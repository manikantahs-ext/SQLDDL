-- DDL Export
-- Server: 10.254.33.61
-- Database: NXT
-- Exported: 2026-02-05T11:35:13.270245

USE NXT;
GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.AdvisoryPerformanceReportDataDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[AdvisoryPerformanceReportDataDetails] ADD CONSTRAINT [FK__AdvisoryP__Advis__37BA50E6] FOREIGN KEY ([AdvisoryPerformanceReportData_Id]) REFERENCES [dbo].[AdvisoryPerformanceReportData] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.BulkIPO_ClientGroup_Clients
-- --------------------------------------------------
ALTER TABLE [dbo].[BulkIPO_ClientGroup_Clients] ADD CONSTRAINT [FK_BulkIPO_ClientGroup_Clients_GroupId] FOREIGN KEY ([GroupId]) REFERENCES [dbo].[BulkIPO_ClientGroup] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.DDLCat_PaymentMode
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat_PaymentMode] ADD CONSTRAINT [FK_DDLCat_PaymentMode_CatId] FOREIGN KEY ([CatId]) REFERENCES [dbo].[DDLCat] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.DDLCat_PaymentMode
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat_PaymentMode] ADD CONSTRAINT [FK_DDLCat_PaymentMode_PayModeId] FOREIGN KEY ([PayModeId]) REFERENCES [dbo].[PaymentMode] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.DDLCat_PaymentModeLog
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat_PaymentModeLog] ADD CONSTRAINT [FK_DDLCat_PaymentModeLog_CatPayModeId] FOREIGN KEY ([CatPayModeId]) REFERENCES [dbo].[DDLCat_PaymentMode] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.DDLCatLog
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCatLog] ADD CONSTRAINT [FK_DDLCatLog_CatId] FOREIGN KEY ([CatId]) REFERENCES [dbo].[DDLCat] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.DocumentUpload
-- --------------------------------------------------
ALTER TABLE [dbo].[DocumentUpload] ADD CONSTRAINT [FK_DocumentUpload_MasterId] FOREIGN KEY ([MasterId]) REFERENCES [dbo].[DocumentUploadMaster] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.DocumentUploadYoutube
-- --------------------------------------------------
ALTER TABLE [dbo].[DocumentUploadYoutube] ADD CONSTRAINT [FK_DocumentUploadYoutube_MasterId] FOREIGN KEY ([MasterId]) REFERENCES [dbo].[DocumentUploadMaster] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.QuestionAnswerModule
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerModule] ADD CONSTRAINT [FK_QuestionAnswerModule_TrainingLinkId] FOREIGN KEY ([TrainingLinkId]) REFERENCES [dbo].[TrainingLinks] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.QuestionAnswerOptions
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerOptions] ADD CONSTRAINT [FK_QuestionAnswerOptions_AnswerOptionId] FOREIGN KEY ([AnswerOptionId]) REFERENCES [dbo].[AnswerOptions] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.QuestionAnswerOptions
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerOptions] ADD CONSTRAINT [FK_QuestionAnswerOptions_QuestionId] FOREIGN KEY ([QuestionId]) REFERENCES [dbo].[Questions_TobeDrop] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.Questions_TobeDrop
-- --------------------------------------------------
ALTER TABLE [dbo].[Questions_TobeDrop] ADD CONSTRAINT [FK_Questions_ModuleId] FOREIGN KEY ([ModuleId]) REFERENCES [dbo].[QuestionAnswerModule] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.SB_TrainingLinks
-- --------------------------------------------------
ALTER TABLE [dbo].[SB_TrainingLinks] ADD CONSTRAINT [FK_SB_TrainingLinks_SBName_SBTag] FOREIGN KEY ([TrainingLinkId]) REFERENCES [dbo].[TrainingLinks] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.SubBrokerQuestion
-- --------------------------------------------------
ALTER TABLE [dbo].[SubBrokerQuestion] ADD CONSTRAINT [FK_SubBrokerQuestion_ModuleId] FOREIGN KEY ([ModuleId]) REFERENCES [dbo].[QuestionAnswerModule] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.SubBrokerQuestionResponse
-- --------------------------------------------------
ALTER TABLE [dbo].[SubBrokerQuestionResponse] ADD CONSTRAINT [FK_SubBrokerQuestionResponse_SubBrokerQueId] FOREIGN KEY ([SubBrokerQueId]) REFERENCES [dbo].[SubBrokerQuestion] ([Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.t2
-- --------------------------------------------------
ALTER TABLE [dbo].[t2] ADD CONSTRAINT [FK__t2__a__1C873BEC] FOREIGN KEY ([a]) REFERENCES [dbo].[t1] ([a])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.Tbl_NXTMobilePopupSbTagMap
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_NXTMobilePopupSbTagMap] ADD CONSTRAINT [FK__Tbl_NXTMo__Popup__79CCCF6F] FOREIGN KEY ([Popup_Id]) REFERENCES [dbo].[Tbl_NXTMobilePopup] ([id])

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_CalEmployeeAge
-- --------------------------------------------------
CREATE FUNCTION [dbo].[fn_CalEmployeeAge](@DOB DATETIME)
RETURNS INT 
AS 
BEGIN
	DECLARE @TEMPDATE DATE
	DECLARE @STRING  VARCHAR(100), @YRS INT, @MONTH INT, @DAYS INT
	--SET @DOB = '1990-08-18'
	SET @TEMPDATE = @DOB

	SELECT	@YRS = DATEDIFF(YEAR, @TEMPDATE,GETDATE())-
			CASE 
				WHEN
					(MONTH(@DOB) > MONTH(GETDATE())) OR
					(MONTH(@DOB) = MONTH(GETDATE()) AND DAY(@DOB) > DAY(GETDATE()))
			THEN 1 ELSE  0
			END
			RETURN @YRS 
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_Get_StartData
-- --------------------------------------------------
CREATE function [dbo].[fn_Get_StartData]
(
	@period varchar(20) ='MTD'
)
/*
select dbo.fn_Get_StartData('YTD')
select dbo.fn_Get_StartData('MTD')
*/
returns date
AS
BEGIN
	declare @rdate datetime = getdate()
	if (@period = 'YTD')
	BEGIN

	--select @rdate=convert(Date,DateAdd(yy, -1, dateadd(d,1,getdate())))
	select @rdate=cast(DateAdd(yy, -1,DATEADD(dd,-(DAY(DATEADD(mm,1,getdate()))-1),
DATEADD(mm,1,getdate()))) as date)
	END
	ELSE
			if (@period = 'MTD')
	BEGIN
		set @rdate = cast(DATEADD(month, DATEDIFF(month, 0, getdate()), 0) as date) 
	END

	ElSE

	Begin 
		set @rdate = '1900-01-01'
	End

	return @rdate ;
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_Get_StartData_Opt20180425
-- --------------------------------------------------

CREATE function [dbo].[fn_Get_StartData_Opt20180425]
(
	@period varchar(20) ='MTD'
)
/*
select dbo.fn_Get_StartData_Opt20180425('YTD')
select dbo.fn_Get_StartData_Opt20180425('MTD')
*/
returns date
AS
BEGIN
	declare @rdate datetime = getdate()
	if (@period = 'YTD')
	BEGIN
		----select @rdate=convert(Date,DateAdd(yy, -1, dateadd(d,1,getdate())))
		--select @rdate=cast(DateAdd(yy, -1,DATEADD(dd,-(DAY(DATEADD(mm,1,getdate()))-1),
		--DATEADD(mm,1,getdate()))) as date)

		SELECT @rdate=
		CASE 
		WHEN DATEPART(MONTH, getdate()) < 4
			THEN CONVERT(DATETIME, CONVERT(CHAR(4), DATEPART(YEAR, DATEADD(yy,-1,getdate()))) + '-04-01') 
		WHEN DATEPART(MONTH, getdate()) >= 4
			THEN CONVERT(DATETIME, CONVERT(CHAR(4), DATEPART(YEAR, getdate())) + '-04-01') 
		END 

	END
	ELSE
	BEGIN
		set @rdate = cast(DATEADD(month, DATEDIFF(month, 0, getdate()), 0) as date) 
	END

	return @rdate ;
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.Fn_getMFLedgerBalance_IPartner
-- --------------------------------------------------
CREATE FUNCTION [dbo].[Fn_getMFLedgerBalance_IPartner]
(
--Declare 
@PartyCode Varchar(1000)='rp61'

)
--RETURNS @Strings TABLE(Limit Float)
RETURNS Float
AS
BEGIN

/*
select dbo.Fn_getMFLedgerBalance_IPartner('ALWR2144')
EXEC [usp_getMFLedgerBalance_IPartner]'rp61'
*/

Declare @Limit Float

Declare @Temp table
(
	DRAMOUNT Float,CL_CODE varchar(100)

)

Declare @bse table
(
CRAMOUNT Float,                   
DRAMOUNT Float,                  
BALANCE Float,                   
cltcode varchar(100),                   
edt date                  
)

Declare @nse table
(
CRAMOUNT Float,                   
DRAMOUNT Float,                  
BALANCE Float,                   
cltcode varchar(100),                   
edt date                  
)

Declare @NSEBSEALL table 
(
balance Float,PartyCode  varchar(100)
)

Declare @MF_PO table 
(
	Amount Float,
	PartyCode varchar(100)
)
Declare @NSEBSEALLFinal table 
(
balance float,PartyCode varchar(100)
)

declare @TempFinal table 
(
DRAMOUNT float,PartyCode  varchar(100)
)

declare @MF_POFinal table
(
Amount float,PartyCode  varchar(100)
)



INSERT INTO @Temp
SELECT (DRAMOUNT) DRAMOUNT,CL_CODE As PartyCode 
--INTO #Temp
FROM [AngelFO].BBO_FA.dbo.MFSS_REL_DATA with (nolock) WHERE RELDT_DR ='' AND RELDT_CR =''
and VTYPE=2
and CL_CODE=@PartyCode 
--group by CL_CODE


insert into @bse
SELECT		Sum(cramount)                 AS CRAMOUNT,                   
            Sum(dramount)                 AS DRAMOUNT,                  
            Sum(cramount) - ISNULL(Sum(dramount),0) AS BALANCE,                   
            cltcode,                   
            edt                   
     --INTO   #bse                   
     FROM   [AngelFO].bbo_fa.dbo.mfss_ledger_bse with (nolock)                   
     --WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), edt)) = CONVERT(DATETIME,CONVERT(VARCHAR(11), Getdate()))                   
    -- WHERE EDT BETWEEN (SELECT SDTCUR FROM PARAMETER WITH (NOLOCK) WHERE CURYEAR=1) AND (SELECT LDTCUR FROM PARAMETER WITH (NOLOCK) WHERE CURYEAR=1)  
       WHERE VDT BETWEEN (SELECT SDTCUR FROM  [AngelFO].BBO_FA.dbo.PARAMETER WITH (NOLOCK) WHERE CURYEAR=1) AND (SELECT LDTCUR FROM  [AngelFO].BBO_FA.dbo.PARAMETER WITH (NOLOCK) WHERE CURYEAR=1)  
       and EDT>=(SELECT SDTCUR FROM  [AngelFO].BBO_FA.dbo.PARAMETER WITH (NOLOCK) WHERE CURYEAR=1)
       and cltcode=@PartyCode
     GROUP  BY cltcode,                   
               edt                   
                
				insert into @nse 
     SELECT Sum(cramount)                 AS CRAMOUNT,                   
            Sum(dramount)                 AS DRAMOUNT,                  
            Sum(cramount) - ISNULL(Sum(dramount),0) AS BALANCE,                   
            cltcode,                   
            edt                   
     --INTO   #nse                   
     FROM   [AngelFO].bbo_fa.dbo.mfss_ledger_nse  with (nolock)                
     --WHERE  CONVERT(DATETIME, CONVERT(VARCHAR(11), edt)) = CONVERT(DATETIME,CONVERT(VARCHAR(11), Getdate()))                   
     WHERE EDT BETWEEN (SELECT SDTCUR FROM  [AngelFO].BBO_FA.dbo.PARAMETER WITH (NOLOCK) WHERE CURYEAR=1) AND (SELECT LDTCUR FROM  [AngelFO].BBO_FA.dbo.PARAMETER WITH (NOLOCK) WHERE CURYEAR=1)  
     and EDT>=(SELECT SDTCUR FROM  [AngelFO].BBO_FA.dbo.PARAMETER WITH (NOLOCK) WHERE CURYEAR=1)
     and cltcode=@PartyCode
     GROUP  BY cltcode,                   
               edt          

insert into @NSEBSEALL
Select (BALANCE) balance ,PartyCode  from 
(
select A.BALANCE BALANCE,A.cltcode PartyCode 
from @bse A
UNION ALL
select A.BALANCE BALANCE,A.cltcode PartyCode 
from @nse A
) T
--group by PartyCode 


--select * from #NSEBSEALL
insert into @MF_PO 
Select Amount,clientcode PartyCode --INTO #MF_PO 
from [196.1.115.132].risk.dbo.vw_MutualFundPendingOrder_NCMS WITH (NOLOCK)
where clientcode=   @PartyCode                

--select * from #MF_PO
insert into @NSEBSEALLFinal
select ISNULL(sum(balance),0) balance,PartyCode from @NSEBSEALL Group by PartyCode
insert into @TempFinal
select ISNULL(Sum(DRAMOUNT),0) DRAMOUNT,CL_CODE from @Temp Group by CL_CODE
insert into @MF_POFinal
select Isnull(Sum(Amount),0)  Amount,PartyCode from @MF_PO Group by PartyCode


SELECT 
@Limit=isnull((balance),0)-(ISNULL(B.DRAMOUNT,0))-(ISNULL(PO.Amount,0)) --Balance--,A.PartyCode   
 from @NSEBSEALLFinal A --order by edt    
left JOIN @TempFinal B  ON A.PartyCode  =B.PartyCode  
left join @MF_POFinal PO ON A.PartyCode  =PO.PartyCode  


	RETURN @Limit 



END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_IPartner_FormatAddress
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			11/18/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This function formats Address.

	SELECT dbo.fn_IPartner_FormatAddress ('Address1,', ',aDDress2', 'LandMark', 'Mumbai', ',Maharashtra,', '4000062', 0)
*/	
/**************************************************************/

CREATE FUNCTION [dbo].[fn_IPartner_FormatAddress]
(
	@Addline1 VARCHAR(50)
	,@Addline2 VARCHAR(50)
	,@Landmark VARCHAR(50)
	,@City VARCHAR(50)
	,@State VARCHAR(50)
	,@Pincode VARCHAR(50)
	,@CaseFlag INT
)
RETURNS VARCHAR(500)
AS
BEGIN

	DECLARE @Address VARCHAR(500)
	DECLARE @StringData TABLE (ID INT IDENTITY(1,1), Data VARCHAR(500))

	INSERT INTO @StringData(Data) VALUES(@Addline1)
	INSERT INTO @StringData(Data) VALUES(@Addline2)
	INSERT INTO @StringData(Data) VALUES(@Landmark)
	INSERT INTO @StringData(Data) VALUES(@City)
	INSERT INTO @StringData(Data) VALUES(@State)
	INSERT INTO @StringData(Data) VALUES(@Pincode)

	;WITH AddDataSet AS
	(
		SELECT SubCategory FROM
		(
			SELECT 
				LTRIM(RTRIM(Split.Data.value('.', 'VARCHAR(100)'))) AS SubCategory
			FROM
			(
				SELECT CAST('<V>' + REPLACE(REPLACE([Data], ',', '</V><V>'),'&','&amp;') + '</V>' AS XML) AS String FROM @StringData
				ORDER BY ID
				OFFSET 0 ROWS FETCH NEXT 100 ROWS ONLY
			) AS A 
			CROSS APPLY String.nodes('/V') AS Split(Data)
		) X
		WHERE LEN(SubCategory) > 0
	)	
	SELECT @Address = REPLACE(SUBSTRING((SELECT  CAST('|' + SubCategory AS VARCHAR(MAX)) FROM AddDataSet FOR XML PATH('')), 2, 4000), '|', ', ')

	SET @Address = CASE WHEN @CaseFlag = 1 THEN UPPER(@Address) WHEN @CaseFlag = 2 THEN LOWER(@Address) ELSE dbo.fn_IPartner_TitleCase(@Address) END

	RETURN @Address

END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_IPartner_TitleCase
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			11/18/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This function formats Address.

	SELECT dbo.fn_IPartner_TitleCase ('AdDress1,')
*/	
/**************************************************************/
CREATE FUNCTION [dbo].[fn_IPartner_TitleCase]
(
	@InputString VARCHAR(4000)
)
RETURNS VARCHAR(4000)
AS
BEGIN
	DECLARE @Index INT
	DECLARE @Char CHAR(1)
	DECLARE @OutputString VARCHAR(255)
	
	SET @OutputString = LOWER(@InputString)
	SET @Index = 2
	SET @OutputString = STUFF(@OutputString, 1, 1,UPPER(SUBSTRING(@InputString,1,1)))
	WHILE @Index <= LEN(@InputString)
	BEGIN
		SET @Char = SUBSTRING(@InputString, @Index, 1)
		IF @Char IN (' ', ';', ':', '!', '?', ',', '.', '_', '-', '/', '&','''','(')
			IF @Index + 1 <= LEN(@InputString)
			BEGIN
				IF @Char != '''' OR UPPER(SUBSTRING(@InputString, @Index + 1, 1)) != 'S'
				SET @OutputString = STUFF(@OutputString, @Index + 1, 1,UPPER(SUBSTRING(@InputString, @Index + 1, 1)))
			END
		SET @Index = @Index + 1
	END

	RETURN ISNULL(@OutputString,'')

END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_Split
-- --------------------------------------------------


CREATE FUNCTION [dbo].[fn_Split](@text VARCHAR(max),  @delimiter VARCHAR(5) = ',') 

RETURNS @Strings TABLE

(   

	 StringValue VARCHAR(max)

)

AS



BEGIN



DECLARE @index int 



SET @index = -1 



WHILE (LEN(@text) > 0)

BEGIN  



    SET @index = CHARINDEX(@delimiter , @text)  



    IF (@index = 0) AND (LEN(@text) > 0)  

	BEGIN   

		INSERT INTO @Strings VALUES (LTRIM(RTRIM(@text)))

		BREAK  

	END  



    IF (@index > 1)  

      BEGIN   

        INSERT INTO @Strings VALUES (LTRIM(RTRIM(LEFT(@text,@index - 1))))   

        SET @text = RIGHT(@text, (LEN(@text) - @index))  

      END  

    ELSE 

      SET @text = RIGHT(@text, (LEN(@text) - @index)) 

    END

	RETURN

END

GO

-- --------------------------------------------------
-- FUNCTION dbo.parseJSON
-- --------------------------------------------------

create FUNCTION [dbo].[parseJSON]( @JSON NVARCHAR(MAX))
	RETURNS @hierarchy TABLE
	  (
	   element_id INT IDENTITY(1, 1) NOT NULL, /* internal surrogate primary key gives the order of parsing and the list order */
	   sequenceNo [int] NULL, /* the place in the sequence for the element */
	   parent_ID INT,/* if the element has a parent then it is in this column. The document is the ultimate parent, so you can get the structure from recursing from the document */
	   Object_ID INT,/* each list or object has an object id. This ties all elements to a parent. Lists are treated as objects here */
	   NAME NVARCHAR(2000),/* the name of the object */
	   StringValue NVARCHAR(MAX) NOT NULL,/*the string representation of the value of the element. */
	   ValueType VARCHAR(10) NOT null /* the declared type of the value represented as a string in StringValue*/
	  )
	AS
	BEGIN
	  DECLARE
	    @FirstObject INT, --the index of the first open bracket found in the JSON string
	    @OpenDelimiter INT,--the index of the next open bracket found in the JSON string
	    @NextOpenDelimiter INT,--the index of subsequent open bracket found in the JSON string
	    @NextCloseDelimiter INT,--the index of subsequent close bracket found in the JSON string
	    @Type NVARCHAR(10),--whether it denotes an object or an array
	    @NextCloseDelimiterChar CHAR(1),--either a '}' or a ']'
	    @Contents NVARCHAR(MAX), --the unparsed contents of the bracketed expression
	    @Start INT, --index of the start of the token that you are parsing
	    @end INT,--index of the end of the token that you are parsing
	    @param INT,--the parameter at the end of the next Object/Array token
	    @EndOfName INT,--the index of the start of the parameter at end of Object/Array token
	    @token NVARCHAR(200),--either a string or object
	    @value NVARCHAR(MAX), -- the value as a string
	    @SequenceNo int, -- the sequence number within a list
	    @name NVARCHAR(200), --the name as a string
	    @parent_ID INT,--the next parent ID to allocate
	    @lenJSON INT,--the current length of the JSON String
	    @characters NCHAR(36),--used to convert hex to decimal
	    @result BIGINT,--the value of the hex symbol being parsed
	    @index SMALLINT,--used for parsing the hex value
	    @Escape INT --the index of the next escape character
	    
	  DECLARE @Strings TABLE /* in this temporary table we keep all strings, even the names of the elements, since they are 'escaped' in a different way, and may contain, unescaped, brackets denoting objects or lists. These are replaced in the JSON string by tokens representing the string */
	    (
	     String_ID INT IDENTITY(1, 1),
	     StringValue NVARCHAR(MAX)
	    )
	  SELECT--initialise the characters to convert hex to ascii
	    @characters='0123456789abcdefghijklmnopqrstuvwxyz',
	    @SequenceNo=0, --set the sequence no. to something sensible.
	  /* firstly we process all strings. This is done because [{} and ] aren't escaped in strings, which complicates an iterative parse. */
	    @parent_ID=0;
	  WHILE 1=1 --forever until there is nothing more to do
	    BEGIN
	      SELECT
	        @start=PATINDEX('%[^a-zA-Z]["]%', @json collate SQL_Latin1_General_CP850_Bin);--next delimited string
	      IF @start=0 BREAK --no more so drop through the WHILE loop
	      IF SUBSTRING(@json, @start+1, 1)='"' 
	        BEGIN --Delimited Name
	          SET @start=@Start+1;
	          SET @end=PATINDEX('%[^\]["]%', RIGHT(@json, LEN(@json+'|')-@start) collate SQL_Latin1_General_CP850_Bin);
	        END
	      IF @end=0 --no end delimiter to last string
	        BREAK --no more
	      SELECT @token=SUBSTRING(@json, @start+1, @end-1)
	      --now put in the escaped control characters
	      SELECT @token=REPLACE(@token, FROMString, TOString)
	      FROM
	        (SELECT
	          '\"' AS FromString, '"' AS ToString
	         UNION ALL SELECT '\\', '\'
	         UNION ALL SELECT '\/', '/'
	         UNION ALL SELECT '\b', CHAR(08)
	         UNION ALL SELECT '\f', CHAR(12)
	         UNION ALL SELECT '\n', CHAR(10)
	         UNION ALL SELECT '\r', CHAR(13)
	         UNION ALL SELECT '\t', CHAR(09)
	        ) substitutions
	      SELECT @result=0, @escape=1
	  --Begin to take out any hex escape codes
	      WHILE @escape>0
	        BEGIN
	          SELECT @index=0,
	          --find the next hex escape sequence
	          @escape=PATINDEX('%\x[0-9a-f][0-9a-f][0-9a-f][0-9a-f]%', @token collate SQL_Latin1_General_CP850_Bin)
	          IF @escape>0 --if there is one
	            BEGIN
	              WHILE @index<4 --there are always four digits to a \x sequence   
	                BEGIN
	                  SELECT --determine its value
	                    @result=@result+POWER(16, @index)
	                    *(CHARINDEX(SUBSTRING(@token, @escape+2+3-@index, 1),
	                                @characters)-1), @index=@index+1 ;
	         
	                END
	                -- and replace the hex sequence by its unicode value
	              SELECT @token=STUFF(@token, @escape, 6, NCHAR(@result))
	            END
	        END
	      --now store the string away 
	      INSERT INTO @Strings (StringValue) SELECT @token
	      -- and replace the string with a token
	      SELECT @JSON=STUFF(@json, @start, @end+1,
	                    '@string'+CONVERT(NVARCHAR(5), @@identity))
	    END
	  -- all strings are now removed. Now we find the first leaf.  
	  WHILE 1=1  --forever until there is nothing more to do
	  BEGIN
	 
	  SELECT @parent_ID=@parent_ID+1
	  --find the first object or list by looking for the open bracket
	  SELECT @FirstObject=PATINDEX('%[{[[]%', @json collate SQL_Latin1_General_CP850_Bin)--object or array
	  IF @FirstObject = 0 BREAK
	  IF (SUBSTRING(@json, @FirstObject, 1)='{') 
	    SELECT @NextCloseDelimiterChar='}', @type='object'
	  ELSE 
	    SELECT @NextCloseDelimiterChar=']', @type='array'
	  SELECT @OpenDelimiter=@firstObject
	  WHILE 1=1 --find the innermost object or list...
	    BEGIN
	      SELECT
	        @lenJSON=LEN(@JSON+'|')-1
	  --find the matching close-delimiter proceeding after the open-delimiter
	      SELECT
	        @NextCloseDelimiter=CHARINDEX(@NextCloseDelimiterChar, @json,
	                                      @OpenDelimiter+1)
	  --is there an intervening open-delimiter of either type
	      SELECT @NextOpenDelimiter=PATINDEX('%[{[[]%',
	             RIGHT(@json, @lenJSON-@OpenDelimiter)collate SQL_Latin1_General_CP850_Bin)--object
	      IF @NextOpenDelimiter=0 
	        BREAK
	      SELECT @NextOpenDelimiter=@NextOpenDelimiter+@OpenDelimiter
	      IF @NextCloseDelimiter<@NextOpenDelimiter 
	        BREAK
	      IF SUBSTRING(@json, @NextOpenDelimiter, 1)='{' 
	        SELECT @NextCloseDelimiterChar='}', @type='object'
	      ELSE 
	        SELECT @NextCloseDelimiterChar=']', @type='array'
	      SELECT @OpenDelimiter=@NextOpenDelimiter
	    END
	  ---and parse out the list or name/value pairs
	  SELECT
	    @contents=SUBSTRING(@json, @OpenDelimiter+1,
	                        @NextCloseDelimiter-@OpenDelimiter-1)
	  SELECT
	    @JSON=STUFF(@json, @OpenDelimiter,
	                @NextCloseDelimiter-@OpenDelimiter+1,
	                '@'+@type+CONVERT(NVARCHAR(5), @parent_ID))
	  WHILE (PATINDEX('%[A-Za-z0-9@+.e]%', @contents collate SQL_Latin1_General_CP850_Bin))<>0 
	    BEGIN
	      IF @Type='Object' --it will be a 0-n list containing a string followed by a string, number,boolean, or null
	        BEGIN
	          SELECT
	            @SequenceNo=0,@end=CHARINDEX(':', ' '+@contents)--if there is anything, it will be a string-based name.
	          SELECT  @start=PATINDEX('%[^A-Za-z@][@]%', ' '+@contents collate SQL_Latin1_General_CP850_Bin)--AAAAAAAA
	          SELECT @token=SUBSTRING(' '+@contents, @start+1, @End-@Start-1),
	            @endofname=PATINDEX('%[0-9]%', @token collate SQL_Latin1_General_CP850_Bin),
	            @param=RIGHT(@token, LEN(@token)-@endofname+1)
	          SELECT
	            @token=LEFT(@token, @endofname-1),
	            @Contents=RIGHT(' '+@contents, LEN(' '+@contents+'|')-@end-1)
	          SELECT  @name=stringvalue FROM @strings
	            WHERE string_id=@param --fetch the name
	        END
	      ELSE 
	        SELECT @Name=null,@SequenceNo=@SequenceNo+1 
	      SELECT
	        @end=CHARINDEX(',', @contents)-- a string-token, object-token, list-token, number,boolean, or null
	      IF @end=0 
	        SELECT  @end=PATINDEX('%[A-Za-z0-9@+.e][^A-Za-z0-9@+.e]%', @Contents+' ' collate SQL_Latin1_General_CP850_Bin)
	          +1
	       SELECT
	        @start=PATINDEX('%[^A-Za-z0-9@+.e][A-Za-z0-9@+.e]%', ' '+@contents collate SQL_Latin1_General_CP850_Bin)
	      --select @start,@end, LEN(@contents+'|'), @contents  
	      SELECT
	        @Value=RTRIM(SUBSTRING(@contents, @start, @End-@Start)),
	        @Contents=RIGHT(@contents+' ', LEN(@contents+'|')-@end)
	      IF SUBSTRING(@value, 1, 7)='@object' 
	        INSERT INTO @hierarchy
	          (NAME, SequenceNo, parent_ID, StringValue, Object_ID, ValueType)
	          SELECT @name, @SequenceNo, @parent_ID, SUBSTRING(@value, 8, 5),
	            SUBSTRING(@value, 8, 5), 'object' 
	      ELSE 
	        IF SUBSTRING(@value, 1, 6)='@array' 
	          INSERT INTO @hierarchy
	            (NAME, SequenceNo, parent_ID, StringValue, Object_ID, ValueType)
	            SELECT @name, @SequenceNo, @parent_ID, SUBSTRING(@value, 7, 5),
	              SUBSTRING(@value, 7, 5), 'array' 
	        ELSE 
	          IF SUBSTRING(@value, 1, 7)='@string' 
	            INSERT INTO @hierarchy
	              (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	              SELECT @name, @SequenceNo, @parent_ID, stringvalue, 'string'
	              FROM @strings
	              WHERE string_id=SUBSTRING(@value, 8, 5)
	          ELSE 
	            IF @value IN ('true', 'false') 
	              INSERT INTO @hierarchy
	                (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                SELECT @name, @SequenceNo, @parent_ID, @value, 'boolean'
	            ELSE
	              IF @value='null' 
	                INSERT INTO @hierarchy
	                  (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                  SELECT @name, @SequenceNo, @parent_ID, @value, 'null'
	              ELSE
	                IF PATINDEX('%[^0-9]%', @value collate SQL_Latin1_General_CP850_Bin)>0 
	                  INSERT INTO @hierarchy
	                    (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                    SELECT @name, @SequenceNo, @parent_ID, @value, 'real'
	                ELSE
	                  INSERT INTO @hierarchy
	                    (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                    SELECT @name, @SequenceNo, @parent_ID, @value, 'int'
	      if @Contents=' ' Select @SequenceNo=0
	    END
	  END
	INSERT INTO @hierarchy (NAME, SequenceNo, parent_ID, StringValue, Object_ID, ValueType)
	  SELECT '-',1, NULL, '', @parent_id-1, @type
	--
	   RETURN
	END

GO

-- --------------------------------------------------
-- FUNCTION dbo.random_password
-- --------------------------------------------------

--select dbo.random_password(8, '')        
CREATE Function [dbo].[random_password]                   
(                    
@len int = 8, --Length of the password to be generated                    
@password_type char(7) = 'simple'                     
--Default is to generate a simple password with lowecase letters.                     
--Pass anything other than 'simple' to generate a complex password.                     
--The complex password includes numbers, special characters, upper case and lower case letters                    
)             
Returns varchar(15)                   
AS                    
Begin            
                
                  
DECLARE @password varchar(25), @type tinyint, @bitmap char(6)                    
SET @password=''                     
--SET @bitmap = '#$%^&~!'                     
--SET @bitmap = 'aeruoy'                     
----@bitmap contains all the vowels, which are a, e, i, o, u and y. These vowels are used to generate slightly readable/rememberable simple passwords                    
SET @bitmap = '1234567890'                     
      
IF @password_type <> 'simple'                   
begin                  
  select @password = @password + SUBSTRING(@bitmap,CONVERT(int,ROUND(1 + (RandNum * (5)),0)),1) from Vw_RAND                   
  set @len = @len-1                  
end                  
SET @bitmap = 'aerouy'                     
--set @len =len(@password)                  
                  
WHILE @len > 0                    
BEGIN                    
 IF @password_type = 'simple' --Generating a simple password                    
 BEGIN                    
  IF (@len%2) = 0  --Appending a random vowel to @password                    
    select @password = @password + SUBSTRING(@bitmap,CONVERT(int,ROUND(1 + (RandNum * (5)),0)),1)   from Vw_RAND                         
  ELSE --Appending a random alphabet                    
    select @password = @password + CHAR(ROUND(97 + (RandNum * (25)),0))      from Vw_RAND                      
  END                    
 ELSE --Generating a complex password                    
  BEGIN                    
  select @type = 3--ROUND(1 + (RandNum * (3)),0)  from Vw_RAND                              
                    
   IF @type = 1 --Appending a random lower case alphabet to @password                    
    select @password = @password + CHAR(ROUND(97 + (RandNum * (25)),0))     from Vw_RAND                       
 ELSE IF @type = 2 --Appending a random upper case alphabet to @password                    
    select @password = @password + CHAR(ROUND(65 + (RandNum * (25)),0))     from Vw_RAND                      
 ELSE IF @type = 3 --Appending a random number between 0 and 9 to @password                    
    select @password = @password + CHAR(ROUND(48 + (RandNum * (9)),0))        from Vw_RAND                   
 ELSE IF @type = 4 --Appending a random special character to @password                    
--    below ascii code is off. replace with numeric code between 0 and 9                
--    SET @password = @password + CHAR(ROUND(33 + (RAND() * (13)),0))                   
    select @password = @password + CHAR(ROUND(48 + (RandNum * (9)),0))     from Vw_RAND                       
  END                    
  SET @len = @len - 1                    
END                    
                    
return @password --Here's the result                    
                    
END

GO

-- --------------------------------------------------
-- INDEX dbo.Accrual_Amt_NXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Accrual_Amt_NXT_Party] ON [dbo].[Accrual_Amt_NXT] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.Accrual_Amt_NXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Accrual_Amt_NXT_PartyAccrual_Amt] ON [dbo].[Accrual_Amt_NXT] ([PARTY_CODE], [Accrual_Amt])

GO

-- --------------------------------------------------
-- INDEX dbo.ALG_EXP_MAST
-- --------------------------------------------------
CREATE CLUSTERED INDEX [PK_ALG_EXP_MAST_ENTITY_CODE] ON [dbo].[ALG_EXP_MAST] ([ENTITY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.ALG_EXP_MAST
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [PK_ALG_EXP_MAST_Intraday_Type] ON [dbo].[ALG_EXP_MAST] ([Intraday_Type])

GO

-- --------------------------------------------------
-- INDEX dbo.AnswerOptions
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_AnswerOptions_Id] ON [dbo].[AnswerOptions] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.B2B_Bulk_DealerMapping
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_B2B_Bulk_DealerMapping_Dealer1] ON [dbo].[B2B_Bulk_DealerMapping] ([Dealer1], [Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.B2B_Bulk_DealerMapping_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_B2B_Bulk_DealerMapping_Prev_Deal] ON [dbo].[B2B_Bulk_DealerMapping_Prev] ([Dealer1])

GO

-- --------------------------------------------------
-- INDEX dbo.bbo_fa_PARAMETER
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_bbo_fa_PARAMETER_] ON [dbo].[bbo_fa_PARAMETER] ([Sdtcur], [Ldtcur])

GO

-- --------------------------------------------------
-- INDEX dbo.bbo_fa_PARAMETER
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_bbo_fa_PARAMETER_Curyear] ON [dbo].[bbo_fa_PARAMETER] ([Curyear])

GO

-- --------------------------------------------------
-- INDEX dbo.BeeMF_UserLoginRequest
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_BeeMF_UserLoginRequest_Acce] ON [dbo].[BeeMF_UserLoginRequest] ([Access_code], [Username])

GO

-- --------------------------------------------------
-- INDEX dbo.BO_MTFFinal
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_BO_MTFFinal_party_code] ON [dbo].[BO_MTFFinal] ([party_code], [FUDEDVAL])

GO

-- --------------------------------------------------
-- INDEX dbo.BO_MTFFinal_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_BO_MTFFinal_Prev_party_code] ON [dbo].[BO_MTFFinal_Prev] ([party_code], [FUDEDVAL])

GO

-- --------------------------------------------------
-- INDEX dbo.bse_sett_mst
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [bse_sett_mst_Sett] ON [dbo].[bse_sett_mst] ([Sett_Type], [Start_date])

GO

-- --------------------------------------------------
-- INDEX dbo.BulkIPO_ClientGroup
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_BulkIPO_ClientGroup] ON [dbo].[BulkIPO_ClientGroup] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.BusinessdashboardActionsNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_BusinessdashboardActionsNXT] ON [dbo].[BusinessdashboardActionsNXT] ([Subbroker], [ClientCode], [Flag])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_New
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idx_dt_cli] ON [dbo].[Cli_AccCharges_New] ([Charges_Date], [Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_New
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Charges_Code] ON [dbo].[Cli_AccCharges_New] ([Charges_Code], [Charges_Date]) INCLUDE ([Party_Code], [Charges_amt])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_New
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_PartyCharges] ON [dbo].[Cli_AccCharges_New] ([Party_Code]) INCLUDE ([Charges_Date], [Charges_Code], [Charges_amt], [JV_Posted], [Updated_on])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_New
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_pccc] ON [dbo].[Cli_AccCharges_New] ([Party_Code], [Charges_Code]) INCLUDE ([Charges_Date], [Charges_amt])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_New
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_updated] ON [dbo].[Cli_AccCharges_New] ([Updated_on])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_Prev
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idx_dt_cli] ON [dbo].[Cli_AccCharges_Prev] ([Charges_Date], [Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Charges_Code] ON [dbo].[Cli_AccCharges_Prev] ([Charges_Code], [Charges_Date]) INCLUDE ([Party_Code], [Charges_amt])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_PartyCharges] ON [dbo].[Cli_AccCharges_Prev] ([Party_Code]) INCLUDE ([Charges_Date], [Charges_Code], [Charges_amt], [JV_Posted], [Updated_on])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_pccc] ON [dbo].[Cli_AccCharges_Prev] ([Party_Code], [Charges_Code]) INCLUDE ([Charges_Date], [Charges_amt])

GO

-- --------------------------------------------------
-- INDEX dbo.Cli_AccCharges_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_updated] ON [dbo].[Cli_AccCharges_Prev] ([Updated_on])

GO

-- --------------------------------------------------
-- INDEX dbo.CLI_ACCCHARGES_TobeDeleted
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_CLI_ACCCHARGES_CutOffDate] ON [dbo].[CLI_ACCCHARGES_TobeDeleted] ([Charges_Code], [Charges_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.CLI_ACCCHARGES_TobeDeleted
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_CLI_ACCCHARGES_Party] ON [dbo].[CLI_ACCCHARGES_TobeDeleted] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.CLI_ACCCHARGESMASTER
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_CLI_ACCCHARGESMASTER] ON [dbo].[CLI_ACCCHARGESMASTER] ([Charges_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.CLI_ACCCHARGESMASTER
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_CLI_ACCCHARGESMASTER_CutOffDate] ON [dbo].[CLI_ACCCHARGESMASTER] ([CutOffDate])

GO

-- --------------------------------------------------
-- INDEX dbo.client_brok_details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [PK_client_brok_details_cl_code] ON [dbo].[client_brok_details] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.client_brok_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [PK_client_brok_details_IS_CLOSED] ON [dbo].[client_brok_details] ([IS_CLOSED])

GO

-- --------------------------------------------------
-- INDEX dbo.client_brok_details_Ipartner
-- --------------------------------------------------
CREATE CLUSTERED INDEX [PK_client_brok_details_Ipartner_cl_code] ON [dbo].[client_brok_details_Ipartner] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.client_brok_details_Ipartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [PK_client_brok_details_Ipartner_IS_CLOSED] ON [dbo].[client_brok_details_Ipartner] ([IS_CLOSED])

GO

-- --------------------------------------------------
-- INDEX dbo.ClientLedgerBalance_IPartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ClientLedgerBalance_IPartner] ON [dbo].[ClientLedgerBalance_IPartner] ([SubBroker])

GO

-- --------------------------------------------------
-- INDEX dbo.ClientLedgerBalance_IPartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ClientLedgerBalance_IPartner_ledger] ON [dbo].[ClientLedgerBalance_IPartner] ([SubBroker]) INCLUDE ([Party_Code], [Ledger])

GO

-- --------------------------------------------------
-- INDEX dbo.ClientLedgerBalance_IPartner_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ClientLedgerBalance_IPartner_Prev_SubB] ON [dbo].[ClientLedgerBalance_IPartner_Prev] ([SubBroker])

GO

-- --------------------------------------------------
-- INDEX dbo.Daily_sharing
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_client] ON [dbo].[Daily_sharing] ([client])

GO

-- --------------------------------------------------
-- INDEX dbo.Daily_sharing
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Daily_sharing_sb_angel_share] ON [dbo].[Daily_sharing] ([sb], [angel_share]) INCLUDE ([sauda_date], [remi_share], [client])

GO

-- --------------------------------------------------
-- INDEX dbo.Daily_sharing
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_TranDate] ON [dbo].[Daily_sharing] ([sauda_date])

GO

-- --------------------------------------------------
-- INDEX dbo.DDLCat
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_DDLCat_Id] ON [dbo].[DDLCat] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.DDLCat_PaymentMode
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_DDLCat_PaymentMode_Id] ON [dbo].[DDLCat_PaymentMode] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.DPStockShiftingOutsideAngel_Log
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_DPStockShiftingOutsideAngel_Log_NISE] ON [dbo].[DPStockShiftingOutsideAngel_Log] ([NISE_PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.EmandateSMSLinkLog
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_EmandateSMSLinkLog_Mand] ON [dbo].[EmandateSMSLinkLog] ([MandateMappingRefNo])

GO

-- --------------------------------------------------
-- INDEX dbo.EmandateSMSLinkLog
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_EmandateSMSLinkLog_PartyCode] ON [dbo].[EmandateSMSLinkLog] ([PartyCode], [MandateMappingRefNo])

GO

-- --------------------------------------------------
-- INDEX dbo.Error_log
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_Error_log_CreatedBy] ON [dbo].[Error_log] ([CreatedBy])

GO

-- --------------------------------------------------
-- INDEX dbo.Error_log
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Error_log_Proj] ON [dbo].[Error_log] ([ProjectName], [Action])

GO

-- --------------------------------------------------
-- INDEX dbo.Error_log
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_Error_log_projectname] ON [dbo].[Error_log] ([ProjectName], [Event], [createdDate])

GO

-- --------------------------------------------------
-- INDEX dbo.FamilyTradeDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_FamilyTradeDetails_Crea] ON [dbo].[FamilyTradeDetails] ([CreatedBy])

GO

-- --------------------------------------------------
-- INDEX dbo.FamilyTradeDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_FamilyTradeDetails_FamilyTradeId] ON [dbo].[FamilyTradeDetails] ([FamilyTradeId], [FamilyTradeName])

GO

-- --------------------------------------------------
-- INDEX dbo.FamilyTradeTransactions
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_FamilyTradeTransactions_ClientID] ON [dbo].[FamilyTradeTransactions] ([ClientId], [MembershipType])

GO

-- --------------------------------------------------
-- INDEX dbo.FamilyTradeTransactions
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_FamilyTradeTransactions_Fami] ON [dbo].[FamilyTradeTransactions] ([FamilyTradeId], [Authorised], [MembershipType])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Daily_Activation1
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Final_Daily_Activation1_party_code] ON [dbo].[Final_Daily_Activation1] ([AR])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Daily_Activation1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_Final_Daily_Activation1_SUB_Broker] ON [dbo].[Final_Daily_Activation1] ([Sub_Broker])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Daily_Activation1
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Final_Daily_Activation11_party_code] ON [dbo].[Final_Daily_Activation1] ([AR])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Test_Buss_Culs
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Final_Test_Buss_Culs_Category] ON [dbo].[Final_Test_Buss_Culs] ([Age_Year], [AR], [Quartile], [Category])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Test_Buss_Culs
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Final_Test_Buss_Culs_ClientAge] ON [dbo].[Final_Test_Buss_Culs] ([Sub_Broker], [AR], [Quartile])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Test_Buss_Culs
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Final_Test_Buss_Culs_party_code] ON [dbo].[Final_Test_Buss_Culs] ([Sub_Broker], [Category])

GO

-- --------------------------------------------------
-- INDEX dbo.Final_Test_Buss_Culs
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_Final_Test_Buss_Culs_SUB_Broker] ON [dbo].[Final_Test_Buss_Culs] ([Sub_Broker])

GO

-- --------------------------------------------------
-- INDEX dbo.ForceUpdate_NXT_Mob
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ForceUpdate_NXT_Mob_] ON [dbo].[ForceUpdate_NXT_Mob] ([sub_broker], [VersionCode], [Plateform], [IsForceUpdate])

GO

-- --------------------------------------------------
-- INDEX dbo.GetArqClientsData_Trans_V3
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_Party_code] ON [dbo].[GetArqClientsData_Trans_V3] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.GetArqClientsData_Trans_V3
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_Sauda_date] ON [dbo].[GetArqClientsData_Trans_V3] ([Sauda_date])

GO

-- --------------------------------------------------
-- INDEX dbo.GroupTopper_Ipartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_GroupTopper_Ipartner_TAGGenerateddate] ON [dbo].[GroupTopper_Ipartner] ([MTD_New_Clt_Aquired_sub_broker], [MTD_New_Clt_Aquired_TAGGenerateddate], [MTD_New_Clt_Aquired], [YTD_New_Clt_Aquired_sub_broker], [YTD_New_Clt_Aquired_TAGGenerateddate], [YTD_New_Clt_Aquired], [MTD_Traded_Client_sub_broker], [MTD_Traded_Client_TAGGenerateddate], [MTD_Traded_Client], [YTD_Traded_Client_sub_broker], [YTD_Traded_Client_TAGGenerateddate]) INCLUDE ([YTD_Traded_Client], [MTD_Gross_Revenue_sub_broker], [MTD_Gross_Revenue_TAGGenerateddate], [MTD_Gross_Revenue], [YTD_Gross_Revenue_sub_broker], [YTD_Gross_Revenue_TAGGenerateddate], [YTD_Gross_Revenue], [MF_AUM_sub_broker], [MF_AUM_TAGGenerateddate], [MF_AUM], [Active_Clients_sub_broker], [Active_Clients_TAGGenerateddate], [Active_Clients], [MF_Active_Clients_sub_broker], [MF_Active_Clients_TAGGenerateddate], [MF_Active_Clients])

GO

-- --------------------------------------------------
-- INDEX dbo.GroupTopper_Ipartner_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_GroupTopper_Ipartner_Prev_TAGGenerateddate] ON [dbo].[GroupTopper_Ipartner_Prev] ([MTD_New_Clt_Aquired_sub_broker], [MTD_New_Clt_Aquired_TAGGenerateddate], [MTD_New_Clt_Aquired], [YTD_New_Clt_Aquired_sub_broker], [YTD_New_Clt_Aquired_TAGGenerateddate], [YTD_New_Clt_Aquired], [MTD_Traded_Client_sub_broker], [MTD_Traded_Client_TAGGenerateddate], [MTD_Traded_Client], [YTD_Traded_Client_sub_broker], [YTD_Traded_Client_TAGGenerateddate]) INCLUDE ([YTD_Traded_Client], [MTD_Gross_Revenue_sub_broker], [MTD_Gross_Revenue_TAGGenerateddate], [MTD_Gross_Revenue], [YTD_Gross_Revenue_sub_broker], [YTD_Gross_Revenue_TAGGenerateddate], [YTD_Gross_Revenue], [MF_AUM_sub_broker], [MF_AUM_TAGGenerateddate], [MF_AUM], [Active_Clients_sub_broker], [Active_Clients_TAGGenerateddate], [Active_Clients], [MF_Active_Clients_sub_broker], [MF_Active_Clients_TAGGenerateddate], [MF_Active_Clients])

GO

-- --------------------------------------------------
-- INDEX dbo.IPartner_ClientImages
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_IPARTNER_CLIENTIMAGES_PARTYCODE] ON [dbo].[IPartner_ClientImages] ([PartyCode])

GO

-- --------------------------------------------------
-- INDEX dbo.IPartner_ScripTicker
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_IPartner_ScripTicker_SubB] ON [dbo].[IPartner_ScripTicker] ([SubBroker])

GO

-- --------------------------------------------------
-- INDEX dbo.IPartner_ScripTicker
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UK_IPartner_ScripTicker_CoCode_SubBroker] ON [dbo].[IPartner_ScripTicker] ([CoCode], [SubBroker])

GO

-- --------------------------------------------------
-- INDEX dbo.iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting] ON [dbo].[iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting] ([Startofmonth], [Category], [Sub_Broker], [ClientCode])

GO

-- --------------------------------------------------
-- INDEX dbo.iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SBCODE] ON [dbo].[iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting] ([SBCODE], [Startofmonth]) INCLUDE ([activefrom], [NetBrokRev], [GrossBrokRev])

GO

-- --------------------------------------------------
-- INDEX dbo.iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SBCODE_Startofmonth] ON [dbo].[iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting] ([SBCODE], [Startofmonth]) INCLUDE ([availabletradedays])

GO

-- --------------------------------------------------
-- INDEX dbo.iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev_SBCODE_Startofmonth] ON [dbo].[iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev] ([SBCODE], [Startofmonth]) INCLUDE ([activefrom], [NetBrokRev], [GrossBrokRev])

GO

-- --------------------------------------------------
-- INDEX dbo.ItradeSMS_log
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ItradeSMS_log_date] ON [dbo].[ItradeSMS_log] ([date])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_IWMF_trn_current_holding_party_Code] ON [dbo].[IWMF_trn_current_holding] ([party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding_Folio
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_IWMF_trn_current_holding_Folio_angelqty] ON [dbo].[IWMF_trn_current_holding_Folio] ([Angel_Qty]) INCLUDE ([AsOnDate], [party_Code], [scheme_code], [DPFlag], [avg_rate], [MapID], [ProductID], [RedeemableUnit], [SchemeName], [ISIN], [LastNAVPrice], [LastNAVDate], [PrevNAV])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding_Folio
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_IWMF_trn_current_holding_Folio_party] ON [dbo].[IWMF_trn_current_holding_Folio] ([party_Code], [DPFlag], [ISIN])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding_Folio
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_IWMF_trn_current_holding_Folio_partycode] ON [dbo].[IWMF_trn_current_holding_Folio] ([party_Code]) INCLUDE ([AsOnDate], [scheme_code], [DPFlag], [Angel_Qty], [avg_rate], [MapID], [ProductID], [RedeemableUnit], [SchemeName], [ISIN], [LastNAVPrice], [LastNAVDate], [PrevNAV])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding_Folio_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_IWMF_trn_current_holding_Folio_party] ON [dbo].[IWMF_trn_current_holding_Folio_Prev] ([party_Code], [DPFlag], [ISIN])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding_Folio_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_IWMF_trn_current_holding_Folio_Prev_angelqty] ON [dbo].[IWMF_trn_current_holding_Folio_Prev] ([Angel_Qty]) INCLUDE ([AsOnDate], [party_Code], [scheme_code], [DPFlag], [avg_rate], [MapID], [ProductID], [RedeemableUnit], [SchemeName], [ISIN], [LastNAVPrice], [LastNAVDate], [PrevNAV])

GO

-- --------------------------------------------------
-- INDEX dbo.IWMF_trn_current_holding_Folio_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Ix_IWMF_trn_current_holding_Folio_Prev_partycode] ON [dbo].[IWMF_trn_current_holding_Folio_Prev] ([party_Code]) INCLUDE ([AsOnDate], [scheme_code], [DPFlag], [Angel_Qty], [avg_rate], [MapID], [ProductID], [RedeemableUnit], [SchemeName], [ISIN], [LastNAVPrice], [LastNAVDate], [PrevNAV])

GO

-- --------------------------------------------------
-- INDEX dbo.LMS_registration
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_LMS_registration_SB_C] ON [dbo].[LMS_registration] ([SB_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.MARGIN_Accural
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MARGIN_Accural] ON [dbo].[MARGIN_Accural] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.MARGIN_Accural_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MARGIN_Accural] ON [dbo].[MARGIN_Accural_Prev] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.MF_LED_SUM
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MF_LED_SUM_Debit] ON [dbo].[MF_LED_SUM] ([DEBIT_BALANCE], [CREDIT_BALANCE])

GO

-- --------------------------------------------------
-- INDEX dbo.MF_LED_SUM
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_MF_LED_SUM_Party_Code] ON [dbo].[MF_LED_SUM] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_bse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mfss_ledger_bse_CRAMOUNT] ON [dbo].[mfss_ledger_bse] ([VDT], [EDT], [DRAMOUNT], [CRAMOUNT])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_bse
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_mfss_ledger_bse_NCMS] ON [dbo].[mfss_ledger_bse] ([CLTCODE])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_bse_Ipartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mfss_ledger_bse_Ipartner_CRAMOUNT] ON [dbo].[mfss_ledger_bse_Ipartner] ([VDT], [EDT], [DRAMOUNT], [CRAMOUNT])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_bse_Ipartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mfss_ledger_bse_Ipartner_CRAMOUNT_vno] ON [dbo].[mfss_ledger_bse_Ipartner] ([VDT], [EDT], [DRAMOUNT], [CRAMOUNT], [VNO])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_bse_Ipartner
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_mfss_ledger_bse_Ipartner_NCMS] ON [dbo].[mfss_ledger_bse_Ipartner] ([CLTCODE])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_nse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mfss_ledger_nse_CRAMOUNT] ON [dbo].[mfss_ledger_nse] ([VDT], [EDT], [DRAMOUNT], [CRAMOUNT])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_nse
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_mfss_ledger_nse_NCMS] ON [dbo].[mfss_ledger_nse] ([CLTCODE])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_nse_Ipartner
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mfss_ledger_nse_Ipartner_CRAMOUNT] ON [dbo].[mfss_ledger_nse_Ipartner] ([VDT], [EDT], [DRAMOUNT], [CRAMOUNT])

GO

-- --------------------------------------------------
-- INDEX dbo.mfss_ledger_nse_Ipartner
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_mfss_ledger_nse_Ipartner_NCMS] ON [dbo].[mfss_ledger_nse_Ipartner] ([CLTCODE])

GO

-- --------------------------------------------------
-- INDEX dbo.MFSS_REL_DATA
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_MFSS_REL_DATA] ON [dbo].[MFSS_REL_DATA] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.MFSS_REL_DATA
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MFSS_REL_DATA_Debit] ON [dbo].[MFSS_REL_DATA] ([RELDT_DR], [RELDT_CR], [VTYPE], [DRAMOUNT])

GO

-- --------------------------------------------------
-- INDEX dbo.mis_to
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_mis_to_sub_] ON [dbo].[mis_to] ([sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.Mtf_Holding
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Mtf_Holding] ON [dbo].[Mtf_Holding] ([Party_code], [Mtf_Holding])

GO

-- --------------------------------------------------
-- INDEX dbo.Mtf_Holding_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Mtf_Holding_Prev] ON [dbo].[Mtf_Holding_Prev] ([Party_code], [Mtf_Holding])

GO

-- --------------------------------------------------
-- INDEX dbo.MTF_STATUS
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MTF_STATUS_party_code] ON [dbo].[MTF_STATUS] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.MTF_STATUS_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MTF_STATUS_Prev_Part] ON [dbo].[MTF_STATUS_Prev] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.MTM_CLIENTS
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_MTM_CLIENTS_Party] ON [dbo].[MTM_CLIENTS] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.MTM_CLIENTS_Prev
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_MTM_CLIENTS_Prev_Party] ON [dbo].[MTM_CLIENTS_Prev] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.MultilocationSBTags
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_MultilocationSBTags_SBTag] ON [dbo].[MultilocationSBTags] ([SbTag])

GO

-- --------------------------------------------------
-- INDEX dbo.NotificationBeeNXT_MasterList
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_NotificationBeeNXT_MasterList_Moduleame] ON [dbo].[NotificationBeeNXT_MasterList] ([Modulename], [area], [Controller], [action])

GO

-- --------------------------------------------------
-- INDEX dbo.NXT_HistoryUserLogin
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_NXT_HistoryUserLogin_Username] ON [dbo].[NXT_HistoryUserLogin] ([Username])

GO

-- --------------------------------------------------
-- INDEX dbo.NXT_HistoryUserLogin
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_NXT_HistoryUserLogin_Acce] ON [dbo].[NXT_HistoryUserLogin] ([Access_code])

GO

-- --------------------------------------------------
-- INDEX dbo.NXT_UserLogin
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_NXT_UserLogin_Acce] ON [dbo].[NXT_UserLogin] ([Access_code], [Username])

GO

-- --------------------------------------------------
-- INDEX dbo.NXTCommunicationGroupMapping
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_NXTCommunicationGroupMapping_Clientid] ON [dbo].[NXTCommunicationGroupMapping] ([Clientid])

GO

-- --------------------------------------------------
-- INDEX dbo.NXTCommunicationGroupMapping
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_NXTCommunicationGroupMapping_Groupid] ON [dbo].[NXTCommunicationGroupMapping] ([Groupid], [isdelete])

GO

-- --------------------------------------------------
-- INDEX dbo.NXTCommunicationGroupMaster
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_NXTCommunicationGroupMaster_Active] ON [dbo].[NXTCommunicationGroupMaster] ([Sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.NXTCommunicationGroupMaster
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_NXTCommunicationGroupMaster_Groupid] ON [dbo].[NXTCommunicationGroupMaster] ([GroupId], [Sub_broker], [GroupName], [Type])

GO

-- --------------------------------------------------
-- INDEX dbo.NXTFamilyGroupMembers
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_NXTFamilyGroupMembers_groupid] ON [dbo].[NXTFamilyGroupMembers] ([GroupId], [sb_Broker], [ClientId])

GO

-- --------------------------------------------------
-- INDEX dbo.OffersCriteriaMaster_Loan
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_OffersCriteriaMaster_From1] ON [dbo].[OffersCriteriaMaster_Loan] ([OfferId], [CriteriaAmountFrom1], [CriteriaAmountTo1], [CriteriaAmountFrom2], [CriteriaAmountTo2], [CriteriaAmountFrom3], [CriteriaAmountTo3])

GO

-- --------------------------------------------------
-- INDEX dbo.OffersSubBrokerMapping
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_OffersSubBrokerMapping_SBCo] ON [dbo].[OffersSubBrokerMapping] ([SBCode], [OfferId])

GO

-- --------------------------------------------------
-- INDEX dbo.OTP_SDC_Beenxt	_TobeDrop
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_OTP_SDC_Beenxt] ON [dbo].[OTP_SDC_Beenxt	_TobeDrop] ([sb_broker], [Otp], [MobileNo])

GO

-- --------------------------------------------------
-- INDEX dbo.OTP_SDC_Beenxt	_TobeDrop
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_OTP_SDC_Beenxt_Id] ON [dbo].[OTP_SDC_Beenxt	_TobeDrop] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.PassivToActiveNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_PassivToActiveNXT_Part] ON [dbo].[PassivToActiveNXT] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.Penal_Reversed
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Penal_Reversed_TOTAL] ON [dbo].[Penal_Reversed] ([RevDate], [TOTAL]) INCLUDE ([Sub_Broker], [Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.PledgeStatus_All
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_PledgeStatus_All] ON [dbo].[PledgeStatus_All] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.PledgeStatus_All_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_PledgeStatus_All_prev] ON [dbo].[PledgeStatus_All_Prev] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.QuestionAnswerModule
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_QuestionAnswerModule_Id] ON [dbo].[QuestionAnswerModule] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.QuestionAnswerOptions
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_QuestionAnswerOptions_Id] ON [dbo].[QuestionAnswerOptions] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.Questions_TobeDrop
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Questions_Id] ON [dbo].[Questions_TobeDrop] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.Rajasthan_SDAmt
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Rajasthan_SDAmt_party_code] ON [dbo].[Rajasthan_SDAmt] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.Rajasthan_SDAmt_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Rajasthan_SDAmt_party_code] ON [dbo].[Rajasthan_SDAmt_Prev] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.RiskdashboardActionsNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_RiskdashboardActionsNXT] ON [dbo].[RiskdashboardActionsNXT] ([Subbroker], [ClientCode], [Flag])

GO

-- --------------------------------------------------
-- INDEX dbo.RiskdashboardActionsNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_RiskdashboardActionsNXT_Clie] ON [dbo].[RiskdashboardActionsNXT] ([ClientCode])

GO

-- --------------------------------------------------
-- INDEX dbo.rms_holding_RMSHolding
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_rms_holding_PartyCode] ON [dbo].[rms_holding_RMSHolding] ([RMSHolding])

GO

-- --------------------------------------------------
-- INDEX dbo.rms_holding_RMSHolding
-- --------------------------------------------------
CREATE CLUSTERED INDEX [NC_Total] ON [dbo].[rms_holding_RMSHolding] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_OrgType] ON [dbo].[SB_Broker_Prev] ([OrgType], [SBTAG])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_RegStatus] ON [dbo].[SB_Broker_Prev] ([RegStatus]) INCLUDE ([RefNo], [SBTAG], [Branch], [TradeName], [OrgType], [ContactPerson])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_Branch] ON [dbo].[SB_Broker_Prev] ([Branch]) INCLUDE ([SBTAG], [TradeName], [TAGGeneratedDate])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_Branch_PanNo] ON [dbo].[SB_Broker_Prev] ([Branch], [PanNo])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_Branch1] ON [dbo].[SB_Broker_Prev] ([Branch]) INCLUDE ([RefNo], [SBTAG], [IsActive])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_Branch5] ON [dbo].[SB_Broker_Prev] ([Branch]) INCLUDE ([RefNo], [SBTAG], [TradeName], [PanNo], [TAGGeneratedDate])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_OldBranchShiftingTag] ON [dbo].[SB_Broker_Prev] ([OldBranchShiftingTag]) INCLUDE ([SBTAG])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_OldBranchShiftingTag1] ON [dbo].[SB_Broker_Prev] ([OldBranchShiftingTag]) INCLUDE ([FamilyReason])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_PanNo] ON [dbo].[SB_Broker_Prev] ([PanNo])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_ParentTag_RefNo_SBTAG] ON [dbo].[SB_Broker_Prev] ([ParentTag], [RefNo], [SBTAG]) INCLUDE ([Branch])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_SBTAG] ON [dbo].[SB_Broker_Prev] ([SBTAG]) INCLUDE ([RefNo], [PanNo], [CheckerPan], [AppStatus])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_SBTAG1] ON [dbo].[SB_Broker_Prev] ([SBTAG]) INCLUDE ([RefNo], [PanNo], [MakerPan], [CheckerPan], [AppStatus])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Broker_Prev_SBTAG2] ON [dbo].[SB_Broker_Prev] ([SBTAG]) INCLUDE ([RefNo], [PanNo], [CheckerPan], [AppStatus], [IsActive])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SBTAG] ON [dbo].[SB_Broker_Prev] ([SBTAG], [OrgType])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ncidx_sbtag_branch] ON [dbo].[SB_Broker_Prev] ([SBTAG], [Branch])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_mf_Last_Date] ON [dbo].[sb_client_details] ([sub_broker]) INCLUDE ([mf_last_date])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_mobile_pager] ON [dbo].[sb_client_details] ([mobile_pager]) INCLUDE ([sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_sb_client_details] ON [dbo].[sb_client_details] ([B2C], [last_inactive_date]) INCLUDE ([party_code], [sub_broker], [comb_last_date])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_SB_Client_Details_MFAUM] ON [dbo].[sb_client_details] ([sub_broker], [B2C], [mf_Active_Date]) INCLUDE ([MF_AUM])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_sb_ClientDetails] ON [dbo].[sb_client_details] ([sub_broker], [B2C], [last_inactive_date], [FO_LAST_DATE]) INCLUDE ([bsefo_last_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_sb_ClientDetailscomb] ON [dbo].[sb_client_details] ([sub_broker], [B2C], [last_inactive_date]) INCLUDE ([comb_last_date])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_MISSING_sb_client_details_sub_broker_party_code] ON [dbo].[sb_client_details] ([sub_broker]) INCLUDE ([party_code], [email], [long_name], [mobile_pager], [pan_gir_no], [Sex])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_CLIENT_DETAILS_B2C_FIRST_ACTIVE_DATE] ON [dbo].[sb_client_details] ([B2C], [first_active_date]) INCLUDE ([sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_sb_client_details_first_active_date] ON [dbo].[sb_client_details] ([first_active_date]) INCLUDE ([sub_broker], [InitialMargin])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_sb_client_details_MF] ON [dbo].[sb_client_details] ([sub_broker], [MF], [first_active_date]) INCLUDE ([B2C])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_sb_client_details_mf_last_date] ON [dbo].[sb_client_details] ([mf_last_date], [mf_Active_Date], [party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_SB_CLIENT_DETAILS_SUB_BROKER_B2C] ON [dbo].[sb_client_details] ([sub_broker], [B2C]) INCLUDE ([party_code], [long_name])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_SB_CLIENT_DETAILS_SUB_BROKER_B2C_FIRST_ACTIVE_DATE] ON [dbo].[sb_client_details] ([sub_broker], [B2C], [first_active_date])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [sb_client_details_B2C_party_code] ON [dbo].[sb_client_details] ([sub_broker], [B2C], [party_code]) INCLUDE ([long_name], [first_active_date], [last_inactive_date], [comb_last_date], [EQ_AUM], [MF_AUM], [ARQClient], [BSECM], [NSECM], [NSEFutures], [NSECurrency], [BSECurrency], [MCXCurrency], [MCX], [NCX], [MF])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_client_details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [sb_client_details_cl_code] ON [dbo].[sb_client_details] ([cl_code]) INCLUDE ([long_name])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_AddType] ON [dbo].[SB_Contact_Prev] ([AddType]) INCLUDE ([RefNo], [TelNo])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_refno_addtype] ON [dbo].[SB_Contact_Prev] ([RefNo], [AddType])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Contact_Prev_AddType] ON [dbo].[SB_Contact_Prev] ([AddType]) INCLUDE ([RefNo], [MobNo])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Contact_Prev_AddType1] ON [dbo].[SB_Contact_Prev] ([AddType]) INCLUDE ([RefNo], [MobNo], [EmailId])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Contact_Prev_AddType2] ON [dbo].[SB_Contact_Prev] ([AddType]) INCLUDE ([RefNo], [City], [State], [PinCode], [MobNo], [EmailId])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Contact_Prev_EmailId_AddType] ON [dbo].[SB_Contact_Prev] ([EmailId], [AddType])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SB_Contact_Prev_MobNo_AddType] ON [dbo].[SB_Contact_Prev] ([MobNo], [AddType])

GO

-- --------------------------------------------------
-- INDEX dbo.sb_Declaration
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_sb_Declaration] ON [dbo].[sb_Declaration] ([SBTag], [FnYear])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_NOCaccess
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_SB_NOCaccess_username] ON [dbo].[SB_NOCaccess] ([username])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [EXCHANGE] ON [dbo].[securityholdingdata_rpt] ([exchange]) INCLUDE ([party_code], [total])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idxsecurity_party_code] ON [dbo].[securityholdingdata_rpt] ([scrip_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idxsecurity_scripcd] ON [dbo].[securityholdingdata_rpt] ([scrip_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_missing_securityholdingdata_rpt_party_code] ON [dbo].[securityholdingdata_rpt] ([party_code]) INCLUDE ([exchange], [qty], [holding], [scrip_cd], [total], [category], [symbol], [isin])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [EXCHANGE] ON [dbo].[securityholdingdata_rpt_Prev] ([exchange]) INCLUDE ([party_code], [total])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idxsecurity_party_code] ON [dbo].[securityholdingdata_rpt_Prev] ([scrip_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idxsecurity_scripcd] ON [dbo].[securityholdingdata_rpt_Prev] ([scrip_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.securityholdingdata_rpt_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_missing_securityholdingdata_rpt_party_code] ON [dbo].[securityholdingdata_rpt_Prev] ([party_code]) INCLUDE ([exchange], [qty], [holding], [scrip_cd], [total], [category], [symbol], [isin])

GO

-- --------------------------------------------------
-- INDEX dbo.SubBrokerQuestion
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_SubBrokerQuestion_Id] ON [dbo].[SubBrokerQuestion] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Category_Wise_Average_Bussiness_Consulting
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_Category_Wise_Average_Bussiness_Consulting_ClientAge] ON [dbo].[tbl_Category_Wise_Average_Bussiness_Consulting] ([AvgPayout], [ClientAge])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Category_Wise_Average_Bussiness_Consulting
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_Category_Wise_Average_Bussiness_Consulting_party_code] ON [dbo].[tbl_Category_Wise_Average_Bussiness_Consulting] ([SUB_Broker], [Category])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Category_Wise_Average_Bussiness_Consulting
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_Category_Wise_Average_Bussiness_Consulting_SUB_Broker] ON [dbo].[tbl_Category_Wise_Average_Bussiness_Consulting] ([SUB_Broker])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_Client_Master
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ClientMaster] ON [dbo].[Tbl_Client_Master] ([CLIENT_CODE], [FIRST_HOLD_NAME], [NISE_PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_Client_Master
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_ClientMaster_NISE_PARTY_CODE] ON [dbo].[Tbl_Client_Master] ([NISE_PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientBrokerageDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_tbl_ClientBrokerageDetails_Party_Code] ON [dbo].[tbl_ClientBrokerageDetails] ([Party_Code]) INCLUDE ([Sauda_Date], [GrossBrokerage])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientBrokerageDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_ClientBrokerageDetails_Netto_SB] ON [dbo].[tbl_ClientBrokerageDetails] ([NettoSB])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientBrokerageDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_ClientBrokerageDetails_NettoSB] ON [dbo].[tbl_ClientBrokerageDetails] ([Party_Code], [NettoSB])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientBrokerageDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NC_SaudaDate] ON [dbo].[tbl_ClientBrokerageDetails] ([Sauda_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientBrokerageDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [PK_tbl_ClientBrokerageDetails_Party_Code] ON [dbo].[tbl_ClientBrokerageDetails] ([NettoSB], [Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientsTradingDetails
-- --------------------------------------------------
CREATE CLUSTERED INDEX [index_party_code] ON [dbo].[tbl_ClientsTradingDetails] ([Party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientsTradingDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [Inx_Sauda_Date] ON [dbo].[tbl_ClientsTradingDetails] ([Sauda_date])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientsTradingDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_tbl_ClientsTradingDetails] ON [dbo].[tbl_ClientsTradingDetails] ([Party_code], [Sauda_date])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientsTradingDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [INX_tbl_ClientsTradingDetails_ExchangeSegment] ON [dbo].[tbl_ClientsTradingDetails] ([sub_broker], [Sauda_date]) INCLUDE ([Party_code], [ExchangeSegment], [NettoSB])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_ClientsTradingDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_ClientsTradingDetails_Sauda_date] ON [dbo].[tbl_ClientsTradingDetails] ([Sauda_date]) INCLUDE ([Party_code], [GrossBrokerage], [NettoSB], [NetBrok])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_COMBINE_REPORTING_DETAIL
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_TBL_COMBINE_REPORTING_DETAIL_party] ON [dbo].[TBL_COMBINE_REPORTING_DETAIL] ([party_code], [Margin])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_COMBINE_REPORTING_DETAIL_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_TBL_COMBINE_REPORTING_DETAIL_Prev_party] ON [dbo].[TBL_COMBINE_REPORTING_DETAIL_Prev] ([party_code], [Margin])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_ClientDetails
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_CLS_tbl_crms_dashboard_clientdetails] ON [dbo].[tbl_CRMS_Dashboard_ClientDetails] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_ClientDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_TBL_CRMS_DASHBOARD_CLIENTDETAILS_PARTY_CODE_SUB_BROKER] ON [dbo].[tbl_CRMS_Dashboard_ClientDetails] ([party_code], [sub_broker]) INCLUDE ([LedgerTotal])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_crms_dashboard_clientdetails_Prev
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_CLS_tbl_crms_dashboard_clientdetails] ON [dbo].[tbl_crms_dashboard_clientdetails_Prev] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_crms_dashboard_clientdetails_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_TBL_CRMS_DASHBOARD_CLIENTDETAILS_PARTY_CODE_SUB_BROKER] ON [dbo].[tbl_crms_dashboard_clientdetails_Prev] ([party_code], [sub_broker]) INCLUDE ([LedgerTotal])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_CallType] ON [dbo].[tbl_CRMS_Dashboard_PriorityClients_B2B] ([CallType])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_DateTime] ON [dbo].[tbl_CRMS_Dashboard_PriorityClients_B2B] ([DateTime])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_emp_no] ON [dbo].[tbl_CRMS_Dashboard_PriorityClients_B2B] ([emp_no])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IDX_IsProcessed] ON [dbo].[tbl_CRMS_Dashboard_PriorityClients_B2B] ([IsProcessed])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_CRMS_Dashboard_PriorityClients_B2B_emp_no] ON [dbo].[tbl_CRMS_Dashboard_PriorityClients_B2B] ([emp_no], [CallType], [IsProcessed], [DateTime]) INCLUDE ([party_code], [party_name], [CallSubType], [CallValue])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_MF_ARQ_Recommendations
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_TBL_CRMS_MF_ARQ_RECOMMENDATIONS_PCODE_SBRECOMMENDATIONSENDON] ON [dbo].[tbl_CRMS_MF_ARQ_Recommendations] ([Party_code], [Sub_Broker], [RecommendationSendOn])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_CRMS_MF_ARQ_Recommendations
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCI_TBL_CRMS_MF_ARQ_RECOMMENDATIONS_SUB_BROKER] ON [dbo].[tbl_CRMS_MF_ARQ_Recommendations] ([Sub_Broker]) INCLUDE ([Party_code], [Header], [SchemeName], [RecommendationSendOn])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Dormant_Client
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_tbl_Dormant_Client_party_code] ON [dbo].[tbl_Dormant_Client] ([party_code]) INCLUDE ([Proposed])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Emp_Master
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_Emp_Master_sb_tag] ON [dbo].[tbl_Emp_Master] ([Sb_Tag])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Emp_Master
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ__tbl_Emp___262390D6D91692C6] ON [dbo].[tbl_Emp_Master] ([Emp_No])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Emp_Master_Prev
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ__tbl_Emp___262390D6093A3763] ON [dbo].[tbl_Emp_Master_Prev] ([Emp_No])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_FourDigitPIN_NXT2_Mobile
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UC_SBtag] ON [dbo].[Tbl_FourDigitPIN_NXT2_Mobile] ([SBTag])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Get_DailyActivation_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_Get_DailyActivation_Details_AR_Client_Age_Year] ON [dbo].[tbl_Get_DailyActivation_Details] ([AR], [Client_Age_Year])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Get_DailyActivation_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_Get_DailyActivation_Details_Sub_Broker] ON [dbo].[tbl_Get_DailyActivation_Details] ([Sub_Broker], [AR], [Client_Age_Year])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_mobLoginDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_mobLoginDetails_UserId] ON [dbo].[tbl_mobLoginDetails] ([UserId]) INCLUDE ([LastLogin])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_mobLoginDetails_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_mobLoginDetails_Prev_UserId] ON [dbo].[tbl_mobLoginDetails_Prev] ([UserId]) INCLUDE ([LastLogin])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_mtf_status
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NC_MTF_Status] ON [dbo].[tbl_mtf_status] ([MTF_Status])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_mtf_status
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [tbl_mtf_status_Party_Code] ON [dbo].[tbl_mtf_status] ([Party_Code]) INCLUDE ([MTF_Status])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_NewPOA
-- --------------------------------------------------
CREATE CLUSTERED INDEX [PK_Tbl_NewPOA] ON [dbo].[Tbl_NewPOA] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NotificationBEENXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_NotificationBEENXT] ON [dbo].[tbl_NotificationBEENXT] ([NotificationID])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NotificationBEENXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_NotificationBEENXT_NotificationText] ON [dbo].[tbl_NotificationBEENXT] ([sub_broker], [NotificationText])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NotificationNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_NotificationNXT_CreatedDate] ON [dbo].[tbl_NotificationNXT] ([CreatedDate]) INCLUDE ([NotificationText], [NotificationType], [CampaignId])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NotificationNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_NotificationNXT_Sub_broker] ON [dbo].[tbl_NotificationNXT] ([sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NotificationNXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_NotificationNXT_Sub_broker1] ON [dbo].[tbl_NotificationNXT] ([sub_broker], [CreatedDate])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_Pledge_Mapping_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Tbl_Pledge_Mapping] ON [dbo].[Tbl_Pledge_Mapping_Prev] ([Party_code], [Communique_date], [Pldg_Req_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_Pledge_Mapping_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Tbl_Pledge_Mapping_Prev] ON [dbo].[Tbl_Pledge_Mapping_Prev] ([Party_code], [Communique_date], [Pldg_Req_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_pledgeOTPGeneration
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_pledgeOTPGeneration_SBTAG] ON [dbo].[tbl_pledgeOTPGeneration] ([party_code], [otp])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_POA_PLD_ADNL_Pledge_Mtf
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_TBL_POA_PLD_ADNL_Pledge_Mtf] ON [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf] ([PARTY_CODE], [Start_date])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_TBL_POA_PLD_ADNL_Pledge_Mtf_Prev] ON [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Prev] ([PARTY_CODE], [Start_date])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_PopupAdmin
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Tbl_PopupAdmin] ON [dbo].[Tbl_PopupAdmin] ([Project_Type], [Active], [StartDate], [ExpiryDate], [Popup_Type], [Index])

GO

-- --------------------------------------------------
-- INDEX dbo.Tbl_PopupSbTagMap
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Tbl_PopupSbTagMap] ON [dbo].[Tbl_PopupSbTagMap] ([PopupId], [SbTag], [Active])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_RMS_COLLECTION_CLI
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_TBL_RMS_COLLECTION_CLI_EXP_GROSS] ON [dbo].[TBL_RMS_COLLECTION_CLI] ([Net_Debit], [Exp_Gross])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_RMS_COLLECTION_CLI
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_TBL_RMS_COLLECTION_CLI_Party] ON [dbo].[TBL_RMS_COLLECTION_CLI] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_rms_collection_cli_NXT
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_rms_collection_cli_NXT] ON [dbo].[tbl_rms_collection_cli_NXT] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_rms_collection_cli_NXT_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tbl_rms_collection_cli_NXT_Prev] ON [dbo].[tbl_rms_collection_cli_NXT_Prev] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_RMS_COLLECTION_CLI_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_TBL_RMS_COLLECTION_CLI_Prev_EXP_GROSS] ON [dbo].[TBL_RMS_COLLECTION_CLI_Prev] ([Net_Debit], [Exp_Gross])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_RMS_COLLECTION_CLI_Prev
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_TBL_RMS_COLLECTION_CLI_Prev_Party] ON [dbo].[TBL_RMS_COLLECTION_CLI_Prev] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SB_MarginRestore
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_SB_MarginRestore_sb] ON [dbo].[tbl_SB_MarginRestore] ([sb])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SB_MonthlyRevenue
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_GrossRevenue] ON [dbo].[tbl_SB_MonthlyRevenue] ([sub_broker], [Trade_Month]) INCLUDE ([Total_Clients], [Gross_Revenue])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SB_MonthlyRevenue
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_tbl_SB_MonthlyRevenue_SB] ON [dbo].[tbl_SB_MonthlyRevenue] ([sub_broker], [Trade_Month])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SB_MonthlyRevenue
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_tbl_SB_MonthlyRevenue_TradeMonth] ON [dbo].[tbl_SB_MonthlyRevenue] ([Trade_Month], [TradedDays])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SB_MyClient_GetClientDetails
-- --------------------------------------------------
CREATE CLUSTERED INDEX [inx_SB_MyClient_sub_broker_updateDate] ON [dbo].[tbl_SB_MyClient_GetClientDetails] ([sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SB_MyClient_GetClientDetails_Dealer
-- --------------------------------------------------
CREATE CLUSTERED INDEX [inx_SB_MyClient_sub_broker_updateDate] ON [dbo].[tbl_SB_MyClient_GetClientDetails_Dealer] ([sub_broker])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SBAccess
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_SBAccess] ON [dbo].[tbl_SBAccess] ([SBTAG])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SBLastTradeDate
-- --------------------------------------------------
CREATE CLUSTERED INDEX [CI_TBL_SBLASTTRADEDATE_SUB_BROKER] ON [dbo].[tbl_SBLastTradeDate] ([Sub_Broker])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_SBLastTradeDate
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [inx_tbl_SBLastTade_Sauda_Date] ON [dbo].[tbl_SBLastTradeDate] ([Sauda_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.TBL_SMSQUEUE_Log
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_TBL_SMSQUEUE_Log_Active] ON [dbo].[TBL_SMSQUEUE_Log] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.tblArnEuinMaster
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tblArnEuinMaster_SB] ON [dbo].[tblArnEuinMaster] ([SB Equity Tag])

GO

-- --------------------------------------------------
-- INDEX dbo.tblArnEuinMaster_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tblArnEuinMaster_Prev_SB] ON [dbo].[tblArnEuinMaster_Prev] ([SB Equity Tag])

GO

-- --------------------------------------------------
-- INDEX dbo.tblSipSchemeMaster
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_tblSipSchemeMaster] ON [dbo].[tblSipSchemeMaster] ([AMCCode], [AMCName], [SchemeCode])

GO

-- --------------------------------------------------
-- INDEX dbo.TrainingLinks
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ_TrainingLinks_Id] ON [dbo].[TrainingLinks] ([Id])

GO

-- --------------------------------------------------
-- INDEX dbo.UntilityView_Notification
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_UntilityView_Notification_id] ON [dbo].[UntilityView_Notification] ([RN], [CreatedDate])

GO

-- --------------------------------------------------
-- INDEX dbo.user_type_mapper
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_user_type_mapper_angelId] ON [dbo].[user_type_mapper] ([angelId])

GO

-- --------------------------------------------------
-- INDEX dbo.user_type_mapper
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_user_type_mapper_tempId] ON [dbo].[user_type_mapper] ([tempId]) INCLUDE ([userType], [NBFCStatus])

GO

-- --------------------------------------------------
-- INDEX dbo.user_type_mapper
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_user_type_mapper_userType] ON [dbo].[user_type_mapper] ([userType])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_AngelPlatinum_ClientInfo
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_vw_AngelPlatinum_ClientInfo] ON [dbo].[vw_AngelPlatinum_ClientInfo] ([ClientCode])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_AngelPlatinum_ClientInfo
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_vw_AngelPlatinum_ClientInfo_ClientCodeI1] ON [dbo].[vw_AngelPlatinum_ClientInfo] ([ClientCode], [IsPaymentReceived], [IsRiskProfilingDone], [IsConfirmationGiven], [RiskProfilingDoneDate], [ConfirmationGivenDate], [IsAgreementGiven], [RequestCallback], [RequestCallback_Date], [AgreementGivenDate])

GO

-- --------------------------------------------------
-- INDEX dbo.VW_Client_DPBal
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Client] ON [dbo].[VW_Client_DPBal] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.VW_Client_DPBal_Prev
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Client] ON [dbo].[VW_Client_DPBal_Prev] ([PARTY_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_CollectionDetails_CLIENT_Net
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Vw_CollectionDetails_CLIENT_Net1] ON [dbo].[Vw_CollectionDetails_CLIENT_Net] ([Net])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_CollectionDetails_CLIENT_Net
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Vw_CollectionDetails_CLIENT1] ON [dbo].[Vw_CollectionDetails_CLIENT_Net] ([Client])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_Dashboard_sbrisk
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_MISSING_vw_Dashboard_sbrisk] ON [dbo].[vw_Dashboard_sbrisk] ([square_off_type])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_Dashboard_sbrisk
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk] ON [dbo].[vw_Dashboard_sbrisk] ([SUB_BROKER], [Net_collection])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_Dashboard_sbrisk
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk_SUB_BROKER_Net_collection] ON [dbo].[vw_Dashboard_sbrisk] ([SUB_BROKER], [Net_collection]) INCLUDE ([party_code], [long_name], [Reason], [Pure_Risk], [shortage_value], [squareoffvalue], [square_off_type], [square_off_date])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_Dashboard_sbrisk_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_MISSING_vw_Dashboard_sbrisk_Prev] ON [dbo].[vw_Dashboard_sbrisk_Prev] ([square_off_type])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_Dashboard_sbrisk_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk_Prev] ON [dbo].[vw_Dashboard_sbrisk_Prev] ([SUB_BROKER], [Net_collection])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_Dashboard_sbrisk_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk_Prev_SUB_BROKER_Net_collection] ON [dbo].[vw_Dashboard_sbrisk_Prev] ([SUB_BROKER], [Net_collection]) INCLUDE ([party_code], [long_name], [Reason], [Pure_Risk], [shortage_value], [squareoffvalue], [square_off_type], [square_off_date])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_MutualFundPendingOrder_NCMS
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_vw_MutualFundPendingOrder_NCMS] ON [dbo].[vw_MutualFundPendingOrder_NCMS] ([clientcode])

GO

-- --------------------------------------------------
-- INDEX dbo.vw_MutualFundPendingOrder_NCMS
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vw_MutualFundPendingOrder_NCMS_Debit] ON [dbo].[vw_MutualFundPendingOrder_NCMS] ([Segment], [Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_RMS_Client_Vertical
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Vw_RMS_Client_Vertical_Client] ON [dbo].[Vw_RMS_Client_Vertical] ([Client])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_RMS_Client_Vertical
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Vw_RMS_Client_Vertical_sb] ON [dbo].[Vw_RMS_Client_Vertical] ([SB])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_VBB_SCHEME_NAME
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Vw_VBB_SCHEME_NAME] ON [dbo].[Vw_VBB_SCHEME_NAME] ([sub_broker], [cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_VBB_SCHEME_NAME
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Vw_VBB_SCHEME_NAME_sub_broker] ON [dbo].[Vw_VBB_SCHEME_NAME] ([sub_broker]) INCLUDE ([cl_code], [SP_CreatedOn], [SCHEME_NAME])

GO

-- --------------------------------------------------
-- INDEX dbo.Vw_VBB_SCHEME_NAME_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Vw_VBB_SCHEME_NAME_Prev] ON [dbo].[Vw_VBB_SCHEME_NAME_Prev] ([sub_broker], [cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.vwEquitySIP
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vwEquitySIP_UserId] ON [dbo].[vwEquitySIP] ([UserId])

GO

-- --------------------------------------------------
-- INDEX dbo.vwEquitySIP_Prev
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_vwEquitySIP_Prev_UserId] ON [dbo].[vwEquitySIP_Prev] ([UserId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.AdvisoryDeleteLog_NXT
-- --------------------------------------------------
ALTER TABLE [dbo].[AdvisoryDeleteLog_NXT] ADD CONSTRAINT [PK__Advisory__3214EC077D7CED03] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.AdvisoryPerformanceReportData
-- --------------------------------------------------
ALTER TABLE [dbo].[AdvisoryPerformanceReportData] ADD CONSTRAINT [PK__Advisory__3214EC07827C0F57] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.AdvisoryPerformanceReportDataDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[AdvisoryPerformanceReportDataDetails] ADD CONSTRAINT [PK__Advisory__3214EC07D510497D] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.AnswerOptions
-- --------------------------------------------------
ALTER TABLE [dbo].[AnswerOptions] ADD CONSTRAINT [PK_AnswerOptions_TypeValue] PRIMARY KEY ([Type], [Value])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.AnswerOptions
-- --------------------------------------------------
ALTER TABLE [dbo].[AnswerOptions] ADD CONSTRAINT [UQ_AnswerOptions_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.BankHolidays
-- --------------------------------------------------
ALTER TABLE [dbo].[BankHolidays] ADD CONSTRAINT [PK__BankHoli__4A5C1AF31AF2A042] PRIMARY KEY ([BankHolidayId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.BulkIPO_ClientGroup
-- --------------------------------------------------
ALTER TABLE [dbo].[BulkIPO_ClientGroup] ADD CONSTRAINT [PK_BulkIPO_ClientGroup] PRIMARY KEY ([SBTag], [Name])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.BulkIPO_ClientGroup
-- --------------------------------------------------
ALTER TABLE [dbo].[BulkIPO_ClientGroup] ADD CONSTRAINT [UQ_BulkIPO_ClientGroup] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.BulkIPO_ClientGroup_Clients
-- --------------------------------------------------
ALTER TABLE [dbo].[BulkIPO_ClientGroup_Clients] ADD CONSTRAINT [PK_BulkIPO_ClientGroup_Clients] PRIMARY KEY ([PartyCode])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.CommonRejectionTradingPlatform_Logs
-- --------------------------------------------------
ALTER TABLE [dbo].[CommonRejectionTradingPlatform_Logs] ADD CONSTRAINT [PK_CommonRejectionTradingPlatform_Logs] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DDLCat
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat] ADD CONSTRAINT [PK_DDLCat_Name] PRIMARY KEY ([Value])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DDLCat
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat] ADD CONSTRAINT [UQ_DDLCat_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DDLCat_PaymentMode
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat_PaymentMode] ADD CONSTRAINT [PK_DDLCat_PaymentMode_CatId_Value] PRIMARY KEY ([CatId], [PayModeId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DDLCat_PaymentMode
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat_PaymentMode] ADD CONSTRAINT [UQ_DDLCat_PaymentMode_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DDLCat_PaymentModeLog
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCat_PaymentModeLog] ADD CONSTRAINT [PK_DDLCat_PaymentModeLog_Id] PRIMARY KEY ([Id], [CatPayModeId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DDLCatLog
-- --------------------------------------------------
ALTER TABLE [dbo].[DDLCatLog] ADD CONSTRAINT [PK_DDLCatLog_Id] PRIMARY KEY ([Id], [CatId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Dealer_Users
-- --------------------------------------------------
ALTER TABLE [dbo].[Dealer_Users] ADD CONSTRAINT [PK__Dealer_U__3214EC27CC7A7A31] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DocumentUpload
-- --------------------------------------------------
ALTER TABLE [dbo].[DocumentUpload] ADD CONSTRAINT [PK_DocumentUpload_Id] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DocumentUploadMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[DocumentUploadMaster] ADD CONSTRAINT [PK_DocumentUploadMaster_Id] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.DocumentUploadYoutube
-- --------------------------------------------------
ALTER TABLE [dbo].[DocumentUploadYoutube] ADD CONSTRAINT [PK_DocumentUploadYoutube_Id] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.EmandateSMSLinkLog
-- --------------------------------------------------
ALTER TABLE [dbo].[EmandateSMSLinkLog] ADD CONSTRAINT [PK__Emandate__3214EC07010FFF29] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.feed_mfisin_all
-- --------------------------------------------------
ALTER TABLE [dbo].[feed_mfisin_all] ADD CONSTRAINT [pk_feed_mfisin_all_mf_schcode_ISIN] PRIMARY KEY ([mf_schcode], [ISIN])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.FundBarometerFileData
-- --------------------------------------------------
ALTER TABLE [dbo].[FundBarometerFileData] ADD CONSTRAINT [PK__FundBaro__3214EC07C7C96306] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.IPartner_ClientImages
-- --------------------------------------------------
ALTER TABLE [dbo].[IPartner_ClientImages] ADD CONSTRAINT [PK__IPartner__3214EC27FF8D4198] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.IPartner_ScripTicker
-- --------------------------------------------------
ALTER TABLE [dbo].[IPartner_ScripTicker] ADD CONSTRAINT [PK__IPartner__3214EC273867D7A6] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.IPartner_ScripTicker
-- --------------------------------------------------
ALTER TABLE [dbo].[IPartner_ScripTicker] ADD CONSTRAINT [UK_IPartner_ScripTicker_CoCode_SubBroker] UNIQUE ([CoCode], [SubBroker])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.IPODocumentUpload
-- --------------------------------------------------
ALTER TABLE [dbo].[IPODocumentUpload] ADD CONSTRAINT [PK_IPODocumentUpload_Id] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Masters
-- --------------------------------------------------
ALTER TABLE [dbo].[Masters] ADD CONSTRAINT [PK__Masters__CBD0B1B50AA95F89] PRIMARY KEY ([IPOName])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.MF_DB_Logs
-- --------------------------------------------------
ALTER TABLE [dbo].[MF_DB_Logs] ADD CONSTRAINT [PK__MF_DB_Lo__3214EC273C8B211A] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.MFNonPOARedemptionInfo
-- --------------------------------------------------
ALTER TABLE [dbo].[MFNonPOARedemptionInfo] ADD CONSTRAINT [PK__MFNonPOA__3214EC0787685300] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.NotificationDeleteLog_NXT
-- --------------------------------------------------
ALTER TABLE [dbo].[NotificationDeleteLog_NXT] ADD CONSTRAINT [PK__Notifica__3214EC078CAB5CF4] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.NudgeFileData
-- --------------------------------------------------
ALTER TABLE [dbo].[NudgeFileData] ADD CONSTRAINT [PK__NudgeFil__3214EC07334A2A1B] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.NXTMobilePopUpLog
-- --------------------------------------------------
ALTER TABLE [dbo].[NXTMobilePopUpLog] ADD CONSTRAINT [PK__NXTMobil__3214EC07036123A4] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersCriteriaMaster_Loan
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersCriteriaMaster_Loan] ADD CONSTRAINT [PK__OffersCr__FE6ADBCD2151F639] PRIMARY KEY ([CriteriaId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersMaster] ADD CONSTRAINT [PK__OffersMa__8EBCF0915496553F] PRIMARY KEY ([OfferId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersMaster_Mobile_2
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersMaster_Mobile_2] ADD CONSTRAINT [PK__OffersMa__8EBCF091AC5730AE] PRIMARY KEY ([OfferId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersSubBrokerMapping
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersSubBrokerMapping] ADD CONSTRAINT [PK__OffersSu__3214EC072110E9F6] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersSubBrokerMapping_Mobile_2
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersSubBrokerMapping_Mobile_2] ADD CONSTRAINT [PK__OffersSu__3214EC0739E35B1A] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersSubBrokerRewards
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersSubBrokerRewards] ADD CONSTRAINT [PK__OffersSu__3214EC071C964F8E] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersSubBrokerRewards_Mobile_2
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersSubBrokerRewards_Mobile_2] ADD CONSTRAINT [PK__OffersSu__3214EC077B508223] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersSubBrokerRewardsLogs
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersSubBrokerRewardsLogs] ADD CONSTRAINT [PK__OffersSu__3214EC07FA90FBC2] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OffersSubBrokerRewardsLogs_Mobile_2
-- --------------------------------------------------
ALTER TABLE [dbo].[OffersSubBrokerRewardsLogs_Mobile_2] ADD CONSTRAINT [PK__OffersSu__3214EC07BB77194C] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.PaymentMode
-- --------------------------------------------------
ALTER TABLE [dbo].[PaymentMode] ADD CONSTRAINT [PK_PaymentMode_Id] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.PopupDeleteLog_NXT
-- --------------------------------------------------
ALTER TABLE [dbo].[PopupDeleteLog_NXT] ADD CONSTRAINT [PK__PopupDel__3214EC078E236C61] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.QuestionAnswerModule
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerModule] ADD CONSTRAINT [PK_QuestionAnswerModule_Name] PRIMARY KEY ([Name])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.QuestionAnswerModule
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerModule] ADD CONSTRAINT [UQ_QuestionAnswerModule_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.QuestionAnswerOptions
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerOptions] ADD CONSTRAINT [PK_QuestionAnswerOptions_QuestionIdAnswerOptionId] PRIMARY KEY ([QuestionId], [AnswerOptionId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.QuestionAnswerOptions
-- --------------------------------------------------
ALTER TABLE [dbo].[QuestionAnswerOptions] ADD CONSTRAINT [UQ_QuestionAnswerOptions_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Questions_TobeDrop
-- --------------------------------------------------
ALTER TABLE [dbo].[Questions_TobeDrop] ADD CONSTRAINT [PK_Questions_ModuleIdQuestion] PRIMARY KEY ([ModuleId], [Question])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Questions_TobeDrop
-- --------------------------------------------------
ALTER TABLE [dbo].[Questions_TobeDrop] ADD CONSTRAINT [UQ_Questions_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.RedemptionOrderDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[RedemptionOrderDetails] ADD CONSTRAINT [PK_RedemptionOrderDetails] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SB_Broker_Prev
-- --------------------------------------------------
ALTER TABLE [dbo].[SB_Broker_Prev] ADD CONSTRAINT [PK_RefNo1] PRIMARY KEY ([RefNo])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.sb_client_details
-- --------------------------------------------------
ALTER TABLE [dbo].[sb_client_details] ADD CONSTRAINT [PK__sb_clien__E4449B5FDC324E78] PRIMARY KEY ([party_code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SB_TeleBot_Reg
-- --------------------------------------------------
ALTER TABLE [dbo].[SB_TeleBot_Reg] ADD CONSTRAINT [PK_SB_TeleBot_Reg_SBTag] PRIMARY KEY ([SBTag])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SB_TrainingLinks
-- --------------------------------------------------
ALTER TABLE [dbo].[SB_TrainingLinks] ADD CONSTRAINT [PK_SB_TrainingLinks_SBName_SBTag] PRIMARY KEY ([SBTag], [TrainingLinkId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SegmentEmodifications
-- --------------------------------------------------
ALTER TABLE [dbo].[SegmentEmodifications] ADD CONSTRAINT [PK__SegmentE__3214EC07079F3299] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SmartMarketingLogs
-- --------------------------------------------------
ALTER TABLE [dbo].[SmartMarketingLogs] ADD CONSTRAINT [PK_SmartMarketingLogs] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SubBrokerQuestion
-- --------------------------------------------------
ALTER TABLE [dbo].[SubBrokerQuestion] ADD CONSTRAINT [PK_SubBrokerQuestion_SubBrokerTagModuleId] PRIMARY KEY ([SubBrokerTag], [ModuleId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SubBrokerQuestion
-- --------------------------------------------------
ALTER TABLE [dbo].[SubBrokerQuestion] ADD CONSTRAINT [UQ_SubBrokerQuestion_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.t1
-- --------------------------------------------------
ALTER TABLE [dbo].[t1] ADD CONSTRAINT [PK__t1__3BD0198E9493B348] PRIMARY KEY ([a])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TawkChatSBMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[TawkChatSBMaster] ADD CONSTRAINT [PK__TawkChat__3214EC07F55B6412] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_CityMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_CityMaster] ADD CONSTRAINT [PK_tbl_CityMaster] PRIMARY KEY ([CItyId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_CustomPlanBrokerageDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_CustomPlanBrokerageDetails] ADD CONSTRAINT [PK__tbl_Cust__3214EC07D2B69D1F] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_DigitalLibraryCreatives
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_DigitalLibraryCreatives] ADD CONSTRAINT [PK__tbl_Digi__45005BE78F52ACC0] PRIMARY KEY ([Creative_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_DigitalLibraryCreatives_Beenxt
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_DigitalLibraryCreatives_Beenxt] ADD CONSTRAINT [PK__tbl_Digi__45005BE7193FA683] PRIMARY KEY ([Creative_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_DigitalLibraryCreativesCustom
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_DigitalLibraryCreativesCustom] ADD CONSTRAINT [PK__tbl_Digi__33AB555228D8A5B9] PRIMARY KEY ([Requestid])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_DigitalLibraryCreativesCustom_Beenxt
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_DigitalLibraryCreativesCustom_Beenxt] ADD CONSTRAINT [PK__tbl_Digi__33AB5552F2CD35BE] PRIMARY KEY ([Requestid])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_DigitalLibrarySubbrokerMapping
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_DigitalLibrarySubbrokerMapping] ADD CONSTRAINT [PK__tbl_Digi__3213E83F8AC95341] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_DigitalLibrarySubbrokerMapping_Beenxt
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_DigitalLibrarySubbrokerMapping_Beenxt] ADD CONSTRAINT [PK__tbl_Digi__3213E83F024D29D8] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Dormant_Client_New
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Dormant_Client_New] ADD CONSTRAINT [PK__tbl_Dorm__E4449B5FBDCD3A9F] PRIMARY KEY ([party_code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Emp_Master
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Emp_Master] ADD CONSTRAINT [UQ__tbl_Emp___262390D6D91692C6] UNIQUE ([Emp_No])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Emp_Master_Prev
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Emp_Master_Prev] ADD CONSTRAINT [UQ__tbl_Emp___262390D6093A3763] UNIQUE ([Emp_No])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_FourDigitPIN_NXT2_Mobile
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_FourDigitPIN_NXT2_Mobile] ADD CONSTRAINT [PK_Tbl_FourDigitPIN_NXT2_Mobile] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_FourDigitPIN_NXT2_Mobile
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_FourDigitPIN_NXT2_Mobile] ADD CONSTRAINT [UC_SBtag] UNIQUE ([SBTag])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Material_Sub_TypeModel
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Material_Sub_TypeModel] ADD CONSTRAINT [PK__tbl_Mate__6CB36023BEA461F3] PRIMARY KEY ([MSId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_mobLoginDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_mobLoginDetails] ADD CONSTRAINT [PK__tbl_mobL__3214EC2740ECC135] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_mobLoginDetails_Prev
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_mobLoginDetails_Prev] ADD CONSTRAINT [PK__tbl_mobL__3214EC27157DEE7F] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_NXT_CustomPlan
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_NXT_CustomPlan] ADD CONSTRAINT [PK_tbl_NXT_CustomPlan] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_NXTMobilePopup
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_NXTMobilePopup] ADD CONSTRAINT [PK__Tbl_NXTM__3213E83FB6EB613E] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_SBReportPinnedMapping_NXT2_Mobile
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_SBReportPinnedMapping_NXT2_Mobile] ADD CONSTRAINT [PK__Tbl_SBRe__3214EC27094F0866] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_schemeMaster_NXT2_Mobile
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_schemeMaster_NXT2_Mobile] ADD CONSTRAINT [PK_Tbl_schemeMaster_NXT2_Mobile] PRIMARY KEY ([SchemeID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_TargetsandRewards_NXT2_Mobile
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_TargetsandRewards_NXT2_Mobile] ADD CONSTRAINT [PK_Tbl_TargetsandRewards_NXT2_Mobile] PRIMARY KEY ([TargetID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tblKycContest
-- --------------------------------------------------
ALTER TABLE [dbo].[tblKycContest] ADD CONSTRAINT [PK__tblKycCo__3214EC2767A075E1] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tblSipSchemeMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tblSipSchemeMaster] ADD CONSTRAINT [PK__tblSipSc__3214EC07DD77D495] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TrainingLinks
-- --------------------------------------------------
ALTER TABLE [dbo].[TrainingLinks] ADD CONSTRAINT [PK_TrainingLinks_Topic] PRIMARY KEY ([Topic])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TrainingLinks
-- --------------------------------------------------
ALTER TABLE [dbo].[TrainingLinks] ADD CONSTRAINT [UQ_TrainingLinks_Id] UNIQUE ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Utility_Users
-- --------------------------------------------------
ALTER TABLE [dbo].[Utility_Users] ADD CONSTRAINT [PK__Utility___3214EC27ABCCBED6] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DBA_ConvertQueryInHTML
-- --------------------------------------------------
Create PROC [dbo].[DBA_ConvertQueryInHTML] (@objectname1 VARCHAR(MAX),@HTMLBODY VARCHAR(MAX) OUTPUT) 
AS  

SET NOCOUNT ON 

BEGIN
	IF EXISTS(SELECT 1 FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID('DBA_TempHTML') AND TYPE = ('U'))
		DROP TABLE DBA_TempHTML

	DECLARE @CreateTable NVARCHAR(MAX) 
	SET @CreateTable ='SELECT * INTO DBA_TempHTML  FROM  ( '+''+ @objectname1+') A'  
	EXECUTE sp_executesql @CreateTable 

	DECLARE @XMLQuery2 NVARCHAR (MAX) 
	DECLARE @Name VARCHAR(MAX)

	DECLARE c1 CURSOR READ_ONLY 
	FOR  SELECT 'Column_Name' = name FROM SYS.ALL_COLUMNS 
	WHERE OBJECT_ID = ( SELECT OBJECT_ID FROM SYS.ALL_OBJECTS WHERE OBJECT_ID = OBJECT_ID('DBA_TempHTML'))

	OPEN c1
		DECLARE @TempVar NVARCHAR(MAX) = ''
		DECLARE @NewColumn NVARCHAR(MAX) = '' 

		FETCH NEXT FROM c1 INTO @Name 
			WHILE @@FETCH_STATUS = 0 
			BEGIN   
				SET @NewColumn =@NewColumn
											+'<th bgcolor="#8DA97A" style="font-family:TREBUCHET MS;color:WHITE;font-size:12px;align=center"><b>'
											+@Name +'</b></th>'
				SET @TempVar = @TempVar+ 'cast('+@Name +' as varchar(MAX) )'+'+' + '''</td><td>''' +'+'  
				FETCH NEXT FROM c1 INTO @Name 
			END 
	CLOSE c1 
	DEALLOCATE c1 
	  
	SET @TempVar=  LEFT (@TempVar, LEN(@TempVar)-13)  

	DECLARE @Body NVARCHAR(MAX)  

	SET @Body='SELECT CAST( (SELECT td = '+@TempVar
						+' FROM (  SELECT TOP 100 PERCENT * FROM DBA_TempHTML ) as d '+' for xml path( ''tr'' ), type ) as varchar(max) )'  

	CREATE TABLE #Data (RETURNSTR NVARCHAR (MAX))  
	INSERT INTO #Data  
	EXEC SP_EXECUTESQL  @Body  
	DECLARE @Returnstr2 NVARCHAR(MAX)  
	SELECT @Returnstr2 = LTRIM(RTRIM(RETURNSTR)) FROM #Data  

	SET @HTMLBody = '<table cellpadding="1" cellspacing="1" border="1" style="font-family:TREBUCHET MS;font-size:12px;">'  
		+ '<tr style="font-family:TREBUCHET MS;font-size:12px;align=center;">'+''+@NewColumn+ ''+'</tr>'
		+ REPLACE( REPLACE( @returnstr2, '&lt;', '<' ), '&gt;', '>'  )+ '</table>'  

	--SELECT @HTMLBODY
	DROP TABLE #Data  
	DROP TABLE DBA_TempHTML
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.delete_Rec_tbl_NotificationNXT
-- --------------------------------------------------

Create procedure delete_Rec_tbl_NotificationNXT
as
begin

delete from [dbo].[tbl_NotificationNXT]
where createdDate<Dateadd(MM,-3,getdate())


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetCategoryList
-- --------------------------------------------------


CREATE proc [dbo].[GetCategoryList]
as 
begin
select CategoryName from tbl_DigitalLibraryCategoryMaster
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetCityList
-- --------------------------------------------------

CREATE proc [dbo].[GetCityList]
as 
begin
	select Rcity from dbo.[vw_LMSSB_cityMaster] with (nolock)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetCityList_Bkp12Apr2022
-- --------------------------------------------------

CREATE proc [dbo].[GetCityList_Bkp12Apr2022]
as 
begin
	select Rcity from [196.1.115.207].CRM.dbo.[vw_LMSSB_cityMaster]
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetClientDetailsByPartyCode
-- --------------------------------------------------
CREATE PROC GetClientDetailsByPartyCode
@PartyCode NVARCHAR(50),
@SBTag NVARCHAR(50)

AS
BEGIN
	SELECT Party_Code as PartyCode, SUB_BROKER AS SBTag, MOBILE_NO AS MobileNo, EMAIL_ID AS EmailId, PARTY_NAME as ClientName
	FROM [AngelFO].BSEMFSS.dbo.MFSS_client With(Nolock)
	where Party_code = @PartyCode AND SUB_BROKER = @SBTag
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetCreativeNameList
-- --------------------------------------------------

Create proc [dbo].[GetCreativeNameList]
as 
begin
select CreativeName from tbl_DigitalLibraryCreatives
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetCreativeNameList_BeeNXT
-- --------------------------------------------------
CREATE proc [dbo].[GetCreativeNameList_BeeNXT]
as 
begin
select CreativeName from tbl_DigitalLibraryCreatives_Beenxt
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetNocInHouseSB
-- --------------------------------------------------

CREATE proc [dbo].[GetNocInHouseSB]
as
begin
select subbroker,EntryBy,EntryDate from NOC_InHouse_SB_Master
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetNocInHouseSBExceptionList
-- --------------------------------------------------

CREATE proc [dbo].[GetNocInHouseSBExceptionList]
as
begin
select subbroker from NOC_InHouse_SB_Master
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetRedirectionUrlDetails
-- --------------------------------------------------
 
CREATE PROCEDURE [dbo].[GetRedirectionUrlDetails]  
(  
 @Id int  
)  
AS
BEGIN  
 SELECT Id, Modulename, URL, QueryParameter, area, Controller, [action] FROM NotificationNXT_MasterList WHERE Id = @Id  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetRedirectionUrls
-- --------------------------------------------------

CREATE proc [dbo].[GetRedirectionUrls]    
AS     
BEGIN    
 SELECT Id, Modulename, URL, QueryParameter, area, Controller, [action], Active, CreationDate, CreatedBy 
 FROM NotificationNXT_MasterList   
 ORDER BY 1 desc    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetSBNOCAccess
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[GetSBNOCAccess]
as 
begin
	select id,username,entryDate,active --,EntryBy
	from SB_NOCaccess
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetStockSIPList
-- --------------------------------------------------
--95   NXT

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE  procedure [dbo].[GetStockSIPList]
(
@OffsetValue int,
@PagingSize int,
@ClientCode varchar(10)
)
as
Begin
select * from [196.1.115.227].[Angel_Admin].[dbo].[vwEquitySIP] where UserId = @ClientCode  order by EquitySIP_Header_ID
OFFSET @OffsetValue ROWS FETCH NEXT @PagingSize ROWS ONLY
Select count(EquitySIP_Header_ID) as TotalRecords from [196.1.115.227].[Angel_Admin].[dbo].[vwEquitySIP] where UserId = @ClientCode
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetStockSIPList_Bkp30July2021
-- --------------------------------------------------
Create procedure [dbo].[GetStockSIPList_Bkp30July2021]
(
@OffsetValue int,
@PagingSize int,
@ClientCode varchar(10)
)
as
Begin
select * from [172.31.16.75].[Angel_Admin].[dbo].[vwEquitySIP] where UserId = @ClientCode  order by EquitySIP_Header_ID
OFFSET @OffsetValue ROWS FETCH NEXT @PagingSize ROWS ONLY
Select count(EquitySIP_Header_ID) as TotalRecords from [172.31.16.75].[Angel_Admin].[dbo].[vwEquitySIP] where UserId = @ClientCode
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetUtilityMenus
-- --------------------------------------------------
CREATE proc [dbo].[GetUtilityMenus]  
as   
begin  
 select M.Id, M.Name, M.Controller, M.[Action], M.Active, MP.Name AS Parent, 
	CASE WHEN M.IsAccessRequired = 0 THEN 'No' ELSE 'Yes' END AS AccessRequired, 
	M.Createdby, M.CreatedDate, M.UpdatedBy, M.UpdatedDate   
 from Menu M
	left join Menu MP ON MP.Id = M.ParentId
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetVoucherEntryAccess
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[GetVoucherEntryAccess]
as 
begin
	select RecID,SBTAG,CreatedBy,CreatedOn,UpdatedBy,UpdatedDT
	from tbl_SBAccess
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.HolidaysDetect
-- --------------------------------------------------
create procedure HolidaysDetect 
as
begin 

declare @date1 date 
set @date1=(select cast(convert(varchar(20),getdate(),102) as date))
--select dateadd(day,1,@date1)

declare @cnt int 
set @cnt=(select count(*) from [BankHolidays] where HolidayDate=@date1)

declare @cnt1 int 
set @cnt1=(select count(*) from [BankHolidays] where HolidayDate=(select dateadd(day,1,@date1)))

if @cnt>0
begin
if @cnt>0
begin
select HolidayDate from [BankHolidays] where HolidayDate=@date1 or  HolidayDate=(select dateadd(day,1,@date1))
end
else 
begin
(select min(HolidayDate) as HolidayDate from [BankHolidays] where HolidayDate>@date1 )
end 
end 

else 
begin 
(select min(HolidayDate) as HolidayDate from [BankHolidays] where HolidayDate>=@date1 )
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Ins_NXTLogDB_tbl_NotificationNXT
-- --------------------------------------------------
Create procedure Ins_NXTLogDB_tbl_NotificationNXT
as
begin

insert into NXT_Logs.dbo.[tbl_NotificationNXT]
select * from [dbo].[tbl_NotificationNXT] with (nolock)
where createdDate>=convert(date,getdate())


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IPartner_Login_LoginUpdate
-- --------------------------------------------------

-- =============================================
-- Author:		Sharad Patil
-- Create date: 23-Mar-2018
-- Description:	To update login count base on AccessCode and UserName

-- EXEC IPartner_Login_LoginUpdate 'Admin','Admin'

-- =============================================

CREATE PROCEDURE [dbo].[IPartner_Login_LoginUpdate] 
	(
	 @AccessCode VARCHAR (30)
	,@Username VARCHAR (30)
		
	)

AS
SET NOCOUNT ON
BEGIN
	
	IF EXISTS (SELECT 1 FROM NXT_UserLogin WHERE Access_code = @AccessCode AND Username = @Username)
	
	BEGIN

	UPDATE NXT_UserLogin
	SET Login_count = Login_count + 1
	, Last_login  = GETDATE()
	WHERE Access_code = @AccessCode AND Username = @Username

	END

	ELSE

	BEGIN
	
	INSERT INTO NXT_UserLogin 
	(
	 Access_code
	,Username
	,Login_count
	,Last_login
	)

	VALUES (
	 @AccessCode
	,@Username
	,1
	,GETDATE()
	)


	END



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.isClientCodeRegisteredForITRADE
-- --------------------------------------------------






-- =============================================



-- Author:		<Author,,Name>  



-- Create date: <Create Date,,>



-- Description:	<Description,,>



--isClientCodeRegisteredForITRADE  'K636582','PTNA100'

--[ANAND1].msajag.dbo.Vw_VBB_SCHEME_NAME with(nolock) where cl_code = 'K636582' and sub_broker = 'PTNA'

-- =============================================
--isClientCodeRegisteredForITRADE 'S194675','heeh'


Create proc [dbo].[isClientCodeRegisteredForITRADE]

@client_code varchar (100),
@sub_tag varchar(100)



AS



BEGIN

--declare @sbTag nvarchar(50)
--set @sbTag = (select sub_broker from sb_client_details where cl_code = @client_code)

if Exists(select distinct SCHEME_NAME from [ANAND1].msajag.dbo.Vw_VBB_SCHEME_NAME with(nolock) where cl_code = @client_code and sub_broker = @sub_tag)



begin


declare @planedetails nvarchar(100)

--[196.1.115.196].[MSAJAG].dbo.Vw_VBB_SCHEME_NAME 

set @planedetails=(select top 1 SCHEME_NAME from [ANAND1].msajag.dbo.Vw_VBB_SCHEME_NAME with(nolock) where cl_code = @client_code and sub_broker = @sub_tag)



if(@planedetails='ANGEL CLASSIC 10000 VBB' or @planedetails='ANGEL CLASSIC 699 VBB' OR @planedetails='Angel Premier VBB' OR @planedetails='Angel Preferred VBB')

begin



select 1 as status --for itrade



end



if(@planedetails='Itrade Prime Classic VBB' or @planedetails='Itrade Prime Premier VBB' or @planedetails='Itrade Prime VBB' or @planedetails='Itrade PrimePreferred VBB')



begin

select 2 as status --for itrade prime

end

if(@planedetails='Itrade Prime PLUS')

begin



select 3 as status --for itrade PRIME PLUS



end




End

else

select 0 as status --normal

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.mfss_client_count
-- --------------------------------------------------
CREATE procedure mfss_client_count
(
		@Sub_broker varchar(100)
)
as
begin


--EXEC mfss_client_count 'JJUH'

select count(distinct party_code) ClientCount from [AngelFO].bsemfss.dbo.mfss_client   where --party_code='M134401' 
sub_broker=@Sub_broker 
 

 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MinorDetails_Mail
-- --------------------------------------------------

Create procedure [dbo].[MinorDetails_Mail]
(@filenames varchar(100))
as
begin

Set NOCOUNT ON 
--Declare @Cnt INT

DECLARE    @tab char(1) = CHAR(9)

Declare @BodyContent Varchar(max)
,@subject Varchar(2000)

Set @subject='Minor detail'


Declare @Body varchar(max)


Set @Body=
'Hello All,

				Please find the attachment for Minor details.'

EXEC msdb.dbo.sp_send_dbmail
  @profile_name = 'NXT',
  @recipients= 'chhabiraj.chaurasia@angelbroking.com',
  @blind_copy_recipients='yogesh.rewatkar@angelbroking.com',
  @subject= @subject, 
  @body = @body,
  @file_attachments = @filenames,
  @from_address   = 'nxt@angelbroking.com'
		
   

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Module_UpdatedTime
-- --------------------------------------------------
--select * from job_StatusNXT_log
--where Modulename='NRMS'
--order by UpdateTime desc


--sp_depends job_StatusNXT_log

--dbo.Module_UpdatedTime


CREATE Procedure Module_UpdatedTime
--(
--	@Modulename varchar(200)
--)
as
begin
--EXEC Module_UpdatedTime 'Dashboard Risk'



--Declare @Updatedate date

--select @Updatedate=convert(date,max(updatetime)) from job_StatusNXT_log
--where Modulename=@Modulename


		select top 1 UpdateTime --'2023-09-11 09:02:04:543' UpdateTime 
		from job_StatusNXT_log
		where 
		Modulename='NRMS'
		order by UpdateTime desc

		--Modulename=@Modulename
		--and 
		--convert(date,updatetime)=@Updatedate
		--and updatetime = (select max(updatetime) from job_StatusNXT_log where Modulename=@Modulename)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Module_UpdatedTime_Bkp11Sept2023
-- --------------------------------------------------

CREATE Procedure Module_UpdatedTime_Bkp11Sept2023
(
	@Modulename varchar(200)
)
as
begin
--EXEC Module_UpdatedTime 'Dashboard Risk'

Declare @Updatedate date

select @Updatedate=convert(date,max(updatetime)) from job_StatusNXT_log
where Modulename=@Modulename


		select * from job_StatusNXT_log
		where Modulename=@Modulename
		and convert(date,updatetime)=@Updatedate
		and updatetime = (select max(updatetime) from job_StatusNXT_log where Modulename=@Modulename)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Pledge_Mis_Status_Details
-- --------------------------------------------------

----Brokerage report
--95

--EXEC Pledge_Mis_Status_Details_New 'S142845','2020-09-01','2020-08-04'

CREATE procedure Pledge_Mis_Status_Details
(
	@party_code varchar(100)
	,@ActionDate Date=NUll
	,@CommunicationDate date=null

)
as
begin

select 
	Party_code	
	,ISIN	
	,Scrip_Name	
	,QTY	
	,Convert(Varchar(20),@ActionDate,103) ActionDate
	,Convert(Varchar(20),@CommunicationDate,103) CommunicationDate 
	,Case when dp37_status_code in ('A') then 'Accepted'
		 when dp37_status_code in ('C') then 'Cancelled'
		 when dp37_status_code in ('D','E','F','G','J','K','N','P','S','T') then 'Authorisation Pending'
		 when dp37_status_code in ('I','R') then 'Rejected'
		 when dp37_status_code in ('O','H') then 'OTP Generated'
END Status 
 from [196.1.115.182].General.dbo.Pld_Sec_info Sec with (nolock)
where party_code=@party_code
	and (PLDG_Request_date >=@CommunicationDate and PLDG_Request_date<=@ActionDate)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Pledge_Mis_Status_Details_Bkp08Sept2020
-- --------------------------------------------------
--95

--EXEC Pledge_Mis_Status_Details_V1 'SGSY1034','2020-09-01','2020-08-04'

CREATE procedure Pledge_Mis_Status_Details_Bkp08Sept2020
(
	@party_code varchar(100)
	,@ActionDate Date=NUll
	,@CommunicationDate date=null

)
as
begin

select 
	Party_code	
	,ISIN	
	,Scrip_Name	
	,QTY	
	,@ActionDate ActionDate
	,@CommunicationDate CommunicationDate 
	,Case when dp37_status_code in ('A') then 'Accepted'
		 when dp37_status_code in ('C') then 'Cancelled'
		 when dp37_status_code in ('J') then 'Authorisation Pending'
	ELSe 	'OTP Received' END Status 

 from [196.1.115.182].General.dbo.Pld_Sec_info Sec with (nolock)
where party_code=@party_code
	and (PLDG_Request_date >=@CommunicationDate and PLDG_Request_date<=@ActionDate)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Pledge_Mis_Status_Details_Bkp16sep2020
-- --------------------------------------------------

----Brokerage report
--95

--EXEC Pledge_Mis_Status_Details_New 'S142845','2020-09-01','2020-08-04'

CREATE procedure Pledge_Mis_Status_Details_Bkp16sep2020
(
	@party_code varchar(100)
	,@ActionDate Date=NUll
	,@CommunicationDate date=null

)
as
begin

select 
	Party_code	
	,ISIN	
	,Scrip_Name	
	,QTY	
	,Convert(Varchar(20),@ActionDate,103) ActionDate
	,Convert(Varchar(20),@CommunicationDate,103) CommunicationDate 
	,Case when dp37_status_code in ('A') then 'Accepted'
		 when dp37_status_code in ('C') then 'Cancelled'
		 when dp37_status_code in ('D','E','F','G','J','K','N','P','S','T') then 'Authorisation Pending'
		 when dp37_status_code in ('I','R') then 'Rejected'
		 when dp37_status_code in ('O','H') then 'OTP Generated'
END Status 
 from [196.1.115.182].General.dbo.Pld_Sec_info Sec with (nolock)
where party_code=@party_code
	and (PLDG_Request_date >=@CommunicationDate and PLDG_Request_date<=@ActionDate)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Pledge_Mis_Status_Details_New
-- --------------------------------------------------

----Brokerage report
--95

--EXEC Pledge_Mis_Status_Details_V1 'SGSY1034','2020-09-01','2020-08-04'

Create procedure Pledge_Mis_Status_Details_New
(
	@party_code varchar(100)
	,@ActionDate Date=NUll
	,@CommunicationDate date=null

)
as
begin

select 
	Party_code	
	,ISIN	
	,Scrip_Name	
	,QTY	
	,Convert(Varchar(20),@ActionDate) ActionDate
	,Convert(Varchar(20),@CommunicationDate) CommunicationDate 
	,Case when dp37_status_code in ('A') then 'Accepted'
		 when dp37_status_code in ('C') then 'Cancelled'
		 when dp37_status_code in ('D','E','F','G','J','K','N','P','S','T') then 'Authorisation Pending'
		 when dp37_status_code in ('I','R') then 'Rejected'
		 when dp37_status_code in ('O','H') then 'OTP Generated'
END Status 
 from [196.1.115.182].General.dbo.Pld_Sec_info Sec with (nolock)
where party_code=@party_code
	and (PLDG_Request_date >=@CommunicationDate and PLDG_Request_date<=@ActionDate)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Pledge_Mis_Status_Details_V1
-- --------------------------------------------------

----Brokerage report
--95

--EXEC Pledge_Mis_Status_Details_New 'S142845','2020-09-01','2020-08-04'

CREATE procedure Pledge_Mis_Status_Details_v1
(
	@party_code varchar(100)
	,@ActionDate Date=NUll
	,@CommunicationDate date=null

)
as
begin

select 
	Party_code	
	,ISIN	
	,Scrip_Name	
	,QTY	
	,Convert(Varchar(20),@ActionDate,103) ActionDate
	,Convert(Varchar(20),@CommunicationDate,103) CommunicationDate 
	,Case when dp37_status_code in ('A') then 'Accepted'
		 when dp37_status_code in ('C') then 'Cancelled'
		 when dp37_status_code in ('D','E','F','G','J','K','N','P','S','T') then 'Authorisation Pending'
		 when dp37_status_code in ('I','R') then 'Rejected'
		 when dp37_status_code in ('O','H') then 'OTP Generated'
END Status 
 from [196.1.115.182].General.dbo.Pld_Sec_info Sec with (nolock)
where party_code=@party_code
	and (PLDG_Request_date >=@CommunicationDate and PLDG_Request_date<=@ActionDate)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Prc_ChekMultilocationSBTag
-- --------------------------------------------------

CREATE Procedure [dbo].[Prc_ChekMultilocationSBTag]    
@access_code varchar(50)    
As    
Begin    
if exists (select * from MultilocationSBTags with(nolock) where sbtag=@access_code)    
BEGIN    
select 'True' as Flag    
End    
else    
Begin    
select 'False' as Flag    
End    
    
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Prc_ChekSBPageAccess
-- --------------------------------------------------

  
create Procedure [dbo].[Prc_ChekSBPageAccess]  
@access_code varchar(50)  
As  
Begin  
if exists (select * from SBPageAccess with(nolock) where sbtag=@access_code)  
BEGIN  
select 'True' as Flag  
End  
else  
Begin  
select 'False' as Flag  
End  
  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Prc_GetDPClientCode
-- --------------------------------------------------


Create Procedure [dbo].[Prc_GetDPClientCode]
@Party_code varchar(100)
As
Begin
SELECT CLIENT_CODE,FIRST_HOLD_NAME 
--FROM [172.31.16.94].inhouse.dbo.TBL_CLIENT_MASTER WITH(NOLOCK) 
From TBL_CLIENT_MASTER WITH(NOLOCK) 
WHERE NISE_PARTY_CODE= @Party_code
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Prc_GetSparsaRcd
-- --------------------------------------------------
CREATE Procedure [dbo].[Prc_GetSparsaRcd]    
(    
@Sbtag varchar(50),    
@Fcmkey varchar(8000)    
   
)    
As     
Begin    
  if exists(select * from tbl_SparsaDtls with(nolock) where sbtag=@Sbtag )    
  Begin      
  
  update tbl_SparsaDtls
  set Fcmkey=@Fcmkey,
  UpdatedDt=GETDATE() 
  where sbtag=@Sbtag
  
  select upper(StatusFlag) as Message,1 as Result  from tbl_SparsaDtls with(nolock) where sbtag=@Sbtag and Fcmkey=@Fcmkey  
  End    
  Else    
  Begin      
  select 'FALSE' as Message,1 as Result    
  End    
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Prc_InsSparsaRcd
-- --------------------------------------------------
CREATE Procedure [dbo].[Prc_InsSparsaRcd]  
(  
@Sbtag varchar(50),  
@Fcmkey varchar(8000),  
@StatusFlag varchar(10)  
)  
As   
Begin  
  if not exists(select * from tbl_SparsaDtls with(nolock) where sbtag=@Sbtag)  
  Begin  
  insert into tbl_SparsaDtls   
  (SBTAG,FCMKey,StatusFlag,CreatedBy,CreatedOn)  
  values  
  (@Sbtag,@Fcmkey,@StatusFlag,@Sbtag,getdate())  
  
  select 'SUCCESS' as Message,1 as Result
  
  End  
  Else  
  Begin  
  update tbl_SparsaDtls   
  set Fcmkey=@Fcmkey,  
  StatusFlag=@StatusFlag,  
  Updatedby=@Sbtag,  
  UpdatedDt=GETDATE()  
  where Sbtag=@Sbtag  
  
  select 'UPDATED SUCCESSFULLY' as Message,1 as Result
  
  End  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Prc_RestrictAccess
-- --------------------------------------------------

create Procedure [dbo].[Prc_RestrictAccess]
@access_code varchar(50)
As
Begin
if exists (select * from tbl_SBAccess with(nolock) where sbtag=@access_code)
BEGIN
select 'False' as Flag
End
else
Begin
select 'True' as Flag
End

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Sb_Declaration_Pending_BeeNXT
-- --------------------------------------------------
  
CREATE  PROCEDURE Sb_Declaration_Pending_BeeNXT  
(  
 @SBTag varchar(200)  
)  
as  
begin  
--EXEC Sb_Declaration_Pending_BeeNXT 'AAARP'  
  
SELECT [SBTag]  
      --,[FnYear]  
   ,'20'+ convert(varchar(2),substring([FnYear],1,(charindex('-', [FnYear]))+1)) +'-'+ '20'+ convert(varchar(2),substring([FnYear],(charindex('-', [FnYear]))+1,len([FnYear]))) FnYear  
  FROM [dbo].[sb_Declaration]  
  where   
  --FnYear='18-19'  
  --AND   
  SelfDeclaration IS NULL  
  AND RCVD_DATE IS NULL  
  AND SBTag =@SBTag 
  AND ISNULL(IsApproved, 0) = 0
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_GetCombinedMargin
-- --------------------------------------------------


-- Author:		<Author,,Name>



-- Create date: <Create Date,,>



-- Description:	<Description,,>



-- =============================================



CREATE PROCEDURE SP_GetCombinedMargin



(



@fromdate datetime,



--@todate datetime,



@party_code varchar(20)



)



AS



BEGIN



	-- SET NOCOUNT ON added to prevent extra result sets from



	-- interfering with SELECT statements.



	SET NOCOUNT ON;



	



SELECT        MARGINDATE, EXCHANGE, SEGMENT, PARTY_CODE, TDAY_LEDGER, TDAY_MARGIN, TDAY_MTM, TDAY_CASHCOLL, TDAY_FDBG, TDAY_CASH, TDAY_NONCASH,TDAY_MARGIN_SHORT, TDAY_MTM_SHORT 



      --                   T1DAY_LEDGER, T1DAY_MARGIN, T1DAY_MTM, T1DAY_CASHCOLL, T1DAY_FDBG, T1DAY_CASH, T1DAY_NONCASH, T1DAY_MARGIN_SHORT, T1DAY_MTM_SHORT, T2DAY_LEDGER, T2DAY_MARGIN, 



      --                   T2DAY_MTM, T2DAY_CASHCOLL, T2DAY_FDBG, T2DAY_CASH, T2DAY_NONCASH, T2DAY_MARGIN_SHORT, T2DAY_MTM_SHORT



FROM  [AngelNseCM].[MSAJAG].dbo.TBL_COMBINE_REPORTING WITH (NOLOCK)



WHERE  MARGINDATE = cast(@fromdate as datetime) and party_code=@party_code-- and  cast(@todate as datetime) (MARGINDATE = @DATE) AND (PARTY_CODE BETWEEN @tFparty_code AND @tparty_code)



ORDER BY PARTY_CODE











SELECT        MARGINDATE, EXCHANGE, SEGMENT, PARTY_CODE, TDAY_LEDGER, TDAY_MARGIN, TDAY_MTM, TDAY_CASHCOLL, TDAY_FDBG, TDAY_NONCASH, TDAY_MARGIN_SHORT, TDAY_MTM_SHORT ,T_MARGINAVL, T_MTMAVL



                         --T1DAY_LEDGER, T1DAY_MARGIN, T1DAY_MTM, T1DAY_CASHCOLL, T1DAY_FDBG, T1DAY_NONCASH, T1DAY_MARGIN_SHORT, T1DAY_MTM_SHORT, T2DAY_LEDGER, T2DAY_MARGIN, T2DAY_MTM, 



                         --T2DAY_CASHCOLL, T2DAY_FDBG, T2DAY_NONCASH, T2DAY_MARGIN_SHORT, T2DAY_MTM_SHORT, T_MARGINAVL, T_MTMAVL



FROM   [AngelNseCM].[MSAJAG].dbo.TBL_COMBINE_REPORTING_DETAIL WITH (NOLOCK)



WHERE        MARGINDATE = cast(@fromdate as datetime)  and party_code=@party_code-- and  cast(@todate as datetime)(MARGINDATE = @DATE) AND (PARTY_CODE BETWEEN @tFparty_code AND @tparty_code)



ORDER BY PARTY_CODE







select  effdate as EFFDATE ,EXCHANGE,SEGMENT,PARTY_CODE,COLL_TYPE,SCRIP_CD,SERIES,ISIN,QTY,FD_TYPE,FD_BG_NO,MRG_CL_RATE,AMOUNT,MRG_VAR_MARGIN,FINALAMOUNT  from [AngelNseCM].[MSAJAG].dbo.V2_TBL_COLLATERAL_MARGIN_COMBINE WITH (NOLOCK)



where effdate = cast(@fromdate as datetime) and party_code=@party_code --and  cast(@todate as datetime)







END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_GetCombinedMargin_uat
-- --------------------------------------------------



-- Author:		<Author,,Name>



-- Create date: <Create Date,,>



-- Description:	<Description,,>



-- =============================================



CREATE PROCEDURE SP_GetCombinedMargin_uat



(



@fromdate datetime,



--@todate datetime,



@party_code varchar(20)



)



AS



BEGIN



	-- SET NOCOUNT ON added to prevent extra result sets from



	-- interfering with SELECT statements.



	SET NOCOUNT ON;



	



SELECT        MARGINDATE, EXCHANGE, SEGMENT, PARTY_CODE, TDAY_LEDGER, TDAY_MARGIN, TDAY_MTM, TDAY_CASHCOLL, TDAY_FDBG, TDAY_CASH, TDAY_NONCASH,TDAY_MARGIN_SHORT, TDAY_MTM_SHORT 



      --                   T1DAY_LEDGER, T1DAY_MARGIN, T1DAY_MTM, T1DAY_CASHCOLL, T1DAY_FDBG, T1DAY_CASH, T1DAY_NONCASH, T1DAY_MARGIN_SHORT, T1DAY_MTM_SHORT, T2DAY_LEDGER, T2DAY_MARGIN, 



      --                   T2DAY_MTM, T2DAY_CASHCOLL, T2DAY_FDBG, T2DAY_CASH, T2DAY_NONCASH, T2DAY_MARGIN_SHORT, T2DAY_MTM_SHORT



FROM  [AngelNseCM].[MSAJAG].dbo.TBL_COMBINE_REPORTING WITH (NOLOCK)



WHERE  MARGINDATE = cast(@fromdate as datetime) and party_code=@party_code-- and  cast(@todate as datetime) (MARGINDATE = @DATE) AND (PARTY_CODE BETWEEN @tFparty_code AND @tparty_code)



ORDER BY PARTY_CODE











SELECT        MARGINDATE, EXCHANGE, SEGMENT, PARTY_CODE, TDAY_LEDGER, TDAY_MARGIN, TDAY_MTM, TDAY_CASHCOLL, TDAY_FDBG, TDAY_NONCASH, TDAY_MARGIN_SHORT, TDAY_MTM_SHORT ,T_MARGINAVL, T_MTMAVL



                         --T1DAY_LEDGER, T1DAY_MARGIN, T1DAY_MTM, T1DAY_CASHCOLL, T1DAY_FDBG, T1DAY_NONCASH, T1DAY_MARGIN_SHORT, T1DAY_MTM_SHORT, T2DAY_LEDGER, T2DAY_MARGIN, T2DAY_MTM, 



                         --T2DAY_CASHCOLL, T2DAY_FDBG, T2DAY_NONCASH, T2DAY_MARGIN_SHORT, T2DAY_MTM_SHORT, T_MARGINAVL, T_MTMAVL



FROM   [AngelNseCM].[MSAJAG].dbo.TBL_COMBINE_REPORTING_DETAIL WITH (NOLOCK)



WHERE        MARGINDATE = cast(@fromdate as datetime)  and party_code=@party_code-- and  cast(@todate as datetime)(MARGINDATE = @DATE) AND (PARTY_CODE BETWEEN @tFparty_code AND @tparty_code)



ORDER BY PARTY_CODE







select  effdate as EFFDATE ,EXCHANGE,SEGMENT,PARTY_CODE,COLL_TYPE,SCRIP_CD,SERIES,ISIN,QTY,FD_TYPE,FD_BG_NO,MRG_CL_RATE,AMOUNT,MRG_VAR_MARGIN,FINALAMOUNT  from [AngelNseCM].[MSAJAG].dbo.V2_TBL_COLLATERAL_MARGIN_COMBINE WITH (NOLOCK)



where effdate = cast(@fromdate as datetime) and party_code=@party_code --and  cast(@todate as datetime)







END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_Ins_SB_Access_Tag
-- --------------------------------------------------
CREATE Procedure [dbo].[SP_Ins_SB_Access_Tag] 
(
		@sbTag varchar(20)
)
AS
BEGIN

	DECLARE @todayDate datetime
	SET @todayDate=GETDATE()

	IF NOT EXISTS(select * from tbl_SBAccess where SBTAG=@sbTag)
	BEGIN
		INSERT INTO tbl_SBAccess(SBTAG,CreatedBy,CreatedOn,UpdatedBy,UpdatedDT)
		VALUES(@sbTag,'System',@todayDate,'','1900-01-01 00:00:00.000')
		SELECT '1' AS [Message]
	END
	
	ELSE
	BEGIN
		SELECT '0' AS [Message] 
	END
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_Remove_SB_Access_Tag
-- --------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE Procedure [dbo].SP_Remove_SB_Access_Tag 
(
		@sbTag varchar(20)
)
AS
BEGIN
				delete from tbl_SBAccess where SBTAG=@sbTag

		SELECT '1' AS [Message]
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spCheckPOAStatus
-- --------------------------------------------------
CREATE proc [dbo].[spCheckPOAStatus] (
@partyCode as varchar(20)
)
as
begin
select  * from Tbl_NewPOA with(nolock) where PARTY_CODE=@partyCode
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spGetORDER_TRANS
-- --------------------------------------------------
CREATE proc [dbo].[spGetORDER_TRANS]   --[spGetORDER_TRANS] 'RAOI1338','2021-03-15','2021-03-15','AJYC'
( 
	@partycode varchar(30),    
	@fromdate Date,
	@todate Date,
	@access_Code varchar(8)
)
as 
begin
	
	select TRADE_DATE,PARTY_CODE,EXCHANGE,ORDER_NO from [AngelNseCM].MSAJAG.dbo.ORDER_TRANS_JV_CALC where PARTY_CODE=@partycode AND TRADE_DATE  >= @fromdate and TRADE_DATE <= @todate  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_GetCityName
-- --------------------------------------------------
--exec spx_GetCityName ''
  
Create proc [dbo].[spx_GetCityName]  
(  
 @CityId varchar(50)
)  
  
As  
  
Begin  

  Select CityName from tbl_CityMaster C with(Nolock) where CItyId=@CityId

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Spx_MfOrderPayment_GetBankdetails
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Spx_MfOrderPayment_GetBankdetails]              
@ID varchar(100)                
AS                
BEGIN              
          
DECLARE @PanNumber varchar(20)          
DECLARE @Name varchar(100)          
          
            
SELECT TOP 1              
 Id AS 'ID',                    
PartyCode as 'ClientCode',                   
MarginDeposit as 'Amount',                
BankName,             
BranchCode,            
IfscCode,               
AccountNumber as 'BankAccountNumber',                
angelRefNumber as 'RequestUIN',                  
PaymentStatus,              
'Saving' AS 'AccountType',              
'WEBKYC' AS 'ReqSource',        
'Mutual Fund' AS 'ExchangeSegment',        
'WEBNXT-MF-BEENXT-PGSDK' AS 'RequestType',        
'' AS 'AllowedExchanges',        
'1' AS 'IsRequestValid',        
'Y' AS 'IsBasket',        
'' AS 'TokenCode',    
Created_Date,Modified_Date,MimansaTransactionRefNo,merchantIdentifier   
 FROM MfPaymentInfo WITH(Nolock) where angelRefNumber=@ID ORDER BY Created_Date DESC                
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfOrderPayment_GetClientBanks
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[spx_MfOrderPayment_GetClientBanks]     
(    
@PartyCode varchar(100)    
)    
AS    
BEGIN    
   
 SET NOCOUNT ON;    
  
   IF (SELECT count(*) from [196.1.115.167].KYC_CI.DBO.tbl_Bse_MF_AllBank WITH(NOLOCK) where party_code = @PartyCode) > 0
 BEGIN
  select PARTY_CODE,BANK_NAME,branch_name as BANK_BRANCH,accno as ACCOUNTNO,MICR_CODE, IFSC_CODE,'1' as DEFAULT_ID 
  from [196.1.115.167].KYC_CI.DBO.tbl_Bse_MF_AllBank WITH(NOLOCK) where  PARTY_CODE = @PartyCode AND PARTY_CODE <> ''
 END
 ELSE
 BEGIN
   select PARTY_CODE,BANK_NAME,BANK_BRANCH,ACC_NO as ACCOUNTNO,MICR_NO as MICR_CODE,NEFTCODE as IFSC_CODE,'1' as DEFAULT_ID   
   from [AngelFO].[bsemfss].[dbo].[mfss_Client] with(nolock) where party_code=@PartyCode  AND PARTY_CODE <> ''
 END 
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfOrderPayment_GetClientBanks_old
-- --------------------------------------------------
    
CREATE PROCEDURE [dbo].[spx_MfOrderPayment_GetClientBanks_old]      
(      
@PartyCode varchar(100)      
)      
AS      
BEGIN      
     
 SET NOCOUNT ON;      
    
   select PARTY_CODE,BANK_NAME,BANK_BRANCH,ACC_NO as ACCOUNTNO,MICR_NO as MICR_CODE,NEFTCODE as IFSC_CODE,'1' as DEFAULT_ID     
   from [196.1.115.200].[bsemfss].[dbo].[mfss_Client] with(nolock) where party_code=@PartyCode    
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfOrderPayment_GetClientBanks_UAT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[spx_MfOrderPayment_GetClientBanks_UAT]     
(    
@PartyCode varchar(100)    
)    
AS    
BEGIN    
   
 SET NOCOUNT ON;    
  
   IF (SELECT count(*) from [196.1.115.167].KYC_CI.DBO.tbl_Bse_MF_AllBank B WITH(NOLOCK) where party_code = @PartyCode) > 0
 BEGIN
  select PARTY_CODE,BANK_NAME,branch_name as BANK_BRANCH,accno as ACCOUNTNO,MICR_CODE, IFSC_CODE,'1' as DEFAULT_ID 
  from [196.1.115.167].KYC_CI.DBO.tbl_Bse_MF_AllBank WITH(NOLOCK) where  PARTY_CODE = @PartyCode AND PARTY_CODE <> ''
 END
 ELSE
 BEGIN
   select PARTY_CODE,BANK_NAME,BANK_BRANCH,ACC_NO as ACCOUNTNO,MICR_NO as MICR_CODE,NEFTCODE as IFSC_CODE,'1' as DEFAULT_ID   
   from [196.1.115.200].[bsemfss].[dbo].[mfss_Client] with(nolock) where party_code=@PartyCode  AND PARTY_CODE <> ''
 END 
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Spx_MfPayment_GetBankdetails_New
-- --------------------------------------------------

-- =============================================        
-- Author:  Mahesh Darji        
-- Create date: 13/06/2018        
-- Description:         
-- =============================================        
CREATE PROCEDURE [dbo].[Spx_MfPayment_GetBankdetails_New]      
@ID varchar(30)        
AS        
BEGIN      
  
DECLARE @PanNumber varchar(20)  
DECLARE @Name varchar(100)  
  
    
SELECT TOP 1      
 Id AS 'ID',            
PartyCode as 'ClientCode',           
MarginDeposit as 'Amount',        
BankName,     
BranchCode,    
IfscCode,       
AccountNumber as 'BankAccountNumber',        
angelRefNumber as 'RequestUIN',          
PaymentStatus,      
'Saving' AS 'AccountType',      
'WEBKYC' AS 'ReqSource',
'Mutual Fund' AS 'ExchangeSegment',
'WEBNXT-MF-BEENXT-PGSDK' AS 'RequestType',
'' AS 'AllowedExchanges',
'1' AS 'IsRequestValid',
'Y' AS 'IsBasket',
'' AS 'TokenCode'
 FROM MfPaymentInfo WITH(Nolock) where Id=@ID ORDER BY Created_Date DESC        
END        
        
--exec Spx_GetBankdetailsForpaymentgateway '1'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfPayment_GetClientBanks
-- --------------------------------------------------

-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
-- spx_MfPayment_GetClientBanks 'RP61'
CREATE PROCEDURE [dbo].[spx_MfPayment_GetClientBanks]
(
@PartyCode varchar(100)
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	 CREATE TABLE #1 (            
		 Party_code VARCHAR(30),            
		 Bank_Name VARCHAR(100),            
		 Bank_Branch VARCHAR(100),            
		 MICR_CODE VARCHAR(50),            
		 IFSC_CODE VARCHAR(50),            
		 ACCOUNTNO VARCHAR(50),            
		 DEFAULT_ID VARCHAR(10)            
			)  
	
	
	 INSERT INTO #1 (Party_code, Bank_Name, Bank_Branch, MICR_CODE, IFSC_CODE, ACCOUNTNO, DEFAULT_ID)            
	 EXEC [172.31.16.57].cRMDB_A.DBO. CLI_BANK @PartyCode
	 
	 SELECT Party_code, Bank_Name, Bank_Branch, MICR_CODE, IFSC_CODE, ACCOUNTNO, DEFAULT_ID
	 FROM #1
	 ORDER BY DEFAULT_ID DESC
	 
	 DROP TABLE #1  


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfPayment_Save_New
-- --------------------------------------------------
-- =============================================                        
-- Author:  <Author,,Name>                        
-- Create date: <Create Date,,>                        
-- Description: <Description,,>                        
-- =============================================                        
CREATE PROCEDURE [dbo].[spx_MfPayment_Save_New]                    
(                        
@PartyCode varchar(30),                        
@Amount [numeric](18, 2),                        
@SBTag varchar(30),                        
@IpAddress varchar(30),                      
@ReferenceNumber varchar(40)                      
)                        
AS                        
BEGIN                        
 -- SET NOCOUNT ON added to prevent extra result sets from                        
 -- interfering with SELECT statements.                        
 SET NOCOUNT ON;                        
                         
 DECLARE @Id int                        
 DECLARE @Message varchar(100)                 
 DECLARE @BankName varchar(100)                      
 DECLARE @BranchCode varchar(200)              
 DECLARE @IfscCode varchar(50)              
 DECLARE @AccountNo varchar(50)              
 DECLARE @MobileNo varchar(20)              
               
 BEGIN TRY              
               
 IF(ISNULL(@PartyCode,'')='')              
 BEGIN              
               
 SET @Message = 'Party Code does not exist'                   
               
 END              
 ELSE              
 BEGIN                     
               
 --SELECT @BankName = 'AXIS BANK', @AccountNo = '916010084083109', @BranchCode = 'SPRINGFIELDS,LOKHANDWALA-MUM', @IfscCode = 'UTIB0000415'              
               
 CREATE TABLE #1 (              
 Party_code VARCHAR(30),              
 Bank_Name VARCHAR(100),              
 Bank_Branch VARCHAR(100),              
 MICR_CODE VARCHAR(50),              
 IFSC_CODE VARCHAR(50),              
 ACCOUNTNO VARCHAR(50),              
 DEFAULT_ID VARCHAR(10)              
 )              
                     
           
 CREATE TABLE #3 (          
 [MobileNo] varchar(30)          
 )          
               
 INSERT INTO #1 (Party_code, Bank_Name, Bank_Branch, MICR_CODE, IFSC_CODE, ACCOUNTNO, DEFAULT_ID)              
 EXEC [172.31.16.57].cRMDB_A.DBO. CLI_BANK @PartyCode              
               
 SELECT TOP 1 @BankName = Bank_Name, @AccountNo = ACCOUNTNO, @BranchCode = Bank_Branch, @IfscCode = IFSC_CODE              
 FROM #1 WITH(NOLOCK)              
 ORDER BY DEFAULT_ID DESC            
 --WHERE DEFAULT_ID = 1              
               
 IF(ISNULL(@IfscCode,'') <> '')              
 BEGIN              
       
 IF(ISNULL(@BankName,'') <> '')              
 BEGIN              
               
 INSERT INTO [MfPaymentInfo] (PartyCode, SBTag, MarginDeposit, BankName, AccountNumber,BranchCode,IfscCode, AccCharges, PaymentMode_Id, PaymentStatus,                        
 Created_Date, TotalPayment, SBIpAddress, angelRefNumber)                        
 VALUES (@PartyCode, @SBTag, @Amount, @BankName,@AccountNo,@BranchCode,@IfscCode, 0, 96, 0, GETDATE(), @Amount, @IpAddress, @ReferenceNumber)                        
                         
 SELECT @Id = @@IDENTITY                        
                         
 SET @Message = 'success'               
          
           
 INSERT INTO #3 ([MobileNo])          
 EXEC [196.1.115.167].[KYC_CI].dbo.Spx_GetMobileNoOnClientCode @PartyCode          
           
 SELECT @MobileNo = ISNULL(MobileNo,'') FROM #3 WITH(NOLOCK)          
        
 END              
 ELSE              
 BEGIN              
               
 SET @Message = 'Bank not present for Online Payment'              
               
 END              
                   
 END              
 ELSE              
 BEGIN              
               
 SET @Message = 'Bank not mapped to Client Code: ' + @PartyCode              
               
 END              
               
 END              
               
 END TRY              
 BEGIN CATCH              
   Declare @ErrorMessage NVarchar(4000),@ErrorSeverity Int,@ErrorState Int,@ErrorNumber Int,@ErrorLine Int                  
                
  Select @ErrorMessage = ERROR_MESSAGE(),@ErrorSeverity = ERROR_SEVERITY(),@ErrorState = ERROR_STATE(),@ErrorNumber=ERROR_NUMBER(),@ErrorLine=ERROR_LINE();                  
                
  Exec Spx_MfPayment_SaveErrorDetails @ErrorNo=@ErrorNumber,@Description=@ErrorMessage,@ModuleName='Insert Update Payment Details',@Proc_Name='spx_MfPayment_Save_New',@VenDorName='MfPayment'                  
                
  set @Message='Fail'                
              
               
 END CATCH              
             
 DROP TABLE #1                   
 DROP TABLE #3          
            
 --SET @MobileNo = '9773310210'          
                         
 SELECT @ID as ID, @MobileNo AS 'MobileNo', @Message as Message                        
                         
                        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfPayment_UpdateMfPaymentLog
-- --------------------------------------------------
create procedure spx_MfPayment_UpdateMfPaymentLog  
(  
@angelRefNo varchar(100),  
@uniqueRefNo varchar(100),  
@PaymentStatus varchar(50),  
@Response varchar(500)  
)  
AS  
BEGIN  
DECLARE @Message varchar(100)                                              
 BEGIN TRY                            
 update MfPaymentLog set Response=@Response,PaymentStatus=@PaymentStatus,Mdified_Date=GETDATE()  
 where uniqueRefNo=@uniqueRefNo and angelRefNo=@angelRefNo  
    set @Message='success'   
END TRY                            
BEGIN CATCH     
  set @Message='Fail'        
 END CATCH  
 SELECT @Message as Message                                      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfPayment_UpdateReferenceNumber
-- --------------------------------------------------
  
-- =============================================                                  
-- Author:  <Author,,Name>                                  
-- Create date: <Create Date,,>                                  
-- Description: <Description,,>                                  
-- =============================================                                  
CREATE PROCEDURE [dbo].[spx_MfPayment_UpdateReferenceNumber]  
(                                  
@ID int,                                                       
@ReferenceNumber varchar(100) = NULL  ,  
@PayOption VARCHAR(50)    = null,
@ProjectType NVARCHAR(20) = 'BeeNXT'
)                                  
AS                                  
BEGIN                                  
 -- SET NOCOUNT ON added to prevent extra result sets from                                  
 -- interfering with SELECT statements.                                  
 SET NOCOUNT ON;                                  
                   
DECLARE @Message varchar(100)                                          
                         
 BEGIN TRY                        
                     
                 --UPDATE MfPaymentInfo    
                 --SET angelRefNumber = @ReferenceNumber    
                 --WHERE Id = @ID     
  
       UPDATE MfPaymentInfo    
     SET    AngelRefNumber = @ReferenceNumber,  
       Field2 = @PayOption -- Here NB means NetBanking and DC means Debit card  
     WHERE      Id = @ID   
                     
                   set @Message='success'      
                                
                         
 END TRY                        
 BEGIN CATCH                        
   Declare @ErrorMessage NVarchar(4000),@ErrorSeverity Int,@ErrorState Int,@ErrorNumber Int,@ErrorLine Int                            
                          
  Select @ErrorMessage = ERROR_MESSAGE(),@ErrorSeverity = ERROR_SEVERITY(),@ErrorState = ERROR_STATE(),@ErrorNumber=ERROR_NUMBER(),@ErrorLine=ERROR_LINE();                            
                          
  Exec Spx_MfPayment_SaveErrorDetails @ErrorNo=@ErrorNumber,@Description=@ErrorMessage,@ModuleName='Insert Update Payment Details',@Proc_Name='spx_MfPayment_UpdateReferenceNumber',@VenDorName='MfPayment', @ProjectType=@ProjectType                            
                          
  set @Message='Fail'                          
                        
                         
 END CATCH                        
                       
    
 SELECT @Message as Message                                  
                                   
                                  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_MfPayment_UpdateReferenceNumber_BackUp
-- --------------------------------------------------

-- =============================================                                
-- Author:  <Author,,Name>                                
-- Create date: <Create Date,,>                                
-- Description: <Description,,>                                
-- =============================================                                
CREATE PROCEDURE [dbo].[spx_MfPayment_UpdateReferenceNumber_BackUp]
(                                
@ID int,                                                     
@ReferenceNumber varchar(100) = NULL         
)                                
AS                                
BEGIN                                
 -- SET NOCOUNT ON added to prevent extra result sets from                                
 -- interfering with SELECT statements.                                
 SET NOCOUNT ON;                                
                 
DECLARE @Message varchar(100)                                        
                       
 BEGIN TRY                      
                   
                 UPDATE MfPaymentInfo  
                 SET angelRefNumber = @ReferenceNumber  
                 WHERE Id = @ID   
                   
                   set @Message='success'    
                              
                       
 END TRY                      
 BEGIN CATCH                      
   Declare @ErrorMessage NVarchar(4000),@ErrorSeverity Int,@ErrorState Int,@ErrorNumber Int,@ErrorLine Int                          
                        
  Select @ErrorMessage = ERROR_MESSAGE(),@ErrorSeverity = ERROR_SEVERITY(),@ErrorState = ERROR_STATE(),@ErrorNumber=ERROR_NUMBER(),@ErrorLine=ERROR_LINE();                          
                        
  Exec Spx_MfPayment_SaveErrorDetails @ErrorNo=@ErrorNumber,@Description=@ErrorMessage,@ModuleName='Insert Update Payment Details',@Proc_Name='spx_MfPayment_UpdateReferenceNumber',@VenDorName='MfPayment'                          
                        
  set @Message='Fail'                        
                      
                       
 END CATCH                      
                     
  
 SELECT @Message as Message                                
                                 
                                
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_OdinGetReCreateClients
-- --------------------------------------------------
CREATE Procedure spx_OdinGetReCreateClients
As
SELECT Party_Code,CreatedDate FROM PassivToActiveNXT Where CreatedDate>='2020-04-08' And  Flag=0 --And Party_Code= 'A5032'
--SELECT Party_Code,* FROM PassivToActiveNXT Where Flag=0

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_OdinUpdateReCreateFlag
-- --------------------------------------------------
CREATE Procedure [dbo].[spx_OdinUpdateReCreateFlag]
(
	@PartyCode varchar(20)
)
As

-- Changed by Mohan dtd 2020-05-01 stopped processed flag for 44 server' if @MappingManagerID Not In ('interactive43.angeltrade.in')--,'intclient44.angeltrade.in','interactive94.angeltrade.in')
if Exists (SELECT 1 FROM [196.1.115.167].Kyc_Ci.Dbo.Tbl_OdinReAccountLog With(NOlock) 
		Where PartyCode=@PartyCode)-- And (ActionDescription Like '%43.angeltrade.in%')) --  OR ActionDescription Like '%94.angeltrade.in%'))
BEGIN
	Update PassivToActiveNXT Set Flag=1 Where Party_Code=@PartyCode
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.testtodelete_sp
-- --------------------------------------------------

CREATE procedure testtodelete_sp
as
select name from sys.databases

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPS_Get_ARQPerformance_data
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[UPS_Get_ARQPerformance_data]
		@segment varchar(100) = NULL,
		@type varchar(100) = NULL
AS
/*
	EXEC UPS_Get_ARQPerformance_data @segment = 'EQ' , @type = ''
	select distinct [segment], [type] from tbl_ARQ_mailer
*/
BEGIN

--return 0
	IF OBJECT_ID('TEMPDB..#TMP') IS NOT NULL
		DROP TABLE #TMP
	SELECT 
		sr_no,
		[key], ROUND(CAST(REPLACE(LTRIM(RTRIM([VALUE])), '%', '') AS FLOAT), 2) AS [VALUE],
		[type] as stype,
		Title
	INTO #TMP
	FROM tbl_ARQ_mailer
	WHERE (segment = @segment OR NULLIF(@segment, '') is null)
	and ([type] = @type OR NULLIF(@type, '') is null)
	
	select a.[key], a.[VALUE], a.stype, a.Title,
		CASE WHEN (a.sr_no < b.sr_no) then 0 
			 WHEN (a.sr_no > b.sr_no) and (A.[value] > b.[value]) THEN 0 
			 ELSE (b.[value] - A.[value]) END as Outperformance
	from #TMP A
	JOIN #TMP B
	ON A.stype = B.stype
	where a.sr_no <> b.sr_no
		AND 1 = CASE WHEN @segment='MF' AND A.stype='MSCA' THEN 0 ELSE 1 END
	order by a.sr_no
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Accrual_Amt_NXT
-- --------------------------------------------------

Create procedure usp_Accrual_Amt_NXT
as
begin
Set NOCOUNT ON 

  Declare @Today Date =Getdate()

Truncate table Accrual_Amt_NXT

  insert into Accrual_Amt_NXT
  select 'Accrual' AS AssetClass ,A.PARTY_CODE, SUM(isnull(A.CHARGES_AMT,0)) from   
  [196.1.115.132].MISC.DBO.CLI_ACCCHARGES A WITH (NOLOCK)
	INNER JOIN [196.1.115.132].MISC.DBO.CLI_ACCCHARGESMASTER C WITH (NOLOCK)   
	ON A.CHARGES_CODE = C.CHARGES_CODE  
  left join Accrual_Amt_NXT B ON A.Party_Code=B.PARTY_CODE
  where B.PARTY_CODE is null
	  and CHARGES_DATE > CUTOFFDATE                          
  group by A.PARTY_CODE


  --Update A
  --Set Accrual_Amt= T.CHARGES_AMT
  --From Accrual_Amt_NXT A
  --inner join 
  --(
	 -- select 
		--	'Accrual' AS AssetClass ,A.PARTY_CODE, SUM(isnull(A.CHARGES_AMT,0)) CHARGES_AMT 
		--  from   
		--	  MISC.DBO.CLI_ACCCHARGES A WITH (NOLOCK)
		--	  INNER JOIN MISC.DBO.CLI_ACCCHARGESMASTER C WITH (NOLOCK)   
		--	  ON A.CHARGES_CODE = C.CHARGES_CODE  
		--  where 
		--  --convert(date,Updated_on)=@Today
		--	  --and 
		--	  CHARGES_DATE > CUTOFFDATE                          
		--  group by A.PARTY_CODE
  --) T ON A.PARTY_CODE=T.Party_Code



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Active_Inacvtive_AdvisoryData
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Active_Inacvtive_AdvisoryData](
@Id INT,
@ActiveFlag BIT,
@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	UPDATE AdvisoryPerformanceReportData
	SET Active = @ActiveFlag, UpdatedBy = @EmpName, UpdatedDate = GETDATE()
	WHERE Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Active_Inacvtive_Menu
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Active_Inacvtive_Menu](
@Id INT,
@ActiveFlag BIT,
@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	UPDATE Menu
	SET Active = @ActiveFlag, UpdatedBy = @EmpName, UpdatedDate = GETDATE()
	WHERE Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Active_Inacvtive_NotificationData
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Active_Inacvtive_NotificationData](
@IsInActiveFlag BIT,
@CampaignId varchar(100) = '',
@NotificationText varchar(7000) = '',
@CreatedDate Date='2020-01-09',    
@NotificationType varchar(200)='Individual',
@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	UPDATE tbl_NotificationNXT
	SET IsInActive = @IsInActiveFlag, UpdatedBy = @EmpName, UpdatedDate = GETDATE()
	WHERE NOTIFICATIONTEXT = @NotificationText 
		AND CampaignId = @CampaignId 
		AND NotificationText <> 'message' 
		AND NotificationType = @NotificationType 
		AND CONVERT(DATE, CreatedDate) = CONVERT(DATE, @CreatedDate) 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Active_Inacvtive_RedirectionURL
-- --------------------------------------------------
CREATE procedure [dbo].usp_Active_Inacvtive_RedirectionURL(  
@ActiveFlag BIT,  
@RedirectionURLId INT,  
@EmpName NVARCHAR(100)  
)  
AS      
BEGIN   
 UPDATE NotificationNXT_MasterList  
 SET Active = @ActiveFlag, UpdatedBy = @EmpName, UpdatedDate = GETDATE()  
 WHERE ID = @RedirectionURLId   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Active_Inacvtive_SBTeleBotReg
-- --------------------------------------------------
CREATE procedure [dbo].usp_Active_Inacvtive_SBTeleBotReg(  
@ActiveFlag BIT,  
@SBId INT,  
@EmpName NVARCHAR(100)  
)  
AS      
BEGIN   
 UPDATE SB_TeleBot_Reg  
 SET IsActive = @ActiveFlag, UpdatedBy = @EmpName, UpdatedDate = GETDATE()  
 WHERE ID = @SBId   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Active_Inacvtive_UserMenu
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Active_Inacvtive_UserMenu](
@Id INT,
@ActiveFlag BIT,
@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	UPDATE UserMenuAccess
	SET Active = @ActiveFlag, UpdatedBy = @EmpName, UpdatedDate = GETDATE()
	WHERE Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_ActiveSBDetails_Mail
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_ActiveSBDetails_Mail]
as
begin

Set NOCOUNT ON 
--Declare @Cnt INT

DECLARE    @tab char(1) = CHAR(9)

Declare @BodyContent Varchar(max)
,@subject Varchar(2000)

Set @subject='Sb Details'


Set @BodyContent=
'Hello All,

				Please find the attachment for Sb details.'


EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
@recipients = 'nitin.rastogi@angelbroking.com;dewang.patel@angelbroking.com;callaudit@angelbroking.com',
@blind_copy_recipients='yogesh.rewatkar@angelbroking.com',

--Declare  @query  varchar(MAX)

	@query = 'SET NOCOUNT ON ;

	     SELECT access_code,username,person_name,usertype into #Temp
		FROM 
		  [196.1.115.132].Rolemgm.dbo.user_login SB with (nolock)
		  WHERE 
			  status=1
			  and login_inactive_date>getdate()
			  and access_to=''SB''
		
		SELECT ''access_code'', ''username'', ''person_name'', ''usertype''
		UNION ALL
		select * from #Temp
		 
 
        SET NOCOUNT OFF ' 
			,


				
@subject = @subject,
  @body=@BodyContent,
  @attach_query_result_as_file = 1,
@query_attachment_filename = 'SbDetails.xls',
@query_result_header = 0,
--@query_result_separator = ',',
@query_result_separator=@tab,
@query_result_no_padding = 1,
--@exclude_query_output = 1,
@from_address   = 'nxt@angelbroking.com'


				
   

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Add_DigitalLibraryCreative
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_Add_DigitalLibraryCreative]
(
	@Category Varchar(100),
	@CreativeName Varchar(100),
	@IsExpiry Varchar(100),
	@ExpiryDate datetime,
	@FestivalDate datetime='',
	@Personalised varchar(100),
	@ImageName varchar(200),
	@ImagePath varchar(2000),
	@ImageType varchar(100),
	@CreativeType varchar(100),
	@SbTags VARCHAR(MAX),
	@createdby varchar(100)
)
as
begin
Declare @CreativesId int    
insert into tbl_DigitalLibraryCreatives
(
	CreativeName
	,Category
	,ImageName
	,ImagePath
	,IsExpiry
	,ExpiryDate
	,FestivalDate
	,active
	,Personalised 
	,CreativeType
	,CreatedDate
	,createdby
	,IsDeleted
	,ImageType
)
Select 

@CreativeName
,@Category
,@ImageName
,@ImagePath
,@IsExpiry
,@ExpiryDate
,@FestivalDate
,1
,@Personalised 
,@CreativeType
,Getdate() CreatedDate
,@createdby
,0
,@ImageType
			
select @CreativesId = MAX(Creative_id) from tbl_DigitalLibraryCreatives    
    
 if(@CreativeType = 'Individual')    
 BEGIN    
  Insert into tbl_DigitalLibrarySubbrokerMapping(Creative_id,sub_broker,CreatedDate,CreatedBy)    
  select @CreativesId,*,Getdate() CreatedDate,@createdby  
  FROM  dbo.[fn_Split] (@SbTags, ',')        
 END 
 
	 --Declare @URL varchar(200)
	 --SET @URL = 'DigitalLibrary/GetCreatives?Category=' + @Category

	 Declare @NotificationText varchar(3000)
	 SET @NotificationText = 'A new creative as ' + @CreativeName + ' has been added in Digital Library.'

	if(@CreativeType = 'Individual')    
		BEGIN 
			EXEC [usp_DigitalLibraryNotificationNXTIndivisual] @SbTags, @NotificationText ,'', @Category, 'DigitalLibrary','GetCreatives','Admin','Digital Library Creatives','Category'
		END
	ELSE
		BEGIN 
			EXEC [usp_DigitalLibraryNotificationNXTALL] @NotificationText ,'', @Category, 'DigitalLibrary','GetCreatives','Admin','Digital Library Creatives','Category'
		END

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Add_DigitalLibraryCreative_BeeNXT
-- --------------------------------------------------

 
  
  CREATE procedure [dbo].[Usp_Add_DigitalLibraryCreative_BeeNXT]    
(    
 @Category Varchar(100),    
 @CreativeName Varchar(100),    
 @IsExpiry Varchar(100),    
 @ExpiryDate datetime,    
 @Personalised varchar(100),    
 @ImageName varchar(200),    
 @ImagePath varchar(2000),    
 @ImageType varchar(100),    
 @CreativeType varchar(100),    
 @SbTags VARCHAR(MAX),    
 @createdby varchar(100)    
)    
as    
begin    
Declare @CreativesId int        
insert into tbl_DigitalLibraryCreatives_BeeNXT    
(    
 CreativeName    
 ,Category    
 ,ImageName    
 ,ImagePath    
 ,IsExpiry    
 ,ExpiryDate    
 ,active    
 ,Personalised     
 ,CreativeType    
 ,CreatedDate    
 ,createdby    
 ,IsDeleted    
 ,ImageType    
)    
Select     
    
@CreativeName    
,@Category    
,@ImageName    
,@ImagePath    
,@IsExpiry    
,@ExpiryDate    
,1    
,@Personalised     
,@CreativeType    
,Getdate() CreatedDate    
,@createdby    
,0    
,@ImageType    
       
select @CreativesId = MAX(Creative_id) from tbl_DigitalLibraryCreatives_BeeNXT        
        
 if(@CreativeType = 'Individual')        
 BEGIN        
  Insert into tbl_DigitalLibrarySubbrokerMapping_BeeNXT(Creative_id,sub_broker,CreatedDate,CreatedBy)        
  select @CreativesId,*,Getdate() CreatedDate,@createdby      
  FROM  dbo.[fn_Split] (@SbTags, ',')            
 END     
     
  --Declare @URL varchar(200)    
  --SET @URL = 'DigitalLibrary/GetCreatives?Category=' + @Category    
    
  Declare @NotificationText varchar(3000)    
  SET @NotificationText = 'A new creative as ' + @CreativeName + ' has been added in Digital Library. Click here to view'    
    
 if(@CreativeType = 'Individual')        
  BEGIN     
   EXEC [usp_DigitalLibraryNotificationNXTIndivisual_BeeNXT] @SbTags, @NotificationText ,'', @Category, 'DigitalLibrary','GetCreatives','Admin','Digital Library Creatives','Category'    
  END    
 ELSE    
  BEGIN     
   EXEC [usp_DigitalLibraryNotificationBeeNXTALL] @NotificationText ,'', @Category, 'DigitalLibrary','GetCreatives','Admin','Digital Library Creatives','Category'    
  END    
    
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddDashboardVideo
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AddDashboardVideo]  
(  
 @FileName       VARCHAR(200),  
 @FilePath       VARCHAR(200),  
 @CreatedBy      VARCHAR(100),
 @OrderIndex	 tinyint
)  
AS  
BEGIN  
  
  INSERT INTO DashboardVideoUpload ([FileName], FilePath, CreatedBy, OrderIndex)  
  SELECT @FileName, @FilePath, @CreatedBy, @OrderIndex
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddDocumentUpload
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_AddDocumentUpload]
(
	@CardTypeKey    VARCHAR(150),
	@ContentType    VARCHAR(100),
	@FileName       VARCHAR(2000),
	@FilePath       VARCHAR(200),
	@IsYoutube      BIT,
	@CreatedBy      VARCHAR(100)
)
AS
BEGIN

	IF @IsYoutube = 0
	BEGIN
		INSERT INTO DocumentUpload (MasterId, [FileName], FilePath, CreatedBy)
		SELECT Id, @FileName, @FilePath, @CreatedBy
		FROM DocumentUploadMaster
		WHERE ContentType = @ContentType AND CardTypeKey = @CardTypeKey
	END
	ELSE
	BEGIN
		INSERT INTO DocumentUploadYoutube(MasterId, [FileName], FilePath, CreatedBy)
		SELECT Id, @FileName, @FilePath, @CreatedBy
		FROM DocumentUploadMaster
		WHERE ContentType = @ContentType AND CardTypeKey = @CardTypeKey
	
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddEWelcomeAccessSB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AddEWelcomeAccessSB]  
(      
    @datatable EWelcomeSBTableType READONLY  
)              
AS              
BEGIN          
  
 INSERT INTO [EWelcomeSBAccess](SBTAG, ActiveFrom, ActiveTo, IsActive, CreatedBy, CreatedOn)
 SELECT * from @datatable  
  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddIPOUpload
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AddIPOUpload]  
(  
   
 @ContentType    VARCHAR(50),  
 @FileName       VARCHAR(200),  
 @FilePath       VARCHAR(2000), 
 @ServerFilePath  VARCHAR(500),
 @CreatedBy      VARCHAR(100),
 @IPOSrNo  int
)  
AS  
BEGIN  

  INSERT INTO IPODocumentUpload (ContentType, [FileName], FilePath,ServerFilePath, CreatedBy, IPOSrNo)  values (@ContentType,@FileName,@FilePath,@ServerFilePath,@CreatedBy,@IPOSrNo)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddNocInHouseSB
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_AddNocInHouseSB]
(            
@SBTags VARCHAR(MAX),
@EntryBy VARCHAR(20)
)            
AS            
BEGIN        

  Insert into [NOC_InHouse_SB_Master](subbroker,EntryBy,EntryDate, Active)    
  select *, @EntryBy, GetDate(),1    
  FROM  dbo.[fn_Split] (@SBTags, ',')        
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddOrganicMarketingDoc
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AddOrganicMarketingDoc]  
(  
   
 @ContentType    VARCHAR(50), 
 @ContentName    VARCHAR(100),
 @FileName       VARCHAR(200),  
 @FilePath       VARCHAR(2000), 
 @ServerFilePath  VARCHAR(500),
 @CreatedBy      VARCHAR(100),
 @StartDate      Date,
 @StartTime      Time,
 @ExpiryDate      Date,
 @ExpiryTime      Time
)  
AS  
BEGIN  
  DECLARE @Exists INT
  IF EXISTS(SELECT FileName
                        FROM OrganicMarketingUpload
                        WHERE FileName = @FileName AND IsDeleted is null)
  BEGIN
            SET @Exists = 1
			SELECT @Exists AS Status
  END
  ELSE
  BEGIN
            SET @Exists = 0
  INSERT INTO OrganicMarketingUpload (ContentType,ContentName, [FileName], FilePath,ServerFilePath,CreationDate, CreatedBy,LastUpdate,IsDeleted,DeletedBy,IsActive,OrderIndex,UpdatedBy,StartDate,StartTime,ExpiryDate,ExpiryTime)  
  values (@ContentType,@ContentName,@FileName,@FilePath,@ServerFilePath,getdate(),@CreatedBy,null,null,null,null,null,null,@StartDate,CAST(@StartTime AS TIME),@ExpiryDate,CAST(@ExpiryTime AS TIME))
            SELECT @Exists AS Status
  END
  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddRedirectionUrl
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_AddRedirectionUrl]                  
(                  
 @Modulename VARCHAR(MAX),      
 @URL VARCHAR(MAX) = NULL,      
 @area VARCHAR(MAX) = NULL,      
 @Controller VARCHAR(MAX),      
 @action VARCHAR(MAX) = NULL,  
 @QueryParameter VARCHAR(500) = NULL,  
 @CreatedBy VARCHAR(100)  
)                  
AS                  
BEGIN              
      
  Insert into NotificationNXT_MasterList(Modulename,URL, QueryParameter, area,Controller,[action],Active, CreatedBy)          
  Values (@Modulename, @URL, @QueryParameter, @area, @Controller, @action, 1, @CreatedBy)           
       
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddRightIssuesInHouseSB
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_AddRightIssuesInHouseSB]
(            
	@SBTags VARCHAR(MAX),
	@EntryBy VARCHAR(20)
)            
AS            
BEGIN     

	SELECT * INTO #RightIssues_InHouse_SB_Master_temp FROM dbo.[fn_Split] (@SBTags, ',')

	SELECT StringValue AS SbTag,b.subbroker
	INTO #RightIssues_InHouse_SB_Master_temp1
	from #RightIssues_InHouse_SB_Master_temp a
	LEFT JOIN RightIssues_InHouse_SB_Master b WITH(NOLOCK) ON a.StringValue=b.subbroker
	where ISNULL(b.subbroker,'')=''

	INSERT INTO RightIssues_InHouse_SB_Master(subbroker,EntryBy,EntryDate,Active)
	SELECT SbTag,@EntryBy,GETDATE(),1 FROM #RightIssues_InHouse_SB_Master_temp1 WITH(NOLOCK)

	DROP TABLE #RightIssues_InHouse_SB_Master_temp
	DROP TABLE #RightIssues_InHouse_SB_Master_temp1

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddSBNOCAccess
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_AddSBNOCAccess]            
(            
	@SBTags VARCHAR(MAX),
	@EntryBy VARCHAR(20)
)            
AS            
BEGIN        

  Insert into SB_NOCaccess(username,EntryDate, Active)    --,EntryBy
  select *, GetDate(),1									--, @EntryBy
  FROM  dbo.[fn_Split] (@SBTags, ',')        
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddSbNocRights
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_AddSbNocRights]
(    
    @datatable SBNocRightsTableType READONLY
)            
AS            
BEGIN        

INSERT INTO [SB_NOC_Rights]
SELECT * from @datatable

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddSBTeleBot
-- --------------------------------------------------



CREATE PROCEDURE [dbo].[usp_AddSBTeleBot]  
(  
 @SBTag			VARCHAR(100),  
 @DaTag			VARCHAR(100),  
 @APIKey		VARCHAR(100),  
 @CreatedBy     VARCHAR(100)  
)  
AS  
BEGIN  
  
  if exists(select 1 from SB_TeleBot_Reg WHERE SBTag = @SBTag)
  BEGIN
	  UPDATE SB_TeleBot_Reg 
	  set SBTag =@SBTag,
	  DATag = @DaTag, 
	  APIKey = @APIKey, 
	  CreatedBy = @CreatedBy, 
	  IsActive = 1  
	  where SBTag = @SBTag
  END
  else
   BEGIN
	  INSERT INTO SB_TeleBot_Reg (SBTag, DATag, APIKey, CreatedBy, IsActive)  
	  SELECT @SBTag, @DaTag, @APIKey, @CreatedBy, 1  
  END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddSubBrokerMobileForceUpdate
-- --------------------------------------------------
CREATE procedure [dbo].[usp_AddSubBrokerMobileForceUpdate]  
(  
@sub_broker varchar(100),
@VersionCode varchar(100),  
@Plateform varchar(100),  
@CurrentVersion varchar(100),  
@IsForceUpdate varchar(100)
)  
as  
begin  

 If NOT EXISTS (SELECT 1 FROM ForceUpdate_NXT_Mob WHERE sub_broker = @sub_broker)        
	BEGIN
Insert into ForceUpdate_NXT_Mob  
(  
		 sub_broker  
		,VersionCode  
		,Plateform  
		,CurrentVersion  
		,IsForceUpdate  
		,ForceUpdate  
		,CreatedDate  		
)  
Select  
		 @sub_broker  
		,@VersionCode  
		,@Plateform  
		,@CurrentVersion  
		,@IsForceUpdate  
		,NULL
		,GETDATE() 
		END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddUtilityMenu
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AddUtilityMenu]          
(          
 @Name varchar(100),  
 @Controller varchar(100),  
 @Action varchar(100),  
 @CreatedBy varchar(100),
 @ParentId INT = NULL,
 @IsAccessRequired BIT
)          
AS          
BEGIN      
               
 INSERT INTO Menu(Name, Controller, Action, ParentId, IsAccessRequired, Active, Createdby, CreatedDate)      
 SELECT @Name, @Controller, @Action, @ParentId, @IsAccessRequired, 1, @CreatedBy, GETDATE()       
   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddUtilityUserMenu
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AddUtilityUserMenu]          
(          
 @UserId int,  
 @MenuId int,  
 @CreatedBy varchar(100)       
)          
AS          
BEGIN      
   If NOT EXISTS (SELECT 1 FROM UserMenuAccess WHERE UserId = @UserId and MenuId = @MenuId)        
	BEGIN
		INSERT INTO UserMenuAccess (UserId, MenuId, Active, Createdby, CreatedDate)        
		SELECT @UserId, @MenuId, 1, @CreatedBy, GETDATE()       
   END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AddVoucherEntryAccess
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_AddVoucherEntryAccess]            
(            
	@SBTags VARCHAR(MAX),
	@EntryBy VARCHAR(20)
)            
AS            
BEGIN        

  Insert into tbl_SBAccess(SBTAG,CreatedBy,CreatedOn)   
  select *,@EntryBy, GetDate()						
  FROM  dbo.[fn_Split] (@SBTags, ',')        
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_ALG_EXP_MAST
-- --------------------------------------------------


CREATE procedure [dbo].[usp_AMD_ALG_EXP_MAST]
as
begin

--insert into [ALG_EXP_MAST]
--([ENTITY_CODE] ,
--	[Intraday_Type] ,
--	[CRTDT] ,
--	[MDYDT] 
--)
--select 
--[ENTITY_CODE] ,
--	[Intraday_Type] ,
--	[CRTDT] ,
--	[MDYDT] 
--	from [196.1.115.182].General.dbo.alg_exp_mast AM WITH(NOLOCK)

Update A 
Set [Intraday_Type] =AM.[Intraday_Type]
From [ALG_EXP_MAST] A
Inner join [196.1.115.182].General.dbo.alg_exp_mast AM WITH(NOLOCK)
ON AM.[ENTITY_CODE]=A.[ENTITY_CODE]
WHERE AM.[MDYDT]>getdate()-1

insert into ALG_EXP_MAST
select 
AM.[ENTITY_CODE] ,
AM.[Intraday_Type] ,
AM.[CRTDT] ,
AM.[MDYDT] 
 from [196.1.115.182].General.dbo.alg_exp_mast AM WITH(NOLOCK)
left join [ALG_EXP_MAST] B WITH(NOLOCK) ON AM.[ENTITY_CODE]=B.[ENTITY_CODE]
where B.[ENTITY_CODE] is null
and  AM.[MDYDT]>getdate()-1



end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_ANAND1MSAJAGClient_Brok_Details
-- --------------------------------------------------

CREATE procedure usp_amd_ANAND1MSAJAGClient_Brok_Details
as
begin

truncate table ANAND1MSAJAGClient_Brok_Details

insert into ANAND1MSAJAGClient_Brok_Details
select  cl_code,Deactive_value from  [172.31.25.94].ReplicatedData.dbo.ANAND1MSAJAGClient_Brok_Details WITH(NOLOCK)  

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT]
AS
BEGIN

INSERT INTO tbl_NotificationBeeNXT
(
sub_broker
,NotificationText
,NotificationType
,Individualview
,IndividualviewDate
,Notification_9
,Notification_Date_9
,CreatedBy
,CreatedDate
,UpdatedBy
,UpdatedDate
,CLTCODEDupl
,url
,area
,controller
,action
,CampaignId
,areaname

)
SELECT 
DISTINCT 
[SB Equity Tag]
,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
,''
,''
,''
,''
,''
,''

  FROM [196.1.115.253].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where ([Validity To]=convert(date,dateadd(dd,31,getdate()))
	Or [Validity To]=convert(date,dateadd(dd,21,getdate()))
	or [Validity To]=convert(date,dateadd(dd,14,getdate()))
	or [Validity To]=convert(date,dateadd(dd,07,getdate()))
	)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT_1_2Month
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT_1_2Month]
AS
BEGIN

INSERT INTO tbl_NotificationBeeNXT
(
sub_broker
,NotificationText
,NotificationType
,Individualview
,IndividualviewDate
,Notification_9
,Notification_Date_9
,CreatedBy
,CreatedDate
,UpdatedBy
,UpdatedDate
,CLTCODEDupl
,url
,area
,controller
,action
,CampaignId
,areaname


)
SELECT 
DISTINCT 
[SB Equity Tag]
,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
,''
,''
,''
,''
,''
,''
  FROM [196.1.115.253].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where (
	[Validity To]>=convert(date,dateadd(dd,-30,getdate()))  and [Validity To]<=convert(date,dateadd(dd,60,getdate())))

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT_1Month
-- --------------------------------------------------

--select * from tbl_NotificationBeeNXT
--order by CreatedDate desc
--where NotificationType like '%click%'


--<a href="url">Click here</a>

CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT_1Month]
AS
BEGIN

INSERT INTO tbl_NotificationBeeNXT
(
	 sub_broker
	,NotificationText
	,NotificationType
	,Individualview
	,IndividualviewDate
	,Notification_9
	,Notification_Date_9
	,CreatedBy
	,CreatedDate
	,UpdatedBy
	,UpdatedDate
	,CLTCODEDupl
	,url
	,area
	,controller
	,action

)
SELECT 
DISTINCT 
[SB Equity Tag]
--,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'The validity of the ARN & EUIN which are expiring during the period March 15, 2020 to June 29, 2020, will  stand extended till June 30, 2020, <a href="ARN.jpg" target="_blank"><span style="color:blue;cursor:pointer">Click here</span> to download.</a>'
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
,'','','',''
  FROM [196.1.115.253].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where (
	[Validity To]>=convert(date,getdate())  and [Validity To]<=convert(date,dateadd(dd,30,getdate())))

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT_2_3Month
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT_2_3Month]
AS
BEGIN


INSERT INTO tbl_NotificationBeeNXT
(
	 sub_broker
	,NotificationText
	,NotificationType
	,Individualview
	,IndividualviewDate
	,Notification_9
	,Notification_Date_9
	,CreatedBy
	,CreatedDate
	,UpdatedBy
	,UpdatedDate
	,CLTCODEDupl
	,url
	,area
	,controller
	,action

)

SELECT 
DISTINCT 
[SB Equity Tag]
--,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'The validity of the ARN & EUIN which are expiring during the period March 15, 2020 to June 29, 2020, will  stand extended till June 30, 2020, <a href="ARN.jpg" target="_blank"><span style="color:blue;cursor:pointer">Click here</span> to download.</a>'
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
,'','','',''
  FROM [196.1.115.253].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where (
	[Validity To]>=convert(date,dateadd(dd,30,getdate()))  and [Validity To]<=convert(date,dateadd(dd,90,getdate())))

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT_2Month
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT_2Month]
AS
BEGIN

INSERT INTO tbl_NotificationBeeNXT
SELECT 
DISTINCT 
[SB Equity Tag]
,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
,'','','','','',''

  FROM [196.1.115.253].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where (
	[Validity To]>=convert(date,getdate())  and [Validity To]<=convert(date,dateadd(dd,60,getdate())))

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT_3Month
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT_3Month]
AS
BEGIN

INSERT INTO tbl_NotificationBeeNXT
(
sub_broker
,NotificationText
,NotificationType
,Individualview
,IndividualviewDate
,Notification_9
,Notification_Date_9
,CreatedBy
,CreatedDate
,UpdatedBy
,UpdatedDate
,CLTCODEDupl
,url
,area
,controller
,action
,CampaignId
,areaname
)
SELECT 
DISTINCT 
[SB Equity Tag]
,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
,'','','','','',''

  FROM [196.1.115.253].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where (
	[Validity To]>=convert(date,getdate())  and [Validity To]<=convert(date,dateadd(dd,90,getdate())))

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Arn_Notification_BeeNXT_Bkp06Nov2019
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AMD_Arn_Notification_BeeNXT_Bkp06Nov2019]
AS
BEGIN

INSERT INTO tbl_NotificationBeeNXT
SELECT 
DISTINCT 
[SB Equity Tag]
,'Please be notified that your <b>ARN is valid upto ' +convert(varchar(30),convert(date,[Validity To]),106) +'.</b> Please submit new ARN asap' NotificationText
,'ARN' NotificationType
,'Y' Individualview
,Getdate() IndividualviewDate
,'Y' Notification_9
,Getdate() Notification_Date_9
,'Admin' CreatedBy
,Getdate() CreatedDate
,'' UpdatedBy
,'' UpdatedDate
,''
  FROM [196.1.115.132].[MUTUALFUND].[dbo].[tblArnEuinMaster]
  --WHERE [Validity To]='2021-01-15'
    where ([Validity To]=convert(date,dateadd(dd,31,getdate()))
	Or [Validity To]=convert(date,dateadd(dd,21,getdate()))
	or [Validity To]=convert(date,dateadd(dd,14,getdate()))
	or [Validity To]=convert(date,dateadd(dd,07,getdate()))
	)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_B2B_Bulk_DealerMapping
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_B2B_Bulk_DealerMapping]
AS
BEGIN

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE B2B_Bulk_DealerMapping_Prev

INSERT INTO B2B_Bulk_DealerMapping_Prev
SELECT distinct [Party_Code],[Dealer1] FROM B2B_Bulk_DealerMapping WITH (NOLOCK)
		
DROP SYNONYM B2B_Bulk_DealerMapping_syn

CREATE SYNONYM B2B_Bulk_DealerMapping_syn for B2B_Bulk_DealerMapping_Prev


--------------------------Original Table Insert------------------

TRUNCATE TABLE B2B_Bulk_DealerMapping
-----------------------------------------------------------------

INSERT INTO B2B_Bulk_DealerMapping
--SELECT distinct [Party_Code],[Dealer1] FROM [196.1.115.132].[Mimansa].[dbo].[B2B_Bulk_DealerMapping] WITH (NOLOCK)
SELECT distinct [Party_Code],Emp_No FROM [196.1.115.132].[Mimansa].[dbo].Vw_B2B_CurrentClientDealerMapping WITH (NOLOCK)

DROP SYNONYM B2B_Bulk_DealerMapping_syn

CREATE SYNONYM B2B_Bulk_DealerMapping_syn for B2B_Bulk_DealerMapping

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_bbo_fa_PARAMETER
-- --------------------------------------------------

CREATE procedure [dbo].[usp_amd_bbo_fa_PARAMETER]
as
begin
set nocount on 
Truncate table bbo_fa_PARAMETER

insert into bbo_fa_PARAMETER
select * from [AngelFO].bbo_fa.dbo.PARAMETER WITH (NOLOCK)

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_BO_MTFFinal
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_BO_MTFFinal]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#BO_MTFFinal') IS NOT NULL
			DROP TABLE #BO_MTFFinal
			
		
		select T.party_code,sum(FUDEDVAL) FUDEDVAL,T.Max_ORDERBYDATE FundValDate 
		into #BO_MTFFinal
		from 
		(
			select party_code,max(ORDERBYDATE) Max_ORDERBYDATE
			from 
				[196.1.115.182].[General].dbo.BO_MTFFinal MTF with (nolock)
			--[196.1.115.196].MSAJAG.dbo.TBL_COMBINE_REPORTING_DETAIL with (nolock)
				--PARTY_CODE='rp61'
			group by party_code
		) t inner join [196.1.115.182].[General].dbo.BO_MTFFinal M with (nolock)
		on M.ORDERBYDATE=T.Max_ORDERBYDATE
			and T.party_code=M.party_code
		group by t.party_code,t.Max_ORDERBYDATE
		
				--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE BO_MTFFinal_Prev

		INSERT INTO BO_MTFFinal_Prev( party_code,FUDEDVAL,FundValDate )
		SELECT party_code,FUDEDVAL,FundValDate  FROM BO_MTFFinal WITH (NOLOCK)
		
		DROP SYNONYM BO_MTFFinal_syn

		CREATE SYNONYM BO_MTFFinal_syn for BO_MTFFinal_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE BO_MTFFinal

		INSERT INTO BO_MTFFinal( party_code,FUDEDVAL,FundValDate )
		SELECT	party_code,FUDEDVAL,FundValDate  FROM #BO_MTFFinal

		DROP SYNONYM BO_MTFFinal_syn

		CREATE SYNONYM BO_MTFFinal_syn for BO_MTFFinal

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_amd_bse_sett_mst
-- --------------------------------------------------

Create procedure [dbo].[Usp_amd_bse_sett_mst]
as
begin

truncate table bse_sett_mst

insert into bse_sett_mst
select * from [196.1.115.182].general.dbo.bse_sett_mst with (nolock)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_CLI_ACCCHARGES
-- --------------------------------------------------



CREATE procedure [dbo].[usp_AMD_CLI_ACCCHARGES]
as
begin

--Party_Code
--Charges_Code
--Charges_amt



Update A 
Set 
	Charges_Code=A.Charges_Code
	,Charges_amt=B.Charges_amt
From [CLI_ACCCHARGES] A
Inner join [196.1.115.132].MISC.DBO.CLI_ACCCHARGES B WITH (NOLOCK)  
ON A.Party_Code=A.Party_Code
WHERE A.Updated_on>getdate()-1

insert into CLI_ACCCHARGES
(
	Charges_Date
	,Party_Code
	,Charges_Code
	,Charges_amt
	,JV_Posted
	,Updated_on

)
select 
	A.*
FROM [196.1.115.132].MISC.DBO.CLI_ACCCHARGES A WITH (NOLOCK)  
LEFT JOIN [CLI_ACCCHARGES] B WITH(NOLOCK) ON A.Party_Code=B.Party_Code
where B.Party_Code is null
and  A.Updated_on>getdate()-1



end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_CLI_ACCCHARGES_New
-- --------------------------------------------------


Create  PROCEDURE [dbo].[USP_AMD_CLI_ACCCHARGES_New]
as
BEGIn


	IF OBJECT_ID('TEMPDB..#CLI_ACCCHARGES') IS NOT NULL
			DROP TABLE #CLI_ACCCHARGES


		SELECT	
				Charges_Date,Party_Code,Charges_Code,Charges_amt,JV_Posted,Updated_on
		INTO #CLI_ACCCHARGES
		FROM [196.1.115.132].MISC.DBO.CLI_ACCCHARGES h WITH(NOLOCK)


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE CLI_ACCCHARGES_Prev

		INSERT INTO CLI_ACCCHARGES_Prev
				(
						Charges_Date,Party_Code,Charges_Code,Charges_amt,JV_Posted,Updated_on				
				)
		SELECT  
							Charges_Date,Party_Code,Charges_Code,Charges_amt,JV_Posted,Updated_on
		FROM CLI_ACCCHARGES_New WITH (NOLOCK)
		
		DROP SYNONYM CLI_ACCCHARGES_Syn

		CREATE SYNONYM CLI_ACCCHARGES_Syn for CLI_ACCCHARGES_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE CLI_ACCCHARGES_New

		
			INSERT INTO CLI_ACCCHARGES_New
			(
		
					Charges_Date,Party_Code,Charges_Code,Charges_amt,JV_Posted,Updated_on
			)

		SELECT	* FROM #CLI_ACCCHARGES

		DROP SYNONYM CLI_ACCCHARGES_Syn

		CREATE SYNONYM CLI_ACCCHARGES_Syn for CLI_ACCCHARGES_New



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_CLI_ACCCHARGES_Truncate
-- --------------------------------------------------
CREATE procedure [dbo].[usp_AMD_CLI_ACCCHARGES_Truncate]
as
begin

begin tran
begin try


CREATE TABLE #CLI_ACCCHARGES
(
	[Charges_Date] [datetime] NULL,
	[Party_Code] [varchar](10) NULL,
	[Charges_Code] [int] NULL,
	[Charges_amt] [money] NULL,
	[JV_Posted] [varchar](1) NULL,
	[Updated_on] [datetime] NULL
)

insert into #CLI_ACCCHARGES
select * from [196.1.115.132].MISC.DBO.CLI_ACCCHARGES B WITH (NOLOCK)  

truncate table [CLI_ACCCHARGES]

insert into [CLI_ACCCHARGES] 
select * from #CLI_ACCCHARGES

truncate table #CLI_ACCCHARGES

commit 

end try
begin catch
		rollback
end catch



end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_CLI_ACCCHARGESMASTER
-- --------------------------------------------------

CREATE procedure [dbo].[usp_AMD_CLI_ACCCHARGESMASTER]
as
Begin
--Truncate table CLI_ACCCHARGES 

Declare @MaxDate DATETIME

select @MaxDate=max(Updated_on) from CLI_ACCCHARGES A WITH (NOLOCK)      



insert into CLI_ACCCHARGES 
select * from [196.1.115.132].MISC.DBO.CLI_ACCCHARGES A WITH (NOLOCK)      
where updated_on >@MaxDate                    

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_client_brok_details
-- --------------------------------------------------

CREATE procedure [dbo].[usp_amd_client_brok_details]
as
begin




--DROP TABLE #Temp

IF OBJECT_ID('tempdb..#Temp') IS NOT NULL
    DROP TABLE #Temp


select * 
into #Temp
from 
(
		select cl_code,(flag) from 
		(
				SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag
				--into #Temp

				FROM 
				  [AngelNseCM].MSAJAG.dbo.client_brok_details WITH (nolock)
		) T
		group by cl_code,flag
) T1 where flag='N'


Update client_brok_details
Set IS_CLOSED=B.flag
From client_brok_details A
inner join 
(
		SELECT isnull(Flag,Flag1) Flag,
			  cl_code	,Modifiedon	,rn
		FROM 
		(
		SELECT A.cl_code,B.Flag,case when A.Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag1,A.Modifiedon 
		,row_number() over (partition by A.cl_code order by Modifiedon desc) rn
		FROM 
		  [AngelNseCM].MSAJAG.dbo.client_brok_details A WITH (nolock)
		  left join #Temp B on A.cl_code=B.cl_code
		  where Modifiedon>getdate()-1
		 ) T where T.rn=1
 ) B ON A.cl_code=B.cl_code



 
insert into client_brok_details
(
	cl_code
	,IS_CLOSED

)
select 
	cl_code
	,isnull(flag,IS_CLOSED) IS_CLOSED 
from 
(
		select distinct 
			A.cl_code
			,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end IS_CLOSED
			,C.Flag
		 from   [AngelNseCM].MSAJAG.dbo.client_brok_details A  WITH (nolock)
		left join client_brok_details B WITH(NOLOCK) ON A.cl_code=B.cl_code
		left join #Temp C on C.cl_code=B.cl_code
		where B.cl_code is null
		and  A.[Trd_Eff_Dt]>getdate()-1
) T



/*

Update client_brok_details
Set IS_CLOSED=B.flag
From client_brok_details A
inner join 
(
SELECT * FROM 
(
SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag,Modifiedon 
,row_number() over (partition by cl_code order by Modifiedon desc) rn
FROM 
  [196.1.115.196].MSAJAG.dbo.client_brok_details WITH (nolock)
  --where cl_code='pt77'
   where Modifiedon>getdate()-1
 ) T where T.rn=1
 ) B ON A.cl_code=B.cl_code

insert into client_brok_details
(
	cl_code
	,IS_CLOSED

)
select distinct 
	A.cl_code
	,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end IS_CLOSED
 from   [196.1.115.196].MSAJAG.dbo.client_brok_details A  WITH (nolock)
left join client_brok_details B WITH(NOLOCK) ON A.cl_code=B.cl_code
where B.cl_code is null
and  A.[Trd_Eff_Dt]>getdate()-1
*/





 END

 ----------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_client_brok_details_Bkp21Feb2019
-- --------------------------------------------------

Create procedure [dbo].[usp_amd_client_brok_details_Bkp21Feb2019]
as
begin




Update client_brok_details
Set IS_CLOSED=B.flag
From client_brok_details A
inner join 
(
SELECT * FROM 
(
SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag,Modifiedon 
,row_number() over (partition by cl_code order by Modifiedon desc) rn
FROM 
  [196.1.115.196].MSAJAG.dbo.client_brok_details WITH (nolock)
  --where cl_code='pt77'
   where Modifiedon>getdate()-1
 ) T where T.rn=1
 ) B ON A.cl_code=B.cl_code

insert into client_brok_details
(
	cl_code
	,IS_CLOSED

)
select distinct 
	A.cl_code
	,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end IS_CLOSED
 from   [196.1.115.196].MSAJAG.dbo.client_brok_details A  WITH (nolock)
left join client_brok_details B WITH(NOLOCK) ON A.cl_code=B.cl_code
where B.cl_code is null
and  A.[Trd_Eff_Dt]>getdate()-1





 END

 ----------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_client_brok_details_Release21Feb2019
-- --------------------------------------------------

CREATE  procedure [dbo].[usp_amd_client_brok_details_Release21Feb2019]
as
begin




--DROP TABLE #Temp

IF OBJECT_ID('tempdb..#Temp') IS NOT NULL
    DROP TABLE #Temp


select * 
into #Temp
from 
(
		select cl_code,(flag) from 
		(
				SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag
				--into #Temp

				FROM 
				  [196.1.115.196].MSAJAG.dbo.client_brok_details WITH (nolock)
		) T
		group by cl_code,flag
) T1 where flag='N'


Update client_brok_details
Set IS_CLOSED=B.flag
From client_brok_details A
inner join 
(
		SELECT isnull(Flag,Flag1) Flag,
			  cl_code	,Modifiedon	,rn
		FROM 
		(
		SELECT A.cl_code,B.Flag,case when A.Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag1,A.Modifiedon 
		,row_number() over (partition by A.cl_code order by Modifiedon desc) rn
		FROM 
		  [196.1.115.196].MSAJAG.dbo.client_brok_details A WITH (nolock)
		  left join #Temp B on A.cl_code=B.cl_code
		  where Modifiedon>getdate()-1
		 ) T where T.rn=1
 ) B ON A.cl_code=B.cl_code



 
insert into client_brok_details
(
	cl_code
	,IS_CLOSED

)
select 
	cl_code
	,isnull(flag,IS_CLOSED) IS_CLOSED 
from 
(
		select distinct 
			A.cl_code
			,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end IS_CLOSED
			,C.Flag
		 from   [196.1.115.196].MSAJAG.dbo.client_brok_details A  WITH (nolock)
		left join client_brok_details B WITH(NOLOCK) ON A.cl_code=B.cl_code
		left join #Temp C on C.cl_code=B.cl_code
		where B.cl_code is null
		and  A.[Trd_Eff_Dt]>getdate()-1
) T



/*

Update client_brok_details
Set IS_CLOSED=B.flag
From client_brok_details A
inner join 
(
SELECT * FROM 
(
SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag,Modifiedon 
,row_number() over (partition by cl_code order by Modifiedon desc) rn
FROM 
  [196.1.115.196].MSAJAG.dbo.client_brok_details WITH (nolock)
  --where cl_code='pt77'
   where Modifiedon>getdate()-1
 ) T where T.rn=1
 ) B ON A.cl_code=B.cl_code

insert into client_brok_details
(
	cl_code
	,IS_CLOSED

)
select distinct 
	A.cl_code
	,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end IS_CLOSED
 from   [196.1.115.196].MSAJAG.dbo.client_brok_details A  WITH (nolock)
left join client_brok_details B WITH(NOLOCK) ON A.cl_code=B.cl_code
where B.cl_code is null
and  A.[Trd_Eff_Dt]>getdate()-1
*/





 END

 ----------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_client_brok_details_Trun
-- --------------------------------------------------



CREATE PROCEDURE [dbo].[usp_AMD_client_brok_details_Trun]
AS
BEGIN
--begin tran
--begin try

Create table #client_brok_details
(
cl_code varchar(50),
Deactive_value varchar(10),
Modifiedon datetime
)

insert into #client_brok_details(cl_code,Deactive_value,Modifiedon)
select cl_code,Deactive_value,Modifiedon from [AngelNseCM].MSAJAG.dbo.client_brok_details WITH (nolock)

truncate table client_brok_details


IF OBJECT_ID('tempdb..#Temp') IS NOT NULL
    DROP TABLE #Temp


select * 
into #Temp
from 
(
		select cl_code,(flag) from 
		(
				SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag
				--into #Temp

				FROM 
				 #client_brok_details
		) T
		group by cl_code,flag
) T1 where flag='N'

--select * from #Temp where cl_code='NH77'


insert into client_brok_details
SELECT cl_code	,isnull(Flag,Flag1) Flag
--,  cl_code	,Modifiedon	,rn
FROM 
(
SELECT A.cl_code,B.Flag,case when A.Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag1,A.Modifiedon 
,row_number() over (partition by A.cl_code order by Modifiedon desc) rn
FROM 
 #client_brok_details a
  left join #Temp B on A.cl_code=B.cl_code
  --where cl_code='NH77'
   --where Modifiedon>getdate()-1
 ) T where T.rn=1






/*
insert into client_brok_details
SELECT cl_code	,Flag 
FROM 
(
	SELECT cl_code,case when Deactive_value in ('C','T') THEN 'Y' ELSE 'N' end Flag,Modifiedon 
	,row_number() over (partition by cl_code order by Modifiedon desc) rn
	FROM 
	  #client_brok_details
	  --where cl_code='pt77'
) T where T.rn=1

*/

----commit 

--end try
--begin catch
--		rollback
--end catch



Drop table #client_brok_details
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_CLIENT_MASTER
-- --------------------------------------------------

CREATE   procedure [dbo].[USP_AMD_CLIENT_MASTER]
as
begin 


Truncate table TBL_CLIENT_MASTER

INSERT INTO TBL_CLIENT_MASTER(CLIENT_CODE,FIRST_HOLD_NAME,NISE_PARTY_CODE,InsertedOn)
select 
	CLIENT_CODE,FIRST_HOLD_NAME,NISE_PARTY_CODE ,GETDATE()
from [172.31.16.108].inhouse.dbo.TBL_CLIENT_MASTER WITH(NOLOCK) 


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_ClientBrokerage_07032018
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_AMD_ClientBrokerage_07032018]
(
	@Sauda_Date DATE = NULL
)
AS
	--EXEC Usp_AMD_ClientBrokerage @Sauda_Date ='2018-02-19'
BEGIN
	
	SET NOCOUNT ON 
	IF(@Sauda_Date IS NULL)
	BEGIN
		SET @Sauda_Date = (SELECT MAX(Sauda_Date) FROM tbl_ClientBrokerageDetails WITH (NOLOCK))
		SELECT @Sauda_Date
	END

		DELETE FROM tbl_ClientBrokerageDetails
		WHERE CAST(Sauda_Date AS DATE) >= @Sauda_Date
				
	INSERT INTO tbl_ClientBrokerageDetails(Party_Code,Client_Name,Sub_Broker,Segment,Sauda_Date,Branch,Sub_Remi_Code,GrossBrokerage,NettoSB,NetBrok,Remi_Share,Fran_Share,Fran_Percent)
	SELECT Party_Code, Client_Name,subbrokcode AS Sub_Broker,Segment,Sauda_Date,Branch,Sub_Remi_Code,Brok_earned AS GrossBrokerage,Remi_Share AS NettoSB,Angel_share AS NetBrok,Sub_remi_share,Fran_Share,Fran_Percent
	FROM [196.1.115.167].remisior.dbo.brok_Ipartner WITH (NOLOCK) 
	WHERE CAST(Sauda_date AS DATE) > @Sauda_Date--'2017-04-01'

	SET NOCOUNT OFF
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_ClientLedgerBalance_IPartner
-- --------------------------------------------------

CREATE  PROCEDURE [dbo].[Usp_AMD_ClientLedgerBalance_IPartner]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#ClientLedgerBalance_IPartner') IS NOT NULL
			DROP TABLE #ClientLedgerBalance_IPartner


		SELECT	SubBroker,Party_Code,Ledger
		INTO #ClientLedgerBalance_IPartner
		FROM [196.1.115.182].General.dbo.vw_ClientLedgerBalance_IPartner WITH (NOLOCK)
		


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE ClientLedgerBalance_IPartner_Prev

		INSERT INTO ClientLedgerBalance_IPartner_Prev
		SELECT * FROM ClientLedgerBalance_IPartner WITH (NOLOCK)
		
		DROP SYNONYM ClientLedgerBalance_IPartner_syn

		CREATE SYNONYM ClientLedgerBalance_IPartner_syn for ClientLedgerBalance_IPartner_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE ClientLedgerBalance_IPartner

		INSERT INTO ClientLedgerBalance_IPartner( SubBroker,Party_Code,Ledger)
		SELECT	* FROM #ClientLedgerBalance_IPartner

		DROP SYNONYM ClientLedgerBalance_IPartner_syn

		CREATE SYNONYM ClientLedgerBalance_IPartner_syn for ClientLedgerBalance_IPartner

		/*
		----Same table craeted on 42 
		EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.vw_Dashboard_sbrisk'
		
		INSERT INTO [172.31.16.42].[IPartner].Dbo.vw_Dashboard_sbrisk 
		(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		 FROM vw_Dashboard_sbrisk
		 */
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_CRMS_MF_ARQ_Recommendations
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_CRMS_MF_ARQ_Recommendations]
AS
BEGIN				
	BEGIN Try 	
	BEGIN TRANSACTION
		TRUNCATE TABLE tbl_CRMS_MF_ARQ_Recommendations

		INSERT INTO tbl_CRMS_MF_ARQ_Recommendations
			
		Select distinct C.Party_code, AC.Sub_Broker, MF.Header, MF.SchemeName, C.RecommendationSendOn,mf.GrowthISIN
		from [196.1.115.207].crm.dbo.tbl_CRMS_MF_ARQ_Recommender_ProcessedClients C with(nolock),
		[196.1.115.207].crm.dbo.arq_mfssRecommendedScheme_MimansaLog MF with(nolock),
		[196.1.115.207].angelcs.dbo.angelClient1 AC with(nolock)
		where MF.flag ='A'
		and C.MF_ARQ_Recommendation = MF.Header
		and MF.LogDate >= convert(varchar(11),getdate()-30,109)
		and MF.LogDate <= convert(varchar(11),getdate(),109) + ' 23:59'
		and Cast(MF.LogDate as date) =  Cast(C.RecommendationSendOn as date)
		and C.party_code = AC.Party_Code
		and AC.B2C = 'N'
		order by C.Party_code, MF.Header, C.RecommendationSendOn, MF.SchemeName

		
		COMMIT TRANSACTION;

		--below code added by ruchi on 08/03/2018
		--exec [172.31.16.42].Ipartner.DBO.Usp_AMD_CRMS_MF_ARQ_Recommendations

	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION
		DECLARE @Error_Message varchar(max) = ERROR_MESSAGE()

		IF @Error_Message IS NOT NULL
			RAISERROR(@Error_Message, 16, 1)
		ELSE
			RAISERROR(1, 1, 1)
	END CATCH;
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_CRMS_MF_ARQ_Recommendations_08032018
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_CRMS_MF_ARQ_Recommendations_08032018]
AS
BEGIN				
	TRUNCATE TABLE tbl_CRMS_MF_ARQ_Recommendations

	INSERT INTO tbl_CRMS_MF_ARQ_Recommendations
			
	Select distinct C.Party_code, AC.Sub_Broker, MF.Header, MF.SchemeName, C.RecommendationSendOn,mf.GrowthISIN
	from [196.1.115.207].crm.dbo.tbl_CRMS_MF_ARQ_Recommender_ProcessedClients C with(nolock),
	[196.1.115.207].crm.dbo.arq_mfssRecommendedScheme_MimansaLog MF with(nolock),
	[196.1.115.207].angelcs.dbo.angelClient1 AC with(nolock)
	where MF.flag ='A'
	and C.MF_ARQ_Recommendation = MF.Header
	and MF.LogDate >= convert(varchar(11),getdate()-30,109)
	and MF.LogDate <= convert(varchar(11),getdate(),109) + ' 23:59'
	and Cast(MF.LogDate as date) =  Cast(C.RecommendationSendOn as date)
	and C.party_code = AC.Party_Code
	and AC.B2C = 'N'
	order by C.Party_code, MF.Header, C.RecommendationSendOn, MF.SchemeName
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_feed_mfisin_all
-- --------------------------------------------------
create procedure usp_amd_feed_mfisin_all
AS
BEGIN
		truncate table feed_mfisin_all
		insert into feed_mfisin_all (mf_schcode,ISIN)
		select mf_schcode,ISIN
		from [196.1.115.232].[FSS_MF].[dbo].[FEED_MFISIN_ALL] with (nolock)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_GetArqClientsData_Trans_V3
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_GetArqClientsData_Trans_V3]
AS
BEGIN

TRUNCATE TABLE GetArqClientsData_Trans_V3

INSERT INTO GetArqClientsData_Trans_V3
(Mode,Exchangesegment,Party_code,Sauda_date,Isin,PqtyDel,SaleSauda_date,SqtyDel,PBrokDel,SBrokDel,CF,Scrip_Name,Scrip_cd,Price
,PrevClose,RecordType,IsCA)
Select Mode,Exchangesegment,Party_code,Sauda_date,Isin,PqtyDel,SaleSauda_date,SqtyDel,PBrokDel,SBrokDel,CF,Scrip_Name,Scrip_cd,Price
,PrevClose,RecordType,IsCA from [172.31.16.75].ANGEL_WMS.DBO.GetArqClientsData_Trans_V3 with(nolock)

--EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.GetArqClientsData_Trans_V3'
		
--INSERT INTO [172.31.16.42].[IPartner].Dbo.GetArqClientsData_Trans_V3 
--(Mode,Exchangesegment,Party_code,Sauda_date,Isin,PqtyDel,SaleSauda_date,SqtyDel,PBrokDel,SBrokDel,CF,Scrip_Name,Scrip_cd,Price
--,PrevClose,RecordType,IsCA)
--Select Mode,Exchangesegment,Party_code,Sauda_date,Isin,PqtyDel,SaleSauda_date,SqtyDel,PBrokDel,SBrokDel,CF,Scrip_Name,Scrip_cd,Price
--,PrevClose,RecordType,IsCA from GetArqClientsData_Trans_V3 with(nolock)


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_GetSBRegStatus	_TobeDrop
-- --------------------------------------------------
create procedure usp_amd_GetSBRegStatus
as
begin

truncate table GetSBRegStatus

insert into GetSBRegStatus
(
		[regtag] 
      ,[regtradeName] 
      ,[TagGeneratedDate] 
      ,[BSECM_remi]  
      ,[BSECM_SB]  
      ,[NSECM]  
      ,[NSEFO]  
      ,[MCX] 
      ,[NCDEX] 
      ,[MCD] 
      ,[NSX] 
      ,[MF] 

)
select 
	[regtag] 
      ,[regtradeName] 
      ,[TagGeneratedDate] 
      ,[BSECM_remi]  
      ,[BSECM_SB]  
      ,[NSECM]  
      ,[NSEFO]  
      ,[MCX] 
      ,[NCDEX] 
      ,[MCD] 
      ,[NSX] 
      ,[MF] 
 from [196.1.115.167].remisior.dbo.GetSBRegStatus WITH(NOLOCK)


end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting]
AS
BEGIN
declare @StDate datetime,@EdDate Datetime , @SOM DATETIME=NULL, @StartOfFinDate DATETIME

SET @StDate  = DATEADD(YEAR,-1,GETDATE())
SET	@EdDate  = GETDATE()
DECLARE @Month INT
SELECT @Month =DATEDIFF(M,@StDate,@EdDate)

Declare @Startofmonth Datetime 
select @Startofmonth=max(Startofmonth) from [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_partyinfobrokmonthwise pr with (NOLOCK)

--------------------------Prev Table Insert------------------
		
delete from  iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev where Startofmonth=@Startofmonth

INSERT INTO iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev
SELECT * FROM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting WITH (NOLOCK)  where Startofmonth=@Startofmonth
		
DROP SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn

CREATE SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn for iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev


--------------------------Original Table Insert------------------

delete from iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting where Startofmonth=@Startofmonth
-----------------------------------------------------------------


Create Table #AllCategorySubBroker_Age_revenue
(
	Sub_Broker Varchar(200),
	Category Varchar(20)
	
)
INSERT INTO #AllCategorySubBroker_Age_revenue
SELECT SBTAG,SbCat
FROM [196.1.115.159].Ispacescorecard.dbo.VW_SubBroker_Details with (NOLOCK) 
WHERE ISNULL(Branch,'')<>'MFSB'	

INSERT INTO iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
select * from [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_partyinfobrokmonthwise pr with (NOLOCK)
inner join #AllCategorySubBroker_Age_revenue a
ON a.Sub_Broker=pr.SBCODE collate DATABASE_DEFAULT
--where StartOfMonth between @StDate AND @EdDate --AND SBCODE=@subBroker
where Startofmonth=@Startofmonth


DROP SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn

CREATE SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn for iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting

DROP TABLE #AllCategorySubBroker_Age_revenue

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Bkp17Nov2019
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Bkp17Nov2019]
AS
BEGIN
declare @StDate datetime,@EdDate Datetime , @SOM DATETIME=NULL, @StartOfFinDate DATETIME

SET @StDate  = DATEADD(YEAR,-1,GETDATE())
SET	@EdDate  = GETDATE()
DECLARE @Month INT
SELECT @Month =DATEDIFF(M,@StDate,@EdDate)

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev

INSERT INTO iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev
SELECT * FROM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting WITH (NOLOCK)
		
DROP SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn

CREATE SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn for iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev


--------------------------Original Table Insert------------------

TRUNCATE TABLE iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-----------------------------------------------------------------


Create Table #AllCategorySubBroker_Age_revenue
(
	Sub_Broker Varchar(200),
	Category Varchar(20)
	
)
INSERT INTO #AllCategorySubBroker_Age_revenue
SELECT SBTAG,SbCat
FROM [196.1.115.159].Ispacescorecard.dbo.VW_SubBroker_Details with (NOLOCK) 
WHERE ISNULL(Branch,'')<>'MFSB'	

INSERT INTO iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
select * from [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_partyinfobrokmonthwise pr with (NOLOCK)
inner join #AllCategorySubBroker_Age_revenue a
ON a.Sub_Broker=pr.SBCODE collate DATABASE_DEFAULT
where StartOfMonth between @StDate AND @EdDate --AND SBCODE=@subBroker


DROP SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn

CREATE SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn for iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting

DROP TABLE #AllCategorySubBroker_Age_revenue

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_IWMF_current_holding
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_IWMF_current_holding]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#IWMF_current_holding') IS NOT NULL
			DROP TABLE #IWMF_current_holding

		SELECT	AsOnDate,party_Code,fund_code,scheme_code,folio_no,AMFI_Code,DPFlag,Angel_Qty,Actual_Qty,avg_rate,UpdateTime,fsSchemeCode,
				MapID,ProductID,RedeemableUnit,isElssData,SchemeName,ISIN,LastNAVPrice,LastNAVDate,PrevNAV
		INTO #IWMF_current_holding
		FROM [172.31.16.85].ABR_DW_DION.dbo.IWMF_trn_current_holding WITH (NOLOCK)

		
		TRUNCATE TABLE IWMF_trn_current_holding_Prev

		INSERT INTO IWMF_trn_current_holding_Prev
		SELECT * FROM IWMF_trn_current_holding WITH (NOLOCK)
		
		DROP SYNONYM IWMF_trn_current_holding_syn

		CREATE SYNONYM IWMF_trn_current_holding_syn for IWMF_trn_current_holding_Prev

		TRUNCATE TABLE IWMF_trn_current_holding

		INSERT INTO IWMF_trn_current_holding(AsOnDate,party_Code,fund_code,scheme_code,folio_no,AMFI_Code,DPFlag,Angel_Qty,Actual_Qty,
					avg_rate,UpdateTime,fsSchemeCode,MapID,ProductID,RedeemableUnit,isElssData,SchemeName,ISIN,LastNAVPrice,LastNAVDate,PrevNAV)
	
		SELECT	* FROM #IWMF_current_holding

		DROP SYNONYM IWMF_trn_current_holding_syn

		CREATE SYNONYM IWMF_trn_current_holding_syn for IWMF_trn_current_holding


	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_IWMF_trn_current_holding_Folio
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_IWMF_trn_current_holding_Folio]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#IWMF_trn_current_holding_Folio') IS NOT NULL
			DROP TABLE #IWMF_trn_current_holding_Folio

		SELECT	
					AsOnDate,party_Code,fund_code,scheme_code,folio_no,AMFI_Code,DPFlag,Angel_Qty,Actual_Qty
			,avg_rate,UpdateTime,fsSchemeCode,MapID,ProductID,RedeemableUnit,isElssData,SchemeName,ISIN,LastNAVPrice
			,LastNAVDate,PrevNAV,RedeemableUnit_withoutPledge
		INTO #IWMF_trn_current_holding_Folio
		FROM [172.31.16.85].ABR_DW_DION_FOLIO.dbo.IWMF_trn_current_holding WITH (NOLOCK)
				
		TRUNCATE TABLE IWMF_trn_current_holding_Folio_Prev

		INSERT INTO IWMF_trn_current_holding_Folio_Prev
		SELECT * FROM IWMF_trn_current_holding_Folio WITH (NOLOCK)
		
		DROP SYNONYM IWMF_trn_current_holding_Folio_syn

		CREATE SYNONYM IWMF_trn_current_holding_Folio_syn for IWMF_trn_current_holding_Folio_Prev

		TRUNCATE TABLE IWMF_trn_current_holding_Folio

		INSERT INTO IWMF_trn_current_holding_Folio
		(AsOnDate,party_Code,fund_code,scheme_code,folio_no,AMFI_Code,DPFlag,Angel_Qty,Actual_Qty
			,avg_rate,UpdateTime,fsSchemeCode,MapID,ProductID,RedeemableUnit,isElssData,SchemeName,ISIN,LastNAVPrice
			,LastNAVDate,PrevNAV,RedeemableUnit_withoutPledge)
	
		SELECT	* FROM #IWMF_trn_current_holding_Folio

		DROP SYNONYM IWMF_trn_current_holding_Folio_syn

		CREATE SYNONYM IWMF_trn_current_holding_Folio_syn for IWMF_trn_current_holding_Folio

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Amd_MARGIN_Accural
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_Amd_MARGIN_Accural]
		AS
	BEGIN
		SET NOCOUNT ON
		--IF OBJECT_ID('TEMPDB..#MARGIN_Accural') IS NOT NULL
		--	DROP TABLE #MARGIN_Accural
			
		
		--select username,InsertedOn into #MARGIN_Accural from [196.1.115.132].[ROLEMGM].dbo.MARGIN_Accural with(nolock)
				--------------------------Prev Table Insert------------------
		
		TRUNCATE TABLE MARGIN_Accural_Prev

		INSERT INTO MARGIN_Accural_Prev( 
				Party_code,SHORTAGE,Penalty_Amt,Margin_Date,Exchnage,PENALTY_PERC,DAYS_3_COUNT,MONTH_5_COUNT
			)
		SELECT 
	Party_code,SHORTAGE,Penalty_Amt,Margin_Date,Exchnage,PENALTY_PERC,DAYS_3_COUNT,MONTH_5_COUNT
		FROM MARGIN_Accural WITH (NOLOCK)
		
		DROP SYNONYM MARGIN_Accural_syn

		CREATE SYNONYM MARGIN_Accural_syn for MARGIN_Accural_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE MARGIN_Accural

		INSERT INTO MARGIN_Accural( 
			Party_code,SHORTAGE,Penalty_Amt,Margin_Date,Exchnage,PENALTY_PERC,DAYS_3_COUNT,MONTH_5_COUNT
		)
		SELECT	
				Party_code,SHORTAGE,Penalty_Amt,Margin_Date,Exchnage,PENALTY_PERC,DAYS_3_COUNT,MONTH_5_COUNT
		FROM  [AngelFO].NSECURFO.dbo.MARGIN_Accural WITH(NOLOCK)

		DROP SYNONYM MARGIN_Accural_syn

		CREATE SYNONYM MARGIN_Accural_syn for MARGIN_Accural

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_mf_led_sum
-- --------------------------------------------------

CREATE procedure [dbo].[usp_AMD_mf_led_sum]
as
begin



Update A
set 
DEBIT_BALANCE =mls.DEBIT_BALANCE
,CREDIT_BALANCE =mls.CREDIT_BALANCE 
From mf_led_sum A
inner join [AngelFO].bbo_fa.dbo.mf_led_sum mls  WITH(NOLOCK)
  ON A.party_code=mls.PARTY_CODE


 insert into mf_led_sum
  select mls.* from [AngelFO].bbo_fa.dbo.mf_led_sum mls  WITH(NOLOCK)
  left join [MF_LED_SUM] B
  ON mls.party_code=B.PARTY_CODE
where  B.PARTY_CODE is null


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_MFNXT_Daily_sharing
-- --------------------------------------------------
CREATE procedure [dbo].[USP_AMD_MFNXT_Daily_sharing]
As
Begin
Set Nocount ON



--Declare @date Date
--Select  @date = max(sauda_date) from Daily_sharing

--Truncate table Daily_sharing
DELETE FROM Daily_sharing  Where sauda_Date > cast(DATEADD(month, -3, GETDATE()) as date)

Insert into Daily_sharing
(
segment,sauda_date,brok_earned,remi_share,sub_remi_share,angel_share,zone,region,branch,branchname,Regionname,sb,client,Addt_Brok,AddAngelShare
)

Select segment,sauda_date,brok_earned,remi_share,sub_remi_share,angel_share,zone,region,branch,branchname,Regionname,sb,client,Addt_Brok,AddAngelShare
FROM [196.1.115.167].remisior.dbo.vw_daily_sharing With (nolock) 
--where sauda_Date > @date
--where sauda_Date > cast(DATEADD(year, -1, GETDATE()) as date)
Where sauda_Date > cast(DATEADD(month, -3, GETDATE()) as date)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_mfss_ledger_bse
-- --------------------------------------------------
CREATE procedure [dbo].[usp_amd_mfss_ledger_bse]
as
begin

Update a
set 
	--Segment	=A.Segment
	--,Amount =A.Amount

	VDT=b.VDT
	,EDT=b.EDT
	,DRAMOUNT=b.DRAMOUNT
	,CRAMOUNT =b.CRAMOUNT 


From [mfss_ledger_bse_Ipartner] a
inner join [AngelFO].bbo_fa.dbo.mfss_ledger_bse b with (nolock) 
  ON A.CLTCODE=b.CLTCODE
  and a.VNO=B.VNO

 insert into [mfss_ledger_bse_Ipartner]
  select 
		a.CLTCODE,a.VDT,a.EDT,a.DRAMOUNT,a.CRAMOUNT ,a.VNO
  
  from [AngelFO].bbo_fa.dbo.mfss_ledger_bse a with (nolock) 
  left join [mfss_ledger_bse_Ipartner] B with (nolock) 
  ON a.CLTCODE=B.CLTCODE
  and a.VNO=B.VNO
where  B.CLTCODE is null
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_mfss_ledger_bse_Bkp07Jan2018
-- --------------------------------------------------
create procedure [dbo].[usp_amd_mfss_ledger_bse_Bkp07Jan2018]
as
begin

Update a
set 
	--Segment	=A.Segment
	--,Amount =A.Amount

	VDT=b.VDT
	,EDT=b.EDT
	,DRAMOUNT=b.DRAMOUNT
	,CRAMOUNT =b.CRAMOUNT 


From mfss_ledger_bse a
inner join [196.1.115.200].bbo_fa.dbo.mfss_ledger_bse b with (nolock) 
  ON A.CLTCODE=b.CLTCODE


 insert into mfss_ledger_bse
  select 
		a.CLTCODE,a.VDT,a.EDT,a.DRAMOUNT,a.CRAMOUNT ,a.VNO
  
  from [196.1.115.200].bbo_fa.dbo.mfss_ledger_bse a with (nolock) 
  left join mfss_ledger_bse B with (nolock) 
  ON a.CLTCODE=B.CLTCODE
where  B.CLTCODE is null
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_mfss_ledger_bse_truncate
-- --------------------------------------------------
CREATE PROCEDURE usp_amd_mfss_ledger_bse_truncate
as
BEGIN
	TRUNCATE TABLE mfss_ledger_bse

	INSERT INTO mfss_ledger_bse(CLTCODE	,VDT,	EDT,	DRAMOUNT,	CRAMOUNT)
	SELECT a.CLTCODE,a.VDT,a.EDT,a.DRAMOUNT,a.CRAMOUNT 
	FROM [AngelFO].bbo_fa.dbo.mfss_ledger_bse a WITH (NOLOCK) 
	LEFT JOIN mfss_ledger_bse B WITH (NOLOCK) 
	ON a.CLTCODE=B.CLTCODE
	WHERE  B.CLTCODE is null

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_mfss_ledger_bse_update
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_amd_mfss_ledger_bse_update]
as
BEGIN
	UPDATE a
	SET VDT=b.VDT,EDT=b.EDT,DRAMOUNT=b.DRAMOUNT,CRAMOUNT =b.CRAMOUNT 
	FROM mfss_ledger_bse_ipartner a
	INNER JOIN [AngelFO].bbo_fa.dbo.mfss_ledger_bse b WITH (NOLOCK) 
	ON A.CLTCODE=b.CLTCODE
	and A.VNO=b.VNO
	
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_mfss_ledger_nse
-- --------------------------------------------------


CREATE procedure [dbo].[usp_amd_mfss_ledger_nse]
as
begin

Update a
set 
	--Segment	=A.Segment
	--,Amount =A.Amount

	VDT=b.VDT
	,EDT=b.EDT
	,DRAMOUNT=b.DRAMOUNT
	,CRAMOUNT =b.CRAMOUNT 


From mfss_ledger_nse_Ipartner a
inner join [AngelFO].bbo_fa.dbo.mfss_ledger_nse b with (nolock) 
  ON A.CLTCODE=b.CLTCODE
    and a.VNO=B.VNO


 insert into mfss_ledger_nse_Ipartner
  select 
		a.CLTCODE,a.VDT,a.EDT,a.DRAMOUNT,a.CRAMOUNT ,a.VNO
  
  from [AngelFO].bbo_fa.dbo.mfss_ledger_nse a with (nolock) 
  left join mfss_ledger_nse_Ipartner B with (nolock) 
  ON a.CLTCODE=B.CLTCODE
    and a.VNO=B.VNO
where  B.CLTCODE is null
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_MFSS_REL_DATA
-- --------------------------------------------------

CREATE procedure [dbo].[usp_AMD_MFSS_REL_DATA]
as
begin



Update b
set 
RELDT_DR =a.RELDT_DR
,RELDT_CR =a.RELDT_CR
, VTYPE=a.VTYPE
,DRAMOUNT=a.DRAMOUNT
From MFSS_REL_DATA b
inner join [AngelFO].BBO_FA.dbo.MFSS_REL_DATA a with (nolock)
  ON A.cl_code=b.party_code


 insert into MFSS_REL_DATA
  select 
  	 a.cl_code  
	,a.RELDT_DR 
	,a.RELDT_CR 
	,a.VTYPE 
	,a.DRAMOUNT 
  from [AngelFO].BBO_FA.dbo.MFSS_REL_DATA a with (nolock)
  left join MFSS_REL_DATA B
  ON a.cl_code=B.party_code
where  B.PARTY_CODE is null


END
-------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_mis_to
-- --------------------------------------------------

--Created by:-   Sharad Patil
--Created Date:- 2018-Jul-24

CREATE PROCEDURE [dbo].[USP_AMD_mis_to]
AS
--EXEC USP_AMD_mis_to
BEGIN

TRUNCATE TABLE mis_to

INSERT INTO mis_to (sub_broker,LastTradeDate)

SELECT 
sub_broker
,MAX(Sauda_Date) AS LastTradeDate
FROM 
[196.1.115.132].ebroking.dbo.mis_to CD WITH(NOLOCK)
GROUP BY sub_broker	


--EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'TRUNCATE TABLE mis_to'

--INSERT INTO [172.31.16.42].Ipartner.dbo.mis_to (sub_broker,LastTradeDate)
--SELECT sub_broker,LastTradeDate FROM mis_to WITH(NOLOCK)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_mtf_holding
-- --------------------------------------------------
--Create table Mtf_Holding_Prev
--(
--	Party_code varchar(100),
--	Mtf_Holding numeric(20,2)
--)

--Create nonclustered index ix_Mtf_Holding_Prev on Mtf_Holding_Prev(Party_code ,Mtf_Holding)



CREATE  PROCEDURE [dbo].[Usp_AMD_mtf_holding]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#mtf_holding') IS NOT NULL
			DROP TABLE #mtf_holding


		select mtf.party_code,SUM(VBHC) Mtf_Holding
		INTO #mtf_holding
		from [196.1.115.182].Squareoff.dbo.mtf_holding Mtf with (nolock)
		group by mtf.party_code

		


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE mtf_holding_Prev

		INSERT INTO mtf_holding_Prev(Party_Code,Mtf_Holding)
		SELECT Party_Code,Mtf_Holding FROM mtf_holding WITH (NOLOCK)
		
		DROP SYNONYM mtf_holding_syn

		CREATE SYNONYM mtf_holding_syn for mtf_holding_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE mtf_holding

		INSERT INTO mtf_holding( Party_Code,Mtf_Holding)
		SELECT	Party_Code,Mtf_Holding FROM #mtf_holding

		DROP SYNONYM mtf_holding_syn

		CREATE SYNONYM mtf_holding_syn for mtf_holding

		/*
		----Same table craeted on 42 
		EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.vw_Dashboard_sbrisk'
		
		INSERT INTO [172.31.16.42].[IPartner].Dbo.vw_Dashboard_sbrisk 
		(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		 FROM vw_Dashboard_sbrisk
		 */
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_MTF_STATUS
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_MTF_STATUS]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#MTF_STATUS') IS NOT NULL
			DROP TABLE #MTF_STATUS


		SELECT	Party_Code,FROM_DATE,MTFSTATUS
		INTO #MTF_STATUS
		FROM [AngelNseCM].MTFtrade.dbo.MTF_STATUS  WITH(NOLOCK)
		




		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE MTF_STATUS_Prev

		INSERT INTO MTF_STATUS_Prev
		SELECT * FROM MTF_STATUS WITH (NOLOCK)
		
		DROP SYNONYM MTF_STATUS_syn

		CREATE SYNONYM MTF_STATUS_syn for MTF_STATUS_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE MTF_STATUS

		INSERT INTO MTF_STATUS( Party_Code,FROM_DATE,MTFSTATUS)
		SELECT	* FROM #MTF_STATUS

		DROP SYNONYM MTF_STATUS_syn

		CREATE SYNONYM MTF_STATUS_syn for MTF_STATUS

		/*
		----Same table craeted on 42 
		EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.vw_Dashboard_sbrisk'
		
		INSERT INTO [172.31.16.42].[IPartner].Dbo.vw_Dashboard_sbrisk 
		(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		 FROM vw_Dashboard_sbrisk
		 */
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_MTFStatus
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_MTFStatus]
AS
BEGIN
	BEGIN Try 	
	BEGIN TRANSACTION
		TRUNCATE TABLE tbl_mtf_status
	
		INSERT INTO tbl_mtf_status (Party_Code,MTF_From_Date,MTF_Status)
		SELECT Party_Code,FROM_DATE,MTFSTATUS 
		FROM [AngelNseCM].MTFtrade.dbo.MTF_STATUS WITH (NOLOCK)

		COMMIT TRANSACTION;

		--bELOW CODE ADDED BY RUCHI ON 08 mar 2018
		--EXEC [172.31.16.42].Ipartner.dbo.Usp_AMD_MTFStatus
	
	END TRY
	BEGIN CATCH
		ROLLBACK TRANSACTION
		DECLARE @Error_Message varchar(max) = ERROR_MESSAGE()

		IF @Error_Message IS NOT NULL
			RAISERROR(@Error_Message, 16, 1)
		ELSE
			RAISERROR(1, 1, 1)
	END CATCH;
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_MTFStatus_08032018
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_MTFStatus_08032018]
AS
BEGIN

	TRUNCATE TABLE tbl_mtf_status
	
	INSERT INTO tbl_mtf_status (Party_Code,MTF_From_Date,MTF_Status)
	SELECT Party_Code,FROM_DATE,MTFSTATUS 
	FROM [196.1.115.196].MTFtrade.dbo.MTF_STATUS WITH (NOLOCK)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_MTM_CLIENTS
-- --------------------------------------------------

CREATE  PROCEDURE [dbo].[Usp_AMD_MTM_CLIENTS]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#MTM_CLIENTS') IS NOT NULL
			DROP TABLE #MTM_CLIENTS


		SELECT	*
		INTO #MTM_CLIENTS
		FROM  [196.1.115.182].GENERAL.dbo.MTM_CLIENTS with(nolock)
		


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE MTM_CLIENTS_Prev

		INSERT INTO MTM_CLIENTS_Prev
		SELECT * FROM MTM_CLIENTS WITH (NOLOCK)
		
		DROP SYNONYM MTM_CLIENTS_syn

		CREATE SYNONYM MTM_CLIENTS_syn for MTM_CLIENTS_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE MTM_CLIENTS

		INSERT INTO MTM_CLIENTS
		SELECT	* FROM #MTM_CLIENTS

		DROP SYNONYM MTM_CLIENTS_syn

		CREATE SYNONYM MTM_CLIENTS_syn for MTM_CLIENTS

		/*
		----Same table craeted on 42 
		EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.vw_Dashboard_sbrisk'
		
		INSERT INTO [172.31.16.42].[IPartner].Dbo.vw_Dashboard_sbrisk 
		(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		 FROM vw_Dashboard_sbrisk
		 */
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_OFRA_Sub_broker
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_OFRA_Sub_broker]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#OFRA_Sub_broker') IS NOT NULL
			DROP TABLE #OFRA_Sub_broker
			
		
		select Sub_broker into #OFRA_Sub_broker from [196.1.115.132].[ROLEMGM].dbo.OFRA_Sub_broker with(nolock)
				--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE OFRA_Sub_broker_Prev

		INSERT INTO OFRA_Sub_broker_Prev( Sub_broker )
		SELECT Sub_broker  FROM OFRA_Sub_broker WITH (NOLOCK)
		
		DROP SYNONYM OFRA_Sub_broker_syn

		CREATE SYNONYM OFRA_Sub_broker_syn for OFRA_Sub_broker_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE OFRA_Sub_broker

		INSERT INTO OFRA_Sub_broker( Sub_broker )
		SELECT	Sub_broker  FROM #OFRA_Sub_broker

		DROP SYNONYM OFRA_Sub_broker_syn

		CREATE SYNONYM OFRA_Sub_broker_syn for OFRA_Sub_broker

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_Penal_Reversed
-- --------------------------------------------------
CREATE PROCEDURE USP_AMD_Penal_Reversed
AS
BEGIN

		TRUNCATE TABLE Penal_Reversed

		INSERT INTO Penal_Reversed 

		(RevDate,Region,Branch_cd,Sub_Broker,Party_code,BSECM,NSECM,NSEFO,BSEFO,MCX,NCDEX,NSX,MCD,TOTAL)
		
		select RevDate,Region,Branch_cd,Sub_Broker,Party_code,BSECM,NSECM,NSEFO,BSEFO,MCX,NCDEX,NSX,MCD,TOTAL
		
		from [196.1.115.132].MISC.DBO.Penal_Reversed a WITH(nolock)



END

--select count(1) from [196.1.115.132].MISC.DBO.Penal_Reversed a WITH(nolock)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_PledgeStatus_All
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_PledgeStatus_All]
as
BEGIn


	IF OBJECT_ID('TEMPDB..#PledgeStatus_All') IS NOT NULL
			DROP TABLE #PledgeStatus_All

					
		select 
				Party_Code	,scrip_cd	,series	,BCltDpId , CertNo , sum(Qty) Qty , 'margin pledge' PledgeType ,Getdate() UpdatedTime
		INTO #PledgeStatus_All
		 from [AngelDemat].MSAJAG.dbo.deltrans with (nolock) 
		 where drcr='d' and delivered ='0' and filler2=1      
		 and bcltdpid in ('1203320030135814')
		 group by Party_Code	,scrip_cd	,series	,BCltDpId , CertNo 
				 Union 
		 select 
			   Party_Code	,scrip_cd	,series	,BCltDpId , CertNo , sum(Qty) Qty ,'MTF pledge' PledgeType ,Getdate()
		 from [AngelDemat].MSAJAG.dbo.deltrans with (nolock) 
		 where drcr='d' and delivered ='0' and filler2=1
				and bcltdpid in ('1203320030135829')   --MTF pledge
		 group by Party_Code	,scrip_cd	,series	,BCltDpId , CertNo 


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE PledgeStatus_All_Prev

		INSERT INTO PledgeStatus_All_Prev
				(
					Party_Code	,scrip_cd	,series	,BCltDpId , CertNo , Qty , PledgeType , UpdatedTime
				)
				
		SELECT Party_Code	,scrip_cd	,series	,BCltDpId , CertNo , Qty , PledgeType , UpdatedTime
		 FROM PledgeStatus_All WITH (NOLOCK)
		
		DROP SYNONYM PledgeStatus_All_Syn

		CREATE SYNONYM PledgeStatus_All_Syn for PledgeStatus_All_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE PledgeStatus_All

		
			INSERT INTO PledgeStatus_All
			(
										Party_Code	,scrip_cd	,series	,BCltDpId , CertNo , Qty , PledgeType , UpdatedTime

			)

		SELECT Party_Code	,scrip_cd	,series	,BCltDpId , CertNo , Qty , PledgeType , UpdatedTime FROM #PledgeStatus_All

		DROP SYNONYM PledgeStatus_All_Syn

		CREATE SYNONYM PledgeStatus_All_Syn for PledgeStatus_All



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Amd_Rajasthan_SDAmt
-- --------------------------------------------------

create PROCEDURE [dbo].[usp_Amd_Rajasthan_SDAmt]
		AS
	BEGIN
		SET NOCOUNT ON
		--IF OBJECT_ID('TEMPDB..#Rajasthan_SDAmt') IS NOT NULL
		--	DROP TABLE #Rajasthan_SDAmt
			
		
		--select username,InsertedOn into #Rajasthan_SDAmt from [196.1.115.132].[ROLEMGM].dbo.Rajasthan_SDAmt with(nolock)
				--------------------------Prev Table Insert------------------
		
		TRUNCATE TABLE Rajasthan_SDAmt_Prev

		INSERT INTO Rajasthan_SDAmt_Prev( 
				Party_code,SD_Amt
			)
		SELECT 
				Party_code,SD_Amt
		FROM Rajasthan_SDAmt WITH (NOLOCK)
		
		DROP SYNONYM Rajasthan_SDAmt_syn

		CREATE SYNONYM Rajasthan_SDAmt_syn for Rajasthan_SDAmt_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE Rajasthan_SDAmt

		INSERT INTO Rajasthan_SDAmt( 
			Party_code,SD_Amt
		)
		SELECT	
				Party_code,SD_Amt
		FROM  [196.1.115.132].[MISC].DBO.Rajasthan_SDAmt WITH(NOLOCK)

		DROP SYNONYM Rajasthan_SDAmt_syn

		CREATE SYNONYM Rajasthan_SDAmt_syn for Rajasthan_SDAmt

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_SBClientDetails95To38
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_SBClientDetails95To38]
AS
BEGIN
	--Below code added by ruchi on 07032018
	exec [172.31.16.42].Ipartner.dbo.Usp_AMD_SBClientDetails 
		
	--Below code added by ruchi on 07032018
	exec [172.31.16.42].Ipartner.dbo.Usp_AMD_DailyClientActivationRatio 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_securityholdingdata_rpt
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_AMD_securityholdingdata_rpt]
	AS
	BEGIN
		SET NOCOUNT ON
		--IF OBJECT_ID('TEMPDB..#securityholdingdata_rpt') IS NOT NULL
		--	DROP TABLE #securityholdingdata_rpt
			
		
		--select username,InsertedOn into #securityholdingdata_rpt from [196.1.115.132].[ROLEMGM].dbo.securityholdingdata_rpt with(nolock)
				--------------------------Prev Table Insert------------------
		
		TRUNCATE TABLE securityholdingdata_rpt_Prev

		INSERT INTO securityholdingdata_rpt_Prev( 
			party_code
			,exchange
			,qty
			,holding
			,scrip_cd
			,total
			,category
			,symbol
			,isin)
		SELECT party_code
			,exchange
			,qty
			,holding
			,scrip_cd
			,total
			,category
			,symbol
			,isin 
		FROM securityholdingdata_rpt WITH (NOLOCK)
		
		DROP SYNONYM securityholdingdata_rpt_syn

		CREATE SYNONYM securityholdingdata_rpt_syn for securityholdingdata_rpt_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE securityholdingdata_rpt

		INSERT INTO securityholdingdata_rpt( party_code
					,exchange
					,qty
					,holding
					,scrip_cd
					,total
					,category
					,symbol
					,isin
)
		SELECT	party_code
			,exchange
			,qty
			,holding
			,scrip_cd
			,total
			,category
			,symbol
			,isin 
FROM  [196.1.115.182].[GENERAL].dbo.securityholdingdata_rpt with(nolock)

		DROP SYNONYM securityholdingdata_rpt_syn

		CREATE SYNONYM securityholdingdata_rpt_syn for securityholdingdata_rpt

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_tbl_Category_Wise_Average_Bussiness_Consulting
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_AMD_tbl_Category_Wise_Average_Bussiness_Consulting]
AS
BEGIN
Declare   
@StDate Date,@EdDate Date

SET @StDate  = DATEADD(YEAR,-1,GETDATE())
SET	@EdDate  = GETDATE()

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE tbl_Category_Wise_Average_Bussiness_Consulting_Prev

INSERT INTO tbl_Category_Wise_Average_Bussiness_Consulting_Prev
SELECT * FROM tbl_Category_Wise_Average_Bussiness_Consulting WITH (NOLOCK)
		
DROP SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn

CREATE SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn for tbl_Category_Wise_Average_Bussiness_Consulting_Prev


--------------------------Original Table Insert------------------

TRUNCATE TABLE tbl_Category_Wise_Average_Bussiness_Consulting
-----------------------------------------------------------------

------------------Calculate Client Payout age wise------------------------------------------------------------------------------

SELECT Category,SUB_Broker,Startofmonth, ClientAge,Payout,ActiveFrom
INTO #Client_Payout
FROM
 
(Select 
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)) AS Startofmonth,
	--(DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom)) AS AgeInMonth,
	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END AS ClientAge,
	
	SUM(DISTINCT GrossBrokRev) - SUM(DISTINCT NetBrokRev) AS Payout,
	'' ActiveFrom
	
from 
	--#DATA pr with (NOLOCK) 
	iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SYN pr with (NOLOCK) 


GROUP BY
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)),

	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END
	
) AS A


Order By Startofmonth desc


----------------------------------------------------------------------------------------------------------------------------------

--------------------Calculate Client Count age wise-------------------------------------------------------------------------------

SELECT Category,SUB_Broker,Cnt, Startofmonth, ClientAge, ActiveFrom
INTO #Client_Count
FROM 

(Select 
	Category,
	SUB_Broker,
	COUNT(DISTINCT pr.ClientCode) Cnt,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)) AS Startofmonth,
	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END AS ClientAge,
	'' ActiveFrom
	
	
from 
	--#DATA pr with (NOLOCK) 
	iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SYN pr with (NOLOCK) 
	
GROUP BY
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)),

	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END
	
) AS A


----------------------------------------------------------------------------------------------------------------------------------

--------------------Get Maximum Available Trade Days Month Wise--------------------------------------------------------------------

Select 
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)) AS Startofmonth,
	MAX(pr.availableTradedays) AS availableTradedays
INTO #Available_Trade_days
FROm 
	--#DATA pr with (NOLOCK) 
	iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SYN pr with (NOLOCK) 

Group By Category,SUB_Broker,DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth))

----------------------------------------------------------------------------------------------------------------------------------

--------------------Calculate Age Payout------------------------------------------------------------------------------------------

Select Category,SUB_Broker,Startofmonth, ClientAge, AgePayout, ActiveFrom
INTO #Calculate_Avg_Payout 
from (Select
			t.Category,
			t.SUB_Broker,
			t.Startofmonth,
			t.ClientAge, 
			(ISNULL(t.Payout,1) / CASE WHEN t1.Cnt=0 THEN 1 ELSE ISNULL(t1.Cnt,1) END / CASE WHEN t2.availableTradedays=0 THEN 1 ELSE ISNULL(t2.availableTradedays,1) END) *245 AS AgePayout,
			'' ActiveFrom
		FROM 
			#Client_Payout t
			INNER JOIN #Client_Count t1 ON t.Startofmonth = t1.Startofmonth AND t.ClientAge = t1.ClientAge AND t.SUB_Broker = t1.SUB_Broker
			INNER JOIN #Available_Trade_days t2 ON t.Startofmonth = t2.Startofmonth AND t.SUB_Broker = t2.SUB_Broker
	 ) AS A


-----------------------------------------------------------------------------------------------------------------------------------

--------------------Calculate Average Age Payout-----------------------------------------------------------------------------------

Select 
	Category,
	SUB_Broker,
	ClientAge,
	AVG(AgePayout) AS AvgPayout,
	'' ActiveFrom
INTO #Client_Avg_Payout
from 
	#Calculate_Avg_Payout
Where
	--SUB_Broker = 'ICFS'	AND 
AgePayout >0
GROUP By
	Category,
	SUB_Broker,
	 ClientAge

-----------------------------------------------------------------------------------------------------------------------------------
INSERT INTO tbl_Category_Wise_Average_Bussiness_Consulting
Select Category,AvgPayout,ClientAge,SUB_Broker,ActiveFrom  from #Client_Avg_Payout

DROP SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn

CREATE SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn for tbl_Category_Wise_Average_Bussiness_Consulting

Drop Table #Client_Avg_Payout, #Client_Payout, #Client_Count,#Calculate_Avg_Payout,#Available_Trade_days

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_TBL_COMBINE_REPORTING_DETAIL
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_TBL_COMBINE_REPORTING_DETAIL]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#TBL_COMBINE_REPORTING_DETAIL') IS NOT NULL
			DROP TABLE #TBL_COMBINE_REPORTING_DETAIL

		Declare @StartDate date=convert(date,dateadd(MONTH,-6,getdate()))


		select --*
			T.party_code ,T.Max_margindate margindate,sum(TDAY_MARGIN) TDAY_MARGIN   ,sum(TDAY_MTM) TDAY_MTM  , isnull(sum(TDAY_MARGIN),0) + isnull(sum(TDAY_MTM),0) Margin
			into #TBL_COMBINE_REPORTING_DETAIL
		from 
		(
			select 
				 party_code ,max(margindate) Max_margindate
			from [AngelNseCM].MSAJAG.dbo.TBL_COMBINE_REPORTING_DETAIL with (nolock)
			where  margindate >=convert(date,dateadd(MONTH,-6,getdate()))
		--	and PARTY_CODE in ('A100427','A100077')
			group by party_code 
		) T inner join [AngelNseCM].MSAJAG.dbo.TBL_COMBINE_REPORTING_DETAIL d with (nolock)
		on T.Max_margindate=d.margindate
		and T.party_code=d.party_code
		group by T.party_code ,T.Max_margindate




		
		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE TBL_COMBINE_REPORTING_DETAIL_Prev

		INSERT INTO TBL_COMBINE_REPORTING_DETAIL_Prev(party_code,MARGINDATE,TDAY_MARGIN,TDAY_MTM,Margin)
		SELECT party_code,MARGINDATE,TDAY_MARGIN,TDAY_MTM,Margin FROM TBL_COMBINE_REPORTING_DETAIL WITH (NOLOCK)
		
		DROP SYNONYM TBL_COMBINE_REPORTING_DETAIL_syn

		CREATE SYNONYM TBL_COMBINE_REPORTING_DETAIL_syn for TBL_COMBINE_REPORTING_DETAIL_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE TBL_COMBINE_REPORTING_DETAIL

		INSERT INTO TBL_COMBINE_REPORTING_DETAIL( party_code ,margindate,TDAY_MARGIN   ,TDAY_MTM  , Margin)
		SELECT	party_code,MARGINDATE,TDAY_MARGIN,TDAY_MTM,Margin FROM #TBL_COMBINE_REPORTING_DETAIL

		DROP SYNONYM TBL_COMBINE_REPORTING_DETAIL_syn

		CREATE SYNONYM TBL_COMBINE_REPORTING_DETAIL_syn for TBL_COMBINE_REPORTING_DETAIL

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_tbl_CRMS_Dashboard_PriorityClients_B2B]
AS
BEGIN

TRUNCATE TABLE tbl_CRMS_Dashboard_PriorityClients_B2B
INSERT INTO tbl_CRMS_Dashboard_PriorityClients_B2B
(AutoId,DateTime,emp_no,party_code,party_name,CallType,CallSubType,CallValue,Priority,Sub_Priority,IsProcessed,IsProcessedDateTime)
Select AutoId,DateTime,emp_no,party_code,party_name,CallType,CallSubType,CallValue,Priority,Sub_Priority,IsProcessed,IsProcessedDateTime from 
[196.1.115.207].crm.dbo.tbl_CRMS_Dashboard_PriorityClients_B2B with(nolock)
where 		[DateTime] between convert(varchar(11),getdate(),109) 
		and convert(varchar(11),getdate(),109) + ' 23:59'
		and IsProcessed = 'N'

--EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.tbl_CRMS_Dashboard_PriorityClients_B2B'
		
--INSERT INTO [172.31.16.42].[IPartner].Dbo.tbl_CRMS_Dashboard_PriorityClients_B2B 
--(AutoId,DateTime,emp_no,party_code,party_name,CallType,CallSubType,CallValue,Priority,Sub_Priority,IsProcessed,IsProcessedDateTime)
--Select AutoId,DateTime,emp_no,party_code,party_name,CallType,CallSubType,CallValue,Priority,Sub_Priority,IsProcessed,IsProcessedDateTime from tbl_CRMS_Dashboard_PriorityClients_B2B with(nolock)



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_tbl_DRA_SBTAG
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_tbl_DRA_SBTAG]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#tbl_DRA_SBTAG') IS NOT NULL
			DROP TABLE #tbl_DRA_SBTAG
			
		
		select Sbtag into #tbl_DRA_SBTAG from [196.1.115.132].[risk].dbo.tbl_DRA_SBTAG with(nolock)
				--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE tbl_DRA_SBTAG_Prev

		INSERT INTO tbl_DRA_SBTAG_Prev( Sbtag )
		SELECT Sbtag  FROM tbl_DRA_SBTAG WITH (NOLOCK)
		
		DROP SYNONYM tbl_DRA_SBTAG_syn

		CREATE SYNONYM tbl_DRA_SBTAG_syn for tbl_DRA_SBTAG_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE tbl_DRA_SBTAG

		INSERT INTO tbl_DRA_SBTAG( Sbtag )
		SELECT	Sbtag  FROM #tbl_DRA_SBTAG

		DROP SYNONYM tbl_DRA_SBTAG_syn

		CREATE SYNONYM tbl_DRA_SBTAG_syn for tbl_DRA_SBTAG

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_tbl_Emp_Master
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_tbl_Emp_Master]
AS
BEGIN

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE tbl_Emp_Master_Prev

INSERT INTO tbl_Emp_Master_Prev
(Emp_No,Sb_Tag,First_Name,Middle_Name,Last_Name,Emp_Name,Address1,Address2
,City,State,Pincode,Mobile,Email,Dt_ActiveFrom,isSuspended,isTerminated
,Salary,User_ID,Password,Dt_Updation,IP,Created_date,LandLine,isAdmin
)
SELECT 
Emp_No,Sb_Tag,First_Name,Middle_Name,Last_Name,Emp_Name,Address1,Address2
,City,State,Pincode,Mobile,Email,Dt_ActiveFrom,isSuspended,isTerminated
,Salary,User_ID,Password,Dt_Updation,IP,Created_date,LandLine,isAdmin
FROM tbl_Emp_Master WITH (NOLOCK)
		
DROP SYNONYM tbl_Emp_Master_syn

CREATE SYNONYM tbl_Emp_Master_syn for tbl_Emp_Master_Prev


--------------------------Original Table Insert------------------

TRUNCATE TABLE tbl_Emp_Master
-----------------------------------------------------------------

INSERT INTO tbl_Emp_Master
(Emp_No,Sb_Tag,First_Name,Middle_Name,Last_Name,Emp_Name,Address1,Address2
,City,State,Pincode,Mobile,Email,Dt_ActiveFrom,isSuspended,isTerminated
,Salary,User_ID,Password,Dt_Updation,IP,Created_date,LandLine,isAdmin)
SELECT 
Emp_No,Sb_Tag,First_Name,Middle_Name,Last_Name,Emp_Name,'' Address1,'' Address2
,'' City,'' State,'' Pincode,'' Mobile,'' Email,Dt_ActiveFrom,isSuspended,isTerminated
,Salary,User_ID,Password,Dt_Updation,IP,Created_date,LandLine,isAdmin
FROM [Intranet].[Mimansa].[dbo].[tbl_Emp_Master] WITH (NOLOCK)

DROP SYNONYM tbl_Emp_Master_syn

CREATE SYNONYM tbl_Emp_Master_syn for tbl_Emp_Master

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Amd_tbl_Emp_Suspension_Termination
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_tbl_Emp_Suspension_Termination]    
AS    
BEGIN    

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE tbl_Emp_Suspension_Termination_PREV   

 INSERT INTO tbl_Emp_Suspension_Termination_PREV (
		pid_tbl_Emp_Suspension_Termination
		,sb_tag
		,Emp_no
		,isClientMaped
		,Suspension_Date
		,SuspendedBy
		,SuspensionEntry_Date
		,isSuspended
		,Termination_Date
		,TerminatedBy
		,TerminationEntry_Date
		,isTerminated
)
 SELECT 
		pid_tbl_Emp_Suspension_Termination
		,sb_tag
		,Emp_no
		,isClientMaped
		,Suspension_Date
		,SuspendedBy
		,SuspensionEntry_Date
		,isSuspended
		,Termination_Date
		,TerminatedBy
		,TerminationEntry_Date
		,isTerminated
		FROM tbl_Emp_Suspension_Termination with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM tbl_Emp_Suspension_Termination_syn

		CREATE SYNONYM tbl_Emp_Suspension_Termination_syn for tbl_Emp_Suspension_Termination_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE tbl_Emp_Suspension_Termination  
   
 INSERT INTO tbl_Emp_Suspension_Termination (
		pid_tbl_Emp_Suspension_Termination
		,sb_tag
		,Emp_no
		,isClientMaped
		,Suspension_Date
		,SuspendedBy
		,SuspensionEntry_Date
		,isSuspended
		,Termination_Date
		,TerminatedBy
		,TerminationEntry_Date
		,isTerminated
) 
    
 SELECT  
		pid_tbl_Emp_Suspension_Termination
		,sb_tag
		,Emp_no
		,isClientMaped
		,Suspension_Date
		,SuspendedBy
		,SuspensionEntry_Date
		,isSuspended
		,Termination_Date
		,TerminatedBy
		,TerminationEntry_Date
		,isTerminated
FROM [196.1.115.132].Mimansa.dbo.tbl_Emp_Suspension_Termination B with (nolock)


--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM tbl_Emp_Suspension_Termination_syn

		CREATE SYNONYM tbl_Emp_Suspension_Termination_syn for tbl_Emp_Suspension_Termination

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_tbl_Get_DailyActivation_Details
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_AMD_tbl_Get_DailyActivation_Details]
AS
BEGIN

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE tbl_Get_DailyActivation_Details_Prev

INSERT INTO tbl_Get_DailyActivation_Details_Prev
SELECT * FROM tbl_Get_DailyActivation_Details WITH (NOLOCK)
		
DROP SYNONYM tbl_Get_DailyActivation_Details_syn

CREATE SYNONYM tbl_Get_DailyActivation_Details_syn for tbl_Get_DailyActivation_Details_Prev

--------------------------Original Table Insert------------------

TRUNCATE TABLE tbl_Get_DailyActivation_Details
-----------------------------------------------------------------

TRUNCATE TABLE tbl_Get_DailyActivation_Details

declare @StDate datetime,@EdDate Datetime , @SOM DATETIME=NULL, @StartOfFinDate DATETIME

SET @StDate  = DATEADD(YEAR,-1,GETDATE())
SET	@EdDate  = GETDATE()
DECLARE @Month INT
SELECT @Month =DATEDIFF(M,@StDate,@EdDate)


IF @Som IS NULL
Select @Som=MAX(StartOfMonth) 
From  [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_PERBRANCHMONTHLYTREND

SELECT @StartOfFinDate=MAX(StartOfFinDate)
FROM [196.1.115.207].angelcs.dbo.TABLE_DATE
WHERE Date=@SOM
	
SELECT *
INTO #VW_SubBroker_Details
FROM  [196.1.115.159].Ispacescorecard.dbo.VW_SubBroker_Details with (NOLOCK)
WHERE ISNULL(Branch,'')<>'MFSB'	
--and SbCat in (select SbCat from  [196.1.115.159].Ispacescorecard.dbo.VW_SubBroker_Details with (NOLOCK)  where SBTAG=@subBroker)

select * into #iSpc_Master_SCard_partyinfobrokmonthwise1_Daily_Activation from  [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_partyinfobrokmonthwise pr with (NOLOCK)
inner join #VW_SubBroker_Details a
ON a.SBTAG=pr.SBCODE --collate DATABASE_DEFAULT
where StartOfMonth=@SOM
and pr.ClientType='N'
--AND SBCODE=@SubBroker

SELECT
som.StartOfMonth AS StartOfMonth,sb2.SBTAG AS Sub_Broker,
sb2.Branch AS BranchCode,
ac1.InActiveFrom,
pr.NetBrokRev,
pr.GrossBrokRev,
pr.NoOfDaysTraded,
pr.AvailableTradeDays,

CASE WHEN (sb2.TAGGeneratedDate>=DATEADD(M,-11,som.StartOfMonth) AND sb2.TAGGeneratedDate<DATEADD(M,1,som.StartOfMonth))			
THEN '1st year' 		
WHEN (sb2.TAGGeneratedDate>=DATEADD(M,-23,som.StartOfMonth) AND sb2.TAGGeneratedDate<DATEADD(M,-11,som.StartOfMonth)) --- Second Year Rev		
THEN '2nd year' 		
WHEN (sb2.TAGGeneratedDate>=DATEADD(M,-35,som.StartOfMonth) AND sb2.TAGGeneratedDate<DATEADD(M,-23,som.StartOfMonth)) --- Third Year Rev		
THEN '3rd year' 		
WHEN (sb2.TAGGeneratedDate>=DATEADD(M,-47,som.StartOfMonth) AND sb2.TAGGeneratedDate<DATEADD(M,-35,som.StartOfMonth)) --- Fourth Year Rev		
THEN '4th year' 		
WHEN (sb2.TAGGeneratedDate>=DATEADD(M,-59,som.StartOfMonth) AND sb2.TAGGeneratedDate<DATEADD(M,-47,som.StartOfMonth)) --- Fifth Year Rev		
THEN '5th year' 		
WHEN (sb2.TAGGeneratedDate<DATEADD(M,-59,som.StartOfMonth)) --- More than 5 Year Rev		
THEN 'More than 5 year' 		
END SBAge_Year,

CASE WHEN (ac1.ActiveFrom>=DATEADD(M,-11,som.StartOfMonth) AND ac1.ActiveFrom<DATEADD(M,1,som.StartOfMonth))			
THEN '1st year' 		
WHEN (ac1.ActiveFrom>=DATEADD(M,-23,som.StartOfMonth) AND ac1.ActiveFrom<DATEADD(M,-11,som.StartOfMonth)) --- Second Year Rev		
THEN '2nd year' 		
WHEN (ac1.ActiveFrom>=DATEADD(M,-35,som.StartOfMonth) AND ac1.ActiveFrom<DATEADD(M,-23,som.StartOfMonth)) --- Third Year Rev		
THEN '3rd year' 		
WHEN (ac1.ActiveFrom>=DATEADD(M,-47,som.StartOfMonth) AND ac1.ActiveFrom<DATEADD(M,-35,som.StartOfMonth)) --- Fourth Year Rev		
THEN '4th year' 		
WHEN (ac1.ActiveFrom>=DATEADD(M,-59,som.StartOfMonth) AND ac1.ActiveFrom<DATEADD(M,-47,som.StartOfMonth)) --- Fifth Year Rev		
THEN '5th year' 		
WHEN (ac1.ActiveFrom<DATEADD(M,-59,som.StartOfMonth)) --- More than 5 Year Rev		
THEN 'More than 5 year' 		
END ClientAge_Year

INTO #SubBroker_Details_Daily_Activation
FROM 
	[196.1.115.159].Ispacescorecard.dbo.vw_StartOfMonth_ForSBAge som
	LEFT JOIN #VW_SubBroker_Details sb2
		ON (som.StartOfMonth>=DATEADD(mm,DATEDIFF(mm,0,sb2.TAGGeneratedDate),0))
	LEFT JOIN  [196.1.115.159].Ispacescorecard.dbo.Tbl_Sb_code_online_offline_sbProfile cat
		ON sb2.SBTAG=cat.SBCode
	LEFT JOIN #iSpc_Master_SCard_partyinfobrokmonthwise1_Daily_Activation pr
		ON sb2.SBTAG=pr.SBCODE	AND som.Startofmonth=pr.Startofmonth 
	LEFT JOIN [196.1.115.159].Ispacescorecard.dbo.AngelClient1 ac1
		ON pr.ClientCode=ac1.Party_Code	
	--LEFT JOIN [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_PERBRANCHMONTHLYTREND br
	--	ON sb2.Branch=br.BRANCH_CD And br.StartOfMonth=som.StartOfMonth		
	--LEFT JOIN [196.1.115.159].Ispacescorecard.dbo.tbl_SB_Deposit dp
	--	ON sb2.SBTAG=dp.SB_Tag		
WHERE	
	som.StartOfMonth=@SOM
	--AND sb2.SBTAG = @SubBroker

Select	
	Sub_Broker,
	COUNT(Sub_Broker) [Total_Cnt],
	ClientAge_Year,
	CONVERT(FLOAT,0) AS [AR],
	COUNT(CASE WHEN NetBrokRev>0 THEN Sub_Broker END)Total_ActiveSB
INTO #Test_Daily_Activation 
From #SubBroker_Details_Daily_Activation pr
group by 
	Sub_Broker,
	ClientAge_Year
	
SELECT 	
	Sub_Broker,
	Total_ActiveSB,
	Total_Cnt,
	(CONVERT(FLOAT,Total_ActiveSB)/CONVERT(FLOAT,Total_Cnt))*100 AS [AR],
	ClientAge_Year
Into #Final_Daily_Activation
FROM #Test_Daily_Activation 
where 
	Total_ActiveSB>0

--INSERT INTO tbl_Get_DailyActivation_Details
--SELECT * FROM #Final_Daily_Activation


INSERT INTO tbl_Get_DailyActivation_Details
SELECT	* FROM #Final_Daily_Activation

DROP SYNONYM tbl_Get_DailyActivation_Details_syn

CREATE SYNONYM tbl_Get_DailyActivation_Details_syn for tbl_Get_DailyActivation_Details
	
Drop Table #VW_SubBroker_Details, #iSpc_Master_SCard_partyinfobrokmonthwise1_Daily_Activation, #SubBroker_Details_Daily_Activation, #Test_Daily_Activation,#Final_Daily_Activation

--Create Table tbl_Get_DailyActivation_Details
--(
--	Sub_Broker Varchar(2000),
--	Total_ActiveSB INT,
--	Total_Cnt INT,
--	AR Numeric(18,2),
--	Client_Age_Year VARCHAR(100)
--)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_TBL_MOBLOGINDETAILS
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_TBL_MOBLOGINDETAILS]    
AS    
BEGIN    

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE TBL_MOBLOGINDETAILS_PREV   


 INSERT INTO TBL_MOBLOGINDETAILS_PREV (
ID
,UserId
,SessionId
,LastLogin
,Location
)
 SELECT 
ID
,UserId
,SessionId
,LastLogin
,Location		
FROM TBL_MOBLOGINDETAILS with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM TBL_MOBLOGINDETAILS_syn

		CREATE SYNONYM TBL_MOBLOGINDETAILS_syn for TBL_MOBLOGINDETAILS_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE TBL_MOBLOGINDETAILS  
   
 INSERT INTO TBL_MOBLOGINDETAILS (
ID
,UserId
,SessionId
,LastLogin
,Location
) 
    
 SELECT  
ID
,UserId
,SessionId
,LastLogin
,Location
FROM [196.1.115.132].risk.dbo.TBL_MOBLOGINDETAILS with(nolock)

--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM TBL_MOBLOGINDETAILS_syn

		CREATE SYNONYM TBL_MOBLOGINDETAILS_syn for TBL_MOBLOGINDETAILS

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Tbl_NewPOA
-- --------------------------------------------------

CREATE procedure [dbo].[usp_AMD_Tbl_NewPOA]
as
begin

Truncate table Tbl_NewPOA


insert into Tbl_NewPOA
(
	PARTY_CODE
	,upd_date
)
select 
	PARTY_CODE
	,upd_date
from [196.1.115.182].General.dbo.Tbl_NewPOA Poa WITH(NOLOCK)
--left join Tbl_NewPOA B WITH(NOLOCK) ON Poa.[PARTY_CODE]=B.[PARTY_CODE]
--where B.[PARTY_CODE] is null

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AMD_Tbl_NewPOA_Bkp02Dec2021
-- --------------------------------------------------

CREATE procedure [dbo].[usp_AMD_Tbl_NewPOA_Bkp02Dec2021]
as
begin

insert into Tbl_NewPOA
select poa.* from [196.1.115.182].General.dbo.Tbl_NewPOA Poa WITH(NOLOCK)
left join Tbl_NewPOA B WITH(NOLOCK) ON Poa.[PARTY_CODE]=B.[PARTY_CODE]
where B.[PARTY_CODE] is null

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_Tbl_Pledge_Mapping
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_Tbl_Pledge_Mapping]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#Tbl_Pledge_Mapping') IS NOT NULL
			DROP TABLE #Tbl_Pledge_Mapping
			
		select * into #Tbl_Pledge_Mapping from [196.1.115.182].general.dbo.Tbl_Pledge_Mapping with (nolock)
		where [b2c]='N'
			
				--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE Tbl_Pledge_Mapping_Prev

		INSERT INTO Tbl_Pledge_Mapping_Prev( Party_code,Communique_date,Pldg_Req_Date,Pldg_Exec_date,Mtf_Communique_date,Mtf_Pld_Date,Mtf_Pldg_Exec_date,Valid
,Remarks,Dummy1,Dummy2,Dummy3,b2c)
		SELECT Party_code,Communique_date,Pldg_Req_Date,Pldg_Exec_date,Mtf_Communique_date,Mtf_Pld_Date,Mtf_Pldg_Exec_date,Valid
,Remarks,Dummy1,Dummy2,Dummy3,b2c  FROM Tbl_Pledge_Mapping WITH (NOLOCK)
		
		DROP SYNONYM Tbl_Pledge_Mapping_syn

		CREATE SYNONYM Tbl_Pledge_Mapping_syn for Tbl_Pledge_Mapping_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE Tbl_Pledge_Mapping

		INSERT INTO Tbl_Pledge_Mapping( Party_code,Communique_date,Pldg_Req_Date,Pldg_Exec_date,Mtf_Communique_date,Mtf_Pld_Date,Mtf_Pldg_Exec_date,Valid
,Remarks,Dummy1,Dummy2,Dummy3,b2c)
		SELECT	Party_code,Communique_date,Pldg_Req_Date,Pldg_Exec_date,Mtf_Communique_date,Mtf_Pld_Date,Mtf_Pldg_Exec_date,Valid
,Remarks,Dummy1,Dummy2,Dummy3,b2c  FROM #Tbl_Pledge_Mapping

		DROP SYNONYM Tbl_Pledge_Mapping_syn

		CREATE SYNONYM Tbl_Pledge_Mapping_syn for Tbl_Pledge_Mapping

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf]
as
BEGIN

Declare @startDate Date=convert(date,Getdate())

Declare @RunDate varchar(10)=replace(convert(varchar,Getdate(),102),'.','')
Declare @Counter1 int = 0

SELECT @Counter1 = Counter FROM Tbl_CounterForMTFPledgeJob WITH(NOLOCK)
where CONVERT(DATE,createdDate) = CONVERT(date,GETDATE())
SELECT @Counter1
--select @RunDate


If (SELECT count(*) FROM [AngelNseCM].[MTFTRADE].[dbo].[TBL_MTF_PROV_LOG] with (nolock) WHERE FUNDING_DATE =CONVERT(VARCHAR(11),GETDATE(),120))>0
begin

IF (@Counter1 <1)
BEGIN
--if (select count(*) from TBL_POA_PLD_ADNL_Pledge_Mtf with (nolock) where convert(date,UpdatedDate)=@startDate)=0
--begin

--if (select count(*) from msdb.dbo.sysjobhistory where step_name='USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf' and run_date=@RunDate)=0
--begin


	IF OBJECT_ID('TEMPDB..#TBL_POA_PLD_ADNL_Pledge_Mtf') IS NOT NULL
			DROP TABLE #TBL_POA_PLD_ADNL_Pledge_Mtf

	
			select 
					PARTY_CODE	
					,SCRIP_CD	
					,CERTNO	
					,DPID   
					,EXEDATE	
					,CLTDPID 
					,PAYQTY	
					,B.Sett_No
					,SUCCESSFLAG
					,Case When SUCCESSFLAG='Y' Then 'OTP received'
					When SUCCESSFLAG='N' then  'OTP pending'
					When SUCCESSFLAG='P' Then 'Pledge Done' END SUCCESSFLAG_Converted
					,TRANSDATE Start_date	
					,End_Date
					,Getdate() UpdatedDate
					,QTY
					
			into #TBL_POA_PLD_ADNL_Pledge_Mtf
			 from  [AngelDemat].MSAJAG.dbo.TBL_POA_PLD_ADNL A with (nolock) 
			inner join (select * from [AngelDemat].MSAJAG.dbo.sett_mst with (nolock) where Sett_Type='N') B
			On A.SETT_NO=B.Sett_No
				where Convert(Date,TRANSDATE)=@startDate 

				
		--------------------------Prev Table Insert------------------

		
		--TRUNCATE TABLE TBL_POA_PLD_ADNL_Pledge_Mtf_Prev

		--INSERT INTO TBL_POA_PLD_ADNL_Pledge_Mtf_Prev
		--		(
		--			PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
		--		)
				
		--SELECT PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
		-- FROM TBL_POA_PLD_ADNL_Pledge_Mtf WITH (NOLOCK)
		
		--DROP SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn

		--CREATE SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn for TBL_POA_PLD_ADNL_Pledge_Mtf_Prev



		--------------------------Original Table Insert------------------

--		TRUNCATE TABLE TBL_POA_PLD_ADNL_Pledge_Mtf

		insert into Tbl_pledege_mtf_data_log (party_code,createddate,start_date)
		select PARTY_CODE,getdate(),start_date from #TBL_POA_PLD_ADNL_Pledge_Mtf
		
		delete from TBL_POA_PLD_ADNL_Pledge_Mtf where Start_date<dateadd(dd,-15,getdate())

		
			INSERT INTO TBL_POA_PLD_ADNL_Pledge_Mtf
			(
				PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
			)

		SELECT PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,UpdatedDate,End_Date,UpdatedDate,QTY 
		FROM #TBL_POA_PLD_ADNL_Pledge_Mtf

		
	
		--select @Counter


		INSERT INTO Tbl_CounterForMTFPledgeJob (Counter,createdDate,SP_Job_Name)
		VALUES (@Counter1+1,GETDATE(),'USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf')
		--DROP SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn

		--CREATE SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn for TBL_POA_PLD_ADNL_Pledge_Mtf

--END
END
ELSE 
PRINT @COUNTER1
END
ELSE 
PRINT 'BBB'
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp03Aug2021
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp03Aug2021]
as
BEGIn


	IF OBJECT_ID('TEMPDB..#TBL_POA_PLD_ADNL_Pledge_Mtf') IS NOT NULL
			DROP TABLE #TBL_POA_PLD_ADNL_Pledge_Mtf

	
			select 
					PARTY_CODE	
					,SCRIP_CD	
					,CERTNO	
					,DPID   
					,EXEDATE	
					,CLTDPID 
					,PAYQTY	
					,B.Sett_No
					,SUCCESSFLAG
					,Case When SUCCESSFLAG='Y' Then 'OTP received'
					When SUCCESSFLAG='N' then  'OTP pending'
					When SUCCESSFLAG='P' Then 'Pledge Done' END SUCCESSFLAG_Converted
					,Start_date	
					,End_Date
					,Getdate() UpdatedDate
					,QTY
					
			into #TBL_POA_PLD_ADNL_Pledge_Mtf
			 from  [196.1.115.197].MSAJAG.dbo.TBL_POA_PLD_ADNL A with (nolock) 
			inner join (select * from [196.1.115.197].MSAJAG.dbo.sett_mst where Sett_Type='N') B
			On A.SETT_NO=B.Sett_No

		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE TBL_POA_PLD_ADNL_Pledge_Mtf_Prev

		INSERT INTO TBL_POA_PLD_ADNL_Pledge_Mtf_Prev
				(
					PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
				)
				
		SELECT PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
		 FROM TBL_POA_PLD_ADNL_Pledge_Mtf WITH (NOLOCK)
		
		DROP SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn

		CREATE SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn for TBL_POA_PLD_ADNL_Pledge_Mtf_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE TBL_POA_PLD_ADNL_Pledge_Mtf

		
			INSERT INTO TBL_POA_PLD_ADNL_Pledge_Mtf
			(
				PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
			)

		SELECT PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY FROM #TBL_POA_PLD_ADNL_Pledge_Mtf

		DROP SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn

		CREATE SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn for TBL_POA_PLD_ADNL_Pledge_Mtf



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp20Jan2022
-- --------------------------------------------------
Create PROCEDURE [dbo].[USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp20Jan2022]
as
BEGIn

Declare @startDate Date=convert(date,Getdate())

Declare @RunDate varchar(10)=replace(convert(varchar,Getdate(),102),'.','')

--select @RunDate


If (SELECT count(*) FROM [196.1.115.196].[MTFTRADE].[dbo].[TBL_MTF_PROV_LOG] with (nolock) WHERE FUNDING_DATE =CONVERT(VARCHAR(11),GETDATE(),120))>0
begin

if (select count(*) from TBL_POA_PLD_ADNL_Pledge_Mtf with (nolock) where convert(date,UpdatedDate)=@startDate)=0
begin

--if (select count(*) from msdb.dbo.sysjobhistory where step_name='USP_AMD_TBL_POA_PLD_ADNL_Pledge_Mtf' and run_date=@RunDate)=0
--begin

	IF OBJECT_ID('TEMPDB..#TBL_POA_PLD_ADNL_Pledge_Mtf') IS NOT NULL
			DROP TABLE #TBL_POA_PLD_ADNL_Pledge_Mtf

	
			select 
					PARTY_CODE	
					,SCRIP_CD	
					,CERTNO	
					,DPID   
					,EXEDATE	
					,CLTDPID 
					,PAYQTY	
					,B.Sett_No
					,SUCCESSFLAG
					,Case When SUCCESSFLAG='Y' Then 'OTP received'
					When SUCCESSFLAG='N' then  'OTP pending'
					When SUCCESSFLAG='P' Then 'Pledge Done' END SUCCESSFLAG_Converted
					,TRANSDATE Start_date	
					,End_Date
					,Getdate() UpdatedDate
					,QTY
					
			into #TBL_POA_PLD_ADNL_Pledge_Mtf
			 from  [196.1.115.197].MSAJAG.dbo.TBL_POA_PLD_ADNL A with (nolock) 
			inner join (select * from [196.1.115.197].MSAJAG.dbo.sett_mst with (nolock) where Sett_Type='N') B
			On A.SETT_NO=B.Sett_No
				where Convert(Date,TRANSDATE)=@startDate 
		--------------------------Prev Table Insert------------------

		
		--TRUNCATE TABLE TBL_POA_PLD_ADNL_Pledge_Mtf_Prev

		--INSERT INTO TBL_POA_PLD_ADNL_Pledge_Mtf_Prev
		--		(
		--			PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
		--		)
				
		--SELECT PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
		-- FROM TBL_POA_PLD_ADNL_Pledge_Mtf WITH (NOLOCK)
		
		--DROP SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn

		--CREATE SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn for TBL_POA_PLD_ADNL_Pledge_Mtf_Prev



		--------------------------Original Table Insert------------------

		--TRUNCATE TABLE TBL_POA_PLD_ADNL_Pledge_Mtf

		
		delete from TBL_POA_PLD_ADNL_Pledge_Mtf where Start_date<dateadd(dd,-15,getdate())

			INSERT INTO TBL_POA_PLD_ADNL_Pledge_Mtf
			(
				PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,Start_date,End_Date,UpdatedDate,QTY
			)

		SELECT PARTY_CODE,SCRIP_CD,CERTNO,DPID,EXEDATE,CLTDPID,SUCCESSFLAG,SUCCESSFLAG_Converted,PAYQTY,Sett_No,UpdatedDate,End_Date,UpdatedDate,QTY FROM #TBL_POA_PLD_ADNL_Pledge_Mtf

		--DROP SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn

		--CREATE SYNONYM TBL_POA_PLD_ADNL_Pledge_Mtf_Syn for TBL_POA_PLD_ADNL_Pledge_Mtf


END
END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_TBL_RMS_COLLECTION_CLI
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_TBL_RMS_COLLECTION_CLI]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#TBL_RMS_COLLECTION_CLI') IS NOT NULL
			DROP TABLE #TBL_RMS_COLLECTION_CLI


		SELECT	
				Party_Code,Cash,Derivatives,Currency,Commodities,DP,NBFC,ABL_Net,ACBL_Net,NBFC_Net,Deposit,Net_Debit,Net_Available,BSE_Ledger,NSE_Ledger
		,NSEFO_Ledger,MCD_Ledger,NSX_Ledger,MCX_Ledger,NCDEX_Ledger,NBFC_Ledger,Net_Ledger,UnReco_Credit,Hold_BlueChip,Hold_Good,Hold_Poor
		,Hold_Junk,Hold_Total,Hold_TotalHC,Coll_NSEFO,Coll_MCD,Coll_NSX,Coll_MCX,Coll_NCDEX,Coll_Total,Coll_TotalHC,Exp_NSEFO,Exp_MCD
		,Exp_NSX,Exp_MCX,Exp_NCDEX,Exp_Cash,Exp_Gross,Margin_NSEFO,Margin_MCD,Margin_NSX,Margin_MCX,Margin_NCDEX,Margin_Total,Margin_Shortage
		,Margin_Violation,MOS,Pure_Risk,SB_CrAdjwithPureRisk,Proj_Risk,SB_CrAdjwithProjRisk,SB_Cr_Adjusted,UB_Loss
		,CashColl_Total,Debit_Days,Last_Bill_Date,Report_Type,RiskCategory,Net_Collection,Gross_Collection,Gross_Collection_Perc
		,Risk_Inc_Dec,Risk_Inc_Dec_Perc,Pure_Net_Collection,Proj_Net_Collection,BSX_Ledger,Coll_BSX,Exp_BSX,Margin_BSX,MTF_Ledger

		INTO #TBL_RMS_COLLECTION_CLI
		FROM  [196.1.115.182].GENERAL.dbo.TBL_RMS_COLLECTION_CLI with(nolock)
		


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE TBL_RMS_COLLECTION_CLI_Prev

		INSERT INTO TBL_RMS_COLLECTION_CLI_Prev(
					Party_Code,Cash,Derivatives,Currency,Commodities,DP,NBFC,ABL_Net,ACBL_Net,NBFC_Net,Deposit,Net_Debit,Net_Available,BSE_Ledger,NSE_Ledger
			,NSEFO_Ledger,MCD_Ledger,NSX_Ledger,MCX_Ledger,NCDEX_Ledger,NBFC_Ledger,Net_Ledger,UnReco_Credit,Hold_BlueChip,Hold_Good,Hold_Poor
			,Hold_Junk,Hold_Total,Hold_TotalHC,Coll_NSEFO,Coll_MCD,Coll_NSX,Coll_MCX,Coll_NCDEX,Coll_Total,Coll_TotalHC,Exp_NSEFO,Exp_MCD
			,Exp_NSX,Exp_MCX,Exp_NCDEX,Exp_Cash,Exp_Gross,Margin_NSEFO,Margin_MCD,Margin_NSX,Margin_MCX,Margin_NCDEX,Margin_Total,Margin_Shortage
			,Margin_Violation,MOS,Pure_Risk,SB_CrAdjwithPureRisk,Proj_Risk,SB_CrAdjwithProjRisk,SB_Cr_Adjusted,UB_Loss
			,CashColl_Total,Debit_Days,Last_Bill_Date,Report_Type,RiskCategory,Net_Collection,Gross_Collection,Gross_Collection_Perc
			,Risk_Inc_Dec,Risk_Inc_Dec_Perc,Pure_Net_Collection,Proj_Net_Collection,BSX_Ledger,Coll_BSX,Exp_BSX,Margin_BSX,MTF_Ledger
		)
		SELECT 
				Party_Code,Cash,Derivatives,Currency,Commodities,DP,NBFC,ABL_Net,ACBL_Net,NBFC_Net,Deposit,Net_Debit,Net_Available,BSE_Ledger,NSE_Ledger
		,NSEFO_Ledger,MCD_Ledger,NSX_Ledger,MCX_Ledger,NCDEX_Ledger,NBFC_Ledger,Net_Ledger,UnReco_Credit,Hold_BlueChip,Hold_Good,Hold_Poor
		,Hold_Junk,Hold_Total,Hold_TotalHC,Coll_NSEFO,Coll_MCD,Coll_NSX,Coll_MCX,Coll_NCDEX,Coll_Total,Coll_TotalHC,Exp_NSEFO,Exp_MCD
		,Exp_NSX,Exp_MCX,Exp_NCDEX,Exp_Cash,Exp_Gross,Margin_NSEFO,Margin_MCD,Margin_NSX,Margin_MCX,Margin_NCDEX,Margin_Total,Margin_Shortage
		,Margin_Violation,MOS,Pure_Risk,SB_CrAdjwithPureRisk,Proj_Risk,SB_CrAdjwithProjRisk,SB_Cr_Adjusted,UB_Loss
		,CashColl_Total,Debit_Days,Last_Bill_Date,Report_Type,RiskCategory,Net_Collection,Gross_Collection,Gross_Collection_Perc
		,Risk_Inc_Dec,Risk_Inc_Dec_Perc,Pure_Net_Collection,Proj_Net_Collection,BSX_Ledger,Coll_BSX,Exp_BSX,Margin_BSX,MTF_Ledger
		 FROM TBL_RMS_COLLECTION_CLI WITH (NOLOCK)
		
		DROP SYNONYM TBL_RMS_COLLECTION_CLI_syn

		CREATE SYNONYM TBL_RMS_COLLECTION_CLI_syn for TBL_RMS_COLLECTION_CLI_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE TBL_RMS_COLLECTION_CLI

		INSERT INTO TBL_RMS_COLLECTION_CLI
		(
				Party_Code,Cash,Derivatives,Currency,Commodities,DP,NBFC,ABL_Net,ACBL_Net,NBFC_Net,Deposit,Net_Debit,Net_Available,BSE_Ledger,NSE_Ledger
		,NSEFO_Ledger,MCD_Ledger,NSX_Ledger,MCX_Ledger,NCDEX_Ledger,NBFC_Ledger,Net_Ledger,UnReco_Credit,Hold_BlueChip,Hold_Good,Hold_Poor
		,Hold_Junk,Hold_Total,Hold_TotalHC,Coll_NSEFO,Coll_MCD,Coll_NSX,Coll_MCX,Coll_NCDEX,Coll_Total,Coll_TotalHC,Exp_NSEFO,Exp_MCD
		,Exp_NSX,Exp_MCX,Exp_NCDEX,Exp_Cash,Exp_Gross,Margin_NSEFO,Margin_MCD,Margin_NSX,Margin_MCX,Margin_NCDEX,Margin_Total,Margin_Shortage
		,Margin_Violation,MOS,Pure_Risk,SB_CrAdjwithPureRisk,Proj_Risk,SB_CrAdjwithProjRisk,SB_Cr_Adjusted,UB_Loss
		,CashColl_Total,Debit_Days,Last_Bill_Date,Report_Type,RiskCategory,Net_Collection,Gross_Collection,Gross_Collection_Perc
		,Risk_Inc_Dec,Risk_Inc_Dec_Perc,Pure_Net_Collection,Proj_Net_Collection,BSX_Ledger,Coll_BSX,Exp_BSX,Margin_BSX,MTF_Ledger
		)
		SELECT	
		Party_Code,Cash,Derivatives,Currency,Commodities,DP,NBFC,ABL_Net,ACBL_Net,NBFC_Net,Deposit,Net_Debit,Net_Available,BSE_Ledger,NSE_Ledger
,NSEFO_Ledger,MCD_Ledger,NSX_Ledger,MCX_Ledger,NCDEX_Ledger,NBFC_Ledger,Net_Ledger,UnReco_Credit,Hold_BlueChip,Hold_Good,Hold_Poor
,Hold_Junk,Hold_Total,Hold_TotalHC,Coll_NSEFO,Coll_MCD,Coll_NSX,Coll_MCX,Coll_NCDEX,Coll_Total,Coll_TotalHC,Exp_NSEFO,Exp_MCD
,Exp_NSX,Exp_MCX,Exp_NCDEX,Exp_Cash,Exp_Gross,Margin_NSEFO,Margin_MCD,Margin_NSX,Margin_MCX,Margin_NCDEX,Margin_Total,Margin_Shortage
,Margin_Violation,MOS,Pure_Risk,SB_CrAdjwithPureRisk,Proj_Risk,SB_CrAdjwithProjRisk,SB_Cr_Adjusted,UB_Loss
,CashColl_Total,Debit_Days,Last_Bill_Date,Report_Type,RiskCategory,Net_Collection,Gross_Collection,Gross_Collection_Perc
,Risk_Inc_Dec,Risk_Inc_Dec_Perc,Pure_Net_Collection,Proj_Net_Collection,BSX_Ledger,Coll_BSX,Exp_BSX,Margin_BSX,MTF_Ledger
		
		 FROM #TBL_RMS_COLLECTION_CLI

		DROP SYNONYM TBL_RMS_COLLECTION_CLI_syn

		CREATE SYNONYM TBL_RMS_COLLECTION_CLI_syn for TBL_RMS_COLLECTION_CLI

		/*
		----Same table craeted on 42 
		EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.vw_Dashboard_sbrisk'
		
		INSERT INTO [172.31.16.42].[IPartner].Dbo.vw_Dashboard_sbrisk 
		(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		 FROM vw_Dashboard_sbrisk
		 */
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_tbl_rms_collection_cli_NXT
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_AMD_tbl_rms_collection_cli_NXT]
AS 
--EXEC USP_AMD_tbl_rms_collection_cli_NXT

BEGIN

SET NOCOUNT ON
		
		IF OBJECT_ID('TEMPDB..#tbl_rms_collection_cli_NXT') IS NOT NULL
			DROP TABLE #tbl_rms_collection_cli_NXT


		SELECT		[party_code],[net_ledger],[upd_date] ,ledgerBal
		INTO #tbl_rms_collection_cli_NXT
		FROM [196.1.115.182].general.dbo.tbl_rms_collection_cli_NXT with (nolock) --Vw_RmsDtclFi_Collection


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE tbl_rms_collection_cli_NXT_Prev

		INSERT INTO tbl_rms_collection_cli_NXT_Prev
		(
				[party_code],[net_ledger],[upd_date],ledgerBal	
			)
		SELECT 
				[party_code],[net_ledger],[upd_date],ledgerBal	
	
		 FROM tbl_rms_collection_cli_NXT WITH (NOLOCK)
		
		DROP SYNONYM tbl_rms_collection_cli_NXT_Syn

		CREATE SYNONYM tbl_rms_collection_cli_NXT_Syn for tbl_rms_collection_cli_NXT_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE tbl_rms_collection_cli_NXT

		
		INSERT INTO tbl_rms_collection_cli_NXT
		(
				[party_code],[net_ledger],[upd_date]	,ledgerBal
			)
		SELECT	 				[party_code],[net_ledger],[upd_date],ledgerBal	
			FROM #tbl_rms_collection_cli_NXT

		DROP SYNONYM tbl_rms_collection_cli_NXT_Syn

		CREATE SYNONYM tbl_rms_collection_cli_NXT_Syn for tbl_rms_collection_cli_NXT



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_TempUserMaster
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_TempUserMaster]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#TempUserMaster') IS NOT NULL
			DROP TABLE #TempUserMaster
			
		
		select username,InsertedOn into #TempUserMaster from [196.1.115.132].[ROLEMGM].dbo.TempUserMaster with(nolock)
				--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE TempUserMaster_Prev

		INSERT INTO TempUserMaster_Prev( username,InsertedOn )
		SELECT username,InsertedOn  FROM TempUserMaster WITH (NOLOCK)
		
		DROP SYNONYM TempUserMaster_syn

		CREATE SYNONYM TempUserMaster_syn for TempUserMaster_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE TempUserMaster

		INSERT INTO TempUserMaster( username,InsertedOn )
		SELECT	username,InsertedOn  FROM #TempUserMaster

		DROP SYNONYM TempUserMaster_syn

		CREATE SYNONYM TempUserMaster_syn for TempUserMaster

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Amd_UntilityView_Notification
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_UntilityView_Notification]    
AS    
BEGIN    

SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType into #Test 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -1, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification_PREV   


 INSERT INTO UntilityView_Notification_PREV (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
)
 SELECT 
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
FROM UntilityView_Notification with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification  
   
 INSERT INTO UntilityView_Notification (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
) 
    
select * from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where 
		CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -1, GETDATE())    
) T
--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_UntilityView_Notification_Bkp13Sept2022
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_UntilityView_Notification_Bkp13Sept2022]    
AS    
BEGIN    

SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType into #Test 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -7, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification_PREV   


 INSERT INTO UntilityView_Notification_PREV (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
)
 SELECT 
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
FROM UntilityView_Notification with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification  
   
 INSERT INTO UntilityView_Notification (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
) 
    
select * from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where 
		CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -7, GETDATE())    
) T
--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_UntilityView_Notification_Bkp14Sept2022
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_UntilityView_Notification_Bkp14Sept2022]    
AS    
BEGIN    

SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType into #Test 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -7, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification_PREV   


 INSERT INTO UntilityView_Notification_PREV (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
)
 SELECT 
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
FROM UntilityView_Notification with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification  
   
 INSERT INTO UntilityView_Notification (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
) 
    
select * from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where 
		CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -7, GETDATE())    
) T
--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_UntilityView_Notification_V1_DeplyLive
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_AMD_UntilityView_Notification_V1_DeplyLive]    
AS    
BEGIN    

SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType into #Test 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -1, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification_PREV   


 INSERT INTO UntilityView_Notification_PREV (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
)
 SELECT 
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
FROM UntilityView_Notification with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE UntilityView_Notification  
   
 INSERT INTO UntilityView_Notification (
RN
,sub_broker
,NotificationText
,CampaignId
,NotificationType
,CreatedBy
,CreatedDate
,CNT
,sub_brokercnt
,IsInActive
,StartDate
,StartTime
,ExpiryDate
,ExpiryTime
) 
    
select * from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where 
		CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -1, GETDATE())    
) T
--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM UntilityView_Notification_syn

		CREATE SYNONYM UntilityView_Notification_syn for UntilityView_Notification

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_user_type_mapper
-- --------------------------------------------------
CREATE PROCEDURE USP_AMD_user_type_mapper
AS
BEGIN

TRUNCATE TABLE user_type_mapper

INSERT INTO user_type_mapper([angelId], [userType], [IsCorporateUser], [tempId], [MF_BOStatus], [NBFCStatus])
SELECT [angelId], [userType], [IsCorporateUser], [tempId], [MF_BOStatus], [NBFCStatus]

FROM [172.31.16.75].angel_wms.dbo.user_type_mapper WITH(NOLOCK)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_vw_AngelPlatinum_ClientInfo
-- --------------------------------------------------


/******************************
Created By: Narendra
Date : 10-05-2018

********************************/


CREATE PROCEDURE [dbo].[Usp_AMD_vw_AngelPlatinum_ClientInfo]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#vw_AngelPlatinum_ClientInfo') IS NOT NULL
			DROP TABLE #vw_AngelPlatinum_ClientInfo


		SELECT	*
		INTO #vw_AngelPlatinum_ClientInfo
		FROM [196.1.115.167].kyc_ci.dbo.vw_AngelPlatinum_ClientInfo with(nolock)
		


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE vw_AngelPlatinum_ClientInfo_Prev

		INSERT INTO vw_AngelPlatinum_ClientInfo_Prev
		SELECT 
			ClientCode,CommunicationDate,ClientId,CreationDate,PushedSource,IsAgreementGiven,AgreementGivenDate,IsPaymentReceived,PaymentReceivedDate
			,IsRiskProfilingDone,RiskProfilingDoneDate,ExpiryDate,IsActive,ActivationDate,Profile,LeadSource,Ecode,IsDeleted,DeletedDate,IsConfirmationGiven
			,ConfirmationGivenDate,Interested,Interested_Date,Interested_Count,RequestCallback,RequestCallback_Date,RequestCallback_Count,Status
		 FROM vw_AngelPlatinum_ClientInfo WITH (NOLOCK)
		
		DROP SYNONYM vw_AngelPlatinum_ClientInfo_syn

		CREATE SYNONYM vw_AngelPlatinum_ClientInfo_syn for vw_AngelPlatinum_ClientInfo_Prev



		--------------------------Original Table Insert------------------

		TRUNCATE TABLE vw_AngelPlatinum_ClientInfo

		INSERT INTO vw_AngelPlatinum_ClientInfo
		SELECT	
			ClientCode,CommunicationDate,ClientId,CreationDate,PushedSource,IsAgreementGiven,AgreementGivenDate,IsPaymentReceived,PaymentReceivedDate
			,IsRiskProfilingDone,RiskProfilingDoneDate,ExpiryDate,IsActive,ActivationDate,Profile,LeadSource,Ecode,IsDeleted,DeletedDate,IsConfirmationGiven
			,ConfirmationGivenDate,Interested,Interested_Date,Interested_Count,RequestCallback,RequestCallback_Date,RequestCallback_Count,Status
		 FROM #vw_AngelPlatinum_ClientInfo

		DROP SYNONYM vw_AngelPlatinum_ClientInfo_syn

		CREATE SYNONYM vw_AngelPlatinum_ClientInfo_syn for vw_AngelPlatinum_ClientInfo

		/*
		----Same table craeted on 42 
		EXEC [172.31.16.42].[IPartner].sys.sp_executesql N'Truncate table dbo.vw_Dashboard_sbrisk'
		
		INSERT INTO [172.31.16.42].[IPartner].Dbo.vw_Dashboard_sbrisk 
		(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		 FROM vw_Dashboard_sbrisk
		 */
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Amd_VW_Client_DPBal
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_Amd_VW_Client_DPBal]
		AS
	BEGIN
		SET NOCOUNT ON
		--IF OBJECT_ID('TEMPDB..#VW_Client_DPBal') IS NOT NULL
		--	DROP TABLE #VW_Client_DPBal
			
		
		--select username,InsertedOn into #VW_Client_DPBal from [196.1.115.132].[ROLEMGM].dbo.VW_Client_DPBal with(nolock)
				--------------------------Prev Table Insert------------------
		
		TRUNCATE TABLE VW_Client_DPBal_Prev

		INSERT INTO VW_Client_DPBal_Prev( 
					PARTY_CODE,CLIENT_CODE,ACTUAL_AMOUNT,ACCRUAL_BAL,BRANCH_CODE

)
		SELECT 
				PARTY_CODE,CLIENT_CODE,ACTUAL_AMOUNT,ACCRUAL_BAL,BRANCH_CODE
		FROM VW_Client_DPBal WITH (NOLOCK)
		
		DROP SYNONYM VW_Client_DPBal_syn

		CREATE SYNONYM VW_Client_DPBal_syn for VW_Client_DPBal_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE VW_Client_DPBal

		INSERT INTO VW_Client_DPBal( 
				PARTY_CODE,CLIENT_CODE,ACTUAL_AMOUNT,ACCRUAL_BAL,BRANCH_CODE
		)
		SELECT	
			PARTY_CODE,CLIENT_CODE,ACTUAL_AMOUNT,ACCRUAL_BAL,BRANCH_CODE
		FROM  [196.1.115.182].GENERAL.DBO.VW_Client_DPBal WITH (NOLOCK)

		DROP SYNONYM VW_Client_DPBal_syn

		CREATE SYNONYM VW_Client_DPBal_syn for VW_Client_DPBal

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_vw_Dashboard_sbrisk
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_vw_Dashboard_sbrisk]
	AS
	BEGIN
		SET NOCOUNT ON


-------------------------************Mail*********--------------------

Declare @StartDate Datetime=Getdate(),
@subject varchar(100),
@BodyContent varchar(2000)

Set @subject='Dashboard Risk job started at '+' ' +convert(varchar(20),Getdate())


EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
--@recipients = 'yogesh.rewatkar@angelbroking.com;jogendar.dhoble@angelbroking.com;
--chhabiraj.chaurasia@angelbroking.com;girish.bind@angelbroking.com;subbulakshmi.sk@angelbroking.com;
--vishal@angelbroking.com;vijayprakash.yadav@angelbroking.com;nitin.agrawal@angelbroking.com;nxtteam@angelbroking.com;
--poonam.chaudhary@angelbroking.com;bhupesh.maisuria@angelbroking.com;tanmay.bhattacharya@angelbroking.com;priyanka.bist@angelbroking.com', 
@recipients = 'yogesh.rewatkar@angelbroking.com', 
	            @subject = @subject,
                @body=
				'Hello All,

				Dashboard risk job started.',
				@from_address   = 'nxt@angelbroking.com'
		 
-------------------------************Mail*********--------------------
   



/*Index Drop*/

IF EXISTS(SELECT * FROM sys.indexes WHERE object_id = object_id('dbo.vw_Dashboard_sbrisk') AND NAME ='IX_MISSING_vw_Dashboard_sbrisk')
		Drop INDEX [IX_MISSING_vw_Dashboard_sbrisk] ON [dbo].[vw_Dashboard_sbrisk]
		
IF EXISTS(SELECT * FROM sys.indexes WHERE object_id = object_id('dbo.vw_Dashboard_sbrisk') AND NAME ='ix_vw_Dashboard_sbrisk')
		Drop INDEX [ix_vw_Dashboard_sbrisk] ON [dbo].[vw_Dashboard_sbrisk]

IF EXISTS(SELECT * FROM sys.indexes WHERE object_id = object_id('dbo.vw_Dashboard_sbrisk') AND NAME ='ix_vw_Dashboard_sbrisk_SUB_BROKER_Net_collection')
		Drop INDEX [ix_vw_Dashboard_sbrisk_SUB_BROKER_Net_collection] ON [dbo].[vw_Dashboard_sbrisk]

IF EXISTS(SELECT * FROM sys.indexes WHERE object_id = object_id('dbo.vw_Dashboard_sbrisk_Prev') AND NAME ='IX_MISSING_vw_Dashboard_sbrisk_Prev')
		Drop INDEX [IX_MISSING_vw_Dashboard_sbrisk_Prev] ON [dbo].[vw_Dashboard_sbrisk_Prev]

IF EXISTS(SELECT * FROM sys.indexes WHERE object_id = object_id('dbo.vw_Dashboard_sbrisk_Prev') AND NAME ='ix_vw_Dashboard_sbrisk_Prev')
		Drop INDEX [ix_vw_Dashboard_sbrisk_Prev] ON [dbo].[vw_Dashboard_sbrisk_Prev]

IF EXISTS(SELECT * FROM sys.indexes WHERE object_id = object_id('dbo.vw_Dashboard_sbrisk_Prev') AND NAME ='ix_vw_Dashboard_sbrisk_Prev_SUB_BROKER_Net_collection')
		Drop INDEX [ix_vw_Dashboard_sbrisk_Prev_SUB_BROKER_Net_collection] ON [dbo].[vw_Dashboard_sbrisk_Prev]



		IF OBJECT_ID('TEMPDB..#vw_Dashboard_sbrisk') IS NOT NULL
			DROP TABLE #vw_Dashboard_sbrisk

		
		SELECT	party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date
		INTO #vw_Dashboard_sbrisk
		FROM [196.1.115.182].general.dbo.vw_Dashboard_sbrisk WITH (NOLOCK)


		--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE vw_Dashboard_sbrisk_Prev

		INSERT INTO vw_Dashboard_sbrisk_Prev
		SELECT * FROM vw_Dashboard_sbrisk WITH (NOLOCK)
		
		DROP SYNONYM vw_Dashboard_sbrisk_syn

		CREATE SYNONYM vw_Dashboard_sbrisk_syn for vw_Dashboard_sbrisk_Prev

		
		--------------------------Original Table Insert------------------

		TRUNCATE TABLE vw_Dashboard_sbrisk

		INSERT INTO vw_Dashboard_sbrisk(party_code,long_name,Reason,Risk,SUB_BROKER,Net_collection,Pure_Risk,shortage_value,squareoffvalue,square_off_type,square_off_date)
		SELECT	* FROM #vw_Dashboard_sbrisk

		DROP SYNONYM vw_Dashboard_sbrisk_syn

		CREATE SYNONYM vw_Dashboard_sbrisk_syn for vw_Dashboard_sbrisk



/*Index creation*/		
		
/****** Object:  Index [IX_MISSING_vw_Dashboard_sbrisk]    Script Date: 2/7/2019 11:32:18 AM ******/
CREATE NONCLUSTERED INDEX [IX_MISSING_vw_Dashboard_sbrisk] ON [dbo].[vw_Dashboard_sbrisk]
(
	[square_off_type] ASC
)

/****** Object:  Index [ix_vw_Dashboard_sbrisk]    Script Date: 2/7/2019 11:32:21 AM ******/
CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk] ON [dbo].[vw_Dashboard_sbrisk]
(
	[SUB_BROKER] ASC,
	[Net_collection] ASC
)


CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk_SUB_BROKER_Net_collection] ON [dbo].[vw_Dashboard_sbrisk]
(
	[SUB_BROKER] ASC,
	[Net_collection] ASC
)
INCLUDE ( 	[party_code],
	[long_name  ],
	[Reason],
	[Pure_Risk],
	[shortage_value],
	[squareoffvalue],
	[square_off_type],
	[square_off_date]
) 

-----------------------------------------------------------------------------


/****** Object:  Index [IX_MISSING_vw_Dashboard_sbrisk_Prev]    Script Date: 2/7/2019 11:32:18 AM ******/
CREATE NONCLUSTERED INDEX [IX_MISSING_vw_Dashboard_sbrisk_Prev] ON [dbo].[vw_Dashboard_sbrisk_Prev]
(
	[square_off_type] ASC
)





/****** Object:  Index [ix_vw_Dashboard_sbrisk_Prev_NetColl]    Script Date: 2/7/2019 11:32:25 AM ******/
CREATE NONCLUSTERED INDEX ix_vw_Dashboard_sbrisk_Prev ON [dbo].[vw_Dashboard_sbrisk_Prev]
(
	[SUB_BROKER] ASC,
	[Net_collection] ASC
)



CREATE NONCLUSTERED INDEX [ix_vw_Dashboard_sbrisk_Prev_SUB_BROKER_Net_collection] ON [dbo].[vw_Dashboard_sbrisk_Prev]
(
	[SUB_BROKER] ASC,
	[Net_collection] ASC
)
INCLUDE ( 	[party_code],
	[long_name],
	[Reason],
	[Pure_Risk],
	[shortage_value],
	[squareoffvalue],
	[square_off_type],
	[square_off_date]
) 

--------------------------Update job log time for showing in dashboard---------------

--insert into  job_StatusNXT_log
--Set updatetime=Getdate()
--where id=1
--and Modulename='Dashboard Risk'


INSERT INTO  job_StatusNXT_log(JobName	,Modulename	,UpdateTime)
SELECT 
	'Usp_AMD_vw_Dashboard_sbrisk',
	'Dashboard Risk',
	getdate()

--------------------******************-------------------------------

Set @subject='Dashboard Risk job completed successfully at '+' ' +convert(varchar(20),Getdate())

EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
@recipients = 'yogesh.rewatkar@angelbroking.com', 
	            @subject = @subject,
                @body=
				'Hello All,

				Dashboard risk job completed successfully.',
				@from_address   = 'nxt@angelbroking.com'
		 
-----------------------------***  Mail ***********----------------------




	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_vw_LMSSB_cityMaster
-- --------------------------------------------------
create procedure usp_amd_vw_LMSSB_cityMaster
as
begin

Truncate table vw_LMSSB_cityMaster

		insert into vw_LMSSB_cityMaster(Rcity)
		select Rcity from [196.1.115.207].CRM.dbo.[vw_LMSSB_cityMaster] with (nolock)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_amd_vw_MutualFundPendingOrder_NCMS
-- --------------------------------------------------
CREATE procedure [dbo].[usp_amd_vw_MutualFundPendingOrder_NCMS]
as
begin

delete from vw_MutualFundPendingOrder_NCMS 
where clientcode not in (select clientcode from [196.1.115.132].risk.dbo.vw_MutualFundPendingOrder_NCMS a WITH (NOLOCK))
  --ON A.clientcode=b.clientcode


Update b
set 
	Segment	=A.Segment
	,Amount =A.Amount

From vw_MutualFundPendingOrder_NCMS b
inner join [196.1.115.132].risk.dbo.vw_MutualFundPendingOrder_NCMS a WITH (NOLOCK)
  ON A.clientcode=b.clientcode


 insert into vw_MutualFundPendingOrder_NCMS
  select 
		  a.clientcode	
		,a.Segment	
		,a.Amount 
  
  from [196.1.115.132].risk.dbo.vw_MutualFundPendingOrder_NCMS a WITH (NOLOCK)
  left join vw_MutualFundPendingOrder_NCMS B
  ON a.clientcode=B.clientcode
where  B.clientcode is null
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AMD_VW_ONLY_MF_TAG
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_AMD_VW_ONLY_MF_TAG]
	AS
	BEGIN
		SET NOCOUNT ON
		IF OBJECT_ID('TEMPDB..#VW_ONLY_MF_TAG') IS NOT NULL
			DROP TABLE #VW_ONLY_MF_TAG
			
		
		select Sbtag into #VW_ONLY_MF_TAG from [196.1.115.167].[sb_comp].dbo.VW_ONLY_MF_TAG with(nolock)
				--------------------------Prev Table Insert------------------

		
		TRUNCATE TABLE VW_ONLY_MF_TAG_Prev

		INSERT INTO VW_ONLY_MF_TAG_Prev( Sbtag )
		SELECT Sbtag  FROM VW_ONLY_MF_TAG WITH (NOLOCK)
		
		DROP SYNONYM VW_ONLY_MF_TAG_syn

		CREATE SYNONYM VW_ONLY_MF_TAG_syn for VW_ONLY_MF_TAG_Prev


		--------------------------Original Table Insert------------------

		TRUNCATE TABLE VW_ONLY_MF_TAG

		INSERT INTO VW_ONLY_MF_TAG( Sbtag )
		SELECT	Sbtag  FROM #VW_ONLY_MF_TAG

		DROP SYNONYM VW_ONLY_MF_TAG_syn

		CREATE SYNONYM VW_ONLY_MF_TAG_syn for VW_ONLY_MF_TAG

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_Vw_RMS_Client_Vertical
-- --------------------------------------------------
CREATE  PROCEDURE [dbo].[USP_AMD_Vw_RMS_Client_Vertical]
AS
BEGIN
SET NOCOUNT ON

CREATE TABLE #Vw_RMS_CLIENT_Vertical_182
(
	SB VARCHAR(10),
	[Client] VARCHAR(10)
)

iNSERT INTO #Vw_RMS_CLIENT_Vertical_182
SELECT SB,[Client] FROM [196.1.115.182].general.dbo.Vw_RMS_CLIENT_Vertical RCV WITH(NOLOCK)   --1942560


insert into [Vw_RMS_Client_Vertical](SB,[Client])
 select distinct rcv.SB,RCV.[Client]
  from  #Vw_RMS_CLIENT_Vertical_182 rcv --1942560
  left join [Vw_RMS_Client_Vertical] B
  ON RCV.[Client]=B.[Client]
  where B.Client is null

DROP TABLE #Vw_RMS_CLIENT_Vertical_182

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_Vw_RMS_Client_Vertical_Trun
-- --------------------------------------------------
CREATE procedure [dbo].[USP_AMD_Vw_RMS_Client_Vertical_Trun]
as
begin 

CREATE TABLE #Vw_RMS_CLIENT_Vertical
(
	SB VARCHAR(10),
	[Client] VARCHAR(10)
)

INSERT INTO #Vw_RMS_CLIENT_Vertical
SELECT SB,[Client] FROM [196.1.115.182].general.dbo.Vw_RMS_CLIENT_Vertical RCV WITH(NOLOCK)   --1942560

Truncate table [Vw_RMS_Client_Vertical]

insert into [Vw_RMS_Client_Vertical](SB,[Client])
 select distinct SB,[Client]
  from  #Vw_RMS_CLIENT_Vertical --1942560

Drop table #Vw_RMS_CLIENT_Vertical

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_AMD_vwEquitySIP
-- --------------------------------------------------
create PROCEDURE [dbo].[USP_AMD_vwEquitySIP]    
AS    
BEGIN    

--------------------------Prev Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE vwEquitySIP_PREV   


 INSERT INTO vwEquitySIP_PREV (
EquitySIP_Header_ID
,UserId
,GroupCode
,BasketName
,StartDate
,EndDate
,Frequency
,NoOfOccurence
,TotalAmount
,Exchange
,DebitType
,SIPStatus
,CreatedOn
)
 SELECT 
EquitySIP_Header_ID
,UserId
,GroupCode
,BasketName
,StartDate
,EndDate
,Frequency
,NoOfOccurence
,TotalAmount
,Exchange
,DebitType
,SIPStatus
,CreatedOn
FROM vwEquitySIP with(nolock)    
--------------------------DROP AND CREATE SYNONYM OF PREV TABLE------------------

		DROP SYNONYM vwEquitySIP_syn

		CREATE SYNONYM vwEquitySIP_syn for vwEquitySIP_PREV

--------------------------Original Table TRUNCATE AND INSERT------------------

 TRUNCATE TABLE vwEquitySIP  
   
 INSERT INTO vwEquitySIP (
EquitySIP_Header_ID
,UserId
,GroupCode
,BasketName
,StartDate
,EndDate
,Frequency
,NoOfOccurence
,TotalAmount
,Exchange
,DebitType
,SIPStatus
,CreatedOn
) 
    
 SELECT  
EquitySIP_Header_ID
,UserId
,GroupCode
,BasketName
,StartDate
,EndDate
,Frequency
,NoOfOccurence
,TotalAmount
,Exchange
,DebitType
,SIPStatus
,CreatedOn
FROM [196.1.115.227].[Angel_Admin].[dbo].[vwEquitySIP] with(nolock)

--------------------------DROP AND CREATE SYNONYM OF ORIGINAL TABLE------------------
		DROP SYNONYM vwEquitySIP_syn

		CREATE SYNONYM vwEquitySIP_syn for vwEquitySIP

 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_ApproveSelfDeclaration
-- --------------------------------------------------
CREATE PROCEDURE usp_ApproveSelfDeclaration       
@SBTag VARCHAR(100),
@FinYear VARCHAR(100),
@EmpName NVARCHAR(100)
        
AS        
BEGIN 	
	SET NOCOUNT ON; 

	UPDATE dbo.sb_Declaration  
	SET IsApproved = 1,
		UpdatedBy = @EmpName,
		UpdatedDate = GETDATE()
	WHERE SBTag = @SBTag AND FnYear = @FinYear
           
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Bank_receipt_report
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			09-oct-2018
	AUTHOR:			Narendra
	DESCRIPTION:





	exec usp_Bank_receipt_report 'P94439'
	**************************************************/
CREATE PROCEDURE [dbo].[usp_Bank_receipt_report]
(@party_code VARCHAR(50)
)

AS
BEGIN

SET NOCOUNT ON

SELECT row_number() over (order by party_code)  'Sr_No',
(case when convert(varchar(11),B.RELDT_CR,106)='01 Jan 1900' then '-' else convert(varchar(11),B.RELDT_CR,106) end) as Realization_Date,
convert(varchar(11) ,a.EDT,106) as 'Date_Of_Reconcilliation',
PARTY_CODE as 'Client_Code',
ACNAME as Client_Name,
(CASE WHEN CHECKED_BY LIKE '%TPR%' THEN 'CLEAR' ELSE
(CASE WHEN B.RELDT_CR='' THEN 'UNCLEAR' ELSE 'CLEAR' END) END) AS  Unrealized_Status,
INSTNO as Cheque_No,
a.amount as Amount
  FROM (
SELECT VNO,VDT,EDT,CLTCODE AS PARTY_CODE,VTYPE ,CRAMOUNT AS AMOUNT, 'BSE' AS EXCHANGE,'MFSS' AS SEGMENT 
FROM [AngelFO].bbo_fa.dbo.MFSS_LEDGER_BSE  WITH(NOLOCK)  WHERE VTYPE =2 AND VDT >=CONVERT(VARCHAR(11),GETDATE()-15,120) 
AND CRAMOUNT <> 0 AND CLTCODE =@party_code
UNION ALL 
SELECT VNO,VDT,EDT,CLTCODE AS PARTY_CODE,VTYPE ,CRAMOUNT AS AMOUNT, 'NSE' AS EXCHANGE,'MFSS' AS SEGMENT 
FROM [AngelFO].bbo_fa.dbo.MFSS_LEDGER_NSE WITH(NOLOCK) WHERE VTYPE =2 AND VDT >=CONVERT(VARCHAR(11),GETDATE()-15,120)  AND CRAMOUNT <> 0 
 AND CLTCODE =@party_code
  )A 
LEFT OUTER JOIN 
(SELECT * FROM [AngelFO].bbo_fa.dbo.MFSS_REL_DATA_NEW  WITH(NOLOCK)
WHERE VTYPE =2 AND VDT >= REPLACE(CONVERT(VARCHAR(11),GETDATE()-15,120),'-','') 
)B
ON A.PARTY_CODE=CL_CODE  AND A.VNO =B.VNO 
ORDER BY PARTY_CODE,a.EDT  DESC

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BeeNXT_InsertErrorlog
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_BeeNXT_InsertErrorlog]
(
 @ProjectName Varchar (20) =Null
,@ModuleName Varchar (100) =Null
,@Controller Varchar (50) =Null
,@ErrorMsg varchar (max) =Null
,@Action varchar (50) =Null
,@API_URL varchar (1000) =Null
,@Request  varchar (max) =Null
,@Response Varchar (max) =Null
,@StackTrace varchar (max) =Null
,@CreatedBy Varchar (50) =Null
,@createdDate Datetime =Null
,@Event Varchar (20) =Null
,@IPadress Varchar (20) =Null

)
As
BEgin
--return 0
SET NOCOUNT ON

INSERt INTO Error_log
(
 ProjectName
,ModuleName
,Controller
,ErrorMsg
,Action
,API_URL
,Request
,Response
,StackTrace
,CreatedBy
,createdDate
,[Event]
,IPadress
)

Values (

 @ProjectName
,@ModuleName
,@Controller
,@ErrorMsg
,@Action
,@API_URL
,@Request
,@Response
,@StackTrace
,@CreatedBy
,GETDATE()
,@Event
,@IPadress
)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BeeNxt_Login_NXT_2_Mobile
-- --------------------------------------------------

-- EXEC USP_BeeNxt_Login_NXT_2_Mobile 'AKMAU001','AKMAU001'
-- EXEC USP_BeeNxt_Login_NXT_2_Mobile 'MFSBAXVPR','eez6qn3e'
-- EXEC USP_BeeNxt_Login_NXT_2_Mobile 'AANKU001','AANKU001'


CREATE Procedure [dbo].[USP_BeeNxt_Login_NXT_2_Mobile]

@USERNAME	VARCHAR(50),
@PASSWORD	VARCHAR(100)

AS

BEGIN

	DECLARE @message VARCHAR(50),@accessCode varchar(20),
	@point	int

	CREATE table #LoginDetails
	(access_code VARCHAR(20),
	access_to VARCHAR(20),	
	Device_Id VARCHAR(50),
	email VARCHAR(100),
	Message VARCHAR(50),
	Name VARCHAR(100),
	Result BIT,
	username VARCHAR(20),
	UserType VARCHAR(20),
	MFUserType VARCHAR(20),
	IsFirstLogin BIT
	)
	INSERT INTO #LoginDetails
	Exec [usp_MFNXTLogin_DealerANDSB]	@USERNAME,	@PASSWORD

	IF EXISTS ( SELECT 1 FROM #LoginDetails WITH(NOLOCK))
	BEGIN
		SELECT @message = ISNULL(Message,''),@accessCode = ISNULL(access_code,'') FROM #LoginDetails WITH(NOLOCK)
		IF (CHARINDEX('Invalid', @message)>0)
			--Update #LoginDetails set Message = 'FAILED'
			print 1
			
		ELSE
		BEGIN
			Update #LoginDetails set Message = 'SUCCESS'
		END
		SELECT @point = CHARINDEX('0',@accessCode)
		IF(@point > 1)
		BEGIN
			SELECT @accessCode = SUBSTRING(@accessCode, 1, @point - 1)
			UPDATE #LoginDetails SET access_code = @accessCode
		END
	END
		

	SELECT access_code,access_to,Device_Id,email,Message,Ltrim(Rtrim(Name)) as Name,Result,username,UserType,MFUserType,IsFirstLogin FROM #LoginDetails WITH(NOLOCK)


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_BulkIPO_GroupExists
-- --------------------------------------------------
CREATE PROCEDURE usp_BulkIPO_GroupExists
(
	@SBTag  VARCHAR(100),
	@GroupName VARCHAR(1000)
)
AS
BEGIN
	DECLARE @Exists BIT = 0
	SELECT @Exists = 1 FROM BulkIPO_ClientGroup WHERE Name = @GroupName AND SBTag = @SBTag

	SELECT @Exists
END
CREATE TYPE IPOGroupClients AS TABLE
(
	PartyCode VARCHAR(100),
	UPI VARCHAR(1000)
)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_BusinessdashboardActionsNXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_BusinessdashboardActionsNXT]
(
	@Subbroker Varchar(100),
	@ClientCode varchar(100),
	@Flag varchar(10),
	@Createdate datetime=NULL ,
	@CreatedBy Varchar(100),
	@Updatedate datetime=NULL
	


)
AS
BEGIN 


		IF not exists (select * from BusinessdashboardActionsNXT where Subbroker=@Subbroker and ClientCode=@ClientCode)
		begin

		Insert into BusinessdashboardActionsNXT(Subbroker,ClientCode,Flag,Createdate,CreatedBy,Updatedate)
			Select 	
				@Subbroker ,
				@ClientCode ,
				@Flag ,
				Getdate() Createdate ,
				@CreatedBy ,
				@Updatedate


			Select 1
				
		END
		ELSE 
		BEGIN

				Update BusinessdashboardActionsNXT
				Set Flag=@Flag
				,Updatedate=Getdate()
				,UpdatedBy=@CreatedBy
				where Subbroker=@Subbroker and ClientCode=@ClientCode

			Select 1

		END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_BusinessdashboardActionsNXT_Bkp21Nov2018
-- --------------------------------------------------
Create PROCEDURE [dbo].[usp_BusinessdashboardActionsNXT_Bkp21Nov2018]
(
	@Subbroker Varchar(100),
	@ClientCode varchar(100),
	@Flag varchar(10),
	@Createdate datetime=NULL ,
	@CreatedBy Varchar(100),
	@Updatedate datetime=NULL
	


)
AS
BEGIN 


		IF not exists (select * from BusinessdashboardActionsNXT where Subbroker=@Subbroker and ClientCode=@ClientCode)
		begin

		Insert into BusinessdashboardActionsNXT(Subbroker,ClientCode,Flag,Createdate,CreatedBy,Updatedate)
			Select 	
				@Subbroker ,
				@ClientCode ,
				@Flag ,
				Getdate() Createdate ,
				@CreatedBy ,
				@Updatedate


			Select 1
				
		END
		ELSE 
		BEGIN

				Update BusinessdashboardActionsNXT
				Set Flag=@Flag
				,Updatedate=Getdate()
				,UpdatedBy=@Createdate
				where Subbroker=@Subbroker and ClientCode=@ClientCode

			Select 1

		END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_check_sb_exist_EWelcome_access
-- --------------------------------------------------
CREATE procedure [dbo].usp_check_sb_exist_EWelcome_access(  
@sbTag NVARCHAR(50)
)  
AS      
BEGIN  
 SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END  
 FROM EWelcomeSBAccess  
 WHERE SBTAG = @sbTag  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_check_SBTagExist
-- --------------------------------------------------

CREATE procedure [dbo].usp_check_SBTagExist(  
@SBTag NVARCHAR(50),  
@CurrentRecordId INT = NULL  
)  
AS      
BEGIN  
 SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END  
 FROM SB_TeleBot_Reg  
 WHERE SBTag = @SBTag AND (@CurrentRecordId IS NULL OR (@CurrentRecordId IS NOT NULL AND ID <> @CurrentRecordId))  
 AND IsActive = 1
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CheckIfAdvisoryDataAlreadyUploadedForPeriod
-- --------------------------------------------------

CREATE procedure [dbo].[USP_CheckIfAdvisoryDataAlreadyUploadedForPeriod]  
( 
	@Period varchar(50) = '',
	@IsExist bit OUT
)    
as    
begin    
	DECLARE @Count INT;

	SELECT @Count = COUNT(*) From AdvisoryPerformanceReportData WHERE Period = @Period AND Active = 1;

	IF ISNULL(@Count, 0) > 0
	BEGIN
		SET @IsExist = 1;
	END
	ELSE
	BEGIN
		SET @IsExist = 0;
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CheckIfNotificationNXTCampaignExist
-- --------------------------------------------------

CREATE procedure [dbo].[USP_CheckIfNotificationNXTCampaignExist]  
( 
	@CampaignId varchar(100) = '',
	@IsExist bit OUT
)    
as    
begin 

Declare @Tdate date = CONVERT(DATE,GETDATE()-7)  

	DECLARE @Count INT;

	SELECT @Count = COUNT(*) From tbl_NotificationNXT with (nolock) WHERE CampaignId = @CampaignId and CreatedDate>@Tdate;

	IF ISNULL(@Count, 0) > 0
	BEGIN
		SET @IsExist = 1;
	END
	ELSE
	BEGIN
		SET @IsExist = 0;
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_checkIfPanExistAgainstSubBroker
-- --------------------------------------------------
CREATE PROCEDURE usp_checkIfPanExistAgainstSubBroker  
@Pan NVARCHAR(10)  
  
AS  
BEGIN  
 DECLARE @Count INT = 0  
   
 SELECT @Count = COUNT(PANNO) FROM [196.1.115.167].SB_COMP.dbo.VW_PR_TAG_DETAILS with(nolock) WHERE PANNO = @Pan  
  
 IF(@Count > 0)  
 BEGIN  
  SELECT 1 AS [Exists]  
 END  
 ELSE  
 BEGIN  
  SELECT 0 AS [Exists]  
 END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ClientCom_SMSClientWise_Ipartner
-- --------------------------------------------------

--USP_ClientCom_SMSClientWise_Ipartner 'VAJH1006','ALL','2024-02-01','2024-02-16'
CREATE PROCEDURE [dbo].[USP_ClientCom_SMSClientWise_Ipartner]
  (
	@ClientCode varchar(10) = 'r32712',
	@Flag 	varchar(50) = 'All',
	@FromDate datetime='2018-02-01',
	@Todate  datetime='2019-02-28'
  )
  AS
  /*
  declare @Todate datetime = getdate()
  declare @fromdate datetime = dateadd(year,-1,getdate())
  EXEC USP_ClientCom_SMSClientWise_Ipartner 'ALWR115',@Flag='ALL',@FromDate=@fromdate,@Todate=@Todate
  
  */
  
  BEGIN 

IF @Flag 	='All'
Begin
			print 'AAA'
	--- advisory sent by nxt but not made live on uat as well on 17 Dec 2017
	select * into #tempTable from (Select 
		MobileNo,	
		case when (message like '%(OTP)%' or message like '% OTP %') Then 'OTP Sent' ELSE message  END Message,
		TransmissionTime,
		--convert(varchar,TransmissionTime) TransmissionTime,
		party_code,
		'Advisory' Type 
	From   
		TBL_SMSQUEUE_Log  WITH (NOLOCk) where party_code=@ClientCode
	--Order by 3 desc

	--- advisory sent by nxt but not made live on uat as well on 17 Dec 2017
	UNION
    
	--- commmon 132 inhouse sms table 
	SELECT  
		to_no,	
		case when (message like '%(OTP)%' or message like '% OTP %') Then 'OTP Sent' ELSE message  END Message,
		CONVERT(DATETIME,date +' '+time  +' '+ ampm,103) AS TransmissionTime,
		--,date +' '+time +' '+ ampm ,
		UL.party_code,
		'All' Type
	FROM 
	    sb_client_details UL  WITH (NOLOCK) 
		INNER JOIN [INTRANET].[SMS].[dbo].[sms] SMS  WITH (NOLOCK) ON SMS.to_no=UL.mobile_pager
		WHERE UL.party_code=@ClientCode 
		and convert([date] ,date,105) >=  @FromDate and 
		convert([date] ,date,105) <= @Todate 

	--- commmon 132 inhouse sms table 

	UNION 

	--- square off data from sp , 182 general Get_SquareUp_T6T7_SMS_Log

	SELECT  
		A.MobileNo as MobileNO,
		A.SMS_Content Message,
		A.Msg_Date as TransmissionTime, 
		A.Party_Code as party_code,
		Msg_For as Type  
		--'All' as Type  
	FROM 
		[CSOKYC-6].general.dbo.Squareup_MsgLog A WITH (NOLOCK)  
		--INNER JOIN [CSOKYC-6].general.dbo.Vw_RMS_CLIENT_Vertical B WITH (NOLOCK) 
	--ON
	where 
		A.Party_code  = @ClientCode and
		--A.Party_code = B.Client and 
		CONVERT(DATE,Msg_Date,105)>=  @FromDate AND  
		CONVERT(DATE,Msg_Date,105)<= @Todate  

	--- square off data from sp , 182 general Get_SquareUp_T6T7_SMS_Log

	union
	-- mtf data from sp , 182 general Get_MTF_SMS_Log
	(
		  SELECT 
		  A.MobileNo,A.SMS_Content as [Message],A.Msg_Date as TransmissionTime, A.Party_Code as party_code, SQ_OFF_TYPE as Type
		  FROM
		  	[CSOKYC-6].general.dbo.MTF_SqqOff_MsgLog  A WITH (NOLOCK) 
		  	--INNER JOIN [CSOKYC-6].general.dbo.Vw_RMS_CLIENT_Vertical B WITH (NOLOCK) 
		  --ON 
		  	--A.Party_code = B.Client  
		  WHERE
			 A.Party_code = @ClientCode  AND  Msg_Date between  @FromDate AND @Todate
		 Union
		  SELECT A.MobileNo,A.SMS_Content as [Message],A.Msg_Date as TransmissionTime, A.Party_Code as party_code, SQ_OFF_TYPE as Type
		  FROM 
			[CSOKYC-6].general.dbo.MTFAgeing_T7_SqqOff_MsgLog A WITH (NOLOCK)  
			--INNER JOIN [CSOKYC-6].general.dbo.Vw_RMS_CLIENT_Vertical B WITH (NOLOCK) 
		  --ON A.Party_code = B.Client 
		  WHERE  A.Party_code = @ClientCode  AND  
		  CONVERT(DATE,Msg_Date,105)>=  @FromDate  AND 
		  CONVERT(DATE,Msg_Date,105)<= @Todate 
		Union  
		  SELECT A.MobileNo,A.SMS_Content as [Message],A.Msg_Date  as TransmissionTime, A.Party_Code as party_code, SQ_OFF_TYPE as Type
		  FROM [CSOKYC-6].general.dbo.Combine_MsgLog A WITH (NOLOCK)
		    --INNER JOIN [CSOKYC-6].general.dbo.Vw_RMS_CLIENT_Vertical B WITH (NOLOCK) 
		  --ON A.Party_code = B.Client 
		  WHERE A.Party_code = @ClientCode  AND  
		  CONVERT(DATE,Msg_Date ,105)>= @FromDate AND 
		  CONVERT(DATE,Msg_Date,105)<=  @Todate 

	)

	-- mtf data from sp , 182 general Get_MTF_SMS_Log

	UNION
	
	--- debit square of data from sp 182 general USP_SQUP_ALERT_RPT
	SELECT
		MOB_NUMBER AS MobileNo,
		MESS_MOB AS [Message],
		SENT_TIME AS TransmissionTime,
		CLIENT_CODE party_code,
		[Type]=(CASE WHEN TYPE='DEBIT' THEN TYPE ELSE 'SQUARE OFF' END )
	FROM 
		[CSOKYC-6].general.dbo.TBL_SQUP_ALERT_LOG A WITH(NOLOCK)
		--INNER JOIN VW_RMS_CLIENT_VERTICAL B WITH(NOLOCK) ON A.CLIENT_CODE=B.CLIENT
	WHERE
    ISNULL(MOB_NUMBER,'') <> ''
	AND CONVERT(DATE,[SENT_TIME] ,105) >= @FromDate  AND 
	CONVERT(DATE,[SENT_TIME],105) <=  @ToDate AND 
		A.CLIENT_CODE = @ClientCode
	  --and B.SB like 'ET'	   
	
	--- debit square of data from sp 182 general USP_SQUP_ALERT_RPT

	) as wholeTable

	
	select * from (select ID=ROW_NUMBER() OVER(partition by cast(TransmissionTime as date),Message ORDER BY TransmissionTime ),
	MobileNo,Message,TransmissionTime,party_code,Type
	 from #tempTable ) a where a.id  = 1 
	 and Message not like '%Password%'
	 Order by CONVERT(DATETIME,TransmissionTime,103) DESC 
	 Drop table #tempTable
END
ELSE
BEGIN
print 'BB'
	Select 
		MobileNo,	
		case when (message like '%(OTP)%' or message like '% OTP %') Then 'OTP Sent' ELSE message  END Message,
		TransmissionTime,
		'Advisory' Type 
	From   
		TBL_SMSQUEUE_Log  WITH (NOLOCk) 
	WHERE 
		party_code=@ClientCode and
		Message not like '%Password%' and 
		@FromDate >=convert([date] ,TransmissionTime ,105) and 
		@Todate <= convert([date] ,TransmissionTime ,105)
	Order by 3 desc

END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_ClientNXTActive_ZeroBrok
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_ClientNXTActive_ZeroBrok]
(
		@Sub_broker varchar(100),
		@ClientCode varchar(max)
)
As
begin
--EXEC Usp_ClientNXTActive_ZeroBrok 'AJYC','ALWR1022,ALWR115,ALWR1472,ALWR164'

SET NOCOUNT ON

INSERT INTO ClientNXTActive_ZeroBrok
 --INSERT INTO #PartyList  
		 SELECT @Sub_broker,StringValue AS PartyCode  ,Getdate(),Getdate()
		 FROM dbo.fn_Split(@ClientCode, ',')  

		 --Select * from #PartyList  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CompainContestGenerateCouponUsingAPI
-- --------------------------------------------------
----95
 
CREATE Proc [dbo].[USP_CompainContestGenerateCouponUsingAPI]    
(    
--Declare 
@Sub_Broker varchar (50)    ='CBHO'
,@app_id varchar (50)		='NXT'
,@event_name varchar (50)    ='mf_test_event'
,@input_id varchar(1000) ='9fd0656b-dc4a-40be-8b5c-a4655b36cf59-16ecf7ee857'
)    
AS    
Begin     


Declare @RequestTime datetime
Declare @ResponseTime datetime


/*  
  
EXEC [USP_CompainContestGenerateCouponUsingAPI] 'CBHO'  
  
  
*/  
      

 
 --declare @user_id varchar(50),@app_id varchar(50),@mobile varchar(50),@event_name varchar(50),@input_id varchar(100) 

 Declare @mobile varchar(50)
Declare @coupon_id varchar(200)
Declare @Amount Numeric(10,4)
Declare @URL varchar(2000)='https://irewards.angelbroking.com/app/scratchcardrequest_v1'
 set @mobile='45454'
    
 DECLARE @Object AS INT;        
 DECLARE @ResponseText AS VARCHAR(1000);        
 DECLARE @Body AS VARCHAR(MAX) =        
 '{
   "user_id":"'+@Sub_Broker+'",        
   "app_id":"'+@app_id+'",        
   "mobile":"'+@mobile+'",        
   "event_name":"'+@event_name+'",      
   "input_id":"'+@input_id+'"    
 }'    
   
 --print @Body

 Set @RequestTime=Getdate()

     
 EXEC sp_OACreate 'MSXML2.ServerXMLHTTP', @Object OUT;        
 EXEC sp_OAMethod @Object, 'open', NULL, 'post','https://irewards.angelbroking.com/app/scratchcardrequest_v1', 'false'        
        
 EXEC sp_OAMethod @Object, 'setRequestHeader', null, 'Content-Type', 'application/json'        
 EXEC sp_OAMethod @Object, 'send', null, @body        
        
 EXEC sp_OAMethod @Object, 'responseText',@ResponseText OUTPUT      
          
 EXEC sp_OADestroy @Object        
  
   --select * from parseJSON(@ResponseText) 
   Set @ResponseTime=Getdate()


select  @coupon_id=StringValue from parseJSON(@ResponseText)  where NAME='coupon_id'
select  @Amount=StringValue from parseJSON(@ResponseText)  where NAME='amount'

  
select  @Sub_Broker Sub_Broker ,@coupon_id coupon_id,@Amount Amount, @URl URl,@body Request,@ResponseText Response,@RequestTime RequestTime,@ResponseTime ResponseTime

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DashboardVideoDetails
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_DashboardVideoDetails]  
(
@IsDisplay int
)
AS          
BEGIN         
if(@IsDisplay = 1)
  BEGIN
   SELECT id as Id,         
   orderIndex        
   ,FilePath AS FilePath        
   ,FileName AS FileName,
   CreatedBy,
   CreationDate AS CreatedOn,
   IsActive
   FROM  dbo.DashboardVideoUpload a WITH (NOLOCK)     
   WHERE IsActive = 1
   Order by orderIndex   
  END
ELSE
  BEGIN
   SELECT id as Id,         
   orderIndex        
   ,FilePath AS FilePath        
   ,FileName AS FileName,
   CreatedBy,
   CreationDate AS CreatedOn,
   IsActive
   FROM  dbo.DashboardVideoUpload a WITH (NOLOCK)   
   Order by CreatedOn  desc
  END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Dealer_NXT_Incoming_Ozonetel
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_Dealer_NXT_Incoming_Ozonetel]
(
  @DialWhomNumber Varchar(100)
)
as
begin


select 
phoneNumber
,ucid
,did
,callerID
,skillName
,agentID
,campaignId
,monitorUcid
,type
,uui
from
OzonetelIncomingCallData
where agentPhoneNumber=@DialWhomNumber and ISNULL(flag,0) = 0


Update OzonetelIncomingCallData
Set flag=1
where agentPhoneNumber=@DialWhomNumber

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_delete_AdvisoryData_NXT
-- --------------------------------------------------
CREATE procedure [dbo].usp_delete_AdvisoryData_NXT(
@AdvisoryId BIGINT,
@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	DECLARE @Period NVARCHAR(50)
	
	SELECT @Period = [Period]
	FROM AdvisoryPerformanceReportData 
	WHERE Id = @AdvisoryId

	DELETE FROM AdvisoryPerformanceReportDataDetails WHERE AdvisoryPerformanceReportData_Id = @AdvisoryId

	DELETE FROM AdvisoryPerformanceReportData WHERE Id = @AdvisoryId 

	INSERT INTO AdvisoryDeleteLog_NXT(AdvisoryPerformanceReportDataId, Period, DeletedBy, DeletedDateTime)
	VALUES (@AdvisoryId, @Period, @EmpName, GETDATE())
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DELETE_BulkIPO_ClientGroup
-- --------------------------------------------------
CREATE PROCEDURE usp_DELETE_BulkIPO_ClientGroup
(
	@SBTag  VARCHAR(100),
	@GroupName VARCHAR(1000)
)
AS
BEGIN
	DELETE FROM BulkIPO_ClientGroup_Clients WHERE GroupId IN (SELECT Id FROM BulkIPO_ClientGroup WHERE Name = @GroupName AND SBTag = @SBTag)
	DELETE FROM BulkIPO_ClientGroup WHERE SBTag = @SBTag AND Name = @GroupName
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DELETE_BulkIPO_GroupClients
-- --------------------------------------------------
CREATE PROCEDURE usp_DELETE_BulkIPO_GroupClients
(
	@SBTag VARCHAR(100),
	@GroupId BIGINT,
	@datatable IPOGroupClients Readonly,
	@UpdatedBy VARCHAR(500)
)
AS
BEGIN
	DELETE BCC
	FROM BulkIPO_ClientGroup_Clients BCC
	INNER JOIN @datatable DT ON DT.PartyCode = BCC.PartyCode
	WHERE BCC.GroupId = @GroupId
	
	UPDATE BulkIPO_ClientGroup
	SET UpdatedBy = @UpdatedBy,
		LastUpdate = GETDATE()
	WHERE Id = @GroupId 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_delete_holiday
-- --------------------------------------------------
CREATE PROCEDURE usp_delete_holiday    
@holidayId INT,    
@empName NVARCHAR(50)    
AS    
BEGIN   
 UPDATE BankHolidays  
 SET [Status] = 'I', UpdatedBy = @empName, UpdatedTime = GETDATE()  
 WHERE BankHolidayId = @holidayId;  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_delete_NotificationData_NXT
-- --------------------------------------------------
CREATE procedure [dbo].[usp_delete_NotificationData_NXT]
(
	@CampaignId varchar(100) = '',
	@NotificationText varchar(7000) = '',
	@CreatedDate Date='2020-01-09',    
	@NotificationType varchar(200)='Individual',
	@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	DELETE FROM tbl_NotificationNXT
	WHERE NOTIFICATIONTEXT = @NotificationText 
		AND CampaignId = @CampaignId 
		AND NotificationText <> 'message' 
		AND NotificationType = @NotificationType 
		AND CONVERT(DATE, CreatedDate) = CONVERT(DATE, @CreatedDate) 


delete from UntilityView_Notification
	WHERE NOTIFICATIONTEXT = @NotificationText 
		AND CampaignId = @CampaignId 
		AND NotificationText <> 'message' 
		AND NotificationType = @NotificationType 
		AND CONVERT(DATE, CreatedDate) = CONVERT(DATE, @CreatedDate) 

			   		 
	INSERT INTO NotificationDeleteLog_NXT(CampaignId, NotificationType, NotificationText, DeletedBy, DeletedDateTime)
	VALUES (@CampaignId, @NotificationType, @NotificationText, @EmpName, GETDATE())
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_delete_PopupData_NXT
-- --------------------------------------------------
CREATE procedure [dbo].[usp_delete_PopupData_NXT](
@PopupId BIGINT,
@EmpName NVARCHAR(100)
)
AS    
BEGIN 
	DECLARE @CampaignId NVARCHAR(100),
		@PopupType NVARCHAR(100)
	
	SELECT @CampaignId = CampaignId, @PopupType = Popup_Type 
	FROM tbl_PopupAdmin 
	WHERE id = @PopupId

	DELETE FROM Tbl_PopupSbTagMap WHERE PopupId = @PopupId

	DELETE FROM tbl_PopupAdmin WHERE id = @PopupId 

	INSERT INTO PopupDeleteLog_NXT(PopupId, CampaignId, PopupType, DeletedBy, DeletedDateTime)
	VALUES (@PopupId, @CampaignId, @PopupType, @EmpName, GETDATE())
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteCreative
-- --------------------------------------------------

 CREATE PROCEDURE [dbo].[usp_DeleteCreative]     
   (      
		@Id  INT
		,@Deletedby  varchar(100)  
	)      
	AS      
	BEGIN  
			update tbl_DigitalLibraryCreatives SET Active = 0, IsDeleted = 1, DeletedDate = GetDate(), Deletedby = @Deletedby  WHERE Creative_id = @Id
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteCreative_BeeNXT
-- --------------------------------------------------

 CREATE PROCEDURE [dbo].[usp_DeleteCreative_BeeNXT]     
   (      
		@Id  INT
		,@Deletedby  varchar(100)  
	)      
	AS      
	BEGIN  
			update tbl_DigitalLibraryCreatives_Beenxt SET Active = 0, IsDeleted = 1, DeletedDate = GetDate(), Deletedby = @Deletedby  WHERE Creative_id = @Id
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteFamilyTradeTransactions
-- --------------------------------------------------

CREATE procedure [dbo].[usp_DeleteFamilyTradeTransactions]
(
		@FamilyTradeId INT=NULL,
		@ClientId varchar(30)=NULL,
		@DeletedBy varchar(30)=NULL
)
as
begin

Declare @FamilyTradeIdTemp Table
(
	FamilyTradeId INT
) 

IF @FamilyTradeId IS NOT NULL and @FamilyTradeId <> 0
BEGIN 
		insert into @FamilyTradeIdTemp
		select FamilyTradeId from FamilyTradeDetails where  FamilyTradeId=  @FamilyTradeId


		insert into [FamilyTradeTransactions_DeleteLog]
		(FamilyTradeId,ClientId,MembershipType,Relation,CreatedBy,CreatedDate,DeletedBy,DeletedDate)
		select 
		FamilyTradeId,ClientId,MembershipType,Relation,CreatedBy,CreatedDate,@DeletedBy DeletedBy,Getdate() DeletedDate
		From  FamilyTradeTransactions 
		where FamilyTradeId in (select * from @FamilyTradeIdTemp)

		Insert into [FamilyTradeDetails_DeleteLog]
		(FamilyTradeId,FamilyTradeName,CreatedBy,CreatedDate,DeletedBy,DeletedDate)
		select FamilyTradeId,FamilyTradeName,CreatedBy,CreatedDate,@DeletedBy DeletedBy,Getdate() DeletedDate
		from FamilyTradeDetails where FamilyTradeId in (select * from  @FamilyTradeIdTemp)



		delete from FamilyTradeTransactions where FamilyTradeId in (select * from @FamilyTradeIdTemp)

		delete from FamilyTradeDetails where FamilyTradeId in (select * from  @FamilyTradeIdTemp)

END
ELSE 
BEGIN

		insert into [FamilyTradeTransactions_DeleteLog]
		(FamilyTradeId,ClientId,MembershipType,Relation,CreatedBy,CreatedDate,DeletedBy,DeletedDate)
		select 
		FamilyTradeId,ClientId,MembershipType,Relation,CreatedBy,CreatedDate,@DeletedBy DeletedBy,Getdate() DeletedDate
		From  FamilyTradeTransactions 
		where ClientId=@ClientId


		Delete from FamilyTradeTransactions 
		where ClientId=@ClientId

END


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteFamilyTradeTransactions_Bkp10Sep2018
-- --------------------------------------------------


CREATE procedure [dbo].[usp_DeleteFamilyTradeTransactions_Bkp10Sep2018]
(
		@FamilyTradeId INT=NULL,
		@ClientId varchar(30)=NULL
)
as
begin

Declare @FamilyTradeIdTemp Table
(
	FamilyTradeId INT
) 

IF @FamilyTradeId IS NOT NULL and @FamilyTradeId <> 0
BEGIN 
		insert into @FamilyTradeIdTemp
		select FamilyTradeId from FamilyTradeDetails where  FamilyTradeId=  @FamilyTradeId

		delete from FamilyTradeTransactions where FamilyTradeId in (select * from @FamilyTradeIdTemp)

		delete from FamilyTradeDetails where FamilyTradeId in (select * from  @FamilyTradeIdTemp)

END
ELSE 
BEGIN


		Delete from FamilyTradeTransactions 
		where ClientId=@ClientId

END


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteNocInHouseSB
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_DeleteNocInHouseSB]
(        
@SBTag varchar(50)    
)        
AS        
BEGIN    
DELETE FROM NOC_InHouse_SB_Master WHERE subbroker = @SBTag  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteOrActiveNudgeFile
-- --------------------------------------------------
 CREATE PROCEDURE [dbo].[usp_DeleteOrActiveNudgeFile]       
   (        
     @Id  INT    
    ,@IsActive BIT 
    ,@Action VARCHAR(100)  
    )        
    AS        
    BEGIN    
          
        IF(@Action = 'delete')  
           DELETE FROM [dbo].[NudgeFileData]  WHERE id = @Id  
                  
        IF(@Action = 'active')  
		   UPDATE [dbo].[NudgeFileData]
		   SET IsActive = @IsActive
		   WHERE id = @Id  
                  
           
    END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteOrActiveNXTMobilePopup
-- --------------------------------------------------
CREATE PROCEDURE [dbo].usp_DeleteOrActiveNXTMobilePopup     
(      
	@Id  INT, 
	@Active VARCHAR(3), 
	@Action VARCHAR(100),
	@EmpName VARCHAR(100)
)      
AS      
BEGIN
    IF(@Action = 'delete')
		DELETE FROM Tbl_NXTMobilePopup  WHERE id = @Id
                
    IF(@Action = 'active')
		UPDATE dbo.Tbl_NXTMobilePopup
		SET Active = @Active,
			ModifyBy = @EmpName,
			ModifyDate = GETDATE()
		WHERE id = @Id
                
         
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteOrActiveOffer
-- --------------------------------------------------
     
    
     CREATE PROCEDURE [dbo].[usp_DeleteOrActiveOffer]         
     (          
     @Id  INT      
    ,@Active BIT  
    ,@Action VARCHAR(100)    
   )          
   AS          
   BEGIN      
              
    IF(@Action = 'delete')    
     DELETE FROM Tbl_PopupAdmin  WHERE id = @Id    
                      
    IF(@Action = 'active')    
       UPDATE dbo.OffersMaster  
       SET IsActive = @Active,    
        ModifiedDate = GETDATE()    
       WHERE OfferId = @Id   
         
   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteOrActivePopup
-- --------------------------------------------------



   CREATE PROCEDURE [dbo].[usp_DeleteOrActivePopup]     
   (      
		@Id  INT  
	   ,@Active VARCHAR(3)
	   ,@Action VARCHAR(100)
    )      
    AS      
    BEGIN  
        
        IF(@Action = 'delete')
		   DELETE FROM Tbl_PopupAdmin  WHERE id = @Id
                
        IF(@Action = 'active')
			UPDATE dbo.Tbl_PopupAdmin
			SET Active = @Active,
				ModifyDate = GETDATE()
			WHERE id = @Id
                
         
    END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteRedirectionUrl
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_DeleteRedirectionUrl]       
(        
	@Id	int    
)        
AS        
BEGIN    
	DELETE FROM NotificationNXT_MasterList  WHERE Id = @Id  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteRightIssuesInHouseSB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_DeleteRightIssuesInHouseSB]
(        
	@SBTag	varchar(50)    
)        
AS        
BEGIN    
	DELETE FROM RightIssues_InHouse_SB_Master WHERE subbroker = @SBTag  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteSBNOCAccess
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_DeleteSBNOCAccess]       
(        
	@Id	varchar(50)    
)        
AS        
BEGIN    
	DELETE FROM SB_NOCaccess WHERE id = @Id  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteSbNocRights
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_DeleteSbNocRights]
(        
@id int
)        
AS        
BEGIN    
DELETE FROM SB_NOC_Rights WHERE Id = @id  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteUtilityMenu
-- --------------------------------------------------

  
CREATE PROCEDURE [dbo].[usp_DeleteUtilityMenu]       
(        
	@MenuId	INT    
)        
AS        
BEGIN    
	DELETE FROM Menu WHERE id = @MenuId
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteUtilityUserMenu
-- --------------------------------------------------
  
CREATE PROCEDURE [dbo].[usp_DeleteUtilityUserMenu]       
(        
	@Id	INT    
)        
AS        
BEGIN    
	DELETE FROM UserMenuAccess WHERE id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DeleteVoucherEntryAccess
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_DeleteVoucherEntryAccess]       
(        
	@Id	varchar(50)    
)        
AS        
BEGIN    
	DELETE FROM tbl_SBAccess WHERE RecID = @Id  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_DigitalLibraryAddCustomizedCreative
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_DigitalLibraryAddCustomizedCreative]
(
	@sub_broker varchar(100),
	@Category varchar(100),
	@CreativeName Varchar(2000),
	@Purpose varchar(5000),
	@Message varchar(5000),
	@FlagForContact Varchar(10),
	@SampleImageURL Varchar(500),
	@SampleImageName Varchar(100),
	@ExpectedDelivery Varchar(100), 
	@Createdby varchar(100)
)
as
begin


insert into tbl_DigitalLibraryCreativesCustom
(
		sub_broker
		,Category
		,CreativeName
		,Purpose
		,Message
		,FlagForContact
		,SampleImageURL
		,SampleImageName
		,ImageURL
		,ImageName
		,ExpectedDelivery
		,Status
		,Remarks
		,CreateDate
		,createdby
)
Select	 @sub_broker
		,@Category
		,@CreativeName
		,@Purpose
		,@Message
		,@FlagForContact
		,@SampleImageURL
		,@SampleImageName
		,'' ImageURL
		,'' ImageName
		,@ExpectedDelivery
		,'Request Received' Status
		,'' Remarks
		,Getdate() CreateDate
		,@Createdby

EXEC Usp_DigitalLibraryAddCustomizedCreative_Mail 	@sub_broker ,	@Category ,	@CreativeName ,	@Purpose ,	@Message ,
													@FlagForContact ,	@SampleImageURL ,	@SampleImageName ,	@ExpectedDelivery 


end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_DigitalLibraryAddCustomizedCreative_Beenxt
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_DigitalLibraryAddCustomizedCreative_Beenxt]
(
	@sub_broker varchar(100),
	@Category varchar(100),
	@CreativeName Varchar(2000),
	@Purpose varchar(5000),
	@Message varchar(5000),
	@FlagForContact Varchar(10),
	@SampleImageURL Varchar(500),
	@SampleImageName Varchar(100),
	@ExpectedDelivery Varchar(100), 
	@Createdby varchar(100)
)
as
begin


insert into tbl_DigitalLibraryCreativesCustom_Beenxt
(
		sub_broker
		,Category
		,CreativeName
		,Purpose
		,Message
		,FlagForContact
		,SampleImageURL
		,SampleImageName
		,ImageURL
		,ImageName
		,ExpectedDelivery
		,Status
		,Remarks
		,CreateDate
		,createdby
)
Select	 @sub_broker
		,@Category
		,@CreativeName
		,@Purpose
		,@Message
		,@FlagForContact
		,@SampleImageURL
		,@SampleImageName
		,'' ImageURL
		,'' ImageName
		,@ExpectedDelivery
		,'Request Received' Status
		,'' Remarks
		,Getdate() CreateDate
		,@Createdby

--EXEC Usp_DigitalLibraryAddCustomizedCreative_Mail 	@sub_broker ,	@Category ,	@CreativeName ,	@Purpose ,	@Message ,
--													@FlagForContact ,	@SampleImageURL ,	@SampleImageName ,	@ExpectedDelivery 


end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DigitalLibraryNotificationNXTALL
-- --------------------------------------------------

/*
Altered By  -Yasmin khan
Altered on - 24-12-21
Added columns to be inserted  
*/


CREATE procedure [dbo].[usp_DigitalLibraryNotificationNXTALL]  
(   
  @NotificationText varchar(8000)  
 ,@URL varchar(MAX)  
 ,@area varchar(200)  
 ,@controller varchar(200)   
 ,@action varchar(200)  
 ,@empName varchar(200) 
 ,@CampaignId varchar(200)
 ,@areaname varchar(200)  
) 
AS 
BEGIN 
		insert into [tbl_NotificationNXT] 
		(
			sub_broker
			,NotificationText
			,NotificationType
			,Individualview
			,IndividualviewDate
			,Notification_9
			,Notification_Date_9
			,CreatedBy
			,CreatedDate
			,UpdatedBy
			,UpdatedDate
			,CLTCODEDupl
			,URL
			,area
			,controller
			,action
			,CampaignId
			,areaname
		) 
		SELECT   
		access_code [sub_broker]  
		,@NotificationText  [NotificationText]  
		,'All' [NotificationType] 
		,'N' [Individualview]  
		,null [IndividualviewDate]
		,'Y' [Notification_9]  
		,getdate() [Notification_Date_9]  
		,@empName [CreatedBy]  
		,GETDATE() [CreatedDate]  
		,'' [UpdatedBy]
		,getdate() [UpdatedDate]  
		,'' [CLTCODEDupl]
		,@URL [URL] 
		,@area [area]  
		,@controller [controller]  
		,@action [action]  
		,@CampaignId [CampaignId]
		,@areaname [areaname]
		FROM  
		(
			select access_code from [196.1.115.132].rolemgm.dbo.user_login UL 
			where status=1  
			and login_inactive_date>getdate() 
			and access_to='SB'  
			and usertype='ADMIN'  
			and username is not NULL  
		) UL  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DigitalLibraryNotificationNXTIndivisual
-- --------------------------------------------------

  
CREATE procedure [dbo].[usp_DigitalLibraryNotificationNXTIndivisual]  
(  
@SbTag VARCHAR(MAX),  
@NotificationText varchar(8000),  
@url varchar(8000)=null  
,@area varchar(200)  
,@controller varchar(200)   
,@action varchar(200)  
   ,@empName varchar(200) 
 ,@CampaignId varchar(200)
 ,@areaname varchar(200)   
)  
as  
begin  
  
insert into [tbl_NotificationNXT](sub_broker,NotificationText,NotificationType,Individualview,IndividualviewDate,Notification_9,Notification_Date_9,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,CLTCODEDupl,URL,area,controller,action,CampaignId,areaname)  
select *,@NotificationText,'Individual','N',Null,'Y',getdate(),@empName,GETDATE(),'',GETDATE(),'',@url,@area,@controller,@action,@CampaignId,@areaname
FROM  dbo.[fn_Split] (@SbTag, ',')   
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DigitalLibraryNotificationNXTIndivisual_BeeNXT
-- --------------------------------------------------
       
 CREATE PROCEDURE [dbo].[usp_DigitalLibraryNotificationNXTIndivisual_BeeNXT]      
 (      
   @SbTag VARCHAR(MAX)  
  ,@NotificationText varchar(8000)  
  ,@url varchar(8000) = null      
  ,@area varchar(200)  
  ,@controller varchar(200)  
  ,@action varchar(200)  
  ,@empName varchar(200)  
  ,@CampaignId varchar(200)    
  ,@areaname varchar(200)       
 )      
 AS      
 BEGIN      
       
  INSERT INTO [tbl_NotificationBEENXT](sub_broker,NotificationText,NotificationType,Individualview,IndividualviewDate,Notification_9,Notification_Date_9,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,CLTCODEDupl,URL,area,controller,action,CampaignId,areaname 
)      
  SELECT *,@NotificationText,'Individual','N',Null,'Y',getdate(),@empName,GETDATE(),'',GETDATE(),'',@url,@area,@controller,@action,@CampaignId ,@areaname
  FROM  dbo.[fn_Split] (@SbTag, ',')       
        
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DigitalLibraryUpdateCustomizeCreative
-- --------------------------------------------------

CREATE procedure [dbo].[usp_DigitalLibraryUpdateCustomizeCreative]
(
	@Requestid INT,
	--@Sub_broker Varchar(100),
	@ImageURL Varchar(100),
	@ImageName Varchar(100),
	@DeliveryDate Varchar(100),
	@Status Varchar(100),
	@Remarks Varchar(5000),
	@modifyby Varchar(100)
)
as
begin
	Update tbl_DigitalLibraryCreativesCustom
	Set ImageURL=@ImageURL ,
		ImageName=@ImageName,
		DeliveryDate=@DeliveryDate ,
		Status=@Status ,
		Remarks=@Remarks ,
		modifyDate =GETDATE(),
		modifyby = @modifyby
	where Requestid =@Requestid 
	--and sub_broker=@Sub_broker
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DigitalLibraryUpdateCustomizeCreative_BeeNXT
-- --------------------------------------------------

CREATE procedure [dbo].[usp_DigitalLibraryUpdateCustomizeCreative_BeeNXT]
(
	@Requestid INT,
	--@Sub_broker Varchar(100),
	@ImageURL Varchar(100),
	@ImageName Varchar(100),
	@DeliveryDate Varchar(100),
	@Status Varchar(100),
	@Remarks Varchar(5000),
	@modifyby Varchar(100)
)
as
begin
	Update tbl_DigitalLibraryCreativesCustom_Beenxt
	Set ImageURL=@ImageURL ,
		ImageName=@ImageName,
		DeliveryDate=@DeliveryDate ,
		Status=@Status ,
		Remarks=@Remarks ,
		modifyDate =GETDATE(),
		modifyby = @modifyby
	where Requestid =@Requestid 
	--and sub_broker=@Sub_broker
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_DP_StocksShiftingOutsideAngelPopup
-- --------------------------------------------------
--usp_DP_StocksShiftingOutsideAngelPopup 'K150267','2021-5-21','1203320030711864'
CREATE procedure [dbo].[usp_DP_StocksShiftingOutsideAngelPopup]
(
	@party_code varchar(10),
	@request_date varchar(11),
	@dp_id varchar(16)
)
as 
begin
set nocount on;
--declare @df int
--set @df = charindex('-',@request_date)
--if(@df = 0)
--	set @request_date=convert(datetime,@request_date,103)    
--else
--	set @request_date=convert(datetime,@request_date,105)    

SET @Request_date = CONVERT(date,GETDATE(),103)

select * into #VW_Dis_Data from [172.31.16.108].DMAT.citrus_usr.VW_Dis_Data WITH(NOLOCK)
where dpam_bbo_code=@party_code

select 
distinct
DD.dpam_bbo_code as 'ClientCode',
DD.DPTDC_ISIN as 'ISIN',
DD.dpam_sba_no as 'DPID', 
convert(date,DD.DPTDC_REQUEST_DT) as 'RequestDate',
DD.remarks as 'Remark',
DD.Qty as 'Quantity',
DD.Comp_Name as 'CompanyName',
DD.DPTDC_REASON_CD as 'Reason'

from #VW_Dis_Data DD WITH(NOLOCK) 
where DD.DPTDC_REQUEST_DT = @request_date
and dpam_sba_no = @dp_id

DROP TABLE #VW_Dis_Data

end

--declare @request_date varchar(11)
--select @request_date=convert(datetime,'2021-5-21',105)  
--select @request_date

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_EditRedirectionUrl
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_EditRedirectionUrl]                
(                
 @Id int,    
 @Modulename VARCHAR(MAX),    
 @URL VARCHAR(MAX) = NULL,    
 @area VARCHAR(MAX) = NULL,    
 @Controller VARCHAR(MAX),    
 @action VARCHAR(MAX) = NULL,  
 @QueryParameter VARCHAR(500) = NULL,  
 @UpdatedBy VARCHAR(100)  
)                
AS                
BEGIN            
    
 Update NotificationNXT_MasterList SET     
 Modulename = @Modulename,URL = @URL,area = @area,Controller = @Controller,[action] = @action,   
 QueryParameter = @QueryParameter, UpdatedBy = @UpdatedBy, UpdatedDate = GETDATE()    
 Where Id = @Id    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_EMandateSendMail
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_EMandateSendMail]    
@ClientName varchar(100),      
@ClientEmail varchar(200),      
@ExpiryDate varchar(30),       
@Link varchar(100)       
AS      
BEGIN       
 DECLARE @clientcode varchar(20),@sub varchar(100),@htmlBody varchar(max), @RetMessage varchar(50),@Status varchar(30) 
      
 SET @htmlBody='<!DOCTYPE html>    
<html>    
<body>    
<table align="center" cellpadding="0" cellspacing="0" style="border: 1px solid #ff7300; border-radius: 10px; padding: 0px;">    
<tr>    
<td>    
<table align="center" border="0" cellpadding="0" cellspacing="0" style="text-align:center;border-radius: 10px" width="720">    
<tbody>    
<tr>    
<td align="center" valign="top">    
<a href="#" style="display: block;width: 100%;font-family: Barlow, sans-serif;"><img alt="" src="http://web.angelbackoffice.com/angelbroking/econnect/MTF_Mailers/header.jpg" style="width: 100%; display: block; vertical-align: top; border-top-left-radius:1
  
0px;border-top-right-radius: 10px;"></a>    
</td>    
</tr>    
<tr>    
<td align="center" valign="top" style="padding-top: 15px">    
<table cellpadding="0" cellspacing="0" width="80%">    
<tr>    
<td style="background: #f1f1f2;padding: 30px;border-radius: 10px;text-align: left;color: #404041;font-size: 14px;font-family: Barlow, sans-serif;">    
Dear '+@ClientName+',<br><br>    
Your SB has raised a request to create MF-SIP Mandate. <br>    
This is a one-time registration through which you instruct your bank to deduct your MF-SIP amount from your account and direct the same towards your chosen SIP scheme. This will ensure that your SIP payments happen automatically and regularly without you 
  
having to do so manually.  <br><br>    
Please click this link before '+@ExpiryDate+' to authorize the mandate: '+@Link+' <br><br>    
For more help:<br>    
Please connect with your RM.    
</td>    
</tr>    
</table>    
</td>    
</tr>    
<tr>    
<td>    
<table align="center" cellpadding="0" cellspacing="0" width="720" style="padding-top: 10px">    
<tbody>    
<tr>    
<td align="left" style="padding: 0px;background: #fff; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px" valign="top">    
<table align="left" border="0" cellpadding="0" cellspacing="0" style="width: 100%">    
<tbody>    
<tr>    
<td align="center" style="font-size: 15px;color: #231f20;font-weight: 400; font-family: Barlow, sans-serif;padding: 20px; vertical-align: middle;" valign="middle">    
Spread the word &nbsp;&nbsp; <a href="https://www.facebook.com/OfficialAngelOne" style="font-family: Barlow, sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/fb.png" style="vertical-align:
  
 top;"></a>&nbsp; <a href="https://www.instagram.com/angelone/?utm_medium=copy_link" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/insta.png" style="vertic
  
al-align: top;"></a>&nbsp; <a href="https://twitter.com/AngelOne?t=Qx3rxyE9ZhQBJ-jSi7R3tQ&s=09" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/tweeter.png" 
  
style="vertical-align: top;"></a>&nbsp; <a href="https://youtube.com/user/AngelBrokingVideos" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/youtube.png" st
  
yle="vertical-align: top;"></a>&nbsp; <a href="https://www.linkedin.com/company/angelone" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/in.png" style="vert
  
ical-align: top;"></a>&nbsp; <a href="https://t.me/AngelOneAdvisory" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/tele.png" style="vertical-align: top;"></a>
&nbsp; <a href="https://wa.me/917400180180?&text=Start" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/whats.png" style="vertical-align: top;"></a> &nbsp;
<a href="https://www.jio.com/en-in/apps/jio-chat" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/jio.png" style="vertical-align: top;"></a>    
</td>    
</tr>    
<tr>    
<td align="left" style="font-size: 13px;color: #131313;font-family: Barlow, sans-serif; font-weight: 400; text-align: center;padding-bottom: 20px;" valign="top">    
Disclaimer - *Investments in securities market are subject to market risk, read all the<br>    
related documents carefully before investing. <a href="https://bit.ly/2VBt5c5" style="color: #2e51ff; text-decoration: none" target="_blank">Read more...</a>    
</td>    
</tr>    
</tbody>    
</table>    
</td>    
</tr>    
</tbody>    
</table>    
</td>    
</tr>    
</tbody>    
</table>    
</td>    
</tr>    
</table>    
</body>    
</html>'      
       
 --SET @FilePath='\\172.31.24.30\D\NXT\Uploads\Holding_1203320009930584.pdf'      
      
 --SET @FilePath = '\\172.31.24.30\D\NXT\Uploads\' + @Filename --+'\'      
 --SET @FilePath = '\\172.31.18.104\C\inetpub\wwwroot\NXTUAT\Uploads\' + @Filename --+'\'      
 --SET @FilePath = '\\172.31.24.30\Uploads\' + @Filename --+'\'  
 
 
      
 SET @sub = 'Auto Debit SIP Mandate link'    
  IF(@ClientEmail<>'')      
  BEGIN      
  EXEC MSDB.DBO.SP_SEND_DBMAIL                                    
     @RECIPIENTS =@ClientEmail,                                    
     --@COPY_RECIPIENTS ='chhabiraj.chaurasia@angelbroking.com;yogesh.rewatkar@angelbroking.com',--;manish.shah@angelbroking.com;varuna.sharma@angelbroking.com',                                
     --@blind_copy_recipients='Prashant.patade@angelbroking.com;varuna.sharma@angelbroking.com;varuna.sharma@angelbroking.com;manish.shah@angelbroking.com',                                    
     @PROFILE_NAME = 'NXT',                                    
     @BODY_FORMAT ='HTML',                                    
     @SUBJECT = @sub , --'Test',       
  --@FILE_ATTACHMENTS = @FilePath,        
     --@FILE_ATTACHMENTS = '\\172.21.24.30\D\NXT\Uploads\Holding_1203320009930584.pdf',--@s,                                    
  --@FILE_ATTACHMENTS = '\\172.31.24.30\D\NXT\Uploads\Holding_1203320009930584.pdf',--@s,                                    
    --@FILE_ATTACHMENTS = '\\196.1.115.147\upload1\bse_nse_poor_cat\Downloads\Hold_NSE_BSE_Poor07072021.csv',--@s,                                    
     @BODY =@htmlBody--'Test'--@MESS        
      
  SET @RetMessage='Mail send to' + @ClientEmail+' Successfully'      
  SET @Status = 'Success'      
  END      
  ELSE      
  BEGIN      
  SET @RetMessage = 'Email not registered'      
  SET @Status='Failed'      
  END      
  select @RetMessage Message,@Status status      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_EMandateSendMail_UAT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_EMandateSendMail_UAT]      
@ClientName varchar(100),      
@ClientEmail varchar(200),      
@ExpiryDate varchar(30),       
@Link varchar(100)       
AS      
BEGIN       
 DECLARE @clientcode varchar(20),@sub varchar(100),@htmlBody varchar(max), @RetMessage varchar(50),@Status varchar(30)  

 SELECT top 1 @clientcode=PartyCode FROM EMANDATESMSLINKLOG WITH (NOLOCK) where SMSLink=@Link
      
 SET @htmlBody='<!DOCTYPE html>    
<html>    
<body>    
<table align="center" cellpadding="0" cellspacing="0" style="border: 1px solid #ff7300; border-radius: 10px; padding: 0px;">    
<tr>    
<td>    
<table align="center" border="0" cellpadding="0" cellspacing="0" style="text-align:center;border-radius: 10px" width="720">    
<tbody>    
<tr>    
<td align="center" valign="top">    
<a href="#" style="display: block;width: 100%;font-family: Barlow, sans-serif;"><img alt="" src="http://web.angelbackoffice.com/angelbroking/econnect/MTF_Mailers/header.jpg" style="width: 100%; display: block; vertical-align: top; border-top-left-radius:1
  
0px;border-top-right-radius: 10px;"></a>    
</td>    
</tr>    
<tr>    
<td align="center" valign="top" style="padding-top: 15px">    
<table cellpadding="0" cellspacing="0" width="80%">    
<tr>    
<td style="background: #f1f1f2;padding: 30px;border-radius: 10px;text-align: left;color: #404041;font-size: 14px;font-family: Barlow, sans-serif;">    
Dear '+@ClientName+',<br><br>    
Your SB has raised a request to create MF-SIP Mandate. <br>    
This is a one-time registration through which you instruct your bank to deduct your MF-SIP amount from your account and direct the same towards your chosen SIP scheme. This will ensure that your SIP payments happen automatically and regularly without you 
  
having to do so manually.  <br><br>    
Please click this link before '+@ExpiryDate+' to authorize the mandate: '+@Link+' <br><br>    
For more help:<br>    
Please connect with your RM.    
</td>    
</tr>    
</table>    
</td>    
</tr>    
<tr>    
<td>    
<table align="center" cellpadding="0" cellspacing="0" width="720" style="padding-top: 10px">    
<tbody>    
<tr>    
<td align="left" style="padding: 0px;background: #fff; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px" valign="top">    
<table align="left" border="0" cellpadding="0" cellspacing="0" style="width: 100%">    
<tbody>    
<tr>    
<td align="center" style="font-size: 15px;color: #231f20;font-weight: 400; font-family: Barlow, sans-serif;padding: 20px; vertical-align: middle;" valign="middle">    
Spread the word &nbsp;&nbsp; <a href="https://www.facebook.com/OfficialAngelOne" style="font-family: Barlow, sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/fb.png" style="vertical-align:
  
 top;"></a>&nbsp; <a href="https://www.instagram.com/angelone/?utm_medium=copy_link" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/insta.png" style="vertic
  
al-align: top;"></a>&nbsp; <a href="https://twitter.com/AngelOne?t=Qx3rxyE9ZhQBJ-jSi7R3tQ&s=09" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/tweeter.png" 
  
style="vertical-align: top;"></a>&nbsp; <a href="https://youtube.com/user/AngelBrokingVideos" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/youtube.png" st
  
yle="vertical-align: top;"></a>&nbsp; <a href="https://www.linkedin.com/company/angelone" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/in.png" style="vert
  
ical-align: top;"></a>&nbsp; <a href="https://t.me/AngelOneAdvisory" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/tele.png" style="vertical-align: top;"></a>
&nbsp; <a href="https://wa.me/917400180180?&text=Start" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/whats.png" style="vertical-align: top;"></a> &nbsp;
<a href="https://www.jio.com/en-in/apps/jio-chat" style="font-family: "Barlow", sans-serif;" target="_blank"><img alt="" src="https://absite-mumbai.s3.ap-south-1.amazonaws.com/01112021/Diwali+SIP/jio.png" style="vertical-align: top;"></a>    
</td>    
</tr>    
<tr>    
<td align="left" style="font-size: 13px;color: #131313;font-family: Barlow, sans-serif; font-weight: 400; text-align: center;padding-bottom: 20px;" valign="top">    
Disclaimer - *Investments in securities market are subject to market risk, read all the<br>    
related documents carefully before investing. <a href="https://bit.ly/2VBt5c5" style="color: #2e51ff; text-decoration: none" target="_blank">Read more...</a>    
</td>    
</tr>    
</tbody>    
</table>    
</td>    
</tr>    
</tbody>    
</table>    
</td>    
</tr>    
</tbody>    
</table>    
</td>    
</tr>    
</table>    
</body>    
</html>'      
       
 --SET @FilePath='\\172.31.24.30\D\NXT\Uploads\Holding_1203320009930584.pdf'      
      
 --SET @FilePath = '\\172.31.24.30\D\NXT\Uploads\' + @Filename --+'\'      
 --SET @FilePath = '\\172.31.18.104\C\inetpub\wwwroot\NXTUAT\Uploads\' + @Filename --+'\'      
 --SET @FilePath = '\\172.31.24.30\Uploads\' + @Filename --+'\'  
 
 
      
 SET @sub = @clientcode +' - Auto Debit SIP Mandate link'    
  IF(@ClientEmail<>'')      
  BEGIN      
  EXEC MSDB.DBO.SP_SEND_DBMAIL                                    
     @RECIPIENTS =@ClientEmail,                                    
     --@COPY_RECIPIENTS ='chhabiraj.chaurasia@angelbroking.com;yogesh.rewatkar@angelbroking.com',--;manish.shah@angelbroking.com;varuna.sharma@angelbroking.com',                                
     --@blind_copy_recipients='Prashant.patade@angelbroking.com;varuna.sharma@angelbroking.com;varuna.sharma@angelbroking.com;manish.shah@angelbroking.com',                                    
     @PROFILE_NAME = 'NXT',                                    
     @BODY_FORMAT ='HTML',                                    
     @SUBJECT = @sub , --'Test',       
  --@FILE_ATTACHMENTS = @FilePath,        
     --@FILE_ATTACHMENTS = '\\172.21.24.30\D\NXT\Uploads\Holding_1203320009930584.pdf',--@s,                                    
  --@FILE_ATTACHMENTS = '\\172.31.24.30\D\NXT\Uploads\Holding_1203320009930584.pdf',--@s,                                    
    --@FILE_ATTACHMENTS = '\\196.1.115.147\upload1\bse_nse_poor_cat\Downloads\Hold_NSE_BSE_Poor07072021.csv',--@s,                                    
     @BODY =@htmlBody--'Test'--@MESS        
      
  SET @RetMessage='Mail send to' + @ClientEmail+' Successfully'      
  SET @Status = 'Success'      
  END      
  ELSE      
  BEGIN      
  SET @RetMessage = 'Email not registered'      
  SET @Status='Failed'      
  END      
  select @RetMessage Message,@Status status      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EmandateSMSLinkLogInsert
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_EmandateSMSLinkLogInsert]    
  (    
   @PARTYCODE NVARCHAR (20) =NULL    
  ,@MANDATEMAPPINGREFNO NVARCHAR (100) =NULL    
  ,@SMSLINK NVARCHAR (250) =NULL    
  ,@SMSLINKSTATUS NVARCHAR (50) =NULL    
  ,@BANKNAME NVARCHAR (50) =NULL    
  ,@BANKACCOUNTNUMBER NVARCHAR (50) =NULL    
  ,@USERTYPE NVARCHAR (50) =NULL    
  ,@AMOUNT int = NULL    
  ,@AUTH_MODE VARCHAR (20) = NULL    
  )    
  AS    
  BEGIN    
      
      
      
  SET NOCOUNT ON    
      
      
  INSERT INTO EMANDATESMSLINKLOG    
  (    
   PARTYCODE    
  ,MANDATEMAPPINGREFNO    
  ,SMSLINK    
  ,CREATEDON    
  ,SMSSTATUS    
  ,BANKNAME    
  ,BANKNUMBER    
  ,USERTYPE    
  ,UPDATEDON    
  ,AMOUNT    
  ,AUTHMODE  
  )    
      
  VALUES (    
   @PARTYCODE    
  ,@MANDATEMAPPINGREFNO    
  ,@SMSLINK    
  ,GETDATE()    
  ,@SMSLINKSTATUS    
  ,@BANKNAME    
  ,@BANKACCOUNTNUMBER    
  ,@USERTYPE    
  ,GETDATE()    
  ,@AMOUNT    
  ,@AUTH_MODE  
  )    
      
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EmandateSMSLinkLogInsert_Bkp18Mar2019
-- --------------------------------------------------





CREATE PROCEDURE [dbo].[USP_EmandateSMSLinkLogInsert_Bkp18Mar2019]
(
 @PARTYCODE NVARCHAR (20) =NULL
,@MANDATEMAPPINGREFNO NVARCHAR (100) =NULL
,@SMSLINK NVARCHAR (50) =NULL
,@SMSLINKSTATUS NVARCHAR (50) =NULL
,@BANKNAME NVARCHAR (50) =NULL
,@BANKACCOUNTNUMBER NVARCHAR (50) =NULL
,@USERTYPE NVARCHAR (50) =NULL
)
AS
BEGIN

SET NOCOUNT ON

INSERT INTO EMANDATESMSLINKLOG
(
 PARTYCODE
,MANDATEMAPPINGREFNO
,SMSLINK
,CREATEDON
,SMSSTATUS
,BANKNAME
,BANKNUMBER
,USERTYPE
,UPDATEDON
)

VALUES (
 @PARTYCODE
,@MANDATEMAPPINGREFNO
,@SMSLINK
,GETDATE()
,@SMSLINKSTATUS
,@BANKNAME
,@BANKACCOUNTNUMBER
,@USERTYPE
,GETDATE()
)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EmandateSMSLinkLogInsert_bkp20Feb2019
-- --------------------------------------------------




CREATE PROCEDURE [dbo].[USP_EmandateSMSLinkLogInsert_bkp20Feb2019]
(
 @PARTYCODE NVARCHAR (20) =NULL
,@MANDATEMAPPINGREFNO NVARCHAR (100) =NULL
,@SMSLINK NVARCHAR (50) =NULL
,@SMSLINKSTATUS NVARCHAR (50) =NULL
,@BANKNAME NVARCHAR (50) =NULL
,@BANKACCOUNTNUMBER NVARCHAR (50) =NULL
,@USERTYPE NVARCHAR (50) =NULL
)
AS
BEGIN

SET NOCOUNT ON

INSERT INTO EMANDATESMSLINKLOG
(
 PARTYCODE
,MANDATEMAPPINGREFNO
,SMSLINK
,CREATEDON
,SMSSTATUS
,BANKNAME
,BANKNUMBER
,USERTYPE
)

VALUES (
 @PARTYCODE
,@MANDATEMAPPINGREFNO
,@SMSLINK
,GETDATE()
,@SMSLINKSTATUS
,@BANKNAME
,@BANKACCOUNTNUMBER
,@USERTYPE
)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EmandateSMSLinkLogUpdate
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[USP_EmandateSMSLinkLogUpdate] 
	 @MANDATEMAPPINGREFNO NVARCHAR(100),
	 @SMSSTATUS NVARCHAR(50)
AS
BEGIN
    UPDATE EMANDATESMSLINKLOG
	SET
	SMSSTATUS = @SMSSTATUS,
	UPDATEDON = GETDATE()
	WHERE
	MANDATEMAPPINGREFNO = @MANDATEMAPPINGREFNO
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Emodification_SendMobileNoVerificationLink
-- --------------------------------------------------

CREATE PROCEDURE usp_Emodification_SendMobileNoVerificationLink
@PartyCode NVARCHAR(100),
@EmailText NVARCHAR(MAX),
@EmailId NVARCHAR(100),
@Subject NVARCHAR(100) = 'Mobile no e-modification'
AS
BEGIN
	SET @EmailText = REPLACE(@EmailText, '\n', '<br/>')

	EXEC MSDB.DBO.SP_SEND_DBMAIL                                    
		@RECIPIENTS = @EmailId,                                    
		@COPY_RECIPIENTS = '',                                    
		@blind_copy_recipients= '',                          
		@PROFILE_NAME = 'NXT',                                    
		@BODY_FORMAT ='HTML',                                    
		@SUBJECT = @Subject,                    
		@FILE_ATTACHMENTS = '',                                   
		@BODY = @EmailText 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Error_log_ModuleFilter
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Error_log_ModuleFilter]
(
	@Modulename varchar(500),
	@Fromdate Date,
	@Todate Date
)
as
begin

       If(@Modulename='TerminalTradeReport (Equity) - CommonRejection')
	   BEGIN
	   	   		SELECT *
        FROM [NXT].[dbo].[Error_log] with (nolock)
		where ( @Modulename = 'All' OR ModuleName =@Modulename )
		and convert(date,createdDate) between @Fromdate and @Todate 
		AND Controller <> '' 
		AND Action <> ''
		AND Event = 'Log'
	   END

	   ELSE
	   BEGIN
	   		SELECT *
        FROM [NXT_Logs].[dbo].[Error_log] with (nolock)
		where ( @Modulename = 'All' OR ModuleName =@Modulename )
		and convert(date,createdDate) between @Fromdate and @Todate 
		AND Controller <> '' 
		AND Action <> ''
		AND Event = 'Log'
	   END

		

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Error_log_ModuleFilter_BeeNXT
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_Error_log_ModuleFilter_BeeNXT]  
		(  
		 @Modulename varchar(500),  
		 @Fromdate Date,  
		 @Todate Date  
		)  
		AS  
		BEGIN  
		  
			SELECT *  FROM [dbo].[Error_log] WITH (NOLOCK)  
			WHERE ProjectName= 'BEENXT' AND ( @Modulename = 'All' OR ModuleName =@Modulename )  
				  AND CONVERT(DATE,createdDate) BETWEEN @Fromdate and @Todate   
				  AND Controller <> ''   
				  AND ACTION <> ''  
				  AND EVENT = 'Log'  
			ORDER BY createdDate DESC
		  
		end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Error_log_Modulename
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Error_log_Modulename]
as
begin

	select 'All' as Value
	Union ALL
	SELECT distinct [ModuleName] as Value
    FROM [dbo].[Error_log] with (nolock)
	where [ModuleName] not like '%Itrade%' AND Event = 'Log'
	and [ModuleName] not like '%Client Reactivation Post confirm %'

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Error_log_Modulename_BeeNXT
-- --------------------------------------------------

	CREATE PROCEDURE [dbo].[usp_Error_log_Modulename_BeeNXT]  
	AS  
	BEGIN  
	  
			 SELECT 'All' as Value  
	 UNION ALL  
			 SELECT DISTINCT [ModuleName] as Value  
			 FROM [dbo].[Error_log] with (nolock)  
			 WHERE ProjectName= 'BEENXT' AND [ModuleName] NOT LIKE '%Itrade%' AND Event = 'Log'  
			 AND [ModuleName] not like '%Client Reactivation Post confirm %'  
			  
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_error_log_Truncate
-- --------------------------------------------------

Create procedure usp_error_log_Truncate
as
begin

insert into [NXT_Logs].dbo.[Error_log]
(
	ProjectName
	,ModuleName
	,Controller
	,ErrorMsg
	,Action
	,API_URL
	,Request
	,Response
	,StackTrace
	,CreatedBy
	,createdDate
	,Event
	,IPadress
)
select 
		 ProjectName
		,ModuleName
		,Controller
		,ErrorMsg
		,Action
		,API_URL
		,Request
		,Response
		,StackTrace
		,CreatedBy
		,createdDate
		,Event
		,IPadress
 from [dbo].[Error_log] with (nolock)

 Truncate table [Error_log]


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Exotel_Error_Log
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Exotel_Error_Log]
(
	@JsonResponse varchar(max),
	@ExceptionMessage  varchar(max)
)
as
begin

	Insert into Exotel_Error_Log
	Select 
	@JsonResponse ,
	@ExceptionMessage,
	GETDATE() 

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Facebook_Reauthorisation_BKP_20Aug2018
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_Facebook_Reauthorisation_BKP_20Aug2018]
	( 
		@SubBroker VARCHAR(50),
		@Email VARCHAR(100)
	)

	--EXEC Usp_Facebook_Reauthorisation @SubBroker='AADD',@Email='arvindyadav1200@gmail.com'

	AS
	BEGIN
	
	Declare @Date datetime
		select @Date = Cast(updated_Date as date) FROM tbl_SocialMedia_Login WITH (NOLOCK) WHERE SB_Tag_Email =(LTRIM(RTRIM(@SubBroker))+'-'+LTRIM(RTRIM(@Email)))
		
		
		
		IF ISNULL(@Date,cast(GETDATE() as date)) > DATEADD(DAY, -30, CAST(GETDATE() AS DATE))

		BEGIN

		SELECT 0 as MSG

		END

		ELSE

		BEGIN

		SELECT 1 as MSG

		End

		
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_findinJobs
-- --------------------------------------------------

Create Procedure [dbo].[usp_findinJobs](@Str as varchar(500))

as

select b.name,

Case when b.enabled=1 then 'Active' else 'Deactive' end as Status,

date_created,date_modified,a.step_id,a.step_name,a.command

from msdb.dbo.sysjobsteps a, msdb.dbo.sysjobs b

where command like '%'+@Str+'%'

and a.job_id=b.job_id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FINDINUSP
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_FINDINUSP]                  
 @DBNAME VARCHAR(500),                
 @SRCSTR VARCHAR(500)                  
AS                  
                  
 SET NOCOUNT ON                
 SET @SRCSTR  = '%' + @SRCSTR + '%'                  
                
 DECLARE @STR AS VARCHAR(1000),@xdbname as varchar(500)                
    
 set @xdbname=@DBNAME    
    
 SET @STR=''                
 IF @DBNAME <>''                
 BEGIN                
 SET @DBNAME=@DBNAME+'.DBO.'                
 END                
 ELSE                
 BEGIN                
 SET @DBNAME=DB_NAME()+'.DBO.'                
 END                
 ----PRINT @DBNAME                
                
 SET @STR='SELECT DISTINCT '''+@xdbname+''' as DBNAME,O.NAME,O.XTYPE FROM '+@DBNAME+'SYSCOMMENTS  C '                 
 SET @STR=@STR+' JOIN '+@DBNAME+'SYSOBJECTS O ON O.ID = C.ID '                 
 SET @STR=@STR+' WHERE O.XTYPE IN (''P'',''V'') AND C.TEXT LIKE '''+@SRCSTR+''''                  
 PRINT @STR                
  EXEC(@STR)                
        
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Force_Update_Sub_BrokerUser_Mob
-- --------------------------------------------------
CREATE procedure [dbo].usp_Force_Update_Sub_BrokerUser_Mob(  
@forceUpdateFlag varchar,  
@subBrokerId INT  
)  
AS      
BEGIN   
 UPDATE ForceUpdate_NXT_Mob  
 SET IsForceUpdate = @forceUpdateFlag
 WHERE ID = @subBrokerId   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_ForceUpdate_NXT_Mob
-- --------------------------------------------------

Create procedure [dbo].[usp_ForceUpdate_NXT_Mob]
(
	 @sub_broker varchar(100)
	,@VersionCode  varchar(100)
	,@Plateform varchar(100)
	--,@IsForceUpdate varchar(100)
)
as
begin


--usp_ForceUpdate_NXT_Mob 

Select Case when count(1)>0 Then 'True' ELSE 'False' END Message from ForceUpdate_NXT_Mob
where IsForceUpdate='Y'
and CurrentVersion<>@VersionCode
and sub_broker=@sub_broker
and Plateform=@Plateform
--Update 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_ForDealers_ClientORSB
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_ForDealers_ClientORSB]
	--@SubBroker VARCHAR(10)
	--,
	@Search VARCHAR(20)
AS
BEGIN

--EXEC [usp_ForDealers_ClientORSB] 'AJYC'

	SET NOCOUNT ON

If (SELECT count(1) 
	FROM 
		[196.1.115.132].rolemgm.dbo.user_login with (nolock) --where Access_Code in ('JJNG') WITH(NOLOCK)
	WHERE
		(
				Access_Code LIKE '%' + @Search + '%'
				OR person_name LIKE '%' + @Search + '%'
			)
		and  status=1
	  and login_inactive_date>getdate()
	  and access_to='SB'
	  --and usertype='ADMIN'
	  and username is not NULL
	  )>0
begin
	  Select 'SB' Type
END
ELSE
BEgin

	Select  'Client' Type
END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_AdvisoryData
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_Get_AdvisoryData](
	@AdvisoryPerformanceReportDataId INT
) 
AS    
BEGIN    
	SELECT details.Market, details.Segment, details.TotalCalls, details.PositiveCalls, details.SRPercentage, details.NetRRR 
	From AdvisoryPerformanceReportDataDetails details
	WHERE details.AdvisoryPerformanceReportData_Id = @AdvisoryPerformanceReportDataId;
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_AllDigitalLibraryCreative
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_Get_AllDigitalLibraryCreative]       
AS        
BEGIN        
	SELECT  Creative_id AS CreativeId  
	,Category
	,CreativeName   
	,IsExpiry
	,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]  
	,Personalised 
	,[ImageName]  
	,[ImagePath]  AS [ImageUrl]      
	,CreativeType as PopupType
	,[Active]  
	,[CreatedDate]  
	,CreatedBy
	FROM  dbo.tbl_DigitalLibraryCreatives WITH (NOLOCK)  
	Order by [CreatedDate] Desc   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_AllDigitalLibraryCreative_Beenxt
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_Get_AllDigitalLibraryCreative_Beenxt]         
AS          
BEGIN          
 SELECT  Creative_id AS CreativeId    
 ,Category  
 ,CreativeName     
 ,IsExpiry  
 ,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]    
 ,Personalised   
 ,[ImageName]    
 ,[ImagePath]  AS [ImageUrl]        
 ,CreativeType as PopupType  
 ,[Active]    
 ,[CreatedDate]    
 ,CreatedBy  
 FROM  dbo.tbl_DigitalLibraryCreatives_Beenxt WITH (NOLOCK)    
 Order by [CreatedDate] Desc     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_BeeNXTDigitalLibraryCreativeByType
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Get_BeeNXTDigitalLibraryCreativeByType]   
(      
@Category varchar(100),
@SearchText varchar(100),
@Accesscode varchar(100)
)        
   
AS        
BEGIN        
	SELECT  a.Creative_id AS CreativeId  
	,a.Category
	,a.CreativeName   
	,a.IsExpiry
	,CONVERT(VARCHAR, a.[ExpiryDate], 6) AS [ExpiryDate]  
	,a.Personalised 
	,a.[ImageName]  
	,a.[ImagePath]  AS ImagePath
	,a.ImageType
	,a.CreativeType as CreativeType
	,a.[Active]  
	,a.[CreatedDate]  
	,a.CreatedBy
	FROM  dbo.tbl_DigitalLibraryCreatives_Beenxt a
	LEFT JOIN tbl_DigitalLibrarySubbrokerMapping_BeeNXT b on ( a.Creative_id = b.Creative_id AND a.CreativeType = 'Individual')    
	where Category = @Category AND Active = 1 AND  ExpiryDate > dateadd(day,-1, cast(getdate() as date))
	AND CreativeName like '%' + @SearchText + '%'
	AND ( a.CreativeType = 'All' OR (a.CreativeType = 'Individual' AND b.sub_broker = @Accesscode))
	Order by [CreatedDate] Desc   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GET_BulkIPO_ClientGroup
-- --------------------------------------------------
CREATE PROCEDURE usp_GET_BulkIPO_ClientGroup  
(  
 @SBTag  VARCHAR(100)  
)  
AS  
BEGIN  
 SELECT CG.Name, Count(CGC.GroupId) AS ClientCount FROM BulkIPO_ClientGroup CG WITH(NOLOCK)  
  LEFT JOIN BulkIPO_ClientGroup_Clients CGC WITH(NOLOCK)   
   ON CG.Id = CGC.GroupId  
  WHERE CG.SBTag = @SBTag
Group BY CG.Name, CGC.GroupId 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GET_BulkIPO_ClientGroup_UAT
-- --------------------------------------------------
CREATE PROCEDURE usp_GET_BulkIPO_ClientGroup_UAT  
(  
 @SBTag  VARCHAR(100),
 @GrpName VARCHAR(100)=''
)  
AS  
BEGIN  
 SELECT CG.Name, Count(CGC.GroupId) AS ClientCount FROM BulkIPO_ClientGroup CG WITH(NOLOCK)  
  LEFT JOIN BulkIPO_ClientGroup_Clients CGC WITH(NOLOCK)   
   ON CG.Id = CGC.GroupId  
  WHERE CG.SBTag = @SBTag
  AND(@GrpName='' or (@GrpName!='' AND  CG.Name=@GrpName))
Group BY CG.Name, CGC.GroupId 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_BulkIPO_ClientGroupName
-- --------------------------------------------------
CREATE PROCEDURE usp_Get_BulkIPO_ClientGroupName
(
	@SBTag  VARCHAR(100)
)
AS
BEGIN
	SELECT Name FROM BulkIPO_ClientGroup WITH(NOLOCK) 
	WHERE SBTag = @SBTag
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_Business_Dashboard_Details_Revenue
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_Get_Business_Dashboard_Details_Revenue]
(
	@SubBroker VARCHAR(50)
)

	--EXEC [Usp_Get_Business_Dashboard_Details_Revenue] 'ET'		
	--EXEC Usp_Get_Business_Dashboard_Details_bkp_11022018'AMTT'	
	--EXEC [Usp_Get_Business_Dashboard_Details_bkp16-aug-2018] 'DDVM'		
AS
BEGIN
set nocount on 
		--DECLARE @STDate DATE = CASE WHEN MONTH(GETDATE()-1) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE()-1)) AS VARCHAR(4))+'-04'+'-01') ELSE CONVERT(DATE,CAST(YEAR(DATEADD(YY,0,GETDATE()-1)) AS VARCHAR(4))+'-04'+'-01') END
		DECLARE @STDate DATE = dbo.fn_Get_StartData('YTD')
		DECLARE @EdDate DATE = GETDATE()
		DECLARE @MSTDate DATE = CAST(DATEADD(m, DATEDIFF(m, 0, GETDATE()-1), 0) AS DATE)
		--SELECT @STDate=convert(varchar(15),@STDate,109),@EdDate=convert(varchar(15),@EdDate,109),@MSTDate=convert(varchar(15),@MSTDate,109)
		--select @STDate,@EdDate,@MSTDate

		DECLARE @STDate1 Varchar(100)
		DECLARE @EdDate1 Varchar(100)
		DECLARE @MSTDate1 Varchar(100)


		SELECT @STDate1=convert(varchar(15),@STDate,109),@EdDate1=convert(varchar(15),@EdDate,109),@MSTDate1=convert(varchar(15),@MSTDate,109)
			--select @STDate1,@EdDate1,@MSTDate1



Create Table #MTD_Gross_Revenue	
(
	Region	varchar(500)
	,Branch	varchar(500)
	,SB	Varchar(7500)
	,NetGross	Numeric(18,4)
	,AdditionalBrok	Numeric(18,4)
	,TotalGross	Numeric(18,4)
	,Remisior	Numeric(18,4)
	,NetAngelShare	Numeric(18,4)
	,AddAngelShare	Numeric(18,4)
	,TotalNetAngelShare	Numeric(18,4)
	,Angel_Share_Perc Numeric(18,2)	
	,Remisior_Share_Perc Numeric(18,2)
)

Create Table #YTD_Gross_Revenue	
(
	Region	varchar(500)
	,Branch	varchar(500)
	,SB	Varchar(7500)
	,NetGross	Numeric(18,4)
	,AdditionalBrok	Numeric(18,4)
	,TotalGross	Numeric(18,4)
	,Remisior	Numeric(18,4)
	,NetAngelShare	Numeric(18,4)
	,AddAngelShare	Numeric(18,4)
	,TotalNetAngelShare	Numeric(18,4)
	,Angel_Share_Perc Numeric(18,2)	
	,Remisior_Share_Perc Numeric(18,2)
)
		
		insert into #MTD_Gross_Revenue
		EXEC [196.1.115.167].remisior.dbo.rpt_daily_sharing @FDATE=@MSTDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker
		--EXEC dbo.rpt_daily_sharing @FDATE=@MSTDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker

		insert into #YTD_Gross_Revenue
		EXEC [196.1.115.167].remisior.dbo.rpt_daily_sharing @FDATE=@STDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker
		--EXEC dbo.rpt_daily_sharing @FDATE=@STDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker



		;WITH MTD_Gross_Revenue 
		AS
		(
				select @SubBroker sub_broker,TotalGross MTD_Gross_Revenue from #MTD_Gross_Revenue  
				--SELECT S.sub_broker ,SUM(Gross_Revenue) AS MTD_Gross_Revenue
				--FROM tbl_SB_MonthlyRevenue S WITH(NOLOCK)
				--WHERE S.sub_broker = @SubBroker 
				--AND CAST(S.Trade_Month AS DATE) BETWEEN @MSTDate AND @EdDate
				--GROUP BY S.sub_broker
		
		), YTD_Gross_Revenue 
		AS
		(
				select @SubBroker sub_broker,TotalGross YTD_Gross_Revenue from #YTD_Gross_Revenue
				--SELECT S.sub_broker,SUM(Gross_Revenue) AS YTD_Gross_Revenue
				--FROM tbl_SB_MonthlyRevenue S WITH(NOLOCK)
				--WHERE S.sub_broker = @SubBroker 
				--AND CAST(S.Trade_Month AS DATE) BETWEEN @STDate AND @EdDate
				--GROUP BY S.sub_broker
		
		
		)

		SELECT	@SubBroker as sub_broker
		-- YTD_Clt.sub_broker
			
				,CONVERT(DECIMAL(20,2),ROUND(ISNULL(MTD_Gross_Revenue,0),2)) AS MTD_Gross_Revenue
				,CONVERT(DECIMAL(20,2),ROUND(ISNULL(YTD_Gross_Revenue,0),2)) AS YTD_Gross_Revenue
				
		into #temp
		FROM 
			MTD_Gross_Revenue Mtd_Rev
			full join YTD_Gross_Revenue Ytd_Rev		
		ON Mtd_Rev.sub_broker = Ytd_Rev.sub_broker
		
	-- added by Narendra-- to show business dashboard records not on the basis of client activation date..
		select @SubBroker sub_Broker,
		--max(MTD_New_Clt_Aquired) as MTD_New_Clt_Aquired, max(YTD_New_Clt_Aquired) YTD_New_Clt_Aquired,max(MTD_Traded_Client) MTD_Traded_Client,max(YTD_Traded_Client)YTD_Traded_Client,
		max(MTD_Gross_Revenue)MTD_Gross_Revenue,max(YTD_Gross_Revenue)YTD_Gross_Revenue
 --,max(MF_AUM)MF_AUM,max(Active_Clients)Active_Clients,max(MF_Aquired_Clients)MF_Aquired_Clients 
	from #temp

		drop table #temp
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_Business_Dashboard_Details_Revenue_V2
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Get_Business_Dashboard_Details_Revenue_V2]
(
	@SubBroker VARCHAR(50)
)

	--EXEC [Usp_Get_Business_Dashboard_Details_Revenue_V2] 'ET'		
	--EXEC Usp_Get_Business_Dashboard_Details_bkp_11022018'AMTT'	
	--EXEC [Usp_Get_Business_Dashboard_Details_bkp16-aug-2018] 'DDVM'		
AS
BEGIN
set nocount on 
		--DECLARE @STDate DATE = CASE WHEN MONTH(GETDATE()-1) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE()-1)) AS VARCHAR(4))+'-04'+'-01') ELSE CONVERT(DATE,CAST(YEAR(DATEADD(YY,0,GETDATE()-1)) AS VARCHAR(4))+'-04'+'-01') END
		DECLARE @STDate DATE = dbo.fn_Get_StartData('YTD')
		DECLARE @EdDate DATE = GETDATE()
		DECLARE @MSTDate DATE = CAST(DATEADD(m, DATEDIFF(m, 0, GETDATE()-1), 0) AS DATE)
		--SELECT @STDate=convert(varchar(15),@STDate,109),@EdDate=convert(varchar(15),@EdDate,109),@MSTDate=convert(varchar(15),@MSTDate,109)
		--select @STDate,@EdDate,@MSTDate

		DECLARE @STDate1 Varchar(100)
		DECLARE @EdDate1 Varchar(100)
		DECLARE @MSTDate1 Varchar(100)


		SELECT @STDate1=convert(varchar(15),@STDate,109),@EdDate1=convert(varchar(15),@EdDate,109),@MSTDate1=convert(varchar(15),@MSTDate,109)
			--select @STDate1,@EdDate1,@MSTDate1



Create Table #MTD_Gross_Revenue	
(
	Region	varchar(500)
	,Branch	varchar(500)
	,SB	Varchar(7500)
	,NetGross	Numeric(18,4)
	,AdditionalBrok	Numeric(18,4)
	,TotalGross	Numeric(18,4)
	,Remisior	Numeric(18,4)
	,NetAngelShare	Numeric(18,4)
	,AddAngelShare	Numeric(18,4)
	,TotalNetAngelShare	Numeric(18,4)
	,Angel_Share_Perc Numeric(18,2)	
	,Remisior_Share_Perc Numeric(18,2)
)

Create Table #YTD_Gross_Revenue	
(
	Region	varchar(500)
	,Branch	varchar(500)
	,SB	Varchar(7500)
	,NetGross	Numeric(18,4)
	,AdditionalBrok	Numeric(18,4)
	,TotalGross	Numeric(18,4)
	,Remisior	Numeric(18,4)
	,NetAngelShare	Numeric(18,4)
	,AddAngelShare	Numeric(18,4)
	,TotalNetAngelShare	Numeric(18,4)
	,Angel_Share_Perc Numeric(18,2)	
	,Remisior_Share_Perc Numeric(18,2)
)
		
		insert into #MTD_Gross_Revenue
		EXEC [196.1.115.167].remisior.dbo.rpt_daily_sharing @FDATE=@MSTDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker
		--EXEC dbo.rpt_daily_sharing @FDATE=@MSTDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker

		insert into #YTD_Gross_Revenue
		EXEC [196.1.115.167].remisior.dbo.rpt_daily_sharing @FDATE=@STDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker
		--EXEC dbo.rpt_daily_sharing @FDATE=@STDate1,@TDATE=@EdDate1,@EntityCode=@SubBroker,@EntityType='SB',@FltrEntity='SB',@Segment='%',@type='%',@flag='O',@access_to='SB',@access_code=@SubBroker



		;WITH MTD_Gross_Revenue 
		AS
		(
				select @SubBroker sub_broker,TotalGross MTD_Gross_Revenue from #MTD_Gross_Revenue  
				--SELECT S.sub_broker ,SUM(Gross_Revenue) AS MTD_Gross_Revenue
				--FROM tbl_SB_MonthlyRevenue S WITH(NOLOCK)
				--WHERE S.sub_broker = @SubBroker 
				--AND CAST(S.Trade_Month AS DATE) BETWEEN @MSTDate AND @EdDate
				--GROUP BY S.sub_broker
		
		), YTD_Gross_Revenue 
		AS
		(
				select @SubBroker sub_broker,TotalGross YTD_Gross_Revenue from #YTD_Gross_Revenue
				--SELECT S.sub_broker,SUM(Gross_Revenue) AS YTD_Gross_Revenue
				--FROM tbl_SB_MonthlyRevenue S WITH(NOLOCK)
				--WHERE S.sub_broker = @SubBroker 
				--AND CAST(S.Trade_Month AS DATE) BETWEEN @STDate AND @EdDate
				--GROUP BY S.sub_broker
		
		
		)

		SELECT	@SubBroker as sub_broker
		-- YTD_Clt.sub_broker
			
				,CONVERT(DECIMAL(20,2),ROUND(ISNULL(MTD_Gross_Revenue,0),2)) AS MTD_Gross_Revenue
				,CONVERT(DECIMAL(20,2),ROUND(ISNULL(YTD_Gross_Revenue,0),2)) AS YTD_Gross_Revenue
				
		into #temp
		FROM 
			MTD_Gross_Revenue Mtd_Rev
			full join YTD_Gross_Revenue Ytd_Rev		
		ON Mtd_Rev.sub_broker = Ytd_Rev.sub_broker
		
	-- added by Narendra-- to show business dashboard records not on the basis of client activation date..
		select @SubBroker sub_Broker,@STDate YTd_StartDate,@MSTDate MTD_StartDate, @EdDate EndDate,
		--max(MTD_New_Clt_Aquired) as MTD_New_Clt_Aquired, max(YTD_New_Clt_Aquired) YTD_New_Clt_Aquired,max(MTD_Traded_Client) MTD_Traded_Client,max(YTD_Traded_Client)YTD_Traded_Client,
		max(MTD_Gross_Revenue)MTD_Gross_Revenue,max(YTD_Gross_Revenue)YTD_Gross_Revenue
 --,max(MF_AUM)MF_AUM,max(Active_Clients)Active_Clients,max(MF_Aquired_Clients)MF_Aquired_Clients 
	from #temp

		drop table #temp
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_Business_Dashboard_grouptopper_v1_Mob
-- --------------------------------------------------
Create Procedure usp_Get_Business_Dashboard_grouptopper_v1_Mob
(
	@Sub_broker varchar(100)
)

as
begin

EXEC [Usp_Get_Business_Dashboard_Details_V1_Mob]  @Sub_broker
EXEC [usp_IPartner_grouptopper_v1_Mob] @Sub_broker

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_Business_Home_Mobile_2
-- --------------------------------------------------
CREATE Procedure usp_get_Business_Home_Mobile_2
(
@sub_broker varchar(100)
--,
--@Filter varchar(100)=Null

)

/*

EXEC usp_get_Business_Home_Mobile_2 'CBHO'

*/
as
begin 

EXEC [172.31.16.109].NXT.dbo.usp_GetSB_AUM_Mobile_2 @sub_broker--,@Filter

--EXEC [Usp_Get_MyClient_ClientServiceSummary_Mobile_2] @sub_broker

EXEC usp_get_Business_Clients_Mobile_2 @sub_broker

EXEC [196.1.115.167].[remisior].dbo.[Usp_Get_Business_Dashboard_Details_Revenue] @sub_broker

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_get_Business_Report_Paid_Brokerage
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_get_Business_Report_Paid_Brokerage]
(@Sub_Broker varchar(100))
AS
BEGIN 

SET NOCOUNT ON 

SELECT * FROM 
(
	SELECT SB,convert(date,Month) Month,[Final Amount] FinalAmount FROM Paid_Brokerage_Sept With (nolock) 
	UNION
	SELECT [Agent Code],convert(date,Month),[Final Amount] FROM Paid_Brokerage_Oct With (nolock)
	UNION
	SELECT [Agent Code],'01-'+Month,[Total Paid]  FROM Paid_Brokerage_June With (nolock)
	UNION
	SELECT [Agent Code],convert(date,Month),[Final Payout] FROM Paid_Brokerage_July With (nolock)
	UNION
	SELECT [Agent Code],'01-'+Month Month,[Final Payout] FROM Paid_Brokerage_August  With (nolock)
) t
Where t.SB=@Sub_Broker 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_CustomPlanDetails
-- --------------------------------------------------


CREATE proc [dbo].[usp_Get_CustomPlanDetails]
as 
begin
	select * from [NXT].[dbo].[tbl_NXT_CustomPlan]
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_DDLCat
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_Get_DDLCat] --[usp_Get_DDLCat]
(
	@category VARCHAR(100) = NULL
)
AS
BEGIN
	SELECT DDC.Id AS CatId, DDC.Text AS CatText, DDC.Value AS CatValue, DDC.IsActive AS CatActive, 
		PM.Id AS PayModeId, PM.Text AS PayMode, PM.Value AS PayModeValue, DDP.IsActive AS PayModeActive
	FROM DDLCat DDC
	INNER JOIN DDLCat_PaymentMode DDP ON DDC.Id = DDP.CatId
	INNER JOIN PaymentMode PM ON PM.Id = DDP.PayModeId
	WHERE DDC.Value = ISNULL(@category, DDC.Value)
	Order by DDC.Id --DDC.Text
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_DDLCat_New
-- --------------------------------------------------
/****** Object:  StoredProcedure [dbo].[usp_Get_DDLCat_New]    Script Date: 29-04-2022 14:20:22 ******/


CREATE PROCEDURE [dbo].[usp_Get_DDLCat_New] --[usp_Get_DDLCat_New_V1] 'LIC OF INDIA'
(
	@category VARCHAR(100) = NULL
)
AS
BEGIN
    IF(@category = 'LIC OF INDIA')
	BEGIN
	SELECT DDC.Id AS CatId, DDC.Text AS CatText, DDC.Value AS CatValue, DDC.IsActive AS CatActive, 
		PM.Id AS PayModeId, PM.Text AS PayMode, PM.Value AS PayModeValue, DDP.IsActive AS PayModeActive
	FROM DDLCat DDC
	INNER JOIN DDLCat_PaymentMode DDP ON DDC.Id = DDP.CatId
	INNER JOIN PaymentMode PM ON PM.Id = DDP.PayModeId
	Order by DDC.Id --DDC.Text
	END
	ELSE
	BEGIN
	SELECT DDC.Id AS CatId, DDC.Text AS CatText, DDC.Value AS CatValue, DDC.IsActive AS CatActive, 
		PM.Id AS PayModeId, PM.Text AS PayMode, PM.Value AS PayModeValue, DDP.IsActive AS PayModeActive
	FROM DDLCat DDC
	INNER JOIN DDLCat_PaymentMode DDP ON DDC.Id = DDP.CatId
	INNER JOIN PaymentMode PM ON PM.Id = DDP.PayModeId
	WHERE DDC.Value = ISNULL(@category, DDC.Value) AND DDC.Value NOT IN ('POL','EMP')
	Order by DDC.Id 
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_DDLCat_New_V1
-- --------------------------------------------------
/****** Object:  StoredProcedure [dbo].[usp_Get_DDLCat_New]    Script Date: 29-04-2022 14:20:22 ******/


CREATE PROCEDURE [dbo].[usp_Get_DDLCat_New_V1] --[usp_Get_DDLCat_New] 'Policy Holder Testing Limited'
(
	@category VARCHAR(100) = NULL
)
AS
BEGIN
    if(@category = 'LIC OF INDIA')
	BEGIN
	SELECT DDC.Id AS CatId, DDC.Text AS CatText, DDC.Value AS CatValue, DDC.IsActive AS CatActive, 
		PM.Id AS PayModeId, PM.Text AS PayMode, PM.Value AS PayModeValue, DDP.IsActive AS PayModeActive
	FROM DDLCat DDC
	INNER JOIN DDLCat_PaymentMode DDP ON DDC.Id = DDP.CatId
	INNER JOIN PaymentMode PM ON PM.Id = DDP.PayModeId
	Order by DDC.Id --DDC.Text
	END
	ELSE
	BEGIN
	SELECT DDC.Id AS CatId, DDC.Text AS CatText, DDC.Value AS CatValue, DDC.IsActive AS CatActive, 
		PM.Id AS PayModeId, PM.Text AS PayMode, PM.Value AS PayModeValue, DDP.IsActive AS PayModeActive
	FROM DDLCat DDC
	INNER JOIN DDLCat_PaymentMode DDP ON DDC.Id = DDP.CatId
	INNER JOIN PaymentMode PM ON PM.Id = DDP.PayModeId
	WHERE DDC.Value = ISNULL(@category, DDC.Value) AND DDC.Value NOT IN ('POL','EMP')
	Order by DDC.Id 
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_DDLCat_V1
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_Get_DDLCat_V1] --[usp_Get_DDLCat]
(
	@category VARCHAR(100) = NULL
)
AS
BEGIN
	SELECT DDC.Id AS CatId, DDC.Text AS CatText, DDC.Value AS CatValue, DDC.IsActive AS CatActive, 
		PM.Id AS PayModeId, PM.Text AS PayMode, PM.Value AS PayModeValue, DDP.IsActive AS PayModeActive
	FROM DDLCat DDC
	INNER JOIN DDLCat_PaymentMode DDP ON DDC.Id = DDP.CatId
	INNER JOIN PaymentMode PM ON PM.Id = DDP.PayModeId
	WHERE DDC.Value = ISNULL(@category, DDC.Value)
	Order by DDC.Id --DDC.Text
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DigitalLibraryCreativeArchive
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_Get_DigitalLibraryCreativeArchive]       
AS        
BEGIN        
	SELECT  Creative_id AS CreativeId  
	,Category
	,CreativeName   
	,IsExpiry
	,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]  
	,Personalised 
	,[ImageName]  
	,[ImagePath]  AS [ImageUrl]      
	,CreativeType as SubBrokerTag
	,[Active]  
	,[CreatedDate]  
	,CreatedBy
	,case when IsDeleted = 1 then 'Deleted' else 'Expired' end as ArchiveType
	FROM  dbo.tbl_DigitalLibraryCreatives WITH (NOLOCK)  
	where Active = 0 OR IsDeleted = 1 OR  ExpiryDate < dateadd(day,-1, cast(getdate() as date))
	Order by [CreatedDate] Desc   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DigitalLibraryCreativeArchive_BeeNXT
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_Get_DigitalLibraryCreativeArchive_BeeNXT]       
AS        
BEGIN        
	SELECT  Creative_id AS CreativeId  
	,Category
	,CreativeName   
	,IsExpiry
	,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]  
	,Personalised 
	,[ImageName]  
	,[ImagePath]  AS [ImageUrl]      
	,CreativeType as SubBrokerTag
	,[Active]  
	,[CreatedDate]  
	,CreatedBy
	,case when IsDeleted = 1 then 'Deleted' else 'Expired' end as ArchiveType
	FROM  dbo.tbl_DigitalLibraryCreatives_Beenxt WITH (NOLOCK)  
	where Active = 0 OR IsDeleted = 1 OR  ExpiryDate < dateadd(day,-1, cast(getdate() as date))
	Order by [CreatedDate] Desc   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_DigitalLibraryCreativeByType
-- --------------------------------------------------

  --[dbo].[usp_Get_DigitalLibraryCreativeByType]   'KYC' ,''
CREATE PROCEDURE [dbo].[usp_Get_DigitalLibraryCreativeByType]   
(      
@Category varchar(100),
@SearchText varchar(100) 
)        
   
AS        
BEGIN        
	SELECT  Creative_id AS CreativeId  
	,Category
	,CreativeName   
	,IsExpiry
	,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]  
	,Personalised 
	,[ImageName]  
	,[ImagePath]  AS ImagePath
	,CreativeType as CreativeType
	,[Active]  
	,[CreatedDate]  
	,CreatedBy
	FROM  dbo.tbl_DigitalLibraryCreatives WITH (NOLOCK)
	where Category = @Category AND Active = 1 AND  ExpiryDate >= dateadd(day,-1, cast(getdate() as date))
	AND CreativeName like '%' + @SearchText + '%'
	Order by [CreatedDate] Desc   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_DigitalLibraryCreativeByType_BeeNXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_Get_DigitalLibraryCreativeByType_BeeNXT]   
(      
@Category varchar(100),
@SearchText varchar(100) 
)        
   
AS        
BEGIN        
	SELECT  Creative_id AS CreativeId  
	,Category
	,CreativeName   
	,IsExpiry
	,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]  
	,Personalised 
	,[ImageName]  
	,[ImagePath]  AS ImagePath
	,CreativeType as CreativeType
	,[Active]  
	,[CreatedDate]  
	,CreatedBy
	FROM  dbo.tbl_DigitalLibraryCreatives_Beenxt WITH (NOLOCK)
	where Category = @Category AND Active = 1 AND  ExpiryDate >= dateadd(day,-1, cast(getdate() as date))
	AND CreativeName like '%' + @SearchText + '%'
	Order by [CreatedDate] Desc   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DigitalLibraryCreativeLog
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_Get_DigitalLibraryCreativeLog]        
AS          
BEGIN          

select a.Creative_id,b.access_code into #AllUser 
from tbl_DigitalLibraryCreatives a       
LEFT JOIN (      
select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL       
where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL       
AND  access_code is not NULL AND access_code <> ''      
) b on (1=1)      
where 
a.CreativeType = 'All' AND         
CONVERT(DATE,a.[CreatedDate])>DATEADD(DD,-31,GETDATE())          
      
SELECT case when a.CreativeType = 'Individual' then COUNT(b.sub_broker) else COUNT(d.access_code) end cnt         
,a.Creative_id, a.CreativeType as CreativeType into #Count         
FROM tbl_DigitalLibraryCreatives a         
LEFT JOIN tbl_DigitalLibrarySubbrokerMapping b on ( a.Creative_id = b.Creative_id AND a.CreativeType = 'Individual')        
LEFT JOIN #AllUser d on (a.Creative_id = d.Creative_id  AND a.CreativeType = 'All' )    
where    
CONVERT(DATE,a.[CreatedDate])>DATEADD(DD,-31,GETDATE())          
group by a.Creative_id, a.CreativeType        

select * INTO #fINAL from           
(          
SELECT ROW_NUMBER() over (partition by a.Creative_id order by a.[CreatedDate]  ) RN, 
a.Creative_id,        
a.CreativeName         
,a.CreativeType as CreativeType        
,a.Category
,a.ImageName            
,a.IsExpiry 
,a.ExpiryDate
,a.Personalised          
,a.[Createdby]          
,a.[CreatedDate]          
FROM tbl_DigitalLibraryCreatives  a         
where    
CONVERT(DATE,a.[CreatedDate]) > DATEADD(DD,-31,GETDATE())         
) T         
             
SELECT rn,
A.Creative_id,          
A.CreativeName          
,A.CreativeType          
,A.Category            
,A.ImageName            
,A.IsExpiry 
,A.ExpiryDate
,A.Personalised         
,A.[CreatedBy]          
,A.[CreatedDate]          
,B.cnt CNT      
FROM #fINAL A           
LEFT JOIN #Count B on A.Creative_id= B.Creative_id          
WHERE RN = 1           
order by A.CreatedDate desc          
             
DROP TABLE #fINAL          
DROP TABLE #Count      
DROP TABLE #AllUser            
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DigitalLibraryCreativeLogData
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_Get_DigitalLibraryCreativeLogData] 
(    
 @CreativeId int
)    
as    
begin    
    
select     
case when a.CreativeType = 'Individual' then b.sub_broker else d.access_code end as sub_broker     
,a.CreativeName   
,a.CreativeType as CreativeType  
,case when isnull(c.Id,'') = '' then 'N' else 'Y' end as Individualview  
,case when isnull(c.Id,'') = '' then c.CreatedDate else c.CreatedDate end as IndividualviewDate  
--,'N' as Individualview
--,'' as IndividualviewDate
,case when isnull(e.Id,'') = '' then 'N' else 'Y' end as PersonalisedIndividualview  
,case when isnull(e.Id,'') = '' then e.CreatedDate else e.CreatedDate end as PersonalisedIndividualviewDate  
,a.Category      
,a.ImageName  
,a.IsExpiry
,a.ExpiryDate
,a.[Createdby]    
,a.[CreatedDate]
FROM tbl_DigitalLibraryCreatives a     
LEFT JOIN tbl_DigitalLibrarySubbrokerMapping b on ( a.Creative_id = b.Creative_id AND a.CreativeType = 'Individual')    
LEFT JOIN (  
select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL   
where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL and access_code is not NULL AND access_code <> ''  
) d on (a.CreativeType = 'All')  
LEFT JOIN tbl_DigitalLibraryCreativesLog c on (a.Creative_id= c.CreativeId AND ((a.CreativeType = 'ALL' AND c.SbTag  = d.access_code) OR (a.CreativeType = 'Individual' AND c.SbTag  = b.sub_broker)))
LEFT JOIN tbl_DigitalLibraryPersonalisedCreativesLog e on (a.Creative_id= e.CreativeId AND ((a.CreativeType = 'ALL' AND e.SbTag  = d.access_code) OR (a.CreativeType = 'Individual' AND e.SbTag  = b.sub_broker)))
where a.Creative_id =@CreativeId
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DownloadData
-- --------------------------------------------------
CREATE  procedure [dbo].[Usp_Get_DownloadData]    
( 
@CampaignId varchar(100) = '',
@NotificationText varchar(7000) = '',
@CreateDate Date='2020-01-09',    
@NotificationType varchar(200)='Individual'    
)    
as    
begin    
select     
 sub_broker    
 ,NotificationText    
 ,NotificationType    
 ,Individualview    
 ,IndividualviewDate    
 ,Notification_9    
 ,Notification_Date_9    
 ,CreatedBy    
 ,CreatedDate    
 ,UpdatedBy    
 ,UpdatedDate  
 ,CampaignId,
 StartDate,
 StartTime,
 ExpiryDate,
 ExpiryTime
 from [tbl_NotificationNXT]    
where 
--CreatedBy='NXT_Team' and 
NOTIFICATIONTEXT = @NotificationText AND  
CampaignId = @CampaignId AND
NotificationText<>'message' and 
NotificationType = @NotificationType and 
convert(date,CreatedDate) = convert(date,@CreateDate)    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DownloadData_Bee
-- --------------------------------------------------

  CREATE procedure [dbo].[Usp_Get_DownloadData_Bee]    
(    
 @CreateDate Date='2020-01-09'    
 ,@NotificationType varchar(200)='Individual'    
)    
as    
begin    
select     
 sub_broker    
 ,NotificationText    
 ,NotificationType    
 ,Individualview    
 ,IndividualviewDate    
 ,Notification_9    
 ,Notification_Date_9    
 ,CreatedBy    
 ,CreatedDate    
 ,UpdatedBy    
 ,UpdatedDate  
 ,CampaignId  
 from [tbl_NotificationBeeNXT]    
where --CreatedBy='NXT_Team' and   
 NotificationText<>'message'    
and NotificationType=@NotificationType    
and convert(date,CreatedDate)=convert(date,@CreateDate)    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DownloadData_NXTMobilePopup
-- --------------------------------------------------

CREATE procedure [dbo].Usp_Get_DownloadData_NXTMobilePopup    
(    
 @CreateDate Date='2020-01-29',
 @PopupType varchar(200)='ALL'    
)    
as    
BEGIN
	select b.SbTag,    
	case when @PopupType = 'Individual' then b.SbTag else d.access_code end as sub_broker     
	,a.ImageName   
	,a.PopUp_Type as PopUpType  
	,case when isnull(c.Id, '') = '' then 'N' else 'Y' end as Individualview  
	,case when isnull(c.Id,'') = '' then c.CreatedDate else c.CreatedDate end as IndividualviewDate  
	,a.Redirect_Url     
	,a.[Createdby]    
	,a.[CreatedDate]
	,a.CampaignId
	FROM Tbl_NXTMobilePopup a     
	LEFT JOIN Tbl_NXTMobilePopupSbTagMap b on ( a.id = b.Popup_Id AND a.Popup_Type = 'Individual')    
	LEFT JOIN (  
	select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL   
	where status = 1 and login_inactive_date > getdate() and access_to = 'SB' and usertype = 'ADMIN' and username is not NULL and access_code is not NULL AND access_code <> ''  
	) d on (a.Popup_Type = 'All')  
	LEFT JOIN NXTMobilePopUpLog c on (a.id = c.Popup_Id AND ((a.Popup_Type = 'ALL' AND c.SbTag  = d.access_code) OR (a.Popup_Type = 'Individual' AND c.SbTag  = b.SbTag))) -- AND d.access_code = c.SbTag  
	where a.PopUp_Type = @PopupType    
		and convert(date, a.CreatedDate) = convert(date, @CreateDate)    
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_DownloadData_NXTPopup
-- --------------------------------------------------

  
CREATE procedure [dbo].[Usp_Get_DownloadData_NXTPopup]      
(      
	@PopupId int,      
	@PopupType varchar(200)='ALL'      
)      
as      
begin      
      
select b.SbTag,      
case when @PopupType = 'Individual' then b.SbTag else d.access_code end as sub_broker       
,a.ImageName     
,a.PopUp_Type as PopUpType
,case when isnull(c.Id,'') = '' then 'N' else 'Y' end as Individualview    
,case when isnull(c.Id,'') = '' then c.CreatedDate else c.CreatedDate end as IndividualviewDate    
,a.Redirect_Url        
,a.Project_Type       
,a.[Createdby]      
,a.[CreatedDate]  
,a.CampaignId  
FROM Tbl_PopupAdmin a       
LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId AND a.Popup_Type = 'Individual')      
LEFT JOIN (    
select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL     
where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL and access_code is not NULL AND access_code <> ''    
) d on (a.Popup_Type = 'All')    
LEFT JOIN PopUpLog c on (a.id= c.PopupId AND ((a.Popup_Type = 'ALL' AND c.SbTag  = d.access_code) OR (a.Popup_Type = 'Individual' AND c.SbTag  = b.SbTag))) -- AND d.access_code = c.SbTag    
where a.Project_Type = 'NXT'     
AND a.PopUp_Type=@PopupType      
and a.id = @PopupId     
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_EMANDATESMSLINKLOG
-- --------------------------------------------------
CREATE PROCEDURE USP_GET_EMANDATESMSLINKLOG  
@PartyCode VARCHAR(20)  
AS  
BEGIN  
  
  SELECT SMSLink FROM EMANDATESMSLINKLOG WITH (NOLOCK)   
  WHERE PartyCode = @PartyCode   
  ORDER BY Id DESC  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_EXISTING_CLIENT
-- --------------------------------------------------


/*
-----------------------------------------------------------
CREATED BY - Neeta Patil
CREATED ON - 02/08/2018
EXEC USP_GET_EXISTING_CLIENT 'KANAKCHHABRIAfamily'
-----------------------------------------------------------
MODIFICATION-

*/
CREATE PROCEDURE [dbo].[USP_GET_EXISTING_CLIENT]
(
	@CLIENT_ID VARCHAR(50)
)

AS
BEGIN

	SELECT 
		FamilyTradeId 
	FROM 
		FamilyTradeTransactions
	WHERE
		ClientId = @CLIENT_ID

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_Financial_Ledger_OneTime
-- --------------------------------------------------

  CREATE  procedure usp_get_Financial_Ledger_OneTime
  (
		 @SB_Code varchar(100)
  )
  as
  begin 

  --EXEC usp_get_Financial_Ledger_OneTime 'AAAI'

  select 
  case when FY='17-18' then '2017-2018'
		when FY='14-15' then '2014-2015'
		when FY='15-16' then '2015-2016'
		when FY='16-17' then '2016-2017'
  END FY

  ,Date	
  ,[Voucher Type]	
  ,[Vr No] 	
  ,[Cheque No]	
  ,[Particulars]	
  ,[Debit Amt#]	
  ,[Credit Amt]	
  ,[Balance]	
  ,[SBCode]
  From   [Financial_Ledger_OneTime]
where [SBCode]=@SB_Code 



  end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_FolioNoWise_Current_Holding
-- --------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/*
-----------------------------------------------------------
CREATED BY - Neeta Patil
CREATED ON - 27/07/2018
EXEC usp_Get_FolioNoWise_Current_Holding 'INF200KA1Y40','R575499'
-----------------------------------------------------------
MODIFICATION-

*/

CREATE PROCEDURE [dbo].[usp_Get_FolioNoWise_Current_Holding]
(
	@ISIN VARCHAR(500),
	@PARTY_CODE VARCHAR(500)
)

AS
BEGIN

SET NOCOUNT ON

	Select 
		CH.folio_no,CH.DPFlag,
		Cast(Round(CH.Angel_Qty,2,1) as decimal(18,2)) AS Angel_Qty,
		CH.RedeemableUnit AS RedeemableUnit,
		Cast(Round((CH.Angel_Qty * CH.LastNAVPrice),2,1) as decimal(18,2)) AS TotalAmt,
		Cast(Round((CH.RedeemableUnit * CH.LastNAVPrice),2,1) as decimal(18,2)) AS RedeemableAmt
		
	From 
		[172.31.16.85].ABR_DW_DION_FOLIO.[dbo].[IWMF_trn_current_holding] CH WITH (NOLOCK)
		
	WHERE
		CH.ISIN = @ISIN
		AND CH.party_Code = @PARTY_CODE
	
SET NOCOUNT OFF

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_IPartner_NavFeedDetails
-- --------------------------------------------------
/*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]

 SP_HELPTEXT 

*/
CREATE PROCEDURE [dbo].[Usp_Get_IPartner_NavFeedDetails]
(
	 @Type VARCHAR(3)=null,
	@mf_schcode varchar(50)
)
AS
BEGIN
	
	select top 7 mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice  from 
	 [196.1.115.232].FSS_MF.dbo.feed_dbdprice with (nolock) where mf_schcode=@mf_schcode order by navdate DESC
--	[172.31.16.75].FSS_MF.dbo.feed_dbdprice with (nolock) where mf_schcode=@mf_schcode order by navdate DESC
	----EXEC Usp_Get_IPartner_NavFeedDetails @Type ='T',@mf_schcode ='16622'
	----EXEC Usp_Get_IPartner_NavFeedDetails @Type ='W',@mf_schcode ='16622'
	----EXEC Usp_Get_IPartner_NavFeedDetails @Type ='M',@mf_schcode ='16622'
	----EXEC Usp_Get_IPartner_NavFeedDetails @Type ='YTD',@mf_schcode ='16622'
	----EXEC Usp_Get_IPartner_NavFeedDetails @Type ='1YR',@mf_schcode ='16622'
	----EXEC Usp_Get_IPartner_NavFeedDetails @Type ='3YR',@mf_schcode ='16622'
	

	--DECLARE @STYTD DATE 
	--set @STYTD= CASE WHEN MONTH(GETDATE()) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE())) AS VARCHAR(4))+'-04'+'-01')ELSE CONVERT(DATE,CAST(YEAR(GETDATE()) AS VARCHAR(4))+'-04'+'-01') END

	--IF(@Type = 'T')
	--	BEGIN
	--		SELECT mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice
	--		FROM [172.31.16.75].FSS_MF.dbo.feed_dbdprice WITH (NOLOCK)
	--		WHERE mf_schcode = @mf_schcode AND navdate >= CAST(GETDATE() AS DATE)
	--	END
	--IF(@Type = 'W')
	--	BEGIN
	--		SELECT mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice
	--		FROM [172.31.16.75].FSS_MF.dbo.feed_dbdprice WITH (NOLOCK)
	--		WHERE mf_schcode = @mf_schcode AND navdate BETWEEN CAST(DATEADD(DD,-7,GETDATE()) AS DATE) AND CAST(GETDATE() AS DATE)
	--	END
	--IF(@Type = 'M')
	--	BEGIN
	--		SELECT mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice
	--		FROM [172.31.16.75].FSS_MF.dbo.feed_dbdprice WITH (NOLOCK)
	--		WHERE mf_schcode = @mf_schcode AND navdate BETWEEN CAST(DATEADD(DD,-30,GETDATE()) AS DATE) AND CAST(GETDATE() AS DATE)
	--	END
	--IF(@Type = 'YTD')
	--	BEGIN
	--		SELECT mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice
	--		FROM [172.31.16.75].FSS_MF.dbo.feed_dbdprice WITH (NOLOCK)
	--		WHERE mf_schcode = @mf_schcode AND navdate BETWEEN @STYTD AND CAST(GETDATE() AS DATE)
	--	END
	--IF(@Type = '1YR')
	--	BEGIN
	--		SELECT mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice
	--		FROM [172.31.16.75].FSS_MF.dbo.feed_dbdprice WITH (NOLOCK)
	--		WHERE mf_schcode = @mf_schcode AND navdate BETWEEN CAST(DATEADD(YY,-1,GETDATE()) AS DATE) AND CAST(GETDATE() AS DATE)
	--	END
	--IF(@Type = '3YR')
	--	BEGIN
	--		SELECT mf_cocode,mf_schcode,navdate,navrs,adjnavrs,navreprice,navsaprice,navlsprice
	--		FROM [172.31.16.75].FSS_MF.dbo.feed_dbdprice WITH (NOLOCK)
	--		WHERE mf_schcode = @mf_schcode AND navdate BETWEEN CAST(DATEADD(YY,-3,GETDATE()) AS DATE) AND CAST(GETDATE() AS DATE)
	--	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_IPODocumentUploadById
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_Get_IPODocumentUploadById]
(
	@Id INT
)	
AS
BEGIN
	SELECT Id, ContentType, FileName, FilePath, CreationDate, LastUpdate, CreatedBy
	FROM IPODocumentUpload WHERE Id = @Id
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_IWMF_trn_current_holding_FN
-- --------------------------------------------------




	   
	 CREATE PROCEDURE Usp_Get_IWMF_trn_current_holding_FN
	 (    
		@party_Code VARCHAR(200),    
		@isin VARCHAR(50)    ,
		@DPFlag VARCHAR(1000)='DP'
	 )    
	 AS    
	 BEGIN    

/*

exec Usp_Get_IWMF_trn_current_holding_FN_New    'A103822','INF769K01DK3','DP'
exec Usp_Get_IWMF_trn_current_holding_FN    'A103822','INF769K01DK3','DP'

A103822   INF769K01DK3
*/

	     
	 SELECT   ISIN	 
			 ,SchemeName 	
			 ,fsSchemeCode AS SchemeCode	
			 ,folio_no	 AS  FolioNo 
			 ,RedeemableUnit AS RedeemableUnit
			 ,LastNAVPrice
	 FROM 
	 	 --[172.31.16.38].ABR_DW_DION.dbo.IWMF_trn_current_holding_FN WITH (NOLOCK)     
		 --[172.31.16.85].ABR_DW_DION_FOLIO.DBO.IWMF_trn_current_holding  WITH (NOLOCK)     

		IWMF_trn_current_holding_Folio_syn WITH (NOLOCK)     

	 WHERE  party_Code = @party_Code AND  
		 ISIN = @isin 
		 and DPFlag=@DPFlag 
	     
	     
	 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_IWMF_trn_current_holding_FN_Bkp17Feb2022
-- --------------------------------------------------
	
	   
	 create PROCEDURE Usp_Get_IWMF_trn_current_holding_FN_Bkp17Feb2022    
	 (    
		@party_Code VARCHAR(200),    
		@isin VARCHAR(50)    ,
		@DPFlag VARCHAR(1000)='DP'
	 )    
	 AS    
	 BEGIN    
	     
	 SELECT   ISIN	 
			 ,SchemeName 	
			 ,fsSchemeCode AS SchemeCode	
			 ,folio_no	 AS  FolioNo 
			 ,RedeemableUnit AS RedeemableUnit
			 ,LastNAVPrice
	 FROM 
	 	 --[172.31.16.38].ABR_DW_DION.dbo.IWMF_trn_current_holding_FN WITH (NOLOCK)     
		 [172.31.16.85].ABR_DW_DION_FOLIO.DBO.IWMF_trn_current_holding  WITH (NOLOCK)     

	 WHERE  party_Code = @party_Code AND  
		 ISIN = @isin 
		 and DPFlag=@DPFlag 
	     
	     
	 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_IWMF_trn_current_holding_FN_New
-- --------------------------------------------------


	   
	 create PROCEDURE Usp_Get_IWMF_trn_current_holding_FN_New    
	 (    
		@party_Code VARCHAR(200),    
		@isin VARCHAR(50)    ,
		@DPFlag VARCHAR(1000)='DP'
	 )    
	 AS    
	 BEGIN    
	     
	 SELECT   ISIN	 
			 ,SchemeName 	
			 ,fsSchemeCode AS SchemeCode	
			 ,folio_no	 AS  FolioNo 
			 ,RedeemableUnit AS RedeemableUnit
			 ,LastNAVPrice
	 FROM 
	 	 --[172.31.16.38].ABR_DW_DION.dbo.IWMF_trn_current_holding_FN WITH (NOLOCK)     
		 --[172.31.16.85].ABR_DW_DION_FOLIO.DBO.IWMF_trn_current_holding  WITH (NOLOCK)     

		IWMF_trn_current_holding_Folio_syn WITH (NOLOCK)     

	 WHERE  party_Code = @party_Code AND  
		 ISIN = @isin 
		 and DPFlag=@DPFlag 
	     
	     
	 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_LatestFundBarometerFile
-- --------------------------------------------------
    
CREATE PROCEDURE [dbo].[usp_Get_LatestFundBarometerFile]       
 AS                  
 BEGIN        
        
   SELECT TOP 1    
      [FileName],    
       FilePath,    
       CreatedDate    
   FROM dbo.FundBarometerFileData 
   WHERE ProjectType = 'BEENXT'  
   ORDER BY CreatedDate DESC    
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_LatestNudgeFileData
-- --------------------------------------------------
    
    
    
CREATE PROCEDURE [dbo].[usp_Get_LatestNudgeFileData]      
@ProjectType VARCHAR(50)     
 AS                    
 BEGIN          
          
   SELECT TOP 1     
        Name     
       ,RedirectURL    
       ,[FileName]      
       ,FilePath      
       ,CreatedDate      
   FROM dbo.NudgeFileData    
   WHERE   ProjectType = @ProjectType   
    AND ExpiryDate >= CONVERT(DATE, GETDATE())  
    AND IsActive = 1  
   ORDER BY ExpiryDate      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_LatestNXTFundBarometerFile
-- --------------------------------------------------
    
CREATE PROCEDURE [dbo].[usp_Get_LatestNXTFundBarometerFile]       
 AS                  
 BEGIN        
        
   SELECT TOP 1    
      [FileName],    
       FilePath,    
       CreatedDate    
   FROM dbo.FundBarometerFileData 
   WHERE ProjectType = 'NXT'  
   ORDER BY CreatedDate DESC    
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_MyClient_ClientServiceSummary
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Get_MyClient_ClientServiceSummary]
(
	@SubBroker VARCHAR(50)
)
AS
BEGIN

	--EXEC Usp_Get_MyClient_ClientServiceSummary 'MMCN'

	SELECT	 sub_broker
			,Total_Client
			,Active_Client_PastYears
			,Inactive_Client_PastYears
			,Traded_Client
			,NotTraded_Yesterday
			,Never_Traded
			,ArqEnRoll_Client
			,MTFRegistered
			,MFBoughtClients
			,NotTraded_Past30Days
			,New_Client_NotTraded_Past7days
			,Comm_Active_Past30Days
			,Curr_Active_Past30Days
			,EQ_Active_Past30Days
			,FO_Active_Past30Days
			,Dorment_Client
			,ClientUnderRisk
			,Clients_Rebalance_Due
		 FROM tbl_SB_MyClient_GetClientDetails WITH (NOLOCK)
		WHERE sub_broker = @SubBroker
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_MyClient_ClientServiceSummary_Dealer
-- --------------------------------------------------

--sp_depends tbl_SB_MyClient_GetClientDetails

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Get_MyClient_ClientServiceSummary_Dealer]
(
	@SubBroker VARCHAR(50)
)
AS
BEGIN


/*
e
EXEC [Usp_Get_MyClient_ClientServiceSummary_Dealer]  'ET'

*/

--return 0

Declare @Column varchar(10)


IF EXISTS(Select * from B2B_Bulk_DealerMapping_Syn WHERE Dealer1 = @SubBroker)
BEGIN
	SET @Column = 'Dealer'
END
ELSE
BEGIN
	SET @Column = 'SubBroker'
END



IF @Column = 'SubBroker'
begin
	--EXEC Usp_Get_MyClient_ClientServiceSummary 'MMCN'

	SELECT	 sub_broker
			,Total_Client
			,Active_Client_PastYears
			,Inactive_Client_PastYears
			,Traded_Client
			,NotTraded_Yesterday
			,Never_Traded
			,ArqEnRoll_Client
			,MTFRegistered
			,MFBoughtClients
			,NotTraded_Past30Days
			,New_Client_NotTraded_Past7days
			,Comm_Active_Past30Days
			,Curr_Active_Past30Days
			,EQ_Active_Past30Days
			,FO_Active_Past30Days
			,Dorment_Client
			,ClientUnderRisk
			,Clients_Rebalance_Due
		 FROM tbl_SB_MyClient_GetClientDetails WITH (NOLOCK)
		WHERE sub_broker = @SubBroker
END
ELSE 
BEGIn


	SELECT	dISTINCT 
			sub_broker
			,Total_Client
			,Active_Client_PastYears
			,Inactive_Client_PastYears
			,Traded_Client
			,NotTraded_Yesterday
			,Never_Traded
			,ArqEnRoll_Client
			,MTFRegistered
			,MFBoughtClients
			,NotTraded_Past30Days
			,New_Client_NotTraded_Past7days
			,Comm_Active_Past30Days
			,Curr_Active_Past30Days
			,EQ_Active_Past30Days
			,FO_Active_Past30Days
			,Dorment_Client
			,ClientUnderRisk
			,Clients_Rebalance_Due
		 FROM tbl_SB_MyClient_GetClientDetails_dealer CD WITH (NOLOCK)
	WHERE
		sub_broker = @SubBroker



END


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_MyClient_ClientServiceSummary_Mobile_2
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Get_MyClient_ClientServiceSummary_Mobile_2]
(
	@SubBroker VARCHAR(50),
	@Filter varchar(100)=null
)
AS
BEGIN


/*
EXEC [Usp_Get_MyClient_ClientServiceSummary_Mobile_2] 'ET'
EXEC [Usp_Get_MyClient_ClientServiceSummary_Dealer]  'ET001'

*/

--return 0

Declare @Column varchar(10)


IF EXISTS(Select * from B2B_Bulk_DealerMapping_Syn WHERE Dealer1 = @SubBroker)
BEGIN
	SET @Column = 'Dealer'
END
ELSE
BEGIN
	SET @Column = 'SubBroker'
END



IF @Column = 'SubBroker'
begin
	--EXEC Usp_Get_MyClient_ClientServiceSummary 'MMCN'

	SELECT	 sub_broker
			,Total_Client
			,Active_Client_PastYears
			--,Inactive_Client_PastYears
			--,Traded_Client
			--,NotTraded_Yesterday
			--,Never_Traded
			--,ArqEnRoll_Client
			--,MTFRegistered
			,MFBoughtClients
			--,NotTraded_Past30Days
			--,New_Client_NotTraded_Past7days
			--,Comm_Active_Past30Days
			--,Curr_Active_Past30Days
			,EQ_Active_Past30Days
			--,FO_Active_Past30Days
			--,Dorment_Client
			--,ClientUnderRisk
			--,Clients_Rebalance_Due
		 FROM tbl_SB_MyClient_GetClientDetails WITH (NOLOCK)
		WHERE sub_broker = @SubBroker
END
/*
ELSE 
BEGIn


	SELECT	dISTINCT 
			sub_broker
			,Total_Client
			,Active_Client_PastYears
			,Inactive_Client_PastYears
			,Traded_Client
			,NotTraded_Yesterday
			,Never_Traded
			,ArqEnRoll_Client
			,MTFRegistered
			,MFBoughtClients
			,NotTraded_Past30Days
			,New_Client_NotTraded_Past7days
			,Comm_Active_Past30Days
			,Curr_Active_Past30Days
			,EQ_Active_Past30Days
			,FO_Active_Past30Days
			,Dorment_Client
			,ClientUnderRisk
			,Clients_Rebalance_Due
		 FROM tbl_SB_MyClient_GetClientDetails_dealer CD WITH (NOLOCK)
	WHERE
		sub_broker = @SubBroker



END
*/

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_MyoperatorDashboard
-- --------------------------------------------------

CREATE procedure usp_Get_MyoperatorDashboard
as
begin

If (select count(*) from MyoperatorDashboard with (nolock) where Flag=0)>0
begin

	select A.*,B.Message from MyoperatorDashboard A with (nolock)
	inner join MyOpratorCallStatMaster B on A.call_state=B.Call_Stat
	where Flag=0

	Update A
	set Flag=1
	from MyoperatorDashboard A with (nolock)


END
ELSe
begin

Select  'Failed' 'message'

END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_Notification_NewTable_Main
-- --------------------------------------------------

CREATE procedure usp_Get_Notification_NewTable_Main
as
begin

SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType into #Test 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -1, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])
  
  insert into UntilityView_Final
select * from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where 
	--A.NotificationText <> 'message' 
		--and 
		CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -1, GETDATE())    
) T

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationBeeNXT_Log
-- --------------------------------------------------

  CREATE procedure [dbo].[Usp_Get_NotificationBeeNXT_Log]  
as  
begin  
Set nocount on   
  
Declare @Tdate date =CONVERT(DATE,GETDATE())  
,@TotalCount INT  
  
SELECT NOTIFICATIONTEXT,MAX(RN) CNT ,CREATEDDATE,NotificationType  
Into #TEST  
FROM   
(  
SELECT   
 DENSE_RANK()  OVER (PARTITION BY NOTIFICATIONTEXT ORDER BY NOTIFICATIONID) RN  
 ,NOTIFICATIONTEXT  
 ,NotificationType  
 ,CONVERT(DATE,CREATEDDATE) CREATEDDATE  
 --,COUNT(1) CNT  
FROM [TBL_NOTIFICATIONBeeNXT]  
WHERE 
--CREATEDBY='NXT_TEAM' and 
--and NotificationType=@NotificationType  
 NOTIFICATIONTEXT<>'message'  
  and CONVERT(DATE,[CreatedDate])>DATEADD(DD,-31,GETDATE())    
) T  
GROUP BY NOTIFICATIONTEXT,NotificationType,CREATEDDATE  
  
select count(sub_broker) cnt, CONVERT(DATE,CREATEDDATE) CREATEDDATE ,  NotificationType into #Count from [TBL_NOTIFICATIONBeeNXT]  
  where  NotificationText<>'message' and CONVERT(DATE,[CreatedDate])>DATEADD(DD,-31,GETDATE())   
  --and NotificationType=@NotificationType   
group by CONVERT(DATE,CREATEDDATE) ,NotificationType  
  
select * iNTO #fINAL from   
(  
SELECT ROW_NUMBER() over (partition by CONVERT(DATE,A.[CreatedDate]),A.NotificationType order by sub_broker) RN,  
      [sub_broker]  
      ,A.[NotificationText]  
      ,A.[NotificationType]  
   , Individualview  Individualview  
   ,IndividualviewDate IndividualviewDate  
   ,[CreatedBy]  
      ,A.[CreatedDate]  
  ,isnull(B.CNT,0) CNT  
  
  FROM [dbo].[tbl_NotificationBeeNXT] A  
  Left join #TEST B  
  On a.NotificationText=B.NotificationText  
  and A.NotificationType=B.NotificationType  
  where   
  --sub_broker='CBHO'  
  --and NotificationType='All'  
  A.NotificationText<>'message' and   
  --A.NotificationType =@NotificationType and   
   CONVERT(DATE,A.[CreatedDate])>DATEADD(DD,-31,GETDATE())    
  --AND CreatedBy='NXT_Team'  
   
) T --order by CreatedDate desc  
  
  
sELECT rn,  
      case when A.[NotificationType] ='All' then 'CBHO' ELSe A.[sub_broker] END sub_broker  
      ,[NotificationText]  
      ,A.[NotificationType]  
   , Individualview  Individualview  
   ,IndividualviewDate IndividualviewDate  
   ,[CreatedBy]  
      ,A.[CreatedDate]  
  ,B.cnt CNT  
 FROM #fINAL A   
 inner join #Count B on convert(date,A.[CreatedDate])=B.[CreatedDate]  
   and A.NotificationType=B.NotificationType  
 WHERE RN=1   
  order by CreatedDate desc  
  
  
DROP TABLE #fINAL  
DROP TABLE #TEST  
Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_NotificationBeeNXT_MasterList
-- --------------------------------------------------

Create procedure usp_get_NotificationBeeNXT_MasterList
as
begin

Select * from NotificationBeeNXT_MasterList with (nolock)


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_Get_NotificationNXT_Log]  
as  
begin  

  
Declare @Tdate date = CONVERT(DATE,GETDATE()-1)  
--select @Tdate 
/*
,@TotalCount INT  
  
SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType INTO #TEST 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -2, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])
  

select * INTO #fINAL from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where A.NotificationText <> 'message' 
		and CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -7, GETDATE())    
) T
  
  */
SELECT rn,
	 A.CampaignId,
	 A.NotificationText,
	 A.[NotificationType],
	 [CreatedBy],
	 A.[CreatedDate],
	 A.sub_brokercnt CNT,
	 --sub_brokercnt
	 A.IsInActive,
	 A.StartDate,
	 A.StartTime,
	 A.ExpiryDate,
	 A.ExpiryTime
FROM UntilityView_Notification_syn A with (nolock)   
--inner join #Count B on A.CampaignId = B.CampaignId 
--	AND A.NotificationText = B.NotificationText
--	AND convert(date, A.[CreatedDate]) = B.[CreatedDate] 
--	and A.NotificationType = B.NotificationType   

WHERE RN = 1   
and CreatedDate >=@Tdate 
order by CreatedDate desc  
  
  
--DROP TABLE #fINAL  
--DROP TABLE #TEST  
--Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log_04_05_2020
-- --------------------------------------------------

  CREATE procedure [dbo].[Usp_Get_NotificationNXT_Log_04_05_2020]  
as  
begin  
  
Declare @Tdate date =CONVERT(DATE,GETDATE())  
,@TotalCount INT  
  
SELECT NOTIFICATIONTEXT,MAX(RN) CNT ,CREATEDDATE  
Into #TEST  
FROM   
(  
SELECT   
 DENSE_RANK()  OVER (PARTITION BY NOTIFICATIONTEXT ORDER BY NOTIFICATIONID) RN  
 ,NOTIFICATIONTEXT  
 ,CONVERT(DATE,CREATEDDATE) CREATEDDATE  
 --,COUNT(1) CNT  
FROM [TBL_NOTIFICATIONNXT]  
WHERE --CREATEDBY='NXT_TEAM' and  
   CONVERT(DATE,[CreatedDate])>DATEADD(DD,-31,GETDATE())    
) T  
GROUP BY NOTIFICATIONTEXT,CREATEDDATE  
  
select count(sub_broker) cnt, CONVERT(DATE,CREATEDDATE) CREATEDDATE into #Count from [TBL_NOTIFICATIONNXT]  
  where  NotificationText<>'message' and CONVERT(DATE,[CreatedDate])>DATEADD(DD,-31,GETDATE())    
group by CONVERT(DATE,CREATEDDATE)  
  
select * iNTO #fINAL from   
(  
SELECT ROW_NUMBER() over (partition by CONVERT(DATE,A.[CreatedDate]) order by sub_broker) RN,  
[sub_broker]  
,A.[NotificationText]  
,[NotificationType]  
,Individualview  Individualview  
,IndividualviewDate IndividualviewDate  
,[CreatedBy]  
,A.[CreatedDate]  
,isnull(B.CNT,0) CNT  
  FROM [dbo].[tbl_NotificationNXT] A  
  Left join #TEST B  
  On a.NotificationText=B.NotificationText  
  where   
  --sub_broker='CBHO'  
  --and NotificationType='All'  
  A.NotificationText<>'message' and   
  CONVERT(DATE,A.[CreatedDate])>DATEADD(DD,-31,GETDATE())    
  --AND CreatedBy='NXT_Team'  
) T --order by CreatedDate desc  
  
  
sELECT rn,  
      [sub_broker]  
      ,[NotificationText]  
      ,[NotificationType]  
   , Individualview  Individualview  
   ,IndividualviewDate IndividualviewDate  
   ,[CreatedBy]  
      ,A.[CreatedDate]  
  ,B.cnt CNT  
 FROM #fINAL A   
 inner join #Count B on convert(date,A.[CreatedDate])=B.[CreatedDate]  
 WHERE RN=1   
  order by CreatedDate desc  
  
  
DROP TABLE #fINAL  
DROP TABLE #TEST  
Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log_20May2022
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_Get_NotificationNXT_Log_20May2022]  
as  
begin  

  
Declare @Tdate date = CONVERT(DATE,GETDATE()-1)  
--select @Tdate 
/*
,@TotalCount INT  
  
SELECT NotificationText, CampaignId, count(sub_broker) sub_brokercnt,COUNT(*) CNT, 
CONVERT(DATE, [CreatedDate]) Convert_CreatedDate,CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType INTO #TEST 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -2, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])
  

select * INTO #fINAL from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		B.sub_brokercnt,
	A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	    Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where A.NotificationText <> 'message' 
		and CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -7, GETDATE())    
) T
  
  */
SELECT rn,
	 A.CampaignId,
	 A.NotificationText,
	 A.[NotificationType],
	 [CreatedBy],
	 A.[CreatedDate],
	 A.sub_brokercnt CNT,
	 --sub_brokercnt
	 A.IsInActive,
	 A.StartDate,
	 A.StartTime,
	 A.ExpiryDate,
	 A.ExpiryTime
FROM UntilityView_Notification_syn A with (nolock)   
--inner join #Count B on A.CampaignId = B.CampaignId 
--	AND A.NotificationText = B.NotificationText
--	AND convert(date, A.[CreatedDate]) = B.[CreatedDate] 
--	and A.NotificationType = B.NotificationType   

WHERE RN = 1   
and CreatedDate >=@Tdate 
order by CreatedDate desc  
  
  
--DROP TABLE #fINAL  
--DROP TABLE #TEST  
--Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log_Bkp09Jan2020
-- --------------------------------------------------

CREATE procedure Usp_Get_NotificationNXT_Log_Bkp09Jan2020
as
begin

Declare @Tdate date =CONVERT(DATE,GETDATE())


--DROP TABLE #TEST

SELECT NOTIFICATIONTEXT,MAX(RN) CNT 
Into #TEST
FROM 
(
SELECT 
	DENSE_RANK()  OVER (PARTITION BY NOTIFICATIONTEXT ORDER BY NOTIFICATIONID) RN
	,NOTIFICATIONTEXT
	,CONVERT(DATE,CREATEDDATE) CREATEDDATE
	--,COUNT(1) CNT
FROM [TBL_NOTIFICATIONNXT]
WHERE CREATEDBY='NXT_TEAM'
and CONVERT(DATE,CREATEDDATE)=@Tdate
) T
GROUP BY NOTIFICATIONTEXT

--select * from #TEST


SELECT 
      [sub_broker]
      ,A.[NotificationText]
      ,[NotificationType]
	  , Individualview	 Individualview
	  ,IndividualviewDate IndividualviewDate
	  ,[CreatedBy]
      ,[CreatedDate]
		,isnull(B.CNT,0) CNT
  FROM [dbo].[tbl_NotificationNXT] A
  Left join #TEST B
  On a.NotificationText=B.NotificationText
  where sub_broker='CBHO'
  --and NotificationType='All'
  and CreatedBy='NXT_Team'
  order by CreatedDate desc




DROP TABLE #TEST


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log_Bkp31May2022
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_Get_NotificationNXT_Log_Bkp31May2022]  
as  
begin  
  
Declare @Tdate date = CONVERT(DATE,GETDATE())  
,@TotalCount INT  
  
SELECT NotificationText, CampaignId, COUNT(*) CNT, CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType INTO #TEST 
FROM [TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -7, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])
  
select count(sub_broker) cnt, CampaignId, NotificationText, CONVERT(DATE, CreatedDate) CreatedDate, NotificationType INTO #Count
from [TBL_NOTIFICATIONNXT]  with (nolock) 
where  NotificationText <> 'message' 
  and CONVERT(DATE, [CreatedDate]) > DATEADD(DD, -7, GETDATE())    
group by CampaignId, NotificationText, CONVERT(DATE, CreatedDate), NotificationType 
  
select * INTO #fINAL from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM [dbo].[tbl_NotificationNXT] A   with (nolock)
	Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where A.NotificationText <> 'message' 
		and CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -7, GETDATE())    
) T
  
SELECT rn,
	 A.CampaignId,
	 A.NotificationText,
	 A.[NotificationType],
	 [CreatedBy],
	 A.[CreatedDate],
	 B.cnt CNT,
	 A.IsInActive,
	 A.StartDate,
	 A.StartTime,
	 A.ExpiryDate,
	 A.ExpiryTime
FROM #fINAL A   
inner join #Count B on A.CampaignId = B.CampaignId 
	AND A.NotificationText = B.NotificationText
	AND convert(date, A.[CreatedDate]) = B.[CreatedDate] 
	and A.NotificationType = B.NotificationType   
WHERE RN = 1   
order by CreatedDate desc  
  
  
DROP TABLE #fINAL  
DROP TABLE #TEST  
Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log_New
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_Get_NotificationNXT_Log_New]  
as  
begin  
  
Declare @Tdate date = CONVERT(DATE,GETDATE())  
,@TotalCount INT  

select * into #TBL_NOTIFICATIONNXT from [TBL_NOTIFICATIONNXT]  with (nolock)
where 
NotificationText <> 'message' 
  and 
  CONVERT(DATE, [CreatedDate]) > DATEADD(DD, -7, GETDATE())    

  
SELECT NotificationText, CampaignId, COUNT(*) CNT, CONVERT(DATE, [CreatedDate]) CREATEDDATE, NotificationType INTO #TEST 
FROM #TBL_NOTIFICATIONNXT
WHERE CONVERT(DATE,[CreatedDate]) > DATEADD(DD, -7, GETDATE())
GROUP BY CampaignId, NotificationText, NotificationType, CONVERT(DATE, [CreatedDate])
  
select count(sub_broker) cnt, CampaignId, NotificationText, CONVERT(DATE, CreatedDate) CreatedDate, NotificationType INTO #Count
from #TBL_NOTIFICATIONNXT  
where  NotificationText <> 'message' 
  and CONVERT(DATE, [CreatedDate]) > DATEADD(DD, -7, GETDATE())    
group by CampaignId, NotificationText, CONVERT(DATE, CreatedDate), NotificationType 
  
select * INTO #fINAL from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, CONVERT(DATE, A.[CreatedDate]), A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate], 
		isnull(B.CNT,0) CNT,
		A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM #TBL_NOTIFICATIONNXT A  
	Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where A.NotificationText <> 'message' 
		and CONVERT(DATE, A.[CreatedDate]) > DATEADD(DD, -7, GETDATE())    
) T
  
SELECT rn,
	 A.CampaignId,
	 A.NotificationText,
	 A.[NotificationType],
	 [CreatedBy],
	 A.[CreatedDate],
	 B.cnt CNT,
	 A.IsInActive,
	 A.StartDate,
	 A.StartTime,
	 A.ExpiryDate,
	 A.ExpiryTime
FROM #fINAL A   
inner join #Count B on A.CampaignId = B.CampaignId 
	AND A.NotificationText = B.NotificationText
	AND convert(date, A.[CreatedDate]) = B.[CreatedDate] 
	and A.NotificationType = B.NotificationType   
WHERE RN = 1   
order by CreatedDate desc  
  

drop table #TBL_NOTIFICATIONNXT  
DROP TABLE #fINAL  
DROP TABLE #TEST  
Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NotificationNXT_Log_Opti19May2022
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_Get_NotificationNXT_Log_Opti19May2022]  
as  
begin  
  
Declare @Tdate date = DATEADD(DD, -7, GETDATE())
,@TotalCount INT  

select *,CONVERT(DATE,[CreatedDate]) Convert_CreatedDate into #TBL_NOTIFICATIONNXT from 
[TBL_NOTIFICATIONNXT]  with (nolock)
WHERE CONVERT(DATE,[CreatedDate]) > @Tdate

  
SELECT NotificationText, CampaignId, COUNT(*) CNT, Convert_CreatedDate, NotificationType INTO #TEST 
FROM #TBL_NOTIFICATIONNXT  with (nolock)
WHERE Convert_CreatedDate > @Tdate
GROUP BY CampaignId, NotificationText, NotificationType, Convert_CreatedDate
  
select count(sub_broker) cnt, CampaignId, NotificationText, Convert_CreatedDate CreatedDate, NotificationType INTO #Count
from #TBL_NOTIFICATIONNXT  with (nolock) 
where  NotificationText <> 'message' 
  and Convert_CreatedDate > @Tdate
group by CampaignId, NotificationText, Convert_CreatedDate, NotificationType 
  
select * INTO #fINAL from   
(  
	SELECT ROW_NUMBER() over (partition by A.CampaignId, A.NotificationText, A.Convert_CreatedDate, A.NotificationType order by sub_broker) RN,  
		[sub_broker],
		A.NotificationText,
		A.CampaignId, 
		A.[NotificationType], 
		[CreatedBy], 
		A.[CreatedDate],
		A.Convert_CreatedDate Convert_CreatedDate,
		isnull(B.CNT,0) CNT,
		A.IsInActive,
		A.StartDate,
		A.StartTime,
		A.ExpiryDate,
		A.ExpiryTime
	FROM #TBL_NOTIFICATIONNXT A   with (nolock)
	Left join #TEST B On A.CampaignId = B.CampaignId 
		AND A.NotificationText = B.NotificationText
		and A.NotificationType = B.NotificationType  
	where A.NotificationText <> 'message' 
		and A.Convert_CreatedDate > @Tdate
) T
  
SELECT rn,
	 A.CampaignId,
	 A.NotificationText,
	 A.[NotificationType],
	 [CreatedBy],
	 A.[CreatedDate],
	 B.cnt CNT,
	 A.IsInActive,
	 A.StartDate,
	 A.StartTime,
	 A.ExpiryDate,
	 A.ExpiryTime
FROM #fINAL A   
inner join #Count B on A.CampaignId = B.CampaignId 
	AND A.NotificationText = B.NotificationText
	AND Convert_CreatedDate = B.[CreatedDate] 
	and A.NotificationType = B.NotificationType   
WHERE RN = 1   
order by CreatedDate desc  
  
  
DROP TABLE #fINAL  
DROP TABLE #TEST  
Drop table #Count  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_NotificationNXT_MasterList
-- --------------------------------------------------
CREATE procedure usp_get_NotificationNXT_MasterList  
as  
begin  
  
Select * from NotificationNXT_MasterList with (nolock)  
where Active = 1
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NRMS_Details_11Jul2018
-- --------------------------------------------------
Create PROCEDURE [dbo].[Usp_Get_NRMS_Details_11Jul2018]
(
	@Sub_broker VARCHAR(50)
)

	--EXEC Usp_Get_NRMS_Details 'ET'

AS
BEGIN

	SET NOCOUNT ON
	SET FMTONLY OFF
	IF OBJECT_ID('TEMPDB..#TempNRMSDetails') IS NOT NULL
		DROP TABLE #TempNRMSDetails
	CREATE TABLE #TempNRMSDetails
	(
		 Region VARCHAR(50)
		,Branch VARCHAR(50)
		,Sub_Broker VARCHAR(50)
		,Party_code	VARCHAR(50)
		,Client_Name VARCHAR(200)
		,Client_Type VARCHAR(50)
		,Client_Category VARCHAR(50)
		,Ledger MONEY
		,Net_Shortfall MONEY
		,Holding MONEY
		,MOS MONEY
		,ROI MONEY
		,Total_Coll MONEY
		,Gross_Exposure	MONEY
		,Margin_Total MONEY
		,Margin_Shortage MONEY
		,Net_Available MONEY
		,Unreco_Credit MONEY
		,Unbooked_Loss MONEY
		,NBFC_Logical_Ledger MONEY
		,[Violation %] MONEY
		,Pure_Risk MONEY
		,Projected_Risk	MONEY
		,ProjRisk_After_DP_Adj MONEY
		,SB_Cr_Adjusted	MONEY
		,No_of_Dr_Days INT
		,Last_Bill_Date VARCHAR(20)
		,New_POA VARCHAR(50)
		,Intraday_Status VARCHAR(50)
		,MTF_Status VARCHAR(50)
	)
	
	INSERT INTO #TempNRMSDetails
	EXEC [196.1.115.182].general.dbo.Rpt_DrCr_client_Ipart @Sub_broker,'SB','SB','%','%','%','1','IN 20LACS','sanjay','SB',@Sub_broker 
	
	
	SELECT NRMS.Party_code,Sub_Broker,Client_Name,Client_Type,Client_Category,Ledger,Net_Shortfall,Accural_Amt,Holding,MOS,ROI,Total_Coll,Gross_Exposure,Margin_Total,Margin_Shortage,Net_Available,Unreco_Credit,Unbooked_Loss,NBFC_Logical_Ledger,[Violation %] 
AS Violation_Percentage,Pure_Risk,Projected_Risk,ProjRisk_After_DP_Adj,SB_Cr_Adjusted,No_of_Dr_Days,Last_Bill_Date,New_POA,Intraday_Status,MTF_Status
	FROM #TempNRMSDetails NRMS
	LEFT JOIN
	(
		SELECT A.PARTY_CODE, SUM(A.CHARGES_AMT) Accural_Amt
		FROM [196.1.115.132].MISC.DBO.CLI_ACCCHARGES A WITH (NOLOCK)                        
		INNER JOIN [196.1.115.132].MISC.DBO.CLI_ACCCHARGESMASTER B WITH (NOLOCK) 
		ON A.CHARGES_CODE = B.CHARGES_CODE                        
		WHERE CHARGES_DATE > CUTOFFDATE                        
		GROUP BY A.PARTY_CODE
	)Accural
	ON NRMS.Party_code = Accural.PARTY_CODE

	SET NOCOUNT OFF
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NRMS_Details_28022018
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_Get_NRMS_Details_28022018]
(
	@Sub_broker VARCHAR(50)
)

	--EXEC Usp_Get_NRMS_Details 'ET'

AS
BEGIN

	SET NOCOUNT ON
	SET FMTONLY OFF
	IF OBJECT_ID('TEMPDB..#TempNRMSDetails') IS NOT NULL
		DROP TABLE #TempNRMSDetails
	CREATE TABLE #TempNRMSDetails
	(
		 Region VARCHAR(50)
		,Branch VARCHAR(50)
		,Sub_Broker VARCHAR(50)
		,Party_code	VARCHAR(50)
		,Client_Name VARCHAR(200)
		,Client_Type VARCHAR(50)
		,Client_Category VARCHAR(50)
		,Ledger MONEY
		,Net_Shortfall MONEY
		,Holding MONEY
		,MOS MONEY
		,ROI MONEY
		,Total_Coll MONEY
		,Gross_Exposure	MONEY
		,Margin_Total MONEY
		,Margin_Shortage MONEY
		,Net_Available MONEY
		,Unreco_Credit MONEY
		,Unbooked_Loss MONEY
		,NBFC_Logical_Ledger MONEY
		,[Violation %] MONEY
		,Pure_Risk MONEY
		,Projected_Risk	MONEY
		,ProjRisk_After_DP_Adj MONEY
		,SB_Cr_Adjusted	MONEY
		,No_of_Dr_Days INT
		,Last_Bill_Date VARCHAR(20)
		,New_POA VARCHAR(50)
		,Intraday_Status VARCHAR(50)
		,MTF_Status VARCHAR(50)
	)
	
	INSERT INTO #TempNRMSDetails
	EXEC [196.1.115.182].general.dbo.Rpt_DrCr_client_Ipart @Sub_broker,'SB','SB','%','%','%','1','IN 20LACS','sanjay','SB',@Sub_broker 
	
	
	SELECT NRMS.Party_code,Sub_Broker,Client_Name,Client_Type,Net_Shortfall,(Ledger+NBFC_LOGICAL_LEDGER+Accural_Amt) AS Total_Ledger,(Holding+Total_Coll) AS Hold_Collat,Margin_Total,Pure_Risk,Projected_Risk,MOS,Net_Available
	FROM #TempNRMSDetails NRMS
	LEFT JOIN
	(
		SELECT A.PARTY_CODE, SUM(A.CHARGES_AMT) Accural_Amt
		FROM [196.1.115.132].MISC.DBO.CLI_ACCCHARGES A WITH (NOLOCK)                        
		INNER JOIN [196.1.115.132].MISC.DBO.CLI_ACCCHARGESMASTER B WITH (NOLOCK) 
		ON A.CHARGES_CODE = B.CHARGES_CODE                        
		WHERE CHARGES_DATE > CUTOFFDATE                        
		GROUP BY A.PARTY_CODE
	)Accural
	ON NRMS.Party_code = Accural.PARTY_CODE

	SET NOCOUNT OFF
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_nxt_notification_for_edit
-- --------------------------------------------------

CREATE procedure [dbo].[usp_get_nxt_notification_for_edit](  
@CampaignId varchar(100) = '',  
@NotificationText varchar(7000) = '',  
@CreatedDate Date='2020-01-09',      
@NotificationType varchar(200)=''  
)  
AS      
BEGIN   
 Select TOP 1 NotificationText, NotificationType, area AS Area, controller AS Controller, action AS Action, URL, QueryParameter,  
  CreatedBy, CreatedDate, StartDate, StartTime, ExpiryDate, ExpiryTime  
 FROM tbl_NotificationNXT  
 WHERE NotificationText = @NotificationText   
  AND CampaignId = @CampaignId   
  AND NotificationText <> 'message'   
  AND NotificationType = @NotificationType   
  AND CONVERT(DATE, CreatedDate) = CONVERT(DATE, @CreatedDate)   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_NXT_popupData
-- --------------------------------------------------
CREATE PROCEDURE usp_get_NXT_popupData  
@PopupId INT  
  
AS  
BEGIN  
	SELECT [Index] AS orderIndex, ImageName, ExpiryDate _ExpiryDate, Redirect_Url AS RedirectUrl,   
		Createdby, CreatedDate, Popup_Type AS PopupType, CampaignId, StartDate _StartDate, StartTime _StartTime, ExpiryTime _ExpiryTime
	FROM Tbl_PopupAdmin  
	WHERE id = @PopupId  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_NXTDigitalLibraryCreativeByType
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_Get_NXTDigitalLibraryCreativeByType]   
(      
@Category varchar(100),
@SearchText varchar(100),
@Accesscode varchar(100)
)        
   
AS        
BEGIN     
     If(@SearchText IS NOT NULL) OR (LEN(@SearchText) > 0)
	 BEGIN
	 	SELECT  a.Creative_id AS CreativeId  
	,a.Category
	,a.CreativeName   
	,a.IsExpiry
	,CONVERT(VARCHAR, a.[ExpiryDate], 6) AS [ExpiryDate]  
	,CONVERT(VARCHAR, a.[FestivalDate], 6) AS [FestivalDate]  
	,a.Personalised 
	,a.[ImageName]  
	,a.[ImagePath]  AS ImagePath
	,a.ImageType
	,a.CreativeType as CreativeType
	,a.[Active]  
	,a.[CreatedDate]  
	,a.CreatedBy
	FROM  dbo.tbl_DigitalLibraryCreatives a
	LEFT JOIN tbl_DigitalLibrarySubbrokerMapping b on ( a.Creative_id = b.Creative_id AND a.CreativeType = 'Individual')    
	where Category = @Category AND Active = 1 AND  ExpiryDate > dateadd(day,-1, cast(getdate() as date))
	AND CreativeName like '%' + @SearchText + '%'
	AND ( a.CreativeType = 'All' OR (a.CreativeType = 'Individual' AND b.sub_broker = @Accesscode))
	Order by [CreatedDate] Desc 
	 END

	 ELSE
	 BEGIN
	  	SELECT  a.Creative_id AS CreativeId  
	,a.Category
	,a.CreativeName   
	,a.IsExpiry
    ,CONVERT(VARCHAR,a.[FestivalDate],6) AS [FestivalDate]
	,CONVERT(VARCHAR, a.[ExpiryDate], 6) AS [ExpiryDate]  
	,a.Personalised 
	,a.[ImageName]  
	,a.[ImagePath]  AS ImagePath
	,a.ImageType
	,a.CreativeType as CreativeType
	,a.[Active]  
	,a.[CreatedDate]  
	,a.CreatedBy
	FROM  dbo.tbl_DigitalLibraryCreatives a
	LEFT JOIN tbl_DigitalLibrarySubbrokerMapping b on ( a.Creative_id = b.Creative_id AND a.CreativeType = 'Individual')    
	where Category = @Category AND Active = 1 AND  ExpiryDate > dateadd(day,-1, cast(getdate() as date))
	--AND CreativeName like '%' + @SearchText + '%'
	AND ( a.CreativeType = 'All' OR (a.CreativeType = 'Individual' AND b.sub_broker = @Accesscode))
	Order by [CreatedDate] Desc 
	 END

  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_NXTMobile_popupData
-- --------------------------------------------------
CREATE PROCEDURE usp_get_NXTMobile_popupData  
@PopupId INT  
  
AS  
BEGIN  
	SELECT [Index] AS orderIndex, ImageName, ExpiryDate _ExpiryDate, Redirect_Url AS RedirectUrl,   
		Createdby, CreatedDate, Popup_Type AS PopupType, CampaignId, StartDate _StartDate, StartTime _StartTime, ExpiryTime _ExpiryTime 
	FROM Tbl_NXTMobilePopup  
	WHERE id = @PopupId  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_OTPFAMILYTRADE
-- --------------------------------------------------


-- =============================================

-- Author:		Vivek

-- Create date: 04/08/2018

-- Description:	for getting otp

-- =============================================

CREATE PROCEDURE [dbo].[USP_GET_OTPFAMILYTRADE] 

	-- Add the parameters for the stored procedure here

	

AS

BEGIN

	-- SET NOCOUNT ON added to prevent extra result sets from

	-- interfering with SELECT statements.

	SET NOCOUNT ON;



    -- Insert statements for procedure here

	select dbo.random_password(4, '') as Otp 

	

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_Pledge_broking_holding_PopUp
-- --------------------------------------------------



Create procedure Usp_Get_Pledge_broking_holding_PopUp
(
	@Party_code varchar(100)
)
as
begin
SET NOCOUNT ON

select scripname	,isin , party_code  , qty	,close_rate  from [196.1.115.182].general.dbo.tbl_po_holding with (nolock)
where segment='NON-MTF'  -- broking holding
and party_code=@Party_code
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_Pledge_Mtf_Funding_PopUp
-- --------------------------------------------------
CREATE procedure Usp_Get_Pledge_Mtf_Funding_PopUp
(
		@Party_code varchar(100)
)
as
begin
SET NOCOUNT ON
select scripname	,isin , party_code  , qty	,close_rate from [196.1.115.182].general.dbo.tbl_po_holding with (nolock)
where segment='MTF'   --mtf funding  
and party_code=@Party_code

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_Pledge_Mtf_Status
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Get_Pledge_Mtf_Status]
(
--Declare 	
	@FromDate Date='2020-09-01',
	@ToDate Date='2020-09-17',
	@sub_broker varchar(100)='CBHO'
)

--EXEC usp_Get_Pledge_Mtf_Status_V1 '2022-01-18','2022-01-20','CBHO'

as
begin


select distinct sett_no into #Final from TBL_POA_PLD_ADNL_Pledge_Mtf_syn A with (nolock)
where convert(date,start_date) between @FromDate and @ToDate


--select * from #Final

Select 
	A.PARTY_CODE,	SCRIP_CD,	CERTNO ISIN,	Convert(varchar(20),EXEDATE,103) MTF_Pledge_Due_Date,	CLTDPID,SUCCESSFLAG_Converted SUCCESSFLAG, PAYQTY Pledge_Quantity, QTY Pledge_Request_Quantity,Convert(varchar(20),Start_date,103) MTFTradeDate, UpdatedDate
 from TBL_POA_PLD_ADNL_Pledge_Mtf_syn A with (nolock)
 inner join sb_client_details SB on A.PARTY_CODE=SB.party_code
inner join #Final B on A.sett_no=B.sett_no
where 
convert(date,start_date) between @FromDate and @ToDate
and 
SB.sub_broker=@sub_broker

drop table #Final 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_Pledge_Mtf_Status_V1
-- --------------------------------------------------
CREATE procedure usp_Get_Pledge_Mtf_Status_V1
(
--Declare 	
	@FromDate Date='2020-09-01',
	@ToDate Date='2020-09-17',
	@sub_broker varchar(100)='CBHO'
)

--EXEC usp_Get_Pledge_Mtf_Status '2020-09-01','2020-09-17','CBHO'

as
begin


select distinct sett_no into #Final from TBL_POA_PLD_ADNL_Pledge_Mtf_syn A with (nolock)
where convert(date,start_date) between @FromDate and @ToDate


--select * from #Final

Select 
	A.PARTY_CODE,	SCRIP_CD,	CERTNO ISIN,	Convert(varchar(20),EXEDATE,103) MTF_Pledge_Due_Date,	CLTDPID,SUCCESSFLAG_Converted SUCCESSFLAG, PAYQTY Pledge_Quantity, QTY Pledge_Request_Quantity,Convert(varchar(20),Start_date,103) MTFTradeDate, UpdatedDate
 from TBL_POA_PLD_ADNL_Pledge_Mtf_syn A with (nolock)
 inner join sb_client_details SB on A.PARTY_CODE=SB.party_code
inner join #Final B on A.sett_no=B.sett_no
where 
convert(date,start_date) between @FromDate and @ToDate
and 
SB.sub_broker=@sub_broker

drop table #Final 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_PledgeModuleLog_NXT
-- --------------------------------------------------

Create procedure [dbo].[usp_Get_PledgeModuleLog_NXT]
(
	@Modulename varchar(500),
	@Fromdate Date,
	@Todate Date
)
as
begin

		SELECT *
        FROM dbo.PledgeModuleLog_NXT with (nolock)
		where ( @Modulename = 'All' OR ModuleName =@Modulename )
		and convert(date,CreationDateTime) between @Fromdate and @Todate 
		--AND Controller <> '' 
		--AND Action <> ''
		--AND Event = 'Log'

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_PopupAdmin
-- --------------------------------------------------


Create procedure [dbo].[usp_Get_PopupAdmin]
	(
	@Project_Type varchar(100)
)
as
begin

select * from Tbl_PopupAdmin
where Active='Y'
and ExpiryDate>getdate()
and Project_Type=@Project_Type

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_PopupNXT_Log
-- --------------------------------------------------

           
  CREATE procedure [dbo].[Usp_Get_PopupNXT_Log]        
           
AS          
             
BEGIN          
          
select a.id,b.access_code into #AllUser from Tbl_PopupAdmin a       
LEFT JOIN (      
select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL       
where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL       
AND  access_code is not NULL AND access_code <> ''      
) b on (1=1)      
where a.Project_Type = 'NXT' 
--AND a.Active = 'Y' 
AND a.Popup_Type = 'All' AND         
CONVERT(DATE,a.[CreatedDate])>DATEADD(DD,-93,GETDATE())          
      
      
SELECT case when a.Popup_Type = 'Individual' then COUNT(b.SbTag) else COUNT(d.access_code) end cnt         
,CONVERT(DATE,a.CREATEDDATE) CREATEDDATE, a.PopUp_Type as PopUpType into #Count         
FROM Tbl_PopupAdmin a         
LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId AND a.Popup_Type = 'Individual')        
      
LEFT JOIN #AllUser d on (a.id = d.id  AND a.Popup_Type = 'All' )      
      
--LEFT JOIN (      
--select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL       
--where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL       
--AND  access_code is not NULL AND access_code <> ''      
--) d on (a.Popup_Type = 'All')      
      
--LEFT JOIN PopUpLog c on (a.id= c.PopupId AND ((a.Popup_Type = 'ALL' AND c.SbTag  = d.access_code) OR (a.Popup_Type = 'Individual' AND c.SbTag  = b.SbTag)))--AND d.access_code = c.SbTag      
where  a.Project_Type = 'NXT' 
--AND a.Active = 'Y' 
AND CONVERT(DATE,a.[CreatedDate])>DATEADD(DD,-93,GETDATE())          
--AND ( (a.Popup_Type = 'Individual' AND b.SbTag = c.SbTag) OR (a.Popup_Type = 'Individual' AND d.access_code = c.SbTag))      
group by CONVERT(DATE,a.CREATEDDATE), a.PopUp_Type        
             
select * INTO #fINAL from           
(          
SELECT ROW_NUMBER() over (partition by CONVERT(DATE,a.[CreatedDate]),a.PopUp_Type order by b.SbTag  ) RN,          
b.SbTag        
,a.ImageName         
,a.PopUp_Type as PopUpType        
,a.Redirect_Url            
,a.Project_Type           
,a.[Createdby]          
,a.[CreatedDate]          
FROM Tbl_PopupAdmin  a         
LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId AND a.Popup_Type = 'Individual')        
--LEFT JOIN PopUpLog c on (a.id = c.PopupId)         
where a.Project_Type = 'NXT' 
--AND a.Active = 'Y' 
AND CONVERT(DATE,a.[CreatedDate]) > DATEADD(DD,-93,GETDATE())         
) T         
             
SELECT rn,          
   CASE WHEN A.PopUpType  ='All' then 'CBHO' ELSe A.SbTag END sub_broker          
   ,A.ImageName          
   ,A.PopUpType          
   ,Redirect_Url  Redirect_Url          
   ,Project_Type Project_Type          
   ,A.[CreatedBy]          
   ,A.[CreatedDate]          
   ,B.cnt CNT      
FROM #fINAL A           
LEFT JOIN #Count B on convert(date,A.[CreatedDate])= B.[CreatedDate]          
AND A.PopUpType = B.PopUpType          
WHERE RN = 1           
order by CreatedDate desc          
             
             
DROP TABLE #fINAL          
DROP TABLE #Count      
DROP TABLE #AllUser      
             
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_RedirectUrlList
-- --------------------------------------------------
 CREATE PROCEDURE usp_Get_RedirectUrlList        
 AS        
 BEGIN        
         
  SELECT  Modulename      
      ,CONCAT(Controller, CASE WHEN LTRIM(RTRIM([action])) <> '' AND [action] IS NOT NULL THEN  '/' + [action] ELSE '' END) AS RedirectURL      
  FROM NotificationNXT_MasterList WITH (NOLOCK)      
  where Active = 1  
  ORDER BY Id      
         
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_SB_REVENUE_DETAIL_OPTI
-- --------------------------------------------------

----INPUT PARAMETER OF SP
CREATE PROCEDURE [dbo].[USP_GET_SB_REVENUE_DETAIL_OPTI]
	@SubBroker VARCHAR(25) = ''
AS
/*
	EXEC USP_GET_SB_REVENUE_DETAIL @SUBBROKER = ''
	EXEC USP_GET_SB_REVENUE_DETAIL @SUBBROKER = 'MMCN'
	EXEC USP_GET_SB_REVENUE_DETAIL @SUBBROKER = 'ET'

	
select * from tbl_SB_MonthlyRevenue
where month(Trade_Month) = 12
*/
SET NOCOUNT ON
BEGIN

	IF(@SubBroker = '' OR @SubBroker IS NULL)
	BEGIN
		SELECT '' AS SUB_BROKER,
			0 AS TOTAL_PER_CLIENT_REVENUE,
			0 AS TOTAL_GROSS_REVENUE,
			0 AS PREVIOUS_MONTH_TRADE_CLIENT_CNT,
			0 AS PREVIOUS_MONTH_PER_CLIENT_REVENUE,
			0 AS PREVIOUS_MONTH_GROSS_REVENUE,
			0 AS CURRENT_MONTH_TRADE_CLIENT_CNT,
			0 AS CURRENT_MONTH_PER_CLIENT_REVENUE,
			0 AS CURRENT_MONTH_GROSS_REVENUE
		RETURN
	END
	-----INTERNAL USED PARAMETERS
	DECLARE @FY_SDATE DATETIME 
	SELECT @FY_SDATE = CAST(CASE 
            WHEN Month(GETDATE()) BETWEEN 4 AND 12
                THEN CONVERT(VARCHAR(20), YEAR(GETDATE()-1))
            WHEN Month(GETDATE()) BETWEEN 1 AND 3
                THEN CONVERT(VARCHAR(20), YEAR(GETDATE()-1) - 1)
			END + '-04-01' AS DATE)
			

	DECLARE @CURRENT_SDATE DATETIME = DATEADD(m, DATEDIFF(m, 0, GETDATE()), 0),
			@CURRENT_EDATE DATETIME = DATEADD(DAY, -1, GETDATE()), --GETDATE())  --'2017/11/01') 
			@PREVIOUS_SDATE DATETIME = DATEADD(m, DATEDIFF(m, 0, DATEADD(MONTH, -1 ,GETDATE())), 0)
	DECLARE @PREVIOUS_EDATE DATETIME = DATEADD(s, -1, DATEADD(mm, DATEDIFF(m, 0, @PREVIOUS_SDATE) + 1,0))
	--DECLARE @SDATE_1 DATETIME = '2017/09/01'
 
	print @CURRENT_SDATE 
	print @CURRENT_EDATE
	print  @PREVIOUS_SDATE
	print  @PREVIOUS_EDATE

	DECLARE @TRADE_CLIENT_CNT INT = 0,
			@CURRENT_MTD_TRADE_CLIENT_CNT INT = 0,
			@PREVIOUS_MTD_TRADE_CLIENT_CNT INT = 0;

	---VARIABLE FOR GETTING CLIENT COUNT WITHOUT DATE RANGE  
	SELECT @TRADE_CLIENT_CNT = ISNULL(SUM(Total_Clients), 0) 
	FROM
		tbl_SB_MonthlyRevenue 
	WHERE sub_broker = @SubBroker
	GROUP BY sub_broker;

	---VARIABLE FOR GETTING EXACT CLIENT COUNT OF CURRENT MONTH TRADED 	
	SELECT @CURRENT_MTD_TRADE_CLIENT_CNT = ISNULL(SUM(Traded_Clients), 0) FROM 
		tbl_SB_MonthlyRevenue
	where SUB_BROKER = @SUBBROKER
	AND CAST(Trade_Month AS DATE) BETWEEN @CURRENT_SDATE AND @CURRENT_EDATE
	

	---VARIABLE FOR GETTING EXACT CLIENT COUNT OF PREVIOUS MONTH TRADED 	
	SELECT @PREVIOUS_MTD_TRADE_CLIENT_CNT = ISNULL(SUM(TRADED_CLIENTS), 0) FROM 
		tbl_SB_MonthlyRevenue
	where SUB_BROKER = @SUBBROKER
	AND CAST(Trade_Month AS DATE) BETWEEN @PREVIOUS_SDATE AND @PREVIOUS_EDATE
	
	print @TRADE_CLIENT_CNT
	print @CURRENT_MTD_TRADE_CLIENT_CNT
	print @PREVIOUS_MTD_TRADE_CLIENT_CNT

	SELECT ISNULL(MAX(A.SUB_BROKER), '') AS SUB_BROKER, 
			ISNULL(CAST(MAX(PER_CLIENT_REVENUE) AS INT), 0) AS TOTAL_PER_CLIENT_REVENUE,
			ISNULL(CAST(MAX(GROSS_REVENUE) AS INT), 0) AS TOTAL_GROSS_REVENUE,
			ISNULL(MAX(PREVIOUS_MONTH_TRADE_CLIENT_CNT), 0) AS PREVIOUS_MONTH_TRADE_CLIENT_CNT,
			ISNULL(CAST(MAX(PREVIOUS_MONTH_PER_CLIENT_REVENUE) AS INT), 0) AS PREVIOUS_MONTH_PER_CLIENT_REVENUE,
			ISNULL(CAST(MAX(PREVIOUS_MONTH_GROSS_REVENUE) AS INT), 0) AS PREVIOUS_MONTH_GROSS_REVENUE,
			ISNULL(MAX(CURRENT_MONTH_TRADE_CLIENT_CNT), 0) AS CURRENT_MONTH_TRADE_CLIENT_CNT,
			ISNULL(CAST(MAX(CURRENT_MONTH_PER_CLIENT_REVENUE) AS INT), 0) AS CURRENT_MONTH_PER_CLIENT_REVENUE,
			ISNULL(CAST(MAX(CURRENT_MONTH_GROSS_REVENUE) AS INT), 0) AS CURRENT_MONTH_GROSS_REVENUE
	FROM
	(
		----TOTAL FINANCIAL DATA FOR 'SUB_BROKER' 
		SELECT 
			SUB_BROKER, 
			ROUND(ISNULL((SUM(Gross_Revenue) * 100000)/AVG(Total_Clients) , 0), 0) AS PER_CLIENT_REVENUE,
			ROUND(ISNULL((SUM(Gross_Revenue) * 100000), 0), 0) AS GROSS_REVENUE,
			0 AS PREVIOUS_MONTH_TRADE_CLIENT_CNT,
			0 AS PREVIOUS_MONTH_PER_CLIENT_REVENUE,
			0 AS PREVIOUS_MONTH_GROSS_REVENUE,
			0 AS CURRENT_MONTH_TRADE_CLIENT_CNT,
			0 AS CURRENT_MONTH_PER_CLIENT_REVENUE,
			0 AS CURRENT_MONTH_GROSS_REVENUE
		FROM tbl_SB_MonthlyRevenue
		WHERE CAST(Trade_Month AS DATE) BETWEEN @FY_SDATE AND @CURRENT_EDATE
		AND sub_broker = @SubBroker
		GROUP BY sub_broker
		
		UNION 

		----CURRENT MONTH DATA FOR 'SUB_BROKER' 
		SELECT 
			SUB_BROKER,  
			0 AS PER_CLIENT_REVENUE,
			0 AS GROSS_REVENUE,
			0 AS PREVIOUS_MONTH_TRADE_CLIENT_CNT,
			0 AS PREVIOUS_MONTH_PER_CLIENT_REVENUE,
			0 AS PREVIOUS_MONTH_GROSS_REVENUE,
			@CURRENT_MTD_TRADE_CLIENT_CNT AS CURRENT_MONTH_TRADE_CLIENT_CNT,
			ROUND(ISNULL((SUM(Gross_Revenue) * 100000)/AVG(Total_Clients) , 0), 0) AS CURRENT_MONTH_PER_CLIENT_REVENUE,
			ROUND(ISNULL((SUM(Gross_Revenue) * 100000), 0), 0) AS CURRENT_MONTH_GROSS_REVENUE
		FROM tbl_SB_MonthlyRevenue
		WHERE CAST(Trade_Month AS DATE) BETWEEN @CURRENT_SDATE AND @CURRENT_EDATE
		AND sub_broker = @SubBroker
		GROUP BY sub_broker

		UNION 

		----PREVIOUS MONTH DATA FOR 'SUB_BROKER' 
		SELECT 
			SUB_BROKER,  
			0 AS PER_CLIENT_REVENUE,
			0 AS GROSS_REVENUE,
			@PREVIOUS_MTD_TRADE_CLIENT_CNT AS PREVIOUS_MONTH_TRADE_CLIENT_CNT,
			ROUND(ISNULL((SUM(Gross_Revenue) * 100000) / AVG(Total_Clients) , 0), 0) AS PREVIOUS_MONTH_PER_CLIENT_REVENUE,
			ROUND(ISNULL((SUM(Gross_Revenue) * 100000), 0), 0) AS PREVIOUS_MONTH_GROSS_REVENUE,
			0 AS CURRENT_MONTH_TRADE_CLIENT_CNT,
			0 AS CURRENT_MONTH_PER_CLIENT_REVENUE,
			0 AS CURRENT_MONTH_GROSS_REVENUE
		FROM tbl_SB_MonthlyRevenue
		WHERE CAST(Trade_Month AS DATE) BETWEEN @PREVIOUS_SDATE AND @PREVIOUS_EDATE
		AND sub_broker = @SubBroker
		GROUP BY sub_broker
	) A
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Get_SB_TrainingLinks
-- --------------------------------------------------
  
CREATE PROCEDURE usp_Get_SB_TrainingLinks  
(  
 @SBTag VARCHAR(50),  
 @CreatedBy VARCHAR(50)  
)  
AS  
BEGIN  
 IF NOT EXISTS(SELECT 1 FROM SB_TrainingLinks WHERE SBTag = @SBTag)  
 BEGIN  
	  INSERT INTO SB_TrainingLinks (SBTag, TrainingLinkId, IsVisited, CreatedBy)  
	  SELECT @SBTag, Id, 0, @CreatedBy FROM TrainingLinks WHERE Day = 1 AND IsActive = 1  
 END  
   
 SELECT SBTL.Id AS SBTrainingLinkId, TL.Topic, TL.Day,  SBTL.[Language],
	  CASE WHEN SBTL.[Language] = 'Hindi' THEN TL.HindiUrl ELSE TL.EnglishUrl END AS Url,   
	  TL.Day, SBTL.FromTime, SBTL.ToTime, SBTL.IsVisited, QAM.Id AS ModuleId,  
	  CASE WHEN SBQ.ModuleCompleted = 1 THEN 1 ELSE 0 END AS IsCertificateAvailable, SBQ.LastUpdate AS CertificateDate  
 FROM TrainingLinks TL  
 INNER JOIN (SELECT TOP 1 TrainingLinkId, Id, IsVisited, SBTag, [Language], FromTime, ToTime FROM SB_TrainingLinks WHERE SBTag = @SBTag ORDER BY CreationDate DESC) SBTL  
	ON SBTL.TrainingLinkId = TL.Id  
 LEFT JOIN QuestionAnswerModule QAM  
	ON QAM.TrainingLinkId = TL.Id  
 LEFT JOIN SubBrokerQuestion SBQ  
	ON SBQ.ModuleId = QAM.Id AND SBQ.SubBrokerTag = SBTL.SBTag  
 WHERE TL.IsActive = 1  
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_SBRevenue_AgeWise
-- --------------------------------------------------

	--exec Usp_Get_SBRevenue_AgeWise 'OOML','m'
CREATE  Procedure [dbo].[Usp_Get_SBRevenue_AgeWise]
(
--@SubBroker Varchar(200),
--@Period varchar(200)
	@SubBroker VARCHAR(20),
	@Type VARCHAR(3) = NULL,
	@Month VARCHAR(20) = NULL,
	@BktYear VARCHAR(2) = NULL

)
as
Begin  

--exec Usp_Get_SBRevenue_AgeWise 'ET','M',null,''
--Declare @SubBroker varchar(1000)= 'DDVM'

IF @Type='M' 
Begin
	Set @Type='YTD' 
END
ELSE 
Begin

	Set @Type='MTD' 
END


--IF @Type='Y' 
--Begin
--	Set @Type='YTD' 
--END


Declare @SDate Datetime ,@EDate Datetime 

Select @SDate=[dbo].[fn_Get_StartData] (@Type)
,@EDate=convert(date,getdate())

Print @SDate
Print @EDate


CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@SDate,@EDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@SDate)),0)
		SET @i = @i+1
	END


	--Select * from #Month 


	SELECT @SubBroker Sub_broker
	,M.Month Trade_Month
			,ISNULL(D.NoOfClients, 0) AS Traded_Client
				,Convert(decimal(18,2),remi_share) Total_Revenue
			,CONVERT(VARCHAR(3),DATENAME(MONTH,M.[Month]))+''''+ RIGHT(YEAR(M.[Month]),2) AS [MONTH]
	
		
			
		FROM
		#Month M
		LEFT JOIN (
				SELECT 
					DATEADD(M,DATEDIFF(M,0, sauda_date),0) AS [Month]
					,COUNT(distinct CLIENT) AS NoOfClients
					,SUM(remi_share) remi_share
				FROM  
					Daily_sharing DS WITH (NOLOCK)
				WHERE
					DS.sb=@SubBroker
					and angel_share>0
				GROUP BY 
						DATEADD(M,DATEDIFF(M,0, DS.sauda_date),0)
				) D
		ON M.[Month] = D.[Month]
		ORDER BY M.[Month]


Drop table #Month

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_SBRevenue_AgeWise_New
-- --------------------------------------------------


	
CREATE  Procedure [dbo].[Usp_Get_SBRevenue_AgeWise_New]
(
--@SubBroker Varchar(200),
--@Period varchar(200)
	@SubBroker VARCHAR(20),
	@Type VARCHAR(3) = NULL,
	@Month VARCHAR(20) = NULL,
	@BktYear VARCHAR(2) = NULL

)
as
Begin  

--exec Usp_Get_SBRevenue_AgeWise 'ET','M',null,''
--Declare @SubBroker varchar(1000)= 'DDVM'

IF @Type='M' 
Begin
	Set @Type='YTD' 
END
ELSE 
Begin

	Set @Type='MTD' 
END


--IF @Type='Y' 
--Begin
--	Set @Type='YTD' 
--END


Declare @SDate Datetime ,@EDate Datetime 

Select @SDate=[dbo].[fn_Get_StartData] (@Type)
,@EDate=convert(date,getdate())

Print @SDate
Print @EDate


CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@SDate,@EDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@SDate)),0)
		SET @i = @i+1
	END


	--Select * from #Month 


	SELECT @SubBroker Sub_broker
	,M.Month Trade_Month
			,ISNULL(D.NoOfClients, 0) AS Traded_Client
				,remi_share Total_Revenue
			,CONVERT(VARCHAR(3),DATENAME(MONTH,M.[Month]))+''''+ RIGHT(YEAR(M.[Month]),2) AS [MONTH]
	
		
			
		FROM
		#Month M
		LEFT JOIN (
				SELECT 
					DATEADD(M,DATEDIFF(M,0, sauda_date),0) AS [Month]
					,COUNT(distinct CLIENT) AS NoOfClients
					,SUM(remi_share) remi_share
				FROM  
					Daily_sharing DS WITH (NOLOCK)
				WHERE
					DS.sb=@SubBroker
					and angel_share>0
				GROUP BY 
						DATEADD(M,DATEDIFF(M,0, DS.sauda_date),0)
				) D
		ON M.[Month] = D.[Month]
		ORDER BY M.[Month]


Drop table #Month

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Get_SBRevenue_AgeWise_New08June2018
-- --------------------------------------------------

CREATE Procedure [dbo].[Usp_Get_SBRevenue_AgeWise_New08June2018]
(
--@SubBroker Varchar(200),
--@Period varchar(200)
	@SubBroker VARCHAR(20),
	@Type VARCHAR(3) = NULL,
	@Month VARCHAR(20) = NULL,
	@BktYear VARCHAR(2) = NULL

)
as
Begin  

--exec Usp_Get_SBRevenue_AgeWise_New08June2018 'DDVM','YTD',null,''
--Declare @SubBroker varchar(1000)= 'DDVM'


Declare @SDate Datetime ,@EDate Datetime 

Select @SDate=[dbo].[fn_Get_StartData] (@Type)
,@EDate=convert(date,getdate())

Print @SDate
Print @EDate


CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@SDate,@EDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@SDate)),0)
		SET @i = @i+1
	END


	--Select * from #Month 


	SELECT @SubBroker Sub_broker,
			CONVERT(VARCHAR(3),DATENAME(MONTH,M.[Month]))+''''+ RIGHT(YEAR(M.[Month]),2) AS [MONTH]
			,ISNULL(D.NoOfClients, 0) AS Traded_Client
			,remi_share Total_Revenue
			,M.Month Trade_Month
		FROM
		#Month M
		LEFT JOIN (
				SELECT 
					DATEADD(M,DATEDIFF(M,0, sauda_date),0) AS [Month]
					,COUNT(distinct CLIENT) AS NoOfClients
					,SUM(remi_share) remi_share
				FROM  
					Daily_sharing DS WITH (NOLOCK)
				WHERE
					DS.sb=@SubBroker
					and angel_share>0
				GROUP BY 
						DATEADD(M,DATEDIFF(M,0, DS.sauda_date),0)
				) D
		ON M.[Month] = D.[Month]
		ORDER BY M.[Month]


Drop table #Month

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_TRADING_DATA_DAILY
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_GET_TRADING_DATA_DAILY]
AS
BEGIN
	DECLARE @EDATE DATE = DATEADD(DAY, -1, GETDATE()) 
	DECLARE @SDATE DATE, @ID INT = 0, @ROWCNT INT = 0
	SELECT @SDATE = DATEADD(DAY, 1, isnull(MAX(TO_DATE), '2018-01-01'))  FROM TBL_TRADING_DATA_TRACK
		WHERE [STATUS] = 'SUCCESS'
	SELECT @SDATE, @EDATE
	
	
	INSERT INTO TBL_TRADING_DATA_TRACK
	VALUES (@SDATE, @EDATE, 'RUNNING', 0, GETDATE(), NULL);

	SET @ID = @@IDENTITY;

	BEGIN TRY
	BEGIN TRANSACTION
	
		IF OBJECT_ID('TEMPDB..#TRADEINGDETAILS') IS NOT NULL
			DROP TABLE #TRADEINGDETAILS;

		CREATE TABLE #TRADEINGDETAILS
		(
			ZONE VARCHAR(100),
			REGION VARCHAR(100),
			REGIONNAME VARCHAR(100),
			BRANCH_CD VARCHAR(100),
			BRANCH VARCHAR(100),
			SUB_BROKER VARCHAR(100),
			PARTY_CODE VARCHAR(100),
			PARTY_NAME VARCHAR(100),
			ONLINECLIENT VARCHAR(100),
			B2C VARCHAR(100),
			EXCHANGESEGMENT VARCHAR(100),
			SAUDA_DATE VARCHAR(100),
			DATE1 VARCHAR(100),
			TURNOVER VARCHAR(100),
			TURNOVERB2C VARCHAR(100),
			TURNOVERB2B VARCHAR(100),
			[TURNOVER%] VARCHAR(100),
			BROKERAGE VARCHAR(100),
			BROKERAGEB2C VARCHAR(100),
			BROKERAGEB2B VARCHAR(100),
			[BROKERAGE%] VARCHAR(100),
			REMISSIER VARCHAR(100),
			[REMISSIER%] VARCHAR(100),
			NETBROK VARCHAR(100),
			NETBROKB2C VARCHAR(100),
			NETBROKB2B VARCHAR(100),
			[NETBROK%] VARCHAR(100)
		);

		INSERT INTO #TRADEINGDETAILS
		Exec [196.1.115.207].BSEDB_AB.dbo.[sp_LevelMIS1_TurnOver_AW] 
			@statusid = 'BROKER', 
			@statusname = 'BROKER', 
			@empid = 'P00045', 
			@IsEntityOrPeriodic = 'B',   
			@Entity = 'PARTY', 
			@Period ='DAILY' , 
			@ExchangeSegment = '''BSECM'', ''NSECM'', ''NSEFO'', ''MCX'', ''NCX'', ''MCD'', ''NSX''', 
			@FromZone = 'A', 
			@ToZone = 'ZZZZZZ', 
			@FromScrip = 'A', 
			@ToScrip = 'ZZZZZZ', 
			@FromBranch = 'A', 
			@ToBranch = 'ZZZZZZ', 
			@FromSubbroker = 'A',   
			@ToSubbroker = 'ZZZZZZ', 
			@FromParty = 'A', 
			@ToParty = 'ZZZZZZ', 
			@FromDate = @SDATE, --'Jan 01 2018',
			@ToDate =  @EDATE, --'Jan 02 2018',
			@FinYear = '', 
			@FinMonth = '', 
			@OrderBy = '', 
			@Rounding = 100000, 
			@AbsoluteRelative = 'RELATIVE'
	
		SET @ROWCNT = @@ROWCOUNT;
	
		INSERT INTO TBL_CLIENTSTRADINGDETAILS
		SELECT  
			CAST(PARTY_CODE AS VARCHAR(20)) PARTY_CODE,
			CAST(ONLINECLIENT AS VARCHAR(2)) ONLINECLIENT,
			CAST(B2C AS VARCHAR(2)) B2C,
			CAST(EXCHANGESEGMENT AS VARCHAR(50)) EXCHANGESEGMENT,
			CAST(SAUDA_DATE AS DATETIME) SAUDA_DATE,
			CAST(TURNOVER AS DECIMAL(20,10)) TURNOVER,
			CAST(TURNOVERB2C AS DECIMAL(20,10)) TURNOVERB2C,
			CAST(TURNOVERB2B AS DECIMAL(20,10)) TURNOVERB2B,
			CAST(BROKERAGE AS DECIMAL(20,10)) GROSSBROKERAGE,
			CAST(BROKERAGEB2C AS DECIMAL(20,10)) BROKERAGEB2C,
			CAST(BROKERAGEB2B AS DECIMAL(20,10)) BROKERAGEB2B,
			CAST(REMISSIER AS DECIMAL(20,10)) NETTOSB,
			CAST(NETBROK AS DECIMAL(20,10)) NETBROK,
			CAST(NETBROKB2C AS DECIMAL(20,10)) NETBROKB2C,
			CAST(NETBROKB2B AS DECIMAL(20,10)) NETBROKB2B,
			CAST(SUB_BROKER AS VARCHAR(50)) SUB_BROKER
		FROM #TRADEINGDETAILS;
	
		UPDATE TBL_TRADING_DATA_TRACK SET
			[STATUS] = 'SUCCESS',
			ROW_CNT = @ROWCNT,
			PROCESS_END_DATE = GETDATE()
		WHERE ID = @ID;

	COMMIT;
	END TRY
	BEGIN CATCH
		ROLLBACK;
		UPDATE TBL_TRADING_DATA_TRACK SET
			[STATUS] = 'FAIL',
			PROCESS_END_DATE = GETDATE()
		WHERE ID = @ID;

	END CATCH

--SELECT * FROM #TRADEINGDETAILS
--SELECT * FROM TBL_CLIENTSTRADINGDETAILS_TMP
--SELECT * FROM TBL_TRADING_DATA_TRACK
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_get_Watchlist_Trigger_Mobile_2
-- --------------------------------------------------

CREATE procedure usp_get_Watchlist_Trigger_Mobile_2
(
	@sub_broker varchar(200),
	@TriggerId INT,
	@Flag INT=1
)
/*

EXEC usp_get_Watchlist_Trigger_Mobile_2 'CBHO',2,0

*/

as
begin
	If (@Flag =1)
	begin
		Select * from Watchlist_Trigger_Mobile_2 with (nolock)
		where sub_broker=@sub_broker
		and TriggerId=@TriggerId
		and active=1
	END
	ELSE
	BEGIN
		Select * from Watchlist_Trigger_Mobile_2 with (nolock)
		where sub_broker=@sub_broker
		and TriggerId=@TriggerId
		and active=0
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetAdvisoryPerformanceReportData
-- --------------------------------------------------

CREATE procedure [dbo].[USP_GetAdvisoryPerformanceReportData](
	@Period NVARCHAR(50)
) 
AS    
BEGIN    
	SELECT header.PeriodDesc, header.EquityFileName, header.FutureFileName, details.Market, details.Segment, details.TotalCalls, details.PositiveCalls, details.SRPercentage, details.NetRRR 
	From AdvisoryPerformanceReportData header
	JOIN AdvisoryPerformanceReportDataDetails details ON header.id = details.AdvisoryPerformanceReportData_Id
	WHERE header.Period = @Period 
		AND header.Active = 1;
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetAdvisoryPerformanceReportPeriodList
-- --------------------------------------------------

CREATE procedure [dbo].[USP_GetAdvisoryPerformanceReportPeriodList]  
AS    
BEGIN    
	SELECT Period From AdvisoryPerformanceReportData WHERE Active = 1 ORDER BY Id;
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllBankHolidays
-- --------------------------------------------------
CREATE PROCEDURE usp_GetAllBankHolidays    
AS      
BEGIN     
 SELECT HolidayDate, BankHolidayId, Equity, Debt, Liquid    
 FROM BankHolidays WITH(NOLOCK)   
 WHERE Status = 'A' ORDER BY HolidayDate;    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllBankHolidaysForVoucherEntry
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetAllBankHolidaysForVoucherEntry]    
AS      
BEGIN  
SELECT FORMAT(HolidayDate,'dd/MM/yyyy') as HolidayDate 
 FROM BankHolidays WITH(NOLOCK) WHERE Status = 'A' and HolidayDate>=DATEADD(M, -2,  GETDATE())  
END 

 --HolidayDate=convert(varchar,getdate(),23)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllFundBarometerFileList
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetAllFundBarometerFileList]   
   @ProjectType VARCHAR(50)  
 AS                
 BEGIN  
   
    SELECT   
      [Id]  
     ,[FileName]  
     ,[FilePath]  
     ,[ProjectType]  
     ,[CreatedBy]  
     ,[CreatedDate]  
    FROM dbo.FundBarometerFileData where [ProjectType] = @ProjectType   
    ORDER BY 1 DESC  
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllNudgeFileList
-- --------------------------------------------------
         
 CREATE PROCEDURE [dbo].[usp_GetAllNudgeFileList]       
   @ProjectType VARCHAR(50)      
 AS                    
 BEGIN      
       
    SELECT       
		 [Id]      
		 ,Name    
		 ,RedirectURL    
		 ,[FileName]      
		 ,[FilePath]      
		 ,[ProjectType]      
		 ,[CreatedBy]      
		 ,[CreatedDate]   
		 ,FORMAT(ExpiryDate, 'dd MMM yyyy') AS ExpiryDate
		 ,IsActive     
    FROM dbo.NudgeFileData    
    WHERE [ProjectType] = @ProjectType    
    ORDER BY 1 DESC      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllOccupation
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description : Get All Occupation for Loans module>
-- =============================================
CREATE PROCEDURE [dbo].[usp_GetAllOccupation] 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select CODE, DESCRIPTION as Occupation from [AngelNseCM].msajag.dbo.CLIENT_STATIC_CODES a  with (nolock)  WHERE CATEGORY LIKE '%OCCUPATION%' AND kra_type='CDSL'
   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllPopupDetails
-- --------------------------------------------------

  
CREATE PROCEDURE [dbo].[usp_GetAllPopupDetails]      
(      
@Project_Type varchar(100)  
)        
AS        
BEGIN        
             
	SELECT  [id] AS Id  
	,[Index]  
	,CONVERT(VARCHAR, [ExpiryDate], 6) AS [ExpiryDate]  
	,[ImageName]  
	,[ImagePath]  AS [ImageUrl]      
	,[Redirect_Url] AS [Href ]  
	,Project_Type  AS [ProjectType]  
	,Popup_Type as PopupType
	,[Active]  
	,[CreatedDate]  
	,[ModifyDate]
	FROM  dbo.Tbl_PopupAdmin WITH (NOLOCK)  
	Order by [CreatedDate] Desc     
             
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllSalarySlab
-- --------------------------------------------------

-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description : Get All Salary Slab for Loans module>
-- =============================================
CREATE PROCEDURE [dbo].[usp_GetAllSalarySlab] 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select gross_income=DESCRIPTION from [AngelNseCM].msajag.dbo.CLIENT_STATIC_CODES WHERE CATEGORY ='INCOMESLAB_NONIND'AND kra_type='CDSL' 
   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllSelfDeclarations
-- --------------------------------------------------
CREATE PROCEDURE usp_GetAllSelfDeclarations           
@FromDate		DATE = NULL,  
@ToDate		DATE = NULL,
@ProjectType  VARCHAR(100) = NULL,
@FnYear		VARCHAR(10) = NULL             
AS              
BEGIN                    
	SELECT SBTag    
		,'20'+ convert(varchar(2),substring([FnYear],1,(charindex('-', [FnYear]))+1)) +'-'+ '20'+ convert(varchar(2),substring([FnYear],(charindex('-', [FnYear]))+1,len([FnYear]))) AS FnYear        
		,DocPath    
		,[FileName]    
		,EntryDate
		,REPLACE(DocPath,'\','#') AS NewDocPath
		,[Source] AS ProjectType,
		IsApproved,
		Remark,
		CreatedBy,
		CreatedDate,
		UpdatedBy,
		UpdatedDate
	FROM  [dbo].[sb_Declaration] WITH (NOLOCK)        
	WHERE SelfDeclaration = 'YES'     
		AND ISNULL (DocPath, '') != ''    
		AND [FileName] != ''    
		AND IsOTPVerified = 0 
		AND (@ProjectType IS NULL OR [Source] = @ProjectType) 
		AND (@FnYear IS NULL OR [FnYear] = @FnYear)   
		AND (@FromDate IS NULL OR CAST(EntryDate AS DATE) >= @FromDate)    
		AND (@ToDate IS NULL OR CAST(EntryDate AS DATE) <=  @ToDate) 
	ORDER BY EntryDate DESC              
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetClientMobileNo
-- --------------------------------------------------



-- =============================================                            
-- Author:  <Author,,Name>                            
-- Create date: <Create Date,,>                            
-- Description: <Description,,>                            
-- =============================================                            
CREATE PROCEDURE [dbo].[usp_GetClientMobileNo]                 
(                            
@PartyCode varchar(30) 
)                            
AS   

                         
BEGIN                            
 -- SET NOCOUNT ON added to prevent extra result sets from                            
 -- interfering with SELECT statements.                            
 SET NOCOUNT ON; 
 
  
 BEGIN        
          
               
 EXEC [196.1.115.167].[KYC_CI].dbo.Spx_GetMobileNoOnClientCode @PartyCode              
               
           
END 
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetCUstomePlan_Details
-- --------------------------------------------------
Create PROC [dbo].[USP_GetCUstomePlan_Details]
@SlabId NVARCHAR(10)
AS
BEGIN

/****** Script for SelectTopNRows command from SSMS  ******/
SELECT[CashSegment_Intraday_EachSide]
      ,[CashSegment_Delivery_Brokerage]
      ,[FO_Nifty]
      ,[FO_Future]
      ,[FO_DB]
      ,[Currency_Future]
      ,[Currency_FutureDB]
      ,[FO_Option_Premium]
      ,[Commodity]
      ,[Commodity_DB]
  FROM [NXT].[dbo].[tbl_NXT_CustomPlan] WITH(NoLOCK) where Id=@SlabId

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_getDealerAdmin
-- --------------------------------------------------
CREATE procedure usp_getDealerAdmin
(
@Sub_Broker varchar(200)
)
as
begin

--EXEC  usp_getDealerAdmin 

select Sb_Tag,User_ID
 FROM [NXT].[dbo].[tbl_Emp_Master_syn]
where Sb_Tag=@Sub_Broker
  and [isAdmin]=1

  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_getDealerSbtag
-- --------------------------------------------------
 CREATE procedure usp_getDealerSbtag
(  
@empNo varchar(200)  
)  
as  
begin  
   
select Sb_Tag  
 FROM [NXT].[dbo].[tbl_Emp_Master_syn]  
where Emp_No =  @empNo
  and [isAdmin]=1  
  
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDigitalLibraryCustomizeCreativeByRequestId
-- --------------------------------------------------

CREATE Procedure [dbo].[usp_GetDigitalLibraryCustomizeCreativeByRequestId]
(
	@Requestid INT
)
as
begin
	select 
	Requestid
	,sub_broker + convert(varchar(10),@Requestid)
	,Category
	,CreativeName
	,Purpose
	,Message
	,FlagForContact
	,SampleImageURL
	,SampleImageName
	,ImageURL
	,ImageName
	,ExpectedDelivery
	,DeliveryDate
	,Status
	,Remarks
	,CreateDate
	,createdby
	,modifyDate 
	from tbl_DigitalLibraryCreativesCustom with (nolock)
	where Requestid=@Requestid
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDigitalLibraryCustomizeCreativeByRequestId_BeeNXT
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetDigitalLibraryCustomizeCreativeByRequestId_BeeNXT]
(
	@Requestid INT
)
as
begin
	select 
	Requestid
	,sub_broker + convert(varchar(10),@Requestid)
	,Category
	,CreativeName
	,Purpose
	,Message
	,FlagForContact
	,SampleImageURL
	,SampleImageName
	,ImageURL
	,ImageName
	,ExpectedDelivery
	,DeliveryDate
	,Status
	,Remarks
	,CreateDate
	,createdby
	,modifyDate 
	from tbl_DigitalLibraryCreativesCustom_Beenxt with (nolock)
	where Requestid=@Requestid
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDigitalLibraryCustomizeCreativesAll
-- --------------------------------------------------

CREATE Procedure [dbo].[usp_GetDigitalLibraryCustomizeCreativesAll]
as
begin
	select 
	Requestid
	,sub_broker
	,Category
	,CreativeName
	,Purpose
	,Message
	,FlagForContact
	,SampleImageURL
	,SampleImageName
	,ImageURL
	,ImageName
	,ExpectedDelivery
	,DeliveryDate
	,Status
	,Remarks
	,CreateDate
	,createdby
	,modifyDate
	,modifyby 
	from tbl_DigitalLibraryCreativesCustom with (nolock)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDigitalLibraryCustomizeCreativesAll_BeeNXT
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetDigitalLibraryCustomizeCreativesAll_BeeNXT]
as
begin
	select 
	Requestid
	,sub_broker
	,Category
	,CreativeName
	,Purpose
	,Message
	,FlagForContact
	,SampleImageURL
	,SampleImageName
	,ImageURL
	,ImageName
	,ExpectedDelivery
	,DeliveryDate
	,Status
	,Remarks
	,CreateDate
	,createdby
	,modifyDate
	,modifyby 
	from tbl_DigitalLibraryCreativesCustom_Beenxt with (nolock)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDigitalLibraryCustomizeCreativesBySubroker
-- --------------------------------------------------

CREATE Procedure [dbo].[usp_GetDigitalLibraryCustomizeCreativesBySubroker]
(
	@Accesscode varchar(100)
)
as
begin

select 
	Requestid
	,sub_broker
	,Category
	,CreativeName
	,Purpose
	,Message
	,FlagForContact
	,SampleImageURL
	,SampleImageName
	,ImageURL
	,ImageName
	,ExpectedDelivery
	,DeliveryDate
	,Status
	,Remarks
	,CreateDate
	,createdby
	,modifyDate
	from tbl_DigitalLibraryCreativesCustom with (nolock)
	where sub_broker=@Accesscode
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDigitalLibraryCustomizeCreativesBySubroker_BeeNXT
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetDigitalLibraryCustomizeCreativesBySubroker_BeeNXT]
(
	@Accesscode varchar(100)
)
as
begin

select 
	Requestid
	,sub_broker
	,Category
	,CreativeName
	,Purpose
	,Message
	,FlagForContact
	,SampleImageURL
	,SampleImageName
	,ImageURL
	,ImageName
	,ExpectedDelivery
	,DeliveryDate
	,Status
	,Remarks
	,CreateDate
	,createdby
	,modifyDate
	from tbl_DigitalLibraryCreativesCustom_BeeNXT with (nolock)
	where sub_broker=@Accesscode
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetDMATCharges
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE USP_GetDMATCharges
(
@DPID varchar(100),
@fromdate nvarchar(100),
@todate nvarchar(100)
)
AS
BEGIN
declare @p15 varchar(1)
set @p15=NULL
exec [172.31.16.94].[DMAT].[citrus_usr].[Pr_rpt_bill_profile_filter_NXT] @pa_dptype='CDSL',@pa_excsmid=3,@pa_fromdate=@fromdate,@pa_todate=@todate,
@pa_bulk_printflag='N',@pa_stopbillclients_flag='N',@pa_fromaccid=@DPID,@pa_toaccid=@DPID,
@pa_group_cd='|*~|N',@pa_transclientsonly='N',@pa_Hldg_Yn='Y',@pa_profile='',@pa_login_pr_entm_id='1',@pa_login_entm_cd_chain='HO|*~|',
@pa_output=@p15 output
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDocumentUpload
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetDocumentUpload]
(
	@ContentType VARCHAR(200)
)	
AS
BEGIN
	SELECT DU.Id, DU.MasterId, DUM.CardType, DUM.CardTypeKey, DU.FileName, DU.FilePath, DU.CreationDate, DU.LastUpdate, DU.CreatedBy
	FROM DocumentUpload DU
	INNER JOIN DocumentUploadMaster DUM
		ON DU.MasterId = DUM.Id
	 WHERE DUM.ContentType = @ContentType AND (DU.IsDeleted IS NULL OR DU.IsDeleted = 0)
	ORDER BY DUM.CardType, DU.CreationDate DESC
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetDocumentUploadById
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetDocumentUploadById]
(
	@Id INT
)	
AS
BEGIN
	SELECT DU.Id, DUM.ContentType, DU.MasterId, DUM.CardType, DUM.CardTypeKey, DU.FileName, DU.FilePath, DU.CreationDate, DU.LastUpdate, DU.CreatedBy
	FROM DocumentUpload DU
	INNER JOIN DocumentUploadMaster DUM
		ON DU.MasterId = DUM.Id 
	WHERE DU.Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetDPID
-- --------------------------------------------------

CREATE Procedure Usp_GetDPID
(@Party_Code varchar(200))
as
begin
--EXEC Usp_GetDPID 'M2806'
			SELECT NISE_PARTY_CODE,	CLIENT_CODE from --1203320000000032 
			[172.31.16.108].inhouse.dbo.TBL_CLIENT_MASTER WITH(NOLOCK) 
			WHERE NISE_PARTY_CODE= @Party_Code 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetEmpSubBroker
-- --------------------------------------------------
create procedure [dbo].[usp_GetEmpSubBroker]
(
  @EmpId varchar(25)
)

as

set nocount on

begin
select Sb_Tag as AccessCode,'SB' as AccessTo from tbl_emp_master with (nolock) where Emp_No=@EmpId
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetEWelcomeAccessSB
-- --------------------------------------------------
Create proc [dbo].[usp_GetEWelcomeAccessSB]  
as   
begin  
 select * from EWelcomeSBAccess with (noLock)  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetEWelcomeAccessSBBasedOnId
-- --------------------------------------------------
CREATE PROCEDURE usp_GetEWelcomeAccessSBBasedOnId           
(            
 @UserId  int    
)            
AS            
BEGIN        
 Select ID, SBTAG, ActiveFrom, ActiveTo, CreatedBy, CONVERT (date, CreatedOn) as CreatedOn, IsActive    
 FROM [EWelcomeSBAccess]    
 WHERE ID = @UserId    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetIPODocumentUpload
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetIPODocumentUpload]
(
	@ContentType VARCHAR(200)
)	
AS
BEGIN
	SELECT Id, FileName, FilePath, CreationDate, ContentType,LastUpdate, IsActive,CreatedBy
	FROM IPODocumentUpload WHERE ContentType = @ContentType AND (IsDeleted IS NULL OR IsDeleted = 0)
	ORDER BY  CreationDate DESC
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetIPOUploadDetails
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_GetIPOUploadDetails]  
(  
   
 @iposrno  int
)  
AS  
BEGIN  

  SELECT * FROM IPODocumentUpload where IPOSrNo = @iposrno order by Id desc

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_getKycContestDetails
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Sangharsh Malgaonkar>
-- Create date: <Create Date,,08-01-2019>
-- Description:	<Description, Get Data for Kyc Contest,>
-- =============================================
CREATE PROCEDURE [dbo].[Usp_getKycContestDetails]
	(
	@sbtag varchar(10)
	)
	
AS
BEGIN


	select ID, SB_TAG, Target_KYC, Reward, htmlPage from tblKycContest where SB_TAG = @sbtag
   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETMANDATESMSLOGS
-- --------------------------------------------------
CREATE PROCEDURE USP_GETMANDATESMSLOGS(
	@StartDate DATE = null,
	@EndDate DATE = null,
	@PartyCode VARCHAR(50) = null,
	@UserType VARCHAR(20) = 'ALL',
	@MandateType VARCHAR(10) = 'ALL'
)

--SELECT TOP 100 * FROM EmandateSMSLinkLog WITH(NOLOCK)
AS
BEGIN
	CREATE TABLE #MandateSmsLog(PartyCode VARCHAR(50), SMSLink VARCHAR(500), BankName VARCHAR(200), SmsStatus VARCHAR(10), UserType VARCHAR(50), CreatedOnDate DATETIME, Amount INT, MandateType VARCHAR(20));
	
	IF (@MandateType IN ('DIGITAL', 'ALL'))  
	BEGIN
	
 
		INSERT INTO #MandateSmsLog
		SELECT PartyCode
		, SMSLink
		, BankName
		, CASE WHEN SmsStatus = 'Y' THEN 'YES' ELSE 'NO' END AS SmsStatus
		, CASE 
			WHEN UserType = ('NXTMANDATE') THEN 'NXT MANDATE ONLY' 
			WHEN UserType = ('inhouse') THEN 'INHOUSE' 
			WHEN UserType = ('lms') THEN 'LMS' 
			WHEN UserType = ('crms') THEN 'CRMS' 
			WHEN UserType = ('BEENXTMANDATE') THEN 'BEENXT MANDATE ONLY'
			WHEN UserType = ('BEENXT') THEN 'BEENXT SIP MANDATE'
			WHEN UserType = ('NXT MF') THEN 'NXT SIP MANDATE'
			WHEN UserType = ('InhouseMandate') THEN 'INHOUSE MANDATE ONLY'
			ELSE UserType END AS UserType
		, CreatedOn AS CreatedOn
		, Amount
		, 'Digital'
		FROM EmandateSMSLinkLog WITH(NOLOCK)
		WHERE (CASE WHEN @StartDate IS NOT NULL THEN CreatedOn ELSE @StartDate END) >= @StartDate
		AND (CASE WHEN dateadd(day,1,@EndDate) IS NOT NULL THEN CreatedOn ELSE dateadd(day,1,@EndDate) END <= dateadd(day,1,@EndDate))
		AND (CASE WHEN @PartyCode IS NOT NULL AND @PartyCode <> '' THEN @PartyCode ELSE PartyCode END) = PartyCode
		AND (
			(CASE WHEN @UserType IS NULL THEN UserType END) = UserType
			OR (CASE WHEN @UserType IS NOT NULL AND @UserType = ('BEENXT') THEN UserType END) IN  ('BEENXT', 'BEENXTMANDATE')
			OR (CASE WHEN @UserType IS NOT NULL AND @UserType = ('NXT') THEN UserType END) IN  ('NXT MF', 'NXTMANDATE')
			OR (CASE WHEN @UserType IS NOT NULL AND @UserType = ('LMS') THEN UserType END) = 'lms'
			OR (CASE WHEN @UserType IS NOT NULL AND @UserType = ('CRMS') THEN UserType END) = 'crms'
			OR (CASE WHEN @UserType IS NOT NULL AND @UserType = ('INHOUSE') THEN UserType END) IN ('inhouse', 'InhouseMandate')
			OR 1 = (CASE WHEN @UserType = 'ALL' THEN 1 END)
		);
		
		
			
	END
	IF(@MandateType IN ('PHYSICAL', 'ALL'))
	BEGIN
		INSERT INTO #MandateSmsLog
		SELECT e.PartyCode AS PartyCode
		, e.Url AS SMSLink
		, t.sBankName AS BankName
		, CASE WHEN t.sSmsSend = 'Y' THEN 'YES' ELSE 'NO' END AS SmsStatus
		, '' AS UserType
		, e.CreatedOn AS CreatedOn
		, t.nAmount AS Amount
		, 'Physical'
		--[172.31.18.177]/[196.1.115.132]
		FROM [196.1.115.253].[MUTUALFUND].dbo.EmandateSmsLog e WITH (NOLOCK)
		left JOIN [196.1.115.253].[MUTUALFUND].dbo.tblXsipMandateDetails t WITH (NOLOCK) ON e.MandateId = t.sMandateID
		WHERE (CASE WHEN @StartDate IS NOT NULL THEN e.CreatedOn ELSE @StartDate END) >= @StartDate
			AND (CASE WHEN dateadd(day,1,@EndDate) IS NOT NULL THEN e.CreatedOn ELSE dateadd(day,1,@EndDate) END <= dateadd(day,1,@EndDate))
			AND (CASE WHEN @PartyCode IS NOT NULL AND @PartyCode <> '' THEN @PartyCode ELSE e.PartyCode END) = e.PartyCode
			ORDER BY CreatedOn DESC;
	END
	
	SELECT PartyCode, SMSLink, BankName, SmsStatus, UserType, FORMAT(CreatedOnDate, 'dd/MM/yyyy hh:mm:ss tt') AS CreatedOn, Amount, MandateType 
	FROM #MandateSmsLog l ORDER BY l.CreatedOnDate DESC;

END;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetMF_ACTIVE_LIST_FORSB
-- --------------------------------------------------
--select * from [196.1.115.200].bsemfss.dbo.MF_ACTIVE_LIST_FORSB where party_code='R123492'

CREATE Procedure [dbo].[Usp_GetMF_ACTIVE_LIST_FORSB]
(
@Party_Code varchar(100)
)

--EXEC Usp_GetMF_ACTIVE_LIST_FORSB 'R123492'
as
begin

select status,@Party_Code  Party_Code from [AngelFO].bsemfss.dbo.MF_ACTIVE_LIST_FORSB with (nolock) where party_code=@Party_Code



End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetMFFolioNo
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_GetMFFolioNo]
(
  @PARTY_CODE VARCHAR(100)
  ,@amcCode VARCHAR(100)
  ,@schemeCode VARCHAR(100)


)

--EXEC Usp_GetMFFolioNo 'B52733','RelianceMutualFund_MF','RELLFTPI-GR-L0'

AS
begin



  select top 1 isnull(sFolioNo,0)  sFolioNo
  from [196.1.115.253].MutualFund.dbo.TBLCLIENTFOLIODETAILS with(nolock) 
  where sClientCode=@PARTY_CODE 
  and sAMCCode=@amcCode 
  and sSchemeCode=@schemeCode 
  order by sInsertedOn desc

  End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetMFFolioNo_Ipartner
-- --------------------------------------------------

CREATE  procedure [dbo].[Usp_GetMFFolioNo_Ipartner]
(
  @PARTY_CODE VARCHAR(100)
  --,@amcCode VARCHAR(100)
  ,@schemeCode VARCHAR(100)


)

--EXEC Usp_GetMFFolioNo_Ipartner 'B52733','RELLFTPI-GR-L0'

AS
begin



  select top 1 isnull(Folio_No,0)  sFolioNo
  --from [196.1.115.132].MutualFund.dbo.TBLCLIENTFOLIODETAILS with(nolock) 
  from [172.31.16.85].ABR_DW.DBO.IWMF_vw_GetLatestFolioNo with(nolock) 
  where party_COde=@PARTY_CODE 
  and Scheme_Code=@schemeCode 
  order by trans_date desc

  End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetNewSBGeneratedDate
-- --------------------------------------------------
CREATE PROCEDURE Usp_GetNewSBGeneratedDate
(            
 @sbTag  VARCHAR(100)
 )
AS  
BEGIN   
	DECLARE @today Date = CAST(GETDATE() AS DATE)
	DECLARE @generatedDate date
	DECLARE @daysDiff int = 30

	SELECT @generatedDate = CAST(login_Activated AS DATE) 
	FROM USER_LOGIN WITH(NOLOCK) 
	WHERE access_code = @sbTag

	SELECT CASE WHEN DATEDIFF(day, @generatedDate, @today) <= @daysDiff THEN 1 ELSE 0 END  as IsAccessiable

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetNewSBGeneratedDate_v1
-- --------------------------------------------------

--Usp_GetNewSBGeneratedDate_v1 'AJYC'
CREATE PROCEDURE Usp_GetNewSBGeneratedDate_v1
(            
 @sbTag  VARCHAR(100)
 )
AS  
BEGIN   
	DECLARE @today Date = CAST(GETDATE() AS DATE)
	DECLARE @generatedDate date
	DECLARE @daysDiff int = 30

	SELECT @generatedDate = CAST(login_Activated AS DATE) 
	FROM [172.31.12.199].NXT.dbo.USER_LOGIN WITH(NOLOCK) 
	WHERE access_code = @sbTag

	SELECT CASE WHEN DATEDIFF(day, @generatedDate, @today) <= @daysDiff THEN 1 ELSE 0 END  as IsAccessiable

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETNONPOAREDEMPTIONREQUEST
-- --------------------------------------------------
           
 CREATE PROCEDURE [dbo].[USP_GETNONPOAREDEMPTIONREQUEST]       
  @PartyCode varchar(50),      
  @RequestId varchar(100)      
 AS          
 BEGIN          
            
   SET NOCOUNT ON;          
            
   SELECT * FROM MFNonPOARedemptionInfo WITH (NOLOCK)         
   WHERE PartyCode = @PartyCode and RequestId= @RequestId and LinkStatus=1      
   ORDER BY CreatedDate asc        
          
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetNXTAppStatus
-- --------------------------------------------------
CREATE Procedure [dbo].[Usp_GetNXTAppStatus]  
(  
  @username varchar(200)  
)  
as  
begin  
  
--EXEC Usp_GetNXTAppStatus  'hoet'  
  
--Declare @username varchar(200)  
--Set @username= 'hoet1'  
  
 If Exists (select * from dbo.user_login_syn with(nolock) where username=@username)  
 Begin   
     --Select @username username,'User Exists' Message  
  
    If Exists (select * from dbo.TBL_MOBLOGINDETAILS_syn with(nolock) where userid=@username)  
    Begin   
  
  
    Select 'App Downloaded' Message  
      
  
    END  
  
 END  
 ELSE  
 BEGIN  
    Select 'User Not found' Message  
  
 END  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetNXTAppStatus_Bkp04Dec2021
-- --------------------------------------------------
CREATE Procedure [dbo].[Usp_GetNXTAppStatus_Bkp04Dec2021]  
(  
  @username varchar(200)  
)  
as  
begin  
  
--EXEC Usp_GetNXTAppStatus  'hoet'  
  
--Declare @username varchar(200)  
--Set @username= 'hoet1'  
  
 If Exists (select * from [196.1.115.132].rolemgm.dbo.user_login with(nolock) where username=@username)  
 Begin   
     --Select @username username,'User Exists' Message  
  
    If Exists (select * from [196.1.115.132].risk.dbo.TBL_MOBLOGINDETAILS with(nolock) where userid=@username)  
    Begin   
  
  
    Select 'App Downloaded' Message  
      
  
    END  
  
 END  
 ELSE  
 BEGIN  
    Select 'User Not found' Message  
  
 END  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetNXTMobilePopupDetails
-- --------------------------------------------------
CREATE PROCEDURE usp_GetNXTMobilePopupDetails       
(     
    @Sub_broker varchar(100) = ''      
)          
AS          
BEGIN         
	If (select Count(1)  FROM [dbo].[sb_Declaration]  where SelfDeclaration is null  and RCVD_DATE is null  and [SBTag] = @Sub_broker) > 0      
	Begin          
		SELECT a.id as Id,         
		[Index],  
		[ImagePath] AS [ImageUrl],  
		[Redirect_Url] AS Href,  
		[ImageName]  
		FROM dbo.Tbl_NXTMobilePopup a WITH (NOLOCK)        
		LEFT JOIN Tbl_NXTMobilePopupSbTagMap b on ( a.id = b.Popup_Id )   
		WHERE a.[Active] = 'Y'         
			AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
			AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))     
			AND (a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))  
		Order by [Index]   
	END             
	ELSE       
	BEGIN      
		SELECT a.id as Id,        
		[Index],  
		[ImagePath] AS [ImageUrl],  
		[Redirect_Url] AS Href,  
		[ImageName]  
		FROM  dbo.Tbl_NXTMobilePopup a WITH (NOLOCK)    
		LEFT JOIN Tbl_NXTMobilePopupSbTagMap b on ( a.id = b.Popup_Id)   
		WHERE a.[Active] = 'Y'                
			AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
			AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))       
			and a.Redirect_Url Not like '%SelfDeclaration%'      
			AND (a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))  
		Order by [Index]   
	END      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetNXTMobilePopupLog
-- --------------------------------------------------
CREATE PROCEDURE [dbo].Usp_GetNXTMobilePopupLog                   
AS            
BEGIN            
            
	select a.id, b.access_code into #AllUser   
	from Tbl_NXTMobilePopup a         
	LEFT JOIN (        
	select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL         
	where status = 1 and login_inactive_date > getdate() and access_to = 'SB' and usertype = 'ADMIN' and username is not NULL         
	AND  access_code is not NULL AND access_code <> ''        
	) b on (1 = 1)        
	where a.Popup_Type = 'All'   
	AND CONVERT(DATE, a.[CreatedDate]) > DATEADD(DD, -93, GETDATE())            
        
	SELECT case when a.Popup_Type = 'Individual' then COUNT(b.SbTag) else COUNT(d.access_code) end cnt,   
	CONVERT(DATE,a.CREATEDDATE) CREATEDDATE, a.PopUp_Type as PopUpType into #Count           
	FROM Tbl_NXTMobilePopup a           
	LEFT JOIN Tbl_NXTMobilePopupSbTagMap b on (a.id = b.Popup_Id AND a.Popup_Type = 'Individual')           
	LEFT JOIN #AllUser d on (a.id = d.id AND a.Popup_Type = 'All' )        
	where CONVERT(DATE, a.[CreatedDate]) > DATEADD(DD, -93, GETDATE())        
	group by CONVERT(DATE, a.CREATEDDATE), a.PopUp_Type          
               
	select * INTO #fINAL from             
	(            
	SELECT ROW_NUMBER() over (partition by CONVERT(DATE,a.[CreatedDate]), a.PopUp_Type order by b.SbTag) RN,            
	b.SbTag,  
	a.Id AS PopupId,  
	a.[Index] AS OrderIndex,  
	a.ImageName,  
	a.ImagePath,  
	a.Popup_Type AS PopUpType,         
	a.Redirect_Url,  
	a.ExpiryDate,  
	a.CampaignId,  
	a.Active,  
	a.[Createdby],            
	a.[CreatedDate],
	a.StartDate,
	a.StartTime,
	a.ExpiryTime
	FROM Tbl_NXTMobilePopup a           
	LEFT JOIN Tbl_NXTMobilePopupSbTagMap b on ( a.id = b.Popup_Id AND a.Popup_Type = 'Individual')          
	WHERE CONVERT(DATE,a.[CreatedDate]) > DATEADD(DD, -93, GETDATE())           
	) T           
               
	SELECT rn,   
	A.PopupId,  
	A.OrderIndex,  
	A.ImageName,  
	A.ImagePath,  
	A.PopUpType,          
	A.Redirect_Url,  
	A.CampaignId,  
	A.Active,  
	A.[CreatedBy],  
	A.[CreatedDate],  
	B.cnt CNT,
	A.StartDate,
	A.StartTime,
	A.ExpiryDate,
	A.ExpiryTime
	FROM #fINAL A             
	LEFT JOIN #Count B on convert(date, A.[CreatedDate]) = B.[CreatedDate]            
	AND A.PopUpType = B.PopUpType            
	--WHERE RN = 1             
	order by CreatedDate desc            
               
	DROP TABLE #fINAL            
	DROP TABLE #Count        
	DROP TABLE #AllUser        
               
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetOrganicMarketingUpload
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_GetOrganicMarketingUpload]

AS
BEGIN

SELECT top 1 * FROM OrganicMarketingUpload WITH(NOLOCK)
WHERE GETDATE()   >= CAST(CONCAT(Startdate,' ',Starttime) AS VARCHAR(23)) and
GETDATE()  <= CAST(CONCAT(ExpiryDate,' ',ExpiryTime) AS VARCHAR(23))
and isnull(IsDeleted,'') <> 1
order by ID desc

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetOrgMarketingDocument
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetOrgMarketingDocument]

AS
BEGIN
	SELECT Id, ContentType,ContentName, FileName as ImageName, FilePath,ServerFilePath as ImagePath, CreationDate, LastUpdate, CreatedBy
	,CAST(StartDate AS varchar) StartDate,CAST(StartTime AS varchar) StartTime ,CAST(ExpiryDate AS varchar) ExpiryDate ,CAST(ExpiryTime AS varchar) ExpiryTime 
	FROM OrganicMarketingUpload WITH(NOLOCK) WHERE (IsDeleted IS NULL OR IsDeleted = 0)
	AND DATEDIFF(DAY,CONVERT(DATE,GETDATE()),CONVERT(DATE,StartDate)) <= 30
	AND CONVERT(DATE,StartDate) <= CONVERT(DATE,GETDATE())
	ORDER BY ID DESC
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetOrgMarketingDocumentList
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetOrgMarketingDocumentList]

AS
BEGIN
	SELECT Id, ContentType,ContentName, FileName as ImageName, FilePath,ServerFilePath as ImagePath, CreationDate, LastUpdate, CreatedBy
	,CAST(StartDate AS varchar) StartDate,CAST(StartTime AS varchar) StartTime ,CAST(ExpiryDate AS varchar) ExpiryDate ,CAST(ExpiryTime AS varchar) ExpiryTime 
	FROM OrganicMarketingUpload WITH(NOLOCK) WHERE (IsDeleted IS NULL OR IsDeleted = 0)
	AND DATEDIFF(DAY,CONVERT(DATE,GETDATE()),CONVERT(DATE,StartDate)) <= 30
	ORDER BY ID DESC
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetOrgMarketingDocUpldById
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetOrgMarketingDocUpldById]
(
	@Id INT
)	
AS
BEGIN
	SELECT Id, ContentType, FileName, FilePath, CreationDate, LastUpdate, CreatedBy
	FROM OrganicMarketingUpload WHERE Id = @Id
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetOrgnMarDigitalLibrary
-- --------------------------------------------------
Create Procedure [dbo].[usp_GetOrgnMarDigitalLibrary]
@SearchText varchar(100)
AS
BEGIN
    If(@SearchText IS NOT NULL) OR (LEN(@SearchText) > 0)
	BEGIN
	SELECT Id, ContentType,ContentName, FileName as ImageName, FilePath,ServerFilePath as ImagePath, CreationDate, LastUpdate, CreatedBy
	,CAST(StartDate AS varchar) StartDate,CAST(StartTime AS varchar) StartTime ,CAST(ExpiryDate AS varchar) ExpiryDate ,CAST(ExpiryTime AS varchar) ExpiryTime 
	FROM OrganicMarketingUpload WITH(NOLOCK) WHERE (IsDeleted IS NULL OR IsDeleted = 0)
	AND DATEDIFF(DAY,CONVERT(DATE,GETDATE()),CONVERT(DATE,StartDate)) <= 30
	AND CONVERT(DATE,StartDate) <= CONVERT(DATE,GETDATE()) AND ContentName like '%' + @SearchText + '%'
	ORDER BY ID DESC
	END
	Else
	BEGIN
	SELECT Id, ContentType,ContentName, FileName as ImageName, FilePath,ServerFilePath as ImagePath, CreationDate, LastUpdate, CreatedBy
	,CAST(StartDate AS varchar) StartDate,CAST(StartTime AS varchar) StartTime ,CAST(ExpiryDate AS varchar) ExpiryDate ,CAST(ExpiryTime AS varchar) ExpiryTime 
	FROM OrganicMarketingUpload WITH(NOLOCK) WHERE (IsDeleted IS NULL OR IsDeleted = 0)
	AND DATEDIFF(DAY,CONVERT(DATE,GETDATE()),CONVERT(DATE,StartDate)) <= 30
	AND CONVERT(DATE,StartDate) <= CONVERT(DATE,GETDATE())
	ORDER BY ID DESC
	END
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetPartnerReferral
-- --------------------------------------------------
  
CREATE PROCEDURE Usp_GetPartnerReferral   
(            
 @sbTag  VARCHAR(100)
 )
AS  
BEGIN   
  SELECT ROW_NUMBER() OVER (ORDER BY RefId) AS RowNum, RefName AS LeadName, CreatedOn, City, Mobile AS MobileNo, EmailId, SpecialTips as RemarksProspect, 
  CASE WHEN PushFlag = 0 THEN 'Inactive' ELSE 'Active' END as Flag,
  ModifiedOn
  From [196.1.115.167].sb_comp.dbo.SB_Partners_ReferenceDetail WITH(NOLOCK)
  WHERE sbtag = @sbTag
  order by CreatedOn
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetPassiveClientNXT_Bkp29Apr2020
-- --------------------------------------------------
CREATE procedure Usp_GetPassiveClientNXT_Bkp29Apr2020 
(

@Party_Code varchar(200)
)
as
--EXEC Usp_GetPassiveClientNXT 'R16237'

begin
Select * from PassivToActiveNXT with (nolock) where flag=1 and Party_Code=@Party_Code

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETPAYMENTMSLOGS
-- --------------------------------------------------
CREATE PROCEDURE USP_GETPAYMENTMSLOGS(
	@StartDate DATE = null,
	@EndDate DATE = null,
	@PartyCode VARCHAR(50) = null
)

--SELECT TOP 100 * FROM EmandateSMSLinkLog WITH(NOLOCK)
AS
BEGIN
	Select PartyCode
	, SBTag
	, BankName
	, Created_Date AS CreatedOn
	, MarginDeposit AS Amount
	, PaymentLink AS SMSLink 
	FROM MfPaymentInfo m WITH(NOLOCK)
	WHERE (CASE WHEN @StartDate IS NOT NULL THEN Created_Date ELSE @StartDate END) >= @StartDate 
		AND (CASE WHEN dateadd(day,1,@EndDate) IS NOT NULL THEN Created_Date ELSE dateadd(day,1,@EndDate) END <= dateadd(day,1,@EndDate))
		--AND (CASE WHEN @PartyCode IS NOT NULL AND @PartyCode <> '' THEN @PartyCode ELSE PartyCode END) = PartyCode 
	ORDER BY m.Created_Date DESC;
END;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetPopupDetails
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetPopupDetails]          
(          
    @Project_Type varchar(100) ,         
    @Sub_broker   varchar(100)  =''        
)            
AS            
BEGIN      
--return 0
	If (select Count(1) FROM [dbo].[sb_Declaration] where SelfDeclaration is null and RCVD_DATE is null and [SBTag] = @Sub_broker) > 0        
	Begin            
		SELECT a.id as Id,           
		[Index]          
		,[ImagePath] AS [ImageUrl]          
		,[Redirect_Url] AS Href          
		,[ImageName] ,    
		OpenInNewTab    
		FROM  dbo.Tbl_PopupAdmin a WITH (NOLOCK)          
		LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId )     
		WHERE (a.[Project_Type] = @Project_Type OR a.[Project_Type] = 'BOTH')          
		AND a.[Active] = 'Y'
		AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
		AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))
		AND (a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))    
		Order by [Index], a.CreatedDate DESC  
	END               
	ELSE         
	BEGIN        
		SELECT  a.id as Id,          
		[Index]          
		,[ImagePath] AS [ImageUrl]          
		,[Redirect_Url] AS Href          
		,[ImageName],    
		OpenInNewTab    
		FROM  dbo.Tbl_PopupAdmin a WITH (NOLOCK)      
		LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId)     
		WHERE (a.[Project_Type] = @Project_Type OR a.[Project_Type] = 'BOTH')          
		AND a.[Active] = 'Y'    
		AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
		AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))        
		and a.Redirect_Url Not like '%SelfDeclaration%'        
		AND ( a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))    
		Order by [Index], a.CreatedDate DESC     
	END        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetPopupDetails_1
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetPopupDetails_1]          
(          
    @Project_Type varchar(100) ,         
    @Sub_broker   varchar(100)  =''        
)            
AS            
BEGIN      
--return 0
	If (select Count(1) FROM [dbo].[sb_Declaration] where SelfDeclaration is null and RCVD_DATE is null and [SBTag] = @Sub_broker) > 0        
	Begin            
		SELECT a.id as Id,           
		[Index]          
		,[ImagePath] AS [ImageUrl]          
		,[Redirect_Url] AS Href          
		,[ImageName] ,    
		OpenInNewTab    
		FROM  dbo.Tbl_PopupAdmin a WITH (NOLOCK)          
		LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId )     
		WHERE (a.[Project_Type] = @Project_Type OR a.[Project_Type] = 'BOTH')          
		AND a.[Active] = 'Y'
		AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
		AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))
		AND (a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))    
		Order by [Index], a.CreatedDate DESC  
	END               
	ELSE         
	BEGIN        
		SELECT  a.id as Id,          
		[Index]          
		,[ImagePath] AS [ImageUrl]          
		,[Redirect_Url] AS Href          
		,[ImageName],    
		OpenInNewTab    
		FROM  dbo.Tbl_PopupAdmin a WITH (NOLOCK)      
		LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId)     
		WHERE (a.[Project_Type] = @Project_Type OR a.[Project_Type] = 'BOTH')          
		AND a.[Active] = 'Y'    
		AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
		AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))        
		and a.Redirect_Url Not like '%SelfDeclaration%'        
		AND ( a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))    
		Order by [Index], a.CreatedDate DESC     
	END        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetPopupDetails_New
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_GetPopupDetails_New]      
    (      
    @Project_Type varchar(100) ,     
    @Sub_broker   varchar(100)  =''    
   )        
   AS        
   BEGIN        
    
     
  If (select Count(1)  FROM [dbo].[sb_Declaration]  where SelfDeclaration is null  and RCVD_DATE is null  and [SBTag]=@Sub_broker)>0    
  Begin        
  Print 'A'    
    
   SELECT a.id as Id,       
     [Index]      
    ,[ImagePath] AS [ImageUrl]      
    ,[Redirect_Url] AS Href      
    ,[ImageName]      
     FROM  dbo.Tbl_PopupAdmin a WITH (NOLOCK)      
	 LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId ) 
     WHERE (a.[Project_Type] = @Project_Type OR a.[Project_Type] = 'BOTH')      
     AND a.[Active] = 'Y'       
     AND a.[ExpiryDate] >= CAST(GETDATE() AS DATE)        
     --and a.Redirect_Url like '%SelfDeclaration%'  
	 --AND ((a.IsIndividual = 1 AND b.SbTag = @Sub_broker) OR a.IsIndividual = 0)  
	 AND ( a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))
	 Order by [Index] 
 END           
 ELSe     
 BEGIN    
 Print 'B'    
    
  SELECT  a.id as Id,      
	 [Index]      
    ,[ImagePath] AS [ImageUrl]      
    ,[Redirect_Url] AS Href      
    ,[ImageName]      
     FROM  dbo.Tbl_PopupAdmin a WITH (NOLOCK)  
	 LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId) -- AND a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker
     WHERE (a.[Project_Type] = @Project_Type OR a.[Project_Type] = 'BOTH')      
     AND a.[Active] = 'Y'       
     AND a.[ExpiryDate] >= CAST(GETDATE() AS DATE)      
     and a.Redirect_Url Not like '%SelfDeclaration%'    
	 --AND ((a.IsIndividual = 1 AND b.SbTag = @Sub_broker) OR a.IsIndividual = 0)  
	 AND ( a.Popup_Type = 'All' OR (a.Popup_Type = 'Individual' AND b.SbTag = @Sub_broker))
	 Order by [Index] 
 END    
           
   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetPopupNXTLog
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_GetPopupNXTLog]              
                 
AS                
                   
BEGIN                
                
	select a.id, b.access_code into #AllUser from Tbl_PopupAdmin a             
	LEFT JOIN (            
	select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL             
	where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL             
	AND  access_code is not NULL AND access_code <> ''            
	) b on (1=1)            
	where a.Project_Type = 'NXT'       
	--AND a.Active = 'Y'       
	AND a.Popup_Type = 'All'       
	AND CONVERT(DATE,a.[CreatedDate])>DATEADD(DD,-30,GETDATE())                
            
  
	SELECT   
	case when a.Popup_Type = 'Individual' then COUNT(b.SbTag) else COUNT(d.access_code) end cnt,  
	a.Id AS PopupId, a.PopUp_Type as PopUpType into #Count               
	FROM Tbl_PopupAdmin a               
	LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId AND a.Popup_Type = 'Individual')              
	LEFT JOIN #AllUser d on (a.id = d.id  AND a.Popup_Type = 'All' )       
	--LEFT JOIN (            
	--select distinct access_code from [196.1.115.132].rolemgm.dbo.user_login UL             
	--where status=1 and login_inactive_date>getdate() and access_to='SB' and usertype='ADMIN' and username is not NULL             
	--AND  access_code is not NULL AND access_code <> ''            
	--) d on (a.Popup_Type = 'All')                    
	--LEFT JOIN PopUpLog c on (a.id= c.PopupId AND ((a.Popup_Type = 'ALL' AND c.SbTag  = d.access_code) OR (a.Popup_Type = 'Individual' AND c.SbTag  = b.SbTag)))--AND d.access_code = c.SbTag            
	where  a.Project_Type = 'NXT'       
	--AND a.Active = 'Y'       
	AND CONVERT(DATE,a.[CreatedDate])>DATEADD(DD,-30,GETDATE())                
	--AND ( (a.Popup_Type = 'Individual' AND b.SbTag = c.SbTag) OR (a.Popup_Type = 'Individual' AND d.access_code = c.SbTag))   
	GROUP BY a.Id, a.Popup_Type  
                   
	select * INTO #fINAL from                 
	(                
	SELECT ROW_NUMBER() over (partition by a.Id, a.PopUp_Type order by b.SbTag) RN,                
	b.SbTag,      
	a.Id AS PopupId,      
	a.[Index] AS OrderIndex,      
	a.ImageName,       
	a.ImagePath,            
	a.PopUp_Type as PopUpType              
	,a.Redirect_Url,      
	a.ExpiryDate      
	,a.Project_Type                 
	,a.[Createdby]                
	,a.[CreatedDate],      
	a.CampaignId,      
	a.Active,  
    a.StartDate,
	a.StartTime,
	a.ExpiryTime
	FROM Tbl_PopupAdmin  a               
	LEFT JOIN Tbl_PopupSbTagMap b on ( a.id = b.PopupId AND a.Popup_Type = 'Individual')              
	--LEFT JOIN PopUpLog c on (a.id = c.PopupId)               
	where a.Project_Type = 'NXT'       
	--AND a.Active = 'Y'       
	AND CONVERT(DATE,a.[CreatedDate]) > DATEADD(DD,-30,GETDATE())) T               
                   
	SELECT                
	CASE WHEN A.PopUpType  ='All' then 'CBHO' ELSe A.SbTag END sub_broker,      
	A.PopupId,      
	A.OrderIndex,      
	A.ImageName,      
	A.ImagePath      
	,A.PopUpType                
	,Redirect_Url,      
	A.ExpiryDate     
	,Project_Type Project_Type                
	,A.[CreatedBy]                
	,A.[CreatedDate]                
	,B.cnt CNT,      
	A.CampaignId,      
	A.Active,
	A.StartDate,
	A.StartTime,
	A.ExpiryTime
	FROM #fINAL A                 
	LEFT JOIN #Count B on A.PopupId= B.PopupId                
	AND A.PopUpType = B.PopUpType              
	WHERE RN = 1               
	order by CreatedDate desc                
                
	DROP TABLE #fINAL                
	DROP TABLE #Count            
	DROP TABLE #AllUser            
                   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetRightIssuesInHouseSB
-- --------------------------------------------------

Create proc [dbo].[usp_GetRightIssuesInHouseSB]
as 
begin
	select subbroker,EntryBy,EntryDate from RightIssues_InHouse_SB_Master with (noLock)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetSbNocClientRights
-- --------------------------------------------------

CREATE proc [dbo].[usp_GetSbNocClientRights]
as
begin
select FromSubBroker,ToSubBroker from SB_NOC_Rights
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetSbNocRights
-- --------------------------------------------------

CREATE proc [dbo].[usp_GetSbNocRights]
as
begin
select Id,FromSubBroker,ToSubBroker,EntryBy,EntryDate from SB_NOC_Rights
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetSBTeleBoat
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetSBTeleBoat]  
AS          
BEGIN         

   SELECT Id,         
   SBTag        
  ,DATag     
  ,APIKey
  ,IsActive
   FROM  dbo.SB_TeleBot_Reg WITH (NOLOCK)     

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetSBTeleBotLink
-- --------------------------------------------------
CREATE PROCEDURE usp_GetSBTeleBotLink  
(  
	@SBTag VARCHAR(50)  
)  
AS  
BEGIN  
 SELECT DATag + '_z_' + APIKey AS Param  
 FROM SB_TeleBot_Reg WHERE SBTag = @SBTag  
	and IsActive = 1
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetSIPDate
-- --------------------------------------------------
CREATE PROCEDURE usp_GetSIPDate(    
 @StartDate DATETIME,  
 @SchemeType VARCHAR(50) = null,
 @FrequencyDays INT = 7
)    
AS    
    
DECLARE @Count INT = @FrequencyDays;    
DECLARE @cnt INT = 0;    
DECLARE @normalcount INT = 0;    
    
select @SchemeType = CASE WHEN @Schemetype IN ('equity', 'elss', 'fof', 'hybrid (c)', 'hybrid (nc)', 'mip', 'gilt', 'bond') THEN 'equity'  
    WHEN @SchemeType IN ('debt') THEN 'debt'  
    WHEN @schemeType IN ('liquid') THEN 'liquid'  
    ELSE @schemeType  
    END;  
  
WHILE @cnt < @Count    
BEGIN    
 Select @StartDate = DATEADD(day, 1, @StartDate);    
 IF((DATENAME(dw, @StartDate) != 'Sunday') AND (DATENAME(dw, @StartDate) != 'Saturday'))    
 BEGIN    
  SELECT @normalcount = COUNT(*) FROM BankHolidays WITH(NOLOCK)   
  WHERE HolidayDate = @StartDate   
  AND Status = 'A'  
  AND (CASE WHEN @SchemeType = 'equity' THEN Equity WHEN @SchemeType = 'debt' THEN Debt WHEN @SchemeType = 'liquid' THEN Liquid ELSE 'Y' END) = 'Y';    
  IF(@normalcount<1)    
  BEGIN    
   --IF((DATENAME(dw, @StartDate) != 'Saturday') OR (datepart(wk, @StartDate) % 2)!=0)    
   --BEGIN    
        
    SET @cnt += 1;    
   --END    
   --ELSE    
   --BEGIN    
   -- Select @StartDate = DATEADD(day, 1, @StartDate);    
   --END    
  END    
  --ELSE    
  --BEGIN    
  -- Select @StartDate = DATEADD(day, 1, @StartDate);    
  --END      
 END    
 --ELSE    
 --BEGIN    
 -- Select @StartDate = DATEADD(day, 1, @StartDate);    
 --END    
END    
SELECT @StartDate;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETSMSSENTDETAILS
-- --------------------------------------------------

		 
		 
			CREATE PROCEDURE [dbo].[USP_GETSMSSENTDETAILS] --'P94439636854953686012235'  
			 @MANDATEMAPPINGREFNO NVARCHAR(50)  
			AS  
			BEGIN  
			   
			 SET NOCOUNT ON;  
			  
			 SELECT TOP 1
			   *	 
			 FROM EMANDATESMSLINKLOG WITH (NOLOCK) WHERE MANDATEMAPPINGREFNO = @MANDATEMAPPINGREFNO  
			END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetSubBrokerMobForceUpdate
-- --------------------------------------------------

CREATE proc [dbo].[usp_GetSubBrokerMobForceUpdate]  
as   
begin  
 select id,
		sub_broker 
		,VersionCode  
		,Plateform  
		,CurrentVersion  
		,IsForceUpdate  
		,ForceUpdate  
		,CreatedDate from ForceUpdate_NXT_Mob  
		order by CreatedDate desc
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetUtilityMenuBasedOnId
-- --------------------------------------------------
CREATE PROCEDURE usp_GetUtilityMenuBasedOnId         
(          
 @MenuId  int  
)          
AS          
BEGIN      
 Select ID, Name, Controller, [Action], IsAccessRequired, ParentId, CreatedBy, CreatedDate, Active  
 FROM Menu  
 WHERE ID = @MenuId  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_GetWeeklyLoginCount
-- --------------------------------------------------
--EXEC Usp_GetWeeklyLoginCount '2021-07-26 00:00:00.000','2021-08-01 00:00:00.000'	
CREATE Procedure Usp_GetWeeklyLoginCount
@StartDate Datetime,
@LastDate Datetime
As
Begin
select count(Access_code) totalcount,convert(date,Last_login) last_login from NXT_HistoryUserLogin with(nolock)
where convert(date,Last_login) between convert(date,@StartDate) and convert(date,@LastDate)
group by convert(date,Last_login)
order by convert(date,Last_login) asc

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetYoutubeUpload
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_GetYoutubeUpload]
(
	@CardTypeKey VARCHAR(200) = NULL
)	
AS
BEGIN
	SELECT DU.Id, DU.MasterId, DUM.CardType, DUM.CardTypeKey, DU.FileName, DU.FilePath, DU.IsActive, DU.CreationDate, DU.LastUpdate, DU.CreatedBy
	FROM DocumentUploadYoutube DU
	INNER JOIN DocumentUploadMaster DUM
		ON DU.MasterId = DUM.Id
	 WHERE DUM.ContentType = 'Video' AND DUM.CardTypeKey = ISNULL(@CardTypeKey, DUM.CardTypeKey)
	ORDER BY DUM.CardType, DU.CreationDate DESC
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetYoutubeUploadById
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_GetYoutubeUploadById]
(
	@Id INT
)	
AS
BEGIN
	SELECT DU.Id, DUM.ContentType, DU.MasterId, DUM.CardType, DUM.CardTypeKey, DU.FileName, DU.FilePath, DU.CreationDate, DU.LastUpdate, DU.CreatedBy
	FROM DocumentUploadYoutube DU
	INNER JOIN DocumentUploadMaster DUM
		ON DU.MasterId = DUM.Id 
	WHERE DU.Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INS_ComplianceLog
-- --------------------------------------------------
/*
created by :- Yasmin khan
*/

CREATE PROCEDURE USP_INS_ComplianceLog
(
	@SBTag VARCHAR(100),
	@DocumentId BIGINT,
	@StartTime DATETIME,
	@CreatedBy VARCHAR(1000)
)
AS
BEGIN
	INSERT INTO Downloads_ComplianceLog (SBTag, DocumentId, StartTime, IsCompleted, CreatedBy)
	SELECT @SBTag, @DocumentId, @StartTime, 0, @CreatedBy
	
	SELECT SCOPE_IDENTITY() AS LogId
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INS_InsertITradeSMSLog
-- --------------------------------------------------
CREATE PROCEDURE USP_INS_InsertITradeSMSLog
(
	@Mobile VARCHAR(15),
	@Content VARCHAR(MAX),
	@Status VARCHAR(100)
)
AS
BEGIN
	insert into ItradeSMS_log (to_no, message, date, time, flag, ampm, status)
	values(@Mobile,@Content,format(GETDATE(),'dd/MM/yyyy'),format(GETDATE(),'hh:mm'),'A',FORMAT(GETDATE(),'tt'), @Status)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_INS_PreTradeNotification
-- --------------------------------------------------
CREATE PROCEDURE usp_INS_PreTradeNotification  
(  
 @SubBroker VARCHAR(50),  
 @NotificationText VARCHAR(MAX)  
)  
AS  
BEGIN  
 INSERT INTO tbl_NotificationNXT (SUB_BROKER, NOTIFICATIONTEXT, NOTIFICATIONTYPE, INDIVIDUALVIEW, CREATEDDATE, CREATEDBY, URL, area, controller, action, QueryParameter)  
 SELECT @SubBroker, @NotificationText, 'Individual', 'Y', GETDATE(), 'PreTradeAPI', 'NXT', '', 'Utilities', 'RecordingUpload', 'ActiveTab=ViewPendingRecords'  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_INS_SB_TrainingLinksLog
-- --------------------------------------------------
CREATE PROCEDURE usp_INS_SB_TrainingLinksLog
(
	@SBTrainingLinkId BIGINT,
	@ClickedBy VARCHAR(50)
)
AS
BEGIN
	INSERT INTO SB_TrainingLinks_Log(SBTraniningLinkId,SBName,VisitDate)
	SELECT @SBTrainingLinkId, @ClickedBy, GETDATE()
	
	UPDATE SB_TrainingLinks
	SET IsVisited = 1
	WHERE Id = @SBTrainingLinkId
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_INSERT_BulkIPO_GroupClients
-- --------------------------------------------------
CREATE PROCEDURE usp_INSERT_BulkIPO_GroupClients
(
	@SBTag VARCHAR(100),
	@GroupName VARCHAR(1000),
	@UpdatedBy VARCHAR(500),
	@datatable IPOGroupClients Readonly
)
AS
BEGIN
	DECLARE @GroupId BIGINT
	SELECT @GroupId = Id FROM BulkIPO_ClientGroup WHERE Name = @GroupName AND SBTag = @SBTag
	
	IF @GroupId IS NULL
	BEGIN
		INSERT INTO BulkIPO_ClientGroup(SBTag, Name, CreatedBy)
		SELECT @SBTag, @GroupName, @UpdatedBy
		SET @GroupId = SCOPE_IDENTITY()
	END
	ELSE
	BEGIN
		UPDATE BulkIPO_ClientGroup
		SET UpdatedBy = @UpdatedBy,
			LastUpdate = GETDATE()
		WHERE Id = @GroupId
	END
	
	INSERT INTO BulkIPO_ClientGroup_Clients (GroupId, PartyCode, SelectedUPIId)
	SELECT @GroupId, PartyCode, UPI
	FROM @datatable
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_INSERT_BulkIPO_GroupClients_UAT
-- --------------------------------------------------

CREATE PROCEDURE usp_INSERT_BulkIPO_GroupClients_UAT
(
	@SBTag VARCHAR(100),
	@GroupName VARCHAR(1000),
	@UpdatedBy VARCHAR(500),
	@datatable IPOGroupClients_UAT Readonly
)
AS
BEGIN
	DECLARE @GroupId BIGINT
	SELECT @GroupId = Id FROM BulkIPO_ClientGroup WHERE Name = @GroupName AND SBTag = @SBTag
	
	IF @GroupId IS NULL
	BEGIN
		INSERT INTO BulkIPO_ClientGroup(SBTag, Name, CreatedBy)
		SELECT @SBTag, @GroupName, @UpdatedBy
		SET @GroupId = SCOPE_IDENTITY()
	END
	ELSE
	BEGIN
		UPDATE BulkIPO_ClientGroup
		SET UpdatedBy = @UpdatedBy,
			LastUpdate = GETDATE()
		WHERE Id = @GroupId
	END
	
	INSERT INTO BulkIPO_ClientGroup_Clients (GroupId, PartyCode, SelectedUPIId,SelectedDPId)
	SELECT @GroupId, PartyCode, UPI,DP
	FROM @datatable
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_INSERT_ContentDownloadLogs
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_INSERT_ContentDownloadLogs]
(
	@SBTag NVARCHAR(10),
	@userName NVARCHAR(50),
	@ContentType NVARCHAR(50),
	@ContentName NVARCHAR(50)
)
AS
BEGIN
	
		INSERT INTO SmartMarketingLogs(SB, UserName, DateAndTime,ContentType,ContentName) Values (@SBTag,@userName,getdate(),@ContentType,@ContentName)
		
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Insert_FamilyTradeDetails
-- --------------------------------------------------


-----------------------------------------------------


CREATE PROCEDURE [dbo].[USP_Insert_FamilyTradeDetails]
(
 --@FamilyTradeId int
@FamilyTradeName varchar(50)
,@CreatedBy VARCHAR (30)
--,@UpdatedBy VARCHAR (30)
--,@DeletedBy VARCHAR (30)
)

AS

BEgin

INSERT INTO FamilyTradeDetails
(
FamilyTradeName
,CreatedBy
,CreatedDate
--,UpdatedBy
,UpdatedDate
--,DeletedBy
,familycode
)
VaLUES (@FamilyTradeName,@CreatedBy,GETDATE(),GETDATE(),NEWID())

select @@IDENTITY


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INSERT_FamilyTradeTransactions
-- --------------------------------------------------

/*
Modification

- modified by neeta on 02/08/2018 - Added new column and parameter for Authorised 

*/

CREATE PROCEDURE [dbo].[USP_INSERT_FamilyTradeTransactions]
(
@FamilyTradeId int
,@ClientId varchar(30)
,@MembershipType varchar(30)--(Primary/Secondayr)
,@Relation varchar(30)--(wife,husband,son,daughter,father,mother)
,@CreatedBy VARCHAr (30)
,@Authorised VARCHAR(4)
)

AS

BEgin

INSERT INTO FamilyTradeTransactions
(FamilyTradeId
,ClientId
,MembershipType
,Relation
,CreatedBy
,CreatedDate
,Authorised)

Values (
 @FamilyTradeId
,@ClientId
,@MembershipType
,@Relation
,@CreatedBy
,GETDATE()
,@Authorised)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_InsertAndVerify_PIN_NXT2_MOBILE
-- --------------------------------------------------
--EXEC [Usp_InsertAndVerify_PIN_NXT2_MOBILE] 'DDPMA','1234','I'
--EXEC Usp_InsertAndVerify_PIN_NXT2_MOBILE 'DDPMA','1234','V'

CREATE PROCEDURE [dbo].[Usp_InsertAndVerify_PIN_NXT2_MOBILE]
(
@sbTag varchar(20),
@pin	varchar(4),
@flag	VARCHAR(1)
)
AS
BEGIN
	DECLARE	@RetMessage varchar(50), @ID BIGINT, @STATUS VARCHAR(20),@PIN1 VARCHAR(4)
	
	
IF (@FLAG='I')
BEGIN
IF NOT EXISTS (SELECT SBTag from Tbl_FourDigitPIN_NXT2_Mobile where SBTag=@SBTag)
	BEGIN
					IF (LEN(@PIN)=4)
						BEGIN
							INSERT INTO Tbl_FourDigitPIN_NXT2_Mobile (SBTag,PIN,CreatedDate)
							VALUES(@SBTag,@PIN,GETDATE())
							SET @RetMessage='PIN Inserted Successfully'
							SET @STATUS= 'Success'
							SELECT  @RetMessage message,@STATUS status, @PIN pin, @SBTag sbTag 
						END
					ELSE
						BEGIN
							SET @RetMessage='PIN Should be of Four Digits'
							SET @STATUS= 'Failed'
							SELECT @retMessage message, @STATUS status
						END
	END
ELSE
	BEGIN
					SET @RetMessage='SBtag Exists'
					SET @STATUS = 'Failed' 
					SELECT  @retMessage message, @status status
	END
	
END


ELSE IF(@FLAG='V')
BEGIN

		IF (LEN(@PIN)=4)
			BEGIN
					IF EXISTS (SELECT SBTag FROM Tbl_FourDigitPIN_NXT2_Mobile WITH(NOLOCK) WHERE SBTag=@SBTag )
					BEGIN
							SELECT TOP 1 @PIN1= ISNULL(PIN,'') FROM Tbl_FourDigitPIN_NXT2_Mobile WITH(NOLOCK) WHERE SBTag=@SBTag ORDER BY CreatedDate DESC
							PRINT @PIN1 
							IF (@PIN1=@PIN)
								BEGIN
								SET @RetMessage='PIN Matched'
								SET @STATUS= 'Success'
								SELECT @RetMessage message, @STATUS status,@PIN pin , @SBTag sbTag FROM Tbl_FourDigitPIN_NXT2_Mobile WITH(NOLOCK) WHERE SBTag=@SBTag ORDER BY CreatedDate DESC
								END
							ELSE
								BEGIN
								SET @RetMessage='PIN MisMatched'
								SET @STATUS= 'Failed'
								SELECT @RetMessage message, @STATUS status
								END
					END
					ELSE
					BEGIN
								SET @RetMessage = 'SBTag Does Not Exist'
								SET @STATUS = 'Failed'
								SELECT @RetMessage message, @STATUS status
					END
			END
		ELSE
			BEGIN
					SET @RetMessage='PIN Should be of Four Digits'
					SET @STATUS= 'Failed'
					SELECT @RetMessage message, @STATUS status
			END
END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_InsertNotifyScratchedCouponLogs
-- --------------------------------------------------
   
    
       
  CREATE PROCEDURE [dbo].[usp_InsertNotifyScratchedCouponLogs]   
   (            
       @SBCode   VARCHAR(50)  
      ,@OfferId   INT  
      ,@URL    VARCHAR(500)  
      ,@RequestBody  VARCHAR(MAX)  
      ,@ResponseBody VARCHAR(MAX)  
      ,@RequestTime  DATETIME  
      ,@ResponseTime DATETIME  
   )            
   AS            
   BEGIN  
         
      
    INSERT INTO [dbo].[OffersSubBrokerRewardsLogs]  
    VALUES (@SBCode,@OfferId,@URL,@RequestBody,@ResponseBody,@RequestTime,@ResponseTime,GETDATE())  
      
           
   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_AdvisoryRepositoryCalls
-- --------------------------------------------------
/**************************************************************/
/*
	DATE:			10/27/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure returns detailed list of Advisory Calls
					based on provided ScriptCD and Start EntryDate and 
					End EntryDate.

	EXEC dbo.usp_IPartner_Advisory_AdvisoryRepositoryCalls

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_AdvisoryRepositoryCalls]
	@RowsToSkip INT = 0
	,@NoOfRows INT = 500
	,@ScriptCD VARCHAR(40) = NULL
	,@StartEntryDate DATETIME = NULL
	,@EndEntryDate DATETIME = NULL
	,@Category VARCHAR(100) = NULL
AS
BEGIN

	SET NOCOUNT ON

	SET @ScriptCD = CASE WHEN @ScriptCD = '' THEN '%' ELSE ISNULL(@ScriptCD, '%') END
	SET @StartEntryDate = ISNULL(@StartEntryDate, '1/1/1900')
	SET @EndEntryDate = ISNULL(@EndEntryDate, '12/31/9999')
	SET @Category = CASE WHEN @Category = '' THEN '%' ELSE ISNULL(@Category, '%') END

	;WITH AdvisoryRepoCalls AS
	(
	SELECT 
		category
		,script_cd
		,entrydate
		,exchange
		,expirydate
		--,CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, ' with Stop loss of ', stoploss, ' and target of ', targetprice) AS DisplayText
	--	,CASE 
	--		WHEN exchange IN ('FO', 'COMMODITY', 'CURRENCY') THEN CONCAT(strategy, ' ', script_cd, CASE WHEN StrikePrice>0 THEN CONCAT(' ', StrikePrice) ELSE '' END, ' ', CONVERT(CHAR(3), expirydate, 0), ' ', opttype, ' at ', recommendedprice, CASE WHEN stoploss>0
 --THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice)
	--		ELSE CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, CASE WHEN stoploss>0 THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice) 
	--	 END AS DisplayText
		,subcategory
		,broadcastmsg DisplayText
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
	UNION ALL
	SELECT 
		category
		,script_cd
		,entrydate
		,exchange
		,expirydate
		--,CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, ' with Stop loss of ', stoploss, ' and target of ', targetprice) AS DisplayText 
		--,CASE 
		--	WHEN exchange IN ('FO', 'COMMODITY', 'CURRENCY') THEN CONCAT(strategy, ' ', script_cd, CASE WHEN StrikePrice>0 THEN CONCAT(' ', StrikePrice) ELSE '' END, ' ', CONVERT(CHAR(3), expirydate, 0), ' ', opttype, ' at ', recommendedprice, CASE WHEN stoploss>0
		--	THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice)
		--	ELSE CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, CASE WHEN stoploss>0 THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice) 
		-- END AS DisplayText
		,subcategory
		,broadcastmsg DisplayText
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_ClosedNotFundamental WITH(NOLOCK)
	UNION ALL
	SELECT 
		category
		,script_cd
		,entrydate
		,exchange
		,expirydate
		--,CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, ' with Stop loss of ', stoploss, ' and target of ', targetprice) AS DisplayText
		--,CASE 
		--	WHEN exchange IN ('FO', 'COMMODITY', 'CURRENCY') THEN CONCAT(strategy, ' ', script_cd, CASE WHEN StrikePrice>0 THEN CONCAT(' ', StrikePrice) ELSE '' END, ' ', CONVERT(CHAR(3), expirydate, 0), ' ', opttype, ' at ', recommendedprice, CASE WHEN stoploss>0
		--	THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice)
		--	ELSE CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, CASE WHEN stoploss>0 THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice) 
		-- END AS DisplayText
		,subcategory
		,broadcastmsg DisplayText
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_TwoYearFundamental WITH(NOLOCK)
	)
	SELECT DISTINCT
		*
	FROM 
		AdvisoryRepoCalls
	WHERE
		script_cd LIKE @ScriptCD
		AND CONVERT(DATE, entrydate) >= @StartEntryDate AND CONVERT(DATE, entrydate) <= @EndEntryDate
		AND category LIKE @Category
	ORDER BY
		entrydate DESC
	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_AdvisoryRepositoryCalls_Bkp18May2018
-- --------------------------------------------------




CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_AdvisoryRepositoryCalls_Bkp18May2018]
	@RowsToSkip INT = 0
	,@NoOfRows INT = 500
	,@ScriptCD VARCHAR(40) = NULL
	,@StartEntryDate DATETIME = NULL
	,@EndEntryDate DATETIME = NULL
	,@Category VARCHAR(100) = NULL
AS
BEGIN

	SET NOCOUNT ON

	SET @ScriptCD = CASE WHEN @ScriptCD = '' THEN '%' ELSE ISNULL(@ScriptCD, '%') END
	SET @StartEntryDate = ISNULL(@StartEntryDate, '1/1/1900')
	SET @EndEntryDate = ISNULL(@EndEntryDate, '12/31/9999')
	SET @Category = CASE WHEN @Category = '' THEN '%' ELSE ISNULL(@Category, '%') END

	;WITH AdvisoryRepoCalls AS
	(
	SELECT 
		category
		,script_cd
		,entrydate
		,exchange
		,expirydate
		,CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, ' with Stop loss of ', stoploss, ' and target of ', targetprice) AS DisplayText
		,subcategory
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
	UNION ALL
	SELECT 
		category
		,script_cd
		,entrydate
		,exchange
		,expirydate
		,CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, ' with Stop loss of ', stoploss, ' and target of ', targetprice) AS DisplayText 
		,subcategory
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_ClosedNotFundamental WITH(NOLOCK)
	UNION ALL
	SELECT 
		category
		,script_cd
		,entrydate
		,exchange
		,expirydate
		,CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, ' with Stop loss of ', stoploss, ' and target of ', targetprice) AS DisplayText
		,subcategory
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_TwoYearFundamental WITH(NOLOCK)
	)
	SELECT DISTINCT
		*
	FROM 
		AdvisoryRepoCalls
	WHERE
		script_cd LIKE @ScriptCD
		AND CONVERT(DATE, entrydate) >= @StartEntryDate AND CONVERT(DATE, entrydate) <= @EndEntryDate
		AND category LIKE @Category
	ORDER BY
		entrydate DESC
	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_AdvisoryRepositoryCategoryList
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_AdvisoryRepositoryCategoryList]
	@ScriptCD VARCHAR(40) = NULL
	,@StartEntryDate DATE = NULL
	,@EndEntryDate DATE = NULL
AS
BEGIN

	SET NOCOUNT ON

	SET @ScriptCD = CASE WHEN @ScriptCD = '' THEN '%' ELSE ISNULL(@ScriptCD, '%') END
	SET @StartEntryDate = ISNULL(@StartEntryDate, '1/1/1900')
	SET @EndEntryDate = ISNULL(@EndEntryDate, '12/31/9999')

	;WITH CategoryList AS
	(
		SELECT 
			category
			,script_cd
			,entrydate
		FROM 
			[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
		WHERE
			script_cd LIKE @ScriptCD
			AND CONVERT(DATE, entrydate) >= @StartEntryDate AND CONVERT(DATE, entrydate) <= @EndEntryDate
		UNION ALL
		SELECT 
			category
			,script_cd
			,entrydate
		FROM 
			[196.1.115.207].crm.dbo.VW_AngelAdvisory_ClosedNotFundamental WITH(NOLOCK)
		WHERE
			script_cd LIKE @ScriptCD
			AND CONVERT(DATE, entrydate) >= @StartEntryDate AND CONVERT(DATE, entrydate) <= @EndEntryDate
		UNION ALL
		SELECT 
			category
			,script_cd
			,entrydate
		FROM 
			[196.1.115.207].crm.dbo.VW_AngelAdvisory_TwoYearFundamental WITH(NOLOCK)
		WHERE
			script_cd LIKE @ScriptCD
			AND CONVERT(DATE, entrydate) >= @StartEntryDate AND CONVERT(DATE, entrydate) <= @EndEntryDate
	)
	SELECT DISTINCT * INTO #CategoryList FROM CategoryList

	SELECT 
		category 
		,COUNT(*) AS Ct
	FROM 
		#CategoryList
	GROUP BY
		category
	
	IF OBJECT_ID('tempdb..#CategoryList') IS NOT NULL
		DROP TABLE #CategoryList

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_CategoryList
-- --------------------------------------------------
/**************************************************************/
/*
	DATE:			11/23/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure returns list of Category for Advisory Calls

	EXEC dbo.usp_IPartner_Advisory_CategoryList

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_CategoryList]
AS
BEGIN

	SET NOCOUNT ON

	;WITH CategoryList AS
	(
		SELECT 
			category
		FROM 
			[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
		UNION ALL
		SELECT 
			category
		FROM 
			[196.1.115.207].crm.dbo.VW_AngelAdvisory_ClosedNotFundamental WITH(NOLOCK)
		UNION ALL
		SELECT 
			category
		FROM 
			[196.1.115.207].crm.dbo.VW_AngelAdvisory_TwoYearFundamental WITH(NOLOCK)
	)
	SELECT DISTINCT Category FROM CategoryList ORDER BY 1

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_GetAGMEGM_bkup20180416
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/02/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gives a list of AGM / EGM from multiple sources.

	EXEC dbo.usp_IPartner_Advisory_GetAGMEGM
	EXEC dbo.usp_IPartner_Advisory_GetAGMEGM 0, 10
	EXEC dbo.usp_IPartner_Advisory_GetAGMEGM -1, -10

*/	
/**************************************************************/

CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_GetAGMEGM_bkup20180416]
	@RowsToSkip INT = NULL
	,@NoOfRows INT = NULL
AS
BEGIN
	SET NOCOUNT ON

	DECLARE @DateYesterday DATE = CONVERT(DATE, DATEADD(DAY, -1, GETDATE()))

	SET @RowsToSkip = CASE WHEN @RowsToSkip < 0 THEN 0 WHEN @RowsToSkip IS NULL THEN 0 ELSE @RowsToSkip END
	SET @NoOfRows = CASE WHEN @NoOfRows < 0 THEN 2147483647 WHEN @NoOfRows IS NULL THEN 2147483647 ELSE @NoOfRows END

	SELECT co_code, co_name, markname, MeetingDate
	FROM
	(
		SELECT
			FA.co_code
			,VST.co_name
			,FA.markname
			,CONVERT(DATE, FA.agm_date) AS MeetingDate
		FROM 
			[172.31.16.75].[FSS_EQUITY].[dbo].feed_agm FA WITH(NOLOCK)
			LEFT JOIN [172.31.16.75].[FSS_EQUITY].[dbo].vw_stock_mst VST WITH(NOLOCK) ON FA.co_code = VST.co_code
		WHERE
			CONVERT(DATE, agm_date) > = @DateYesterday
		UNION ALL
		SELECT
			FE.co_code
			,VST.co_name
			,FE.markname
			,CONVERT(DATE, FE.egm_date) AS MeetingDate
		FROM 
			[172.31.16.75].[FSS_EQUITY].[dbo].feed_egm FE WITH(NOLOCK)
			LEFT JOIN [172.31.16.75].[FSS_EQUITY].[dbo].vw_stock_mst VST WITH(NOLOCK) ON FE.co_code = VST.co_code
		WHERE
			CONVERT(DATE, egm_date) > = @DateYesterday
	) Meeting
	ORDER BY
		MeetingDate
	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_OpenCalls
-- --------------------------------------------------






/**************************************************************/
/*
	DATE:			10/24/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	Gives a list of Open Calls based on provided
					SubCategory list.

	EXEC dbo.usp_IPartner_Advisory_OpenCalls 'Technical,Fundamental'
*/	
/**************************************************************/

CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_OpenCalls]
	@SubCategoryList VARCHAR(500) = NULL
AS
BEGIN

	SET NOCOUNT ON
	SET FMTONLY OFF
	
	DECLARE @SubCategory TABLE (Data VARCHAR(500))
	INSERT INTO @SubCategory VALUES(@SubCategoryList)

	SELECT 
		Split.Data.value('.', 'VARCHAR(100)') AS SubCategory 
	INTO #SubCategory
	FROM
	(
		SELECT CAST('<V>' + REPLACE([Data], ',', '</V><V>') + '</V>' AS XML) AS String FROM @SubCategory
	) AS A 
	CROSS APPLY String.nodes('/V') AS Split(Data)

	SELECT
		publishid
		,UPPER(script_cd) AS script_cd
		,category
		,entrydate
		,expirydate
		,CASE 
			WHEN exchange IN ('FO', 'COMMODITY', 'CURRENCY') THEN CONCAT(strategy, ' ', script_cd, CASE WHEN StrikePrice>0 THEN CONCAT(' ', StrikePrice) ELSE '' END, ' ', CONVERT(CHAR(3), expirydate, 0), ' ', opttype, ' at ', recommendedprice, CASE WHEN stoploss>0 THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice)
			ELSE CONCAT(strategy, ' ', script_cd, ' at ', recommendedprice, CASE WHEN stoploss>0 THEN CONCAT(' with Stop loss of ', stoploss) ELSE '' END, ' and target of ', targetprice) 
		 END AS DisplayText
		,StrikePrice
		,subcategory
		,exchange AS Segment
		,broadcastmsg
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
	WHERE
		1 = CASE 
				WHEN @SubCategoryList IS NULL OR @SubCategoryList = '' THEN 1 
				WHEN subcategory IN (SELECT SubCategory FROM #SubCategory) THEN 1 
			END
	ORDER BY
		entrydate DESC

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_OpenCalls_TeleSales
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_OpenCalls_TeleSales]
AS 
BEGIN
SELECT script_cd,strategy,exchange,category,recommendedprice,targetprice,stoploss,remark,subcategory,calltype,StrikePrice,OPTType,InstType
FROM  [196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK) 
WHERE calltype='Open'
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_OpenCallsCount
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			11/13/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gives counts of Open Calls by 
					SubCategory

	EXEC dbo.usp_IPartner_Advisory_OpenCallsCount
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_OpenCallsCount]
AS
BEGIN

	SET NOCOUNT ON
	
	SELECT 
		subcategory
		,COUNT(*) AS NoOfCalls
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
	WHERE
		subcategory NOT IN ('Currency', 'Commodity')
	GROUP BY 
		subcategory
	UNION ALL
	SELECT 
		 'Currency' AS subcategory
		,COUNT(*) AS NoOfCalls 
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls WITH(NOLOCK)
	WHERE
		subcategory IN ('Currency', 'Commodity')
	HAVING
		COUNT(*) > 0

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Advisory_PerformanceCompanyAutoSuggest
-- --------------------------------------------------
/**************************************************************/
/*
	DATE:			11/23/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Advisory_PerformanceCompanyAutoSuggest 'r', 'c', '0', 1

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Advisory_PerformanceCompanyAutoSuggest]
(
	@p_keyword VARCHAR(1000),
	@p_type VARCHAR(1000),
	@p_searchtype VARCHAR(1),
	@p_topten int = 1
)
AS
BEGIN
	SET NOCOUNT ON
	
	IF(@p_topten = 1)
		BEGIN
			IF(LOWER(@p_type) = 'i')
				BEGIN
						--SELECT TOP 10 co_code, co_name, sc_name
						SELECT TOP 10 lname, cm_symbol
						FROM [196.1.115.207].Angelcs.DBO.AngelAdvisoryScrips WITH(NOLOCK)
						WHERE aliasmemo LIKE '%'+@p_keyword+'%' AND (hse_code='idx' AND sect_name!='etf') AND  feed_flag = @p_searchtype
						ORDER BY CASE WHEN co_name like @p_keyword+'%' THEN ' ' + co_name ELSE co_name END
				END
			ELSE IF(LOWER(@p_type) = 'c')
				BEGIN
						SELECT TOP 10 lname, cm_symbol
						FROM [196.1.115.207].Angelcs.DBO.AngelAdvisoryScrips WITH(NOLOCK)
						WHERE aliasmemo LIKE '%'+@p_keyword+'%' AND (hse_code!='idx' OR sect_name='etf') AND  feed_flag = @p_searchtype
						ORDER BY CASE WHEN co_name like @p_keyword+'%' THEN ' ' + co_name ELSE co_name END
				END
			ELSE
				BEGIN
						SELECT TOP 10 lname, cm_symbol
						FROM [196.1.115.207].Angelcs.DBO.AngelAdvisoryScrips WITH(NOLOCK)
						WHERE aliasmemo LIKE '%'+@p_keyword+'%' AND  feed_flag = @p_searchtype
						ORDER BY CASE WHEN co_name like @p_keyword+'%' THEN ' ' + co_name ELSE co_name END
				END
		END
	ELSE
		BEGIN
			IF(LOWER(@p_type) = 'i')
				BEGIN
						SELECT lname, cm_symbol
						FROM [196.1.115.207].Angelcs.DBO.AngelAdvisoryScrips WITH(NOLOCK)
						WHERE aliasmemo LIKE '%'+@p_keyword+'%' AND (hse_code='idx' AND sect_name!='etf') AND  feed_flag = @p_searchtype
						ORDER BY CASE WHEN co_name like @p_keyword+'%' THEN ' ' + co_name ELSE co_name END
				END
			ELSE IF(LOWER(@p_type) = 'c')
				BEGIN
						SELECT lname, cm_symbol
						FROM [196.1.115.207].Angelcs.DBO.AngelAdvisoryScrips WITH(NOLOCK)
						WHERE aliasmemo LIKE '%'+@p_keyword+'%' AND (hse_code!='idx' OR sect_name='etf') AND  feed_flag = @p_searchtype
						ORDER BY CASE WHEN co_name like @p_keyword+'%' THEN ' ' + co_name ELSE co_name END
				END
			ELSE
				BEGIN
						SELECT lname, cm_symbol
						FROM [196.1.115.207].Angelcs.DBO.AngelAdvisoryScrips WITH(NOLOCK)
						WHERE aliasmemo LIKE '%'+@p_keyword+'%' AND  feed_flag = @p_searchtype
						ORDER BY CASE WHEN co_name like @p_keyword+'%' THEN ' ' + co_name ELSE co_name END
				END
		END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_ClientViewSubbroker_ARNDetails
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================

--EXEC usp_IPartner_ClientViewSubbroker_ARNDetails 'ET'
CREATE PROCEDURE [dbo].[usp_IPartner_ClientViewSubbroker_ARNDetails]
	-- Add the parameters for the stored procedure here
	@sb_tag varchar(100)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select * from [196.1.115.253].mutualfund.dbo.tblArnEuinMaster where [SB EQUITY TAG]=@sb_tag
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard__GetCrossSellInfo
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			01/11/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Dashboard__GetCrossSellInfo 'GDS', 'A100940', '12/22/2017'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard__GetCrossSellInfo]
	@SubBroker VARCHAR(10)
	,@PartyCode VARCHAR(10)
	,@RecommSendOn DATE
AS
BEGIN

	SET NOCOUNT ON

	CREATE TABLE #Recommendations
	(
		Party_code VARCHAR(30)
		,Sub_Broker VARCHAR(10)
		,Header VARCHAR(100)
		,SchemeName VARCHAR(500)
		,RecommendationSendOn DATETIME
	)

	INSERT INTO #Recommendations
	EXEC [196.1.115.207].crm.[dbo].[Usp_CRMS_MF_ARQ_Recommendations_For_iPartner] @SubBroker

	SELECT DISTINCT 
		Header
		,SchemeName
		,CONVERT(DATE, RecommendationSendOn) AS RecommendationSendOn
	FROM 
		#Recommendations 
	WHERE 
		Party_Code = @PartyCode
		AND CONVERT(DATE, RecommendationSendOn) = @RecommSendOn

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_GetCrossSellInfo
-- --------------------------------------------------




/**************************************************************/
/*
	DATE:			01/11/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Dashboard_GetCrossSellInfo 'ET', 'P77264', '2/8/2018'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard_GetCrossSellInfo]
	@SubBroker VARCHAR(10)
	,@PartyCode VARCHAR(10)
	,@RecommSendOn VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON

	SELECT DISTINCT 
		AR.Header
		,AR.SchemeName
		,AR.ISIN
		,CONVERT(DATE, AR.RecommendationSendOn) AS RecommendationSendOn
		,MF.[1yrReturn]
		,MF.[3yrReturn]
		,MF.[5yrReturn]
		,Score = ISNULL(MFS.ARQ_mScore,0)
	FROM 
		tbl_CRMS_MF_ARQ_Recommendations AR WITH(NOLOCK)
		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.arq_mfssRecommendedScheme MF WITH(NOLOCK) ON AR.ISIN = MF.GrowthISIN
		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.ARQ_ISIN_MFscore MFS WITH(NOLOCK) ON AR.Isin = MFS.ARQ_tISIN
	WHERE
		Party_Code = @PartyCode
		AND Sub_Broker = @SubBroker
		--AND CONVERT(DATE, RecommendationSendOn) = TRY_CONVERT(DATE, @RecommSendOn)
		AND RecommendationSendOn BETWEEN TRY_CONVERT(DATETIME, @RecommSendOn + ' 00:00:00.000') AND TRY_CONVERT(DATETIME, @RecommSendOn + ' 23:59:59.997')
		AND MF.Flag = 'A'
		AND MFS.ARQ_tflag='A'

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_IPOList
-- --------------------------------------------------
--sp_helptext usp_IPartner_Dashboard_IPOList

CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard_IPOList]  
  
AS  
  
BEGIN  
  
 SET NOCOUNT ON  
  
 SELECT  
  IPOName AS NameType  
  ,LowerValue AS LowerPrice  
  ,UpperValue AS HigherPrice  
  ,No_Of_Shares AS NoOfShares  
  ,IPOStartdate  
  ,IPOEnddate  
  ,Discount  
  ,Srno  
  ,IPO_Status   
  --,CAST(Case when dateadd(dd,-1,IPOStartdate) <= Getdate()  then 'Y' else 'N' END AS Varchar(10)) AS Show_Download
 FROM  
  --[196.1.115.132].risk.dbo.[VW_IPO_MasterTable] WITH(NOLOCK)  
  [196.1.115.132].[RISK].[IPO].[MASTERS] WITH(NOLOCK)  
 WHERE  
   IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, DATEADD(D, -30, GETDATE()))) + ' ' + '23:59:59.997'  
   --and convert(date,IPO_LiveDate) <= convert(date,Getdate())   
  
   --AND NOT(  
   -- IPO_Status ='0'  
   -- AND IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, GETDATE()))  
   -- AND IPOEnddate <= CONVERT(DATETIME, CONVERT(DATE, GETDATE())) + ' ' + '23:59:59.997'  
   -- )  
    and IPOName not like '%Test%'
 ORDER BY IPOStartdate --DESC  
  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_IPOList_08May2018
-- --------------------------------------------------
CREATE  PROCEDURE [dbo].[usp_IPartner_Dashboard_IPOList_08May2018]

AS

BEGIN

	SET NOCOUNT ON

	SELECT
		IPOName AS NameType
		,LowerValue AS LowerPrice
		,UpperValue AS HigherPrice
		,No_Of_Shares AS NoOfShares
		,IPOStartdate
		,IPOEnddate
		,Discount
		,Srno
	FROM
		--[196.1.115.132].risk.dbo.[VW_IPO_MasterTable] WITH(NOLOCK)
		[196.1.115.132].[RISK].[IPO].[MASTERS] WITH(NOLOCK)
	WHERE
		 IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, DATEADD(D, -30, GETDATE()))) + ' ' + '23:59:59.997'
		 and convert(date,IPO_LiveDate) <= convert(date,Getdate()) 

		 --AND NOT(
			--	IPO_Status ='0'
			--	AND IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, GETDATE()))
			--	AND IPOEnddate <= CONVERT(DATETIME, CONVERT(DATE, GETDATE())) + ' ' + '23:59:59.997'
			--	)
	ORDER BY IPOStartdate DESC


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_IPOList_Bkp07May2018
-- --------------------------------------------------





Create  PROCEDURE [dbo].[usp_IPartner_Dashboard_IPOList_Bkp07May2018]

AS

BEGIN

	SET NOCOUNT ON



	SELECT

		IPOName AS NameType

		,LowerValue AS LowerPrice

		,UpperValue AS HigherPrice

		,No_Of_Shares AS NoOfShares

		,IPOStartdate

		,IPOEnddate

		,Discount
		,Srno

	FROM 
		--[196.1.115.132].risk.dbo.[VW_IPO_MasterTable] WITH(NOLOCK)
		[196.1.115.132].[RISK].[IPO].[MASTERS] WITH(NOLOCK)
	WHERE
		 IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, DATEADD(D, -30, GETDATE()))) + ' ' + '23:59:59.997'
		 AND NOT(
				IPO_Status ='0'
				AND IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, GETDATE()))
				AND IPOEnddate <= CONVERT(DATETIME, CONVERT(DATE, GETDATE())) + ' ' + '23:59:59.997'
				)

	ORDER BY IPOStartdate DESC



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_IPOList_New
-- --------------------------------------------------
--sp_helptext usp_IPartner_Dashboard_IPOList

create PROCEDURE [dbo].[usp_IPartner_Dashboard_IPOList_New]  
  
AS  
  
BEGIN  
  
 SET NOCOUNT ON  
  
 SELECT  
  IPOName AS NameType  
  ,LowerValue AS LowerPrice  
  ,UpperValue AS HigherPrice  
  ,No_Of_Shares AS NoOfShares  
  ,IPOStartdate  
  ,IPOEnddate  
  ,Discount  
  ,Srno  
  ,IPO_Status   
  ,Case when dateadd(dd,-1,IPOStartdate) <= Getdate()  then 'Y' else 'N' END 'Show_Download '
 FROM  
  --[196.1.115.132].risk.dbo.[VW_IPO_MasterTable] WITH(NOLOCK)  
  [196.1.115.132].[RISK].[IPO].[MASTERS] WITH(NOLOCK)  
 WHERE  
   IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, DATEADD(D, -30, GETDATE()))) + ' ' + '23:59:59.997'  
   --and convert(date,IPO_LiveDate) <= convert(date,Getdate())   
  
   --AND NOT(  
   -- IPO_Status ='0'  
   -- AND IPOStartdate >= CONVERT(DATETIME, CONVERT(DATE, GETDATE()))  
   -- AND IPOEnddate <= CONVERT(DATETIME, CONVERT(DATE, GETDATE())) + ' ' + '23:59:59.997'  
   -- )  
    and IPOName not like '%Test%'
 ORDER BY IPOStartdate DESC  
  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_RiskBySubBroker_1
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.[usp_IPartner_Dashboard_RiskBySubBroker] 'ajyc'
	EXEC dbo.[usp_IPartner_Dashboard_RiskBySubBroker_New27July2018] 'ajyc'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker 'GDS'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker 'SAG'

	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_1 'AJYC', 1, null

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard_RiskBySubBroker_1]
	@SubBroker VARCHAR(10)
	,@PageNo INT = NULL
	,@PageSize INT = NULL
AS
BEGIN
	SET NOCOUNT ON

	SET @PageNo = ISNULL( CASE WHEN @PageNo <=0 THEN 1 ELSE @PageNo END, 1)
	SET @PageSize = ISNULL(CASE WHEN @PageSize <=0 THEN 10 ELSE @PageSize END, 2147483647)

	DECLARE	@RowsToSkip INT = (@PageNo-1) * @PageSize
	DECLARE	@NoOfRows INT = @PageSize

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + DATENAME(YEAR, GETDATE())
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))



	CREATE TABLE #PriorityCalls
	(
		party_code VARCHAR(10)
		,long_name VARCHAR(100)
		,Reason VARCHAR(200)
		,Risk MONEY
		,[Collection] MONEY
		,Shortage MONEY
		,squareoffvalue MONEY
		,square_off_type VARCHAR(100)
		,square_off_date VARCHAR(20)
	)

	/*********************************/
	--Risk view data
	/*********************************/

	INSERT INTO #PriorityCalls
	SELECT
		party_code
		,long_name
		,Reason
		,Net_Collection AS Risk
		,Net_Collection AS [Collection]
		--,NULLIF(ISNULL(Pure_Risk, 0) + ISNULL(shortage_value, 0), 0) AS Shortage
		,ISNULL(shortage_value, 0) AS Shortage
		,squareoffvalue
		,square_off_type
		,square_off_date
	FROM 
		vw_Dashboard_sbrisk_syn
	WHERE
		SUB_BROKER = @SubBroker AND Net_Collection < 0

	
	CREATE TABLE #PriorityClients_B2B
	(
		Party_Code VARCHAR(20)
		,Party_Name VARCHAR(100)
		,CallType VARCHAR(200)
		,CallSubType VARCHAR(200)
		,CallValue VARCHAR(2000)
		,[Description] VARCHAR(2500)
	)

	INSERT INTO #PriorityClients_B2B
	EXEC [196.1.115.207].crm.dbo.usp_CRMS_Dashboard_PriorityClients_B2B @emp_no=@SubBroker, @flag='QuarterlyPayout', @name=''

	SET @SDate = RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + DATENAME(YEAR, GETDATE())
	SET @EDate = RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))


	INSERT INTO #PriorityCalls
	--Margin Restore
	SELECT Party_Code, Party_Name, 'Margin Restore' AS Reason, NULL AS Risk, NULL AS [Collection], NULL AS Shortage, NULL AS squareoffvalue, NULL AS square_off_type, NULL AS square_off_date FROM #PriorityClients_B2B WHERE CallType = 'QuarterlyPayout'
	--Margin Retention
	UNION ALL
	SELECT Client, Party_Name, 'Margin Retention' AS Reason, NULL AS Risk, NULL AS [Collection], NULL AS Shortage, NULL AS squareoffvalue, NULL AS square_off_type , NULL AS square_off_date
	FROM tbl_SB_MarginRetention WITH(NOLOCK)
	WHERE SB = @SubBroker AND CONVERT(DATE, SCCS_SettDate_Last) BETWEEN @SDate AND @EDate

	SELECT * FROM #PriorityCalls
	ORDER BY
	   squareoffvalue DESC
	   ,Shortage DESC
	   ,[Collection] DESC
	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

	DROP TABLE #PriorityCalls
	DROP TABLE #PriorityClients_B2B


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_RiskBySubBroker_V1
-- --------------------------------------------------



/**************************************************************/
/*
	DATE:			
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V1 'ET'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V1 'GDS'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V1 'SAG'

	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V1 'ET', 1, null

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard_RiskBySubBroker_V1]
	@SubBroker VARCHAR(10)
	,@PageNo INT = NULL
	,@PageSize INT = NULL
AS
BEGIN
	SET NOCOUNT ON
	SET FMTONLY OFF

	SET @PageNo = ISNULL( CASE WHEN @PageNo <=0 THEN 1 ELSE @PageNo END, 1)
	SET @PageSize = ISNULL(CASE WHEN @PageSize <=0 THEN 10 ELSE @PageSize END, 2147483647)

	DECLARE	@RowsToSkip INT = (@PageNo-1) * @PageSize
	DECLARE	@NoOfRows INT = @PageSize

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + DATENAME(YEAR, GETDATE())
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))

	CREATE TABLE #PriorityCalls
	(
		party_code VARCHAR(10)
		,long_name VARCHAR(100)
		,Reason VARCHAR(200)
		,Risk MONEY
		,[Collection] MONEY
		,Shortage MONEY
		,squareoffvalue MONEY
		,square_off_type VARCHAR(100)
		,square_off_date VARCHAR(20)
	)

	/*********************************/
	--Risk view data
	/*********************************/

	INSERT INTO #PriorityCalls
	SELECT
		party_code
		,long_name
		,Reason
		,Net_Collection AS Risk
		,Net_Collection AS [Collection]
		--,NULLIF(ISNULL(Pure_Risk, 0) + ISNULL(shortage_value, 0), 0) AS Shortage
		,ISNULL(shortage_value, 0) AS Shortage
		,squareoffvalue
		,square_off_type
		,LTRIM(RTRIM(square_off_date)) AS square_off_date
	FROM 
		[196.1.115.182].general.dbo.vw_Dashboard_sbrisk
	WHERE
		SUB_BROKER = @SubBroker AND Net_Collection < 0

	--Newly added for LedgerBalance for Margin Retention
	SELECT Party_Code, Ledger 
	INTO #LedgerBal
	FROM [196.1.115.182].General.dbo.vw_ClientLedgerBalance_IPartner WITH(NOLOCK)
	WHERE SubBroker = @SubBroker

	SET @SDate = RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + DATENAME(YEAR, GETDATE())
	SET @EDate = RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))

	INSERT INTO #PriorityCalls
	--Margin Restore
	SELECT 
		MR.Party_Code
		,MR.Party_Name
		,'Margin Restore' AS Reason
		,NULL AS Risk
		,ISNULL(LB.Ledger, 0) AS [Collection]
		,NULL AS Shortage
		,CASE WHEN MR.Segment = 'Commodity' THEN MR.[Funds Payout] WHEN MR.Segment = 'Equity' THEN MR.[Payout value] ELSE 0 END AS squareoffvalue
		,CASE WHEN MR.Segment = 'Commodity' THEN 'FMC' WHEN MR.Segment = 'Equity' THEN 'SEBI' ELSE '' END AS square_off_type
		,CONVERT(VARCHAR(10), CONVERT(DATE,MR.update_date), 103) AS square_off_date 
	FROM 
		tbl_SB_MarginRestore MR WITH(NOLOCK)
		LEFT JOIN #LedgerBal LB WITH(NOLOCK) ON MR.Party_Code = LB.Party_Code
	WHERE 
		MR.SB = @SubBroker
	--Margin Retention
	UNION ALL
	SELECT MR.Client, MR.Party_Name, 'Margin Retention' AS Reason, NULL AS Risk, ISNULL(LB.Ledger, 0) AS [Collection], NULL AS Shortage, MR.FundsPayout AS squareoffvalue, CASE WHEN MR.Segment = 'Commodity' THEN 'FMC' WHEN MR.Segment = 'Equity' THEN 'SEBI' ELSE '' END AS square_off_type, CONVERT(VARCHAR(10), CONVERT(DATE,MR.SCCS_SettDate_Last), 103) AS square_off_date
	FROM tbl_SB_MarginRetention MR WITH(NOLOCK) 
	LEFT JOIN #LedgerBal LB WITH(NOLOCK) ON MR.Client = LB.Party_Code
	WHERE MR.SB = @SubBroker AND CONVERT(DATE, MR.SCCS_SettDate_Last) BETWEEN @SDate AND @EDate

	SELECT * FROM #PriorityCalls
	ORDER BY
		CASE 
			WHEN square_off_type = 'ageing T+7' THEN 1
			WHEN square_off_type = 'MTF' THEN 1
			WHEN square_off_type = 'nbfc margin shortage' THEN 1
			WHEN square_off_type = 't+2 day proj' THEN 1
			WHEN square_off_type = 't+2 day nbfc' THEN 1
			WHEN square_off_type = 'SEBI' AND Reason='Margin Retention' THEN 6
			WHEN square_off_type = 'FMC' AND Reason='Margin Retention' THEN 7
			WHEN square_off_type IS NULL THEN 8
			WHEN square_off_type = 'SEBI' AND Reason='Margin Restore' THEN 9
			WHEN square_off_type = 'FMC' AND Reason='Margin Restore' THEN 10
			ELSE 100
		END ASC
		,CONVERT(DATE, square_off_date, 103) ASC
		,Shortage ASC
	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

	DROP TABLE #PriorityCalls
	DROP TABLE #LedgerBal

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2 'ET'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2 'GDS'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2 'SAG'

	EXEC dbo.[usp_IPartner_Dashboard_RiskBySubBroker_V2_Opti] 'ET', 1, null

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard_RiskBySubBroker_V2]
	@SubBroker VARCHAR(10)
	,@PageNo INT = NULL
	,@PageSize INT = NULL	
AS
BEGIN
	SET NOCOUNT ON

	SET @PageNo = ISNULL( CASE WHEN @PageNo <=0 THEN 1 ELSE @PageNo END, 1)
	SET @PageSize = ISNULL(CASE WHEN @PageSize <=0 THEN 10 ELSE @PageSize END, 2147483647)

	DECLARE	@RowsToSkip INT = (@PageNo-1) * @PageSize
	DECLARE	@NoOfRows INT = @PageSize

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + DATENAME(YEAR, GETDATE())
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))

	CREATE TABLE #PriorityCalls
	(
		party_code VARCHAR(10)
		,long_name VARCHAR(100)
		,Reason VARCHAR(200)
		,Risk MONEY
		,[Collection] MONEY
		,Shortage MONEY
		,squareoffvalue MONEY
		,square_off_type VARCHAR(100)
		,square_off_date VARCHAR(20)
	)

	/*********************************/
	--Risk view data
	/*********************************/

	INSERT INTO #PriorityCalls
	SELECT
		party_code
		,long_name
		,Reason
		,Net_Collection AS Risk
		,Net_Collection AS [Collection]
		,ISNULL(shortage_value, 0) AS Shortage
		,squareoffvalue
		,square_off_type
		--,LTRIM(RTRIM(square_off_date)) AS square_off_date
		,square_off_date
	FROM 
		--[196.1.115.182].general.dbo.vw_Dashboard_sbrisk with(nolock)
		--vw_Dashboard_sbrisk with(nolock)
		vw_Dashboard_sbrisk_syn with(nolock) 
	WHERE
		SUB_BROKER = @SubBroker AND Net_Collection < 0

	--Newly added for LedgerBalance for Margin Retention
	SELECT Party_Code, Ledger 
	INTO #LedgerBal
	--FROM [196.1.115.182].General.dbo.vw_ClientLedgerBalance_IPartner WITH(NOLOCK)
	from ClientLedgerBalance_IPartner_syn  WITH(NOLOCK)
	WHERE SubBroker = @SubBroker

	SET @SDate = RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + DATENAME(YEAR, GETDATE())
	SET @EDate = RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))

	INSERT INTO #PriorityCalls
	--Margin Restore
	SELECT 
		MR.Party_Code
		,MR.Party_Name
		,'Margin Restore' AS Reason
		,NULL AS Risk
		,ISNULL(LB.Ledger, 0) AS [Collection]
		,NULL AS Shortage
		,CASE WHEN MR.Segment = 'Commodity' THEN MR.[Funds Payout] WHEN MR.Segment = 'Equity' THEN ABS(MR.[Funds Payout]) + ABS(MR.[Payout value]) ELSE 0 END AS squareoffvalue
		,CASE WHEN MR.Segment = 'Commodity' THEN 'FMC' WHEN MR.Segment = 'Equity' THEN 'SEBI' ELSE '' END AS square_off_type
		,CONVERT(VARCHAR(10), CONVERT(DATE,MR.update_date), 103) AS square_off_date 
	FROM 
		tbl_SB_MarginRestore MR WITH(NOLOCK)
		LEFT JOIN #LedgerBal LB WITH(NOLOCK) ON MR.Party_Code = LB.Party_Code
	WHERE 
		MR.SB = @SubBroker
	--Margin Retention
	UNION ALL
	SELECT 
		MR.Client
		,MR.Party_Name
		,'Margin Retention' AS Reason
		,NULL AS Risk
		,ISNULL(LB.Ledger, 0) AS [Collection]
		,NULL AS Shortage
		,ABS(MR.FundsPayout) + ABS(MR.PayoutValue) AS squareoffvalue
		,CASE WHEN MR.Segment = 'Commodity' THEN 'FMC' WHEN MR.Segment = 'Equity' THEN 'SEBI' ELSE '' END AS square_off_type
		,CONVERT(VARCHAR(10), CONVERT(DATE,MR.SCCS_SettDate_Last), 103) AS square_off_date
	FROM 
		tbl_SB_MarginRetention MR WITH(NOLOCK) 
		LEFT JOIN #LedgerBal LB WITH(NOLOCK) ON MR.Client = LB.Party_Code
	WHERE 
		MR.SB = @SubBroker 
		AND CONVERT(DATE, MR.SCCS_SettDate_Last) BETWEEN @SDate AND @EDate

	SELECT * FROM #PriorityCalls
	ORDER BY
		CASE 
			WHEN square_off_type = 'ageing T+7' THEN 1
			WHEN square_off_type = 'MTF' THEN 1
			WHEN square_off_type = 'nbfc margin shortage' THEN 1
			WHEN square_off_type = 't+2 day proj' THEN 1
			WHEN square_off_type = 't+2 day nbfc' THEN 1
			WHEN square_off_type = 'MTF Ageing' THEN 1
			WHEN square_off_type = 'SEBI' AND Reason='Margin Retention' THEN 6
			WHEN square_off_type = 'FMC' AND Reason='Margin Retention' THEN 7
			WHEN square_off_type IS NULL THEN 8
			WHEN square_off_type = 'SEBI' AND Reason='Margin Restore' THEN 9
			WHEN square_off_type = 'FMC' AND Reason='Margin Restore' THEN 10
			ELSE 100
		END ASC
		,CASE
			WHEN square_off_type IN ('ageing T+7', 'MTF', 'nbfc margin shortage', 't+2 day proj', 't+2 day nbfc', 'MTF Ageing') THEN CONVERT(DATE, square_off_date, 103) 
		 END ASC
		,CASE
			WHEN Reason IN ('Margin Retention', 'Margin Restore') THEN squareoffvalue
		 END DESC
		 ,CASE
			WHEN square_off_type IS NULL THEN [Collection]
		 END ASC
		 ,CASE
			WHEN square_off_type IN ('ageing T+7', 'MTF', 'nbfc margin shortage', 't+2 day proj', 't+2 day nbfc', 'MTF Ageing') THEN squareoffvalue
			WHEN Reason IN ('Margin Retention', 'Margin Restore') THEN [Collection]
		 END DESC
		 ,CASE
			WHEN square_off_type IN ('ageing T+7', 'MTF', 'nbfc margin shortage', 't+2 day proj', 't+2 day nbfc', 'MTF Ageing') THEN [Collection]
		 END ASC

	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

	DROP TABLE #PriorityCalls
	DROP TABLE #LedgerBal

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2_1
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2 'ET'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2 'GDS'
	EXEC dbo.usp_IPartner_Dashboard_RiskBySubBroker_V2 'SAG'

	EXEC dbo.[usp_IPartner_Dashboard_RiskBySubBroker_V2] 'GDS', 1, 5

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Dashboard_RiskBySubBroker_V2_1]
	@SubBroker VARCHAR(10)
	,@PageNo INT = NULL
	,@PageSize INT = NULL	
AS
BEGIN
	SET NOCOUNT ON

	SET @PageNo = ISNULL( CASE WHEN @PageNo <=0 THEN 1 ELSE @PageNo END, 1)
	SET @PageSize = ISNULL(CASE WHEN @PageSize <=0 THEN 10 ELSE @PageSize END, 2147483647)

	DECLARE	@RowsToSkip INT = (@PageNo-1) * @PageSize
	DECLARE	@NoOfRows INT = @PageSize

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + DATENAME(YEAR, GETDATE())
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))

	CREATE TABLE #PriorityCalls
	(
		party_code VARCHAR(10)
		,long_name VARCHAR(100)
		,Reason VARCHAR(200)
		,Risk MONEY
		,[Collection] MONEY
		,Shortage MONEY
		,squareoffvalue MONEY
		,square_off_type VARCHAR(100)
		,square_off_date VARCHAR(20)
	)

	/*********************************/
	--Risk view data
	/*********************************/

	INSERT INTO #PriorityCalls
	SELECT
		party_code
		,long_name
		,Reason
		,Net_Collection AS Risk
		,Net_Collection AS [Collection]
		,ISNULL(shortage_value, 0) AS Shortage
		,squareoffvalue
		,square_off_type
		--,LTRIM(RTRIM(square_off_date)) AS square_off_date
		,square_off_date
	FROM 
		--[196.1.115.182].general.dbo.vw_Dashboard_sbrisk with(nolock)
		--vw_Dashboard_sbrisk with(nolock)
		vw_Dashboard_sbrisk_syn with(nolock) 
	WHERE
		SUB_BROKER = @SubBroker AND Net_Collection < 0

		select '#PriorityCalls',* from #PriorityCalls

	--Newly added for LedgerBalance for Margin Retention
	SELECT Party_Code, Ledger 
	INTO #LedgerBal
	--FROM [196.1.115.182].General.dbo.vw_ClientLedgerBalance_IPartner WITH(NOLOCK)
	from ClientLedgerBalance_IPartner_syn  WITH(NOLOCK)
	WHERE SubBroker = @SubBroker


	select 2,* from #LedgerBal

	SET @SDate = RIGHT('0' + DATENAME(DAY, GETDATE()), 2) + ' ' + LEFT(DATENAME(MONTH, GETDATE()), 3) + ' ' + DATENAME(YEAR, GETDATE())
	SET @EDate = RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, GETDATE())), 2) + ' ' + LEFT(DATENAME(MONTH, DATEADD(D, 7, GETDATE())), 3) + ' ' + DATENAME(YEAR, DATEADD(D, 7, GETDATE()))

	INSERT INTO #PriorityCalls
	--Margin Restore
	SELECT 
		MR.Party_Code
		,MR.Party_Name
		,'Margin Restore' AS Reason
		,NULL AS Risk
		,ISNULL(LB.Ledger, 0) AS [Collection]
		,NULL AS Shortage
		,CASE WHEN MR.Segment = 'Commodity' THEN MR.[Funds Payout] WHEN MR.Segment = 'Equity' THEN ABS(MR.[Funds Payout]) + ABS(MR.[Payout value]) ELSE 0 END AS squareoffvalue
		,CASE WHEN MR.Segment = 'Commodity' THEN 'FMC' WHEN MR.Segment = 'Equity' THEN 'SEBI' ELSE '' END AS square_off_type
		,CONVERT(VARCHAR(10), CONVERT(DATE,MR.update_date), 103) AS square_off_date 
	FROM 
		tbl_SB_MarginRestore MR WITH(NOLOCK)
		LEFT JOIN #LedgerBal LB WITH(NOLOCK) ON MR.Party_Code = LB.Party_Code
	WHERE 
		MR.SB = @SubBroker
	--Margin Retention
	UNION ALL
	SELECT 
		MR.Client
		,MR.Party_Name
		,'Margin Retention' AS Reason
		,NULL AS Risk
		,ISNULL(LB.Ledger, 0) AS [Collection]
		,NULL AS Shortage
		,ABS(MR.FundsPayout) + ABS(MR.PayoutValue) AS squareoffvalue
		,CASE WHEN MR.Segment = 'Commodity' THEN 'FMC' WHEN MR.Segment = 'Equity' THEN 'SEBI' ELSE '' END AS square_off_type
		,CONVERT(VARCHAR(10), CONVERT(DATE,MR.SCCS_SettDate_Last), 103) AS square_off_date
	FROM 
		tbl_SB_MarginRetention MR WITH(NOLOCK) 
		LEFT JOIN #LedgerBal LB WITH(NOLOCK) ON MR.Client = LB.Party_Code
	WHERE 
		MR.SB = @SubBroker 
		AND CONVERT(DATE, MR.SCCS_SettDate_Last) BETWEEN @SDate AND @EDate

		select 1, * from #PriorityCalls

	SELECT * FROM #PriorityCalls
	ORDER BY
		CASE 
			WHEN square_off_type = 'ageing T+7' THEN 1
			WHEN square_off_type = 'MTF' THEN 1
			WHEN square_off_type = 'nbfc margin shortage' THEN 1
			WHEN square_off_type = 't+2 day proj' THEN 1
			WHEN square_off_type = 't+2 day nbfc' THEN 1
			WHEN square_off_type = 'MTF Ageing' THEN 1
			WHEN square_off_type = 'SEBI' AND Reason='Margin Retention' THEN 6
			WHEN square_off_type = 'FMC' AND Reason='Margin Retention' THEN 7
			WHEN square_off_type IS NULL THEN 8
			WHEN square_off_type = 'SEBI' AND Reason='Margin Restore' THEN 9
			WHEN square_off_type = 'FMC' AND Reason='Margin Restore' THEN 10
			ELSE 100
		END ASC
		,CASE
			WHEN square_off_type IN ('ageing T+7', 'MTF', 'nbfc margin shortage', 't+2 day proj', 't+2 day nbfc', 'MTF Ageing') THEN CONVERT(DATE, square_off_date, 103) 
		 END ASC
		,CASE
			WHEN Reason IN ('Margin Retention', 'Margin Restore') THEN squareoffvalue
		 END DESC
		 ,CASE
			WHEN square_off_type IS NULL THEN [Collection]
		 END ASC
		 ,CASE
			WHEN square_off_type IN ('ageing T+7', 'MTF', 'nbfc margin shortage', 't+2 day proj', 't+2 day nbfc', 'MTF Ageing') THEN squareoffvalue
			WHEN Reason IN ('Margin Retention', 'Margin Restore') THEN [Collection]
		 END DESC
		 ,CASE
			WHEN square_off_type IN ('ageing T+7', 'MTF', 'nbfc margin shortage', 't+2 day proj', 't+2 day nbfc', 'MTF Ageing') THEN [Collection]
		 END ASC

	OFFSET @RowsToSkip ROWS FETCH NEXT @NoOfRows ROWS ONLY

	DROP TABLE #PriorityCalls
	DROP TABLE #LedgerBal

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_GetClientAutoSuggest_Dealer_2_0
-- --------------------------------------------------


/**************************************************************/

/*

DATE:			01/05/2018

AUTHOR:			Brijesh B

DESCRIPTION:	



EXEC dbo.usp_IPartner_GetClientAutoSuggest_Dealer_2_0 'XM','A0001'

-----------------------------------------------

Modification



Modified by neeta on 02/08/2018 - Added new column mobile_pager while fetching details

*/	



/**************************************************************/

CREATE PROCEDURE [dbo].usp_IPartner_GetClientAutoSuggest_Dealer_2_0	
	@SubBroker VARCHAR(10) 
	,@Search VARCHAR(20) 

AS

BEGIN



	SET NOCOUNT ON

	IF EXISTS(Select * from B2B_Bulk_DealerMapping_syn WHERE Dealer1 = @SubBroker)

	begin

		SELECT TOP 5

			cd.party_code UserId
			,long_name FullName
			,mobile_pager mobilepager
			,Email     
			,mobile_pager Mobile 
			,pan_gir_no Pan         
			,Dob         


		FROM 

			sb_client_details cd WITH(NOLOCK) 
			inner join B2B_Bulk_DealerMapping_syn dm with(nolock) 
			on cd.party_code = dm.Party_Code and dm.Dealer1 = @SubBroker

		WHERE

			--sub_broker = @SubBroker			AND 

			(

					cd.Party_Code LIKE '%' + @Search + '%'

					OR long_name LIKE '%' + @Search + '%'

					OR mobile_pager LIKE '%' + @Search + '%'

					OR email LIKE '%' + @Search + '%'

					OR pan_gir_no LIKE '%' + @Search + '%'

				)

			--AND CONVERT(DATE, last_inactive_Date) > CONVERT(DATE, GETDATE())

		ORDER BY

			long_name

	end

	else 

	begin

		SELECT TOP 5
			party_code UserId
			,long_name FullName
			,mobile_pager mobilepager
			,Email     
			,mobile_pager Mobile 
			,pan_gir_no Pan         
			,Dob         

		FROM 

			sb_client_details WITH(NOLOCK)

		WHERE

			sub_broker = @SubBroker

			AND (

					Party_Code LIKE '%' + @Search + '%'

					OR long_name LIKE '%' + @Search + '%'

					OR mobile_pager LIKE '%' + @Search + '%'

					OR email LIKE '%' + @Search + '%'

					OR pan_gir_no LIKE '%' + @Search + '%'

				)

			--AND CONVERT(DATE, last_inactive_Date) > CONVERT(DATE, GETDATE())

		ORDER BY

			long_name

	end

	



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_GetClientImage
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/28/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	Image of Client

	EXEC dbo.usp_IPartner_GetClientImage 'PPOD056'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_GetClientImage]
	@PartyCode VARCHAR(10)
AS
BEGIN

	SELECT
		[Image]
		,CreatedDate
	FROM
		IPartner_ClientImages WITH(NOLOCK)
	WHERE
		PartyCode = @PartyCode

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Ipartner_GetSegmentActivationDetails
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Ipartner_GetSegmentActivationDetails]
(
	@Party_code VARCHAR(50)
)

	--EXEC Usp_Ipartner_GetSegmentActivationDetails 'AOF030'
AS
BEGIN
	
	SELECT	ISNULL(CASE WHEN [BSE-CAPITAL] = 'ACTIVE' OR [NSE-CAPITAL] = 'ACTIVE' THEN 'Cash' END,'')+'  '+
			ISNULL(CASE WHEN [MCX-FUTURES] = 'ACTIVE' OR [NCX-FUTURES] = 'ACTIVE' THEN 'Commodity' END,'')+'  '+
			ISNULL(CASE WHEN [NSX-FUTURES] = 'ACTIVE' OR [MCD-FUTURES] = 'ACTIVE' THEN 'Currency' END,'')+'  '+
			ISNULL(CASE WHEN [NSE-FUTURES] = 'ACTIVE' THEN 'FnO' END,'') AS	Active_Segment 
		
	FROM [AngelNseCM].msajag.dbo.CL_ACSTATUS  WITH(NOLOCK)
                where cl_code = @Party_code
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_MyClient_GetApprovedScrips
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/25/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	Gives list of approved scrips for report.


	EXEC dbo.usp_IPartner_MyClient_GetApprovedScrips '12/21/2017'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_MyClient_GetApprovedScrips]
	@FromDate DATE
AS
BEGIN

	SET NOCOUNT ON

	SELECT
		scrip_cd
		,from_date
		,to_date
		,entered_by
		,entered_date
		,Series
		,BseCode
		,ISIN
		,Scrip_Group
		,FUND_PER
	FROM 
		[172.31.16.57].NBFC.dbo.TBLScripMargin WITH(NOLOCK)
	WHERE 
		CONVERT(DATE, TO_DATE) > @FromDate
		AND scrip_cd<>''
	ORDER BY 
		scrip_cd

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_MyClient_GetSBPAN
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/26/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	Gives the PAN of SubBroker.

	EXEC dbo.usp_IPartner_MyClient_GetSBPAN 'ET'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_MyClient_GetSBPAN]
	@SubBroker VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON

	SELECT 
		PanNo  
	FROM
		[196.1.115.167].sb_comp.dbo.VW_SubBroker_Details WITH(NOLOCK)
	WHERE 
		SBTAG = @SubBroker

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_MyClient_GetSettlementCalendar
-- --------------------------------------------------
/**************************************************************/
/*
	DATE:			12/25/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	Gives Settlement Calendar.


	EXEC dbo.usp_IPartner_MyClient_GetSettlementCalendar 'SAG', 'AAA', 'ZZZ'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_MyClient_GetSettlementCalendar]
	@StatusName VARCHAR(10)
	,@FromParty VARCHAR(10)
	,@ToParty VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON
	
	Select 
		A.Sett_No, A.Sett_Type,Start_date,ScripName=s2.Scrip_CD
		,Qty=Sum(TradeQty)
		,Amount=Sum(TradeQty*N_NetRate)+Sum(Case When Service_Chrg = 1 Then NSertax Else 0 End)+Sum(Case When AuctionPart Like 'F%'	Then A.Other_Chrg Else 0 End)
		,MarketRate=Round((Sum(TradeQty*N_NetRate)+Sum(Case When Service_Chrg = 1 Then NSertax Else 0 End)+Sum(Case When AuctionPart Like 'F%' Then A.Other_Chrg Else 0 End))/Sum(TradeQty),4)
		,Sell_buy
	From 
		[AngelNseCM].msajag.dbo.Client2 C2 With( Nolock)
		,[AngelNseCM].msajag.dbo.Client1 C1 With(Nolock)--
		,[AngelNseCM].msajag.dbo.Settlement A With(Nolock)
		,[AngelNseCM].msajag.dbo.Scrip2 S2 With(Nolock)
		,[AngelNseCM].msajag.dbo.Sett_Mst S With(Nolock)
		,(Select Top 2 Sett_no = Sett_no From [AngelNseCM].msajag.dbo.Accbill With(Nolock) Where party_code = @StatusName and Sett_type = 'A' Order By Sett_no Desc) Sa		
	Where 
		C1.Cl_Code = C2.Cl_Code
		And C2.Party_code = A.Party_Code And MarketRate > 0 And TradeQty > 0 
		And A.Sett_No = Sa.Sett_No 
		And A.Sett_Type = 'A' and s2.Scrip_Cd = A.scrip_cd
		and s2.series = A.Series
		And A.Party_Code >= @FromParty And A.Party_Code <= @ToParty And AuctionPart Not Like 'A%'
		And c2.party_code = @statusname 
		--And c1.sub_broker like @statusname 
		And A.Sett_no = S.Sett_no And A.Sett_type = S.Sett_type
	Group by 
		A.Sett_No, A.Sett_Type,A.Party_Code,C1.Long_Name,C1.L_Address1,C1.L_Address2,
		C1.L_Address3,L_City,L_State,L_Zip,BillNo,s2.Scrip_CD,Sell_buy,S.Start_date
	Order by 
		A.Sett_no Desc, A.Sett_type, s2.Scrip_CD, Sell_buy

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_MyClient_GetSettlementNos
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			01/05/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_MyClient_GetSettlementNos 'ad','All'
	EXEC dbo.usp_IPartner_MyClient_GetSettlementNos 'ad', '2017209'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_MyClient_GetSettlementNos]
	@SettType VARCHAR(3)
	,@SettNo VARCHAR(7)=NULL
AS
BEGIN

	SET NOCOUNT ON

	--BSE
	SELECT DISTINCT
		Sett_No
	FROM
		[AngelDemat].bsedb.dbo.sett_mst WITH(NOLOCK)
	WHERE
		Sett_Type = @SettType
		AND Sett_No LIKE CASE WHEN @SettNo = 'All' OR @SettNo IS NULL THEN '%' ELSE @SettNo + '%' END
	ORDER BY
		Sett_No DESC

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_MyClient_ViewSettlementCalendar
-- --------------------------------------------------
/**************************************************************/
/*
	DATE:			12/27/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_MyClient_ViewSettlementCalendar 'ad','All'
	EXEC dbo.usp_IPartner_MyClient_ViewSettlementCalendar 'ad', '2017209'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_MyClient_ViewSettlementCalendar]
	@SettType VARCHAR(3)
	,@SettNo VARCHAR(7)=NULL
AS
BEGIN

	SET NOCOUNT ON

	/*
	SELECT 
		SETT_NO,START_DATE=LEFT(CONVERT(VARCHAR,START_DATE,109),11),
		END_DATE=LEFT(CONVERT(VARCHAR,END_DATE,109),11),
		FUNDS_PAYIN=LEFT(CONVERT(VARCHAR,FUNDS_PAYIN,109),11),
		FUNDS_PAYOUT=LEFT(CONVERT(VARCHAR,FUNDS_PAYOUT,109),11),
		SEC_PAYIN=LEFT(CONVERT(VARCHAR,SEC_PAYIN,109),11),
		SEC_PAYOUT=LEFT(CONVERT(VARCHAR,SEC_PAYOUT,109),11)
	FROM 
		[196.1.115.201].[BSEDB_AB].DBO.SETT_MST WITH(NOLOCK)
	WHERE 
		SETT_TYPE = @SettType
		AND SETT_NO LIKE CASE WHEN @SettNo = 'All' OR @SettNo IS NULL THEN '%' ELSE @SettNo END
	ORDER BY
		SETT_NO DESC
	*/

	SELECT * FROM
	(
	--BSE
	SELECT
		EXCHANGE = 'BSE',
		NARRATION = CASE 
					WHEN SETT_TYPE='AC' THEN 'Auction Oddlot' 
					WHEN SETT_TYPE='AD' THEN 'Auction Rolling Settlement' 
					WHEN SETT_TYPE='C' THEN 'Normal Oddlot' 
					WHEN SETT_TYPE='D' THEN 'Rolling Settlement'
					WHEN SETT_TYPE='OB' THEN 'Buy Back'
					ELSE ''
					END,
		SETT_NO,START_DATE=LEFT(CONVERT(VARCHAR,START_DATE,109),11),
		END_DATE=LEFT(CONVERT(VARCHAR,END_DATE,109),11),
		FUNDS_PAYIN=LEFT(CONVERT(VARCHAR,FUNDS_PAYIN,109),11),
		FUNDS_PAYOUT=LEFT(CONVERT(VARCHAR,FUNDS_PAYOUT,109),11),
		SEC_PAYIN=LEFT(CONVERT(VARCHAR,SEC_PAYIN,109),11),
		SEC_PAYOUT=LEFT(CONVERT(VARCHAR,SEC_PAYOUT,109),11)
	FROM 
		[AngelBSECM].[BSEDB_AB].DBO.SETT_MST WITH(NOLOCK)
	WHERE 
		SETT_TYPE = @SettType
		AND SETT_TYPE IN ('AC','AD','C','D','OB')
		AND SETT_NO LIKE CASE WHEN @SettNo = 'All' OR @SettNo IS NULL THEN '%' ELSE @SettNo END
		AND [start_date] <= getdate() AND funds_payin >= getdate()-3
	--NSE
	UNION ALL
	SELECT
		EXCHANGE = 'NSE',
		NARRATION = CASE 
					WHEN SETT_TYPE='A' THEN 'Auction Normal' 
					WHEN SETT_TYPE='N' THEN 'Normal Settlement' 
					WHEN SETT_TYPE='W' THEN 'Trade for Trade' 
					WHEN SETT_TYPE='X' THEN 'Auction Oddlot'
					WHEN SETT_TYPE='BX' THEN 'Buy Back'
					ELSE ''
					END,
		SETT_NO,START_DATE=LEFT(CONVERT(VARCHAR,START_DATE,109),11),
		END_DATE=LEFT(CONVERT(VARCHAR,END_DATE,109),11),
		FUNDS_PAYIN=LEFT(CONVERT(VARCHAR,FUNDS_PAYIN,109),11),
		FUNDS_PAYOUT=LEFT(CONVERT(VARCHAR,FUNDS_PAYOUT,109),11),
		SEC_PAYIN=LEFT(CONVERT(VARCHAR,SEC_PAYIN,109),11),
		SEC_PAYOUT=LEFT(CONVERT(VARCHAR,SEC_PAYOUT,109),11)
	FROM 
		[AngelNseCM].msajag.dbo.sett_mst WITH(NOLOCK)
	WHERE 
		SETT_TYPE = @SettType
		AND SETT_TYPE IN ('A','N','W','X','BX')
		AND SETT_NO LIKE CASE WHEN @SettNo = 'All' OR @SettNo IS NULL THEN '%' ELSE @SettNo END
		AND [start_date] <= getdate() AND funds_payin >= getdate()-3
	) S
	ORDER BY
		SETT_NO DESC

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_ofs_scripmaster
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_IPartner_ofs_scripmaster]
AS
BEGIN
select * from [196.1.115.132].MISC.dbo.OFS_ScripMaster
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_OneClientView_GetAadhaarStatus
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/20/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	Gives the Status Flag if Aadhaar.

	EXEC dbo.usp_IPartner_OneClientView_GetAadhaarStatus 'RP61'
	EXEC dbo.usp_IPartner_OneClientView_GetAadhaarStatus 'RP611'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_OneClientView_GetAadhaarStatus]
	@PartyCode VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON

	IF EXISTS(
				SELECT * FROM [196.1.115.167].[Kyc_Ci].dbo.Vi_GetAadhaarRepositoryDetails WITH(NOLOCK) 
				WHERE PartyCode = @PartyCode AND AadhaarNo IS NOT NULL
			 )
		SELECT 'Yes' AS AadhaarStatus
	ELSE
		SELECT 'No' AS AadhaarStatus

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_OneClientView_GetFundsPayout
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			11/06/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_OneClientView_GetFundsPayout 'R89338'
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_OneClientView_GetFundsPayout]
	@ClientCode AS VARCHAR(100) = ''
AS
BEGIN

	SET NOCOUNT ON
	--IF @Process = 'GetFundsPayout'  
	--BEGIN	
		EXEC [196.1.115.132].CMS.dbo.NCMS_MOB_GetPODetail @ClientCode
	--END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_OneClientView_GetLedgerBalance
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			11/13/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gives counts of Legdger Balances
					by Segment and Total Ledger Balance.
	
	DATE LAST UPDATED: 11/23/2017

	--EXEC dbo.usp_IPartner_OneClientView_GetLedgerBalance 'RP61', '04/06/2015', '01/07/2016'
	EXEC dbo.usp_IPartner_OneClientView_GetLedgerBalance 'RP61'
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_OneClientView_GetLedgerBalance]
	@Client VARCHAR(10)
	--,@FromDate VARCHAR(100)
	--,@ToDate VARCHAR(100)
AS
BEGIN

	SET NOCOUNT ON

	CREATE TABLE #LedgerBalance
	(
		party_code VARCHAR(10)
		,Long_name VARCHAR(100)
		,BSELedger MONEY
		,bsecashdeposit MONEY
		,BseSett_no CHAR(10)
		,NseSett_no CHAR(10)
		,MarginDate SMALLDATETIME
		,bse_NetFund MONEY
		,BSELastCDate SMALLDATETIME
		,BSELastCheque MONEY
		,BseLastBillDate SMALLDATETIME
		,BSELastBillAmt MONEY
		,NSELedger MONEY
		,nsecashdeposit MONEY
		,Nse_NetFund MONEY
		,NSELastCDate SMALLDATETIME
		,NSELastCheque MONEY
		,NseLastBillDate SMALLDATETIME
		,NSELastBillAmt MONEY
		,NSEFOLedger MONEY
		,NSEFOCashDeposit MONEY
		,NonCash_Coll MONEY
		,NSEFOMarginRequired MONEY
		,NetMarginFO MONEY
		,NseFo_NetFund MONEY
		,NSEFoLastCDate SMALLDATETIME
		,NSEFOLastCheque MONEY
		,NseFoLastBillDate SMALLDATETIME
		,NseFoBillAmount MONEY
		,MCDXLedger MONEY
		,MCDXCashDeposit MONEY
		,MCDXNonCash_coll MONEY
		,MCXMarginRequired MONEY
		,McdxMtmMargin MONEY
		,NetMarginMcx MONEY
		,MCXNetFund MONEY
		,McdxLastCDate SMALLDATETIME
		,MCDXLastCheque MONEY
		,McdxLastBillDate SMALLDATETIME
		,McdxBillAmount MONEY
		,NCDXLedger MONEY
		,NCDXCashDeposit MONEY
		,NCDXNonCash_coll MONEY
		,NCXMarginRequired MONEY
		,NcdxMtmMargin MONEY
		,NetMarginNcx MONEY
		,NCXNetFund MONEY
		,NcdxLastCDate SMALLDATETIME
		,NCDXLastCheque MONEY
		,NcdxLastBillDate SMALLDATETIME
		,NcdxBillAmount MONEY
		,NSXLedger MONEY
		,NSXCashDeposit MONEY
		,NSXNonCash_coll MONEY
		,NSXMarginRequired MONEY
		,NetMarginNsx MONEY
		,NSXNetFund MONEY
		,NSXLastCDate VARCHAR(20)
		,NSXLastCheque MONEY
		,NSXLastBillDate VARCHAR(20)
		,NSXBillAmount MONEY
		,BSXLedger MONEY
		,BSXCashDeposit MONEY
		,BSXNonCash_coll MONEY
		,BSXMarginRequired MONEY
		,NetMarginBsx MONEY
		,BSXNetFund MONEY
		,BSXLastCDate VARCHAR(20)
		,BSXLastCheque MONEY
		,BSXLastBillDate VARCHAR(20)
		,BSXBillAmount MONEY
		,MCDLedger MONEY
		,MCDCashDeposit MONEY
		,MCDNonCash_coll MONEY
		,MCDMarginRequired MONEY
		,NetMarginMCD MONEY
		,MCDNetFund MONEY
		,MCDLastCDate VARCHAR(20)
		,MCDLastCheque MONEY
		,MCDLastBillDate VARCHAR(20)
		,MCDBillAmount MONEY
		,NBFCLedger MONEY
		,NBFCNetFund MONEY
		,NBFCNonCash_coll MONEY
		,BSEMFLEDGER MONEY
		,NSEMFLEDGER MONEY
		,LedgerTotal MONEY
		,CashDepositTotal MONEY
		,SecurityDepositTotal MONEY
		,TotalRequiredMargin MONEY
		,TotalMTMMargin MONEY
		,TotalNetMargin MONEY
		,TotalNetFund MONEY
		,TotalLastCheque MONEY
		,TotalLastBill MONEY
		,IsAngelGoldClientFlag VARCHAR(10)
		,IsMF_CUG_Flag VARCHAR(20)
		,IsIPOClientFlag VARCHAR(10)
		,PrepaidAmount MONEY
		,BalancePrepaidAmt MONEY
	)

	INSERT INTO #LedgerBalance
	EXEC [196.1.115.207].Angelcs.dbo.Sp_FundsReport_NewVer1 @Client

	SELECT
		BSELedger
		,NSELedger
		,NSEFOLedger
		,MCDXLedger
		,NCDXLedger
		,NSXLedger
		,BSXLedger
		,MCDLedger
		,NBFCLedger
		,ISNULL(BSELedger, 0) + ISNULL(NSELedger, 0) + ISNULL(NSEFOLedger, 0) + ISNULL(MCDXLedger, 0) + 
		ISNULL(NCDXLedger, 0) + ISNULL(NSXLedger, 0) + ISNULL(BSXLedger, 0) + ISNULL(MCDLedger, 0) + ISNULL(NBFCLedger, 0) AS Total
	FROM
		#LedgerBalance

	IF OBJECT_ID('tempdb..#LedgerBalance') IS NOT NULL
		DROP TABLE #LedgerBalance

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_OneClientView_GetMTFStatus
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/16/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gets MTF Status of given
					Client.

	EXEC dbo.usp_IPartner_OneClientView_GetMTFStatus 'RP61'
	EXEC dbo.usp_IPartner_OneClientView_GetMTFStatus 'A99246'


*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_OneClientView_GetMTFStatus]
	@PartyCode VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON



	IF EXISTS(
				SELECT MTFStatus FROM [AngelNseCM].MTFtrade.dbo.MTF_STATUS MS WITH(NOLOCK)
				WHERE Party_Code = @PartyCode
			 )
		SELECT 'Y' AS MTFStatus
	ELSE
		SELECT 'N' AS MTFStatus

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_RPT_SB_CREDIT_DrCr
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			2/1/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_RPT_SB_CREDIT_DrCr 'GDS', 'GDS'
	EXEC dbo.usp_IPartner_RPT_SB_CREDIT_DrCr 'SAEO', 'SAEO'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_RPT_SB_CREDIT_DrCr]
	@EntityCode VARCHAR(10)
	,@Access_Code VARCHAR(10)
AS
BEGIN
	SET NOCOUNT ON
	SET FMTONLY OFF

	CREATE TABLE #DrCr
	(
		Region VARCHAR(20)
		,Branch VARCHAR(10)
		,[Sub Broker] VARCHAR(10)
		,[SB Name] VARCHAR(100)
		,[SB Type] VARCHAR(10)
		,[SB Cat] VARCHAR(50)
		,[SB ROI] MONEY
		,[Net Shortfall] DECIMAL(20,2)
		,[Holding] DECIMAL(15,2)
		,[Gross Exposure] DECIMAL(15,2)
		,[Margin Shortage] DECIMAL(15,2)
		,[SB Credit] DECIMAL(20,2)
		,[Client Risk] DECIMAL(15,2)
		,[SB Cr After Adj] DECIMAL(15,2)
		,[Projected Risk] DECIMAL(15,2)
		,[ProjRisk After DP Adj] DECIMAL(15,2)
		,[Unbooked Loss] DECIMAL(15,2)
		,[Client Count] INT
		,[Total Clients] INT
		,[Client (%)] DECIMAL(15,2)
	)

	INSERT INTO #DrCr
	EXEC [196.1.115.182].General.dbo.Rpt_DrCr_sb_Ipart @EntityCode,'SB','sb','%','%','%','1','IN 20LACS','sanjay','BROKER', @Access_Code

	
	CREATE TABLE #Credit
	(
		SB VARCHAR(10)
		,[SB's cash deposit(in Lacs)] VARCHAR(1000)
		,[SB's non cash deposit(in Lacs)] VARCHAR(1000)
		,[SB's Brokerage lying with Angel(in Lacs)] VARCHAR(1000)
		,[SB's Accured brokerage(in Lacs)] VARCHAR(1000)
		,[Total SB credit(in Lacs)]	DECIMAL(15,2)
	)

	INSERT INTO #Credit
	EXEC [196.1.115.182].General.dbo.RPT_SB_CREDIT_Ipart @EntityCode, 'SB', 1, 'sanjay', 'SB', @Access_Code

	SELECT
		CR.SB
		,ISNULL(CR.[SB's cash deposit(in Lacs)], 0) AS [SB's cash deposit(in Lacs)]
		,ISNULL(CR.[SB's non cash deposit(in Lacs)], 0) AS [SB's non cash deposit(in Lacs)]
		,ISNULL(CR.[SB's Brokerage lying with Angel(in Lacs)], 0) AS [SB's Brokerage lying with Angel(in Lacs)]
		,ISNULL(CR.[SB's Accured brokerage(in Lacs)], 0) AS [SB's Accured brokerage(in Lacs)]
		,ISNULL(CR.[Total SB credit(in Lacs)], 0) AS [Total SB credit(in Lacs)]
		,ISNULL(DC.[Client Risk], 0) AS [Client Risk]
		,ISNULL(DC.[SB Cr After Adj], 0) AS [SB Cr After Adj]
		,ISNULL(DC.[Projected Risk], 0) AS [Projected Risk]
	FROM
		#DrCr DC
		FULL OUTER JOIN #Credit CR ON DC.[Sub Broker] = CR.SB
	
	DROP TABLE #DrCr
	DROP TABLE #Credit

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_RPT_SB_CREDIT_DrCr_WithMultitag
-- --------------------------------------------------
/**************************************************************/
/*
	DATE:			2/1/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_RPT_SB_CREDIT_DrCr 'GDS', 'GDS'
	EXEC dbo.usp_IPartner_RPT_SB_CREDIT_DrCr 'AJYT', 'AJYT'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_RPT_SB_CREDIT_DrCr_WithMultitag]
	@EntityCode VARCHAR(10)
	,@Access_Code VARCHAR(10)
AS
BEGIN
	SET NOCOUNT ON
	SET FMTONLY OFF

	Declare @IsParent INT

Create Table #MultiTag
(
	Branch	varchar(100)
	,tags	varchar(100)
	,isParent INT
)

		CREATE TABLE #DrCr
		(
			Region VARCHAR(20)
			,Branch VARCHAR(10)
			,[Sub Broker] VARCHAR(10)
			,[SB Name] VARCHAR(100)
			,[SB Type] VARCHAR(10)
			,[SB Cat] VARCHAR(50)
			,[SB ROI] MONEY
			,[Net Shortfall] DECIMAL(20,2)
			,[Holding] DECIMAL(15,2)
			,[Gross Exposure] DECIMAL(15,2)
			,[Margin Shortage] DECIMAL(15,2)
			,[SB Credit] DECIMAL(20,2)
			,[Client Risk] DECIMAL(15,2)
			,[SB Cr After Adj] DECIMAL(15,2)
			,[Projected Risk] DECIMAL(15,2)
			,[ProjRisk After DP Adj] DECIMAL(15,2)
			,[Unbooked Loss] DECIMAL(15,2)
			,[Client Count] INT
			,[Total Clients] INT
			,[Client (%)] DECIMAL(15,2)
		)


	CREATE TABLE #Credit
	(
		SB VARCHAR(10)
		,[SB's cash deposit(in Lacs)] VARCHAR(1000)
		,[SB's non cash deposit(in Lacs)] VARCHAR(1000)
		,[SB's Brokerage lying with Angel(in Lacs)] VARCHAR(1000)
		,[SB's Accured brokerage(in Lacs)] VARCHAR(1000)
		,[Total SB credit(in Lacs)]	DECIMAL(15,2)
	)

	insert into #MultiTag
	EXEC [196.1.115.167].[SB_COMP].dbo.usp_nxt_multilocation_tag @Access_Code


	select @IsParent=isParent from #MultiTag WITH(NOLOCK) where isParent=1 and tags=@Access_Code

	If @IsParent=1 
	begin 


		INSERT INTO #DrCr
		EXEC [196.1.115.182].General.dbo.Rpt_DrCr_sb_Ipart @EntityCode,'SB','sb','%','%','%','1','IN 20LACS','sanjay','BROKER', @Access_Code

		INSERT INTO #Credit
		EXEC [196.1.115.182].General.dbo.RPT_SB_CREDIT_Ipart @EntityCode, 'SB', 1, 'sanjay', 'SB', @Access_Code

		SELECT distinct
			CR.SB
			,ISNULL(CR.[SB's cash deposit(in Lacs)], 0) AS [SB's cash deposit(in Lacs)]
			,ISNULL(CR.[SB's non cash deposit(in Lacs)], 0) AS [SB's non cash deposit(in Lacs)]
			,ISNULL(CR.[SB's Brokerage lying with Angel(in Lacs)], 0) AS [SB's Brokerage lying with Angel(in Lacs)]
			,ISNULL(CR.[SB's Accured brokerage(in Lacs)], 0) AS [SB's Accured brokerage(in Lacs)]
			,ISNULL(CR.[Total SB credit(in Lacs)], 0) AS [Total SB credit(in Lacs)]
			,ISNULL(DC.[Client Risk], 0) AS [Client Risk]
			,ISNULL(DC.[SB Cr After Adj], 0) AS [SB Cr After Adj]
			,ISNULL(DC.[Projected Risk], 0) AS [Projected Risk]
		FROM
			#DrCr DC WITH(NOLOCK)
			FULL OUTER JOIN #Credit CR WITH(NOLOCK) ON DC.[Sub Broker] = CR.SB

	END
	ELSE 
	BEGIN

			INSERT INTO #DrCr
		EXEC [196.1.115.182].General.dbo.Rpt_DrCr_sb_Ipart @EntityCode,'SB','sb','%','%','%','1','IN 20LACS','sanjay','BROKER', @Access_Code

		INSERT INTO #Credit
		EXEC [196.1.115.182].General.dbo.RPT_SB_CREDIT_Ipart @EntityCode, 'SB', 1, 'sanjay', 'SB', @Access_Code

		SELECT distinct 
			CR.SB
			,ISNULL(CR.[SB's cash deposit(in Lacs)], 0) AS [SB's cash deposit(in Lacs)]
			,ISNULL(CR.[SB's non cash deposit(in Lacs)], 0) AS [SB's non cash deposit(in Lacs)]
			,ISNULL(CR.[SB's Brokerage lying with Angel(in Lacs)], 0) AS [SB's Brokerage lying with Angel(in Lacs)]
			,ISNULL(CR.[SB's Accured brokerage(in Lacs)], 0) AS [SB's Accured brokerage(in Lacs)]
			,ISNULL(CR.[Total SB credit(in Lacs)], 0) AS [Total SB credit(in Lacs)]
			,ISNULL(DC.[Client Risk], 0) AS [Client Risk]
			,ISNULL(DC.[SB Cr After Adj], 0) AS [SB Cr After Adj]
			,ISNULL(DC.[Projected Risk], 0) AS [Projected Risk]
		FROM
			#DrCr DC WITH(NOLOCK)
			FULL OUTER JOIN #Credit CR WITH(NOLOCK) ON DC.[Sub Broker] = CR.SB
			where SB=@Access_Code


	END	
	DROP TABLE #DrCr
	DROP TABLE #Credit


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_ScripView_AdvisoryCalls
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/06/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gives a list of Advisory Calls
					for given company code.

	EXEC dbo.usp_IPartner_ScripView_AdvisoryCalls 2806
*/	
/**************************************************************/

CREATE PROCEDURE [dbo].[usp_IPartner_ScripView_AdvisoryCalls]
	@CoCode INT
AS
BEGIN
	SET NOCOUNT ON

	DECLARE @Symbol VARCHAR(32)

	SELECT @Symbol = cm_symbol FROM [172.31.16.75].ANGEL_WMS.dbo.vw_stock_mst WHERE co_code = @CoCode

	SELECT
		expirydate, broadcastmsg
	FROM 
		[196.1.115.207].crm.dbo.VW_AngelAdvisory_OpenCalls 
	WHERE 
		script_cd = @Symbol

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Service_Actionable
-- --------------------------------------------------



/**************************************************************/
/*
	DATE:			12/04/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Service_Actionable 'GDS'

*/	
/**************************************************************/

CREATE PROCEDURE [dbo].[usp_IPartner_Service_Actionable]
	@SubBroker VARCHAR(20)
AS
BEGIN
	SET NOCOUNT ON
	
	DECLARE @PriorityName VARCHAR(200)
	DECLARE @DisplayOrder INT

	CREATE TABLE #PriorityListMetaData
	(
		PriorityDisplayName	VARCHAR(200)
		,PriorityName VARCHAR(200)
		,DisplayOrder INT UNIQUE
	)

	INSERT INTO #PriorityListMetaData
	EXEC [196.1.115.207].crm.dbo.usp_CRMS_Dashboard_PriorityListMetaData @emp_no= @SubBroker, @flag=''


	CREATE TABLE #PriorityList
	(
		GivenPriorityName VARCHAR(200)
		,PriorityName VARCHAR(200)
	,ListOrder INT
	)

	/*
	INSERT INTO #PriorityList 
	VALUES	('30DaysNotTradedClients', 'NotTradedClients_30_Day', 16)
			,('ARQRe-balanceMissed', 'ARQ_Re_balance_Missed', 6)
			,('BanScrips-FOviolation', '', 7)
			,('MF-3MonthsNotTraded', 'MF_AUM_NotTraded3Months', 8)
			,('MFProspectList', '', 9)
			,('MTFSquareoff', '', 1)
			,('NewClientsNeverTraded', 'NewClientsNeverTraded', 10)
			,('OpenPosition-MTM', 'OpenPosition', 4)
			,('ProjectedSqOff', 'ProjectedSqOff', 2)
			,('PureTradingShortage(ShortSell)', 'PureTradingShortage', 3)
			,('QuarterlyPayout', 'QuarterlyPayout', 11)
			,('QuarterlyPayout-Probable', 'QuarterlyPayout_Probable', 12)
			,('T+7DaysNotTradedClients', 'NotTradedClients_T_7_Day', 13)
			,('Today''sARQRe-balancing', 'Todays_ARQ_Rebalancing', 14)
			,('WelcomeCalls', 'WelcomeCalls', 15)
			,('7 Day Sq. Off', '7_Day_Sq_Off', 5)
	*/
	INSERT INTO #PriorityList 
	VALUES	
			('ARQRe-balanceMissed', 'ARQ_Re_balance_Missed', 6)
			,('MFProspectList', '', 9)
			,('QuarterlyPayout', 'QuarterlyPayout', 11)
			,('QuarterlyPayout-Probable', 'QuarterlyPayout_Probable', 12)
			,('WelcomeCalls', 'WelcomeCalls', 15)

	CREATE TABLE #PriorityClients_B2B
	(
		Party_Code VARCHAR(20)
		,Party_Name VARCHAR(100)
		,CallType VARCHAR(200)
		,CallSubType VARCHAR(200)
		,CallValue VARCHAR(2000)
		,[Description] VARCHAR(2500)
		--,DisplayPriority INT
	)

	WHILE EXISTS(SELECT PLMD.PriorityName FROM #PriorityListMetaData PLMD JOIN #PriorityList PL ON PLMD.PriorityName = PL.PriorityName)
	BEGIN
		SELECT TOP 1 
			@PriorityName = PLMD.PriorityName
			,@DisplayOrder = PLMD.DisplayOrder 
		FROM 
			#PriorityListMetaData PLMD
			JOIN #PriorityList PL ON PLMD.PriorityName = PL.PriorityName
		ORDER BY 
			--PLMD.DisplayOrder
			PL.ListOrder
			,PLMD.DisplayOrder
		PRINT @PriorityName
	
		INSERT INTO #PriorityClients_B2B
		EXEC [196.1.115.207].crm.dbo.usp_CRMS_Dashboard_PriorityClients_B2B @emp_no=@SubBroker, @flag=@PriorityName, @name=''

		UPDATE
			#PriorityClients_B2B
		SET
			[Description] = 'Margin Restore'
		WHERE
			CallType = 'QuarterlyPayout' AND [Description] LIKE '%QuarterlyPayout%'

		UPDATE
			#PriorityClients_B2B
		SET
			[Description] = 'Margin Retention'
		WHERE
			CallType = 'QuarterlyPayout_Probable' AND [Description] LIKE '%Quarterly%Payout%Probable%'

		UPDATE
			#PriorityClients_B2B
		SET
			[Description] = 'Welcome Calls'
		WHERE
			CallType = 'WelcomeCalls' AND [Description] LIKE '%Welcome%Calls%'

		DELETE FROM #PriorityListMetaData WHERE PriorityName = @PriorityName AND DisplayOrder = @DisplayOrder
	END


	SELECT * FROM #PriorityClients_B2B

	DROP TABLE #PriorityListMetaData
	DROP TABLE #PriorityClients_B2B
	DROP TABLE #PriorityList

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Service_GetFOPrice
-- --------------------------------------------------
 /*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]
 */

/**************************************************************/
/*
	DATE:			01/17/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Service_GetFOPrice 'NIFTY','FUTURE'
	EXEC dbo.usp_IPartner_Service_GetFOPrice 'NIFTY','OPTION'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Service_GetFOPrice]
	@Symbol VARCHAR(20)
	,@FO VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON

	IF @FO = 'FUTURE'
	BEGIN
		
		SELECT DISTINCT
			FF.symbol
			,FF.ltp
			,FF.expdate
			,FM.market_lot
		FROM 
			--[172.31.16.75].FSS_DERIVATIVES.dbo.feed_faolatest1 FF WITH(NOLOCK)
			[196.1.115.232].FSS_DERIVATIVES.dbo.feed_faolatest1 FF WITH(NOLOCK)
			INNER JOIN 
			[196.1.115.232].FSS_DERIVATIVES.dbo.feed_FaoMktLot FM WITH(NOLOCK) ON FF.symbol = FM.symbol
			--[172.31.16.75].FSS_DERIVATIVES.dbo.feed_FaoMktLot FM WITH(NOLOCK) ON FF.symbol = FM.symbol
		WHERE
			FF.symbol = @Symbol
			AND FF.instname IN ('FUTIDX', 'FUTSTK')
		ORDER BY
			FF.expdate
	
	END
	ELSE IF @FO = 'OPTION'
	BEGIN
	
		SELECT DISTINCT
			FF.symbol
			,FF.ltp
			,FF.expdate
			,FF.strikeprice
			,FF.opttype
			,FM.market_lot
		FROM 
		 [196.1.115.232].FSS_DERIVATIVES.dbo.feed_faolatest1 FF WITH(NOLOCK)
		  INNER JOIN 
		  [196.1.115.232].FSS_DERIVATIVES.dbo.feed_FaoMktLot FM WITH(NOLOCK) ON FF.symbol = FM.symbol
			--[172.31.16.75].FSS_DERIVATIVES.dbo.feed_faolatest1 FF WITH(NOLOCK)
			--INNER JOIN [172.31.16.75].FSS_DERIVATIVES.dbo.feed_FaoMktLot FM WITH(NOLOCK) ON FF.symbol = FM.symbol
		WHERE
			FF.symbol = @Symbol
			AND FF.instname IN ('OPTIDX', 'OPTSTK') 
		ORDER BY
			FF.expdate
			,FF.strikeprice
			
	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Service_GetFOSymbolAutoSuggest
-- --------------------------------------------------
 /*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]
 */

 

/**************************************************************/
/*
	DATE:			01/17/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_Service_GetFOSymbolAutoSuggest 'NIF','FUTURE'
	EXEC dbo.usp_IPartner_Service_GetFOSymbolAutoSuggest 'NIF','OPTION'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Service_GetFOSymbolAutoSuggest]
	@Search VARCHAR(20)
	,@FO VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON

	SELECT DISTINCT
		symbol
	FROM 
		[196.1.115.232].FSS_DERIVATIVES.dbo.feed_faolatest1 WITH(NOLOCK)

--		[172.31.16.75].FSS_DERIVATIVES.dbo.feed_faolatest1 WITH(NOLOCK)
	WHERE
		symbol LIKE @Search + '%'
		AND 1 = CASE 
					WHEN @FO='FUTURE' AND instname IN ('FUTIDX', 'FUTSTK') THEN 1 
					WHEN @FO='OPTION' AND instname IN ('OPTIDX', 'OPTSTK') THEN 1 
					ELSE 0 
				END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Service_GetLimitEnhancementInfo_1
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			1/1/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	Limit Enhancement Information by Client

	EXEC dbo.usp_IPartner_Service_GetLimitEnhancementInfo_1 'AJYC',''

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Service_GetLimitEnhancementInfo_1]
	@SubBroker VARCHAR(10)
	,@PartyCode VARCHAR(10) =''
AS
BEGIN

	SET NOCOUNT ON

	IF(@PartyCode = '')
		SET @PartyCode = NULL

	SELECT
		ClientCode
		,ClientName
		,convert(decimal(18,2),EnterLimit) as EnterLimit
		,Segment
		,convert(varchar,CreatedDT,103)+' ' +convert(char , CreatedDT, 108) as CreatedDT
		,case 
			when limitResponse=1 then 'Success' 
			when(limitResponse=0 and isnull(LimitResponseMesaage,'')='' and isnull(ServerMapped,'')<>'') then 'Limit Updated on Odin Response Awaited' 
			else 'Failed' 
		end as LimitUpdation
	FROM
		[196.1.115.132].LimitEnhancement.dbo.tbl_SBLimitAllocation WITH(NOLOCK)
	WHERE
		SBCode = @SubBroker
		AND ClientCode = isnull(@PartyCode,ClientCode)
	ORDER BY
		CreatedDT DESC

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_ServiceMarket_GetScripTicker
-- --------------------------------------------------
 /*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]

 SP_HELPTEXT usp_IPartner_ServiceMarket_GetScripTicker

 */


/**************************************************************/
/*
	DATE:			12/14/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gets the Scrip Ticker records
					for given SubBroker.

	EXEC dbo.usp_IPartner_ServiceMarket_GetScripTicker 'ET'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_ServiceMarket_GetScripTicker]
	@SubBroker VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON
	SET FMTONLY OFF

	SELECT
		FD.co_code
		,FD.dlyprice_close AS PrevClose
		,FD.dlyprice_date AS PrevDate
		,FD.st_exchng
	INTO 
		#PrevClose
	FROM 
		dbo.IPartner_ScripTicker ST WITH(NOLOCK)
		JOIN [196.1.115.232].FSS_EQUITY.dbo.feed_dlyprice FD WITH(NOLOCK) ON ST.CoCode = FD.co_code

		--[172.31.16.75].FSS_EQUITY.dbo.feed_dlyprice FD WITH(NOLOCK) ON ST.CoCode = FD.co_code
		CROSS APPLY (
					SELECT MAX(dlyprice_date) AS dlyprice_date FROM [196.1.115.232].FSS_EQUITY.dbo.feed_dlyprice BFD WITH(NOLOCK) 
					--[172.31.16.75].FSS_EQUITY.dbo.feed_dlyprice BFD WITH(NOLOCK) 
					WHERE FD.co_code = BFD.co_code AND CONVERT(DATE, FD.dlyprice_date) < CONVERT(DATE, GETDATE()) AND FD.st_exchng = FD.st_exchng --FD.st_exchng = 'BSE'
					) BSE
	WHERE
	FD.dlyprice_date = BSE.dlyprice_Date

	SELECT DISTINCT
		ST.CoCode
		,VSM.lname As ScripName
		--,CONVERT(DECIMAL(24,2), BP.PrevClose) AS BPrevClose
		,CONVERT(DECIMAL(24,2), ISNULL(FBSE.price, BP.PrevClose)) AS BPrice
		,(ISNULL(ISNULL(FBSE.price, BP.PrevClose), 0) - ISNULL(BP.PrevClose, 0)) AS BAbsChg
		--,CONVERT(DECIMAL(24,2), NP.PrevClose) AS NPrevClose
		,CONVERT(DECIMAL(24,2), ISNULL(FNSE.close_price, NP.PrevClose)) AS NPrice
		,(ISNULL(ISNULL(FNSE.close_price, NP.PrevClose), 0) - ISNULL(NP.PrevClose, 0)) AS NAbsChg
		,ST.CreatedDate
	FROM
		dbo.IPartner_ScripTicker ST WITH(NOLOCK)
		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.vw_stock_mst VSM WITH(NOLOCK) ON ST.CoCode = VSM.co_code
		LEFT JOIN [196.1.115.232].FSS_EQUITY.dbo.feed_bselatest FBSE WITH(NOLOCK) ON VSM.sc_code = FBSE.sc_code--[172.31.16.75].FSS_EQUITY.dbo.feed_bselatest FBSE WITH(NOLOCK) ON VSM.sc_code = FBSE.sc_code
		LEFT JOIN [196.1.115.232].FSS_EQUITY.dbo.feed_nselatest FNSE WITH(NOLOCK) ON VSM.cm_symbol = FNSE.symbol--[172.31.16.75].FSS_EQUITY.dbo.feed_nselatest FNSE WITH(NOLOCK) ON VSM.cm_symbol = FNSE.symbol
		LEFT JOIN #PrevClose BP ON VSM.co_code = BP.co_code AND BP.st_exchng = 'BSE'
		LEFT JOIN #PrevClose NP ON VSM.co_code = NP.co_code AND NP.st_exchng = 'NSE'
	WHERE
		ST.SubBroker = @SubBroker
	ORDER BY
		ST.CreatedDate DESC

	DROP TABLE #PrevClose

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_ServiceMarket_InsertScripTicker
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/14/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure inserts and updates records
					in IPartner_ScripTicker table.

	EXEC dbo.usp_IPartner_ServiceMarket_InsertScripTicker 476, 'ET'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_ServiceMarket_InsertScripTicker]
	@CoCode INT
	,@SubBroker VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON
	
	DECLARE @Ct INT = 0

	SELECT @Ct = COUNT(*) FROM IPartner_ScripTicker WITH(NOLOCK) 
	WHERE SubBroker = @SubBroker AND CoCode <> @CoCode

	IF @Ct >= 5
	BEGIN
		--Deleting records other than latest 5
		;WITH TOP5 AS
		(
			SELECT TOP 4 ID FROM IPartner_ScripTicker WITH(NOLOCK)
			WHERE SubBroker = @SubBroker AND CoCode <> @CoCode
			ORDER BY CreatedDate DESC
		)
		DELETE ST
		FROM IPartner_ScripTicker ST
		LEFT OUTER JOIN TOP5 T ON ST.ID = T.ID
		WHERE T.ID IS NULL AND SubBroker = @SubBroker
	END		


	MERGE dbo.IPartner_ScripTicker T
	USING (SELECT @CoCode AS CoCode, @SubBroker AS SubBroker) S
	ON T.CoCode = S.CoCode AND T.SubBroker = S.SubBroker
	WHEN MATCHED THEN
	  UPDATE SET T.CreatedDate = GETDATE()
	WHEN NOT MATCHED BY TARGET THEN
	--WHEN NOT MATCHED BY TARGET AND S.CoCode<>T.CoCode AND S.SubBroker<>T.SubBroker THEN
	  INSERT (CoCode, SubBroker)
	  VALUES (@CoCode, @SubBroker);

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_SubBrokerView_AddSBPayout
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			11/06/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_SubBrokerView_AddSBPayout 'ET'
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_SubBrokerView_AddSBPayout]
	@Comments AS VARCHAR(100) = '',
	@ABLAmt AS VARCHAR(100) = '',
	@ACBPLAmt AS VARCHAR(500) = '',
	@AccessCode AS VARCHAR(100) = '',
	@VendorID AS VARCHAR(100) = '',
	@Company AS VARCHAR(100) = '',
	@PCode AS VARCHAR(100) = '',
	@Location AS VARCHAR(100) = ''
AS
BEGIN

	--IF @Process='AddSBPayout'
	--BEGIN

		DECLARE @code AS VARCHAR(10) = ''
		SELECT	@code = code 
		FROM	[196.1.115.167].remisbpayout.dbo.TBL_MARKINGCODE with(NoLock)


		IF(@PCode = @code AND @PCode <> '0')
		BEGIN
			---add tran
			IF @ABLAmt = 'NaN'
			BEGIN
				SET @ABLAmt = NULL
			END
	
			IF @ACBPLAmt = 'NaN'
			BEGIN
				SET @ACBPLAmt = NULL
			END

			DECLARE @maker AS VARCHAR(300)
			DECLARE @dates AS VARCHAR(60)
			SET @dates = CAST( MONTH (GETDATE()) as varchar(10))+'/'+cast (DAY (GETDATE()) as varchar(10))+'/'+cast(YEAR (getdate())as varchar(10))+' ' +  LTRIM(RIGHT(CONVERT(CHAR(20), CURRENT_TIMESTAMP, 22), 11))
	
			SET @maker = @Location+ ' | '+ @dates + ' | '+@AccessCode
			/*
			--exec [196.1.115.167].remisbpayout.dbo.SP_UPDMARKEDAMT_MOB @FilterData1,@FilterData2,@FilterData3,@maker,@FilterData4,'N',@FilterData5
			*/
			-- BELOW PROCEDURE IS NOT BE EXECUTED WHILE Developing OR Testing. THIS CAN BE EXECUTED ONLY IN PRESENCE OF Hemant Patel
			EXEC [196.1.115.167].remisbpayout.dbo.SP_UPDMARKEDAMT_Ipartner @Comments,@ABLAmt,@ACBPLAmt,@maker,@AccessCode,'N',@VendorID		--Sproc created by Ashok Sharma(MSG) for IPartner usage.
	   
			DECLARE @mark AS VARCHAR(60) = '0.00'
			IF @Company = 'ABL'
			BEGIN
				SET @mark = @ABLAmt
			END
			ELSE
			BEGIN
				SET @mark = @ACBPLAmt
			END
		
			SELECT 'Success' AS 'Status'

		END
		ELSE
		BEGIN
			SELECT 'Please click on Refresh' AS 'Status'
		END
	
	--END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_SubBrokerView_AddSBPayout_bkp20180419
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			11/06/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_SubBrokerView_AddSBPayout 'ET'
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_SubBrokerView_AddSBPayout_bkp20180419]
	@Comments AS VARCHAR(100) = '',
	@ABLAmt AS VARCHAR(100) = '',
	@ACBPLAmt AS VARCHAR(500) = '',
	@AccessCode AS VARCHAR(100) = '',
	@VendorID AS VARCHAR(100) = '',
	@Company AS VARCHAR(100) = '',
	@PCode AS VARCHAR(100) = '',
	@Location AS VARCHAR(100) = ''
AS
BEGIN

	--IF @Process='AddSBPayout'
	--BEGIN

		DECLARE @code AS VARCHAR(10) = ''
		SELECT @code = code FROM [196.1.115.167].remisbpayout.dbo.TBL_MARKINGCODE


		IF(@PCode = @code AND @PCode <> '0')
		BEGIN
			---add tran
			IF @ABLAmt = 'NaN'
			BEGIN
				SET @ABLAmt = NULL
			END
	
			IF @ACBPLAmt = 'NaN'
			BEGIN
				SET @ACBPLAmt = NULL
			END

			DECLARE @maker AS VARCHAR(300)
			DECLARE @dates AS VARCHAR(60)
			SET @dates = CAST( MONTH (GETDATE()) as varchar(10))+'/'+cast (DAY (GETDATE()) as varchar(10))+'/'+cast(YEAR (getdate())as varchar(10))+' ' +  LTRIM(RIGHT(CONVERT(CHAR(20), CURRENT_TIMESTAMP, 22), 11))
	
			SET @maker = @Location+ ' | '+ @dates + ' | '+@AccessCode
			/*
			--exec [196.1.115.167].remisbpayout.dbo.SP_UPDMARKEDAMT_MOB @FilterData1,@FilterData2,@FilterData3,@maker,@FilterData4,'N',@FilterData5
			*/
			-- BELOW PROCEDURE IS NOT BE EXECUTED WHILE Developing OR Testing. THIS CAN BE EXECUTED ONLY IN PRESENCE OF Hemant Patel
			--EXEC [196.1.115.167].remisbpayout.dbo.SP_UPDMARKEDAMT_Ipartner @Comments,@ABLAmt,@ACBPLAmt,@maker,@AccessCode,'N',@VendorID		--Sproc created by Ashok Sharma(MSG) for IPartner usage.
	   
			DECLARE @mark AS VARCHAR(60) = '0.00'
			IF @Company = 'ABL'
			BEGIN
				SET @mark = @ABLAmt
			END
			ELSE
			BEGIN
				SET @mark = @ACBPLAmt
			END
			/*
			insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
			values(@FilterData4,'Remiser payout Payout details: Compny-"'+@FilterData6+'", Marked Amount-"'+@mark+'", Device-"'+@FilterData8+'"',GETDATE())
			*/

			--As discussed with Amit, we are not maintaining our log, so below is commented
			/*
			INSERT INTO IPartner.dbo.IPartner_ActivityLog(UserID, ActivityLog, LogDate)
			VALUES(@AccessCode, 'Remiser payout Payout details: Company-"' + @Company + '", Marked Amount-"' + @mark + '", Device-"' + @Location + '"', GETDATE())
			*/
		
			SELECT 'Success' AS 'Status'

		END
		ELSE
		BEGIN
			SELECT 'Please click on Refresh' AS 'Status'
		END
	
	--END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_IPartner_SubBrokerView_ARPCDetails
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_IPartner_SubBrokerView_ARPCDetails]
(
	@SubBroker VARCHAR(50)
)
AS
BEGIN
	
	--EXEC Usp_IPartner_SubBrokerView_ARPCDetails 'GDS'
	
	Declare @StDate DATE
	Declare @EdDate DATE
	SET @StDate = CASE WHEN MONTH(GETDATE()) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE())) AS VARCHAR(4))+'-04'+'-01')ELSE CONVERT(DATE,CAST(YEAR(GETDATE()) AS VARCHAR(4))+'-04'+'-01') END
	SET @EdDate = EOMONTH(DATEADD(M,-1,DATEADD(M, DATEDIFF(M, 0, GETDATE()), 0)))

	CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@StDate,@EdDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@StDate)),0)
		SET @i = @i+1
	END

	SELECT
		ISNULL(T.Sub_Broker, @SubBroker) AS Sub_Broker
		,ISNULL(T.Total_Traded_Days, 0) AS Total_Traded_Days
		,ISNULL(T.Total_Revenue, 0) AS Total_Revenue
		,ISNULL(T.ARPC, 0) AS ARPC
		,ISNULL(T.Traded_Month, M.[Month]) AS Traded_Month
		,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,M.[Month]),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,M.[Month]),0)),2) AS [Month]
	FROM
		#Month M
		LEFT JOIN
			(	
			SELECT  
				 T.Sub_broker
				,SUM(Total_Traded_Client_Days) AS Total_Traded_Days
				,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue),0)) AS Total_Revenue
				,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue)/SUM(Total_Traded_Client_Days),2)) AS ARPC
				,CAST(T.Trade_Month AS DATE) AS Traded_Month
				--,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)),2) AS [Month]
				FROM tbl_SB_MonthlyRevenue T WITH (NOLOCK)
				WHERE CAST(T.Trade_Month AS DATE) BETWEEN @StDate AND @EdDate
				AND T.sub_broker = @SubBroker
				GROUP BY T.Sub_broker,T.Trade_Month
				--ORDER BY T.Trade_Month
			) T
		ON M.[Month] = T.Traded_Month
		ORDER BY 
			M.[Month]

	DROP TABLE #Month
						
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_IPartner_SubBrokerView_ARPCDetails_V1
-- --------------------------------------------------
--select * from tbl_SB_MonthlyRevenue T WITH (NOLOCK)
--where sub_broker='RVO'
--and Trade_Month='2020-02-01 00:00:00.000'


--Declare 
CREATE PROCEDURE [dbo].[Usp_IPartner_SubBrokerView_ARPCDetails_V1]
(
	@SubBroker VARCHAR(50)='RVO'
)
AS
BEGIN
	
	/*
	EXEC Usp_IPartner_SubBrokerView_ARPCDetails_v1 'RVO'
	exec [Usp_IPartner_SubBrokerView_ARPCDetails_V1_New] 'RVO'
	*/
	Declare @StDate DATE
	Declare @EdDate DATE
	/*
	SET @StDate = CASE WHEN MONTH(GETDATE()) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE())) AS VARCHAR(4))+'-04'+'-01')ELSE CONVERT(DATE,CAST(YEAR(GETDATE()) AS VARCHAR(4))+'-04'+'-01') END
	SET @EdDate = EOMONTH(DATEADD(M,-1,DATEADD(M, DATEDIFF(M, 0, GETDATE()), 0)))
	*/
	SET @StDate = dbo.fn_Get_StartData('YTD')
	SET @EdDate = CONVERT(DATE, GETDATE())


	--select @StDate ,@EdDate 

	CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@StDate,@EdDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@StDate)),0)
		SET @i = @i+1
	END


	--select * from #Month 

	SELECT 
		ISNULL(T.Sub_Broker, @SubBroker) AS Sub_Broker
		,ISNULL(T.Total_Traded_Days, 0) AS Total_Traded_Days
		,ISNULL(T.Total_Revenue, 0) AS Total_Revenue
		,ISNULL(T.ARPC, 0) AS ARPC
		,ISNULL(T.Traded_Month, M.[Month]) AS Traded_Month
		,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,M.[Month]),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,M.[Month]),0)),2) AS [Month]
	FROM
		#Month M
		LEFT JOIN
			(
				SELECT  
					 T.Sub_broker
					,SUM(case when Segment='Equity' then Total_Traded_Client_Days else 0 end) AS Total_Traded_Days
					,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue),0)) AS Total_Revenue
					,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue)/SUM(case when Segment='Equity' then Total_Traded_Client_Days else 0 end),2)) AS ARPC
					,CAST(T.Trade_Month AS DATE) AS Traded_Month
					,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)),2) AS [Month]
					FROM tbl_SB_MonthlyRevenue T WITH (NOLOCK)
					WHERE CAST(T.Trade_Month AS DATE) BETWEEN @StDate AND @EdDate
					AND T.sub_broker = @SubBroker
					GROUP BY T.Sub_broker,T.Trade_Month
					--ORDER BY T.Trade_Month
			) T
		ON M.[Month] = T.Traded_Month
		ORDER BY 
			M.[Month]

	DROP TABLE #Month
				
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_IPartner_SubBrokerView_ARPCDetails_V1_Bkp09Feb2022
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_IPartner_SubBrokerView_ARPCDetails_V1_Bkp09Feb2022]
(
	@SubBroker VARCHAR(50)
)
AS
BEGIN
	
	--EXEC Usp_IPartner_SubBrokerView_ARPCDetails 'GDS'
	
	Declare @StDate DATE
	Declare @EdDate DATE
	/*
	SET @StDate = CASE WHEN MONTH(GETDATE()) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE())) AS VARCHAR(4))+'-04'+'-01')ELSE CONVERT(DATE,CAST(YEAR(GETDATE()) AS VARCHAR(4))+'-04'+'-01') END
	SET @EdDate = EOMONTH(DATEADD(M,-1,DATEADD(M, DATEDIFF(M, 0, GETDATE()), 0)))
	*/
	SET @StDate = dbo.fn_Get_StartData('YTD')
	SET @EdDate = CONVERT(DATE, GETDATE())

	CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@StDate,@EdDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@StDate)),0)
		SET @i = @i+1
	END

	SELECT
		ISNULL(T.Sub_Broker, @SubBroker) AS Sub_Broker
		,ISNULL(T.Total_Traded_Days, 0) AS Total_Traded_Days
		,ISNULL(T.Total_Revenue, 0) AS Total_Revenue
		,ISNULL(T.ARPC, 0) AS ARPC
		,ISNULL(T.Traded_Month, M.[Month]) AS Traded_Month
		,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,M.[Month]),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,M.[Month]),0)),2) AS [Month]
	FROM
		#Month M
		LEFT JOIN
			(
				SELECT  
					 T.Sub_broker
					,SUM(Total_Traded_Client_Days) AS Total_Traded_Days
					,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue),0)) AS Total_Revenue
					,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue)/SUM(Total_Traded_Client_Days),2)) AS ARPC
					,CAST(T.Trade_Month AS DATE) AS Traded_Month
					--,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)),2) AS [Month]
					FROM tbl_SB_MonthlyRevenue T WITH (NOLOCK)
					WHERE CAST(T.Trade_Month AS DATE) BETWEEN @StDate AND @EdDate
					AND T.sub_broker = @SubBroker
					GROUP BY T.Sub_broker,T.Trade_Month
					--ORDER BY T.Trade_Month
			) T
		ON M.[Month] = T.Traded_Month
		ORDER BY 
			M.[Month]

	DROP TABLE #Month
				
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_IPartner_SubBrokerView_ARPCDetails_V1_New
-- --------------------------------------------------
--select * from tbl_SB_MonthlyRevenue T WITH (NOLOCK)
--where sub_broker='RVO'
--and Trade_Month='2020-02-01 00:00:00.000'


--Declare 
CREATE PROCEDURE [dbo].[Usp_IPartner_SubBrokerView_ARPCDetails_V1_New]
(
	@SubBroker VARCHAR(50)='RVO'
)
AS
BEGIN
	
	/*
	EXEC Usp_IPartner_SubBrokerView_ARPCDetails_v1 'RVO'
	exec [Usp_IPartner_SubBrokerView_ARPCDetails_V1_New] 'RVO'
	*/
	Declare @StDate DATE
	Declare @EdDate DATE
	/*
	SET @StDate = CASE WHEN MONTH(GETDATE()) BETWEEN 1 AND 3 THEN CONVERT(DATE,CAST(YEAR(DATEADD(YY,-1,GETDATE())) AS VARCHAR(4))+'-04'+'-01')ELSE CONVERT(DATE,CAST(YEAR(GETDATE()) AS VARCHAR(4))+'-04'+'-01') END
	SET @EdDate = EOMONTH(DATEADD(M,-1,DATEADD(M, DATEDIFF(M, 0, GETDATE()), 0)))
	*/
	SET @StDate = dbo.fn_Get_StartData('YTD')
	SET @EdDate = CONVERT(DATE, GETDATE())


	--select @StDate ,@EdDate 

	CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@StDate,@EdDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@StDate)),0)
		SET @i = @i+1
	END


	--select * from #Month 

	SELECT 
		ISNULL(T.Sub_Broker, @SubBroker) AS Sub_Broker
		,ISNULL(T.Total_Traded_Days, 0) AS Total_Traded_Days
		,ISNULL(T.Total_Revenue, 0) AS Total_Revenue
		,ISNULL(T.ARPC, 0) AS ARPC
		,ISNULL(T.Traded_Month, M.[Month]) AS Traded_Month
		,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,M.[Month]),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,M.[Month]),0)),2) AS [Month]
	FROM
		#Month M
		LEFT JOIN
			(
				SELECT  
					 T.Sub_broker
					,SUM(case when Segment='Equity' then Total_Traded_Client_Days else 0 end) AS Total_Traded_Days
					,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue),0)) AS Total_Revenue
					,CONVERT(DECIMAL(20,2),ROUND(SUM(T.NettoSB_Revenue)/SUM(case when Segment='Equity' then Total_Traded_Client_Days else 0 end),2)) AS ARPC
					,CAST(T.Trade_Month AS DATE) AS Traded_Month
					,CONVERT(VARCHAR(3),DATENAME(MONTH,DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)))+''''+ RIGHT(YEAR(DATEADD(M,DATEDIFF(M,0,T.Trade_Month),0)),2) AS [Month]
					FROM tbl_SB_MonthlyRevenue T WITH (NOLOCK)
					WHERE CAST(T.Trade_Month AS DATE) BETWEEN @StDate AND @EdDate
					AND T.sub_broker = @SubBroker
					GROUP BY T.Sub_broker,T.Trade_Month
					--ORDER BY T.Trade_Month
			) T
		ON M.[Month] = T.Traded_Month
		ORDER BY 
			M.[Month]

	DROP TABLE #Month
				
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_IPartner_SubBrokerView_ARPCDetails_V1_New08June2018
-- --------------------------------------------------

CREATE   Procedure [dbo].[Usp_IPartner_SubBrokerView_ARPCDetails_V1_New08June2018]
(
--@SubBroker Varchar(200),
--@Period varchar(200)
	@SubBroker VARCHAR(20),
	@Type VARCHAR(3) = NULL,
	@Month VARCHAR(20) = NULL,
	@BktYear VARCHAR(2) = NULL

)
as
Begin  

--exec Usp_IPartner_SubBrokerView_ARPCDetails_V1_New08June2018 'DDVM','YTD',null,''
--Declare @SubBroker varchar(1000)= 'DDVM'


Declare @SDate Datetime ,@EDate Datetime 

Select @SDate=[dbo].[fn_Get_StartData] (@Type)
,@EDate=convert(date,getdate())

Print @SDate
Print @EDate


CREATE TABLE #Month
	(
		[Month] DATE
	)

	DECLARE @i INT = 0
	WHILE(@i <= DATEDIFF(M,@SDate,@EDate))
	BEGIN			
		INSERT INTO #Month 
		SELECT DATEADD(M,DATEDIFF(M,0,DATEADD(M,@i,@SDate)),0)
		SET @i = @i+1
	END


	--Select * from #Month 


	SELECT @SubBroker Sub_broker,
			CONVERT(VARCHAR(3),DATENAME(MONTH,M.[Month]))+''''+ RIGHT(YEAR(M.[Month]),2) AS [MONTH]
			,ISNULL(D.NoOfClients, 0) AS Total_Traded_Days
			,remi_share Total_Revenue
			,M.Month Trade_Month
			,ISNULL(remi_share,0)/D.NoOfClients AS  ARPC
		FROM
		#Month M
		LEFT JOIN (
				SELECT 
					DATEADD(M,DATEDIFF(M,0, sauda_date),0) AS [Month]
					,COUNT(distinct CLIENT) AS NoOfClients
					,SUM(remi_share) remi_share
				FROM  
					Daily_sharing DS WITH (NOLOCK)
				WHERE
					DS.sb=@SubBroker
					and angel_share>0
				GROUP BY 
						DATEADD(M,DATEDIFF(M,0, DS.sauda_date),0)
				) D
		ON M.[Month] = D.[Month]
		ORDER BY M.[Month]


Drop table #Month

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_SubBrokerView_GetSBPayoutSummery
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			11/02/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_IPartner_SubBrokerView_GetSBPayoutSummery 'ET'
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_SubBrokerView_GetSBPayoutSummery]
	@AccessCode AS VARCHAR(100) = ''			--@FilterData1
AS
BEGIN

	--IF @Process='GETSBPAYOUTSUMMERY'
	--BEGIN
		--exec [196.1.115.167].remisbpayout.dbo.USP_SbRiskPayoutMarking_Mob @FilterData1
		EXEC [196.1.115.167].remisbpayout.dbo.USP_SbRiskPayoutMarking_Mob @AccessCode
		--Above sproc does not insert any record or send any info to SUB_BROKER OR CLIENT
	--END 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_IPartner_SubBrokerView_RevenueDetails
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_IPartner_SubBrokerView_RevenueDetails]
(
 @subBroker VARCHAR(50)
)
 
 AS
 BEGIN
		
		--EXEC Usp_IPartner_SubBrokerView_RevenueDetails @subBroker ='ET'
		

	
		;WITH YTDRevenue
		AS
		(
			SELECT  
					 T.Sub_broker
					,T.Segment
					,SUM(T.NettoSB_Revenue) AS YTD_NettoSB_Revenue
			
			FROM tbl_SB_MonthlyRevenue T WITH (NOLOCK)
			
			WHERE CAST(t.Trade_Month AS DATE) BETWEEN CAST(DATEADD(M,-12,DATEADD(M, DATEDIFF(M, 0, GETDATE()-1), 0))AS DATE)  
			AND EOMONTH(DATEADD(M, DATEDIFF(M, 0, GETDATE()-1),0)) 
			AND T.sub_broker = @subBroker 
			GROUP BY T.Sub_broker,T.Segment
		
		),MTDRevenue
		As
		(
					SELECT  
					 T.Sub_broker
					,T.Segment
					,SUM(T.NettoSB_Revenue) AS MTD_NettoSB_Revenue
			
			FROM tbl_SB_MonthlyRevenue T WITH (NOLOCK)
			WHERE  CAST(T.Trade_Month AS DATE) BETWEEN CAST(DATEADD(M,0,DATEADD(M, DATEDIFF(M, 0, GETDATE()-1), 0))AS DATE)   
			AND EOMONTH(DATEADD(M, DATEDIFF(M, 0, GETDATE()-1),0)) 
			AND T.sub_broker =  @subBroker  
			GROUP BY T.Sub_broker,T.Segment
		)
		
		SELECT	 Y.sub_broker
				,Y.Segment
				,CONVERT(DECIMAL(20,2),ROUND(ISNULL(Y.YTD_NettoSB_Revenue,0),2)) AS YTD_SB_Revenue
				,CONVERT(DECIMAL(20,2),ROUND(ISNULL(M.MTD_NettoSB_Revenue,0),2)) AS MTD_SB_Revenue
			
		FROM YTDRevenue Y
		LEFT JOIN MTDRevenue M
		ON Y.sub_broker= M.sub_broker
		AND Y.Segment= M.Segment

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IPartner_Utility_GetScripPrice
-- --------------------------------------------------
/*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]

 SP_HELPTEXT usp_IPartner_Utility_GetScripPrice



*/



/**************************************************************/
/*
	DATE:			04/02/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	This procedure gets the Scrip Price wiht Absolute 
					change and percentage change.

	EXEC dbo.usp_IPartner_Utility_GetScripPrice 476

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_IPartner_Utility_GetScripPrice]
	@CoCode INT
AS
BEGIN

	SET NOCOUNT ON
	SET FMTONLY OFF

	SELECT
		FD.co_code
		,FD.dlyprice_close AS PrevClose
		,FD.dlyprice_date AS PrevDate
		,FD.st_exchng
	INTO 
		#PrevClose
	FROM 
		--[172.31.16.75].FSS_EQUITY.dbo.feed_dlyprice FD WITH(NOLOCK)
		[196.1.115.232].FSS_EQUITY.dbo.feed_dlyprice FD WITH(NOLOCK)
		CROSS APPLY (
					SELECT MAX(dlyprice_date) AS dlyprice_date FROM [196.1.115.232].FSS_EQUITY.dbo.feed_dlyprice BFD WITH(NOLOCK) 
					--[172.31.16.75].FSS_EQUITY.dbo.feed_dlyprice BFD WITH(NOLOCK) 
					WHERE FD.co_code = BFD.co_code AND CONVERT(DATE, FD.dlyprice_date) < CONVERT(DATE, GETDATE()) AND FD.st_exchng = FD.st_exchng --FD.st_exchng = 'BSE'
					) BSE
	WHERE
	FD.dlyprice_date = BSE.dlyprice_Date
	and FD.co_code = @CoCode


	SELECT DISTINCT
		VSM.Co_Code
		,VSM.lname As ScripName
		,CONVERT(DECIMAL(24,2), ISNULL(FBSE.price, BP.PrevClose)) AS BPrice
		,(ISNULL(ISNULL(FBSE.price, BP.PrevClose), 0) - ISNULL(BP.PrevClose, 0)) AS BAbsChg
		--,BAbsChg*100/BPrice AS BPctChg
		,CONVERT(DECIMAL(24,2), ((ISNULL(ISNULL(FBSE.price, BP.PrevClose), 0) - ISNULL(BP.PrevClose, 0)))*100/(CONVERT(DECIMAL(24,2), ISNULL(FBSE.price, BP.PrevClose)))) AS BPctChg
		,CONVERT(DECIMAL(24,2), ISNULL(FNSE.close_price, NP.PrevClose)) AS NPrice
		,(ISNULL(ISNULL(FNSE.close_price, NP.PrevClose), 0) - ISNULL(NP.PrevClose, 0)) AS NAbsChg
		--,NAbsChg*100/NPrice AS NPctChg
		,CONVERT(DECIMAL(24,2), (ISNULL(ISNULL(FNSE.close_price, NP.PrevClose), 0) - ISNULL(NP.PrevClose, 0))*100/(CONVERT(DECIMAL(24,2), ISNULL(FNSE.close_price, NP.PrevClose)))) AS NPctChg
		,VSM.cm_symbol AS NSymbol, VSM.sc_code as BSymbol
	FROM
		[172.31.16.75].ANGEL_WMS.dbo.vw_stock_mst VSM WITH(NOLOCK) --ON ST.CoCode = VSM.co_code
		LEFT JOIN /*[172.31.16.75]*/[196.1.115.232].FSS_EQUITY.dbo.feed_bselatest FBSE WITH(NOLOCK) ON VSM.sc_code = FBSE.sc_code
		LEFT JOIN /*[172.31.16.75]*/[196.1.115.232].FSS_EQUITY.dbo.feed_nselatest FNSE WITH(NOLOCK) ON VSM.cm_symbol = FNSE.symbol
		LEFT JOIN #PrevClose BP ON VSM.co_code = BP.co_code AND BP.st_exchng = 'BSE'
		LEFT JOIN #PrevClose NP ON VSM.co_code = NP.co_code AND NP.st_exchng = 'NSE'
	WHERE
		VSM.co_code = @CoCode

	DROP TABLE #PrevClose


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IsFileExists
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_IsFileExists]  
(  
	@FileName       VARCHAR(200)
)  
AS  
BEGIN  
  DECLARE @Exists INT
  IF EXISTS(SELECT FileName FROM IPODocumentUpload WHERE FileName = @FileName)
                        
  BEGIN
            SET @Exists = 1
			SELECT @Exists AS Status
  END
  ELSE
  BEGIN
            SET @Exists = 0
  
	        SELECT @Exists AS Status
  END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Job_Get_Avg_Payout_For_All_Subbroker
-- --------------------------------------------------
create PROCEDURE [dbo].[Usp_Job_Get_Avg_Payout_For_All_Subbroker]
AS
BEGIN
Declare   
@StDate Date,@EdDate Date

SET @StDate  = DATEADD(YEAR,-1,GETDATE())
SET	@EdDate  = GETDATE()

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE tbl_Category_Wise_Average_Bussiness_Consulting_Prev

INSERT INTO tbl_Category_Wise_Average_Bussiness_Consulting_Prev
SELECT * FROM tbl_Category_Wise_Average_Bussiness_Consulting WITH (NOLOCK)
		
DROP SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn

CREATE SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn for tbl_Category_Wise_Average_Bussiness_Consulting_Prev


--------------------------Original Table Insert------------------

TRUNCATE TABLE tbl_Category_Wise_Average_Bussiness_Consulting
-----------------------------------------------------------------

------------------Calculate Client Payout age wise------------------------------------------------------------------------------

SELECT Category,SUB_Broker,Startofmonth, ClientAge,Payout,ActiveFrom
INTO #Client_Payout
FROM
 
(Select 
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)) AS Startofmonth,
	--(DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom)) AS AgeInMonth,
	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END AS ClientAge,
	
	SUM(DISTINCT GrossBrokRev) - SUM(DISTINCT NetBrokRev) AS Payout,
	'' ActiveFrom
	
from 
	--#DATA pr with (NOLOCK) 
	iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SYN pr with (NOLOCK) 


GROUP BY
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)),

	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END
	
) AS A


Order By Startofmonth desc


----------------------------------------------------------------------------------------------------------------------------------

--------------------Calculate Client Count age wise-------------------------------------------------------------------------------

SELECT Category,SUB_Broker,Cnt, Startofmonth, ClientAge, ActiveFrom
INTO #Client_Count
FROM 

(Select 
	Category,
	SUB_Broker,
	COUNT(DISTINCT pr.ClientCode) Cnt,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)) AS Startofmonth,
	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END AS ClientAge,
	'' ActiveFrom
	
	
from 
	--#DATA pr with (NOLOCK) 
	iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SYN pr with (NOLOCK) 
	
GROUP BY
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)),

	CASE WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 12 Then '1'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 24 THEN '2'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 36 THEN '3'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 48 Then '4'
	WHEN ((DATEPART(YEAR,Startofmonth) * 12 + DatePart(Month,Startofmonth)) - (DATEPART(YEAR,pr.ActiveFrom) * 12 + DatePart(Month,pr.ActiveFrom))) < 60 THEn '5'
	ELSE '5+' END
	
) AS A


----------------------------------------------------------------------------------------------------------------------------------

--------------------Get Maximum Available Trade Days Month Wise--------------------------------------------------------------------

Select 
	Category,
	SUB_Broker,
	DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth)) AS Startofmonth,
	MAX(pr.availableTradedays) AS availableTradedays
INTO #Available_Trade_days
FROm 
	--#DATA pr with (NOLOCK) 
	iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_SYN pr with (NOLOCK) 

Group By Category,SUB_Broker,DATENAME(Month,Startofmonth) + ' - ' + CONVERT(VARCHAR(100),DATEPART(YEAR,Startofmonth))

----------------------------------------------------------------------------------------------------------------------------------

--------------------Calculate Age Payout------------------------------------------------------------------------------------------

Select Category,SUB_Broker,Startofmonth, ClientAge, AgePayout, ActiveFrom
INTO #Calculate_Avg_Payout 
from (Select
			t.Category,
			t.SUB_Broker,
			t.Startofmonth,
			t.ClientAge, 
			(ISNULL(t.Payout,1) / CASE WHEN t1.Cnt=0 THEN 1 ELSE ISNULL(t1.Cnt,1) END / CASE WHEN t2.availableTradedays=0 THEN 1 ELSE ISNULL(t2.availableTradedays,1) END) *245 AS AgePayout,
			'' ActiveFrom
		FROM 
			#Client_Payout t
			INNER JOIN #Client_Count t1 ON t.Startofmonth = t1.Startofmonth AND t.ClientAge = t1.ClientAge AND t.SUB_Broker = t1.SUB_Broker
			INNER JOIN #Available_Trade_days t2 ON t.Startofmonth = t2.Startofmonth AND t.SUB_Broker = t2.SUB_Broker
	 ) AS A


-----------------------------------------------------------------------------------------------------------------------------------

--------------------Calculate Average Age Payout-----------------------------------------------------------------------------------

Select 
	Category,
	SUB_Broker,
	ClientAge,
	AVG(AgePayout) AS AvgPayout,
	'' ActiveFrom
INTO #Client_Avg_Payout
from 
	#Calculate_Avg_Payout
Where
	--SUB_Broker = 'ICFS'	AND 
AgePayout >0
GROUP By
	Category,
	SUB_Broker,
	 ClientAge

-----------------------------------------------------------------------------------------------------------------------------------
INSERT INTO tbl_Category_Wise_Average_Bussiness_Consulting
Select Category,AvgPayout,ClientAge,SUB_Broker,ActiveFrom  from #Client_Avg_Payout

DROP SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn

CREATE SYNONYM tbl_Category_Wise_Average_Bussiness_Consulting_syn for tbl_Category_Wise_Average_Bussiness_Consulting

Drop Table #Client_Avg_Payout, #Client_Payout, #Client_Count,#Calculate_Avg_Payout,#Available_Trade_days

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Job_Get_Partyinfobrokmonthwise_Data_Bussiness_Consulting
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Job_Get_Partyinfobrokmonthwise_Data_Bussiness_Consulting]
AS
BEGIN
declare @StDate datetime,@EdDate Datetime , @SOM DATETIME=NULL, @StartOfFinDate DATETIME

SET @StDate  = DATEADD(YEAR,-1,GETDATE())
SET	@EdDate  = GETDATE()
DECLARE @Month INT
SELECT @Month =DATEDIFF(M,@StDate,@EdDate)

--------------------------Prev Table Insert------------------
		
TRUNCATE TABLE iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev

INSERT INTO iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev
SELECT * FROM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting WITH (NOLOCK)
		
DROP SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn

CREATE SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn for iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev


--------------------------Original Table Insert------------------

TRUNCATE TABLE iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-----------------------------------------------------------------


Create Table #AllCategorySubBroker_Age_revenue
(
	Sub_Broker Varchar(200),
	Category Varchar(20)
	
)
INSERT INTO #AllCategorySubBroker_Age_revenue
SELECT SBTAG,SbCat
FROM [196.1.115.159].Ispacescorecard.dbo.VW_SubBroker_Details with (NOLOCK) 
WHERE ISNULL(Branch,'')<>'MFSB'	

INSERT INTO iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
select * from [196.1.115.159].Ispacescorecard.dbo.iSpc_Master_SCard_partyinfobrokmonthwise pr with (NOLOCK)
inner join #AllCategorySubBroker_Age_revenue a
ON a.Sub_Broker=pr.SBCODE collate DATABASE_DEFAULT
where StartOfMonth between @StDate AND @EdDate --AND SBCODE=@subBroker


DROP SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn

CREATE SYNONYM iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_syn for iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting

DROP TABLE #AllCategorySubBroker_Age_revenue

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_LMS_registration
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_LMS_registration]
	( 
		@SubBroker VARCHAR(50),
		@Message VARCHAR(100),
		@Status VARCHAR(10),
		@Flag Varchar (20)
	)

	--EXEC [Usp_LMS_registration] @SubBroker='',@Message='',@SubBroker='',@Status = ''

	AS
	BEGIN

	IF @Flag = 'Registration'
	Begin 

	IF exists (select 1 from LMS_registration where sb_code = @SubBroker)
	Begin

	UPDATE LMS_registration SET status = @status , message = @message
	where sb_code = @SubBroker

	select 'Update' as Msg,@status as 'Status'

	End

	Else
	Begin
	INSERT INTO LMS_registration
	(	 SB_Code
		,Message
		,Status
		,Created_dt
	)
				
	VALUES (@SubBroker,@Message,@Status,GETDATE())
	
	select 'Insert' as Msg, @status as 'Status'
	END
	End

	If @Flag = 'CHeck'

	if exists (select 1 from LMS_registration where sb_code = @SubBroker)
	begin 
	
	select 'Data Exists' as Msg, Status  from LMS_registration where sb_code = @SubBroker

	end

	Else 

	Begin

	select 'Not Exists' as Msg,'' as  Status  
	
	End

	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_LMSAPIIssue
-- --------------------------------------------------
--exec usp_LMSAPIIssue 'NXT'
CREATE  proc [dbo].[usp_LMSAPIIssue] 
( 
@profile varchar(50)
)
as

begin
declare @Message varchar(50)=''
begin try
EXEC msdb.dbo.sp_send_dbmail  

						@profile_name =@profile,  

						@recipients='NXTCSO@angelbroking.com',

						--@copy_recipients=@CC,

						--@blind_copy_recipients='Yogesh.rewatkar@angelbroking.com;rewansh.jain@angelbroking.com;darshi.shah@angelbroking.com',

						@blind_copy_recipients='vaibhav.shah@angelbroking.com;anand.singh@angelbroking.com',

						@subject = 'LMS API not Working',  

						@body = 'LMS API is not working Please conatct Z- Axis Team',

						@body_format = 'Text'

						set @Message='success'
						select @Message as ErrorMessage
end try
begin catch
set @Message='failed'
select @Message as ErrorMessage
end catch
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_LMSDetail_Mail_Bkp18Oct2019
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_LMSDetail_Mail_Bkp18Oct2019]
AS
BEGIN


DECLARE @xml NVARCHAR(MAX)
DECLARE @body NVARCHAR(MAX)

SET @xml = CAST(( SELECT [SrNo] AS 'td','',[LeadDate] AS 'td','', [ProspectName] AS 'td','', [Mobile] AS 'td','', [Email] AS 'td','', [City] AS 'td','', [Status] AS 'td'
FROM [NXT].[dbo].[LMS_NXT_LeadForm]
FOR XML PATH('tr'), ELEMENTS ) AS NVARCHAR(MAX))




SET @body ='<html><body><H3>
Dear Sir  <br>
Please find the below prospect leads sourced on <date> for your reference and further action on the same:</H3>
<table border = 1> 
<tr>
<th> SrNo </th> <th> LeadDate </th> <th> ProspectName </th><th> Mobile </th><th> Email </th><th> City </th><th> Status </th></tr>
'

SET @body = @body + @xml +'</table>

<p>
 Request you to please review this information and to update the status or to take any appropriate action on the lead refer path -- NXT > Sales > LMS section.
<br><br>
Thanks & Regards,<br>
Team NXT

 </p>







</body></html>'



	EXEC msdb.dbo.SP_SEND_DBMAIL
		@profile_name = 'NXT',
		@recipients = 'yogesh.rewatkar@angelbroking.com',
		--@recipients = 'yogesh.rewatkar@angelbroking.com',
		--@copy_recipients='anil.singh@angelbroking.com',
		@subject = 'LMS Details',
		@body = @Body   ,
		@body_format = 'HTML'

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_LogReport_ErrorLog_BeeNXT_Weekly
-- --------------------------------------------------
----132  Risk
--Create table tbl_Weekly_GenerateFile_BeeNXT 
--(
-- [SB tag]  varchar (50),
-- [Access Date/Time] varchar (50),	
-- IPadress  varchar (50),	
-- [Report Type]  varchar (50),	
-- [Report SubType]  varchar (50),
-- [Report path]  varchar (1000)
--) 

--truncate table tbl_Weekly_GenerateFile


CREATE procedure [dbo].[usp_LogReport_ErrorLog_BeeNXT_Weekly]
as
begin

	TRUNCATE TABLE tbl_Weekly_GenerateFile_BeeNXT 


	Insert into tbl_Weekly_GenerateFile_BeeNXT 
	select 'SB tag'	,'Access Date/Time',	'IPadress'	,'Report Type',	'Report SubType'	,'Report path'

   insert into tbl_Weekly_GenerateFile_BeeNXT
   EXEC [172.31.16.95].nxt.dbo.usp_Sub_Broker_Click_Log_Weekly_GenerateFile_BeeNXT


   DECLARE @filename1 as varchar(100)                                              
   --select @filename1='\\196.1.115.182\upload1\CodeCreationFileFormat'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'              
   select @filename1='\\172.29.19.16\Common_Folder\NXT_LogReport\BeeNXT_LogReport'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                   
             
			         
   DECLARE @BCPCOMMAND VARCHAR(250)                          
   DECLARE @FILENAME VARCHAR(250)                   
   declare @s1 as varchar(max)                  
              
   SET @FILENAME = '\\172.29.19.16\Common_Folder\NXT_LogReport\BeeNXT_LogReport'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                                                                                 
   --SET @FILENAME = '\\196.1.115.182\upload1\OmnesysFileFormat\CodeCreationFileFormat'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                 
               
   SET @BCPCOMMAND = 'BCP "  SELECT * from risk.dbo.tbl_Weekly_GenerateFile_BeeNXT" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -S196.1.115.132 -Uinhouse -Pinh6014'                          
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND      

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_LogReport_ErrorLog_BeeNXT_Weekly_UAT
-- --------------------------------------------------
----132  Risk
--Create table tbl_Weekly_GenerateFile_BeeNXT 
--(
-- [SB tag]  varchar (50),
-- [Access Date/Time] varchar (50),	
-- IPadress  varchar (50),	
-- [Report Type]  varchar (50),	
-- [Report SubType]  varchar (50),
-- [Report path]  varchar (1000)
--) 

--truncate table tbl_Weekly_GenerateFile


CREATE procedure [dbo].[usp_LogReport_ErrorLog_BeeNXT_Weekly_UAT]
as
begin

	TRUNCATE TABLE tbl_Weekly_GenerateFile_BeeNXT 


	Insert into tbl_Weekly_GenerateFile_BeeNXT 
	select 'SB tag'	,'Access Date/Time',	'IPadress'	,'Report Type',	'Report SubType'	,'Report path'

   insert into tbl_Weekly_GenerateFile_BeeNXT
   EXEC [172.31.16.42].Ipartner.dbo.usp_Sub_Broker_Click_Log_Weekly_GenerateFile_BeeNXT_Uat



   DECLARE @filename1 as varchar(100)                                              
   --select @filename1='\\196.1.115.182\upload1\CodeCreationFileFormat'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'              
   select @filename1='\\172.29.19.16\Common_Folder\NXT_LogReport\BeeNXT_UAT_LogReport'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                   
             
			         
   DECLARE @BCPCOMMAND VARCHAR(250)                          
   DECLARE @FILENAME VARCHAR(250)                   
   declare @s1 as varchar(max)                  
              
   SET @FILENAME = '\\172.29.19.16\Common_Folder\NXT_LogReport\BeeNXT_UAT_LogReport'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.csv'                                                                                 
   --SET @FILENAME = '\\196.1.115.182\upload1\OmnesysFileFormat\CodeCreationFileFormat'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                 
               
   SET @BCPCOMMAND = 'BCP "  SELECT * from risk.dbo.tbl_Weekly_GenerateFile_BeeNXT" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -S196.1.115.132 -Uinhouse -Pinh6014'                          
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND      

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_LumpsumSIP_Performance_Mail_Main
-- --------------------------------------------------
--EXEC [spDailyFamilyTradeDetailsLog_Mail_23052019_11]


CREATE procedure [dbo].USP_LumpsumSIP_Performance_Mail_Main
as
begin

Set NOCOUNT ON 
--Declare @Cnt INT

DECLARE    @tab char(1) = CHAR(9)

Declare @BodyContent Varchar(max)
,@subject Varchar(2000)

Set @subject='MF campaign daily data.(MAHA MARCH LUMSUM & SIP)'


Set @BodyContent=
'Hello All,

					Please find the attachment for LumpsumSIP Performance.'


EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
@recipients = 'paras.joshi@angelbroking.com;jogendar.dhoble@angelbroking.com;mayur.shinde@angelbroking.com;reshma.koyande@angelbroking.com;vikas.raibole@angelbroking.com',
@blind_copy_recipients='yogesh.rewatkar@angelbroking.com',

--Declare  @query  varchar(MAX)

	@query = 'SET NOCOUNT ON ;

	  	EXEC [196.1.115.132].risk.dbo.USP_LumpsumSIP_Performance_Mail
		 
 
        SET NOCOUNT OFF ' 
			,


				
@subject = @subject,
  @body=@BodyContent,
  @attach_query_result_as_file = 1,
@query_attachment_filename = 'LumpsumSIP_Performance.xls',
@query_result_header = 0,
--@query_result_separator = ',',
@query_result_separator=@tab,
@query_result_no_padding = 1,
--@exclude_query_output = 1,
@from_address   = 'nxt@angelbroking.com'


				
   

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mandateapprove_notification
-- --------------------------------------------------

CREATE proc [dbo].[usp_mandateapprove_notification]    
  (    
 @sb varchar(50),    
 @name varchar(100)    
  )    
 as  
 /*  
 created by : Prasad Kharade  
 Desc: Inserts in table [tbl_NotificationBEENXT] which sends notification to SB on mandate approval.  
 */    
  IF NOT EXISTS(select COUNT(1) from [tbl_NotificationBEENXT] where convert(date,CreatedDate) = convert(date,getdate()) 
  and CampaignId = 'Mandate' and sub_broker = @sb)
  BEGIN  
	 begin    
	 INSERT INTO [dbo].[tbl_NotificationBEENXT](sub_broker,NotificationText,NotificationType,Individualview,IndividualviewDate,    
	 Notification_9,Notification_Date_9,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,CLTCODEDupl,url,area,controller,action,CampaignId)    
	    
	 select @sb as sub_broker,'Your client ' + UPPER(@name) +' mandate is set-up successfully' as NotificationText,'Individual' as NotificationType,  
	 'N' as Individualview,getdate() as IndividualviewDate,  
	 'Y' as [Notification_9],getdate() as [Notification_Date_9],'' as CreatedBy,getdate() as CreatedDate,'' as UpdatedBy,getdate() as UpdatedDate,'' as CLTCODEDupl,'NXT' as [url],  
	 '' as area,'Home' as controller,'index' as [action],'Mandate' as CampaignId      
	 end 
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mandateapprove_notification_05072021
-- --------------------------------------------------

CREATE proc [dbo].[usp_mandateapprove_notification_05072021]    
  (    
 @sb varchar(50),    
 @name varchar(100)    
  )    
 as  
 /*  
 created by : Prasad Kharade  
 Desc: Inserts in table [tbl_NotificationBEENXT] which sends notification to SB on mandate approval.  
 */    
 begin    
 INSERT INTO [dbo].[tbl_NotificationBEENXT](sub_broker,NotificationText,NotificationType,Individualview,IndividualviewDate,    
 Notification_9,Notification_Date_9,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,CLTCODEDupl,url,area,controller,action,CampaignId)    
    
 select @sb as sub_broker,'Your client ' + UPPER(@name) +' mandate is set-up successfully' as NotificationText,'Individual' as NotificationType,  
 'N' as Individualview,getdate() as IndividualviewDate,  
 'Y' as [Notification_9],getdate() as [Notification_Date_9],'' as CreatedBy,getdate() as CreatedDate,'' as UpdatedBy,getdate() as UpdatedDate,'' as CLTCODEDupl,'NXT' as [url],  
 '' as area,'Home' as controller,'index' as [action],'Mandate' as CampaignId      
 end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_mandateapprove_notification_NXT
-- --------------------------------------------------
CREATE proc [dbo].[usp_mandateapprove_notification_NXT]    
  (    
 @sb varchar(50),    
 @name varchar(100)    
  )    
 as  
 /*  
 created by : Prasad Kharade  
 Desc: Inserts in table [tbl_NotificationBEENXT] which sends notification to SB on mandate approval.  
 */    
 begin    
 INSERT INTO [dbo].[tbl_NotificationNXT](sub_broker,NotificationText,NotificationType,Individualview,IndividualviewDate,    
 Notification_9,Notification_Date_9,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,CLTCODEDupl,url,area,controller,action,CampaignId)    
    
 select @sb as sub_broker,'Your client ' + UPPER(@name) +' mandate is set-up successfully' as NotificationText,'Individual' as NotificationType,  
 'N' as Individualview,getdate() as IndividualviewDate,  
 'Y' as [Notification_9],getdate() as [Notification_Date_9],'' as CreatedBy,getdate() as CreatedDate,'' as UpdatedBy,getdate() as UpdatedDate,'' as CLTCODEDupl,'NXT' as [url],  
 '' as area,'Home' as controller,'index' as [action],'Mandate' as CampaignId      
 end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_aLLCount
-- --------------------------------------------------
--exec NXT.dbo.usp_MF_Dash_aLLCount @SubBroker = 'EMT', @UserType = 'Agent', @ReportType = 'All', @Period = 'YTD'    
--GO    
    
--EXEC [Usp_GetFundWiseSchemeWiseAll_v3] 'ET'    
    
    
    
    
CREATE  PROCEDURE [dbo].[usp_MF_Dash_aLLCount]    
--declare    
--@ReportType as varchar(100),    
 @SubBroker VARCHAR(100), --= 'ET',    
 @UserType as varchar(100), --= 'Agent',    
 @ReportType VARCHAR(10), --= 'All', --- 'All/SIP/Lumsum    
 @Period VARCHAR(5) = 'MTD'    
AS    
/*    
exec dbo.usp_MF_Dash_aLLCount @SubBroker = 'GDS', @UserType = 'Agent', @ReportType = 'All', @Period = 'ITD'    
*/    
BEGIN    
 if object_id('tempdb..#tmp_aum_cnt') is not null    
  drop table #tmp_aum_cnt    
 CREATE table #tmp_aum_cnt    
 (    
  Header varchar(20),    
  subbroker varchar(50),    
  Total float    
 )    
 ---Aum Count    
 insert into #tmp_aum_cnt
 --exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal @UserType, @SubBroker, @Period    
 --exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal 'Agent', 'GDS', 'YTD'    
 EXEC [172.31.16.109].NXT.dbo.[usp_MF_NXT_SubBrokerTotalAUM]  @SubBroker, @Period    
    
 if object_id('tempdb..#tmp_Clientcnt') is not null    
  drop table #tmp_Clientcnt    
 CREATE table #tmp_Clientcnt    
 (    
  account int,    
  havingPortfolio int,    
  MFSegmentActive int,    
  RegisteredInMF int,    
  MFPortfoliioAmount float    
 )    
    
 insert into #tmp_Clientcnt    
 EXEC dbo.[usp_MF_Dash_GetClientCounts] @SubBroker, @ReportType, @Period    
 --EXEC dbo.usp_MF_Dash_GetClientCounts @SubBroker, @ReportType, @Period    
 --EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'    
      
 if object_id('tempdb..#tmp_TransCnt') is not null    
  drop table #tmp_TransCnt    
 CREATE table #tmp_TransCnt    
 (    
  sub_broker varchar(100),    
  purchaseAmount float,    
  SaleAmount Float,    
  NetSale float    
 )    
 insert into #tmp_TransCnt    
 exec [172.31.16.109].MUTUALFund.dbo.usp_MF_Agent_AssetClassWiseCollection @SubBroker,@Period,'Total'    
 --exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal @SubBroker,@Period    
 --exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal 'GDS','MTD'    
     
 declare @sdate varchar(10) , @edate varchar(10)    
     
 select @sdate = CONVERT(char(10), dbo.fn_Get_StartData(@Period) , 103)     
 set @edate = CONVERT(char(10), getdate() , 103)     
    
    
 if object_id('tempdb..#tmp_CommissionCnt') is not null    
  drop table #tmp_CommissionCnt;    
    
 CREATE table #tmp_CommissionCnt    
 (    
  ClientCode varchar(50),    
  ClientName varchar(max),     
  SchemeType varchar(50),    
  SchemeName varchar(max),    
  InvestmentType varchar(20),     
  TrxnDate date,    
  FolioNo varchar(50),     
  PurchaseNAV float,    
  Units float,    
  Amount float,    
  GrossReceipt float,    
  Commission float,    
  RevenueType varchar(50)    
 )    
    
 insert into #tmp_CommissionCnt    
 exec [172.31.16.109].[MutualFund].[dbo].[usp_BillTransaction_Angel_ForIPartner] @AgentCode=@SubBroker,@BillPeriodFrom=@sdate,@BillPeriodTo =@edate    
     
 --select round(sum(Commission), 4) CommissionCnt from #tmp_CommissionCnt    
    
 select @SubBroker as sub_broker,     
 max(Aum_Count) as Aum_Count,     
 max(Client_Count) as Client_Count,    
 CASE WHEN max(Transaction_Count) = 0 THEN MIN(Transaction_Count) ELSE MAX(Transaction_Count) END as Transaction_Count,    
 --max(Transaction_Count) as Transaction_Count,     
 max(Commission_Count) as Commission_Count    
 from    
 (    
  select isnull(Total, 0) as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_aum_cnt     
  union all    
  select 0 as Aum_Count, isnull(account, 0) as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_Clientcnt     
  union all    
  select 0 as Aum_Count, 0 as Client_Count, isnull(NetSale, 0) as Transaction_Count, 0 as Commission_Count from #tmp_TransCnt     
  union all     
  select 0 as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, isnull(round(sum(Commission), 4), 0) as Commission_Count from #tmp_CommissionCnt     
 ) a    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_aLLCount_1
-- --------------------------------------------------
--exec NXT.dbo.usp_MF_Dash_aLLCount @SubBroker = 'EMT', @UserType = 'Agent', @ReportType = 'All', @Period = 'YTD'
--GO

--EXEC [Usp_GetFundWiseSchemeWiseAll_v3] 'ET'




CREATE  PROCEDURE [dbo].[usp_MF_Dash_aLLCount_1]
--declare
--@ReportType as varchar(100),
	@SubBroker VARCHAR(100), --= 'ET',
	@UserType as varchar(100), --= 'Agent',
	@ReportType VARCHAR(10), --= 'All', --- 'All/SIP/Lumsum
	@Period VARCHAR(5) = 'MTD'
AS
/*
exec dbo.usp_MF_Dash_aLLCount @SubBroker = 'EMT', @UserType = 'Agent', @ReportType = 'All', @Period = 'YTD'
*/
BEGIN
	--if object_id('tempdb..#tmp_aum_cnt') is not null
	--	drop table #tmp_aum_cnt
	--CREATE table #tmp_aum_cnt
	--(
	--	Header varchar(20),
	--	subbroker varchar(50),
	--	Total float
	--)
	-----Aum Count
	--insert into #tmp_aum_cnt
	----exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal @UserType, @SubBroker, @Period
	----exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal 'Agent', 'GDS', 'YTD'
	EXEC [172.31.16.109].NXT.dbo.[usp_MF_NXT_SubBrokerTotalAUM]  @SubBroker, @Period

	--Select * from ##main

	if object_id('tempdb..#tmp_Clientcnt') is not null
		drop table #tmp_Clientcnt
	CREATE table #tmp_Clientcnt
	(
		account int,
		havingPortfolio int,
		MFSegmentActive int,
		RegisteredInMF int,
		MFPortfoliioAmount float
	)

	insert into #tmp_Clientcnt
	EXEC dbo.[usp_MF_Dash_GetClientCounts] @SubBroker, @ReportType, @Period
	--EXEC dbo.usp_MF_Dash_GetClientCounts @SubBroker, @ReportType, @Period
	--EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
		
	if object_id('tempdb..#tmp_TransCnt') is not null
		drop table #tmp_TransCnt
	CREATE table #tmp_TransCnt
	(
		sub_broker varchar(100),
		purchaseAmount float,
		SaleAmount Float,
		NetSale float
	)
	insert into #tmp_TransCnt
	exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal @SubBroker,@Period
	--exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal 'GDS','MTD'
	
	declare @sdate varchar(10) , @edate varchar(10)
	
	select @sdate = CONVERT(char(10), dbo.fn_Get_StartData(@Period) , 103) 
	set @edate = CONVERT(char(10), getdate() , 103) 


	if object_id('tempdb..#tmp_CommissionCnt') is not null
		drop table #tmp_CommissionCnt;

	CREATE table #tmp_CommissionCnt
	(
		ClientCode varchar(50),
		ClientName varchar(max), 
		SchemeType varchar(50),
		SchemeName varchar(max),
		InvestmentType varchar(20),	
		TrxnDate date,
		FolioNo	varchar(50), 
		PurchaseNAV float,
		Units float,
		Amount float,
		GrossReceipt float,
		Commission float,
		RevenueType varchar(50)
	)

	insert into #tmp_CommissionCnt
	exec [172.31.16.109].[MutualFund].[dbo].[usp_BillTransaction_Angel_ForIPartner] @AgentCode=@SubBroker,@BillPeriodFrom=@sdate,@BillPeriodTo =@edate
	
	--select round(sum(Commission), 4) CommissionCnt from #tmp_CommissionCnt

	select @SubBroker as sub_broker, 
	max(Aum_Count) as Aum_Count, 
	max(Client_Count) as Client_Count,
	CASE WHEN max(Transaction_Count) = 0 THEN MIN(Transaction_Count) ELSE MAX(Transaction_Count) END as Transaction_Count,
	--max(Transaction_Count) as Transaction_Count, 
	max(Commission_Count) as Commission_Count
	from
	(
		select isnull(Total_AUM, 0) as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from ##Main 
		union all
		select 0 as Aum_Count, isnull(account, 0) as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_Clientcnt 
		union all
		select 0 as Aum_Count, 0 as Client_Count, isnull(NetSale, 0) as Transaction_Count, 0 as Commission_Count from #tmp_TransCnt 
		union all 
		select 0 as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, isnull(round(sum(Commission), 4), 0) as Commission_Count from #tmp_CommissionCnt 
	) a
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_aLLCount_Dealer
-- --------------------------------------------------
-- exec usp_MF_Dash_aLLCount_Dealer 'MMABC001','Agent','All','YTD','Dealer'  
CREATE  PROCEDURE [dbo].[usp_MF_Dash_aLLCount_Dealer]  
 @SubBroker VARCHAR(100), --= 'ET',  
 @UserType as varchar(100), --= 'Agent',  
 @ReportType VARCHAR(10), --= 'All', --- 'All/SIP/Lumsum  
 @Period VARCHAR(5) = 'MTD',  
 @Access_To varchar(10)  
AS  
/*  
exec dbo.usp_MF_Dash_aLLCount @SubBroker = 'GDS', @UserType = 'Agent', @ReportType = 'All', @Period = 'ITD'  
*/  
BEGIN  
      if (@Access_To='SB')  
       begin  
           if object_id('tempdb..#tmp_aum_cnt') is not null  
           drop table #tmp_aum_cnt  
     CREATE table #tmp_aum_cnt  
     (  
      Header varchar(20),  
      subbroker varchar(50),  
      Total float  
     )  
              ---Aum Count  
    insert into #tmp_aum_cnt 
    select '','',0 
    --exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal @UserType, @SubBroker, @Period  
    --exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal 'Agent', 'GDS', 'YTD'  
    --EXEC [172.31.16.109].NXT.dbo.[usp_MF_NXT_SubBrokerTotalAUM]  @SubBroker, @Period  
  
    if object_id('tempdb..#tmp_Clientcnt') is not null  
    drop table #tmp_Clientcnt  
    CREATE table #tmp_Clientcnt  
    (  
     account int,  
     havingPortfolio int,  
     MFSegmentActive int,  
     RegisteredInMF int,  
     MFPortfoliioAmount float  
    )  
  
    insert into #tmp_Clientcnt  
    EXEC dbo.[usp_MF_Dash_GetClientCounts] @SubBroker, @ReportType, @Period  
    --EXEC dbo.usp_MF_Dash_GetClientCounts @SubBroker, @ReportType, @Period  
    --EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'  
    
    if object_id('tempdb..#tmp_TransCnt') is not null  
    drop table #tmp_TransCnt  
    CREATE table #tmp_TransCnt  
    (  
     sub_broker varchar(100),  
     purchaseAmount float,  
     SaleAmount Float,  
     NetSale float  
    )  
    insert into #tmp_TransCnt  
    exec [172.31.16.109].MUTUALFund.dbo.usp_MF_Agent_AssetClassWiseCollection @SubBroker,@Period,'Total'  
    --exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal @SubBroker,@Period  
    --exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal 'GDS','MTD'  
   
    declare @sdate varchar(10) , @edate varchar(10)  
    select @sdate = CONVERT(char(10), dbo.fn_Get_StartData(@Period) , 103)   
    set @edate = CONVERT(char(10), getdate() , 103)   
  
  
    if object_id('tempdb..#tmp_CommissionCnt') is not null  
    drop table #tmp_CommissionCnt;  
  
    CREATE table #tmp_CommissionCnt  
    (  
     ClientCode varchar(50),  
     ClientName varchar(max),   
     SchemeType varchar(50),  
     SchemeName varchar(max),  
     InvestmentType varchar(20),   
     TrxnDate date,  
     FolioNo varchar(50),   
     PurchaseNAV float,  
     Units float,  
     Amount float,  
     GrossReceipt float,  
     Commission float,  
     RevenueType varchar(50)  
    )  
  
    insert into #tmp_CommissionCnt  
    exec [172.31.16.109].[MutualFund].[dbo].[usp_BillTransaction_Angel_ForIPartner] @AgentCode=@SubBroker,@BillPeriodFrom=@sdate,@BillPeriodTo =@edate  
    --select round(sum(Commission), 4) CommissionCnt from #tmp_CommissionCnt  
  
    select @SubBroker as sub_broker,   
    max(Aum_Count) as Aum_Count,   
    max(Client_Count) as Client_Count,  
    CASE WHEN max(Transaction_Count) = 0 THEN MIN(Transaction_Count) ELSE MAX(Transaction_Count) END as Transaction_Count,  
    --max(Transaction_Count) as Transaction_Count,   
    max(Commission_Count) as Commission_Count  
    from  
    (  
     select isnull(Total, 0) as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_aum_cnt   
     union all  
     select 0 as Aum_Count, isnull(account, 0) as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_Clientcnt   
     union all  
     select 0 as Aum_Count, 0 as Client_Count, isnull(NetSale, 0) as Transaction_Count, 0 as Commission_Count from #tmp_TransCnt   
     union all   
     select 0 as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, isnull(round(sum(Commission), 4), 0) as Commission_Count from #tmp_CommissionCnt   
    ) a  
     end  
   else  
         begin  
         if object_id('tempdb..#tmp_aum_cnt_emp') is not null  
      drop table #tmp_aum_cnt_emp  
     CREATE table #tmp_aum_cnt_emp  
     (  
      Header varchar(20),  
      subbroker varchar(50),  
      Total float  
     )  
    ---Aum Count  
    insert into #tmp_aum_cnt_emp  
    --exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal @UserType, @SubBroker, @Period  
    --exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal 'Agent', 'GDS', 'YTD'  
    EXEC [172.31.16.109].NXT.dbo.[usp_MF_NXT_SubBrokerTotalAUM_Dealer]  @SubBroker, @Period  
  
    if object_id('tempdb..#tmp_Clientcnt_emp') is not null  
     drop table #tmp_Clientcnt_emp  
    CREATE table #tmp_Clientcnt_emp  
    (  
     account int,  
     havingPortfolio int,  
     MFSegmentActive int,  
     RegisteredInMF int,  
     MFPortfoliioAmount float  
    )  
  
    insert into #tmp_Clientcnt_emp  
    EXEC dbo.[usp_MF_Dash_GetClientCounts_Dealer] @SubBroker, @ReportType, @Period  
    --EXEC dbo.usp_MF_Dash_GetClientCounts @SubBroker, @ReportType, @Period  
    --EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'  
    
    if object_id('tempdb..#tmp_TransCnt_emp') is not null  
     drop table #tmp_TransCnt_emp  
    CREATE table #tmp_TransCnt_emp  
    (  
     sub_broker varchar(100),  
     purchaseAmount float,  
     SaleAmount Float,  
     NetSale float  
    )  
    insert into #tmp_TransCnt_emp  
    exec [172.31.16.109].MUTUALFund.dbo.usp_MF_Agent_AssetClassWiseCollection_Dealer @SubBroker,@Period,'Total'  
    --exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal @SubBroker,@Period  
    --exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal 'GDS','MTD'  
   
    declare @sdate_emp varchar(10) , @edate_emp varchar(10)  
   
    select @sdate_emp = CONVERT(char(10), dbo.fn_Get_StartData(@Period) , 103)   
    set @edate_emp = CONVERT(char(10), getdate() , 103)   
  
  
    if object_id('tempdb..#tmp_CommissionCnt_emp') is not null  
     drop table #tmp_CommissionCnt_emp;  
  
    CREATE table #tmp_CommissionCnt_emp  
    (  
     ClientCode varchar(50),  
     ClientName varchar(max),   
     SchemeType varchar(50),  
     SchemeName varchar(max),  
     InvestmentType varchar(20),   
     TrxnDate date,  
     FolioNo varchar(50),   
     PurchaseNAV float,  
     Units float,  
     Amount float,  
     GrossReceipt float,  
     Commission float,  
     RevenueType varchar(50)  
    )  
  
    insert into #tmp_CommissionCnt_emp  
    exec [172.31.16.109].[MutualFund].[dbo].[usp_BillTransaction_Angel_ForIPartner_Dealer] @AgentCode=@SubBroker,@BillPeriodFrom=@sdate,@BillPeriodTo =@edate  
   
    --select round(sum(Commission), 4) CommissionCnt from #tmp_CommissionCnt  
  
    select @SubBroker as sub_broker,   
    max(Aum_Count) as Aum_Count,   
    max(Client_Count) as Client_Count,  
    CASE WHEN max(Transaction_Count) = 0 THEN MIN(Transaction_Count) ELSE MAX(Transaction_Count) END as Transaction_Count,  
    --max(Transaction_Count) as Transaction_Count,   
    max(Commission_Count) as Commission_Count  
    from  
    (  
     select isnull(Total, 0) as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_aum_cnt_emp   
     union all  
     select 0 as Aum_Count, isnull(account, 0) as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_Clientcnt_emp   
     union all  
     select 0 as Aum_Count, 0 as Client_Count, isnull(NetSale, 0) as Transaction_Count, 0 as Commission_Count from #tmp_TransCnt_emp   
     union all   
     select 0 as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, isnull(round(sum(Commission), 4), 0) as Commission_Count from #tmp_CommissionCnt_emp   
    ) a  
     end   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_aLLCount_NY
-- --------------------------------------------------

--exec NXT.dbo.usp_MF_Dash_aLLCount @SubBroker = 'EMT', @UserType = 'Agent', @ReportType = 'All', @Period = 'YTD'
--GO

--EXEC [Usp_GetFundWiseSchemeWiseAll_v3] 'ET'




CREATE  PROCEDURE [dbo].[usp_MF_Dash_aLLCount_NY]
--declare
--@ReportType as varchar(100),
	@SubBroker VARCHAR(100), --= 'ET',
	@UserType as varchar(100), --= 'Agent',
	@ReportType VARCHAR(10), --= 'All', --- 'All/SIP/Lumsum
	@Period VARCHAR(5) = 'MTD'
AS
/*
exec dbo.usp_MF_Dash_aLLCount @SubBroker = 'GDS', @UserType = 'Agent', @ReportType = 'All', @Period = 'ITD'
*/
BEGIN
	if object_id('tempdb..#tmp_aum_cnt') is not null
		drop table #tmp_aum_cnt
	CREATE table #tmp_aum_cnt
	(
		Header varchar(20),
		subbroker varchar(50),
		Total float
	)
	---Aum Count
	insert into #tmp_aum_cnt
	--exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal @UserType, @SubBroker, @Period
	--exec [172.31.16.109].NXT.dbo.Usp_MF_Dash_AUMTotal 'Agent', 'GDS', 'YTD'
	EXEC [172.31.16.109].NXT.dbo.[usp_MF_NXT_SubBrokerTotalAUM_NY]  @SubBroker, @Period

	if object_id('tempdb..#tmp_Clientcnt') is not null
		drop table #tmp_Clientcnt
	CREATE table #tmp_Clientcnt
	(
		account int,
		havingPortfolio int,
		MFSegmentActive int,
		RegisteredInMF int,
		MFPortfoliioAmount float
	)

	insert into #tmp_Clientcnt
	EXEC dbo.[usp_MF_Dash_GetClientCounts] @SubBroker, @ReportType, @Period
	--EXEC dbo.usp_MF_Dash_GetClientCounts @SubBroker, @ReportType, @Period
	--EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
		
	if object_id('tempdb..#tmp_TransCnt') is not null
		drop table #tmp_TransCnt
	CREATE table #tmp_TransCnt
	(
		sub_broker varchar(100),
		purchaseAmount float,
		SaleAmount Float,
		NetSale float
	)
	insert into #tmp_TransCnt
	exec [172.31.16.109].MUTUALFund.dbo.usp_MF_Agent_AssetClassWiseCollection @SubBroker,@Period,'Total'
	--exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal @SubBroker,@Period
	--exec [172.31.16.109].NXT.dbo.usp_MF_Dash_TransactionTotal 'GDS','MTD'
	
	declare @sdate varchar(10) , @edate varchar(10)
	
	select @sdate = CONVERT(char(10), dbo.fn_Get_StartData(@Period) , 103) 
	set @edate = CONVERT(char(10), getdate() , 103) 


	if object_id('tempdb..#tmp_CommissionCnt') is not null
		drop table #tmp_CommissionCnt;

	CREATE table #tmp_CommissionCnt
	(
		ClientCode varchar(50),
		ClientName varchar(max), 
		SchemeType varchar(50),
		SchemeName varchar(max),
		InvestmentType varchar(20),	
		TrxnDate date,
		FolioNo	varchar(50), 
		PurchaseNAV float,
		Units float,
		Amount float,
		GrossReceipt float,
		Commission float,
		RevenueType varchar(50)
	)

	insert into #tmp_CommissionCnt
	exec [172.31.16.109].[MutualFund].[dbo].[usp_BillTransaction_Angel_ForIPartner] @AgentCode=@SubBroker,@BillPeriodFrom=@sdate,@BillPeriodTo =@edate
	
	--select round(sum(Commission), 4) CommissionCnt from #tmp_CommissionCnt

	select @SubBroker as sub_broker, 
	max(Aum_Count) as Aum_Count, 
	max(Client_Count) as Client_Count,
	CASE WHEN max(Transaction_Count) = 0 THEN MIN(Transaction_Count) ELSE MAX(Transaction_Count) END as Transaction_Count,
	--max(Transaction_Count) as Transaction_Count, 
	max(Commission_Count) as Commission_Count
	from
	(
		select isnull(Total, 0) as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_aum_cnt 
		union all
		select 0 as Aum_Count, isnull(account, 0) as Client_Count, 0 as Transaction_Count, 0 as Commission_Count from #tmp_Clientcnt 
		union all
		select 0 as Aum_Count, 0 as Client_Count, isnull(NetSale, 0) as Transaction_Count, 0 as Commission_Count from #tmp_TransCnt 
		union all 
		select 0 as Aum_Count, 0 as Client_Count, 0 as Transaction_Count, isnull(round(sum(Commission), 4), 0) as Commission_Count from #tmp_CommissionCnt 
	) a
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Dash_BoughtClientCount
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_MF_Dash_BoughtClientCount]
(
	@SubBroker VARCHAR(50)
)
AS
BEGIN
Set NOCOUNT ON 

	--EXEC Usp_MF_Dash_BoughtClientCount 'MMCN'
	--EXEC Usp_MF_Dash_BoughtClientCount 'AHD'

	SELECT	 @SubBroker sub_broker
			,count(MFBoughtClients) MFBoughtClientCount
		 FROM tbl_SB_MyClient_GetClientDetails WITH (NOLOCK)
		WHERE sub_broker = @SubBroker
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_GetClientCounts
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			3/15/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All','ITD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'MTD'



	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'ITD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'
	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'



	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum','ITD'


	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'MTD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'EMT', 'All',null
*/	
/**************************************************************/
CREATE  PROCEDURE [dbo].[usp_MF_Dash_GetClientCounts]
	@SubBroker VARCHAR(10)
	,@ReportType VARCHAR(10) = 'All'
	,@Period VARCHAR(5) = NULL
AS
BEGIN

	SET NOCOUNT ON

	DECLARE @SDate DATETIME =  dbo.fn_Get_StartData('YTD')
	DECLARE @EDate DATETIME =  CONVERT(DATETIME, CONVERT(VARCHAR(11), GETDATE()) + ' 23:59:59.997')
	DECLARE @MSDate DATETIME = dbo.fn_Get_StartData('MTD')
	DECLARE @IMSDate DATETIME = dbo.fn_Get_StartData('ITD')

	DECLARE @SDate1 DATE = CONVERT(DATE, @SDate)
	DECLARE @EDate1 DATE = CONVERT(DATE, @EDate)
	DECLARE @MSDate1 DATE = CONVERT(DATE, @MSDate)
	DECLARE @MSIDate1 DATE = CONVERT(DATE, @IMSDate)

	IF @ReportType = 'All'
	BEGIN
		
		IF @Period = 'YTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @SDate, @EDate
		
		IF @Period = 'MTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @MSDate, @EDate

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @IMSDate, @EDate

	END

	ELSE IF @ReportType = 'SIP'
	BEGIN

		IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		IF @Period = 'MTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSDate,@EDate

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@IMSDate,@EDate

	END

	ELSE IF @ReportType = 'Lumpsum'
	BEGIN

		IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate1,@EDate1

		IF @Period = 'MTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSDate1,@EDate1

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSIDate1,@EDate1

	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_GetClientCounts_Bkp10May2018
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			3/15/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All','ITD'
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'MTD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP'
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'YTD'
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum'
	EXEC dbo.usp_MF_Dash_GetClientCounts 'EMT', 'Lumpsum', 'ITD'
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'MTD'


*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_MF_Dash_GetClientCounts_Bkp10May2018]
	@SubBroker VARCHAR(10)
	,@ReportType VARCHAR(10) = 'All'
	,@Period VARCHAR(5) = NULL
AS
BEGIN

	SET NOCOUNT ON

	DECLARE @SDate DATETIME =  dbo.fn_Get_StartData('YTD')
	DECLARE @EDate DATETIME =  CONVERT(DATETIME, CONVERT(VARCHAR(11), GETDATE()) + ' 23:59:59.997')
	DECLARE @MSDate DATETIME = dbo.fn_Get_StartData('MTD')
	DECLARE @IMSDate DATETIME = dbo.fn_Get_StartData('ITD')

	DECLARE @SDate1 DATE = CONVERT(DATE, @SDate)
	DECLARE @EDate1 DATE = CONVERT(DATE, @EDate)
	DECLARE @MSDate1 DATE = CONVERT(DATE, @MSDate)
	DECLARE @MSIDate1 DATE = CONVERT(DATE, @IMSDate)

	IF @ReportType = 'All'
	BEGIN
		
		IF @Period = 'YTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @SDate, @EDate
		
		IF @Period = 'MTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @MSDate, @EDate

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @IMSDate, @EDate

	END

	ELSE IF @ReportType = 'SIP'
	BEGIN

		IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		IF @Period = 'MTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSDate,@EDate

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@IMSDate,@EDate

	END

	ELSE IF @ReportType = 'Lumpsum'
	BEGIN

		IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate1,@EDate1

		IF @Period = 'MTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSDate1,@EDate1

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSIDate1,@EDate1

	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_GetClientCounts_Dealer
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			3/15/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All','ITD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'MTD'



	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'ITD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'
	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'



	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum','ITD'


	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'MTD'

	EXEC dbo.usp_MF_Dash_GetClientCounts_Dealer 'SSHCH005','SIP',null
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_MF_Dash_GetClientCounts_Dealer]
	@SubBroker VARCHAR(10)
	,@ReportType VARCHAR(10) = 'All'
	,@Period VARCHAR(5) = NULL
AS
BEGIN

	SET NOCOUNT ON

	DECLARE @SDate DATETIME =  dbo.fn_Get_StartData('YTD')
	DECLARE @EDate DATETIME =  CONVERT(DATETIME, CONVERT(VARCHAR(11), GETDATE()) + ' 23:59:59.997')
	DECLARE @MSDate DATETIME = dbo.fn_Get_StartData('MTD')
	DECLARE @IMSDate DATETIME = dbo.fn_Get_StartData('ITD')

	DECLARE @SDate1 DATE = CONVERT(DATE, @SDate)
	DECLARE @EDate1 DATE = CONVERT(DATE, @EDate)
	DECLARE @MSDate1 DATE = CONVERT(DATE, @MSDate)
	DECLARE @MSIDate1 DATE = CONVERT(DATE, @IMSDate)

	IF @ReportType = 'All'
	BEGIN
		
		IF @Period = 'YTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount_Dealer @SubBroker, @SDate, @EDate
		
		IF @Period = 'MTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount_Dealer @SubBroker, @MSDate, @EDate

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount_Dealer @SubBroker, @IMSDate, @EDate

	END

	ELSE IF @ReportType = 'SIP'
	BEGIN

		IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_Inhouse_MFNXT_Dealer NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		IF @Period = 'MTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_Inhouse_MFNXT_Dealer NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSDate,@EDate

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_Inhouse_MFNXT_Dealer NULL,NULL,@SubBroker,NULL,NULL,NULL,@IMSDate,@EDate

	END

	ELSE IF @ReportType = 'Lumpsum'
	BEGIN

		IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT_Dealer NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate1,@EDate1

		IF @Period = 'MTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT_Dealer NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSDate1,@EDate1

		IF @Period = 'ITD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT_Dealer NULL,NULL,@SubBroker,NULL,NULL,NULL,@MSIDate1,@EDate1

	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_GetClientCounts_New
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			3/15/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All','ITD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'MTD'



	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'ITD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'
	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'



	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum','ITD'


	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'MTD'


*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_MF_Dash_GetClientCounts_New]
	@SubBroker VARCHAR(10)
	,@ReportType VARCHAR(10) = 'All'
	,@Period VARCHAR(5) = NULL
AS
BEGIN

	SET NOCOUNT ON

	DECLARE @SDate DATETIME =  dbo.fn_Get_StartData(@Period)
	DECLARE @EDate DATETIME =  CONVERT(DATE, GETDATE())
	--DECLARE @MSDate DATETIME = dbo.fn_Get_StartData(@Period)

	--DECLARE @SDate1 DATE = CONVERT(DATE, @SDate)
	--DECLARE @EDate1 DATE = CONVERT(DATE, @EDate)
	--DECLARE @MSDate1 DATE = CONVERT(DATE, @MSDate)

	IF @ReportType = 'All'
	BEGIN
		
		--IF @Period = 'YTD' OR @Period IS NULL
			EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @SDate, @EDate
		
		--IF @Period = 'MTD' OR @Period IS NULL
		--	EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @SDate, @EDate

		--IF @Period = 'ITD' OR @Period IS NULL
		--EXEC dbo.usp_MF_Dash_GetCLCount @SubBroker, @SDate, @EDate

	END

	ELSE IF @ReportType = 'SIP'
	BEGIN

		--IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		--IF @Period = 'MTD' OR @Period IS NULL
		--	EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		--IF @Period = 'ITD' OR @Period IS NULL
		--EXEC [172.31.16.109].MutualFund.dbo.usp_SipDetailWithNewSIP_Angel_inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

	END

	ELSE IF @ReportType = 'Lumpsum'
	BEGIN

		--IF @Period = 'YTD' OR @Period IS NULL
			EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		--IF @Period = 'MTD' OR @Period IS NULL
		--	EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

		--IF @Period = 'ITD' OR @Period IS NULL
		--	EXEC [172.31.16.109].MutualFund.dbo.usp_LunmpSum_Angel_Inhouse_MFNXT NULL,NULL,@SubBroker,NULL,NULL,NULL,@SDate,@EDate

	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_Dash_GetClientCounts_SBandDealer
-- --------------------------------------------------


/**************************************************************/
/*
	DATE:			3/15/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All','ITD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'All', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'All', 'MTD'



	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'ITD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'
	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'SIP', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'SIP', 'MTD'



	
	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum','ITD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum','ITD'


	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'YTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'YTD'
	

	EXEC dbo.usp_MF_Dash_GetClientCounts 'ET', 'Lumpsum', 'MTD'
	EXEC dbo.[usp_MF_Dash_GetClientCounts_New] 'ET', 'Lumpsum', 'MTD'

	EXEC dbo.usp_MF_Dash_GetClientCounts 'EMT', 'All',null
*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_MF_Dash_GetClientCounts_SBandDealer]
	@SubBroker VARCHAR(10)
	,@ReportType VARCHAR(10) = 'All'
	,@Period VARCHAR(5) = NULL
AS
BEGIN

Declare @Column varchar(100)
IF EXISTS(Select * from [196.1.115.132].Mimansa.dbo.Vw_B2B_CurrentClientDealerMapping WHERE Emp_No = @SubBroker)
BEGIN
	SET @Column = 'Dealer'
END
ELSE
BEGIN
	SET @Column = 'SubBroker'
END 

IF @Column='SubBroker'
BEGIN
 
  EXEC usp_MF_Dash_GetClientCounts @SubBroker,@ReportType,@Period
  
END
ELSE
BEGIN
  
  EXEC usp_MF_Dash_GetClientCounts_Dealer @SubBroker,@ReportType,@Period

END


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Get_BellNotificationCounts
-- --------------------------------------------------




CREATE PROCEDURE [dbo].[Usp_MF_Get_BellNotificationCounts]
		@SubBroker varchar(50)
AS
BEGIN
    
	SET NOCOUNT ON;

	-- select last 30 days notifications
	SELECT COUNT(*)
	FROM tbl_NotificationBEENXT WITH (NOLOCK)
	WHERE SUB_BROKER = @SubBroker
		  AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE()))
		  AND NOTIFICATION_9 = 'Y'
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Get_BellNotificationCounts_NXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_MF_Get_BellNotificationCounts_NXT]
@SubBroker varchar(50)
AS
BEGIN
   
SET NOCOUNT ON;

-- select last 30 days notifications
SELECT COUNT(*)
FROM tbl_NotificationNXT WITH (NOLOCK)
WHERE SUB_BROKER = @SubBroker
 AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE()))
 --AND NOTIFICATION_9 = 'Y'
 AND Individualview = 'N'
 AND ISNULL(IsInActive, 0) = 0
 AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))
 AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Get_BellNotifications
-- --------------------------------------------------
  
 CREATE PROCEDURE [dbo].[Usp_MF_Get_BellNotifications]    
   @SubBroker varchar(50)    
 AS    
 BEGIN    
        
    SET NOCOUNT ON;    
       
    -- select last 30 days notifications    
    SELECT    NOTIFICATIONID  
       ,SUB_BROKER  
       ,NOTIFICATIONTEXT  
       ,NOTIFICATIONTYPE  
       ,INDIVIDUALVIEW  
       ,INDIVIDUALVIEWDATE  
       ,CREATEDDATE  
       ,URL    
       ,area   
       ,controller   
       ,[action]   
       ,areaname
      FROM tbl_NotificationBEENXT WITH (NOLOCK)    
      WHERE SUB_BROKER = @SubBroker    
      AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE() - 30 ))    
      ORDER BY CREATEDDATE DESC    
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Get_BellNotifications_NXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_MF_Get_BellNotifications_NXT]  
 @SubBroker varchar(50)  
AS  
BEGIN  
      
 SET NOCOUNT ON;  
  
 -- select last 30 days notifications  
 SELECT NOTIFICATIONID, SUB_BROKER, NOTIFICATIONTEXT, NOTIFICATIONTYPE, INDIVIDUALVIEW, INDIVIDUALVIEWDATE, CREATEDDATE, URL,   
  area, controller, action, areaname, QueryParameter  
 FROM tbl_NotificationNXT WITH (NOLOCK)  
 WHERE SUB_BROKER = @SubBroker  
    AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE() - 30 ))  
    AND ISNULL(IsInActive, 0) = 0  
    AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))  
 ORDER BY CREATEDDATE DESC  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MF_GET_MFSCHEMECODE
-- --------------------------------------------------
/*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]

 SP_HELPTEXT USP_MF_GET_MFSCHEMECODE

*/

-- =============================================
-- Author:		Vaibhav Shah
-- Create date: 30 Nov 2018
-- Description:	Get mf schemecode from isin
-- =============================================
CREATE PROCEDURE [dbo].[USP_MF_GET_MFSCHEMECODE]
(
	@ISIN NVARCHAR(20)
)
AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
SET NOCOUNT ON;
SELECT MF_SCHCODE,ISIN
FROM /*[172.31.16.75] */ 
[196.1.115.232].[FSS_MF].[dbo].[FEED_MFISIN_ALL] with (nolock) where ISIN = @ISIN
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_IPartner_Dashboard_GetCrossSellInfo
-- --------------------------------------------------
/*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]
 SP_HELPTEXT usp_MF_IPartner_Dashboard_GetCrossSellInfo
*/


/**************************************************************/
/*
	DATE:			01/11/2018
	AUTHOR:			Brijesh B
	DESCRIPTION:	

	
	EXEC dbo.usp_MF_IPartner_Dashboard_GetCrossSellInfo 'AJYC', 'ALWR2127', '2018-06-29'

*/	
/**************************************************************/
CREATE PROCEDURE [dbo].[usp_MF_IPartner_Dashboard_GetCrossSellInfo]
	@SubBroker VARCHAR(10)
	,@PartyCode VARCHAR(10)
	,@RecommSendOn VARCHAR(10)
AS
BEGIN

	SET NOCOUNT ON

	SELECT DISTINCT 
		AR.Header
		,AR.SchemeName
		,AR.ISIN
		,CONVERT(DATE, AR.RecommendationSendOn) AS RecommendationSendOn
		--,MF.[1yrReturn]
		--,MF.[3yrReturn]
		--,MF.[5yrReturn]
		,A.oneyear		[1yrReturn]
		,A.threeyear	[3yrReturn]
		,A.fiveyear		[5yrReturn]
		,Score = ISNULL(MFS.ARQ_mScore,0)
		,A.oneyear		[C1yrReturn]
		,A.threeyear	[C3yrReturn]
		,A.fiveyear		[C5yrReturn]
		
	FROM 
		tbl_CRMS_MF_ARQ_Recommendations AR WITH(NOLOCK)
--		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.arq_mfssRecommendedScheme MF WITH(NOLOCK) ON AR.ISIN = MF.GrowthISIN --commentes after discussed with Yogesh and Nazma mam as on 10-Jul-2018
		Left join /*[172.31.16.75]*/[196.1.115.232].FSS_MF.dbo.Feed_Mfisin S on S.isin = AR.ISIN 
		Left join /*[172.31.16.75]*/[196.1.115.232].FSS_MF.dbo.Feed_returnv A on A.mf_schcode = S.mf_schcode
		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.ARQ_ISIN_MFscore MFS WITH(NOLOCK) ON AR.Isin = MFS.ARQ_tISIN
		 
	WHERE
		Party_Code = @PartyCode
		AND Sub_Broker = @SubBroker
		--AND CONVERT(DATE, RecommendationSendOn) = TRY_CONVERT(DATE, @RecommSendOn)
		AND RecommendationSendOn BETWEEN TRY_CONVERT(DATETIME, @RecommSendOn + ' 00:00:00.000') AND TRY_CONVERT(DATETIME, @RecommSendOn + ' 23:59:59.997')
		--AND MF.Flag = 'A'
		AND MFS.ARQ_tflag='A' 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MF_IPartner_Dashboard_GetCrossSellInfo_Dealer
-- --------------------------------------------------
/*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]
 SP_HELPTEXT usp_MF_IPartner_Dashboard_GetCrossSellInfo_Dealer

*/

CREATE PROCEDURE [dbo].[usp_MF_IPartner_Dashboard_GetCrossSellInfo_Dealer]
	@SubBroker VARCHAR(10)
	,@PartyCode VARCHAR(10)
	,@RecommSendOn VARCHAR(10)
	,@Access_To varchar(10)
AS
BEGIN

	SET NOCOUNT ON
	       if(Lower(@Access_To)='sb')
		             begin
								SELECT DISTINCT 
									AR.Header
									,AR.SchemeName
									,AR.ISIN
									,CONVERT(DATE, AR.RecommendationSendOn) AS RecommendationSendOn
									--,MF.[1yrReturn]
									--,MF.[3yrReturn]
									--,MF.[5yrReturn]
									,A.oneyear		[1yrReturn]
									,A.threeyear	[3yrReturn]
									,A.fiveyear		[5yrReturn]
									,Score = ISNULL(MFS.ARQ_mScore,0)
									,A.oneyear		[C1yrReturn]
									,A.threeyear	[C3yrReturn]
									,A.fiveyear		[C5yrReturn]
		
								FROM 
									tbl_CRMS_MF_ARQ_Recommendations AR WITH(NOLOCK)
							--		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.arq_mfssRecommendedScheme MF WITH(NOLOCK) ON AR.ISIN = MF.GrowthISIN --commentes after discussed with Yogesh and Nazma mam as on 10-Jul-2018
									Left join /*[172.31.16.75]*/[196.1.115.232].FSS_MF.dbo.Feed_Mfisin S on S.isin = AR.ISIN 
									Left join /*[172.31.16.75]*/[196.1.115.232].FSS_MF.dbo.Feed_returnv A on A.mf_schcode = S.mf_schcode
									LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.ARQ_ISIN_MFscore MFS WITH(NOLOCK) ON AR.Isin = MFS.ARQ_tISIN
		 
								WHERE
									Party_Code = @PartyCode
									AND Sub_Broker = @SubBroker
									--AND CONVERT(DATE, RecommendationSendOn) = TRY_CONVERT(DATE, @RecommSendOn)
									AND RecommendationSendOn BETWEEN TRY_CONVERT(DATETIME, @RecommSendOn + ' 00:00:00.000') AND TRY_CONVERT(DATETIME, @RecommSendOn + ' 23:59:59.997')
									--AND MF.Flag = 'A'
									AND MFS.ARQ_tflag='A' 
					 end
            else
			         begin
					      declare @emp_subbroker varchar(10)
						  select @emp_subbroker=Sb_Tag from tbl_Emp_Master where Emp_No=@SubBroker
					      SELECT DISTINCT 
									AR.Header
									,AR.SchemeName
									,AR.ISIN
									,CONVERT(DATE, AR.RecommendationSendOn) AS RecommendationSendOn
									--,MF.[1yrReturn]
									--,MF.[3yrReturn]
									--,MF.[5yrReturn]
									,A.oneyear		[1yrReturn]
									,A.threeyear	[3yrReturn]
									,A.fiveyear		[5yrReturn]
									,Score = ISNULL(MFS.ARQ_mScore,0)
									,A.oneyear		[C1yrReturn]
									,A.threeyear	[C3yrReturn]
									,A.fiveyear		[C5yrReturn]
		
								FROM 
									tbl_CRMS_MF_ARQ_Recommendations AR WITH(NOLOCK)
							--		LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.arq_mfssRecommendedScheme MF WITH(NOLOCK) ON AR.ISIN = MF.GrowthISIN --commentes after discussed with Yogesh and Nazma mam as on 10-Jul-2018
									Left join /*[172.31.16.75]*/[196.1.115.232].FSS_MF.dbo.Feed_Mfisin S on S.isin = AR.ISIN 
									Left join /*[172.31.16.75]*/[196.1.115.232].FSS_MF.dbo.Feed_returnv A on A.mf_schcode = S.mf_schcode
									LEFT JOIN [172.31.16.75].ANGEL_WMS.dbo.ARQ_ISIN_MFscore MFS WITH(NOLOCK) ON AR.Isin = MFS.ARQ_tISIN
		 
								WHERE
									Party_Code = @PartyCode
									AND Sub_Broker = @emp_subbroker
									--AND CONVERT(DATE, RecommendationSendOn) = TRY_CONVERT(DATE, @RecommSendOn)
									AND RecommendationSendOn BETWEEN TRY_CONVERT(DATETIME, @RecommSendOn + ' 00:00:00.000') AND TRY_CONVERT(DATETIME, @RecommSendOn + ' 23:59:59.997')
									--AND MF.Flag = 'A'
									AND MFS.ARQ_tflag='A' 
					 end

	

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Update_Get_Bell_Notifications
-- --------------------------------------------------
  
  CREATE PROCEDURE [dbo].[Usp_MF_Update_Get_Bell_Notifications]    
    @SubBroker varchar(50),    
    @NotificationCount varchar(50)    
  AS    
  BEGIN    
          
     SET NOCOUNT ON;    
        
     -- Update notifications     
     UPDATE tbl_NotificationBEENXT    
     SET NOTIFICATION_9 = 'N',    
      NOTIFICATION_DATE_9 = GETDATE(),    
      UPDATEDDATE = GETDATE(),    
      UPDATEDBY = @SubBroker    
     WHERE SUB_BROKER = @SubBroker    
     AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE()))    
     AND NOTIFICATION_9 = 'Y'    
      
    -- Insert log into history Table    
    INSERT INTO tbl_BellNotificationBEENXTHist(sub_broker,EntryDate,NotificationCount) values(@SubBroker, GETDATE(), @NotificationCount)    
      
    -- select last 2 days notifications    
     SELECT   
       NOTIFICATIONID  
      ,SUB_BROKER  
      ,NOTIFICATIONTEXT  
      ,NOTIFICATIONTYPE  
      ,INDIVIDUALVIEW  
      ,INDIVIDUALVIEWDATE  
      ,CREATEDDATE  
      ,URL    
      ,area   
      ,controller   
      ,[action]    
      ,areaname           
     FROM tbl_NotificationBEENXT WITH (NOLOCK)    
     WHERE SUB_BROKER = @SubBroker    
     AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE() - 1))  
     ORDER BY CREATEDDATE DESC 
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Update_Get_Bell_Notifications_NXT
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_MF_Update_Get_Bell_Notifications_NXT]  
  @SubBroker varchar(50),  
  @NotificationCount varchar(50)  
AS  
BEGIN  
      
 SET NOCOUNT ON;  
  
 -- Update notifications   
 UPDATE tbl_NotificationNXT  
 SET NOTIFICATION_9 = 'N',  
  NOTIFICATION_DATE_9 = GETDATE(),  
  UPDATEDDATE = GETDATE(),  
  UPDATEDBY = @SubBroker  
 WHERE SUB_BROKER = @SubBroker  
    AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE()))  
    AND NOTIFICATION_9 = 'Y'  
    AND ISNULL(IsInActive, 0) = 0  
    AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))  
    AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))  
  
 -- Insert log into history Table  
 INSERT INTO [tbl_BellNotificationNXTHist](sub_broker,EntryDate,NotificationCount) values(@SubBroker, GETDATE(), @NotificationCount)  
  
    -- select last 2 days notifications  
 SELECT NOTIFICATIONID, SUB_BROKER, NOTIFICATIONTEXT, NOTIFICATIONTYPE, INDIVIDUALVIEW, INDIVIDUALVIEWDATE, CREATEDDATE,URL  
 ,area ,controller ,action, areaname, QueryParameter  
 FROM tbl_NotificationNXT WITH (NOLOCK)  
 WHERE SUB_BROKER = @SubBroker  
    AND CREATEDDATE >= DATEADD(d, 0, DATEDIFF(d, 0, GETDATE() - 1))  
    AND ISNULL(IsInActive, 0) = 0  
    AND (StartDate IS NULL OR (StartDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), StartDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(StartTime, '00:00'), 108)) <= GETDATE()))  
    AND (ExpiryDate IS NULL OR (ExpiryDate IS NOT NULL AND CONVERT(DATETIME, CONVERT(CHAR(8), ExpiryDate, 112) + ' ' + CONVERT(CHAR(8), ISNULL(ExpiryTime, '23:59'), 108)) >= GETDATE()))  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MF_Update_Individual_Notifications_NXT
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_MF_Update_Individual_Notifications_NXT]
		@SubBroker varchar(50),
		@NotificationID int
AS
BEGIN
    
	SET NOCOUNT ON;

	-- Update individual notification
	UPDATE tbl_NotificationNXT
	SET Individualview = 'Y',
		IndividualviewDate = GETDATE(),
		UPDATEDDATE = GETDATE(),
		UPDATEDBY = @SubBroker
	WHERE SUB_BROKER = @SubBroker
		  AND NotificationID = @NotificationID

	
	DECLARE @TempRecord TABLE ([NotificationID] [int] NULL,
	[sub_broker] [varchar](200) NULL,
	[NotificationText] [varchar](7000) NULL,
	[NotificationType] [varchar](70) NULL,
	[Individualview] [varchar](2) NULL,
	[IndividualviewDate] [datetime] NULL,
	[Notification_9] [varchar](2) NULL,
	[Notification_Date_9] [datetime] NULL,
	[CreatedBy] [varchar](200) NULL,
	[CreatedDate] [datetime] NULL,
	[UpdatedBy] [varchar](200) NULL,
	[UpdatedDate] [datetime] null,
	[EntryDate] [datetime] default GETDATE(),
	url [varchar](max)
	,area  [varchar](200) NULL
	,controller  [varchar](200) NULL
	,action  [varchar](200) NULL
	)


	INSERT INTO @TempRecord 
	(NotificationID, sub_broker, NotificationText, NotificationType, Individualview, IndividualviewDate, Notification_9, Notification_Date_9, CreatedBy, CreatedDate, UpdatedBy, UpdatedDate,Url,area,controller,action)
	SELECT TOP 1 
	NotificationID, sub_broker, NotificationText, NotificationType, Individualview, IndividualviewDate, Notification_9, Notification_Date_9, CreatedBy, CreatedDate, UpdatedBy, UpdatedDate ,Url,area,controller,action
	FROM tbl_NotificationNXT WHERE NotificationID = @NotificationID

	INSERT INTO tbl_NotificationIndividualNXTHist 
	SELECT TOP 1 * FROM @TempRecord WHERE NotificationID = @NotificationID

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MFNXTLogin_Dealer
-- --------------------------------------------------
--exec [usp_MFNXTLogin_Dealer] 'AAAAA001','AAAAA001'

CREATE PROCEDURE [dbo].[usp_MFNXTLogin_Dealer]
(
	@Access_Code varchar(50),
	@userpassword varchar(20) 
	
)
as
BEGIN 
SET NOCOUNT ON 
	

	
	IF(SELECT COUNT(*) fROM dbo.tbl_Emp_Master_syn A with (nolock)
	left join dbo.tbl_Emp_Suspension_Termination_syn B with (nolock)
	ON A.Emp_No=B.Emp_no
		where User_ID=@Access_Code
		and ((A.isSuspended	=1 or A.isTerminated=1)
		or (B.Suspension_Date<getdate() or B.Termination_Date<=getdate()))
		
		)>0
			BEGIN 
			SELECT @Access_Code +' '+ 'Employee Terminated' AS MESSAGE,0 AS RESULT
			Return
			END


	Declare @Cnt int
	
	IF exists(select * FROM tbl_Emp_Master_syn em WITH (NOLOCK) WHERE user_id=@Access_Code and password=@userpassword)
	Begin
			SELECT 
				Isnull(@Access_Code,'') access_code,'Dealer' access_to,'' Device_Id,
				Isnull(email,'') email,'' Message,Emp_Name Name,1 Result,
				isnull(user_id,'') as username,'Dealer' UserType,'' MFUserType,1 IsFirstLogin
			FROM 
				tbl_Emp_Master_syn WITH (NOLOCK)
			WHERE user_id=@Access_Code
			and password=@userpassword
			--and active='Y'
			--and status=1
			and isSuspended=0 and isTerminated=0
	END
	ELSE 
	BEGIN
			--select 1
			SELECT 
				'' access_code,'' access_to,''  Device_Id,
				'' email,'Invalid Credential' Message,'' Name ,0 Result,
				'' username,'' UserType,'' MFUserType,0 IsFirstLogin
	
	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MFNXTLogin_Dealer_New
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_MFNXTLogin_Dealer_New]
(
	@Access_Code varchar(50),
	@userpassword varchar(20) 
	
)
as
BEGIN 
SET NOCOUNT ON 
	
	Declare @Cnt int
	
	IF exists(select * FROM tbl_Emp_Master_syn em WITH (NOLOCK) WHERE user_id=@Access_Code and password=@userpassword)
	Begin
			SELECT 
				Isnull(@Access_Code,'') access_code,'Dealer' access_to,'' Device_Id,
				Isnull(email,'') email,'' Message,Emp_Name Name,1 Result,
				isnull(user_id,'') as username,'Dealer' UserType,'' MFUserType,1 IsFirstLogin
			FROM 
				tbl_Emp_Master_syn WITH (NOLOCK)
			WHERE user_id=@Access_Code
			and password=@userpassword
			--and active='Y'
			--and status=1
			and isSuspended=0 and isTerminated=0
	END
	ELSE 
	BEGIN
			--select 1
			SELECT 
				'' access_code,'' access_to,''  Device_Id,
				'' email,'Invalid Credential' Message,'' Name ,0 Result,
				'' username,'' UserType,'' MFUserType,0 IsFirstLogin
	
	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MFNXTLogin_Dealer_New11
-- --------------------------------------------------
--EXEC [usp_MFNXTLogin_Dealer_New11] 'CBHO013','TO2XIJVK'


CREATE PROCEDURE [dbo].[usp_MFNXTLogin_Dealer_New11]
(
	@Access_Code varchar(50),
	@userpassword varchar(20) 
	
)
as
BEGIN 
SET NOCOUNT ON 



	IF(SELECT COUNT(*) fROM [196.1.115.132].Mimansa.dbo.tbl_Emp_Master A
	left join [196.1.115.132].Mimansa.dbo.tbl_Emp_Suspension_Termination B
	ON A.Emp_No=B.Emp_no
		where User_ID=@Access_Code
		and ((A.isSuspended	=1 or A.isTerminated=1)
		or (B.Suspension_Date<getdate() or B.Termination_Date<=getdate()))
		
		)>0
			BEGIN 
			SELECT @Access_Code +' '+ 'Employee Terminated' AS MESSAGE,0 AS RESULT
			Return
			END



	
	Declare @Cnt int
	
	IF exists(select * FROM tbl_Emp_Master_syn em WITH (NOLOCK) WHERE user_id=@Access_Code and password=@userpassword)
	Begin
			SELECT 
				Isnull(@Access_Code,'') access_code,'Dealer' access_to,'' Device_Id,
				Isnull(email,'') email,'' Message,Emp_Name Name,1 Result,
				isnull(user_id,'') as username,'Dealer' UserType,'' MFUserType,1 IsFirstLogin
			FROM 
				tbl_Emp_Master_syn A WITH (NOLOCK)
				left join [196.1.115.132].Mimansa.dbo.tbl_Emp_Suspension_Termination B
					ON A.Emp_No=B.Emp_no
			WHERE user_id=@Access_Code
			and password=@userpassword
			--and active='Y'
			--and status=1
			and ((A.isSuspended=0 and A.isTerminated=0)
			or (B.Suspension_Date is null OR B.Suspension_Date >Getdate() or B.Termination_Date is null OR B.Termination_Date >Getdate()))
	END
	ELSE 
	BEGIN
			--select 1
			SELECT 
				'' access_code,'' access_to,''  Device_Id,
				'' email,'Invalid Credential' Message,'' Name ,0 Result,
				'' username,'' UserType,'' MFUserType,0 IsFirstLogin
	
	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MFNXTLogin_Dealer_V1
-- --------------------------------------------------
--exec [usp_MFNXTLogin_Dealer] 'AAAAA001','AAAAA001'

CREATE PROCEDURE [dbo].[usp_MFNXTLogin_Dealer_V1]
(
	@Access_Code varchar(50),
	@userpassword varchar(20) 
	
)
as
BEGIN 
SET NOCOUNT ON 
	

	
	IF(SELECT COUNT(*) fROM dbo.tbl_Emp_Master_syn A with (nolock)
	left join dbo.tbl_Emp_Suspension_Termination_syn B with (nolock)
	ON A.Emp_No=B.Emp_no
		where User_ID=@Access_Code
		and ((A.isSuspended	=1 or A.isTerminated=1)
		or (B.Suspension_Date<getdate() or B.Termination_Date<=getdate()))
		
		)>0
			BEGIN 
			SELECT @Access_Code +' '+ 'Employee Terminated' AS MESSAGE,0 AS RESULT
			Return
			END


	Declare @Cnt int
	
	IF exists(select * FROM tbl_Emp_Master_syn em WITH (NOLOCK) WHERE user_id=@Access_Code and password=@userpassword COLLATE SQL_Latin1_General_CP1_CS_AS)
	Begin
			SELECT 
				Isnull(@Access_Code,'') access_code,'Dealer' access_to,'' Device_Id,
				Isnull(email,'') email,'' Message,Emp_Name Name,1 Result,
				isnull(user_id,'') as username,'Dealer' UserType,'' MFUserType,1 IsFirstLogin
			FROM 
				tbl_Emp_Master_syn WITH (NOLOCK)
			WHERE user_id=@Access_Code
			and password=@userpassword COLLATE SQL_Latin1_General_CP1_CS_AS
			--and active='Y'
			--and status=1
			and isSuspended=0 and isTerminated=0
	END
	ELSE 
	BEGIN
			--select 1
			SELECT 
				'' access_code,'' access_to,''  Device_Id,
				'' email,'Invalid Credential' Message,'' Name ,0 Result,
				'' username,'' UserType,'' MFUserType,0 IsFirstLogin
	
	END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_multilocation_Log
-- --------------------------------------------------


Create procedure usp_multilocation_Log
(
	@sub_broker varchar(100)
)
as
begin

Insert into multilocation_Log(sub_broker,EntryDate)
select @sub_broker ,getdate()



end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MultilocationSBTags
-- --------------------------------------------------

CREATE procedure Usp_MultilocationSBTags
(@access_code varchar(100))
As
begin 

Declare @Todays Datetime=Getdate()

if (select count(1) from MultilocationSBTags with (nolock) where sbtag=@access_code)=0
begin 
		insert into MultilocationSBTags
		select distinct @access_code,@Todays,'system' 
END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NOC_Creditdebit_Mail_OneTime
-- --------------------------------------------------
CREATE procedure [dbo].[usp_NOC_Creditdebit_Mail_OneTime]
as
begin

Set NOCOUNT ON 
--Declare @Cnt INT

DECLARE    @tab char(1) = CHAR(9)

Declare @BodyContent Varchar(max)
,@subject Varchar(2000)

Declare @Filename varchar(100)=replace('CLientshiftingrecovery_' + convert(varchar(10),GETDATE(),105),'-','')+'.xls'


Set @subject='Noc credit debit'


Set @BodyContent=
'Hello All,

				Please find the attachment for CLientshiftingrecovery.'

EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
--@recipients = 'yogesh.rewatkar@angelbroking.com',
@recipients = 'remisier@angelbroking.com',
@copy_recipients='hemantp.patel@angelbroking.com;arnab.1maji@angelbroking.com;leon.vaz@angelbroking.com;yogesh.rewatkar@angelbroking.com;manish.shah@angelbroking.com;shalini.mohanan@angelbroking.com',
@blind_copy_recipients='yogesh.rewatkar@angelbroking.com',

--Declare  @query  varchar(MAX)

	@query = 'SET NOCOUNT ON ;

		
		select ''Date''	,''SUB_BROKER''	,''Amount''	,''Segment''	,''Naturecode'',	''Narration'',	''TDS''	,''GST''
		union all
		select convert(varchar(20),entryDate,103) Date,SUB_BROKER	,convert(varchar(20),Amount) Amount	,Segment	,convert(varchar(20),Naturecode) Naturecode,	Narration,	TDS	,GST
		from noc_credit_debit_One_Mail_Sent

		insert into nxt.dbo.noc_credit_debit_log 
		select * from nxt.dbo.noc_credit_debit_One_Mail_Sent


        SET NOCOUNT OFF ' 
			,
			
@subject = @subject,
  @body=@BodyContent,
  @attach_query_result_as_file = 1,
@query_attachment_filename = @Filename,
@query_result_header = 0,
--@query_result_separator = ',',
@query_result_separator=@tab,
@query_result_no_padding = 1,
--@exclude_query_output = 1,
@from_address   = 'nxt@angelbroking.com'


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Noc_logs
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Noc_logs]
(
		 @Party_Code varchar(100)
		,@sub_broker varchar(100)
		,@RequestTime Datetime =null
		,@DeletionTime Datetime = null
		,@Remarks varchar(max)
		,@Ipadress varchar(100)
		,@Flag Char(1)
)
as
begin
Set nocount on 

If @Flag='I'
begin

Insert into Noc_logs 
(
		Party_Code
		,sub_broker
		,RequestTime
		,DeletionTime
		,Remarks
		,Ipadress
		,EntryDate 
)
Select 
		 @Party_Code
		,@sub_broker
		,Getdate()
		,Null
		,@Remarks
		,@Ipadress
		,getdate()

END
ELSE
begin

Insert into Noc_logs 
(
		Party_Code
		,sub_broker
		,RequestTime
		,DeletionTime
		,Remarks
		,Ipadress
		,EntryDate 	
)
Select 
		 @Party_Code
		,@sub_broker
		,Null
		,Getdate()
		,@Remarks
		,@Ipadress
		,getdate()

END
END

--select * from Noc_logs

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NOCModule_NXTUtility_Log
-- --------------------------------------------------

CREATE procedure [dbo].[usp_NOCModule_NXTUtility_Log] --usp_NOCModule_NXTUtility_Log '04-13-2022','04-13-2022'
(
		@FromDate Date,
		@ToDate Date
)
as
begin
Set nocount on 

SELECT [Party_Code]
      ,[sub_broker]
      ,[RequestTime]
      ,[DeletionTime]
      ,[Remarks]
      ,[Ipadress]
      ,[EntryDate]
  FROM NXT.[dbo].[Noc_logs] with(nolock) where convert(date,EntryDate) between @FromDate and @ToDate 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Notification_DIY_NXT
-- --------------------------------------------------
CREATE procedure usp_Notification_DIY_NXT
(
	@SUB_BROKER  VARCHAR(100)
)
as
begin


Insert into tbl_NotificationNXT
(
		sub_broker
		,NotificationText
		,NotificationType
		,Individualview
		,IndividualviewDate
		,Notification_9
		,Notification_Date_9
		,CreatedBy
		,CreatedDate
		,UpdatedBy
		,UpdatedDate
		,CLTCODEDupl
		,URL
		,area
		,controller
		,action
		,CampaignId
		,areaname
)
SELECT 
		@SUB_BROKER [sub_broker]
      ,'Dear Business Partner, new DIY journey initiated kindly <a href="DIY/Report"target="_blank"><span style="color:blue;cursor:pointer"> Click here for more details</span></a>' [NotificationText]
      ,'All' [NotificationType]
      ,'N' [Individualview]
      ,null [IndividualviewDate]
      ,'Y' [Notification_9]
      ,getdate() [Notification_Date_9]
      ,'Admin' [CreatedBy]
      ,Getdate() [CreatedDate]
      ,'Admin' [UpdatedBy]
      ,getdate() [UpdatedDate]
      ,'' [CLTCODEDupl]
      ,'NXT' [URL]
      ,'' [area]
      ,'DIY/Report' [controller]
      ,'Index' [action]
      ,'' [CampaignId]
      ,'' [areaname]
  --FROM [NXT].[dbo].[tbl_NotificationNXT]
  --where NotificationText like '%to comply%'

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationBEENXT_SBDeclaration
-- --------------------------------------------------
--Text
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE procedure [dbo].[usp_NotificationBEENXT_SBDeclaration]
as
begin
  

DECLARE @FIYear VARCHAR(20)    
Declare @TodayDate datetime
select @TodayDate=dateadd(yy,-1,getdate())
    
SELECT @FIYear = (CASE WHEN (MONTH(@TodayDate)) <= 3 THEN convert(varchar(4), YEAR(@TodayDate)-1) + '-' + convert(varchar(4), YEAR(@TodayDate)%100)    
                        ELSE convert(varchar(4),YEAR(@TodayDate))+ '-' + convert(varchar(4),(YEAR(@TodayDate)%100)+1)END)    
    
--SELECT substring(@FIYear,3,len(@FIYear)) AS F_YEAR    

SELECT @FIYear=substring(@FIYear,3,len(@FIYear)) 

  --DELETE FROM [tbl_NotificationBEENXT]  where  NotificationType='SBDeclaration'

  INSERT INTO [tbl_NotificationBEENXT]
  (
sub_broker
,NotificationText
,NotificationType
,Individualview
,IndividualviewDate
,Notification_9
,Notification_Date_9
,CreatedBy
,CreatedDate
,UpdatedBy
,UpdatedDate
,CLTCODEDupl
,url
,area
,controller
,action
  
  )
   SELECT    
		   [SBTag]
		,'Your Self declaration for FY - ' +convert(varchar(20),@FIYear) + ' is pending. Kindly fill up the form to continue receiving Brokerage Payout.' NotificationText
		,'SBDeclaration' NotificationType
		,'Y' Individualview
		,Getdate() IndividualviewDate
		,'Y' Notification_9
		,Getdate() Notification_Date_9
		,'Admin' CreatedBy
		,Getdate() CreatedDate
		,'' UpdatedBy
		,'' UpdatedDate
		,''
		,''url	
		,'' area	
		,'' controller	
		,''action

    FROM  sb_Declaration with (nolock)
  where (SelfDeclaration<>'YES' or SelfDeclaration is null)
	and	FnYear=@FIYear
  --where convert(date,EntryDate)=convert(date,getdate())
   


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationBeeNXTIndivisual
-- --------------------------------------------------

      
    CREATE procedure [dbo].[usp_NotificationBeeNXTIndivisual]      
  (      
   @SbTag    VARCHAR(20)    
  ,@NotificationText VARCHAR(8000)    
  ,@url    VARCHAR(8000) = NULL      
  ,@area    VARCHAR(200)      
  ,@controller  VARCHAR(200)       
  ,@action   VARCHAR(200)
  ,@empName varchar(200) 
  ,@CampaignId varchar(200) 
  )      
  AS      
  BEGIN      
         
         
    INSERT INTO [tbl_NotificationBeeNXT]    
      (sub_broker    
      ,NotificationText    
      ,NotificationType    
      ,Individualview    
      ,IndividualviewDate    
      ,Notification_9    
      ,Notification_Date_9    
      ,CreatedBy    
      ,CreatedDate    
      ,UpdatedBy    
      ,UpdatedDate    
      ,CLTCODEDupl    
      ,URL    
      ,area    
      ,controller    
      ,[action]
	  ,CampaignId)      
    VALUES(    
      @SbTag    
      ,@NotificationText    
      ,'Individual'    
      ,'N'    
      ,NULL    
      ,'Y'    
      ,GETDATE()    
      ,@empName    
      ,GETDATE()    
      ,''    
      ,GETDATE()    
      ,''    
      ,@url    
      ,@area    
      ,@controller    
      ,@action
	  ,@CampaignId)      
            
        
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationNXTALL
-- --------------------------------------------------
CREATE procedure [dbo].[usp_NotificationNXTALL]      
(       
 @NotificationText varchar(8000)='Testing',      
 @URL varchar(MAX)='Testing',      
 @area varchar(200)='Testing'      
 ,@controller varchar(200)='Testing'       
 ,@action varchar(200)='Testing'      
 ,@empName varchar(200) ='Testing'    
 ,@CampaignId varchar(200)='Testing',    
@StartDate DATE = NULL,    
@StartTime TIME = NULL,    
@ExpiryDate DATE = NULL,    
@ExpiryTime TIME = NULL,  
@QueryParameter VARCHAR(500) = NULL  
)      
as      
begin      
    
--truncate table [tbl_NotificationNXTALL]      

--DECLARE @id_control INT
--DECLARE @batchSize INT
--DECLARE @results INT

--SET @results = 1
--SET @batchSize = 10000
--SET @id_control = 0

select * into #user_login_syn from NXT.dbo.user_login_syn UL with (nolock)     
where       
status=1      
and login_inactive_date>getdate()     
and access_to='SB'     
--and len(username)>2     
and usertype='ADMIN'      
and username is not NULL      

--DECLARE @batch INT = 10000;

--WHILE @batch > 0
--BEGIN

	    
insert into [tbl_NotificationNXT]  (sub_broker, NotificationText, NotificationType, Individualview, IndividualviewDate, Notification_9, Notification_Date_9, CreatedBy,     
CreatedDate, UpdatedBy, UpdatedDate, CLTCODEDupl, URL, area, controller, action, CampaignId, IsInActive, StartDate, StartTime, ExpiryDate, ExpiryTime, QueryParameter)      
SELECT       
--[NotificationID]      
      access_code Access_code      
      ,@NotificationText  [NotificationText]      
      ,'All' [NotificationType]     
      ,'N' [Individualview]      
      ,null [IndividualviewDate]      
      ,'Y' [Notification_9]      
      ,getdate() [Notification_Date_9]     
      ,@empName [CreatedBy]      
      ,GETDATE() [CreatedDate]      
      ,'' [UpdatedBy]      
      ,getdate() [UpdatedDate]    
      ,'' [CLTCODEDupl]     
   ,@URL URL      
   ,@area area      
   ,@controller controller      
   ,@action action      
   ,@CampaignId CampaignId    
   , 0 [IsInActive],     
   @StartDate,     
   @StartTime,     
   @ExpiryDate,    
   @ExpiryTime,  
   @QueryParameter  
  FROM    
#user_login_syn
--where userid> @id_control
--      AND userid <= @id_control + @batchSize

    --SET @batch = @@ROWCOUNT
	
END 

--ENd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationNXTALL_new
-- --------------------------------------------------
CREATE procedure [dbo].[usp_NotificationNXTALL_new]      
(       
 @NotificationText varchar(8000),      
 @URL varchar(MAX),      
 @area varchar(200)      
 ,@controller varchar(200)       
 ,@action varchar(200)      
 ,@empName varchar(200)     
 ,@CampaignId varchar(200),    
@StartDate DATE = NULL,    
@StartTime TIME = NULL,    
@ExpiryDate DATE = NULL,    
@ExpiryTime TIME = NULL,  
@QueryParameter VARCHAR(500) = NULL  
)      
as      
begin      
    
--truncate table [tbl_NotificationNXTALL]      

select * into #user_login_syn from NXT.dbo.user_login_syn UL with (nolock)     
where       
status=1      
and login_inactive_date>getdate()     
and access_to='SB'     
--and len(username)>2     
and usertype='ADMIN'      
and username is not NULL      

     
insert into [tbl_NotificationNXT]  (sub_broker, NotificationText, NotificationType, Individualview, IndividualviewDate, Notification_9, Notification_Date_9, CreatedBy,     
CreatedDate, UpdatedBy, UpdatedDate, CLTCODEDupl, URL, area, controller, action, CampaignId, IsInActive, StartDate, StartTime, ExpiryDate, ExpiryTime, QueryParameter)      
SELECT       
--[NotificationID]      
      access_code Access_code      
      ,@NotificationText  [NotificationText]      
      ,'All' [NotificationType]     
      ,'N' [Individualview]      
      ,null [IndividualviewDate]      
      ,'Y' [Notification_9]      
      ,getdate() [Notification_Date_9]     
      ,@empName [CreatedBy]      
      ,GETDATE() [CreatedDate]      
      ,'' [UpdatedBy]      
      ,getdate() [UpdatedDate]    
      ,'' [CLTCODEDupl]     
   ,@URL URL      
   ,@area area      
   ,@controller controller      
   ,@action action      
   ,@CampaignId CampaignId    
   , 0 [IsInActive],     
   @StartDate,     
   @StartTime,     
   @ExpiryDate,    
   @ExpiryTime,  
   @QueryParameter  
  FROM    
      
#user_login_syn
      
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationNXTALL_Testing
-- --------------------------------------------------
CREATE procedure [dbo].[usp_NotificationNXTALL_Testing]      
(       
 @NotificationText varchar(8000)='Testing',      
 @URL varchar(MAX)='Testing',      
 @area varchar(200)='Testing'      
 ,@controller varchar(200)='Testing'       
 ,@action varchar(200)='Testing'      
 ,@empName varchar(200) ='Testing'    
 ,@CampaignId varchar(200)='Testing',    
@StartDate DATE = NULL,    
@StartTime TIME = NULL,    
@ExpiryDate DATE = NULL,    
@ExpiryTime TIME = NULL,  
@QueryParameter VARCHAR(500) = NULL  
)      
as      
begin      
    
--truncate table [tbl_NotificationNXTALL]      

DECLARE @id_control INT
DECLARE @batchSize INT
DECLARE @results INT

SET @results = 1
SET @batchSize = 10000
SET @id_control = 0

select * into #user_login_syn from NXT.dbo.user_login_syn UL with (nolock)     
where       
status=1      
and login_inactive_date>getdate()     
and access_to='SB'     
--and len(username)>2     
and usertype='ADMIN'      
and username is not NULL      

WHILE (@results > 0)
BEGIN
	    
insert into [tbl_NotificationNXT_testing]  (sub_broker, NotificationText, NotificationType, Individualview, IndividualviewDate, Notification_9, Notification_Date_9, CreatedBy,     
CreatedDate, UpdatedBy, UpdatedDate, CLTCODEDupl, URL, area, controller, action, CampaignId, IsInActive, StartDate, StartTime, ExpiryDate, ExpiryTime, QueryParameter)      
SELECT       
--[NotificationID]      
      access_code Access_code      
      ,@NotificationText  [NotificationText]      
      ,'All' [NotificationType]     
      ,'N' [Individualview]      
      ,null [IndividualviewDate]      
      ,'Y' [Notification_9]      
      ,getdate() [Notification_Date_9]     
      ,@empName [CreatedBy]      
      ,GETDATE() [CreatedDate]      
      ,'' [UpdatedBy]      
      ,getdate() [UpdatedDate]    
      ,'' [CLTCODEDupl]     
   ,@URL URL      
   ,@area area      
   ,@controller controller      
   ,@action action      
   ,@CampaignId CampaignId    
   , 0 [IsInActive],     
   @StartDate,     
   @StartTime,     
   @ExpiryDate,    
   @ExpiryTime,  
   @QueryParameter  
  FROM    
#user_login_syn
where userid> @id_control
      AND userid <= @id_control + @batchSize


   SET @results = @@ROWCOUNT

   -- next batch
   SET @id_control = @id_control + @batchSize      
      
END 

ENd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationNXTALL_V1_DeplyLive
-- --------------------------------------------------
CREATE procedure [dbo].[usp_NotificationNXTALL_V1_DeplyLive]      
(       
 @NotificationText varchar(8000)='Testing',      
 @URL varchar(MAX)='Testing',      
 @area varchar(200)='Testing'      
 ,@controller varchar(200)='Testing'       
 ,@action varchar(200)='Testing'      
 ,@empName varchar(200) ='Testing'    
 ,@CampaignId varchar(200)='Testing',    
@StartDate DATE = NULL,    
@StartTime TIME = NULL,    
@ExpiryDate DATE = NULL,    
@ExpiryTime TIME = NULL,  
@QueryParameter VARCHAR(500) = NULL  
)      
as      
begin      
    
--truncate table [tbl_NotificationNXTALL]      

DECLARE @id_control INT
DECLARE @batchSize INT
DECLARE @results INT

SET @results = 1
SET @batchSize = 10000
SET @id_control = 0

select * into #user_login_syn from NXT.dbo.user_login_syn UL with (nolock)     
where       
status=1      
and login_inactive_date>getdate()     
and access_to='SB'     
--and len(username)>2     
and usertype='ADMIN'      
and username is not NULL      

WHILE (@results > 0)
BEGIN
	    
insert into [tbl_NotificationNXT]  (sub_broker, NotificationText, NotificationType, Individualview, IndividualviewDate, Notification_9, Notification_Date_9, CreatedBy,     
CreatedDate, UpdatedBy, UpdatedDate, CLTCODEDupl, URL, area, controller, action, CampaignId, IsInActive, StartDate, StartTime, ExpiryDate, ExpiryTime, QueryParameter)      
SELECT       
--[NotificationID]      
      access_code Access_code      
      ,@NotificationText  [NotificationText]      
      ,'All' [NotificationType]     
      ,'N' [Individualview]      
      ,null [IndividualviewDate]      
      ,'Y' [Notification_9]      
      ,getdate() [Notification_Date_9]     
      ,@empName [CreatedBy]      
      ,GETDATE() [CreatedDate]      
      ,'' [UpdatedBy]      
      ,getdate() [UpdatedDate]    
      ,'' [CLTCODEDupl]     
   ,@URL URL      
   ,@area area      
   ,@controller controller      
   ,@action action      
   ,@CampaignId CampaignId    
   , 0 [IsInActive],     
   @StartDate,     
   @StartTime,     
   @ExpiryDate,    
   @ExpiryTime,  
   @QueryParameter  
  FROM    
#user_login_syn
where userid> @id_control
      AND userid <= @id_control + @batchSize


   SET @results = @@ROWCOUNT

   -- next batch
   SET @id_control = @id_control + @batchSize      
      
END 

ENd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NotificationNXTIndivisual
-- --------------------------------------------------

CREATE procedure [dbo].[usp_NotificationNXTIndivisual]    
(    
@SbTag varchar(20),    
@NotificationText varchar(8000),    
@url varchar(8000)=null    
,@area varchar(200)    
,@controller varchar(200)     
,@action varchar(200)    
,@empName varchar(200)    
,@CampaignId varchar(200),  
@StartDate DATE = NULL,  
@StartTime TIME = NULL,  
@ExpiryDate DATE = NULL,  
@ExpiryTime TIME = NULL,
@QueryParameter VARCHAR(500) = NULL
)    
as    
begin    
    
--select * from [tbl_NotificationNXT]    
    
insert into [tbl_NotificationNXT](sub_broker,NotificationText,NotificationType,Individualview,IndividualviewDate,Notification_9,Notification_Date_9,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,CLTCODEDupl,URL,area,controller,action,CampaignId, IsInActive, 
StartDate, StartTime, ExpiryDate, ExpiryTime, QueryParameter)   
   
Values(@SbTag,@NotificationText,'Individual','N',Null,'Y',getdate(),@empName,GETDATE(),'',GETDATE(),'',@url,@area,@controller,@action,@CampaignId, 0, @StartDate, @StartTime, @ExpiryDate, @ExpiryTime, @QueryParameter)    
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NRMS_Job_Time_Mail
-- --------------------------------------------------

CREATE Procedure usp_NRMS_Job_Time_Mail
(
		@StartEND Varchar(20)='Start'
)
as
begin

Declare @StartDate Datetime=Getdate(),
@subject varchar(100),
@BodyContent varchar(2000)

--EXEC usp_NRMS_Job_Time_Mail 'END'

If @StartEND='Start'
begin

Set @subject='NRMS job started at '+' ' +convert(varchar(20),Getdate())

EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
--@recipients = 'yogesh.rewatkar@angelbroking.com', 
@recipients = 'yogesh.rewatkar@angelbroking.com;jogendar.dhoble@angelbroking.com;chhabiraj.chaurasia@angelbroking.com;
yogen.gandhi@angelbroking.com;rahul.shah@angelbroking.com;subbulakshmi.sk@angelbroking.com;jigar.ravani@angelbroking.com;', 

	            @subject = @subject,
                @body=
				'Hello All,
				NRMS job started.',
				@from_address   = 'nxt@angelbroking.com'
END
ELSE 
BEGIN

INSERT INTO  NXT.dbo.job_StatusNXT_log(JobName ,Modulename ,UpdateTime)
SELECT
'NRMSSummary_182',
'NRMS',
getdate()

INSERT INTO  [172.31.12.199].NXT.dbo.job_StatusNXT_log(JobName ,Modulename ,UpdateTime)
SELECT
'NRMSSummary_182',
'NRMS',
getdate()



SET @subject='NRMS job completed successfully at '+' ' +convert(varchar(20),Getdate())


EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'nxt',
--@recipients = 'yogesh.rewatkar@angelbroking.com',
@recipients = 'yogesh.rewatkar@angelbroking.com;jogendar.dhoble@angelbroking.com;chhabiraj.chaurasia@angelbroking.com;yogen.gandhi@angelbroking.com;
rahul.shah@angelbroking.com;subbulakshmi.sk@angelbroking.com', 

	            @subject = @subject,
                @body=
				'Hello All,

				NRMS job completed sucessfully.',
				@from_address   = 'nxt@angelbroking.com'

END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NXT_clientcommunication_add_groupclients
-- --------------------------------------------------


/******************************************************************************************************
Created By :Narendra
Date : 19-10-2018

begin tran
exec usp_NXT_clientcommunication_add_groupclients 'AJYC','Test Group of 10','A98753','4'
select * from NXTCommunicationGroupMaster where groupid=4
select * from NXTCommunicationGroupMapping where clientid='A98753'
rollback

************************************************************************************************/



CREATE PROCEDURE [dbo].[usp_NXT_clientcommunication_add_groupclients]
(
		@Sub_broker Varchar(200),
		@GroupName Varchar(500)=NULL,
		--@Type Varchar(10)='SB',
		--@CreateBy Varchar(10)=NULL,
		@Clientid varchar(MAX)=NULL,
		@GroupId iNT=NULL

)

AS
BEGIN


Declare @ClientidTemp Table
(
	Clientid Varchar(2000)
)


--	INSERT INTO @ClientidTemp
--	SELECT distinct StringValue AS CoCode FROM fn_Split('PX45,S125378', ',')
--SELECT a.Clientid,1 from @ClientidTemp a left join NXTCommunicationGroupMapping b on a.Clientid=b.Clientid where b.Clientid is null


--SELECT * FROM NXTCommunicationGroupMapping a WITH (NOLOCK) inner join @ClientidTemp b on a.Clientid=b.Clientid WHERE a.GroupId=1 and a.isdelete=1


	INSERT INTO @ClientidTemp
	SELECT distinct StringValue AS CoCode FROM fn_Split(@Clientid, ',')
	



	IF  EXISTS(SELECT * FROM NXTCommunicationGroupMaster WITH (NOLOCK) WHERE Sub_broker=@Sub_broker and GroupId=@GroupId --and isdelete=0 
		)
		
			BEGIN		
			update NXTCommunicationGroupMaster set GroupName=@GroupName WHERE Sub_broker=@Sub_broker and GroupId=@GroupId
			select 1 as stat
				
	if  EXISTS(SELECT * FROM NXTCommunicationGroupMapping a WITH (NOLOCK) inner join @ClientidTemp b on a.Clientid=b.Clientid WHERE a.GroupId=@GroupId and a.isdelete=1)
	begin
	update a set a.isdelete=0 , deleted_at=getdate() from NXTCommunicationGroupMapping a inner join @ClientidTemp b on a.Clientid=b.Clientid WHERE a.GroupId=@GroupId and a.isdelete=1
	end

	if exists (SELECT * from @ClientidTemp a left join NXTCommunicationGroupMapping b WITH (NOLOCK)  on  b.Groupid = @GroupId and a.Clientid=b.Clientid where b.Clientid is null)
	begin
	INSERT INTO NXTCommunicationGroupMapping(Clientid,Groupid)
	SELECT a.Clientid,@GroupId from @ClientidTemp a left join NXTCommunicationGroupMapping b WITH (NOLOCK) on  b.Groupid = @GroupId and a.Clientid=b.Clientid where b.Clientid is null
	end

	END

	else 
		begin
			select 0 as stat
		end		
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NXT_clientcommunication_delete_groupclients
-- --------------------------------------------------


/*********************************************************************************
Created By: Narendra
Date : 19-10-2018
begin tran
exec usp_NXT_clientcommunication_delete_groupclients 'ET','2'
select * from NXTCommunicationGroupMaster
select * from NXTCommunicationGroupMapping
rollback

********************************************************************************/



CREATE PROCEDURE [dbo].[usp_NXT_clientcommunication_delete_groupclients]
(
		@Sub_broker Varchar(200),
		@GroupId iNT=NULL
)

AS
BEGIN

IF  EXISTS (SELECT * FROM NXTCommunicationGroupMaster WITH (NOLOCK) WHERE Sub_broker=@Sub_broker and GroupId =@GroupId and isdelete=0)
begin
update NXTCommunicationGroupMaster set isdelete=1 , deleted_at=getdate() where Sub_broker=@Sub_broker and GroupId =@GroupId

--IF  EXISTS (SELECT * FROM NXTCommunicationGroupMapping WITH (NOLOCK) WHERE GroupId =@GroupId)

update NXTCommunicationGroupMapping set isdelete=1 ,deleted_at=getdate() where GroupId =@GroupId

 select 1 as stat
 end
 else 
 begin
 select 0 as stat
 end
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NXT_clientcommunication_remove_groupclients
-- --------------------------------------------------


/*********************************************************************************
Created By: Narendra
Date : 19-10-2018


begin tran
exec usp_NXT_clientcommunication_remove_groupclients 'PX45,S12537','2'
select * from NXTCommunicationGroupMapping
rollback

********************************************************************************/



CREATE PROCEDURE [dbo].[usp_NXT_clientcommunication_remove_groupclients]
(
		@Clientid varchar(MAX)=NULL,
		@GroupId iNT=NULL

)

AS
BEGIN


Declare @ClientidTemp Table
(
	Clientid Varchar(2000)
)


	INSERT INTO @ClientidTemp
	SELECT distinct StringValue AS CoCode FROM fn_Split(@Clientid, ',')

	IF  EXISTS(SELECT * FROM NXTCommunicationGroupMapping a WITH (NOLOCK) inner join @ClientidTemp b on a.Clientid=b.Clientid WHERE a.GroupId=@GroupId and a.isdelete=0 )
	begin
	update NXTCommunicationGroupMapping set isdelete=1 ,deleted_at=getdate() where GroupId=@GroupId and  Clientid in (select Clientid from @ClientidTemp)
	select 1 as stat
	end
	else 
	begin
	select 0 as stat
	end
	End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_nxt_getadvisory_perf_report
-- --------------------------------------------------
--usp_nxt_getadvisory_perf_report 'equity-Fno'
--usp_nxt_getadvisory_perf_report 'commodity'
--usp_nxt_getadvisory_perf_report 'currency'
create procedure [dbo].[usp_nxt_getadvisory_perf_report](
@segment varchar(100)
)
as
begin
	set nocount on
	if(@segment = 'equity-Fno')
	begin
		select * from tbl_advisory_per_rep_eq_FNO with(nolock)
	end
	else if(@segment = 'commodity')
	begin
		select * from tbl_advisory_per_rep_comm with(nolock)
	end
	else if(@segment = 'currency')
	begin
		select * from tbl_advisory_per_rep_curr with(nolock)
	end
	else 
	begin
		select 'please select segment' as Error
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_NXT_HistoryUserLogin
-- --------------------------------------------------


CREATE  Procedure [dbo].[Usp_NXT_HistoryUserLogin]
as
begin

SET NOCOUNT ON

Declare @StartDate DATE


--Insert into [NXT_HistoryUserLogin]
--  SELECT DISTINCT *,convert(date,getdate())
--	FROM [NXT]..NXT_UserLogin A WITH(NOLOCK)
--	WHERE CAST(Last_login AS DATE) = CAST(GETDATE() AS DATE)
--	ORDER BY Username ASC

Insert into [NXT_HistoryUserLogin]	
 SELECT DISTINCT A.*,convert(date,getdate())
	FROM [NXT]..NXT_UserLogin A WITH(NOLOCK)
	Left join [NXT_HistoryUserLogin] B
	ON A.Username=B.Username
	and CAST(A.Last_login AS DATE) = CAST(EnterDate as date)
	WHERE CAST(A.Last_login AS DATE) = CAST(GETDATE() AS DATE)
	and B.Username is null


select @StartDate=convert(date,dateadd(mm,-3, getdate()))
delete from [NXT_HistoryUserLogin] where convert(date,EnterDate)<@StartDate
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NXT_Insert_MF_DB_Logs
-- --------------------------------------------------
    
CREATE PROCEDURE [dbo].USP_NXT_Insert_MF_DB_Logs      
(        
 @Event VARCHAR (100) = NULL,    
 @ModuleName VARCHAR (500) = NULL,    
 @ClassName VARCHAR (500) = NULL,    
 @MethodName VARCHAR (500) = NULL,    
 @SPName VARCHAR (500) = NULL,    
 @DB  VARCHAR (500) = NULL,    
 @Server VARCHAR (100) = NULL,    
 @Request VARCHAR (MAX) = NULL,    
 @TimeTaken BIGINT,    
 @ErrorMsg VARCHAR (MAX) = NULL  ,    
 @StackTrace VARCHAR (MAX) = NULL ,  
 @IP VARCHAR (100) = NULL,    
 @CreatedBy VARCHAR (200) = NULL    
)        
AS        
BEGIN    
 SET NOCOUNT ON    
        
 INSERT INTO MF_DB_Logs(Event,ModuleName,ClassName,MethodName,SPName,DB,Server,Request,TimeTaken,ErrorMsg,StackTrace,IP,CreatedBy,CreatedDate)  
    VALUES (@Event, @ModuleName, @ClassName, @MethodName, @SPName, @DB, @Server, @Request, @TimeTaken, @ErrorMsg, @StackTrace,     
  @IP, @CreatedBy, GETDATE())     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NXT_InsertErrorlog
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_NXT_InsertErrorlog]  
(  
 @ProjectName Varchar (20) =Null  
,@ModuleName Varchar (300) =Null  
,@Controller Varchar (50) =Null  
,@ErrorMsg varchar (max) =Null  
,@Action varchar (50) =Null  
,@API_URL varchar (max) =Null  
,@Request  varchar (max) =Null  
,@Response Varchar (max) =Null  
,@StackTrace varchar (max) =Null  
,@CreatedBy Varchar (50) =Null  
,@createdDate Datetime =Null  
,@Event Varchar (20) =Null  
,@IPAddress varchar (50)=NULL
)  
As  
BEgin  
  
SET NOCOUNT ON  
  
 --return 0

INSERt INTO Error_log  
(  
 ProjectName  
,ModuleName  
,Controller  
,ErrorMsg  
,Action  
,API_URL  
,Request  
,Response  
,StackTrace  
,CreatedBy  
,createdDate  
,[Event]  
,IPAdress
)  
  
Values (  
  
 @ProjectName  
,@ModuleName  
,@Controller  
,@ErrorMsg  
,@Action  
,@API_URL  
,@Request  
,@Response  
,@StackTrace  
,@CreatedBy  
,GETDATE()  
,@Event  
,@IPAddress
)  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_NXT_LMSAPIIssue
-- --------------------------------------------------
--exec usp_NXT_LMSAPIIssue
CREATE proc [dbo].[usp_NXT_LMSAPIIssue]
as

begin
declare @Message varchar(50)=''
begin try
EXEC msdb.dbo.sp_send_dbmail  

						@profile_name = 'NXT',  

						--@recipients='anand.singh@angelbroking.com',

						--@copy_recipients=@CC,

						--@blind_copy_recipients='Yogesh.rewatkar@angelbroking.com;rewansh.jain@angelbroking.com;darshi.shah@angelbroking.com',

						@blind_copy_recipients='vaibhav.shah@angelbroking.com;anand.singh@angelbroking.com',

						@subject = 'LMS API not Working',  

						@body = 'LMS API is not working Please conatct Z- Axis Team',

						@body_format = 'Text'

						set @Message='success'
						select @Message as ErrorMessage
end try
begin catch
set @Message='failed'
select @Message as ErrorMessage
end catch
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OTP_Save_bKP26nOV2019
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[Usp_OTP_Save_bKP26nOV2019]
	 @Partycode VARCHAR(100),
	 @Otp VARCHAR(100),
	 @MobileNo VARCHAR(100),
	 @Status VARCHAR(100),
	 @SubBroker VARCHAR(100),
	 @UserType VARCHAR(100)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	INSERT INTO CamsOtpLog(PartyCode, OTP, MobileNumber, OTPSent, OTPVerified, CreatedBy, CreatedOn, UserType)
	VALUES(@Partycode, @Otp, @MobileNo, @Status, 0 , @SubBroker, GETDATE(), @UserType)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_OTP_SDC_Beenxt	_TobeDrop
-- --------------------------------------------------
CREATE PROCEDURE usp_OTP_SDC_Beenxt    
   (    
     @sb_broker VARCHAR(100)    
    ,@Otp   INT  
    ,@MobileNo  VARCHAR(10)  
    ,@OtpSent   BIT  
    ,@UserType  VARCHAR(10)   ,     
	@ARNNAME VARCHAR(100)   ,     
	@Email VARCHAR(100)   ,
	@FinYear VARCHAR(100)   
   )    
   AS    
   BEGIN    
     
      -- SET NOCOUNT ON added to prevent extra result sets from    
      -- interfering with SELECT statements.    
      SET NOCOUNT ON;    
      
      INSERT INTO [dbo].[OTP_SDC_Beenxt]       
      (  
        sb_broker  
       ,Otp  
       ,MobileNo  
       ,OTPSent  
       ,OTPVerified  
       ,CreateDate  
       ,ModifyDate  
       ,UserType
       ,WrongCount  
	   ,FinYear
		,ARNNAME
		,Email
      )    
      SELECT     
         @sb_broker  
        ,@Otp    
        ,@MobileNo  
        ,@OtpSent  
        ,0  
        ,GETDATE()    
        ,GETDATE()   
        ,@UserType
        ,0  
		  ,@FinYear
		,@ARNNAME
		,@Email



		EXEC dbo.[usp_sb_Declaration_OTP_Mail] @sb_broker,@ARNNAME,@FinYear,@Otp,@Email,@UserType 

   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Ozonetel_Error_Log
-- --------------------------------------------------

CREATE procedure [dbo].[usp_Ozonetel_Error_Log]
(
	@JsonResponse varchar(max),
	@ExceptionMessage  varchar(max)
)
as
begin

	Insert into Ozonetel_Error_Log
	Select 
	@JsonResponse ,
	@ExceptionMessage,
	GETDATE() 

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Ozonetel_GetSubBrokerData
-- --------------------------------------------------

CREATE Procedure [dbo].[usp_Ozonetel_GetSubBrokerData]
(
  @cid Varchar(100)='09082927347',
  @did Varchar(100)
)
as
begin




select @cid as CallerNumber, @did as CalledNumber, 'Ravindra Solanki' as AgentID, '9555222751' as AgentPhoneNumber, 'Booking' as SkillName


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_OzonetelCallBackData
-- --------------------------------------------------
CREATE procedure [dbo].[usp_OzonetelCallBackData]
(
@AgentPhoneNumber varchar(100),
@Disposition varchar(100),
@CallerConfAudioFile varchar(100),
@TransferredTo varchar(100) ,
@Apikey varchar(100),
@Did varchar(100),
@StartTime varchar(100),
@CallDuration varchar(100),
@EndTime varchar(100),
@ConfDuration varchar(100),
@CustomerStatus varchar(100),
@TimeToAnswer varchar(100),
@monitorUCID varchar(100),
@AgentID varchar(100),
@AgentStatus varchar(100) ,
@Location varchar(100),
@FallBackRule varchar(100),
@CampaignStatus varchar(100),
@CallerID varchar(100),
@Duration varchar(100),
@Status varchar(100),
@AgentUniqueID varchar(100),
@UserName varchar(100),
@HangupBy varchar(100),
@AudioFile varchar(100) ,
@PhoneName varchar(100),
@TransferType varchar(100),
@DialStatus varchar(100),
@CampaignName varchar(100),
@UUI varchar(100),
@AgentName varchar(100),
@Skill varchar(100),
@DialedNumber varchar(100),
@Type varchar(100),
@Comments varchar(100)
)
as
begin


Insert into OzonetelCallBackData
(  
       AgentPhoneNumber
      ,Disposition
      ,CallerConfAudioFile
      ,TransferredTo
      ,Apikey
      ,Did
      ,StartTime
      ,CallDuration
      ,EndTime
      ,ConfDuration
      ,CustomerStatus
      ,TimeToAnswer
      ,monitorUCID
      ,AgentID
      ,AgentStatus
      ,Location
      ,FallBackRule
      ,CampaignStatus
      ,CallerID
      ,Duration
      ,Status
      ,AgentUniqueID
      ,UserName
      ,HangupBy
      ,AudioFile
      ,PhoneName
      ,TransferType
      ,DialStatus
      ,CampaignName
      ,UUI
      ,AgentName
      ,Skill
      ,DialedNumber
      ,Type
      ,Comments
)
Select
 @AgentPhoneNumber
,@Disposition
,@CallerConfAudioFile
,@TransferredTo
,@Apikey
,@Did
,@StartTime
,@CallDuration
,@EndTime
,@ConfDuration
,@CustomerStatus
,@TimeToAnswer
      ,@monitorUCID
      ,@AgentID
      ,@AgentStatus
      ,@Location
      ,@FallBackRule
      ,@CampaignStatus
      ,@CallerID
      ,@Duration
      ,@Status
      ,@AgentUniqueID
      ,@UserName
      ,@HangupBy
      ,@AudioFile
      ,@PhoneName
      ,@TransferType
      ,@DialStatus
      ,@CampaignName
      ,@UUI
      ,@AgentName
      ,@Skill
      ,@DialedNumber
      ,@Type
      ,@Comments
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_OzonetelIncomingCallData
-- --------------------------------------------------
CREATE procedure [dbo].[usp_OzonetelIncomingCallData]
(
@phoneNumber varchar(100),
@ucid varchar(100),
@did varchar(100),
@callerID varchar(100) ,
@skillName varchar(100),
@agentID varchar(100),
@campaignId varchar(100),
@monitorUcid varchar(100),
@type varchar(100),
@uui varchar(100),
@agentUniqueID varchar(100),
@dataID varchar(100),
@phoneName varchar(100),
@agentPhoneNumber varchar(100)
)
as
begin


Insert into OzonetelIncomingCallData
(
  phoneNumber,
  ucid,
  did,
  callerID,
  skillName,
  agentID,
  campaignId,
  monitorUcid,
  type,
  uui,
  agentUniqueID,
  dataID,
  phoneName,
  agentPhoneNumber,
  createDate 
)
Select
 @phoneNumber
,@ucid
,@did
,@callerID
,@skillName
,@agentID
,@campaignId
,@monitorUcid
,@type
,@uui
,@agentUniqueID
,@dataID
,@phoneName
,@agentPhoneNumber
,getdate()
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PartyTickerIndex
-- --------------------------------------------------
/*
 FSS_EQUITY
 FSS_MF
 FSS_DERIVATIVES
 FSS_COMMODITIES
 ANGEL_SCREENERS
 [196.1.115.232]

*/

CREATE procedure [dbo].[usp_PartyTickerIndex]
(
	@Access_Code varchar(50),
	@Symbol varchar(200),
	@sActive varchar(1)
)
AS
set nocount on 

BEGIN

CREATE TABLE #Symbol_list (Symbol VARCHAR(500))

	INSERT INTO #Symbol_list (Symbol)
		SELECT StringValue
		FROM fn_Split(@Symbol, ',')


				update tbl_PartyTickerIndex
				set 
						--Symbol =@Symbol ,
						sActive =@sActive 
				from tbl_PartyTickerIndex A
				inner join #Symbol_list B 
				on A.Symbol=B.Symbol
				where A.Access_Code=@Access_Code
				


				update tbl_PartyTickerIndex
				set 
						--Symbol =@Symbol ,
						sActive ='F'
				from tbl_PartyTickerIndex A
				left join #Symbol_list B 
				on A.Symbol=B.Symbol
				where A.Access_Code=@Access_Code
				and B.Symbol is null
				

		------For remaining symbols to bydefault active

		
--Declare @Access_Code varchar(20)
DECLARE @cnt INT 
--Set @Access_Code='ET'



SELECT *
into #temp
		--symbol,	CurrValue	,absolutechange	,NetChangeFromPrevClose
FROM
(
		SELECT 
		case when co_code=20559 then 1 
		     when co_code=20558 then 2
			 when co_code=26753 then 8 END Order_by,
			 case when symbol='BSESENSEX' then 'SENSEX' 
				when symbol='BANKNIFTY' then 'Bank Nifty' ELSE symbol END as symbol
		FROM [172.31.16.75].ANGEL_WMS.DBO.Vw_IndianIndices WITH(NOLOCK) 
		WHERE co_code in (20559,20558,26753)


UNION

		SELECT 
		case when P.NAME='Nikkei 225' then 3 	
			 when P.NAME='DAX' then 4 
			 when P.Name='Nasdaq'then 5  
			 when P.Name='DJIA'then 6 
			 --when P.Name='Straits Times'then 6 
			 --when P.Name='S&P 100' then 7 
			 when P.Name='S&P 500'then 7
			 END Order_by,
		CASE WHEN P.NAME='Nikkei 225' THEN 'Nikkei' ELSE P.NAME END Exchange
		
		 --FROM [172.31.16.75].ANGEL_WMS.DBO.Vw_GlobalIndices GI WITH(NOLOCK) 
		 FROM [196.1.115.232].FSS_EQUITY.dbo.feed_windicesmaster M WITH (NOLOCK)
		INNER JOIN [196.1.115.232].FSS_EQUITY.dbo.bi_worldindices_latestprices P WITH (NOLOCK) ON M.NAME = P.NAME
		WHERE P.NAME IN ('DAX','Nikkei 225','Nasdaq','DJIA','S&P 500')
) T
ORDER BY Order_by

declare @Cnt1 INT
declare @Top INT

--select * from #temp
select @Cnt1=count(1) from tbl_PartyTickerIndex  where access_code=@Access_Code
and sActive='T'


set @Top=4-@Cnt1

		IF @Top>0 
				BEGIN
						select * into #temp1 from #temp 
						where symbol not in (select symbol from tbl_PartyTickerIndex  where access_code=@Access_Code and sActive='T' )

						select @cnt=count(*) from #temp A
						inner join tbl_PartyTickerIndex B
						ON A.symbol=B.Symbol
						where sActive='T'



						Declare @Sql varchar(1000)

						Set @Sql='select top  '+convert(varchar,@Top)+'  * into #Final from #temp1

						Update tbl_PartyTickerIndex
						Set sActive=''T''
						where symbol in (select symbol from #Final)
				
						--drop table #temp1

				'

				EXEC  (@Sql) 


				
			END

drop table #temp


--end









		
		/*
		IF @Symbol = 'All'
		BEGIN
			
			UPDATE tbl_PartyTickerIndex SET sActive = @sActive 
			WHERE Symbol IN ('NIFTY', 'SENSEX', 'Nikkei', 'DAX')
			AND Access_Code = @Access_Code
		
		END
		ELSE IF not exists (select 1 from tbl_PartyTickerIndex where Access_Code=@Access_Code and Symbol=@Symbol)
		begin
				insert into tbl_PartyTickerIndex
				(
							Access_Code
							,Symbol
							,sActive
				)
				select 
						@Access_Code ,
						@Symbol ,
						@sActive 
				end 
		else
		begin
				update tbl_PartyTickerIndex
				set 
						--Symbol =@Symbol ,
						sActive =@sActive 
				where Access_Code=@Access_Code
				and Symbol=@Symbol

		END
		*/

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PassivToActiveNXT
-- --------------------------------------------------

CREATE procedure [dbo].[usp_PassivToActiveNXT]
(
@Party_Code varchar(max)
,@CreatedDate datetime=NULL
,@CreatedBy  varchar(100)

)
as
begin
Set nocount on 

CREATE TABLE #PartyList  
(
	PartyCode  varchar(1000)
)


 INSERT INTO #PartyList  
		 SELECT StringValue AS PartyCode  
		 FROM dbo.fn_Split(@Party_Code, ',')  

  INSERT INTO PassivToActiveNXT (Party_Code,CreatedDate,CreatedBy,Flag,filegenerated)      
  SELECT PartyCode,getdate(),@CreatedBy,'0','N' FROM       
  #PartyList A       
  left join PassivToActiveNXT B      
  ON A.PartyCode=B.Party_Code      
  Where B.Party_Code is null 
		
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PassivToActiveNXT_8April2020
-- --------------------------------------------------

Create procedure [dbo].[usp_PassivToActiveNXT_8April2020]
(
@Party_Code varchar(max)
,@CreatedDate datetime=NULL
,@CreatedBy  varchar(100)

)
as
begin
Set nocount on 

CREATE TABLE #PartyList  
(
	PartyCode  varchar(1000)
)


 INSERT INTO #PartyList  
		 SELECT StringValue AS PartyCode  
		 FROM dbo.fn_Split(@Party_Code, ',')  

INSERT INTO PassivToActiveNXT (Party_Code,CreatedDate,CreatedBy)
	SELECT PartyCode,getdate(),@CreatedBy FROM 
	#PartyList A 
	left join PassivToActiveNXT B
	ON A.PartyCode=B.Party_Code
	Where B.Party_Code is null
		
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PassivToActiveNXT_Add_ReactivetionProcess_UAT
-- --------------------------------------------------
 
 
--exec usp_PassivToActiveNXT_Add_ReactivetionProcess_UAT  'NOR021','DELHINOR' 
CREATE procedure [dbo].[usp_PassivToActiveNXT_Add_ReactivetionProcess_UAT]    
(    
@Party_Code varchar(max)    
,@CreatedDate datetime=NULL    
,@CreatedBy  varchar(100)    
    
)    
as    
begin    
Set nocount on     
    
    
	IF exists (select * from [196.1.115.132].mis.dbo.Tbl_PassiveRecords where Party_code=@Party_Code)
	BEGIN 
	CREATE TABLE #PartyList      
	(    
	 PartyCode  varchar(1000)    
	)    
	    
    
	 INSERT INTO #PartyList      
	 SELECT StringValue AS PartyCode      
	 FROM dbo.fn_Split(@Party_Code, ',')      
	    
	 INSERT INTO PassivToActiveNXT (Party_Code,CreatedDate,CreatedBy,Flag,filegenerated)    
	 SELECT PartyCode,getdate(),@CreatedBy,'0','N' FROM     
	 #PartyList A     
	 left join PassivToActiveNXT B    
	 ON A.PartyCode=B.Party_Code    
	 Where B.Party_Code is null
	END 
	
	ELSE
	BEGIN 		
		--//Requirment from Ketan shah sir 
		--//Reactivation Process 
		--//Client deleted before 2012 in odin server then reactived  from odin server //
		exec [196.1.115.167].GENODINLIMIT.dbo.Usp_ReactivationProcess @Party_Code,@CreatedBy
	END
     
     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PassivToActiveNXT_Add_ReactivetionProcess_UAT_09jul2020
-- --------------------------------------------------
 
 
--exec usp_PassivToActiveNXT_Add_ReactivetionProcess_UAT  'NOR021','DELHINOR' 
CREATE procedure [dbo].[usp_PassivToActiveNXT_Add_ReactivetionProcess_UAT_09jul2020]    
(    
@Party_Code varchar(max)    
,@CreatedDate datetime=NULL    
,@CreatedBy  varchar(100)    
    
)    
as    
begin    
Set nocount on     
    
    
	IF exists (select * from [196.1.115.132].mis.dbo.Tbl_PassiveRecords where Party_code=@Party_Code)
	BEGIN 
	CREATE TABLE #PartyList      
	(    
	 PartyCode  varchar(1000)    
	)    
	    
    
	 INSERT INTO #PartyList      
	 SELECT StringValue AS PartyCode      
	 FROM dbo.fn_Split(@Party_Code, ',')      
	    
	 INSERT INTO PassivToActiveNXT (Party_Code,CreatedDate,CreatedBy)    
	 SELECT PartyCode,getdate(),@CreatedBy FROM     
	 #PartyList A     
	 left join PassivToActiveNXT B    
	 ON A.PartyCode=B.Party_Code    
	 Where B.Party_Code is null
	END 
	
	ELSE
	BEGIN 		
		--//Requirment from Ketan shah sir 
		--//Reactivation Process 
		--//Client deleted before 2012 in odin server then reactived  from odin server //
		exec [196.1.115.167].GENODINLIMIT.dbo.Usp_ReactivationProcess @Party_Code,@CreatedBy
	END
     
     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Penal_Charges_Report
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[Usp_Penal_Charges_Report]
(
	 @SubBroker VARCHAR(50)
	,@StDate DATE
	,@EdDate DATE

)
	--EXEC Usp_Penal_Charges_Report @SubBroker='ET', @StDate='12/07/2017',@EdDate='12/22/2017'
AS 
BEGIN
	
	SELECT A.* 
	FROM 
	(
		SELECT  Branch_Cd AS [Branch Code],sub_Broker  AS [SB Code],sb_name AS [SB Name],
				[Penal Value ABL]=sum(Case when InterestAmount > 0 then InterestAmount else 0 end),  
				[Penal Value ACBPL]=sum(Case when acbpl_intAmt > 0 then acbpl_intAmt else 0 end),  
				[Penal Value]=sum(Case when (InterestAmount+acbpl_intAmt) > 0 then (InterestAmount+acbpl_intAmt) else 0 end)  
		FROM [196.1.115.132].MISC.DBO.Int_sb WITH (NOLOCK) 
		WHERE balancedate >=@StDate and balancedate<=@EdDate  AND SUB_BROKER= @SubBroker 
		GROUP BY Branch_Cd,sub_Broker,sb_name
	)A
	
	LEFT OUTER JOIN
	(
		SELECT sub_Broker,RevTotal=sum(total) 
		FROM [196.1.115.132].MISC.DBO.Penal_Reversed WITH (nolock) 
		WHERE REvDate >=@StDate and REvDate<=@EdDate and total <> 0 group by 
		sub_Broker
	)B
	ON A.[SB Code]=B.sub_Broker
	order by [Penal Value] desc 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Penal_Charges_Report_ClientWise_bkp_2018May21
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Penal_Charges_Report_ClientWise_bkp_2018May21]
(
	 @SubBroker VARCHAR(50)
	,@StDate DATE
	,@EdDate DATE

)
	--EXEC Usp_Penal_Charges_Report_ClientWise @SubBroker='ET', @StDate='12/07/2017',@EdDate='12/22/2017'
AS 
BEGIN

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, @StDate), 3) + ' ' + RIGHT('0' + DATENAME(DAY, @StDate), 2) + ' ' + DATENAME(YEAR, @StDate)
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, @EdDate)), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, @EdDate)), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, @EdDate))

	/********************************/
	-- Interest Summary Report
	/********************************/
	CREATE TABLE #IntSummary
	(
		CLTCODE VARCHAR(10)
		,PERIOD VARCHAR(50)
		,INT_AMT NUMERIC(18,2)
		,LONG_NAME VARCHAR(100)
		,INT_PER NUMERIC(19,4)
	)

	INSERT INTO #IntSummary
	EXEC [172.31.16.57].ACCOUNTNBFC.dbo.CBO_INT_SUMMARYREPORT @DATEFROM = @SDate, @DATETO = @EDate, @FROMPARTY = 'a', @TOPARTY = 'z', @STATUSID = 'subbroker', @STATUSNAME = @SubBroker

	/********************************/
	-- Penal Charges Report
	/********************************/
	SELECT 
			SB=COALESCE(a.sub_Broker,b.sub_broker, @SubBroker),
			[Pcode]=COALESCE(a.party_code,b.party_code,I.CLTCODE),
			[PName]=COALESCE(a.party_name,I.LONG_NAME,''),
			[ABLPenal]=isnull([ABL Penal],0),
			[ACBPLPenal]=isnull([ACBPL Penal],0),
			[TotalPenal]=isnull([Total Penal],0),
			[IntAmt]=I.INT_AMT,
			[IntPer]=I.INT_PER
			FROM 
			(
			SELECT	sub_Broker,party_code,party_name,
					[ABL Penal]=sum(Case when (InterestAmount) > 0 then (InterestAmount) else 0 end) , 
					[ACBPL Penal]=sum(Case when (ACBPL_IntAmt) > 0 then (ACBPL_IntAmt) else 0 end) ,
					[Total Penal]=sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt) else 0 end) ,
					[Avg.Brok]=sum(brokerage)/b.nod, 
					[ABL Avg.Dr]=sum(Case when (Total) > 0 then (Total) else 0 end)/(sum(Case when (Total) > 0 then 1 else 0.0001 end)),
					[ACBPL Avg.Dr]=sum(Case when (ACBPL_Total) > 0 then (ACBPL_Total) else 0 end)/(sum(Case when (ACBPL_Total) > 0 then 1 else 0.0001 end)),
					[Total Avg.Dr]=sum(Case when (Total+ACBPL_Total) > 0 then (Total+ACBPL_Total) else 0 end)/(sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)),
					[No of Dr.Days]=sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end),
					[ROI *]=(((sum(brokerage)/b.nod)*250)/(sum(Case when Total > 0 then (Total+ACBPL_Total) else 0.0001 end)/sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)))*100 
					from [196.1.115.132].MISC.DBO.cliinterest a WITH (NOLOCK) , 
					(
						select nod=(CASE WHEN count(*) = 0 THEN 1 ELSE count(*) END) 
						from [196.1.115.132].risk.dbo.bse_sett_mst WITH (NOLOCK) 
						where sett_Type='D'and start_date >= @StDate and end_date <=@EdDate
					) b 
					WHERE LTRIM(RTRIM(sub_broker)) = @SubBroker and balancedate >=@StDate and balancedate<=@EdDate
					GROUP BY sub_Broker,party_code,party_name,b.nod 
					HAVING sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt)  else 0 end) <> 0 
			)A  
			FULL OUTER JOIN 
			(
				SELECT	sub_broker,party_code,
						[ABL Rev.Amt.]=sum(BSECM+NSECM+NSEFO+BSEFO+MCD+NSX),
						[ACBPL Rev.Amt.]=sum(MCX+NCDEX)  
						from [196.1.115.132].MISC.DBO.Penal_Reversed WITH (NOLOCK) 
						where LTRIM(RTRIM(sub_broker)) = @SubBroker and REvDate >=@StDate and REvDate<=@EdDate and Total <> 0 
						group by sub_broker,party_code
			)B 
			ON A.party_code=B.party_code
			FULL OUTER JOIN #IntSummary I ON A.party_code = I.CLTCODE 
			ORDER BY [Total Penal] DESC

			DROP TABLE #IntSummary

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Penal_Charges_Report_ClientWise_Byneeta
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[Usp_Penal_Charges_Report_ClientWise_Byneeta]
(

	@SubBroker VARCHAR(50)='GDS'
	,@StDate DATE='10/07/2018'
	,@EdDate DATE='10/15/2018'

)
	--declare @date1 datetime = getdate()
	--EXEC Usp_Penal_Charges_Report_ClientWise @SubBroker='GDS', @StDate='10/07/2018',@EdDate='10/15/2018'
	--select datediff(ms,@date1,GETDATE())
	--EXEC Usp_Penal_Charges_Report_ClientWise @SubBroker='ET', @StDate='12/07/2017',@EdDate='12/22/2017'
	/*
	EXEC Usp_Penal_Charges_Report_ClientWise_1 @SubBroker='ET', @StDate='05/14/2017',@EdDate='05/16/2017'
	EXEC Usp_Penal_Charges_Report_ClientWise @SubBroker='ET', @StDate='05/14/2017',@EdDate='05/16/2017'
	*/

AS 
BEGIN

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, @StDate), 3) + ' ' + RIGHT('0' + DATENAME(DAY, @StDate), 2) + ' ' + DATENAME(YEAR, @StDate)
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, @EdDate)), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, @EdDate)), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, @EdDate))



	/********************************/
	-- Interest Summary Report
	/********************************/
	CREATE TABLE #IntSummary
	(
		CLTCODE VARCHAR(10)
		,PERIOD VARCHAR(50)
		,INT_AMT NUMERIC(18,2)
		,LONG_NAME VARCHAR(100)
		,INT_PER NUMERIC(19,4)
	)


	INSERT INTO #IntSummary
	EXEC [172.31.16.57].ACCOUNTNBFC.dbo.CBO_INT_SUMMARYREPORT @DATEFROM = @SDate, @DATETO = @EDate, @FROMPARTY = 'a', @TOPARTY = 'z', @STATUSID = 'subbroker', @STATUSNAME = @SubBroker


	Declare @nod INT
	select @nod=(CASE WHEN count(*) = 0 THEN 1 ELSE count(*) END) 
						from [196.1.115.132].risk.dbo.bse_sett_mst WITH (NOLOCK) 
						where sett_Type='D'and start_date >= @StDate and end_date <=@EdDate

	SELECT sub_broker,party_code,
						[ABL Rev.Amt.]=sum(BSECM+NSECM+NSEFO+BSEFO+MCD+NSX),
						[ACBPL Rev.Amt.]=sum(MCX+NCDEX)
	INTO #Penal_Reversed
	FROM [196.1.115.132].MISC.DBO.Penal_Reversed WITH (NOLOCK)
	WHERE LTRIM(RTRIM(sub_broker)) = @SubBroker and REvDate >=@StDate and REvDate<=@EdDate and Total <> 0
	group by sub_broker,party_code

	SELECT 	sub_Broker,party_code,party_name,
					[ABL Penal]=sum(Case when (InterestAmount) > 0 then (InterestAmount) else 0 end) , 
					[ACBPL Penal]=sum(Case when (ACBPL_IntAmt) > 0 then (ACBPL_IntAmt) else 0 end) ,
					[Total Penal]=sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt) else 0 end) ,
					[Avg.Brok]=sum(brokerage)/@nod, 
					[ABL Avg.Dr]=sum(Case when (Total) > 0 then (Total) else 0 end)/(sum(Case when (Total) > 0 then 1 else 0.0001 end)),
					[ACBPL Avg.Dr]=sum(Case when (ACBPL_Total) > 0 then (ACBPL_Total) else 0 end)/(sum(Case when (ACBPL_Total) > 0 then 1 else 0.0001 end)),
					[Total Avg.Dr]=sum(Case when (Total+ACBPL_Total) > 0 then (Total+ACBPL_Total) else 0 end)/(sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)),
					[No of Dr.Days]=sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end),
					[ROI *]=(((sum(brokerage)/@nod)*250)/(sum(Case when Total > 0 then (Total+ACBPL_Total) else 0.0001 end)/sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)))*100 
	INTO #cliinterest
	FROM [196.1.115.132].MISC.DBO.cliinterest a WITH (NOLOCK)
	WHERE LTRIM(RTRIM(sub_broker)) = @SubBroker and balancedate >=@StDate and balancedate<=@EdDate
	GROUP BY sub_Broker,party_code,party_name--,@nod 
	HAVING sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt)  else 0 end) <> 0

	
	/********************************/
	-- Penal Charges Report
	/********************************/
	SELECT 
			SB=COALESCE(a.sub_Broker,b.sub_broker, @SubBroker),
			[Pcode]=COALESCE(a.party_code,b.party_code,I.CLTCODE),
			[PName]=COALESCE(a.party_name,I.LONG_NAME,''),
			[ABLPenal]=isnull([ABL Penal],0),
			[ACBPLPenal]=isnull([ACBPL Penal],0),
			[TotalPenal]=isnull([Total Penal],0),
			[IntAmt]=I.INT_AMT,
			[IntPer]=I.INT_PER
			INTO #Main FROM 
			(
			#cliinterest A
			--SELECT	sub_Broker,party_code,party_name,
			--		[ABL Penal]=sum(Case when (InterestAmount) > 0 then (InterestAmount) else 0 end) , 
			--		[ACBPL Penal]=sum(Case when (ACBPL_IntAmt) > 0 then (ACBPL_IntAmt) else 0 end) ,
			--		[Total Penal]=sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt) else 0 end) ,
			--		[Avg.Brok]=sum(brokerage)/@nod, 
			--		[ABL Avg.Dr]=sum(Case when (Total) > 0 then (Total) else 0 end)/(sum(Case when (Total) > 0 then 1 else 0.0001 end)),
			--		[ACBPL Avg.Dr]=sum(Case when (ACBPL_Total) > 0 then (ACBPL_Total) else 0 end)/(sum(Case when (ACBPL_Total) > 0 then 1 else 0.0001 end)),
			--		[Total Avg.Dr]=sum(Case when (Total+ACBPL_Total) > 0 then (Total+ACBPL_Total) else 0 end)/(sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)),
			--		[No of Dr.Days]=sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end),
			--		[ROI *]=(((sum(brokerage)/@nod)*250)/(sum(Case when Total > 0 then (Total+ACBPL_Total) else 0.0001 end)/sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)))*100 
			--		from #cliinterest
			--		--(
			--		--	select nod=(CASE WHEN count(*) = 0 THEN 1 ELSE count(*) END) 
			--		--	from [196.1.115.132].risk.dbo.bse_sett_mst WITH (NOLOCK) 
			--		--	where sett_Type='D'and start_date >= @StDate and end_date <=@EdDate
			--		--) b 
			--		--WHERE LTRIM(RTRIM(sub_broker)) = @SubBroker and balancedate >=@StDate and balancedate<=@EdDate
			--		GROUP BY sub_Broker,party_code,party_name--,@nod 
			--		HAVING sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt)  else 0 end) <> 0 
			--)A  
			FULL OUTER JOIN #Penal_Reversed B
			--(
			--	SELECT	sub_broker,party_code,
			--			[ABL Rev.Amt.]=sum(BSECM+NSECM+NSEFO+BSEFO+MCD+NSX),
			--			[ACBPL Rev.Amt.]=sum(MCX+NCDEX)  
			--			from #Penal_Reversed
			--			--where LTRIM(RTRIM(sub_broker)) = @SubBroker and REvDate >=@StDate and REvDate<=@EdDate and Total <> 0 
			--			group by sub_broker,party_code
			--)B 
			ON A.party_code=B.party_code)
			FULL OUTER JOIN #IntSummary I ON A.party_code = I.CLTCODE 
			ORDER BY [Total Penal] DESC

		Select * from #Main	
		UNION ALL
		select 'Grand Total' as SB	,'' as Pcode	,'' as PName,	Sum(ABLPenal) as ABLPenal	,Sum(ACBPLPenal) as ACBPLPenal ,	sum(TotalPenal) as TotalPenal	,Sum(IntAmt) as IntAmt,	NULL as IntPer
			from #Main
				
				DROP TABLE #Main
				DROP TABLE #IntSummary,#cliinterest,#Penal_Reversed
			

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Penal_Charges_Report_ClientWise_opti18Feb2019
-- --------------------------------------------------



CREATE PROCEDURE [dbo].[Usp_Penal_Charges_Report_ClientWise_opti18Feb2019]
(
	 @SubBroker VARCHAR(50)
	,@StDate DATE
	,@EdDate DATE

)
	
	/*
	EXEC [Usp_Penal_Charges_Report_ClientWise_opti18Feb2019] @SubBroker='ET', @StDate='2010-02-12',@EdDate='2019-02-18'

	EXEC Usp_Penal_Charges_Report_ClientWise_1 @SubBroker='ET', @StDate='05/14/2017',@EdDate='05/16/2017'
	EXEC Usp_Penal_Charges_Report_ClientWise @SubBroker='ET', @StDate='05/14/2017',@EdDate='05/16/2017'
	*/

AS 
BEGIN

	DECLARE @SDate VARCHAR(11) = LEFT(DATENAME(MONTH, @StDate), 3) + ' ' + RIGHT('0' + DATENAME(DAY, @StDate), 2) + ' ' + DATENAME(YEAR, @StDate)
	DECLARE @EDate VARCHAR(11) = LEFT(DATENAME(MONTH, DATEADD(D, 7, @EdDate)), 3) + ' ' + RIGHT('0' + DATENAME(DAY, DATEADD(D, 7, @EdDate)), 2) + ' ' + DATENAME(YEAR, DATEADD(D, 7, @EdDate))

	/********************************/
	-- Interest Summary Report
	/********************************/
	CREATE TABLE #IntSummary
	(
		CLTCODE VARCHAR(10)
		,PERIOD VARCHAR(50)
		,INT_AMT NUMERIC(18,2)
		,LONG_NAME VARCHAR(100)
		,INT_PER NUMERIC(19,4)
	)

	INSERT INTO #IntSummary
	EXEC [172.31.16.57].ACCOUNTNBFC.dbo.CBO_INT_SUMMARYREPORT @DATEFROM = @SDate, @DATETO = @EDate, @FROMPARTY = 'a', @TOPARTY = 'z', @STATUSID = 'subbroker', @STATUSNAME = @SubBroker


	select * from #IntSummary

	/*
	/********************************/
	-- Penal Charges Report
	/********************************/
	SELECT 
			SB=COALESCE(a.sub_Broker,b.sub_broker, @SubBroker),
			[Pcode]=COALESCE(a.party_code,b.party_code,I.CLTCODE),
			[PName]=COALESCE(a.party_name,I.LONG_NAME,''),
			[ABLPenal]=isnull([ABL Penal],0),
			[ACBPLPenal]=isnull([ACBPL Penal],0),
			[TotalPenal]=isnull([Total Penal],0),
			[IntAmt]=I.INT_AMT,
			[IntPer]=I.INT_PER
			INTO #Main FROM 
			(
			SELECT	sub_Broker,party_code,party_name,
					[ABL Penal]=sum(Case when (InterestAmount) > 0 then (InterestAmount) else 0 end) , 
					[ACBPL Penal]=sum(Case when (ACBPL_IntAmt) > 0 then (ACBPL_IntAmt) else 0 end) ,
					[Total Penal]=sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt) else 0 end) ,
					[Avg.Brok]=sum(brokerage)/b.nod, 
					[ABL Avg.Dr]=sum(Case when (Total) > 0 then (Total) else 0 end)/(sum(Case when (Total) > 0 then 1 else 0.0001 end)),
					[ACBPL Avg.Dr]=sum(Case when (ACBPL_Total) > 0 then (ACBPL_Total) else 0 end)/(sum(Case when (ACBPL_Total) > 0 then 1 else 0.0001 end)),
					[Total Avg.Dr]=sum(Case when (Total+ACBPL_Total) > 0 then (Total+ACBPL_Total) else 0 end)/(sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)),
					[No of Dr.Days]=sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end),
					[ROI *]=(((sum(brokerage)/b.nod)*250)/(sum(Case when Total > 0 then (Total+ACBPL_Total) else 0.0001 end)/sum(Case when (Total+ACBPL_Total) > 0 then 1 else 0.0001 end)))*100 
					from [196.1.115.132].MISC.DBO.cliinterest a WITH (NOLOCK) , 
					(
						select nod=(CASE WHEN count(*) = 0 THEN 1 ELSE count(*) END) 
						from [196.1.115.132].risk.dbo.bse_sett_mst WITH (NOLOCK) 
						where sett_Type='D'and start_date >= @StDate and end_date <=@EdDate
					) b 
					WHERE LTRIM(RTRIM(sub_broker)) = @SubBroker and balancedate >=@StDate and balancedate<=@EdDate
					GROUP BY sub_Broker,party_code,party_name,b.nod 
					HAVING sum(Case when (InterestAmount+ACBPL_IntAmt) > 0 then (InterestAmount+ACBPL_IntAmt)  else 0 end) <> 0 
			)A  
			FULL OUTER JOIN 
			(
				SELECT	sub_broker,party_code,
						[ABL Rev.Amt.]=sum(BSECM+NSECM+NSEFO+BSEFO+MCD+NSX),
						[ACBPL Rev.Amt.]=sum(MCX+NCDEX)  
						from [196.1.115.132].MISC.DBO.Penal_Reversed WITH (NOLOCK) 
						where LTRIM(RTRIM(sub_broker)) = @SubBroker and REvDate >=@StDate and REvDate<=@EdDate and Total <> 0 
						group by sub_broker,party_code
			)B 
			ON A.party_code=B.party_code
			FULL OUTER JOIN #IntSummary I ON A.party_code = I.CLTCODE 
			ORDER BY [Total Penal] DESC

		Select * from #Main	
		UNION ALL
		select 'Grand Total' as SB	,'' as Pcode	,'' as PName,	Sum(ABLPenal) as ABLPenal	,Sum(ACBPLPenal) as ACBPLPenal ,	sum(TotalPenal) as TotalPenal	,Sum(IntAmt) as IntAmt,	NULL as IntPer
			from #Main
				
				DROP TABLE #Main
				DROP TABLE #IntSummary
			
*/


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Penal_Charges_Report_ClientWise_SBandDealer_Bkp21May2019
-- --------------------------------------------------

Create procedure [dbo].[Usp_Penal_Charges_Report_ClientWise_SBandDealer_Bkp21May2019]
(
	 @SubBroker VARCHAR(50)
	,@StDate DATE
	,@EdDate DATE

)
AS
BEGIN 


			IF EXISTS(Select * from [dbo].[B2B_Bulk_DealerMapping_syn] with (nolock) WHERE dealer1 = @SubBroker)
			BEGIN
				--SET @Column = 'Dealer'
				--select  @SubBroker ,@StDate ,@EdDate 
								EXEC [Usp_Penal_Charges_Report_ClientWise_dealer] 	 @SubBroker ,@StDate ,@EdDate 

			END
			ELSE
			BEGIN
					EXEC [Usp_Penal_Charges_Report_ClientWise] 	 @SubBroker ,@StDate ,@EdDate 

			END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Pledge_Mapping_Restrict_LE
-- --------------------------------------------------


CREATE procedure usp_Pledge_Mapping_Restrict_LE
(
	@party_code varchar(100)
)
as
begin
--EXEC usp_Pledge_Mapping_Restrict_LE 'MADN1050'

/*
Declare @Cnt INT

select @Cnt = count(1) from 
	--[196.1.115.182].general.
	dbo.Tbl_Pledge_Mapping_syn A with (nolock)
where 
	[b2c]='N'
	and convert(date,Pldg_Exec_date) <= convert(date,Getdate())
	and party_code=@party_code
 
 select case when @Cnt >0 Then 'Restrict' else  'Allow' END Message
 */

 Select 'Allow' Message

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_pledge_Migration_Daily
-- --------------------------------------------------


CREATE Procedure usp_pledge_Migration_Daily
as
begin

EXEC [196.1.115.132].risk.dbo.usp_pledge_Migration_Daily 

Truncate table dbo.tbl_MigrationClientPledge

insert into dbo.tbl_MigrationClientPledge(Party_code,CommunicationDate,ActionDate)
select Party_code,CommunicationDate,ActionDate from [196.1.115.132].risk.dbo.tbl_MigrationClientPledge with (nolock)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PledgeModuleLog_NXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_PledgeModuleLog_NXT]
@SBTag varchar(100),
@PartyCode varchar(100),
@CreatedBy varchar(200),
@UserIP varchar(150),
@Modulename varchar(100),
@APIName varchar(200) ,
@RequestParameter text,
@ResponceParameter text,
@APIRequestTime datetime ,
@APIResponceTime datetime ,
@Status varchar(5000)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	--ScripName,TotalQuantity,MarkedQuantity,Amount,
	--@ScripName,@TotalQTY,@MarkQTY,@Amount,
	insert into PledgeModuleLog_NXT(SBTag,PartyCode,CreatedBy,CreationDateTime,UserIPAddress,Modulename,APIName ,RequestParameter,ResponceParameter,APIRequestTime ,APIResponceTime,Status ) 
	Values(@SBTag,@PartyCode,@CreatedBy ,Getdate(),@UserIP,@Modulename,@APIName ,@RequestParameter,@ResponceParameter,@APIRequestTime ,@APIResponceTime,@Status )

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_pledgeOTPGeneration
-- --------------------------------------------------
CREATE procedure [dbo].[usp_pledgeOTPGeneration]
(
	@party_code varchar(100)='abc'
	--,
	--@otp int,
	,@InitiateMargin NUmeric(20,2)
	,@BOID varchar(100)

	
)
as
begin
Set nocount on 


--EXEC usp_pledgeOTPGeneration_New 'abc',10000,'123456'


Declare @OTP INT

Set @OTP= LEFT(CAST(RAND()*1000000000 AS INT),4) 


--if (select count(1) from tbl_pledgeOTPGeneration where party_code=@party_code and convert(date,Entrydate)=convert(date,getdate()))=0
--begin 
--Print '11'
		Insert into tbl_pledgeOTPGeneration
		select @party_code
				,@OTP 
				,Getdate()

Select @OTP OTP
--END
--ELSE
--BEGIN

----Print '22'
--select @OTP=OTP from tbl_pledgeOTPGeneration where party_code=@party_code and convert(date,Entrydate)=convert(date,getdate())

--Select @OTP OTP


--END

---------------------------------Email to client--------------

EXEC Usp_PledgeOTPClient_Mail  @party_code ,@otp ,@InitiateMargin ,@BOID    --Need to remove comment 



end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_PopupAdmin
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_PopupAdmin]                
(                
      @Index  TINYINT              
     ,@ImagePath VARCHAR(MAX)             
     ,@ImageName VARCHAR(MAX)               
     ,@ExpiryDate DATE                
     ,@Redirect_Url VARCHAR(1000)                
     ,@Active  VARCHAR(3)                
     ,@Project_Type VARCHAR(100)                
     ,@Flag  VARCHAR(20)          
	 ,@Popup_Type VARCHAR(100)          
	 ,@SbTags VARCHAR(MAX)    
	 ,@empName varchar(200)     
	 ,@CampaignId varchar(200)    
	 ,@OpenInNewTab BIT = NULL
	 ,@StartDate DATE = NULL  
	 ,@StartTime TIME = NULL
	 ,@ExpiryTime TIME = NULL  
)                
AS                
BEGIN            
 Declare @PopupId int        
 INSERT INTO Tbl_PopupAdmin            
 (      
  [Index]      
  ,ImagePath      
  ,ImageName      
  ,ExpiryDate      
  ,Redirect_Url      
  ,Project_Type      
  ,Active      
  ,CreatedDate      
  ,Createdby      
  ,ModifyDate      
  ,Popup_Type      
  ,CampaignId    
  ,OpenInNewTab,  
  StartDate,  
  StartTime,  
  ExpiryTime  
  )          
 SELECT              
  @Index                 
  ,@ImagePath             
  ,@ImageName                  
  ,@ExpiryDate                
  ,@Redirect_Url                     
  ,@Project_Type              
  ,@Active                
  ,GETDATE()   AS CreatedDate                
  ,@empName AS Createdby                
  ,GETDATE()   AS  ModifyDate            
  ,@Popup_Type      
  ,@CampaignId    
  ,@OpenInNewTab,  
  @StartDate,  
  @StartTime,  
  @ExpiryTime  
      
 select @PopupId = MAX(id) from Tbl_PopupAdmin        
        
 if(@Popup_Type = 'Individual')        
 BEGIN        
  Insert into Tbl_PopupSbTagMap(PopupId, SbTag, Active)        
  select @PopupId, *, 'Y'        
  FROM  dbo.[fn_Split] (@SbTags, ',')            
 END        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PWD_RESET_MAILER_MFNXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_PWD_RESET_MAILER_MFNXT]     
@pwd varchar(40),    
@email varchar(200)    
as     

BEGIN
   
declare @Mail_body as varchar(8000)        
set @Mail_body='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body>&#65279;
<div>
	
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
		<tbody><tr>
			<td align="center" style="vertical-align:top;padding:0px 0px 0px 0px;border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1;border-right:1px solid #d1d1d1">
				<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
					<tbody>
						<tr>
							<td align="center" bgcolor="#0071BB" style="vertical-align:top;padding:0px 0px 0px 0px;background-color:#0071bb">
								<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620">
									<tbody>
										<tr>
											<td align="left" style="padding:0 0 0 5px" valign="bottom">
												<a href="" target="_blank"><img alt="Angel Broking powered by ARQ" height="53" src="http://web.angelbackoffice.com/angelbroking/econnect/Refer_and_Earn/images/angel-logo_Rev.png" style="display:block" width="250"></a>
											</td>
										</tr>
									</tbody>
								</table>
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
	</tbody></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px;background-color:#27a3a1" width="620"></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="border:1px solid #d1d1d1;border-top:none" width="620">
		<tbody>
			<tr>
				<td align="center" valign="middle">
					<a href="#0.1_" style="display:block"><img alt="NXT Password" src="https://rm.angelbroking.com/upload1/BEE-NXT_Banner.jpg" style="display:block" width="620"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:40px 30px 20px 30px">
					Dear User,<br>
					<br>
					The password for your NXT Wealth Account is: <strong>'+@pwd+'</strong><br>
					<br>
					Login and experience seamless LMS and Digital Marketing. Access your Dashboard and view your Customized ARQ.<br>
					<br>
					<a href="https://beenxt.angelbroking.com/"><img alt="Loginbtn" src="http://web.angelbackoffice.com/angelbroking/econnect/NXT_Password_270218/images/loginbtn.png"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:0 30px 20px 30px">
					For any queries, please contact us on the below details:<br>
					<a href="mailto:mfsd@angelbroking.com" style="text-decoration:underline;color:#0071bb;font-size:14px" target="_blank">mfsd@angelbroking.com</a><br>
					+91 22 4000 3600
				</td>
			</tr>
		</tbody>
	</table>
	<table align="center" bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" width="620">
		<tbody>
			<tr>
				<td align="left" bgcolor="#FFFFFF" style="background-color:#ffffff;padding:7px 5px" valign="top">
					<table align="left" border="0" cellpadding="0" cellspacing="0" style="width:100%">
						<tbody>
							<tr>
								<td align="left" bgcolor="#FFFFFF" style="vertical-align:middle" valign="center">
									<table align="left" border="0" cellpadding="0" cellspacing="0">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.facebook.com/AngelBrokingLtd" target="_blank"><img alt="Facebook" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_01.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://twitter.com/AngelBrokingLtd" target="_blank"><img alt="Twitter" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_02.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.youtube.com/user/AngelBrokingVideos" target="_blank"><img alt="Youtube" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_03.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.linkedin.com/company/angel-broking" target="_blank"><img alt="LinkedIn" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_04.png"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
								<td style="vertical-align:middle">
									<table align="right" border="0" cellpadding="0" cellspacing="2" style="vertical-align:middle">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 0">
													<a href="#0.1_" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none"><img alt="Phone" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_05.png" style="vertical-align:middle">+91 22 4000 3600</
a> &nbsp; <a href="mailto:mfsd@angelbroking.com" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none" target="_blank"><img alt="Email" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_06.png" style="verti
cal-align:middle"> mfsd@angelbroking.com</a> &nbsp; <a href="http://mf.angelmf.com/Wealth/Index2" style="color:#808080;font-family:''Arial'',sans-serif;font-size:8px;text-decoration:none" target="_blank"><img alt=" " src="https://s3.ap-south-1.amazonaws.c
om/absite-mumbai/CG/icon_08.png" style="vertical-align:middle">*Disclaimer</a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
							</tr>
						</tbody>
					</table>
				</td>
			</tr>
		</tbody>
	</table>
</div>
</body></html>'    
     
EXEC MSDB.DBO.Sp_send_dbmail    
        @PROFILE_NAME='NXT', 
        @RECIPIENTS= @email,  
		@blind_copy_recipients  ='yogesh.rewatkar@angelbroking.com;jigar.ravani@angelbroking.com',
        @SUBJECT ='Login Details',         
        @BODY =@Mail_body,                    
        @BODY_FORMAT = 'HTML'  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PWD_RESET_MAILER_MFNXT_1
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_PWD_RESET_MAILER_MFNXT_1]     
@pwd varchar(40),    
@email varchar(200)    
as     

BEGIN

--EXEC [USP_PWD_RESET_MAILER_MFNXT_1]   'ABC','yogesh.rewatkar@angelbroking.com'  
   
declare @Mail_body as varchar(8000)        
set @Mail_body='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body>&#65279;
<div>
	
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
		<tbody><tr>
			<td align="center" style="vertical-align:top;padding:0px 0px 0px 0px;border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1;border-right:1px solid #d1d1d1">
				<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
					<tbody>
						<tr>
							<td align="center" bgcolor="#0071BB" style="vertical-align:top;padding:0px 0px 0px 0px;background-color:#0071bb">
								<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620">
									<tbody>
										<tr>
											<td align="left" style="padding:0 0 0 5px" valign="bottom">
												<a href="" target="_blank"><img alt="Angel Broking powered by ARQ" height="53" src="http://web.angelbackoffice.com/angelbroking/econnect/Refer_and_Earn/images/angel-logo_Rev.png" style="display:block" width="250"></a>
											</td>
										</tr>
									</tbody>
								</table>
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
	</tbody></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px;background-color:#27a3a1" width="620"></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="border:1px solid #d1d1d1;border-top:none" width="620">
		<tbody>
			<tr>
				<td align="center" valign="middle">
					<a href="#0.1_" style="display:block"><img alt="NXT Password" src="https://rm.angelbroking.com/upload1/BEE-NXT_Banner.jpg" style="display:block" width="620"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:40px 30px 20px 30px">
					Dear User,<br>
					<br>
					The password for your NXT Wealth Account is: <strong>'+@pwd+'</strong><br>
					<br>
					Login and experience seamless LMS and Digital Marketing. Access your Dashboard and view your Customized ARQ.<br>
					<br>
					<a href="https://nxt.angelbroking.com/"><img alt="Loginbtn" src="http://web.angelbackoffice.com/angelbroking/econnect/NXT_Password_270218/images/loginbtn.png"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:0 30px 20px 30px">
					For any queries, please contact us on the below details:<br>
					<a href="mailto:mfsd@angelbroking.com" style="text-decoration:underline;color:#0071bb;font-size:14px" target="_blank">mfsd@angelbroking.com</a><br>
					+91 22 4000 3600
				</td>
			</tr>
		</tbody>
	</table>
	<table align="center" bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" width="620">
		<tbody>
			<tr>
				<td align="left" bgcolor="#FFFFFF" style="background-color:#ffffff;padding:7px 5px" valign="top">
					<table align="left" border="0" cellpadding="0" cellspacing="0" style="width:100%">
						<tbody>
							<tr>
								<td align="left" bgcolor="#FFFFFF" style="vertical-align:middle" valign="center">
									<table align="left" border="0" cellpadding="0" cellspacing="0">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.facebook.com/AngelBrokingLtd" target="_blank"><img alt="Facebook" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_01.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://twitter.com/AngelBrokingLtd" target="_blank"><img alt="Twitter" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_02.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.youtube.com/user/AngelBrokingVideos" target="_blank"><img alt="Youtube" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_03.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.linkedin.com/company/angel-broking" target="_blank"><img alt="LinkedIn" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_04.png"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
								<td style="vertical-align:middle">
									<table align="right" border="0" cellpadding="0" cellspacing="2" style="vertical-align:middle">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 0">
													<a href="#0.1_" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none"><img alt="Phone" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_05.png" style="vertical-align:middle">+91 22 4000 3600</a> &nbsp; <a href="mailto:mfsd@angelbroking.com" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none" target="_blank"><img alt="Email" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_06.png"style="vertical-align:middle"> mfsd@angelbroking.com</a> &nbsp; <a href="http://mf.angelmf.com/Wealth/Index2" style="color:#808080;font-family:''Arial'',sans-serif;font-size:8px;text-decoration:none" target="_blank"><img alt=" " src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_08.png" style="vertical-align:middle">*Disclaimer</a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
							</tr>
						</tbody>
					</table>
				</td>
			</tr>
		</tbody>
	</table>
</div>
</body></html>'    
     
EXEC MSDB.DBO.Sp_send_dbmail    
        @PROFILE_NAME='NXT', 
        @RECIPIENTS= @email,    
        @SUBJECT ='Login Details',         
        @BODY =@Mail_body,                    
        @BODY_FORMAT = 'HTML'  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PWD_RESET_MAILER_MFNXT_AngelOne
-- --------------------------------------------------
/*
EXEC [USP_PWD_RESET_MAILER_MFNXT_AngelOne] 'ABC123','jigar.ravani@angelbroking.com'
*/

CREATE PROCEDURE [dbo].[USP_PWD_RESET_MAILER_MFNXT_AngelOne]     
@pwd varchar(40),    
@email varchar(200)    
as     

BEGIN
   
declare @Mail_body as varchar(8000)        
set @Mail_body='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body>&#65279;
<div>
	
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
		<tbody><tr>
			<td align="center" style="vertical-align:top;padding:0px 0px 0px 0px;border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1;border-right:1px solid #d1d1d1">
				<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
					<tbody>
						<tr>
							<td align="center" bgcolor="#0071BB" style="vertical-align:top;padding:0px 0px 0px 0px;background-color:#0071bb">
								<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620">
									<tbody>
										<tr>
											<td align="left" style="padding:0 0 0 5px" valign="bottom">
												<a href="" target="_blank"><img alt="Angel Broking powered by ARQ" height="53" src="http://web.angelbackoffice.com/angelbroking/econnect/Refer_and_Earn/images/angel-logo_Rev.png" style="display:block" width="250"></a>
											</td>
										</tr>
									</tbody>
								</table>
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
	</tbody></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px;background-color:#27a3a1" width="620"></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="border:1px solid #d1d1d1;border-top:none" width="620">
		<tbody>
			<tr>
				<td align="center" valign="middle">
					<a href="#0.1_" style="display:block"><img alt="NXT Password" src="https://rm.angelbroking.com/upload1/BEE-NXT_Banner.jpg" style="display:block" width="620"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:40px 30px 20px 30px">
					Dear User,<br>
					<br>
					The password for your NXT Wealth Account is: <strong>'+@pwd+'</strong><br>
					<br>
					Login and experience seamless LMS and Digital Marketing. Access your Dashboard and view your Customized ARQ.<br>
					<br>
					<a href="https://beenxt.angelbroking.com/"><img alt="Loginbtn" src="http://web.angelbackoffice.com/angelbroking/econnect/NXT_Password_270218/images/loginbtn.png"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:0 30px 20px 30px">
					For any queries, please contact us on the below details:<br>
					<a href="mailto:mfsd@angelbroking.com" style="text-decoration:underline;color:#0071bb;font-size:14px" target="_blank">mfsd@angelbroking.com</a><br>
					+91 22 4000 3600
				</td>
			</tr>
		</tbody>
	</table>
	<table align="center" bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" width="620">
		<tbody>
			<tr>
				<td align="left" bgcolor="#FFFFFF" style="background-color:#ffffff;padding:7px 5px" valign="top">
					<table align="left" border="0" cellpadding="0" cellspacing="0" style="width:100%">
						<tbody>
							<tr>
								<td align="left" bgcolor="#FFFFFF" style="vertical-align:middle" valign="center">
									<table align="left" border="0" cellpadding="0" cellspacing="0">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.facebook.com/angelbrokingLtd" target="_blank"><img alt="Facebook" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_01.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://twitter.com/angelbrokingLtd" target="_blank"><img alt="Twitter" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_02.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.youtube.com/user/angelbrokingVideos" target="_blank"><img alt="Youtube" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_03.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.linkedin.com/company/angel-broking" target="_blank"><img alt="LinkedIn" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_04.png"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
								<td style="vertical-align:middle">
									<table align="right" border="0" cellpadding="0" cellspacing="2" style="vertical-align:middle">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 0">
													<a href="#0.1_" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none"><img alt="Phone" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_05.png" style="vertical-align:middle">+91 22 4000 3600</a> &nbsp; <a href="mailto:mfsd@angelbroking.com" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none" target="_blank"><img alt="Email" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_06.png" style="vertical-align:middle"> mfsd@angelone.in</a> &nbsp; <a href="http://mf.angelmf.com/Wealth/Index2" style="color:#808080;font-family:''Arial'',sans-serif;font-size:8px;text-decoration:none" target="_blank"><img alt=" " src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_08.png" style="vertical-align:middle">*Disclaimer</a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
							</tr>
						</tbody>
					</table>
				</td>
			</tr>
		</tbody>
	</table>
</div>
</body></html>'    
     
EXEC MSDB.DBO.Sp_send_dbmail    
        @PROFILE_NAME='NXT', 
        --@RECIPIENTS= @email,  
        @RECIPIENTS= 'yogesh.rewatkar@angelbroking.com;jigar.ravani@angelbroking.com;yogen.gandhi@angelbroking.com;dinesh.malekar@angelbroking.com;jogendar.dhoble@angelbroking.com;subbulakshmi.sk@angelbroking.com;mukesh.pandey@angelbroking.com ',  
		@blind_copy_recipients  ='yogesh.rewatkar@angelbroking.com',
        @SUBJECT ='Login Details',         
        @BODY =@Mail_body,                    
        @BODY_FORMAT = 'HTML'  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PWD_RESET_MAILER_MFNXT_Bkp03July2018
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_PWD_RESET_MAILER_MFNXT_Bkp03July2018]     
@pwd varchar(40),    
@email varchar(200)    
as     

BEGIN
   
declare @Mail_body as varchar(8000)        
set @Mail_body='<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body>&#65279;
<div>
	
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
		<tbody><tr>
			<td align="center" style="vertical-align:top;padding:0px 0px 0px 0px;border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1;border-right:1px solid #d1d1d1">
				<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620px">
					<tbody>
						<tr>
							<td align="center" bgcolor="#0071BB" style="vertical-align:top;padding:0px 0px 0px 0px;background-color:#0071bb">
								<table border="0" cellpadding="0" cellspacing="0" style="min-width:620px" width="620">
									<tbody>
										<tr>
											<td align="left" style="padding:0 0 0 5px" valign="bottom">
												<a href="" target="_blank"><img alt="Angel Broking powered by ARQ" height="53" src="http://web.angelbackoffice.com/angelbroking/econnect/Refer_and_Earn/images/angel-logo_Rev.png" style="display:block" width="250"></a>
											</td>
										</tr>
									</tbody>
								</table>
							</td>
						</tr>
					</tbody>
				</table>
			</td>
		</tr>
	</tbody></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width:620px;background-color:#27a3a1" width="620"></table>
	<table align="center" border="0" cellpadding="0" cellspacing="0" style="border:1px solid #d1d1d1;border-top:none" width="620">
		<tbody>
			<tr>
				<td align="center" valign="middle">
					<a href="#0.1_" style="display:block"><img alt="NXT Password" src="http://web.angelbackoffice.com/angelbroking/econnect/NXT_Password_270218/images/NXT_Passwordt_banner.jpg" style="display:block" width="620"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:40px 30px 20px 30px">
					Dear User,<br>
					<br>
					The password for your NXT Wealth Account is: <strong>'+@pwd+'</strong><br>
					<br>
					Login and experience seamless LMS and Digital Marketing. Access your Dashboard and view your Customized ARQ.<br>
					<br>
					<a href="https://beenxt.angelbroking.com/"><img alt="Loginbtn" src="http://web.angelbackoffice.com/angelbroking/econnect/NXT_Password_270218/images/loginbtn.png"></a>
				</td>
			</tr>
			<tr>
				<td style="font-size:14px;color:#4e4e4e;font-family:Open Sans,arial,sans-serif;text-align:justify;font-weight:400;line-height:20px;padding:0 30px 20px 30px">
					For any queries, please contact us on the below details:<br>
					<a href="mailto:mfsd@angelbroking.com" style="text-decoration:underline;color:#0071bb;font-size:14px" target="_blank">mfsd@angelbroking.com</a><br>
					022-33551111 | 022-42185454
				</td>
			</tr>
		</tbody>
	</table>
	<table align="center" bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" width="620">
		<tbody>
			<tr>
				<td align="left" bgcolor="#FFFFFF" style="background-color:#ffffff;padding:7px 5px" valign="top">
					<table align="left" border="0" cellpadding="0" cellspacing="0" style="width:100%">
						<tbody>
							<tr>
								<td align="left" bgcolor="#FFFFFF" style="vertical-align:middle" valign="center">
									<table align="left" border="0" cellpadding="0" cellspacing="0">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.facebook.com/AngelBrokingLtd" target="_blank"><img alt="Facebook" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_01.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://twitter.com/AngelBrokingLtd" target="_blank"><img alt="Twitter" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_02.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.youtube.com/user/AngelBrokingVideos" target="_blank"><img alt="Youtube" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_03.png"></a>
												</td>
												<td style="vertical-align:middle;padding:0 3px">
													<a href="https://www.linkedin.com/company/angel-broking" target="_blank"><img alt="LinkedIn" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_04.png"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
								<td style="vertical-align:middle">
									<table align="right" border="0" cellpadding="0" cellspacing="2" style="vertical-align:middle">
										<tbody>
											<tr>
												<td style="vertical-align:middle;padding:0 0">
													<a href="#0.1_" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none"><img alt="Phone" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_05.png" style="vertical-align:middle">022-3355 1111 / 4218 5454</a> &nbsp; <a href="mailto:mfsd@angelbroking.com" style="font-family:''Arial'',sans-serif;font-size:8px;color:#808080;text-decoration:none" target="_blank"><img alt="Email" src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_06.png"

 style="vertical-align:middle"> partners@angelbroking.com</a> &nbsp; <a href="http://mf.angelmf.com/Wealth/Index2" style="color:#808080;font-family:''Arial'',sans-serif;font-size:8px;text-decoration:none" target="_blank"><img alt=" " src="https://s3.ap-south-1.amazonaws.com/absite-mumbai/CG/icon_08.png" style="vertical-align:middle">*Disclaimer</a>
												</td>
											</tr>
										</tbody>
									</table>
								</td>
							</tr>
						</tbody>
					</table>
				</td>
			</tr>
		</tbody>
	</table>
</div>
</body></html>'    
     
EXEC MSDB.DBO.Sp_send_dbmail    
        @PROFILE_NAME='NXT', 
        @RECIPIENTS= @email,    
        @SUBJECT ='Login Details',         
        @BODY =@Mail_body,                    
        @BODY_FORMAT = 'HTML'  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_RejectSelfDeclaration
-- --------------------------------------------------
CREATE PROCEDURE usp_RejectSelfDeclaration       
@SBTag VARCHAR(100),
@FinYear VARCHAR(100) ,
@RejectionReason NVARCHAR(1000),
@EmpName NVARCHAR(100)
        
AS        
BEGIN 	
	SET NOCOUNT ON;   
			      
	--UPDATE dbo.sb_Declaration  
	--SET  SelfDeclaration = NULL
	--	,DocPath = '' 
	--	,IsOTPVerified = 0
	--	,[FileName] = ''
	--WHERE SBTag = @SBTag AND FnYear = @FinYear

	UPDATE dbo.sb_Declaration  
	SET SelfDeclaration = NULL,
		DocPath = '',
		IsOTPVerified = 0,
		[Filename] = '',
		IsApproved = 0,
		Remark = @RejectionReason,
		UpdatedBy = @EmpName,
		UpdatedDate = GETDATE()
	WHERE SBTag = @SBTag AND FnYear = @FinYear
           
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_RiskdashboardActionsNXT
-- --------------------------------------------------
Create PROCEDURE [dbo].[usp_RiskdashboardActionsNXT]
(
	@Subbroker Varchar(100),
	@ClientCode varchar(100),
	@Flag varchar(10),
	@Createdate datetime=NULL ,
	@CreatedBy Varchar(100),
	@Updatedate datetime=NULL
	


)
AS
BEGIN 


		IF not exists (select * from RiskdashboardActionsNXT where Subbroker=@Subbroker and ClientCode=@ClientCode)
		begin

		Insert into RiskdashboardActionsNXT(Subbroker,ClientCode,Flag,Createdate,CreatedBy,Updatedate)
			Select 	
				@Subbroker ,
				@ClientCode ,
				@Flag ,
				Getdate() Createdate ,
				@CreatedBy ,
				@Updatedate


			Select 1
				
		END
		ELSE 
		BEGIN

				Update RiskdashboardActionsNXT
				Set Flag=@Flag
				,Updatedate=Getdate()
				,UpdatedBy=@Createdate
				where Subbroker=@Subbroker and ClientCode=@ClientCode

			Select 1

		END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_rpt_MFclient_ledger_summary
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_rpt_MFclient_ledger_summary]
	@client_Code varchar(20),
	@fromdt date = null,
	@todt date = null, 
	@fyear varchar(20) 
as 
begin

/*
EXEC [dbo].[usp_rpt_MFclient_ledger_summary] @client_Code = 'rp61', @fromdt = null, @todt = null, @fyear = '2016-2017'
EXEC [dbo].[usp_rpt_MFclient_ledger_summary] @client_Code = 'rp61', @fromdt = 'APR  1 2017', @todt = 'MAR 31 2018', @fyear = '2016-2017'
EXEC [dbo].[usp_rpt_MFclient_ledger_summary] @client_Code = 'rp61', @fromdt = 'May  1 2016', @todt = 'DEC 31 2016', @fyear = '2016-2017'
exec [196.1.115.207].general.dbo.PartySingleLedgerBBGWithDate 'rp61' , '', 'APR  1 2016', 'MAR 31 2017'
*/
	
	select 
		@fromdt = case when (isnull(@fromdt, '') = '') then sdate when (@fromdt < sdate) then '' else @fromdt end,
		@todt = case when (isnull(@todt, '') = '') then edate when (@todt > edate) then '' else @todt end
	from [172.31.16.109].NXT.dbo.tbl_fiscalDetails WITH (NOLOCK)
	WHERE fiscalYear = @fyear
	
	--select  @fromdt, @todt
	
	--client balance summay
	IF OBJECT_ID('TempDB..#tbl_clientdetails') IS NOT NULL
		DROP TABLE #tbl_clientdetails
	
	create table #tbl_clientdetails
	(
		exchangesegment varchar(20),
		cltCode varchar(50),
		vdt date,
		particulars varchar(max),
		debit numeric(17,2),
		credit numeric(17,2),
		balance numeric(17,2)
	)

	if ((@fromdt  <> '') and (@todt  <> ''))
	BEGIN
		insert into #tbl_clientdetails
		exec [196.1.115.207].general.dbo.PartySingleLedgerBBGWithDate @client_Code , '', @fromdt, @todt
		--exec [196.1.115.207].general.dbo.PartySingleLedgerBBGWithDate 'rp61' , '', 'APR  1 2016', 'APR 30 2016'
	END	
	
	declare @cramt numeric(18,2) = 0, 
	@dramt numeric(18,2) = 0
	select @dramt = sum(debit), @cramt = sum(credit) from #tbl_clientdetails

	--select @dramt, @cramt
	
	select top 1 a.cltCode as Clientcode, investmst.FirstHolderName as clientName, @fyear fyear, 
	abs(abs(@cramt) - @dramt) as Balance
	from #tbl_clientdetails a
	join [172.31.16.109].MutualFund.dbo.investormaster  investmst  WITH (NOLOCK)
	on a.cltCode = investmst.existcode

ENd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_save_NXTMobilePopup
-- --------------------------------------------------
CREATE PROCEDURE usp_save_NXTMobilePopup           
(              
	@Index  TINYINT,           
    @ImagePath VARCHAR(MAX),          
    @ImageName VARCHAR(MAX),            
    @ExpiryDate DATE,              
    @Redirect_Url VARCHAR(1000),              
    @Active  VARCHAR(3),               
    @Flag  VARCHAR(20),        
	@Popup_Type VARCHAR(100),        
	@SbTags VARCHAR(MAX),  
	@empName varchar(200),  
	@CampaignId varchar(200),
	@StartDate DATE = NULL,
	@StartTime TIME = NULL,
	@ExpiryTime TIME = NULL
)              
AS              
BEGIN          
	Declare @PopupId int      
	INSERT INTO Tbl_NXTMobilePopup([Index], ImagePath, ImageName, ExpiryDate, Redirect_Url, Active, CreatedDate, Createdby, ModifyBy, ModifyDate,    
		Popup_Type, CampaignId, StartDate, StartTime, ExpiryTime)        
	SELECT @Index, @ImagePath, @ImageName, @ExpiryDate, @Redirect_Url, @Active, GETDATE() AS CreatedDate, @empName AS Createdby, @empName AS ModifyBy,   
		GETDATE() AS  ModifyDate, @Popup_Type, @CampaignId, @StartDate, @StartTime, @ExpiryTime  
    
	SELECT @PopupId = SCOPE_IDENTITY()    
      
	IF(@Popup_Type = 'Individual')      
	BEGIN      
		Insert into Tbl_NXTMobilePopupSbTagMap(Popup_Id, SbTag, Active)      
		SELECT @PopupId, *, 'Y'      
		FROM dbo.[fn_Split](@SbTags, ',')          
	END      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SaveAdvisoryPerformanceDetail
-- --------------------------------------------------

CREATE procedure [dbo].[usp_SaveAdvisoryPerformanceDetail](
@AdvisoryPerformanceHeaderId INTEGER,
@Market NVARCHAR(50),
@Segment NVARCHAR(200),
@TotalCalls INT,
@PositiveCalls INTEGER,
@SRPercentage INTEGER = NULL,
@NetRRR NUMERIC(5, 2) = NULL
)
AS    
BEGIN
	INSERT INTO AdvisoryPerformanceReportDataDetails(AdvisoryPerformanceReportData_Id, Market, Segment, TotalCalls, PositiveCalls, SRPercentage, NetRRR)
	VALUES (@AdvisoryPerformanceHeaderId, @Market, @Segment, @TotalCalls, @PositiveCalls, @SRPercentage, @NetRRR)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SaveAdvisoryPerformanceHeader
-- --------------------------------------------------

CREATE procedure [dbo].[usp_SaveAdvisoryPerformanceHeader](
@Period NVARCHAR(50),
@PeriodDesc NVARCHAR(200),
@EquityFileName NVARCHAR(200),
@FutureFileName NVARCHAR(200),
@EmpName NVARCHAR(100),
@AdvisoryPerformanceReportDataId NVARCHAR(60) OUT
)
AS    
BEGIN 
	DECLARE @InsertedId TABLE (Id INTEGER)
	
	INSERT INTO AdvisoryPerformanceReportData(Period, PeriodDesc, EquityFileName, FutureFileName, Active, CreatedBy, CreatedDate)
	OUTPUT inserted.Id INTO @InsertedId
	VALUES (@Period, @PeriodDesc, @EquityFileName, @FutureFileName, 1, @EmpName, GETDATE())

	SELECT @AdvisoryPerformanceReportDataId = (SELECT CAST(Id AS NVARCHAR(60)) FROM @InsertedId)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveDigitalLibraryDownloadCreativeLog
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_SaveDigitalLibraryDownloadCreativeLog]        
(        
@CreativeId  int      
,@Accesscode varchar(100)     
,@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
    If Exists (select * from tbl_DigitalLibraryCreativesLog with(nolock) where SbTag=@Accesscode AND CreativeId = @CreativeId)    
		BEGIN  
			select Id from tbl_DigitalLibraryCreativesLog with(nolock) where SbTag=@Accesscode
		END  
	else
		BEGIN  
			INSERT INTO tbl_DigitalLibraryCreativesLog        
			SELECT      
			@CreativeId         
			,@Accesscode          
			,GETDATE()             
			,@CreatedBy      
			,'Y'
		END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveDigitalLibraryDownloadCreativeLog_BeeNXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_SaveDigitalLibraryDownloadCreativeLog_BeeNXT]        
(        
@CreativeId  int      
,@Accesscode varchar(100)     
,@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
    If Exists (select * from tbl_DigitalLibraryCreativesLog_BeeNXT with(nolock) where SbTag=@Accesscode AND CreativeId = @CreativeId)    
		BEGIN  
			select Id from tbl_DigitalLibraryCreativesLog_BeeNXT with(nolock) where SbTag=@Accesscode
		END  
	else
		BEGIN  
			INSERT INTO tbl_DigitalLibraryCreativesLog_BeeNXT        
			SELECT      
			@CreativeId         
			,@Accesscode          
			,GETDATE()             
			,@CreatedBy      
			,'Y'
		END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveDigitalLibraryDownloadPersonalisedCreativeLog
-- --------------------------------------------------



CREATE PROCEDURE [dbo].[USP_SaveDigitalLibraryDownloadPersonalisedCreativeLog]        
(        
@CreativeId  int      
,@Accesscode varchar(100)     
,@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
    If Exists (select * from tbl_DigitalLibraryPersonalisedCreativesLog with(nolock) where SbTag=@Accesscode AND CreativeId = @CreativeId)    
		BEGIN  
			select Id from tbl_DigitalLibraryPersonalisedCreativesLog with(nolock) where SbTag=@Accesscode
		END  
	else
		BEGIN  
			INSERT INTO tbl_DigitalLibraryPersonalisedCreativesLog        
			SELECT      
			@CreativeId         
			,@Accesscode          
			,GETDATE()             
			,@CreatedBy      
			,'Y'
		END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveDigitalLibraryDownloadPersonalisedCreativeLog_BeeNXT
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_SaveDigitalLibraryDownloadPersonalisedCreativeLog_BeeNXT]        
(        
@CreativeId  int      
,@Accesscode varchar(100)     
,@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
    If Exists (select * from tbl_DigitalLibraryPersonalisedCreativesLog_Beenxt with(nolock) where SbTag=@Accesscode AND CreativeId = @CreativeId)    
		BEGIN  
			select Id from tbl_DigitalLibraryPersonalisedCreativesLog_Beenxt with(nolock) where SbTag=@Accesscode
		END  
	else
		BEGIN  
			INSERT INTO tbl_DigitalLibraryPersonalisedCreativesLog_Beenxt        
			SELECT      
			@CreativeId         
			,@Accesscode          
			,GETDATE()             
			,@CreatedBy      
			,'Y'
		END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveDigitalLibraryPreviewCreativeLog
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_SaveDigitalLibraryPreviewCreativeLog]        
(        
@CreativeId  int      
,@Accesscode varchar(100)     
,@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
    if exists (select * from tbl_DigitalLibraryCreativesLog with(nolock) where SbTag=@Accesscode)    
		BEGIN  
			select Id from tbl_DigitalLibraryCreativesLog with(nolock) where SbTag=@Accesscode
		END  
	else
		BEGIN  
			INSERT INTO tbl_DigitalLibraryCreativesLog        
			SELECT      
			@CreativeId         
			,@Accesscode          
			,GETDATE()             
			,@CreatedBy      
			,'Y'
		END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveDigitalLibraryPreviewCreativeLog_BeeNXT
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_SaveDigitalLibraryPreviewCreativeLog_BeeNXT]        
(        
@CreativeId  int      
,@Accesscode varchar(100)     
,@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
    if exists (select * from tbl_DigitalLibraryCreativesLog_Beenxt with(nolock) where SbTag=@Accesscode)    
		BEGIN  
			select Id from tbl_DigitalLibraryCreativesLog_Beenxt with(nolock) where SbTag=@Accesscode
		END  
	else
		BEGIN  
			INSERT INTO tbl_DigitalLibraryCreativesLog_Beenxt        
			SELECT      
			@CreativeId         
			,@Accesscode          
			,GETDATE()             
			,@CreatedBy      
			,'Y'
		END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SaveFundBarometerFile
-- --------------------------------------------------

  
     CREATE PROCEDURE [dbo].[usp_SaveFundBarometerFile]                
    (                         
   @FilePath VARCHAR(MAX)             
  ,@FileName VARCHAR(200)          
  ,@ProjectType VARCHAR(50)  
     ,@empName varchar(50)    
 )                
 AS                
 BEGIN               
    INSERT INTO dbo.FundBarometerFileData            
    (      
     [FileName]  
    ,[FilePath]     
    ,ProjectType      
    ,Createdby   
    ,CreatedDate  
    )          
    SELECT              
     @FileName                 
    ,@FilePath                     
    ,@ProjectType                 
    ,@empName                 
    ,GETDATE() AS CreatedDate  
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SaveNudgeFileData
-- --------------------------------------------------
  
CREATE PROCEDURE [dbo].[usp_SaveNudgeFileData]                  
 (   
    @Name VARCHAR(200)  
   ,@RedirectURL VARCHAR(200)                          
   ,@FilePath VARCHAR(MAX)               
   ,@FileName VARCHAR(200)            
   ,@ProjectType VARCHAR(50)    
   ,@empName VARCHAR(50) 
   ,@ExpiryDate  DATE     
 )                  
 AS                  
 BEGIN                 
    INSERT INTO dbo.NudgeFileData              
    (        
    Name,  
    RedirectURL,  
    [FileName]    
    ,[FilePath]       
    ,ProjectType        
    ,Createdby     
    ,CreatedDate 
    ,ExpiryDate   
    ,IsActive
    )            
    SELECT   
     @Name      
    ,@RedirectURL           
    ,@FileName                   
    ,@FilePath                       
    ,@ProjectType                   
    ,@empName                   
    ,GETDATE() AS CreatedDate   
    ,@ExpiryDate
    ,1
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SaveNXTMobilePopUpLog
-- --------------------------------------------------

CREATE PROCEDURE USP_SaveNXTMobilePopUpLog       
(        
	@PopupId  int, 
	@Sub_broker varchar(100),
	@CreatedBy VARCHAR(100)
)        
AS        
BEGIN    
	INSERT INTO NXTMobilePopUpLog (Popup_Id, SbTag, Active, CreatedBy, CreatedDate)       
	VALUES(@PopupId, @Sub_broker, 'Y', @CreatedBy, GETDATE())
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SavePopUpLog
-- --------------------------------------------------


 CREATE PROCEDURE [dbo].[USP_SavePopUpLog]        
     (        
	 @PopupId  int      
    ,@Sub_broker varchar(100)     
    ,@CreatedBy VARCHAR(100)       
    ,@Project_Type VARCHAR(10)
    )        
    AS        
    BEGIN    
             
	  INSERT INTO PopUpLog        
	  SELECT      
		@PopupId         
	   ,@Sub_broker     
	   ,@Project_Type        
	   ,GETDATE()             
	   ,@CreatedBy      
		,'Y'     
    END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SB_DECLARATION_CHECK
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[USP_SB_DECLARATION_CHECK] 
	@SbTag nvarchar(100),
	@FinYear nvarchar(100)
AS
BEGIN
	SET NOCOUNT ON;

	SELECT SelfDeclaration FROM sb_Declaration where SBTag = @SbTag and FnYear = @FinYear
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_sb_Declaration_Mail
-- --------------------------------------------------
CREATE procedure [dbo].[usp_sb_Declaration_Mail]
as
begin

Set NOCOUNT ON 

DECLARE    @tab char(1) = CHAR(9)

Declare @BodyContent Varchar(2000)
,@subject Varchar(2000)

Set @subject='SB Declaration'


Set @BodyContent=
'Hello All,

				Please find the below list of sb declaration.'
	

If (select 	count(1) from [NXT].[dbo].[sb_Declaration] with (nolock) where convert(date,EntryDate)=convert(date,Getdate()))>0
begin 



			EXEC msdb.dbo.sp_send_dbmail
			@profile_name = 'BEEnxt',
			@recipients = 'mf@angelbroking.com;pravin.adkhale@angelbroking.com;jigar.s@angelbroking.com;ingrid.thanicatt@angelbroking.com',
			--@recipients = 'abhilash.singh@angelbroking.com',
					@copy_recipients='yogesh.rewatkar@angelbroking.com;paras.joshi@angelbroking.com',
				 @query = 'SET NOCOUNT ON ;

									select SBTAG,Convert(varchar(20),EntryDate) EntryDate,DocPath INTO #Data 
									from [NXT].[dbo].[sb_Declaration] 
									where convert(date,EntryDate)=convert(date,Getdate())

									SELECT ''SBTAG'',''EntryDate'',''DocPath''
									UNION ALL
									select * from #Data

									Drop table #data

								   SET NOCOUNT OFF ' ,
							@subject = @subject,
							@body=@BodyContent,
							@attach_query_result_as_file = 1,
							@query_attachment_filename='SB_Declaration.xls',
							@query_result_separator=@tab,
							@query_result_header=0,
							@from_address   = 'Beenxt@angelbroking.com'
		 
END   

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_sb_Declaration_OTP_Mail
-- --------------------------------------------------
CREATE procedure [dbo].[usp_sb_Declaration_OTP_Mail]
(
	@Sb_Tag varchar(200),
	@ARNName varchar(200),
	@FinYear varchar(200),
	@OTP INT,
	@Email varchar(200),
	@UserType  varchar(100)
)
/*

EXEC [usp_sb_Declaration_OTP_Mail] 'AJYC','ABC','2018-2019',154554,'yogesh.rewatkar@angelbroking.com','NXT'


*/
as
begin

Set NOCOUNT ON 

DECLARE    @tab char(1) = CHAR(9)

Declare @BodyContent Varchar(2000)
,@subject Varchar(2000)

Set @subject='One Time Password (OTP) for Self Declaration Certificate'

If @UserType ='NXT'
Begin

Set @BodyContent=
'Dear '+@ARNName+',

The One Time Password (OTP) for Self Declaration Certificate is '+Convert(varchar(20),@OTP)+'.

Your Request for Submitting Self Declaration for the year '+@FinYear+' through NXT is initiated.

o This OTP is valid for the day or 1 successful attempt whichever is earlier. Please note, this OTP is valid only for this process and cannot be used for any other process.

o Please do not share this One Time Password with anyone.

o In case you have not requested for OTP, please contact the MF Help-desk 022-50515151.

Regards,
Angel Broking Ltd.'


	EXEC msdb.dbo.sp_send_dbmail
	@profile_name = 'nxt',
	@recipients = @Email,
	--@copy_recipients='prashantk.naik@angelbroking.com',
	@blind_copy_recipients='prashantk.naik@angelbroking.com;yogesh.rewatkar@angelbroking.com;Vikas.raibole@angelbroking.com',
	@subject = @subject,
	@body=@BodyContent,
	@from_address   = 'nxt@angelbroking.com'

END
ELSE
BEGIN
Set @BodyContent=
'Dear '+@ARNName+',

The One Time Password (OTP) for Self Declaration Certificate is '+Convert(varchar(20),@OTP)+'.

Your Request for Submitting Self Declaration for the year '+@FinYear+' through BeeNXT is initiated.

o This OTP is valid for the day or 1 successful attempt whichever is earlier. Please note, this OTP is valid only for this process and cannot be used for any other process.

o Please do not share this One Time Password with anyone.

o In case you have not requested for OTP, please contact the MF Help-desk 022-50515151.

Regards,
Angel Broking Ltd.'


	EXEC msdb.dbo.sp_send_dbmail
	@profile_name = 'beenxt',
	@recipients = @Email,
	--@copy_recipients='prashantk.naik@angelbroking.com',
	@blind_copy_recipients='prashantk.naik@angelbroking.com;yogesh.rewatkar@angelbroking.com;Vikas.raibole@angelbroking.com',
	@subject = @subject,
	@body=@BodyContent,
	@from_address   = 'beenxt@angelbroking.com'

END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_sb_Declaration_Submitted_Mail
-- --------------------------------------------------
CREATE procedure [dbo].[usp_sb_Declaration_Submitted_Mail]  
(  
 @Sb_Tag varchar(200),  
 @ARNName varchar(200),  
 @FinYear varchar(200),  
 @Email varchar(200)  ,
 @UserType varchar(200) =NULL 
)  
/*  
EXEC [usp_sb_Declaration_Submitted_Mail] 'AJYC','ABC','2018-2019','yogesh.rewatkar@angelbroking.com','BeeNXT'  
*/  
as  
begin  
  
Set NOCOUNT ON   
  
DECLARE    @tab char(1) = CHAR(9)  
  
Declare @BodyContent Varchar(2000)  
,@subject Varchar(2000)  
  
Set @subject='Submitted Self Declaration for the (F.Y '+@FinYear+').'  
  
  
Set @BodyContent=  
'Dear '+@ARNName+',  
   
  
You have successfully submitted your Self declaration for the selected financial year (F.Y '+@FinYear+').    
   
  
Regards,  
Angel Broking Ltd.'  
  
If @UserType ='NXT'
Begin

Print 'NXT'
		 EXEC msdb.dbo.sp_send_dbmail
		 @profile_name = 'nxt',  
		 @recipients = @Email,  
		 --@copy_recipients='prashantk.naik@angelbroking.com',  
		 @blind_copy_recipients='prashantk.naik@angelbroking.com;yogesh.rewatkar@angelbroking.com',  
		 @subject = @subject,  
		 @body=@BodyContent,  
		 @from_address   = 'nxt@angelbroking.com'  

END

ELSE 
BEGIn

Print 'BeeNXT'

		 EXEC msdb.dbo.sp_send_dbmail  
		 @profile_name = 'BEEnxt',  
		 @recipients = @Email,  
		 --@copy_recipients='prashantk.naik@angelbroking.com',  
		 @blind_copy_recipients='prashantk.naik@angelbroking.com;yogesh.rewatkar@angelbroking.com',  
		 @subject = @subject,  
		 @body=@BodyContent,  
		 @from_address   = 'Beenxt@angelbroking.com'  
END     


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SB_DECLARATION_UPDATE
-- --------------------------------------------------
   
  
CREATE PROCEDURE USP_SB_DECLARATION_UPDATE             
    @SbTag   NVARCHAR(100),            
    @FinYear  NVARCHAR(100),            
    @Path   NVARCHAR(MAX),            
    @FileName       NVARCHAR(500),           
    @Source   NVARCHAR(100),        
    @Email   VARCHAR(200),          
    @ARNName  VARCHAR(200),        
    @isOTPVerified BIT,    
    @UserName NVARCHAR(100) = ''    
  AS            
  BEGIN            
              
    SET NOCOUNT ON;           
              
    DECLARE @Count INT = 0          
              
    SELECT @Count = COUNT(1)FROM sb_Declaration          
    WHERE SBTag = @SbTag AND FnYear = @FinYear           
              
    IF(@Count > 0)          
    UPDATE sb_Declaration            
    SET  DocPath = @Path,         
      [FileName] = @FileName,            
      EntryDate = GETDATE(),            
      SelfDeclaration = 'YES',         
      isOTPVerified = @isOTPVerified,        
      [Source] = @Source,    
      IsApproved = NULL,    
      Remark = NULL,    
      UpdatedBy = @UserName,    
      UpdatedDate = GETDATE()    
    WHERE SBTag = @SbTag AND FnYear = @FinYear            
 ELSE          
     INSERT INTO sb_Declaration (SBTag, SelfDeclaration, FnYear, RCVD_DATE, EntryDate, [Source], DocPath, IsOTPVerified,     
     [Filename], CreatedBy, CreatedDate)          
    VALUES (@SbTag, 'Yes', @FinYear, '', GETDATE(), @Source, @Path, @isOTPVerified, @FileName, @UserName, GETDATE())         
            
          
   EXEC dbo.[usp_sb_Declaration_Submitted_Mail] @SbTag, @ARNName, @FinYear, @Email          
          
          
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SB_NOCaccess
-- --------------------------------------------------



CREATE procedure usp_SB_NOCaccess
(
	@username varchar(100),
	@Flag varchar(100)
)
as
begin

--EXEC usp_SB_NOCaccess 'CBHO','ACCESS'

If @Flag='Access'
begin

		If (select count(*) from SB_NOCaccess with (nolock)  where username=@username)=0
		begin

				Insert into SB_NOCaccess
				(
					username
					,entryDate
					,active
				)
				 Select 
							@username,
							Getdate(),
							1
		END
		else
		begin
				Update SB
				Set 
					active=1
				From SB_NOCaccess SB with (nolock)
				where username=@username				

		end


END
else
begin

		If (select count(*) from SB_NOCaccess with (nolock) where username=@username)>0
		begin

				Update A
				Set 
					active=0
				From SB_NOCaccess A with (nolock)
				where username=@username
		END
		ELSe
		begin
						Insert into SB_NOCaccess
						(
							username
							,entryDate
							,active
						)
						 Select 
							@username,
							Getdate(),
							0
		END
end
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SDC_OTP_Validate	_TobeDrop
-- --------------------------------------------------
 
 CREATE PROCEDURE [dbo].[USP_SDC_OTP_Validate]    
 (     
   @SubBroker VARCHAR(100),  
   @Otp VARCHAR(100),  
   @UserType VARCHAR(100)  
 )    
 AS    
 BEGIN    
     
  SET NOCOUNT ON;    
      
  SELECT TOP 1 * INTO #TopRecord FROM [dbo].[OTP_SDC_Beenxt]      
  WHERE  sb_broker = @SubBroker     
   AND UserType = @UserType     
   AND CreateDate >= DATEADD(HOUR, -24, GETDATE())    
  ORDER BY CreateDate DESC  
  
  
  DECLARE @Id INT, @WrongCount INT = 0 ;
  SET @Id = (SELECT Id FROM #TopRecord)
  
  
  DECLARE @OtpCount INT;     
  SET @OtpCount = (SELECT COUNT(*) FROM #TopRecord WHERE OTP = @Otp AND OTPVerified = 0)  
    
  IF(@OtpCount = 1)
   BEGIN   		
		  UPDATE [dbo].[OTP_SDC_Beenxt]      
		  SET OTPVerified = 1    
		  WHERE Id = @Id
			  AND UserType = @UserType  
			  AND OTP = @Otp  
			  AND OTPVerified = 0  
	        
		  SELECT 1 AS [Status], @WrongCount AS WrongCount
   END    
  ELSE  
   BEGIN  
          SET @WrongCount = (SELECT WrongCount FROM [dbo].[OTP_SDC_Beenxt]   WHERE Id = @Id)   
   
		  UPDATE [dbo].[OTP_SDC_Beenxt]      
		  SET WrongCount = @WrongCount + 1    
		  WHERE Id = @Id
			  
		  SET @WrongCount = (SELECT WrongCount FROM [dbo].[OTP_SDC_Beenxt]   WHERE Id = @Id)   
			   
		  SELECT 0 AS [Status] , @WrongCount AS WrongCount  
   END  
      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SELECT_ComplianceVideo
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_SELECT_ComplianceVideo]  --USP_SELECT_ComplianceVideo 'CBHO'
(
	@SBTag VARCHAR(100)
)
AS
BEGIN
	SELECT distinct FileName, FilePath, DU.CreationDate AS uploaddate, CL.IsCompleted, DU.Id AS DocumentId
	FROM DocumentUpload DU
	INNER JOIN DocumentUploadMaster DUM 
		ON DU.MasterId = DUM.Id
	LEFT JOIN Downloads_ComplianceLog CL
		ON CL.DocumentId = DU.Id
		AND CL.IsCompleted = 1
		AND CL.SBTag = @SBTag	
	WHERE DUM.CardTypeKey = 'Compliance' AND (DU.IsDeleted IS NULL OR DU.IsDeleted = 0)
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SelfDeclaration_Report
-- --------------------------------------------------
    
  CREATE PROCEDURE [dbo].[usp_SelfDeclaration_Report]  
  @FromDate		DATE = NULL,  
  @ToDate		DATE = NULL,
  @ProjectType  VARCHAR(100) = NULL,
  @FnYear		VARCHAR(10) = NULL
  AS                      
  BEGIN        
    
    
          
   SELECT     SBTag            
        ,'20'+ convert(varchar(2),substring([FnYear],1,(charindex('-', [FnYear]))+1)) +'-'+ '20'+ convert(varchar(2),substring([FnYear],(charindex('-', [FnYear]))+1,len([FnYear]))) AS FnYear                
        ,DocPath            
        ,[FileName]            
        ,CONVERT(varchar(10), CAST(EntryDate as date), 101) AS EntryDate  
        ,REPLACE(DocPath,'\','#') AS NewDocPath        
        ,[Source] AS ProjectType              
    FROM  [dbo].[sb_Declaration] WITH (NOLOCK)                
    WHERE SelfDeclaration = 'YES'             
      AND ISNULL (DocPath, '') != ''            
      AND [FileName] != ''            
      AND IsOTPVerified = 1    
      AND (@ProjectType IS NULL OR [Source] = @ProjectType) 
      AND (@FnYear IS NULL OR [FnYear] = @FnYear)   
      AND (@FromDate IS NULL OR CAST(EntryDate AS DATE) >= @FromDate)    
      AND (@ToDate IS NULL OR CAST(EntryDate AS DATE) <=  @ToDate)    
    ORDER BY EntryDate DESC        
           
        
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_SendMailToSb
-- --------------------------------------------------
CREATE PROC [dbo].[Usp_SendMailToSb]
AS
BEGIN

	DECLARE @subject VARCHAR(50) = '', @copyrecipients VARCHAR(50) = '', @email VARCHAR(50) = '', @mainBody VARCHAR(MAX) = '', @Style VARCHAR(MAX) = ''
	DECLARE @SbData TABLE(ClientCode VARCHAR(20),TradeDate DATE)
	DECLARE @SbDataNew TABLE(CursorTestID INT IDENTITY(1,1) PRIMARY KEY CLUSTERED,SbTag VARCHAR(20),EmailId VARCHAR(100))
	DECLARE @SbTag VARCHAR(20) = ''
	DECLARE @EmailId VARCHAR(100) = ''

	DECLARE @CursorTestID INT = 1;
	DECLARE @RunningTotal BIGINT = 0;
	DECLARE @RowCnt BIGINT = 0;

	INSERT INTO @SbDataNew
	EXEC Usp_PendingPreTradeData ''


	-- get a count of total rows to process 
	SELECT @RowCnt = COUNT(0) FROM @SbDataNew
	WHILE @CursorTestID <= @RowCnt
	BEGIN
		
		SELECT @EmailId = ISNULL(EmailId,''),@SbTag = ISNULL(SbTag,'') FROM @SbDataNew WHERE CursorTestID = @CursorTestID
		
		INSERT INTO @SbData
		EXEC Usp_PendingPreTradeData @SbTag = @SbTag

		SET @subject = 'Pending Pre Trade Records'
		--SET @copyrecipients = 'callaudit@angelbroking.com'
		SET @email = 'jigar.ravani@angelbroking.com'
		SET @Style += +N'<style type="text/css">' + N'table.trade td, table.trade th {border: 1px solid;padding: 8px;}'
			  + N'</style>';
		SET @mainBody = 'Dear Partner,During our routine surveillance, it has been observed that you have placed orders in the account of below clients without obtaining pre-trade confirmations before placing such orders.'
		SET @mainBody += @Style + N'<table class="trade">'
			+ N'<tr><th>Client Code</th><th>Trade Date</th></tr>'
			+ N'<tr>'
			+ CAST((Select td = ClientCode,'',
					td =TradeDate,''
					FROM @SbData
				FOR
				 XML PATH('tr') ,
					 TYPE
			   ) AS NVARCHAR(MAX))
			+ N'</table>'
		SET @mainBody += 'You are hereby requested to upload the evidence of the client placing these orders in his/her account on below path in NXT to avoid further action.(Path / Link)For any clarifications, please feel free to contact Call Audit team - Contact No : _____.Regards,Call Audit Team'
		SET @email = 'jigar.ravani@angelbroking.com'
		exec msdb.dbo.sp_send_dbmail                                                                                                                                                                         
				@profile_name = 'NXT',                       
				@recipients = @email,
				--@copy_recipients =@copyrecipients,	 
				@subject = @subject,                            
				@body = @mainBody,                            
				@body_format ='html'
		DELETE FROM @SbData
		SET @RunningTotal += @CursorTestID
		SET @CursorTestID = @CursorTestID + 1 
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SetActive_IPODocumentUpload
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_SetActive_IPODocumentUpload]
(
     @Id  INT,
	 @Active BIT,
	 @UpdatedBy VARCHAR(200),
	 @IsYoutube BIT
 )          
 AS          
 BEGIN  
	IF @IsYoutube = 1 
       UPDATE dbo.IPODocumentUpload  
       SET IsActive = @Active,    
        LastUpdate = GETDATE(),
		UpdatedBy = @UpdatedBy
       WHERE Id = @Id 
	ELSE
		UPDATE dbo.IPODocumentUpload  
       SET IsDeleted = 1,    
        LastUpdate = GETDATE(),
		DeletedBy = @UpdatedBy
       WHERE Id = @Id 
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SetActiveDeactiveDashboardVideo
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_SetActiveDeactiveDashboardVideo]  
(  
  @Id  INT,  
  @Active BIT,  
  @UpdatedBy VARCHAR(200) 
 )            
 AS            
 BEGIN    
       UPDATE dbo.DashboardVideoUpload    
       SET IsActive = @Active,      
        LastUpdate = GETDATE(),  
		UpdatedBy = @UpdatedBy  
       WHERE Id = @Id   
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SetActiveDocumentUpload
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[usp_SetActiveDocumentUpload]
(
     @Id  INT,
	 @Active BIT,
	 @UpdatedBy VARCHAR(200),
	 @IsYoutube BIT
 )          
 AS          
 BEGIN  
	IF @IsYoutube = 1 
       UPDATE dbo.DocumentUploadYoutube  
       SET IsActive = @Active,    
        LastUpdate = GETDATE(),
		UpdatedBy = @UpdatedBy
       WHERE Id = @Id 
	ELSE
		UPDATE dbo.DocumentUpload  
       SET IsDeleted = 1,    
        LastUpdate = GETDATE(),
		DeletedBy = @UpdatedBy
       WHERE Id = @Id 
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SetActiveIPODocumentUpload
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_SetActiveIPODocumentUpload]
(
     @Id  INT,
	 @Active BIT,
	 @UpdatedBy VARCHAR(200),
	 @IsYoutube BIT
 )          
 AS          
 BEGIN  
	IF @IsYoutube = 1 
       UPDATE dbo.IPODocumentUpload  
       SET IsActive = @Active,    
        LastUpdate = GETDATE(),
		UpdatedBy = @UpdatedBy
       WHERE Id = @Id 
	ELSE
		UPDATE dbo.IPODocumentUpload  
       SET IsDeleted = 1,    
        LastUpdate = GETDATE(),
		DeletedBy = @UpdatedBy
       WHERE Id = @Id 
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_setActiveKycMilestone
-- --------------------------------------------------

CREATE PROCEDURE usp_setActiveKycMilestone
(
	@Id BIGINT,
	@Active BIT,
	@UpdatedBy VARCHAR(200)
)
AS
BEGIN
	UPDATE OffersKycMilestones
	SET IsActive = @Active,
		UpdatedBy = @UpdatedBy,
		UpdateDate = GETDATE()
	WHERE Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SetActiveOrgMarketingDocUpld
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_SetActiveOrgMarketingDocUpld]
(
     @Id  INT,
	 @Active BIT,
	 @UpdatedBy VARCHAR(200)
 )          
 AS          
 BEGIN  
	UPDATE OrganicMarketingUpload  
       SET IsDeleted = 1,    
        LastUpdate = GETDATE(),
		DeletedBy = @UpdatedBy
       WHERE Id = @Id
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SmartMarketingModule_NXTUtility_Log
-- --------------------------------------------------
CREATE procedure [dbo].[usp_SmartMarketingModule_NXTUtility_Log] --usp_NOCModule_NXTUtility_Log '04-13-2022','04-13-2022'
(
		@FromDate Date,
		@ToDate Date
)
as
begin
Set nocount on 

SELECT *
  FROM SmartMarketingLogs where convert(date,DateAndTime) between @FromDate and @ToDate 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_monthly
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_monthly]
AS
BEGIN

DECLARE @FirstDay INT
Declare @TillDate DATE 
SELECT @FirstDay=DATEPART(DD,getdate())
Select @TillDate=convert(date,Getdate())


Declare @BodyContent Varchar(2000)
,@subject Varchar(2000)

SELECT @subject='SubBroker Click Log Monthly '+convert(varchar(20),@TillDate)+' '
SET @BodyContent =''

DECLARE    @tab char(1) = CHAR(9)


	IF @FirstDay=1
	BEGIN 

	 
EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'Nxt',
	--@recipients = ,
@recipients = 'NXTCSO@angelbroking.com', 
--@copy_recipients='NXTCSO@angelbroking.com',
@blind_copy_recipients='yogesh.rewatkar@angelbroking.com',
	 @query = 'SET NOCOUNT ON ;
	 

	 DECLARE @PrevMonthEndDate Date
DECLARE @PrevMonthStartDate Date

DECLARE @date DATETIME = dateadd(dd,-1,getdate())


	SELECT @PrevMonthStartDate=convert(date,DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0)) ,
	   @PrevMonthEndDate= convert(date,DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))) 




				SELECT 
					 Log.[CreatedBy] ''SB tag''
					  ,[createdDate] as ''Access Date/Time''
					  ,[IPadress] IPadress
					  ,Controller as ''Report Type''
					  ,Action as ''Report SubType''
					  ,API_URL as ''Report path''
			  FROM NXT.[dbo].[Error_log] Log
				INNER JOIN [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname=''nxt''
				  AND Event=''Report''
				  AND convert(date,createdDate)>=@PrevMonthStartDate  and CONVERT(DATE,createdDate)<= @PrevMonthEndDate                                
			  SET NOCOUNT OFF ' ,
	            @subject = @subject,
                @body=@BodyContent,
                @attach_query_result_as_file = 1,
                @query_attachment_filename='NXTLogReport.xls',
                @query_result_separator=@tab,
				@query_result_header=0,
				@from_address   = 'NXT@angelbroking.in'
		 
	 END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Monthly_GenerateFile
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_Monthly_GenerateFile]
AS
BEGIN


			
		DECLARE @PrevMonthEndDate Date
		DECLARE @PrevMonthStartDate Date

		DECLARE @date DATETIME = dateadd(dd,-1,getdate())


	SELECT @PrevMonthStartDate=convert(date,DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0)) ,
	   @PrevMonthEndDate= convert(date,DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))) 


	   --select @PrevMonthEndDate,@PrevMonthStartDate

			--select @MonthStartDate

				SELECT 
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,API_URL as 'Report path'
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='nxt'
				  --AND Event='Report'
				    AND convert(date,createdDate)>=@PrevMonthStartDate  and convert(date,createdDate)<= @PrevMonthEndDate
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Monthly_GenerateFile_BeeNXT
-- --------------------------------------------------
----95  NXT
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_Monthly_GenerateFile_BeeNXT]
AS
BEGIN


			
		DECLARE @PrevMonthEndDate Date
		DECLARE @PrevMonthStartDate Date

		DECLARE @date DATETIME = dateadd(dd,-1,getdate())


	SELECT @PrevMonthStartDate=convert(date,DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0)) ,
	   @PrevMonthEndDate= convert(date,DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))) 


	   --select @PrevMonthEndDate,@PrevMonthStartDate

			--select @MonthStartDate

				SELECT 
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,Controller as 'Report path'
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='Beenxt'
				  AND Event='Log'
				    AND convert(date,createdDate)>=@PrevMonthStartDate  and convert(date,createdDate)<= @PrevMonthEndDate
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Monthly_GenerateFile_NXT
-- --------------------------------------------------

Create procedure [dbo].[usp_Sub_Broker_Click_Log_Monthly_GenerateFile_NXT]
AS
BEGIN


			
		DECLARE @PrevMonthEndDate Date
		DECLARE @PrevMonthStartDate Date

		DECLARE @date DATETIME = dateadd(dd,-1,getdate())


	SELECT @PrevMonthStartDate=convert(date,DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0)) ,
	   @PrevMonthEndDate= convert(date,DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))) 


	   --select @PrevMonthEndDate,@PrevMonthStartDate

			--select @MonthStartDate

				SELECT 
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,API_URL as 'Report path'
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='nxt'
				  AND Event='Report'
				    AND convert(date,createdDate)>=@PrevMonthStartDate  and convert(date,createdDate)<= @PrevMonthEndDate
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Weekly
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_Weekly]
AS
BEGIN


EXEC msdb.dbo.sp_send_dbmail
@profile_name = 'NXT',
@recipients = 'yogesh.rewatkar@angelbroking.com',

--@recipients = 'NXTCSO@angelbroking.com', 
--@copy_recipients='NXTCSO@angelbroking.com',
@blind_copy_recipients='yogesh.rewatkar@angelbroking.com',
	 @query = 'SET NOCOUNT ON ;
	 		

			DECLARE @MonthEndDate Date
			DECLARE @MonthStartDate Date
			DECLARE @FirstDay INT

			SELECT @FirstDay=DATEPART(DD,getdate())
			DECLARE @date DATETIME = dateadd(dd,-1,getdate())

			SET @MonthStartDate=convert(date,DATEADD(MONTH, DATEDIFF(MONTH, 0, @date), 0))
			SET @MonthEndDate=convert(date,EOMONTH (@date))

				SELECT 
						 Log.[CreatedBy] ''SB tag''
						  ,[createdDate] as ''Access Date/Time''
						  ,[IPadress]
						  ,Controller as ''Report Type''
						  ,Action as ''Report SubType''
						  ,API_URL as ''Report path''
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname=''nxt''
				  --AND Event=''Report''
				  AND convert(date,createdDate)>=@MonthStartDate  and convert(date,createdDate)<= Convert(date,getdate())
				  --AND convert(date,createdDate)>=@date  and convert(date,createdDate)<= @date 

	  '
			,
				@subject = 'Log Report',
                @body='PFA',
                --@attach_query_result_as_file = 1,
                --@query_attachment_filename='NXTLogReport.xlsX',
				@attach_query_result_as_file=1,
				@query_attachment_filename = 'NXTLogReport.csv',

				@query_result_separator = ',',
                --@query_result_separator=1,
				@query_result_header=0,
				@from_address   = 'NXT@angelbroking.in'











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Weekly_GenerateFile
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_Weekly_GenerateFile]
AS
BEGIN




			DECLARE @MonthEndDate Date
			DECLARE @MonthStartDate Date
			DECLARE @FirstDay INT

			SELECT @FirstDay=DATEPART(DD,getdate())
			DECLARE @date DATETIME = convert(date,getdate())

			--select @date

			SET @MonthStartDate=convert(date,DATEADD(MONTH, DATEDIFF(MONTH, 0, @date), 0))
			SET @MonthEndDate=convert(date,EOMONTH (@date))

			--select @MonthStartDate

				SELECT 
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,API_URL as 'Report path'
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='nxt'
				  --AND Event='Report'
				    AND convert(date,createdDate)>=@MonthStartDate  and convert(date,createdDate)<= Convert(date,getdate())
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Weekly_GenerateFile_BeeNXT
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_Weekly_GenerateFile_BeeNXT]
AS
BEGIN




			DECLARE @MonthEndDate Date
			DECLARE @MonthStartDate Date
			DECLARE @FirstDay INT

			SELECT @FirstDay=DATEPART(DD,getdate())
			DECLARE @date DATETIME = convert(date,getdate())

			--select @date

			SET @MonthStartDate=convert(date,DATEADD(MONTH, DATEDIFF(MONTH, 0, @date), 0))
			SET @MonthEndDate=convert(date,EOMONTH (@date))

			--select @MonthStartDate

				SELECT  
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,API_URL as 'Report path'
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='Beenxt'
				  --AND Event='Report'
				    AND convert(date,createdDate)>=@MonthStartDate  and convert(date,createdDate)<= Convert(date,getdate())
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Weekly_GenerateFile_BeeNXT_Uat
-- --------------------------------------------------
CREATE  procedure [dbo].[usp_Sub_Broker_Click_Log_Weekly_GenerateFile_BeeNXT_Uat]
AS
BEGIN




			DECLARE @MonthEndDate Date
			DECLARE @MonthStartDate Date
			DECLARE @FirstDay INT

			SELECT @FirstDay=DATEPART(DD,getdate())
			DECLARE @date DATETIME = convert(date,getdate())

			--select @date

			SET @MonthStartDate=convert(date,DATEADD(MONTH, DATEDIFF(MONTH, 0, @date), 0))
			SET @MonthEndDate=convert(date,EOMONTH (@date))

			--select @MonthStartDate

				SELECT  
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,API_URL as 'Report path'
			  FROM [172.31.16.42].Ipartner.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='Beenxt'
				  AND Event='Log'
				    AND convert(date,createdDate)>=@MonthStartDate  and convert(date,createdDate)<= Convert(date,getdate())
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Sub_Broker_Click_Log_Weekly_GenerateFile_NXT
-- --------------------------------------------------
CREATE procedure [dbo].[usp_Sub_Broker_Click_Log_Weekly_GenerateFile_NXT]
AS
BEGIN




			DECLARE @MonthEndDate Date
			DECLARE @MonthStartDate Date
			DECLARE @FirstDay INT

			SELECT @FirstDay=DATEPART(DD,getdate())
			DECLARE @date DATETIME = convert(date,getdate())

			--select @date

			SET @MonthStartDate=convert(date,DATEADD(MONTH, DATEDIFF(MONTH, 0, @date), 0))
			SET @MonthEndDate=convert(date,EOMONTH (@date))

			--select @MonthStartDate

				SELECT 
						 Log.[CreatedBy] 'SB tag'
						  ,[createdDate] as 'Access Date/Time'
						  ,[IPadress]
						  ,Controller as 'Report Type'
						  ,Action as 'Report SubType'
						  ,API_URL as 'Report path'
			  FROM NXT.dbo.[Error_log] Log
				inner join [196.1.115.132].rolemgm.dbo.user_login SB
			  ON SB.username=Log.[CreatedBy]
			  WHERE 
				  projectname='nxt'
				  --AND Event='Report'
				    AND convert(date,createdDate)>=@MonthStartDate  and convert(date,createdDate)<= Convert(date,getdate())
				  --AND convert(date,createdDate)=@date  --and convert(date,createdDate)<= @date 











END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_SubbrokerOfferRewards
-- --------------------------------------------------
   CREATE PROCEDURE Usp_SubbrokerOfferRewards      
   (      
     @SBCode  VARCHAR(200),      
     @ProductType VARCHAR(200)      
   )      
   AS      
   BEGIN      
               
           
     SELECT   OSR.Id    
       ,OM.OfferId   
       ,OM.OfferName     
       ,CouponId     
       ,RewardAmount    
       ,IsScratched    
       ,@SBCode       
     FROM dbo.OffersSubBrokerRewards OSR      
     INNER JOIN dbo.OffersMaster OM      
     ON OSR.OfferId = OM.OfferId      
     WHERE SBCode = @SBCode      
      --AND EndDate < GETDATE()      
      AND ProductType = @ProductType      
          
     ORDER BY OSR.Id DESC    
         
   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_TaskassignedTo_mobile_2
-- --------------------------------------------------
CREATE procedure [dbo].[usp_TaskassignedTo_mobile_2]
(@Sub_broker varchar(100))
as
begin

Set nocount on 
/*

usp_TaskassignedTo_mobile_2 'ET'

*/

select @Sub_broker Dealer,'Self' Emp_Name
UNION 
SELECT distinct Dealer1,Emp_Name FROM [B2B_Bulk_DealerMapping_syn] D with (nolock)
left join dbo.tbl_Emp_Master_syn em-- order by Created_date desc
on D.Dealer1=em.Emp_No
WHERE Sb_Tag =@Sub_broker 

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_TBL_POA_PLD_ADNL_Pledge_Mtf
-- --------------------------------------------------

CREATE proc usp_TBL_POA_PLD_ADNL_Pledge_Mtf
as
begin


Declare @startDate Date=convert(date,Getdate()-1)

return 0


--select top 0 * into TBL_POA_PLD_ADNL_Pledge_Mtf_bkp16Nov2021 from TBL_POA_PLD_ADNL_Pledge_Mtf


insert into TBL_POA_PLD_ADNL_Pledge_Mtf_bkp16Nov2021 
select * from TBL_POA_PLD_ADNL_Pledge_Mtf


IF OBJECT_ID('TEMPDB..#TBL_POA_PLD_ADNL_Pledge_Mtf') IS NOT NULL
			DROP TABLE #TBL_POA_PLD_ADNL_Pledge_Mtf

	
			select 
					PARTY_CODE	
					,SCRIP_CD	
					,CERTNO	
					,DPID   
					,EXEDATE	
					,CLTDPID 
					,PAYQTY	
					,B.Sett_No
					,SUCCESSFLAG
					,Case When SUCCESSFLAG='Y' Then 'OTP received'
					When SUCCESSFLAG='N' then  'OTP pending'
					When SUCCESSFLAG='P' Then 'Pledge Done' END SUCCESSFLAG_Converted
					,Start_date	
					,End_Date
					,TRANSDATE UpdatedDate
					,QTY
					
			into #TBL_POA_PLD_ADNL_Pledge_Mtf
			 from  [AngelDemat].MSAJAG.dbo.TBL_POA_PLD_ADNL A with (nolock) 
			inner join (select * from [AngelDemat].MSAJAG.dbo.sett_mst with (nolock) where Sett_Type='N') B
			On A.SETT_NO=B.Sett_No
				where Convert(Date,TRANSDATE)>=@startDate 


insert into TBL_POA_PLD_ADNL_Pledge_Mtf
select * from #TBL_POA_PLD_ADNL_Pledge_Mtf


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Trading_Platform_Logs
-- --------------------------------------------------
CREATE PROC [dbo].[Usp_Trading_Platform_Logs]           
@SBTag NVARCHAR(50), 
@Action NVARCHAR(50)

AS      
BEGIN      
 DECLARE @Status BIT = 0      
   IF(@Action = 'Insert') 

   INSERT INTO CommonRejectionTradingPlatform_Logs (SBTag, DownloadedDate)      
				VALUES (@SBTag,GETDATE())
			
   --INSERT INTO [NXT_Logs].dbo.Error_log 
   -- SELECT TOP 1 * FROM [NXT].dbo.Error_log where  ModuleName='TerminalTradeReport (Equity) - CommonRejection' ORDER BY createdDate DESC
   SET @Status=1
   
      IF(@Action='GetDetails')

   SELECT SBTag,DownloadedDate FROM CommonRejectionTradingPlatform_Logs with (nolock) where SBTag=@SBTag
  

   SET @Status=1
  

   END


		
			Select @Status as Status,@SBTag as SBTag

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UPD_BulkIPO_Client
-- --------------------------------------------------
CREATE PROCEDURE usp_UPD_BulkIPO_Client    
(    
 @SBTag VARCHAR(100),    
 @PartyCode VARCHAR(100),    
 @GroupName VARCHAR(1000),  
 @UpiId VARCHAR(50),
 @UpdatedBy VARCHAR(500)    
)    
AS    
BEGIN    
 DECLARE @GroupId BIGINT    
     
 SELECT @GroupId = GroupId FROM BulkIPO_ClientGroup_Clients WHERE PartyCode = @PartyCode  
     
 IF @GroupName = ''    
 BEGIN    
  DELETE FROM BulkIPO_ClientGroup_Clients WHERE PartyCode = @PartyCode    
 END    
 ELSE
 BEGIN
	UPDATE BulkIPO_ClientGroup_Clients
	SET SelectedUPIId = @UpiId
	WHERE PartyCode = @PartyCode 
 END
  
 UPDATE BulkIPO_ClientGroup    
 SET LastUpdate = GETDATE(),    
  UpdatedBy = @UpdatedBy    
 WHERE Id = @GroupId    
     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UPD_CatPaymentMode
-- --------------------------------------------------

CREATE PROCEDURE usp_UPD_CatPaymentMode
(
	@PayModeId INT,
	@CatId INT,
	@IsActive BIT,
	@UpdatedBy VARCHAR(500)
)
AS
BEGIN
	UPDATE DDLCat_PaymentMode
	SET IsActive = @IsActive
	WHERE PayModeId = @PayModeId AND CatId = @CatId
	
	INSERT INTO DDLCat_PaymentModeLog (CatPayModeId, UpdatedIsActive, UpdatedBy, UpdateDateTime)
	SELECT Id, @IsActive, @UpdatedBy, GETDATE()
	FROM DDLCat_PaymentMode
	WHERE PayModeId = @PayModeId AND CatId = @CatId
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPD_ComplianceLog
-- --------------------------------------------------
/*
created by :- Yasmin khan
*/
CREATE PROCEDURE USP_UPD_ComplianceLog
(
	@LogId BIGINT,
	@EndTime DATETIME,
	@UpdatedBy VARCHAR(100)
)
AS
BEGIN
	UPDATE Downloads_ComplianceLog
	SET EndTime = GETDATE(),
		IsCompleted = 1,
		UpdatedBy = @UpdatedBy,
		LastUpdate = GETDATE()
	WHERE Id = @LogId
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UPD_DDLCat
-- --------------------------------------------------

CREATE PROCEDURE usp_UPD_DDLCat
(
	@Id INT,
	@IsActive BIT,
	@UpdatedBy VARCHAR(500)
)
AS
BEGIN
	UPDATE DDLCat
	SET IsActive = @IsActive
	WHERE Id = @Id
	
	INSERT INTO DDLCatLog (CatId, UpdatedIsActive, UpdatedBy, UpdateDateTime)
	SELECT @Id, @IsActive, @UpdatedBy, GETDATE()
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UPD_SBTrainingLinks
-- --------------------------------------------------
CREATE PROCEDURE usp_UPD_SBTrainingLinks
(
	@Language VARCHAR(50),
	@ToTime VARCHAR(50),
	@FromTime VARCHAR(50),
	@Id BIGINT
)
AS
BEGIN
	UPDATE SB_TrainingLinks
	SET Language = @Language,
		ToTime = @ToTime,
		FromTime = @FromTime
	WHERE Id = @Id
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Update_FamilyDetails
-- --------------------------------------------------


-- =============================================
-- Author:		Name
-- Create date: 
-- Description:	
-- =============================================
CREATE PROCEDURE [dbo].[USP_Update_FamilyDetails] 
	-- Add the parameters for the stored procedure here
	@FamilyTradeName varchar(50),@FamilyTradeId int,@CreatedBy VARCHAR (30)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	Update FamilyTradeDetails set FamilyTradeName=@FamilyTradeName,UpdatedBy=@CreatedBy 
	where FamilyTradeId=@FamilyTradeId
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateEWelcomeAccessUser
-- --------------------------------------------------
CREATE PROCEDURE usp_UpdateEWelcomeAccessUser           
(            
 @UserId  int,    
 @ActiveFrom NVARCHAR(100),    
 @ActiveTo NVARCHAR(100),    
 @IsActive NVARCHAR(100) = NULL,
 @LoginUserName NVARCHAR(100)
)            
AS            
BEGIN       
if(@IsActive IS NULL) -- to update active dates
BEGIN
 UPDATE [EWelcomeSBAccess]    
 SET ActiveFrom = @ActiveFrom, ActiveTo = @ActiveTo, UpdatedBy = @LoginUserName, UpdatedOn = GETDATE()    
 WHERE ID = @UserId   
END
ELSE
BEGIN
 UPDATE [EWelcomeSBAccess]    -- to update isActive flag
 SET IsActive = @IsActive, UpdatedBy = @LoginUserName, UpdatedOn = GETDATE()    
 WHERE ID = @UserId 
END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateNXTMobilePopup
-- --------------------------------------------------
CREATE procedure usp_UpdateNXTMobilePopup  
@PopupId INT,  
@Index INT,  
@ImagePath NVARCHAR(MAX) = NULL,  
@ImageName NVARCHAR(MAX) = NULL,  
@ExpiryDate DATE,  
@Redirect_Url NVARCHAR(1000) = NULL,  
@EmpName NVARCHAR(100),
@StartDate DATE = NULL,
@StartTime TIME = NULL,
@ExpiryTime TIME = NULL 
  
AS  
BEGIN  
	UPDATE Tbl_NXTMobilePopup  
	SET [Index] = @Index,   
		ImagePath = CASE WHEN @ImagePath IS NOT NULL THEN @ImagePath ELSE ImagePath END,   
		ImageName = CASE WHEN @ImageName IS NOT NULL THEN @ImageName ELSE ImageName END,  
		StartDate = @StartDate, 
		StartTime = @StartTime, 
		ExpiryDate = @ExpiryDate, 
		ExpiryTime = @ExpiryTime,  
		Redirect_Url = @Redirect_Url,   
		ModifyBy = @EmpName,   
		ModifyDate = GETDATE()  
	WHERE id = @PopupId  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateNXTNotification
-- --------------------------------------------------
CREATE procedure [dbo].[usp_UpdateNXTNotification](  
@CampaignId varchar(100) = '',  
@NotificationTextOld varchar(7000) = '',  
@NotificationTextNew varchar(7000) = '',  
@CreatedDate Date='2020-01-09',      
@NotificationType varchar(200) = '',  
@URL VARCHAR(8000) = NULL,  
@Area NVARCHAR(80) = NULL,  
@Controller NVARCHAR(80) = NULL,  
@Action NVARCHAR(80) = NULL,  
@EmpName NVARCHAR(100) = NULL,  
@StartDate DATE = NULL,  
@StartTime TIME = NULL,  
@ExpiryDate DATE = NULL,  
@ExpiryTime TIME = NULL ,
@QueryParameter VARCHAR(500) = NULL
)  
AS      
BEGIN   
 UPDATE tbl_NotificationNXT  
 SET NotificationText = @NotificationTextNew, URL = @URL, Area = @Area, controller = @Controller, action = @Action, QueryParameter = @QueryParameter,   
  StartDate = @StartDate, StartTime = @StartTime, ExpiryDate = @ExpiryDate, ExpiryTime = @ExpiryTime  
 WHERE NotificationText = @NotificationTextOld  
  AND CampaignId = @CampaignId   
  AND NotificationText <> 'message'   
  AND NotificationType = @NotificationType   
  AND CONVERT(DATE, CreatedDate) = CONVERT(DATE, @CreatedDate)   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateOfferRewardStatus
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[usp_UpdateOfferRewardStatus]   
   (            
     @CouponId VARCHAR(100)   
   )            
   AS            
   BEGIN  
     
   DECLARE @Status INT = 404,  
     @OfferId INT = 0,  @Sub_broker varchar(200),
           @Message VARCHAR(100) = 'CouponId not found.'  
     
    IF EXISTS(SELECT 1 FROM dbo.OffersSubBrokerRewards WHERE CouponId = @CouponId)       
    BEGIN  
       
     IF EXISTS(SELECT 1 FROM dbo.OffersSubBrokerRewards WHERE CouponId = @CouponId AND IsScratched  = 0)  
      BEGIN  
        UPDATE dbo.OffersSubBrokerRewards  
        SET  IsScratched  = 1,  
       ModifiedDate = GETDATE()  
        WHERE CouponId = @CouponId          
          

		  Select @Sub_broker=SBCode from dbo.OffersSubBrokerRewards WHERE CouponId = @CouponId   -- Added by Yogesh for mail if scratch

		  EXEC USP_CompainContestSentCoupon_StockSIP_IsScratch_Mail @Sub_broker   -- Added by Yogesh for mail if scratch


        SET @Status = 200  
        SET @Message = 'Success'  
      END  
     ELSE  
      BEGIN  
        SET @Status = 409  
        SET @Message = 'CouponId already used.'  
      END  
       
       
      SELECT   @Status   AS [Status]   
      ,@Message  AS [Message]  
      ,SBCode  
      ,OfferId  
      ,CouponId  
      ,RewardAmount  
    FROM dbo.OffersSubBrokerRewards    
    WHERE CouponId = @CouponId  
          
       END  
       ELSE  
     SELECT @Status AS [Status]  
       ,@Message AS [Message]   
       ,'' AS SBCode  
       ,@OfferId AS OfferId  
       ,'' AS CouponId  
       ,0 AS RewardAmount  
                
           
   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdatePopupAdmin
-- --------------------------------------------------
CREATE procedure usp_UpdatePopupAdmin  
@PopupId INT,  
@Index INT,  
@ImagePath NVARCHAR(MAX) = NULL,  
@ImageName NVARCHAR(MAX) = NULL,  
@ExpiryDate DATE,  
@Redirect_Url NVARCHAR(1000) = NULL,  
@EmpName NVARCHAR(100),
@StartDate DATE = NULL,
@StartTime TIME = NULL,
@ExpiryTime TIME = NULL
  
AS  
BEGIN  
	UPDATE Tbl_PopupAdmin  
	SET [Index] = @Index,   
		ImagePath = CASE WHEN @ImagePath IS NOT NULL THEN @ImagePath ELSE ImagePath END,   
		ImageName = CASE WHEN @ImageName IS NOT NULL THEN @ImageName ELSE ImageName END,   
		StartDate = @StartDate, 
		StartTime = @StartTime, 
		ExpiryDate = @ExpiryDate, 
		ExpiryTime = @ExpiryTime,
		Redirect_Url = @Redirect_Url,   
		ModifyBy = @EmpName,   
		ModifyDate = GETDATE()  
	WHERE id = @PopupId  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateUtilityMenu
-- --------------------------------------------------
CREATE PROCEDURE usp_UpdateUtilityMenu        
(          
 @MenuId  int,  
 @Name NVARCHAR(100),  
 @Controller NVARCHAR(100),  
 @Action NVARCHAR(100),  
 @LoginUserName NVARCHAR(100),
 @ParentId int = null,
 @IsAccessRequired BIT
)          
AS          
BEGIN      
 UPDATE Menu  
 SET Name = @Name, Controller = @Controller, [Action] = @Action, ParentId = @ParentId, IsAccessRequired = @IsAccessRequired, UpdatedBy = @LoginUserName, UpdatedDate = GETDATE()  
 WHERE ID = @MenuId  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_holiday_list
-- --------------------------------------------------
CREATE PROCEDURE usp_upload_holiday_list  
@holidaylist VARCHAR(MAX),  
@empName NVARCHAR(50)  
AS  
BEGIN 
	declare  @tbl table
	(
		[holiday] varchar(20)
	);
	
	INSERT INTO @tbl
	SELECT * from dbo.[fn_Split] (@holidaylist, ',');
 
	INSERT INTO BankHolidays (        
        HolidayDate        
        ,Status
		, CreatedBy
		, CreatedDateTime
		)              
       SELECT convert(date, t.holiday, 105)
	   , 'A'
	   , @empName
	   , GETDATE()
	   from @tbl t
	   WHERE convert(date, t.holiday, 105) NOT IN (
		SELECT HolidayDate FROM BankHolidays With(Nolock) WHERE Status = 'A'
	   );
END;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UploadPendingSBSelfDeclartion
-- --------------------------------------------------
   
CREATE PROCEDURE [dbo].[usp_UploadPendingSBSelfDeclartion]                
     (                 
   @SbTags VARCHAR(MAX)   
  ,@FnYear varchar(20)      
  ,@EmpName varchar(200)  
    )                
AS                
BEGIN  
              
    INSERT INTO dbo.tbl_NotificationBEENXT ([sub_broker]  
             ,[NotificationText]  
             ,[NotificationType]  
             ,[Individualview]  
             ,[IndividualviewDate]  
             ,[Notification_9]  
             ,[Notification_Date_9]  
             ,[CreatedBy]  
             ,[CreatedDate]  
             ,[UpdatedBy]  
             ,[UpdatedDate]  
             ,[CLTCODEDupl]  
             ,[url]  
             ,[area]  
             ,[controller]  
             ,[action]  
             ,[CampaignId]  
             ,[areaname])  
   SELECT   StringValue  
     ,'Your Self declaration for FY - '+@FnYear+' is pending. Kindly fill up the form to continue receiving Brokerage Payout.'  
     ,'Individual'  
     ,'N'  
     ,GETDATE()  
     ,'N'  
     ,GETDATE()  
     ,''  
     ,GETDATE()  
     ,''  
     ,GETDATE()  
     ,''  
     ,'NXT'  
     ,''  
     ,'Utilities'  
     ,'SelfDeclaration'  
     ,'PendingSelfDeclaration'  
     ,NULL  
   FROM  dbo.[fn_Split] (@SbTags, ',') AS t  
   LEFT JOIN dbo.sb_Declaration s ON s.SbTag = t.StringValue AND s.FnYear = @FnYear  
   WHERE s.SbTag IS NULL 
   
   
   INSERT INTO dbo.tbl_NotificationNXT ([sub_broker]  
             ,[NotificationText]  
             ,[NotificationType]  
             ,[Individualview]  
             ,[IndividualviewDate]  
             ,[Notification_9]  
             ,[Notification_Date_9]  
             ,[CreatedBy]  
             ,[CreatedDate]  
             ,[UpdatedBy]  
             ,[UpdatedDate]  
             ,[CLTCODEDupl]  
             ,[url]  
             ,[area]  
             ,[controller]  
             ,[action]  
             ,[CampaignId]  
             ,[areaname])  
   SELECT   StringValue  
     ,'Your Self declaration for FY - '+@FnYear+' is pending. Kindly fill up the form to continue receiving Brokerage Payout.'  
     ,'Individual'  
     ,'N'  
     ,GETDATE()  
     ,'N'  
     ,GETDATE()  
     ,''  
     ,GETDATE()  
     ,''  
     ,GETDATE()  
     ,''  
     ,'NXT'  
     ,''  
     ,'Utilities'  
     ,'SelfDeclaration'  
     ,'PendingSelfDeclaration'  
     ,NULL  
   FROM  dbo.[fn_Split] (@SbTags, ',') AS t  
   LEFT JOIN dbo.sb_Declaration s ON s.SbTag = t.StringValue AND s.FnYear = @FnYear  
   WHERE s.SbTag IS NULL    
     
     
   INSERT INTO dbo.sb_Declaration (SbTag, FnYear,IsOTPVerified, CreatedBy, CreatedDate)        
   SELECT StringValue,@FnYear,0,@EmpName,GETDATE()    
   FROM  dbo.[fn_Split] (@SbTags, ',') AS t  
   LEFT JOIN dbo.sb_Declaration s ON s.SbTag = t.StringValue AND s.FnYear = @FnYear  
   WHERE s.SbTag IS NULL   
     
     
   
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_usernameFilter
-- --------------------------------------------------
CREATE procedure Usp_usernameFilter
(
@username varchar(200)
)
as
begin


--EXEC Usp_usernameFilter 'CBHO'
SELECT distinct username
  FROM 
  [196.1.115.132].Rolemgm.dbo.user_login SB with (nolock)
  WHERE 
	  status=1
	  and login_inactive_date>getdate()
	  and access_to='SB'
	  --and usertype='ADMIN'
	  and username is not NULL
	and username  like '%'+	@username+ '%'
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Utility_Get_AdvisoryPerformanceData
-- --------------------------------------------------

CREATE procedure [dbo].[USP_Utility_Get_AdvisoryPerformanceData]
AS    
BEGIN    
	SELECT Id, Period, PeriodDesc, EquityFileName, FutureFileName, CreatedBy, CreatedDate, Active
	From AdvisoryPerformanceReportData
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Watchlist_Trigger_Mobile_2
-- --------------------------------------------------
Create procedure usp_Watchlist_Trigger_Mobile_2
(
	@sub_broker varchar(100),
	@AlertCriteria varchar(100),
	@StockName varchar(100),
	@Variation varchar(100),
	@CheckingCriteria varchar(100),
	@LTP float,
	@active INT,
	@Flag Char(1),
	@Triggerid INT=Null

)
as
begin

	If @flag='I'
	begin
		Insert into Watchlist_Trigger_Mobile_2 
		(
			sub_broker,AlertCriteria,StockName,Variation,CheckingCriteria,LTP,active
		)
		Select @sub_broker,@AlertCriteria,@StockName,@Variation,@CheckingCriteria,@LTP,1

	END
	else
	Begin
		
		Update Watchlist_Trigger_Mobile_2 
		Set active=0		
		where sub_broker=@sub_broker and Triggerid=@Triggerid
		
	END

END

GO

-- --------------------------------------------------
-- TABLE dbo.Accrual_Amt_NXT
-- --------------------------------------------------
CREATE TABLE [dbo].[Accrual_Amt_NXT]
(
    [AssetClass] VARCHAR(100) NULL,
    [PARTY_CODE] VARCHAR(100) NULL,
    [Accrual_Amt] NUMERIC(10, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AdvisoryDeleteLog_NXT
-- --------------------------------------------------
CREATE TABLE [dbo].[AdvisoryDeleteLog_NXT]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [AdvisoryPerformanceReportDataId] BIGINT NOT NULL,
    [Period] NVARCHAR(50) NOT NULL,
    [DeletedBy] NVARCHAR(200) NOT NULL,
    [DeletedDateTime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AdvisoryPerformanceReportData
-- --------------------------------------------------
CREATE TABLE [dbo].[AdvisoryPerformanceReportData]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Period] NVARCHAR(50) NOT NULL,
    [PeriodDesc] NVARCHAR(200) NOT NULL,
    [EquityFileName] NVARCHAR(200) NULL,
    [FutureFileName] NVARCHAR(200) NULL,
    [Active] BIT NOT NULL,
    [CreatedBy] NVARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AdvisoryPerformanceReportDataDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[AdvisoryPerformanceReportDataDetails]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [AdvisoryPerformanceReportData_Id] INT NOT NULL,
    [Market] NVARCHAR(50) NOT NULL,
    [Segment] NVARCHAR(100) NOT NULL,
    [TotalCalls] INT NOT NULL,
    [PositiveCalls] INT NOT NULL,
    [SRPercentage] INT NULL,
    [NetRRR] NUMERIC(5, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALG_EXP_MAST
-- --------------------------------------------------
CREATE TABLE [dbo].[ALG_EXP_MAST]
(
    [ENTITY_CODE] VARCHAR(20) NOT NULL,
    [Intraday_Type] VARCHAR(20) NULL,
    [CRTDT] DATETIME NOT NULL,
    [MDYDT] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ALG_EXP_MAST_Bkp16Nov2022
-- --------------------------------------------------
CREATE TABLE [dbo].[ALG_EXP_MAST_Bkp16Nov2022]
(
    [ENTITY_CODE] VARCHAR(20) NOT NULL,
    [Intraday_Type] VARCHAR(20) NULL,
    [CRTDT] DATETIME NOT NULL,
    [MDYDT] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ANAND1MSAJAGClient_Brok_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[ANAND1MSAJAGClient_Brok_Details]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [Deactive_value] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ANAND1MSAJAGClient_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[ANAND1MSAJAGClient_Details]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ANAND1MSAJAGClient_Details_New
-- --------------------------------------------------
CREATE TABLE [dbo].[ANAND1MSAJAGClient_Details_New]
(
    [cl_code] VARCHAR(10) NOT NULL,
    [cl_status] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AngelClient
-- --------------------------------------------------
CREATE TABLE [dbo].[AngelClient]
(
    [Region] VARCHAR(50) NOT NULL,
    [Branch] VARCHAR(10) NOT NULL,
    [SubBroker] VARCHAR(10) NOT NULL,
    [PartyCode] VARCHAR(25) NOT NULL,
    [ShortName] VARCHAR(100) NULL,
    [LongName] VARCHAR(500) NOT NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [Address3] VARCHAR(50) NULL,
    [City] VARCHAR(40) NOT NULL,
    [State] VARCHAR(50) NOT NULL,
    [Nation] VARCHAR(15) NOT NULL,
    [Zip] VARCHAR(10) NOT NULL,
    [ResPhone] VARCHAR(15) NOT NULL,
    [MobileNo] VARCHAR(40) NOT NULL,
    [EMail] VARCHAR(50) NOT NULL,
    [PanNo] VARCHAR(25) NOT NULL,
    [Birthdate] DATETIME NOT NULL DEFAULT ((0)),
    [Gender] VARCHAR(2) NOT NULL,
    [ActiveFrom] DATETIME NOT NULL,
    [InActiveFrom] DATETIME NOT NULL,
    [B2C] CHAR(1) NOT NULL,
    [NBFC] CHAR(1) NOT NULL DEFAULT 'N',
    [EbrokingClient] CHAR(1) NOT NULL,
    [TradingPlatform] VARCHAR(10) NOT NULL,
    [RmDealer] VARCHAR(20) NOT NULL,
    [RmDealerName] VARCHAR(100) NOT NULL DEFAULT '',
    [RmDealerEmail] VARCHAR(100) NOT NULL DEFAULT '',
    [RmDealerPhone] VARCHAR(100) NOT NULL DEFAULT '',
    [DPIDs] VARCHAR(200) NOT NULL DEFAULT '',
    [DPIDWithPOA] VARCHAR(200) NOT NULL DEFAULT '',
    [DPIDForPayout] VARCHAR(200) NOT NULL DEFAULT '',
    [UpdDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.AnswerOptions
-- --------------------------------------------------
CREATE TABLE [dbo].[AnswerOptions]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Type] VARCHAR(10) NOT NULL,
    [Value] VARCHAR(100) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL,
    [LastUpdate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AumCalculationSubbroker
-- --------------------------------------------------
CREATE TABLE [dbo].[AumCalculationSubbroker]
(
    [AUM] NUMERIC(18, 2) NULL,
    [Party_Code] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.B2B_Bulk_DealerMapping
-- --------------------------------------------------
CREATE TABLE [dbo].[B2B_Bulk_DealerMapping]
(
    [Party_Code] VARCHAR(20) NULL,
    [Dealer1] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.B2B_Bulk_DealerMapping_Bkp08Feb2019_Renamed_By_DBA
-- --------------------------------------------------
CREATE TABLE [dbo].[B2B_Bulk_DealerMapping_Bkp08Feb2019_Renamed_By_DBA]
(
    [Party_Code] VARCHAR(20) NULL,
    [Dealer1] VARCHAR(20) NULL,
    [Dealer2] VARCHAR(20) NULL,
    [ProcessId] VARCHAR(50) NULL,
    [Segment_Type] VARCHAR(20) NULL,
    [UserCode] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.B2B_Bulk_DealerMapping_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[B2B_Bulk_DealerMapping_Prev]
(
    [Party_Code] VARCHAR(20) NULL,
    [Dealer1] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.B2B_Bulk_DealerMapping_Prev_Bkp08Feb2019_Renamed_By_DBA
-- --------------------------------------------------
CREATE TABLE [dbo].[B2B_Bulk_DealerMapping_Prev_Bkp08Feb2019_Renamed_By_DBA]
(
    [Party_Code] VARCHAR(20) NULL,
    [Dealer1] VARCHAR(20) NULL,
    [Dealer2] VARCHAR(20) NULL,
    [ProcessId] VARCHAR(50) NULL,
    [Segment_Type] VARCHAR(20) NULL,
    [UserCode] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BankHolidays
-- --------------------------------------------------
CREATE TABLE [dbo].[BankHolidays]
(
    [BankHolidayId] INT IDENTITY(1,1) NOT NULL,
    [HolidayDate] DATE NULL,
    [Status] CHAR(1) NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDateTime] DATETIME NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdatedTime] DATETIME NULL,
    [Equity] VARCHAR(5) NULL DEFAULT 'Y',
    [Debt] VARCHAR(5) NULL DEFAULT 'Y',
    [Liquid] VARCHAR(5) NULL DEFAULT 'Y'
);

GO

-- --------------------------------------------------
-- TABLE dbo.bbo_fa_PARAMETER
-- --------------------------------------------------
CREATE TABLE [dbo].[bbo_fa_PARAMETER]
(
    [Sdtcur] DATETIME NULL,
    [Ldtcur] DATETIME NULL,
    [Ldtprv] DATETIME NULL,
    [Sdtnxt] DATETIME NULL,
    [Curyear] INT NULL,
    [Vnoflag] INT NULL,
    [Match_btob] INT NULL,
    [Match_ctoc] INT NULL,
    [Maker_checker] INT NULL,
    [Voucherprintflag] INT NULL,
    [Branchflag] INT NULL,
    [FldAuto] INT NULL,
    [REPORTDAYS] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BeeMF_UserLoginRequest
-- --------------------------------------------------
CREATE TABLE [dbo].[BeeMF_UserLoginRequest]
(
    [Row_id] INT IDENTITY(1,1) NOT NULL,
    [Access_code] VARCHAR(30) NULL,
    [Username] VARCHAR(30) NULL,
    [Login_count] INT NULL,
    [Last_login] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BO_MTFFinal
-- --------------------------------------------------
CREATE TABLE [dbo].[BO_MTFFinal]
(
    [party_code] VARCHAR(100) NULL,
    [FUDEDVAL] NUMERIC(20, 2) NULL,
    [FundValDate] DATE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BO_MTFFinal_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[BO_MTFFinal_Prev]
(
    [party_code] VARCHAR(100) NULL,
    [FUDEDVAL] NUMERIC(20, 2) NULL,
    [FundValDate] DATE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bse_sett_mst
-- --------------------------------------------------
CREATE TABLE [dbo].[bse_sett_mst]
(
    [co_code] VARCHAR(25) NULL,
    [Exchange] CHAR(3) NOT NULL,
    [Sett_Type] CHAR(3) NOT NULL,
    [Sett_No] CHAR(7) NOT NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [Funds_Payin] DATETIME NULL,
    [Funds_Payout] DATETIME NULL,
    [Sec_Payin] DATETIME NULL,
    [Sec_Payout] DATETIME NULL,
    [Series] VARCHAR(3) NULL,
    [MarketType] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BulkIPO_ClientGroup
-- --------------------------------------------------
CREATE TABLE [dbo].[BulkIPO_ClientGroup]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(50) NOT NULL,
    [Name] VARCHAR(1000) NOT NULL,
    [CreatedBy] VARCHAR(500) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [UpdatedBy] VARCHAR(500) NULL,
    [LastUpdate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BulkIPO_ClientGroup_Clients
-- --------------------------------------------------
CREATE TABLE [dbo].[BulkIPO_ClientGroup_Clients]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [GroupId] BIGINT NOT NULL,
    [PartyCode] VARCHAR(50) NOT NULL,
    [SelectedUPIId] VARCHAR(2000) NOT NULL,
    [SelectedDPId] VARCHAR(200) NOT NULL DEFAULT ''
);

GO

-- --------------------------------------------------
-- TABLE dbo.BulkIPO_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[BulkIPO_Log]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [GroupId] BIGINT NOT NULL,
    [IPOSrNo] VARCHAR(100) NOT NULL,
    [CreatedBy] VARCHAR(500) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.BusinessdashboardActionsNXT
-- --------------------------------------------------
CREATE TABLE [dbo].[BusinessdashboardActionsNXT]
(
    [Subbroker] VARCHAR(100) NULL,
    [ClientCode] VARCHAR(100) NULL,
    [Flag] VARCHAR(10) NULL,
    [Createdate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [Updatedate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Cli_AccCharges_New
-- --------------------------------------------------
CREATE TABLE [dbo].[Cli_AccCharges_New]
(
    [Charges_Date] DATETIME NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Charges_Code] INT NULL,
    [Charges_amt] MONEY NULL DEFAULT ((0)),
    [JV_Posted] VARCHAR(1) NULL,
    [Updated_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Cli_AccCharges_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[Cli_AccCharges_Prev]
(
    [Charges_Date] DATETIME NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Charges_Code] INT NULL,
    [Charges_amt] MONEY NULL DEFAULT ((0)),
    [JV_Posted] VARCHAR(1) NULL,
    [Updated_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLI_ACCCHARGES_TobeDeleted
-- --------------------------------------------------
CREATE TABLE [dbo].[CLI_ACCCHARGES_TobeDeleted]
(
    [Charges_Date] DATETIME NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Charges_Code] INT NULL,
    [Charges_amt] MONEY NULL,
    [JV_Posted] VARCHAR(1) NULL,
    [Updated_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLI_ACCCHARGESMASTER
-- --------------------------------------------------
CREATE TABLE [dbo].[CLI_ACCCHARGESMASTER]
(
    [Charges_Code] INT NOT NULL,
    [Charges_Name] VARCHAR(25) NULL,
    [CutOffDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details]
(
    [cl_code] VARCHAR(100) NULL,
    [IS_CLOSED] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_brok_details_Ipartner
-- --------------------------------------------------
CREATE TABLE [dbo].[client_brok_details_Ipartner]
(
    [cl_code] VARCHAR(100) NULL,
    [IS_CLOSED] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ClientLedgerBalance_IPartner
-- --------------------------------------------------
CREATE TABLE [dbo].[ClientLedgerBalance_IPartner]
(
    [SubBroker] VARCHAR(100) NULL,
    [Party_Code] VARCHAR(100) NULL,
    [Ledger] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ClientLedgerBalance_IPartner_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[ClientLedgerBalance_IPartner_Prev]
(
    [SubBroker] VARCHAR(100) NULL,
    [Party_Code] VARCHAR(100) NULL,
    [Ledger] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ClientNXTActive_ZeroBrok
-- --------------------------------------------------
CREATE TABLE [dbo].[ClientNXTActive_ZeroBrok]
(
    [Sub_broker] VARCHAR(100) NULL,
    [ClientCode] VARCHAR(100) NULL,
    [ActivateDate] DATETIME NULL,
    [EntryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CommonRejectionTradingPlatform_Logs
-- --------------------------------------------------
CREATE TABLE [dbo].[CommonRejectionTradingPlatform_Logs]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBTag] NVARCHAR(50) NULL,
    [DownloadedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Daily_sharing
-- --------------------------------------------------
CREATE TABLE [dbo].[Daily_sharing]
(
    [segment] VARCHAR(50) NULL,
    [sauda_date] DATE NULL,
    [brok_earned] NUMERIC(21, 4) NULL,
    [remi_share] NUMERIC(21, 4) NULL,
    [sub_remi_share] NUMERIC(21, 4) NULL,
    [angel_share] NUMERIC(21, 4) NULL,
    [zone] VARCHAR(30) NULL,
    [region] VARCHAR(100) NULL,
    [branch] VARCHAR(20) NULL,
    [branchname] VARCHAR(100) NULL,
    [Regionname] VARCHAR(100) NULL,
    [sb] VARCHAR(30) NULL,
    [client] VARCHAR(50) NULL,
    [Addt_Brok] NUMERIC(21, 4) NULL,
    [AddAngelShare] NUMERIC(21, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Daily_sharing_new
-- --------------------------------------------------
CREATE TABLE [dbo].[Daily_sharing_new]
(
    [segment] VARCHAR(10) NULL,
    [sauda_date] DATETIME NULL,
    [brok_earned] MONEY NULL,
    [remi_share] MONEY NULL,
    [sub_remi_share] MONEY NULL,
    [angel_share] MONEY NULL,
    [zone] VARCHAR(20) NULL,
    [region] VARCHAR(255) NULL,
    [branch] VARCHAR(10) NULL,
    [branchname] VARCHAR(100) NULL,
    [Regionname] VARCHAR(255) NULL,
    [sb] VARCHAR(10) NULL,
    [client] CHAR(20) NULL,
    [Addt_Brok] MONEY NULL,
    [AddAngelShare] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DashboardVideoUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[DashboardVideoUpload]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [FileName] VARCHAR(200) NOT NULL,
    [FilePath] VARCHAR(2000) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [LastUpdate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [IsActive] BIT NOT NULL DEFAULT ((1)),
    [UpdatedBy] VARCHAR(200) NULL,
    [OrderIndex] TINYINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Db_ResponseTime
-- --------------------------------------------------
CREATE TABLE [dbo].[Db_ResponseTime]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [ProcedureName] VARCHAR(100) NULL,
    [StartTime] DATETIME NULL,
    [EndTime] DATETIME NULL,
    [TimeTaken] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Db_ResponseTimeForOpti
-- --------------------------------------------------
CREATE TABLE [dbo].[Db_ResponseTimeForOpti]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [ProcedureName] VARCHAR(100) NULL,
    [StartTime] DATETIME NULL,
    [EndTime] DATETIME NULL,
    [TimeTaken] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DDLCat
-- --------------------------------------------------
CREATE TABLE [dbo].[DDLCat]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Text] VARCHAR(150) NOT NULL,
    [Value] VARCHAR(100) NOT NULL,
    [IsActive] BIT NOT NULL DEFAULT ((1))
);

GO

-- --------------------------------------------------
-- TABLE dbo.DDLCat_PaymentMode
-- --------------------------------------------------
CREATE TABLE [dbo].[DDLCat_PaymentMode]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [CatId] INT NOT NULL,
    [PayModeId] INT NOT NULL,
    [IsActive] BIT NOT NULL DEFAULT ((1))
);

GO

-- --------------------------------------------------
-- TABLE dbo.DDLCat_PaymentModeLog
-- --------------------------------------------------
CREATE TABLE [dbo].[DDLCat_PaymentModeLog]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [CatPayModeId] INT NOT NULL,
    [UpdatedIsActive] BIT NOT NULL,
    [UpdatedBy] VARCHAR(500) NOT NULL,
    [UpdateDateTime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DDLCatLog
-- --------------------------------------------------
CREATE TABLE [dbo].[DDLCatLog]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [CatId] INT NOT NULL,
    [UpdatedIsActive] BIT NOT NULL,
    [UpdatedBy] VARCHAR(500) NOT NULL,
    [UpdateDateTime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Dealer_Users
-- --------------------------------------------------
CREATE TABLE [dbo].[Dealer_Users]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ECode] NVARCHAR(50) NULL,
    [Islogin] BIT NULL,
    [Name] NVARCHAR(200) NOT NULL,
    [Active] BIT NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DocumentUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[DocumentUpload]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [MasterId] INT NOT NULL,
    [FileName] VARCHAR(200) NOT NULL,
    [FilePath] VARCHAR(2000) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [LastUpdate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [IsDeleted] BIT NULL,
    [DeletedBy] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DocumentUploadMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[DocumentUploadMaster]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [CardType] VARCHAR(200) NOT NULL,
    [CardTypeKey] VARCHAR(150) NOT NULL,
    [ContentType] VARCHAR(100) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [LastUpdate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DocumentUploadYoutube
-- --------------------------------------------------
CREATE TABLE [dbo].[DocumentUploadYoutube]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [MasterId] INT NOT NULL,
    [FileName] VARCHAR(200) NOT NULL,
    [FilePath] VARCHAR(2000) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [LastUpdate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [IsActive] BIT NOT NULL DEFAULT ((1)),
    [UpdatedBy] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Downloads_ComplianceLog
-- --------------------------------------------------
CREATE TABLE [dbo].[Downloads_ComplianceLog]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(100) NOT NULL,
    [DocumentId] BIGINT NOT NULL,
    [StartTime] DATETIME NOT NULL,
    [EndTime] DATETIME NULL,
    [IsCompleted] BIT NOT NULL,
    [CreatedBy] VARCHAR(1000) NOT NULL,
    [CreationDate] DATETIME NULL DEFAULT (getdate()),
    [UpdatedBy] VARCHAR(1000) NULL,
    [LastUpdate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DPStockShiftingOutsideAngel_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[DPStockShiftingOutsideAngel_Log]
(
    [From_DP] VARCHAR(100) NULL,
    [TD_ISIN_CODE] VARCHAR(100) NULL,
    [TD_CURDATE] DATETIME NULL,
    [NISE_PARTY_CODE] VARCHAR(100) NULL,
    [To_DP] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EmandateSMSLinkLog
-- --------------------------------------------------
CREATE TABLE [dbo].[EmandateSMSLinkLog]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [PartyCode] NVARCHAR(20) NOT NULL,
    [MandateMappingRefNo] NVARCHAR(50) NULL,
    [SMSLink] NVARCHAR(250) NULL,
    [BankName] NVARCHAR(MAX) NULL,
    [BankNumber] NVARCHAR(MAX) NULL,
    [SmsStatus] NVARCHAR(1) NULL,
    [UserType] NVARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL,
    [UpdatedOn] DATETIME NULL,
    [Amount] INT NULL DEFAULT ((0)),
    [AuthMode] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Error_log
-- --------------------------------------------------
CREATE TABLE [dbo].[Error_log]
(
    [ProjectName] VARCHAR(20) NULL,
    [ModuleName] VARCHAR(300) NULL,
    [Controller] VARCHAR(50) NULL,
    [ErrorMsg] VARCHAR(MAX) NULL,
    [Action] VARCHAR(50) NULL,
    [API_URL] VARCHAR(3000) NULL,
    [Request] VARCHAR(MAX) NULL,
    [Response] VARCHAR(MAX) NULL,
    [StackTrace] VARCHAR(MAX) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [createdDate] DATETIME NULL,
    [Event] VARCHAR(20) NULL,
    [IPadress] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EWelcomeSBAccess
-- --------------------------------------------------
CREATE TABLE [dbo].[EWelcomeSBAccess]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SBTAG] VARCHAR(100) NULL,
    [ActiveFrom] VARCHAR(100) NULL,
    [ActiveTo] VARCHAR(100) NULL,
    [IsActive] VARCHAR(100) NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [CreatedOn] VARCHAR(100) NULL,
    [UpdatedBy] VARCHAR(100) NULL,
    [UpdatedOn] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Exotel_Error_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[Exotel_Error_Log]
(
    [JsonResponse] VARCHAR(MAX) NULL,
    [ExceptionMessage] VARCHAR(MAX) NULL,
    [CreateDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeDetails]
(
    [FamilyTradeId] INT IDENTITY(1,1) NOT NULL,
    [FamilyTradeName] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(30) NULL,
    [UpdatedDate] DATETIME NULL,
    [familycode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeDetails_Bkp05Aug2019
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeDetails_Bkp05Aug2019]
(
    [FamilyTradeId] INT IDENTITY(1,1) NOT NULL,
    [FamilyTradeName] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(30) NULL,
    [UpdatedDate] DATETIME NULL,
    [familycode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeDetails_Bkp12Apr2022
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeDetails_Bkp12Apr2022]
(
    [FamilyTradeId] INT IDENTITY(1,1) NOT NULL,
    [FamilyTradeName] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(30) NULL,
    [UpdatedDate] DATETIME NULL,
    [familycode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeDetails_Bkp13Feb2020
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeDetails_Bkp13Feb2020]
(
    [FamilyTradeId] INT IDENTITY(1,1) NOT NULL,
    [FamilyTradeName] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(30) NULL,
    [UpdatedDate] DATETIME NULL,
    [familycode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeDetails_Bkp15July2022
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeDetails_Bkp15July2022]
(
    [FamilyTradeId] INT IDENTITY(1,1) NOT NULL,
    [FamilyTradeName] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(30) NULL,
    [UpdatedDate] DATETIME NULL,
    [familycode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeDetails_DeleteLog
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeDetails_DeleteLog]
(
    [FamilyTradeId] INT NOT NULL,
    [FamilyTradeName] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [DeletedBy] VARCHAR(30) NULL,
    [DeletedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeTransactions
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeTransactions]
(
    [FamilyTradeId] INT NULL,
    [ClientId] VARCHAR(30) NULL,
    [MembershipType] VARCHAR(30) NULL,
    [Relation] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [Authorised] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeTransactions_Bkp05Aug2019
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeTransactions_Bkp05Aug2019]
(
    [FamilyTradeId] INT NULL,
    [ClientId] VARCHAR(30) NULL,
    [MembershipType] VARCHAR(30) NULL,
    [Relation] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [Authorised] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeTransactions_Bkp12Apr2022
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeTransactions_Bkp12Apr2022]
(
    [FamilyTradeId] INT NULL,
    [ClientId] VARCHAR(30) NULL,
    [MembershipType] VARCHAR(30) NULL,
    [Relation] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [Authorised] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeTransactions_Bkp13Feb2020
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeTransactions_Bkp13Feb2020]
(
    [FamilyTradeId] INT NULL,
    [ClientId] VARCHAR(30) NULL,
    [MembershipType] VARCHAR(30) NULL,
    [Relation] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [Authorised] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeTransactions_Bkp15July2022
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeTransactions_Bkp15July2022]
(
    [FamilyTradeId] INT NULL,
    [ClientId] VARCHAR(30) NULL,
    [MembershipType] VARCHAR(30) NULL,
    [Relation] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [Authorised] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FamilyTradeTransactions_DeleteLog
-- --------------------------------------------------
CREATE TABLE [dbo].[FamilyTradeTransactions_DeleteLog]
(
    [FamilyTradeId] INT NULL,
    [ClientId] VARCHAR(30) NULL,
    [MembershipType] VARCHAR(30) NULL,
    [Relation] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL,
    [DeletedBy] VARCHAR(30) NULL,
    [DeletedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.feed_mfisin_all
-- --------------------------------------------------
CREATE TABLE [dbo].[feed_mfisin_all]
(
    [mf_schcode] INT NOT NULL,
    [ISIN] VARCHAR(12) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Final_Daily_Activation1
-- --------------------------------------------------
CREATE TABLE [dbo].[Final_Daily_Activation1]
(
    [Sub_Broker] VARCHAR(2000) NULL,
    [Total_ActiveSB] INT NULL,
    [Total_Cnt] INT NULL,
    [AR] NUMERIC(18, 2) NULL,
    [Client_Age_Year] VARCHAR(100) NULL,
    [Quartile] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Final_Test_Buss_Culs
-- --------------------------------------------------
CREATE TABLE [dbo].[Final_Test_Buss_Culs]
(
    [Sub_Broker] VARCHAR(200) NULL,
    [Age_Year] VARCHAR(10) NULL,
    [AR] NUMERIC(18, 2) NULL,
    [Category] VARCHAR(1000) NULL,
    [Quartile] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Financial_ledger_new
-- --------------------------------------------------
CREATE TABLE [dbo].[Financial_ledger_new]
(
    [FY] NVARCHAR(255) NULL,
    [Date] DATETIME NULL,
    [Voucher Type] NVARCHAR(255) NULL,
    [Vr No ] FLOAT NULL,
    [Cheque No] NVARCHAR(255) NULL,
    [Particulars] NVARCHAR(255) NULL,
    [Debit Amt#] FLOAT NULL,
    [Credit Amt] FLOAT NULL,
    [Balance ] FLOAT NULL,
    [SBCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Financial_Ledger_OneTime
-- --------------------------------------------------
CREATE TABLE [dbo].[Financial_Ledger_OneTime]
(
    [FY] NVARCHAR(255) NULL,
    [Date] DATETIME NULL,
    [Voucher Type] NVARCHAR(255) NULL,
    [Vr No ] FLOAT NULL,
    [Cheque No] NVARCHAR(255) NULL,
    [Particulars] NVARCHAR(255) NULL,
    [Debit Amt#] FLOAT NULL,
    [Credit Amt] FLOAT NULL,
    [Balance ] FLOAT NULL,
    [SBCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Financial_Ledger_OneTime_Bkp20Dec2019
-- --------------------------------------------------
CREATE TABLE [dbo].[Financial_Ledger_OneTime_Bkp20Dec2019]
(
    [FY] NVARCHAR(255) NULL,
    [Date] DATETIME NULL,
    [Voucher Type] NVARCHAR(255) NULL,
    [Vr No ] FLOAT NULL,
    [Cheque No] NVARCHAR(255) NULL,
    [Particulars] NVARCHAR(255) NULL,
    [Debit Amt#] FLOAT NULL,
    [Credit Amt] FLOAT NULL,
    [Balance ] FLOAT NULL,
    [SBCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Financial_Ledger_OnetimeData
-- --------------------------------------------------
CREATE TABLE [dbo].[Financial_Ledger_OnetimeData]
(
    [FY] NVARCHAR(255) NULL,
    [Date] DATETIME NULL,
    [Voucher Type] NVARCHAR(255) NULL,
    [Vr No ] FLOAT NULL,
    [Cheque No] NVARCHAR(255) NULL,
    [Particulars] NVARCHAR(255) NULL,
    [Debit Amt#] FLOAT NULL,
    [Credit Amt] FLOAT NULL,
    [Balance ] FLOAT NULL,
    [SBCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ForceUpdate_NXT_Mob
-- --------------------------------------------------
CREATE TABLE [dbo].[ForceUpdate_NXT_Mob]
(
    [sub_broker] VARCHAR(100) NULL,
    [VersionCode] VARCHAR(100) NULL,
    [Plateform] VARCHAR(100) NULL,
    [CurrentVersion] VARCHAR(100) NULL,
    [IsForceUpdate] VARCHAR(100) NULL,
    [ForceUpdate] DATETIME NULL,
    [CreatedDate] DATETIME NULL,
    [ID] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ForceUpdate_NXT_Mob_13_08_2021
-- --------------------------------------------------
CREATE TABLE [dbo].[ForceUpdate_NXT_Mob_13_08_2021]
(
    [sub_broker] VARCHAR(100) NULL,
    [VersionCode] VARCHAR(100) NULL,
    [Plateform] VARCHAR(100) NULL,
    [CurrentVersion] VARCHAR(100) NULL,
    [IsForceUpdate] VARCHAR(100) NULL,
    [ForceUpdate] DATETIME NULL,
    [CreatedDate] DATETIME NULL,
    [ID] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ForceUpdate_NXT_Mob_29_09_2021
-- --------------------------------------------------
CREATE TABLE [dbo].[ForceUpdate_NXT_Mob_29_09_2021]
(
    [sub_broker] VARCHAR(100) NULL,
    [VersionCode] VARCHAR(100) NULL,
    [Plateform] VARCHAR(100) NULL,
    [CurrentVersion] VARCHAR(100) NULL,
    [IsForceUpdate] VARCHAR(100) NULL,
    [ForceUpdate] DATETIME NULL,
    [CreatedDate] DATETIME NULL,
    [ID] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FundBarometerFileData
-- --------------------------------------------------
CREATE TABLE [dbo].[FundBarometerFileData]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [FileName] VARCHAR(200) NOT NULL DEFAULT '',
    [FilePath] VARCHAR(MAX) NOT NULL DEFAULT '',
    [ProjectType] VARCHAR(50) NOT NULL DEFAULT '',
    [CreatedBy] VARCHAR(50) NOT NULL DEFAULT '',
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.GetArqClientsData_Trans_V3
-- --------------------------------------------------
CREATE TABLE [dbo].[GetArqClientsData_Trans_V3]
(
    [Mode] VARCHAR(50) NULL,
    [Exchangesegment] VARCHAR(50) NULL,
    [Party_code] VARCHAR(50) NULL,
    [Sauda_date] DATETIME NULL,
    [Isin] VARCHAR(50) NULL,
    [PqtyDel] INT NULL,
    [SaleSauda_date] DATETIME NULL,
    [SqtyDel] INT NULL,
    [PBrokDel] MONEY NULL,
    [SBrokDel] MONEY NULL,
    [CF] VARCHAR(2) NULL,
    [Scrip_Name] VARCHAR(80) NULL,
    [Scrip_cd] VARCHAR(80) NULL,
    [Price] MONEY NULL,
    [PrevClose] MONEY NULL,
    [RecordType] VARCHAR(10) NULL,
    [IsCA] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GetSBRegStatus
-- --------------------------------------------------
CREATE TABLE [dbo].[GetSBRegStatus]
(
    [regtag] VARCHAR(500) NULL,
    [regtradeName] VARCHAR(500) NULL,
    [TagGeneratedDate] DATETIME NULL,
    [BSECM_remi] VARCHAR(500) NULL,
    [BSECM_SB] VARCHAR(500) NULL,
    [NSECM] VARCHAR(500) NULL,
    [NSEFO] VARCHAR(500) NULL,
    [MCX] VARCHAR(500) NULL,
    [NCDEX] VARCHAR(500) NULL,
    [MCD] VARCHAR(500) NULL,
    [NSX] VARCHAR(500) NULL,
    [MF] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GroupTopper_Ipartner
-- --------------------------------------------------
CREATE TABLE [dbo].[GroupTopper_Ipartner]
(
    [Category] VARCHAR(100) NULL,
    [MTD_New_Clt_Aquired_sub_broker] VARCHAR(100) NULL,
    [MTD_New_Clt_Aquired_TAGGenerateddate] VARCHAR(20) NULL,
    [MTD_New_Clt_Aquired] INT NULL,
    [YTD_New_Clt_Aquired_sub_broker] VARCHAR(100) NULL,
    [YTD_New_Clt_Aquired_TAGGenerateddate] VARCHAR(20) NULL,
    [YTD_New_Clt_Aquired] INT NULL,
    [MTD_Traded_Client_sub_broker] VARCHAR(100) NULL,
    [MTD_Traded_Client_TAGGenerateddate] VARCHAR(20) NULL,
    [MTD_Traded_Client] INT NULL,
    [YTD_Traded_Client_sub_broker] VARCHAR(100) NULL,
    [YTD_Traded_Client_TAGGenerateddate] VARCHAR(20) NULL,
    [YTD_Traded_Client] INT NULL,
    [MTD_Gross_Revenue_sub_broker] VARCHAR(100) NULL,
    [MTD_Gross_Revenue_TAGGenerateddate] VARCHAR(20) NULL,
    [MTD_Gross_Revenue] NUMERIC(18, 4) NULL,
    [YTD_Gross_Revenue_sub_broker] VARCHAR(100) NULL,
    [YTD_Gross_Revenue_TAGGenerateddate] VARCHAR(20) NULL,
    [YTD_Gross_Revenue] NUMERIC(18, 4) NULL,
    [MF_AUM_sub_broker] VARCHAR(100) NULL,
    [MF_AUM_TAGGenerateddate] VARCHAR(20) NULL,
    [MF_AUM] NUMERIC(18, 4) NULL,
    [Active_Clients_sub_broker] VARCHAR(100) NULL,
    [Active_Clients_TAGGenerateddate] VARCHAR(20) NULL,
    [Active_Clients] INT NULL,
    [MF_Active_Clients_sub_broker] VARCHAR(100) NULL,
    [MF_Active_Clients_TAGGenerateddate] VARCHAR(20) NULL,
    [MF_Active_Clients] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.GroupTopper_Ipartner_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[GroupTopper_Ipartner_Prev]
(
    [Category] VARCHAR(100) NULL,
    [MTD_New_Clt_Aquired_sub_broker] VARCHAR(100) NULL,
    [MTD_New_Clt_Aquired_TAGGenerateddate] VARCHAR(20) NULL,
    [MTD_New_Clt_Aquired] INT NULL,
    [YTD_New_Clt_Aquired_sub_broker] VARCHAR(100) NULL,
    [YTD_New_Clt_Aquired_TAGGenerateddate] VARCHAR(20) NULL,
    [YTD_New_Clt_Aquired] INT NULL,
    [MTD_Traded_Client_sub_broker] VARCHAR(100) NULL,
    [MTD_Traded_Client_TAGGenerateddate] VARCHAR(20) NULL,
    [MTD_Traded_Client] INT NULL,
    [YTD_Traded_Client_sub_broker] VARCHAR(100) NULL,
    [YTD_Traded_Client_TAGGenerateddate] VARCHAR(20) NULL,
    [YTD_Traded_Client] INT NULL,
    [MTD_Gross_Revenue_sub_broker] VARCHAR(100) NULL,
    [MTD_Gross_Revenue_TAGGenerateddate] VARCHAR(20) NULL,
    [MTD_Gross_Revenue] NUMERIC(18, 4) NULL,
    [YTD_Gross_Revenue_sub_broker] VARCHAR(100) NULL,
    [YTD_Gross_Revenue_TAGGenerateddate] VARCHAR(20) NULL,
    [YTD_Gross_Revenue] NUMERIC(18, 4) NULL,
    [MF_AUM_sub_broker] VARCHAR(100) NULL,
    [MF_AUM_TAGGenerateddate] VARCHAR(20) NULL,
    [MF_AUM] NUMERIC(18, 4) NULL,
    [Active_Clients_sub_broker] VARCHAR(100) NULL,
    [Active_Clients_TAGGenerateddate] VARCHAR(20) NULL,
    [Active_Clients] INT NULL,
    [MF_Active_Clients_sub_broker] VARCHAR(100) NULL,
    [MF_Active_Clients_TAGGenerateddate] VARCHAR(20) NULL,
    [MF_Active_Clients] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IntSummary
-- --------------------------------------------------
CREATE TABLE [dbo].[IntSummary]
(
    [CLTCODE] VARCHAR(10) NULL,
    [PERIOD] VARCHAR(50) NULL,
    [INT_AMT] NUMERIC(18, 2) NULL,
    [LONG_NAME] VARCHAR(100) NULL,
    [INT_PER] NUMERIC(19, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IPartner_ClientImages
-- --------------------------------------------------
CREATE TABLE [dbo].[IPartner_ClientImages]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PartyCode] VARCHAR(50) NOT NULL,
    [Image] VARCHAR(MAX) NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IPartner_ScripTicker
-- --------------------------------------------------
CREATE TABLE [dbo].[IPartner_ScripTicker]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [CoCode] INT NULL,
    [SubBroker] VARCHAR(10) NOT NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.IPODocumentUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[IPODocumentUpload]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [ContentType] VARCHAR(50) NOT NULL,
    [FileName] VARCHAR(200) NOT NULL,
    [FilePath] VARCHAR(2000) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [LastUpdate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [IsDeleted] BIT NULL,
    [DeletedBy] VARCHAR(200) NULL,
    [IsActive] BIT NULL,
    [OrderIndex] TINYINT NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [IPOSrNo] INT NULL,
    [ServerFilePath] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting
-- --------------------------------------------------
CREATE TABLE [dbo].[iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting]
(
    [ClientCode] VARCHAR(10) NOT NULL,
    [SBCODE] VARCHAR(10) NOT NULL,
    [Branchcode] VARCHAR(10) NULL,
    [clienttype] CHAR(1) NULL,
    [Startofmonth] DATETIME NOT NULL,
    [activefrom] DATETIME NULL,
    [InActiveFrom] DATETIME NULL,
    [angelclrating] CHAR(10) NULL,
    [InitialMargin] MONEY NULL,
    [Noofdaystraded] INT NULL,
    [availabletradedays] INT NULL,
    [NetBrokRev] MONEY NULL,
    [neteq] MONEY NULL,
    [netfo] MONEY NULL,
    [netcommcurr] MONEY NULL,
    [netonlinebrok] MONEY NULL,
    [GrossBrokRev] MONEY NULL,
    [grosseq] MONEY NULL,
    [grossdeleq] MONEY NULL,
    [grosstrdeq] MONEY NULL,
    [grossfo] MONEY NULL,
    [grosscommcurr] MONEY NULL,
    [grossonlinebrok] MONEY NULL,
    [Turnover] MONEY NULL,
    [TOdeleq] MONEY NULL,
    [TOtrdeq] MONEY NULL,
    [TOfo] MONEY NULL,
    [TOcommcurr] MONEY NULL,
    [TOonline] MONEY NULL,
    [Dealercode] VARCHAR(20) NULL,
    [CommDealer1] VARCHAR(20) NULL,
    [CommDealer2] VARCHAR(20) NULL,
    [Noofdaystradedcash] INT NULL,
    [NoofdaystradedFNO] INT NULL,
    [NoofdaystradedEq] INT NULL,
    [NoofdaystradedComm] INT NULL,
    [NoofdaystradedCurr] INT NULL,
    [NoofdaystradedCommcurr] INT NULL,
    [GrossFut] MONEY NULL,
    [GrossOpt] MONEY NULL,
    [TOFut] MONEY NULL,
    [TOOpt] MONEY NULL,
    [NetFut] MONEY NULL,
    [NetOpt] MONEY NULL,
    [NetComm] MONEY NULL,
    [NetCurr] MONEY NULL,
    [GrossComm] MONEY NULL,
    [GrossCurr] MONEY NULL,
    [TOComm] MONEY NULL,
    [TOCurr] MONEY NULL,
    [Netdeleq] MONEY NULL,
    [Nettrdeq] MONEY NULL,
    [Noofdaystradeddeleq] INT NULL,
    [Noofdaystradedtrdeq] INT NULL,
    [Noofdaystradedfut] INT NULL,
    [Noofdaystradedopt] INT NULL,
    [NoofdaystradedOnline] INT NULL,
    [NoofdaystradedOffline] INT NULL,
    [Sub_Broker] VARCHAR(500) NULL,
    [Category] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[iSpc_Master_SCard_partyinfobrokmonthwise_For_BussConsulting_Prev]
(
    [ClientCode] VARCHAR(10) NOT NULL,
    [SBCODE] VARCHAR(10) NOT NULL,
    [Branchcode] VARCHAR(10) NULL,
    [clienttype] CHAR(1) NULL,
    [Startofmonth] DATETIME NOT NULL,
    [activefrom] DATETIME NULL,
    [InActiveFrom] DATETIME NULL,
    [angelclrating] CHAR(10) NULL,
    [InitialMargin] MONEY NULL,
    [Noofdaystraded] INT NULL,
    [availabletradedays] INT NULL,
    [NetBrokRev] MONEY NULL,
    [neteq] MONEY NULL,
    [netfo] MONEY NULL,
    [netcommcurr] MONEY NULL,
    [netonlinebrok] MONEY NULL,
    [GrossBrokRev] MONEY NULL,
    [grosseq] MONEY NULL,
    [grossdeleq] MONEY NULL,
    [grosstrdeq] MONEY NULL,
    [grossfo] MONEY NULL,
    [grosscommcurr] MONEY NULL,
    [grossonlinebrok] MONEY NULL,
    [Turnover] MONEY NULL,
    [TOdeleq] MONEY NULL,
    [TOtrdeq] MONEY NULL,
    [TOfo] MONEY NULL,
    [TOcommcurr] MONEY NULL,
    [TOonline] MONEY NULL,
    [Dealercode] VARCHAR(20) NULL,
    [CommDealer1] VARCHAR(20) NULL,
    [CommDealer2] VARCHAR(20) NULL,
    [Noofdaystradedcash] INT NULL,
    [NoofdaystradedFNO] INT NULL,
    [NoofdaystradedEq] INT NULL,
    [NoofdaystradedComm] INT NULL,
    [NoofdaystradedCurr] INT NULL,
    [NoofdaystradedCommcurr] INT NULL,
    [GrossFut] MONEY NULL,
    [GrossOpt] MONEY NULL,
    [TOFut] MONEY NULL,
    [TOOpt] MONEY NULL,
    [NetFut] MONEY NULL,
    [NetOpt] MONEY NULL,
    [NetComm] MONEY NULL,
    [NetCurr] MONEY NULL,
    [GrossComm] MONEY NULL,
    [GrossCurr] MONEY NULL,
    [TOComm] MONEY NULL,
    [TOCurr] MONEY NULL,
    [Netdeleq] MONEY NULL,
    [Nettrdeq] MONEY NULL,
    [Noofdaystradeddeleq] INT NULL,
    [Noofdaystradedtrdeq] INT NULL,
    [Noofdaystradedfut] INT NULL,
    [Noofdaystradedopt] INT NULL,
    [NoofdaystradedOnline] INT NULL,
    [NoofdaystradedOffline] INT NULL,
    [Sub_Broker] VARCHAR(500) NULL,
    [Category] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ItradeNXTForMail
-- --------------------------------------------------
CREATE TABLE [dbo].[ItradeNXTForMail]
(
    [party_code] VARCHAR(8000) NULL,
    [Sub_broker] VARCHAR(50) NULL,
    [createdDate] DATE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ItradeSMS_log
-- --------------------------------------------------
CREATE TABLE [dbo].[ItradeSMS_log]
(
    [to_no] VARCHAR(50) NOT NULL,
    [message] VARCHAR(500) NULL,
    [date] VARCHAR(20) NULL,
    [time] VARCHAR(20) NULL,
    [flag] VARCHAR(2) NULL,
    [ampm] VARCHAR(3) NULL,
    [purpose] VARCHAR(100) NULL,
    [status] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IWMF_trn_current_holding
-- --------------------------------------------------
CREATE TABLE [dbo].[IWMF_trn_current_holding]
(
    [AsOnDate] DATE NULL,
    [party_Code] VARCHAR(20) NULL,
    [fund_code] VARCHAR(15) NULL,
    [scheme_code] VARCHAR(100) NULL,
    [folio_no] VARCHAR(100) NULL,
    [AMFI_Code] VARCHAR(25) NULL,
    [DPFlag] VARCHAR(50) NULL,
    [Angel_Qty] DECIMAL(18, 6) NULL,
    [Actual_Qty] DECIMAL(18, 6) NULL,
    [avg_rate] DECIMAL(18, 4) NULL,
    [UpdateTime] DATETIME NULL,
    [fsSchemeCode] VARCHAR(20) NULL,
    [MapID] BIGINT NULL,
    [ProductID] INT NULL,
    [RedeemableUnit] NUMERIC(18, 6) NULL,
    [isElssData] INT NULL,
    [SchemeName] VARCHAR(200) NULL,
    [ISIN] VARCHAR(20) NULL,
    [LastNAVPrice] DECIMAL(13, 4) NULL,
    [LastNAVDate] DATE NULL,
    [PrevNAV] DECIMAL(13, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IWMF_trn_current_holding_Folio
-- --------------------------------------------------
CREATE TABLE [dbo].[IWMF_trn_current_holding_Folio]
(
    [AsOnDate] DATE NULL,
    [party_Code] VARCHAR(20) NULL,
    [fund_code] VARCHAR(15) NULL,
    [scheme_code] VARCHAR(100) NULL,
    [folio_no] VARCHAR(100) NULL,
    [AMFI_Code] VARCHAR(25) NULL,
    [DPFlag] VARCHAR(50) NULL,
    [Angel_Qty] DECIMAL(18, 6) NULL,
    [Actual_Qty] DECIMAL(18, 6) NULL,
    [avg_rate] DECIMAL(18, 4) NULL,
    [UpdateTime] DATETIME NULL,
    [fsSchemeCode] VARCHAR(20) NULL,
    [MapID] BIGINT NULL,
    [ProductID] INT NULL,
    [RedeemableUnit] NUMERIC(18, 6) NULL,
    [isElssData] INT NULL,
    [SchemeName] VARCHAR(200) NULL,
    [ISIN] VARCHAR(20) NULL,
    [LastNAVPrice] DECIMAL(13, 4) NULL,
    [LastNAVDate] DATE NULL,
    [PrevNAV] DECIMAL(13, 4) NULL,
    [RedeemableUnit_withoutPledge] NUMERIC(18, 6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IWMF_trn_current_holding_Folio_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[IWMF_trn_current_holding_Folio_Prev]
(
    [AsOnDate] DATE NULL,
    [party_Code] VARCHAR(20) NULL,
    [fund_code] VARCHAR(15) NULL,
    [scheme_code] VARCHAR(100) NULL,
    [folio_no] VARCHAR(100) NULL,
    [AMFI_Code] VARCHAR(25) NULL,
    [DPFlag] VARCHAR(50) NULL,
    [Angel_Qty] DECIMAL(18, 6) NULL,
    [Actual_Qty] DECIMAL(18, 6) NULL,
    [avg_rate] DECIMAL(18, 4) NULL,
    [UpdateTime] DATETIME NULL,
    [fsSchemeCode] VARCHAR(20) NULL,
    [MapID] BIGINT NULL,
    [ProductID] INT NULL,
    [RedeemableUnit] NUMERIC(18, 6) NULL,
    [isElssData] INT NULL,
    [SchemeName] VARCHAR(200) NULL,
    [ISIN] VARCHAR(20) NULL,
    [LastNAVPrice] DECIMAL(13, 4) NULL,
    [LastNAVDate] DATE NULL,
    [PrevNAV] DECIMAL(13, 4) NULL,
    [RedeemableUnit_withoutPledge] NUMERIC(18, 6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IWMF_trn_current_holding_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[IWMF_trn_current_holding_Prev]
(
    [AsOnDate] DATE NULL,
    [party_Code] VARCHAR(20) NULL,
    [fund_code] VARCHAR(15) NULL,
    [scheme_code] VARCHAR(100) NULL,
    [folio_no] VARCHAR(100) NULL,
    [AMFI_Code] VARCHAR(25) NULL,
    [DPFlag] VARCHAR(50) NULL,
    [Angel_Qty] NUMERIC(18, 6) NULL,
    [Actual_Qty] NUMERIC(18, 6) NULL,
    [avg_rate] NUMERIC(18, 4) NULL,
    [UpdateTime] DATETIME NULL,
    [fsSchemeCode] VARCHAR(20) NULL,
    [MapID] BIGINT NULL,
    [ProductID] INT NULL,
    [RedeemableUnit] NUMERIC(18, 6) NULL,
    [isElssData] INT NULL,
    [SchemeName] VARCHAR(200) NULL,
    [ISIN] VARCHAR(20) NULL,
    [LastNAVPrice] NUMERIC(13, 4) NULL,
    [LastNAVDate] DATE NULL,
    [PrevNAV] NUMERIC(13, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.job_StatusNXT_log
-- --------------------------------------------------
CREATE TABLE [dbo].[job_StatusNXT_log]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [JobName] VARCHAR(100) NULL,
    [Modulename] VARCHAR(100) NULL,
    [UpdateTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LatestNavDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[LatestNavDetails]
(
    [SchemeCode] VARCHAR(16) NULL,
    [NavDate] DATETIME NULL,
    [NAVAmt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ledger_Final_Urgent
-- --------------------------------------------------
CREATE TABLE [dbo].[Ledger_Final_Urgent]
(
    [party_code] VARCHAR(100) NULL,
    [Legder] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ledger_merge_final
-- --------------------------------------------------
CREATE TABLE [dbo].[ledger_merge_final]
(
    [""] VARCHAR(50) NULL,
    ["party_code"] VARCHAR(50) NULL,
    ["total_ledger"] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LedgerBal
-- --------------------------------------------------
CREATE TABLE [dbo].[LedgerBal]
(
    [SubBroker] VARCHAR(50) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Ledger] NUMERIC(17, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LedgerBalance
-- --------------------------------------------------
CREATE TABLE [dbo].[LedgerBalance]
(
    [PartyCode] VARCHAR(50) NULL,
    [Name] VARCHAR(500) NULL,
    [CashBalance] NUMERIC(17, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LMS_registration
-- --------------------------------------------------
CREATE TABLE [dbo].[LMS_registration]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SB_Code] VARCHAR(50) NULL,
    [Message] VARCHAR(100) NULL,
    [Status] VARCHAR(10) NULL,
    [Created_dt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MandateFailed
-- --------------------------------------------------
CREATE TABLE [dbo].[MandateFailed]
(
    [sClientCode] NVARCHAR(255) NULL,
    [sUserRefNo] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mandatenotgenerated
-- --------------------------------------------------
CREATE TABLE [dbo].[Mandatenotgenerated]
(
    [sClientCode] NVARCHAR(255) NULL,
    [sUserRefNo] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MARGIN_Accural
-- --------------------------------------------------
CREATE TABLE [dbo].[MARGIN_Accural]
(
    [Party_code] VARCHAR(100) NULL,
    [SHORTAGE] NUMERIC(18, 2) NULL,
    [Penalty_Amt] NUMERIC(18, 2) NULL,
    [Margin_Date] DATETIME NULL,
    [Exchnage] VARCHAR(100) NULL,
    [PENALTY_PERC] NUMERIC(18, 6) NULL,
    [DAYS_3_COUNT] INT NULL,
    [MONTH_5_COUNT] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MARGIN_Accural_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[MARGIN_Accural_Prev]
(
    [Party_code] VARCHAR(100) NULL,
    [SHORTAGE] NUMERIC(18, 2) NULL,
    [Penalty_Amt] NUMERIC(18, 2) NULL,
    [Margin_Date] DATETIME NULL,
    [Exchnage] VARCHAR(100) NULL,
    [PENALTY_PERC] NUMERIC(18, 6) NULL,
    [DAYS_3_COUNT] INT NULL,
    [MONTH_5_COUNT] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Masters
-- --------------------------------------------------
CREATE TABLE [dbo].[Masters]
(
    [Srno] INT IDENTITY(1,1) NOT NULL,
    [IPOName] VARCHAR(75) NOT NULL,
    [ISIN] VARCHAR(75) NULL,
    [SyndicateMemberStampName] VARCHAR(300) NULL,
    [SyndicateMemberStampCode] VARCHAR(300) NULL,
    [Broker_SCSB_CDP_RTAStampName] VARCHAR(300) NULL,
    [Broker_SCSB_CDP_RTAStampCode] VARCHAR(300) NULL,
    [Subbrokers_SubAgentsStampName] VARCHAR(300) NULL,
    [Subbrokers_SubAgentsStampCode] VARCHAR(300) NULL,
    [SCBBranchStampName] VARCHAR(300) NULL,
    [SCBBranchStampCode] VARCHAR(300) NULL,
    [IPOStartdate] DATETIME NULL,
    [IPOEnddate] DATETIME NULL,
    [FormStartNo] DECIMAL(15, 0) NULL,
    [FormEndNo] DECIMAL(15, 0) NULL,
    [Lowervalue] MONEY NULL,
    [Uppervalue] MONEY NULL,
    [Imageurl] VARCHAR(75) NULL,
    [updatedon] DATETIME NULL,
    [updatedby] VARCHAR(30) NULL,
    [No_Of_Shares] VARCHAR(100) NULL,
    [Price] VARCHAR(100) NULL,
    [DISCOUNT] MONEY NULL,
    [IPOShortName] VARCHAR(100) NULL,
    [MultipleUnitValue] VARCHAR(100) NULL,
    [MaxTotalAmt] VARCHAR(1000) NULL,
    [IPO_STATUS] VARCHAR(10) NULL,
    [BID_STATUS] VARCHAR(10) NULL,
    [OfferType] VARCHAR(300) NULL,
    [IPOType] VARCHAR(500) NULL,
    [FaceValue] VARCHAR(200) NULL,
    [MinimumLotQty] VARCHAR(200) NULL,
    [TotalIssueAmount] VARCHAR(200) NULL,
    [TotalIssueQty] VARCHAR(100) NULL,
    [MaximumBidQtyLot] VARCHAR(100) NULL,
    [DiscountFlag] VARCHAR(10) NULL,
    [AngelRecommendation] VARCHAR(100) NULL,
    [StartTime] VARCHAR(10) NULL,
    [EndTime] VARCHAR(10) NULL,
    [IPO_LiveDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Menu
-- --------------------------------------------------
CREATE TABLE [dbo].[Menu]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Name] VARCHAR(100) NOT NULL,
    [Controller] VARCHAR(100) NOT NULL,
    [Action] VARCHAR(100) NOT NULL,
    [Active] BIT NOT NULL DEFAULT ((1)),
    [Createdby] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL,
    [IsAccessRequired] BIT NULL DEFAULT ((1)),
    [ParentId] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Menu_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Menu_Temp]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Name] VARCHAR(100) NOT NULL,
    [Controller] VARCHAR(100) NOT NULL,
    [Action] VARCHAR(100) NOT NULL,
    [Active] BIT NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MF_DB_Logs
-- --------------------------------------------------
CREATE TABLE [dbo].[MF_DB_Logs]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Event] NVARCHAR(100) NULL,
    [ModuleName] NVARCHAR(500) NULL,
    [ClassName] NVARCHAR(500) NULL,
    [MethodName] NVARCHAR(500) NULL,
    [SPName] NVARCHAR(500) NULL,
    [DB] NVARCHAR(500) NULL,
    [Server] NVARCHAR(100) NULL,
    [Request] NVARCHAR(MAX) NULL,
    [TimeTaken] BIGINT NULL,
    [ErrorMsg] NVARCHAR(MAX) NULL,
    [StackTrace] NVARCHAR(MAX) NULL,
    [IP] NVARCHAR(100) NULL,
    [CreatedBy] NVARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MF_LED_SUM
-- --------------------------------------------------
CREATE TABLE [dbo].[MF_LED_SUM]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [DEBIT_BALANCE] NUMERIC(18, 2) NULL,
    [CREDIT_BALANCE] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MF_NXT_forget_pwd_log
-- --------------------------------------------------
CREATE TABLE [dbo].[MF_NXT_forget_pwd_log]
(
    [date_time] DATETIME NULL,
    [pc_ip_name] VARCHAR(50) NULL,
    [username] VARCHAR(50) NULL,
    [password1] VARCHAR(50) NULL,
    [message] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MFNonPOARedemptionInfo
-- --------------------------------------------------
CREATE TABLE [dbo].[MFNonPOARedemptionInfo]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [PartyCode] VARCHAR(50) NULL,
    [SBTag] VARCHAR(30) NULL,
    [RedemptionLink] VARCHAR(200) NULL,
    [RequestId] VARCHAR(100) NULL,
    [TransactionRefNumber] VARCHAR(150) NULL,
    [UserType] VARCHAR(50) NULL,
    [LinkStatus] INT NULL,
    [CreatedDate] DATETIME NULL,
    [OrderType] VARCHAR(50) NULL,
    [Quantity] VARCHAR(10) NULL,
    [ISIN] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MFNXTSBLogin
-- --------------------------------------------------
CREATE TABLE [dbo].[MFNXTSBLogin]
(
    [userid] INT IDENTITY(1,1) NOT NULL,
    [person_name] VARCHAR(100) NULL,
    [username] VARCHAR(20) NULL,
    [userpassword] VARCHAR(20) NULL,
    [usertype] VARCHAR(50) NULL,
    [access_to] VARCHAR(50) NULL,
    [access_code] VARCHAR(50) NULL,
    [cat_code] INT NULL,
    [status] INT NULL,
    [last_login] DATETIME NULL,
    [NoOfTry] INT NULL,
    [NoOfLogin] INT NULL,
    [login_Activated] DATETIME NULL,
    [login_inactive_date] DATETIME NULL,
    [active] VARCHAR(10) NULL,
    [email] VARCHAR(100) NULL,
    [IP] VARCHAR(500) NULL,
    [IP_active] VARCHAR(10) NULL,
    [Gateway] VARCHAR(50) NULL,
    [Gateway_active] VARCHAR(50) NULL,
    [session_id] VARCHAR(100) NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [CreatedOn] VARCHAR(50) NULL,
    [LastModifiedBy] VARCHAR(50) NULL,
    [LastModifiedOn] VARCHAR(50) NULL,
    [SB_Broker_Type] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MFSB_Mapping_Weekly
-- --------------------------------------------------
CREATE TABLE [dbo].[MFSB_Mapping_Weekly]
(
    [SBTag] VARCHAR(100) NULL,
    [Region] VARCHAR(100) NULL,
    [BranchTag] VARCHAR(100) NULL,
    [BDMName] VARCHAR(100) NULL,
    [BDMCode] VARCHAR(100) NULL,
    [EmailAdd] VARCHAR(500) NULL,
    [MobileNumber] VARCHAR(100) NULL,
    [AHName] VARCHAR(100) NULL,
    [AHCode] VARCHAR(100) NULL,
    [EmailID] VARCHAR(500) NULL,
    [Number] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mfss_ledger_bse
-- --------------------------------------------------
CREATE TABLE [dbo].[mfss_ledger_bse]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] DATETIME NULL,
    [EDT] DATETIME NULL,
    [DRAMOUNT] NUMERIC(18, 2) NULL,
    [CRAMOUNT] NUMERIC(18, 2) NULL,
    [VNO] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mfss_ledger_bse_Ipartner
-- --------------------------------------------------
CREATE TABLE [dbo].[mfss_ledger_bse_Ipartner]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] DATETIME NULL,
    [EDT] DATETIME NULL,
    [DRAMOUNT] NUMERIC(18, 2) NULL,
    [CRAMOUNT] NUMERIC(18, 2) NULL,
    [VNO] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mfss_ledger_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[mfss_ledger_nse]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] DATETIME NULL,
    [EDT] DATETIME NULL,
    [DRAMOUNT] NUMERIC(18, 2) NULL,
    [CRAMOUNT] NUMERIC(18, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mfss_ledger_nse_Ipartner
-- --------------------------------------------------
CREATE TABLE [dbo].[mfss_ledger_nse_Ipartner]
(
    [CLTCODE] VARCHAR(100) NULL,
    [VDT] DATETIME NULL,
    [EDT] DATETIME NULL,
    [DRAMOUNT] NUMERIC(18, 2) NULL,
    [CRAMOUNT] NUMERIC(18, 2) NULL,
    [VNO] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MFSS_REL_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[MFSS_REL_DATA]
(
    [party_code] VARCHAR(100) NULL,
    [RELDT_DR] DATETIME NULL,
    [RELDT_CR] DATETIME NULL,
    [VTYPE] VARCHAR(5) NULL,
    [DRAMOUNT] NUMERIC(10, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mis_to
-- --------------------------------------------------
CREATE TABLE [dbo].[mis_to]
(
    [sub_broker] VARCHAR(20) NULL,
    [LastTradeDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.missing_NOC_SB
-- --------------------------------------------------
CREATE TABLE [dbo].[missing_NOC_SB]
(
    [Party_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [BRANCH_CODE_NEW] VARCHAR(10) NULL,
    [sub_broker_NEW] VARCHAR(10) NULL,
    [UPDATE_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mtf_Holding
-- --------------------------------------------------
CREATE TABLE [dbo].[Mtf_Holding]
(
    [Party_code] VARCHAR(100) NULL,
    [Mtf_Holding] NUMERIC(20, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mtf_Holding_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[Mtf_Holding_Prev]
(
    [Party_code] VARCHAR(100) NULL,
    [Mtf_Holding] NUMERIC(20, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_STATUS
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_STATUS]
(
    [Party_Code] VARCHAR(10) NOT NULL,
    [FROM_DATE] DATETIME NOT NULL,
    [MTFSTATUS] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTF_STATUS_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[MTF_STATUS_Prev]
(
    [Party_Code] VARCHAR(10) NOT NULL,
    [FROM_DATE] DATETIME NOT NULL,
    [MTFSTATUS] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTM_CLIENTS
-- --------------------------------------------------
CREATE TABLE [dbo].[MTM_CLIENTS]
(
    [PARTY_CODE] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MTM_CLIENTS_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[MTM_CLIENTS_Prev]
(
    [PARTY_CODE] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multilocation_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[multilocation_Log]
(
    [sub_broker] VARCHAR(100) NULL,
    [EntryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultilocationSBTags
-- --------------------------------------------------
CREATE TABLE [dbo].[MultilocationSBTags]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultilocationSBTags_Bkp10Feb2021
-- --------------------------------------------------
CREATE TABLE [dbo].[MultilocationSBTags_Bkp10Feb2021]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultilocationSBTags_Bkp18March2021
-- --------------------------------------------------
CREATE TABLE [dbo].[MultilocationSBTags_Bkp18March2021]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MultilocationSBTags_Bkp18March21
-- --------------------------------------------------
CREATE TABLE [dbo].[MultilocationSBTags_Bkp18March21]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mytask_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[Mytask_Mobile_2]
(
    [TaskId] INT IDENTITY(1,1) NOT NULL,
    [Sub_broker] VARCHAR(100) NULL,
    [Employeeid] VARCHAR(100) NULL,
    [Mytask] CHAR(1) NULL,
    [Title] VARCHAR(100) NULL,
    [DueBy] VARCHAR(200) NULL,
    [TaskDescription] VARCHAR(MAX) NULL,
    [Type] VARCHAR(100) NULL,
    [Priority] VARCHAR(100) NULL,
    [RedirectionURL] VARCHAR(MAX) NULL,
    [Occurance] VARCHAR(100) NULL,
    [OccuranceText] VARCHAR(100) NULL,
    [AudioPath] VARCHAR(MAX) NULL,
    [StartDate] DATETIME NULL,
    [EndDate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mytask_Mobile_2_AssignTo
-- --------------------------------------------------
CREATE TABLE [dbo].[Mytask_Mobile_2_AssignTo]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [TaskId] INT NULL,
    [Sub_broker] VARCHAR(100) NULL,
    [assignedTo] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mytask_Mobile_2_Tagging
-- --------------------------------------------------
CREATE TABLE [dbo].[Mytask_Mobile_2_Tagging]
(
    [TaggingId] INT IDENTITY(1,1) NOT NULL,
    [TaskId] INT NULL,
    [Sub_broker] VARCHAR(100) NULL,
    [Type] VARCHAR(100) NULL,
    [TagTo] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Client_wise_log
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Client_wise_log]
(
    [Date] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_Bkp03Feb2023
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_Bkp03Feb2023]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_bkp03Feb2023_9_27PM
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_bkp03Feb2023_9_27PM]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_bkp10Feb2023
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_bkp10Feb2023]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_Bkp10May2023
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_Bkp10May2023]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_Bkp19July2023
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_Bkp19July2023]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_testing
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_testing]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_Clientwise_log_testing1
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_Clientwise_log_testing1]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [party_code] VARCHAR(20) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] VARCHAR(20) NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [Date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_log
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_log]
(
    [UpdateDate] DATE NULL,
    [SUB_BROKER] VARCHAR(100) NULL,
    [Amount] NUMERIC(18, 2) NULL,
    [Segment] VARCHAR(10) NULL,
    [Naturecode] VARCHAR(10) NULL,
    [Narration] VARCHAR(1000) NULL,
    [TDS] VARCHAR(10) NULL,
    [GST] VARCHAR(100) NULL,
    [entryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_log_Bkp03Feb2023
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_log_Bkp03Feb2023]
(
    [UpdateDate] DATE NULL,
    [SUB_BROKER] VARCHAR(100) NULL,
    [Amount] NUMERIC(18, 2) NULL,
    [Segment] VARCHAR(10) NULL,
    [Naturecode] VARCHAR(10) NULL,
    [Narration] VARCHAR(1000) NULL,
    [TDS] VARCHAR(10) NULL,
    [GST] VARCHAR(100) NULL,
    [entryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_log_Bkp10Feb2023
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_log_Bkp10Feb2023]
(
    [UpdateDate] DATE NULL,
    [SUB_BROKER] VARCHAR(100) NULL,
    [Amount] NUMERIC(18, 2) NULL,
    [Segment] VARCHAR(10) NULL,
    [Naturecode] VARCHAR(10) NULL,
    [Narration] VARCHAR(1000) NULL,
    [TDS] VARCHAR(10) NULL,
    [GST] VARCHAR(100) NULL,
    [entryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.noc_credit_debit_One_Mail_Sent
-- --------------------------------------------------
CREATE TABLE [dbo].[noc_credit_debit_One_Mail_Sent]
(
    [UpdateDate] DATE NULL,
    [SUB_BROKER] VARCHAR(100) NULL,
    [Amount] NUMERIC(18, 2) NULL,
    [Segment] VARCHAR(10) NULL,
    [Naturecode] VARCHAR(10) NULL,
    [Narration] VARCHAR(1000) NULL,
    [TDS] VARCHAR(10) NULL,
    [GST] VARCHAR(100) NULL,
    [entryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NOC_InHouse_SB_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[NOC_InHouse_SB_Master]
(
    [subbroker] VARCHAR(100) NULL,
    [EntryBy] VARCHAR(100) NULL,
    [EntryDate] DATETIME NULL,
    [Active] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Noc_logs
-- --------------------------------------------------
CREATE TABLE [dbo].[Noc_logs]
(
    [Party_Code] VARCHAR(100) NULL,
    [sub_broker] VARCHAR(100) NULL,
    [RequestTime] DATETIME NULL,
    [DeletionTime] DATETIME NULL,
    [Remarks] VARCHAR(MAX) NULL,
    [Ipadress] VARCHAR(100) NULL,
    [EntryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NotificationBeeNXT_MasterList
-- --------------------------------------------------
CREATE TABLE [dbo].[NotificationBeeNXT_MasterList]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Modulename] VARCHAR(1000) NULL,
    [URL] VARCHAR(MAX) NULL,
    [area] VARCHAR(200) NULL,
    [Controller] VARCHAR(200) NULL,
    [action] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NotificationDeleteLog_NXT
-- --------------------------------------------------
CREATE TABLE [dbo].[NotificationDeleteLog_NXT]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [CampaignId] NVARCHAR(100) NOT NULL,
    [NotificationType] NVARCHAR(70) NOT NULL,
    [NotificationText] NVARCHAR(MAX) NOT NULL,
    [DeletedBy] NVARCHAR(200) NOT NULL,
    [DeletedDateTime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NotificationNXT_MasterList
-- --------------------------------------------------
CREATE TABLE [dbo].[NotificationNXT_MasterList]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Modulename] VARCHAR(1000) NULL,
    [URL] VARCHAR(MAX) NULL,
    [area] VARCHAR(200) NULL,
    [Controller] VARCHAR(200) NULL,
    [action] VARCHAR(200) NULL,
    [Active] BIT NOT NULL DEFAULT ((1)),
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL,
    [QueryParameter] VARCHAR(500) NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NudgeFileData
-- --------------------------------------------------
CREATE TABLE [dbo].[NudgeFileData]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Name] VARCHAR(200) NOT NULL DEFAULT '',
    [RedirectURL] VARCHAR(200) NOT NULL DEFAULT '',
    [FileName] VARCHAR(200) NOT NULL DEFAULT '',
    [FilePath] VARCHAR(MAX) NOT NULL DEFAULT '',
    [ProjectType] VARCHAR(50) NOT NULL DEFAULT '',
    [CreatedBy] VARCHAR(50) NOT NULL DEFAULT '',
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [ExpiryDate] DATE NOT NULL,
    [IsActive] BIT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXT_HistoryUserLogin
-- --------------------------------------------------
CREATE TABLE [dbo].[NXT_HistoryUserLogin]
(
    [Row_id] INT NULL,
    [Access_code] VARCHAR(30) NULL,
    [Username] VARCHAR(30) NULL,
    [Login_count] INT NULL,
    [Last_login] DATETIME NULL,
    [EnterDate] DATE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXT_UserLogin
-- --------------------------------------------------
CREATE TABLE [dbo].[NXT_UserLogin]
(
    [Row_id] INT IDENTITY(1,1) NOT NULL,
    [Access_code] VARCHAR(30) NULL,
    [Username] VARCHAR(30) NULL,
    [Login_count] INT NULL,
    [Last_login] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTCommunicationGroupMapping
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTCommunicationGroupMapping]
(
    [Clientid] VARCHAR(200) NULL,
    [Groupid] INT NULL,
    [isdelete] BIT NOT NULL DEFAULT ((0)),
    [deleted_at] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTCommunicationGroupMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTCommunicationGroupMaster]
(
    [GroupId] INT IDENTITY(1,1) NOT NULL,
    [Sub_broker] VARCHAR(100) NULL,
    [GroupName] VARCHAR(1000) NULL,
    [Type] VARCHAR(10) NULL,
    [CreateDate] DATETIME NULL,
    [CreateBy] VARCHAR(1000) NULL,
    [isdelete] BIT NOT NULL DEFAULT ((0)),
    [deleted_at] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTFamilyGroup
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTFamilyGroup]
(
    [GroupId] INT IDENTITY(1,1) NOT NULL,
    [sb_Broker] VARCHAR(100) NULL,
    [GroupName] VARCHAR(1000) NULL,
    [Active] INT NULL DEFAULT ((1)),
    [CreateDate] DATETIME NULL,
    [CreateBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTFamilyGroup_Bkp06Apr2022
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTFamilyGroup_Bkp06Apr2022]
(
    [GroupId] INT IDENTITY(1,1) NOT NULL,
    [sb_Broker] VARCHAR(100) NULL,
    [GroupName] VARCHAR(1000) NULL,
    [Active] INT NULL,
    [CreateDate] DATETIME NULL,
    [CreateBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTFamilyGroupMembers
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTFamilyGroupMembers]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [sb_Broker] VARCHAR(100) NULL,
    [ClientId] VARCHAR(100) NULL,
    [IsPrimary] INT NULL,
    [GroupId] INT NULL,
    [Relation] VARCHAR(100) NULL,
    [Active] INT NULL DEFAULT ((1)),
    [CreateDate] DATETIME NULL,
    [CreateBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTFamilyGroupMembers_Bkp06Apr2022
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTFamilyGroupMembers_Bkp06Apr2022]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [sb_Broker] VARCHAR(100) NULL,
    [ClientId] VARCHAR(100) NULL,
    [IsPrimary] INT NULL,
    [GroupId] INT NULL,
    [Relation] VARCHAR(100) NULL,
    [Active] INT NULL,
    [CreateDate] DATETIME NULL,
    [CreateBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NXTMobilePopUpLog
-- --------------------------------------------------
CREATE TABLE [dbo].[NXTMobilePopUpLog]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Popup_Id] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL,
    [CreatedBy] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersCriteriaMaster_Loan
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersCriteriaMaster_Loan]
(
    [CriteriaId] INT IDENTITY(1,1) NOT NULL,
    [CriteriaType] VARCHAR(100) NOT NULL,
    [OfferId] INT NOT NULL,
    [CriteriaAmountFrom1] VARCHAR(100) NOT NULL,
    [CriteriaAmountTo1] VARCHAR(100) NOT NULL,
    [ScratchCardAmount1] FLOAT NOT NULL,
    [CriteriaAmountFrom2] VARCHAR(100) NOT NULL,
    [CriteriaAmountTo2] VARCHAR(100) NOT NULL,
    [ScratchCardAmount2] FLOAT NOT NULL,
    [CriteriaAmountFrom3] VARCHAR(100) NOT NULL,
    [CriteriaAmountTo3] VARCHAR(100) NOT NULL,
    [ScratchCardAmount3] FLOAT NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [ModifiedDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersKycMilestones
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersKycMilestones]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [CriteriaId] BIGINT NOT NULL,
    [MilestoneCount] INT NOT NULL,
    [RewardImagePath] VARCHAR(MAX) NOT NULL,
    [IsActive] BIT NOT NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdateDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersMaster]
(
    [OfferId] INT IDENTITY(1,1) NOT NULL,
    [CampaignId] VARCHAR(300) NOT NULL,
    [OfferName] VARCHAR(300) NOT NULL,
    [OfferImageName] VARCHAR(500) NULL,
    [OfferImagePath] VARCHAR(500) NOT NULL,
    [StartDate] DATE NOT NULL,
    [EndDate] DATE NOT NULL,
    [ProductType] VARCHAR(10) NOT NULL,
    [OfferType] VARCHAR(10) NOT NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [ModifiedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL DEFAULT '',
    [ModifiedBy] VARCHAR(100) NOT NULL DEFAULT '',
    [IsActive] BIT NOT NULL DEFAULT ((1))
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersMaster_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersMaster_Mobile_2]
(
    [OfferId] INT IDENTITY(1,1) NOT NULL,
    [CampaignId] VARCHAR(300) NOT NULL,
    [OfferName] VARCHAR(300) NOT NULL,
    [OfferImageName] VARCHAR(500) NULL,
    [OfferImagePath] VARCHAR(500) NOT NULL,
    [StartDate] DATE NOT NULL,
    [EndDate] DATE NOT NULL,
    [ProductType] VARCHAR(10) NOT NULL,
    [OfferType] VARCHAR(10) NOT NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [ModifiedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL DEFAULT '',
    [ModifiedBy] VARCHAR(100) NOT NULL DEFAULT '',
    [IsActive] BIT NOT NULL DEFAULT ((1)),
    [offer_detail] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersSubBrokerMapping
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersSubBrokerMapping]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBCode] VARCHAR(50) NOT NULL,
    [OfferId] INT NOT NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersSubBrokerMapping_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersSubBrokerMapping_Mobile_2]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBCode] VARCHAR(50) NOT NULL,
    [OfferId] INT NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [IsTargetAchieved] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersSubBrokerRewards
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersSubBrokerRewards]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBCode] VARCHAR(50) NOT NULL,
    [OfferId] INT NOT NULL,
    [CouponId] VARCHAR(100) NOT NULL,
    [RewardAmount] FLOAT NOT NULL,
    [IsScratched] BIT NOT NULL DEFAULT ((0)),
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [ModifiedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersSubBrokerRewards_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersSubBrokerRewards_Mobile_2]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBCode] VARCHAR(50) NOT NULL,
    [OfferId] INT NOT NULL,
    [CouponId] VARCHAR(100) NOT NULL,
    [RewardAmount] FLOAT NOT NULL,
    [IsScratched] BIT NOT NULL DEFAULT ((0)),
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate()),
    [ModifiedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersSubBrokerRewardsLogs
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersSubBrokerRewardsLogs]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBCode] VARCHAR(50) NOT NULL,
    [OfferId] INT NOT NULL,
    [URL] VARCHAR(500) NOT NULL,
    [RequestBody] VARCHAR(MAX) NOT NULL,
    [ResponseBody] VARCHAR(MAX) NOT NULL,
    [RequestTime] DATETIME NOT NULL,
    [ResponseTime] DATETIME NOT NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.OffersSubBrokerRewardsLogs_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[OffersSubBrokerRewardsLogs_Mobile_2]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBCode] VARCHAR(50) NOT NULL,
    [OfferId] INT NOT NULL,
    [URL] VARCHAR(500) NOT NULL,
    [RequestBody] VARCHAR(MAX) NOT NULL,
    [ResponseBody] VARCHAR(MAX) NOT NULL,
    [RequestTime] DATETIME NOT NULL,
    [ResponseTime] DATETIME NOT NULL,
    [CreatedDate] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.OFRA_Sub_broker
-- --------------------------------------------------
CREATE TABLE [dbo].[OFRA_Sub_broker]
(
    [Sub_broker] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OFRA_Sub_broker_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[OFRA_Sub_broker_Prev]
(
    [Sub_broker] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Openingclosing
-- --------------------------------------------------
CREATE TABLE [dbo].[Openingclosing]
(
    [FY] NVARCHAR(255) NULL,
    [Date] NVARCHAR(255) NULL,
    [Voucher Type] NVARCHAR(255) NULL,
    [Vr No ] NVARCHAR(255) NULL,
    [Cheque No] NVARCHAR(255) NULL,
    [Particulars] NVARCHAR(255) NULL,
    [Debit Amt#] FLOAT NULL,
    [Credit Amt] FLOAT NULL,
    [Balance ] FLOAT NULL,
    [SBCode] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OrganicMarketingUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[OrganicMarketingUpload]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [ContentType] VARCHAR(50) NOT NULL,
    [FileName] VARCHAR(200) NOT NULL,
    [FilePath] VARCHAR(2000) NOT NULL,
    [CreationDate] DATETIME NOT NULL,
    [LastUpdate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [IsDeleted] BIT NULL,
    [DeletedBy] VARCHAR(200) NULL,
    [IsActive] BIT NULL,
    [OrderIndex] TINYINT NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [ServerFilePath] VARCHAR(500) NULL,
    [StartDate] DATE NULL,
    [ExpiryDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryTime] TIME NULL,
    [ContentName] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OTP_SDC_Beenxt	_TobeDrop
-- --------------------------------------------------
CREATE TABLE [dbo].[OTP_SDC_Beenxt	_TobeDrop]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [sb_broker] VARCHAR(200) NULL,
    [Otp] INT NULL,
    [MobileNo] VARCHAR(10) NULL,
    [OTPSent] BIT NULL,
    [OTPVerified] BIT NULL,
    [CreateDate] DATETIME NULL,
    [ModifyDate] DATETIME NULL,
    [UserType] VARCHAR(10) NULL,
    [WrongCount] INT NOT NULL,
    [FinYear] VARCHAR(100) NULL,
    [ARNNAME] VARCHAR(100) NULL,
    [Email] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ozonetel_Error_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[Ozonetel_Error_Log]
(
    [JsonResponse] VARCHAR(MAX) NULL,
    [ExceptionMessage] VARCHAR(MAX) NULL,
    [CreateDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OzonetelCallBackData
-- --------------------------------------------------
CREATE TABLE [dbo].[OzonetelCallBackData]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [AgentPhoneNumber] VARCHAR(100) NULL,
    [Disposition] VARCHAR(100) NULL,
    [CallerConfAudioFile] VARCHAR(100) NULL,
    [TransferredTo] VARCHAR(100) NULL,
    [Apikey] VARCHAR(100) NULL,
    [Did] VARCHAR(100) NULL,
    [StartTime] VARCHAR(100) NULL,
    [CallDuration] VARCHAR(100) NULL,
    [EndTime] VARCHAR(100) NULL,
    [ConfDuration] VARCHAR(100) NULL,
    [CustomerStatus] VARCHAR(100) NULL,
    [TimeToAnswer] VARCHAR(100) NULL,
    [monitorUCID] VARCHAR(100) NULL,
    [AgentID] VARCHAR(100) NULL,
    [AgentStatus] VARCHAR(100) NULL,
    [Location] VARCHAR(100) NULL,
    [FallBackRule] VARCHAR(100) NULL,
    [CampaignStatus] VARCHAR(100) NULL,
    [CallerID] VARCHAR(100) NULL,
    [Duration] VARCHAR(100) NULL,
    [Status] VARCHAR(100) NULL,
    [AgentUniqueID] VARCHAR(100) NULL,
    [UserName] VARCHAR(100) NULL,
    [HangupBy] VARCHAR(100) NULL,
    [AudioFile] VARCHAR(100) NULL,
    [PhoneName] VARCHAR(100) NULL,
    [TransferType] VARCHAR(100) NULL,
    [DialStatus] VARCHAR(100) NULL,
    [CampaignName] VARCHAR(100) NULL,
    [UUI] VARCHAR(100) NULL,
    [AgentName] VARCHAR(100) NULL,
    [Skill] VARCHAR(100) NULL,
    [DialedNumber] VARCHAR(100) NULL,
    [Type] VARCHAR(100) NULL,
    [Comments] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Paid_Brokerage_August
-- --------------------------------------------------
CREATE TABLE [dbo].[Paid_Brokerage_August]
(
    [Agent Code] NVARCHAR(255) NULL,
    [Month] NVARCHAR(255) NULL,
    [Final Payout] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Paid_Brokerage_July
-- --------------------------------------------------
CREATE TABLE [dbo].[Paid_Brokerage_July]
(
    [Agent Code] NVARCHAR(255) NULL,
    [Month] DATETIME NULL,
    [Final Payout] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Paid_Brokerage_June
-- --------------------------------------------------
CREATE TABLE [dbo].[Paid_Brokerage_June]
(
    [Agent Code] NVARCHAR(255) NULL,
    [Month] NVARCHAR(255) NULL,
    [Total Paid] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Paid_Brokerage_Oct
-- --------------------------------------------------
CREATE TABLE [dbo].[Paid_Brokerage_Oct]
(
    [Agent Code] NVARCHAR(255) NULL,
    [Month] DATETIME NULL,
    [Final Amount] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Paid_Brokerage_Sept
-- --------------------------------------------------
CREATE TABLE [dbo].[Paid_Brokerage_Sept]
(
    [SB] NVARCHAR(255) NULL,
    [Month] DATETIME NULL,
    [Final Amount] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PassivToActiveNXT
-- --------------------------------------------------
CREATE TABLE [dbo].[PassivToActiveNXT]
(
    [Party_Code] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [Flag] VARCHAR(10) NULL,
    [filegenerated] VARCHAR(10) NULL,
    [Dt_filegenerated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PassivToActiveNXT_08April2020
-- --------------------------------------------------
CREATE TABLE [dbo].[PassivToActiveNXT_08April2020]
(
    [Party_Code] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PaymentMode
-- --------------------------------------------------
CREATE TABLE [dbo].[PaymentMode]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Text] VARCHAR(150) NOT NULL,
    [Value] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Penal_Reversed
-- --------------------------------------------------
CREATE TABLE [dbo].[Penal_Reversed]
(
    [RevDate] DATETIME NULL,
    [Region] VARCHAR(10) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [Sub_Broker] VARCHAR(10) NULL,
    [Party_code] VARCHAR(10) NULL,
    [BSECM] MONEY NULL DEFAULT ((0)),
    [NSECM] MONEY NULL DEFAULT ((0)),
    [NSEFO] MONEY NULL DEFAULT ((0)),
    [BSEFO] MONEY NULL DEFAULT ((0)),
    [MCX] MONEY NULL DEFAULT ((0)),
    [NCDEX] MONEY NULL DEFAULT ((0)),
    [NSX] MONEY NULL DEFAULT ((0)),
    [MCD] MONEY NULL DEFAULT ((0)),
    [TOTAL] MONEY NULL DEFAULT ((0))
);

GO

-- --------------------------------------------------
-- TABLE dbo.PledgeSMS_log
-- --------------------------------------------------
CREATE TABLE [dbo].[PledgeSMS_log]
(
    [to_no] VARCHAR(50) NOT NULL,
    [message] VARCHAR(500) NULL,
    [date] VARCHAR(20) NULL,
    [time] VARCHAR(20) NULL,
    [flag] VARCHAR(2) NULL,
    [ampm] VARCHAR(3) NULL,
    [purpose] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PledgeStatus_All
-- --------------------------------------------------
CREATE TABLE [dbo].[PledgeStatus_All]
(
    [Party_Code] VARCHAR(100) NULL,
    [scrip_cd] VARCHAR(100) NULL,
    [series] VARCHAR(100) NULL,
    [BCltDpId] VARCHAR(100) NULL,
    [CertNo] VARCHAR(100) NULL,
    [Qty] INT NULL,
    [PledgeType] VARCHAR(100) NULL,
    [UpdatedTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PledgeStatus_All_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[PledgeStatus_All_Prev]
(
    [Party_Code] VARCHAR(100) NULL,
    [scrip_cd] VARCHAR(100) NULL,
    [series] VARCHAR(100) NULL,
    [BCltDpId] VARCHAR(100) NULL,
    [CertNo] VARCHAR(100) NULL,
    [Qty] INT NULL,
    [PledgeType] VARCHAR(100) NULL,
    [UpdatedTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PopupDeleteLog_NXT
-- --------------------------------------------------
CREATE TABLE [dbo].[PopupDeleteLog_NXT]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [PopupId] BIGINT NOT NULL,
    [CampaignId] NVARCHAR(100) NOT NULL,
    [PopupType] NVARCHAR(100) NOT NULL,
    [DeletedBy] NVARCHAR(200) NOT NULL,
    [DeletedDateTime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PopUpLog
-- --------------------------------------------------
CREATE TABLE [dbo].[PopUpLog]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [PopupId] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [Project_Type] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.QuestionAnswerModule
-- --------------------------------------------------
CREATE TABLE [dbo].[QuestionAnswerModule]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Name] VARCHAR(100) NOT NULL,
    [TrainingLinkId] INT NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL,
    [LastUpdate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.QuestionAnswerOptions
-- --------------------------------------------------
CREATE TABLE [dbo].[QuestionAnswerOptions]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [QuestionId] INT NOT NULL,
    [AnswerOptionId] INT NOT NULL,
    [IsAnswer] BIT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL,
    [LastUpdate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Questions_TobeDrop
-- --------------------------------------------------
CREATE TABLE [dbo].[Questions_TobeDrop]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [ModuleId] INT NOT NULL,
    [Question] VARCHAR(5000) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL,
    [LastUpdate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Rajasthan_SDAmt
-- --------------------------------------------------
CREATE TABLE [dbo].[Rajasthan_SDAmt]
(
    [Party_code] VARCHAR(25) NULL,
    [SD_Amt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Rajasthan_SDAmt_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[Rajasthan_SDAmt_Prev]
(
    [Party_code] VARCHAR(25) NULL,
    [SD_Amt] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RedemptionOrderDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[RedemptionOrderDetails]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Client_Code] NVARCHAR(50) NULL,
    [EUIN_Number] NVARCHAR(50) NULL,
    [Folio_Number] NVARCHAR(50) NULL,
    [Scheme_Name] NVARCHAR(MAX) NULL,
    [SchemeCode] NVARCHAR(50) NULL,
    [InternalRefNo] NVARCHAR(50) NULL,
    [Isin] NVARCHAR(50) NULL,
    [UserType] NVARCHAR(50) NULL,
    [RedemptionDate] DATETIME NULL,
    [RedemptionTime] DATETIME NULL,
    [AmountInvested] FLOAT NULL,
    [SbARNCode] NVARCHAR(50) NULL,
    [InsertedBy] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.redisLogin
-- --------------------------------------------------
CREATE TABLE [dbo].[redisLogin]
(
    [Access_code] VARCHAR(30) NULL,
    [Username] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RightIssues_InHouse_SB_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[RightIssues_InHouse_SB_Master]
(
    [subbroker] VARCHAR(100) NULL,
    [EntryBy] VARCHAR(100) NULL,
    [EntryDate] DATETIME NULL,
    [Active] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RiskdashboardActionsNXT
-- --------------------------------------------------
CREATE TABLE [dbo].[RiskdashboardActionsNXT]
(
    [Subbroker] VARCHAR(100) NULL,
    [ClientCode] VARCHAR(100) NULL,
    [Flag] VARCHAR(10) NULL,
    [Createdate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [Updatedate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rms_holding_RMSHolding
-- --------------------------------------------------
CREATE TABLE [dbo].[rms_holding_RMSHolding]
(
    [AssetClass] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(100) NULL,
    [RMSHolding] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_Broker_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_Broker_Prev]
(
    [RefNo] NUMERIC(18, 0) NOT NULL,
    [SBTAG] VARCHAR(50) NULL,
    [Branch] VARCHAR(50) NULL,
    [ParentTag] VARCHAR(50) NULL,
    [TradeName] VARCHAR(200) NULL,
    [OrgType] VARCHAR(20) NULL,
    [DOI] DATETIME NULL,
    [NoofPartners] INT NULL,
    [SalContactPerson] VARCHAR(20) NULL,
    [ContactPerson] VARCHAR(200) NULL,
    [RegCat] VARCHAR(10) NULL,
    [PanNo] VARCHAR(20) NULL,
    [Objective] VARCHAR(20) NULL,
    [ObjOthers] VARCHAR(100) NULL,
    [SEBIRegNo] VARCHAR(50) NULL,
    [LeadId] VARCHAR(20) NULL,
    [LeadSource] VARCHAR(50) NULL,
    [EmpId] VARCHAR(20) NULL,
    [FileNo] VARCHAR(20) NULL,
    [PANVerified] VARCHAR(5) NULL,
    [TAGGeneratedDate] DATETIME NULL,
    [SBstatus] VARCHAR(20) NULL,
    [RegStatus] INT NULL,
    [RecStatus] INT NULL,
    [CrtBy] VARCHAR(500) NULL,
    [CrtDt] DATETIME NULL,
    [MdyBy] VARCHAR(500) NULL,
    [MdyDt] DATETIME NULL,
    [Printed] CHAR(1) NULL,
    [SbCat] VARCHAR(50) NULL,
    [Certno1] VARCHAR(20) NULL,
    [Certno2] VARCHAR(20) NULL,
    [Certno3] VARCHAR(20) NULL,
    [Certno4] VARCHAR(20) NULL,
    [Cso_PancardNum] VARCHAR(15) NULL,
    [Cso_PanCardName] VARCHAR(200) NULL,
    [SalTradeName] VARCHAR(20) NULL,
    [CTS] VARCHAR(20) NULL,
    [PLS] VARCHAR(20) NULL,
    [TradeNameInCommodity] VARCHAR(200) NULL,
    [DOICOR] DATETIME NULL,
    [PanNoCorp] VARCHAR(20) NULL,
    [MakerPan] VARCHAR(20) NULL,
    [CheckerPan] VARCHAR(20) NULL,
    [MakerId] VARCHAR(100) NULL,
    [CheckerId] VARCHAR(10) NULL,
    [AppStatus] VARCHAR(1) NULL,
    [RejectReasons] VARCHAR(4000) NULL,
    [TimeStamp] DATETIME NULL,
    [IpAddress] VARCHAR(20) NULL,
    [AuthSign] VARCHAR(100) NULL,
    [OldBranchShiftingTag] VARCHAR(30) NULL,
    [IsActive] VARCHAR(10) NULL,
    [IsActiveDate] DATETIME NULL,
    [AadharNo] VARCHAR(50) NULL,
    [FamilyReason] VARCHAR(200) NULL,
    [LEAD_TYPE] VARCHAR(20) NULL,
    [LEAD_SOURCE] VARCHAR(100) NULL,
    [SB_Broker_Type] VARCHAR(10) NULL,
    [MF_REG_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_Change_Update_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_Change_Update_Log]
(
    [Party_code] VARCHAR(200) NULL,
    [UpdateDate] DATETIME NULL,
    [status] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_client_details
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_client_details]
(
    [party_code] VARCHAR(10) NOT NULL,
    [branch_cd] VARCHAR(10) NULL,
    [sub_broker] VARCHAR(10) NULL,
    [cl_code] VARCHAR(10) NULL,
    [email] VARCHAR(50) NULL,
    [long_name] VARCHAR(100) NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [bank_name] VARCHAR(50) NULL,
    [first_active_date] DATETIME NULL,
    [last_inactive_date] DATETIME NULL,
    [B2C] VARCHAR(1) NULL,
    [BSE_LAST_DATE] DATETIME NULL,
    [NSE_LAST_DATE] DATETIME NULL,
    [FO_LAST_DATE] DATETIME NULL,
    [NCDX_LAST_DATE] DATETIME NULL,
    [MCDX_LAST_DATE] DATETIME NULL,
    [nsx_last_Date] DATETIME NULL,
    [mcd_last_Date] DATETIME NULL,
    [bsefo_last_Date] DATETIME NULL,
    [comb_last_date] DATETIME NULL,
    [EQ_AUM] DECIMAL(20, 2) NULL,
    [MF_AUM] DECIMAL(20, 2) NULL,
    [ARQEQInvstAmt] MONEY NULL,
    [ARQEQLastPrice] MONEY NULL,
    [ARQMFInvstAmt] MONEY NULL,
    [ARQMFLastNAVPrice] MONEY NULL,
    [ARQClient] BIT NULL,
    [mf_Active_Date] DATETIME NULL,
    [mf_last_date] DATETIME NULL,
    [InitialMargin] DECIMAL(20, 4) NULL,
    [short_name] VARCHAR(100) NULL,
    [l_address1] VARCHAR(100) NULL,
    [l_address2] VARCHAR(100) NULL,
    [l_address3] VARCHAR(100) NULL,
    [l_city] VARCHAR(100) NULL,
    [l_state] VARCHAR(100) NULL,
    [l_nation] VARCHAR(15) NULL,
    [l_zip] VARCHAR(10) NULL,
    [pan_gir_no] VARCHAR(50) NULL,
    [CltDpId1] VARCHAR(16) NULL,
    [DPId] VARCHAR(20) NULL,
    [BSECM] VARCHAR(3) NULL,
    [NSECM] VARCHAR(3) NULL,
    [NSEFutures] VARCHAR(3) NULL,
    [NSECurrency] VARCHAR(3) NULL,
    [BSECurrency] VARCHAR(3) NULL,
    [MCXCurrency] VARCHAR(3) NULL,
    [MCX] VARCHAR(3) NULL,
    [NCX] VARCHAR(3) NULL,
    [MF] VARCHAR(3) NULL,
    [Sex] VARCHAR(4) NULL,
    [DOB] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_Contact_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_Contact_Prev]
(
    [RefNo] NUMERIC(18, 0) NOT NULL,
    [AddType] VARCHAR(10) NULL,
    [AddLine1] VARCHAR(1000) NULL,
    [AddLine2] VARCHAR(1000) NULL,
    [Landmark] VARCHAR(200) NULL,
    [City] VARCHAR(100) NULL,
    [State] VARCHAR(100) NULL,
    [Country] VARCHAR(50) NULL,
    [PinCode] VARCHAR(10) NULL,
    [Stdcode] VARCHAR(20) NULL,
    [TelNo] VARCHAR(100) NULL,
    [MobNo] VARCHAR(100) NULL,
    [FaxNo] VARCHAR(20) NULL,
    [EmailId] VARCHAR(200) NULL,
    [RecStatus] INT NULL,
    [CrtBy] VARCHAR(500) NULL,
    [CrtDt] DATETIME NULL,
    [MdyBy] VARCHAR(500) NULL,
    [MdyDt] DATETIME NULL,
    [MakerId] VARCHAR(20) NULL,
    [CheckerID] VARCHAR(20) NULL,
    [TimeStamp] DATETIME NULL,
    [IpAddress] VARCHAR(20) NULL,
    [MobNo2] VARCHAR(20) NULL,
    [MobNo3] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL DEFAULT ((0)),
    [Filename] NVARCHAR(500) NULL DEFAULT '',
    [IsApproved] BIT NULL,
    [Remark] NVARCHAR(1000) NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration_Bkp02June2020
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration_Bkp02June2020]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL,
    [Filename] NVARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_declaration_Bkp05Dec2022
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_declaration_Bkp05Dec2022]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL,
    [Filename] NVARCHAR(500) NULL,
    [IsApproved] BIT NULL,
    [Remark] NVARCHAR(1000) NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration_Bkp131pr2022
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration_Bkp131pr2022]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL,
    [Filename] NVARCHAR(500) NULL,
    [IsApproved] BIT NULL,
    [Remark] NVARCHAR(1000) NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration_Bkp25Nov2019
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration_Bkp25Nov2019]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration_Bkp28July2020
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration_Bkp28July2020]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL,
    [Filename] NVARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration_Bkp30July2020
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration_Bkp30July2020]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL,
    [Filename] NVARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_Declaration_testing
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_Declaration_testing]
(
    [SBTag] VARCHAR(100) NULL,
    [SelfDeclaration] VARCHAR(200) NULL,
    [FnYear] VARCHAR(200) NULL,
    [RCVD_DATE] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [Source] VARCHAR(200) NULL,
    [DocPath] VARCHAR(MAX) NULL,
    [IsOTPVerified] BIT NOT NULL,
    [Filename] NVARCHAR(500) NULL,
    [IsApproved] BIT NULL,
    [Remark] NVARCHAR(1000) NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_MarginRetention
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_MarginRetention]
(
    [Zone] VARCHAR(20) NULL,
    [Region] VARCHAR(20) NULL,
    [Branch] VARCHAR(10) NULL,
    [SB] VARCHAR(10) NULL,
    [Client] VARCHAR(15) NULL,
    [Party_Name] VARCHAR(100) NULL,
    [CliType] VARCHAR(10) NULL,
    [SCCS_SettDate_Last] VARCHAR(20) NULL,
    [DaysAhead] INT NULL,
    [old_code] VARCHAR(30) NULL,
    [FundsPayout] MONEY NULL,
    [PayoutValue] MONEY NULL,
    [Segment] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_NOC_Rights
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_NOC_Rights]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [FromSubBroker] VARCHAR(100) NULL,
    [ToSubBroker] VARCHAR(100) NULL,
    [EntryBy] VARCHAR(100) NULL,
    [EntryDate] DATETIME NULL,
    [Active] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_NOCaccess
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_NOCaccess]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [username] VARCHAR(100) NULL,
    [entryDate] DATETIME NULL,
    [active] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_TeleBot_Reg
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_TeleBot_Reg]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(50) NOT NULL,
    [DATag] VARCHAR(50) NOT NULL,
    [APIKey] VARCHAR(50) NOT NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [IsActive] INT NULL,
    [UpdatedBy] VARCHAR(100) NULL,
    [UpdatedDate] VARCHAR(100) NULL,
    [CreatedOn] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_TrainingLinks
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_TrainingLinks]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(50) NOT NULL,
    [TrainingLinkId] INT NOT NULL,
    [IsVisited] BIT NOT NULL,
    [CreatedBy] VARCHAR(50) NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [FromTime] VARCHAR(50) NULL,
    [ToTime] VARCHAR(50) NULL,
    [Language] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_TrainingLinks_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_TrainingLinks_Log]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTraniningLinkId] BIGINT NOT NULL,
    [SBName] VARCHAR(50) NOT NULL,
    [VisitDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBDetailsWithLedgerBal_prev
-- --------------------------------------------------
CREATE TABLE [dbo].[SBDetailsWithLedgerBal_prev]
(
    [SBTAG] VARCHAR(50) NULL,
    [TAGGeneratedDate] VARCHAR(20) NULL,
    [TerMobNo] VARCHAR(100) NULL,
    [TerTelephone] VARCHAR(121) NULL,
    [AltMobNo] VARCHAR(100) NULL,
    [AltTelephone] VARCHAR(121) NULL,
    [Category] VARCHAR(25) NULL,
    [LedgerBal] MONEY NULL,
    [ContactPerson] VARCHAR(220) NULL,
    [Branch] VARCHAR(50) NULL,
    [TerAddline1] VARCHAR(1000) NULL,
    [TerAddline2] VARCHAR(1000) NULL,
    [TerLandmark] VARCHAR(1000) NULL,
    [TerCity] VARCHAR(1000) NULL,
    [TerState] VARCHAR(1000) NULL,
    [TerPincode] VARCHAR(10) NULL,
    [TerEmailid] VARCHAR(200) NULL,
    [SBName] VARCHAR(800) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SBPageAccess
-- --------------------------------------------------
CREATE TABLE [dbo].[SBPageAccess]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.schememaster
-- --------------------------------------------------
CREATE TABLE [dbo].[schememaster]
(
    [AMCcode] VARCHAR(16) NULL,
    [SchemeCode] VARCHAR(16) NOT NULL,
    [SchemeName] VARCHAR(250) NULL,
    [SchemeType] INT NULL,
    [SchemeTypeDescription] VARCHAR(50) NULL,
    [LaunchDate] DATETIME NULL,
    [SchemePlanCode] INT NULL,
    [schemePlanDescription] VARCHAR(150) NULL,
    [schemeSubPlanDescription] VARCHAR(100) NULL,
    [SchemeClassCode] INT NULL,
    [SchemeClassDescription] VARCHAR(50) NULL,
    [SchemeSubClassDescription] VARCHAR(50) NULL,
    [OpenDate] DATETIME NULL,
    [CloseDate] DATETIME NULL,
    [RedemptionDate] DATETIME NULL,
    [MinInvestmentAmount] INT NULL,
    [initialPrice] FLOAT NULL,
    [InitialPriceUOM] FLOAT NULL,
    [InitialPriceUOMDescription] VARCHAR(50) NULL,
    [Size] NUMERIC(10, 4) NULL,
    [sizeUOM] INT NULL,
    [SizeUOMDescription] VARCHAR(50) NULL,
    [OfferPrice] MONEY NULL,
    [AmountRaised] MONEY NULL,
    [AmountRaisedUOM] INT NULL,
    [AmountRaisedUOMDescription] VARCHAR(50) NULL,
    [FundManagerPrefix] VARCHAR(50) NULL,
    [FundManagerName] VARCHAR(255) NULL,
    [ListingInFormation] BIT NOT NULL,
    [EntryLoad] VARCHAR(25) NULL,
    [ExitLoad] VARCHAR(25) NULL,
    [RedemptionFerq] VARCHAR(50) NULL,
    [AMFICode] VARCHAR(20) NULL,
    [DeleteFlag] BIT NULL,
    [CreationDate] DATETIME NULL,
    [SchemeCategoryCode] VARCHAR(10) NULL,
    [SchemeCategoryDescription] VARCHAR(80) NULL,
    [BenchMarkIndexCode] VARCHAR(50) NULL,
    [BenchMarkIndexName] VARCHAR(100) NULL,
    [Risk] VARCHAR(50) NULL,
    [ISINGrowth] VARCHAR(50) NULL,
    [ISINDiv] VARCHAR(50) NULL,
    [ExpensesRatio] MONEY NULL,
    [ExitLoadwithDesc] VARCHAR(2500) NULL,
    [StandardDeviation] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.securityholdingdata_rpt
-- --------------------------------------------------
CREATE TABLE [dbo].[securityholdingdata_rpt]
(
    [party_code] VARCHAR(50) NULL,
    [exchange] VARCHAR(10) NULL,
    [qty] FLOAT NULL,
    [holding] MONEY NULL,
    [scrip_cd] VARCHAR(15) NULL,
    [total] NUMERIC(38, 4) NULL,
    [category] VARCHAR(20) NULL,
    [symbol] VARCHAR(200) NULL,
    [isin] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.securityholdingdata_rpt_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[securityholdingdata_rpt_Prev]
(
    [party_code] VARCHAR(50) NULL,
    [exchange] VARCHAR(10) NULL,
    [qty] FLOAT NULL,
    [holding] MONEY NULL,
    [scrip_cd] VARCHAR(15) NULL,
    [total] NUMERIC(38, 4) NULL,
    [category] VARCHAR(20) NULL,
    [symbol] VARCHAR(200) NULL,
    [isin] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SegmentEmodifications
-- --------------------------------------------------
CREATE TABLE [dbo].[SegmentEmodifications]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTag] NVARCHAR(100) NOT NULL,
    [PartyCode] NVARCHAR(100) NOT NULL,
    [ExistingSegments] NVARCHAR(1000) NOT NULL,
    [NewSegments] NVARCHAR(1000) NOT NULL,
    [LinkSent] BIT NULL,
    [Link] NVARCHAR(500) NULL,
    [LinkOpened] BIT NULL,
    [OTPSent] BIT NULL,
    [OTPVerified] BIT NULL,
    [ModificationSuccessful] BIT NULL,
    [ModificationDate] DATETIME NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Self_Declaration_Data
-- --------------------------------------------------
CREATE TABLE [dbo].[Self_Declaration_Data]
(
    [SB Tag] NVARCHAR(255) NULL,
    [ARNNo(1)] NVARCHAR(255) NULL,
    [SDC FY-18-19] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Self_Declaration_Data_Bkp02Jun2020
-- --------------------------------------------------
CREATE TABLE [dbo].[Self_Declaration_Data_Bkp02Jun2020]
(
    [SB Tag] NVARCHAR(255) NULL,
    [ARNNo(1)] NVARCHAR(255) NULL,
    [SDC FY-18-19] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Self_Declaration_Data_Bkp13Apr2022
-- --------------------------------------------------
CREATE TABLE [dbo].[Self_Declaration_Data_Bkp13Apr2022]
(
    [SB Tag] NVARCHAR(255) NULL,
    [ARNNo(1)] NVARCHAR(255) NULL,
    [SDC FY-18-19] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Self_Declaration_Data_Bkp28July2020
-- --------------------------------------------------
CREATE TABLE [dbo].[Self_Declaration_Data_Bkp28July2020]
(
    [SB Tag] NVARCHAR(255) NULL,
    [ARNNo(1)] NVARCHAR(255) NULL,
    [SDC FY-18-19] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SmartMarketingLogs
-- --------------------------------------------------
CREATE TABLE [dbo].[SmartMarketingLogs]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SB] NVARCHAR(50) NOT NULL,
    [UserName] NVARCHAR(50) NOT NULL,
    [DateAndTime] DATETIME NOT NULL,
    [ContentType] NVARCHAR(50) NOT NULL,
    [ContentName] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SubBrokerQuestion
-- --------------------------------------------------
CREATE TABLE [dbo].[SubBrokerQuestion]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SubBrokerTag] VARCHAR(50) NOT NULL,
    [ModuleId] INT NOT NULL,
    [ModuleCompleted] BIT NOT NULL DEFAULT ((0)),
    [Attempted] INT NOT NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL,
    [LastUpdate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SubBrokerQuestionResponse
-- --------------------------------------------------
CREATE TABLE [dbo].[SubBrokerQuestionResponse]
(
    [Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SubBrokerQueId] BIGINT NOT NULL,
    [QuestionAnswerOptionId] INT NULL,
    [AnswerText] VARCHAR(5000) NULL,
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [CreatedBy] VARCHAR(100) NOT NULL,
    [LastUpdate] DATETIME NULL,
    [UpdatedBy] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.t
-- --------------------------------------------------
CREATE TABLE [dbo].[t]
(
    [SBTAG] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL,
    [UpdatedBy] VARCHAR(50) NULL,
    [UpdatedDT] DATETIME NULL,
    [RecID] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.t1
-- --------------------------------------------------
CREATE TABLE [dbo].[t1]
(
    [a] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.t2
-- --------------------------------------------------
CREATE TABLE [dbo].[t2]
(
    [a] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TawkChatSBMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[TawkChatSBMaster]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_advisory_per_rep_comm
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_advisory_per_rep_comm]
(
    [Category] VARCHAR(100) NULL,
    [Positive_Calls] INT NULL,
    [Total_Calls] INT NULL,
    [Strike_Rate_Call_Wise] VARCHAR(100) NULL,
    [Net_Risk_Reward_Ratio] DECIMAL(18, 0) NULL,
    [updated_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_advisory_per_rep_curr
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_advisory_per_rep_curr]
(
    [Category] VARCHAR(100) NULL,
    [Total_Calls] INT NULL,
    [Positive_Calls] INT NULL,
    [Strike_Rate_Call_Wise] VARCHAR(100) NULL,
    [Net_Risk_Reward_Ratio] DECIMAL(18, 0) NULL,
    [updated_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_advisory_per_rep_eq_FNO
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_advisory_per_rep_eq_FNO]
(
    [Category] VARCHAR(100) NULL,
    [Positive_Calls] INT NULL,
    [Total_Calls] INT NULL,
    [Strike_Rate_Call_Wise] VARCHAR(100) NULL,
    [Net_Risk_Reward_Ratio] DECIMAL(18, 0) NULL,
    [updated_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ARQ_mailer
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ARQ_mailer]
(
    [sr_no] BIGINT IDENTITY(1,1) NOT NULL,
    [key] VARCHAR(200) NOT NULL,
    [value] VARCHAR(50) NOT NULL,
    [segment] VARCHAR(50) NOT NULL,
    [type] NVARCHAR(50) NOT NULL,
    [title] NVARCHAR(100) NOT NULL,
    [createdOn] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ARQ_mailer_tmp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ARQ_mailer_tmp]
(
    [sr_no] BIGINT IDENTITY(1,1) NOT NULL,
    [key] VARCHAR(200) NOT NULL,
    [value] VARCHAR(50) NOT NULL,
    [segment] VARCHAR(50) NOT NULL,
    [type] NVARCHAR(50) NOT NULL,
    [title] NVARCHAR(100) NOT NULL,
    [createdOn] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BCS_Get_DailyActRatio
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BCS_Get_DailyActRatio]
(
    [Trade_Date] DATE NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [Active_Client] INT NULL,
    [Total_Client] INT NULL,
    [Daily_Act_Ratio] FLOAT NULL,
    [MONTH] VARCHAR(6) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BellNotificationBEENXTHist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BellNotificationBEENXTHist]
(
    [sub_broker] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [NotificationCount] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BellNotificationNXTHist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BellNotificationNXTHist]
(
    [sub_broker] VARCHAR(200) NULL,
    [EntryDate] DATETIME NULL,
    [NotificationCount] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Category_Wise_Average_Bussiness_Consulting
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Category_Wise_Average_Bussiness_Consulting]
(
    [Category] VARCHAR(1000) NULL,
    [AvgPayout] NUMERIC(18, 2) NULL,
    [ClientAge] VARCHAR(10) NULL,
    [SUB_Broker] VARCHAR(200) NULL,
    [ActiveFrom] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Category_Wise_Average_Bussiness_Consulting_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Category_Wise_Average_Bussiness_Consulting_Prev]
(
    [Category] VARCHAR(1000) NULL,
    [AvgPayout] NUMERIC(18, 2) NULL,
    [ClientAge] VARCHAR(10) NULL,
    [SUB_Broker] VARCHAR(200) NULL,
    [ActiveFrom] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CityMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CityMaster]
(
    [CItyId] INT IDENTITY(1,1) NOT NULL,
    [CityName] NVARCHAR(100) NOT NULL,
    [StateId] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Client_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Client_Master]
(
    [CLIENT_CODE] VARCHAR(20) NULL,
    [FIRST_HOLD_NAME] VARCHAR(100) NULL,
    [NISE_PARTY_CODE] VARCHAR(100) NULL,
    [InsertedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ClientBrokerageDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ClientBrokerageDetails]
(
    [Party_Code] CHAR(20) NULL,
    [Client_Name] VARCHAR(100) NULL,
    [Sub_Broker] VARCHAR(10) NULL,
    [Segment] VARCHAR(10) NULL,
    [Sauda_Date] DATETIME NULL,
    [Branch] VARCHAR(10) NULL,
    [Sub_Remi_Code] VARCHAR(10) NOT NULL,
    [GrossBrokerage] MONEY NULL,
    [NettoSB] MONEY NULL,
    [NetBrok] MONEY NULL,
    [Remi_Share] MONEY NULL,
    [Fran_Share] MONEY NULL,
    [Fran_Percent] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ClientsTradingDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ClientsTradingDetails]
(
    [Party_code] VARCHAR(20) NULL,
    [OnlineClient] VARCHAR(2) NULL,
    [B2C] VARCHAR(2) NULL,
    [ExchangeSegment] VARCHAR(50) NULL,
    [Sauda_date] DATETIME NULL,
    [Turnover] DECIMAL(20, 10) NULL,
    [TurnoverB2C] DECIMAL(20, 10) NULL,
    [TurnoverB2B] DECIMAL(20, 10) NULL,
    [GrossBrokerage] DECIMAL(20, 10) NULL,
    [BrokerageB2C] DECIMAL(20, 10) NULL,
    [BrokerageB2B] DECIMAL(20, 10) NULL,
    [NettoSB] DECIMAL(20, 10) NULL,
    [NetBrok] DECIMAL(20, 10) NULL,
    [NetBrokB2C] DECIMAL(20, 10) NULL,
    [NetBrokB2B] DECIMAL(20, 10) NULL,
    [sub_broker] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_DETAIL
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_DETAIL]
(
    [party_code] VARCHAR(100) NULL,
    [MARGINDATE] DATE NULL,
    [TDAY_MARGIN] NUMERIC(25, 2) NULL,
    [TDAY_MTM] NUMERIC(25, 2) NULL,
    [Margin] NUMERIC(25, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_COMBINE_REPORTING_DETAIL_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_COMBINE_REPORTING_DETAIL_Prev]
(
    [party_code] VARCHAR(100) NULL,
    [MARGINDATE] DATE NULL,
    [TDAY_MARGIN] NUMERIC(25, 2) NULL,
    [TDAY_MTM] NUMERIC(25, 2) NULL,
    [Margin] NUMERIC(25, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_CounterForMTFPledgeJob
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_CounterForMTFPledgeJob]
(
    [Counter] INT NULL,
    [createdDate] DATETIME NULL,
    [SP_Job_Name] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CRMS_Dashboard_ClientDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CRMS_Dashboard_ClientDetails]
(
    [party_code] VARCHAR(20) NULL,
    [Client_Name] VARCHAR(100) NULL,
    [sub_broker] VARCHAR(50) NOT NULL,
    [branch_cd] VARCHAR(50) NULL,
    [ECN] VARCHAR(20) NULL,
    [PAN] VARCHAR(50) NULL,
    [Trading_Mode] VARCHAR(10) NOT NULL,
    [NbFcClient] VARCHAR(50) NOT NULL,
    [ActiveFromEq] VARCHAR(11) NULL,
    [InactiveFromEq] VARCHAR(11) NULL,
    [ActiveFromCurr] VARCHAR(11) NULL,
    [inactivefromcurr] VARCHAR(11) NULL,
    [ActiveFromMcxNcx] VARCHAR(11) NULL,
    [InActiveFromMcxNcx] VARCHAR(11) NULL,
    [NseFoActiveFrom] VARCHAR(11) NULL,
    [NseFoInActiveFrom] VARCHAR(11) NULL,
    [OnlineBrokerageDiscount] VARCHAR(10) NULL,
    [POA_Status] VARCHAR(50) NULL,
    [MF_Status] VARCHAR(50) NULL,
    [Address] VARCHAR(300) NOT NULL,
    [Email] VARCHAR(100) NULL,
    [Mobile_pager] VARCHAR(20) NULL,
    [LedgerTotal] MONEY NOT NULL,
    [TotalHoldValue] MONEY NOT NULL,
    [NetOpenValue] MONEY NOT NULL,
    [LoginStatus] VARCHAR(30) NOT NULL,
    [Today_Turnover] MONEY NOT NULL,
    [LastCallDate] VARCHAR(50) NOT NULL,
    [LastTradeDate] VARCHAR(11) NULL,
    [CurrentLimit] MONEY NULL,
    [MorningDealer] VARCHAR(50) NULL,
    [EveningDealer] VARCHAR(50) NULL,
    [FamilyCode] VARCHAR(50) NOT NULL,
    [NRMSHolding] MONEY NOT NULL,
    [NRMSLedger] MONEY NOT NULL,
    [NRMSShortfall] MONEY NOT NULL,
    [NRMSMOS] MONEY NOT NULL,
    [Unrecosiled_Credit] MONEY NULL,
    [PayoutShortage] MONEY NULL,
    [OnlineSoftwareTraining] VARCHAR(20) NULL,
    [SoftwareDownloaded] NVARCHAR(MAX) NULL,
    [DirectClient] VARCHAR(5) NULL,
    [HOD1_HOD2] VARCHAR(100) NULL,
    [Dealer] VARCHAR(50) NULL,
    [DealerType] VARCHAR(50) NULL,
    [VarSqOff] MONEY NULL,
    [CurrencyDealer] VARCHAR(50) NULL,
    [NetCollection] MONEY NULL,
    [ClientProfile] VARCHAR(50) NULL,
    [AUM] MONEY NULL,
    [ParentCode] VARCHAR(50) NULL,
    [PnL] MONEY NULL,
    [IntradayProduct] VARCHAR(200) NULL,
    [ProjectedSqOff] VARCHAR(50) NULL,
    [RMDealer] VARCHAR(20) NULL,
    [InitialMargin] MONEY NULL,
    [Proj_Risk] MONEY NULL,
    [ProjectedSqOff_Tplus1Day] MONEY NULL,
    [ProjectedSqOff_Tday] MONEY NULL,
    [CurrentLimit_Commodity] MONEY NULL,
    [Persona] VARCHAR(50) NULL,
    [OnboardingPersona] VARCHAR(50) NULL,
    [MorningDealerName] VARCHAR(50) NULL,
    [EveningDealerName] VARCHAR(50) NULL,
    [CurrencyDealerName] VARCHAR(50) NULL,
    [B2B_DealerCode] VARCHAR(50) NULL,
    [MFHolding] MONEY NULL,
    [BSEMFLedger] MONEY NULL,
    [NSEMFLedger] MONEY NULL,
    [MTFStatus] CHAR(1) NULL,
    [AadharUpdatedStatus] CHAR(1) NULL,
    [CommodityOptionFlag] CHAR(1) NULL,
    [PayinShortage] BIGINT NULL,
    [PortfolioHealthScore] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_crms_dashboard_clientdetails_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_crms_dashboard_clientdetails_Prev]
(
    [party_code] VARCHAR(20) NULL,
    [Client_Name] VARCHAR(100) NULL,
    [sub_broker] VARCHAR(50) NOT NULL,
    [branch_cd] VARCHAR(50) NULL,
    [ECN] VARCHAR(20) NULL,
    [PAN] VARCHAR(50) NULL,
    [Trading_Mode] VARCHAR(10) NOT NULL,
    [NbFcClient] VARCHAR(50) NOT NULL,
    [ActiveFromEq] VARCHAR(11) NULL,
    [InactiveFromEq] VARCHAR(11) NULL,
    [ActiveFromCurr] VARCHAR(11) NULL,
    [inactivefromcurr] VARCHAR(11) NULL,
    [ActiveFromMcxNcx] VARCHAR(11) NULL,
    [InActiveFromMcxNcx] VARCHAR(11) NULL,
    [NseFoActiveFrom] VARCHAR(11) NULL,
    [NseFoInActiveFrom] VARCHAR(11) NULL,
    [OnlineBrokerageDiscount] VARCHAR(10) NULL,
    [POA_Status] VARCHAR(50) NULL,
    [MF_Status] VARCHAR(50) NULL,
    [Address] VARCHAR(300) NOT NULL,
    [Email] VARCHAR(100) NULL,
    [Mobile_pager] VARCHAR(20) NULL,
    [LedgerTotal] MONEY NOT NULL,
    [TotalHoldValue] MONEY NOT NULL,
    [NetOpenValue] MONEY NOT NULL,
    [LoginStatus] VARCHAR(30) NOT NULL,
    [Today_Turnover] MONEY NOT NULL,
    [LastCallDate] VARCHAR(50) NOT NULL,
    [LastTradeDate] VARCHAR(11) NULL,
    [CurrentLimit] MONEY NULL,
    [MorningDealer] VARCHAR(50) NULL,
    [EveningDealer] VARCHAR(50) NULL,
    [FamilyCode] VARCHAR(50) NOT NULL,
    [NRMSHolding] MONEY NOT NULL,
    [NRMSLedger] MONEY NOT NULL,
    [NRMSShortfall] MONEY NOT NULL,
    [NRMSMOS] MONEY NOT NULL,
    [Unrecosiled_Credit] MONEY NULL,
    [PayoutShortage] MONEY NULL,
    [OnlineSoftwareTraining] VARCHAR(20) NULL,
    [SoftwareDownloaded] NVARCHAR(MAX) NULL,
    [DirectClient] VARCHAR(5) NULL,
    [HOD1_HOD2] VARCHAR(100) NULL,
    [Dealer] VARCHAR(50) NULL,
    [DealerType] VARCHAR(50) NULL,
    [VarSqOff] MONEY NULL,
    [CurrencyDealer] VARCHAR(50) NULL,
    [NetCollection] MONEY NULL,
    [ClientProfile] VARCHAR(50) NULL,
    [AUM] MONEY NULL,
    [ParentCode] VARCHAR(50) NULL,
    [PnL] MONEY NULL,
    [IntradayProduct] VARCHAR(200) NULL,
    [ProjectedSqOff] VARCHAR(50) NULL,
    [RMDealer] VARCHAR(20) NULL,
    [InitialMargin] MONEY NULL,
    [Proj_Risk] MONEY NULL,
    [ProjectedSqOff_Tplus1Day] MONEY NULL,
    [ProjectedSqOff_Tday] MONEY NULL,
    [CurrentLimit_Commodity] MONEY NULL,
    [Persona] VARCHAR(50) NULL,
    [OnboardingPersona] VARCHAR(50) NULL,
    [MorningDealerName] VARCHAR(50) NULL,
    [EveningDealerName] VARCHAR(50) NULL,
    [CurrencyDealerName] VARCHAR(50) NULL,
    [B2B_DealerCode] VARCHAR(50) NULL,
    [MFHolding] MONEY NULL,
    [BSEMFLedger] MONEY NULL,
    [NSEMFLedger] MONEY NULL,
    [MTFStatus] CHAR(1) NULL,
    [AadharUpdatedStatus] CHAR(1) NULL,
    [CommodityOptionFlag] CHAR(1) NULL,
    [PayinShortage] BIGINT NULL,
    [PortfolioHealthScore] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CRMS_Dashboard_PriorityClients_B2B
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CRMS_Dashboard_PriorityClients_B2B]
(
    [AutoId] BIGINT NOT NULL,
    [DateTime] DATETIME NULL,
    [emp_no] VARCHAR(20) NULL,
    [party_code] VARCHAR(20) NULL,
    [party_name] VARCHAR(100) NULL,
    [CallType] VARCHAR(200) NULL,
    [CallSubType] VARCHAR(200) NULL,
    [CallValue] VARCHAR(2000) NULL,
    [Priority] INT NULL,
    [Sub_Priority] INT NULL,
    [IsProcessed] CHAR(1) NULL,
    [IsProcessedDateTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CRMS_MF_ARQ_Recommendations
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CRMS_MF_ARQ_Recommendations]
(
    [Party_code] VARCHAR(30) NULL,
    [Sub_Broker] VARCHAR(10) NOT NULL,
    [Header] VARCHAR(100) NULL,
    [SchemeName] VARCHAR(500) NULL,
    [RecommendationSendOn] DATETIME NOT NULL,
    [Isin] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CustomPlanBrokerageDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CustomPlanBrokerageDetails]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Clientcode] VARCHAR(50) NULL,
    [SubBroker] VARCHAR(50) NULL,
    [ClientName] VARCHAR(50) NULL,
    [RequestDate] DATETIME NULL,
    [ClientAcceptanceDate] DATETIME NULL,
    [Status] INT NULL,
    [ApprovalDate] DATETIME NULL,
    [BrokerageSlab] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCategoryMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCategoryMaster]
(
    [CategoryName] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCategoryMaster_Beenxt
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCategoryMaster_Beenxt]
(
    [CategoryName] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCreatives
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCreatives]
(
    [Creative_id] INT IDENTITY(1,1) NOT NULL,
    [CreativeName] VARCHAR(100) NULL,
    [Category] VARCHAR(100) NULL,
    [ImageName] VARCHAR(200) NULL,
    [ImagePath] VARCHAR(2000) NULL,
    [IsExpiry] VARCHAR(100) NULL,
    [ExpiryDate] DATETIME NULL,
    [Active] BIT NULL,
    [Personalised] VARCHAR(100) NULL,
    [CreativeType] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [ModifyDate] DATETIME NULL,
    [ModifyBy] VARCHAR(100) NULL,
    [IsDeleted] BIT NULL,
    [DeletedDate] DATETIME NULL,
    [Deletedby] VARCHAR(100) NULL,
    [ImageType] VARCHAR(100) NULL,
    [FestivalDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCreatives_Beenxt
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCreatives_Beenxt]
(
    [Creative_id] INT IDENTITY(1,1) NOT NULL,
    [CreativeName] VARCHAR(100) NULL,
    [Category] VARCHAR(100) NULL,
    [ImageName] VARCHAR(200) NULL,
    [ImagePath] VARCHAR(2000) NULL,
    [IsExpiry] VARCHAR(100) NULL,
    [ExpiryDate] DATETIME NULL,
    [Active] BIT NULL,
    [Personalised] VARCHAR(100) NULL,
    [CreativeType] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [ModifyDate] DATETIME NULL,
    [ModifyBy] VARCHAR(100) NULL,
    [IsDeleted] BIT NULL,
    [DeletedDate] DATETIME NULL,
    [Deletedby] VARCHAR(100) NULL,
    [ImageType] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCreativesCustom
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCreativesCustom]
(
    [Requestid] INT IDENTITY(100,1) NOT NULL,
    [sub_broker] VARCHAR(100) NULL,
    [Category] VARCHAR(100) NULL,
    [CreativeName] VARCHAR(2000) NULL,
    [Purpose] VARCHAR(5000) NULL,
    [Message] VARCHAR(5000) NULL,
    [FlagForContact] VARCHAR(10) NULL,
    [SampleImageURL] VARCHAR(500) NULL,
    [SampleImageName] VARCHAR(100) NULL,
    [ImageURL] VARCHAR(100) NULL,
    [ImageName] VARCHAR(100) NULL,
    [ExpectedDelivery] VARCHAR(100) NULL,
    [DeliveryDate] VARCHAR(100) NULL,
    [Status] VARCHAR(100) NULL,
    [Remarks] VARCHAR(5000) NULL,
    [CreateDate] DATETIME NULL,
    [createdby] VARCHAR(100) NULL,
    [modifyDate] DATETIME NULL,
    [modifyby] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCreativesCustom_Beenxt
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCreativesCustom_Beenxt]
(
    [Requestid] INT IDENTITY(100,1) NOT NULL,
    [sub_broker] VARCHAR(100) NULL,
    [Category] VARCHAR(100) NULL,
    [CreativeName] VARCHAR(2000) NULL,
    [Purpose] VARCHAR(5000) NULL,
    [Message] VARCHAR(5000) NULL,
    [FlagForContact] VARCHAR(10) NULL,
    [SampleImageURL] VARCHAR(500) NULL,
    [SampleImageName] VARCHAR(100) NULL,
    [ImageURL] VARCHAR(100) NULL,
    [ImageName] VARCHAR(100) NULL,
    [ExpectedDelivery] VARCHAR(100) NULL,
    [DeliveryDate] VARCHAR(100) NULL,
    [Status] VARCHAR(100) NULL,
    [Remarks] VARCHAR(5000) NULL,
    [CreateDate] DATETIME NULL,
    [createdby] VARCHAR(100) NULL,
    [modifyDate] DATETIME NULL,
    [modifyby] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCreativesLog
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCreativesLog]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [CreativeId] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryCreativesLog_Beenxt
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryCreativesLog_Beenxt]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [CreativeId] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryPersonalisedCreativesLog
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryPersonalisedCreativesLog]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [CreativeId] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibraryPersonalisedCreativesLog_Beenxt
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibraryPersonalisedCreativesLog_Beenxt]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [CreativeId] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibrarySubbrokerMapping
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibrarySubbrokerMapping]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [Creative_id] INT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DigitalLibrarySubbrokerMapping_Beenxt
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DigitalLibrarySubbrokerMapping_Beenxt]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [Creative_id] INT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Dormant_Client
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Dormant_Client]
(
    [Sr_no] INT IDENTITY(1,1) NOT NULL,
    [party_code] VARCHAR(50) NULL,
    [Old_AUM] NUMERIC(18, 2) NULL,
    [New_AUM] NUMERIC(18, 2) NULL,
    [AUM_Diff] NUMERIC(18, 2) NULL,
    [pnl] NUMERIC(18, 2) NULL,
    [erosion] NUMERIC(18, 2) NULL,
    [flag] INT NULL,
    [flag_category] VARCHAR(500) NULL,
    [flag_description] VARCHAR(MAX) NULL,
    [Reason] VARCHAR(500) NULL,
    [Proposed] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Dormant_Client_mapping_tmp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Dormant_Client_mapping_tmp]
(
    [Sr_no] INT NULL,
    [flag_description] VARCHAR(MAX) NULL,
    [Reason] VARCHAR(500) NULL,
    [Proposed] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Dormant_Client_New
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Dormant_Client_New]
(
    [party_code] VARCHAR(30) NOT NULL,
    [Old_AUM] MONEY NULL,
    [New_AUM] MONEY NULL,
    [AUM_Diff] MONEY NULL,
    [PNL] MONEY NULL,
    [Erosion] MONEY NULL,
    [Flag] INT NULL,
    [Flag_Category] VARCHAR(500) NULL,
    [Flag_Description] VARCHAR(1000) NULL,
    [Proposed] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Dormant_Client_tmp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Dormant_Client_tmp]
(
    [Sr_no] INT IDENTITY(1,1) NOT NULL,
    [party_code] VARCHAR(50) NULL,
    [Old_AUM] NUMERIC(18, 2) NULL,
    [New_AUM] NUMERIC(18, 2) NULL,
    [AUM_Diff] NUMERIC(18, 2) NULL,
    [pnl] NUMERIC(18, 2) NULL,
    [erosion] NUMERIC(18, 2) NULL,
    [flag] INT NULL,
    [flag_category] VARCHAR(500) NULL,
    [flag_description] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Dormant_Client_v1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Dormant_Client_v1]
(
    [Sr_no] BIGINT NOT NULL,
    [clientName] VARCHAR(10) NOT NULL,
    [dormantPrediction] VARCHAR(50) NOT NULL,
    [createdOn] SMALLDATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DRA_SBTAG
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DRA_SBTAG]
(
    [SBTag] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_DRA_SBTAG_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_DRA_SBTAG_Prev]
(
    [Sbtag] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Emp_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Emp_Master]
(
    [Emp_No] VARCHAR(15) NOT NULL,
    [Sb_Tag] VARCHAR(15) NULL,
    [First_Name] VARCHAR(50) NULL,
    [Middle_Name] VARCHAR(50) NULL,
    [Last_Name] VARCHAR(50) NULL,
    [Emp_Name] VARCHAR(150) NULL,
    [Address1] VARCHAR(1000) NULL,
    [Address2] VARCHAR(1000) NULL,
    [City] VARCHAR(25) NULL,
    [State] VARCHAR(25) NULL,
    [Pincode] VARCHAR(20) NULL,
    [Mobile] VARCHAR(50) NULL,
    [Email] VARCHAR(100) NULL,
    [Dt_ActiveFrom] DATETIME NULL,
    [isSuspended] BIT NULL DEFAULT ((0)),
    [isTerminated] BIT NULL DEFAULT ((0)),
    [Salary] DECIMAL(18, 0) NULL,
    [User_ID] VARCHAR(25) NULL,
    [Password] VARCHAR(50) NULL,
    [Dt_Updation] DATETIME NULL,
    [IP] VARCHAR(20) NULL,
    [Created_date] DATETIME NULL,
    [LandLine] VARCHAR(50) NULL,
    [isAdmin] BIT NULL DEFAULT ((0))
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Emp_Master_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Emp_Master_Prev]
(
    [Emp_No] VARCHAR(15) NOT NULL,
    [Sb_Tag] VARCHAR(15) NULL,
    [First_Name] VARCHAR(50) NULL,
    [Middle_Name] VARCHAR(50) NULL,
    [Last_Name] VARCHAR(50) NULL,
    [Emp_Name] VARCHAR(150) NULL,
    [Address1] VARCHAR(1000) NULL,
    [Address2] VARCHAR(1000) NULL,
    [City] VARCHAR(25) NULL,
    [State] VARCHAR(25) NULL,
    [Pincode] VARCHAR(20) NULL,
    [Mobile] VARCHAR(50) NULL,
    [Email] VARCHAR(100) NULL,
    [Dt_ActiveFrom] DATETIME NULL,
    [isSuspended] BIT NULL DEFAULT ((0)),
    [isTerminated] BIT NULL DEFAULT ((0)),
    [Salary] DECIMAL(18, 0) NULL,
    [User_ID] VARCHAR(25) NULL,
    [Password] VARCHAR(50) NULL,
    [Dt_Updation] DATETIME NULL,
    [IP] VARCHAR(20) NULL,
    [Created_date] DATETIME NULL,
    [LandLine] VARCHAR(50) NULL,
    [isAdmin] BIT NULL DEFAULT ((0))
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Emp_Suspension_Termination
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Emp_Suspension_Termination]
(
    [pid_tbl_Emp_Suspension_Termination] INT NULL,
    [sb_tag] VARCHAR(20) NULL,
    [Emp_no] VARCHAR(25) NULL,
    [isClientMaped] BIT NULL,
    [Suspension_Date] DATETIME NULL,
    [SuspendedBy] VARCHAR(25) NULL,
    [SuspensionEntry_Date] DATETIME NULL,
    [isSuspended] BIT NULL,
    [Termination_Date] DATETIME NULL,
    [TerminatedBy] VARCHAR(25) NULL,
    [TerminationEntry_Date] DATETIME NULL,
    [isTerminated] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Emp_Suspension_Termination_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Emp_Suspension_Termination_Prev]
(
    [pid_tbl_Emp_Suspension_Termination] INT NULL,
    [sb_tag] VARCHAR(20) NULL,
    [Emp_no] VARCHAR(25) NULL,
    [isClientMaped] BIT NULL,
    [Suspension_Date] DATETIME NULL,
    [SuspendedBy] VARCHAR(25) NULL,
    [SuspensionEntry_Date] DATETIME NULL,
    [isSuspended] BIT NULL,
    [Termination_Date] DATETIME NULL,
    [TerminatedBy] VARCHAR(25) NULL,
    [TerminationEntry_Date] DATETIME NULL,
    [isTerminated] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_FlatFileDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_FlatFileDetails]
(
    [sr_no] BIGINT IDENTITY(1,1) NOT NULL,
    [keyword] VARCHAR(50) NOT NULL,
    [modifiedDate] DATETIME NOT NULL,
    [tablename] VARCHAR(100) NULL,
    [CreatedOn] DATETIME NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_FourDigitPIN_NXT2_Mobile
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_FourDigitPIN_NXT2_Mobile]
(
    [ID] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(20) NULL,
    [PIN] VARCHAR(4) NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Get_DailyActivation_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Get_DailyActivation_Details]
(
    [Sub_Broker] VARCHAR(2000) NULL,
    [Total_ActiveSB] INT NULL,
    [Total_Cnt] INT NULL,
    [AR] NUMERIC(18, 2) NULL,
    [Client_Age_Year] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Get_DailyActivation_Details_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Get_DailyActivation_Details_Prev]
(
    [Sub_Broker] VARCHAR(2000) NULL,
    [Total_ActiveSB] INT NULL,
    [Total_Cnt] INT NULL,
    [AR] NUMERIC(18, 2) NULL,
    [Client_Age_Year] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IPartner_amplispot_config
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IPartner_amplispot_config]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [configType] VARCHAR(20) NULL,
    [url] VARCHAR(200) NULL,
    [client_secret] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IPartner_SB_SocialMedia_Comments
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IPartner_SB_SocialMedia_Comments]
(
    [Post_id] BIGINT NULL,
    [Comment_user_id] VARCHAR(100) NULL,
    [Comment_person_name] VARCHAR(100) NULL,
    [Message_id] VARCHAR(200) NULL,
    [Message_Description] VARCHAR(500) NULL,
    [Commented_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IPartner_SB_SocialMedia_Comments_History
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IPartner_SB_SocialMedia_Comments_History]
(
    [Post_id] BIGINT NULL,
    [Comment_user_id] VARCHAR(100) NULL,
    [Comment_person_name] VARCHAR(100) NULL,
    [Message_id] VARCHAR(200) NULL,
    [Message_Description] VARCHAR(500) NULL,
    [Commented_on] DATETIME NULL,
    [Flag] CHAR(1) NOT NULL,
    [CreatedOn] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IPartner_SB_SocialMedia_Comments_Tmp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IPartner_SB_SocialMedia_Comments_Tmp]
(
    [Post_id] BIGINT NULL,
    [Comment_user_id] VARCHAR(100) NULL,
    [Comment_person_name] VARCHAR(100) NULL,
    [Message_id] VARCHAR(200) NULL,
    [Message_Description] VARCHAR(500) NULL,
    [Commented_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IPartner_SB_SocialMedia_Reactions_History
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IPartner_SB_SocialMedia_Reactions_History]
(
    [Post_id] BIGINT NULL,
    [Reacted_user_id] VARCHAR(100) NULL,
    [Reacted_person_name] VARCHAR(100) NULL,
    [Reaction_type] VARCHAR(50) NULL,
    [Flag] CHAR(1) NOT NULL,
    [CreatedOn] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MandateNotificationBeeNXTHist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MandateNotificationBeeNXTHist]
(
    [sub_broker] VARCHAR(100) NULL,
    [sClientCode] VARCHAR(100) NULL,
    [Mandateid] VARCHAR(100) NULL,
    [InsertedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Material_Sub_TypeModel
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Material_Sub_TypeModel]
(
    [MSId] INT IDENTITY(1,1) NOT NULL,
    [MSType] VARCHAR(100) NULL,
    [MSSize] VARCHAR(500) NULL,
    [MSCustomsize] VARCHAR(500) NULL,
    [MSCost] DECIMAL(9, 2) NULL,
    [TargetKYC] INT NULL,
    [Targetmonth] VARCHAR(100) NULL,
    [MSImage] VARCHAR(500) NULL,
    [MId] INT NULL,
    [Quantity] VARCHAR(100) NULL,
    [Width] VARCHAR(100) NULL,
    [Height] VARCHAR(100) NULL,
    [Mtype] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MigrationClientPledge
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MigrationClientPledge]
(
    [Party_code] VARCHAR(200) NULL,
    [ActionDate] DATETIME NULL,
    [CommunicationDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MigrationClientPledge_new
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MigrationClientPledge_new]
(
    [Party_code] VARCHAR(200) NULL,
    [ActionDate] DATE NULL,
    [CommunicationDate] DATE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MigrationClientPledge_Status
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MigrationClientPledge_Status]
(
    [party_code] VARCHAR(100) NULL,
    [status] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mobLoginDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mobLoginDetails]
(
    [ID] INT NOT NULL,
    [UserId] VARCHAR(100) NULL,
    [SessionId] VARCHAR(300) NULL,
    [LastLogin] DATETIME NULL,
    [Location] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mobLoginDetails_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mobLoginDetails_Prev]
(
    [ID] INT NOT NULL,
    [UserId] VARCHAR(100) NULL,
    [SessionId] VARCHAR(300) NULL,
    [LastLogin] DATETIME NULL,
    [Location] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mtf_status
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mtf_status]
(
    [Party_Code] VARCHAR(10) NOT NULL,
    [MTF_From_Date] DATETIME NOT NULL,
    [MTF_Status] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mtf_status_Bkp23Sept2019
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mtf_status_Bkp23Sept2019]
(
    [Party_Code] VARCHAR(10) NOT NULL,
    [MTF_From_Date] DATETIME NOT NULL,
    [MTF_Status] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_NewPOA
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_NewPOA]
(
    [PARTY_CODE] VARCHAR(10) NOT NULL,
    [upd_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_noc_mail
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_noc_mail]
(
    [UPDATE_ON] VARCHAR(20) NULL,
    [BRANCH] VARCHAR(10) NULL,
    [Date] VARCHAR(20) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [Segment] VARCHAR(6) NOT NULL,
    [Naturecode] INT NOT NULL,
    [Narration] VARCHAR(97) NULL,
    [TDS] VARCHAR(1) NOT NULL,
    [GST] VARCHAR(4) NOT NULL,
    [IsPropCode] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NotificationBEENXT
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NotificationBEENXT]
(
    [NotificationID] INT IDENTITY(1,1) NOT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [Individualview] VARCHAR(2) NULL,
    [IndividualviewDate] DATETIME NULL,
    [Notification_9] VARCHAR(2) NULL,
    [Notification_Date_9] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdatedDate] DATETIME NULL,
    [CLTCODEDupl] VARCHAR(8000) NULL,
    [url] VARCHAR(MAX) NULL,
    [area] VARCHAR(200) NULL,
    [controller] VARCHAR(200) NULL,
    [action] VARCHAR(200) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [areaname] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NotificationBeeNXT_Bkp29July2019
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NotificationBeeNXT_Bkp29July2019]
(
    [NotificationID] INT IDENTITY(1,1) NOT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [Individualview] VARCHAR(2) NULL,
    [IndividualviewDate] DATETIME NULL,
    [Notification_9] VARCHAR(2) NULL,
    [Notification_Date_9] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdatedDate] DATETIME NULL,
    [CLTCODEDupl] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NotificationNXT
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NotificationNXT]
(
    [NotificationID] INT IDENTITY(1,1) NOT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [Individualview] VARCHAR(2) NULL,
    [IndividualviewDate] DATETIME NULL,
    [Notification_9] VARCHAR(2) NULL,
    [Notification_Date_9] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdatedDate] DATETIME NULL,
    [CLTCODEDupl] VARCHAR(8000) NULL,
    [URL] VARCHAR(8000) NULL,
    [area] VARCHAR(80) NULL,
    [controller] VARCHAR(80) NULL,
    [action] VARCHAR(80) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [areaname] VARCHAR(50) NULL,
    [IsInActive] BIT NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryDate] DATE NULL,
    [ExpiryTime] TIME NULL,
    [QueryParameter] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NotificationNXT_testing
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NotificationNXT_testing]
(
    [NotificationID] INT IDENTITY(1,1) NOT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [Individualview] VARCHAR(2) NULL,
    [IndividualviewDate] DATETIME NULL,
    [Notification_9] VARCHAR(2) NULL,
    [Notification_Date_9] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdatedDate] DATETIME NULL,
    [CLTCODEDupl] VARCHAR(8000) NULL,
    [URL] VARCHAR(8000) NULL,
    [area] VARCHAR(80) NULL,
    [controller] VARCHAR(80) NULL,
    [action] VARCHAR(80) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [areaname] VARCHAR(50) NULL,
    [IsInActive] BIT NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryDate] DATE NULL,
    [ExpiryTime] TIME NULL,
    [QueryParameter] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NotificationNXT_Yasmin
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NotificationNXT_Yasmin]
(
    [NotificationID] INT IDENTITY(1,1) NOT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [Individualview] VARCHAR(2) NULL,
    [IndividualviewDate] DATETIME NULL,
    [Notification_9] VARCHAR(2) NULL,
    [Notification_Date_9] DATETIME NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] VARCHAR(200) NULL,
    [UpdatedDate] DATETIME NULL,
    [CLTCODEDupl] VARCHAR(8000) NULL,
    [URL] VARCHAR(8000) NULL,
    [area] VARCHAR(80) NULL,
    [controller] VARCHAR(80) NULL,
    [action] VARCHAR(80) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [areaname] VARCHAR(50) NULL,
    [IsInActive] BIT NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryDate] DATE NULL,
    [ExpiryTime] TIME NULL,
    [QueryParameter] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NXT_CustomPlan
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NXT_CustomPlan]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SlabNumber] NVARCHAR(50) NULL,
    [CashSegment_Intraday_EachSide] NVARCHAR(50) NULL,
    [CashSegment_Delivery_Brokerage] NVARCHAR(50) NULL,
    [FO_Nifty] NVARCHAR(50) NULL,
    [FO_Future] NVARCHAR(50) NULL,
    [FO_DB] NVARCHAR(50) NULL,
    [Currency_Future] NVARCHAR(50) NULL,
    [Currency_FutureDB] NVARCHAR(50) NULL,
    [FO_Option_Premium] NVARCHAR(50) NULL,
    [Commodity] NVARCHAR(50) NULL,
    [Commodity_DB] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_NXTMobilePopup
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_NXTMobilePopup]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [Popup_Type] VARCHAR(100) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [Index] TINYINT NULL,
    [ImagePath] VARCHAR(MAX) NULL,
    [ImageName] VARCHAR(MAX) NULL,
    [ExpiryDate] DATE NULL,
    [Redirect_Url] VARCHAR(1000) NULL,
    [Active] VARCHAR(3) NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [ModifyBy] NVARCHAR(100) NULL,
    [ModifyDate] DATETIME NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryTime] TIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_NXTMobilePopupSbTagMap
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_NXTMobilePopupSbTagMap]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Popup_Id] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_PartyTickerIndex
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_PartyTickerIndex]
(
    [Access_Code] VARCHAR(50) NULL,
    [Symbol] VARCHAR(200) NULL,
    [sActive] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_pledege_mtf_data_log
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_pledege_mtf_data_log]
(
    [party_code] VARCHAR(25) NULL,
    [createdDate] DATETIME NULL,
    [start_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Pledge_Mapping
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Pledge_Mapping]
(
    [Sr_no] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(10) NULL,
    [Communique_date] DATETIME NULL,
    [Pldg_Req_Date] DATETIME NULL,
    [Pldg_Exec_date] DATETIME NULL,
    [Mtf_Communique_date] DATETIME NULL,
    [Mtf_Pld_Date] DATETIME NULL,
    [Mtf_Pldg_Exec_date] DATETIME NULL,
    [Valid] VARCHAR(1) NULL,
    [Remarks] VARCHAR(50) NULL,
    [Dummy1] VARCHAR(10) NULL,
    [Dummy2] VARCHAR(10) NULL,
    [Dummy3] VARCHAR(10) NULL,
    [b2c] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Pledge_Mapping_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Pledge_Mapping_Prev]
(
    [Sr_no] INT IDENTITY(1,1) NOT NULL,
    [Party_code] VARCHAR(10) NULL,
    [Communique_date] DATETIME NULL,
    [Pldg_Req_Date] DATETIME NULL,
    [Pldg_Exec_date] DATETIME NULL,
    [Mtf_Communique_date] DATETIME NULL,
    [Mtf_Pld_Date] DATETIME NULL,
    [Mtf_Pldg_Exec_date] DATETIME NULL,
    [Valid] VARCHAR(1) NULL,
    [Remarks] VARCHAR(50) NULL,
    [Dummy1] VARCHAR(10) NULL,
    [Dummy2] VARCHAR(10) NULL,
    [Dummy3] VARCHAR(10) NULL,
    [b2c] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_pledgeOTPGeneration
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_pledgeOTPGeneration]
(
    [party_code] VARCHAR(100) NULL,
    [otp] INT NULL,
    [Entrydate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp04Aug2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp04Aug2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp04Aug2021_12_14PM
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp04Aug2021_12_14PM]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_bkp15Nov2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_bkp15Nov2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_bkp16Nov2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_bkp16Nov2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp20Jan2022
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp20Jan2022]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp26Nov2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp26Nov2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp30Aug2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp30Aug2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp31Aug2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp31Aug2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp31Dec2021
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Bkp31Dec2021]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_POA_PLD_ADNL_Pledge_Mtf_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_POA_PLD_ADNL_Pledge_Mtf_Prev]
(
    [PARTY_CODE] VARCHAR(100) NULL,
    [SCRIP_CD] VARCHAR(100) NULL,
    [CERTNO] VARCHAR(100) NULL,
    [DPID] VARCHAR(100) NULL,
    [EXEDATE] DATETIME NULL,
    [CLTDPID] VARCHAR(100) NULL,
    [SUCCESSFLAG] VARCHAR(100) NULL,
    [SUCCESSFLAG_Converted] VARCHAR(100) NULL,
    [PAYQTY] FLOAT NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Start_date] DATETIME NULL,
    [End_Date] DATETIME NULL,
    [UpdatedDate] DATETIME NULL,
    [QTY] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_PopupAdmin
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_PopupAdmin]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [Index] TINYINT NULL,
    [ImagePath] VARCHAR(MAX) NULL,
    [ImageName] VARCHAR(MAX) NULL,
    [ExpiryDate] DATE NULL,
    [Redirect_Url] VARCHAR(1000) NULL,
    [Project_Type] VARCHAR(100) NULL,
    [Active] VARCHAR(3) NULL,
    [CreatedDate] DATETIME NULL,
    [Createdby] VARCHAR(100) NULL,
    [ModifyDate] DATETIME NULL,
    [Popup_Type] VARCHAR(100) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [OpenInNewTab] BIT NULL,
    [ModifyBy] NVARCHAR(100) NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryTime] TIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_PopupSbTagMap
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_PopupSbTagMap]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [PopupId] INT NOT NULL,
    [SbTag] VARCHAR(100) NOT NULL,
    [Active] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_QSipMandateStatusDetails_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_QSipMandateStatusDetails_Log]
(
    [ClientCode] VARCHAR(50) NULL,
    [sMandateID] VARCHAR(100) NULL,
    [sMandateRefNO] VARCHAR(50) NULL,
    [sMandateStatus] VARCHAR(150) NULL,
    [InsertedOn] DATETIME NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RMS_COLLECTION_CLI
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RMS_COLLECTION_CLI]
(
    [Party_Code] VARCHAR(10) NOT NULL,
    [Cash] MONEY NULL,
    [Derivatives] MONEY NULL,
    [Currency] MONEY NULL,
    [Commodities] MONEY NULL,
    [DP] MONEY NULL,
    [NBFC] MONEY NULL,
    [ABL_Net] MONEY NULL,
    [ACBL_Net] MONEY NULL,
    [NBFC_Net] MONEY NULL,
    [Deposit] MONEY NULL,
    [Net_Debit] MONEY NULL,
    [Net_Available] MONEY NULL,
    [BSE_Ledger] MONEY NULL,
    [NSE_Ledger] MONEY NULL,
    [NSEFO_Ledger] MONEY NULL,
    [MCD_Ledger] MONEY NULL,
    [NSX_Ledger] MONEY NULL,
    [MCX_Ledger] MONEY NULL,
    [NCDEX_Ledger] MONEY NULL,
    [NBFC_Ledger] MONEY NULL,
    [Net_Ledger] MONEY NULL,
    [UnReco_Credit] MONEY NULL,
    [Hold_BlueChip] MONEY NULL,
    [Hold_Good] MONEY NULL,
    [Hold_Poor] MONEY NULL,
    [Hold_Junk] MONEY NULL,
    [Hold_Total] MONEY NULL,
    [Hold_TotalHC] MONEY NULL,
    [Coll_NSEFO] MONEY NULL,
    [Coll_MCD] MONEY NULL,
    [Coll_NSX] MONEY NULL,
    [Coll_MCX] MONEY NULL,
    [Coll_NCDEX] MONEY NULL,
    [Coll_Total] MONEY NULL,
    [Coll_TotalHC] MONEY NULL,
    [Exp_NSEFO] MONEY NULL,
    [Exp_MCD] MONEY NULL,
    [Exp_NSX] MONEY NULL,
    [Exp_MCX] MONEY NULL,
    [Exp_NCDEX] MONEY NULL,
    [Exp_Cash] MONEY NULL,
    [Exp_Gross] MONEY NULL,
    [Margin_NSEFO] MONEY NULL,
    [Margin_MCD] MONEY NULL,
    [Margin_NSX] MONEY NULL,
    [Margin_MCX] MONEY NULL,
    [Margin_NCDEX] MONEY NULL,
    [Margin_Total] MONEY NULL,
    [Margin_Shortage] MONEY NULL,
    [Margin_Violation] MONEY NULL,
    [MOS] MONEY NULL,
    [Pure_Risk] MONEY NULL,
    [SB_CrAdjwithPureRisk] MONEY NULL,
    [Proj_Risk] MONEY NULL,
    [SB_CrAdjwithProjRisk] MONEY NULL,
    [SB_Cr_Adjusted] MONEY NULL,
    [UB_Loss] MONEY NULL,
    [CashColl_Total] MONEY NULL,
    [Debit_Days] INT NULL,
    [Last_Bill_Date] DATETIME NULL,
    [Report_Type] VARCHAR(10) NULL,
    [RiskCategory] VARCHAR(10) NULL,
    [Net_Collection] MONEY NULL,
    [Gross_Collection] MONEY NULL,
    [Gross_Collection_Perc] MONEY NULL,
    [Risk_Inc_Dec] MONEY NULL,
    [Risk_Inc_Dec_Perc] MONEY NULL,
    [Pure_Net_Collection] MONEY NULL,
    [Proj_Net_Collection] MONEY NULL,
    [BSX_Ledger] MONEY NULL,
    [Coll_BSX] MONEY NULL,
    [Exp_BSX] MONEY NULL,
    [Margin_BSX] MONEY NULL,
    [MTF_Ledger] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_rms_collection_cli_NXT
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_rms_collection_cli_NXT]
(
    [party_code] VARCHAR(10) NOT NULL,
    [net_ledger] MONEY NULL,
    [upd_date] DATETIME NOT NULL,
    [ledgerBal] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_rms_collection_cli_NXT_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_rms_collection_cli_NXT_Prev]
(
    [party_code] VARCHAR(10) NULL,
    [net_ledger] MONEY NULL,
    [upd_date] DATETIME NOT NULL,
    [ledgerBal] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RMS_COLLECTION_CLI_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RMS_COLLECTION_CLI_Prev]
(
    [Party_Code] VARCHAR(10) NOT NULL,
    [Cash] MONEY NULL,
    [Derivatives] MONEY NULL,
    [Currency] MONEY NULL,
    [Commodities] MONEY NULL,
    [DP] MONEY NULL,
    [NBFC] MONEY NULL,
    [ABL_Net] MONEY NULL,
    [ACBL_Net] MONEY NULL,
    [NBFC_Net] MONEY NULL,
    [Deposit] MONEY NULL,
    [Net_Debit] MONEY NULL,
    [Net_Available] MONEY NULL,
    [BSE_Ledger] MONEY NULL,
    [NSE_Ledger] MONEY NULL,
    [NSEFO_Ledger] MONEY NULL,
    [MCD_Ledger] MONEY NULL,
    [NSX_Ledger] MONEY NULL,
    [MCX_Ledger] MONEY NULL,
    [NCDEX_Ledger] MONEY NULL,
    [NBFC_Ledger] MONEY NULL,
    [Net_Ledger] MONEY NULL,
    [UnReco_Credit] MONEY NULL,
    [Hold_BlueChip] MONEY NULL,
    [Hold_Good] MONEY NULL,
    [Hold_Poor] MONEY NULL,
    [Hold_Junk] MONEY NULL,
    [Hold_Total] MONEY NULL,
    [Hold_TotalHC] MONEY NULL,
    [Coll_NSEFO] MONEY NULL,
    [Coll_MCD] MONEY NULL,
    [Coll_NSX] MONEY NULL,
    [Coll_MCX] MONEY NULL,
    [Coll_NCDEX] MONEY NULL,
    [Coll_Total] MONEY NULL,
    [Coll_TotalHC] MONEY NULL,
    [Exp_NSEFO] MONEY NULL,
    [Exp_MCD] MONEY NULL,
    [Exp_NSX] MONEY NULL,
    [Exp_MCX] MONEY NULL,
    [Exp_NCDEX] MONEY NULL,
    [Exp_Cash] MONEY NULL,
    [Exp_Gross] MONEY NULL,
    [Margin_NSEFO] MONEY NULL,
    [Margin_MCD] MONEY NULL,
    [Margin_NSX] MONEY NULL,
    [Margin_MCX] MONEY NULL,
    [Margin_NCDEX] MONEY NULL,
    [Margin_Total] MONEY NULL,
    [Margin_Shortage] MONEY NULL,
    [Margin_Violation] MONEY NULL,
    [MOS] MONEY NULL,
    [Pure_Risk] MONEY NULL,
    [SB_CrAdjwithPureRisk] MONEY NULL,
    [Proj_Risk] MONEY NULL,
    [SB_CrAdjwithProjRisk] MONEY NULL,
    [SB_Cr_Adjusted] MONEY NULL,
    [UB_Loss] MONEY NULL,
    [CashColl_Total] MONEY NULL,
    [Debit_Days] INT NULL,
    [Last_Bill_Date] DATETIME NULL,
    [Report_Type] VARCHAR(10) NULL,
    [RiskCategory] VARCHAR(10) NULL,
    [Net_Collection] MONEY NULL,
    [Gross_Collection] MONEY NULL,
    [Gross_Collection_Perc] MONEY NULL,
    [Risk_Inc_Dec] MONEY NULL,
    [Risk_Inc_Dec_Perc] MONEY NULL,
    [Pure_Net_Collection] MONEY NULL,
    [Proj_Net_Collection] MONEY NULL,
    [BSX_Ledger] MONEY NULL,
    [Coll_BSX] MONEY NULL,
    [Exp_BSX] MONEY NULL,
    [Margin_BSX] MONEY NULL,
    [MTF_Ledger] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MarginRestore
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MarginRestore]
(
    [update_date] DATETIME NULL,
    [region] VARCHAR(255) NULL,
    [branch] VARCHAR(10) NULL,
    [sb] VARCHAR(10) NULL,
    [party_Code] VARCHAR(10) NULL,
    [opcode] VARCHAR(10) NULL,
    [party_name] VARCHAR(100) NULL,
    [clitype] CHAR(3) NULL,
    [Net Credit] MONEY NULL,
    [Funds Payout] MONEY NULL,
    [Blocked Funds] MONEY NULL,
    [Holding Value] MONEY NULL,
    [Payout value] MONEY NULL,
    [Segment] VARCHAR(10) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MarginRetention_PREV
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MarginRetention_PREV]
(
    [Zone] VARCHAR(20) NULL,
    [Region] VARCHAR(20) NULL,
    [Branch] VARCHAR(10) NULL,
    [SB] VARCHAR(10) NULL,
    [Client] VARCHAR(15) NULL,
    [Party_Name] VARCHAR(100) NULL,
    [CliType] VARCHAR(10) NULL,
    [SCCS_SettDate_Last] VARCHAR(20) NULL,
    [DaysAhead] INT NULL,
    [old_code] VARCHAR(30) NULL,
    [CreatedDate] DATETIME NULL DEFAULT (getdate()),
    [UpdatedDate] DATETIME NULL,
    [FundsPayout] MONEY NULL,
    [Segment] VARCHAR(10) NULL,
    [PayoutValue] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MonthlyRevenue
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MonthlyRevenue]
(
    [sub_broker] VARCHAR(50) NOT NULL,
    [Segment] VARCHAR(50) NOT NULL,
    [Trade_Month] DATETIME NULL,
    [Total_Clients] INT NULL,
    [Traded_Clients] INT NULL,
    [Total_Traded_Client_Days] INT NULL,
    [Gross_Revenue] DECIMAL(38, 10) NULL,
    [NettoSB_Revenue] DECIMAL(38, 10) NULL,
    [NetBrok_Revenue] DECIMAL(38, 10) NULL,
    [TradedDays] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MyClient_GetClientDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MyClient_GetClientDetails]
(
    [sub_broker] VARCHAR(10) NOT NULL,
    [Total_Client] INT NULL,
    [Active_Client_PastYears] INT NOT NULL,
    [Inactive_Client_PastYears] INT NOT NULL,
    [Traded_Client] INT NOT NULL,
    [NotTraded_Yesterday] INT NOT NULL,
    [Never_Traded] INT NOT NULL,
    [ArqEnRoll_Client] INT NOT NULL,
    [MTFRegistered] INT NOT NULL,
    [MFBoughtClients] INT NOT NULL,
    [NotTraded_Past30Days] INT NOT NULL,
    [New_Client_NotTraded_Past7days] INT NOT NULL,
    [Comm_Active_Past30Days] INT NOT NULL,
    [Curr_Active_Past30Days] INT NOT NULL,
    [EQ_Active_Past30Days] INT NOT NULL,
    [FO_Active_Past30Days] INT NOT NULL,
    [Dorment_Client] INT NOT NULL,
    [ClientUnderRisk] INT NOT NULL,
    [Clients_Rebalance_Due] INT NOT NULL,
    [UpdateDate] SMALLDATETIME NULL,
    [Active_Past30Days] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MyClient_GetClientDetails_Bkp06Dec2021
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MyClient_GetClientDetails_Bkp06Dec2021]
(
    [sub_broker] VARCHAR(10) NOT NULL,
    [Total_Client] INT NULL,
    [Active_Client_PastYears] INT NOT NULL,
    [Inactive_Client_PastYears] INT NOT NULL,
    [Traded_Client] INT NOT NULL,
    [NotTraded_Yesterday] INT NOT NULL,
    [Never_Traded] INT NOT NULL,
    [ArqEnRoll_Client] INT NOT NULL,
    [MTFRegistered] INT NOT NULL,
    [MFBoughtClients] INT NOT NULL,
    [NotTraded_Past30Days] INT NOT NULL,
    [New_Client_NotTraded_Past7days] INT NOT NULL,
    [Comm_Active_Past30Days] INT NOT NULL,
    [Curr_Active_Past30Days] INT NOT NULL,
    [EQ_Active_Past30Days] INT NOT NULL,
    [FO_Active_Past30Days] INT NOT NULL,
    [Dorment_Client] INT NOT NULL,
    [ClientUnderRisk] INT NOT NULL,
    [Clients_Rebalance_Due] INT NOT NULL,
    [UpdateDate] SMALLDATETIME NULL,
    [Active_Past30Days] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MyClient_GetClientDetails_Bkp15June2021
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MyClient_GetClientDetails_Bkp15June2021]
(
    [sub_broker] VARCHAR(10) NOT NULL,
    [Total_Client] INT NULL,
    [Active_Client_PastYears] INT NOT NULL,
    [Inactive_Client_PastYears] INT NOT NULL,
    [Traded_Client] INT NOT NULL,
    [NotTraded_Yesterday] INT NOT NULL,
    [Never_Traded] INT NOT NULL,
    [ArqEnRoll_Client] INT NOT NULL,
    [MTFRegistered] INT NOT NULL,
    [MFBoughtClients] INT NOT NULL,
    [NotTraded_Past30Days] INT NOT NULL,
    [New_Client_NotTraded_Past7days] INT NOT NULL,
    [Comm_Active_Past30Days] INT NOT NULL,
    [Curr_Active_Past30Days] INT NOT NULL,
    [EQ_Active_Past30Days] INT NOT NULL,
    [FO_Active_Past30Days] INT NOT NULL,
    [Dorment_Client] INT NOT NULL,
    [ClientUnderRisk] INT NOT NULL,
    [Clients_Rebalance_Due] INT NOT NULL,
    [UpdateDate] SMALLDATETIME NULL,
    [Active_Past30Days] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MyClient_GetClientDetails_bkup_20042021
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MyClient_GetClientDetails_bkup_20042021]
(
    [sub_broker] VARCHAR(10) NOT NULL,
    [Total_Client] INT NULL,
    [Active_Client_PastYears] INT NOT NULL,
    [Inactive_Client_PastYears] INT NOT NULL,
    [Traded_Client] INT NOT NULL,
    [NotTraded_Yesterday] INT NOT NULL,
    [Never_Traded] INT NOT NULL,
    [ArqEnRoll_Client] INT NOT NULL,
    [MTFRegistered] INT NOT NULL,
    [MFBoughtClients] INT NOT NULL,
    [NotTraded_Past30Days] INT NOT NULL,
    [New_Client_NotTraded_Past7days] INT NOT NULL,
    [Comm_Active_Past30Days] INT NOT NULL,
    [Curr_Active_Past30Days] INT NOT NULL,
    [EQ_Active_Past30Days] INT NOT NULL,
    [FO_Active_Past30Days] INT NOT NULL,
    [Dorment_Client] INT NOT NULL,
    [ClientUnderRisk] INT NOT NULL,
    [Clients_Rebalance_Due] INT NOT NULL,
    [UpdateDate] SMALLDATETIME NULL,
    [Active_Past30Days] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MyClient_GetClientDetails_Dealer
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MyClient_GetClientDetails_Dealer]
(
    [sub_broker] VARCHAR(500) NULL,
    [Total_Client] INT NULL,
    [Active_Client_PastYears] INT NOT NULL,
    [Inactive_Client_PastYears] INT NOT NULL,
    [Traded_Client] INT NOT NULL,
    [NotTraded_Yesterday] INT NOT NULL,
    [Never_Traded] INT NOT NULL,
    [ArqEnRoll_Client] INT NOT NULL,
    [MTFRegistered] INT NOT NULL,
    [MFBoughtClients] INT NOT NULL,
    [NotTraded_Past30Days] INT NOT NULL,
    [New_Client_NotTraded_Past7days] INT NOT NULL,
    [Comm_Active_Past30Days] INT NOT NULL,
    [Curr_Active_Past30Days] INT NOT NULL,
    [EQ_Active_Past30Days] INT NOT NULL,
    [FO_Active_Past30Days] INT NOT NULL,
    [Dorment_Client] INT NOT NULL,
    [ClientUnderRisk] INT NOT NULL,
    [Clients_Rebalance_Due] INT NOT NULL,
    [UpdateDate] DATETIME NULL,
    [Active_Past30Days] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_MyClient_GetClientDetails_Dealer_Bkp09Jun2022
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_MyClient_GetClientDetails_Dealer_Bkp09Jun2022]
(
    [sub_broker] VARCHAR(500) NULL,
    [Total_Client] INT NULL,
    [Active_Client_PastYears] INT NOT NULL,
    [Inactive_Client_PastYears] INT NOT NULL,
    [Traded_Client] INT NOT NULL,
    [NotTraded_Yesterday] INT NOT NULL,
    [Never_Traded] INT NOT NULL,
    [ArqEnRoll_Client] INT NOT NULL,
    [MTFRegistered] INT NOT NULL,
    [MFBoughtClients] INT NOT NULL,
    [NotTraded_Past30Days] INT NOT NULL,
    [New_Client_NotTraded_Past7days] INT NOT NULL,
    [Comm_Active_Past30Days] INT NOT NULL,
    [Curr_Active_Past30Days] INT NOT NULL,
    [EQ_Active_Past30Days] INT NOT NULL,
    [FO_Active_Past30Days] INT NOT NULL,
    [Dorment_Client] INT NOT NULL,
    [ClientUnderRisk] INT NOT NULL,
    [Clients_Rebalance_Due] INT NOT NULL,
    [UpdateDate] DATETIME NULL,
    [Active_Past30Days] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SBAccess
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SBAccess]
(
    [RecID] INT IDENTITY(1,1) NOT NULL,
    [SBTAG] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL,
    [UpdatedBy] VARCHAR(50) NULL,
    [UpdatedDT] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SBAccess_bkup_22_oct_2021
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SBAccess_bkup_22_oct_2021]
(
    [RecID] INT IDENTITY(1,1) NOT NULL,
    [SBTAG] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL,
    [UpdatedBy] VARCHAR(50) NULL,
    [UpdatedDT] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SBAccess_bkup_26Aug2021
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SBAccess_bkup_26Aug2021]
(
    [RecID] INT IDENTITY(1,1) NOT NULL,
    [SBTAG] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL,
    [UpdatedBy] VARCHAR(50) NULL,
    [UpdatedDT] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SBCategoryContactDtls
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SBCategoryContactDtls]
(
    [RecID] INT IDENTITY(1,1) NOT NULL,
    [SBCategory] VARCHAR(50) NULL,
    [RMS] VARCHAR(50) NULL,
    [Dealing] VARCHAR(50) NULL,
    [Partners] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedDT] DATETIME NULL,
    [UpdatedBy] VARCHAR(50) NULL,
    [UpdatedDT] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SBLastTradeDate
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SBLastTradeDate]
(
    [Sub_Broker] VARCHAR(50) NOT NULL,
    [Sauda_Date] SMALLDATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_SBReportPinnedMapping_NXT2_Mobile
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_SBReportPinnedMapping_NXT2_Mobile]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(20) NULL,
    [ReportID] INT NULL,
    [CreatedBy] VARCHAR(20) NULL,
    [CreatedDate] DATETIME NULL,
    [IsPinned] BIT NULL,
    [ModifiedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_schemeMaster_NXT2_Mobile
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_schemeMaster_NXT2_Mobile]
(
    [SchemeID] BIGINT IDENTITY(1,1) NOT NULL,
    [SchemeName] VARCHAR(500) NULL,
    [SchemeType] VARCHAR(50) NULL,
    [StartDate] DATETIME NULL,
    [EndDte] DATETIME NULL,
    [SchemeImage] VARCHAR(500) NULL,
    [CreatedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [IsActive] BIT NULL,
    [ModifiedDate] DATETIME NULL,
    [ModifiedBy] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_SMSQUEUE_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_SMSQUEUE_Log]
(
    [party_code] VARCHAR(50) NULL,
    [SentFrom] VARCHAR(50) NULL,
    [ServiceName] VARCHAR(50) NULL,
    [MobileNo] VARCHAR(50) NULL,
    [Message] VARCHAR(4000) NULL,
    [DeliveryAckRequired] CHAR(1) NULL,
    [TransmissionTime] DATETIME NULL,
    [SMSSentStatus] CHAR(1) NULL,
    [TokenID] VARCHAR(50) NULL,
    [MessageType] VARCHAR(10) NULL,
    [IsTransactionalSMS] CHAR(1) NULL,
    [IsDNDNumber] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SparsaDtls
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SparsaDtls]
(
    [RecId] INT IDENTITY(1,1) NOT NULL,
    [SBTAG] VARCHAR(50) NULL,
    [FCMKey] VARCHAR(8000) NULL,
    [StatusFlag] VARCHAR(10) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] DATETIME NULL,
    [UpdatedBy] VARCHAR(50) NULL,
    [UpdatedDT] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SubBrokerAuditQustionMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SubBrokerAuditQustionMaster]
(
    [nId] INT IDENTITY(1,1) NOT NULL,
    [sQuestion] VARCHAR(MAX) NULL,
    [sStatus] CHAR(1) NULL,
    [dtCreationDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_TargetsandRewards_NXT2_Mobile
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_TargetsandRewards_NXT2_Mobile]
(
    [TargetID] BIGINT IDENTITY(1,1) NOT NULL,
    [OfferID] BIGINT NOT NULL,
    [TargetCount] INT NULL,
    [TargetAmount] INT NULL,
    [RewardAmount] INT NULL,
    [RewardGift] VARCHAR(500) NULL,
    [CreaetedDate] DATETIME NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [IsActive] BIT NULL,
    [ModifiedDate] DATETIME NULL,
    [ModifiedBy] VARCHAR(50) NULL,
    [IsTargetAchieved] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_TRADING_DATA_TRACK
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_TRADING_DATA_TRACK]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [FRM_DATE] DATE NOT NULL,
    [TO_DATE] DATE NOT NULL,
    [STATUS] VARCHAR(20) NOT NULL,
    [ROW_CNT] INT NOT NULL,
    [PROCESS_START_DATE] DATETIME NOT NULL,
    [PROCESS_END_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Weekly_GenerateFile
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Weekly_GenerateFile]
(
    [SB tag] VARCHAR(50) NULL,
    [Access Date/Time] VARCHAR(50) NULL,
    [IPadress] VARCHAR(50) NULL,
    [Report Type] VARCHAR(50) NULL,
    [Report SubType] VARCHAR(50) NULL,
    [Report path] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Weekly_GenerateFile_BeeNXT
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Weekly_GenerateFile_BeeNXT]
(
    [SB tag] VARCHAR(50) NULL,
    [Access Date/Time] VARCHAR(50) NULL,
    [IPadress] VARCHAR(50) NULL,
    [Report Type] VARCHAR(50) NULL,
    [Report SubType] VARCHAR(50) NULL,
    [Report path] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_XSipMandateStatusDetails_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_XSipMandateStatusDetails_Log]
(
    [ClientCode] VARCHAR(50) NULL,
    [sMandateID] VARCHAR(100) NULL,
    [sMandateRefNo] VARCHAR(100) NULL,
    [sMandateStatus] VARCHAR(50) NULL,
    [dUpdatedOn] DATETIME NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblArnEuinMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tblArnEuinMaster]
(
    [Sr No] VARCHAR(100) NULL,
    [SB Equity Tag] VARCHAR(100) NULL,
    [SB Name] VARCHAR(100) NULL,
    [ARN No] VARCHAR(100) NULL,
    [ARN Holder Name] VARCHAR(100) NULL,
    [Validity From] VARCHAR(100) NULL,
    [Validity To] VARCHAR(100) NULL,
    [EUIN No] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblArnEuinMaster_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[tblArnEuinMaster_Prev]
(
    [Sr No] VARCHAR(100) NULL,
    [SB Equity Tag] VARCHAR(100) NULL,
    [SB Name] VARCHAR(100) NULL,
    [ARN No] VARCHAR(100) NULL,
    [ARN Holder Name] VARCHAR(100) NULL,
    [Validity From] VARCHAR(100) NULL,
    [Validity To] VARCHAR(100) NULL,
    [EUIN No] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblKycContest
-- --------------------------------------------------
CREATE TABLE [dbo].[tblKycContest]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SB_TAG] VARCHAR(10) NULL,
    [Target_KYC] INT NULL,
    [Reward] VARCHAR(100) NULL,
    [htmlPage] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblSipSchemeMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tblSipSchemeMaster]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [AMCCode] VARCHAR(50) NULL,
    [AMCName] VARCHAR(50) NULL,
    [SchemeCode] VARCHAR(50) NULL,
    [SchemeName] VARCHAR(MAX) NULL,
    [SIPTransMode] VARCHAR(10) NULL,
    [SIPFrequency] VARCHAR(50) NULL,
    [SIPDates] VARCHAR(50) NULL,
    [SIPMinGap] INT NULL,
    [SIPMaxGap] INT NULL,
    [SIPInstallmentGap] INT NULL,
    [SIPStatus] INT NULL,
    [SIPMinInstallAmt] MONEY NULL,
    [SIPMaxInstallAmt] MONEY NULL,
    [SIPMultiplierAmt] MONEY NULL,
    [SIPMinInstallNo] INT NULL,
    [SIPMaxInstallNo] INT NULL,
    [SchemeISIN] VARCHAR(50) NULL,
    [SchemeType] VARCHAR(50) NULL,
    [Fname] VARCHAR(MAX) NULL,
    [FetchDatetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Temp_Tbl_NOCBulk_Upload1
-- --------------------------------------------------
CREATE TABLE [dbo].[Temp_Tbl_NOCBulk_Upload1]
(
    [ClientCode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TempUserMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[TempUserMaster]
(
    [username] VARCHAR(20) NULL,
    [InsertedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TempUserMaster_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[TempUserMaster_Prev]
(
    [username] VARCHAR(500) NULL,
    [InsertedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TerminatedSb
-- --------------------------------------------------
CREATE TABLE [dbo].[TerminatedSb]
(
    [sbtag] VARCHAR(50) NULL,
    [Dt] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test
-- --------------------------------------------------
CREATE TABLE [dbo].[test]
(
    [party_code] VARCHAR(10) NOT NULL,
    [sub_broker] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.testtodelete
-- --------------------------------------------------
CREATE TABLE [dbo].[testtodelete]
(
    [col1] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tml_clitype
-- --------------------------------------------------
CREATE TABLE [dbo].[tml_clitype]
(
    [party_code] VARCHAR(10) NOT NULL,
    [b2c] VARCHAR(1) NULL,
    [cli_type] VARCHAR(10) NULL,
    [srno] NUMERIC(18, 0) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TrainingLinks
-- --------------------------------------------------
CREATE TABLE [dbo].[TrainingLinks]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Topic] VARCHAR(500) NOT NULL,
    [Day] INT NOT NULL,
    [CreatedBy] VARCHAR(200) NOT NULL,
    [IsActive] BIT NOT NULL DEFAULT ((1)),
    [CreationDate] DATETIME NOT NULL DEFAULT (getdate()),
    [UpdatedBy] VARCHAR(200) NULL,
    [LastUpdate] DATETIME NULL,
    [EnglishUrl] VARCHAR(2000) NULL,
    [HindiUrl] VARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.transactiondetail
-- --------------------------------------------------
CREATE TABLE [dbo].[transactiondetail]
(
    [TranCode] VARCHAR(20) NOT NULL,
    [RegistrarID] INT NULL,
    [TranDate] DATETIME NULL,
    [InvestorCode] VARCHAR(80) NULL,
    [SchCode] VARCHAR(50) NULL,
    [AppNo] VARCHAR(50) NULL,
    [FolioNo] VARCHAR(50) NULL,
    [TrxnType] VARCHAR(20) NULL,
    [SWFlag] VARCHAR(50) NULL,
    [SubTrxnType] VARCHAR(20) NULL,
    [TranNo] VARCHAR(50) NULL,
    [TranId] VARCHAR(50) NULL,
    [Amount] NUMERIC(38, 2) NULL,
    [Units] NUMERIC(38, 4) NULL,
    [Rate] NUMERIC(38, 4) NULL,
    [NAVDate] DATETIME NULL,
    [RevTag] CHAR(1) NULL,
    [ReferenceNo] VARCHAR(50) NULL,
    [BranchId] VARCHAR(50) NULL,
    [AgentCode] VARCHAR(50) NULL,
    [BrokerId] VARCHAR(10) NULL,
    [InvestorType] VARCHAR(2) NULL,
    [SwitchScheme] VARCHAR(10) NULL,
    [SwitchFolio] VARCHAR(50) NULL,
    [SwitchTranCode] VARCHAR(25) NULL,
    [RMCode] VARCHAR(50) NULL,
    [STT] NUMERIC(17, 2) NULL,
    [CommPer] NUMERIC(10, 4) NULL,
    [TranCharge] NUMERIC(10, 2) NULL,
    [OnLineFlag] CHAR(1) NULL,
    [Location] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(10) NULL,
    [CreationDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UntilityView_Notification
-- --------------------------------------------------
CREATE TABLE [dbo].[UntilityView_Notification]
(
    [RN] BIGINT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [CNT] INT NOT NULL,
    [sub_brokercnt] INT NULL,
    [IsInActive] BIT NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryDate] DATE NULL,
    [ExpiryTime] TIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UntilityView_Notification_Bkp13Sept2022
-- --------------------------------------------------
CREATE TABLE [dbo].[UntilityView_Notification_Bkp13Sept2022]
(
    [RN] BIGINT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [CNT] INT NOT NULL,
    [sub_brokercnt] INT NULL,
    [IsInActive] BIT NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryDate] DATE NULL,
    [ExpiryTime] TIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UntilityView_Notification_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[UntilityView_Notification_Prev]
(
    [RN] BIGINT NULL,
    [sub_broker] VARCHAR(200) NULL,
    [NotificationText] VARCHAR(7000) NULL,
    [CampaignId] VARCHAR(100) NULL,
    [NotificationType] VARCHAR(70) NULL,
    [CreatedBy] VARCHAR(200) NULL,
    [CreatedDate] DATETIME NULL,
    [CNT] INT NOT NULL,
    [sub_brokercnt] INT NULL,
    [IsInActive] BIT NULL,
    [StartDate] DATE NULL,
    [StartTime] TIME NULL,
    [ExpiryDate] DATE NULL,
    [ExpiryTime] TIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.user_type_mapper
-- --------------------------------------------------
CREATE TABLE [dbo].[user_type_mapper]
(
    [angelId] VARCHAR(100) NOT NULL,
    [userType] VARCHAR(20) NOT NULL DEFAULT 'Trading',
    [IsCorporateUser] VARCHAR(1) NULL DEFAULT 'N',
    [tempId] VARCHAR(20) NULL,
    [MF_BOStatus] VARCHAR(10) NULL,
    [NBFCStatus] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserMenuAccess
-- --------------------------------------------------
CREATE TABLE [dbo].[UserMenuAccess]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [UserId] INT NOT NULL,
    [MenuId] INT NOT NULL,
    [Active] BIT NOT NULL DEFAULT ((1)),
    [Createdby] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserMenuAccess_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[UserMenuAccess_Temp]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [UserId] INT NOT NULL,
    [MenuId] INT NOT NULL,
    [Active] BIT NOT NULL,
    [Createdby] VARCHAR(100) NOT NULL,
    [CreatedDate] DATETIME NOT NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.USP_DealingDeskNumber_RegionWise
-- --------------------------------------------------
CREATE TABLE [dbo].[USP_DealingDeskNumber_RegionWise]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [RegionName] VARCHAR(200) NOT NULL,
    [DealingDeskNumber] VARCHAR(200) NOT NULL,
    [CreationDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Usp_Get_ArqPerformanceGraph
-- --------------------------------------------------
CREATE TABLE [dbo].[Usp_Get_ArqPerformanceGraph]
(
    [StategyName] VARCHAR(255) NOT NULL,
    [Return] NUMERIC(5, 2) NULL,
    [BenchMarkReturn] NUMERIC(5, 2) NULL,
    [OutPerformance] NUMERIC(5, 2) NULL,
    [IncReturn] NUMERIC(5, 2) NULL,
    [IncBenchMarkReturn] NUMERIC(5, 2) NULL,
    [IncOutPerformance] NUMERIC(5, 2) NULL,
    [IncBasketPeriod] VARCHAR(30) NULL,
    [InceptionDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.USP_SB_DifferentServer_SurveillanceNO
-- --------------------------------------------------
CREATE TABLE [dbo].[USP_SB_DifferentServer_SurveillanceNO]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [SBTag] VARCHAR(200) NOT NULL,
    [RegionName] VARCHAR(200) NOT NULL,
    [RegionCode] VARCHAR(200) NOT NULL,
    [SurveillanceNO] VARCHAR(200) NOT NULL,
    [CreationDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Utility_Users
-- --------------------------------------------------
CREATE TABLE [dbo].[Utility_Users]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ECode] NVARCHAR(50) NULL,
    [Name] NVARCHAR(100) NULL,
    [Active] BIT NULL,
    [CreatedBy] NVARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL,
    [UpdatedBy] NVARCHAR(100) NULL,
    [UpdatedDate] DATETIME NULL,
    [Role] VARCHAR(10) NULL DEFAULT 'User'
);

GO

-- --------------------------------------------------
-- TABLE dbo.vw_AngelPlatinum_ClientInfo
-- --------------------------------------------------
CREATE TABLE [dbo].[vw_AngelPlatinum_ClientInfo]
(
    [ClientCode] VARCHAR(50) NULL,
    [CommunicationDate] DATETIME NULL,
    [ClientId] INT NULL,
    [CreationDate] DATETIME NULL,
    [PushedSource] VARCHAR(50) NULL,
    [IsAgreementGiven] CHAR(5) NULL,
    [AgreementGivenDate] DATETIME NULL,
    [IsPaymentReceived] CHAR(5) NULL,
    [PaymentReceivedDate] DATETIME NULL,
    [IsRiskProfilingDone] CHAR(5) NULL,
    [RiskProfilingDoneDate] DATETIME NULL,
    [ExpiryDate] DATETIME NULL,
    [IsActive] CHAR(1) NULL,
    [ActivationDate] DATETIME NULL,
    [Profile] VARCHAR(50) NULL,
    [LeadSource] VARCHAR(50) NULL,
    [Ecode] VARCHAR(50) NULL,
    [IsDeleted] INT NULL,
    [DeletedDate] DATETIME NULL,
    [IsConfirmationGiven] VARCHAR(50) NULL,
    [ConfirmationGivenDate] DATETIME NULL,
    [Interested] VARCHAR(5) NULL,
    [Interested_Date] DATETIME NULL,
    [Interested_Count] INT NULL,
    [RequestCallback] VARCHAR(5) NULL,
    [RequestCallback_Date] VARCHAR(50) NULL,
    [RequestCallback_Count] INT NULL,
    [Status] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vw_AngelPlatinum_ClientInfo_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[vw_AngelPlatinum_ClientInfo_Prev]
(
    [ClientCode] VARCHAR(50) NULL,
    [CommunicationDate] DATETIME NULL,
    [ClientId] INT NULL,
    [CreationDate] DATETIME NULL,
    [PushedSource] VARCHAR(50) NULL,
    [IsAgreementGiven] CHAR(5) NULL,
    [AgreementGivenDate] DATETIME NULL,
    [IsPaymentReceived] CHAR(5) NULL,
    [PaymentReceivedDate] DATETIME NULL,
    [IsRiskProfilingDone] CHAR(5) NULL,
    [RiskProfilingDoneDate] DATETIME NULL,
    [ExpiryDate] DATETIME NULL,
    [IsActive] CHAR(1) NULL,
    [ActivationDate] DATETIME NULL,
    [Profile] VARCHAR(50) NULL,
    [LeadSource] VARCHAR(50) NULL,
    [Ecode] VARCHAR(50) NULL,
    [IsDeleted] INT NULL,
    [DeletedDate] DATETIME NULL,
    [IsConfirmationGiven] VARCHAR(50) NULL,
    [ConfirmationGivenDate] DATETIME NULL,
    [Interested] VARCHAR(5) NULL,
    [Interested_Date] DATETIME NULL,
    [Interested_Count] INT NULL,
    [RequestCallback] VARCHAR(5) NULL,
    [RequestCallback_Date] VARCHAR(50) NULL,
    [RequestCallback_Count] INT NULL,
    [Status] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VW_Client_DPBal
-- --------------------------------------------------
CREATE TABLE [dbo].[VW_Client_DPBal]
(
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_CODE] VARCHAR(16) NULL,
    [ACTUAL_AMOUNT] MONEY NOT NULL,
    [ACCRUAL_BAL] MONEY NOT NULL,
    [BRANCH_CODE] VARCHAR(6) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VW_Client_DPBal_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[VW_Client_DPBal_Prev]
(
    [PARTY_CODE] VARCHAR(20) NULL,
    [CLIENT_CODE] VARCHAR(16) NULL,
    [ACTUAL_AMOUNT] MONEY NOT NULL,
    [ACCRUAL_BAL] MONEY NOT NULL,
    [BRANCH_CODE] VARCHAR(6) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Vw_CollectionDetails_CLIENT_Net
-- --------------------------------------------------
CREATE TABLE [dbo].[Vw_CollectionDetails_CLIENT_Net]
(
    [AssetClass] VARCHAR(10) NULL,
    [Client] VARCHAR(100) NULL,
    [Net] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vw_Dashboard_sbrisk
-- --------------------------------------------------
CREATE TABLE [dbo].[vw_Dashboard_sbrisk]
(
    [party_code] VARCHAR(10) NULL,
    [long_name] VARCHAR(100) NULL,
    [Reason] VARCHAR(25) NULL,
    [Risk] NUMERIC(21, 4) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [Net_collection] NUMERIC(12, 2) NULL,
    [Pure_Risk] NUMERIC(12, 2) NULL,
    [shortage_value] MONEY NULL,
    [squareoffvalue] MONEY NULL,
    [square_off_type] VARCHAR(20) NULL,
    [square_off_date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vw_Dashboard_sbrisk_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[vw_Dashboard_sbrisk_Prev]
(
    [party_code] VARCHAR(10) NULL,
    [long_name] VARCHAR(100) NULL,
    [Reason] VARCHAR(25) NULL,
    [Risk] NUMERIC(21, 4) NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [Net_collection] NUMERIC(12, 2) NULL,
    [Pure_Risk] NUMERIC(12, 2) NULL,
    [shortage_value] MONEY NULL,
    [squareoffvalue] MONEY NULL,
    [square_off_type] VARCHAR(20) NULL,
    [square_off_date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vw_LMSSB_cityMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[vw_LMSSB_cityMaster]
(
    [Rcity] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vw_MutualFundPendingOrder_NCMS
-- --------------------------------------------------
CREATE TABLE [dbo].[vw_MutualFundPendingOrder_NCMS]
(
    [clientcode] VARCHAR(100) NULL,
    [Segment] VARCHAR(10) NULL,
    [Amount] NUMERIC(18, 4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VW_ONLY_MF_TAG
-- --------------------------------------------------
CREATE TABLE [dbo].[VW_ONLY_MF_TAG]
(
    [Sbtag] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VW_ONLY_MF_TAG_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[VW_ONLY_MF_TAG_Prev]
(
    [Sbtag] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Vw_RMS_Client_Vertical
-- --------------------------------------------------
CREATE TABLE [dbo].[Vw_RMS_Client_Vertical]
(
    [SB] VARCHAR(10) NULL,
    [Client] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Vw_VBB_SCHEME_NAME
-- --------------------------------------------------
CREATE TABLE [dbo].[Vw_VBB_SCHEME_NAME]
(
    [cl_code] VARCHAR(10) NULL,
    [long_name] VARCHAR(100) NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SCHEME_NAME] VARCHAR(50) NULL,
    [sub_broker] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Vw_VBB_SCHEME_NAME_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[Vw_VBB_SCHEME_NAME_Prev]
(
    [cl_code] VARCHAR(10) NULL,
    [long_name] VARCHAR(100) NULL,
    [SP_CreatedOn] DATETIME NOT NULL,
    [SCHEME_NAME] VARCHAR(50) NULL,
    [sub_broker] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vwEquitySIP
-- --------------------------------------------------
CREATE TABLE [dbo].[vwEquitySIP]
(
    [EquitySIP_Header_ID] INT NULL,
    [UserId] VARCHAR(100) NULL,
    [GroupCode] VARCHAR(100) NULL,
    [BasketName] VARCHAR(100) NULL,
    [StartDate] DATE NULL,
    [EndDate] DATE NULL,
    [Frequency] VARCHAR(10) NULL,
    [NoOfOccurence] INT NULL,
    [TotalAmount] NUMERIC(10, 2) NULL,
    [Exchange] INT NULL,
    [DebitType] VARCHAR(100) NULL,
    [SIPStatus] VARCHAR(100) NULL,
    [CreatedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vwEquitySIP_Prev
-- --------------------------------------------------
CREATE TABLE [dbo].[vwEquitySIP_Prev]
(
    [EquitySIP_Header_ID] INT NULL,
    [UserId] VARCHAR(100) NULL,
    [GroupCode] VARCHAR(100) NULL,
    [BasketName] VARCHAR(100) NULL,
    [StartDate] DATE NULL,
    [EndDate] DATE NULL,
    [Frequency] VARCHAR(10) NULL,
    [NoOfOccurence] INT NULL,
    [TotalAmount] NUMERIC(10, 2) NULL,
    [Exchange] INT NULL,
    [DebitType] VARCHAR(100) NULL,
    [SIPStatus] VARCHAR(100) NULL,
    [CreatedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Watchlist_SB_Mapping_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[Watchlist_SB_Mapping_Mobile_2]
(
    [watchlist_id] INT IDENTITY(1,1) NOT NULL,
    [watchlist_Name] VARCHAR(100) NULL,
    [sub_broker] VARCHAR(200) NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Watchlist_Stock_Mapping_Log_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[Watchlist_Stock_Mapping_Log_Mobile_2]
(
    [sub_broker] VARCHAR(200) NULL,
    [watchlist_id] INT NULL,
    [stockname] VARCHAR(500) NULL,
    [ISIN] VARCHAR(100) NULL,
    [active] INT NULL,
    [DeletedBy] VARCHAR(100) NULL,
    [DeletedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Watchlist_Stock_Mapping_Mobile_2
-- --------------------------------------------------
CREATE TABLE [dbo].[Watchlist_Stock_Mapping_Mobile_2]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [watchlist_id] INT NULL,
    [stockname] VARCHAR(500) NULL,
    [ISIN] VARCHAR(100) NULL,
    [active] INT NULL,
    [CreatedBy] VARCHAR(100) NULL,
    [CreatedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- VIEW dbo.vw_ClientLedgerBalance_IPartner
-- --------------------------------------------------

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/**************************************************************/
/*
	DATE:			12/22/2017
	AUTHOR:			Brijesh B
	SERVER.DB:		
	DESCRIPTION:	Gives list of Clients with Ledger Balance.
	

	SELECT TOP 10 * FROM dbo.vw_ClientLedgerBalance_IPartner
*/	
/**************************************************************/
CREATE VIEW [dbo].[vw_ClientLedgerBalance_IPartner]
AS
	SELECT
		RCV.SB AS SubBroker
		,RCC.Party_Code
		,CONVERT(DECIMAL(15,2), RCC.net_ledger) AS Ledger
	FROM
		[196.1.115.182].general.dbo.Vw_RMS_CLIENT_Vertical RCV WITH(NOLOCK)
		INNER JOIN [196.1.115.182].general.dbo.tbl_RMS_collection_CLI RCC WITH(NOLOCK) ON RCV.Client=RCC.PARTY_CODE

GO

-- --------------------------------------------------
-- VIEW dbo.vw_DifferentIPAddress
-- --------------------------------------------------
CREATE VIEW [dbo].[vw_DifferentIPAddress]
AS
	select CreatedBy, cast(createdDate as date) as createdDate, IPadress from Error_log with (nolock)
	where IPadress is not NULL
	and IPadress not like '172%'
	and Controller ='Login'
	group by CreatedBy, cast(createdDate as date) ,IPadress
	having count(1) > 1

GO

-- --------------------------------------------------
-- VIEW dbo.vw_IPartner_GoalClients
-- --------------------------------------------------

/**************************************************************/
/*
	DATE:			12/13/2017
	AUTHOR:			Brijesh B
	DESCRIPTION:	This view gives list of distinct Clients
					who have created Goal.
*/	
/**************************************************************/
CREATE VIEW [dbo].[vw_IPartner_GoalClients]
AS
	SELECT DISTINCT 
		party_code 
	FROM 
		--[172.31.16.42].opticloud.dbo.TBL_AWGT_CLIENT_GOAL_INFO WITH(NOLOCK)
		opticloud.dbo.TBL_AWGT_CLIENT_GOAL_INFO WITH(NOLOCK)
	WHERE
		party_code IS NOT NULL

GO

-- --------------------------------------------------
-- VIEW dbo.Vw_RAND
-- --------------------------------------------------
CREATE View [dbo].[Vw_RAND]        
as        
select RandNum=RAND()

GO


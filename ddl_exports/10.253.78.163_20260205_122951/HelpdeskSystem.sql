-- DDL Export
-- Server: 10.253.78.163
-- Database: HelpdeskSystem
-- Exported: 2026-02-05T12:29:59.016021

USE HelpdeskSystem;
GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.Client_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[Client_Details] ADD CONSTRAINT [FK_Client_Details_JobStatusMaster] FOREIGN KEY ([Status_Code]) REFERENCES [dbo].[JobStatusMaster] ([JobStatus_Id])

GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.Faq_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[Faq_Details] ADD CONSTRAINT [FK_Faq_Details_Faq_Identifier] FOREIGN KEY ([Faq_Identifier]) REFERENCES [dbo].[Faq_Identifier] ([Faq_Identifier])

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_diagramobjects
-- --------------------------------------------------

	CREATE FUNCTION dbo.fn_diagramobjects() 
	RETURNS int
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		declare @id_upgraddiagrams		int
		declare @id_sysdiagrams			int
		declare @id_helpdiagrams		int
		declare @id_helpdiagramdefinition	int
		declare @id_creatediagram	int
		declare @id_renamediagram	int
		declare @id_alterdiagram 	int 
		declare @id_dropdiagram		int
		declare @InstalledObjects	int

		select @InstalledObjects = 0

		select 	@id_upgraddiagrams = object_id(N'dbo.sp_upgraddiagrams'),
			@id_sysdiagrams = object_id(N'dbo.sysdiagrams'),
			@id_helpdiagrams = object_id(N'dbo.sp_helpdiagrams'),
			@id_helpdiagramdefinition = object_id(N'dbo.sp_helpdiagramdefinition'),
			@id_creatediagram = object_id(N'dbo.sp_creatediagram'),
			@id_renamediagram = object_id(N'dbo.sp_renamediagram'),
			@id_alterdiagram = object_id(N'dbo.sp_alterdiagram'), 
			@id_dropdiagram = object_id(N'dbo.sp_dropdiagram')

		if @id_upgraddiagrams is not null
			select @InstalledObjects = @InstalledObjects + 1
		if @id_sysdiagrams is not null
			select @InstalledObjects = @InstalledObjects + 2
		if @id_helpdiagrams is not null
			select @InstalledObjects = @InstalledObjects + 4
		if @id_helpdiagramdefinition is not null
			select @InstalledObjects = @InstalledObjects + 8
		if @id_creatediagram is not null
			select @InstalledObjects = @InstalledObjects + 16
		if @id_renamediagram is not null
			select @InstalledObjects = @InstalledObjects + 32
		if @id_alterdiagram  is not null
			select @InstalledObjects = @InstalledObjects + 64
		if @id_dropdiagram is not null
			select @InstalledObjects = @InstalledObjects + 128
		
		return @InstalledObjects 
	END

GO

-- --------------------------------------------------
-- FUNCTION dbo.functest
-- --------------------------------------------------
create FUNCTION functest
(
@parameter_name as varchar(10)
)

RETURNS table

AS 

RETURN (select * from user_master
where userid=@parameter_name )

GO

-- --------------------------------------------------
-- FUNCTION dbo.getFullmonth
-- --------------------------------------------------

create FUNCTION [dbo].[getFullmonth]
(
 @date1 datetime
)
RETURNS @dates TABLE 
(
 date datetime not null 
)
AS
BEGIN
 -- Set first day in month
 DECLARE @month int;
 
 SET @month = datepart(MM, @date1);
 SET @date1 = convert(datetime, convert(varchar,datepart(yy,@date1)) + '.' + convert(varchar,@month) + '.01 00:00:00');
 WHILE datepart(MM,@date1) = @month
 BEGIN
  INSERT INTO @dates VALUES (@date1);
  SET @date1 = dateadd(dd, 1, @date1);
 END 
 RETURN;
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.Split
-- --------------------------------------------------
CREATE FUNCTION dbo.Split(@String varchar(8000), @Delimiter char(1))        
returns @temptable TABLE (items varchar(8000))        
as        
begin        
    declare @idx int        
    declare @slice varchar(8000)        
       
    select @idx = 1        
        if len(@String)<1 or @String is null  return        
       
    while @idx!= 0        
    begin        
        set @idx = charindex(@Delimiter,@String)        
        if @idx!=0        
            set @slice = left(@String,@idx - 1)        
        else        
            set @slice = @String        
           
        if(len(@slice)>0)   
            insert into @temptable(Items) values(@slice)        
  
        set @String = right(@String,len(@String) - @idx)        
        if len(@String) = 0 break        
    end    
return        
end

GO

-- --------------------------------------------------
-- FUNCTION dbo.sumoftwovalues
-- --------------------------------------------------
create function sumoftwovalues
(@val1 int,@val2 int)
returns int
as
begin
while @val1 < 100
begin
set @val1=@val1 + 1
end
return (@val1 + @val2)
end

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_CTCL_Details_Branch_Name] ON [dbo].[CTCL_Details] ([Branch_Name])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_CTCL_Details_CTCL_IBranch_Cd] ON [dbo].[CTCL_Details] ([CTCL_IBranch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_CTCL_Details_CtCL_Odinid] ON [dbo].[CTCL_Details] ([ctcl_odinid])

GO

-- --------------------------------------------------
-- INDEX dbo.OldCTCL_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_CTCL_details_ctcl_isbtag] ON [dbo].[OldCTCL_Details] ([Ctcl_ISBTag])

GO

-- --------------------------------------------------
-- INDEX dbo.OldCTCL_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_CTCL_details_ctcl_odinid] ON [dbo].[OldCTCL_Details] ([ctcl_odinid])

GO

-- --------------------------------------------------
-- INDEX dbo.OldCTCL_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_CTCL_Details_IBranch_cd] ON [dbo].[OldCTCL_Details] ([CTCL_IBranch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.OldView_Subbroker
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_View_Subbroker_Tag] ON [dbo].[OldView_Subbroker] ([TAG])

GO

-- --------------------------------------------------
-- INDEX dbo.OldView_Subbroker
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_View_Subbroker_Tagbranch] ON [dbo].[OldView_Subbroker] ([TAGBranch])

GO

-- --------------------------------------------------
-- INDEX dbo.sysdiagrams
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UK_principal_name] ON [dbo].[sysdiagrams] ([principal_id], [name])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_IT_ProductMaster
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_ITProduct_Master_Product_Name] ON [dbo].[tbl_IT_ProductMaster] ([Product_Name])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewClient_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_tbl_NewClient_Details_Client_code] ON [dbo].[tbl_NewClient_Details] ([Client_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewClient_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_tbl_newclient_details_Issue_Resolved_By] ON [dbo].[tbl_NewClient_Details] ([Issue_Resolved_By])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewClient_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_tbl_NewClient_Details_Issue_Resolved_DateTime] ON [dbo].[tbl_NewClient_Details] ([Issue_Resolved_Datetime])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewClient_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_tbl_NewClient_Details_Status_Code] ON [dbo].[tbl_NewClient_Details] ([Status_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewClient_Details
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_tbl_Newclient_details_Tagbranch] ON [dbo].[tbl_NewClient_Details] ([TagBranch])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewTaskDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIS_Tbl_NewTask_Details_Issue_Resolved_Datetime] ON [dbo].[tbl_NewTaskDetails] ([Issue_Resolved_Datetime])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewTaskDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_Tbl_New_Task_Details_Issue_Resolved_BY] ON [dbo].[tbl_NewTaskDetails] ([Issue_Resolved_By])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewTaskDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_Tbl_newTask_Details_Status_Code] ON [dbo].[tbl_NewTaskDetails] ([Status_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewTaskDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_tbl_NewTaskDetails_Client_code] ON [dbo].[tbl_NewTaskDetails] ([Client_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_NewTaskDetails
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_Tbl_NewTaskDetails_Tagbranch] ON [dbo].[tbl_NewTaskDetails] ([TagBranch])

GO

-- --------------------------------------------------
-- INDEX dbo.User_Master
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_User_Master_Role_ID] ON [dbo].[User_Master] ([Role_Id])

GO

-- --------------------------------------------------
-- INDEX dbo.User_Master
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_User_Master_Userid] ON [dbo].[User_Master] ([Userid])

GO

-- --------------------------------------------------
-- INDEX dbo.User_Master
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_User_Master_UserName] ON [dbo].[User_Master] ([UserName])

GO

-- --------------------------------------------------
-- INDEX dbo.Vendor_Product
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_Vendor_Product_Product_Name] ON [dbo].[Vendor_Product] ([Product_Name])

GO

-- --------------------------------------------------
-- INDEX dbo.View_Subbroker
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_View_Subbroker_Tag] ON [dbo].[View_Subbroker] ([TAG])

GO

-- --------------------------------------------------
-- INDEX dbo.VLMSINhouse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_VLMSINhouse_Emailadd] ON [dbo].[VLMSINhouse] ([emailadd])

GO

-- --------------------------------------------------
-- INDEX dbo.VLMSINhouse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_VLMSInhouse_Emp_ID] ON [dbo].[VLMSINhouse] ([Emp No])

GO

-- --------------------------------------------------
-- INDEX dbo.VLMSINhouse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NCLIX_VLMSInhouse_Employee_Name] ON [dbo].[VLMSINhouse] ([EMP_NAME])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Advance_Information
-- --------------------------------------------------
ALTER TABLE [dbo].[Advance_Information] ADD CONSTRAINT [PK__Advance_Informat__6A50C1DA] PRIMARY KEY ([Client_Code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.branch_details
-- --------------------------------------------------
ALTER TABLE [dbo].[branch_details] ADD CONSTRAINT [PK_branch_details] PRIMARY KEY ([BRANCH_CODE])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Client_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[Client_Details] ADD CONSTRAINT [PK_Client_Details] PRIMARY KEY ([Docket_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ClientExists
-- --------------------------------------------------
ALTER TABLE [dbo].[ClientExists] ADD CONSTRAINT [PK_ClientExists] PRIMARY KEY ([Refrence_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.dotnettest
-- --------------------------------------------------
ALTER TABLE [dbo].[dotnettest] ADD CONSTRAINT [PK__dotnettest__387A3A7B] PRIMARY KEY ([Code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Executive_Rating
-- --------------------------------------------------
ALTER TABLE [dbo].[Executive_Rating] ADD CONSTRAINT [PK_Executive_Rating] PRIMARY KEY ([Emp_Id], [Date])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Faq_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[Faq_Details] ADD CONSTRAINT [PK__Faq_Details__42E1EEFE] PRIMARY KEY ([Faq_Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Faq_Identifier
-- --------------------------------------------------
ALTER TABLE [dbo].[Faq_Identifier] ADD CONSTRAINT [PK_Faq_Identifier] PRIMARY KEY ([Faq_Identifier])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.FAQ_Status
-- --------------------------------------------------
ALTER TABLE [dbo].[FAQ_Status] ADD CONSTRAINT [PK__FAQ_Status__46B27FE2] PRIMARY KEY ([FAQStatus_Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.FAQ_Type
-- --------------------------------------------------
ALTER TABLE [dbo].[FAQ_Type] ADD CONSTRAINT [PK__FAQ_Type__44CA3770] PRIMARY KEY ([Faq_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Issue_Subcategory
-- --------------------------------------------------
ALTER TABLE [dbo].[Issue_Subcategory] ADD CONSTRAINT [PK_Issue_Subcategory] PRIMARY KEY ([Issue_Sub_Code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.IssueDetails_AKRUTI
-- --------------------------------------------------
ALTER TABLE [dbo].[IssueDetails_AKRUTI] ADD CONSTRAINT [PK_IssueDetails_AKRUTI] PRIMARY KEY ([Docket_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.JobStatusMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[JobStatusMaster] ADD CONSTRAINT [PK__JobStatusMaster__2D27B809] PRIMARY KEY ([JobStatus_Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SalesByQuarter
-- --------------------------------------------------
ALTER TABLE [dbo].[SalesByQuarter] ADD CONSTRAINT [PK__SalesByQuarter__1E6F845E] PRIMARY KEY ([Y], [Q])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.sent_messages
-- --------------------------------------------------
ALTER TABLE [dbo].[sent_messages] ADD CONSTRAINT [PK_sent_messages] PRIMARY KEY ([Msg_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.sysdiagrams
-- --------------------------------------------------
ALTER TABLE [dbo].[sysdiagrams] ADD CONSTRAINT [PK__sysdiagrams__7D78A4E7] PRIMARY KEY ([diagram_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.sysdiagrams
-- --------------------------------------------------
ALTER TABLE [dbo].[sysdiagrams] ADD CONSTRAINT [UK_principal_name] UNIQUE ([principal_id], [name])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Task_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[Task_Details] ADD CONSTRAINT [PK__Task_Details__4F09656F] PRIMARY KEY ([TT_Code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_BOIssueDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_BOIssueDetails] ADD CONSTRAINT [PK_tbl_BOIssueDetails] PRIMARY KEY ([DID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_BOIssueMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_BOIssueMaster] ADD CONSTRAINT [PK__tbl_BOIssueMaste__50BD6F0E] PRIMARY KEY ([Docket_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_IT_ProductMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_IT_ProductMaster] ADD CONSTRAINT [PK_tbl_IT_ProductMaster] PRIMARY KEY ([Product_Code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_ITSubbroker_Exists
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_ITSubbroker_Exists] ADD CONSTRAINT [PK_tbl_ITSubbroker_Exists] PRIMARY KEY ([Refrence_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_NewClient_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_NewClient_Details] ADD CONSTRAINT [PK_tbl_NewClient_Details] PRIMARY KEY ([Docket_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_NewTaskDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_NewTaskDetails] ADD CONSTRAINT [PK__tbl_NewTaskDetai__55B662FE] PRIMARY KEY ([TT_Number])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_UserSMTPSettings
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_UserSMTPSettings] ADD CONSTRAINT [PK_tbl_UserSMTPSettings] PRIMARY KEY ([Emp_Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.test
-- --------------------------------------------------
ALTER TABLE [dbo].[test] ADD CONSTRAINT [PK_test] PRIMARY KEY ([a])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.user_master_backup
-- --------------------------------------------------
ALTER TABLE [dbo].[user_master_backup] ADD CONSTRAINT [PK_user_master_backup] PRIMARY KEY ([Userid])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.UserID_TL
-- --------------------------------------------------
ALTER TABLE [dbo].[UserID_TL] ADD CONSTRAINT [PK_UserID_TL] PRIMARY KEY ([userid])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Vendor_Master
-- --------------------------------------------------
ALTER TABLE [dbo].[Vendor_Master] ADD CONSTRAINT [PK__Vendor_Master__4D94879B] PRIMARY KEY ([Vendor_Code])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Vendor_Product
-- --------------------------------------------------
ALTER TABLE [dbo].[Vendor_Product] ADD CONSTRAINT [PK_Vendor_Product] PRIMARY KEY ([Product_Code])

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Add_New_Issue
-- --------------------------------------------------
CREATE proc [dbo].[Add_New_Issue]
--Auther:	Sanjay Lavu Kudtarkar
--Date Created: 13-08-2008
--Stored Procedure to insert new issue in tbl_newclient_details 
@pageidentifier as int,
@docket_number as varchar(20),
@Client_Code as varchar(10),
@Product_Code as varchar(50),
@Issue_Raised_Datetime datetime,
@Issue_Resolving_Time datetime,
@Type as varchar(10),
@Nature as varchar(20),
@Problem as varchar(300),
@Brief_Solution as varchar(300),
@Client_Remark as varchar(300),
@Issue_Resolved_By as varchar(50),
@Status_Code as varchar(10),
@level as int
as

if @Status_Code='UP'
	
begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

	end
end	
---------------------------------------------------------------------------------
else if @Status_Code='L'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		end
		
		else if @pageidentifier=2
		
		begin
		Update tbl_newclient_details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime='',L1_finalRemark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		end

		else if @pageidentifier=3
		begin
		Update tbl_newclient_details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime='',L2_userRemark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		end

		else if @pageidentifier=4
		begin
		Update tbl_newclient_details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime='',L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		insert into tbl_newtbl_newclient_details values('',@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
		Update tbl_newclient_details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),L1_finalRemark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		end

	else if @pageidentifier=3
		begin
		Update tbl_newclient_details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),L2_userRemark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		end

	else if @pageidentifier=4
		begin
		Update tbl_newclient_details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		insert into tbl_newtaskdetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_DateTime,getdate(),@Issue_Resolving_Time,'','','Ebro',@Type,@Nature,@Problem,@Brief_Solution,'','','','','',@Issue_Resolved_By,'','',@Status_Code)
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Authenticate
-- --------------------------------------------------
  
CREATE proc [dbo].[Authenticate]  
@EmpID varchar(10),  
@pass varchar(10)  
as  
set @EmpID=replace(@EmpID,'-','')  
set @pass=replace(@pass,'-','')  
  
--select Role_id,username,Branch_id from MUser_Master where  userid=@EmpID and password=@pass  
--select UM.Userid,UM.Role_id ,RM.Role_Name,UM.username,EM.Department,UM.Branch_id,CM.CentralSupport   
--from MUser_Master UM,role_master RM, [196.1.115.158].MISSC.dbo.employee_master EM,  tbl_CSOMaster CM  
--where UM.Role_id=RM.Role_id and @EmpID=EM.Emp_no   
--and CM.Branch_Tag=UM.Branch_id and userid=@EmpID and password=@pass  
  
  
select UM.Userid,UM.Role_id ,RM.Role_Name,UM.username,EM.Department,UM.Branch_id,CM.CentralSupport   
from MUser_Master UM,role_master RM, [MIDDLEWARE].[Harmony].dbo.VLMSInhouse EM,  tbl_CSOMaster CM  
where UM.Role_id=RM.Role_id and @EmpID=EM.[Emp no]   
and CM.Branch_Tag=UM.Branch_id and userid=@EmpID and password=@pass

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ClientAdvanceinformation
-- --------------------------------------------------
CREATE Proc [dbo].[ClientAdvanceinformation]
@Client_code char(15) as
(select * from advance_information where client_code=@client_code)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CMSEmail
-- --------------------------------------------------
create proc [dbo].[CMSEmail]
as
select i.docket_number,i.Branch,u.username as [Issue Resolved by]
from issuedetails_Akruti i,user_master u 
where u.userid=i.issue_resolved_by and status_code = 'P' and (datediff(minute,issue_resolved_datetime,getdate()) > 30)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CSR_Clientinfo
-- --------------------------------------------------



CREATE proc [dbo].[CSR_Clientinfo] 
@Client_code char(15)
as

declare @online bit

select @online = online_client from client_master where client_code=@Client_code

if @online='1' 
	begin
		select Client_Master.Short_Name,Client_Master.Long_Name,Client_Master.DOB,Client_Master.B2C,Client_Master.Branch_Code,Client_Master.Subbroker_Code,Client_Master.Region_Code,Client_Master.Zone_Code,Vendor_Product.Product_Name,vendor_product.product_version,Client_Master.Secondary_Product,Client_Master.PDA,Client_Master.Manager_Code,Client_Master.Account_Status,Client_Master.Active_From,Client_Master.PAN_Number,Client_Master.BSE,Client_Master.NSE,Client_Master.NSEFO,Client_Master.MCX,Client_Master.NCDEX,client_master.Address,Client_Master.Address1,Client_Master.Address2,Client_Master.City
		,Client_Master.State
		,Client_Master.Country
		,Client_Master.Permanent_Address
		,Client_Master.Landline_Number1
		,Client_Master.Landline_Number2
		,Client_Master.Office_Number1
		,Client_Master.Office_Number2
		,Client_Master.Mobile
		,Client_Master.Email,Client_Master.Online_Client
		from client_master Join vendor_product 
		on vendor_product.product_code=client_master.product_code
		where Client_code=@Client_Code
	end	
else
	begin
		select Client_Master.Short_Name,Client_Master.Long_Name,Client_Master.DOB,Client_Master.B2C,Client_Master.Branch_Code,Client_Master.Subbroker_Code,Client_Master.Region_Code,Client_Master.Zone_Code,Vendor_Product.Product_Name,vendor_product.product_version,Client_Master.Secondary_Product,Client_Master.PDA,Client_Master.Manager_Code,Client_Master.Account_Status,Client_Master.Active_From,Client_Master.PAN_Number,Client_Master.BSE,Client_Master.NSE,Client_Master.NSEFO,Client_Master.MCX,Client_Master.NCDEX,client_master.Address,Client_Master.Address1,Client_Master.Address2,Client_Master.City
		,Client_Master.State
		,Client_Master.Country
		,Client_Master.Permanent_Address
		,Client_Master.Landline_Number1
		,Client_Master.Landline_Number2
		,Client_Master.Office_Number1
		,Client_Master.Office_Number2
		,Client_Master.Mobile
		,Client_Master.Email,Client_Master.Online_Client
		from client_master left Join vendor_product 
		on vendor_product.product_code=client_master.product_code 
		where Client_code=@Client_Code
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CSR_Solution
-- --------------------------------------------------
Create Proc CSR_Solution
@product varchar(50),@type varchar(50),@nature varchar(Max),@problem varchar(MAX)
as
select top 1 Solution,briefsolution from Faq_Details
where product_Name=@Product and FAQ_type=@Type and Faq_nature=@Nature and problem=@problem and Faq_status=1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.demo
-- --------------------------------------------------
CREATE proc demo
@issue_raised_datetime_from varchar(100),
@doc varchar(100)
as
select issue_raised_datetime from client_details
where docket_number= @doc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EBHMS_ClientAdvanceinformation
-- --------------------------------------------------
Create Proc EBHMS_ClientAdvanceinformation
@Client_code char(15) as
(select * from advance_information where client_code=@client_code)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Ebhms_ClientHistory
-- --------------------------------------------------

CREATE Proc [dbo].[Ebhms_ClientHistory]
@Client_Code char(20)
as

select top 3 docket_number as [Docket_Number],Client_Code as [Client Code],Source, Product_name as [Product Name],
temp.type as [Type],Nature, Problem, Brief_Solution as [Brief Solution], Remarks, RaisedDate, ResolvedDate, 
TotalTime as [Total Time],Executive,Status 
from
(
select distinct d.docket_number, d.Client_Code,d.Source, v.Product_name, d.Type, d.Nature, d.Problem,d.Brief_solution,
Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id in ('L1EX','ITL1EX','ITL1EXBR')) THEN L1_InitialRemark 
				 	 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L1TL','ITL1TL','ITL1TLBR')) THEN L1_FinalRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L2FEX','L2TEX','L2FTL','L2TTL')) THEN L2_UserRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L3EX','L3TL','ADM','ITL3EX','ITL3TL')) THEN L3_UserRemark					
					 END,''),
left(d.Issue_raised_datetime,11) as [RaisedDate],
left(d.issue_resolved_datetime,11) as [ResolvedDate],
CONVERT(VARCHAR,d.issue_resolving_time,108) as [TotalTime],
um.username as [Executive],js.jobstatus_name as [Status]

from tbl_NewClient_details d
join vendor_product v   on (d.product_code=v.product_code or d.product_code=v.product_name)
join Jobstatusmaster js on d.status_code=js.JobStatus_Id
join user_master um     on d.issue_resolved_by=um.userid

where client_code=@Client_Code and d.issue_type='EBro'
) temp
order by docket_number desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EBHMS_InsertAdvanceinformation
-- --------------------------------------------------

CREATE Proc [dbo].[EBHMS_InsertAdvanceinformation]
@Client_Code char(20),
@OS varchar(100),
@SP int,
@IP char(20),
@ISP varchar(100),
@Processor varchar(40),
@RAM char(20),
@Ex_Remark varchar(200)
as
insert into Advance_Information
values(@Client_Code,@OS,@SP,@IP,@ISP,@Processor,@RAM,@Ex_Remark)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Ebhms_Lastinformation
-- --------------------------------------------------


CREATE Proc [dbo].[Ebhms_Lastinformation]
@Client_Code char(20)
,@emp_id varchar(20)
as
select top 3 
d.docket_number as [Docket Number],
d.Client_Code as [Client Code],
um.Team_id as [Resolution Level],
d.Issue_raised_datetime as [Issue Raised Datetime],
d.issue_resolved_datetime as [Issue Resolved Datetime],
CONVERT(VARCHAR,d.issue_resolving_time,108) as [Issue Resolving Time],
v.Product_name as [Product Name],
d.Type,
d.Nature,
d.Problem,
d.Brief_solution as [Brief Solution],
um.username as [Issue Resolved By],
js.jobstatus_name as [Status]

from tbl_NewClient_details d
join vendor_product v
on d.product_code=v.product_code
join Jobstatusmaster js
on d.status_code=js.JobStatus_Id
join user_master um
on d.issue_resolved_by=um.userid
where client_code=@client_code 
and d.issue_resolved_by = @emp_id
order by d.Issue_raised_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Ebhms_lastIssueraisedatetime
-- --------------------------------------------------
Create Proc Ebhms_lastIssueraisedatetime
@client_code char(25)
as
select top 1 issue_raised_datetime from client_details
where client_code=@client_code order by issue_raised_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Ebhms_lastIssueresolutiondatetime
-- --------------------------------------------------
CREATE Proc [dbo].[Ebhms_lastIssueresolutiondatetime]
@client_code char(25)
as
select top 1 issue_raised_datetime from client_details
where client_code=@client_code and status_code='C' order by issue_resolved_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EBHMS3_UpdateAdvanceinfo
-- --------------------------------------------------
Create Proc EBHMS3_UpdateAdvanceinfo
@Client_COde char(25),
@OS varchar(100),
@sp int,
@IP Char(20),
@ISP varchar(100),
@Processor varchar(40),
@RAM char(20),
@Ex_Remark varchar(200)
as
begin
update advance_information set operating_system=@os,service_pack=@sp,ip=@ip,isp=@isp,processor=@processor,ram=@ram,Executive_remark=@ex_remark
where client_code=@client_code
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EBHMSPDAJOBS
-- --------------------------------------------------


CREATE proc [dbo].[EBHMSPDAJOBS]
as
select d.Docket_Number as 'Docket Number',left(d.Issue_Raised_dateTime,11) as 'Issue Raised Date',
m.Branch_Code as 'Branch Code',d.Client_Code as 'Client Code',d.product_Code as 'Product Name',
d.problem as 'Problem',d.client_remark as 'Client Remark'
from tbl_newclient_details d with (Nolock), client_master m with (nolock), 
vendor_product v with (nolock),
jobstatusmaster j with (nolock)
where m.Client_Code=d.Client_Code
and (v.product_code=d.product_code or v.product_name=d.product_code)
and d.status_code=j.jobstatus_id
and (d.Status_Code like 'PDA%' ) --or d.Issue_resolved_By='')
order by d.Issue_Raised_dateTime asc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Ebro_AssignEmp
-- --------------------------------------------------


CREATE procedure [dbo].[Ebro_AssignEmp]
@TL varchar(50)
as
select USERNAME from USER_MASTER 
where UserId in (Select Employee_ID from TBl_TeamleaderMaster where TeamLeader=@TL And Account_Status=1)
Order By UserName

--select username 
--from user_master 
--where TeamLeader=(Select TeamLeader from user_master where userid = @issueby )

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EgShowRating
-- --------------------------------------------------



create proc [dbo].[EgShowRating]
@Type varchar(30),
@Employee varchar(100),
@FromDate datetime,
@ToDate datetime
--@Day varchar(50)
as
if @Type = 'Daily'
begin
if @Employee = 'All Executive'
begin
select u.username as "Executive Name", left(Date,11) as Date, e.total as Total  --,e.date, u.username as "Employee Name",
from executive_rating E, user_master U
where e.emp_id=u.userid --and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
order by u.username, e.date
end
else
begin
select left(Date,11) as Date, e.total as Total  --,e.date, u.username as "Employee Name",
from executive_rating E, user_master U
where e.emp_id=u.userid and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
order by e.date
end
end
else if @Type = 'Monthly'
begin
if @Employee = 'All Executive'
begin
select u.username as "Employee Name", DATENAME(mm,date)+' '+DATENAME(yyyy,date) as "Month", sum(e.total) as Total
from executive_rating E, user_master U
where e.emp_id=u.userid --and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
--group by u.username
group by u.username,DATENAME(mm,date)+' '+DATENAME(yyyy,date),DATEPART(m,date),DATEPART(yyyy,date)
order by u.username,DATEPART(yyyy,date),DATEPART(m,date),DATENAME(mm,date)+' '+DATENAME(yyyy,date)
end
else
begin
select DATENAME(mm,date)+' '+DATENAME(yyyy,date) as "Month", sum(e.total) as Total
from executive_rating E, user_master U
where e.emp_id=u.userid and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
--group by u.username
group by DATENAME(mm,date)+' '+DATENAME(yyyy,date),DATEPART(m,date),DATEPART(yyyy,date)
order by DATEPART(yyyy,date),DATEPART(m,date),DATENAME(mm,date)+' '+DATENAME(yyyy,date)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.get_TeamID
-- --------------------------------------------------
CREATE proc get_TeamID
@roleid as char(25)
as

SELECT t.team_id from team_master t, role_master r
where t.team_id = r.team_id
and r.role_id = @roleid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetCategory
-- --------------------------------------------------
create proc [dbo].[GetCategory]
as
select distinct(nature) from tbl_IT_KB_Master

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetEmp
-- --------------------------------------------------

CREATE proc [dbo].[GetEmp]
as
select distinct(rtrim(ltrim(userid))) as EmpID,rtrim(ltrim(username)) as  EmpName from user_master

GO

-- --------------------------------------------------
-- PROCEDURE dbo.getrefnumber
-- --------------------------------------------------
create proc getrefnumber
as
select max(convert(int,Refrence_Number)) from clientexists

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetTeamTL
-- --------------------------------------------------


CREATE proc [dbo].[GetTeamTL]
@team as char(10),
@type as char(10)
as
Begin
	select userid, Role_id from user_master
	where Team_id = @team and Role_ID = @type
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.insert_issueAKRUTI
-- --------------------------------------------------


CREATE proc insert_issueAKRUTI
			@code char(15)
           ,@Branch varchar(100)
           ,@Branch_Name varchar(100)
           ,@Raised datetime 
           ,@Resolved datetime 
           ,@Product varchar(100)
           ,@Type varchar(100)
           ,@Nature varchar(100)
           ,@Problem varchar(100)
           ,@Brief varchar(100)
           ,@Sol text
           ,@CRemark varchar(100)
           ,@Add varchar(100)
           ,@Phone varchar(100)
           ,@Contact varchar(100)
           ,@Remark varchar(100)
           ,@By varchar(100)
           ,@Status char(15)
		  
as
--set @Raised=getdate()
--set @Resolved=getdate()
if @Status = 'C'
begin
insert into IssueDetails_AKRUTI values('',@code,@Branch,@Branch_Name,@Raised,@Resolved,@Product,@Type,@Nature,@Problem,
@Brief,@Sol,@CRemark,@Add,@Phone,@Contact,@Remark,@By,'C')
end
else if @Status = 'P'
begin
insert into IssueDetails_AKRUTI values('',@code,@Branch,@Branch_Name,@Raised,@Resolved,@Product,@Type,@Nature,@Problem,
@Brief,@Sol,@CRemark,@Add,@Phone,@Contact,@Remark,@By,'P')
end
--select @code,@Branch,@Branch_Name,@Raised,@Resolved,@Product,@Type,@Nature,@Problem,@Brief,@Sol,@CRemark,@Add,@Phone,@Contact,@Remark,@By
select docket_number from IssueDetails_AKRUTI where issue_raised_datetime=@Raised

GO

-- --------------------------------------------------
-- PROCEDURE dbo.InsertAdvanceinfo
-- --------------------------------------------------
CREATE Proc InsertAdvanceinfo
@Client_COde char(25),
@OS varchar(100),
@SP int,
@IP Char(20),
@ISP varchar(100),
@Processor varchar(40),
@RAM char(20),
@Ex_Remark varchar(200)
as
begin
insert into advance_information Values(@client_code,@OS,@SP,@IP,@ISP,@Processor,@RAM,@Ex_Remark)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Issuesinlast3months
-- --------------------------------------------------





CREATE proc [dbo].[Issuesinlast3months]
@Client_COde char(25)
as
--select count(*) from client_details
--where client_code=@client_code and month(Issue_Raised_datetime) between month(getdate())-2 and month(getdate())
--
select count(client_code) as Totalcalls,
ISnull((sum(datediff(minute,issue_raised_datetime,issue_resolved_datetime))),0) as  Totaltime,
Isnull((sum(datediff(minute,issue_raised_datetime,issue_resolved_datetime))/count(client_code)),0) as Averagetime
from TBL_NEWCLIENT_DETAILS
where client_code=@Client_COde and (status_code='C' or status_code='X' or status_code='ITC' ) 
and month(Issue_Raised_datetime) between month(getdate())-2 and month(getdate())
group by client_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Add_New_Issue
-- --------------------------------------------------

CREATE proc [dbo].[IT_Add_New_Issue]
@pageidentifier as int,
@docket_number as varchar(20),
@Client_Code as char(15),
@Product_Code as char(50),
@Issue_Raised_DateTime as varchar(22) ,
--@Issue_Resolved_Datetime as varchar(22),
@Nature as varchar(200),
@Problem as varchar(max),
@Brief_Solution as varchar(max),
@Client_Remark as varchar(200) ,
@L1_InitialRemark as varchar(200) ,
@L1_FinalRemark as varchar(200) ,
@L2_UserRemark as varchar(200) ,
@L3_UserRemark as varchar(200) ,
@Issue_Resolved_By as varchar(20) ,
@Contact_Person as varchar(200),
--@Type as varchar(max),
@Status_Code as varchar(10),
@level as int
as

if @Status_Code='ITUP'

begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		--insert into client_details values('',@Client_Code,@Product_Code,convert(datetime,@Issue_Raised_Datetime),'','','','',@Type,@Nature,@Problem,@Brief_Solution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@Contact_Person,@Status_Code )
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		--select @docket_number
		end

		if @level=2
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		--select @docket_number
		end

		if @level=3
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

	end
end	
---------------------------------------------------------------------------------
else if @Status_Code='ITL'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

		if @level=2
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

		if @level=3
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

		end		
		else if @pageidentifier=2
		
		begin
		Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime='',L1_finalRemark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		end

		else if @pageidentifier=3
		begin
		Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		end


		else if @pageidentifier=4
		begin
		Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

		if @level=2
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

		if @level=3
		begin
		insert into client_details Values('',@client_code,@product_code,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@nature,@problem,@brief_solution,'',@client_remark,@L1_InitialRemark,@L1_FinalRemark,@L2_UserRemark,@L3_UserRemark,@Issue_Resolved_By,'',@Contact_person,@Status_code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
		Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		end

	else if @pageidentifier=3
		begin
		--print(@Issue_Resolved_Datetime)
		Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		end

	else if @pageidentifier=4
		begin
		Update client_details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Assign
-- --------------------------------------------------


CREATE proc [dbo].[IT_Assign]
@name varchar(50),@docket int,@date datetime
as
update tbl_NewClient_Details 
set Status_Code='ITP',Issue_Resolved_By=@name,Issue_Resolved_dateTime=@date
where Docket_Number=@docket

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Close
-- --------------------------------------------------

CREATE proc [dbo].[IT_Close]
@pageidentifier as int,
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Client_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15),
@level as int

as

if @pageidentifier=1
	begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number

--		insert into client_details values('',@Client_Code,@Product_Code ,convert(datetime,@Issue_Raised_Datetime),@Issue_Resolved_Datetime,NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@contact_person,@Status_Code)
--		select @docket_number=max(convert(int,docket_number)) from client_details
--		--insert into task_details values('',@docket_number,@Issue_Resolved_By,getdate(),getdate(),@Status_Code,'')
--		select @docket_number
	end
else
	begin
		Update tbl_NewClient_Details 
		set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),Issue_Resolved_Datetime = getdate(),
			L3_Userremark=@Client_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number		
		
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,getdate(),getdate(),@Status_Code,'')
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Close_latest
-- --------------------------------------------------









CREATE proc [dbo].[IT_Close_latest]
@pageidentifier as int,
@docket_number as char(8),
@access as char(10),
@SBTAG as char(20),
@Client_Code char(15),
@Product_Code char(50),
@branchtag varchar(50),
@Issue_Raised_Datetime datetime,
@Issue_Resolving_Time datetime, 
@Call_From char(25),
@Call_Type char(25),
@source char(10),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Detailed_Solution varchar(MAX),
@Ex_Remark varchar(MAX),
@L1_EXRemark varchar(MAX),
@L1_TLRemark varchar(MAX),
@L2_Remark varchar(MAX),
@L3_Remark varchar(MAX),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15),
@level as int

as

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR') and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL' or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV' or @access = 'ITL2EXI' or @access = 'ITL2TLI'  or @access = 'ITL2EXS' or @access = 'ITL2TLS') and @Ex_Remark<>'')
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM') and @Ex_Remark<>'') 
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark


------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
if @access = 'ITL2EXI' or @access='ITL2TLI' set @Team_Id='ITL2I'
if @access = 'ITL2EXS' or @access='ITL2TLS' set @Team_Id='ITL2S'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'


if @pageidentifier=1
	begin
		 Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end
else
	begin
		Update tbl_NewClient_Details 
		set Issue_Raised_Datetime=CONVERT(datetime,@Issue_Raised_Datetime),Issue_Resolved_Datetime = getdate(),
			Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
			status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number		
		
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		--insert into task_details values('',@docket_number,@Issue_Resolved_By,getdate(),getdate(),@Status_Code,'')
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Courtesy_Call
-- --------------------------------------------------
CREATE proc IT_Courtesy_Call
as

select distinct(Branch_Name),Docket_number,odin_id,Client_Remark,issue_resolved_by,tbl_it_Odinmaster.odin_manager_code,issue_resolved_datetime,nature
from tbl_newClient_details,tbl_it_odinmaster
where branch_name <> 'null' 
and client_code = odin_id and issue_type = 'IT' and Nature='Courtesy call'
--and odin_id not in  ('CHIEF','PATAN')
order by Docket_number

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Currentsummary
-- --------------------------------------------------



---------------------------------------------------------------------------------------
--modified by	:	Sanjay Lavu Kudtarkar
--Date Modified	:	7.12.2009
---------------------------------------------------------------------------------------

CREATE proc [dbo].[IT_Currentsummary]
@TLID as varchar(10),
@access as varchar(10)
as


exec IT_levelsummary_currentmonth @TLID,@ACCESS,''
exec IT_levelsummary_lastmonth @TLID,@ACCESS,''
exec IT_Mastermind_test @TLID,@ACCESS,''
---------------------------------------------------------------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL' or @access='ADM' or @access='M' 
begin
	select user_master.username as [Username] , user_master.Lastlogin as [lastlogindatetime],isnull(Todays_Completed,0) as [Todays Completed],isnull(Todays_Escalated,0) as [Todays Escalated],isnull(Current_Month_Completed,0) as [Current Month Completed],isnull(Current_Month_Escalated,0) as [Current Month Escalated] ,isnull(Last_Month_Completed,0) as [Last Month Completed],isnull(Last_Month_Escalated,0) as [Last Month Escalated] from user_master
	join
	(select * from 
	(select userid as [userid1],completed as [Current_Month_Completed],escalated as [Current_Month_Escalated],Performancepoint as [Current_Month_Performance_Point] from view_currentmonth union all select distinct(userid),0,0,0 from (select distinct(userid) from view_lastmonth where userid not in (select userid from view_currentmonth) union all select distinct(userid) from view_Mastermind where userid not in (select userid from view_currentmonth)) as t1 where t1.userid<>'null' ) as CM
	join
	(select userid as [userid2],completed as [Last_Month_Completed],escalated as [Last_Month_Escalated],Performancepoint as [Last_Month_Performance_Point] from view_lastmonth union all select distinct(userid),0,0,0 from (select distinct(userid) from view_currentmonth where userid not in (select userid from view_lastmonth) union all select distinct(userid) from view_Mastermind where userid not in (select userid from view_lastmonth)) as t2 where t2.userid<>'null' ) as LM
	on CM.userid1=LM.userid2
	join
	(select userid as [userid3],completed as [Todays_Completed],escalated as [Todays_Escalated],Performancepoint as [Todays_Performance_Point] from view_Mastermind union all select distinct(userid),0,0,0 from (select distinct(userid) from view_currentmonth where userid not in (select userid from view_Mastermind) union all select distinct(userid) from view_lastmonth where userid not in (select userid from view_Mastermind)) as t3 where t3.userid<>'null') as TD
	on TD.userid3=LM.userid2 ) as CurrentSummery
	on user_master.userid=CurrentSummery.userid1
end
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------Auther:	Sanjay Lavu Kudtarkar
--in case of verification use these queries to check contents of views
--select * from view_currentmonth
--select * from view_lastmonth
--select * from view_Mastermind
---------------------------------------Copyright 2008(C)----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Escalate
-- --------------------------------------------------


CREATE proc [dbo].[IT_Escalate]

@pageidentifier as int,
@access as char(8),
@docket_number as varchar(20),
@Client as char(15),
@Product as char(50),
@Issue_Raised_DateTime as varchar(22) ,
@Issue_Resolved_Datetime as varchar(22),
@Issue_resolving_time as varchar(22),
@Inboundoutbound as char(25),
@calltype as char(25),
@type as char(25),
@Nature as varchar(200),
@Problem as varchar(max),
@BriefSolution as varchar(max),
@solution as varchar(max),
@Client_Remark as varchar(200) ,
@L1_InitialRemark as varchar(200) ,
@L1_FinalRemark as varchar(200) ,
@L2_UserRemark as varchar(200) ,
@L3_UserRemark as varchar(200) ,
@Issue_Resolved_By as varchar(20) ,
@Team_Id char(25),
@contactPerson as varchar(200),
@Status as varchar(10)


--@IssueType as varchar(max)
as

if @pageidentifier=1
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL') and (@type='ODIN')
	begin
		set @Status='ITEL2O'
		set @L2_UserRemark=@Client_Remark
		--insert into it_client_details values('',@Client,@Client_Name,@Product ,convert(datetime,@Issue_Raised_Datetime),'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,@Status,@Nature,@contactPerson,@IssueType,@Problem,@BriefSolution,@manager_name)
		--insert into client_details values('',@Client,@Product ,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,@team_id,@contactPerson,@Status)
		
		insert into client_details values('',@Client, @Product ,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime) ,@Issue_resolving_time ,@Inboundoutbound ,@calltype ,@type ,@Nature ,@Problem ,@BriefSolution ,@solution ,@Client_Remark ,@L1_InitialRemark  ,@L1_FinalRemark ,@L2_UserRemark  ,@L3_UserRemark ,@Issue_Resolved_By  ,@Team_Id ,@contactPerson ,@Status ) 
		select @docket_number=max(convert(int,docket_number))  from client_details
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
	end

	else if(@access = 'ITL1EX' or @access='ITL1TL') and (@type='Network')
	begin
		set @Status='ITEL2N'
		set @L2_UserRemark=@Client_Remark
		--insert into it_client_details values('',@Client,@Client_Name,@Product ,convert(datetime,@Issue_Raised_Datetime),'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,@Status,@Nature,@contactPerson,@IssueType,@Problem,@BriefSolution,@manager_name)
		--insert into client_details values('',@Client,@Product ,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@contactPerson,@Status)
		insert into client_details values('',@Client, @Product ,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime) ,@Issue_resolving_time ,@Inboundoutbound ,@calltype ,@type ,@Nature ,@Problem ,@BriefSolution ,@solution ,@Client_Remark ,@L1_InitialRemark  ,@L1_FinalRemark ,@L2_UserRemark  ,@L3_UserRemark ,@Issue_Resolved_By  ,@Team_Id ,@contactPerson ,@Status ) 
		select @docket_number=max(convert(int,docket_number))  from client_details
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
	end

	else if(@access = 'ITL1EX' or @access='ITL1TL') and (@type='VSAT')
	begin
		set @Status='ITEL2V'
		set @L2_UserRemark=@Client_Remark
		--insert into it_client_details values('',@Client,@Client_Name,@Product ,convert(datetime,@Issue_Raised_Datetime),'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,@Status,@Nature,@contactPerson,@IssueType,@Problem,@BriefSolution,@manager_name)
		--insert into client_details values('',@Client,@Product ,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@contactPerson,@Status)
		
		insert into client_details values('',@Client, @Product ,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime) ,@Issue_resolving_time ,@Inboundoutbound ,@calltype ,@type ,@Nature ,@Problem ,@BriefSolution ,@solution ,@Client_Remark ,@L1_InitialRemark  ,@L1_FinalRemark ,@L2_UserRemark  ,@L3_UserRemark ,@Issue_Resolved_By  ,@Team_Id ,@contactPerson ,@Status ) 
		select @docket_number=max(convert(int,docket_number))  from client_details
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
	end

	else if @access = 'ITL2EXO' or @access='ITL2TLO' or @access = 'ITL2EXN' or @access='ITL2TLN' or @access = 'ITL2EXV' or @access='ITL2TLV'
	begin
		set @Status='ITE3'
		set @L3_UserRemark=@Client_Remark
		--insert into it_client_details values('',@Client,@Client_Name,@Product ,convert(datetime,@Issue_Raised_Datetime),'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,@Status,@Nature,@contactPerson,@IssueType,@Problem,@BriefSolution,@manager_name)
		--insert into client_details values('',@Client,@Product ,convert(datetime,@Issue_Raised_Datetime),getdate(),NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@contactPerson,@Status)

		insert into client_details values('',@Client, @Product ,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime) ,@Issue_resolving_time ,@Inboundoutbound ,@calltype ,@type ,@Nature ,@Problem ,@BriefSolution ,@solution ,@Client_Remark ,@L1_InitialRemark  ,@L1_FinalRemark ,@L2_UserRemark  ,@L3_UserRemark ,@Issue_Resolved_By  ,@Team_Id ,@contactPerson ,@Status ) 
		select @docket_number=max(convert(int,docket_number))  from client_details
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
	end

	select @docket_number
end

------------------------------------------------------------------------------

else
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL') and (@type='ODIN')
	begin
		set @Status='ITE2O'
		set @L2_UserRemark=@Client_Remark
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
		update client_details set status_code=@Status, L2_UserRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@type='Network')
	begin
		set @Status='ITE2N'
		set @L2_UserRemark=@Client_Remark
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
		update client_details set status_code=@Status,  L2_UserRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@type='VSAT')
	begin
		set @Status='ITE2V'
		set @L2_UserRemark=@Client_Remark
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
		update client_details set status_code=@Status,  L2_UserRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end

	else if @access = 'ITL2EXO' or @access='ITL2TLO' or @access = 'ITL2EXN' or @access='ITL2TLN' or @access = 'ITL2EXV' or @access='ITL2TLV'
	begin
		set @Status='ITE3'
		set @L3_UserRemark=@Client_Remark
		--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status,'')
		update client_details set status_code=@Status,  L3_UserRemark = @L3_UserRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end

end

--insert into client_details values('',@Client, @Product ,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime) ,@Issue_resolving_time ,@Inboundoutbound ,@calltype ,@type ,@Nature ,@Problem ,@BriefSolution ,@solution ,@Client_Remark ,@L1_InitialRemark  ,@L1_FinalRemark ,@L2_UserRemark  ,@L3_UserRemark ,@Issue_Resolved_By  ,@Team_Id ,@contactPerson ,@Status )

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Escalate_Latest
-- --------------------------------------------------


CREATE proc [dbo].[IT_Escalate_Latest]
---------------------------------------------------------------------------
----Created By		:   Mahendra Bonde
----Date Created	:	06-01-2010
----Comment		    :	Escalate
---------------------------------------------------------------------------
@pageidentifier as int,
@access as char(8),
@docket_number as char(8),
@SBTAG as char(20),
@Client_Code char(15),
@Product_Code char(50),
@branchtag varchar(50),
@Issue_Raised_Datetime datetime,
@Issue_Resolving_Time datetime, 
@Call_From char(25),
@Call_Type char(25),
@source char(10),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Detailed_Solution varchar(MAX),
@Ex_Remark varchar(200),
@L1_EXRemark varchar(200),
@L1_TLRemark varchar(200),
@L2_Remark varchar(200),
@L3_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team nchar(10),
@Contact_Person char(50),
@Status_Code char(15)
as

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR') and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL' or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV' or @access = 'ITL2EXS' or @access = 'ITL2TLS' or @access = 'ITL2EXI' or @access = 'ITL2TLI') and @Ex_Remark<>'')
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM') and @Ex_Remark<>'') 
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark

Declare @Team_Id as nchar(10)

------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
if @access = 'ITL2EXI' or @access='ITL2TLI' set @Team_Id='ITL2I'
if @access = 'ITL2EXS' or @access='ITL2TLS' set @Team_Id='ITL2S'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'
-------------------------------------------------------------


if @pageidentifier=1
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR' ) and (@Team='ITL2O')
	begin
		set @Status_Code ='ITEL2O'
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end
	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR' ) and (@Team='ITL2I')
	begin
		set @Status_Code ='ITEL2I'
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end
	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR' ) and (@Team='ITL2S')
	begin
		set @Status_Code ='ITEL2S'
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end
	else if (@access = 'L1EX' or @access='L1TL') and (@Team='ITL1')
	begin
		 set @Status_Code ='ITL1E'
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2N')
	begin
		 set @Status_Code ='ITEL2N'
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2V')
	begin
		 set @Status_Code ='ITEL2V'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@SBTAG,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end	
	else if (@access = 'ITL2EXO' or @access='ITL2TLO' or @access ='ITL2EXN' or @access ='ITL2TLN' or @access ='ITL2EXV' or @access ='ITL2TLV' or @access ='ITL2EXS' or @access ='ITL2TLS' or @access ='ITL2EXI' or @access ='ITL2TLI')
	begin
		set @Status_Code = 'ITEL3'         
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

--select @docket_number
end

------------------------------------------------------------------------------

else
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2O')
	begin
		set @Status_Code = 'ITEL2O'
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end
	
	else if (@access = 'L1EX' or @access='L1TL') and (@Team='ITL1')
	begin
		set @Status_Code ='ITL1E'	
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2N')
	begin
		set @Status_Code = 'ITEL2N'
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2V')
	begin
		set @Status_Code ='ITEL2V'
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end
	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2I')
	begin
		set @Status_Code ='ITEL2I'
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end
	else if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') and (@Team='ITL2S')
	begin
		set @Status_Code ='ITEL2S'
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end
	else if @access = 'ITL2EXO' or @access='ITL2EXN' or @access='ITL2EXV' or @access='ITL2EXS' or @access='ITL2EXI' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV' or @access='ITL2TLS' or @access='ITL2TLI'
	begin
		set @Status_Code = 'ITEL3'          
		insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details 
		set Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		status_code=@Status_Code,Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_FillComboAssignPDAjobs
-- --------------------------------------------------




CREATE procedure [dbo].[IT_FillComboAssignPDAjobs]
@issueby  varchar(50)
as
select username
from user_master 
where TeamLeader = (Select TeamLeader from user_master where userid = @issueby ) 

--userid in (select udt.userid from UserID_TL udt where udt.TeamLeader1=@issueby or udt.TeamLeader2=@issueby)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_General_Call
-- --------------------------------------------------
CREATE proc IT_General_Call
as

select distinct(Branch_Name),Docket_number,odin_id,Client_Remark,issue_resolved_by,tbl_it_Odinmaster.odin_manager_code,issue_resolved_datetime,nature
from tbl_newClient_details,tbl_it_odinmaster
where branch_name <> 'null' 
and client_code = odin_id and issue_type = 'IT' and Nature='General Call'
order by Docket_number

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GetAssignPending
-- --------------------------------------------------

CREATE proc [dbo].[IT_GetAssignPending]
@emp_id varchar(15),
@access nvarchar(50),
@issuetype varchar(5),
@user char(10)
as
if (@access ='ITL1TL' and @issuetype = 'I') 
	begin
		select distinct(Docket_Number) as 'Docket No.',
			--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
			tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
			tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
			tbl_NewClient_Details.Brief_solution as [Brief Solution],
			Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,		
			Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Level 1 Executive',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
			--,Status_code
		from tbl_NewClient_Details 
			join ctcl_details
			on tbl_NewClient_Details.client_code=ctcl_odinid
			join view_subbroker
			on ctcl_Details.ctcl_isbtag=view_subbroker.tag
			join tbl_IT_KB_Master
			on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
			join user_master
			on tbl_NewClient_Details.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where status_code='ITL1R' and tbl_NewClient_Details.issue_type = 'IT' and
		issue_resolved_by in (select Employee_ID from tbl_teamleadermaster where Teamleader = @emp_id)
		or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
		order by tbl_NewClient_Details.docket_number
	end
--print @access
else if (@access = 'ITL1TL' and @issuetype = 'E')
	begin
		select distinct(d.Docket_Number) as 'Docket Number',m.Branch_Code as 'Branch Code',
			d.Client_Code as 'Client Code',d.source as 'Source',v.product_name as 'Product Name',
			d.nature as 'Nature',d.problem as 'Problem',
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
			d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'Level 1 Executive',user_master.username as 'Level 1 Executive',
			j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
			--,d.status_code

		from tbl_NewClient_Details d, client_master m, vendor_product v,jobstatusmaster j,user_master
		where m.Client_Code=d.Client_Code and v.product_code=d.product_code and d.status_code=j.jobstatus_id
			and d.issue_resolved_by=user_master.userid and (d.Status_Code='ITL1R' ) and 
			issue_type = 'EBro' and
			issue_resolved_by in (select Employee_ID from tbl_teamleadermaster where Teamleader = @emp_id) --or d.Issue_resolved_By='')
		order by j.jobstatus_name		

	end
else if (@access ='ITL2TLO' and @issuetype = 'I')
begin
	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,		
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Level 2 Executive',user_master.username as 'Level 2 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
	--,Status_code
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where status_code='ITL2RO' and issue_resolved_by in (select Employee_ID from tbl_teamleadermaster where Teamleader = @emp_id)
		or (status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number
end
else if (@access = 'ITL2TLO' and @issuetype = 'E')
	begin
		select distinct(d.Docket_Number) as 'Docket Number',m.Branch_Code as 'Branch Code',
		d.Client_Code as 'Client Code',d.source as 'Source',v.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'Level 1 Executive',user_master.username as 'Level 1 Executive',
		j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
		--,d.status_code

		from tbl_NewClient_Details d, client_master m, vendor_product v,jobstatusmaster j,user_master
		where m.Client_Code=d.Client_Code and v.product_code=d.product_code and d.status_code=j.jobstatus_id
		and d.issue_resolved_by=user_master.userid and (d.Status_Code='ITL2RO' ) and 
		issue_type = 'EBro' and
		issue_resolved_by in (select Employee_ID from tbl_teamleadermaster where Teamleader = @emp_id) --or d.Issue_resolved_By='')
		order by j.jobstatus_name		

	end
else if ((@access ='ITL2TLN' or @access ='ITL2TLV') and @issuetype = 'I') 
begin
	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Level 2 Executive',user_master.username as 'Level 2 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
	--,Status_code
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITL2RN' or status_code='ITL2RV' )and issue_resolved_by in (select Employee_ID from tbl_teamleadermaster where Teamleader = @emp_id)
	or ((status_code='ITEL2N' or status_code='ITEL2V') and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number
end
--else if (@access ='ITL2TLV' and @issuetype = 'I' )
--begin
--	select distinct(Docket_Number) as 'Docket No.',
--	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
--	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
--	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
--	tbl_NewClient_Details.Brief_solution as [Brief Solution],
--	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
--	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Level 2 Executive',user_master.username as 'Level 2 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
--	--,Status_code
--	from tbl_NewClient_Details 
--	join ctcl_details
--	on tbl_NewClient_Details.client_code=ctcl_odinid
--	join view_subbroker
--	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
--	join tbl_IT_KB_Master
--	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
--	join user_master
--	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
--	where status_code='ITL2RV' and issue_resolved_by in (select Employee_ID from tbl_teamleadermaster where Teamleader = @emp_id)
--	or(status_code='ITEL2V' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
--	order by tbl_NewClient_Details.docket_number
--end
else if (@access = 'ADM' or  @access='ITL3TL' or  @access='ITL3EX' or @access='L3TL' or  @access='L3EX') and @issuetype = 'I'
begin
	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Executive id',user_master.username as 'IT Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
	--,Status_code
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code in ('ITL3R','ITL2RV','ITL2RN','ITL2RO','ITL1R','ITEL2O','ITEL2N','ITEL2V','ITEL3'))
	and issue_resolved_by in (select userid from user_master)
	order by tbl_NewClient_Details.docket_number
end
else if (@access = 'ADM' or  @access='ITL3TL' or  @access='ITL3EX' or @access='L3TL' or  @access='L3EX') and @issuetype = 'E' and @user = 'IT'
begin 
	select distinct(d.Docket_Number) as 'Docket Number',m.Branch_Code as 'Branch Code',
	d.Client_Code as 'Client Code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'Level 1 Executive',user_master.username as 'Level 1 Executive',
	j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
	--,d.status_code

	from tbl_NewClient_Details d, client_master m, vendor_product v,jobstatusmaster j,user_master
	where m.Client_Code=d.Client_Code and v.product_code=d.product_code and d.status_code=j.jobstatus_id
	and d.issue_resolved_by=user_master.userid and d.Status_Code in ('ITL1R','L1E') and 
	issue_type = 'EBro' and
	issue_resolved_by in (select userid from user_master where Team_Id = 'ITL1') --or d.Issue_resolved_By='')
	order by j.jobstatus_name
end
--	print @access

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GetClientInfo
-- --------------------------------------------------


CREATE proc [dbo].[IT_GetClientInfo]
@OdinID varchar(20)
as
declare @SB_tag as varchar(20)
select distinct(user_id),name,branch,branch_code,email_id,sb_name,sb_tag,activation_date,mode_of_connectivity,site_code,gateway,subnet_mask,address,location,mode_of_connection,NCFM_valid_upto,Trading_Allowed,manager_version,PAN ,DOB ,RADDRESS1,RADDRESS2,RADDRESS3,rcity,rpin,oaddress1,oaddress2,oaddress3,opin,rmobile,ophone,rphone,RFAX,manager_name,contact_person from (select it_odinid_master.*,it_sb_master.*,it_terminal_master.*,IT_manager_master.* from it_odinid_master join it_sb_master on it_odinid_master.user_id=it_sb_master.odinid join it_terminal_master on it_sb_master.sb_tag=it_terminal_master.sub_broker_tag join IT_manager_master on upper(replace(IT_manager_master.server_name_rm,' ',''))=upper(replace(IT_ODINID_Master.manager_name,' ','')) where user_id=@OdinID) as IT_client_master
select @SB_tag=sb_tag from (select it_sb_master.* from it_odinid_master join it_sb_master on it_odinid_master.user_id=it_sb_master.odinid join it_terminal_master on it_sb_master.sb_tag=it_terminal_master.sub_broker_tag where user_id=@OdinID) as IT_client_master

select distinct(odinid) from it_sb_master where sb_tag=@SB_tag

select distinct(call_type),nature from IT_KB_master

select distinct(team_id),Team_name from IT_teamid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GETKB
-- --------------------------------------------------


CREATE proc [dbo].[IT_GETKB]
@Category int,
@Parameter varchar(max),
@product varchar(20)
as
if @category=1 
begin
	select distinct(product_name),product_name from tbl_IT_kb_master
	select distinct(product_name),nature from tbl_IT_kb_master
	select distinct(Nature),Problem	from tbl_IT_kb_master
--	select distinct(Problem),Detailed_Solution from tbl_IT_kb_master
	select distinct(Problem),Detailed_Solution,Issue_Area,Issue_Type from tbl_IT_kb_master	
end
if @category=2 
--get Problems
begin
	select distinct(problem) from tbl_IT_kb_master where nature=@Parameter and product_name=@product
end
if @category=3 
--get Solutions
begin
	if @Parameter<>''
	begin
		select distinct(Detailed_Solution),issue_type from tbl_IT_kb_master where problem=@Parameter and product_name=@product
	end
	else
	begin
		select distinct(Detailed_Solution),issue_type from tbl_IT_kb_master 
	end

end
if @category=4
--get brief solution for selected  Detailed_Solution
begin
	if @Parameter<>''
	begin
		select Brief_Solution from tbl_IT_KB_Master where Detailed_Solution=@Parameter and product_name=@product
	end	
end
if @category=5
--get call type depending for inbound / outbound paramere
begin
	if @Parameter<>''
	begin
		select distinct(rtrim(Nature)) from tbl_IT_KB_Master where call_type=@Parameter and product_name=@product
	end	
end
if @category=6
--get distinct product_name
begin
	select distinct product_name from tbl_it_kb_master 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Getname
-- --------------------------------------------------



CREATE proc [dbo].[IT_Getname]
@username char(100)
as
select userid from User_Master
where username =@username

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GetProductName
-- --------------------------------------------------


CREATE proc [dbo].[IT_GetProductName]
as
select distinct Product_Name from IT_SBs_Product

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_getrefnumber
-- --------------------------------------------------

CREATE proc [dbo].[IT_getrefnumber]
as
select max(convert(int,Refrence_Number)) from tbl_ITSubbroker_Exists

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GetReportData
-- --------------------------------------------------


CREATE proc [dbo].[IT_GetReportData]

@docket_number varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@flag varchar(1),
@query varchar(1000)

as

--set @BranchName = 'select branch_code from client_master where client_code=@client_code'

--set @issue_raised_datetime_from=convert(datetime,@issue_raised_datetime_from,101)
--set @issue_raised_datetime_to=convert(datetime,@issue_raised_datetime_to,101)

--select * from client_details
--select @client_code = client_code,@product_code = product_code,@issue_resolved_by= issue_resolved_by,@status_code =status_code from client_details where docket_number=@docket_number
--select @client_code = client_code,@product_code = product_code,@issue_resolved_by= issue_resolved_by,@status_code =status_code

--set @query='select * from client_details where '
--set @query ='Select docket_number as ''Docket Number'',client_code as ''Client Code'', product_code as ''Product Code'',Nature,Problem,issue_raised_datetime as ''Issue Raised Date/Time'',issue_resolved_by as ''Issue Resolved By'',issue_resolved_datetime as ''Issue Resolved Date/Time'',status_code as ''Status'' from client_details where '

set @query='select rtrim(d.docket_number) as ''Docket Number'',d.Client_code as ''Client Code'',d.branch_code as ''Branch code'',c.product_name as ''Product Name'',
				d.nature as ''Nature'',d.problem as ''Problem'',d.Issue_Raised_dateTime as ''Issue Raised Date/Time'',tm.Team_Name as ''Issue resolved level'',
				u.UserName as ''Issue resolved by'',d.Issue_Resolved_dateTime as ''Issue Resolved Date/Time'',j.jobstatus_name as ''Status''
			
			from IT_SBs_Product c,IT_client_details d, IT_user_master u, IT_status_master j,IT_TeamID tm
			
			where c.product_code=d.product_code and j.jobstatus_id=d.status_code 
					and u.team_id=tm.team_id and u.userid=d.issue_resolved_by and '

--u.userid=d.Issue_resolved_BY
set @flag =0

-----------------------------------------------1-------------------------------------
if @docket_number<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.docket_number='''+@docket_number+''''-- and rid = (select max(rid) from task_details
--where docket_number='''+@docket_number+''')'
end
else
begin
set @query=@query+ ' d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
--where docket_number='''+@docket_number+''')' 
end
set @flag=1
end
-------------------------------------------end 1---------------------------------------
--------------------------------------------2------------------------------------------
if @client_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.client_code='''+@client_code+ '''' 
end
else
begin
set @query=@query+ ' d.client_code='''+@client_code+ '''' 
end
set @flag=1
end
----------------------------------------end 2---------------------------------------
----------------------------------------3------------------------------------------
if @branch_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and branch_code='''+@branch_code+ '''' 
end
else
begin
set @query=@query+ ' branch_code='''+@branch_code+ '''' 
end
set @flag=1
end
-------------------------------end 3-----------------------------------------------

----------------------------------------4------------------------------------------
if @status_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and j.jobstatus_name='''+@status_code+ '''' 
end
else
begin
set @query=@query+ ' j.jobstatus_name='''+@status_code+ '''' 
end
set @flag=1
end
-------------------------------end 4-----------------------------------------------


----------------------------------------5------------------------------------------
if @product_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and c.product_name='''+@product_code+ '''' 
end
else
begin
set @query=@query+ ' c.product_name='''+@product_code+ '''' 
end
set @flag=1
end
-------------------------------end 5-----------------------------------------------

----------------------------------------6------------------------------------------
if @issue_resolved_by<>''
begin
if @flag=1
begin
set @query=@query+ ' and u.username='''+@issue_resolved_by+ '''' 
end
else
begin
set @query=@query+ ' u.username='''+@issue_resolved_by+ '''' 
end
set @flag=1
end
-------------------------------end 6-----------------------------------------------

----------------------------------------7------------------------------------------
if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+ convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
end
else
begin
set @query=@query+ ' d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
end
set @flag=1
end
-------------------------------end 7-----------------------------------------------


--select @query
set @query=@query+ 'order by d.Issue_Raised_dateTime desc'
exec (@query)

------------------------------------------------------------------------------
--select @username =username  from user_master where userid=@issue_resolved_by
--select @branch_code =branch_code from client_master where client_code=@client_code
--select @jobstatus_name=jobstatus_name from jobstatusmaster where jobstatus_id= @status_code
--select @product_name= product_name from vendor_product where product_code=@product_code
-------------------------------------------------------------------------------

--select @docket_number,@client_code,@username,@branch_code,@jobstatus_name,@product_name

--select getdate()

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GetStatus
-- --------------------------------------------------
CREATE proc [dbo].[IT_GetStatus]
as
select rtrim(JobStatus_Name) as Status
from IT_Status_Master
where JobStatus_Name not like 'new'
and
JobStatus_Name not like 'call back'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_GetTeamList
-- --------------------------------------------------
CREATE proc [dbo].[IT_GetTeamList]
@Identifier as Int
as
select distinct(team_id),Team_name from IT_tea

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_INSERTNEWCLIENT
-- --------------------------------------------------


CREATE proc [dbo].[IT_INSERTNEWCLIENT]
@Refrence_Number as nchar(10)
,@Subbroker_Name as varchar(200) 
,@Branch_Tag as char(25)
,@Branch_Name as varchar(200)
,@Landline as char(10)
,@Office_Number as char(10)
,@Mobile as char(10)
,@Region as varchar(100)
,@State as varchar(100)
,@Email as varchar(100)
,@Address as varchar(200)
,@City as char(100)
,@Issue_Raised_Date as datetime
--,@Issue_Resolved_Date as datetime
,@Product_Name as varchar(50)
,@Nature as varchar(100)
,@Problem as varchar(100)
,@Brief_Solution as varchar(200)
,@Remark as varchar(500)
,@Issue_Resolved_By as char(10)
,@Status as char(10)

as 

INSERT INTO tbl_ITSubbroker_Exists
     VALUES (@Refrence_Number,@Subbroker_Name,@Branch_Tag,@Branch_Name,@Landline,@Office_Number,@Mobile,@Region,@State,@Email,@Address,@City,convert(datetime,@Issue_Raised_Date),getdate(),@Product_Name,@Nature,@Problem,@Brief_Solution,@Remark,@Issue_Resolved_By,@Status)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_currentmonth
-- --------------------------------------------------




CREATE proc [dbo].[IT_levelsummary_currentmonth]
@TL varchar(20),
@access varchar(15), 
@query varchar(500)

as
-------------------------------------------------------------
--Auther		:Sanjay Lavu Kudtarkar
--Created Date  : 5.12.2009
--Comment		:Do not dare to alter this Stored Procedure
--Copy Right	:Angel Broking Pvt. Ltd. 2008(c)
-------------------------------------------------------------
declare @checkid1 int,@checkid2 int,@checkid3 int
declare @viewquery varchar(1000)

if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'   ---@TL='L1T' or @TL='L2TT'
begin
set @query='alter view view_completed_currentmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code=''ITC'' and datename(month,issue_raised_datetime)=datename(month,getdate()) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_currentmonth

set @query='alter view view_escalated_currentmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code=''ITEL2N'' or status_code=''ITEL2O'' or status_code=''ITEL2V'' or status_code=''ITEL3'') and datename(month,issue_raised_datetime)=datename(month,getdate()) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_currentmonth

set @query='alter view view_performancepoint_currentmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,getdate()) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_currentmonth

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_performancepoint_currentmonth.emp_id
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end 
end
else if @access='ADM' or @access='M' 
begin
set @query='alter view view_completed_currentmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code=''ITC'' and datename(month,issue_raised_datetime)=datename(month,getdate())  group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_currentmonth

set @query='alter view view_escalated_currentmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code=''ITEL2N'' or status_code=''ITEL2O'' or status_code=''ITEL2V'' or status_code=''ITEL3'') and datename(month,issue_raised_datetime)=datename(month,getdate())  group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_currentmonth

set @query='alter view view_performancepoint_currentmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,getdate()) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_currentmonth

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_performancepoint_currentmonth.emp_id
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_DailynMonthlyClosed
-- --------------------------------------------------







--exec IT_levelsummary_DailynMonthlycomp 'e03446','ADM','11/4/2009 12:00:00 AM','12/7/2009 12:00:00 AM','Daily','','',''

CREATE procedure [dbo].[IT_levelsummary_DailynMonthlyClosed]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)

--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from TBL_NEWTASKDETAILS where status_code=''ITC'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp5') drop table levelsummary_Temp5
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
			into levelsummary_Temp5
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@location)
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
			into levelsummary_Temp5
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
		END
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
		into levelsummary_Temp5
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Closed) as Closed from levelsummary_Temp5
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Closed) as Closed from levelsummary_Temp5
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
into levelsummary_Temp5
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and (d.status_code='X') and d.issue_resolved_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Closed) as Closed from levelsummary_Temp5
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Closed) as Closed from levelsummary_Temp5
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_DailynMonthlyComp
-- --------------------------------------------------








--exec IT_levelsummary_DailynMonthlycomp 'e03446','ADM','11/4/2009 12:00:00 AM','12/7/2009 12:00:00 AM','Daily','','',''


CREATE procedure [dbo].[IT_levelsummary_DailynMonthlyComp]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)

--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from TBL_NEWTASKDETAILS where status_code=''ITC'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp1') drop table levelsummary_Temp1
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
			into levelsummary_Temp1
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@location)
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
			into levelsummary_Temp1
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
		END
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
		into levelsummary_Temp1
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror1'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp1
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror2'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp1
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
into levelsummary_Temp1
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp1
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp1
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_DailynMonthlyComp_New
-- --------------------------------------------------



--exec IT_levelsummary_DailynMonthlycomp 'e03446','ADM','11/4/2009 12:00:00 AM','12/7/2009 12:00:00 AM','Daily','','',''


CREATE procedure [dbo].[IT_levelsummary_DailynMonthlyComp_New]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
--@query2 varchar(max),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)

--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from tbl_newclient_details where status_code=''ITC'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp1') drop table levelsummary_Temp1
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
		into levelsummary_Temp1
		from tbl_newclient_details d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
		into levelsummary_Temp1
		from tbl_newclient_details d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp1
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp1
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
into levelsummary_Temp1
from tbl_newclient_details d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='ITC' and d.issue_resolved_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp1
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp1
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_DailynMonthlyEscalate
-- --------------------------------------------------






--exec IT_levelsummary_DailynMonthlyEscalate 'e03446','ADM','10/4/2009 12:00:00 AM','12/7/2009 12:00:00 AM','Daily','','',''



CREATE procedure [dbo].[IT_levelsummary_DailynMonthlyEscalate]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from TBL_NEWTASKDETAILS where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp2') drop table levelsummary_Temp2
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
			into levelsummary_Temp2
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code like 'ITE%')  and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@location)
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
			into levelsummary_Temp2
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code like 'ITE%')  and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
		END
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
		into levelsummary_Temp2
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and (d.status_code like 'ITE%') and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,left(date,11) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by left(date,11),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,d.issue_raised_datetime as [date],d.docket_number as Escalated
into levelsummary_Temp2
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and d.status_code like 'ITE%' and d.issue_resolved_datetime
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,left(date,11) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by left(date,11),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_DailynMonthlyPending
-- --------------------------------------------------







--exec IT_levelsummary_DailynMonthlycomp 'e03446','ADM','11/4/2009 12:00:00 AM','12/7/2009 12:00:00 AM','Daily','','',''

CREATE procedure [dbo].[IT_levelsummary_DailynMonthlyPending]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)

--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from TBL_NEWTASKDETAILS where status_code=''ITC'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp3') drop table levelsummary_Temp3
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
			into levelsummary_Temp3
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code='ITP' or d.status_code='ITUP') and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@location)
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
			into levelsummary_Temp3
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code='ITP' or d.status_code='ITUP') and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
		END
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
		into levelsummary_Temp3
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and (d.status_code='ITP' or d.status_code='ITUP') and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Pending) as Pending from levelsummary_Temp3
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Pending) as Pending from levelsummary_Temp3
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
into levelsummary_Temp3
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and (d.status_code='ITP' or d.status_code='ITUP') and d.issue_resolved_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Pending) as Pending from levelsummary_Temp3
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Pending) as Pending from levelsummary_Temp3
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_DailynMonthlyReassigned
-- --------------------------------------------------






--exec IT_levelsummary_DailynMonthlycomp 'e03446','ADM','11/4/2009 12:00:00 AM','12/7/2009 12:00:00 AM','Daily','','',''

CREATE procedure [dbo].[IT_levelsummary_DailynMonthlyReassigned]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)

--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from TBL_NEWTASKDETAILS where status_code=''ITC'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp4') drop table levelsummary_Temp4
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassigned
			into levelsummary_Temp4
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and  (d.status_code='ITL1R' or d.status_code='ITL2RO' or d.status_code='ITL2RN' or d.status_code='ITL2RV' or d.status_code='ITL3R') and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@location)
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassigned
			into levelsummary_Temp4
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code='ITL1R' or d.status_code='ITL2RO' or d.status_code='ITL2RN' or d.status_code='ITL2RV' or d.status_code='ITL3R') and d.issue_resolved_datetime
			--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
		END
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassigned
		into levelsummary_Temp4
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and (d.status_code='ITL1R' or d.status_code='ITL2RO' or d.status_code='ITL2RN' or d.status_code='ITL2RV' or d.status_code='ITL3R')and d.issue_resolved_datetime
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------
--(d.status_code='ITL1R' or d.status_code='ITL2RO' or d.status_code='ITL2RN' or d.status_code='ITL2RV' or d.status_code='ITL3R')

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Reassigned) as Reassigned from levelsummary_Temp4
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Reassigned
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassigned)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Reassigned) as Reassigned from levelsummary_Temp4
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Reassigned
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassigned)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassigned
into levelsummary_Temp4
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and (d.status_code='ITL1R' or d.status_code='ITL2RO' or d.status_code='ITL2RN' or d.status_code='ITL2RV' or d.status_code='ITL3R') and d.issue_resolved_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Reassigned) as Reassigned from levelsummary_Temp4
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Reassigned
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassigned)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Reassigned) as Reassigned from levelsummary_Temp4
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Reassigned
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassigned)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_levelsummary_lastmonth
-- --------------------------------------------------



CREATE proc [dbo].[IT_levelsummary_lastmonth]
@TL varchar(20),
@access varchar(15), 
@query varchar(500)

as
-------------------------------------------------------------
--Auther		: Sanjay Lavu Kudtarkar
--Created Date  : 5.12.2009
--Comment		: Do not dare to alter this Stored Procedure
--Copy Right	: Mastermind Developers Pvt. Ltd. 2008(c)
-------------------------------------------------------------
declare @checkid1 int,@checkid2 int,@checkid3 int
declare @viewquery varchar(1000)

if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL'  ---@TL='L1T' or @TL='L2TT'
begin
set @query='alter view view_completed_lastmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code=''ITC'' and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_lastmonth

set @query='alter view view_escalated_lastmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code=''ITEl2N'' or status_code=''ITEl2O'' or status_code=''ITEl2V'' or status_code=''ITEL3'') and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_lastmonth

set @query='alter view view_performancepoint_lastmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,dateadd(month,-1,getdate())) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_lastmonth

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_performancepoint_lastmonth.emp_id
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end 
end
else if @access='ADM' or @access='M'
begin
set @query='alter view view_completed_lastmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code=''ITC'' and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate()))  group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_lastmonth

set @query='alter view view_escalated_lastmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code=''ITEl2N'' or status_code=''ITEl2O'' or status_code=''ITEl2V'' or status_code=''ITEL3'') and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate()))  group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_lastmonth

set @query='alter view view_performancepoint_lastmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,dateadd(month,-1,getdate())) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_lastmonth

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_performancepoint_lastmonth.emp_id
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Mastermind_test
-- --------------------------------------------------




CREATE proc [dbo].[IT_Mastermind_test]
@TL varchar(20),
@access varchar(15), 
@query varchar(500)

as
set nocount on
-------------------------------------------------------------
--Auther		:Sanjay Lavu Kudtarkar
--Created Date  : 5.12.2009
--Comment		:Do not dare to alter this Stored Procedure
--Copy Right	:Angel Broking Pvt. Ltd. 2008(c)
-------------------------------------------------------------
declare @checkid1 int,@checkid2 int,@checkid3 int
declare @viewquery varchar(1000)

if @access='ITL1TL' or @access='ITL2TLN' or @access='ITL2TLO' or @access='ITL2TLV' or @access='ITL3TL' ---@TL='L1T' or @TL='L2TT'
begin
set @query='alter view view_completed
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code=''ITC'' and left(issue_raised_datetime,11)=left(getdate(),11) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed

set @query='alter view view_escalated
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code=''ITEl2N'' or status_code=''ITEl2O'' or status_code=''ITEl2V'' or status_code=''ITEL3'') and left(issue_raised_datetime,11)=left(getdate(),11) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated

set @query='alter view view_performancepoint
as
select emp_id,date,total from executive_rating
where left(date,11)=left(getdate(),11) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by date,emp_id,total'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join view_performancepoint 
on view_escalated.issue_resolved_by =view_performancepoint.emp_id
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end 
end
else if @access='ADM' or @access='M'
begin
set @query='alter view view_completed
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code=''ITC'' and left(issue_raised_datetime,11)=left(getdate(),11) group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed

set @query='alter view view_escalated
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code=''ITEl2N'' or status_code=''ITEl2O'' or status_code=''ITEl2V'' or status_code=''ITEL3'') and left(issue_raised_datetime,11)=left(getdate(),11)  group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated

set @query='alter view view_performancepoint
as
select emp_id,date,total from executive_rating
where left(date,11)=left(getdate(),11) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by date,emp_id,total'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join view_performancepoint 
on view_escalated.issue_resolved_by =view_performancepoint.emp_id
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end 
end

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------Auther:	Sanjay Lavu Kudtarkar
------Comments:	can create view using this query
--alter view view_Mastermind as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed left join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--join user_master on view_completed.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_completed.issue_resolved_by where left(executive_rating.Date,11)=left(getdate(),11)
---------------------------------------Copyright 2008(C)----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Nature_Report
-- --------------------------------------------------





CREATE PROC [dbo].[IT_Nature_Report]
@Nature as varchar(15)
as

Begin
if @Nature = 'Courtesy call'
	Begin
		SELECT ROW_NUMBER() OVER (order by table1.Location) as 'Sr. No',table1.Location,table1.odin_id as 'Client Name',table1.Remarks, table1.username as 'Confirmation Taken By',table1.odin_manager_code as Server,table1.issue_resolved_datetime as 'Call made data/time'
		from 
			( select distinct(Branch_Name) as Location,odin_id,
					Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id='ITL1EX') THEN L1_InitialRemark 
										WHEN issue_resolved_by in (select userid from user_master where role_id='ITL1TL') THEN L1_FinalRemark
										WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL2EXO','ITL2EXN','ITL2EXV','ITL2TLO','ITL2TLN','ITL2TLV')) THEN L2_UserRemark
										WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL3EX','ITL3TL','ADM')) THEN L3_UserRemark					
								   END,0),
					username,tbl_it_Odinmaster.odin_manager_code,issue_resolved_datetime
					from tbl_newClient_details,tbl_it_odinmaster,user_Master
					where branch_name <> 'null' and issue_resolved_by=userid
					and client_code = odin_id and issue_type = 'IT' 
					and Nature=@Nature and odin_id not in  ('CHIEF','PATAN')
			) as table1 
	End
else if @Nature = 'General Call'
	Begin
		SELECT ROW_NUMBER() OVER (order by table1.Location) as 'Sr. No',table1.Location,table1.odin_id as 'Client Name',table1.Remarks, table1.username as 'Confirmation Taken By',table1.odin_manager_code as Server,table1.issue_resolved_datetime as 'Call made data/time'
		from 
			( select distinct(Branch_Name) as Location,odin_id ,
				Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id='ITL1EX') THEN L1_InitialRemark 
									 WHEN issue_resolved_by in (select userid from user_master where role_id='ITL1TL') THEN L1_FinalRemark
									 WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL2EXO','ITL2EXN','ITL2EXV','ITL2TLO','ITL2TLN','ITL2TLV')) THEN L2_UserRemark
									 WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL3EX','ITL3TL','ADM')) THEN L3_UserRemark					
								END,0),
				username,tbl_it_Odinmaster.odin_manager_code,issue_resolved_datetime
				from tbl_newClient_details,tbl_it_odinmaster,user_Master
				where branch_name <> 'null' and issue_resolved_by=userid
				and client_code = odin_id and issue_type = 'IT' and Nature=@Nature 
			) as table1 
	End
else if @Nature = 'Saaz Call'
	Begin
		SELECT ROW_NUMBER() OVER (order by table1.Location) as 'Sr. No',table1.Location,table1.odin_id as 'Client Name',table1.Remarks, table1.username as 'Confirmation Taken By',table1.odin_manager_code as Server,table1.issue_resolved_datetime as 'Call made data/time'
		from 
			( select distinct(Branch_Name) as Location,odin_id ,
				Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id='ITL1EX') THEN L1_InitialRemark 
									 WHEN issue_resolved_by in (select userid from user_master where role_id='ITL1TL') THEN L1_FinalRemark
									 WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL2EXO','ITL2EXN','ITL2EXV','ITL2TLO','ITL2TLN','ITL2TLV')) THEN L2_UserRemark
									 WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL3EX','ITL3TL','ADM')) THEN L3_UserRemark					
								END,0),
				username,tbl_it_Odinmaster.odin_manager_code,issue_resolved_datetime
				from tbl_newClient_details,tbl_it_odinmaster,user_Master
				where branch_name <> 'null' and issue_resolved_by=userid
				and client_code = odin_id and issue_type = 'IT' and Nature=@Nature 
			) as table1 
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_NewIssue_Latest
-- --------------------------------------------------




CREATE Proc [dbo].[IT_NewIssue_Latest]
@pageidentifier as int,
@docket_number as char(8),
@access as char(10),
@SBTAG as char(20),
@Client_Code char(15),
@Product_Code char(50),
@tagbranch varchar(50),
@Issue_Raised_Datetime datetime,
@Issue_Resolving_Time datetime, 
@Call_From char(25),
@Call_Type char(25),
@source char(10),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Detailed_Solution varchar(MAX),
@Ex_Remark varchar(MAX),
@L1_EXRemark varchar(MAX),
@L1_TLRemark varchar(MAX),
@L2_Remark varchar(MAX),
@L3_Remark varchar(MAX),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15),
@level as int
as

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR' ) and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL' or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'ITL2EXO' or @access = 'ITL2EXI' or @access = 'ITL2EXS' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV' or @access = 'ITL2TLI' or @access = 'ITL2TLS') and @Ex_Remark<>'')
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM') and @Ex_Remark<>'') 
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark

if ((@access='ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV') and @Status_Code='ITC')
	set @status_code='X'

------------------------ IT Team -----------------------------
if @access = 'ITL1EX'  or @access='ITL1TL'  set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
if @access = 'ITL2EXI' or @access='ITL2TLI'  set @Team_Id='ITL2I'
if @access = 'ITL2EXS' or @access='ITL2TLS'  set @Team_Id='ITL2S'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'



if @Status_Code='UP' or @Status_Code='C'
begin
	if @pageidentifier=1
				
		begin
		if @level=1
		begin
			Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
			select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
			Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
			select @docket_number
			end
		end
	else if @pageidentifier=2
		begin
			Update tbl_NewClient_Details 
			set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
			Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
			status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
			where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
end

else if @Status_Code='ITUP'
begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
				Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
				Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
				Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		        select @docket_number
		end

	end
	else if @pageidentifier=2
		
		begin
			Update tbl_NewClient_Details 
			set SBTAG=@SBTAG,Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
			Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
			Team_Id=@Team_Id,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
			where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=3
		begin
			--print(@Issue_Raised_Datetime)
			Update tbl_NewClient_Details 
			set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
			Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
			status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
			where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=4
		begin
			Update tbl_NewClient_Details 
			set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
			Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
			status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
			where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
end	
---------------------------------------------------------------------------------
else if @Status_Code='ITL'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		end		
		else if @pageidentifier=2
		
		begin
		Update tbl_NewClient_Details 
		set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
 		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		--Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),Issue_Raised_Datetime='',L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

		else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details 
		set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
 		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end


		else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details 
		set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		 Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
		Update tbl_NewClient_Details 
		set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=3
		begin
		--print(@Issue_Raised_Datetime)
		Update tbl_NewClient_Details 
		set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details 
		set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
		Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_OdinIdLast3CallHistory
-- --------------------------------------------------
Create Proc IT_OdinIdLast3CallHistory
@Client_Code char(50)
as
select top 3 
d.docket_number as [DocketNumber],
d.Client_Code as [ClientCode],
d.Product_code as [ProductName],
d.Nature,
d.Problem,
d.Brief_solution as [BriefSolution],
Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id='L1EX') THEN L1_InitialRemark 
				 	 WHEN issue_resolved_by in (select userid from user_master where role_id='L1TL') THEN L1_FinalRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L2FEX','L2TEX','L2FTL','L2TTL')) THEN L2_UserRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L3EX','L3TL','ADM')) THEN L3_UserRemark					
					 END,''),
left(d.Issue_raised_datetime,11) as [RaisedDate],
left(d.issue_resolved_datetime,11) as [ResolvedDate],
CONVERT(VARCHAR,d.issue_resolving_time,108) as [TotalTime],
um.username as [Executive],
js.jobstatus_name as [Status]
from tbl_NewClient_details d
join Jobstatusmaster js
on d.status_code=js.JobStatus_Id
join user_master um
on d.issue_resolved_by=um.userid
where d.issue_type='IT' and client_code=@Client_Code
order by d.Issue_raised_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_PendingJobInfo
-- --------------------------------------------------




CREATE proc [dbo].[IT_PendingJobInfo]
@docketnumber as varchar(20)
as
--select 
--distinct(view_subbroker.Tag),
--ctcl_details.ctcl_odinid,
--View_Subbroker.Regname,
--tbl_Branch_Master.Branch_Code,
--tbl_Branch_Master.Branch_Name,
--View_Subbroker.Resadd1 as Address1,
--View_Subbroker.Resadd2 as Address2,
--View_Subbroker.ResPincode as pincode,
--View_Subbroker.Rcity,
--View_Subbroker.resadd3 as State,
--View_Subbroker.PAN,
--View_Subbroker.EMailId,
--View_Subbroker.ResPhone,
--View_Subbroker.Mobile 
--From ctcl_details left Join View_Subbroker on ctcl_details.ctcl_ISBTag=view_subbroker.Tag
--join tbl_Branch_Master on Branch_code=tagbranch
--where ctcl_details.ctcl_odinid=(select client_code from tbl_newclient_details where docket_number = @docketnumber)
--And CTCL_STatus='Active' 
--And view_subbroker.Tag = (select SBTAG from tbl_newclient_details where docket_number = @docketnumber)
select distinct(view_subbroker.Tag),ctcl_details.ctcl_odinid,View_Subbroker.Regname,tbl_ITBranchMaster.Branch_Code,
	tbl_ITBranchMaster.Branch_Name, View_Subbroker.Resadd1 as Address1, View_Subbroker.Resadd2 as Address2,
	View_Subbroker.ResPincode as pincode, View_Subbroker.Rcity,View_Subbroker.resadd3 as State,
	View_Subbroker.PAN, View_Subbroker.EMailId, View_Subbroker.ResPhone,View_Subbroker.Mobile,
	tbl_ITBranchMaster.CSO_Code As [CSO]
From ctcl_details left Join View_Subbroker on ctcl_details.ctcl_ISBTag=view_subbroker.Tag
	join tbl_ITBranchMaster on Branch_code=tagbranch
where ctcl_details.ctcl_odinid=(select client_code from tbl_newclient_details where docket_number = @docketnumber)
--	And CTCL_STatus='Active' 
	And view_subbroker.Tag = (select SBTAG from tbl_newclient_details where docket_number = @docketnumber)


SELECT distinct Docket_Number,view_subbroker.Tag,Client_Code,Product_Code,Issue_Raised_DateTime,Issue_Resolved_Datetime
,Issue_Resolving_Time,Call_From,Call_Type,Issue_Type,tbl_NewClient_Details.Type,Nature,Problem,Brief_Solution,Detailed_Solution,Client_Remark
,L1_InitialRemark,L1_FinalRemark,L2_UserRemark,L3_UserRemark,Issue_Resolved_By,Team_Id,Contact_Person
,tbl_NewClient_Details.Status_Code,jobstatusmaster.JobStatus_name
  FROM tbl_NewClient_Details, jobstatusmaster,view_subbroker,ctcl_details
where docket_number = @docketnumber 
and client_code=ctcl_odinid and ctcl_details.ctcl_ISBTag=view_subbroker.Tag
and Status_Code = JobStatus_Id 
And SBTAG=view_subbroker.Tag
--And CTCL_STatus='Active'


--select 
--docket_number, 
--* from tbl_newclient_details 
--where docket_number = @docketnumber



--'CHIEF'
--
--
--select client_code from tbl_newclient_details 
--
--where docket_number = @docketnumber
--'10000064'
-- 
--select distinct(sb_code) from tbl_IT_Odinmaster where Odin_id = 'CHIEF'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Reassign
-- --------------------------------------------------


CREATE proc [dbo].[IT_Reassign]
@pageidentifier as int,
@docket_number as char(8),
@access char(8),
@Client_Code as char(15),
@Product_Code as char(50),
@Issue_Raised_DateTime as varchar(22),
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature as char(50),
@Problem as varchar(500),
@Brief_Solution as varchar(500),
@Client_Remark as varchar(200) ,
@L1_InitialRemark as varchar(200) ,
@L1_FinalRemark as varchar(200) ,
@L2_UserRemark as varchar(200) ,
@L3_UserRemark as varchar(200) ,
@Issue_Resolved_By as varchar(15) ,
@contact_person as char(50),
@Status_Code as char(15)
as

if @pageidentifier=1
begin 
if (@access = 'ITL1EX')
begin
	set @Status_Code='ITL1R'
	set @L1_FinalRemark =@Client_Remark
	Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	select @docket_number
end
else if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX')
begin
	set @Status_Code='R'
	set @L1_FinalRemark =@Client_Remark
	Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	select @docket_number
end
else if(@access = 'ITL2EXO')
begin
	set @Status_Code='ITL2RO'
	set @L2_UserRemark=@Client_Remark
	Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	select @docket_number
end

else if(@access = 'ITL2EXN')
begin
	set @Status_Code='ITL2RN'
	set @L2_UserRemark=@Client_Remark
	Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	select @docket_number
end

else if(@access = 'ITL2EXV')
begin
	set @Status_Code='ITL2RV'
	set @L2_UserRemark=@Client_Remark
	Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	select @docket_number
end

select @docket_number
end

------------------------------------------------------------------------------

else
begin 
if (@access = 'ITL1EX' or @access='ITL1TL') 
begin
	set @Status_Code='ITL1R'
	set @L1_FinalRemark =@Client_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	update tbl_NewClient_Details set Status_code=@Status_Code,L1_FinalRemark = @L1_FinalRemark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXO' or @access='ITL2TLO') 
begin
	set @Status_Code='ITL2RO'
	set @L2_UserRemark=@Client_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	update tbl_NewClient_Details set Status_code=@Status_Code,L2_userRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXN' or @access='ITL2TLN')
begin
	set @L2_UserRemark=@Client_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	update tbl_NewClient_Details set Status_code=@Status_Code,L2_userRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXV' or @access='ITL2TLV')
begin
	set @Status_Code='ITL2RV'
	set @L2_UserRemark=@Client_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	update tbl_NewClient_Details set Status_code=@Status_Code,L2_userRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end
else if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX')
begin
	set @Status_Code='R'
	set @L2_UserRemark=@Client_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'',@Contact_Person,@Status_Code)
	update tbl_NewClient_Details set Status_code=@Status_Code,L2_userRemark = @L2_UserRemark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end
end



--('',@Client_Code,@Product_Code,convert(datetime,@Issue_Raised_Datetime),'',NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Client_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@contact_person,@Status_Code)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Reassign_Latest
-- --------------------------------------------------





CREATE proc [dbo].[IT_Reassign_Latest]
@pageidentifier as int,
@docket_number as char(8),
@access char(8),
@SBTAG as char(20),
@Client_Code as char(15),
@Product_Code as char(50),
@branchtag varchar(50),
@Issue_Raised_DateTime as varchar(22),
@Issue_Resolving_Time datetime, 
@Call_From char(25),
@Call_Type char(25),
@source char(10),
@Issue_Type char(25),
@Type char(25),
@Nature as char(50),
@Problem as varchar(500),
@Brief_Solution as varchar(500),
@Detailed_Solution as varchar(MAX),
@Ex_Remark varchar(200),
@L1_EXRemark varchar(200),
@L1_TLRemark varchar(200),
@L2_Remark varchar(200),
@L3_Remark varchar(200),
@Issue_Resolved_By as varchar(15) ,
@Team_Id nchar(10),
@contact_person as char(50),
@Status_Code as char(15)
as

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR') and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL'  or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV' or @access = 'ITL2EXI' or @access = 'ITL2TLI'  or @access = 'ITL2EXS' or @access = 'ITL2TLS') and @Ex_Remark<>'')
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM') and @Ex_Remark<>'') 
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark

------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
if @access = 'ITL2EXI' or @access='ITL2TLI' set @Team_Id='ITL2I'
if @access = 'ITL2EXS' or @access='ITL2TLS' set @Team_Id='ITL2S'

------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'



if @pageidentifier=1
begin 
if (@access = 'ITL1EX' or @access = 'ITL1EXBR')
begin
	set @Status_Code='ITL1R'
	--set @L1_FinalRemark =@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end
else if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX')
begin
	set @Status_Code='R'
	--set @L1_FinalRemark =@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end
else if(@access = 'ITL2EXO')
begin
	set @Status_Code='ITL2RO'
	--set @L2_UserRemark=@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end

else if(@access = 'ITL2EXN')
begin
	set @Status_Code='ITL2RN'
	--set @L2_UserRemark=@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end

else if(@access = 'ITL2EXV')
begin
	set @Status_Code='ITL2RV'
	--set @L2_UserRemark=@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end

else if(@access = 'ITL2EXS')
begin
	set @Status_Code='ITL2RS'
	--set @L2_UserRemark=@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end

else if(@access = 'ITL2EXI')
begin
	set @Status_Code='ITL2RI'
	--set @L2_UserRemark=@Ex_Remark
	Insert Into tbl_NewClient_Details Values('',@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
	select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	select @docket_number
end

select @docket_number
end

------------------------------------------------------------------------------

else
begin 
if (@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1EXBR' or @access='ITL1TLBR') 
begin
	set @Status_Code='ITL1R'
	--set @L1_FinalRemark =@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXO' or @access='ITL2TLO') 
begin
	set @Status_Code='ITL2RO'
	--set @L2_UserRemark=@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),	
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXN' or @access='ITL2TLN')
begin
	--set @L2_UserRemark=@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXV' or @access='ITL2TLV')
begin
	set @Status_Code='ITL2RV'
	--set @L2_UserRemark=@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),	
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXI' or @access='ITL2TLI')
begin
	set @Status_Code='ITL2RI'
	--set @L2_UserRemark=@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),	
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end

else if(@access = 'ITL2EXS' or @access='ITL2TLS')
begin
	set @Status_Code='ITL2RS'
	--set @L2_UserRemark=@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),	
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end
else if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX')
begin
	set @Status_Code='R'
	--set @L2_UserRemark=@Ex_Remark
	--insert into task_details values('',@docket_number,@EmployeeCode,convert(datetime,@Issue_Raised_Datetime),convert(datetime,),@Status_Code,'')
	Insert into tbl_NewTaskDetails values('',@docket_number,@SBTAG,@Client_Code,@Product_Code,@branchtag,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
	update tbl_NewClient_Details 
	set SBTAG=@SBTAG,Team_Id=@Team_Id,Brief_Solution=@Brief_Solution,Detailed_solution=@Detailed_Solution,
	Status_code=@Status_Code,L1_InitialRemark=@L1_EXRemark,
	Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
	L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
	Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
	where docket_number = @docket_number
end
end



--('',@Client_Code,@Product_Code,convert(datetime,@Issue_Raised_Datetime),'',NULL,'','','',@Nature,@Problem,@BriefSolution,'',@Ex_Remark,@L1_InitialRemark,@L1_FinalRemark ,@L2_UserRemark ,@L3_UserRemark ,@Issue_Resolved_By,'',@contact_person,@Status_Code)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_Saaz_Call
-- --------------------------------------------------


CREATE proc [dbo].[IT_Saaz_Call]
as

select distinct(Branch_Name) as Location,Docket_number ,odin_id as 'Client Name',Client_Remark as Remarks,
issue_resolved_by as 'Confirmation Taken By',tbl_it_Odinmaster.odin_manager_code as Server,
issue_resolved_datetime as 'Call made data/time',nature
from tbl_newClient_details,tbl_it_odinmaster
where branch_name <> 'null' 
and client_code = odin_id and issue_type = 'IT' and Nature='Saaz Call'
order by Docket_number

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_SPCallBack
-- --------------------------------------------------


CREATE proc [dbo].[IT_SPCallBack]
@emp_id varchar(15),@access varchar(15)
as
if @access ='ITL1EX' 
--or @access = 'ITL2EXO' or @access = 'ITL2EXN' or @access = 'ITL2EXV' or @access = 'ITL3EX'
begin

	select distinct(rtrim(d.docket_number)) as 'Docket Number',d.Client_code as 'Client Code',bm.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.status_code
	from tbl_NewClient_Details d, user_master u,tbl_IT_KB_Master v,Team_Master tm,ctcl_details cd,View_Subbroker vs,tbl_Branch_Master bm
	where (cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag and u.userid=d.Issue_resolved_BY 
	and u.team_id=tm.team_id and v.product_Name=d.product_code and Branch_code=vs.tagbranch and vs.tagbranch=d.tagbranch)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
	and (d.status_code like 'ITC'
	and (issue_resolved_by= @emp_id
	or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
	order by d.Issue_Resolved_dateTime

end
else if @access = 'ITL1TL' 
--or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL3TL'
begin

	select distinct(rtrim(d.docket_number)) as 'Docket Number',d.Client_code as 'Client Code',bm.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.status_code
	from tbl_NewClient_Details d, user_master u,tbl_IT_KB_Master v,Team_Master tm,ctcl_details cd,View_Subbroker vs,tbl_Branch_Master bm
	where (cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag and u.userid=d.Issue_resolved_BY 
	and u.team_id=tm.team_id and v.product_Name=d.product_code and Branch_code=vs.tagbranch and vs.tagbranch=d.tagbranch)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
	and (d.status_code like 'ITC'
	and (issue_resolved_by = @emp_id 
	or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id)
	or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
	order by d.Issue_Resolved_dateTime 

end
else if @access = 'ADM'
begin
	select distinct(rtrim(d.docket_number)) as 'Docket Number',d.Client_code as 'Client Code',bm.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.status_code
	from tbl_NewClient_Details d, user_master u,tbl_IT_KB_Master v,Team_Master tm,ctcl_details cd,View_Subbroker vs,tbl_Branch_Master bm
	where (cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag and u.userid=d.Issue_resolved_BY 
	and u.team_id=tm.team_id and v.product_Name=d.product_code and Branch_code=vs.tagbranch and vs.tagbranch=d.tagbranch )
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
	and (d.status_code like 'ITC'
	and (issue_resolved_by in (select userid from user_master where role_id like 'IT%')))
	order by d.Issue_Resolved_dateTime

end




--select userid,role_id from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_SPCallBack_Latest
-- --------------------------------------------------


CREATE proc [dbo].[IT_SPCallBack_Latest]

@emp_id varchar(15),
@access varchar(15),
@FromDate Datetime,
@ToDate Datetime,
@CSO varchar(15)

as
if @access ='ITL1EXBR' 
--or @access = 'ITL2EXO' or @access = 'ITL2EXN' or @access = 'ITL2EXV' or @access = 'ITL3EX'
begin
		Select distinct(rtrim(d.docket_number)) as 'Docket Number',
			--d.SBTag as 'SubBroker Tag',
			d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
			pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
			d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
			tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
			d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
			--,d.status_code
		from tbl_newclient_details (NOLOCK) d,
			--ctcl_details (NOLOCK) cd,
			user_master (NOLOCK) u,
			--view_subbroker (NOLOCK) vs,
			tbl_it_productmaster (NOLOCK) pm,
			tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 

		where d.issue_resolved_by=u.userid 
			--and d.client_code=cd.ctcl_odinid and d.tagbranch=vs.tagbranch and cd.ctcl_isbtag=vs.tag 
			and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
			and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND' and d.issue_type='IT'
			and d.status_code='ITC' and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
				Where Teamleader in (Select Distinct Teamleader From tbl_teamleadermaster Where Employee_ID=@emp_id))
			And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
		order by d.Issue_Resolved_dateTime



--		select distinct(rtrim(d.docket_number)) as 'Docket Number',
--		--d.SBTag as 'SubBroker Tag',
--		d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
--		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
--		d.Brief_solution as [Brief Solution],
--		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
--		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
--		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
--		--,d.status_code
--		from tbl_newclient_details d,ctcl_details cd,user_master u,view_subbroker vs,tbl_it_productmaster pm,
--		tbl_branch_master bm,team_master tm
--
--		where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
--		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
--		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND' and d.issue_type='IT'
--		and d.status_code like 'ITC' and issue_resolved_by= @emp_id 
--	--or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
--		order by d.Issue_Resolved_dateTime

end

if @access ='ITL1EX' 
--or @access = 'ITL2EXO' or @access = 'ITL2EXN' or @access = 'ITL2EXV' or @access = 'ITL3EX'
begin
		Select distinct(rtrim(d.docket_number)) as 'Docket Number',
			--d.SBTag as 'SubBroker Tag',
			d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
			pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
			d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
			tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
			d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
			--,d.status_code
		from tbl_newclient_details (NOLOCK) d,
			--ctcl_details (NOLOCK) cd,
			user_master (NOLOCK) u,
			--view_subbroker (NOLOCK) vs,
			tbl_it_productmaster (NOLOCK) pm,
			tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 

		where d.issue_resolved_by=u.userid 
			--and d.client_code=cd.ctcl_odinid and d.tagbranch=vs.tagbranch and cd.ctcl_isbtag=vs.tag 
			and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
			and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND' and d.issue_type='IT'
			and d.status_code='ITC' and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
			 Where Teamleader in (Select Distinct Teamleader From tbl_teamleadermaster Where Employee_ID=@emp_id))
			And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
		order by d.Issue_Resolved_dateTime
end


if @access ='L1EX' 
--or @access = 'ITL2EXO' or @access = 'ITL2EXN' or @access = 'ITL2EXV' or @access = 'ITL3EX'
begin

		select distinct(rtrim(d.docket_number)) as 'Docket Number',
		--d.SBTag as 'SubBroker Tag',
		d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
		from tbl_newclient_details d,ctcl_details cd,user_master u,view_subbroker vs,tbl_it_productmaster pm,
		tbl_branch_master bm,team_master tm

		where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND'
		and d.status_code='C' and issue_resolved_by= @emp_id and d.issue_type='IT'
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
	--or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
	order by d.Issue_Resolved_dateTime

end
else if @access = 'ITL1TLBR' 
--or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL3TL'
begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
		--,d.SBTag as 'SubBroker Tag'
		,d.Client_code as 'Client Code',
		d.tagbranch as 'Branch code',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
		pm.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
	from tbl_newclient_details (NOLOCK) d,
		--ctcl_details (NOLOCK) cd,
		user_master (NOLOCK) u,
		--view_subbroker (NOLOCK) vs,
		tbl_it_productmaster (NOLOCK) pm,
		tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 
	where 
		-- d.client_code=cd.ctcl_odinid 	and 
		d.issue_resolved_by=u.userid and 
		-- d.tagbranch=vs.tagbranch
		-- and cd.ctcl_isbtag=vs.tag and 
		d.Product_Code=pm.product_name and 
		d.tagbranch=bm.branch_code 
		and u.team_id=tm.team_id and d.call_type='INBOUND'
		And (Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113)))
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
		and (d.status_code like 'ITC' and d.issue_type='IT'
		and (issue_resolved_by =@emp_id
		or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
		
		order by d.Issue_Resolved_dateTime 


--	select distinct(rtrim(d.docket_number)) as 'Docket Number'
--		--,d.SBTag as 'SubBroker Tag'
--		,d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
--		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
--		d.Brief_solution as [Brief Solution],
--		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
--		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
--		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
--		--,d.status_code
--	from tbl_newclient_details (NOLOCK) d,ctcl_details (NOLOCK) cd,
--		user_master (NOLOCK) u,view_subbroker (NOLOCK) vs,tbl_it_productmaster (NOLOCK) pm,
--		tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 
--	where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
--		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code 
--		and u.team_id=tm.team_id and d.call_type='INBOUND'
--		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
--		and (d.status_code like 'ITC' and d.issue_type='IT'
--		and (issue_resolved_by = @emp_id 
--		or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
--		order by d.Issue_Resolved_dateTime 

end
else if @access = 'ITL1TL' 
--or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL3TL'
begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
		--,d.SBTag as 'SubBroker Tag'
		,d.Client_code as 'Client Code',
		d.tagbranch as 'Branch code',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
		pm.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
	from tbl_newclient_details (NOLOCK) d,
		--ctcl_details (NOLOCK) cd,
		user_master (NOLOCK) u,
		--view_subbroker (NOLOCK) vs,
		tbl_it_productmaster (NOLOCK) pm,
		tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 
	where 
		-- d.client_code=cd.ctcl_odinid 	and 
		d.issue_resolved_by=u.userid and 
		-- d.tagbranch=vs.tagbranch
		-- and cd.ctcl_isbtag=vs.tag and 
		d.Product_Code=pm.product_name and 
		d.tagbranch=bm.branch_code 
		and u.team_id=tm.team_id and d.call_type='INBOUND'
		And (Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113)))
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
		and (d.status_code like 'ITC' and d.issue_type='IT'
		--and (issue_resolved_by =@emp_id
		--or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
		and (issue_resolved_by =@emp_id
			or issue_resolved_by in (select Employee_id from tbl_teamleadermaster Where teamleader in (Select Userid From User_Master Where Role_ID in ('ITL1TLBR','ITL1TL') And Account_Status=1))))
		order by d.Issue_Resolved_dateTime 
end
else if @access = 'L1TL' 
--or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL3TL'
begin

	select distinct(rtrim(d.docket_number)) as 'Docket Number',
		--,d.SBTag as 'SubBroker Tag',d.Client_code as 'Client Code',d.tagbranch as 'Branch code'
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when d.TagBranch<>'' Then d.TagBranch End) As 'Branch code',
				(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
	from tbl_newclient_details d,ctcl_details cd,user_master u,view_subbroker vs,tbl_it_productmaster pm,
		tbl_branch_master bm,team_master tm 
	where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code 
		and u.team_id=tm.team_id and d.call_type='INBOUND'
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
		and (d.status_code like 'C' and d.issue_type='IT'
		and (issue_resolved_by = @emp_id 
		or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
		--or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id)
		--or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
		order by d.Issue_Resolved_dateTime 

end
else if ( @access='ITL3EX' or @access='ITL3TL' or @access='L3EX' or @access='L3TL')
begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
	--,d.SBTag as 'SubBroker Tag'
	,d.Client_code as 'Client Code',d.Tagbranch as 'Branch code',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
	d.product_Code as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
	--,d.status_code
	from tbl_NewClient_Details (NOLOCK) d, user_master (NOLOCK) u,tbl_IT_KB_Master (NOLOCK) v,Team_Master (NOLOCK) tm
		--,ctcl_details cd,View_Subbroker vs
	where (
		--cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag 
	 u.userid=d.Issue_resolved_BY and d.call_type='INBOUND'
	and u.team_id=tm.team_id 
	--and d.tagbranch=vs.tagbranch
	 )
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.issue_type='IT'
	and 
	(
		(d.status_code like 'ITC' and (issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))) 
		or
		(d.status_code like 'C' and (issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
	)
	And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
		Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
			Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
	order by d.Issue_Resolved_dateTime


--	select distinct(rtrim(d.docket_number)) as 'Docket Number'
--	--,d.SBTag as 'SubBroker Tag'
--	,d.Client_code as 'Client Code',d.Tagbranch as 'Branch code',d.product_Code as 'Product Name',
--	d.nature as 'Nature',d.problem as 'Problem',d.Brief_solution as [Brief Solution],
--	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
--	--,d.status_code
--	from tbl_NewClient_Details d, user_master u,tbl_IT_KB_Master v,Team_Master tm,ctcl_details cd,View_Subbroker vs
--	where (cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag 
--	and u.userid=d.Issue_resolved_BY and d.call_type='INBOUND'
--	and u.team_id=tm.team_id and d.tagbranch=vs.tagbranch
--	 )
--	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.issue_type='IT'
--	and 
--	(
--		(d.status_code like 'ITC' and (issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))) 
--		or
--		(d.status_code like 'C' and (issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
--	)
--	order by d.Issue_Resolved_dateTime

end
--select userid,role_id from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL')
else if(@access = 'ADM')
begin
	If(@CSO<>'')
	Begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
		--,d.SBTag as 'SubBroker Tag'
		,d.Client_code as 'Client Code',d.Tagbranch as 'Branch code',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
		d.product_Code as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
		from tbl_NewClient_Details (NOLOCK) d, user_master (NOLOCK) u,tbl_IT_KB_Master (NOLOCK) v,Team_Master (NOLOCK) tm
			--,ctcl_details cd,View_Subbroker vs
		where (
			--cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag 
		 u.userid=d.Issue_resolved_BY and d.call_type='INBOUND'
		and u.team_id=tm.team_id 
		--and d.tagbranch=vs.tagbranch
		 )
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.issue_type='IT'
		and 
		(
			(d.status_code like 'ITC' and (issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))) 
			or
			(d.status_code like 'C' and (issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
		)
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
			Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
		And issue_resolved_by in (Select Userid From MUser_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code=@CSO))
		order by d.Issue_Resolved_dateTime
	End
	Else If(@CSO='')
	Begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
		--,d.SBTag as 'SubBroker Tag'
		,d.Client_code as 'Client Code',d.Tagbranch as 'Branch code',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',
		d.product_Code as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
		from tbl_NewClient_Details d with (NOLOCK), user_master u with (NOLOCK),
			tbl_IT_KB_Master v with (NOLOCK),Team_Master tm with (NOLOCK) 
			--,ctcl_details cd,View_Subbroker vs
		where (u.userid=d.Issue_resolved_BY and d.call_type='INBOUND' and u.team_id=tm.team_id )
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.issue_type='IT'
		and 
		(
			(d.status_code like 'ITC' and (issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))) 
			or
			(d.status_code like 'C' and (issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
		)
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
			Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
		And issue_resolved_by in (Select Distinct Userid From User_Master Where Account_Status=1 And Branch_ID in (Select Distinct Branch_Code From tbl_ITBranchMaster))
		order by d.Issue_Resolved_dateTime
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_SPCallBack_new
-- --------------------------------------------------





CREATE proc [dbo].[IT_SPCallBack_new]
@emp_id varchar(15),@access varchar(15)
as
if @access ='ITL1EX' 
--or @access = 'ITL2EXO' or @access = 'ITL2EXN' or @access = 'ITL2EXV' or @access = 'ITL3EX'
begin
		Select distinct(rtrim(d.docket_number)) as 'Docket Number',
			--d.SBTag as 'SubBroker Tag',
			d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
			pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
			d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
			tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
			d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
			--,d.status_code
		from tbl_newclient_details (NOLOCK) d,
			--ctcl_details (NOLOCK) cd,
			user_master (NOLOCK) u,
			--view_subbroker (NOLOCK) vs,
			tbl_it_productmaster (NOLOCK) pm,
			tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 

		where d.issue_resolved_by=u.userid 
			--and d.client_code=cd.ctcl_odinid and d.tagbranch=vs.tagbranch and cd.ctcl_isbtag=vs.tag 
			and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
			and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND' and d.issue_type='IT'
			and d.status_code='ITC' and issue_resolved_by= @emp_id 
		order by d.Issue_Resolved_dateTime


--		select distinct(rtrim(d.docket_number)) as 'Docket Number',
--		--d.SBTag as 'SubBroker Tag',
--		d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
--		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
--		d.Brief_solution as [Brief Solution],
--		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
--		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
--		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
--		--,d.status_code
--		from tbl_newclient_details d,ctcl_details cd,user_master u,view_subbroker vs,tbl_it_productmaster pm,
--		tbl_branch_master bm,team_master tm
--
--		where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
--		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
--		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND' and d.issue_type='IT'
--		and d.status_code like 'ITC' and issue_resolved_by= @emp_id 
--	--or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
--		order by d.Issue_Resolved_dateTime

end
if @access ='L1EX' 
--or @access = 'ITL2EXO' or @access = 'ITL2EXN' or @access = 'ITL2EXV' or @access = 'ITL3EX'
begin

		select distinct(rtrim(d.docket_number)) as 'Docket Number',
		--d.SBTag as 'SubBroker Tag',
		d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
		from tbl_newclient_details d,ctcl_details cd,user_master u,view_subbroker vs,tbl_it_productmaster pm,
		tbl_branch_master bm,team_master tm

		where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code and u.team_id=tm.team_id
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.call_type='INBOUND'
		and d.status_code='C' and issue_resolved_by= @emp_id and d.issue_type='IT'
	--or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
	order by d.Issue_Resolved_dateTime

end
else if @access = 'ITL1TL' 
--or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL3TL'
begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
		--,d.SBTag as 'SubBroker Tag'
		,d.Client_code as 'Client Code',
		d.tagbranch as 'Branch code',
		pm.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
	from tbl_newclient_details (NOLOCK) d,
		--ctcl_details (NOLOCK) cd,
		user_master (NOLOCK) u,
		--view_subbroker (NOLOCK) vs,
		tbl_it_productmaster (NOLOCK) pm,
		tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 
	where 
		-- d.client_code=cd.ctcl_odinid 	and 
		d.issue_resolved_by=u.userid and 
		-- d.tagbranch=vs.tagbranch
		-- and cd.ctcl_isbtag=vs.tag and 
		d.Product_Code=pm.product_name and 
		d.tagbranch=bm.branch_code 
		and u.team_id=tm.team_id and d.call_type='INBOUND'
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
		and (d.status_code like 'ITC' and d.issue_type='IT'
		and (issue_resolved_by =@emp_id
		or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
		order by d.Issue_Resolved_dateTime 


--	select distinct(rtrim(d.docket_number)) as 'Docket Number'
--		--,d.SBTag as 'SubBroker Tag'
--		,d.Client_code as 'Client Code',d.tagbranch as 'Branch code',
--		pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
--		d.Brief_solution as [Brief Solution],
--		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
--		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
--		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
--		--,d.status_code
--	from tbl_newclient_details (NOLOCK) d,ctcl_details (NOLOCK) cd,
--		user_master (NOLOCK) u,view_subbroker (NOLOCK) vs,tbl_it_productmaster (NOLOCK) pm,
--		tbl_branch_master (NOLOCK) bm,team_master (NOLOCK) tm 
--	where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
--		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code 
--		and u.team_id=tm.team_id and d.call_type='INBOUND'
--		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
--		and (d.status_code like 'ITC' and d.issue_type='IT'
--		and (issue_resolved_by = @emp_id 
--		or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
--		order by d.Issue_Resolved_dateTime 

end
else if @access = 'L1TL' 
--or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL3TL'
begin

	select distinct(rtrim(d.docket_number)) as 'Docket Number'
		--,d.SBTag as 'SubBroker Tag',d.Client_code as 'Client Code',d.tagbranch as 'Branch code'
		,pm.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
		tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',
		d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
		--,d.status_code
	from tbl_newclient_details d,ctcl_details cd,user_master u,view_subbroker vs,tbl_it_productmaster pm,
		tbl_branch_master bm,team_master tm 
	where d.client_code=cd.ctcl_odinid 	and d.issue_resolved_by=u.userid and d.tagbranch=vs.tagbranch
		and cd.ctcl_isbtag=vs.tag and d.Product_Code=pm.product_name and d.tagbranch=bm.branch_code 
		and u.team_id=tm.team_id and d.call_type='INBOUND'
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 
		and (d.status_code like 'C' and d.issue_type='IT'
		and (issue_resolved_by = @emp_id 
		or issue_resolved_by in (select employee_id from tbl_teamleadermaster where teamLeader=@emp_id)))
		--or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id)
		--or issue_resolved_by in (select userid from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL'))))
		order by d.Issue_Resolved_dateTime 

end
else if (@access = 'ADM' or @access='ITL3EX' or @access='ITL3TL' or @access='L3EX' or @access='L3TL')
begin
		select distinct(rtrim(d.docket_number)) as 'Docket Number'
	--,d.SBTag as 'SubBroker Tag'
	,d.Client_code as 'Client Code',d.Tagbranch as 'Branch code',d.product_Code as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
	--,d.status_code
	from tbl_NewClient_Details (NOLOCK) d, user_master (NOLOCK) u,tbl_IT_KB_Master (NOLOCK) v,Team_Master (NOLOCK) tm
		--,ctcl_details cd,View_Subbroker vs
	where (
		--cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag 
	 u.userid=d.Issue_resolved_BY and d.call_type='INBOUND'
	and u.team_id=tm.team_id 
	--and d.tagbranch=vs.tagbranch
	 )
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.issue_type='IT'
	and 
	(
		(d.status_code like 'ITC' and (issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))) 
		or
		(d.status_code like 'C' and (issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
	)
	order by d.Issue_Resolved_dateTime


--	select distinct(rtrim(d.docket_number)) as 'Docket Number'
--	--,d.SBTag as 'SubBroker Tag'
--	,d.Client_code as 'Client Code',d.Tagbranch as 'Branch code',d.product_Code as 'Product Name',
--	d.nature as 'Nature',d.problem as 'Problem',d.Brief_solution as [Brief Solution],
--	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time'
--	--,d.status_code
--	from tbl_NewClient_Details d, user_master u,tbl_IT_KB_Master v,Team_Master tm,ctcl_details cd,View_Subbroker vs
--	where (cd.ctcl_odinid=d.client_code and cd.ctcl_odinid=vs.tag 
--	and u.userid=d.Issue_resolved_BY and d.call_type='INBOUND'
--	and u.team_id=tm.team_id and d.tagbranch=vs.tagbranch
--	 )
--	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.issue_type='IT'
--	and 
--	(
--		(d.status_code like 'ITC' and (issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))) 
--		or
--		(d.status_code like 'C' and (issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
--	)
--	order by d.Issue_Resolved_dateTime

end




--select userid,role_id from user_master where role_id like 'IT%' and role_id NOT IN ('ITL1EX','ITL1TL')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_SPGetAllExecutive
-- --------------------------------------------------


create proc [dbo].[IT_SPGetAllExecutive]
as
select username from user_master where role_id like 'IT%' order by username

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_SPlogin
-- --------------------------------------------------

CREATE procedure [dbo].[IT_SPlogin]
@empid varchar(50),@pwd varchar(50) 
as 
if @pwd=''
begin
Select userid,username,u.Role_id,Branch_id,Email,login_status,TeamLeader,Login_status ,r.Role_name,access_id
From tbl_IT_user_master u,tbl_IT_role_master r
Where userid = @empid and u.Role_id=r.Role_Id
end
else
begin 
Select userid,username,u.Role_id,Branch_id,Email,login_status,TeamLeader,Login_status ,r.Role_name,access_id
From tbl_IT_user_master u,tbl_IT_role_master r
Where userid = @empid and password=@pwd and u.Role_id=r.Role_Id
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_spPendingJobs
-- --------------------------------------------------









CREATE procedure [dbo].[IT_spPendingJobs]
@emp_id varchar(15),@access varchar(15), @issuetype varchar(5)
as
if @access ='ITL1EX'  and @issuetype = 'E'
begin

	select distinct temp.Docket_Number as 'Docket No.',temp.client_code as 'Client Code',
	temp.Branch_code as 'Branch',temp.source as 'Source',temp.product_name as 'Product',
	temp.Nature,temp.Problem,temp.Brief_solution as [Brief Solution],temp.Remark,
	temp.Issue_Raised_dateTime as 'Issue Date/Time',temp.Issue_Resolved_dateTime as 'Last Updated time',
	temp.username as 'Level 1 Executive',temp.jobstatus_name as 'Status',temp.hours  
	from
	(
		select rtrim(Docket_Number) as Docket_number,tbl_NewClient_Details.client_code as client_code,
		Branch_code,tbl_NewClient_Details.source as source,vendor_product.product_name,
		Nature,Problem,	tbl_NewClient_Details.Brief_solution as Brief_solution,
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		tbl_NewClient_Details.Issue_Raised_dateTime,tbl_NewClient_Details.Issue_Resolved_dateTime,user_master.username,jobstatusmaster.jobstatus_name,datediff(hour,issue_raised_datetime,getdate()) as hours  
		--,user_master.role_id
		from tbl_NewClient_Details 
		join client_master
		on tbl_NewClient_Details.client_code=client_master.client_code
		join vendor_product
		on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where (status_code='ITP' or status_code='ITUP')  and issue_resolved_by=@emp_id
		and issue_type = 'EBro'
	) temp
	order by docket_number

end

else if @access='ITL1TL' and @issuetype = 'E'
begin

	select distinct temp.Docket_Number as 'Docket No.',temp.client_code as 'Client Code',
	temp.Branch_code as 'Branch',temp.source as 'Source',temp.product_name as 'Product',
	temp.Nature,temp.Problem,temp.Brief_solution as [Brief Solution],temp.Remark,
	temp.Issue_Raised_dateTime as 'Issue Date/Time',temp.Issue_Resolved_dateTime as 'Last Updated time',
	temp.username as 'Level 1 Executive',temp.jobstatus_name as 'Status',temp.hours  
	from
	(
		select rtrim(Docket_Number) as Docket_number,tbl_NewClient_Details.client_code as client_code,
		Branch_code,tbl_NewClient_Details.source as source,vendor_product.product_name,
		Nature,Problem,	tbl_NewClient_Details.Brief_solution as Brief_solution,
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		tbl_NewClient_Details.Issue_Raised_dateTime,tbl_NewClient_Details.Issue_Resolved_dateTime,user_master.username,jobstatusmaster.jobstatus_name,datediff(hour,issue_raised_datetime,getdate()) as hours  
		--,user_master.role_id
		from tbl_NewClient_Details 
		join client_master
		on tbl_NewClient_Details.client_code=client_master.client_code
		join vendor_product
		on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where (status_code='ITP' or status_code='ITUP')  
		and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		and issue_type = 'EBro'
	) temp
	order by docket_number  
end

else if @access ='ITL1EX' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITP' or status_code='ITUP')  and issue_resolved_by= @emp_id 
	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL1TL' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
	--or (status_code='ITL1R' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2EXO' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  and issue_resolved_by= @emp_id) and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2EXN' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  and issue_resolved_by= @emp_id) and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2N' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2EXV' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and issue_resolved_by= 'E03128') and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2TLO' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	--or (status_code='ITL2RO' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2TLN' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2N' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	--or (status_code='ITL2RN' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2TLV' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2V' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	--or (status_code='ITL2RV' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end
--
--else if @access ='ITL3EX' and @issuetype = 'I'
--begin
--
--	select distinct(Docket_Number) as 'Docket No.',tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
--	--,user_master.role_id
--	from tbl_NewClient_Details 
--	join ctcl_details
--	on tbl_NewClient_Details.client_code=ctcl_odinid
--	join view_subbroker
--	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
--	join tbl_IT_KB_Master
--	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
--	join user_master
--	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
--	where ((status_code='ITP' or status_code='ITUP' )  and issue_resolved_by= @emp_id) and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
--	--or(status_code='ITEL3' and issue_resolved_by in (select userid from user_master where Role_id IN ('ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXV','ITL2TLV')))
--	order by tbl_NewClient_Details.docket_number
--
--end
--
--else if @access ='ITL3TL' and @issuetype = 'I'
--
--begin
--
--	select distinct(Docket_Number) as 'Docket No.',tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
--	--,user_master.role_id
--	from tbl_NewClient_Details 
--	join ctcl_details
--	on tbl_NewClient_Details.client_code=ctcl_odinid
--	join view_subbroker
--	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
--	join tbl_IT_KB_Master
--	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
--	join user_master
--	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
--	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select userid from UserID_TL where Teamleader1 = @emp_id or TeamLeader2=@emp_id)))
--	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
--	--or(status_code='ITEL3' and issue_resolved_by in (select userid from user_master where Role_id IN ('ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXV','ITL2TLV')))
--	--or (status_code='ITL3R' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
--	order by tbl_NewClient_Details.docket_number
--
--end
else if (@access = 'ADM' or @access='L3EX' or @access='ITL3EX' or @access='L3TL' or @access='ITL3TL') and @issuetype = 'I'
begin
	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
	join ctcl_details
	on tbl_NewClient_Details.client_code=ctcl_odinid
	join view_subbroker
	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where tbl_NewClient_Details.status_code in ('ITP','ITUP','L') and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--and tbl_NewClient_Details.issue_type = 'IT'
	and tbl_NewClient_Details.issue_resolved_by in (select userid from user_master)


end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.IT_spPendingJobs_Latest
-- --------------------------------------------------




-- addition of case for CSO in all query
CREATE procedure [dbo].[IT_spPendingJobs_Latest]
@emp_id varchar(15),@access varchar(15), @issuetype varchar(5),@CSO varchar(20)
as
if @access ='ITL1EXBR' and @issuetype = 'E'
begin

	select distinct temp.Docket_Number as 'Docket No.',temp.client_code as 'Client Code',
		temp.Branch_code as 'Branch',temp.[Branch Name] as 'Branch Name',temp.[CSO] as 'CSO',temp.source as 'Source',temp.product_name as 'Product',
		temp.Nature,temp.Problem,temp.Brief_solution as [Brief Solution],temp.Remark,
		temp.Issue_Raised_dateTime as 'Issue Date/Time',temp.Issue_Resolved_dateTime as 'Last Updated time',
		temp.username as 'Issue Resolved By',CSO,temp.jobstatus_name as 'Status',temp.hours  
	from
	(
		select rtrim(Docket_Number) as Docket_number,tbl_NewClient_Details.client_code as client_code,
			Branch_code,
			(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [Branch Name],								
			--(Case when (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [CSO],								
			tbl_NewClient_Details.source as source,vendor_product.product_name,
			Nature,Problem,	tbl_NewClient_Details.Brief_solution as Brief_solution,
			Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
			tbl_NewClient_Details.Issue_Raised_dateTime,tbl_NewClient_Details.Issue_Resolved_dateTime,
			user_master.username,
			(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
			jobstatusmaster.jobstatus_name,datediff(hour,issue_raised_datetime,getdate()) as hours  
			--,user_master.role_id
		from tbl_NewClient_Details 
			join client_master
			on tbl_NewClient_Details.client_code=client_master.client_code
			join vendor_product
			on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
			join user_master
			on tbl_NewClient_Details.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where (status_code='ITP' or status_code='ITUP')  
			and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id))
			--issue_resolved_by=@emp_id
		and issue_type = 'EBro'
	) temp
	order by docket_number

end

else if @access='ITL1TLBR' and @issuetype = 'E'
begin

	select distinct temp.Docket_Number as 'Docket No.',temp.client_code as 'Client Code',
		temp.Branch_code as 'Branch',temp.[Branch Name] as 'Branch Name',temp.[CSO] as 'CSO',temp.source as 'Source',temp.product_name as 'Product',
		temp.Nature,temp.Problem,temp.Brief_solution as [Brief Solution],temp.Remark,
		temp.Issue_Raised_dateTime as 'Issue Date/Time',temp.Issue_Resolved_dateTime as 'Last Updated time',
		temp.username as 'Issue Resolved By',CSO,temp.jobstatus_name as 'Status',temp.hours  
	from
	(
		select rtrim(Docket_Number) as Docket_number,tbl_NewClient_Details.client_code as client_code,
			Branch_code,
			(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [Branch Name],								
			--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [CSO],								
			tbl_NewClient_Details.source as source,vendor_product.product_name,
			Nature,Problem,	tbl_NewClient_Details.Brief_solution as Brief_solution,
			Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
			tbl_NewClient_Details.Issue_Raised_dateTime,tbl_NewClient_Details.Issue_Resolved_dateTime,
			user_master.username,
			(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
			jobstatusmaster.jobstatus_name,datediff(hour,issue_raised_datetime,getdate()) as hours  
			--,user_master.role_id
		from tbl_NewClient_Details 
			join client_master
			on tbl_NewClient_Details.client_code=client_master.client_code
			join vendor_product
			on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
			join user_master
			on tbl_NewClient_Details.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where (status_code='ITP' or status_code='ITUP')  
		and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		and issue_type = 'EBro'
	) temp
	order by docket_number  
end
if @access ='ITL1EX' and @issuetype = 'E'
begin

	select distinct temp.Docket_Number as 'Docket No.',temp.client_code as 'Client Code',
		temp.Branch_code as 'Branch',temp.[Branch Name] as 'Branch Name',temp.[CSO] as 'CSO',temp.source as 'Source',temp.product_name as 'Product',
		temp.Nature,temp.Problem,temp.Brief_solution as [Brief Solution],temp.Remark,
		temp.Issue_Raised_dateTime as 'Issue Date/Time',temp.Issue_Resolved_dateTime as 'Last Updated time',
		temp.username as 'Issue Resolved By',CSO,temp.jobstatus_name as 'Status',temp.hours  
	from
	(
		select rtrim(Docket_Number) as Docket_number,tbl_NewClient_Details.client_code as client_code,
			Branch_code,
			(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [Branch Name],								
			--(Case when (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [CSO],								
			tbl_NewClient_Details.source as source,vendor_product.product_name,
			Nature,Problem,	tbl_NewClient_Details.Brief_solution as Brief_solution,
			Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
			tbl_NewClient_Details.Issue_Raised_dateTime,tbl_NewClient_Details.Issue_Resolved_dateTime,user_master.username,
			(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
			jobstatusmaster.jobstatus_name,datediff(hour,issue_raised_datetime,getdate()) as hours  
			--,user_master.role_id
		from tbl_NewClient_Details 
			join client_master
			on tbl_NewClient_Details.client_code=client_master.client_code
			join vendor_product
			on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
			join user_master
			on tbl_NewClient_Details.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where (status_code='ITP' or status_code='ITUP')  
				and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id))
				--issue_resolved_by=@emp_id
		and issue_type = 'EBro'
	) temp
	order by docket_number

end

else if @access='ITL1TL' and @issuetype = 'E'
begin

	select distinct temp.Docket_Number as 'Docket No.',temp.client_code as 'Client Code',
	temp.Branch_code as 'Branch',temp.[Branch Name] as 'Branch Name',temp.[CSO] as 'CSO',temp.source as 'Source',temp.product_name as 'Product',
	temp.Nature,temp.Problem,temp.Brief_solution as [Brief Solution],temp.Remark,
	temp.Issue_Raised_dateTime as 'Issue Date/Time',temp.Issue_Resolved_dateTime as 'Last Updated time',
	temp.username as 'Issue Resolved By',CSO,temp.jobstatus_name as 'Status',temp.hours  
	from
	(
		select rtrim(Docket_Number) as Docket_number,tbl_NewClient_Details.client_code as client_code,
		Branch_code,
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [Branch Name],								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as [CSO],								
		tbl_NewClient_Details.source as source,vendor_product.product_name,
		Nature,Problem,	tbl_NewClient_Details.Brief_solution as Brief_solution,
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		tbl_NewClient_Details.Issue_Raised_dateTime,tbl_NewClient_Details.Issue_Resolved_dateTime,user_master.username,
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
		jobstatusmaster.jobstatus_name,datediff(hour,issue_raised_datetime,getdate()) as hours  
		--,user_master.role_id
		from tbl_NewClient_Details 
		join client_master
		on tbl_NewClient_Details.client_code=client_master.client_code
		join vendor_product
		on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where (status_code='ITP' or status_code='ITUP')  
		--and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		And Issue_Resolved_BY in (Select UserID From User_Master Where Team_ID in ('ITL1','ITL1BR') And Account_Status=1)
		and issue_type = 'EBro'
	) temp
	order by docket_number  
end

else if @access ='ITL1EX' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITP' or status_code='ITUP')  
		--and issue_resolved_by= @emp_id 
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL1TL' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITP' or status_code='ITUP')  
		--and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		And Issue_Resolved_BY in (Select UserID From User_Master Where Team_ID in ('ITL1','ITL1BR') And Account_Status=1)
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
		--or (status_code='ITL1R' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end
else if @access ='ITL1EXBR' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
	(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
	--user_master.username as 'Level 1 Executive',
	user_master.username as 'Issue Resolved By',
	(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
	jobstatusmaster.jobstatus_name as 'Status'
	,datediff(hour,issue_raised_datetime,getdate()) as hours
	--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITP' or status_code='ITUP')  
		--and issue_resolved_by= @emp_id 
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL1TLBR' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where (status_code='ITP' or status_code='ITUP')  
		and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		
	--or (Status_code='ITL1E' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX', 'L1TL')))
	--or (status_code='ITL1R' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2EXO' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id)))
		--and issue_resolved_by= @emp_id) 
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2EXN' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id)))
		--and issue_resolved_by= @emp_id) 
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2N' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2EXV' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive', 
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  
		--and issue_resolved_by= @emp_id) 
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2TLO' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive', 
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	--or (status_code='ITL2RO' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2TLN' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive', 
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--or(status_code='ITEL2N' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
		--or (status_code='ITL2RN' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end

else if @access ='ITL2TLV' and @issuetype = 'I'

begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive', 
		user_master.username as 'Issue Resolved By', 
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--or(status_code='ITEL2V' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
		--or (status_code='ITL2RV' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by tbl_NewClient_Details.docket_number

end
else if @access ='ITL2EXI' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  
		--and issue_resolved_by= @emp_id) 
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end
else if @access ='ITL2EXS' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  
		--and issue_resolved_by= @emp_id) 
		and Issue_Resolved_BY in (Select Distinct Employee_ID From tbl_teamleadermaster 
											Where Teamleader in (Select Distinct Teamleader 
										From tbl_teamleadermaster Where Employee_ID=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end
else if @access ='ITL2TLI' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  
		and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
		 and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end
else if @access ='ITL2TLS' and @issuetype = 'I'
begin

	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive',
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where ((status_code='ITP' or status_code='ITUP' )  
		and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
		and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--or(status_code='ITEL2O' and issue_resolved_by in (select userid from user_master where Role_id = 'ITL1EX' or role_id = 'ITL1TL'))
	order by tbl_NewClient_Details.docket_number

end
--
--else if @access ='ITL3EX' and @issuetype = 'I'
--begin
--
--	select distinct(Docket_Number) as 'Docket No.',tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
--	--,user_master.role_id
--	from tbl_NewClient_Details 
--	join ctcl_details
--	on tbl_NewClient_Details.client_code=ctcl_odinid
--	join view_subbroker
--	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
--	join tbl_IT_KB_Master
--	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
--	join user_master
--	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
--	where ((status_code='ITP' or status_code='ITUP' )  and issue_resolved_by= @emp_id) and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
--	--or(status_code='ITEL3' and issue_resolved_by in (select userid from user_master where Role_id IN ('ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXV','ITL2TLV')))
--	order by tbl_NewClient_Details.docket_number
--
--end
--
--else if @access ='ITL3TL' and @issuetype = 'I'
--
--begin
--
--	select distinct(Docket_Number) as 'Docket No.',tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
--	--,user_master.role_id
--	from tbl_NewClient_Details 
--	join ctcl_details
--	on tbl_NewClient_Details.client_code=ctcl_odinid
--	join view_subbroker
--	on ctcl_Details.ctcl_isbtag=view_subbroker.tag
--	join tbl_IT_KB_Master
--	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
--	join user_master
--	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
--	where ((status_code='ITP' or status_code='ITUP')  and (issue_resolved_by= @emp_id or issue_resolved_by in (select userid from UserID_TL where Teamleader1 = @emp_id or TeamLeader2=@emp_id)))
--	and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
--	--or(status_code='ITEL3' and issue_resolved_by in (select userid from user_master where Role_id IN ('ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXV','ITL2TLV')))
--	--or (status_code='ITL3R' and issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
--	order by tbl_NewClient_Details.docket_number
--
--end
else if ( @access='L3EX' or @access='ITL3EX' or @access='L3TL' or @access='ITL3TL') and @issuetype = 'I'
begin
	select distinct(Docket_Number) as 'Docket No.',
		--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
		tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
		(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
		--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
		tbl_NewClient_Details.Brief_solution as [Brief Solution],
		Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		--user_master.username as 'Level 1 Executive', 
		user_master.username as 'Issue Resolved By',
		(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
		jobstatusmaster.jobstatus_name as 'Status'
		,datediff(hour,issue_raised_datetime,getdate()) as hours
		--,user_master.role_id
	from tbl_NewClient_Details 
		join ctcl_details
		on tbl_NewClient_Details.client_code=ctcl_odinid
		join view_subbroker
		on ctcl_Details.ctcl_isbtag=view_subbroker.tag
		join tbl_IT_KB_Master
		on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
		join user_master
		on tbl_NewClient_Details.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where tbl_NewClient_Details.status_code in ('ITP','ITUP','L') and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
	--and tbl_NewClient_Details.issue_type = 'IT'
	and tbl_NewClient_Details.issue_resolved_by in (select userid from user_master Where Account_Status=1)

end
else if(@access = 'ADM' and @issuetype = 'I')
begin
	If(@CSO<>'')
	Begin
		select distinct(Docket_Number) as 'Docket No.',
			--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
			tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
			(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
			--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
			tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
			tbl_NewClient_Details.Brief_solution as [Brief Solution],
			Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
			Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
			--user_master.username as 'Level 1 Executive', 
			user_master.username as 'Issue Resolved By',
			(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
			jobstatusmaster.jobstatus_name as 'Status'
			,datediff(hour,issue_raised_datetime,getdate()) as hours
			--,user_master.role_id
		from tbl_NewClient_Details 
			join ctcl_details
			on tbl_NewClient_Details.client_code=ctcl_odinid
			join view_subbroker
			on ctcl_Details.ctcl_isbtag=view_subbroker.tag
			join tbl_IT_KB_Master
			on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
			join user_master
			on tbl_NewClient_Details.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where tbl_NewClient_Details.status_code in ('ITP','ITUP','L') and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--and tbl_NewClient_Details.issue_type = 'IT'
		and tbl_NewClient_Details.issue_resolved_by in (select userid from user_master  Where  Account_Status=1 And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code=@CSO))
	End
	Else If(@CSO='')
	Begin

		select distinct(Docket_Number) as 'Docket No.',
			--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
			tbl_NewClient_Details.client_code as 'Client Code',tbl_NewClient_Details.tagbranch as 'Branch',
			(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'Branch Name',								
			--(Case when  (tbl_NewClient_Details.TagBranch is null or tbl_NewClient_Details.TagBranch = '') then '' when tbl_NewClient_Details.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = tbl_NewClient_Details.TagBranch) End) as 'CSO',								
			tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
			tbl_NewClient_Details.Brief_solution as [Brief Solution],
			Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,
			Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time', 
			--user_master.username as 'Level 1 Executive', 
			user_master.username as 'Issue Resolved By',
			(Case when  (tbl_NewClient_Details.issue_resolved_by is null or tbl_NewClient_Details.issue_resolved_by = '') then '' when tbl_NewClient_Details.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as 'CSO',								
			jobstatusmaster.jobstatus_name as 'Status'
			,datediff(hour,issue_raised_datetime,getdate()) as hours
			--,user_master.role_id
		from tbl_NewClient_Details 
			join ctcl_details
			on tbl_NewClient_Details.client_code=ctcl_odinid
			join view_subbroker
			on ctcl_Details.ctcl_isbtag=view_subbroker.tag
			join tbl_IT_KB_Master
			on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
			join user_master
			on tbl_NewClient_Details.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
		where tbl_NewClient_Details.status_code in ('ITP','ITUP','L') and tbl_NewClient_Details.tagbranch=ctcl_details.ctcl_ibranch_cd
		--and tbl_NewClient_Details.issue_type = 'IT'
		and tbl_NewClient_Details.issue_resolved_by in (select userid from user_master  Where Account_Status=1 )
	End
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ITHMS_ClientHistory
-- --------------------------------------------------


CREATE proc [dbo].[ITHMS_ClientHistory]
@client_code as char(25)
as
select top 3 docket as [Docket_Number],
--temp.SBTag as 'SubBroker Tag',
temp.client_code as [Client Code],temp.Product_code as [Product Name],
temp.Nature, temp.Problem, temp.Brief_solution as [Brief Solution],Remarks,RaisedDate,ResolvedDate,
TotalTime,Executive,Status
from
(
select distinct(d.docket_number) as Docket ,
--d.SBTAG,
d.client_code,
d.Product_code, d.Nature, d.Problem, d.Brief_solution,
Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','L1EX','ITL1EXBR')) THEN L1_InitialRemark 
				 	 WHEN issue_resolved_by in (select userid from user_master where role_id  in ('ITL1TL','ITL1TLBR','L1TL')) THEN L1_FinalRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL2EXO','ITL2EXN','ITL2EXV','ITL2EXS','ITL2EXI','ITL2TLO','ITL2TLN','ITL2TLV','ITL2TLS','ITL2TLI')) THEN L2_UserRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('ITL3EX','ITL3TL','ADM','L1EX','L1TL')) THEN L3_UserRemark					
					 END,''),
left(d.Issue_raised_datetime,11)  as [RaisedDate],left(d.issue_resolved_datetime,11) as [ResolvedDate],
CONVERT(VARCHAR,d.issue_resolving_time,108) as [TotalTime],um.username as [Executive],js.jobstatus_name as [Status]

from tbl_NewClient_details d join Ctcl_details cd on d.client_code=cd.ctcl_odinid
join view_subbroker vs on vs.tag=cd.ctcl_isbtag 
join JobStatusMaster js on d.status_code = js.jobstatus_id
join user_master um on d.issue_resolved_by=um.userid 
where 
d.SbTag = @client_code 
--d.client_code = @client_code 
and d.issue_type='IT'
) temp
order by docket desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ITHMS_LastInformation
-- --------------------------------------------------




CREATE Proc [dbo].[ITHMS_LastInformation]
@Client_Code char(50)
--,@userid varchar(20)
as
select top 3 
d.docket_number as [DocketNumber],
d.Client_Code as [ClientCode],
d.Product_code as [ProductName],
d.Nature,
d.Problem,
d.Brief_solution as [BriefSolution],
Remarks= ISNULL(CASE WHEN issue_resolved_by in (select userid from user_master where role_id='L1EX') THEN L1_InitialRemark 
				 	 WHEN issue_resolved_by in (select userid from user_master where role_id='L1TL') THEN L1_FinalRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L2FEX','L2TEX','L2FTL','L2TTL')) THEN L2_UserRemark
					 WHEN issue_resolved_by in (select userid from user_master where role_id in ('L3EX','L3TL','ADM')) THEN L3_UserRemark					
					 END,''),
left(d.Issue_raised_datetime,11) as [RaisedDate],
left(d.issue_resolved_datetime,11) as [ResolvedDate],
CONVERT(VARCHAR,d.issue_resolving_time,108) as [TotalTime],
um.username as [Executive],
js.jobstatus_name as [Status]
from tbl_NewClient_details d
join Jobstatusmaster js
on d.status_code=js.JobStatus_Id
join user_master um
on d.issue_resolved_by=um.userid
where d.issue_type='IT' and client_code=@Client_Code
order by d.Issue_raised_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.LastIssueraiseddatetime
-- --------------------------------------------------


CREATE Proc [dbo].[LastIssueraiseddatetime]
@Client_Code char(25)
as
select top 1 issue_raised_datetime from tbl_NewClient_Details
where client_code=@client_code order by issue_raised_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.LastIssueresolveddatetime
-- --------------------------------------------------


CREATE Proc [dbo].[LastIssueresolveddatetime]
@Client_Code char(25)
as
select top 1 issue_resolved_datetime from tbl_NewClient_Details
where client_code=@client_code order by issue_raised_datetime desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.LWCVR
-- --------------------------------------------------
CREATE Proc LWCVR  
@Fromdate datetime,
@Todate datetime
as
select tbl_CSOMaster.CentralSupport as [Central Support],count(tbl_newclient_details.issue_resolved_datetime)as [Total Calls] from tbl_CSOMaster
join tbl_newclient_details
on tbl_CSOMaster.branch_tag=tbl_newclient_details.tagbranch
where tbl_newclient_details.issue_raised_datetime between @fromdate and @todate
group by tbl_CSOMaster.centralsupport
order by count(tbl_newclient_details.issue_resolved_datetime)desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.nonexist_client_calltype
-- --------------------------------------------------
create proc nonexist_client_calltype
as
select distinct Faq_type from faq_details
where Faq_status=1 and product_name='Business'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.nonexist_client_nature
-- --------------------------------------------------
create proc nonexist_client_nature
@product varchar(max),@type varchar(50)
as
select distinct Faq_Nature from faq_details
where product_Name=ltrim(@product) and Faq_Type=ltrim(@type) and Faq_status=1 and product_name='Business'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.nonexist_client_problem
-- --------------------------------------------------

CREATE proc [dbo].[nonexist_client_problem]
@product varchar(50),@type varchar(50),@nature varchar(50)
as
select Problem
from faq_details
where product_Name=ltrim(@product) and Faq_Type=ltrim(@type) and Faq_Nature=ltrim(@nature) and Faq_status=1 and product_name='Business'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.nonexist_client_solution
-- --------------------------------------------------

CREATE proc [dbo].[nonexist_client_solution]
@productname varchar(50),
@type varchar(30),
@Nature varchar(max),
@problem varchar(max)
as
select top 1 briefsolution,Solution from faq_details
where product_name=ltrim(@productname) and faq_type=ltrim(@type) and faq_nature=ltrim(@Nature) and problem=Ltrim(@problem) and Faq_status=1
order by faq_id Desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.old_IT_SpPendingJobs
-- --------------------------------------------------
CREATE procedure [dbo].[IT_SpPendingJobs]
@emp_id varchar(15),@access varchar(15)
as
if (@access ='ITL1EX' or @access ='ITL2EXO' or @access ='ITL2EXN' or @access ='ITL2EXV')
begin
select rtrim(Docket_Number) as 'Docket No.',client_details.client_code as 'Client Code',Branch_code as 'Branch',client_details.product_code as 'Product',Nature,Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours, Status_code
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join jobstatusmaster
on client_details.status_code=jobstatusmaster.jobstatus_id
where (status_code='P' or status_code='UP')  and issue_resolved_by= @emp_id
order by docket_number
end
if (@access ='ITL1TL' or @access ='ITL2TLO' or @access ='ITL2TLN' or @access ='ITL2TLV')
begin
select rtrim(Docket_Number) as 'Docket No.',client_details.client_code as 'Client Code',Branch_code as 'Branch',client_details.product_code as 'Product',Nature,Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours, Status_code
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join jobstatusmaster
on client_details.status_code=jobstatusmaster.jobstatus_id
where (status_code='P' or status_code='UP')  
and issue_resolved_by = @emp_id or issue_resolved_by in (select userid from user_master where TeamLeader = @emp_id)
order by docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PDA3_ClientRemark
-- --------------------------------------------------

CREATE proc [dbo].[PDA3_ClientRemark]
@docket_number varchar(40),
@client_code char(15),
@product_code char(15),
@Problem varchar,
@client_Remark text,
@status_code char(10)
as
declare @IssueRaisedDate as datetime
set @IssueRaisedDate=Getdate()
insert into client_details(Docket_Number,Client_Code,Product_Code,Issue_Raised_Datetime,Problem,Client_Remark,Status_Code)
values (@docket_number,@client_code,@product_code,@IssueRaisedDate,@Problem,@client_Remark,@status_code)
select isnull(Docket_Number,'') as [Docket_Number] from client_details where Issue_Raised_DateTime=@IssueRaisedDate

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PDA3_SendQuery
-- --------------------------------------------------

create proc [dbo].[PDA3_SendQuery]
@docket_number varchar(40),
@client_code char(15),
@product_code char(15),
@Issue_Raised_Datetime datetime,
@Problem varchar,
@client_Remark text,
@status_code bit
as
insert into client_details(Docket_Number,Client_Code,Product_Code,Issue_Raised_Datetime,Problem,Client_Remark,Status_Code)
values (@docket_number,@client_code,@product_code,@Issue_Raised_Datetime,@Problem,@client_Remark,@status_code)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rebuild_index
-- --------------------------------------------------
CREATE procedure [dbo].[rebuild_index]  
@database varchar(100)  
as  
begin  
  
declare @db_id int  
Select @db_id = db_id(@database)  
  
if @db_id is Null  
return  
  
SET NOCOUNT ON;  
DECLARE @objectid int;  
DECLARE @indexid int;  
DECLARE @partitioncount bigint;  
DECLARE @schemaname nvarchar(130);  
DECLARE @objectname nvarchar(130);  
DECLARE @indexname nvarchar(130);  
DECLARE @partitionnum bigint;  
DECLARE @partitions bigint;  
DECLARE @frag float;  
DECLARE @command nvarchar(4000);  
-- Conditionally select tables and indexes from the sys.dm_db_index_physical_stats function  
-- and convert object and index IDs to names.  
  
SELECT  
object_id AS objectid,  
index_id AS indexid,  
partition_number AS partitionnum,  
avg_fragmentation_in_percent AS frag  
INTO #work_to_do  
FROM sys.dm_db_index_physical_stats (@db_id, NULL, NULL , NULL, 'LIMITED')  
WHERE avg_fragmentation_in_percent > 10.0 AND index_id > 0;  
  
-- Declare the cursor for the list of partitions to be processed.  
DECLARE partitions CURSOR FOR SELECT objectid,indexid,partitionnum,frag FROM #work_to_do;  
  
-- Open the cursor.  
OPEN partitions;  
  
-- Loop through the partitions.  
WHILE (1=1)  
BEGIN;  
FETCH NEXT  
FROM partitions  
INTO @objectid, @indexid, @partitionnum, @frag;  
IF @@FETCH_STATUS < 0 BREAK;  
SELECT @objectname = QUOTENAME(o.name), @schemaname = QUOTENAME(s.name)  
FROM sys.objects AS o  
JOIN sys.schemas as s ON s.schema_id = o.schema_id  
WHERE o.object_id = @objectid;  
SELECT @indexname = QUOTENAME(name)  
FROM sys.indexes  
WHERE object_id = @objectid AND index_id = @indexid;  
SELECT @partitioncount = count (*)  
FROM sys.partitions  
WHERE object_id = @objectid AND index_id = @indexid;  
  
-- 30 is an arbitrary decision point at which to switch between reorganizing and rebuilding.  
IF @frag < 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REORGANIZE';  
IF @frag >= 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REBUILD';  
IF @partitioncount > 1  
      SET @command = @command + N' PARTITION=' + CAST(@partitionnum AS nvarchar(10));  
IF @frag >= 30.0  
      set @command = @command +N' WITH (SORT_IN_TEMPDB = ON)' 
 
EXEC (@command);  
PRINT N'Executed: ' + @command;  
END;  
  
-- Close and deallocate the cursor.  
CLOSE partitions;  
DEALLOCATE partitions;  
  
-- Drop the temporary table.  
DROP TABLE #work_to_do;  
  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.redissue
-- --------------------------------------------------


CREATE procedure [dbo].[redissue]
@clientid varchar(15),@access varchar(15)
as
if @access ='L1EX'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='P'
end
else if @access='L2FEX'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='EF'
end
else if @access='L2TEX'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='ET'
end
else if @access='L3EX'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='E3'
end
else if @access='L1TL'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='P'
end
else if @access='L2FTL'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='EF'
end
else if @access='L2TTL'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='ET'
end
else if @access='L3TL'
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and status_code='E3'
end
else
begin
select count(*)
from client_details
where client_code=@clientid and datename(mm,issue_raised_datetime)=datename(mm,getdate()) and (status_code like 'E%' or status_code='P')
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.remark
-- --------------------------------------------------
create proc remark
as
select Remark from user_remark

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_alterdiagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_alterdiagram
	(
		@diagramname 	sysname,
		@owner_id	int	= null,
		@version 	int,
		@definition 	varbinary(max)
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
	
		declare @theId 			int
		declare @retval 		int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
		declare @ShouldChangeUID	int
	
		if(@diagramname is null)
		begin
			RAISERROR ('Invalid ARG', 16, 1)
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID();	 
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		revert;
	
		select @ShouldChangeUID = 0
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		
		if(@DiagId IS NULL or (@IsDbo = 0 and @theId <> @UIDFound))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1);
			return -3
		end
	
		if(@IsDbo <> 0)
		begin
			if(@UIDFound is null or USER_NAME(@UIDFound) is null) -- invalid principal_id
			begin
				select @ShouldChangeUID = 1 ;
			end
		end

		-- update dds data			
		update dbo.sysdiagrams set definition = @definition where diagram_id = @DiagId ;

		-- change owner
		if(@ShouldChangeUID = 1)
			update dbo.sysdiagrams set principal_id = @theId where diagram_id = @DiagId ;

		-- update dds version
		if(@version is not null)
			update dbo.sysdiagrams set version = @version where diagram_id = @DiagId ;

		return 0
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_ClientMap
-- --------------------------------------------------

CREATE proc [dbo].[sp_ClientMap]
@Client_Code nvarchar(15),
@Product_Code nvarchar(15),
@Secondary_product nvarchar(15),
@manager_code nvarchar(50),
@QueryType nvarchar(2)
as
	if @QueryType='U'
		begin
			Update Client_master set online_client='1',account_status='1',Product_code=@product_code,Secondary_Product=@Secondary_product,manager_code=@Manager_code where client_code=@client_code
--			if @manager_code='Manager8' update client_master set manager_code='Manager15' where manager_code='Manager8' and client_code=@client_code
--			if @manager_code='Manager9' update client_master set manager_code='Manager10' where manager_code='Manager9' and client_code=@client_code
		end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_close
-- --------------------------------------------------




CREATE proc [dbo].[SP_close]
@pageidentifier as int,
@docket_number as varchar(20),
@Client_Code as varchar(10),
@Product_Code as varchar(50),
@Issue_Raised_Datetime as datetime,
@Issue_Resolved_Datetime as datetime,
@Type as varchar(10),
@Nature as varchar(20),
@Problem as varchar(300),
@Brief_Solution as varchar(300),
@Solution as varchar(300),
@Client_Remark as varchar(300),
@Issue_Resolved_By as varchar(50),
@Status_Code as varchar(10)
as

if @pageidentifier=1
	begin
		insert into client_details values('',@Client_Code,@Product_Code ,@Issue_Raised_Datetime,@Issue_Resolved_Datetime ,@Type,@Nature ,@Problem ,@Brief_Solution,@Solution ,'',@Client_Remark ,'','' ,'' ,@Issue_Resolved_By,@Status_Code)
		select @docket_number=max(convert(int,docket_number)) from client_details
		insert into task_details values('',@docket_number,@Issue_Resolved_By,getdate(),getdate(),@Status_Code,'')
		select @docket_number
	end
else
	begin
		update client_details set status_code=@Status_Code
		where docket_number = @docket_number
		insert into task_details values('',@docket_number,@Issue_Resolved_By,getdate(),getdate(),@Status_Code,'')
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_close_Latest
-- --------------------------------------------------



CREATE proc [dbo].[SP_close_Latest]
@pageidentifier as int,
@docket_number as varchar(20),
@access as char(10),
@Client_Code as varchar(10),
@Product_Code as varchar(50),
@tagbranch varchar(50),
@Issue_Raised_Datetime as datetime,
@Issue_Resolving_Time datetime,
@source char(10),
@Issue_Type char(25),
@Type as varchar(10),
@Nature as varchar(20),
@Problem as varchar(300),
@Brief_Solution as varchar(300),
@Detailed_Solution as varchar(MAX),
@Ex_Remark varchar(200),
@L1_EXRemark varchar(200),
@L1_TLRemark varchar(200),
@L2_Remark varchar(200),
@L3_Remark varchar(200),
@Issue_Resolved_By as varchar(50),
@Status_Code as varchar(10)
as

set @Detailed_Solution=''

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR')  and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ':' + Convert(VARCHAR(20),getdate(),100) + ':' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL'  or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ':' + Convert(VARCHAR(20),getdate(),100) + ':' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access = 'L2TTL') and @Ex_Remark<>'' )
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ':' + Convert(VARCHAR(20),getdate(),100) + ':' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'L3EX' or @access = 'L3TL' or @access = 'ADM') and @Ex_Remark<>'')
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ':' + Convert(VARCHAR(20),getdate(),100) + ':' + @Ex_Remark  + '\n' + @L3_Remark

Declare @Team_Id as char(10)

------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'

if @pageidentifier=1
	begin
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	end
else
	begin
		update tbl_NewClient_Details set status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		issue_resolved_by=@Issue_Resolved_By 	
		where docket_number = @docket_number
	
		set @Issue_Raised_Datetime = (Select Issue_Raised_datetime from tbl_newclient_details where docket_number=@docket_number)
		
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_creatediagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_creatediagram
	(
		@diagramname 	sysname,
		@owner_id		int	= null, 	
		@version 		int,
		@definition 	varbinary(max)
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
	
		declare @theId int
		declare @retval int
		declare @IsDbo	int
		declare @userName sysname
		if(@version is null or @diagramname is null)
		begin
			RAISERROR (N'E_INVALIDARG', 16, 1);
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID(); 
		select @IsDbo = IS_MEMBER(N'db_owner');
		revert; 
		
		if @owner_id is null
		begin
			select @owner_id = @theId;
		end
		else
		begin
			if @theId <> @owner_id
			begin
				if @IsDbo = 0
				begin
					RAISERROR (N'E_INVALIDARG', 16, 1);
					return -1
				end
				select @theId = @owner_id
			end
		end
		-- next 2 line only for test, will be removed after define name unique
		if EXISTS(select diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @diagramname)
		begin
			RAISERROR ('The name is already used.', 16, 1);
			return -2
		end
	
		insert into dbo.sysdiagrams(name, principal_id , version, definition)
				VALUES(@diagramname, @theId, @version, @definition) ;
		
		select @retval = @@IDENTITY 
		return @retval
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_dropdiagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_dropdiagram
	(
		@diagramname 	sysname,
		@owner_id	int	= null
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
		declare @theId 			int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
	
		if(@diagramname is null)
		begin
			RAISERROR ('Invalid value', 16, 1);
			return -1
		end
	
		EXECUTE AS CALLER;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		REVERT; 
		
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1)
			return -3
		end
	
		delete from dbo.sysdiagrams where diagram_id = @DiagId;
	
		return 0;
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_EBroNewIssue
-- --------------------------------------------------




CREATE proc [dbo].[sp_EBroNewIssue]
 
--Stored Procedure to insert new issue in client_details 
@pageidentifier as int,
@docket_number as varchar(20),
	@access as char(10),
@Client_Code Char(25),
@Product_Code Char(25),
@Issue_raised_Datetime datetime,
@Issue_Type char(25),
@Type char(50),
@Nature varchar(100),
@Problem varchar(200),
@Brief_Solution varchar(200),
	@Ex_Remark varchar(200),
	@L1_EXRemark varchar(200),
	@L1_TLRemark varchar(200),
	@L2_Remark varchar(200),
	@L3_Remark varchar(200),
@Issue_Resolved_by char(25),
@Status_Code Char(25),
@level as int
as

if (@access = 'L1EX' or @access = 'ITL1EX')
	set @L1_EXRemark=@Ex_Remark
else if (@access = 'L1TL' or @access = 'ITL1TL')
	set @L1_TLRemark=@Ex_Remark
else if (@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV')
	set @L2_Remark=@Ex_Remark
else if (@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM')
	set @L3_Remark=@Ex_Remark



if @Status_Code='UP'
	
begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

	end
	
	else if @pageidentifier=2
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end
	else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end
	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end
end	
---------------------------------------------------------------------------------
else if @Status_Code='L'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
	    Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		  Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		end
		
		else if @pageidentifier=2
		
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime='',L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end

		else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime='',L2_userRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end

		else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime='',L3_Userremark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
			
		Update tbl_NewClient_Details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=convert(datetime,@Issue_Raised_Datetime),L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end

	else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=convert(datetime,@Issue_Raised_Datetime),L2_userRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end

	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=convert(datetime,@Issue_Raised_Datetime),L3_Userremark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,'','',@Status_Code)
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_EBroNewIssue_Latest
-- --------------------------------------------------




CREATE proc [dbo].[sp_EBroNewIssue_Latest]
--Stored Procedure to insert new issue in client_details 
@pageidentifier as int,
@docket_number as varchar(20),
@access as char(10),
@Client_Code Char(25),
@Product_Code Char(25),
@tagbranch varchar(50),
@Issue_raised_Datetime datetime,
@Issue_Resolving_Time datetime, 
@source char(10),
@Issue_Type char(25),
@Type char(50),
@Nature varchar(100),
@Problem varchar(200),
@Brief_Solution varchar(200),
@Detailed_Solution varchar(MAX),
@Ex_Remark varchar(MAX),
@L1_EXRemark varchar(MAX),
@L1_TLRemark varchar(MAX),
@L2_Remark varchar(MAX),
@L3_Remark varchar(MAX),
@Issue_Resolved_by char(25),
@Status_Code Char(25),
@level as int
as

set @Detailed_Solution=''

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR') and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL' or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access = 'L2TTL') and @Ex_Remark<>'' )
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'L3EX' or @access = 'L3TL' or @access = 'ADM') and @Ex_Remark<>'')
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark

Declare @Team_Id as char(10)

------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'


if @Status_Code='UP'
	
begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@tagbranch,@Product_Code,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		 Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@tagbranch,@Product_Code,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

	end
	
	else if @pageidentifier=2
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,
		status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end
	else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end
	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set issue_raised_datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end
end	
---------------------------------------------------------------------------------
else if @Status_Code='L'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
	    Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		  Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		end
		
		else if @pageidentifier=2
		
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end

		else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end

		else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
			
		Update tbl_NewClient_Details 
		set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By 
		where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end

	else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end

	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details 
		set issue_raised_datetime=@Issue_Raised_Datetime,issue_resolved_datetime=getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_Escalate_Latest
-- --------------------------------------------------


CREATE proc [dbo].[SP_Escalate_Latest]
@pageidentifier as int,
@access as char(10),
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@tagbranch varchar(50),
@Issue_Raised_Datetime datetime,
@Issue_Resolving_Time datetime,
@Call_From char(25),
@Call_Type char(25),
@source char(10),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Detailed_Solution varchar(MAX),
@Ex_Remark varchar(MAX),
@L1_EXRemark varchar(MAX),
@L1_TLRemark varchar(MAX),
@L2_Remark varchar(MAX),
@L3_Remark varchar(MAX),
@Issue_Resolved_by varchar(15),
@Contact_Person char(50),
@Status_Code char(15)
as

set @Detailed_Solution=''

if ((@access = 'L1EX' or @access = 'ITL1EX' or @access = 'ITL1EXBR')  and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL' or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access = 'L2TTL') and @Ex_Remark<>'' )
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'L3EX' or @access = 'L3TL' or @access = 'ADM') and @Ex_Remark<>'')
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark

Declare @Team_Id as char(10)

------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'


if @pageidentifier=1
begin 
	if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
	begin
		set @Status_Code='ET'
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if(@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1TLBR' or @access = 'ITL1EXBR') and (@type='technical' or @type='functional')
	begin
		set @Status_Code='L1E'
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if(@access = 'L1EX' or @access='L1TL') and (@type='functional')
	begin
		set @Status_Code='EF'
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if @access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access='L2TTL'
	begin
		set @Status_Code='E3'
		Insert Into tbl_NewClient_Details Values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

select @docket_number
end

else 
Begin
	if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
	begin
		set @Status_Code='ET'
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L1EX' or @access='L1TL') and (@type='functional')
	begin	
		set @Status_Code='EF'
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L2TEX' or @access='L2TTL')
	begin
		set @Status_Code='E3'
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108), 
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L2FEX' or @access = 'L2FTL')
	begin
		set @status_code = 'E3'
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if(@access = 'ITL1EX' or @access='ITL1TL' or @access = 'ITL1TLBR' or @access = 'ITL1EXBR') and (@type='technical' or @type='functional')
	begin
		set @Status_Code='L1E'
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
End
------------------------------------------------------------------------------

--else
--begin 
--if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
--begin
--set @Status_Code='ET'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code, L1_FinalRemark = @Ex_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if (@access = 'L1EX' or @access='L1TL') and (@type='functional')
--begin
--set @Status_Code='EF'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code,  L1_FinalRemark = @Ex_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if @access = 'L2TEX' or @access='L2TTL'
--begin
--set @Status_Code='E3'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code,  L2_UserRemark = @Ex_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--end
--

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_faqaddnewproduct
-- --------------------------------------------------
create procedure SP_faqaddnewproduct
@productname varchar(50),
@type varchar(20),
@nature varchar(40),
@problem varchar(500),
@Solution varchar(500),
@brfsolution varchar(250),
@remark varchar(500),
@emp_id varchar(20),
@faqadded datetime
as 
insert into faq_details
values(@productname,@type,@nature,@problem,@solution,@brfsolution,@remark,'',0,@emp_id,@faqadded,'','',0)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_fillCSO
-- --------------------------------------------------


-- =============================================
-- Author:		<Rihab Rebello>
-- Create date: <24/11/2010>
-- Description:	<to fill CSO in combo for callback>
-- =============================================
CREATE PROC [dbo].[sp_fillCSO]
	@Emp_ID as varchar(15),
	@Role as varchar(15),
	@BranchTag as varchar(15),
	@Option as int
AS
BEGIN
	If(@Option = 1)
	Begin
		Select distinct CSO_Code from tbl_ITBranchMaster
	End	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_Get_Product_Info
-- --------------------------------------------------



CREATE proc [dbo].[SP_Get_Product_Info]
@client_category int
as

if @client_category=0 
begin
select distinct(product_name) from faq_details where faq_identifier=0 
end

if @client_category=1 
begin
select distinct(product_name) from faq_details where faq_identifier=1 or faq_identifier=2 or faq_identifier=3
end

if @client_category=2 
begin
select distinct(product_name) from faq_details where faq_identifier=2 or faq_identifier=3
end

if @client_category=3 
begin
select distinct(product_name) from faq_details where faq_identifier=3
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_GetAllExecutive
-- --------------------------------------------------


CREATE proc [dbo].[SP_GetAllExecutive]
@User_ID varchar(50),
@Role varchar(50),
@Team varchar(100),
@callType varchar(10)
as

if (@Role in ('L1TL','L2FTL','L2TTL','L3TL'))
begin
	select username,userid from user_master where teamLeader=@User_ID order by userName  
End      
if (@Role in ('ITL1TL','ITL2TLN','ITL2TLO','ITL2TLV','ITL3TL'))
begin
	select distinct um.username,um.userid from user_master um
	where Userid in (select userid from UserId_TL where teamLeader1=@User_ID or TeamLeader2=@User_ID) 
	order by userName
end
if (@Role in('ITL1EX','ITL2EXN','ITL2EXO','ITL2EXV','L1EX','L2FEX','L2TEX','L3EX'))
begin
	select username,userid from user_master where userid=@User_ID 
end
if (@Role = 'ADM')
begin
	if (@callType='EBro')
	begin
		select username,userid from user_master where team_id not like 'IT%' and team_id in (select team_id from team_master where team_name=@Team) order by username 
	end 
	if (@callType='IT')
	begin
		select username,userid from user_master where team_id like 'IT%' and team_id in (select team_id from team_master where team_name=@Team) order by username 
	end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_GetEmployee
-- --------------------------------------------------

CREATE Proc [dbo].[sp_GetEmployee]
@User_id as char(25),
@access as char(25)
as
if @access ='L1EX' or @access ='ITL1EX' or @access ='L2FEX'or @access ='ITL2EXO' or @access ='ITL2EXN'or @access ='ITL2EXV' or @access ='L2TEX'or @access ='ITL2EXO' or @access ='ITL2EXN'or @access ='ITL2EXV' or @access ='L3EX'or @access ='ITL3EX'
begin
select username 
from user_master
where Role_id=@access and Userid=@User_id
end

else if @access ='L1TL'or @access ='ITL1TL'or @access ='L2FTL'or @access ='ITL2TLO' or @access ='ITL2TLN' or @access ='ITL2TLV' or @access ='L2TTL' or @access ='ITL2TLO' or @access ='ITL2TLN' or @access ='ITL2TLV' or @access ='L3TL' or @access ='ITL3TL'
begin
select username 
from user_master
where teamleader= @user_id
end

else if @access='ADM'
begin
Select username from user_master
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_GetExecutive
-- --------------------------------------------------








CREATE proc [dbo].[SP_GetExecutive]
@User_ID varchar(50),
@Role varchar(50),
@Team varchar(100),
@location varchar(50),
@callType varchar(10)
as

if (@Role in ('L1TL','L2FTL','L2TTL'))
begin
	select username,userid from user_master where teamLeader=@User_ID order by userName  
End      
if (@Role in ('ITL1TL','ITL2TLO'))
begin
	if(@Role='ITL1TL') set @Team='IT L1 Team ' 
	else if @Role='ITL2TLO' set @Team='Level 2 Technical Support Odin Team'
	
	select username,userid from user_master where team_id like 'IT%' 
	and team_id in (select team_id from team_master where team_name=@Team) 
	and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
	order by username  
--	select * from team_master
--	select distinct um.username,um.userid from user_master um
--	where Userid in (select userid from UserId_TL where teamLeader1=@User_ID or TeamLeader2=@User_ID) 
--	order by userName
end
if(@Role in ('ITL2TLN','ITL2TLV'))
Begin
		if @Role='ITL2TLN' set @Team='Level2 Technical Support Network Team'
		else if @Role='ITL2TLV' set @Team='Level2 Technical Support VSAT Team'	

		select username,userid from user_master where team_id like 'IT%' 
		and team_id in ('ITL2N','ITL2V') 
		and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
		order by username  
End
if (@Role in('ITL1EX','ITL2EXN','ITL2EXO','ITL2EXV','L1EX','L2FEX','L2TEX','L3EX'))
begin
	select username,userid from user_master where userid=@User_ID 
end
if (@Role in ('ADM','ITL3TL','ITL3EX','L3TL','L3EX'))
begin
	if (@callType='EBro')
	begin
		IF(@Team='ALL')
			select username,userid from user_master where team_id not in ('Surveillance','S')
			and team_id in (select team_id from team_master) 
			and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
			order by username
		ELSE
			select username,userid from user_master 
			where team_id in (select team_id from team_master where team_name=@Team) 
			and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
			order by username   
	end 
	if (@callType='IT')
	begin
		if(@Team='ALL')
			select username,userid from user_master where team_id not in ('Surveillance','S')
			and team_id in (select team_id from team_master) 
			and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
			order by username
		Else
			select username,userid from user_master 
			where team_id in (select team_id from team_master where team_name=@Team) 
			and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
			order by username  
	end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_GetExecutive_Mesg
-- --------------------------------------------------



CREATE proc [dbo].[SP_GetExecutive_Mesg]
@User_ID varchar(50),
@Role varchar(50),
@Team varchar(100),
@location varchar(50),
@callType varchar(10)
as

if (@Role in ('L1TL','L2FTL','L2TTL'))
begin
	select username,userid from user_master where teamLeader=@User_ID order by userName  
End      
if (@Role in ('ITL1TL','ITL1TLBR','ITL2TLN','ITL2TLS','ITL2TLI','ITL2TLO','ITL2TLV'))
begin
	if(@Role='ITL1TL') set @Team='IT L1 Team ' 
	if(@Role='ITL1TLBR') set @Team='IT L1 Branch Team' 	
	else if @Role='ITL2TLO' set @Team='Level 2 Technical Support Odin Team'
	else if @Role='ITL2TLN' set @Team='Level2 Technical Support Network Team'
	else if @Role='ITL2TLV' set @Team='Level2 Technical Support VSAT Team'	
	else if @Role='ITL2TLI' set @Team='Level2 Technical Support InfraStructure Team'
	else if @Role='ITL2TLS' set @Team='Level2 Technical Support System Team'

	select username,userid from user_master where team_id like 'IT%' 
	and team_id in (select team_id from team_master where team_name=@Team) 
	and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
	order by username  
--	select * from team_master
--	select distinct um.username,um.userid from user_master um
--	where Userid in (select userid from UserId_TL where teamLeader1=@User_ID or TeamLeader2=@User_ID) 
--	order by userName
end
if (@Role in('ITL1EX','ITL1EXBR','ITL2EXN','ITL2EXO','ITL2EXS','ITL2EXI','ITL2EXV','L1EX','L2FEX','L2TEX','L3EX'))
begin
	select username,userid from user_master where userid=@User_ID 
end
if (@Role in ('ADM','ITL3TL','ITL3EX','L3TL','L3EX'))
begin
	if (@callType='EBro')
	begin
		IF (@location='')
			select username,userid from user_master 
			where team_id in (select team_id from team_master where team_name=@Team)
		ELSE IF (@Team='ALL' and @location='')
			select username,userid from user_master where team_id not in ('Surveillance','S')
			and team_id in (select team_id from team_master) 
			order by username
		ELSE IF(@Team='ALL' and @location<>'')
			select username,userid from user_master where team_id not in ('Surveillance','S')
			and team_id in (select team_id from team_master) 
			and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
			order by username
		ELSE
			select username,userid from user_master 
			where team_id in (select team_id from team_master where team_name=@Team) 
			and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
			order by username   
	end 
	if (@callType='IT')
	begin
		
		IF (@location='')
			Begin
				--Team: 'ALL' and Location: Blank
				IF ((charindex('ALL',@Team)>0) and @location='')
				BEGIN
					select username,userid from user_master where team_id not in ('Surveillance','S')
					and team_id in (select team_id from team_master) order by username
				END
				ELSE
				BEGIN
					--Team: 'L1 Team' but not ALL and Location: Blank
					select username,userid from user_master 
					where team_id in (select team_id from team_master where team_name=@Team) order by username
				END
			END
		--Team:'ALL' and location: 'ACME'
		ELSE IF((charindex('ALL',@Team)>0) and @location<>'')
			BEGIN
				select username,userid from user_master where team_id not in ('Surveillance','S')
				and team_id in (select team_id from team_master) 
				and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
				order by username
			END
		--Team:'L1 Team' and Location: 'ACME'
		ELSE
			BEGIN
				select username,userid from user_master 
				where team_id in (select team_id from team_master where team_name=@Team) 
				and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
				order by username  
			END
	end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_GetITClientInfo
-- --------------------------------------------------
Create Proc sp_GetITClientInfo
@SB_Code char(25)
as
select distinct(tbl_it_Odinmaster.SB_Code),View_Subbroker.Regname,tbl_it_Odinmaster.Branch_Code,tbl_it_Odinmaster.Activation_Date,tbl_it_Odinmaster.NCFM_Validation_Date,tbl_it_Odinmaster.Mode_of_Connectivity,tbl_it_productmaster.Odin_Manager_Code,tbl_it_Odinmaster.Contact_Person,it_terminal_master.Site_Code,it_terminal_master.Gateway,it_terminal_master.Subnet_Mask,tbl_it_productmaster.Product_Name,tbl_it_productmaster.Product_Version,View_Subbroker.Resadd1 as Address,View_Subbroker.Rcity,View_Subbroker.resadd3 as State,View_Subbroker.PAN,View_Subbroker.EMailId,View_Subbroker.ResPhone,View_Subbroker.Mobile 
From tbl_IT_Odinmaster Join View_Subbroker on tbl_it_Odinmaster.sb_code=view_subbroker.Tag
left join tbl_it_productmaster on tbl_it_odinmaster.Odin_Manager_Code=tbl_it_productmaster.RM_Manager_Code
left join it_terminal_master on tbl_it_odinmaster.sb_code=it_terminal_master.sub_broker_tag
where tbl_it_Odinmaster.SB_Code='ABHI'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_getproductclientexists
-- --------------------------------------------------
CREATE proc sp_getproductclientexists
as
select product_name from faq_details
where product_name='Buisness'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_helpdiagramdefinition
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_helpdiagramdefinition
	(
		@diagramname 	sysname,
		@owner_id	int	= null 		
	)
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		set nocount on

		declare @theId 		int
		declare @IsDbo 		int
		declare @DiagId		int
		declare @UIDFound	int
	
		if(@diagramname is null)
		begin
			RAISERROR (N'E_INVALIDARG', 16, 1);
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner');
		if(@owner_id is null)
			select @owner_id = @theId;
		revert; 
	
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname;
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId ))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1);
			return -3
		end

		select version, definition FROM dbo.sysdiagrams where diagram_id = @DiagId ; 
		return 0
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_helpdiagrams
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_helpdiagrams
	(
		@diagramname sysname = NULL,
		@owner_id int = NULL
	)
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		DECLARE @user sysname
		DECLARE @dboLogin bit
		EXECUTE AS CALLER;
			SET @user = USER_NAME();
			SET @dboLogin = CONVERT(bit,IS_MEMBER('db_owner'));
		REVERT;
		SELECT
			[Database] = DB_NAME(),
			[Name] = name,
			[ID] = diagram_id,
			[Owner] = USER_NAME(principal_id),
			[OwnerID] = principal_id
		FROM
			sysdiagrams
		WHERE
			(@dboLogin = 1 OR USER_NAME(principal_id) = @user) AND
			(@diagramname IS NULL OR name = @diagramname) AND
			(@owner_id IS NULL OR principal_id = @owner_id)
		ORDER BY
			4, 5, 1
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_IT_FillExchanges
-- --------------------------------------------------





CREATE proc [dbo].[SP_IT_FillExchanges]
@OdinId as char(25),
@SbTag as char(20),
@branch_mgr	as varchar(15),
@segment as varchar(10)
as
Begin
if (@segment = '')
	begin
		select distinct(CTCLBranch_Segment) from CTCL_details
		where ctcl_odinid = @OdinId and ctcl_isbtag=@SBTag and ctcl_status='Active'
	 
	End
else 
	Begin
		select distinct(CTCLBranch_Segment),ctcl_AllotDate, ctcl_RegValidDate,tbl_it_productmaster.Odin_Manager_code,tbl_it_productmaster.Product_Name,tbl_it_productmaster.Product_Version from CTCL_details
        left join tbl_it_productmaster on ctcl_details.branch_name=tbl_it_productmaster.RM_manager_code
		where CTCLBranch_Segment=@segment and ctcl_odinid = @OdinId and ctcl_isbtag=@SBTag and ctcl_status='Active'
		 
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_IT_GetClinetInfo
-- --------------------------------------------------
Create Proc sp_IT_GetClinetInfo
@SB_Code char(25)
as
select  Distinct(tbl_it_subbroker_master.sb_code),tbl_it_subbroker_master.sb_name,TBL_IT_ODINMASTER.branch_code,TBL_IT_ODINMASTER.activation_date,TBL_IT_ODINMASTER.ncfm_validation_date,TBL_IT_ODINMASTER.mode_of_connectivity,TBL_IT_ODINMASTER.contact_person,view_subbroker.resadd1,view_subbroker.rcity,view_subbroker.resadd3 as State,view_subbroker.respincode,view_subbroker.resphone,view_subbroker.emailid,it_terminal_master.Site_Code,it_terminal_master.Gateway,it_terminal_master.subnet_mask,it_terminal_master.PAN
from tbl_it_subbroker_master LEFT join tbl_it_Odinmaster
on tbl_it_subbroker_master.sb_code=tbl_it_odinmaster.sb_code
Left join view_subbroker
on tbl_it_subbroker_master.sb_code=view_subbroker.tag
Left Join it_terminal_master
on tbl_it_subbroker_master.sb_code=it_terminal_master.sub_broker_tag
where tbl_it_subbroker_master.sb_code=@SB_CODE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_IT_GetOdinIdDetails
-- --------------------------------------------------

CREATE Proc [dbo].[sp_IT_GetOdinIdDetails]
@Odin_Id Char(25),
@SBTAG char(20)
as
select distinct(tbl_it_Odinmaster.Odin_Id),
tbl_it_Odinmaster.Segment,
tbl_it_Odinmaster.Activation_Date,
tbl_it_Odinmaster.NCFM_Validation_Date,
tbl_it_Odinmaster.Mode_of_Connectivity,
tbl_it_productmaster.RM_Manager_code,
tbl_it_productmaster.Product_Name,
tbl_it_productmaster.Product_Version,
tbl_it_Odinmaster.Contact_Person,
tbl_it_Odinmaster.Contact_Number,
it_terminal_master.Site_Code,
it_terminal_master.Gateway,
it_terminal_master.Subnet_mask
from tbl_IT_Odinmaster left join it_terminal_master on tbl_it_Odinmaster.sb_code=it_terminal_master.sub_broker_tag
left join tbl_it_productmaster on tbl_it_Odinmaster.odin_manager_code=tbl_it_productmaster.RM_manager_code
where tbl_it_Odinmaster.Odin_Id=@Odin_Id
and tbl_it_Odinmaster.SB_Code=@SBTAG

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_IT_GetOdinIds
-- --------------------------------------------------

CREATE Proc [dbo].[sp_IT_GetOdinIds]
@SB_Code char(25)
as

select distinct(ctcl_odinid) From CTCL_Details
Where ctcl_ISBTag= @sb_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_IT_GetSubbrokerInfo
-- --------------------------------------------------


CREATE Proc [dbo].[sp_IT_GetSubbrokerInfo]
@SB_Code char(25)
as
--select distinct(tbl_it_OdinMaster.SB_Code),View_Subbroker.Regname,tbl_it_Odinmaster.Branch_Code,tbl_it_Odinmaster.Branch_Name,View_Subbroker.Resadd1,View_Subbroker.Resadd2,View_Subbroker.Respincode,View_Subbroker.Rcity,View_Subbroker.resadd3 as State,View_Subbroker.PAN,View_Subbroker.EMailId,View_Subbroker.ResPhone,View_Subbroker.Mobile 
--From tbl_IT_Odinmaster right Join View_Subbroker on tbl_it_Odinmaster.sb_code=view_subbroker.Tag
--where tbl_it_Odinmaster.SB_Code='MCP'

--select distinct(TAG),View_Subbroker.Regname,tagbranch,Branch_Name,View_Subbroker.Resadd1,View_Subbroker.Resadd2,View_Subbroker.Respincode,View_Subbroker.Rcity,View_Subbroker.resadd3 as State,View_Subbroker.PAN,View_Subbroker.EMailId,View_Subbroker.ResPhone,View_Subbroker.Mobile 
--From VIEW_SUBBROKER join  tbl_Branch_Master on Branch_code = tagbranch
--where TAG=@SB_Code

select distinct(TAG),View_Subbroker.Regname,tagbranch,Branch_Name,View_Subbroker.Resadd1,
		View_Subbroker.Resadd2,View_Subbroker.Respincode,View_Subbroker.Rcity,View_Subbroker.resadd3 as State,View_Subbroker.PAN,
		View_Subbroker.EMailId,View_Subbroker.ResPhone,View_Subbroker.Mobile, CSO_Code
From VIEW_SUBBROKER join  TBl_ITBranchmaster on Branch_code = tagbranch
Where TAG=@SB_Code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_ITEscalate
-- --------------------------------------------------







CREATE proc [dbo].[SP_ITEscalate]
---------------------------------------------------------------------------
 
----Date Created	:	28-11-2009
----Comment		:	Escalate
---------------------------------------------------------------------------
@pageidentifier as int,
@access as char(8),
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Client_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15)
as

if @pageidentifier=1
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2O')
	begin
		set @Status_Code ='ITEL2O'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end
	else if (@access = 'L1EX' or @access='L1TL') and (@Team_Id='ITL1')
	begin
		 set @Status_Code ='ITL1E'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2N')
	begin
		 set @Status_Code ='ITEL2N'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2V')
	begin
		 set @Status_Code ='ITEL2V'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL2EXO' or @access='ITL2TLO' or @access ='ITL2EXN' or @access ='ITL2TLN' or @access ='ITL2EXV' or @access ='ITL2TLV')
	begin
		set @Status_Code = 'ITEL3'         
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

--select @docket_number
end

------------------------------------------------------------------------------

else
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2O')
	begin
		set @Status_Code = 'ITEL2O'
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end
	
	else if (@access = 'L1EX' or @access='L1TL') and (@Team_Id='ITL1')
	begin
		set @Status_Code ='ITL1E'	
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2N')
	begin
		set @Status_Code = 'ITEL2N'
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2V')
	begin
		set @Status_Code ='ITEL2V'
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if @access = 'ITL2EXO' or @access='ITL2EXN' or @access='ITL2EXV' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV'
	begin
		set @Status_Code = 'ITEL3'          
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_ITEscalate_Latest
-- --------------------------------------------------




CREATE proc [dbo].[SP_ITEscalate_Latest]
---------------------------------------------------------------------------
 
----Date Created	:	28-11-2009
----Comment		:	Escalate
---------------------------------------------------------------------------
@pageidentifier as int,
	@access as char(8),
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Ex_Remark varchar(200),
	@L1_EXRemark varchar(200),
	@L1_TLRemark varchar(200),
	@L2_Remark varchar(200),
	@L3_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15)
as

if (@access = 'L1EX' or @access = 'ITL1EX')
	set @L1_EXRemark=@L1_EXRemark + '' + @Ex_Remark
else if (@access = 'L1TL' or @access = 'ITL1TL')
	set @L1_TLRemark=@L1_TLRemark + '' + @Ex_Remark
else if (@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV')
	set @L2_Remark=@L2_Remark + '' + @Ex_Remark
else if (@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM')
	set @L3_Remark=@L3_Remark + '' + @Ex_Remark

if @pageidentifier=1
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2O')
	begin
		set @Status_Code ='ITEL2O'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end
	else if (@access = 'L1EX' or @access='L1TL') and (@Team_Id='ITL1')
	begin
		 set @Status_Code ='ITL1E'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2N')
	begin
		 set @Status_Code ='ITEL2N'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2V')
	begin
		 set @Status_Code ='ITEL2V'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if (@access = 'ITL2EXO' or @access='ITL2TLO' or @access ='ITL2EXN' or @access ='ITL2TLN' or @access ='ITL2EXV' or @access ='ITL2TLV')
	begin
		set @Status_Code = 'ITEL3'         
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

--select @docket_number
end

------------------------------------------------------------------------------

else
begin 
	if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2O')
	begin
		set @Status_Code = 'ITEL2O'
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end
	
	else if (@access = 'L1EX' or @access='L1TL') and (@Team_Id='ITL1')
	begin
		set @Status_Code ='ITL1E'	
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code ,L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2N')
	begin
		set @Status_Code = 'ITEL2N'
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code , L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2V')
	begin
		set @Status_Code ='ITEL2V'
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code ,L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

	else if @access = 'ITL2EXO' or @access='ITL2EXN' or @access='ITL2EXV' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV'
	begin
		set @Status_Code = 'ITEL3'          
		insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code ,L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate()
		where docket_number = @docket_number
	end

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_ITNewIssue
-- --------------------------------------------------





CREATE Proc [dbo].[sp_ITNewIssue]
@pageidentifier as int,
@docket_number as char(8),
	@access as char(10),
@Client_Code char(15),
@Product_Code char(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Ex_Remark varchar(200),
	@L1_EXRemark varchar(200),
	@L1_TLRemark varchar(200),
	@L2_Remark varchar(200),
	@L3_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15),
@level as int
as

if (@access = 'L1EX' or @access = 'ITL1EX')
	set @L1_EXRemark=@Ex_Remark
else if (@access = 'L1TL' or @access = 'ITL1TL')
	set @L1_TLRemark=@Ex_Remark
else if (@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV')
	set @L2_Remark=@Ex_Remark
else if (@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM')
	set @L3_Remark=@Ex_Remark



if @Status_Code='UP' or @Status_Code='C'
begin
	if @pageidentifier=1
				
		begin
		if @level=1
		begin
			Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
			select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
			select @docket_number
			end
		end
	else if @pageidentifier=2
		begin
			Update tbl_NewClient_Details 
			set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
			status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By,issue_resolved_datetime=getdate() where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
end

else if @Status_Code='ITUP'
begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
				Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
				Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
				Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		        select @docket_number
		end

	end
	else if @pageidentifier=2
		
		begin
			Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=3
		begin
			--print(@Issue_Raised_Datetime)
			Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=4
		begin
			Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
end	
---------------------------------------------------------------------------------
else if @Status_Code='ITL'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		end		
		else if @pageidentifier=2
		
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),Issue_Raised_Datetime='',L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

		else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end


		else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=3
		begin
		--print(@Issue_Raised_Datetime)
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime=getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Ex_Remark,@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_ITNewIssue_Latest
-- --------------------------------------------------





CREATE Proc [dbo].[sp_ITNewIssue_Latest]
@pageidentifier as int,
@docket_number as char(8),
@access as char(10),
@Client_Code char(15),
@Product_Code char(50),
@tagbranch varchar(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Ex_Remark varchar(200),
@L1_EXRemark varchar(200),
@L1_TLRemark varchar(200),
@L2_Remark varchar(200),
@L3_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15),
@level as int
as

if (@access = 'L1EX' or @access = 'ITL1EX')
	set @L1_EXRemark= @Ex_Remark
else if (@access = 'L1TL' or @access = 'ITL1TL')
	set @L1_TLRemark= @Ex_Remark
else if (@access = 'ITL2EXO' or @access = 'ITL2TLO' or @access = 'ITL2EXN' or @access = 'ITL2TLN' or @access = 'ITL2EXV' or @access = 'ITL2TLV')
	set @L2_Remark= @Ex_Remark
else if (@access = 'ITL3EX' or @access = 'ITL3TL' or @access = 'ADM')
	set @L3_Remark= @Ex_Remark


if @Status_Code='UP' or @Status_Code='C'
begin
	if @pageidentifier=1
				
		begin
		if @level=1
		begin
			Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
			select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
			select @docket_number
			end
		end
	else if @pageidentifier=2
		begin
			Update tbl_NewClient_Details 
			set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,
			status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
end

else if @Status_Code='ITUP'
begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
				Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
				Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
				Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
				select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
				Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		        select @docket_number
		end

	end
	else if @pageidentifier=2
		
		begin
			Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=3
		begin
			--print(@Issue_Raised_Datetime)
			Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=4
		begin
			Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
			L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
			Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
end	
---------------------------------------------------------------------------------
else if @Status_Code='ITL'
		
	begin
	
		if @pageidentifier=1
			
		begin

		if @level=1
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		end		
		else if @pageidentifier=2
		
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		--Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),Issue_Raised_Datetime='',L1_finalRemark=@Ex_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

		else if @pageidentifier=3
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end


		else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		 Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end
		
end

else

	begin

	if @pageidentifier=1
			
	begin

		if @level=1
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=2
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

		if @level=3
		begin
		 Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
		end

	end

	else if @pageidentifier=2
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=3
		begin
		--print(@Issue_Raised_Datetime)
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	else if @pageidentifier=4
		begin
		Update tbl_NewClient_Details set Issue_Raised_Datetime=convert(datetime,@Issue_Raised_Datetime),issue_resolved_datetime= getdate(),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_Userremark=@L3_Remark,status_code=@Status_Code,issue_resolved_by=@Issue_Resolved_By where docket_number=@docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		end

	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_Mastermind_test
-- --------------------------------------------------












CREATE proc [dbo].[SP_Mastermind_test]
@TL varchar(20),
@access varchar(15), 
@query varchar(500)

as
set nocount on
-------------------------------------------------------------
--Auther		:Sanjay Lavu Kudtarkar
--Comment		:Do not dare to alter this Stored Procedure
--Copy Right	:Mastermind Developers Pvt. Ltd. 2008(c)
-------------------------------------------------------------
declare @checkid1 int,@checkid2 int,@checkid3 int
declare @viewquery varchar(1000)

if @access='L1TL' or @access='L2TTL'  ---@TL='L1T' or @TL='L2TT'
begin
set @query='alter view view_completed
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and left(issue_raised_datetime,11)=left(getdate(),11) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed

set @query='alter view view_escalated
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code=''ET'' or status_code=''EF'' or status_code=''E3'') and left(issue_raised_datetime,11)=left(getdate(),11) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated

set @query='alter view view_performancepoint
as
select emp_id,date,total from executive_rating
where left(date,11)=left(getdate(),11) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by date,emp_id,total'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join view_performancepoint 
on view_escalated.issue_resolved_by =view_performancepoint.emp_id
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end 
end
else if @access='L2FTL' or @access='L3TL' 
begin
set @query='alter view view_completed
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and left(issue_raised_datetime,11)=left(getdate(),11) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed

set @query='alter view view_performancepoint
as
select emp_id,date,total from executive_rating
where left(date,11)=left(getdate(),11) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by date,emp_id,total'

exec (@query)

select @checkid2=count(emp_id) from view_performancepoint

--set @viewquery=
--'alter view view_Mastermind as
--select user_master.userid as userid,view_completed.completed as completed,executive_rating.total as PerformancePoint from view_completed --left join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--join user_master on view_completed.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_completed.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if @checkid1 > @checkid2
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid2 > @checkid1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
else 

begin
set @query='alter view view_completed
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and left(issue_raised_datetime,11)=left(getdate(),11)
group by issue_resolved_by'
exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed

set @query='alter view view_escalated
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code=''ET'' or status_code=''EF'' or status_code=''E3'') and left(issue_raised_datetime,11)=left(getdate(),11) group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated


set @query='alter view view_performancepoint
as
select emp_id,date,total from executive_rating
where left(date,11)=left(getdate(),11) 
group by date,emp_id,total'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint

--if @checkid1 > 0 or @checkid2 < 1
--begin
--if @checkid1 > @checkid2
--begin
--set @viewquery=
--'alter view view_Mastermind as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed left join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--left join user_master on view_completed.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_completed.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--else if @checkid2 > @checkid1
--begin
--set @viewquery=
--'alter view view_Mastermind as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed right join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--left join user_master on view_escalated.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_escalated.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--else
--begin
--set @viewquery=
--'alter view view_Mastermind as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed right join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--left join user_master on view_escalated.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_escalated.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--end
--else if @checkid1 < 1 and @checkid2 > 0
--begin
--set @viewquery=
--'alter view view_Mastermind as
--select user_master.userid  as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed right join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--join user_master on view_escalated.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_escalated.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join view_performancepoint 
on view_escalated.issue_resolved_by =view_performancepoint.emp_id
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_Mastermind 
--as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
--left join view_escalated 
--on view_performancepoint.emp_id=view_escalated.issue_resolved_by
--left join view_completed 
--on view_performancepoint.emp_id =view_completed.issue_resolved_by
--left join user_master 
--on view_performancepoint.emp_id=user_master.userid 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by=view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_performancepoint 
left join view_escalated 
on view_performancepoint.emp_id=view_escalated.issue_resolved_by
left join view_completed 
on view_performancepoint.emp_id =view_completed.issue_resolved_by
left join user_master 
on view_performancepoint.emp_id=user_master.userid' 
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_completed 
left join view_escalated 
on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
left join view_performancepoint 
on view_completed.issue_resolved_by=view_performancepoint.emp_id 
left join user_master 
on view_completed.issue_resolved_by=user_master.userid '
--where left(view_performancepoint.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
exec (@viewquery)
end
end
end

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------Auther:	Sanjay Lavu Kudtarkar
------Comments:	can create view using this query
--alter view view_Mastermind as
--select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed left join view_escalated on view_completed.issue_resolved_by=view_escalated.issue_resolved_by
--join user_master on view_completed.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_completed.issue_resolved_by where left(executive_rating.Date,11)=left(getdate(),11)
---------------------------------------Copyright 2008(C)----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_NewITEscalate
-- --------------------------------------------------



Create proc [dbo].[SP_NewITEscalate]
-----------------------------------------------------------------------------
 
------Date Created	:	26-8-2008
------Comment		:	Escalate
-----------------------------------------------------------------------------
@pageidentifier as int,
@access as char(8),
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Client_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15)
as

if @pageidentifier=1
begin 
if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2O')
begin
set @Status_Code ='ITEL2O'
Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
select @docket_number=max(convert(int,docket_number))  from client_details
Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
end

else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2N')
begin
 set @Status_Code ='ITEL2N'
Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
select @docket_number=max(convert(int,docket_number))  from client_details
Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
end

else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2V')
begin
 set @Status_Code ='ITEL2V'
Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
select @docket_number=max(convert(int,docket_number))  from client_details
Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
end

else if (@access = 'ITL2EXO' or @access='ITL2TLO' or @access ='ITL2EXN' or @access ='ITL2TLN' or @access ='ITL2EXV' or @access ='ITL2TLV')
begin
set @Status_Code = 'ITEL3'         
Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
select @docket_number=max(convert(int,docket_number))  from client_details
Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
end



select @docket_number
end

------------------------------------------------------------------------------

--else
--begin 
--if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2O')
--begin
--set @Status_Code = 'ITEL2O'
----insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code ,'')
--update client_details set status_code=@Status_Code , L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2N')
--begin
--set @Status_Code = 'ITEL2N'
----insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code ,'')
--update client_details set status_code=@Status_Code ,  L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if (@access = 'ITL1EX' or @access='ITL1TL') and (@Team_Id='ITL2V')
--begin
--set @Status_Code ='ITEL2V'
----insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code ,'')
--update client_details set status_code=@Status_Code ,  L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if @access = 'L2TEX' or @access='L2TTL'
--begin
--set @Status_Code = 'ITEL3'          
----insert into task_details values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code ,'')
--update client_details set status_code=@Status_Code ,  L2_UserRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--end
--
--
--

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_newpendingjobs
-- --------------------------------------------------

CREATE procedure [dbo].[sp_NEWPendingJobs]
@emp_id varchar(15),@access varchar(15)
as
if @access ='L1EX' or @access='L1TL' 
begin
select rtrim(Docket_Number) as 'Docket No.',client_details.client_code as 'Client Code' ,vendor_product.product_name as 'Product',Nature,Problem,Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
from client_details 
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join jobstatusmaster
on client_details.status_code=jobstatusmaster.jobstatus_id
where (status_code='P' or status_code='UP')  and issue_resolved_by=@emp_id
order by docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_product_code
-- --------------------------------------------------

CREATE proc [dbo].[SP_product_code]
@client_code as varchar(50)
as
select vendor_product.product_code,vendor_product.product_name from vendor_product join client_master
on vendor_product.product_code=client_master.product_code or vendor_product.product_code=client_master.secondary_product where client_master.client_code=@client_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_reasign
-- --------------------------------------------------


CREATE proc [dbo].[SP_reasign]
@pageidentifier as int,
@docket_number as char(8),
@access char(8),
@Client_Code as char(15),
@Product_Code as char(50),
@Issue_Raised_Datetime as datetime,
--@Issue_Resolved_Datetime as datetime,
@Issue_Type char(25),
@Type as char(25),
@Nature as char(50),
@Problem as varchar(500),
@Brief_Solution as varchar(500),
@Client_Remark as varchar(200) ,
@L1_InitialRemark as varchar(200) ,
@L1_FinalRemark as varchar(200) ,
@L2_UserRemark as varchar(200) ,
@L3_UserRemark as varchar(200) ,
@Issue_Resolved_By as varchar(15) ,
--@contact_person as char(50),
@Status_Code as char(15)
as

if @pageidentifier=1
begin 
if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX') and @Status_Code='R'
	begin
		set @L1_FinalRemark =@Client_Remark
		insert into tbl_NewClient_Details values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
	end
else if(@access = 'ITL1EX')
	begin
		set @Status_Code = 'ITL1R'
		set @L1_FinalRemark =@Client_Remark
		insert into tbl_NewClient_Details values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
	end
else if (@access = 'ITL2EXO')
	begin
		set @Status_Code = 'ITL2RO'
		set @L1_FinalRemark =@Client_Remark
		insert into tbl_NewClient_Details values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
	
	end
else if (@access = 'ITL2EXN')
	begin
		set @Status_Code = 'ITL2RN'
		set @L1_FinalRemark =@Client_Remark
		insert into tbl_NewClient_Details values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
	
	end
else if (@access = 'ITL2EXV')
	begin
		set @Status_Code = 'ITL2RV'
		set @L1_FinalRemark =@Client_Remark
		insert into tbl_NewClient_Details values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
		select @docket_number
	
	end
end
else 
begin
if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX') 
	begin
		set @Status_Code = 'R'
		update tbl_NewClient_Details set Status_code=@Status_Code,L1_FinalRemark = @L1_FinalRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
	end
else if(@access = 'ITL1EX')
	begin
		set @Status_Code = 'ITL1R'
		set @L1_FinalRemark =@Client_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,L1_FinalRemark = @L1_FinalRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
	end
else if (@access = 'ITL2EXO')
	begin
		set @Status_Code = 'ITL2RO'
		set @L1_FinalRemark =@Client_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,L1_FinalRemark = @L1_FinalRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
	end
else if (@access = 'ITL2EXN')
	begin
		set @Status_Code = 'ITL2RN'
		set @L1_FinalRemark =@Client_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,L1_FinalRemark = @L1_FinalRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
	end
else if (@access = 'ITL2EXV')
	begin
		set @Status_Code = 'ITL2RV'
		set @L1_FinalRemark =@Client_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,L1_FinalRemark = @L1_FinalRemark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'','','',@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'',@L1_FinalRemark,'','',@Issue_Resolved_By,'','',@Status_Code)
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_reasign_Latest
-- --------------------------------------------------




CREATE proc [dbo].[SP_reasign_Latest]
@pageidentifier as int,
@docket_number as char(8),
@access as char(10),
@Client_Code as char(15),
@Product_Code as char(50),
@tagbranch varchar(50),
@Issue_Raised_Datetime as datetime,
@Issue_Resolving_Time datetime,
@source char(10),
@Issue_Type char(25),
@Type as char(25),
@Nature as char(50),
@Problem as varchar(500),
@Brief_Solution as varchar(500),
@Detailed_Solution varchar(MAX), 
@Ex_Remark varchar(MAX),
@L1_EXRemark varchar(MAX),
@L1_TLRemark varchar(MAX),
@L2_Remark varchar(MAX),
@L3_Remark varchar(MAX),	
@Issue_Resolved_By as varchar(15) ,
--@contact_person as char(50),
@Status_Code as char(15)
as

set @Detailed_Solution=''

if ((@access = 'L1EX' or @access = 'ITL1EX'  or @access = 'ITL1EXBR')  and @Ex_Remark<>'')
	set @L1_EXRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_EXRemark 
else if ((@access = 'L1TL' or @access = 'ITL1TL'  or @access = 'ITL1TLBR') and @Ex_Remark<>'')
	set @L1_TLRemark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L1_TLRemark
else if ((@access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access = 'L2TTL') and @Ex_Remark<>'' )
	set @L2_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L2_Remark
else if ((@access = 'L3EX' or @access = 'L3TL' or @access = 'ADM') and @Ex_Remark<>'')
	set @L3_Remark= (Select username from User_Master where userid=@Issue_Resolved_by) + ' ; ' + Convert(VARCHAR(20),getdate(),100) + ' ; Remark -' + @Ex_Remark  + '\n' + @L3_Remark

Declare @Team_Id as char(10)

------------------------ IT Team -----------------------------
if @access = 'ITL1EX' or @access='ITL1TL' set @Team_Id='ITL1'
if @access = 'ITL1EXBR' or @access='ITL1TLBR' set @Team_Id='ITL1BR'
if @access = 'ITL2EXO' or @access='ITL2TLO' set @Team_Id='ITL2O'
if @access = 'ITL2EXN' or @access='ITL2TLN' set @Team_Id='ITL2N'
if @access = 'ITL2EXV' or @access='ITL2TLV' set @Team_Id='ITL2V'
------------------------ Ebroking Team -----------------------
if @access='L1EX' or @access='L1TL' set @Team_Id='L1'
if @access='L2FEX' or @access='L2FTL' set @Team_Id='L2F'
if @access='L2TEX' or @access='L2TTL' set @Team_Id='L2T'
if @access='L3EX' or @access='L3TL' set @Team_Id='L3'
------------------------- others ----------------------------
if @access='ADM' set @Team_Id='A'

if @pageidentifier=1
begin 
if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX') and @Status_Code='R'
	begin
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	end
else if(@access = 'ITL1EX' or @access = 'ITL1EXBR')
	begin
		set @Status_Code = 'ITL1R'
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	end
else if (@access = 'ITL2EXO')
	begin
		set @Status_Code = 'ITL2RO'
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	
	end
else if (@access = 'ITL2EXN')
	begin
		set @Status_Code = 'ITL2RN'
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	
	end
else if (@access = 'ITL2EXV')
	begin
		set @Status_Code = 'ITL2RV'
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	
	end
else if (@access = 'ITL2EXS')
	begin
		set @Status_Code = 'ITL2RS'
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	
	end
else if (@access = 'ITL2EXI')
	begin
		set @Status_Code = 'ITL2RI'
		--set @L1_FinalRemark =@Ex_Remark
		insert into tbl_NewClient_Details values('','',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code) 
		select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
		select @docket_number
	
	end
end
else 
begin
if (@access = 'L1EX' or @access = 'L2FEX' or @access = 'L2TEX') 
	begin
		set @Status_Code = 'R'
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
else if(@access = 'ITL1EX' or @access = 'ITL1EXBR')
	begin
		set @Status_Code = 'ITL1R'
		--set @L1_FinalRemark =@Ex_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
else if (@access = 'ITL2EXO')
	begin
		set @Status_Code = 'ITL2RO'
		--set @L1_FinalRemark =@Ex_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
else if (@access = 'ITL2EXN')
	begin
		set @Status_Code = 'ITL2RN'
		--set @L1_FinalRemark =@Ex_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
else if (@access = 'ITL2EXV')
	begin
		set @Status_Code = 'ITL2RV'
		--set @L1_FinalRemark =@Ex_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
else if (@access = 'ITL2EXS')
	begin
		set @Status_Code = 'ITL2RS'
		--set @L1_FinalRemark =@Ex_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
else if (@access = 'ITL2EXI')
	begin
		set @Status_Code = 'ITL2RI'
		--set @L1_FinalRemark =@Ex_Remark
		update tbl_NewClient_Details set Status_code=@Status_Code,issue_resolved_datetime= getdate(),
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
		Insert into tbl_NewTaskDetails values('',@docket_number,'',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),'','',@source,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Detailed_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,'',@Status_Code)
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_renamediagram
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_renamediagram
	(
		@diagramname 		sysname,
		@owner_id		int	= null,
		@new_diagramname	sysname
	
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
		declare @theId 			int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
		declare @DiagIdTarg		int
		declare @u_name			sysname
		if((@diagramname is null) or (@new_diagramname is null))
		begin
			RAISERROR ('Invalid value', 16, 1);
			return -1
		end
	
		EXECUTE AS CALLER;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		REVERT;
	
		select @u_name = USER_NAME(@owner_id)
	
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1)
			return -3
		end
	
		-- if((@u_name is not null) and (@new_diagramname = @diagramname))	-- nothing will change
		--	return 0;
	
		if(@u_name is null)
			select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @new_diagramname
		else
			select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @owner_id and name = @new_diagramname
	
		if((@DiagIdTarg is not null) and  @DiagId <> @DiagIdTarg)
		begin
			RAISERROR ('The name is already used.', 16, 1);
			return -2
		end		
	
		if(@u_name is null)
			update dbo.sysdiagrams set [name] = @new_diagramname, principal_id = @theId where diagram_id = @DiagId
		else
			update dbo.sysdiagrams set [name] = @new_diagramname where diagram_id = @DiagId
		return 0
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_search
-- --------------------------------------------------

CREATE procedure [dbo].[SP_search]
@searchtext varchar(500)
as 
select Path,Description,Language,Exname 
from coderepository
where description like '%'+@searchtext+'%'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_SummaryMonth_AKRUTI
-- --------------------------------------------------



CREATE proc [dbo].[SP_SummaryMonth_AKRUTI]
@id varchar(50),@access varchar(50)
as
if @access = 'L1TL'
begin
select u.username as Resource,count(status_code) as [No of Issues],j.jobstatus_Name as [Status]
from issuedetails_AKRUTI d,user_master u,jobstatusMaster j
where u.userid=d.issue_resolved_by and d.status_code=j.jobstatus_id and datepart(mm,issue_resolved_datetime) like datepart(mm,getdate())
group by j.jobstatus_Name,u.username
end
else
begin
select u.username as Resource,count(status_code) as [No of Issues],j.jobstatus_Name as [Status]
from issuedetails_AKRUTI d,user_master u,jobstatusMaster j
where u.userid=d.issue_resolved_by and d.status_code=j.jobstatus_id and d.issue_resolved_by=@id and d.client_remark='akruti' and datepart(mm,issue_resolved_datetime) like datepart(mm,getdate())
group by j.jobstatus_Name,u.username 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_ultimate
-- --------------------------------------------------
CREATE proc SP_ultimate
@counter int,
@limit int,
@query varchar(500),
@viewquery varchar(500),
@masterquery varchar(500)
as

set @viewquery='create view mastermind as select row_number() over (order by m) as rownumber,m from exrate'
select @limit=count(m) from exrate 
set @counter=1

while @limit>=@counter
begin
set @query='select m from mastermind where rownumber='+convert(varchar,@counter)
exec(@query)
set @counter=@counter+1
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_UpdateClientMaster
-- --------------------------------------------------










/*----------------------------------------------
	Author:-			Siddharthpal
	Create Date:-		11/09/2008
	modified Date:-		22/12/2008
	Porcedure Name:-	sp_UpdatedClientMaster
	Purpose:-           Updating the Client_Master Table
*/-----------------------------------------------

CREATE Proc [dbo].[sp_UpdateClientMaster]
@varOption nvarchar(15)

as

if @varOption='Anywhere'
	begin
		--Adding the newly created client from the 196.1.115.132 risk_info database
		insert into client_master
		SELECT left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
		'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,First_Active_date as Active_From,pan_gir_no as PAN_Number,'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
		left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,
		left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda  
		FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.132;User ID=sa;Password=nirwan612').risk.dbo.Client_details as A where A.party_code not in (select client_code from client_master)
		
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Anywhere')) drop table Anywhere
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Anywhere')) select * into Anywhere FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Anywhere$
		update client_master set online_client=0,Account_Status=0
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Anywhere.Product,''),Client_master.Secondary_Product=isnull(Anywhere.Secondary_Product,''),Client_master.Manager_Code=isnull(Anywhere.Manager,''),Client_master.Account_Status=isnull(Anywhere.Status,0) from client_master join Anywhere on client_master.Client_Code=Anywhere.Client_Code
	end
if @varOption='Odins12'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins12')) drop table Odins12
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins12')) select * into Odins12 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins12$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins12.Product,''),Client_master.Secondary_Product=isnull(Odins12.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins12.Manager,''),Client_master.Account_Status=isnull(Odins12.Status,0) from client_master join Odins12 on client_master.Client_Code=Odins12.Client_Code
	end
if @varOption='Odins16'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins16')) drop table Odins16
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins16')) select * into Odins16 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins16$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins16.Product,''),Client_master.Secondary_Product=isnull(Odins16.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins16.Manager,''),Client_master.Account_Status=isnull(Odins16.Status,0) from client_master join Odins16 on client_master.Client_Code=Odins16.Client_Code
	end

if @varOption='Odins20'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins20')) drop table Odins20
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins20')) select * into Odins20 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins20$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins20.Product,''),Client_master.Secondary_Product=isnull(Odins20.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins20.Manager,''),Client_master.Account_Status=isnull(Odins20.Status,0) from client_master join Odins20 on client_master.Client_Code=Odins20.Client_Code
	end
if @varOption='Odins28'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins28')) drop table Odins28
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins28')) select * into Odins28 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins28$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins28.Product,''),Client_master.Secondary_Product=isnull(Odins28.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins28.Manager,''),Client_master.Account_Status=isnull(Odins28.Status,0) from client_master join Odins28 on client_master.Client_Code=Odins28.Client_Code
	end
if @varOption='Odins32'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins32')) drop table Odins32
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins32')) select * into Odins32 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins32$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins32.Product,''),Client_master.Secondary_Product=isnull(Odins32.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins32.Manager,''),Client_master.Account_Status=isnull(Odins32.Status,0) from client_master join Odins32 on client_master.Client_Code=Odins32.Client_Code
	end
if @varOption='Odins34'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins34')) drop table Odins34
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins34')) select * into Odins34 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins34$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins34.Product,''),Client_master.Secondary_Product=isnull(Odins34.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins34.Manager,''),Client_master.Account_Status=isnull(Odins34.Status,0) from client_master join Odins34 on client_master.Client_Code=Odins34.Client_Code
	end
if @varOption='Odins38'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins38')) drop table Odins38
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins38')) select * into Odins38 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins38$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins38.Product,''),Client_master.Secondary_Product=isnull(Odins38.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins38.Manager,''),Client_master.Account_Status=isnull(Odins38.Status,0) from client_master join Odins38 on client_master.Client_Code=Odins38.Client_Code
	end
if @varOption='Odins30'
	begin
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins30')) drop table Odins30
		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins30')) select * into Odins30 FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Odins30$
		update client_master set Client_master.Online_Client='1',Client_master.Product_Code=isnull(Odins30.Product,''),Client_master.Secondary_Product=isnull(Odins30.Secondary_Product,''),Client_master.Manager_Code=isnull(Odins30.Manager,''),Client_master.Account_Status=isnull(Odins30.Status,0) from client_master join Odins30 on client_master.Client_Code=Odins30.Client_Code
	end

if @varOption='Others'
	begin
		--Adding the newly created client from the 196.1.115.132 risk_info database
		insert into client_master
		SELECT left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
		'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,First_Active_date as Active_From,pan_gir_no as PAN_Number,'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
		left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,
		left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda  
		FROM OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.132;User ID=sa;Password=nirwan612').risk.dbo.Client_details as A where A.party_code not in (select client_code from client_master)
	
	--Here make the table sanjay_updated_info from the 196.1.115.157 client_master table
		if exists (select * from sys.objects where [object_id] = object_id('dbo.Sanjay_Updated_Info') )
			begin
					drop table Sanjay_Updated_Info
					select Client_Code,Product_Code,Secondary_Product,Manager_Code,Account_Status,BSE,NSE,NSEFO,MCX,NCDEX into Sanjay_Updated_Info from OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').pda.dbo.Client_master 
				/*	SELECT left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'Online_Client' as Online_Client,'B2C' as B2C,
					left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'Zone_Code' as Zone_Code,left('Product_Code',15) as Product_Code,
					left('Secondary_Product',20) as Secondary_Product,left('PDA',50) as PDA,left('Manager',40) as Manager_Code,
					Status as Account_Status,First_Active_date as Active_From,pan_gir_no as PAN_Number,bsecm as BSE,nsecm as NSE,nsefo as NSEFO,mcdx as MCX,ncdx as NCDEX,left(l_address1,100) as Address,
					left(l_address2,60) as Address1,left(l_address3,60) as Address2,left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,left(rtrim(ltrim(p_address1))+ ' ' + rtrim(ltrim(p_address2)) + ' ' +rtrim(ltrim(p_address3))+' '+rtrim(ltrim(p_city))+' '+rtrim(ltrim(p_state)),100) as Permanent_Address,
					left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,left(mobile_pager,20) as Mobile,left(email,100) as Email,'Serial_Id' as SERIAL_ID          
					into Updated_Info FROM client_master132
				*/
			end
		else
			begin
				select Client_Code,Product_Code,Secondary_Product,Manager_Code,Account_Status,BSE,NSE,NSEFO,MCX,NCDEX into Sanjay_Updated_Info from OPENDATASOURCE('SQLOLEDB','Data Source=196.1.115.157;User ID=pda;Password=som131624').PDA.dbo.Client_master 
			end

		update Client_master set 
					Client_master.Online_Client=isnull(Sanjay_Updated_Info.Account_Status,0),
					Client_master.Product_Code=isnull(Sanjay_Updated_Info.Product_Code,''),
					Client_master.Secondary_Product=isnull(Sanjay_Updated_Info.Secondary_Product,''),
					Client_master.Manager_Code=isnull(Sanjay_Updated_Info.Manager_Code,''),
					Client_master.Account_Status=isnull(Sanjay_Updated_Info.Account_Status,0),
					Client_master.BSE=isnull(Sanjay_Updated_Info.BSE,0),
					Client_master.NSE=isnull(Sanjay_Updated_Info.NSE,0),
					Client_master.NSEFO=isnull(Sanjay_Updated_Info.NSEFO,0),
					Client_master.MCX=isnull(Sanjay_Updated_Info.MCX,0),
					Client_master.NCDEX=isnull(Sanjay_Updated_Info.NCDEX,0)			
		from client_master join Sanjay_Updated_Info
		on client_master.Client_Code=Sanjay_Updated_Info.Client_Code
				
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_upgraddiagrams
-- --------------------------------------------------

	CREATE PROCEDURE dbo.sp_upgraddiagrams
	AS
	BEGIN
		IF OBJECT_ID(N'dbo.sysdiagrams') IS NOT NULL
			return 0;
	
		CREATE TABLE dbo.sysdiagrams
		(
			name sysname NOT NULL,
			principal_id int NOT NULL,	-- we may change it to varbinary(85)
			diagram_id int PRIMARY KEY IDENTITY,
			version int,
	
			definition varbinary(max)
			CONSTRAINT UK_principal_name UNIQUE
			(
				principal_id,
				name
			)
		);


		/* Add this if we need to have some form of extended properties for diagrams */
		/*
		IF OBJECT_ID(N'dbo.sysdiagram_properties') IS NULL
		BEGIN
			CREATE TABLE dbo.sysdiagram_properties
			(
				diagram_id int,
				name sysname,
				value varbinary(max) NOT NULL
			)
		END
		*/

		IF OBJECT_ID(N'dbo.dtproperties') IS NOT NULL
		begin
			insert into dbo.sysdiagrams
			(
				[name],
				[principal_id],
				[version],
				[definition]
			)
			select	 
				convert(sysname, dgnm.[uvalue]),
				DATABASE_PRINCIPAL_ID(N'dbo'),			-- will change to the sid of sa
				0,							-- zero for old format, dgdef.[version],
				dgdef.[lvalue]
			from dbo.[dtproperties] dgnm
				inner join dbo.[dtproperties] dggd on dggd.[property] = 'DtgSchemaGUID' and dggd.[objectid] = dgnm.[objectid]	
				inner join dbo.[dtproperties] dgdef on dgdef.[property] = 'DtgSchemaDATA' and dgdef.[objectid] = dgnm.[objectid]
				
			where dgnm.[property] = 'DtgSchemaNAME' and dggd.[uvalue] like N'_EA3E6268-D998-11CE-9454-00AA00A3F36E_' 
			return 2;
		end
		return 1;
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spAssign
-- --------------------------------------------------


CREATE proc [dbo].[spAssign]
@name varchar(50),
@docket int,
@date datetime,
@access as char(10),
@reassign as char(10)
as
if (@access = 'L1TL' or @access = 'L2FTL' or @access = 'L2TTL')
	update tbl_newclient_details 
	set Status_Code='P',Issue_Resolved_By=@name,Issue_Resolved_dateTime=getdate()
	where Docket_Number=@docket
else if (@access = 'ITL1TL' or @access = 'ITL2TLBR' or @access = 'ITL2TLO' or @access = 'ITL2TLO' or @access = 'ITL2TLN' or @access = 'ITL2TLV' or @access = 'ITL2TLI' or @access = 'ITL2TLS')
	update tbl_newclient_details 
	set Status_Code='ITP',Issue_Resolved_By=@name,Issue_Resolved_dateTime=getdate()
	where Docket_Number=@docket
else if (@access = 'ADM' or @access='L3TL' ) and @reassign = 'EB'
	update tbl_newclient_details 
	set Status_Code='P',Issue_Resolved_By=@name,Issue_Resolved_dateTime=getdate()
	where Docket_Number=@docket
else if (@access = 'ADM' or @access='ITL3TL') and @reassign = 'IT'
	update tbl_newclient_details 
	set Status_Code='ITP',Issue_Resolved_By=@name,Issue_Resolved_dateTime=getdate()
	where Docket_Number=@docket

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPAssignInsertTask
-- --------------------------------------------------

CREATE proc [dbo].[SPAssignInsertTask]
@Docket varchar(40), @EmpCode char(8), @TDate datetime,
@TTime datetime, @Status Char(15)
as
insert into task_details values('',@Docket,@EmpCode,left(@TDate,11),right(@TTime,12),@Status,'')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPAssignPending
-- --------------------------------------------------

CREATE proc [dbo].[SPAssignPending]
@emp_id varchar(15),
@access nvarchar(50),
@issuetype varchar(5),
@user char(10)
as

if (@access = 'L1TL'  and @issuetype = 'E' ) 
begin
	select distinct(d.Docket_Number) as 'Docket Number',m.Branch_Code as 'Branch Code',
	d.Client_Code as 'Client Code',d.source as 'Source',
	v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'Level 1 Executive',um.username as 'Level 1 Executive',
	j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
	from tbl_NewClient_Details d 
	join client_master m on m.Client_Code=d.Client_Code
	join vendor_product v on (d.product_code=v.product_code or d.product_code=v.product_name)
	join jobstatusmaster j on d.status_code=j.jobstatus_id 
	join user_master um on d.issue_resolved_by=um.userid
	where d.issue_type = 'EBro' and 
	d.Status_Code='R' and  issue_resolved_by in (select Employee_Id from tbl_teamleadermaster where Teamleader =@emp_id)
	-- or (Status_code ='L1E' and issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))
	order by j.jobstatus_name
end
else if(@access = 'L1TL' and @issuetype = 'I')
begin
	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',Branch_code as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,	
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Level 1 Executive',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
	--,Status_code
	from tbl_NewClient_Details 
	join tbl_it_odinmaster
	on tbl_NewClient_Details.client_code=tbl_it_odinmaster.Odin_id
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where status_code='R' and tbl_NewClient_Details.issue_type = 'IT' and
	issue_resolved_by in (select Employee_Id from tbl_teamleadermaster where Teamleader =@emp_id)
	order by tbl_NewClient_Details.docket_number
end
else if (@access ='L2FTL' and @issuetype = 'E' ) 
begin
	select distinct(d.Docket_Number) as 'Docket Number',m.Branch_Code as 'Branch Code',
	d.Client_Code as 'Client Code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'L2 Funcational Executive',um.username as 'L2 Funcational Executive',
	j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
	from tbl_NewClient_Details d 
	join client_master m on m.Client_Code=d.Client_Code
	join vendor_product v on (d.product_code=v.product_code or d.product_code=v.product_name)
	join jobstatusmaster j on d.status_code=j.jobstatus_id 
	join user_master um on d.issue_resolved_by=um.userid
	where d.issue_type = 'EBro' and 
	d.Status_Code='R' and  issue_resolved_by in (select Employee_Id from tbl_teamleadermaster where Teamleader =@emp_id)
	-- or (Status_code ='EF' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL')))
	order by j.jobstatus_name
end
else if (@access ='L2TTL' and @issuetype = 'E' ) 
begin
	select distinct(d.Docket_Number) as 'Docket Number',	m.Branch_Code as 'Branch Code',
	d.Client_Code as 'Client Code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'L2 Funcational Executive',um.username as 'L2 Funcational Executive',
	j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
	from tbl_NewClient_Details d 
	join client_master m on m.Client_Code=d.Client_Code
	join vendor_product v on (d.product_code=v.product_code or d.product_code=v.product_name)
	join jobstatusmaster j on d.status_code=j.jobstatus_id 
	join user_master um on d.issue_resolved_by=um.userid
	where d.issue_type = 'EBro' and 
	d.Status_Code='R' and  issue_resolved_by in (select Employee_Id from tbl_teamleadermaster where Teamleader =@emp_id)
	-- or (Status_code ='ET' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL')))
	order by j.jobstatus_name
end
--else if (@access='L3TL' and @issuetype='E')
--BEGIN
--	select distinct(d.Docket_Number) as 'Docket Number',	m.Branch_Code as 'Branch Code',	d.Client_Code as 'Client Code',	v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
--	d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'L2 Funcational Executive',um.username as 'L2 Funcational Executive',
--	j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
--	from tbl_NewClient_Details d 
--	join client_master m on m.Client_Code=d.Client_Code
--	join vendor_product v on v.product_code=d.product_code
--	join jobstatusmaster j on d.status_code=j.jobstatus_id 
--	join user_master um on d.issue_resolved_by=um.userid
--	where d.issue_type = 'EBro' and 
--	d.Status_Code='R' and  issue_resolved_by in (select userid from user_master where Teamleader =@emp_id)
--	or (Status_code ='E3' and issue_resolved_by in (select userid from user_master where role_id in ('L2FEX','L2FTL','L2TEX','L2TTL')))
--	order by j.jobstatus_name
--END
else if (@access = 'ADM' or @access='L3TL' or @access='L3EX' or @access='ITL3EX' or @access='ITL3TL') and @issuetype = 'E'
Begin
	select distinct(d.Docket_Number) as 'Docket Number',	m.Branch_Code as 'Branch Code',
	d.Client_Code as 'Client Code',	d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue raised Date',	d.Issue_Resolved_dateTime as 'Reassigned date',	d.issue_resolved_by as 'L2 Funcational Executive',um.username as 'L2 Funcational Executive',
	j.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours
	from tbl_NewClient_Details d 
	join client_master m on m.Client_Code=d.Client_Code
	join vendor_product v on (d.product_code=v.product_code or d.product_code=v.product_name)
	join jobstatusmaster j on d.status_code=j.jobstatus_id 
	join user_master um on d.issue_resolved_by=um.userid
	where d.issue_type = 'EBro' and 
	d.Status_Code='R' and  issue_resolved_by in (select userid from user_master)
	-- or (Status_code in ('EF','ET','R') and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL')))
	-- or (Status_code ='E3' and issue_resolved_by in (select userid from user_master where role_id in ('L2FEX','L2FTL','L2TEX','L2TTL')))
	order by j.jobstatus_name
end
else if(@access = 'ADM' or @access='L3TL' or @access='L3EX' or @access='ITL3EX' or @access='ITL3TL') and @issuetype = 'I' and @user = 'EB'
begin
	select distinct(Docket_Number) as 'Docket No.',
	--tbl_NewClient_Details.SBTag as 'SubBroker Tag',
	tbl_NewClient_Details.client_code as 'Client Code',Branch_code as 'Branch',
	tbl_IT_KB_Master.product_name as 'Product',tbl_NewClient_Details.Nature,tbl_NewClient_Details.Problem,
	tbl_NewClient_Details.Brief_solution as [Brief Solution],
	Replace((tbl_NewClient_Details.L1_InitialRemark + tbl_NewClient_Details.L1_FinalRemark + tbl_NewClient_Details.L2_UserRemark + tbl_NewClient_Details.L3_UserRemark),'\n','==||==') AS Remark,	
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.userid as 'Level 1 Executive',user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',datediff(hour,issue_raised_datetime,getdate()) as hours
	--,Status_code
	from tbl_NewClient_Details 
	join tbl_it_odinmaster
	on tbl_NewClient_Details.client_code=tbl_it_odinmaster.Odin_id
	join tbl_IT_KB_Master
	on tbl_NewClient_Details.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on tbl_NewClient_Details.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on tbl_NewClient_Details.status_code=jobstatusmaster.jobstatus_id
	where status_code in ('ITL1E','R') and tbl_NewClient_Details.issue_type = 'IT' and
	issue_resolved_by in (select userid from user_master where Team_Id = 'L1')
	order by tbl_NewClient_Details.docket_number

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPAssignPending(suspend)
-- --------------------------------------------------

create proc [dbo].[SPAssignPending(suspend)]
as
select d.Docket_Number as 'Docket Number',m.Branch_Code as 'Branch Code',d.Client_Code as 'Client Code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue raised Date',u.username as 'Level 1 Executive' ,d.Issue_Resolved_dateTime as 'Reassigned date',j.jobstatus_name as 'Status'
from client_details d, client_master m, user_master u, vendor_product v,jobstatusmaster j
where m.Client_Code=d.Client_Code
and v.product_code=d.product_code and u.userid = d.Issue_resolved_By
and d.status_code=j.jobstatus_id
and (d.Status_Code='R' or d.status_code='PDA') --or d.Issue_resolved_By='')
order by  d.Docket_Number

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPCallBack
-- --------------------------------------------------



CREATE proc [dbo].[SPCallBack]
@emp_id varchar(15),@access varchar(15)
as
if @access ='L1EX'
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
	u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.status_code like 'C' and issue_type='EBro'
	and issue_resolved_by=   @emp_id and issue_type='EBro'
	order by d.Issue_Resolved_dateTime
end
else if @access='ITL1EX'
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
	u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.status_code like 'ITC' and issue_type='EBro'
	and issue_resolved_by=@emp_id
	order by d.Issue_Resolved_dateTime
end
else if @access ='L1TL' 
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
	u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72
	and d.status_code like 'C' and issue_type='EBro'
	and (issue_resolved_by = @emp_id or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by d.Issue_Resolved_dateTime
end
else if @access='ITL1TL'
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
	u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72
	and d.status_code like 'ITC' and issue_type='EBro'
	and (issue_resolved_by = @emp_id or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
	order by d.Issue_Resolved_dateTime
end
else if (@access = 'ADM' or @access='L3EX' or @access='L3TL' or @access='ITL3EX' or @access='ITL3TL')
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',d.source as 'Source',v.product_name as 'Product Name',
	d.nature as 'Nature',d.problem as 'Problem',
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
	u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
	and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and issue_type='EBro'
	and 
	(
	(d.status_code like 'C' and issue_resolved_by in (Select userid from user_master where role_id in ('L1EX','L1TL')))
	or 
	(d.status_code='ITC' and issue_resolved_by in (Select userid from user_master where role_id in ('ITL1EX','ITL1TL')))
	) 
	order by d.Issue_Resolved_dateTime
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPCallBack_Latest
-- --------------------------------------------------




CREATE proc [dbo].[SPCallBack_Latest]
@emp_id varchar(15),
@access varchar(15),
@FromDate Datetime,
@Todate Datetime,
@CSO varchar(15)

as
if @access ='L1EX'
begin
	
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
		m.branch_code as 'Branch code',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch ) End) as [CSO],
		d.source as 'Source',v.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
		u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.status_code like 'C' and issue_type='EBro'
		and issue_resolved_by=   @emp_id and issue_type='EBro'
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
	order by d.Issue_Resolved_dateTime
end
else if @access='ITL1EXBR'
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
		m.branch_code as 'Branch code',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch ) End) as [CSO],
		d.source as 'Source',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
		u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	From client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and d.status_code like 'ITC' and issue_type='EBro'
		and issue_resolved_by=@emp_id
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
	order by d.Issue_Resolved_dateTime
end
else if @access ='L1TL' 
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
		m.branch_code as 'Branch code',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch ) End) as [CSO],
		d.source as 'Source',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
		u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72
		and d.status_code like 'C' and issue_type='EBro'
		and (issue_resolved_by = @emp_id or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
	order by d.Issue_Resolved_dateTime
end
else if @access='ITL1TLBR'
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
		m.branch_code as 'Branch code',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch ) End) as [CSO],
		d.source as 'Source',v.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
		u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72
		and d.status_code like 'ITC' and issue_type='EBro'
		and (issue_resolved_by = @emp_id or issue_resolved_by in (select userid from user_master where Teamleader = @emp_id))
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
	order by d.Issue_Resolved_dateTime
end
else if (@access='L3EX' or @access='L3TL' or @access='ITL3EX' or @access='ITL3TL')
begin
	select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
		 m.branch_code as 'Branch code',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [CSO],
		d.source as 'Source',v.product_name as 'Product Name',
		d.nature as 'Nature',d.problem as 'Problem',
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
		u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
	from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
	where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
		and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and issue_type='EBro'
		and 
		(
		(d.status_code like 'C' and issue_resolved_by in (Select userid from Muser_master where role_id in ('L1EX','L1TL')))
		or 
		(d.status_code='ITC' and issue_resolved_by in (Select userid from Muser_master where role_id in ('ITL1EX','ITL1TL')))
		) 
		And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
				Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
				Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))		
	order by d.Issue_Resolved_dateTime
end
else if(@access = 'ADM')
begin
	if(@CSO<>'')
	Begin
		Select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
			 m.branch_code as 'Branch code',
			(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [CSO],
			d.source as 'Source',v.product_name as 'Product Name',
			d.nature as 'Nature',d.problem as 'Problem',
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
			d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
			u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
		from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
		where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
			and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and issue_type='EBro'
			and 
			(
			(d.status_code like 'C' and issue_resolved_by in (Select userid from Muser_master where role_id in ('L1EX','L1TL')))
			or 
			(d.status_code='ITC' and issue_resolved_by in (Select userid from Muser_master where role_id in ('ITL1EX','ITL1TL')))
			) 
			And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
					Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
			And issue_resolved_by in (Select Userid From MUser_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code=@CSO))
		order by d.Issue_Resolved_dateTime
	End
	Else If(@CSO='')
	Begin
				Select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',
			 m.branch_code as 'Branch code',
			(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			(Case when (d.TagBranch is null or d.TagBranch='') then '' when (d.TagBranch is NOT null AND d.TagBranch<>'') then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [CSO],
			d.source as 'Source',v.product_name as 'Product Name',
			d.nature as 'Nature',d.problem as 'Problem',
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
			d.Issue_Raised_dateTime as 'Issue Raised Date/Time',tm.Team_Name as 'Issue resolved level',
			u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',d.Status_Code as Status
		from client_master m,tbl_NewClient_Details d, user_master u,vendor_product v,Team_Master tm
		where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and u.team_id=tm.team_id and v.product_code=d.product_code)
			and datediff(hour,Issue_Resolved_DateTime,getdate())>72 and issue_type='EBro'
			and 
			(
			(d.status_code like 'C' and issue_resolved_by in (Select userid from Muser_master where role_id in ('L1EX','L1TL')))
			or 
			(d.status_code='ITC' and issue_resolved_by in (Select userid from Muser_master where role_id in ('ITL1EX','ITL1TL')))
			) 
			And Convert(Datetime,Convert(Varchar(12),d.Issue_Resolved_dateTime,113)) 
					Between Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@FromDate), 113)) And 
					Convert(Datetime, COnvert(Varchar(12), Convert(Datetime,@ToDate), 113))
			And issue_resolved_by in (Select Userid From MUser_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster))
		order by d.Issue_Resolved_dateTime
	End
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPcheck_clientexist
-- --------------------------------------------------
create proc SPcheck_clientexist
@clientid varchar(20)
as
select client_code from advance_information
where client_code=@clientid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPCheckRating
-- --------------------------------------------------
CREATE proc SPCheckRating
@EmployeeName varchar(20),
@Date datetime,
@UserID varchar(10)
as
set @UserID = (Select userid from user_master where (username=@EmployeeName))
select u.username,e.emp_id,e.date,Communication,Product_Knowledge,Interpersonal_skills,Conduct_on_calls,Total
from executive_rating e, user_master u
where u.userid=e.emp_id and e.emp_id=@UserID and e.date=@Date

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spclientcode
-- --------------------------------------------------








CREATE procedure [dbo].[spclientcode]
@emp_id varchar(15),@access varchar(15)
as
if @access ='L1EX'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
where (status_code='P' or status_code='UP')  and issue_resolved_by=@emp_id
order by client_details.docket_number 
end
else if @access='L2FEX'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join task_details
on client_details.docket_number=task_details.docket_number
where (client_details.status_code='EF' and task_details.status_code='EF') or (((client_details.status_code='UP' and task_details.status_code='UP') or (client_details.status_code='L' and task_details.status_code='EF')) and issue_resolved_by=@emp_id)
--where status_code='EF' or (status_code='UP' and issue_resolved_by=@emp_id)
order by client_details.docket_number 
end
else if @access='L2TEX'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join task_details
on client_details.docket_number=task_details.docket_number
where (client_details.status_code='ET' and task_details.status_code='ET') or (((client_details.status_code='UP' and task_details.status_code='UP') or (client_details.status_code='L' and task_details.status_code='ET')) and issue_resolved_by=@emp_id)
--where status_code='ET' or (status_code='UP' and issue_resolved_by=@emp_id)
order by client_details.docket_number 
end
else if @access='L3EX'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join task_details
on client_details.docket_number=task_details.docket_number
where (client_details.status_code='E3' and task_details.status_code='E3') or (((client_details.status_code='UP' and task_details.status_code='UP') or (client_details.status_code='L' and task_details.status_code='E3')) and issue_resolved_by=@emp_id)
--where status_code='E3' or (status_code='UP' and issue_resolved_by=@emp_id)
order by client_details.docket_number 
end
else if @access='L1TL'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
where status_code='P' or (status_code='UP' and user_master.team_id='L1')
order by client_details.docket_number
end
else if @access='L2FTL'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join task_details
on client_details.docket_number=task_details.docket_number
where (client_details.status_code='EF' and task_details.status_code='EF') or (((client_details.status_code='UP' and task_details.status_code='UP') or (client_details.status_code='L' and task_details.status_code='EF')) and user_master.team_id='L2F')
--where status_code='EF' or (status_code='UP' and user_master.team_id='L2F')
order by client_details.docket_number
end
else if @access='L2TTL'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join task_details
on client_details.docket_number=task_details.docket_number
where (client_details.status_code='ET' and task_details.status_code='ET') or (((client_details.status_code='UP' and task_details.status_code='UP') or (client_details.status_code='L' and task_details.status_code='ET')) and user_master.team_id='L2T')
--where status_code='ET' or (status_code='UP' and user_master.team_id='L2T')
order by client_details.docket_number
end
else if @access='L3TL'
begin
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
join task_details
on client_details.docket_number=task_details.docket_number
where (client_details.status_code='E3' and task_details.status_code='E3') or (((client_details.status_code='UP' and task_details.status_code='UP') or (client_details.status_code='L' and task_details.status_code='E3')) and user_master.team_id='L3')
--where status_code='E3' or (status_code='UP' and user_master.team_id='L3')
order by client_details.docket_number
end
else
begin 
select client_details.client_code as 'Client Code',client_details.docket_number
from client_details 
join client_master
on client_details.client_code=client_master.client_code
join vendor_product
on client_details.product_code=vendor_product.product_code
join user_master
on client_details.issue_resolved_by=user_master.userid
where status_code like 'E%' or status_code='UP' or status_code='P' or status_code='L'
order by client_details.docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPCurrentsummary
-- --------------------------------------------------



CREATE PROC [dbo].[SPCurrentsummary]
@userid as varchar(10),
@access as varchar(20),
@location as varchar(20)
as

IF charindex('IT',@access)>0 
BEGIN
	IF ((Select role_id from user_master where userid=@userid)='ADM')
	BEGIN
		IF @location<>''
		BEGIN	
			SELECT distinct USERID,USERNAME,TODAYS_TOTAL,
			TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED
--			,CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
--			LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED 
			from v_it,User_Master
			where userid=issue_resolved_by and 
			issue_resolved_by in (select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@Location)

			union

			select 'Total','',sum(TODAYS_TOTAL),SUm(TODAY_COMPLETED),SUM(TODAY_ESCALTED),SUM(TODAY_PENDING),SUM(TODAY_REASSINGNED),SUM(TODAY_CLOSED)
--			,'','','','','','','','','','' 
			from v_it,User_Master
			where userid=issue_resolved_by and 
			issue_resolved_by in (select userid from user_master where teamleader in (select userid from user_master where role_id=@access) and Branch_id=@Location)
		END
		ELSE
		BEGIN	
			SELECT distinct USERID,USERNAME,TODAYS_TOTAL,
			TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED
--			,CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
--			LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
			from v_it,User_Master
			where userid=issue_resolved_by and 
			issue_resolved_by in (select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			
			UNION

			select 'Total','',sum(TODAYS_TOTAL),SUm(TODAY_COMPLETED),SUM(TODAY_ESCALTED),SUM(TODAY_PENDING),SUM(TODAY_REASSINGNED),SUM(TODAY_CLOSED)
--			,'','','','','','','','','','' 
			from v_it,User_Master
			where userid=issue_resolved_by and 
			issue_resolved_by in (select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
		END
	END
	ELSE
	BEGIN
		SELECT distinct USERID,USERNAME,TODAYS_TOTAL,
		TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED 
--		,CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
--		LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
		FROM V_IT,user_master 
		where issue_resolved_by=userid and issue_resolved_by IN (select userid from user_master where TeamLeader=@userid)
			
		UNION
	
		select 'Total','',sum(TODAYS_TOTAL),SUm(TODAY_COMPLETED),SUM(TODAY_ESCALTED),SUM(TODAY_PENDING),SUM(TODAY_REASSINGNED),SUM(TODAY_CLOSED)
--		,'','','','','','','','','','' 
		from v_it,User_Master
		where issue_resolved_by=userid and issue_resolved_by IN (select userid from user_master where TeamLeader=@userid)
	END
END
ELSE
BEGIN
	IF ((Select role_id from user_master where userid=@userid)='ADM')
	BEGIN
		IF @location<>''
		BEGIN
			SELECT distinct USERID,USERNAME,TODAYS_TOTAL,
			TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED
--			,CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
--			LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
			FROM V_Ebro,user_master 
			where userid=issue_resolved_by and 
			issue_resolved_by in (select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@Location)
			
			UNION

			select 'Total','',sum(TODAYS_TOTAL),SUm(TODAY_COMPLETED),SUM(TODAY_ESCALTED),SUM(TODAY_PENDING),SUM(TODAY_REASSINGNED),SUM(TODAY_CLOSED)
--			,'','','','','','','','','',''  
			FROM V_Ebro,user_master
			where userid=issue_resolved_by and 
			issue_resolved_by in (select userid from user_master where teamleader in 
			(select userid from user_master where role_id=@access) and Branch_id=@Location)
		END
		ELSE
		BEGIN
			SELECT distinct USERID,USERNAME,TODAYS_TOTAL,
			TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED
--			,CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
--			LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
			FROM V_Ebro,user_master 
			where userid=issue_resolved_by and 
			issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
			
			UNION

			select 'Total','',SUM(TODAYS_TOTAL),SUM(TODAY_COMPLETED),SUM(TODAY_ESCALTED),SUM(TODAY_PENDING),SUM(TODAY_REASSINGNED),SUM(TODAY_CLOSED)
--			,'','','','','','','','','','' 
			 FROM V_Ebro,user_master
			where userid=issue_resolved_by and 
			issue_resolved_by in(select userid from user_master where teamleader in (select userid from user_master where role_id=@access))
		END
	END
	ELSE
	BEGIN
		SELECT distinct USERID,USERNAME,TODAYS_TOTAL,
		TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED
--		,CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
--		LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
		FROM V_Ebro,user_master 
		where issue_resolved_by=userid and issue_resolved_by IN (select userid from user_master where TeamLeader=@userid)

		UNION

		select 'Total','',sum(TODAYS_TOTAL),SUm(TODAY_COMPLETED),SUM(TODAY_ESCALTED),SUM(TODAY_PENDING),SUM(TODAY_REASSINGNED),SUM(TODAY_CLOSED)
--		,'','','','','','','','','',''  
		FROM V_Ebro,user_master
		where issue_resolved_by=userid and issue_resolved_by IN (select userid from user_master where TeamLeader=@userid)
	END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPCurrentsummary_OLD
-- --------------------------------------------------

CREATE PROC [dbo].[SPCurrentsummary]
@userid as varchar(10),
@access as varchar(20)
as

IF charindex('IT',@access)>0 
BEGIN

	SELECT distinct USERID,USERNAME,
	TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED, 
	CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
	LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
	FROM V_IT,user_master 
	where issue_resolved_by=userid and issue_resolved_by IN (select userid from user_master where TeamLeader=@userid)
END
ELSE
BEGIN

	SELECT distinct USERID,USERNAME,
	TODAY_COMPLETED, TODAY_ESCALTED, TODAY_PENDING, TODAY_REASSINGNED ,TODAY_CLOSED, 
	CurrentMonth_COMPLETED,CurrentMonth_ESCALATED,CurrentMonth_PENDING,CurrentMonth_REASSIGNED,CurrentMonth_CLOSED, 
	LastMonth_COMPLETED, LastMonth_ESACLATED ,LastMonth_PENDING , LastMonth_REASSIGNED, LastMonth_CLOSED  
	FROM V_Ebro,user_master 
	where issue_resolved_by=userid and issue_resolved_by IN (select userid from user_master where TeamLeader=@userid)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPDeleteAllMessage
-- --------------------------------------------------


CREATE procedure [dbo].[SPDeleteAllMessage]
@Message text
as 
Delete from sent_messages where message_sent like  @Message

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPDeleteMessage
-- --------------------------------------------------

CREATE procedure [dbo].[SPDeleteMessage]
@MsgID int
as 
Delete from sent_messages where msg_id=@MsgID

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPDisplayGrid
-- --------------------------------------------------





CREATE proc [dbo].[SPDisplayGrid]
@query1 varchar(max),
@count varchar(100),
@query varchar(max),
@employee varchar(50),
@FromDate varchar(20),
@ToDate varchar(20),
@Type varchar(20),
@TeamLeader varchar(50)
as
-------------------Delete Records from Exrate-----------------------
drop table exrate
--------------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
select Emp_Id,Date,Total
into Exrate
from Executive_rating
-----------------------------------------------------------------------
-----------------------executive monthly----------------------------------
--set @flag =0
if @Type = 'Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select (datename(MM,date)+' '+datename(yyyy,date))as date from Exrate
where date between @Fromdate and @ToDate
group by (datename(MM,date)+' '+datename(yyyy,date))
order by convert(datetime,(datename(MM,date)+' '+datename(yyyy,date)))

--order by date
OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1=left(@query1, len(@query1)-1)

---------------------------------Monthly All Exec---------------------------------------------

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)


if @Employee = 'All Executive' -- 2nd if 
begin
set @query= 'select [Employee Name], ' + @query1 + ' From 
(select u.username as "Employee Name",DATENAME(mm,date)+'''+' '+'''+DATENAME(yyyy,date) as "Date", sum(e.total) as Total from exrate E, user_master U
where e.emp_id=u.userid and u.teamleader ='''+ @TeamLeader+''' and userid <> '''+@TeamLeader+'''
and 
(e.date between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(year,1,'''+@ToDate+''')as datetime)))
group by u.username,DATENAME(mm,date)+'''+' '+'''+DATENAME(yyyy,date),DATEPART(m,date),DATEPART(yyyy,date))s

pivot
(
	 sum(total)
     for date in ('+@query1+')
)p
order by [Employee Name]'
end


-------------------------------Monthly Exec------------------------------------------------------------------
else
begin
set @query= 'select [Employee Name], ' + @query1 + ' From 
(select u.username as "Employee Name",DATENAME(mm,date)+'''+' '+'''+DATENAME(yyyy,date) as "Date", sum(e.total) as Total from exrate E, user_master U
where e.emp_id=u.userid and u.username='''+@Employee +'''
and 
(e.date between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(year,1,'''+@ToDate+''')as datetime)))
group by u.username,DATENAME(mm,date)+'''+' '+'''+DATENAME(yyyy,date),DATEPART(m,date),DATEPART(yyyy,date))s

pivot
(
	 sum(total)
     for date in ('+@query1+')
)p
order by [Employee Name]'
end
end
end
------------------------------------------------------
else if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11)as date from Exrate
where date between @Fromdate and @ToDate
group by left(date,11)
order by convert(datetime,left(date,11))
--order by date
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1=left(@query1, len(@query1)-1)

---------------------------------Daily All Executive---------------------------------------------
if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)

if @Employee = 'All Executive'
begin
set @query= 'select [Employee Name], ' + @query1 + ' From 
(select u.username as "Employee Name",left(date,11) as "Date", e.total as Total from exrate E, user_master U
where e.emp_id=u.userid and u.teamleader ='''+ @TeamLeader+''' and userid <> '''+@TeamLeader+'''
and 
(e.date between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)))
)s

pivot
(
	 sum(total)
     for date in ('+@query1+')
)p
order by [Employee Name]'
end

-------------------------------Daily Executive------------------------------------------------------------------
else
begin
set @query='select [Employee Name], ' + @query1 + ' From 
(select u.username as "Employee Name",left(date,11) as "Date", e.total as Total from exrate E, user_master U
where e.emp_id=u.userid and u.username='''+@Employee+'''
and 
(e.date between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)))
)s

pivot
(
	 sum(total)
     for date in ('+@query1+')
)p
order by [Employee Name]'
end
end
end
--------------------------------------------------------------------------
--select @query
exec (@query)
--select @count 
----------------------------------End Of Query----------------------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPDisplayGrid1
-- --------------------------------------------------


CREATE proc [dbo].[SPDisplayGrid1]
@query1 varchar(max),
@count varchar(100),
@query varchar(max),
@employee varchar(20),
@FromDate varchar(20),
@ToDate varchar(20),
@Type varchar(20)
as
-------------------Delete Records from Exrate-----------------------
drop table exrate
--------------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
select Emp_Id,Date,Total
into Exrate
from Executive_rating
-----------------------------------------------------------------------
-----------------------executive monthly----------------------------------
--set @flag =0

DECLARE sysCursor1 CURSOR
for
select distinct left(date,11) from Exrate
where date between @Fromdate and @ToDate
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
SELECT @query1=left(@query1, len(@query1)-1)
---------------------------------Monthly All Exec---------------------------------------------
if @Type = 'Daily'
begin
if @Employee = 'All Executive'
begin
set @query= 'select [Employee Name], ' + @query1 + 'From 
(select u.username as "Employee Name",left(date,11) as "Date", e.total as Total from exrate E, user_master U
where e.emp_id=u.userid 
and 
(e.date between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)))
)s

pivot
(
	 sum(total)
     for date in ('+@query1+')
)p
order by [Employee Name]'
end

-------------------------------Monthly Exec------------------------------------------------------------------
else
begin
set @query='select [Employee Name], ' + @query1 + ' From 
(select u.username as "Employee Name",left(date,11) as "Date", e.total as Total from exrate E, user_master U
where e.emp_id=u.userid and u.username='''+@Employee+'''
and 
(e.date between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)))
)s

pivot
(
	 sum(total)
     for date in ('+@query1+')
)p
order by [Employee Name]'
end
end
--------------------------------------------------------------------------
select @query1
select @query

exec (@query)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spDisplayMessage
-- --------------------------------------------------
CREATE proc [dbo].[spDisplayMessage]
@name varchar(50)
as
begin
Select message_sent 
from sent_messages 
where Sent_to = @name and (mess_valid_from <= getdate() and mess_valid_to >= getdate())
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spDisplayMessage1
-- --------------------------------------------------
CREATE proc [dbo].[spDisplayMessage1]
@name varchar(50)
as
begin
Select message_sent 
from sent_messages 
where Sent_to = @name and (mess_valid_from <= getdate() and mess_valid_to >= getdate()) and message_status =0
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spDisplayReminder1
-- --------------------------------------------------
CREATE proc [dbo].[spDisplayReminder1]
@name varchar(50)
as
begin
Select message_sent 
from sent_messages 
where Sent_to = @name and (mess_valid_from <= getdate() and mess_valid_to >= getdate()) and message_status =1
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spDynamicCrossTab
-- --------------------------------------------------

CREATE PROCEDURE spDynamicCrossTab

@RowValue VARCHAR(255),         --what is the SQL for the row title 
@ColValue VARCHAR(255),         --what is the SQL for the column title
@Aggregate VARCHAR(255),        --the aggregation value to go in the cells
@FromExpression VARCHAR(8000),              --the FROM, ON and WHERE clause
@colOrderValue VARCHAR (255)=NULL,            --how the columns are ordered
@Title VARCHAR(80)='_',    --the title to put in the first col of first row
@SortBy VARCHAR(255)='row asc', --what you sort the rows by (column heading)
@RowSort VARCHAR(80)=NULL,
@ReturnTheDDL INT=0,--return the SQL code rather than execute it
@Debugging INT=0    --debugging mode
/*
e.g.
Execute spDynamicCrossTab
    @RowValue='firstname+'' ''+lastname',
    @ColValue='Year(OrderDate)',
    @Aggregate= 'count(*)',
    @FromExpression='FROM Employees INNER JOIN Orders 
    ON (Employees.EmployeeID=Orders.EmployeeID)',
    @ColOrderValue='Year(OrderDate)',
   @Title ='No. Sales per year',
   @SortBy ='total desc' --what you sort the rows by (column heading)

Execute spDynamicCrossTab
    @RowValue='firstname+'' ''+lastname',
    @ColValue='DATENAME(month,orderDate)',
    @Aggregate= 'sum(subtotal)',
    @FromExpression='FROM Orders 
   INNER JOIN "Order Subtotals" 
       ON Orders.OrderID = "Order Subtotals".OrderID
   inner join employees on employees.EmployeeID =orders.EmployeeID',
    @ColOrderValue='datepart(month,orderDate)',
   @Title ='Customers orders per month '

EXECUTE spDynamicCrossTab 
    @RowValue='country',
    @ColValue='datename(quarter,orderdate)
     +case datepart(quarter,orderdate) 
         when 1 then ''st'' 
         when 2 then ''nd'' 
         when 3 then ''rd'' 
         when 4 then ''th'' end',
    @Aggregate= 'sum(subtotal)',
    @FromExpression='FROM Orders 
   INNER JOIN "Order Subtotals" 
       ON Orders.OrderID = "Order Subtotals".OrderID
  inner join customers on customers.customerID =orders.customerID',
    @ColOrderValue='datepart(quarter,orderDate)',
   @sortby='total desc',
   @Title ='value of orders per quarter'

*/
AS
SET NOCOUNT ON
DECLARE @Command NVARCHAR(MAX)
DECLARE @SQL VARCHAR(MAX)
--make sure we have sensible defaults for orders
SELECT @ColOrderValue=COALESCE(@ColOrderValue, @ColValue),
   @Sortby=COALESCE(@SortBy,@RowValue),
    @rowsort=COALESCE(@RowSort,@RowValue)
--first construct tha SQL which is used to calculate the columns in a 
--string
SELECT @Command='select @SQL=coalesce(@SQL,''SELECT 
  ['+@Title+']=case when row is null then ''''Sum'''' 
else convert(Varchar(80),[row]) end ,
'')+
  ''[''+convert(varchar(100),'
   +@ColValue+')+''] =sum( CASE col WHEN ''''''+convert(varchar(100),'
   +@ColValue+')+'''''' THEN data else 0 END ),
'' '+@FromExpression+'
GROUP BY '+@ColValue+'
order by max('+@ColorderValue+')'
--Now we execute the string to obtain the SQL that we will use for the
--crosstab query
EXECUTE sp_ExecuteSQL @command,N'@SQL VARCHAR(MAX) OUTPUT',@SQL OUTPUT
  IF @@error > 0 --display the string if there is an error
    BEGIN
      RAISERROR ( 'offending code was ...%s', 0, 1, @command )
      RETURN 1
    END
IF @debugging <>0 SELECT @Command
--we now add the rest of the SQL into the string
SELECT @SQL=@SQL+'  [Total]= sum( data )
from 
   (select [row]='+@RowValue+', 
           [col]='+@ColValue+', 
           [data]='+@Aggregate+',
           [sort]=max('+@rowsort+')
'+@FromExpression+' 
    GROUP BY '+@RowValue+', '+@ColValue+'
)f
group by row with rollup
order by grouping(row),'+@Sortby

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPEscalate
-- --------------------------------------------------


CREATE proc [dbo].[SPEscalate]
-----------------------------------------------------------------------------
------Auther		:	Sanjay Lavu Kudtarkar
------Date Created	:	26-8-2008
------Comment		:	Escalate
-----------------------------------------------------------------------------
@pageidentifier as int,
@access as char(8),
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@Issue_Raised_Datetime datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Client_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15)
as

if @pageidentifier=1
begin 
	if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
	begin
		set @Status_Code='ET'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if(@access = 'ITL1EX' or @access='ITL1TL') and (@type='technical' or @type='functional')
	begin
		set @Status_Code='L1E'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if(@access = 'L1EX' or @access='L1TL') and (@type='functional')
	begin
		set @Status_Code='EF'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if @access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access='L2TTL'
	begin
		set @Status_Code='E3'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

select @docket_number
end

else 
Begin
	if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
	begin
		set @Status_Code='ET'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code, L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L1EX' or @access='L1TL') and (@type='functional')
	begin	
		set @Status_Code='EF'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code, L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L2TEX' or @access='L2TTL')
	begin
		set @Status_Code='E3'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code, L2_UserRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L2FEX' or @access = 'L2FTL')
	begin
		set @status_code = 'E3'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code, L2_UserRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if(@access = 'ITL1EX' or @access='ITL1TL') and (@type='technical' or @type='functional')
	begin
		set @Status_Code='L1E'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@Issue_Raised_Datetime,getdate(),'',@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,@Client_Remark,'','','','',@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code, L2_UserRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
End
------------------------------------------------------------------------------

--else
--begin 
--if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
--begin
--set @Status_Code='ET'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code, L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if (@access = 'L1EX' or @access='L1TL') and (@type='functional')
--begin
--set @Status_Code='EF'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code,  L1_FinalRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if @access = 'L2TEX' or @access='L2TTL'
--begin
--set @Status_Code='E3'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code,  L2_UserRemark = @Client_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--end
--

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPEscalate_Latest
-- --------------------------------------------------




CREATE proc [dbo].[SPEscalate_Latest]
@pageidentifier as int,
@access as char(10),
@docket_number as char(8),
@Client_Code char(15),
@Product_Code char(50),
@tagbranch varchar(50),
@Issue_Raised_Datetime datetime,
@Issue_Resolving_Time datetime,
@Call_From char(25),
@Call_Type char(25),
@Issue_Type char(25),
@Type char(25),
@Nature char(50),
@Problem varchar(500),
@Brief_Solution varchar(500),
@Ex_Remark varchar(200),
@L1_EXRemark varchar(200),
@L1_TLRemark varchar(200),
@L2_Remark varchar(200),
@L3_Remark varchar(200),
@Issue_Resolved_by varchar(15),
@Team_Id nchar(10),
@Contact_Person char(50),
@Status_Code char(15)
as

if (@access = 'L1EX' or @access = 'ITL1EX')
	set @L1_EXRemark= @Ex_Remark
else if (@access = 'L1TL' or @access = 'ITL1TL')
	set @L1_TLRemark= @Ex_Remark
else if (@access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access = 'L2TTL')
	set @L2_Remark= @Ex_Remark
else if (@access = 'L3EX' or @access = 'L3TL' or @access = 'ADM')
	set @L3_Remark= @Ex_Remark

if @pageidentifier=1
begin 
	if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
	begin
		set @Status_Code='ET'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if(@access = 'ITL1EX' or @access='ITL1TL') and (@type='technical' or @type='functional')
	begin
		set @Status_Code='L1E'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if(@access = 'L1EX' or @access='L1TL') and (@type='functional')
	begin
		set @Status_Code='EF'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

	else if @access = 'L2FEX' or @access = 'L2FTL' or @access = 'L2TEX' or @access='L2TTL'
	begin
		set @Status_Code='E3'
		Insert Into tbl_NewClient_Details Values('',@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code) 
		select @docket_number=max(convert(int,docket_number))  from tbl_NewClient_Details
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		select @docket_number
	end

select @docket_number
end

else 
Begin
	if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
	begin
		set @Status_Code='ET'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L1EX' or @access='L1TL') and (@type='functional')
	begin	
		set @Status_Code='EF'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L2TEX' or @access='L2TTL')
	begin
		set @Status_Code='E3'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108), 
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if (@access = 'L2FEX' or @access = 'L2FTL')
	begin
		set @status_code = 'E3'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
	else if(@access = 'ITL1EX' or @access='ITL1TL') and (@type='technical' or @type='functional')
	begin
		set @Status_Code='L1E'
		Insert into tbl_NewTaskDetails values('',@docket_number,@Client_Code,@Product_Code,@tagbranch,@Issue_Raised_Datetime,getdate(),CONVERT(VARCHAR,@Issue_Resolving_Time,108),@Call_From,@Call_Type,@Issue_Type,@Type,@Nature,@Problem,@Brief_Solution,'',@L1_EXRemark,@L1_TLRemark,@L2_Remark,@L3_Remark,@Issue_Resolved_By,@Team_Id,@Contact_Person,@Status_Code)
		update tbl_NewClient_Details set status_code=@Status_Code,
		Issue_Resolving_Time=CONVERT(VARCHAR,@Issue_Resolving_Time,108),
		L1_InitialRemark=@L1_EXRemark,L1_FinalRemark=@L1_TLRemark,L2_UserRemark=@L2_Remark,L3_UserRemark=@L3_Remark,Issue_resolved_by=@Issue_Resolved_By
		where docket_number = @docket_number
	end
End
------------------------------------------------------------------------------

--else
--begin 
--if (@access = 'L1EX' or @access='L1TL') and (@type='technical')
--begin
--set @Status_Code='ET'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code, L1_FinalRemark = @Ex_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if (@access = 'L1EX' or @access='L1TL') and (@type='functional')
--begin
--set @Status_Code='EF'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code,  L1_FinalRemark = @Ex_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--else if @access = 'L2TEX' or @access='L2TTL'
--begin
--set @Status_Code='E3'
--insert into tbl_NewTaskDetails values('',@docket_number,@Issue_Resolved_By,convert(datetime,@Issue_Raised_Datetime),convert(datetime,@Issue_Resolved_Datetime),@Status_Code,'')
--update tbl_NewClient_Details set status_code=@Status_Code,  L2_UserRemark = @Ex_Remark,Issue_resolved_by=@Issue_Resolved_By
--where docket_number = @docket_number
--end
--
--end
--

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillBranchCode
-- --------------------------------------------------


CREATE proc [dbo].[SPFillBranchCode]
as
Select distinct Branch_code from tbl_branch_master
--select Branch_code from branch_details

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillComboAssignP
-- --------------------------------------------------
CREATE procedure [dbo].[SPFillComboAssignP]
@TeamLead varchar(50),@l1 varchar(50)
as
declare @Role as varchar(5)
select @Role=Role_id from user_master where userid=@TeamLead

if upper(@Role)=upper('L1TL')
	begin
		select username 
		from user_master 
		where TeamLeader=@TeamLead  
	end
else
	begin
		select username 
		from user_master 
		where TeamLeader=@TeamLead  and userid <> @l1
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillComboAssignPDAjobs
-- --------------------------------------------------


CREATE procedure [dbo].[SPFillComboAssignPDAjobs]
@issueby varchar(50)
as
select um.username 
from User_Master um
where
TeamLeader=(Select TeamLeader from user_master where userid = @issueby)

--select username 
--from user_master 
--where TeamLeader=(Select TeamLeader from user_master where userid = @issueby )

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillComboMessage
-- --------------------------------------------------


CREATE procedure [dbo].[SPFillComboMessage]
@TeamLead varchar(50)
as
select username 
from user_master 
where TeamLeader=@TeamLead

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillComboRating
-- --------------------------------------------------

CREATE procedure [dbo].[SPFillComboRating]
@TeamLead varchar(50)
as
select username 
from user_master 
where TeamLeader=@TeamLead
and userid <> @Teamlead

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillComboReportExecutive
-- --------------------------------------------------
CREATE procedure [dbo].[SPFillComboReportExecutive]
@TeamLead varchar(50), @RoleID varchar(15)
as
if @RoleID='L1EX'
begin
select username from user_master where TeamLeader=@TeamLead
end
else if @RoleID='L2FEX'
begin
select username from user_master where TeamLeader=@TeamLead
end
else if @RoleID='L2TEX'
begin
select username from user_master where TeamLeader=@TeamLead
end
else if @RoleID='L3EX'
begin
select username from user_master where TeamLeader=@TeamLead
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillEmployee
-- --------------------------------------------------
CREATE proc SPFillEmployee
as
select userid from user_master

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillL1
-- --------------------------------------------------
create proc SPFillL1
as
select UserName from user_master where Role_Id = 'L1EX'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillLocation
-- --------------------------------------------------



CREATE proc [dbo].[SPFillLocation]
@USERID as varchar(8),
@access as varchar(10),
@issuetype as varchar(20)
as

If(UPPER(@IssueType)=UPPER('IT'))
Begin
	If(@USERID<>'' And (@access='ADM' And @access='ITL3TL' And @access='L3TL' ANd @access='ITL3EX' And @access='L3EX'))
		SELECT DISTINCT BRANCH_NAME FROM TBL_TEAMLEADERMASTER WHERE TEAMLEADER=@USERID and Branch_Name<>'Akruti' and (Branch_name<>'' or branch_name is Not NULL)
	else if(@access='ADM' or @access='ITL3TL' or @access='L3TL' or @access='ITL3EX' or @access='L3EX' )
		SELECT DISTINCT BRANCH_NAME FROM TBL_TEAMLEADERMASTER Where Branch_name<>'' or branch_name is Not NULL 
	else 
		SELECT DISTINCT BRANCH_NAME FROM TBL_TEAMLEADERMASTER WHERE TEAMLEADER=@USERID and (Branch_name<>'' or branch_name is Not NULL)
End
Else If(@issuetype <> '' and @issuetype is not null)
Begin
	If(@issuetype <> 'ALL')
	Begin
		Select distinct Branch_Name From tbl_ITBranchMaster Where CSO_Code = @issuetype
	End
	Else If(@issuetype = 'ALL')
	Begin
		Select distinct Branch_Name From tbl_ITBranchMaster 
	End
End
Else
Begin
	If(@USERID<>'' And (@access='ADM' And @access='ITL3TL' And @access='L3TL' ANd @access='ITL3EX' And @access='L3EX'))
		SELECT DISTINCT BRANCH_NAME FROM TBL_TEAMLEADERMASTER WHERE TEAMLEADER=@USERID and Branch_Name<>'Akruti' and (Branch_name<>'' or branch_name is Not NULL)
	else if(@access='ADM' or @access='ITL3TL' or @access='L3TL' or @access='ITL3EX' or @access='L3EX' )
		SELECT DISTINCT BRANCH_NAME FROM TBL_TEAMLEADERMASTER Where Branch_name<>'' or branch_name is Not NULL 
	else 
		SELECT DISTINCT BRANCH_NAME FROM TBL_TEAMLEADERMASTER WHERE TEAMLEADER=@USERID and (Branch_name<>'' or branch_name is Not NULL)
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillRole
-- --------------------------------------------------
CREATE proc SPFillRole
as
select role_name from role_master

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillTeam_Loc
-- --------------------------------------------------

CREATE PROC [dbo].[SPFillTeam_Loc]
@userid as varchar(10),
@access as varchar(10),
@issuetype as char(4)
AS
IF (@access='ADM' or @access='ITL3TL' or @access='L3TL')
BEGIN
	select team_name from team_master where team_id not in('Surveillance','S')
END
Else IF(@access='ITL1TL' or @access='ITL1TLBR' or @access='ITL2TLO' or @access='ITL2TLI' or @access='ITL2TLN' or @access='ITL2TLS' )
Begin
	Select Team_Name From Team_Master Where Team_ID in (Select Team_ID From User_Master Where UserID=@userid)
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillTeamID
-- --------------------------------------------------



CREATE proc [dbo].[SPFillTeamID]
@accesstype as varchar(10)
as
if @accesstype='EBro'
begin
	select team_name from team_master where team_id not like 'IT%' and team_id not in('Surveillance','S')
end
else if @accesstype='IT'
begin
	select team_name from team_master where team_id like 'IT%' and team_id not in('Surveillance','S')
end
else if (@accesstype='ADM' or @accesstype='ITL3EX' or @accesstype='ITL3TL' or @accesstype='L3TL' or @accesstype='L3EX')    
begin
	select team_name from team_master where team_id not in('Surveillance','S')
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillTeamID_New
-- --------------------------------------------------


CREATE proc [dbo].[SPFillTeamID_New]
@accesstype as varchar(5),
@type as varchar(4)
as
if @accesstype='EBro'
begin
	select team_name from team_master where team_id not like 'IT%' and team_id not in('Surveillance','S')
end
else if @accesstype='IT'
begin
	if(@type='ADM')
	select team_name from team_master where team_id in('A','ITL1','ITL2N','ITL2O','ITL2V','ITL1BR','ITL2I','ITL2S','ITL3')
	Else
	select team_name from team_master where team_id like 'IT%' and team_id not in('Surveillance','S')
end
else if @accesstype='ADM'
begin
	select team_name from team_master where team_id not in('Surveillance','S')
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillTL
-- --------------------------------------------------
create proc SPFillTL
as
select distinct username
from user_master
where teamleader=userid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPFillUserName
-- --------------------------------------------------
create proc SPFillUserName
as
select username from user_master

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGenerateDocket
-- --------------------------------------------------

CREATE proc [dbo].[SPGenerateDocket]
as
select max(docket_number)as docket_number from client_details

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetAllExecutive
-- --------------------------------------------------




CREATE proc [dbo].[SPGetAllExecutive]
@User_ID varchar(50),
@Role varchar(50),
@Team varchar(100),
@callType varchar(10)
as

if (@Role in ('L1TL','L2FTL','L2TTL','L3TL'))
begin
	select username,userid from user_master where teamLeader=@User_ID order by userName  
End      
if (@Role in ('ITL1TL','ITL2TLBR','ITL2TLI','ITL2TLS','ITL2TLN','ITL2TLO','ITL2TLV'))
begin
	select distinct um.username,um.userid from user_master um
	where Userid in (select employee_id from tbl_teamleadermaster where teamLeader=@User_Id) 
	order by userName
end
if (@Role in('ITL1EX','ITL1EXBR','ITL2EXN','ITL2EXI','ITL2EXS','ITL2EXO','ITL2EXV','L1EX','L2FEX','L2TEX','L3EX'))
begin
	select username,userid from user_master where userid=@User_ID 
	order by username
end
if (@Role in ('ADM','ITL3TL'))
begin
	if (@callType='EBro' and @Team<>'Administrator')
	begin
		If(@Team='ALL')
		select username,userid from user_master where team_id not like 'IT%' and team_id in (select team_id from team_master) order by username 
		Else
		select username,userid from user_master where team_id not like 'IT%' and team_id in (select team_id from team_master where team_name=@Team) order by username 
	end 
	if (@callType='IT' and @Team<>'Administrator')
	begin
		If(@Team='ALL')
		select username,userid from user_master where team_id like 'IT%' and team_id in (select team_id from team_master) order by username 
		Else
		select username,userid from user_master where team_id like 'IT%' and team_id in (select team_id from team_master where team_name=@Team) order by username 
	end 
	
	if(@Team='Administrator')
	Begin
		select username,userid from user_master where team_id=(select team_id from team_master where team_name=@Team) order by username 
	End
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetClientCode
-- --------------------------------------------------
create procedure [dbo].[SPGetClientCode]
@ClientCode varchar(15)
as select client_code from client_master 
where client_code=@ClientCode

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetClientExists
-- --------------------------------------------------

CREATE procedure [dbo].[SPGetClientExists]
@IssueRaisedDatetimeFrom varchar(100),
@IssueRaisedDatetimeTo varchar(100)
as
select c.refrence_number as 'Docket Number', c.long_name as 'Client Name',c.Landline1,c.Landline2,c.Office1,c.Office2,c.Mobile,c.Email,c.Branch,c.Region,c.Zone,c.IssueRaisedDateTime as 'Issue Raised DateTime',c.IssueResolvedDateTime as 'Issue Resolved DateTime',c.Product,c.Type as 'Type',c.Nature,c.Problem,c.Brief_solution as 'Brief Solution',c.Solution,u.username as 'Issue Resolved By',c.ex_remark as 'Executive Remark'
from clientexists c join user_master u
on c.issue_resolvedby = u.userid 
where 
c.issueraiseddatetime between convert(varchar(100),cast(@IssueRaisedDatetimeFrom as datetime)) and convert(varchar(100),cast(dateadd(day,1,@IssueRaisedDatetimeTo) as datetime))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetDayReminder
-- --------------------------------------------------
create proc SPGetDayReminder
@UserName varchar(50)
as
select * from sent_messages
where sent_to = @UserName and message_status = 1
and mess_valid_from <= getdate() and mess_valid_to >= getdate()

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetID
-- --------------------------------------------------
CREATE proc [dbo].[SPGetID]
@name varchar(50)
as
select username from user_master
where userid=@name

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetManagerdetails
-- --------------------------------------------------
CREATE Proc [dbo].[SPGetManagerdetails]
@Client_Code char(20)
as
select MIP as[Local IP],GlobalIP AS[Global IP1],GlobalIP1 AS[Global IP2],GlobalIP2 as [Global IP3],GlobalIP3 as [Global IP4] from manager_details where manager_code in
(select manager_code from client_master
where client_code=@Client_Code)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetname
-- --------------------------------------------------

CREATE proc [dbo].[SPGetname]
@username char(100)
as
select userid from user_master
where UPPER(username) =UPPER(@username)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetProductName
-- --------------------------------------------------

CREATE proc [dbo].[SPGetProductName]
@callType as varchar(5)
as
if(@callType='EBro')
	select distinct Product_Name from vendor_product where product_name <>'Odin Client'
if(@callType='IT')
	Select Distinct Product_Name From tbl_IT_ProductMaster

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetReport
-- --------------------------------------------------
CREATE proc SPGetReport
@DocketNo Varchar(15) = null,
@ClientCode Varchar(15)= null,
@BranchCode Varchar(30) = null,
@Status Varchar(60) = null,
@ProductName Varchar(30) = null,
@ExecutiveName Varchar(60) = null
as
begin
select t.docket_number as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',
v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',
j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j,vendor_product v,task_details t
where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code and t.docket_number=d.docket_number)
and (m.Branch_code=@BranchCode and d.client_code=@ClientCode and t.docket_number=@DocketNo and u.username=@ExecutiveName and v.Product_name=@ProductName and j.jobstatus_name=@Status)
and (t.docket_number like isnull(@DocketNo,t.docket_number) + '%') 
and (d.Client_code like isnull(@ClientCode,d.Client_code) + '%') 
and (m.branch_code like isnull(@BranchCode,m.branch_code) + '%') 
and (j.jobstatus_name like isnull(@Status,j.jobstatus_name) + '%') 
and (v.product_name like isnull(@ProductName,v.product_name) + '%') 
and (u.UserName like isnull(@ExecutiveName,u.UserName) + '%') 
order by  t.docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetReportData
-- --------------------------------------------------



CREATE proc [dbo].[SPGetReportData]

@docket_number varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@team_name varchar(50),
@callType varchar(5)
as

declare @query varchar(MAX)
set @query =''
if(@callType='EBro')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],m.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newclient_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end
	else
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],m.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newclient_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end		
end
if(@callType='IT')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_odinid and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
	end
	else
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_odinid and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
	end		
	
end
	
if @query <> ''
begin
	if @docket_number<>''
	begin
		set @query=@query+ 'and d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
	end
	if @client_code<>''
	begin
		set @query=@query+ 'and d.client_code='''+@client_code+ '''' 
	end
	if @branch_code<>''
	begin
		set @query=@query+ 'and bm.branch_code='''+@branch_code+ '''' 
	end
	if @status_code<>''
	begin
		set @query=@query+ 'and j.jobstatus_name='''+@status_code+ '''' 
		if @status_code in ('Escalated to L2 Odin','Escalated to L2 Network','Escalated to L2 VSAT' )
		begin
			set @issue_resolved_by=''
		end
	end
	if @product_code<>''
	begin
		set @query=@query+ 'and v.product_name='''+@product_code+ '''' 
	end
	if @team_name<>'ALL'
	begin
		set @query=@query+ 'and tm.team_name='''+@team_name+ '''' 
	end
	if @issue_resolved_by<>'ALL'
	begin
		set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
	end
	if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
	begin
		--set @query=@query+ 'and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		set @query=@query+ 'and d.Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
	end

	set @query=@query+ ' ) as temp order by temp.Docket_Number desc'
	exec (@query)
end
print @query


--///////
--if(@status_code='User Pending')
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end
--	else
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetReportData_Latest
-- --------------------------------------------------

CREATE proc [dbo].[SPGetReportData_Latest]

@docket_number varchar(10),
@uid varchar(10),
@access varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@location varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@team_id varchar(50),
@source varchar(5),
@callType varchar(5)
as

---------------------------------- Ebroking -------------------------------
IF( (@access='L1EX' or @access='L1TL') and @team_id='-Select Team-' )
BEGIN
	SET @team_id='L1'
END
ELSE IF( (@access='L2FEX' or @access='L2FTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2F'
END
ELSE IF( (@access='L2TEX' or @access='L2TTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2T'
END
ELSE IF( (@access='L3EX' or @access='L3TL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L3'
END
--------------------------------ADM-EBroking--------------------------------------
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='L1 Team'))
begin
	set @team_id='L1'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Fuctional Team'))
begin
	set @team_id='L2F'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Technical Team'))
begin
	set @team_id='L2T'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 3 Team'))
begin
	set @team_id='L3'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Administrator'))
begin
	set @team_id='A'
end


------------------------------------ IT ----------------------------------
if( (@access ='ITL1EX' or @access ='ITL1TL')  and @team_id='-Select Team-')
begin
	set @team_id='ITL1'
end
else if((@access ='ITL2EXO' or @access ='ITL2TLO')and @team_id='-Select Team-')
begin
	set @team_id='ITL2O'
end 
else if((@access ='ITL2EXN' or @access ='ITL2TLN') and @team_id='-Select Team-')
begin
	set @team_id='ITL2N'
end 
else if((@access ='ITL2EXV' or @access ='ITL2TLV') and @team_id='-Select Team-')
begin
	set @team_id='ITL2V'
end
else if((@access ='ITL3TL' or @access='ITL3EX') and @team_id='-Select Team-')
begin
	set @team_id='ITL3'
end
--------------------------------ADM-IT--------------------------------------
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT L1 Team'))
begin
	set @team_id='ITL1'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Technical Support Network Team'))
begin
	set @team_id='ITL2N'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support Odin Team'))
begin
	set @team_id='ITL2O'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support VSAT Team'))
begin
	set @team_id='ITL2V'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT Level 3 Team'))
begin
	set @team_id='ITL3'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Administrator'))
begin
	set @team_id='A'
end





declare @query varchar(MAX)
set @query =''
if(@callType='EBro')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id 
						and (d.product_code=v.product_code or d.product_code=v.product_name) and 
						u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end
	Else If(@docket_number<>'')
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code], d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name], d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],	Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from client_master m with (nolock),tbl_newtaskdetails d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id 
						and (d.product_code=v.product_code or d.product_code=v.product_name) and 
						u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	End
	Else If(@Location<>''  and (@access='ADM' or @access='ITL3TL' or @access='L3TL'))
	Begin
		IF(@Team_id='ALL' and @issue_resolved_by='ALL')
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		ELSE IF (@issue_resolved_by='ALL')
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					 where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		ELSE 
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
	End
	Else if ((@access='ADM' or @access='ITL3TL' or @access='L3TL') and @team_id='A' and @Location='')
		Begin
			IF(@Team_id='ALL' and @issue_resolved_by='ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m  with (nolock),tbl_newclient_details d  with (nolock), user_master u  with (nolock), 
							jobstatusmaster j  with (nolock),vendor_product v  with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master) and d.Issue_Type=''EBro'''
			Else IF(@issue_resolved_by='ALL' and @Team_id<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' ) and d.Issue_Type=''EBro'''
			Else
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
							 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''') and d.Issue_Type=''EBro'''
		End
	else
	begin
		If((@access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='ITL1TL' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV') and @issue_resolved_by<>'')
		Begin
			if(@location='' and @issue_resolved_by='ALL')
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''EBro'''
			Else if(@location='' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''EBro'''
			Else if(@location<>'' and @issue_resolved_by='ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''EBro'''
			Else if (@location<>'' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		End
		Else
		Begin
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
		End
	end		
end
if(@callType='IT')
begin
	If(@status_code='User Pending')
	Begin
		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag], cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@docket_number<>'')
	Begin
		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newtaskdetails d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newtaskdetails d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@Location<>'' and (@access='ADM' or @access='ITL3TL' or @access='L3TL'))
	Begin
		IF(@Team_id='ALL' and @issue_resolved_by='ALL')
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d  with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE IF(@issue_resolved_by='ALL')
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
	End
	Else if ((@access='ADM' or @access='ITL3TL' or @access='L3TL') and @Location='')
		Begin
			IF(@Team_id='ALL' and @issue_resolved_by='ALL')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master )and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master )and d.Issue_Type=''IT'''
			Else IF(@issue_resolved_by='ALL' and @Team_id<>'ALL')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' )and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' )and d.Issue_Type=''IT'''
			Else
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
		End
	Else
	Begin
		If((@access='ITL1TL' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV' or @access='L1TL' or @access='L2FTL' or @access='L2TTL' ) and @issue_resolved_by<>'')
		Begin
			if(@location='' and @issue_resolved_by='ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''IT'''
			Else if(@location='' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u,jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''IT'''
			Else if(@location<>'' and @issue_resolved_by='ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''IT'''
			Else if (@location<>'' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''IT'''
		End
		Else
		Begin
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
		End
	End		
	
end
	
if @query <> ''
begin
	if @docket_number<>''
	begin
		set @query=@query+ 'and d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
	end

	If(@callType='EBro')
	Begin
		if @client_code<>''
		begin
			set @query=@query+ 'and d.client_code='''+@client_code+ '''' 
		end
	End
	Else If(@callType='IT')
	Begin
		if @client_code<>''
		begin
			set @query=@query+ 'and d.SBTAG='''+@client_code+ '''' 
		end
	End

	if @branch_code<>''
	begin
		set @query=@query+ 'and d.tagbranch='''+@branch_code+ '''' 
	end
	if @source<>''
	Begin
		if(@access='ADM' or @access='ITL3TL' or @access='L3TL' or @access='ITL3EX' or @access='L3EX' or @access='ITL1TL' or @access='L1TL' or @access='ITL1EX' or @access='L1EX' )
		set @query=@query+ 'and d.source='''+@source+ '''' 
	End
	if @status_code<>''
	begin
		set @query=@query+ 'and j.jobstatus_name='''+@status_code+ '''' 
		if @status_code in ('Escalated to L2 Odin','Escalated to L2 Network','Escalated to L2 VSAT' )
		begin
			set @issue_resolved_by=''
		end
	end
	if @product_code<>''
	begin
		set @query=@query+ 'and v.product_name='''+@product_code+ '''' 
	end
	if @team_id<>'ALL'
	begin
		set @query=@query+ 'and u.team_id='''+@team_id+ '''' 
	end

	if @issue_resolved_by<>'ALL'
	begin
		set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
	end

	
--	if(@access='ADM' or @access='ITL3TL' or @access='L3TL')
--	Begin
--			if(charindex('ALL',@issue_resolved_by)<0)
--				set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
--	End
--	Else if((@access<>'ADM' or @access<>'ITL3TL' or @access<>'L3TL') and (charindex('EX',@access)>0))
--	Begin	
--		if((charindex('ALL',@issue_resolved_by)<0) or @issue_resolved_by<>'')  --@issue_resolved_by!='ALL'
--		begin
--				set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
--		end
--	End

	if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
	begin
		--set @query=@query+ 'and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		--set @query=@query+ 'and d.Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		set @query=@query+ 'and d.Issue_Raised_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
	end

	set @query=@query+ ' ) as temp order by temp.Docket_Number desc'

	print @query

	Exec (@query)
end



--///////
--if(@status_code='User Pending')
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end
--	else
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetReportData_Latest_OLD
-- --------------------------------------------------












Create proc [dbo].[SPGetReportData_Latest_OLD]

@docket_number varchar(10),
@uid varchar(10),
@access varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@location varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@team_id varchar(50),
@source varchar(5),
@callType varchar(5)
as

---------------------------------- Ebroking -------------------------------
IF( (@access='L1EX' or @access='L1TL') and @team_id='-Select Team-' )
BEGIN
	SET @team_id='L1'
END
ELSE IF( (@access='L2FEX' or @access='L2FTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2F'
END
ELSE IF( (@access='L2TEX' or @access='L2TTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2T'
END
ELSE IF( (@access='L3EX' or @access='L3TL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L3'
END
--------------------------------ADM-EBroking--------------------------------------
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='L1 Team'))
begin
	set @team_id='L1'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Fuctional Team'))
begin
	set @team_id='L2F'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Technical Team'))
begin
	set @team_id='L2T'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 3 Team'))
begin
	set @team_id='L3'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Administrator'))
begin
	set @team_id='A'
end


------------------------------------ IT ----------------------------------
if( (@access ='ITL1EX' or @access ='ITL1TL')  and @team_id='-Select Team-')
begin
	set @team_id='ITL1'
end
else if((@access ='ITL2EXO' or @access ='ITL2TLO')and @team_id='-Select Team-')
begin
	set @team_id='ITL2O'
end 
else if((@access ='ITL2EXN' or @access ='ITL2TLN') and @team_id='-Select Team-')
begin
	set @team_id='ITL2N'
end 
else if((@access ='ITL2EXV' or @access ='ITL2TLV') and @team_id='-Select Team-')
begin
	set @team_id='ITL2V'
end
else if((@access ='ITL3TL' or @access='ITL3EX') and @team_id='-Select Team-')
begin
	set @team_id='ITL3'
end
--------------------------------ADM-IT--------------------------------------
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT L1 Team'))
begin
	set @team_id='ITL1'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Technical Support Network Team'))
begin
	set @team_id='ITL2N'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support Odin Team'))
begin
	set @team_id='ITL2O'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support VSAT Team'))
begin
	set @team_id='ITL2V'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT Level 3 Team'))
begin
	set @team_id='ITL3'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Administrator'))
begin
	set @team_id='A'
end





declare @query varchar(MAX)
set @query =''
if(@callType='EBro')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master uwith (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id 
						and (d.product_code=v.product_code or d.product_code=v.product_name) and 
						u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end
	Else If(@docket_number<>'')
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code], d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name], d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],	Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from client_master m with (nolock),tbl_newtaskdetails d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id 
						and (d.product_code=v.product_code or d.product_code=v.product_name) and 
						u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	End
	Else If(@Location<>''  and (@access='ADM' or @access='ITL3TL' or @access='L3TL'))
	Begin
		IF(@Team_id='ALL' and @issue_resolved_by='ALL')
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		ELSE IF (@issue_resolved_by='ALL')
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					 where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		ELSE 
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
	End
	Else if ((@access='ADM' or @access='ITL3TL' or @access='L3TL') and @team_id='A' and @Location='')
		Begin
			IF(@Team_id='ALL' and @issue_resolved_by='ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m  with (nolock),tbl_newclient_details d  with (nolock), user_master u  with (nolock), 
							jobstatusmaster j  with (nolock),vendor_product v  with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master) and d.Issue_Type=''EBro'''
			Else IF(@issue_resolved_by='ALL' and @Team_id<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' ) and d.Issue_Type=''EBro'''
			Else
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
							 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''') and d.Issue_Type=''EBro'''
		End
	else
	begin
		If((@access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='ITL1TL' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV') and @issue_resolved_by<>'')
		Begin
			if(@location='' and @issue_resolved_by='ALL')
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''EBro'''
			Else if(@location='' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''EBro'''
			Else if(@location<>'' and @issue_resolved_by='ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''EBro'''
			Else if (@location<>'' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		End
		Else
		Begin
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
		End
	end		
end
if(@callType='IT')
begin
	If(@status_code='User Pending')
	Begin
		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag], cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@docket_number<>'')
	Begin
		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newtaskdetails d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newtaskdetails d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@Location<>'' and (@access='ADM' or @access='ITL3TL' or @access='L3TL'))
	Begin
		IF(@Team_id='ALL' and @issue_resolved_by='ALL')
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d  with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE IF(@issue_resolved_by='ALL')
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
	End
	Else if ((@access='ADM' or @access='ITL3TL' or @access='L3TL') and @Location='')
		Begin
			IF(@Team_id='ALL' and @issue_resolved_by='ALL')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master )and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master )and d.Issue_Type=''IT'''
			Else IF(@issue_resolved_by='ALL' and @Team_id<>'ALL')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' )and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' )and d.Issue_Type=''IT'''
			Else
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
		End
	Else
	Begin
		If((@access='ITL1TL' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLV' or @access='L1TL' or @access='L2FTL' or @access='L2TTL' ) and @issue_resolved_by<>'')
		Begin
			if(@location='' and @issue_resolved_by='ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''IT'''
			Else if(@location='' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u,jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''IT'''
			Else if(@location<>'' and @issue_resolved_by='ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''IT'''
			Else if (@location<>'' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
					jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''IT'''
		End
		Else
		Begin
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
		End
	End		
	
end
	
if @query <> ''
begin
	if @docket_number<>''
	begin
		set @query=@query+ 'and d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
	end

	If(@callType='EBro')
	Begin
		if @client_code<>''
		begin
			set @query=@query+ 'and d.client_code='''+@client_code+ '''' 
		end
	End
	Else If(@callType='IT')
	Begin
		if @client_code<>''
		begin
			set @query=@query+ 'and d.SBTAG='''+@client_code+ '''' 
		end
	End

	if @branch_code<>''
	begin
		set @query=@query+ 'and d.tagbranch='''+@branch_code+ '''' 
	end
	if @source<>''
	Begin
		if(@access='ADM' or @access='ITL3TL' or @access='L3TL' or @access='ITL3EX' or @access='L3EX' or @access='ITL1TL' or @access='L1TL' or @access='ITL1EX' or @access='L1EX' )
		set @query=@query+ 'and d.source='''+@source+ '''' 
	End
	if @status_code<>''
	begin
		set @query=@query+ 'and j.jobstatus_name='''+@status_code+ '''' 
		if @status_code in ('Escalated to L2 Odin','Escalated to L2 Network','Escalated to L2 VSAT' )
		begin
			set @issue_resolved_by=''
		end
	end
	if @product_code<>''
	begin
		set @query=@query+ 'and v.product_name='''+@product_code+ '''' 
	end
	if @team_id<>'ALL'
	begin
		set @query=@query+ 'and u.team_id='''+@team_id+ '''' 
	end
	
	if(@access='ADM' or @access='ITL3TL' or @access='L3TL')
	Begin
			if(charindex('ALL',@issue_resolved_by)<0)
				set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
	End
	Else if((@access<>'ADM' or @access<>'ITL3TL' or @access<>'L3TL') and (charindex('EX',@access)>0))
	Begin	
		if((charindex('ALL',@issue_resolved_by)<0) or @issue_resolved_by<>'')  --@issue_resolved_by!='ALL'
		begin
				set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
		end
	End

	if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
	begin
		--set @query=@query+ 'and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		--set @query=@query+ 'and d.Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		set @query=@query+ 'and d.Issue_Raised_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
	end

	set @query=@query+ ' ) as temp order by temp.Docket_Number desc'
	exec (@query)
end
print @query


--///////
--if(@status_code='User Pending')
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end
--	else
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetReportData_New
-- --------------------------------------------------







CREATE proc [dbo].[SPGetReportData_New]

@docket_number varchar(10),
@access varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@location varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@team_id varchar(50),
@callType varchar(5)
as

---------------------------------- Ebroking -------------------------------
IF( (@access='L1EX' or @access='L1TL') and @team_id='-Select Team-' )
BEGIN
	SET @team_id='L1'
END
ELSE IF( (@access='L2FEX' or @access='L2FTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2F'
END
ELSE IF( (@access='L2TEX' or @access='L2TTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2T'
END
ELSE IF( (@access='L3EX' or @access='L3TL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L3'
END
--------------------------------ADM-EBroking--------------------------------------
else if(@access ='ADM' and (@team_id='L1 Team'))
begin
	set @team_id='L1'
end
else if(@access ='ADM' and (@team_id='Level2 Fuctional Team'))
begin
	set @team_id='L2F'
end
else if(@access ='ADM' and (@team_id='Level2 Technical Team'))
begin
	set @team_id='L2T'
end 
else if(@access ='ADM' and (@team_id='Level 3 Team'))
begin
	set @team_id='L3'
end

------------------------------------ IT ----------------------------------
if( (@access ='ITL1EX' or @access ='ITL1TL')  and @team_id='-Select Team-')
begin
	set @team_id='ITL1'
end
else if((@access ='ITL2EXO' or @access ='ITL2TLO')and @team_id='-Select Team-')
begin
	set @team_id='ITL2O'
end 
else if((@access ='ITL2EXN' or @access ='ITL2TLN') and @team_id='-Select Team-')
begin
	set @team_id='ITL2N'
end 
else if((@access ='ITL2EXV' or @access ='ITL2TLV') and @team_id='-Select Team-')
begin
	set @team_id='ITL2V'
end
else if((@access ='ITL3TL' or @access='ITL3EX') and @team_id='-Select Team-')
begin
	set @team_id='ITL3'
end
--------------------------------ADM-IT--------------------------------------
else if(@access ='ADM' and (@team_id='IT L1 Team'))
begin
	set @team_id='ITL1'
end
else if(@access ='ADM' and (@team_id='Level2 Technical Support Network Team'))
begin
	set @team_id='ITL2N'
end
else if(@access ='ADM' and (@team_id='Level 2 Technical Support Odin Team'))
begin
	set @team_id='ITL2O'
end 
else if(@access ='ADM' and (@team_id='Level 2 Technical Support VSAT Team'))
begin
	set @team_id='ITL2V'
end 
else if(@access ='ADM' and (@team_id='IT Level 3 Team'))
begin
	set @team_id='ITL3'
end




declare @query varchar(MAX)
set @query =''
if(@callType='EBro')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newclient_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end
	Else If(@docket_number<>'')
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newtaskdetails d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	End
	else
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newclient_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end		
end
if(@callType='IT')
begin
	If(@status_code='User Pending')
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@docket_number<>'')
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newtaskdetails d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@Location<>'')
	Begin
		IF(@Team_id='ALL')
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''

		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
	End
	Else
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End		
	
end
	
if @query <> ''
begin
	if @docket_number<>''
	begin
		set @query=@query+ 'and d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
	end
	if @client_code<>''
	begin
		set @query=@query+ 'and d.client_code='''+@client_code+ '''' 
	end
	if @branch_code<>''
	begin
		set @query=@query+ 'and d.tagbranch='''+@branch_code+ '''' 
	end
	if @status_code<>''
	begin
		set @query=@query+ 'and j.jobstatus_name='''+@status_code+ '''' 
		if @status_code in ('Escalated to L2 Odin','Escalated to L2 Network','Escalated to L2 VSAT' )
		begin
			set @issue_resolved_by=''
		end
	end
	if @product_code<>''
	begin
		set @query=@query+ 'and v.product_name='''+@product_code+ '''' 
	end
	if @team_id<>'ALL'
	begin
		set @query=@query+ 'and u.team_id='''+@team_id+ '''' 
	end
	
	if charindex('ALL',@issue_resolved_by)<0	 	--@issue_resolved_by<>'ALL'
	begin
		set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
	end
	if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
	begin
		--set @query=@query+ 'and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		set @query=@query+ 'and d.Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
	end

	set @query=@query+ ' ) as temp order by temp.Docket_Number desc'
	exec (@query)
end
print @query


--///////
--if(@status_code='User Pending')
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end
--	else
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetReportData_old
-- --------------------------------------------------







CREATE proc [dbo].[SPGetReportData_old]

@docket_number varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@team_name varchar(50),
@callType varchar(5)
as

declare @query varchar(MAX)
set @query =''
if(@callType='EBro')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],m.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newclient_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end
	else
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],m.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from client_master m,tbl_newclient_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end		
end
if(@callType='IT')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
	end
	else
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
	end		
	
end
	
if @query <> ''
begin
	if @docket_number<>''
	begin
		set @query=@query+ 'and d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
	end
	if @client_code<>''
	begin
		set @query=@query+ 'and d.client_code='''+@client_code+ '''' 
	end
	if @branch_code<>''
	begin
		set @query=@query+ 'and bm.branch_code='''+@branch_code+ '''' 
	end
	if @status_code<>''
	begin
		set @query=@query+ 'and j.jobstatus_name='''+@status_code+ '''' 
		if @status_code in ('Escalated to L2 Odin','Escalated to L2 Network','Escalated to L2 VSAT' )
		begin
			set @issue_resolved_by=''
		end
	end
	if @product_code<>''
	begin
		set @query=@query+ 'and v.product_name='''+@product_code+ '''' 
	end
	if @team_name<>'ALL'
	begin
		set @query=@query+ 'and tm.team_name='''+@team_name+ '''' 
	end
	if @issue_resolved_by<>'ALL'
	begin
		set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
	end
	if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
	begin
		--set @query=@query+ 'and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		set @query=@query+ 'and d.Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
	end

	set @query=@query+ ' ) as temp order by temp.Docket_Number desc'
	exec (@query)
end
print @query


--///////
--if(@status_code='User Pending')
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end
--	else
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetStatus
-- --------------------------------------------------



CREATE proc [dbo].[SPGetStatus]
@access as varchar(10),
@callType as varchar(5)

as
if(@callType='EBro')
begin
	if(@access in ('L1EX','L1TL','ITL1EX','ITL1TL','ITL1EXBR','ITL1TLBR'))	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','Escalated to Level 3') 
		and	jobstatus_id not like 'IT%' order by jobstatus_name
	end 
	if(@access in ('L3TL','L3EX'))	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','PDA Jobs') and jobstatus_name not in(select jobstatus_name from jobstatusmaster where jobstatus_name like 'Escalated to %')
		and	jobstatus_id not like 'IT%' order by jobstatus_name
	end 
	else if(@access in ('L2FEX','L2FTL','L2TEX','L2TTL','L1EX','L1TL'))	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','Escalated to L1 Team','PDA Jobs') and jobstatus_name not in(select jobstatus_name from jobstatusmaster where jobstatus_name like 'Escalated to L2 %')
		and	jobstatus_id not like 'IT%' order by jobstatus_name
	end
	else if(@access in ('ADM','M','ITL3TL','ITL3EX'))	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back')	and	jobstatus_id not like 'IT%' order by jobstatus_name
	end
end
if(@callType='IT')
begin
	if(@access in ('L1EX','L1TL','ITL1EX','ITL1TL','ITL1EXBR','ITL1TLBR'))	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','Escalated to L3','PDA Jobs','Re-Assigned Level 3') 
		and	jobstatus_id like 'IT%' order by jobstatus_name
	end 
	else if (@access ='ITL2EXO' or @access = 'ITL2TLO')
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','Reassigned','Re-Assigned Level 3','Escalated to IT L1 Team','Re-Assigned Level1','Escalated to L2 Network2','Escalated to L2 Network','Re-Assigned L2 Network','Escalated to L2 VSAT','Re-Assigned L2 VSAT','PDA Jobs')
		and	jobstatus_id like 'IT%' order by jobstatus_name
	end
	else if	(@access ='ITL2EXN' or @access = 'ITL2TLN')	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','Reassigned','Re-Assigned Level 3','Escalated to IT L1 Team','Re-Assigned Level1','Escalated to L2 Network2','Escalated to L2 Odin','Re-Assigned L2 Odin','Escalated to L2 VSAT','Re-Assigned L2 VSAT','PDA Jobs')
		and	jobstatus_id like 'IT%' order by jobstatus_name
	end
	else if	(@access ='ITL2EXV' or @access = 'ITL2TLV')		
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','Reassigned','Re-Assigned Level 3','Escalated to IT L1 Team','Escalated to IT L1 Team','Re-Assigned Level1','Escalated to L2 Network2','Escalated to L2 Odin','Re-Assigned L2 Odin','Escalated to L2 Network','Re-Assigned L2 Network','PDA Jobs') 
		and	jobstatus_id like 'IT%' order by jobstatus_name
	end
	else if(@access ='ITL3TL')	
	begin
		select rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Locked','PDA Jobs') and jobstatus_name not in(select jobstatus_name from jobstatusmaster where jobstatus_name like 'Escalated to %')
		and	jobstatus_id like 'IT%' order by jobstatus_name
	end
	else if(@access in ('ADM','M'))	
	begin
		select  rtrim(jobstatus_name) as status	from jobstatusmaster 
		where jobstatus_name not in('new','call back','Escalated to L2 Network2')	and	jobstatus_id like 'IT%' order by jobstatus_name
	end
	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetUserDetails
-- --------------------------------------------------
CREATE proc SPGetUserDetails
@Userid varchar(15)
--@TeamLead varchar(15)
as
select u.Userid,u.username,u.dob,t.team_name,r.role_name,
(select username from user_master
where userid=(select teamleader from user_master where userid=@userid)) as 'Team Leader',u.branch_id,u.contact_number,u.mobile,u.email,u.creation_date,u.account_status,u.login_status
from user_master u,team_master t,role_master r
where userid=@Userid and u.team_id = t.team_id 
and u.role_id= r.role_id --and u.userid = u.teamleader

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPInsertMessage
-- --------------------------------------------------



CREATE procedure [dbo].[SPInsertMessage]
@SentBy varchar(50),@Employee varchar(50),@DateIn datetime,@ValidFrom datetime,@ValidTo datetime,@message text,@critical char(15),@Status bit
as 
insert into sent_messages values (@SentBy,@Employee,@DateIn,@ValidFrom,@ValidTo,@message,@critical,@Status)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPInsertNewClient
-- --------------------------------------------------


CREATE proc [dbo].[SPInsertNewClient]
@Refrence_Number varchar(8),
@longname  varchar(150),
@landline1  varchar(10),
@landline2  varchar(10),
@office1 varchar(100),
@office2  varchar(100),
@mobile varchar(15),
@email varchar(150),
@City varchar(100),
@address varchar(250),
@branch  varchar(100),
@subbroker varchar(100),
@region  varchar(100),
@zone  varchar(100),
@issueraised varchar(22),
@issueresolved varchar(22),
@product_code varchar(50),
@type varchar(100),
@Nature varchar(100),
@problem varchar(250),
@briefsolution varchar(300),
@solution varchar(1000),
@issueresolvedby varchar(20),
@exremark  varchar(200)
as
insert into clientexists values (@Refrence_Number,@longname,@landline1,@landline2,@office1,@office2,@mobile,@email,@City,@address,@branch,@subbroker,@region,@zone,convert(datetime,@issueraised),convert(datetime,@issueresolved),
@product_code,@type,@Nature,@problem,@briefsolution,@solution,@issueresolvedby,@exremark)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPInsertRating
-- --------------------------------------------------
CREATE procedure [dbo].[SPInsertRating]
@UserID varchar(10),
@Date datetime,
@Communication varchar(2),
@Product varchar(2),
@Interpersonal varchar(2),
@CallConduct varchar(2),
@Total varchar(3),
@EmployeeName varchar(100)
as
set @UserID = (Select userid from user_master where (username=@EmployeeName))
--elect @userID 
insert into executive_rating values(@UserID,@Date,@Communication,@Product,@Interpersonal,@CallConduct,@Total)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPInsertUser
-- --------------------------------------------------

CREATE proc [dbo].[SPInsertUser]
@userid varchar(15),
@username varchar(120),
@dob datetime,
@teamname varchar(100),
@rolename varchar(100),
@teamlead varchar(100),
@Branch varchar(15),
@Contact varchar(15),
@Mobile varchar(15),
@Email varchar(120),
@createDate datetime,
@AcctStatus varchar(15),
@LoginStatus bit
as
set @teamname =( select team_id from team_master where team_name=@TeamName)
set @rolename = (select role_id from role_master where role_name=@rolename)
set @TeamLead = (select userid from user_master where username=@TeamLead)
insert into user_master
values(@userid,@username,@dob,@teamname,@rolename,@TeamLead,@Branch,@Contact,@Mobile,@Email,'',@createDate,@AcctStatus,@LoginStatus,'')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPIssueDetails_AKRUTI
-- --------------------------------------------------

CREATE proc [dbo].[SPIssueDetails_AKRUTI]
as

SELECT [Docket_Number] as [Ticket Number], [Branch_Code] as [Branch Code], [Product] as [Product Code], [Issue_Raised_DateTime] as [Issue Raised DateTime], [Issue_Resolved_Datetime] as [Issue Resolved Datetime], [Type], [Nature], [Problem], j.jobstatus_name as [status Code] , u.username as [Issue Resolved By],datediff(hour,issue_raised_datetime,getdate()) as hours
FROM IssueDetails_AKRUTI d,jobstatusmaster j,user_master u
where j.jobstatus_id=d.status_code and u.userid = d.Issue_Resolved_By and client_remark='Akruti'
order by Issue_Resolved_Datetime

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spIssueSummary_AKRUTI
-- --------------------------------------------------
CREATE proc [dbo].[spIssueSummary_AKRUTI]
as
select u.username as Resource,count(status_code) as [No of Issues],j.jobstatus_Name as [Status]
from issuedetails_AKRUTI d,user_master u,jobstatusMaster j
where u.userid=d.issue_resolved_by and d.status_code=j.jobstatus_id
group by j.jobstatus_Name,u.username

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_currentmonth
-- --------------------------------------------------










CREATE proc [dbo].[SPlevelsummary_currentmonth]
@TL varchar(20),
@access varchar(15), 
@query varchar(500)

as
-------------------------------------------------------------
--Auther		:Sanjay Lavu Kudtarkar
--Comment		:Do not dare to alter this Stored Procedure
--Copy Right	:Mastermind Developers Pvt. Ltd. 2008(c)
-------------------------------------------------------------
declare @checkid1 int,@checkid2 int,@checkid3 int
declare @viewquery varchar(1000)

if @access='L1TL' or @access='L2TTL'  ---@TL='L1T' or @TL='L2TT'
begin
set @query='alter view view_completed_currentmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and datename(month,issue_raised_datetime)=datename(month,getdate()) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_currentmonth

set @query='alter view view_escalated_currentmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code=''ET'' or status_code=''EF'' or status_code=''E3'') and datename(month,issue_raised_datetime)=datename(month,getdate()) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_currentmonth

set @query='alter view view_performancepoint_currentmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,getdate()) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_currentmonth

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_performancepoint_currentmonth.emp_id
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end 
end
else if @access='L2FTL' or @access='L3TL' 
begin
set @query='alter view view_completed_currentmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and datename(month,issue_raised_datetime)=datename(month,getdate()) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_currentmonth

set @query='alter view view_performancepoint_currentmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,getdate()) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid2=count(emp_id) from view_performancepoint_currentmonth

--set @viewquery=
--'alter view view_currentmonth as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,executive_rating.total as PerformancePoint from view_completed_currentmonth --left join view_escalated_currentmonth on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
--join user_master on view_completed_currentmonth.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_completed_currentmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if @checkid1 > @checkid2
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed'--select @viewquery
exec (@viewquery)
end
else if @checkid2 > @checkid1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed'--select @viewquery
exec (@viewquery)
end
end
else 

begin
set @query='alter view view_completed_currentmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and  datename(month,issue_raised_datetime)=datename(month,getdate())
group by issue_resolved_by'
exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_currentmonth

set @query='alter view view_escalated_currentmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code=''ET'' or status_code=''EF'' or status_code=''E3'') and  datename(month,issue_raised_datetime)=datename(month,getdate()) group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_currentmonth


set @query='alter view view_performancepoint_currentmonth
as
select emp_id,sum(total) as Total from executive_rating
where  datename(month,date)=datename(month,getdate())
group by emp_id'--,date,total'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_currentmonth

--if @checkid1 > 0 or @checkid2 < 1
--begin
--if @checkid1 > @checkid2
--begin
--set @viewquery=
--'alter view view_currentmonth as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_currentmonth left join view_escalated_currentmonth on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
--left join user_master on view_completed_currentmonth.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_completed_currentmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--else if @checkid2 > @checkid1
--begin
--set @viewquery=
--'alter view view_currentmonth as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_currentmonth right join view_escalated_currentmonth on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
--left join user_master on view_escalated_currentmonth.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_escalated_currentmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--else
--begin
--set @viewquery=
--'alter view view_currentmonth as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_currentmonth right join view_escalated_currentmonth on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
--left join user_master on view_escalated_currentmonth.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_escalated_currentmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--end
--else if @checkid1 < 1 and @checkid2 > 0
--begin
--set @viewquery=
--'alter view view_currentmonth as
--select user_master.userid  as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_currentmonth right join view_escalated_currentmonth on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
--join user_master on view_escalated_currentmonth.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_escalated_currentmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_performancepoint_currentmonth.emp_id
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_currentmonth 
--as
--select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
--left join view_escalated_currentmonth 
--on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
--left join view_completed_currentmonth 
--on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_currentmonth.emp_id=user_master.userid 
--where left(view_performancepoint_currentmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_escalated_currentmonth 
left join view_performancepoint_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id
left join view_completed_currentmonth 
on view_escalated_currentmonth.issue_resolved_by=view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_escalated_currentmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_currentmonth 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_performancepoint_currentmonth 
left join view_escalated_currentmonth 
on view_performancepoint_currentmonth.emp_id=view_escalated_currentmonth.issue_resolved_by
left join view_completed_currentmonth 
on view_performancepoint_currentmonth.emp_id =view_completed_currentmonth.issue_resolved_by
left join user_master 
on view_performancepoint_currentmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_currentmonth.date)=datename(month,getdate())
--group by user_master.userid,view_completed_currentmonth.completed,view_escalated_currentmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyClosed
-- --------------------------------------------------







CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyClosed]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as Closed from TBL_NEWTASKDETAILS where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if charindex('IT',@access)>0 
begin
	exec IT_levelsummary_DailynMonthlyClosed @TL ,@access, @fromdate,@todate,@type,@location,@count ,@query ,@query1 
end
else
begin
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp5') drop table levelsummary_Temp5
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
			into levelsummary_Temp5
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access) and branch_id=@location)			
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
			into levelsummary_Temp5
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access))
		END	
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
		into levelsummary_Temp5
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_raised_datetime 
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Closed) as Closed from levelsummary_Temp5
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Closed) as Closed from levelsummary_Temp5
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Closed
into levelsummary_Temp5
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='X' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Closed) as Closed from levelsummary_Temp5
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp5
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Closed) as Closed from levelsummary_Temp5
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Closed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Closed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyComp
-- --------------------------------------------------



CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyComp]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from client_details where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if charindex('IT',@access)>0 
begin
	exec IT_levelsummary_DailynMonthlyComp @TL ,@access,@fromdate,@todate,@type,@location,@count ,@query ,@query1 
end
else
begin
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp') drop table levelsummary_Temp
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
	If((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
			into levelsummary_Temp
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access) and branch_id=@location)			
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
			into levelsummary_Temp
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access))
		END	
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
		into levelsummary_Temp
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
	End
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror1'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror2'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
into levelsummary_Temp
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror3'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror4'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyComp_New
-- --------------------------------------------------




CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyComp_New]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
--@query2 varchar(max),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from client_details where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if charindex('IT',@access)>0 
begin
	exec IT_levelsummary_DailynMonthlyComp_New @TL ,@access, @fromdate,@todate,@type ,@count ,@query ,@query1 
end
else
begin
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp') drop table levelsummary_Temp
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
into levelsummary_Temp
from client_details d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as completed
into levelsummary_Temp
from client_details d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(completed) as Completed from levelsummary_Temp
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(completed) as Completed from levelsummary_Temp
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.completed
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyEscalate
-- --------------------------------------------------





CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyEscalate]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)

if charindex('IT',@access)>0 
begin
	exec IT_levelsummary_DailynMonthlyEscalate @TL ,@access, @fromdate,@todate,@type,@location,@count ,@query ,@query1 
end
else
begin
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as Escalated from TBL_NEWTASKDETAILS where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp2') drop table levelsummary_Temp2
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
			into levelsummary_Temp2
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code in ('ET','EF','E3') and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access) and branch_id=@location)			
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
			into levelsummary_Temp2
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code in ('ET','EF','E3') and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access))
		END	
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
		into levelsummary_Temp2
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code like 'E%' and d.issue_raised_datetime 
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,left(date,11) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by left(date,11),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else 
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Escalated
into levelsummary_Temp2
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and d.status_code like 'E%' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,left(date,11) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by left(date,11),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp2
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeEscalate 
as
select issue_resolved_by as Executive,(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Escalated
from exeEscalate t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Escalated)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyPending
-- --------------------------------------------------








CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyPending]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as Pending from TBL_NEWTASKDETAILS where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if charindex('IT',@access)>0 
begin
	exec IT_levelsummary_DailynMonthlyPending @TL ,@access, @fromdate,@todate,@type,@location ,@count ,@query ,@query1 
end
else
begin
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp3') drop table levelsummary_Temp3
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
			into levelsummary_Temp3
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code='P' or d.status_code='UP')  and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access) and branch_id=@location)			
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
			into levelsummary_Temp3
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and (d.status_code='P' or d.status_code='UP') and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access))
		END	
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
		into levelsummary_Temp3
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and (d.status_code='P' or d.status_code='UP')  and d.issue_raised_datetime 
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Pending) as Pending from levelsummary_Temp3
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Pending) as Pending from levelsummary_Temp3
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Pending
into levelsummary_Temp3
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and (d.status_code='P' or d.status_code='UP') and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Pending) as Pending from levelsummary_Temp3
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp3
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Pending) as Pending from levelsummary_Temp3
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Pending
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Pending)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyPerpoint
-- --------------------------------------------------


CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyPerpoint]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
--@query2 varchar(max),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as completed from client_details where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
drop table levelsummary_Temp1
-----------------------------------------------------------------
-------------------Insert Into levelsummary_Temp-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
select d.emp_id as issue_resolved_by,d.Date as [date],d.total as Total
into levelsummary_Temp1
from executive_rating d,user_master u
where u.userid=d.emp_id and d.date 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
and d.emp_id in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))
--group by left(date,11)

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeperpoint 
as
select issue_resolved_by as Executive,left(date,11) as date,total as [Total] from levelsummary_Temp1'
--group by left(date,11),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.total
from exeperpoint t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(total)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeperpoint 
as
select issue_resolved_by as Executive,(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,sum(total) as Total from levelsummary_Temp1
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.total
from exeperpoint t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(total)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.emp_id as issue_resolved_by,d.Date as [date],d.total as Total
into levelsummary_Temp1
from executive_rating d,user_master u
where u.userid=d.emp_id and d.date 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and d.emp_id in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))
--group by left(date,11)

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeperpoint 
as
select issue_resolved_by as Executive,left(date,11) as date,total as [Total] from levelsummary_Temp1'
--group by left(date,11),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.total
from exeperpoint t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(total)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp1
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view exeperpoint 
as
select issue_resolved_by as Executive,(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,sum(total) as Total from levelsummary_Temp1
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.total
from exeperpoint t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(total)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_DailynMonthlyReassigned
-- --------------------------------------------------






CREATE procedure [dbo].[SPlevelsummary_DailynMonthlyReassigned]
@TL varchar(20),
@access varchar(15), 
@fromdate datetime,
@todate datetime,
@type varchar(20),
@location varchar(20),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
declare @query2 varchar(max)
--declare @count varchar(20),@query varchar(max),@query1 varchar(max)

--Declare @count varchar(100)
--declare 

--set @query2='alter view test
--as 
--select issue_resolved_by as issue_resolved_by,left(issue_raised_datetime,11) as [date],count(docket_number) as Reassinged from TBL_NEWTASKDETAILS where status_code=''C'' and issue_raised_datetime between convert(varchar(20),cast('''+@FromDate +'''as datetime)) and convert(varchar(20),cast(dateadd(day,1,'''+@ToDate+''')as datetime)) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by left(issue_raised_datetime,11),issue_resolved_by '

--select @query2
--exec(@query2)
if charindex('IT',@access)>0 
begin
	exec IT_levelsummary_DailynMonthlyReassigned @TL ,@access, @fromdate,@todate,@type,@location,@count ,@query ,@query1 
end
else
begin
if exists (Select * from sysobjects where xtype in ('u') and name='levelsummary_Temp4') drop table levelsummary_Temp4
-----------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
if @access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='L3TL' 
begin
	if((select role_id from user_master where userid=@TL)='ADM')
	Begin
		IF @location<>''
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassinged
			into levelsummary_Temp4
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='R' and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
						(select userid from user_master where role_id=@access) and branch_id=@location)			
		END
		ELSE
		BEGIN
			select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassinged
			into levelsummary_Temp4
			from TBL_NEWTASKDETAILS d,user_master u
			where u.userid=d.issue_resolved_by and d.status_code='R' and d.issue_raised_datetime 
			between @fromdate and dateadd(day,1,@todate)
			and issue_resolved_by in (select userid from user_master where teamleader in 
					(select userid from user_master where role_id=@access))
		END	
	End
	Else
	Begin
		select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassinged
		into levelsummary_Temp4
		from TBL_NEWTASKDETAILS d,user_master u
		where u.userid=d.issue_resolved_by and d.status_code='R' and d.issue_raised_datetime 
		--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
		between @fromdate and dateadd(day,1,@todate)
		and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
		--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
	End
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Reassinged) as Reassinged from levelsummary_Temp4
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Reassinged
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassinged)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Reassinged) as Reassinged from levelsummary_Temp4
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Reassinged
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassinged)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end

else
begin
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],d.issue_raised_datetime as [date],d.docket_number as Reassinged
into levelsummary_Temp4
from TBL_NEWTASKDETAILS d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='R' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and dateadd(day,1,@todate)
--and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
--group by d.issue_raised_datetime,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------

if @Type = 'Daily'
begin
DECLARE sysCursor1 CURSOR
for
select left(date,11) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by left(date,11)
order by convert(datetime,left(date,11))

--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],left(date,11) as date,count(Reassinged) as Reassinged from levelsummary_Temp4
group by left(date,11),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",t.date,t.Reassinged
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassinged)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
else if @type='Monthly'
begin
DECLARE sysCursor1 CURSOR
for
select datename(MM,date)+' '+datename(yyyy,date) from levelsummary_Temp4
--where date between @Fromdate and @ToDate
where date between @fromdate and dateadd(day,1,@todate)
group by datename(MM,date)+' '+datename(yyyy,date)
order by convert(datetime,datename(MM,date)+' '+datename(yyyy,date))
--group by left(date,11)
--(date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
--SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
SELECT @query1=left(@query1, len(@query1)-1)



set @query2= 'alter view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+'''+' '+'''+datename(yyyy,date)) as date,count(Reassinged) as Reassinged from levelsummary_Temp4
group by (datename(MM,date)+'''+' '+'''+datename(yyyy,date)),issue_resolved_by,[Last login]'

exec (@query2)

set @query='Select [Employee Name],' + @query1 + ' from
(select u.username as "Employee Name",t.date,t.Reassinged
from execount t, user_master u
where t.Executive=u.userid 
)a

pivot
(
	 sum(Reassinged)
     for date in ('+@query1+')
)b
order by [Employee Name]'

end
end
--select @query
exec (@query)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_lastmonth
-- --------------------------------------------------










CREATE proc [dbo].[SPlevelsummary_lastmonth]
@TL varchar(20),
@access varchar(15), 
@query varchar(500)

as
-------------------------------------------------------------
--Auther		:Sanjay Lavu Kudtarkar
--Comment		:Do not dare to alter this Stored Procedure
--Copy Right	:Mastermind Developers Pvt. Ltd. 2008(c)
-------------------------------------------------------------
declare @checkid1 int,@checkid2 int,@checkid3 int
declare @viewquery varchar(1000)

if @access='L1TL' or @access='L2TTL'  ---@TL='L1T' or @TL='L2TT'
begin
set @query='alter view view_completed_lastmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_lastmonth

set @query='alter view view_escalated_lastmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code=''ET'' or status_code=''EF'' or status_code=''E3'') and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_lastmonth

set @query='alter view view_performancepoint_lastmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,dateadd(month,-1,getdate())) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_lastmonth

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_performancepoint_lastmonth.emp_id
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
exec (@viewquery)
end
end 
end
else if @access='L2FTL' or @access='L3TL' 
begin
set @query='alter view view_completed_lastmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) and issue_resolved_by in(select userid from user_master where teamleader='''+@TL+''' and userid<>'''+@TL+''') group by issue_resolved_by '

exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_lastmonth

set @query='alter view view_performancepoint_lastmonth
as
select emp_id,sum(total) as Total from executive_rating
where datename(month,date)=datename(month,dateadd(month,-1,getdate())) and emp_id in(select userid from user_master where teamleader='''+@TL+'''and userid<>'''+@TL+''') group by emp_id'

exec (@query)

select @checkid2=count(emp_id) from view_performancepoint_lastmonth

--set @viewquery=
--'alter view view_lastmonth as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,executive_rating.total as PerformancePoint from view_completed_lastmonth --left join view_escalated_lastmonth on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
--join user_master on view_completed_lastmonth.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_completed_lastmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if @checkid1 > @checkid2
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed'--select @viewquery
exec (@viewquery)
end
else if @checkid2 > @checkid1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed'--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed'--select @viewquery
exec (@viewquery)
end
end
else 

begin
set @query='alter view view_completed_lastmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code=''C'' and  datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate()))
group by issue_resolved_by'
exec(@query)

select @checkid1=count(issue_resolved_by) from view_completed_lastmonth

set @query='alter view view_escalated_lastmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code=''ET'' or status_code=''EF'' or status_code=''E3'') and  datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) group by issue_resolved_by' 

exec(@query)

select @checkid2=count(issue_resolved_by) from view_escalated_lastmonth


set @query='alter view view_performancepoint_lastmonth
as
select emp_id,sum(total) as Total from executive_rating
where  datename(month,date)=datename(month,dateadd(month,-1,getdate()))
group by emp_id'

exec (@query)

select @checkid3=count(emp_id) from view_performancepoint_lastmonth

--if @checkid1 > 0 or @checkid2 < 1
--begin
--if @checkid1 > @checkid2
--begin
--set @viewquery=
--'alter view view_lastmonth as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_lastmonth left join view_escalated_lastmonth on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
--left join user_master on view_completed_lastmonth.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_completed_lastmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--else if @checkid2 > @checkid1
--begin
--set @viewquery=
--'alter view view_lastmonth as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_lastmonth right join view_escalated_lastmonth on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
--left join user_master on view_escalated_lastmonth.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_escalated_lastmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--else
--begin
--set @viewquery=
--'alter view view_lastmonth as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_lastmonth right join view_escalated_lastmonth on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
--left join user_master on view_escalated_lastmonth.issue_resolved_by=user_master.userid left join executive_rating on 
--executive_rating.emp_id=view_escalated_lastmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end
--end
--else if @checkid1 < 1 and @checkid2 > 0
--begin
--set @viewquery=
--'alter view view_lastmonth as
--select user_master.userid  as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,executive_rating.total as PerformancePoint from view_completed_lastmonth right join view_escalated_lastmonth on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
--join user_master on view_escalated_lastmonth.issue_resolved_by=user_master.userid join executive_rating on 
--executive_rating.emp_id=view_escalated_lastmonth.issue_resolved_by where left(executive_rating.Date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
--end

if @checkid1 < 1 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 < 1 and @checkid3 > 0
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_performancepoint_lastmonth.emp_id
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 < 1 and @checkid2 > 0 and @checkid3 >  0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
if (@checkid2 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 < 1
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if @checkid1 > 0 and @checkid2 < 1 and @checkid3 > 0
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
--select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
end
else if @checkid1 > 0 and @checkid2 > 0 and @checkid3 < 1
begin
--'alter view view_lastmonth 
--as
--select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
--left join view_escalated_lastmonth 
--on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
--left join view_completed_lastmonth 
--on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
--left join user_master 
--on view_performancepoint_lastmonth.emp_id=user_master.userid 
--where left(view_performancepoint_lastmonth.date,11)='+''''+left(getdate(),11)+''''
----select @viewquery
--exec (@viewquery)
if (@checkid1 > @checkid2)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end

end
else 
begin
if (@checkid1 > @checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery= 
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid2 > @checkid3) and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3 > @checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid' 
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid1=@checkid2) and (@checkid1 > @checkid3)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id 
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid2=@checkid3)and (@checkid2 > @checkid1)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_escalated_lastmonth 
left join view_performancepoint_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_completed_lastmonth 
on view_escalated_lastmonth.issue_resolved_by=view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_escalated_lastmonth.issue_resolved_by=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else if (@checkid3=@checkid1) and (@checkid3 > @checkid2)
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
else
begin
set @viewquery=
'alter view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_performancepoint_lastmonth 
left join view_escalated_lastmonth 
on view_performancepoint_lastmonth.emp_id=view_escalated_lastmonth.issue_resolved_by
left join view_completed_lastmonth 
on view_performancepoint_lastmonth.emp_id =view_completed_lastmonth.issue_resolved_by
left join user_master 
on view_performancepoint_lastmonth.emp_id=user_master.userid '
--where datename(month,view_performancepoint_lastmonth.date)=datename(month,dateadd(month,-1,getdate()))
--group by user_master.userid,view_completed_lastmonth.completed,view_escalated_lastmonth.Escalated'--select @viewquery
--select @viewquery
exec (@viewquery)
end
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlevelsummary_testing
-- --------------------------------------------------
CREATE proc SPlevelsummary_testing  
@query varchar(max),@query1 varchar(max)  
as  
Declare @teamid varchar(15)  
Print '---- User level Report-----'  
DECLARE vend_cursor CURSOR  
    FOR SELECT distinct rtrim(team_id) FROM user_master   
  
OPEN vend_cursor  
FETCH NEXT FROM vend_cursor  
into @teamid  
  
while @@fetch_status = 0  
begin  
--print @teamid  
--select userid,team_id  
--from user_master  
--where team_id=@teamid  
--set @query=@query + '[' + @teamid + ']' + ','  
set @query=@query + ''''+ @teamid +'''' + ','
FETCH NEXT FROM vend_cursor  
into @teamid  
end  
close vend_cursor  
Deallocate vend_cursor  
if @query = ''  
begin  
print 'None'  
end  
else  
begin  
set @query=left(@query, len(@query)-1)  
print @query  
end
set @query1='select team_id,username from user_master where team_id in ('+@query+') order by team_id'
--set @query1='select '+ @query +' from  
--(  
--    select team_id,username  
--    from user_master  
--)a  
--pivot  
--(  
--    username  
--    for team_id in ('+@query+')  
--)b'  
--end  
exec(@query1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPLoadQueries
-- --------------------------------------------------
CREATE proc [dbo].[SPLoadQueries]  
as  
select Product_Name,Problem  from Faq_Details

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPlogin
-- --------------------------------------------------





CREATE procedure [dbo].[SPlogin]
@empid varchar(50),@pwd varchar(50) 
as 
if @pwd=''
begin
	Select userid,username,user_master.Role_id,Branch_id,Email,login_status,TeamLeader,role_master.role_name,access_id,Account_Status,
User_Master.Team_ID
	From user_master,role_master
	Where userid = @empid and user_master.Role_id=role_master.Role_Id
end
else
begin 
	Select userid, username, user_master.Role_id, Branch_id, Email, login_status,
			 TeamLeader, role_master.role_name, access_id, Account_Status, User_Master.Team_ID
	From user_master,role_master
	Where userid = @empid and password=@pwd and user_master.Role_id=role_master.Role_Id
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPmastermind
-- --------------------------------------------------
CREATE proc SPmastermind

@docket_number varchar(10),
@client_code varchar(10),
@branch_code varchar(10),
@status_code varchar(10),
@product_code varchar(10),
@issue_resolved_by varchar(10),
@issue_raised_datetime_from varchar(50),
@issue_raised_datetime_to varchar(50),
@product_name varchar(10),
@username varchar(50),
@jobstatus_name varchar(50),
@flag varchar(1),
@query varchar(1000)
as

--set @BranchName = 'select branch_code from client_master where client_code=@client_code'

--set @issue_raised_datetime_from=convert(datetime,@issue_raised_datetime_from,101)
--set @issue_raised_datetime_to=convert(datetime,@issue_raised_datetime_to,101)

--select * from client_details
--select @client_code = client_code,@product_code = product_code,@issue_resolved_by= issue_resolved_by,@status_code =status_code from client_details where docket_number=@docket_number
--select @client_code = client_code,@product_code = product_code,@issue_resolved_by= issue_resolved_by,@status_code =status_code

--set @query='select * from client_details where '
--set @query ='Select docket_number as ''Docket Number'',client_code as ''Client Code'', product_code as ''Product Code'',Nature,Problem,issue_raised_datetime as ''Issue Raised Date/Time'',issue_resolved_by as ''Issue Resolved By'',issue_resolved_datetime as ''Issue Resolved Date/Time'',status_code as ''Status'' from client_details where '

set @query='select rtrim(d.docket_number) as ''Docket Number'',d.Client_code as ''Client Code'',m.branch_code as ''Branch code'',v.product_name as ''Product Name'',d.nature as ''Nature'',d.problem as ''Problem'',
d.Issue_Raised_dateTime as ''Issue Raised Date/Time'',u.Team_ID as ''Issue resolved level'',u.UserName as ''Issue resolved by'',d.Issue_Resolved_dateTime as ''Issue Resolved Date/Time'',j.jobstatus_name as ''Status''
from client_master m,client_details d, user_master u, jobstatusmaster j,vendor_product v
where m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code and '

set @flag =0

-----------------------------------------------1-------------------------------------
if @docket_number<>''
begin
if @flag=1
begin
set @query=@query+ 'and d.docket_number='''+@docket_number+''''
end
else
begin
set @query=@query+ 'd.docket_number='''+@docket_number+'''' 
end
set @flag=1
end
-------------------------------------------end 1---------------------------------------
--------------------------------------------2------------------------------------------
if @client_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.client_code='''+@client_code+ '''' 
end
else
begin
set @query=@query+ ' d.client_code='''+@client_code+ '''' 
end
set @flag=1
end
----------------------------------------end 2---------------------------------------
----------------------------------------3------------------------------------------
if @branch_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and branch_code='''+@branch_code+ '''' 
end
else
begin
set @query=@query+ ' branch_code='''+@branch_code+ '''' 
end
set @flag=1
end
-------------------------------end 3-----------------------------------------------

----------------------------------------4------------------------------------------
if @status_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.status_code='''+@status_code+ '''' 
end
else
begin
set @query=@query+ ' d.status_code='''+@status_code+ '''' 
end
set @flag=1
end
-------------------------------end 4-----------------------------------------------


----------------------------------------5------------------------------------------
if @product_code<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.product_code='''+@product_code+ '''' 
end
else
begin
set @query=@query+ ' d.product_code='''+@product_code+ '''' 
end
set @flag=1
end
-------------------------------end 5-----------------------------------------------

----------------------------------------6------------------------------------------
if @issue_resolved_by<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.issue_resolved_by='''+@issue_resolved_by+ '''' 
end
else
begin
set @query=@query+ ' d.issue_resolved_by='''+@issue_resolved_by+ '''' 
end
set @flag=1
end
-------------------------------end 6-----------------------------------------------

----------------------------------------7------------------------------------------
if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
begin
if @flag=1
begin
set @query=@query+ ' and d.issue_raised_datetime between '''+@issue_raised_datetime_from +''' and '''+ @issue_raised_datetime_to +''''
end
else
begin
set @query=@query+ ' d.issue_raised_datetime between '''+@issue_raised_datetime_from +''' and '''+ @issue_raised_datetime_to +''''
end
set @flag=1
end
-------------------------------end 7-----------------------------------------------


select @query

exec (@query)
------------------------------------------------------------------------------
--select @username =username  from user_master where userid=@issue_resolved_by
--select @branch_code =branch_code from client_master where client_code=@client_code
--select @jobstatus_name=jobstatus_name from jobstatusmaster where jobstatus_id= @status_code
--select @product_name= product_name from vendor_product where product_code=@product_code
-------------------------------------------------------------------------------

--select @docket_number,@client_code,@username,@branch_code,@jobstatus_name,@product_name

--select getdate()

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPNature
-- --------------------------------------------------

CREATE proc [dbo].[SPNature]
@product varchar(max),@type varchar(50)
as
select distinct Faq_Nature from faq_details
where product_Name=ltrim(@product) and Faq_Type=ltrim(@type) and Faq_status=1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPPending_AKRUTI
-- --------------------------------------------------

create proc SPPending_AKRUTI
@Ticket char(15)
as
select * from issuedetails_AKRUTI where docket_number=@Ticket

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spPendingJobInfo
-- --------------------------------------------------



CREATE proc [dbo].[spPendingJobInfo]
@docketnumber varchar(20) 
as 

select B2C,Active_from,client_master.client_code,long_name,mobile,landline_number1,landline_number2,
office_number1,office_number2,branch_code,subbroker_code,region_code,zone_code,address,address1,address2,city,
pan_number,Dob,email,vendor_product.product_name,vendor_product.product_version,client_master.Manager_code,
secondary_product

from client_master
--join vendor_product
--on client_master.product_code=vendor_product.product_code
join tbl_NewClient_Details
on client_master.client_code=tbl_NewClient_Details.client_code
join vendor_product
on (tbl_NewClient_Details.product_code=vendor_product.product_code or tbl_NewClient_Details.product_code=vendor_product.product_name)
where docket_number=@docketnumber


SELECT Docket_Number,product_code,Issue_Raised_DateTime,Issue_Resolved_Datetime,Issue_Resolving_Time,Call_From
      ,Call_Type,Source,Issue_Type,Type,Nature,Problem,Brief_Solution,Client_Remark,L1_InitialRemark,L1_FinalRemark
      ,L2_UserRemark,L3_UserRemark,Issue_Resolved_By,Team_Id,Contact_Person,Status_Code,jobstatusmaster.JobStatus_name
FROM tbl_NewClient_Details, jobstatusmaster
where docket_number = @docketnumber and Status_Code = JobStatus_Id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spPendingJobs
-- --------------------------------------------------








CREATE procedure [dbo].[spPendingJobs]
@emp_id varchar(15),
@access varchar(15),
@issuetype varchar(5)
as

if @access ='L1EX' and @issuetype = 'I'
begin 
	select distinct(Docket_Number) as 'Docket No.',
		--d.SBTag as 'SubBroker Tag',
		d.client_code as 'Client Code',d.tagbranch as 'Branch',
		tbl_IT_KB_Master.product_name as 'Product',d.Nature,d.Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours
		--,Status_code
	from tbl_NewClient_Details d
	join ctcl_details
	on d.client_code=ctcl_details.ctcl_odinid
	join tbl_IT_KB_Master
	on d.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (status_code='P' or status_code='UP')  and issue_resolved_by= @emp_id 
	and d.issue_type = 'IT'
	order by d.docket_number
end
else if @access ='L1TL' and @issuetype = 'I'
begin
	select distinct(Docket_Number) as 'Docket No.',
		--d.SBTag as 'SubBroker Tag',
		d.client_code as 'Client Code',d.tagbranch as 'Branch',
		tbl_IT_KB_Master.product_name as 'Product',d.Nature,d.Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours
		--,Status_code
	from tbl_NewClient_Details d
	join ctcl_details
	on d.client_code=ctcl_details.ctcl_odinid
	join tbl_IT_KB_Master
	on d.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (status_code='P' or status_code='UP')  and d.issue_type = 'IT'
	and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
	order by d.docket_number
end
else if @access ='L1EX'  and @issuetype = 'E'
begin
	select distinct(rtrim(Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Branch_code as 'Branch',d.source as 'Source',vendor_product.product_name as 'Product',
	Nature,Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,issue_raised_datetime,getdate()) as hours
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (status_code='P' or status_code='UP' ) and issue_resolved_by=@emp_id 
	or (Status_code ='L1E' and issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))
	and d.issue_type = 'EBro'
	order by rtrim(Docket_Number)
end

else if @access='L2FEX' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Client_master.Branch_code as 'Branch',d.source as 'Source',
	vendor_product.product_name as 'Product',d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive' ,jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'  
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='EF' OR d.status_code='UP'  or d.status_code='L' or d.status_code='P') 
	 and d.issue_type = 'EBro'and d.issue_resolved_by=@emp_id
	order by rtrim(Docket_Number)
end
else if @access='L2TEX' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
	d.source as 'Source',vendor_product.product_name as 'Product',d.Nature As Nature,d.Problem as Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive'  ,jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where d.issue_type = 'EBro' and d.issue_resolved_by=@emp_id And 
		((d.status_code='ET' OR d.status_code='UP' or d.status_code='L' or d.status_code='P')
	or (Status_code ='ET' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL'))))
	  
	order by rtrim(d.Docket_Number)
end
else if @access='L3EX' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',
	d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',d.source as 'Source',
	vendor_product.product_name as 'Product',d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',
	d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 2 Executive' ,jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 3 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='E3' and d.issue_type = 'EBro')
	or ((d.status_code='UP'or d.status_code='L' or d.status_code='P') and d.issue_resolved_by=@emp_id)
	order by rtrim(d.Docket_Number)
end
else if @access='L1TL' and @issuetype = 'E'
begin
--	select distinct(rtrim(Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',Branch_code as 'Branch',
--	d.source as 'Source',vendor_product.product_name as 'Product',Nature,Problem,
--	d.Brief_solution as [Brief Solution],
--	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
--	user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',
--	datediff(hour,issue_raised_datetime,getdate()) as hours  
--	from tbl_NewClient_Details d
--	join client_master
--	on d.client_code=client_master.client_code
--	join vendor_product
--	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
--	join user_master
--	on d.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on d.status_code=jobstatusmaster.jobstatus_id
--	where ((status_code='P' or status_code='UP' and user_master.team_id='L1')
--	or (status_code = 'L1E' and issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
--	AND d.issue_type = 'EBro'
--	order by rtrim(Docket_Number)
	Select distinct(rtrim(Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',Branch_code as 'Branch',
		d.source as 'Source',vendor_product.product_name as 'Product',Nature,Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours  
	from tbl_NewClient_Details d
		join client_master
		on d.client_code=client_master.client_code
		join vendor_product
		on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
		join user_master
		on d.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on d.status_code=jobstatusmaster.jobstatus_id
	where (((status_code='P' or status_code='UP') and user_master.team_id='L1' and issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		or (status_code = 'L1E' and issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL'))))
		AND d.issue_type = 'EBro'
	Order by rtrim(Docket_Number)

end
else if @access='L2FTL' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Client_master.Branch_code as 'Branch',d.source as 'Source',
	vendor_product.product_name as 'Product',d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,	
	d.Issue_Raised_dateTime as 'Issue Date/Time',
	d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive' ,
	jobstatusmaster.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='EF' or d.status_code='UP' or d.status_code='L' or d.status_code='P') and user_master.team_id='L2F'
	and d.issue_type = 'EBro'
	order by rtrim(d.Docket_Number)
end
else if @access='L2TTL' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Client_master.Branch_code as 'Branch',d.source as 'Source',vendor_product.product_name as 'Product',
	d.Nature,d.Problem,
	Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive' ,jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where ((d.status_code='ET' or d.status_code='UP' or d.status_code='L' or d.status_code='P') 
	and user_master.team_id='L2T')
	or (Status_code ='ET' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL')))
	and d.issue_type = 'EBro'
	order by rtrim(d.Docket_Number)
end
else if (@access = 'ADM' or @access='L3EX' or @access='ITL3EX' or @access='L3TL' or @access='ITL3TL') and @issuetype = 'E'
begin
	select distinct(d.Docket_Number) as 'Docket No.',
	d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
	d.source as 'Source',vendor_product.product_name as 'Product',
	d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,	
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 2 Executive' ,jobstatusmaster.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 3 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	join tbl_NewTaskDetails
	on d.docket_number=tbl_NewTaskDetails.docket_number
	where d.status_code in ('p','UP','EF','ET','L','E3') 
	and d.issue_resolved_by in (select userid from user_master)
	order by d.docket_number
end
else
begin
	select rtrim(Docket_Number) as 'Docket No.',d.client_code as 'Client Code',
	Branch_code as 'Branch',d.source as 'Source',vendor_product.product_name as 'Product',
	Nature,Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Executive',jobstatusmaster.jobstatus_name as 'Status' ,datediff(hour,issue_raised_datetime,getdate()) as hours 
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where status_code like 'E%' or status_code='UP' or status_code='P' or status_code='L' and d.issue_type = 'EBro'
	order by d.docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spPendingJobs_Latest
-- --------------------------------------------------


CREATE procedure [dbo].[spPendingJobs_Latest]
@emp_id varchar(15),
@access varchar(15),
@issuetype varchar(5),
@CSO varchar(20)
as

if @access ='L1EX' and @issuetype = 'I'
begin 
	select distinct(Docket_Number) as 'Docket No.',
		--d.SBTag as 'SubBroker Tag',
		d.client_code as 'Client Code',d.tagbranch as 'Branch',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		--(Case when (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',d.Nature,d.Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',
		(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
		jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours
		--,Status_code
	from tbl_NewClient_Details d
	join ctcl_details
	on d.client_code=ctcl_details.ctcl_odinid
	join tbl_IT_KB_Master
	on d.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (status_code='P' or status_code='UP')  and issue_resolved_by= @emp_id 
	and d.issue_type = 'IT'
	order by d.docket_number
end
else if @access ='L1TL' and @issuetype = 'I'
begin
	select distinct(Docket_Number) as 'Docket No.',
		--d.SBTag as 'SubBroker Tag',
		d.client_code as 'Client Code',d.tagbranch as 'Branch',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
		tbl_IT_KB_Master.product_name as 'Product',d.Nature,d.Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',
		(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
		jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours
		--,Status_code
	from tbl_NewClient_Details d
	join ctcl_details
	on d.client_code=ctcl_details.ctcl_odinid
	join tbl_IT_KB_Master
	on d.product_code=tbl_IT_KB_Master.product_Name
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (status_code='P' or status_code='UP')  and d.issue_type = 'IT'
	and (issue_resolved_by= @emp_id or issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
	order by d.docket_number
end
else if @access ='L1EX'  and @issuetype = 'E'
begin
	select distinct(rtrim(Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
		Branch_code as 'Branch',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',									
		d.source as 'Source',vendor_product.product_name as 'Product',
		Nature,Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',
		(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
		jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (status_code='P' or status_code='UP' ) and issue_resolved_by=@emp_id 
	or (Status_code ='L1E' and issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL')))
	and d.issue_type = 'EBro'
	order by rtrim(Docket_Number)
end

else if @access='L2FEX' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Client_master.Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',
	vendor_product.product_name as 'Product',d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive' ,
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
	jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'  
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='EF' OR d.status_code='UP'  or d.status_code='L') 
	 and d.issue_type = 'EBro'and d.issue_resolved_by=@emp_id
	order by rtrim(Docket_Number)
end
else if @access='L2TEX' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',vendor_product.product_name as 'Product',d.Nature As Nature,d.Problem as Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive',
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
	jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='ET' OR d.status_code='UP' or d.status_code='L')
	or (Status_code ='ET' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL')))
	 and d.issue_type = 'EBro' and d.issue_resolved_by=@emp_id
	order by rtrim(d.Docket_Number)
end
else if @access='L3EX' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',
	d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',
	vendor_product.product_name as 'Product',d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',
	d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 2 Executive' ,jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 3 Executive',
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO]
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='E3' and d.issue_type = 'EBro')
	or ((d.status_code='UP'or d.status_code='L') and d.issue_resolved_by=@emp_id)
	order by rtrim(d.Docket_Number)
end
else if @access='L1TL' and @issuetype = 'E'
begin
--	select distinct(rtrim(Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',Branch_code as 'Branch',
--	d.source as 'Source',vendor_product.product_name as 'Product',Nature,Problem,
--	d.Brief_solution as [Brief Solution],
--	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
--	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
--	user_master.username as 'Level 1 Executive',jobstatusmaster.jobstatus_name as 'Status',
--	datediff(hour,issue_raised_datetime,getdate()) as hours  
--	from tbl_NewClient_Details d
--	join client_master
--	on d.client_code=client_master.client_code
--	join vendor_product
--	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
--	join user_master
--	on d.issue_resolved_by=user_master.userid
--	join jobstatusmaster
--	on d.status_code=jobstatusmaster.jobstatus_id
--	where ((status_code='P' or status_code='UP' and user_master.team_id='L1')
--	or (status_code = 'L1E' and issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id)))
--	AND d.issue_type = 'EBro'
--	order by rtrim(Docket_Number)
	Select distinct(rtrim(Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',Branch_code as 'Branch',
		(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
		--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
		d.source as 'Source',vendor_product.product_name as 'Product',Nature,Problem,
		d.Brief_solution as [Brief Solution],
		Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
		d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
		user_master.username as 'Level 1 Executive',
		(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
		jobstatusmaster.jobstatus_name as 'Status',
		datediff(hour,issue_raised_datetime,getdate()) as hours  
	from tbl_NewClient_Details d
		join client_master
		on d.client_code=client_master.client_code
		join vendor_product
		on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
		join user_master
		on d.issue_resolved_by=user_master.userid
		join jobstatusmaster
		on d.status_code=jobstatusmaster.jobstatus_id
	where (((status_code='P' or status_code='UP') and user_master.team_id='L1' and issue_resolved_by in (select Employee_id from tbl_teamleadermaster where teamleader=@emp_id))
		or (status_code = 'L1E' and issue_resolved_by in (select userid from user_master where role_id in ('ITL1EX','ITL1TL'))))
		AND d.issue_type = 'EBro'
	Order by rtrim(Docket_Number)

end
else if @access='L2FTL' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Client_master.Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',
	vendor_product.product_name as 'Product',d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,	
	d.Issue_Raised_dateTime as 'Issue Date/Time',
	d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 1 Executive' ,
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
	jobstatusmaster.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where (d.status_code='EF' or d.status_code='UP' or d.status_code='L' or d.status_code='P') and user_master.team_id='L2F'
	and d.issue_type = 'EBro'
	order by rtrim(d.Docket_Number)
end
else if @access='L2TTL' and @issuetype = 'E'
begin
	select distinct(rtrim(d.Docket_Number)) as 'Docket No.',d.client_code as 'Client Code',
	Client_master.Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',vendor_product.product_name as 'Product',
	d.Nature,d.Problem,
	Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',
	user_master.username as 'Level 1 Executive' ,
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
	jobstatusmaster.jobstatus_name as 'Status',
	datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 2 Executive'
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where ((d.status_code='ET' or d.status_code='UP' or d.status_code='L' or d.status_code='P') 
	and user_master.team_id='L2T')
	or (Status_code ='ET' and issue_resolved_by in (select userid from user_master where role_id in ('L1EX','L1TL')))
	and d.issue_type = 'EBro'
	order by rtrim(d.Docket_Number)
end
else if ( @access='L3EX' or @access='ITL3EX' or @access='L3TL' or @access='ITL3TL') and @issuetype = 'E'
begin
	select distinct(d.Docket_Number) as 'Docket No.',
	d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',vendor_product.product_name as 'Product',
	d.Nature,d.Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,	
	d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 2 Executive' ,jobstatusmaster.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 3 Executive',
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO]
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	join tbl_NewTaskDetails
	on d.docket_number=tbl_NewTaskDetails.docket_number
	where d.status_code in ('p','UP','EF','ET','L','E3') 
	and d.issue_resolved_by in (select userid from user_master)
	order by d.docket_number
end
else if(@access = 'ADM' and @issuetype = 'E')
begin
	If(@CSO<>'')
	Begin
		Select distinct(d.Docket_Number) as 'Docket No.',
			d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
			(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
			d.source as 'Source',vendor_product.product_name as 'Product',
			d.Nature,d.Problem,
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,	
			d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 2 Executive' ,jobstatusmaster.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 3 Executive',
			(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO]
		From tbl_NewClient_Details d
			Join client_master
			on d.client_code=client_master.client_code
			join vendor_product
			on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
			join user_master
			on d.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on d.status_code=jobstatusmaster.jobstatus_id
			join tbl_NewTaskDetails
			on d.docket_number=tbl_NewTaskDetails.docket_number
		where d.status_code in ('p','UP','EF','ET','L','E3') 
			and d.issue_resolved_by in (select userid from user_master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code=@CSO))
		order by d.docket_number
	End
	Else If(@CSO='')
	Begin
		Select distinct(d.Docket_Number) as 'Docket No.',
			d.client_code as 'Client Code',Client_master.Branch_code as 'Branch',
			(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
			--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
			d.source as 'Source',vendor_product.product_name as 'Product',
			d.Nature,d.Problem,
			d.Brief_solution as [Brief Solution],
			Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,	
			d.Issue_Raised_dateTime as 'Issue Date/Time',d.Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Level 2 Executive' ,jobstatusmaster.jobstatus_name as 'Status',datediff(hour,d.issue_raised_datetime,getdate()) as hours ,user_master.username as 'Level 3 Executive',
			(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO]
		From tbl_NewClient_Details d
			Join client_master
			on d.client_code=client_master.client_code
			join vendor_product
			on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
			join user_master
			on d.issue_resolved_by=user_master.userid
			join jobstatusmaster
			on d.status_code=jobstatusmaster.jobstatus_id
			join tbl_NewTaskDetails
			on d.docket_number=tbl_NewTaskDetails.docket_number
		where d.status_code in ('p','UP','EF','ET','L','E3') 
			and d.issue_resolved_by in (select userid from user_master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster))
		order by d.docket_number
	End
end
else
begin
	select rtrim(Docket_Number) as 'Docket No.',d.client_code as 'Client Code',
	Branch_code as 'Branch',
	(Case when d.TagBranch is null then '' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'Branch Name',
	--(Case when  (d.TagBranch is null or d.TagBranch = '') then '' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as 'CSO',								
	d.source as 'Source',vendor_product.product_name as 'Product',
	Nature,Problem,
	d.Brief_solution as [Brief Solution],
	Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
	Issue_Raised_dateTime as 'Issue Date/Time',Issue_Resolved_dateTime as 'Last Updated time',user_master.username as 'Executive',
	(Case when  (d.issue_resolved_by is null or d.issue_resolved_by = '') then '' when d.issue_resolved_by is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = User_Master.Branch_ID) End) as [CSO],
	jobstatusmaster.jobstatus_name as 'Status' ,datediff(hour,issue_raised_datetime,getdate()) as hours 
	from tbl_NewClient_Details d
	join client_master
	on d.client_code=client_master.client_code
	join vendor_product
	on (d.product_code=vendor_product.product_code or d.product_code=vendor_product.product_name)
	join user_master
	on d.issue_resolved_by=user_master.userid
	join jobstatusmaster
	on d.status_code=jobstatusmaster.jobstatus_id
	where status_code like 'E%' or status_code='UP' or status_code='P' or status_code='L' and d.issue_type = 'EBro'
	order by d.docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPProblem
-- --------------------------------------------------

CREATE proc [dbo].[SPProblem]
@product varchar(50),@type varchar(50),@nature varchar(50)
as
select Problem
from faq_details
where product_Name=ltrim(@product) and Faq_Type=ltrim(@type) and Faq_Nature=ltrim(@nature) and Faq_status=1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPProduct
-- --------------------------------------------------


CREATE proc [dbo].[SPProduct]
as
select distinct ltrim(Product_Name) from faq_details
where Faq_status=1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPPublishDisplay
-- --------------------------------------------------


CREATE proc [dbo].[SPPublishDisplay]
@id int
as
select product_name,faq_type,faq_nature,problem,solution,briefsolution,remark
from faq_details
where faq_id=@id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPPublishFAQGrid
-- --------------------------------------------------


CREATE proc [dbo].[SPPublishFAQGrid]
@team char(15)
as
select f.faq_id as 'FAQ ID',f.faq_type as 'Type',f.product_name as 'Product',f.faq_nature as 'Nature',u.username as 'Executive Name',u.Team_Id as 'Executive Level',f.Added_on as 'Submission Date/Time'
from faq_details f, user_master u
where u.userid=f.Added_by and u.teamleader=@team and f.faq_status=0;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPRejectPublishData
-- --------------------------------------------------


CREATE proc [dbo].[SPRejectPublishData]
@id int,@product varchar(50),@type varchar(20),@nature varchar(15),@problem varchar(max),@sol text,@brief text,@remark varchar(50),@by varchar,@on datetime
as
update faq_details
set product_name=@product,faq_type=@type,faq_nature=@nature,problem=@problem,solution=@sol,briefsolution=@brief,remark=@remark,faq_status=2,reviewed_by=@by,reviewed_on=@on
where faq_id=@id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPRepEg
-- --------------------------------------------------
CREATE proc [dbo].[SPRepEg]
@DocketNo Varchar(15) = null,
@ClientCode Varchar(15)= null,
@BranchCode Varchar(30) = null,
@Status Varchar(60) = null,
@ProductName Varchar(30) = null,
@ExecutiveName Varchar(60) = null
as
begin
select td.docket_number as 'Docket Number', cd.Client_code as 'Client Code',cm.branch_code as 'Branch code',
vp.product_name as 'Product Name',cd.nature as 'Nature',cd.problem as 'Problem',cd.Issue_Raised_dateTime as 'Issue Raised Date/Time',
um.Team_ID as 'Issue resolved level',um.UserName as 'Issue resolved by',cd.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',
js.jobstatus_name as 'Status'

from Client_master CM join client_details CD
on CM.client_code=CD.client_code
join User_master UM
on um.userid=cd.Issue_resolved_BY
join jobstatusmaster JS
on js.jobstatus_id=cd.status_code
join vendor_product vp
on vp.product_code=cd.product_code
join task_details td
on td.docket_number=cd.docket_number

where 
(td.docket_number = @DocketNo or @DocketNo is null)
and
(cd.Client_code = @ClientCode or @ClientCode is null)
and
(cm.branch_code = @BranchCode or @BranchCode is null)
and
(js.jobstatus_name = @Status or @Status is null)
and
(um.UserName = @ProductName or @ProductName is null)
and
(cd.Client_code = @ExecutiveName or @ExecutiveName is null)

order by td.docket_number
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPReport
-- --------------------------------------------------
CREATE proc [dbo].[SPReport]
@BranchCode char(15),@ClientCode char(15),@DocketNumber char(8),@Exec char(15),@Product char(15),@Status char(15)
as
select t.docket_number as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',
v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',
j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j,vendor_product v,task_details t
where (m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code and t.docket_number=d.docket_number)
and (m.Branch_code=@BranchCode and d.client_code=@ClientCode and t.docket_number=@DocketNumber and u.username=@Exec and v.Product_name=@Product and j.jobstatus_name=@Status)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPReportEg
-- --------------------------------------------------


---Declare Variables-------------------------------------------------------------------------------
CREATE proc [dbo].[SPReportEg]
@DocketNo Varchar(15) = null,
@ClientCode Varchar(15)= null,
@BranchCode Varchar(30) = null,
@Status Varchar(60) = null,
@ProductName Varchar(30) = null,
@ExecutiveName Varchar(60) = null,
@FromDate datetime = null,
@ToDate datetime = null
-------------------------------------------------------------------------------------------------
as
begin
---Select Data Required--------------------------------------------------------------------------
select td.docket_number as 'Docket Number', cd.Client_code as 'Client Code',cm.branch_code as 'Branch code',
vp.product_name as 'Product Name',cd.nature as 'Nature',cd.problem as 'Problem',cd.Issue_Raised_dateTime as 'Issue Raised Date/Time',
um.Team_ID as 'Issue resolved level',um.UserName as 'Issue resolved by',cd.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',
js.jobstatus_name as 'Status'
-------------------------------------------------------------------------------------------------
----Apply joins on table-------------------------------------------------------------------------
from Client_master CM join client_details CD
on CM.client_code=CD.client_code
join User_master UM
on UM.userid=CD.Issue_resolved_BY
join jobstatusmaster JS
on JS.jobstatus_id=CD.status_code
join vendor_product VP
on VP.product_code=CD.product_code
join task_details TD
on CD.docket_number=TD.docket_number
------------------------------------------------------------------------------------------------
-----Apply conditions for Where clause------------------------------------------------------------
where 
(td.docket_number like isnull(@DocketNo,td.docket_number))
and (cd.Client_code like isnull(@ClientCode,cd.Client_code) + '%') 
and (cm.branch_code like isnull(@BranchCode,cm.branch_code) + '%' )
and (js.jobstatus_name like isnull(@Status,js.jobstatus_name) + '%' )
and (vp.product_name like isnull(@ProductName,vp.product_name) + '%' )
and (um.UserName like isnull(@ExecutiveName,um.UserName) + '%')
and (cd.Issue_Raised_dateTime >= ISNULL(@FromDate, cd.Issue_Raised_dateTime))
--and (cd.Issue_Raised_dateTime <= ISNULL(@ToDate, cd.Issue_Raised_dateTime))
--and (cd.Issue_Raised_dateTime between left(@FromDate,11) and left(dateadd(day,1,@ToDate),11))
order by  td.docket_number
----------------------------------------------------------------------------------------------------------
--select @DocketNo,@ClientCode ,@BranchCode ,@Status ,@ProductName ,@ExecutiveName,@FromDate ,@ToDate
end
------End Of Stored Procedure-------------------------------------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowMessage
-- --------------------------------------------------


CREATE proc [dbo].[SPShowMessage]
@TeamLead varchar(15)
as
select msg_id as ID, message_sent as Messages,mess_valid_from as FromDate, mess_valid_to as ToDate, sent_to as Audience from sent_messages
where sent_by = @TeamLead

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowMessage1
-- --------------------------------------------------


CREATE proc [dbo].[SPShowMessage1]
@TeamLead varchar(15),
@Status bit
as
select msg_id as ID, message_sent as Messages,mess_valid_from as FromDate, mess_valid_to as ToDate, sent_to as Audience from sent_messages
where sent_by = @TeamLead and 
message_status = @Status

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowRating
-- --------------------------------------------------




CREATE proc [dbo].[SPShowRating]
@Type varchar(30),
@Employee varchar(100),
@FromDate datetime,
@ToDate datetime
--@Day varchar(50)
as
--------Daily & All Executive---------------------------------
if @Type = 'Daily'
begin
if @Employee = 'All Executive'
begin
select u.username as "Executive Name", left(Date,11) as Date, e.total as Total  --,e.date, u.username as "Employee Name",
from executive_rating E, user_master U
where e.emp_id=u.userid --and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
order by u.username, e.date
end
--------Daily & Executive------------------------------------------
else
begin
select left(Date,11) as Date, e.total as Total  --,e.date, u.username as "Employee Name",
from executive_rating E, user_master U
where e.emp_id=u.userid and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
order by e.date
end
end
-----------------Monthly & All Executive------------------------------------
else if @Type = 'Monthly'
begin
if @Employee = 'All Executive'
begin
select u.username as "Employee Name", DATENAME(mm,date)+' '+DATENAME(yyyy,date) as "Month", sum(e.total) as Total
from executive_rating E, user_master U
where e.emp_id=u.userid --and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
--group by u.username
group by u.username,DATENAME(mm,date)+' '+DATENAME(yyyy,date),DATEPART(m,date),DATEPART(yyyy,date)
order by u.username,DATEPART(yyyy,date),DATEPART(m,date),DATENAME(mm,date)+' '+DATENAME(yyyy,date)
end
else
---------------Monthly & Executive--------------------------------------------------
begin
select u.username as "Employee Name",DATENAME(mm,date)+' '+DATENAME(yyyy,date) as "Month", sum(e.total) as Total
from executive_rating E, user_master U
where e.emp_id=u.userid and u.username=@Employee 
and (e.date between @FromDate and @ToDate)
--group by u.username
group by u.username,DATENAME(mm,date)+' '+DATENAME(yyyy,date),DATEPART(m,date),DATEPART(yyyy,date)
order by u.username,DATEPART(yyyy,date),DATEPART(m,date),DATENAME(mm,date)+' '+DATENAME(yyyy,date)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnBranch
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnBranch]
@BranchCode char(15)
as
select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.Issue_Raised_dateTime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j,vendor_product v
where m.Branch_code=@BranchCode and m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnClient
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnClient]
@ClientCode char(15)
as
select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.issue_raised_datetime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.issue_resolved_datetime as 'Issue Resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j, vendor_product v
where d.client_code=@ClientCode and m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnDate
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnDate]
@date datetime,@date1 datetime
as
select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.Issue_Raised_dateTime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j, vendor_product v
where m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and (d.Issue_Raised_dateTime between left(@date,11) and left(dateadd(day,1,@date1),11)) and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnDocket
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnDocket]
@DocketNumber char(8)
as
select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.issue_raised_datetime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.issue_resolved_datetime as 'Issue resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j, vendor_product v
where docket_number=@DocketNumber and m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnExecutive
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnExecutive]
@Exec varchar(60)
as
select rtrim(t.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.issue_raised_datetime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',left(t.tdate,11)+' '+right(t.ttime,8) as 'Issue resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j,task_details t, vendor_product v
where u.username=@Exec and m.client_code=d.client_code and u.userid=t.Employee_code and j.jobstatus_id=d.status_code and t.docket_number=d.docket_number and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnProduct
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnProduct]
@Product char(15)
as
select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.issue_raised_datetime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.issue_resolved_datetime as 'Issue resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j, vendor_product v
where v.Product_name=@Product and m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPShowReportOnStatus
-- --------------------------------------------------
CREATE proc [dbo].[SPShowReportOnStatus]
@Status char(60)
as
select rtrim(d.docket_number) as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',
d.issue_raised_datetime as 'Issue Raised Date/Time',u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.issue_resolved_datetime as 'Issue resolved Date/Time',j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j, vendor_product v
where j.jobstatus_name=@Status and m.client_code=d.client_code and u.userid=d.Issue_resolved_BY and j.jobstatus_id=d.status_code and v.product_code=d.product_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPSolution
-- --------------------------------------------------

CREATE proc [dbo].[SPSolution]
@product varchar(50),@type varchar(50),@nature varchar(Max),@problem varchar(MAX)
as
select top 1 f.Solution,f.briefsolution,u.username,f.Added_on,u1.username,f.reviewed_on
from faq_details f, user_master u , user_master u1
where f.added_by=u.userid and f.reviewed_by=u1.userid and product_Name=ltrim(@product) and FAQ_type=ltrim(@type) and Faq_nature=ltrim(@nature) and problem=@problem and Faq_status=1 
order by faq_id Desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spSummaryEOD_AKRUTI
-- --------------------------------------------------


CREATE proc [dbo].[spSummaryEOD_AKRUTI]
@id varchar(50),@access varchar(50)
as
if @access = 'L1TL'
begin
select u.username as Resource,count(status_code) as [No of Issues],j.jobstatus_Name as [Status]
from issuedetails_AKRUTI d,user_master u,jobstatusMaster j
where u.userid=d.issue_resolved_by and d.status_code=j.jobstatus_id and left(issue_resolved_datetime,11) like left(getdate(),11)
group by j.jobstatus_Name,u.username
end
else
begin
select u.username as Resource,count(status_code) as [No of Issues],j.jobstatus_Name as [Status]
from issuedetails_AKRUTI d,user_master u,jobstatusMaster j
where u.userid=d.issue_resolved_by and d.issue_resolved_by=@id and d.status_code=j.jobstatus_id and left(issue_resolved_datetime,11) like left(getdate(),11)
group by j.jobstatus_Name,u.username
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPUpdate_AKRUTI
-- --------------------------------------------------
CREATE proc SPUpdate_AKRUTI
@ticket char(15),@id char(15),@remark varchar(200)
as
Update IssueDetails_Akruti 
set status_code='C',issue_resolved_by=@id ,remark=@remark
where docket_number=@ticket
select @ticket

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPUpdateMessage
-- --------------------------------------------------



CREATE procedure [dbo].[SPUpdateMessage]
@MsgID int, @Message text, @FromDate datetime, @Ftime datetime,@ToDate datetime,
@Ttime datetime
as 
update sent_messages 
set message_sent=@Message , mess_valid_from =(@FromDate+@Ftime), mess_valid_to=(@ToDate+@Ttime)
where msg_id=@msgid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPUpdateMessageAll
-- --------------------------------------------------



CREATE procedure [dbo].[SPUpdateMessageAll]
@OldMessage text, @Message text, @FromDate datetime,@Ftime datetime, @ToDate datetime,@Ttime datetime
as 
update sent_messages 
set message_sent=@Message , mess_valid_from =(@FromDate+@Ftime), mess_valid_to=(@ToDate+@Ttime)
where message_sent like @OldMessage

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPUpdatePublishData
-- --------------------------------------------------



CREATE proc [dbo].[SPUpdatePublishData]
@id int,@product varchar(max),@type varchar(20),@nature varchar(max),@problem varchar(max),@sol text,@brief text,@remark varchar(50),@by varchar(50),@on datetime
as
update faq_details
set product_name=@product,faq_type=@type,faq_nature=@nature,problem=@problem,solution=@sol,briefsolution=@brief,remark=@remark,faq_status=1,reviewed_by=@by,reviewed_on=@on
where faq_id=@id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPUpdateRating
-- --------------------------------------------------

Create procedure [dbo].[SPUpdateRating]
@UserID varchar(10),
@Date datetime,
@Communication varchar(2),
@Product varchar(2),
@Interpersonal varchar(2),
@CallConduct varchar(2),
@Total varchar(3),
@EmployeeName varchar(20)
as
set @UserID = (Select userid from user_master where (username=@EmployeeName))
--elect @userID 
update executive_rating
set Emp_ID=@UserID,
date=@Date,
Communication=@Communication,
Product_Knowledge=@Product,
Interpersonal_skills=@Interpersonal,
Conduct_on_calls=@CallConduct,
Total=@Total
where 
Emp_ID=@UserID and date=@Date

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPUpdateUserProfile
-- --------------------------------------------------
CREATE proc [dbo].[SPUpdateUserProfile]
@userid varchar(15),
@username varchar(120),
@dob datetime,
@teamname varchar(100),
@rolename varchar(100),
@teamlead varchar(100),
@Branch varchar(100),
@Contact varchar(15),
@Mobile varchar(15),
@Email varchar(120),
@createDate datetime,
@AcctStatus varchar(15),
@LoginStatus bit
as
update user_master
set 
username=@username,dob=@dob,
team_id=(select Team_id from team_master where team_name=@teamname),
role_id=(select role_id from role_master where role_name=@rolename),
teamleader=(select userid from user_master where username=@teamlead),
branch_id=@Branch, contact_number=@contact,mobile=@mobile,
email=@email,creation_date=@createDate,account_status =@AcctStatus,
login_status=@LoginStatus
where userid=@userid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SummaryReportDummy
-- --------------------------------------------------
Create proc SummaryReportDummy
as
begin

select count (j.jobstatus_name )as Completed ,o.Branch_Name
from 
tbl_newclient_details d,
tbl_it_Odinmaster o,
jobstatusmaster j
where 
d.client_code=o.odin_id and 
j.jobstatus_id=d.status_code and 
d.status_code in ('ITC')and 
issue_type='IT'
Group by 
Branch_Name,status_code

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test1
-- --------------------------------------------------
CREATE proc dbo.test1
as
select * from client_master m,client_details d, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test18112009
-- --------------------------------------------------
create proc [dbo].[test18112009]
as


select * from user_master where teamleader=user_master.userid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test19112009
-- --------------------------------------------------
CREATE proc [dbo].[test19112009]
@access varchar(50),@User_id varchar(50)
as 
if @access ='L1EX' or @access ='ITL1EX' or @access ='L2FEX'or @access ='ITL2EXO' or @access ='ITL2EXN'or @access ='ITL2EXV' or @access ='L2TEX'or @access ='ITL2EXO' or @access ='ITL2EXN'or @access ='ITL2EXV' or @access ='L3EX'or @access ='ITL3EX'
begin
select username 
from user_master
where Role_id=@access and Userid=@User_id
end

else if @access ='L1TL'or @access ='ITL1TL'or @access ='L2FTL'or @access ='ITL2TLO' or @access ='ITL2TLN' or @access ='ITL2TLV' or @access ='L2TTL' or @access ='ITL2TLO' or @access ='ITL2TLN' or @access ='ITL2TLV' or @access ='L3TL' or @access ='ITL3TL'
begin
select username 
from user_master
where Role_id= @access
end

else if @access='ADM'
begin
Select * from user_master
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test26112009
-- --------------------------------------------------

create proc [dbo].[test26112009]


as 

begin
Select * from user_master
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Testdata
-- --------------------------------------------------

CREATE proc [dbo].[Testdata]
@BranchCode char(15)
as
select t.docket_number as 'Docket Number',d.Client_code as 'Client Code',m.branch_code as 'Branch code',
v.product_name as 'Product Name',d.nature as 'Nature',d.problem as 'Problem',d.Issue_Raised_dateTime as 'Issue Raised Date/Time',
u.Team_ID as 'Issue resolved level',u.UserName as 'Issue resolved by',d.Issue_Resolved_dateTime as 'Issue Resolved Date/Time',
j.jobstatus_name as 'Status'
from client_master m,client_details d, user_master u, jobstatusmaster j,vendor_product v,task_details t
where v.product_code=''

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UDP_UPDATE_ALLVLMSINHOUSE_Weekly
-- --------------------------------------------------
CREATE PROC UDP_UPDATE_ALLVLMSINHOUSE_Weekly  
 --Created By : Mahendra Bonde  
 --Created On : 16 Nov 2010  
 --Description : Update Weekly VLMSINHOUSE From [MIDDLEWARE].[HARMONY] At 6 AM On Sunday Only  
As  
Begin  
  
 Delete VLMSInhouse  
 Insert Into VLMSInhouse  
 Select * From [MIDDLEWARE].[HARMONY].DBO.VLMSInhouse with (nolock)  
    
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UDP_UPDATE_VLMSINHOUSE_Daily
-- --------------------------------------------------
CREATE PROC [dbo].[UDP_UPDATE_VLMSINHOUSE_Daily]  
 --Created By : Mahendra Bonde  
 --Created On : 16 Nov 2010  
 --Description : Update Daily VLMSINHOUSE From [MIDDLEWARE].[HARMONY] At 6 AM Except Sunday  
As  
Begin  
  
 Insert Into VLMSInhouse  
 Select * From [MIDDLEWARE].[HARMONY].DBO.VLMSInhouse with (nolock)  
 Where [Emp No] in ( Select Distinct [Emp No] From [MIDDLEWARE].[HARMONY].DBO.VLMSInhouse with (nolock)  
  Where [Emp NO] not in ( Select Distinct [Emp No] From VLMSInhouse with (nolock)))  
   
  
 Delete VLMS_RolemasterEquity  
 Insert Into VLMS_RolemasterEquity  
 Select * From VLMS_RolemasterEquity  
  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UpdateAdvanceinfo
-- --------------------------------------------------
CREATE Proc [dbo].[UpdateAdvanceinfo]
@Client_COde char(25),
@OS varchar(100),
@sp int,
@IP Char(20),
@ISP varchar(100),
@Processor varchar(40),
@RAM char(20),
@Ex_Remark varchar(200)
as
begin
update advance_information set operating_system=@os,service_pack=@sp,ip=@ip,isp=@isp,processor=@processor,ram=@ram,Executive_remark=@ex_remark
where client_code=@client_code
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ADD_EMPDATA
-- --------------------------------------------------
create  Proc USP_ADD_EMPDATA
@Emp_Id As varchar(10),
@Emp_Name As varchar(10),
@HOD As varchar(10),
@Role_Id As varchar(10),
@Project_Manager As varchar(10),
@Project_Leader As varchar(10),
@Option As varchar(10)
AS 
Begin       
	If(@Option=1)
	Begin
		update Resource_Master
        Set Role_ID=@Role_Id, Project_Manager=@Project_Manager,Project_Leader=@Project_Leader
		Where Emp_ID=@Emp_Id
  	End

	Else If(@Option=2)
	Begin
		Insert into Resource_Master(Emp_ID,Emp_Name,HOD,Role_ID,Project_Manager,Project_Leader)
		values(@Emp_Id,@Emp_Name,@HOD,@Role_Id,@Project_Manager,@Project_Leader)
	End

	Else If(@Option=3)
	Begin
		select Distinct Emp_ID,
        HOD=(Case When RM1.HOD<>'' Then (Select Emp_Name From Resource_Master Where Emp_ID=RM1.HOD) When RM1.HOD='' Then '' End)
		from Resource_Master RM1
	End

	Else If(@Option=4)
	Begin
		select Distinct RM1.Role_ID,ROM.Role_Name
        from Resource_Master RM1 join rolemaster ROM
		on RM1.role_id=ROM.role_id 
	End

	Else If(@Option=5)
	Begin
		select distinct Emp_ID,Emp_Name from Resource_Master where Role_ID='PM' 
	End

	Else If(@Option=6)
	Begin
		select distinct Emp_ID,EMP_NAME from Resource_Master Where Role_id='PL' 
	End


End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AutoMailer_User_Login
-- --------------------------------------------------



CREATE proc [dbo].[usp_AutoMailer_User_Login] 
@uid as nvarchar(15),
@pass as nvarchar(15)
as
select * from AutoMailer_User_Master where userid=@uid and password=@pass

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AutoMailer_User_Master_AllOprns
-- --------------------------------------------------

create proc [dbo].[usp_AutoMailer_User_Master_AllOprns]
@Userid as varchar(15),
@UserName as varchar(120),
@Branch_Tag as char(15),
@Email as varchar(120),
@Access_Id as char(15),
@From_Email as nvarchar(100),
@Password as varchar(50),
@Opration as varchar(15)
as
if(@Opration='S')
begin
	select * from AutoMailer_User_Master where userid=@userid
end
if(@Opration='U')
begin
	update AutoMailer_User_Master set 
						Userid= @Userid, 
						UserName= @UserName,
						Branch_Tag= @Branch_Tag,
						Email= @Email,
						Access_Id= @Access_Id,
						From_Email= @From_Email,
						Password= @Password
	where Userid= @Userid 
end
if(@Opration='I')
begin
	insert into AutoMailer_User_Master values(@Userid,@UserName,@Branch_Tag,@Email,@Access_Id,@From_Email,@Password)
end
if(@Opration='D')
	delete from AutoMailer_User_Master where Userid= @Userid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BO_Operation
-- --------------------------------------------------







CREATE PROC [dbo].[USP_BO_Operation]

@Docket_Number AS Char(25),
@Employee_Code AS Char(25),
@Employee_Name AS Varchar(250),
@Department AS Char(50),
@Mobile AS char(12),
@Email As varchar(50),
@Attendance_Location As Varchar(100),
@Product_Code AS char(25),
@Application_Name AS Varchar(100),
@Nature AS varchar(50),
@Problem AS Varchar(250),
@Issue_Type As Varchar(200),
@Brief_Solution As Varchar(5000),
@BSE AS Bit,
@NSE As Bit,
@NSEFO As Bit, 
@MCX As Bit, 
@NCDEX AS Bit, 
@NSE_Currency As Bit,
@MCX_Currency As Bit,
@MFSS As Bit,
@NA As Bit,
@Call_Source As Char(10),
@Issue_Raised_Datetime AS Datetime, 
@Issue_Time As Datetime,
@Issue_Resolved_Datetime AS Datetime,
@Issue_Resolved_By AS Char(25), 
@Executive_Remark AS Varchar(2000),
@Employee_ExistsFlag As bit,
@Status_Code AS Char(20),
@Emp_ID AS Char(25),
@Role_ID AS Char(20),
@Option AS Int

As 
Begin
	Declare @Emp_Code AS Varchar(20)
	
	If(@Option = 1 ) -- Insert BO Support Record
	Begin

		Insert Into tbl_BOIssueMaster
			(Docket_Number,Employee_Code,Employee_Name,Department,Mobile,Email,Attendance_Location,Product_Code,Application_Name,
				Nature,Problem,Issue_Type,Brief_Solution,BSE,NSE,NSEFO,MCX,NCDEX,NSE_Currency,MCX_Currency,MFSS,NA,Call_Source,
				Issue_Raised_Datetime,Issue_Time,Issue_Resolved_Datetime,Issue_Resolved_By,Executive_Remark,Employee_ExistsFlag,Status_Code)
		Values 
			('',@Employee_Code,@Employee_Name,@Department,@Mobile,@Email,@Attendance_Location,@Product_Code,@Application_Name,
				@Nature,@Problem,@Issue_Type,@Brief_Solution,@BSE,@NSE,@NSEFO,@MCX,@NCDEX,@NSE_Currency,@MCX_Currency,@MFSS,@NA,@Call_Source,
				@Issue_Raised_Datetime,@Issue_Time,@Issue_Resolved_Datetime,@Issue_Resolved_By,@Executive_Remark,@Employee_ExistsFlag,@Status_Code)

		Select @Docket_Number=max(convert(int,Docket_Number)) From tbl_BOIssueMaster

		Insert Into tbl_BOIssueDetails
		Select '', Docket_Number, Employee_Code,Employee_Name,Department,Mobile,Email,Attendance_Location,Product_Code,Application_Name,
				 Nature, Problem, Issue_Type,Brief_Solution,BSE,NSE,NSEFO,MCX,NCDEX,NSE_Currency,MCX_Currency,MFSS,NA,Call_Source,
				Issue_Raised_Datetime,Issue_Time,Issue_Resolved_Datetime,Issue_Resolved_By,Executive_Remark,Employee_ExistsFlag,Status_Code
		From tbl_BOIssueMaster
		Where Docket_Number=@Docket_Number

		Select @Docket_Number
		
	End
	Else If(@Option = 2)
	Begin
		Select Distinct rtrim(Name_Of_Application) From Tbl_Application with (nolock)
	End
	Else if(@Option = 3)
	Begin
		Select Distinct rtrim(Sub_Application) From Tbl_Application with (nolock) 
		Where rtrim(Name_Of_Application)=rtrim(@Product_Code)
	End
	Else If(@Option = 4)
	Begin
		Select Distinct rtrim(Nature) From Tbl_Nature_Request with (nolock)
	End
	Else if(@Option = 5)
	Begin
		Select Distinct rtrim(Request) From Tbl_Nature_Request with (nolock) 
		Where rtrim(Nature)=rtrim(@Nature)
	End
	Else If(@Option = 6)
	Begin
		Select Distinct rtrim(Solution) From Tbl_BOSolution with (nolock)
	End
	Else if(@Option = 7)
	Begin
		Select Distinct rtrim(Type_Of_Call) From Tbl_BO_CallType with (nolock) 
	End
	Else if(@Option = 8)
	Begin
		Select Emp_Name, Department, Phone, AttendanceLoc, emailadd From VLMSInhouse
		Where [Emp No]=@Employee_Code

		Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source AS [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
		From tbl_BOIssueMaster with (nolock)
		Where Employee_Code=@Employee_Code
		Order By Issue_raised_Datetime DESC

	End
	Else if(@Option =9)
	Begin
		If(@Role_ID = 'SPOC')
		Begin
			If(@Email = '')
			Begin
				Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type,Call_Source As [Call Source],
					(Case When Employee_Code<>'' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
						Else '' End) AS Reported_By, 
					Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
					UM.UserName As Resolved_By, 
					(Case when  (tbl_BOIssueMaster.Issue_Resolved_By is null or tbl_BOIssueMaster.Issue_Resolved_By = '') then '' when tbl_BOIssueMaster.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO],
					(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>'01 Jan 1900' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
						Else '' End) As [Pending On], 
					Executive_Remark As Remark
				From tbl_BOIssueMaster , User_Master UM
				Where Status_Code in  ('P','RO' ) And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
					And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID='BO' And Account_status=1 
											Union Select UserID From User_Master Where Role_ID='ADM' And Account_status=1 )
				Order By Issue_Raised_Datetime Desc
			End
		End
		Else If(@Role_ID = 'BOTL')
		Begin
			If(@Email ='')
			Begin
				Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type, Call_Source As [Call Source],
					(Case When Employee_Code<>'' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
						Else '' End) AS Reported_By, 
					Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
					UM.UserName As Resolved_By, 
					(Case when  (tbl_BOIssueMaster.Issue_Resolved_By is null or tbl_BOIssueMaster.Issue_Resolved_By = '') then '' when tbl_BOIssueMaster.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO],
					(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>'01 Jan 1900' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
						Else '' End) As [Pending On], 
					Executive_Remark As Remark
				From tbl_BOIssueMaster , User_Master UM
				Where Status_Code in  ('P','RO' ) And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
					--And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Teamleader=@Emp_ID And Account_status=1 Union Select @Emp_ID)
					And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID='BO' And Account_status=1 
											Union Select UserID From User_Master Where Role_ID='ADM' And Account_status=1 )
				Order By Issue_Raised_Datetime Desc
			End
		End
		Else If(@Role_ID = 'BOEX')
		Begin
			If(@Email ='')
			Begin
				Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type, Call_Source As [Call Source],
					(Case When Employee_Code<>'' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
						Else '' End) AS Reported_By, 
					Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
					UM.UserName As Resolved_By, 
					(Case when  (tbl_BOIssueMaster.Issue_Resolved_By is null or tbl_BOIssueMaster.Issue_Resolved_By = '') then '' when tbl_BOIssueMaster.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO],
					(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>'01 Jan 1900' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
						Else '' End) As [Pending On], 
					Executive_Remark As Remark
				From tbl_BOIssueMaster , User_Master UM
				Where Status_Code in  ('P','RO' ) And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
					--And tbl_BOIssueMaster.Issue_Resolved_By=@Emp_ID And UM.Account_Status=1
					And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID='BO' And Account_status=1 
											Union Select UserID From User_Master Where Role_ID='ADM' And Account_status=1 )
				Order By Issue_Raised_Datetime Desc
			End
		End
		Else If(@Role_ID = 'ITL1TL')
		Begin
			Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type, Call_Source As [Call Source],
				(Case When Employee_Code<>'' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
					Else '' End) AS Reported_By, 
				Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
				UM.UserName As Resolved_By, 
				(Case when  (tbl_BOIssueMaster.Issue_Resolved_By is null or tbl_BOIssueMaster.Issue_Resolved_By = '') then '' when tbl_BOIssueMaster.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO],
				(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>'01 Jan 1900' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
					Else '' End) As [Pending On], 
				Executive_Remark As Remark
			From tbl_BOIssueMaster , User_Master UM
			Where Status_Code in  ('P','RO' ) And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
				And tbl_BOIssueMaster.Issue_Resolved_By = @Emp_ID And UM.Account_Status=1
--				And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID='BO' And Account_status=1 
--										Union Select UserID From User_Master Where Role_ID='ADM' And Account_status=1 )
			Order By Issue_Raised_Datetime Desc
		End
		Else If(@Role_ID = 'ADM' Or @Role_ID = 'M' or @Role_ID = 'ITL3TL')
		Begin
			If(@Email ='')
			Begin
				Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type, Call_Source As [Call Source],
					(Case When Employee_Code<>'' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
						Else '' End) AS Reported_By, 
					Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
					UM.UserName As Resolved_By, 
					(Case when  (tbl_BOIssueMaster.Issue_Resolved_By is null or tbl_BOIssueMaster.Issue_Resolved_By = '') then '' when tbl_BOIssueMaster.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO],
					(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>'01 Jan 1900' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
						Else '' End) As [Pending On], 
					Executive_Remark As Remark
				From tbl_BOIssueMaster , User_Master UM
				Where Status_Code in  ('P','RO' ) And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
					And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID='BO' And Account_status=1 
											Union Select UserID From User_Master Where Role_ID='ADM' And Account_status=1 )
					And UM.Account_Status=1
				Order By Issue_Raised_Datetime Desc
			End
			Else If(@Email <>'')
			Begin
				Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type, Call_Source As [Call Source],
					(Case When Employee_Code<>'' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
						Else '' End) AS Reported_By, 
					Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
					UM.UserName As Resolved_By, 
					(Case when  (tbl_BOIssueMaster.Issue_Resolved_By is null or tbl_BOIssueMaster.Issue_Resolved_By = '') then '' when tbl_BOIssueMaster.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO],
					(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>'01 Jan 1900' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
						Else '' End) As [Pending On], 
					Executive_Remark As Remark
				From tbl_BOIssueMaster , User_Master UM
				Where Status_Code in  ('P','RO' ) And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
					And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID='BO' And Account_status=1 And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code=@Email)
											Union Select UserID From User_Master Where Role_ID='ADM' And Account_status=1 )
					And UM.Account_Status=1
				Order By Issue_Raised_Datetime Desc
			End
		End
	End
	Else If(@Option=10)
	Begin	
		If(@Role_ID = 'BOTL' Or @Role_ID = 'SPOC')
		Begin
			Select Employee_Code AS EC, Employee_Name AS EN, 
				(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Department End) AS Dept,
				(Case When Employee_Code<>'' Then (Select EmailAdd From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Email End) AS Email,
				TBM.Mobile AS Mo, Attendance_Location As Address,
				Product_Code AS PC, Application_Name AS App, Nature AS Nature, Problem  AS PR, Issue_Type AS IT, Brief_Solution AS BS,
				BSE, NSE, NSEFO, MCX, NCDEX, NSE_Currency AS NSEC, MCX_Currency AS MCXC, MFSS, NA,Call_Source,
				Issue_Raised_Datetime AS IRD1, Issue_Resolved_Datetime AS IRD2, 
				Issue_Resolved_By AS IRB, Executive_Remark AS Remark, Employee_ExistsFlag As Flag, Status_Code AS Status
			From Tbl_BOIssueMaster TBM, User_Master UM
			Where Docket_Number=@Docket_Number And TBM.Issue_Resolved_By=UM.Userid
				--And Issue_Resolved_By in (Select Userid From User_Master Where Teamleader=@Emp_ID And User_Master.Account_Status=1 And Account_status=1 Union Select @Emp_ID)
						

			IF((Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)<>'')
			Begin
				Set @Emp_Code = (Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)

				Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
				From tbl_BOIssueMaster with (nolock)
				Where Employee_Code=@Emp_Code
				Order By Issue_raised_Datetime DESC
			End

		End
		Else If(@Role_ID = 'BOEX')
		Begin
			Select Employee_Code AS EC, Employee_Name AS EN, 
				(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Department End) AS Dept,
				(Case When Employee_Code<>'' Then (Select EmailAdd From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Email End) AS Email,
				TBM.Mobile AS Mo, Attendance_Location As Address,
				Product_Code AS PC, Application_Name AS App, Nature AS Nature, Problem  AS PR, Issue_Type AS IT, Brief_Solution AS BS,
				BSE, NSE, NSEFO, MCX, NCDEX, NSE_Currency AS NSEC, MCX_Currency AS MCXC, MFSS, NA ,Call_Source ,
				Issue_Raised_Datetime AS IRD1, Issue_Resolved_Datetime AS IRD2,  
				Issue_Resolved_By AS IRB, Executive_Remark AS Remark, Employee_ExistsFlag As Flag, Status_Code AS Status
			From Tbl_BOIssueMaster TBM, User_Master UM
			Where Docket_Number=@Docket_Number And TBM.Issue_Resolved_By=UM.Userid And UM.Account_Status=1
				--And Issue_Resolved_By=@Emp_ID 


			IF((Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)<>'')
			Begin
				Set @Emp_Code = (Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)

				Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
				From tbl_BOIssueMaster with (nolock)
				Where Employee_Code=@Emp_Code
				Order By Issue_raised_Datetime DESC
			End
		End
			Else If(@Role_ID = 'ITL1TL')
		Begin
			Select Employee_Code AS EC, Employee_Name AS EN, 
				(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Department End) AS Dept,
				(Case When Employee_Code<>'' Then (Select EmailAdd From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Email End) AS Email,
				TBM.Mobile AS Mo, Attendance_Location As Address,
				Product_Code AS PC, Application_Name AS App, Nature AS Nature, Problem  AS PR, Issue_Type AS IT, Brief_Solution AS BS,
				BSE, NSE, NSEFO, MCX, NCDEX, NSE_Currency AS NSEC, MCX_Currency AS MCXC, MFSS, NA ,Call_Source ,
				Issue_Raised_Datetime AS IRD1, Issue_Resolved_Datetime AS IRD2,  
				Issue_Resolved_By AS IRB, Executive_Remark AS Remark, Employee_ExistsFlag As Flag, Status_Code AS Status
			From Tbl_BOIssueMaster TBM, User_Master UM
			Where Docket_Number=@Docket_Number And TBM.Issue_Resolved_By=UM.Userid And UM.Account_Status=1
				--And Issue_Resolved_By=@Emp_ID 


			IF((Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)<>'')
			Begin
				Set @Emp_Code = (Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)

				Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
				From tbl_BOIssueMaster with (nolock)
				Where Employee_Code=@Emp_Code
				Order By Issue_raised_Datetime DESC
			End
		End
		Else If(@Role_ID = 'ADM' Or @Role_ID='M' or @Role_ID = 'ITL3TL')
		Begin
			Select Employee_Code AS EC, Employee_Name AS EN, 
				(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Department End) AS Dept,
				(Case When Employee_Code<>'' Then (Select EmailAdd From VLMSInhouse Where [Emp no]=Employee_Code)
					Else TBM.Email End) AS Email,
				TBM.Mobile AS Mo, Attendance_Location As Address,
				Product_Code AS PC, Application_Name AS App, Nature AS Nature, Problem  AS PR, Issue_Type AS IT, Brief_Solution AS BS,
				BSE, NSE, NSEFO, MCX, NCDEX, NSE_Currency AS NSEC, MCX_Currency AS MCXC, MFSS, NA ,Call_Source ,
				Issue_Raised_Datetime AS IRD1, Issue_Resolved_Datetime AS IRD2,  
				Issue_Resolved_By AS IRB, Executive_Remark AS Remark, Employee_ExistsFlag As Flag, Status_Code AS Status
			From Tbl_BOIssueMaster TBM, User_Master UM
			Where Docket_Number=@Docket_Number And TBM.Issue_Resolved_By=UM.Userid And UM.Account_Status=1 
				--And TBM.Issue_Resolved_By in (Select Userid From User_Master Where Role_ID in ('BOEX','BOTL') And Account_status=1)

			IF((Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)<>'')
			Begin
				Set @Emp_Code = (Select distinct Employee_Code From Tbl_BOIssueMaster Where Docket_Number=@Docket_Number)

				Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code)
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
				From tbl_BOIssueMaster with (nolock)
				Where Employee_Code=@Emp_Code
				Order By Issue_raised_Datetime DESC
			End
		End
	End
	Else If(@Option=11)
	Begin
		Update Tbl_BOIssueMaster
		Set Product_Code=@Product_Code, Application_Name=@Application_Name,
			Nature=@Nature, Problem=@Problem, Issue_Type=@Issue_Type, Brief_Solution=@Brief_Solution,
			BSE=@BSE, NSE=@NSE, NSEFO=@NSEFO, MCX=@MCX, NCDEX=@NCDEX, NSE_Currency=@NSE_Currency,
			MCX_Currency=@MCX_Currency, MFSS=@MFSS, NA=@NA, Call_Source=@Call_Source,
			Issue_Resolved_Datetime=@Issue_Resolved_Datetime, Issue_Time=@Issue_Time, 
			Issue_Resolved_By=@Issue_Resolved_By,
			Executive_Remark=@Executive_Remark, Status_Code=@Status_Code
		Where Docket_Number=@Docket_Number

		Insert Into tbl_BOIssueDetails
		Select '', Docket_Number, Employee_Code,Department,Employee_Name,Mobile,Email,Attendance_Location,
				Product_Code,Application_Name,
				 Nature, Problem, Issue_Type,Brief_Solution,BSE,NSE,NSEFO,MCX,NCDEX,NSE_Currency,MCX_Currency,MFSS,NA,Call_Source ,
				Issue_Raised_Datetime,Issue_Time,Issue_Resolved_Datetime,Issue_Resolved_By,Executive_Remark,Employee_ExistsFlag,Status_Code
		From tbl_BOIssueMaster
		Where Docket_Number=@Docket_Number

		Select @Docket_Number
	End
	Else If(@Option=12)
	Begin
--		If(@Role_ID='BOEX')
--		Begin
--			Select UserName From User_Master
--			Where userid=@Emp_ID And Role_ID='BOEX'
--		End
--		Else If(@Role_ID='BOTL')
--		Begin
--			Select UserName From User_Master
--			Where Teamleader=@Emp_ID And Account_Status=1 And Role_ID='BOEX'
--			
--			union 
--
--			Select UserName From User_Master
--			Where userid=@Emp_ID
--			
--		End
--		Else If(@Role_ID='ADM' Or @Role_ID='M' Or @Role_ID='SPOC')
--		Begin
--			Select UserName From User_Master
--			Where Account_Status=1 And Team_ID in ('BO')
--
--			Union
--
--			Select UserName From User_Master
--			Where Account_Status=1 And Role_ID in ('ADM')
--		End
			Select UserName
			From
			(
		
			Select UserName From User_Master
			Where Account_Status=1 And Team_ID in ('BO','SPOC')

			Union

			Select UserName From User_Master
			Where Account_Status=1 And Role_ID in ('ITL1TL','ITL3TL')
			) T
			Order by UserName
			
	End
	Else if(@Option = 13)
	Begin

		Select [Emp No], Emp_Name, Department, Phone, AttendanceLoc, emailadd 
		From VLMSInhouse with (nolock)
		Where UPPER((Select top 1 items From dbo.Split(emailadd,'@')))=UPPER(@Email) And Status='A'
	
		Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code And Status='A')
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
		From tbl_BOIssueMaster with (nolock)
		Where Employee_Code=(Select [Emp No] From VLMSInhouse
						Where UPPER((Select top 1 items From dbo.Split(emailadd,'@')))=UPPER(@Email) And Status='A')
--Where UPPER(emailadd)=UPPER(@Email)
--Select top 1 items From dbo.Split('mahendrad.bonde@angeltrade.com','@')
		Order By Issue_raised_Datetime DESC

	End
	Else If(@Option=14)
	Begin
		Select distinct Emp_Name From VLMSInhouse with (nolock)
		Where Status='A'
		Order by Emp_Name
	End
	Else if(@Option = 15)
	Begin

		Select [Emp No], Emp_Name, Department, Phone, AttendanceLoc, emailadd 
		From VLMSInhouse with (nolock)
		Where UPPER(Emp_Name)=UPPER(@Employee_Name) And Status='A'
	
		Select Distinct top 3 Docket_Number As [Docket Number], Product_Code as [Product] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND 
							NSE_Currency=0 AND MCX_Currency=0 AND MFSS=0) Then 'NA'
								Else 
							((CASE When BSE=1 Then  'BSE, ' Else '' End ) + 
							 (CASE When NSE=1 Then 'NSE, ' Else '' End ) + 
							 (CASE When NSEFO=1 Then 'NSEFO, ' Else '' End ) + 
							 (CASE When MCX=1 Then 'MCX, '  Else ''End ) + 
							 (CASE When NCDEX=1 Then 'NCDEX, ' Else '' End ) +
							 (CASE When NSE_Currency=1 Then 'NSE Currency, ' Else '' End ) +
							 (CASE When MCX_Currency=1 Then 'MCX Currency, ' Else '' End ) +
							 (CASE When MFSS=1 Then 'MFSS' Else '' End ) 
							) End
						) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
						(Case When Employee_Code<>'' Then (Select Department From VLMSInhouse Where [Emp no]=Employee_Code And Status='A')
							Else '' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						Issue_Resolved_Datetime as [Resolved On],Executive_Remark as [Remark], 
						(Case When Status_code='P' Then 'Pending' When Status_Code='C' Then 'Complete' 
						Else '' End) as [Status]
		From tbl_BOIssueMaster with (nolock)
		Where Employee_Code=(Select [Emp No] From VLMSInhouse
						Where UPPER(Emp_Name)=UPPER(@Employee_Name) And Status='A')
		Order By Issue_raised_Datetime DESC

	End
	Else If(@Option=16)
	Begin
		Declare @Query varchar(MAX)

		Set @Query = '
				Select Docket_Number, Product_Code, Application_Name, Nature, Problem, Issue_Type, Call_Source As [Call Source],
					(Case When Employee_Code<>'''' Then (Select Emp_Name From VLMSInhouse Where [Emp No]=Employee_Code)
						Else '''' End) AS Reported_By, 
					Convert(Varchar(12),Issue_Raised_Datetime,113) AS Reported_On, 
					UM.UserName As Resolved_By, 
					(Case When Convert(Varchar(12),Issue_Resolved_Datetime,113)<>''01 Jan 1900'' Then Convert(Varchar(12),Issue_Resolved_Datetime,113)
						Else '''' End) As [Pending On], 
					Executive_Remark As Remark
				From tbl_BOIssueMaster with (nolock) , User_Master UM with (nolock)
				Where Status_Code = ''C'' And tbl_BOIssueMaster.Issue_Resolved_By=UM.Userid
					And tbl_BOIssueMaster.Issue_Resolved_By in (Select Userid From User_Master Where Team_ID in (''BO'',''ITL1TL'',''ITL3TL'') And Account_status=1 
											Union Select UserID From User_Master Where Role_ID=''ADM'' And Account_status=1 )
					And UM.Account_Status=1

			'

		If(@Docket_Number <>'')
		Begin
			Set @Query = @Query + ' And Docket_Number=''' + @Docket_Number + ''''
		End

		If(@Issue_Resolved_By <>'' And UPPER(@Issue_Resolved_By)<>UPPER('ALL'))
		Begin
			Set @Query = @Query + ' And tbl_BOIssueMaster.Issue_Resolved_By = ''' + rtrim(@Issue_Resolved_By) + ''''
		End

		If(@Issue_Raised_Datetime<>'' And @Issue_Resolved_Datetime<>'')
		Begin
			Set @Query = @Query + '	And 
						Convert(Datetime,Convert(Varchar(12),Convert(Datetime,Issue_Resolved_Datetime),113)) Between 
						Convert(Datetime, ''' + Convert(Varchar(12),Convert(Datetime,@Issue_Raised_Datetime),113) + ''') And 
						Convert(Datetime, ''' + Convert(Varchar(12),Convert(Datetime,@Issue_Resolved_Datetime+1),113) + ''')'
		End

		Print (@Query)

		Exec(@Query)
		
	End
	Else If(@Option = 17)
	Begin
		Update tbl_BOIssueMaster
		Set Status_Code='RO'
		Where Docket_Number=@Docket_Number

		Insert Into tbl_BOIssueDetails
		Select '', Docket_Number, Employee_Code,Employee_Name,Department,Mobile,Email,Attendance_Location,Product_Code,Application_Name,
				 Nature, Problem, Issue_Type,Brief_Solution,BSE,NSE,NSEFO,MCX,NCDEX,NSE_Currency,MCX_Currency,MFSS,NA,Call_Source,
				Issue_Raised_Datetime,Issue_Time,Issue_Resolved_Datetime,Issue_Resolved_By,Executive_Remark,Employee_ExistsFlag,Status_Code
		From tbl_BOIssueMaster
		Where Docket_Number=@Docket_Number

		Select @Docket_Number
	End
	ELSE If(@Option=18)
	Begin
		Select UserName 
		From User_Master with (nolock)
		Where Role_ID in ('BOEX','BOTL','SPOC','ITL1TL','ITL3TL') And Account_status=1
		Order By Username
	End
	
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_BOIssueReport
-- --------------------------------------------------

CREATE proc [dbo].[usp_BOIssueReport]

@Docket_number as  varchar(50),
@Employee_Code As Char(25),
@Product_code as char(25),
@Application As varchar(100),
@Issue_Type As varchar(200),
@Call_Source As Char(10),
@From_Date as  datetime,
@To_Date as datetime,
@Issue_Resolved_BY as  char(25),
@Emp_Type As Char(10),
@Emp_ID As Char(25),
@Role_ID As Char(25),
@Status as char(20),
@Requestor AS Char(50)

As
Begin
	Declare @Query as Nvarchar(Max)
	Declare @Emp_Exists AS bit

	Begin
		set @Query = 'Select Distinct Docket_Number As [Docket Number], Product_Code as [Application] , 
						Application_Name as [SubApplication] , Nature as [Nature] , 
						(Case When (BSE=0 AND NSE=0 AND NSEFO=0 AND MCX=0 AND NCDEX=0 AND NSE_Currency=0 
									AND MCX_Currency=0 AND MFSS=0) Then ''NA''
									Else 
								((CASE When BSE=1 Then  ''BSE, '' Else '''' End ) + 
								 (CASE When NSE=1 Then ''NSE, '' Else '''' End ) + 
								 (CASE When NSEFO=1 Then ''NSEFO, '' Else '''' End ) + 
								 (CASE When MCX=1 Then ''MCX, ''  Else '''' End ) + 
								 (CASE When NCDEX=1 Then ''NCDEX, '' Else '''' End ) +
								 (CASE When NSE_Currency=1 Then ''NSE Currency, '' Else '''' End ) +
								 (CASE When MCX_Currency=1 Then ''MCX Currency, '' Else '''' End ) +
								 (CASE When MFSS=1 Then ''MFSS'' Else '''' End ) 
								) End
							) AS [Segments],Call_Source As [Call Source],
						Problem  as [Problem], Brief_Solution AS [Brief_Soluttion],
						Issue_Type as [IssueType],Employee_Name as [ReportedBy], 
--						(Case When Department<>'''' Then (Select Department From [196.1.115.158].HELPDESK.DBO.VLMSInhouse Where [Emp no]=Employee_Code)
--							Else '''' End) AS Dept,
						(Case When Department<>'''' Then Department Else '''' End) AS Dept,
						Attendance_Location As Location,
						Issue_raised_Datetime as [Reported On],  
						(Select UserName From User_Master Where Userid=Issue_Resolved_By) as [Resolved by],
						(Select CSO_Code From Tbl_ITBranchMaster where Branch_Code in (Select Branch_ID From User_Master Where Userid=Issue_Resolved_By)) As CSO,
						(Case When Status_Code=''P'' Then Convert(Varchar,Issue_Resolved_Datetime,113)
							Else '''' End) as [Pending On],
						(Case When Status_Code=''C'' Then Convert(Varchar,Issue_Resolved_Datetime,113)
							Else '''' End) as [Resolved On],
						Executive_Remark as [Remark], 
						(Case When Status_code=''P'' Then ''Pending'' When Status_Code=''C'' Then''Complete'' 
						Else '''' End) as [Status]
					  From tbl_BOIssueMaster where 1=1'

	End
--
--						BSE, NSE, NSEFO, MCX, NCDEX, NSE_Currency AS [NSE Currency], MCX_Currency As [MCX Currency],
--						MFSS , NA As [Not Applicable] ,

	If(@Emp_Type = 'YES' )
	Begin
		Set @Query=@Query+ ' And Employee_ExistsFlag=''TRUE'''
	End
	Else If(@Emp_Type = 'NO' )
	Begin
		Set @Query=@Query+ ' And Employee_ExistsFlag=''FALSE'''
	End
	

	If(@Docket_number <>'')
	Begin
		Set @Query=@Query+ ' And Docket_Number=''' + @Docket_number + ''''
	End

	If(@Call_Source <>'')
	Begin
		Set @Query=@Query+ ' And Call_Source=''' + @Call_Source + ''''
	End


	If(@Application<>'')
	Begin
		Set @Query = @Query + ' And Application_Name=''' + rtrim(@Application) + ''''
	End

	If(@Issue_Type<>'')
	Begin
		Set @Query = @Query + ' And Issue_Type=''' + rtrim(@Issue_Type) + ''''
	End

	If(@Employee_Code <>'')
	Begin
		Set @Query=@Query+ ' And Employee_Code=''' + rtrim(@Employee_Code) + ''''
	End

	If(@Product_code <>'')
	Begin
		Set @Query=@Query+ ' And Product_code=''' + rtrim(@Product_code) + ''''
	End

	If(@Requestor <>'')
	Begin
		Set @Query=@Query+ ' And Employee_Name like (''%' + rtrim(@Requestor) + '%'')'
	End
	

	If(@From_Date  <> ''  and @To_Date <> '')
	Begin
		--Set @Query=@Query+ ' And (Convert(Datetime,Convert(varchar(12),Issue_raised_Datetime,113)) Between ''' + Convert(Datetime,Convert(varchar(12),@From_Date,113)) + ''' and ''' + Convert(Datetime,Convert(varchar(12),@To_Date,113)) +''')'
		--set @query=@query+ 'and Issue_raised_Datetime between '''+convert(varchar(100),cast(@From_Date as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@To_Date) as datetime)) +''''
		set @query=@query+ 'and ((Issue_raised_Datetime between '''+convert(varchar(100),cast(@From_Date as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@To_Date) as datetime)) +''') OR (Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@From_Date as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@To_Date) as datetime)) +'''))'
	End
	Else If(@From_Date = ''  and @To_Date = '')
	Begin
		--Set @Query=@Query+ ' And (Convert(Datetime,Convert(varchar(12),Issue_raised_Datetime,113)) Between ''' + Convert(Datetime,Convert(varchar(12),@From_Date,113)) + ''' and ''' + Convert(Datetime,Convert(varchar(12),@To_Date,113)) +''')'
		--set @query=@query+ 'and Issue_raised_Datetime between '''+convert(varchar(100),cast(getdate() as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,getdate()) as datetime)) +''''
		set @query=@query+ 'and ((Issue_raised_Datetime between '''+convert(varchar(100),cast(getdate() as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,getdate()) as datetime)) +''') OR (Issue_Resolved_Datetime between '''+convert(varchar(100),cast(getdate() as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,getdate()) as datetime)) +'''))'
	End

	If(@Issue_Resolved_BY <> '')
	Begin
--		If(@Role_ID='BOEX')
--		Begin
			Set @Query=@Query+ 'And Issue_Resolved_BY=(Select Userid From User_Master Where UPPER(username)=''' + upper(rtrim(@Issue_Resolved_BY)) + ''')'
--		End
--		Else If(@Role_ID='BOTL')
--		Begin 
--			Set @Query=@Query+ ' And Issue_Resolved_BY=''' + @Issue_Resolved_BY + ''''
--		End
	End
--	Else If(@Issue_Resolved_BY = '' And @Role_ID='BOTL')
--	Begin
--		Set @Query = @Query  + ' And Issue_Resolved_BY in (Select userid From User_Master Where teamleader=''' + @Emp_ID + ''' And Account_Status=1 Union Select ''' + @Emp_ID + ''')'
--	End
--	Else If(@Issue_Resolved_BY = '' And @Role_ID='SPOC')
--	Begin
--		Set @Query = @Query  + ' And Issue_Resolved_BY in (Select userid From User_Master Where Team_ID=''BO'' And Account_Status=1)'
--	End
	Else If(@Issue_Resolved_BY = '' )
	Begin
		Set @Query = @Query  + ' And Issue_Resolved_BY in (Select userid From User_Master Where Team_ID=''BO'' And Account_Status=1 UNION Select userid From User_Master Where Role_ID in (''ITL1TL'',''ITL3TL'',''ADM'') And Account_Status=1)'
	End

	If(@Status <> '')
	Begin
		if(@Status='Pending')
			Set @Status = 'P'
		else if(@Status='Complete')
			Set @Status = 'C'

		Set @Query=@Query+ ' And Status_Code=''' + rtrim(@Status) + ''''
	End

		Set @Query=@Query+ ' Order By  Issue_Raised_Datetime DESC'

	Print @Query
	Exec (@Query)
	
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BRIssue_Report
-- --------------------------------------------------



CREATE proc [dbo].[USP_BRIssue_Report]

@Docket_Number as char(10),
@Branch_Tag  as varchar(10),
@Employee as varchar(100),
@Existing_Branch as char(5),
@call_Type  as char(20),
@Issue_Area  as varchar(50),
@Nature as varchar(50),
@Resource as  varchar(50),
@From_Date  as datetime,
@To_Date as datetime,
@Status  as char(20) ,
@User As Char(20),
@Role AS Char(20),
@Team As Varchar(20)


As
Begin
	Declare @Query as Varchar(Max)

	--Select @Existing_Branch

	Begin
		set @Query = 'Select Docket_No , Branch_Tag , Branch_Name , 
                      Employee_Name As [Query Raised By], Issue_Raised_Datetime , Issue_Resolved_Datetime , 
					  Convert(Varchar(8),Issue_Resolving_time,114) AS [Issue_Resolving_time] ,                     			 
					  call_Type , Issue_Area , Nature , Problem,
                      Brief_solution , Remark , 
					  (Case When Issue_Resolved_by<>'''' Then (Select UserName From User_Master Where Userid=Issue_Resolved_by And Account_Status=1) End) AS [Issue_Resolved_by] ,					  
					  (Case When Issue_Resolved_by<>'''' Then (Select AttendanceLoc From VLMSInhouse with (nolock) Where Status=''A'' and [Emp No] = Issue_Resolved_by) End) AS [Employee Location] ,					  
					  (Case  When Status_code=''P'' Then  ''Pending'' When Status_Code=''C'' Then ''Completed'' End) AS Status
                      from TBL_BRIssue_Master where 1=1'

    End

	If(@Docket_number <>'')
	Begin
		Set @Query=@Query+ ' And Docket_No =''' + @Docket_number + ''''
	End

	If(@Branch_Tag <>'')
	Begin
		Set @Query = @Query + ' And Branch_Tag =''' + @Branch_Tag + ''''
	End

	If(@Employee <>'')
	Begin
		Set @Query = @Query + ' And UPPER(Employee_Name) =''' + UPPER(@Employee) + ''''
	End

	If(rtrim(Convert(char, @Existing_Branch)) <>'' And upper(rtrim(Convert(char, @Existing_Branch))) <> Upper('All'))
	Begin
		Set @Query=@Query+ ' And Convert(char, Existing_Branch) =''' +  rtrim(Convert(char,Convert(bit,@Existing_Branch)))  + ''''
	End

	If(@Resource <>'')
	Begin
		If(@Role = 'ITL1EX' Or @Role = 'ITL2EXO' Or @Role = 'ITL2EXN' Or @Role = 'ITL2EXI' Or @Role = 'ITL2EXS')
		Begin
			If(@Resource<>'ALL')
			Begin
				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where UPPER(USERNAME)=''' + UPPER(@Resource) + ''' And Account_status=1) '
			End
			Else If(@Resource='ALL')
			Begin
				Set @Query=@Query+ ' And Issue_Resolved_by in (Select distinct Employee_ID From tbl_TeamleaderMaster
											Where Teamleader in (Select distinct Teamleader From tbl_TeamleaderMaster 
											Where Employee_ID= ''' + rtrim(@User) + ''')) '
			End
		End
		Else If(@Role = 'ITL1TL' Or @Role = 'ITL2TLO' Or @Role = 'ITL2TLN' Or @Role = 'ITL2TLI' Or @Role = 'ITL2TLS')
		Begin
			If(@Resource<>'ALL')
			Begin
				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where UPPER(USERNAME)=''' + UPPER(@Resource) + ''' And Account_status=1) '
			End
			Else If(@Resource='ALL')
			Begin
				Set @Query=@Query+ ' And Issue_Resolved_by in (Select distinct Employee_ID From tbl_TeamleaderMaster
											Where Teamleader = ''' + rtrim(@User) + ''') '
			End
		End
		Else If(@Role = 'ITL3TL' Or @Role = 'ADM' OR @Role='M')
		Begin
			If(@Resource<>'ALL')
			Begin
				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where UPPER(USERNAME)=''' + UPPER(@Resource) + ''' And Account_status=1) '
			End
			Else If(@Resource='ALL')
			Begin
				Set @Query=@Query+ ' And Issue_Resolved_by in (Select distinct UserID From User_Master
											Where Role_ID in (''ITL1EX'',''ITL1TL'',''ITL2EXO'',''ITL2TLO'',
												''ITL2EXN'',''ITL2TLN'',''ITL2EXI'',''ITL2TLI'',''ITL2EXS'',
												''ITL2TLS'',''ITL3TL'',''ADM''))'
			End
		End

--		If(@Role = 'L1BREX')
--		Begin	
--			If(@Resource<>'ALL')
--			Begin
--				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where UPPER(USERNAME)=''' + UPPER(@Resource) + ''' And Account_status=1)'
--			End
--			Else If(@Resource = 'ALL')
--			Begin	
--				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where Team_ID in (''L1BR'',''L2BR'',''L3BR'') And Account_status=1 )'
--			End
--
--		End
--		Else If(@Role = 'L2BREX')
--		Begin	
--			If(@Resource<>'ALL')
--			Begin
--				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where UPPER(USERNAME)=''' + UPPER(@Resource) + ''' And Account_status=1)'
--			End
--			Else If(@Resource='ALL')
--			Begin
--				--Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where Teamleader=''' + @User + ''' And Account_status=1 Union Select ''' + @User + ''')'
--				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where Team_ID in (''L1BR'',''L2BR'',''L3BR'') And Account_status=1)'
--			End
--		End
--		Else If(@Role = 'L3BREX')
--		Begin
--			If(@Resource<>'ALL')
--			Begin
--				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where UPPER(USERNAME)=''' + UPPER(@Resource) + ''' And Account_status=1)'
--			End
--			Else If(@Resource='ALL')
--			Begin	
--				Set @Query=@Query+ ' And Issue_Resolved_by in (Select UserID From USer_Master Where Role_ID in (''L1BREX'',''L2BREX'',''L3BREX'') And Account_status=1 )'
--			End
--		End
	End

	If(@Team <> '')
	Begin
		Set @Query=@Query+ ' And (Select UPPER(rtrim(Team)) From Team_Master Where Team_ID in  (Select Distinct Team_ID From User_Master Where UserID=rtrim(Issue_Resolved_by))) =''' + UPPER(rtrim(@Team)) + ''''
	End

    If(@Call_Type <>'' And @Call_Type<>'ALL')
	Begin
		Set @Query=@Query+ ' And rtrim(call_type) =''' + rtrim(@Call_Type) + ''''
	End
    
    If(@Issue_Area <>'')
	Begin
		Set @Query=@Query+ ' And rtrim(Issue_Area)=''' + rtrim(@Issue_Area) + ''''
	End

    If(@Nature <>'')
	Begin
		Set @Query=@Query+ ' And rtrim(Nature) =''' + rtrim(@Nature)  + ''''
	End

	If(@Docket_number ='')
	Begin
		If(@From_Date  <> ''  and  @To_Date <> '')
		Begin
			set @query=@query+ 'and Issue_raised_Datetime between '''+convert(varchar(100),cast(@From_Date as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@To_Date) as datetime)) +''''
		End
	End

    If(@Status <> '')
	Begin
		If(@Status='P')
		Begin
          set @Query=@Query+ ' And Status_Code=''' + @Status + ''''
        End
		Else If(@Status='C')
		Begin
		Set @Query=@Query+ ' And Status_Code=''' + @Status + ''''
        End
	End

	Print @Query
	Exec (@Query)
	
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BRSupport_Operation
-- --------------------------------------------------
CREATE Proc [dbo].[USP_BRSupport_Operation]

@Docket_No  As Char(10),
@Branch_Tag AS Varchar(10),
@Branch_Name As Varchar(100),
@Branch_Address AS Varchar(500),
@Boardline_No As Varchar(50),
@Branch_State As Varchar(25),
@Region AS Varchar(25),
@Zone AS Varchar(25),
@Employee_ID AS Varchar(10),
@Employee_Name As Varchar(100),
@Dept_Desg AS Varchar(100),
@Issue_Raised_Datetime As Datetime,
@Issue_Resolved_Datetime AS Datetime,
@Issue_Resolving_Time AS Datetime,
@Issue_Type AS Char(10), 
@Existing_Branch As Bit,
@Call_type AS Char(20),
@Issue_Area As Varchar(50),
@Nature As Varchar(50),
@Problem As Varchar(200),
@Brief_Solution As Varchar(5000),
@Remark As Varchar(MAX),
@Issue_Resolved_By As varchar(50),
@Team_ID As Varchar(50),
@Status_Code AS Char(20), 
@EmpID AS char(20),
@Role_ID AS Char(20),
@Emailadd As varchar(100),
@CallMail As char(10),
@Option As Int

As 
Begin
	Declare @EmpNo as varchar(10)

	If(@Option = 1)
	Begin

		Insert Into Tbl_BRIssue_Master
			(Docket_No, Branch_Tag, Branch_Name, Branch_Address, Boardline_No, Branch_State, Region, Zone, 
				Employee_ID, Employee_Name, Dept_Desg, Issue_Raised_Datetime, Issue_Resolved_Datetime, Issue_Resolving_Time,
				Issue_Type, Existing_Branch, Call_Type, Issue_Area, Nature, Problem, Brief_Solution,
				Remark, Issue_Resolved_By, Team_ID, Status_Code,Emailadd,Call_Mail)
		Values ('', @Branch_Tag, @Branch_Name, @Branch_Address, @Boardline_No, @Branch_State, @Region, @Zone,
					@Employee_ID, @Employee_Name, @Dept_Desg, @Issue_Raised_Datetime, @Issue_Resolved_Datetime,
					@Issue_Resolving_Time, @Issue_Type, @Existing_Branch, @Call_Type, @Issue_Area,
					@Nature, @Problem, @Brief_Solution, @Remark, @Issue_Resolved_By, @Team_ID,
					@Status_Code,@Emailadd,@CallMail)

		Select @Docket_No=max(convert(int,Docket_No)) From Tbl_BRIssue_Master

		Insert Into Tbl_BRIssue_Details
		Select '' , Docket_No, Branch_Tag, Branch_Name, Branch_Address, Boardline_No, Branch_State, Region, Zone, 
				Employee_ID, Employee_Name, Dept_Desg, Issue_Raised_Datetime, Issue_Resolved_Datetime, Issue_Resolving_Time,
				Issue_Type, Existing_Branch, Call_Type, Issue_Area, Nature, Problem, Brief_Solution,
				Remark, Issue_Resolved_By, Team_ID, Status_Code , Emailadd , Call_Mail
		From Tbl_BRIssue_Master
		Where Docket_No=@Docket_No

		Select @Docket_No

	End
	Else If(@Option = 2) -- Issue Area
	Begin
		Select Distinct rtrim(ISSUE_AREA) From Tbl_BRKB_Master
	End
	Else If(@Option=3)  -- Nature 
	Begin 
		Select Distinct rtrim(Nature) From Tbl_BRKB_Master Where rtrim(UPPER(ISSUE_AREA)) = rtrim(UPPER(@Issue_Area))
	End
	Else If(@Option =4) -- Problem
	Begin
		Select Distinct rtrim(Problem) From Tbl_BRKB_Master
		Where rtrim(UPPER(ISSUE_AREA)) = rtrim(UPPER(@Issue_Area))
			And rtrim(UPPER(Nature)) = rtrim(UPPER(@Nature))
	End 
	Else If(@Option=5) 
	Begin
		Select Distinct rtrim(Brief_Solution) From Tbl_BRKB_Master
		Where rtrim(UPPER(ISSUE_AREA)) = rtrim(UPPER(@Issue_Area))
			And rtrim(UPPER(Nature)) = rtrim(UPPER(@Nature)) And rtrim(UPPER(Problem)) = rtrim(UPPER(@Problem)) 
	End
	Else If(@Option=6)
	Begin
		Select Distinct Branch_Code, Branch_Name, ISNULL(Branch_Address, '') AS Branch_Address,
				ISNULL(ITContactPersonContactNumber, '') As ITConatctNo, ISNULL(Branch_Boardline, '') As Branch_Boardline, 
				ISNULL(Branch_State, '') AS Branch_State, ISNULL(IT_Cat_Code,'') AS IT_Category_Code, 
				Isnull(CSO_Code, '') AS CSO_Code, ISNULL(Region_Code, '') AS Region_Code, ISNULL(Zone_Code,'') AS Zone_Code
		From tbl_ITBranchMaster 
		Where Branch_Code=@Branch_Tag
	End
	Else If(@Option =7)
	Begin
		Select [Emp No] AS Emp_ID, Emp_Name, (Department + '-' + Designation) AS Dept_Desg , emailadd as [Emailadd]
		From VLMSInhouse
		Where [Emp No]=@Employee_ID And Status='A'

		Select distinct CostCode  From VLMSInhouse
		where [Emp No] = @Employee_ID And Status='A'
	End
	Else if(@Option =8)
	Begin 
		
		Update Tbl_BRIssue_Master
		Set Status_Code=@Status_Code, Issue_Resolved_Datetime=@Issue_Resolved_Datetime,
			Issue_Resolving_Time=@Issue_Resolving_Time, Brief_Solution=@Brief_Solution,
			Issue_Resolved_By=@Issue_Resolved_By, Team_ID=@Team_ID, Remark=@Remark
		Where Docket_No=@Docket_No
		
		Insert Into Tbl_BRIssue_Details
		Select '' , Docket_No, Branch_Tag, Branch_Name, Branch_Address, Boardline_No, Branch_State, Region, Zone, 
				Employee_ID, Employee_Name, Dept_Desg, Issue_Raised_Datetime, Issue_Resolved_Datetime, Issue_Resolving_Time,
				Issue_Type, Existing_Branch, Call_Type, Issue_Area, Nature, Problem, Brief_Solution,
				Remark, Issue_Resolved_By, Team_ID, Status_Code ,Emailadd , Call_Mail
		From Tbl_BRIssue_Master
		Where Docket_No=@Docket_No

		Select @Docket_No
	End
	Else IF(@Option=9)
	Begin
		If(@Role_ID = 'ITL1EX' Or @Role_ID = 'ITL2EXO' Or @Role_ID = 'ITL2EXN' Or @Role_ID = 'ITL2EXI' Or @Role_ID = 'ITL2EXS')
		Begin
			Select Docket_No AS [Docket No], Branch_Tag AS [Branch Tag], Branch_Name As [Branch],  
					Employee_Name As [Employee],Emailadd As [Email],
					(Convert(Varchar(12),Issue_Raised_Datetime,113)) AS [Issue_Raised_Datetime] , 
					Issue_Area As [Issue Area], Nature, Problem, Brief_Solution AS [Brief Solution], Remark,
					Call_Type As [Call Type],Call_Mail as [Call],
					(Convert(Varchar(12),Issue_Resolved_Datetime,113) ) AS [Issue Pending Datetime], 
					(Convert(Varchar(8),Issue_Resolving_Time,114)) AS [Issue Resolving Time (In Hrs:Min:Sec)],
					(Case when Existing_Branch=1 Then 'True' Else 'False' End) AS [Existing Branch], UM.UserName AS [Issue Pending by],
					(Case when  (TBRIM.Issue_Resolved_By is null or TBRIM.Issue_Resolved_By = '') then '' when TBRIM.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO]
			From Tbl_BRIssue_Master TBRIM, User_Master UM
			Where Status_Code='P' And TBRIM.Issue_Resolved_By=UM.Userid And UM.Account_Status=1
				And TBRIM.Issue_Resolved_By in (Select distinct Employee_ID From tbl_TeamleaderMaster
					Where Teamleader in (Select distinct Teamleader From tbl_TeamleaderMaster Where Employee_ID=@EmpID))
			Order by (Convert(Varchar(12),Issue_Raised_Datetime,113)) DESC
		End
		Else If(@Role_ID = 'ITL1TL' Or @Role_ID = 'ITL2TLO' Or @Role_ID = 'ITL2TLN' Or @Role_ID = 'ITL2TLI' Or @Role_ID = 'ITL2TLS')
		Begin
			Select Docket_No AS [Docket No], Branch_Tag AS [Branch Tag], Branch_Name As [Branch],  
					Employee_Name As [Employee],Emailadd As [Email],
					(Convert(Varchar(12),Issue_Raised_Datetime,113)) AS [Issue_Raised_Datetime] , 
					Issue_Area As [Issue Area], Nature, Problem, Brief_Solution AS [Brief Solution], Remark,
					Call_Type As [Call Type],Call_Mail as [Call],
					(Convert(Varchar(12),Issue_Resolved_Datetime,113) ) AS [Issue Pending Datetime], 
					(Convert(Varchar(8),Issue_Resolving_Time,114)) AS [Issue Resolving Time (In Hrs:Min:Sec)],
					(Case when Existing_Branch=1 Then 'True' Else 'False' End) AS [Existing Branch], UM.UserName AS [Issue Pending by] ,
					(Case when  (TBRIM.Issue_Resolved_By is null or TBRIM.Issue_Resolved_By = '') then '' when TBRIM.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO]
			From Tbl_BRIssue_Master TBRIM, User_Master UM
			Where Status_Code='P' And TBRIM.Issue_Resolved_By=UM.Userid And UM.Account_Status=1
				And TBRIM.Issue_Resolved_By in (Select Distinct Employee_ID From tbl_TeamleaderMaster Where Teamleader=@EmpID)
			Order by (Convert(Varchar(12),Issue_Raised_Datetime,113)) DESC
		End
		Else If(@Role_ID = 'ITL3TL' or @Role_ID = 'ADM')
		Begin
			If(@Boardline_No = '')
			Begin
				Select Docket_No AS [Docket No], Branch_Tag AS [Branch Tag], Branch_Name As [Branch],  
						Employee_Name As [Employee],Emailadd As [Email],
						(Convert(Varchar(12),Issue_Raised_Datetime,113)) AS [Issue_Raised_Datetime] , 
						Issue_Area As [Issue Area], Nature, Problem, Brief_Solution AS [Brief Solution], Remark,
						Call_Type As [Call Type],Call_Mail as [Call],
						(Convert(Varchar(12),Issue_Resolved_Datetime,113) ) AS [Issue Pending Datetime], 
						(Convert(Varchar(8),Issue_Resolving_Time,114)) AS [Issue Resolving Time (In Hrs:Min:Sec)],
						(Case when Existing_Branch=1 Then 'True' Else 'False' End) AS [Existing Branch], UM.UserName AS [Issue Pending by] ,
						(Case when  (TBRIM.Issue_Resolved_By is null or TBRIM.Issue_Resolved_By = '') then '' when TBRIM.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO]
				From Tbl_BRIssue_Master TBRIM, User_Master UM
				Where Status_Code='P' And TBRIM.Issue_Resolved_By=UM.Userid And UM.Account_Status=1
				Order by (Convert(Varchar(12),Issue_Raised_Datetime,113)) DESC
			End
			Else if(@Boardline_No <> '')
			Begin
				Select Docket_No AS [Docket No], Branch_Tag AS [Branch Tag], Branch_Name As [Branch],  
						Employee_Name As [Employee],Emailadd As [Email],
						(Convert(Varchar(12),Issue_Raised_Datetime,113)) AS [Issue_Raised_Datetime] , 
						Issue_Area As [Issue Area], Nature, Problem, Brief_Solution AS [Brief Solution], Remark,
						Call_Type As [Call Type],Call_Mail as [Call],
						(Convert(Varchar(12),Issue_Resolved_Datetime,113) ) AS [Issue Pending Datetime], 
						(Convert(Varchar(8),Issue_Resolving_Time,114)) AS [Issue Resolving Time (In Hrs:Min:Sec)],
						(Case when Existing_Branch=1 Then 'True' Else 'False' End) AS [Existing Branch], UM.UserName AS [Issue Pending by] ,
						(Case when  (TBRIM.Issue_Resolved_By is null or TBRIM.Issue_Resolved_By = '') then '' when TBRIM.Issue_Resolved_By is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code = UM.Branch_ID) End) as [CSO]
				From Tbl_BRIssue_Master TBRIM, User_Master UM
				Where Status_Code='P'  And UM.Account_Status=1
					 And TBRIM.Issue_Resolved_By=UM.Userid 
					 And TBRIM.Issue_Resolved_By in (Select Userid From User_Master Where Account_status=1 And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code=@Boardline_No))
				Order by (Convert(Varchar(12),Issue_Raised_Datetime,113)) DESC
			End
		End
	End
	Else If(@Option=10)
	Begin		
		
		Select Docket_No, Branch_Tag, Branch_Name, Branch_Address, Boardline_No, Branch_State, Region, Zone, 
				Employee_ID, Employee_Name, Dept_Desg, Issue_Raised_Datetime, Issue_Resolved_Datetime, Issue_Resolving_Time,
				Issue_Type, Existing_Branch, Call_Type, Issue_Area, Nature, Problem, Brief_Solution,
				Remark , Issue_Resolved_By, Team_ID, Status_Code,emailadd,Call_Mail
		From Tbl_BRIssue_Master
		Where Docket_No=@Docket_No

		If((Select Existing_Branch From Tbl_BRIssue_Master Where Docket_No=@Docket_No) = 'True')
		Begin
 			Select Distinct Branch_Code, Branch_Name, ISNULL(Branch_Address, '') AS Branch_Address,
					ISNULL(ITContactPersonContactNumber, '') As ITConatctNo, ISNULL(Branch_Boardline, '') As Branch_Boardline, 
					ISNULL(Branch_State, '') AS Branch_State, ISNULL(IT_Cat_Code,'') AS IT_Category_Code, 
					Isnull(CSO_Code, '') AS CSO_Code, ISNULL(Region_Code, '') AS Region_Code, ISNULL(Zone_Code,'') AS Zone_Code
			From tbl_ITBranchMaster 
			Where Branch_Code in (Select Branch_Tag From Tbl_BRIssue_Master Where Docket_No=@Docket_No)
		End

	End
	Else If(@Option =11)
	Begin
		Select Distinct Branch_Code 
		From tbl_ITBranchMaster
	End
	Else If(@Option=12)
	Begin
		If(@Role_ID = 'ITL1EX' Or @Role_ID = 'ITL2EXO' Or @Role_ID = 'ITL2EXN' Or @Role_ID = 'ITL2EXI' Or @Role_ID = 'ITL2EXS')
		Begin
			Select Distinct UserName From User_Master
			Where USERID in (Select distinct Employee_ID From tbl_TeamleaderMaster
					Where Teamleader in (Select distinct Teamleader From tbl_TeamleaderMaster Where Employee_ID=@EmpID)) 
				And Account_Status = 1 
			Order By UserName
		End
		Else If(@Role_ID = 'ITL1TL' Or @Role_ID = 'ITL2TLO' Or @Role_ID = 'ITL2TLN' Or @Role_ID = 'ITL2TLI' Or @Role_ID = 'ITL2TLS')
		Begin
			Select Distinct UserName From User_Master
			Where USERID in (Select Distinct Employee_ID From tbl_TeamleaderMaster Where Teamleader=@EmpID) 
				And Account_Status = 1 
			Order By UserName
		End
		Else If(@Role_ID = 'ITL3TL' or @Role_ID = 'ADM')
		Begin
			Select Distinct UserName From User_Master
			Where Role_ID in ('ITL1EX','ITL1TL','ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXI','ITL2TLI','ITL2EXS','ITL2TLS','ITL3TL','ADM')
				And Account_Status = 1 
			Order By UserName
		End
					

	End
	Else If(@Option=13)
	Begin
		Select distinct Emp_Name From VLMSInhouse with (nolock)
		Where Status='A'
		Order by Emp_Name
	End
	Else If(@Option = 14)
	Begin
		If(@Employee_Name <> '' and @Employee_Name is not null)
		Begin
			Select [Emp No], Emp_Name, Department, emailadd 
			From VLMSInhouse with (nolock)
			Where UPPER(Emp_Name)=UPPER(@Employee_Name) And Status='A'
			
			Select distinct Branch_ID  From User_Master
			 where Userid = (Select [Emp No] From VLMSInhouse with (nolock)
								Where UPPER(Emp_Name)=UPPER(@Employee_Name) And Status='A')
		End				
	End
	Else If(@Option = 15)
	Begin
		If(@Emailadd <> '' and @Emailadd is not null)
		Begin
			Select [Emp No] , Emp_Name, Department, emailadd 
			From VLMSInhouse with (nolock)
			Where UPPER((Select top 1 items From dbo.Split(emailadd,'@')))=UPPER(@Emailadd) And Status='A'
	
			Select distinct Branch_ID  From User_Master 
			where Userid = (Select [Emp No] From VLMSInhouse with (nolock)
							Where UPPER((Select top 1 items From dbo.Split(emailadd,'@')))=UPPER(@Emailadd) And Status='A')
		End						
	End
	Else If(@Option = 16)
	Begin	
		If(@Branch_Tag <> '' and @Branch_Tag is not null)
		Begin	
			Select distinct top 3 IM.Docket_No as [Docket No], IM.Branch_Tag as [Branch Tag], IM.Branch_Name as [Branch Name],  IM.Boardline_No as [Boardline No], IM.Region, 
				 IM.Employee_Name as [Emp Name], IM.Dept_Desg as [Dept Desg],IM.Emailadd as [Email],  
				 (Convert(Varchar(12),IM.Issue_Raised_Datetime,113)) AS [Issue Raised Datetime] , 
				 (Case when IM.Status_code = 'P' then Convert(Varchar(12),IM.Issue_Raised_Datetime,113) when IM.Status_Code = 'P' then '' End ) as [Issue Pending Datetime], 
				 (Case when IM.Status_code = 'P' then '' when Status_Code = 'C' then Convert(Varchar(12),Issue_Raised_Datetime,113) End) as [Issue Resolved Datetime], 
				 (Convert(Varchar(8),IM.Issue_Resolving_Time,114)) AS [Issue Resolving Time (In Hrs:Min:Sec)],
				(case when IM.Existing_Branch = 1 then 'true' when IM.Existing_Branch = 0 then 'false' end) as [Existing Branch], IM.Call_Type as [Call type],IM.Call_Mail as [Call] ,IM.Issue_Area as [Issue Area], IM.Nature, IM.Problem,
				IM.Remark, UM.UserName as [Issue Resolved By], IM.Team_ID as [Team Id], 
				(Case  When Status_code='P' Then  'Pending' When Status_Code='C' Then 'Completed' End) AS Status
			From Tbl_BRIssue_Master IM, User_MAster UM
			Where IM.Branch_Tag = @Branch_Tag
				and	IM.Issue_Resolved_By = UM.Userid
			Order By [Docket_No] DESC

			Select distinct top 1 left(Issue_raised_datetime,11) as [RaisedDate], left(issue_resolved_datetime,11) as [ResolvedDate],
					CONVERT(VARCHAR,issue_resolving_time,108) as [TotalTime],	Status_Code as [Status],
					UM.UserName as [Issue Resolved By]
				From Tbl_BRIssue_Master IM, User_MAster UM
			Where IM.Branch_Tag = @Branch_Tag
				and	IM.Issue_Resolved_By = UM.Userid
			Order By [RaisedDate] DESC
		End
		Else If(@EmpID <> '' and @EmpID is not null)
		Begin		
			Select distinct top 3 IM.Docket_No as [Docket No], IM.Branch_Tag as [Branch Tag], IM.Branch_Name as [Branch Name],  IM.Boardline_No as [Boardline No], IM.Region, 
				 IM.Employee_Name as [Emp Name], IM.Dept_Desg as [Dept Desg],IM.Emailadd as [Email],  
				 (Convert(Varchar(12),IM.Issue_Raised_Datetime,113)) AS [Issue Raised Datetime] , 
				 (Case when IM.Status_code = 'P' then Convert(Varchar(12),IM.Issue_Raised_Datetime,113) when IM.Status_Code = 'P' then '' End ) as [Issue Pending Datetime], 
				 (Case when IM.Status_code = 'P' then '' when Status_Code = 'C' then Convert(Varchar(12),Issue_Raised_Datetime,113) End) as [Issue Resolved Datetime], 
				 (Convert(Varchar(8),IM.Issue_Resolving_Time,114)) AS [Issue Resolving Time (In Hrs:Min:Sec)],
				(case when IM.Existing_Branch = 1 then 'true' when IM.Existing_Branch = 0 then 'false' end) as [Existing Branch], IM.Call_Type as [Call type],IM.Call_Mail as [Call] ,IM.Issue_Area as [Issue Area], IM.Nature, IM.Problem,
				IM.Remark, UM.UserName as [Issue Resolved By], IM.Team_ID as [Team Id], 
				(Case  When Status_code='P' Then  'Pending' When Status_Code='C' Then 'Completed' End) AS Status
			From Tbl_BRIssue_Master IM, User_MAster UM
			Where IM.Employee_ID = @EmpID 
				--and IM.Branch_Tag = @Branch_Tag
				and	IM.Issue_Resolved_By = UM.Userid
			Order By [Docket_No] DESC

			Select distinct top 1 left(Issue_raised_datetime,11) as [RaisedDate], left(issue_resolved_datetime,11) as [ResolvedDate],
					CONVERT(VARCHAR,issue_resolving_time,108) as [TotalTime],	Status_Code as [Status],
					UM.UserName as [Issue Resolved By]
				From Tbl_BRIssue_Master IM, User_MAster UM
			Where IM.Employee_ID = @EmpID 
				--IM.Branch_Tag = @Branch_Tag
				and	IM.Issue_Resolved_By = UM.Userid
			Order By [RaisedDate] DESC
		End
		
	End
	Else If(@Option = 17)
	Begin
		Select  Count(Docket_No) as [Totalcalls],
			ISnull((sum(datediff(minute,issue_raised_datetime,issue_resolved_datetime))),0) as  Totaltime,
			Isnull((sum(datediff(minute,issue_raised_datetime,issue_resolved_datetime))/count(Docket_No)),0) as Averagetime
		From Tbl_BRIssue_Master
		Where Branch_Tag = @Branch_Tag and Status_Code in ('P','C') 
			and month(Issue_Raised_datetime) between month(getdate())-2 and month(getdate())
		Group By Branch_Tag	
	End
	Else If(@Option=18)
	Begin
		If(@Role_ID = 'ITL1EX' Or @Role_ID = 'ITL2EXO' Or @Role_ID = 'ITL2EXN' Or @Role_ID = 'ITL2EXI' Or @Role_ID = 'ITL2EXS')
		Begin
			Select UserName From
			(
				Select Distinct UserName From User_Master
				Where USERID in (Select distinct Employee_ID From tbl_TeamleaderMaster
						Where Teamleader in (Select distinct Teamleader From tbl_TeamleaderMaster Where Employee_ID=@EmpID)) 
					And Account_Status = 1 

				UNION

				Select Distinct UserName From User_Master
				Where USERID in (Select distinct Employee_ID From tbl_TeamleaderMaster
						Where Teamleader in (Select distinct Teamleader From tbl_TeamleaderMaster Where Employee_ID=@EmpID)) 
					And Account_Status=0 And 
							Convert(Datetime, Convert(Varchar(12),Convert(Datetime,Separation_Date),113))>=
							Convert(Datetime, Convert(Varchar(12),Convert(Datetime,@Issue_Resolved_Datetime),113))
			) T
			Order By UserName
		End
		Else If(@Role_ID = 'ITL1TL' Or @Role_ID = 'ITL2TLO' Or @Role_ID = 'ITL2TLN' Or @Role_ID = 'ITL2TLI' Or @Role_ID = 'ITL2TLS')
		Begin
			Select UserName From
			(
				Select Distinct UserName From User_Master
				Where USERID in (Select Distinct Employee_ID From tbl_TeamleaderMaster Where Teamleader=@EmpID) 
					And Account_Status = 1 

				UNION

				Select Distinct UserName From User_Master
				Where USERID in (Select Distinct Employee_ID From tbl_TeamleaderMaster Where Teamleader=@EmpID) 
					And Account_Status=0 And Convert(Datetime, Convert(Varchar(12),Convert(Datetime,Separation_Date),113))>=
							Convert(Datetime, Convert(Varchar(12),Convert(Datetime,@Issue_Resolved_Datetime),113))
			) T
			Order By UserName
		End
		Else If(@Role_ID = 'ITL3TL' or @Role_ID = 'ADM')
		Begin
			Select UserName From
			(
				Select Distinct UserName From User_Master
				Where Role_ID in ('ITL1EX','ITL1TL','ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXI','ITL2TLI','ITL2EXS','ITL2TLS','ITL3TL','ADM')
					And Account_Status = 1 

				UNION

				Select Distinct UserName From User_Master
				Where Role_ID in ('ITL1EX','ITL1TL','ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXI','ITL2TLI','ITL2EXS','ITL2TLS','ITL3TL','ADM')
					And Account_Status=0 And 
							Convert(Datetime, Convert(Varchar(12),Convert(Datetime,Separation_Date),113))>=
							Convert(Datetime, Convert(Varchar(12),Convert(Datetime,@Issue_Resolved_Datetime),113))
			) T
			Order By UserName

--			Select Distinct UserName From User_Master
--			Where Role_ID in ('ITL1EX','ITL1TL','ITL2EXO','ITL2TLO','ITL2EXN','ITL2TLN','ITL2EXI','ITL2TLI','ITL2EXS','ITL2TLS','ITL3TL','ADM')
--				And Account_Status = 1 
--			Order By UserName
		End
	End
	Else If(@Option=19)
	Begin
		Select Team,Team_Name,Team_ID From Team_Master
		Where Team_ID in ('ITL1','ITL2I','ITL2N','ITL2S','ITL2O','ITL3','A')
		Order By [Order]
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DailyUpdate_CTCL_Details
-- --------------------------------------------------




CREATE Proc [dbo].[USP_DailyUpdate_CTCL_Details]

-------------------------------------------------------------------------------------------------------------
--Created By	: Mahendra Bonde
--Created On	: 6/7/2010
--Modified By	:
--Modified On	: 
-------------------------------------------------------------------------------------------------------------

As 
Begin
	
	----------------- Todays CTCL_Details Data 
	Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
		Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
	Into #CTCL_Details_Today
	From Ctcl_Details with (nolock)

	-----------------  New Data Insertion ----------------------
	Declare @Count As int
	Declare @Total As int

	Select top 1 Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
		Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
	Into #CTCL_Details_Backup 
	From Ctcl_Details with (nolock)

	Delete #CTCL_Details_Backup

	Select Distinct(Branch_Name) 
	Into #CTCL_Details_Branch
	From [INTRANET].[CTCL1.1].dbo.[V_CTCL_SB_Details] with (nolock)
	Order By Branch_Name

	Set @Count=0
	Set @Total=(Select Count(Branch_name) From #CTCL_Details_Branch with (nolock))

	While @Count < @Total
	Begin
		Select Distinct(ctcl_odinid) 
		Into #Temp_ODINID
		From Ctcl_Details with (nolock)
		Where Branch_name in (Select top 1 Branch_name From #CTCL_Details_Branch with (nolock))

		Select Distinct(CTCLID) 
		Into #Temp_CTCLID
		From Ctcl_Details with (nolock)
		Where Branch_name in (Select top 1 Branch_name From #CTCL_Details_Branch with (nolock))

		Select Distinct(ctcl_isbtag) 
		Into #Temp_ctclisbtag
		From Ctcl_Details with (nolock)
		Where Branch_name in (Select top 1 Branch_name From #CTCL_Details_Branch with (nolock))

		Select Distinct(CTclBranch_Segment) 
		Into #Temp_CTCLSegment
		From Ctcl_Details with (nolock)
		Where Branch_name in (Select top 1 Branch_name From #CTCL_Details_Branch with (nolock))

		Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
			Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
		Into #CTCL_Details_NEWDATA 
		From  [INTRANET].[CTCL1.1].dbo.[V_CTCL_SB_Details] with (nolock)
		Where Branch_name in (Select top 1 Branch_name From #CTCL_Details_Branch with (nolock)) 

		Insert Into #CTCL_Details_Backup
		
			Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
				Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
			From 
			(
				Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
					Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
				From #CTCL_Details_NEWDATA with (nolock)
				Where ctcl_odinid not in 
					(
						Select Distinct(ctcl_odinid) From #Temp_ODINID with (nolock)
					)
				
				UNION 

				Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
					Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
				From #CTCL_Details_NEWDATA with (nolock)
				Where CTCLID not in 
					(
						Select Distinct(CTCLID) From #Temp_CTCLID with (nolock)
					)
				
				UNION
			
				Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
					Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
				From #CTCL_Details_NEWDATA with (nolock)
				Where CTclBranch_Segment not in 
					(
						Select Distinct(CTclBranch_Segment) From #Temp_CTCLSegment with (nolock)
					)

				UNION

				Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
					Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
				From #CTCL_Details_NEWDATA with (nolock)
				Where ctcl_isbtag not in 
					(
						Select Distinct(ctcl_isbtag) From #Temp_ctclisbtag with (nolock)
					)
			) T 
			Order By Branch_Name

		Drop Table #Temp_ODINID
		Drop Table #Temp_CTCLID
		Drop Table #Temp_CTCLSegment
		Drop Table #Temp_ctclisbtag
		Drop Table #CTCL_Details_NEWDATA
		

		Delete #CTCL_Details_Branch
		Where Branch_name in (Select top 1 Branch_name From #CTCL_Details_Branch with (nolock))
		
		Set @Count = @Count + 1

	End
	
	Drop Table #CTCL_Details_Branch

	Insert Into #CTCL_Details_Today
	Select * From #CTCL_Details_Backup With (NOLOCK) Order By Branch_name 

	-----------------  Yesterdays ctcl_details BackUP	-----------------
	If Exists(Select Top 1 * From #CTCL_Details_Backup) 
	Begin
		If Exists (Select [Table_Name] From Information_Schema.Tables Where Table_Name='CTCL_Details_Yesterday')
		Begin
			Drop Table CTCL_Details_Yesterday
		End		

		Select Branch_Name, ctcl_odinid,  CtclBranch_Segment, CTCLID, Ctcl_ISBTag, Ctcl_AllotDate, Ctcl_DisablingDate,
			Ctcl_RegValidDate, CTCL_IBranch_cd, Ctcl_Status 
		Into CTCL_Details_Yesterday
		From Ctcl_Details with (nolock)	

	End

	Drop Table #CTCL_Details_Backup
	Delete CTCL_Details

	---------------- New Fresh Data ----------------------
	Insert Into CTCL_Details
		Select * From #CTCL_Details_Today With (NOLOCK) Order BY Branch_Name


	Drop Table #CTCL_Details_Today
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DailyUpdate_View_Subbroker
-- --------------------------------------------------
CREATE Proc [dbo].[USP_DailyUpdate_View_Subbroker]

As

Begin
	--------------------------- New Data Copy  -------------------------------- 

	Select 
		[Ref No] As RefNo, [TAG], [Segment], [Reg Name] As Regname, [TradeName], [Type], [Date Of Birth] As DOB,
		[Sex], [Res Address 1] As Resadd1, [Res Address 2] As Resadd2, [Res Address 3] As Resadd3, [Res City] As Rcity, 
		[Res Pincode] As ResPincode, [Off Address1] As OfAddress1, [Off Address2] As OffAddress2, [Off Address3] As OffAddress3,
		[Off City] As OffCity, [Off Pincode] As OffPincode, [Office Phone] As OfficePhone, [Mobile] As Mobile, 
		[Res Phone] As ResPhone, [Fax No] As [Fax No], [PAN], [Email ID] As EmailID, [Maker ID] As [Maker ID],
		[Maker Date] As [Maker Date], [TAGBranch] As TAGBranch, [GL Unregistered code] As [GL Unregistered code],
		[GL Registered Code] As [GL Registered Code], 
		[Regstatus], [Regdate], [Registration No] As [Registration No]
	Into #SB_COMP_View_Subbroker	
	From [MIS].[SB_Comp].dbo.[View_Subbroker] with (nolock)
	Order BY RefNO 

	--------------------------- Todays View Subbroker -------------------------------
	Select * 
	Into #View_Subbroker_Today
	From View_Subbroker  with (nolock)
	Order BY Tagbranch

	-----------------  New Data Insertion ----------------------
	Declare @Count As int
	Declare @Total As int

	
	Select top 1 * 
	Into #View_Subbroker_Backup
	From View_Subbroker  with (nolock)
	Order BY Tagbranch

	Delete #View_Subbroker_Backup

	Select Distinct Tagbranch 
	Into #View_Subbroker_Tagbranch
	From View_Subbroker  with (nolock)
	Where Tagbranch is not NULL or Tagbranch<>'' 
	Order BY Tagbranch 

	Set @Count=0
	Set @Total=(Select Count(Tagbranch) From #View_Subbroker_Tagbranch with (nolock))

	While @Count < @Total
	Begin

		Select distinct Segment 
		Into #View_Subbroker_Segment
		From View_Subbroker	with (nolock)
		Where Tagbranch in (Select Top 1 Tagbranch From #View_Subbroker_Tagbranch)

		------------------------ Segment ----------------------------------
		Select distinct Tag 
		Into #View_Subbroker_Tag
		From View_Subbroker	with (nolock)
		Where Tagbranch in (Select Top 1 Tagbranch From #View_Subbroker_Tagbranch)

		---------------------- New data copy for particular branch ---------------
		Select RefNo, TAG, Segment, Regname, TradeName, Type, DOB, Sex, Resadd1,
			Resadd2, Resadd3, Rcity, ResPincode, OfAddress1, OffAddress2, OffAddress3, OffCity,
			OffPincode, OfficePhone, Mobile, ResPhone, [Fax No], PAN, EmailID, [Maker ID],
			[Maker Date], TAGBranch, [GL Unregistered code], [GL Registered Code],
			Regstatus,  Regdate, [Registration No]
		Into #View_Subbroker_New_Data	
		From #SB_COMP_View_Subbroker with (nolock)
		Where Tagbranch in (Select Top 1 Tagbranch From #View_Subbroker_Tagbranch)
		Order By Tagbranch	
		

		Insert Into #View_Subbroker_Backup
			Select RefNo, TAG, Segment, Regname, TradeName, Type, DOB, Sex, Resadd1,
				Resadd2, Resadd3, Rcity, ResPincode, OfAddress1, OffAddress2, OffAddress3, OffCity,
				OffPincode, OfficePhone, Mobile, ResPhone, [Fax No], PAN, EmailID, [Maker ID],
				[Maker Date], TAGBranch, [GL Unregistered code], [GL Registered Code],
				Regstatus,  Regdate, [Registration No]
			From
			(
				Select RefNo, TAG, Segment, Regname, TradeName, Type, DOB, Sex, Resadd1,
					Resadd2, Resadd3, Rcity, ResPincode, OfAddress1, OffAddress2, OffAddress3, OffCity,
					OffPincode, OfficePhone, Mobile, ResPhone, [Fax No], PAN, EmailID, [Maker ID],
					[Maker Date], TAGBranch, [GL Unregistered code], [GL Registered Code],
					Regstatus,  Regdate, [Registration No]
				From #View_Subbroker_New_Data with (nolock)
				Where Segment Not In 
					(
						Select distinct Segment From #View_Subbroker_Segment with (nolock)
					)
				
				Union 

				Select RefNo, TAG, Segment, Regname, TradeName, Type, DOB, Sex, Resadd1,
					Resadd2, Resadd3, Rcity, ResPincode, OfAddress1, OffAddress2, OffAddress3, OffCity,
					OffPincode, OfficePhone, Mobile, ResPhone, [Fax No], PAN, EmailID, [Maker ID],
					[Maker Date], TAGBranch, [GL Unregistered code], [GL Registered Code],
					Regstatus,  Regdate, [Registration No]
				From #View_Subbroker_New_Data with (nolock)
				Where Tag Not In 
					(
						Select distinct Tag From #View_Subbroker_Tag with (nolock)
					)

			) T
			Order By Tagbranch



		Drop Table #View_Subbroker_Segment
		Drop Table #View_Subbroker_Tag
		Drop Table #View_Subbroker_New_Data


		Delete #View_Subbroker_Tagbranch
		Where Tagbranch in (Select Top 1 Tagbranch From #View_Subbroker_Tagbranch)

		Set @Count = @Count +  1
	End

	Drop Table #View_Subbroker_Tagbranch

	Insert Into #View_Subbroker_Today
		Select * From #View_Subbroker_Backup  with (nolock) Order By Tagbranch 

	If Exists (Select top 1 * From #View_Subbroker_Backup)
	Begin
		If Exists (Select [Table_Name] From Information_Schema.Tables Where Table_Name='View_Subbroker_Yesterday')
		Begin
			Drop Table View_Subbroker_Yesterday
		End

		Select * Into View_Subbroker_Yesterday
		From View_Subbroker with (nolock) 

	End

	Drop Table #View_Subbroker_Backup
	
	Delete View_Subbroker

	---------------- New Fresh Data ----------------------
	Insert Into View_Subbroker
	Select distinct RefNo, TAG, Segment, Regname, TradeName, [Type], DOB, Sex, Resadd1,
		Resadd2, Resadd3, Rcity, ResPincode, OfAddress1, OffAddress2, OffAddress3, OffCity,
		OffPincode, OfficePhone, Mobile, ResPhone, [Fax No], PAN, EmailID, [Maker ID],
		[Maker Date], TAGBranch, [GL Unregistered code], [GL Registered Code],
		Regstatus,  Regdate, [Registration No] 
	From #View_Subbroker_Today with (nolock)
	
	Drop Table #SB_COMP_View_Subbroker


End

-- Select top 1 * From View_Subbroker_Mahendra

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GenerateIssueAreaReport
-- --------------------------------------------------


CREATE proc [dbo].[usp_GenerateIssueAreaReport]
----- Helpdesk System Graphical Report
@FromDate as datetime,
@Todate as datetime
as
select tbl_CSOMaster.CentralSupport as [Central Support],tbl_it_kb_master.issue_area as [Issue Area], count(tbl_newclient_details.docket_number)as [Total Calls] from tbl_newclient_details
join tbl_it_kb_master on tbl_newclient_details.brief_solution=tbl_it_kb_master.brief_solution
join tbl_csomaster on tbl_CSOMaster.branch_tag=tbl_newclient_details.tagbranch
where tbl_newclient_details.issue_type='IT' and tbl_newclient_details.issue_resolved_datetime between @fromdate and @todate
group by tbl_CSOMaster.CentralSupport ,tbl_it_kb_master.issue_area
order by Issue_Area

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GenerateIssueTypeReport
-- --------------------------------------------------
CREATE proc [dbo].[usp_GenerateIssueTypeReport]
----- Helpdesk System Graphical Report
@FromDate as datetime,
@Todate as datetime
as
select tbl_CSOMaster.CentralSupport as [Central Support],tbl_it_kb_master.issue_type as [Issue Type], count(tbl_newclient_details.docket_number)as [Total Calls] from tbl_newclient_details
join tbl_it_kb_master on tbl_newclient_details.brief_solution=tbl_it_kb_master.brief_solution
join tbl_csomaster on tbl_CSOMaster.branch_tag=tbl_newclient_details.tagbranch
where tbl_newclient_details.issue_type='IT' and tbl_newclient_details.issue_resolved_datetime between @fromdate and @todate
group by tbl_CSOMaster.CentralSupport ,tbl_it_kb_master.issue_type
order by tbl_it_kb_master.issue_type

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetExecutive
-- --------------------------------------------------







CREATE proc [dbo].[USP_GetExecutive]

@User_ID varchar(50),
@Role varchar(50),
@Team varchar(100),
@location varchar(50),
@callType varchar(10),
@CSO AS Char(20)

as

if (@Role in ('L1TL','L2FTL','L2TTL'))
begin
	select username,userid from user_master where teamLeader=@User_ID And Account_Status=1 order by userName  
End      
if (@Role in ('ITL1TL','ITL1TLBR','ITL2TLI','ITL2TLS','ITL2TLO'))
begin
	if(@Role='ITL1TL') set @Team='IT L1 Team ' 
	else if(@Role='ITL1TLBR') set @Team='IT L1 Branch Team' 
	else if @Role='ITL2TLO' set @Team='Level 2 Technical Support Odin Team'
	else if @Role='ITL2TLS' set @Team='Level2 Technical Support System Team'
	else if @Role='ITL2TLI' set @Team='Level2 Technical Support InfraStructure Team'

	select username,userid from user_master where team_id like 'IT%' 
	and team_id in (select team_id from team_master where team_name=@Team) And Account_Status=1 
	and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location ) 
	order by username  
--	select * from team_master
--	select distinct um.username,um.userid from user_master um
--	where Userid in (select userid from UserId_TL where teamLeader1=@User_ID or TeamLeader2=@User_ID) 
--	order by userName
end
if(@Role in ('ITL2TLN','ITL2TLV'))
Begin
		if @Role='ITL2TLN' set @Team='Level2 Technical Support Network Team'
		else if @Role='ITL2TLV' set @Team='Level2 Technical Support VSAT Team'	

		select username,userid from user_master where team_id like 'IT%' 
		and team_id in ('ITL2N','ITL2V') And Account_Status=1 
		and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location ) 
		order by username  
End
if (@Role in('ITL1EX','ITL1EXBR','ITL2EXS','ITL2EXI','ITL2EXN','ITL2EXO','ITL2EXV','L1EX','L2FEX','L2TEX','L3EX'))
begin
	select username,userid from user_master where userid=@User_ID 
end
if (@Role in ('ADM','ITL3TL','ITL3EX','L3TL','L3EX'))
begin
	if (@callType='EBro')
	begin
		IF(@Team='ALL')
		Begin
			IF(@CSO<>'ALL')
			Begin
				select username,userid from user_master where team_id not in ('Surveillance','S')
					and team_id in (select team_id from team_master) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				order by username
			End
			Else IF(@CSO='ALL')
			Begin
				select username,userid from user_master where team_id not in ('Surveillance','S')
					and team_id in (select team_id from team_master) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
				order by username
			End
		End
		ELSE
		Begin
			IF(@CSO<>'ALL')
			Begin
				Select username,userid from user_master 
				Where team_id in (select team_id from team_master where team_name=@Team) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				Order by username   
			End
			Else IF(@CSO='ALL')
			Begin
				Select username,userid from user_master 
				Where team_id in (select team_id from team_master where team_name=@Team) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
				Order by username   
			End
		End
	end 
	if (@callType='IT')
	begin
		If(@Team='ALL')
		Begin
			IF(@CSO<>'ALL')
			Begin
				select username,userid from user_master where team_id not in ('Surveillance','S')
					and team_id in (select team_id from team_master) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				order by username
			End
			Else IF(@CSO='ALL')
			Begin
				select username,userid from user_master where team_id not in ('Surveillance','S')
					and team_id in (select team_id from team_master) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location)
				order by username
			End
		End
		Else
		Begin
			IF(@CSO<>'ALL')
			Begin
				Select username,userid from user_master 
				where team_id in (select team_id from team_master where team_name=@Team) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				order by username  
			End
			Else IF(@CSO='ALL')
			Begin
				Select username,userid from user_master 
				where team_id in (select team_id from team_master where team_name=@Team) And Account_Status=1 
					and Branch_id in (select distinct(branch_id) from tbl_teamleadermaster where branch_Name=@location) 
				order by username  
			End
		End
	end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetReportData_Latest
-- --------------------------------------------------

CREATE proc [dbo].[USP_GetReportData_Latest]

@docket_number varchar(10),
@uid varchar(10),
@access varchar(10),
@client_code varchar(15),
@branch_code varchar(50),
@location varchar(50),
@status_code varchar(50),
@product_code varchar(50),
@issue_resolved_by varchar(max),
@issue_raised_datetime_from varchar(100),
@issue_raised_datetime_to varchar(100),
@product_name varchar(50),
@username varchar(50),
@jobstatus_name varchar(50),
@team_id varchar(50),
@source varchar(5),
@callType varchar(5),
@CSO varchar(15)

as

---------------------------------- Ebroking -------------------------------
IF( (@access='L1EX' or @access='L1TL') and @team_id='-Select Team-' )
BEGIN
	SET @team_id='L1'
END
ELSE IF( (@access='L2FEX' or @access='L2FTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2F'
END
ELSE IF( (@access='L2TEX' or @access='L2TTL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L2T'
END
ELSE IF( (@access='L3EX' or @access='L3TL') and @team_id='-Select Team-')
BEGIN
	SET @team_id='L3'
END
--------------------------------ADM-EBroking--------------------------------------
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='L1 Team'))
begin
	set @team_id='L1'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Fuctional Team'))
begin
	set @team_id='L2F'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Technical Team'))
begin
	set @team_id='L2T'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 3 Team'))
begin
	set @team_id='L3'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Administrator'))
begin
	set @team_id='A'
end


------------------------------------ IT ----------------------------------
if( (@access ='ITL1EX' or @access ='ITL1TL')  and (@team_id='-Select Team-' or @team_id='IT L1 Team'))
begin
	set @team_id='ITL1'
end
if( (@access ='ITL1EXBR' or @access ='ITL1TLBR')  and (@team_id='-Select Team-' or @team_id='IT L1 Branch Team'))
begin
	set @team_id='ITL1BR'
end
else if((@access ='ITL2EXO' or @access ='ITL2TLO')and (@team_id='-Select Team-' or @team_id='Level 2 Technical Support Odin Team'))
begin
	set @team_id='ITL2O'
end 
else if((@access ='ITL2EXN' or @access ='ITL2TLN') and (@team_id='-Select Team-' or @team_id='Level2 Technical Support Network Team'))
begin
	set @team_id='ITL2N'
end 
else if((@access ='ITL2EXS' or @access ='ITL2TLS')and (@team_id='-Select Team-' or @team_id='Level2 Technical Support System Team'))
begin
	set @team_id='ITL2S'
end 
else if((@access ='ITL2EXI' or @access ='ITL2TLI') and (@team_id='-Select Team-' or @team_id='Level2 Technical Support InfraStructure Team'))
begin
	set @team_id='ITL2I'
end 
else if((@access ='ITL2EXV' or @access ='ITL2TLV') and (@team_id='-Select Team-'))
begin
	set @team_id='ITL2V'
end
else if((@access ='ITL3TL' or @access='ITL3EX') and (@team_id='-Select Team-' or @team_id='IT Level 3 Team'))
begin
	set @team_id='ITL3'
end
--------------------------------ADM-IT--------------------------------------
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT L1 Team'))
begin
	set @team_id='ITL1'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT L1 Branch Team'))
begin
	set @team_id='ITL1BR'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level2 Technical Support Network Team'))
begin
	set @team_id='ITL2N'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support Odin Team'))
begin
	set @team_id='ITL2O'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support VSAT Team'))
begin
	set @team_id='ITL2V'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support System Team'))
begin
	set @team_id='ITL2S'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Level 2 Technical Support Infra Team'))
begin
	set @team_id='ITL2I'
end 
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='IT Level 3 Team'))
begin
	set @team_id='ITL3'
end
else if((@access ='ADM' or @access ='ITL3TL' or @access='ITL3EX' or @access='L3TL') and (@team_id='Administrator'))
begin
	set @team_id='A'
end





declare @query varchar(MAX)
set @query =''

if(@callType='EBro')
begin
	if(@status_code='User Pending')
	begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
						,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
						d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],
						d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],
						tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
						(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
						(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
						(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
						d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master uwith (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id 
						and (d.product_code=v.product_code or d.product_code=v.product_name) and 
						u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	end
	Else If(@docket_number<>'')
	Begin
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code], d.tagbranch as [Branch code]
						,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
						d.source as [Source],v.product_name as [Product Name], d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],
						Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],
						u.UserName as [Issue resolved by],
						(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
							(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
							(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
						d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
					where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id 
						and (d.product_code=v.product_code or d.product_code=v.product_name) and 
						u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
	End
	Else If(@Location<>''  and (@access='ADM' or @access='ITL3TL' or @access='L3TL'))
	Begin
		IF(@Team_id='ALL' and (@issue_resolved_by='ALL'  or @issue_resolved_by=''))
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		ELSE IF (@issue_resolved_by='ALL' or @issue_resolved_by='')
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		ELSE 
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
						(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],
							CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
	End
	Else if ((@access='ADM' or @access='ITL3TL' or @access='L3TL') and @team_id='A' and @Location='')
		Begin
			IF(@Team_id='ALL' and (@issue_resolved_by='ALL'  or @issue_resolved_by=''))
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m  with (nolock),tbl_newclient_details d  with (nolock), user_master u  with (nolock), 
							jobstatusmaster j  with (nolock),vendor_product v  with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master) and d.Issue_Type=''EBro'''
			Else IF((@issue_resolved_by='ALL'  or @issue_resolved_by='') and (@Team_id<>'ALL' and @Team_id<>''))
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 							
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' ) and d.Issue_Type=''EBro'''
			Else
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
							 jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and (d.product_code=v.product_code or d.product_code=v.product_name) and tm.team_id=u.team_id and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''') and d.Issue_Type=''EBro'''
		End
	else
	begin
		If((@access='L1TL' or @access='L2FTL' or @access='L2TTL' or @access='ITL1TL' or @access='ITL1TLBR' or @access='ITL2TLO' or @access='ITL2TLN' or @access='ITL2TLS' or @access='ITL2TLI' or @access='ITL2TLV') and @issue_resolved_by<>'')
		Begin
			if(@location='' and (@issue_resolved_by='ALL' or @issue_resolved_by=''))
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''EBro'''
			Else if(@location='' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 								
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''EBro'''
			Else if(@location<>'' and (@issue_resolved_by='ALL' or @issue_resolved_by=''))
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''EBro'''
			Else if (@location<>'' and (@issue_resolved_by<>'' or @issue_resolved_by<>'ALL'))
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
							where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''EBro'''
		End
		Else
		Begin
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.Client_code as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							d.source as [Source],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from client_master m with (nolock),tbl_newclient_details d with (nolock), user_master u with (nolock),
							jobstatusmaster j with (nolock),vendor_product v with (nolock),Team_Master tm  with (nolock)
						where m.client_code=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and (d.product_code=v.product_code or d.product_code=v.product_name) and u.userid=d.issue_resolved_by and d.Issue_Type=''EBro'''
		End
	end		
end
if(@callType='IT')
begin
	If(@status_code='User Pending')
	Begin
		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag], cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
						,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
						v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
						(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
						d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@docket_number<>'')
	Begin
		--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newtaskdetails d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
						,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
						v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
						(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
						d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
					from tbl_newtaskdetails d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
					where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.Issue_Type=''IT'''
	End
	Else If(@Location<>'' and (@access='ADM' or @access='ITL3TL' or @access='L3TL'))
	Begin
		IF((@Team_id='ALL' OR  @Team_id='') and (@issue_resolved_by='ALL' or @issue_resolved_by=''))
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d  with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
							jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE IF(@issue_resolved_by='ALL' or @issue_resolved_by='')
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
						 jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
		ELSE
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id=(select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
						jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''' and Branch_id in (select distinct branch_id from  tbl_teamleadermaster where branch_name='''+@location+'''))and d.Issue_Type=''IT'''
	End
	Else if ((@access='ADM' or @access='ITL3TL' or @access='L3TL') and @Location='')
		Begin
			IF(@Team_id='ALL' and (@issue_resolved_by='ALL'  or @issue_resolved_by=''))
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master )and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock)
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
			Else IF((@issue_resolved_by='ALL'  or @issue_resolved_by='') and (@Team_id<>'ALL' and @Team_id<>''))
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' )and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' )and d.Issue_Type=''IT'''
			Else IF(@issue_resolved_by<>'ALL' and (@Team_id<>'ALL' and @Team_id<>'') and @issue_resolved_by<>'' and @Team_id<>'')
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
			Else 
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master u where u.team_id='''+@team_id+''' and username='''+@issue_resolved_by+''')and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and u.userid=d.issue_resolved_by and d.issue_resolved_by in (select userid from user_master )and d.Issue_Type=''IT'''
						
						
		End
	Else
	Begin
		If((@access='ITL1TL' or @access='ITL1TLBR' or @access='ITL2TLO' or @access='ITL2TLN'  or @access='ITL2TLS' or @access='ITL2TLI' or @access='ITL2TLV' or @access='L1TL' or @access='L2FTL' or @access='L2TTL' ) and @issue_resolved_by<>'')
		Begin
			if(@location='' and (@issue_resolved_by='ALL'  or @issue_resolved_by=''))
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],								
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs with (nolock) 
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''') and d.Issue_Type=''IT'''
			Else if(@location='' and (@issue_resolved_by<>'' or @issue_resolved_by<>'ALL'))
				--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u,jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''IT'''
				set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark,d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock),
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master where username='''+@issue_resolved_by+''') and d.Issue_Type=''IT'''
			Else if(@location<>'' and (@issue_resolved_by='ALL' or @issue_resolved_by=''))
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then 
								(Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in 
								(Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select Employee_id from tbl_teamleadermaster where Teamleader='''+@uid+''' and branch_name='''+@location+''') and d.Issue_Type=''IT'''
			Else if (@location<>'' and @issue_resolved_by<>'' and @issue_resolved_by<>'ALL')
				--set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''IT'''
				set @query ='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
								,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
								v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
								(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in (Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
								d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
							from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
								jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
							where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.issue_resolved_by in (select userid from user_master u where username='''+@issue_resolved_by+''' and Teamleader in (select Employee_id from tbl_teamleadermaster where branch_name='''+@location+''')) and d.Issue_Type=''IT'''
		End
		Else
		Begin
			--set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],d.SBTag [SubBroker Tag],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and v.product_code=d.product_code and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
			set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],d.tagbranch as [Branch code]
							,(Case when d.TagBranch is null then '''' when d.TagBranch is not null  then (Select Branch_Name from tbl_ITBranchMaster  with (nolock) where Branch_Code = d.TagBranch) End) as [Branch Name],
							v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem],d.Brief_solution as [Brief Solution],Replace((L1_InitialRemark + L1_FinalRemark + L2_UserRemark +L3_UserRemark),''\n'',''==||=='') AS Remark, d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],
							(Case when  (d.TagBranch is null or d.TagBranch = '''') then '''' when d.TagBranch is not null  then (Select CSO_Code from tbl_ITBranchMaster  with (nolock) where Branch_Code in (Select Branch_ID From User_Master Where UserID=d.issue_resolved_by)) End) as [CSO],
							d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],CONVERT(VARCHAR,d.Issue_Resolving_Time,108) as [Issue Resolving Time] ,j.jobstatus_name as [Status] 
						from tbl_newclient_details d with (nolock),ctcl_details cd with (nolock), user_master u with (nolock), 
							jobstatusmaster j with (nolock),Tbl_IT_ProductMaster v with (nolock),Team_Master tm with (nolock),View_Subbroker vs  with (nolock)
						where cd.ctcl_odinid=d.client_code and vs.tag=cd.ctcl_isbtag and d.tagbranch=cd.ctcl_ibranch_cd and j.jobstatus_id=d.status_code and tm.team_id=u.team_id and d.product_code=v.product_name and d.issue_resolved_by=u.userid and d.Issue_Type=''IT'''
		End
	End		
	
end

	
if @query <> ''
begin
	if @docket_number<>''
	begin
		set @query=@query+ 'and d.docket_number='''+@docket_number+'''' --and rid = (select max(rid) from task_details
	end
	if @client_code<>''
	begin
		set @query=@query+ 'and d.client_code='''+@client_code+ '''' 
	end
	if @branch_code<>''
	begin
		set @query=@query+ 'and d.tagbranch='''+@branch_code+ '''' 
	end
	if @source<>''
	Begin
		if(@access='ADM' or @access='ITL3TL' or @access='L3TL' or @access='ITL3EX' or @access='L3EX' or @access='ITL1TL' or @access='L1TL' or @access='ITL1EX'  or @access='ITL1EXBR'  or @access='ITL1TLBR' or @access='L1EX' )
		set @query=@query+ 'and d.source='''+@source+ '''' 
	End
	if @status_code<>''
	begin
		set @query=@query+ 'and j.jobstatus_name='''+@status_code+ '''' 
		if @status_code in ('Escalated to L2 Odin','Escalated to L2 Network','Escalated to L2 VSAT' )
		begin
			set @issue_resolved_by=''
		end
	end
	if @product_code<>''
	begin
		set @query=@query+ 'and v.product_name='''+@product_code+ '''' 
	end
	if @team_id<>'ALL' and  @team_id<>''
	begin
		set @query=@query+ 'and u.team_id='''+@team_id+ '''' 
	end
	
	if(@access='ADM' or @access='ITL3TL' or @access='L3TL')
	Begin
			If(UPPER(@issue_resolved_by)<>UPPER('ALL') And @issue_resolved_by<>'')
			--if(charindex('ALL',@issue_resolved_by)< 0)
			begin
				if(@access = 'ADM')
				Begin
					If(@CSO<>'')
					Begin	
						set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''and u.userid in (Select Userid from User_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code='''+ @CSO +'''))'
					End
					Else 
					Begin
						set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''and u.userid in (Select Userid from User_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster))'
					End
				End
				Else if(@access='ITL3TL' or @access='L3TL')
				Begin
					set @query=@query+ 'and u.username='''+@issue_resolved_by+ ''''
				End					
			end
			Else if(UPPER(@issue_resolved_by)=UPPER('ALL') OR @issue_resolved_by='')
			begin
				if(@access = 'ADM')
				Begin
					If(@CSO<>'')
					Begin	
						set @query=@query+ 'and u.userid in (Select Userid from User_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSo_Code='''+ @CSO +'''))'
					End
--					Else 
--					Begin
--						set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''and u.userid in (Select Userid from User_Master Where Branch_ID in (Select Branch_Code From tbl_ITBranchMaster))'
--					End
				End
			End
	End
	Else if((@access<>'ADM' or @access<>'ITL3TL' or @access<>'L3TL') and (charindex('EX',@access)>0))
	Begin	
		if((charindex('ALL',@issue_resolved_by)<0) or @issue_resolved_by<>'')  --@issue_resolved_by!='ALL'
		begin			
				set @query=@query+ 'and u.username='''+@issue_resolved_by+ '''' 
		end
	End

	if @issue_raised_datetime_from<>'' and @issue_raised_datetime_to<>''
	begin
		--set @query=@query+ 'and d.issue_raised_datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		--set @query=@query+ 'and d.Issue_Resolved_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
		set @query=@query+ 'and d.Issue_Raised_Datetime between '''+convert(varchar(100),cast(@issue_raised_datetime_from as datetime)) +''' and '''+convert(varchar(100),cast(dateadd(day,1,@issue_raised_datetime_to) as datetime)) +''''
	end

	set @query=@query+ ' ) as temp order by temp.Docket_Number desc'
	exec (@query)
end
print @query


--///////
--if(@status_code='User Pending')
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_Datetime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end
--	else
--	begin
--		set @query='select * from (select distinct(rtrim(d.docket_number)) as [Docket_Number],cd.ctcl_odinid as [Client Code],bm.branch_code as [Branch code],v.product_name as [Product Name],d.nature as [Nature],d.problem as [Problem], d.Issue_Raised_dateTime as [Issue Raised Date/Time],tm.Team_Name as [Issue resolved level],u.UserName as [Issue resolved by],d.Issue_Resolved_dateTime as [Issue Resolved Date/Time],j.jobstatus_name as [Status] from tbl_newclient_details d,ctcl_details cd, user_master u, jobstatusmaster j,vendor_product v,Team_Master tm,tbl_Branch_Master bm,View_Subbroker vs where cd.ctcl_odinid=d.client_code and j.jobstatus_id=d.status_code and u.team_id=tm.team_id and v.product_code=d.product_code and u.userid=d.issue_resolved_by and bm.Branch_code = vs.tagbranch and d.Issue_Type=''IT'''
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETTL
-- --------------------------------------------------




CREATE PROC [dbo].[USP_GETTL]
@UID AS VARCHAR(10)
AS
SELECT USERNAME FROM USER_MASTER 
WHERE USERID IN (SELECT DISTINCT TEAMLEADER FROM TBL_TEAMLEADERMASTER WHERE EMPLOYEE_ID IN
(SELECT EMPLOYEE_ID FROM TBL_TEAMLEADERMASTER WHERE EMPLOYEE_ID=@UID))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETUSERDETAILS
-- --------------------------------------------------


CREATE PROC [dbo].[USP_GETUSERDETAILS]
@UID AS VARCHAR(20),
@ACCESS AS VARCHAR(25),
@LOCATION AS VARCHAR(25),
@TEAM AS VARCHAR(50)

AS

IF(@TEAM = 'Administrator')
	SET @TEAM = 'A'
ELSE IF (@TEAM = 'IT L1 Team')
	SET @TEAM = 'ITL1'
ELSE IF (@TEAM = 'IT L1 Branch Team')
	SET @TEAM = 'ITL1BR'
ELSE IF (@TEAM = 'Level2 Technical Support Network Team')
	SET @TEAM = 'ITL2N'
ELSE IF (@TEAM = 'Level2 Technical Support Infra Team')
	SET @TEAM = 'ITL2I'
ELSE IF (@TEAM = 'Level2 Technical Support System Team')
	SET @TEAM = 'ITL2S'
ELSE IF (@TEAM = 'Level2 Technical Support Odin Team')
	SET @TEAM = 'ITL2O'
ELSE IF (@TEAM = 'Level2 Technical Support VSAT Team')
	SET @TEAM = 'ITL2V'
ELSE IF (@TEAM = 'IT Level 3 Team')
	SET @TEAM = 'ITL3'
ELSE IF (@TEAM = 'L1 Team')
	SET @TEAM = 'L1'
ELSE IF (@TEAM = 'Level2 Fuctional Team')
	SET @TEAM = 'L2F'
ELSE IF (@TEAM = 'Level2 Technical Team')
	SET @TEAM = 'L2T'
ELSE IF (@TEAM = 'Level 3 Team')
	SET @TEAM = 'L3'
ELSE IF (@TEAM = 'Management')
	SET @TEAM = 'M'

IF (@LOCATION<>'' and @TEAM<>'')
BEGIN
	SELECT USERID,USERNAME,TEAM_NAME,ROLE_NAME,BRANCH_ID,STATUS,ACCESS FROM
	( SELECT DISTINCT USERID, USERNAME, TEAM_NAME, ROLE_NAME,U.BRANCH_ID
	,STATUS=(CASE WHEN ACCOUNT_STATUS=1 THEN 'ACTIVE' WHEN ACCOUNT_STATUS=0 THEN 'DISABLED' END)
	,ACCESS=(CASE WHEN ACCESS_ID='GUEST' THEN 'GUEST' WHEN ACCESS_ID='EXE' THEN 'HARMONY' END)
	From USER_MASTER U, TEAM_MASTER TM, TBL_TEAMLEADERMASTER TLM, ROLE_MASTER RM
	WHERE U.TEAM_ID = @TEAM AND U.TEAM_ID=TM.TEAM_ID AND U.ROLE_ID=RM.ROLE_ID
	AND U.USERID IN (SELECT EMPLOYEE_ID FROM TBL_TEAMLEADERMASTER WHERE BRANCH_NAME=@LOCATION)
	) TEMP 
	ORDER BY USERNAME 


--	SELECT USERNAME FROM USER_MASTER 
--	WHERE USERID IN (SELECT DISTINCT TEAMLEADER FROM TBL_TEAMLEADERMASTER WHERE BRANCH_NAME=@LOCATION AND 
--	EMPLOYEE_ID IN (SELECT DISTINCT U.USERID From USER_MASTER U, TEAM_MASTER TM, ROLE_MASTER RM
--	WHERE U.TEAM_ID = @TEAM AND U.TEAM_ID=TM.TEAM_ID AND U.ROLE_ID=RM.ROLE_ID
--	AND U.USERID IN (SELECT EMPLOYEE_ID FROM TBL_TEAMLEADERMASTER WHERE BRANCH_NAME=@LOCATION))
--	AND TEAMLEADER IS NOT NULL)
END
IF (@LOCATION<>'' AND @TEAM='')
BEGIN
	SELECT USERID,USERNAME,TEAM_NAME,ROLE_NAME,BRANCH_ID,STATUS,ACCESS FROM
	( SELECT DISTINCT USERID, USERNAME, TEAM_NAME, ROLE_NAME,U.BRANCH_ID
	,STATUS=(CASE WHEN ACCOUNT_STATUS=1 THEN 'ACTIVE' WHEN ACCOUNT_STATUS=0 THEN 'DISABLED' END)
	,ACCESS=(CASE WHEN ACCESS_ID='GUEST' THEN 'GUEST' WHEN ACCESS_ID='EXE' THEN 'HARMONY' END)
	From USER_MASTER U, TEAM_MASTER TM, TBL_TEAMLEADERMASTER TLM, ROLE_MASTER RM
	WHERE U.TEAM_ID=TM.TEAM_ID AND U.ROLE_ID=RM.ROLE_ID
	AND U.USERID IN (SELECT EMPLOYEE_ID FROM TBL_TEAMLEADERMASTER WHERE BRANCH_NAME=@LOCATION)
	) TEMP 
	ORDER BY USERNAME 
END
IF (@LOCATION='' AND @TEAM<>'')
BEGIN
	SELECT USERID,USERNAME,TEAM_NAME,ROLE_NAME,BRANCH_ID,STATUS,ACCESS FROM
	( SELECT DISTINCT USERID, USERNAME, TEAM_NAME, ROLE_NAME,U.BRANCH_ID
	,STATUS=(CASE WHEN ACCOUNT_STATUS=1 THEN 'ACTIVE' WHEN ACCOUNT_STATUS=0 THEN 'DISABLED' END)
	,ACCESS=(CASE WHEN ACCESS_ID='GUEST' THEN 'GUEST' WHEN ACCESS_ID='EXE' THEN 'HARMONY' END)
	From USER_MASTER U, TEAM_MASTER TM, TBL_TEAMLEADERMASTER TLM, ROLE_MASTER RM
	WHERE U.TEAM_ID = @TEAM  AND U.TEAM_ID=TM.TEAM_ID AND U.ROLE_ID=RM.ROLE_ID
	AND U.USERID IN (SELECT EMPLOYEE_ID FROM TBL_TEAMLEADERMASTER)
	) TEMP 
	ORDER BY USERNAME 
END


--SELECT DISTINCT USERID, USERNAME, TEAM_NAME, ROLE_NAME,U.BRANCH_ID, ACCOUNT_STATUS, ACCESS_ID
--	From USER_MASTER U, TEAM_MASTER TM, TBL_TEAMLEADERMASTER TLM, ROLE_MASTER RM
--	WHERE U.TEAM_ID = @TEAM AND U.TEAM_ID=TM.TEAM_ID AND U.ROLE_ID=RM.ROLE_ID
--	AND U.USERID IN (SELECT EMPLOYEE_ID FROM TBL_TEAMLEADERMASTER WHERE BRANCH_NAME=@LOCATION)
--
--
--SELECT DISTINCT U.TEAMLEADER,U.USERNAME AS TEAMLEDERNAME
--	From USER_MASTER U, TEAM_MASTER TM, TBL_TEAMLEADERMASTER TLM, ROLE_MASTER RM
--	WHERE U.TEAM_ID=@TEAM AND U.TEAM_ID=TM.TEAM_ID AND U.ROLE_ID=RM.ROLE_ID 
--	AND U.USERID IN (SELECT DISTINCT TEAMLEADER FROM TBL_TEAMLEADERMASTER WHERE BRANCH_NAME=@LOCATION)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_INI_getByProductName
-- --------------------------------------------------



CREATE proc [dbo].[usp_INI_getByProductName]
@ProductName varchar(100),
@Option varchar(2)
as
if(@Option ='N')
	select distinct(faq_Nature),Product_name  from faq_details where product_Name in(@ProductName,'General','E-Broking General','Backoffice','Angel PDA') order by Product_name
if(@Option ='P')
	select distinct(Problem),Product_name  from faq_details where product_Name in(@ProductName,'General','E-Broking General','Backoffice','Angel PDA') order by Product_name

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_InsertintoTaskDetails
-- --------------------------------------------------
CREATE proc [dbo].[usp_InsertintoTaskDetails]

--Comment------------
-- SP to insert record in to newtaskdetails table------------

@Docket varchar(40),@Client_Code char(25),@Product_Code char(25),
@Issue_Resolved_Datetime datetime,
@Call_From char(50),
@Call_Type char(50),
@Issue_Type char(25),
@Type char(50),
@Nature char(100),
@Problem varchar(500),
@Brief_solution varchar(200),
@Client_Remark varchar(500),
@L1IRemark varchar(200),
@L1FRemark varchar(200),
@L2Remark varchar(200), 
@L3Remark varchar(200),
@Issue_Resolved_By Char(25),
@Team_Id char(50),
@Contact_Person varchar(100),
@Status_Code char(25) 
 
as
insert into tbl_Newtaskdetails values('',@Docket,@Client_Code,@Product_Code,Getdate(),@Issue_Resolved_Datetime,'',@Call_From,@Call_Type,@Issue_Type,@Type  ,@Nature  ,@Problem  ,@Brief_solution  ,@Client_Remark  ,@L1IRemark  ,@L1FRemark  ,@L2Remark  , @L3Remark  ,@Issue_Resolved_By  ,@Team_Id  ,@Contact_Person ,@Status_Code )

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_IT_FAQMaster_FillCombo
-- --------------------------------------------------

CREATE proc usp_IT_FAQMaster_FillCombo
@product_Name	varchar(100),
@call_type	varchar(50),
@Nature	varchar(100),
@Problem	varchar(255),
@Issue_Area	varchar(100),
@Issue_Type	varchar(100),
@Flag varchar(50)
as

if(@Flag='Product_Name')
	select distinct(Product_Name) from tbl_IT_KB_Master
else if(@Flag='Call_Type')
	select distinct(call_type) from tbl_IT_KB_Master where product_Name=@product_Name
else if(@Flag='Nature')
	select distinct(Nature) from tbl_IT_KB_Master where product_Name=@product_Name and call_type=@call_type
else if(@Flag='Problem')
	select distinct(Problem) from tbl_IT_KB_Master where product_Name=@product_Name and call_type=@call_type and Nature=@Nature  
else if(@Flag='Issue_Area')
	select distinct(Issue_Area) from tbl_IT_KB_Master where product_Name=@product_Name and call_type=@call_type and Nature=@Nature and Problem=@Problem
else if(@Flag='Issue_Type')
	select distinct(Issue_Type) from tbl_IT_KB_Master where product_Name=@product_Name and call_type=@call_type and Nature=@Nature and Problem=@Problem and Issue_Area=@Issue_Area

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MAIL_INFO
-- --------------------------------------------------




CREATE PROC [dbo].[USP_MAIL_INFO]
@DOCKET_NO AS VARCHAR(20),
@UID AS VARCHAR(10),
@STATUS AS VARCHAR(20)
AS
Declare 
@TEMPSTATUS AS VARCHAR(25),
@TEMPROLE as VARCHAR(20)


BEGIN
	IF(@STATUS = 'REASSIGN')
	BEGIN
		SELECT USERID,USERNAME,EMAIL,@STATUS AS STATUS 
		from TBL_NEWCLIENT_DETAILS D,USER_MASTER U,JOBSTATUSMASTER J
		where DOCKET_NUMBER=@DOCKET_NO AND ISSUE_RESOLVED_BY=USERID AND D.STATUS_CODE=J.JOBSTATUS_ID
		AND ISSUE_RESOLVED_BY=@UID

		select userid, username, Email,@STATUS AS Status
		from tbl_newclient_details d,user_master u, jobstatusmaster j
		where userid in (
						select Teamleader 
						from tbl_teamleadermaster tm, tbl_newclient_details d 
						where Employee_id=d.Issue_resolved_by and docket_number=@DOCKET_NO
					  )
			  and d.docket_number=@DOCKET_NO and d.status_code=j.jobstatus_id
	END
	
	IF(@STATUS = 'ASSIGN')
	BEGIN
		SELECT USERID,USERNAME,EMAIL,@STATUS AS STATUS 
		from TBL_NEWCLIENT_DETAILS D,USER_MASTER U,JOBSTATUSMASTER J
		where DOCKET_NUMBER=@DOCKET_NO AND D.STATUS_CODE=J.JOBSTATUS_ID
		AND USERID=@UID

		SELECT USERID,USERNAME,EMAIL,@STATUS AS STATUS 
		from TBL_NEWCLIENT_DETAILS D,USER_MASTER U,JOBSTATUSMASTER J
		where DOCKET_NUMBER=@DOCKET_NO AND ISSUE_RESOLVED_BY=USERID AND D.STATUS_CODE=J.JOBSTATUS_ID		
	END
	
	IF(@STATUS='ESCALATE')
	BEGIN
		SELECT USERID,USERNAME,EMAIL,@STATUS AS STATUS 
		from TBL_NEWCLIENT_DETAILS D,USER_MASTER U,JOBSTATUSMASTER J
		where DOCKET_NUMBER=@DOCKET_NO AND ISSUE_RESOLVED_BY=USERID AND D.STATUS_CODE=J.JOBSTATUS_ID	

		SET @TEMPSTATUS = (SELECT STATUS_CODE FROM TBL_NEWCLIENT_DETAILS WHERE DOCKET_NUMBER=@DOCKET_NO)

		IF(@TEMPSTATUS = 'ET')
			SET @TEMPROLE = 'L2TTL'
		IF(@TEMPSTATUS = 'EF')
			SET @TEMPROLE = 'L2FTL'
		IF(@TEMPSTATUS = 'E3')
			SET @TEMPROLE = 'L3TL'
		IF(@TEMPSTATUS = 'ITEL2O')
			SET @TEMPROLE = 'ITL2TLO'
		IF(@TEMPSTATUS = 'ITEL2N')
			SET @TEMPROLE = 'ITL2TLN'
		IF(@TEMPSTATUS = 'ITEL2V')
			SET @TEMPROLE = 'ITL2TLV'
		IF(@TEMPSTATUS = 'ITEL2I')
			SET @TEMPROLE = 'ITL2TLI'
		IF(@TEMPSTATUS = 'ITEL2S')
			SET @TEMPROLE = 'ITL2TLS'
		IF(@TEMPSTATUS = 'ITEL3')
			SET @TEMPROLE = 'ITL3TL'

		SELECT USERID,USERNAME,EMAIL,@STATUS AS STATUS 
		FROM USER_MASTER 
		WHERE ROLE_ID = @TEMPROLE
	END
	
	SELECT Docket_Number,Client_Code,TagBranch as Branch,Product_Code,Nature, Problem,
			Issue_Raised_DateTime,Issue_Resolved_Datetime,
		   --L1_InitialRemark,L1_FinalRemark,L2_UserRemark,L3_UserRemark,
			u.username as 'IssueResolvedBy',j.jobstatus_name as 'Status'
	FROM TBL_NEWCLIENT_DETAILS d, user_master u,jobstatusmaster j
	WHERE DOCKET_NUMBER=@DOCKET_NO
	and d.issue_resolved_by=u.userid and j.jobstatus_id=d.status_code



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_BranchExecutiveWiseReport
-- --------------------------------------------------
CREATE proc [dbo].[usp_MIS_BranchExecutiveWiseReport] 
@Branch_Tag as nvarchar(50)
as
if(@Branch_Tag<>'')
begin
	select issue_resolved_by AS Executive_ID,username AS Executive_Name,sum(PENDING) as PENDING,sum(ESCALATED) as ESCALATED,sum(REASSIGNED) as REASSIGNED,sum(COMPLETED) as COMPLETED,sum(CLOSED) as CLOSED,sum(PENDING)+sum(ESCALATED)+sum(REASSIGNED)+sum(COMPLETED)+sum(CLOSED) as TOTAL from
	(
		select 
		issue_resolved_by,
		temp1.username,
		PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(docket_number) END,0),
		ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(docket_number) END,0),
		REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(docket_number) END,0),
		COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(docket_number) END,0),
		CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(docket_number) END,0),
		TOTAL = ISNULL(COUNT(docket_number),0)
		from (
			select NTD.docket_number,NTD.issue_resolved_by,UM.username,NTD.STATUS_CODE from tbl_newtaskdetails as NTD,MUser_Master UM
			where NTD.issue_resolved_by=UM.userid and  issue_type='IT'  and Branch_id=@Branch_Tag
			)
		as temp1
		GROUP BY temp1.STATUS_CODE,issue_resolved_by,temp1.username
	) as temp group by issue_resolved_by,username order by issue_resolved_by
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_BranchWiseReport
-- --------------------------------------------------


CREATE proc [dbo].[usp_MIS_BranchWiseReport] 
@Branch_tag as nvarchar(50),
@Status as nvarchar(50)
as
if(@Branch_tag='' and @Status ='')
begin
	select tagBranch AS BRANCH_TAG,CSO.Branch_Name AS BRANCH_NAME,sum(PENDING) as PENDING,sum(ESCALATED) as ESCALATED,sum(REASSIGNED) as REASSIGNED,sum(COMPLETED) as COMPLETED,sum(CLOSED) as CLOSED,sum(PENDING)+sum(ESCALATED)+sum(REASSIGNED)+sum(COMPLETED)+sum(CLOSED) as TOTAL from
	(
		select 
		tagBranch,
		PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
		ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
		REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
		COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
		CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
		TOTAL = ISNULL(COUNT(STATUS_CODE),0)
		from (select tagBranch,STATUS_CODE from tbl_newtaskdetails where issue_type='IT' and (tagbranch<>null or tagbranch<>''))
		as temp1
		GROUP BY temp1.STATUS_CODE,tagBranch
	) as temp,tbl_CSOMaster as CSO WHERE CSO.branch_Tag=temp.tagBranch group by tagBranch,CSO.Branch_Name order by tagBranch
end
if(@Branch_tag<>'' and @Status <>'')
begin
	if(@Status='PI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch=@Branch_tag and issue_type='IT' and STATUS_CODE IN ('ITP','ITUP')
	if(@Status='EI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch=@Branch_tag and issue_type='IT'  and STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3')
	if(@Status='RI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch=@Branch_tag and issue_type='IT' and STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
	if(@Status='CI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch=@Branch_tag and issue_type='IT' and STATUS_CODE ='ITC'
	if(@Status='CL')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch=@Branch_tag and issue_type='IT' and STATUS_CODE ='X'
	if(@Status='AI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch=@Branch_tag and issue_type='IT'
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_CentralSupportWiseReport
-- --------------------------------------------------



CREATE proc [dbo].[usp_MIS_CentralSupportWiseReport]
@Branch_tag as nvarchar(50),
@Status as nvarchar(50)
as
if(@Branch_tag='' and @Status ='')
begin
	select CSO.centralSupport AS CENTRAL_SUPPORT,sum(PENDING) as PENDING,sum(ESCALATED) as ESCALATED,sum(REASSIGNED) as REASSIGNED,sum(COMPLETED) as COMPLETED,sum(CLOSED) as CLOSED,sum(PENDING)+sum(ESCALATED)+sum(REASSIGNED)+sum(COMPLETED)+sum(CLOSED) as TOTAL from
	(
		select 
		tagBranch,
		PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
		ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
		REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
		COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
		CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
		TOTAL = ISNULL(COUNT(STATUS_CODE),0)
		from (select tagBranch,STATUS_CODE from tbl_newtaskdetails where issue_type='IT')
		as temp1
		GROUP BY temp1.STATUS_CODE,tagBranch
	) as temp,tbl_CSOMaster as CSO where CSO.branch_Tag=temp.tagBranch group by CSO.centralSupport order by CSO.centralSupport
end
if(@Branch_tag <>'' and @Status <>'')
begin
	if(@Status='PI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster where centralsupport=@Branch_tag) and issue_type='IT' and STATUS_CODE IN ('ITP','ITUP')
	if(@Status='EI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid where tbl_NewTaskDetails.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster
				 where centralsupport=@Branch_tag) and issue_type='IT'  and STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3')
	if(@Status='RI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster where centralsupport=@Branch_tag) and issue_type='IT' and STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
	if(@Status='CI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster where centralsupport=@Branch_tag) and issue_type='IT' and STATUS_CODE ='ITC'
	if(@Status='CL')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster where centralsupport=@Branch_tag) and issue_type='IT' and STATUS_CODE ='X'
	if(@Status='AI')
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster where centralsupport=@Branch_tag) and issue_type='IT'
end
if (@Branch_tag <>'' and @Status ='')
begin
	select tagBranch AS BRANCH_TAG,CSO.Branch_Name AS BRANCH_NAME,@Branch_tag as Central_support,sum(PENDING) as PENDING,sum(ESCALATED) as ESCALATED,sum(REASSIGNED) as REASSIGNED,sum(COMPLETED) as COMPLETED,sum(CLOSED) as CLOSED,sum(PENDING)+sum(ESCALATED)+sum(REASSIGNED)+sum(COMPLETED)+sum(CLOSED) as TOTAL from
	(
		select 
		tagBranch,
		PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
		ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
		REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
		COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
		CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
		TOTAL = ISNULL(COUNT(STATUS_CODE),0)
		from (select tagBranch,STATUS_CODE from tbl_newtaskdetails where issue_type='IT' and (tagbranch<>null or tagbranch<>''))
		as temp1
		GROUP BY temp1.STATUS_CODE,tagBranch
	) as temp,tbl_CSOMaster as CSO WHERE CSO.branch_Tag=temp.tagBranch and temp.tagBranch in (select distinct(branch_tag) from tbl_CSOMaster where centralsupport=@Branch_tag) group by tagBranch,CSO.Branch_Name order by tagBranch
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_CentralSupportWiseReport_Latest
-- --------------------------------------------------


CREATE Proc [dbo].[USP_MIS_CentralSupportWiseReport_Latest]

@CSO as nvarchar(50),
@Branch as Varchar(50),
@EMP As Varchar(20),
@From As nvarchar(22),
@To As nvarchar(22),
@Choice As Char(10),
@Status as Varchar(50),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20),
@Option As Int

As 

Begin
--##############################################################################################################--
										    -- CSO Wise --	
--##############################################################################################################--
	If(@Option=1) --(@CSO='') -- CSO wise report
	Begin 
		Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[EBroking],[IT],[Total_Issue]
		From
		(
			select distinct(CentralSupport),
				sum(EBroking) as EBroking,
				sum(IT) As IT,
				sum(IT) + sum(EBroking) As Total_Issue  
			From 
			(
				Select tmp1.CentralSupport,tmp1.Branch_Tag,
					EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
					IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0)
				From
				(
					Select distinct(docket_number),issue_type,branch_tag,CentralSupport
					From Tbl_NewClient_Details D with (nolock)
						Join MUser_Master UM with (nolock) On D.Issue_Resolved_By=UM.Userid 
						Join tbl_CSOMaster CSO with (nolock) On UM.Branch_id=CSO.Branch_Tag 
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 group by CentralSupport,Branch_Tag,issue_type
			) As tmp Group By CentralSupport

			UNION
			
			Select Distinct CentralSupport,'0' As EBroking,'0' As  IT,'0' As Total_Issue
			From tbl_CSOMaster
			Where CentralSupport NOT IN
			(	
				Select Distinct(tmp1.CentralSupport)
				From
				(
					Select distinct(CentralSupport)
					From Tbl_NewClient_Details D with (nolock)
						Join MUser_Master UM with (nolock) On D.Issue_Resolved_By=UM.Userid  
						Join tbl_CSOMaster CSO with (nolock) On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
			) 
			Group By CentralSupport
		) Temp
		--Order BY Total_Issue DESC
	End
	Else If(@Option=2) --For particular CSO IT Issues Count (Status Wise)
	Begin
		Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],
		[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
		from
		(
			select distinct(CentralSupport),
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
			From 
			(
				Select  CentralSupport,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP','P','UP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						Issue_type
				From
				(
					Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_type
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid 
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by CentralSupport,Status_Code,Issue_type
			) As tmp Group By CentralSupport,Issue_type
		)Temp
	End
	Else If(@Option=3) --For particular CSO EBroking Issue Count  (Status Wise)
	Begin
		Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],
			[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
		from
		(
			select distinct(CentralSupport),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					Issue_type
			From 
			(
				Select  CentralSupport,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						Issue_type
				From
				(
					Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_type
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid 
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by CentralSupport,Status_Code,Issue_type
			) As tmp Group By CentralSupport,Issue_type
		)Temp
	End
	Else If(@Option=4) --For particular CSO Both EBroking and IT Count (Status Wise)
	Begin
		Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],
		[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
		from
		(
			select distinct(CentralSupport),
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
			From 
			(
				Select  CentralSupport,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'Total' As Issue_type
				From
				(
					Select distinct(docket_number),Status_Code,branch_tag,CentralSupport
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By<>NULL) and D.Issue_type<>''
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by CentralSupport,Status_Code
			) As tmp Group By CentralSupport,Issue_type
		)Temp
	End
	If(@Option=5) --For particular CSO (EBroking/IT/BOTH) Status Count Wise Issue
	Begin
		If(@Status='Pending')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
				 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				 from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
				  )Temp
			End
			Else If(@Choice='Total')
			Begin
				 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
				 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				  from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				  )Temp
			End
		End
		Else If(@Status='Completed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                 )Temp
			End
			Else If(@Choice='Total')
			Begin
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Closed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				)Temp
			End
			Else If(@Choice='Total')
			Begin
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				)Temp
			End
		End
		Else If(@Status='Escalated')
		Begin
			IF(@Choice='EBro')
			Begin	
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
                )Temp
			End
			IF(@Choice='IT')
			Begin
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
				 )Temp
			End
			Else If(@Choice='Total')
			Begin
				Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
					[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
				from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
					Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Reassigned')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1 
              )Temp
			End
			IF(@Choice='IT')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (	
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               ) Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
		End
		Else If(@Status='Total')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
			IF(@Choice='IT')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
	End
--##############################################################################################################--
								   --For Particular CSO, Branch Wise Report --	
--##############################################################################################################--	
	ELse If(@Option=6) --(@CSO<>'' and @Branch='') -- For Particular CSO Branch wise Report 
	Begin
      Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Branch_Tag],[Branch_Name],[CentralSupport],[EBroking],[IT],[Total_Issue]
		From
		(
		Select distinct Branch_Tag,Branch_Name,CentralSupport,Ebroking,IT,Total_Issue
		From
		(
			select distinct(Branch_Tag),Branch_Name,CentralSupport ,
					sum(EBroking) as EBroking,
					sum(IT) As IT,
					sum(IT) + sum(EBroking) As Total_Issue  
			From 
			(
				Select distinct tmp1.Branch_Tag,Branch_Name,CentralSupport ,
					EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
					IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0)
				From
				(
					Select distinct(docket_number),issue_type,branch_tag,Branch_Name,CentralSupport
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,CentralSupport,issue_type,Branch_Name
			) As tmp 
			Group By Branch_Tag,CentralSupport,Branch_Name
		
			UNION

			Select Distinct Branch_Tag,Branch_Name,CentralSupport,'0'Ebroking,'0' As IT,'0' As Total_Issue
			From tbl_CSOMaster
			Where Branch_Tag not IN
			(
				Select distinct(Branch_Tag)
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			)
			and CentralSupport=@CSO
		) T, MUser_Master UM
		Where UM.Branch_ID=T.Branch_Tag
		--Order By Total_Issue DESC
)Temp
	End
	Else If(@Option=7) --For particular CSO and Particular Branch, IT Issues Count (Status Wise)
	Begin
		Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
		from	
		   (
			select distinct(Branch_Tag),CentralSupport,
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					Issue_type
			From 
			(
				Select  Branch_Tag,CentralSupport,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP','P','UP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),Issue_type
				From
				(
					Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_Type
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and UM.Branch_id=@Branch
						and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,CentralSupport,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
		)Temp
	End
	Else If(@Option=8) --For particular CSO and Particular Branch, EBroking Issue Count  (Status Wise)
	Begin
		Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
		from	
		   (
			select distinct(Branch_Tag),CentralSupport,
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					Issue_type
			From 
			(
				Select  Branch_Tag,CentralSupport,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						Issue_type
				From
				(
					Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_type
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and UM.Branch_id=@Branch
						and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,CentralSupport,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
		)Temp
	End
	Else If(@Option=9) --For particular CSO and Particular Branch, Both EBroking and IT Count (Status Wise)
	Begin
		Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
		from	
        (
			select distinct(Branch_Tag),CentralSupport,
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
			From 
			(
				Select  Branch_Tag,CentralSupport,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'Total' As Issue_type
				From
				(
					Select distinct(docket_number),Status_Code,branch_tag,CentralSupport
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By<>NULL) and D.Issue_type<>''
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and UM.Branch_id=@Branch
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,CentralSupport,Status_Code
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
		)Temp
	End
	If(@Option=10) --For particular CSO and Particular Branch, (EBroking/IT/BOTH) Status Count Wise Issue
	Begin
		If(@Status='Pending')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
				(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
             )Temp
			End
			Else If(@Choice='Total')
			Begin
            Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
				(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP') 
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                 )Temp
			End
		End
		Else If(@Status='Completed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
				(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                  )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('C','ITC')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Closed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('X') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
		End
		Else If(@Status='Escalated')
		Begin
			IF(@Choice='EBro')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
			IF(@Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
		End
		Else If(@Status='Reassigned')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			IF(@Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Total')
		Begin
			IF(@Choice='EBro')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                 )Temp
			End
			IF(@Choice='IT')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
            )Temp
			End
		End
	End
--##############################################################################################################--
						--For Particular CSO and Particular Branch, Employee Wise Report --	
--##############################################################################################################--
	Else If (@Option=11)  -- For Particlar CSO and Particular Branch, Employee Wise Report
	Begin
      Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[Branch_Tag],[CentralSupport],[EBroking],[IT],[Total_Issue]
     
		From
		(
		Select Username, UserID,Branch_Tag,CentralSupport, EBroking, IT, Total_Issue
		from 
		(
			select distinct(Username),UserID,Branch_Tag,CentralSupport,
					sum(EBroking) as EBroking,
					sum(IT) As IT,
					sum(IT) + sum(EBroking) As Total_Issue  
			From 
			(
				Select UserID,Username,tmp1.Branch_Tag,CentralSupport,
					EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
					IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0)
				From
				(
					Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,branch_tag,CentralSupport
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by UserID,Username,Branch_Tag,CentralSupport,issue_type
			) As tmp Group By Username,UserID,Branch_Tag,CentralSupport

			UNION

			Select Username, UserID,Branch_ID As [Branch_Tag],CentralSupport, '0' AS Ebroking, '0' As IT,'0' As Total_Issue
			From MUser_Master , tbl_CSOMaster CSO 
			Where Account_Status=1 And UserID not in 
			(
				Select distinct(UserID)
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			)
			and Branch_ID=@Branch and Branch_id=Branch_Tag
			and Team_ID not in ('M','S','Surveillance','F','CM','ZM')
		) T
		Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
		----Order By Total_Issue desc
)Temp
	End
	Else If(@Option=12) -- For Particlar CSO and Particular Branch and Particular Employee, (IT/Branch) Issue_type Wise Report
	Begin
     	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
	    [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	    from	
	    (
		Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
			D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
			D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
			convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
			Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,			
			JS.jobstatus_name As [Status]
		From Tbl_NewClient_Details D
			Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
			Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
			Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
		Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
			and UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
			and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
			And UM.Account_Status=1
         )Temp
	End
	Else If(@Option=13) -- For Particlar CSO and Particular Branch and Particular Employee, BOTH IT and Branch (Total) Issue_type Wise Report
	Begin
     Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
	  [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	  from	
	  (
		Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
			D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
			D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
			convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
			Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
			JS.jobstatus_name As [Status]
		From Tbl_NewClient_Details D
			Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
			Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
			Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
		Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
			and UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
			and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
			And UM.Account_Status=1
      )Temp
	End

--##############################################################################################################--
								-- USP_MIS_BranchWiseReport_New --
--##############################################################################################################--
						--For Particular Branch, Employee Wise Report --	
--##############################################################################################################--
	Else If(@Option=21) -- Branch Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 

			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],CSO_Code,
				[Branch_Tag],temp.[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
			from (
					select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
					From 
					(
						select distinct(Branch_Tag),Branch_Name,
								sum(EBroking) as EBroking,
								sum(IT) As IT,
								sum(IT) + sum(EBroking) As Total_Issue,
								CentralSupport
						From 
						(
							Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
								EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
								IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
							From
							(
								Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
								From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
								Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
									and UM.Branch_ID=CSO.Branch_Tag
									and D.Issue_Resolved_By=UM.UserID 
									and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
									and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
									and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
									and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
									and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
									And UM.Account_Status=1
							) as tmp1 
							group by Branch_Tag,issue_type,Branch_Name
						) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	

						UNION
					
						select distinct(CSO.Branch_Tag), CSO.Branch_Name, '0' as EBroking,
							'0' As IT, '0' As Total_Issue, ' ' As CentralSupport
						From Tbl_CSOMaster CSO 
						Where Branch_Tag NOT IN
						(
							Select distinct CSO.Branch_Tag
							From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
							Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
								and UM.Branch_ID=CSO.Branch_Tag
								and D.Issue_Resolved_By=UM.UserID 
								and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								And UM.Account_Status=1
						) 
					) T , MUser_Master UM
					Where UM.Branch_ID=T.Branch_Tag
					--Order BY Total_Issue DESC
			)temp , tbl_ITBranchMaster
			where [Branch_Tag] = Branch_Code

		End
		Else If(@ROLE='RH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],CSO_Code,[Branch_Tag],temp.[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
				From 
				(
					select distinct(Branch_Tag),Branch_Name,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport
					From 
					(
						Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
						From
						(
							Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
							From Tbl_NewClient_Details D with (NOLOCK), MUser_Master UM with (NOLOCK), Tbl_CSOMaster CSO with (NOLOCK) 
							Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
								and UM.Branch_ID=CSO.Branch_Tag
								and D.Issue_Resolved_By=UM.UserID 
								and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@TO)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where RegionalHead=@USER)
								and Role_ID not in ('BH', 'RH','ZH','CH'))
								And UM.Account_Status=1
						) as tmp1 
						group by Branch_Tag,issue_type,Branch_Name
					) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
				) T, MUser_Master UM
				Where UM.Branch_ID=T.Branch_Tag

				Union

				Select Distinct Branch_Tag As Branch_Tag,Branch_Name,
							'0' As  EBroking, '0' AS IT, '0' As Total_Issue,'' As CentralSupport
				From Tbl_CSOMaster
				Where Branch_Tag in (Select Bibranch From VLMS_RolemasterEquity	Where RegionalHead=@USER)
					AND Branch_Tag NOT IN
					(
						Select distinct UM.Branch_ID As Branch_Tag
						From Tbl_NewClient_Details D with (NOLOCK), MUser_Master UM with (NOLOCK), Tbl_CSOMaster CSO with (NOLOCK) 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
							and UM.Branch_ID=CSO.Branch_Tag
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
											(Select Bibranch From VLMS_RolemasterEquity	
											Where RegionalHead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					)
				--Order BY Total_Issue DESC
			) Temp, tbl_ITBranchMaster
			where [Branch_Tag] = Branch_Code

		End
		Else If(@ROLE='CH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],CSO_Code,[Branch_Tag],temp.[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
				From 
				(
					select distinct(Branch_Tag),Branch_Name,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport
					From 
					(
						Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
						From
						(
							Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
							From Tbl_NewClient_Details D with (NOLOCK), MUser_Master UM with (NOLOCK), Tbl_CSOMaster CSO with (NOLOCK) 
							Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
								and UM.Branch_ID=CSO.Branch_Tag
								and D.Issue_Resolved_By=UM.UserID 
								and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@TO)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where clusterhead=@USER)
								and Role_ID not in ('BH', 'RH','ZH','CH'))
								And UM.Account_Status=1
						) as tmp1 
						group by Branch_Tag,issue_type,Branch_Name
					) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
				) T, MUser_Master UM
				Where UM.Branch_ID=T.Branch_Tag

				Union

				Select Distinct Branch_Tag As Branch_Tag,Branch_Name,
							'0' As  EBroking, '0' AS IT, '0' As Total_Issue,'' As CentralSupport
				From Tbl_CSOMaster
				Where Branch_Tag in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
					AND Branch_Tag NOT IN
					(
						Select distinct UM.Branch_ID As Branch_Tag
						From Tbl_NewClient_Details D with (NOLOCK), MUser_Master UM with (NOLOCK), Tbl_CSOMaster CSO with (NOLOCK) 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
							and UM.Branch_ID=CSO.Branch_Tag
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
											(Select Bibranch From VLMS_RolemasterEquity	
											Where clusterhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					)
				--Order BY Total_Issue DESC
			) Temp, tbl_ITBranchMaster
			where [Branch_Tag] = Branch_Code

		End
		Else If(@ROLE='ZH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],CSO_Code,[Branch_Tag],temp.[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
				From 
				(
					select distinct(Branch_Tag),Branch_Name,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport
					From 
					(
						Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
						From
						(
							Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
							From Tbl_NewClient_Details D with (NOLOCK), MUser_Master UM with (NOLOCK), Tbl_CSOMaster CSO with (NOLOCK) 
							Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
								and UM.Branch_ID=CSO.Branch_Tag
								and D.Issue_Resolved_By=UM.UserID 
								and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@TO)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where zonalhead=@USER)
								and Role_ID not in ('BH', 'RH','ZH','CH'))
								And UM.Account_Status=1
						) as tmp1 
						group by Branch_Tag,issue_type,Branch_Name
					) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
				) T, MUser_Master UM
				Where UM.Branch_ID=T.Branch_Tag

				Union

				Select Distinct Branch_Tag As Branch_Tag,Branch_Name,
							'0' As  EBroking, '0' AS IT, '0' As Total_Issue,'' As CentralSupport
				From Tbl_CSOMaster
				Where Branch_Tag in (Select Bibranch From VLMS_RolemasterEquity	Where zonalHead=@USER)
					AND Branch_Tag NOT IN
					(
						Select distinct UM.Branch_ID As Branch_Tag
						From Tbl_NewClient_Details D with (NOLOCK), MUser_Master UM with (NOLOCK), Tbl_CSOMaster CSO with (NOLOCK) 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
							and UM.Branch_ID=CSO.Branch_Tag
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
											(Select Bibranch From VLMS_RolemasterEquity	
											Where zonalHead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					)
				--Order BY Total_Issue DESC
			) Temp, tbl_ITBranchMaster
			where [Branch_Tag] = Branch_Code
		End	
		Else If(@ROLE='BH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],CSO_Code,[Branch_Tag],temp.[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
				From 
				(
					select distinct(Branch_Tag),Branch_Name,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport
					From 
					(
						Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
						From
						(
							Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
							From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
							Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
								and UM.Branch_ID=CSO.Branch_Tag
								and D.Issue_Resolved_By=UM.UserID 
								and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
								And UM.Account_Status=1
						) as tmp1 
						group by Branch_Tag,issue_type,Branch_Name
					) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
				) T, MUser_Master UM
				Where UM.Branch_ID=T.Branch_Tag

				Union 

				Select Distinct Branch_Tag As Branch_Tag,Branch_Name,
							'0' As  EBroking, '0' AS IT, '0' As Total_Issue,'' As CentralSupport
				From Tbl_CSOMaster
				Where Branch_Tag in (Select Bibranch From VLMS_RolemasterEquity	Where BranchHead=@USER)
					AND Branch_Tag NOT IN
					(
						Select distinct UM.Branch_ID As Branch_Tag
							From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
							Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
								and UM.Branch_ID=CSO.Branch_Tag
								and D.Issue_Resolved_By=UM.UserID 
								and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
								And UM.Account_Status=1
					)
			--Order BY Total_Issue DESC
			) Temp, tbl_ITBranchMaster
			where [Branch_Tag] = Branch_Code

		End
		Else If(@ROLE='ITM')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],CSO_Code,[Branch_Tag],Temp.[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
			From	
			(
				select ISNULL(Branch.BranchTag,0) As Branch_Tag, ISNULL(BranchName,0) As [Branch_Name], 
						ISNULL(EBroking,0) AS [EBroking], ISNULL(IT,0) AS IT, 
						ISNULL(Total_Issue,0) As [Total_Issue], ISNULL(CentralSupport,0) AS [CentralSupport]
				From 
				(
					select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
					From 
					(
						select distinct(Branch_Tag),Branch_Name,
								sum(EBroking) as EBroking,
								sum(IT) As IT,
								sum(IT) + sum(EBroking) As Total_Issue,
								CentralSupport
						From 
						(
							Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
								EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
								IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
							From
							(
								Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
								From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
								Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
									and UM.Branch_ID=CSO.Branch_Tag
									and D.Issue_Resolved_By=UM.UserID 
									and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
									and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
									and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
									and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
									and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
									and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER))
									And UM.Account_Status=1
							) as tmp1 
							group by Branch_Tag,issue_type,Branch_Name
						) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
					) T, MUser_Master UM
					Where UM.Branch_ID=T.Branch_Tag
				)T
				Right Outer Join  (Select BranchTag, BranchName From tbl_MISBranch Where Emp_ID=@USER) As Branch
					On T.Branch_Tag=Branch.BranchTag			
			) Temp, tbl_ITBranchMaster
			where [Branch_Tag] = Branch_Code
		End
	End
	Else If(@Option=22) --For Particular Branch, IT Issue_Type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
		Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
		from
  		(
			select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					Issue_type,
					CentralSupport
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D ,MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
		)Temp
		End
		Else If(@ROLE='RH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues], sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues], sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues], Issue_type, CentralSupport
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@FROM) And (Convert(Datetime,@TO)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where RegionalHead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='CH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues], sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues], sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues], Issue_type, CentralSupport
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@FROM) And (Convert(Datetime,@TO)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where clusterhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='ZH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues], sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues], sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues], Issue_type, CentralSupport
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@FROM) And (Convert(Datetime,@TO)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where zonalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='BH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						Issue_type,
						CentralSupport
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='ITM')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
			from	
			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						Issue_type,
						CentralSupport
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
	End
	Else If(@Option=23) --For Particular Branch, EBroking Issue_Type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport, Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D, MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='RH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues], CentralSupport, Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D, MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
														and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where regionalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='CH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues], CentralSupport, Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D, MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
														and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where clusterhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='ZH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues], CentralSupport, Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D, MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
														and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	
												Where zonalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='BH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues], CentralSupport, Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D, MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='ITM')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag), sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues], CentralSupport, Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D, MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and D.Issue_type=@Choice 
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code,Issue_type
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
	End
	Else If(@Option=24) --For Particular Branch, Both IT and EBroking (Total) Issue_Type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 		
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport,Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,'Total' As Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
							and D.Issue_Resolved_By=UM.UserID  
							and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='RH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport,Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,'Total' As Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
							and D.Issue_Resolved_By=UM.UserID  
							and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='CH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport,Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,'Total' As Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
							and D.Issue_Resolved_By=UM.UserID  
							and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='ZH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport,Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,'Total' As Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
							and D.Issue_Resolved_By=UM.UserID  
							and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
												(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
		Else If(@ROLE='BH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport,Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,'Total' As Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
							and D.Issue_Resolved_By=UM.UserID  
							and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
			Else If(@ROLE='ITM')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
			from
  			(
				select distinct(Branch_Tag),
						sum(PENDING) as [Pending Issues],
						sum(ESCALATED) As [Escalated Issues],
						sum(REASSIGNED) As [Reassigned Issues],
						sum(COMPLETED) As [Completed Issues],
						sum(CLOSED) As [Closed Issues],
						sum(Total) As [Total Issues],
						CentralSupport,Issue_type
				From 
				(
					Select  Branch_Tag,
							PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
							ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
							REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
							COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
							CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
							TOTAL = ISNULL(COUNT(STATUS_CODE),0),
							'' As CentralSupport,'Total' As Issue_type
					From
					(
						Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
						From Tbl_NewClient_Details D ,MUser_Master UM 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
							and D.Issue_Resolved_By=UM.UserID  
							and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,Status_Code
				) As tmp Group By Branch_Tag,CentralSupport,Issue_type
			)Temp
		End
	End
	If(@Option=25) --For Particular Branch And Particular Issue_type (EBroking/IT/BOTH), Status Count Wise Issue
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				    (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				)Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
              	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			    [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		        from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                 )Temp
				End
				IF(@Choice='IT')
				Begin	
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin	
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
                 )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                   )Temp
				End
				IF(@Choice='IT')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                     )Temp
				End
			End
		End
		Else If(@ROLE='RH')   --================================Regional Head=============================== --
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                   	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                      )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
		     	   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		             from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                      )Temp
				End
				IF(@Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
				IF(@Choice='IT')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
		          (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH')) 
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
		End
		Else If(@ROLE='CH')   --================================Cluster Head=============================== --
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                   	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                      )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
		     	   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		             from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                      )Temp
				End
				IF(@Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
				IF(@Choice='IT')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
		          (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH')) 
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
		End
		Else If(@ROLE='ZH')   --================================Zonal Head=============================== --
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                   	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                      )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
		     	   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		             from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                      )Temp
				End
				IF(@Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                     )Temp
				End
				IF(@Choice='IT')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
		          (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH')) 
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
						and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
		End
		Else If(@ROLE='BH')   --================================Branch Head=============================== --
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                   	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                      )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
		     	   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		             from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                      )Temp
				End
				IF(@Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                     )Temp
				End
				IF(@Choice='IT')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
		          (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
						And UM.Account_Status=1
                    )Temp
				End
			End
		End
		Else If(@ROLE='ITM')   --================================ IT Management =============================== --
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                   	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                      )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
		     	   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		             from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                      )Temp
				End
				IF(@Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                     )Temp
				End
				IF(@Choice='IT')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
		          (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
						And UM.Account_Status=1
                    )Temp
				End
			End
		End

	End
--##############################################################################################################--
							-- USP_MIS_BranchWiseReport_New --
--##############################################################################################################--
						--For Particular Branch, Employee Wise Report --	
--##############################################################################################################--
	Else If (@Option=26)  -- For Particular Branch, Employee Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
				[CentralSupport],[Branch_Tag]
			From
			(
				Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				from 
				(
					select distinct(Username),UserID,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport,Branch_Tag 
					From 
					(
						Select UserID,Username,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
						From
						(
							Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
							From Tbl_NewClient_Details D
								Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
								Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
							Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								And UM.Account_Status=1
						) as tmp1 
						group by Username,UserID,Branch_Tag,issue_type
					) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

					UNION

					Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
					From MUser_Master 
					Where Account_Status=1 And UserID not in 
					(
						Select distinct UM.UserID
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							And UM.Account_Status=1
					)
					and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM','CM','ZM')
				) T
				Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				----Order By Total_Issue desc
			)Temp
		End
		Else If(@ROLE='RH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
				[CentralSupport],[Branch_Tag]
			From
			(					
				Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				from 
				(
					select distinct(Username),UserID,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport,Branch_Tag 
					From 
					(
						Select UserID,Username,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
						From
						(
							Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
							From Tbl_NewClient_Details D
								Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
								Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
							Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
									(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
								and Role_ID not in ('BH', 'RH','ZH','CH'))
								And UM.Account_Status=1
						) as tmp1 
						group by Username,UserID,Branch_Tag,issue_type
					) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

					UNION

					Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
					From MUser_Master 
					Where Account_Status=1 And UserID not in 
					(
						Select distinct UM.UserID
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
									(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					)
					and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM','CM','ZM')
				) T
				Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			)T
--			--Order By Total_Issue desc
		End
		Else If(@ROLE='CH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
				[CentralSupport],[Branch_Tag]
			From
			(
				Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				from 
				(
					select distinct(Username),UserID,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport,Branch_Tag 
					From 
					(
						Select UserID,Username,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
						From
						(
							Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
							From Tbl_NewClient_Details D
								Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
								Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
							Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
									(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
								and Role_ID not in ('BH', 'RH','ZH','CH'))
								And UM.Account_Status=1
						) as tmp1 
						group by Username,UserID,Branch_Tag,issue_type
					) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

					UNION

					Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
					From MUser_Master 
					Where Account_Status=1 And UserID not in 
					(
						Select distinct UM.UserID
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
									(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					)
					and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM','CM','ZM')
				) T
				Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			)T
			--Order By Total_Issue desc
		End
		Else If(@ROLE='ZH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
				[CentralSupport],[Branch_Tag]
			From
			(
				Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				from 
				(
					select distinct(Username),UserID,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport,Branch_Tag 
					From 
					(
						Select UserID,Username,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
						From
						(
							Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
							From Tbl_NewClient_Details D
								Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
								Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
							Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
									(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
								and Role_ID not in ('BH', 'RH','ZH','CH'))
								And UM.Account_Status=1
						) as tmp1 
						group by Username,UserID,Branch_Tag,issue_type
					) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

					UNION

					Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
					From MUser_Master 
					Where Account_Status=1 And UserID not in 
					(
						Select distinct UM.UserID
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
									(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
							and Role_ID not in ('BH', 'RH','ZH','CH'))
							And UM.Account_Status=1
					)
					and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM','CM','ZM')
				) T
				Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			)T
			--Order By Total_Issue desc
		End
		Else If(@ROLE='BH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
				[CentralSupport],[Branch_Tag]
			From
			(
				Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				from 
				(
					select distinct(Username),UserID,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport,Branch_Tag 
					From 
					(
						Select UserID,Username,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
						From
						(
							Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
							From Tbl_NewClient_Details D
								Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
								Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
							Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
								And UM.Account_Status=1
						) as tmp1 
						group by Username,UserID,Branch_Tag,issue_type
					) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

					UNION

					Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
					From MUser_Master 
					Where Account_Status=1 And  UserID not in 
					(
						Select distinct UM.UserID
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
							And UM.Account_Status=1
					)
					and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM','CM','ZM')
				) T
				Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			)T
			--Order By Total_Issue desc
		End
		Else If(@ROLE='ITM')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
				[CentralSupport],[Branch_Tag]
			From
			(
				Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
				from 
				(
					select distinct(Username),UserID,
							sum(EBroking) as EBroking,
							sum(IT) As IT,
							sum(IT) + sum(EBroking) As Total_Issue,
							CentralSupport,Branch_Tag 
					From 
					(
						Select UserID,Username,
							EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
							IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
						From
						(
							Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
							From Tbl_NewClient_Details D
								Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
								Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
							Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
								and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
								and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
								and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
								and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
								And UM.Account_Status=1
						) as tmp1 
						group by Username,UserID,Branch_Tag,issue_type
					) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

					UNION

					Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
					From MUser_Master 
					Where Account_Status=1 And  UserID not in 
					(
						Select distinct UM.UserID
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
							And UM.Account_Status=1
					)
					and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM','CM','ZM')
				) T
				Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			)T
			--Order By Total_Issue desc
		End
	End
	Else If(@Option=27) -- For Particular Branch and Particular Employee, (IT/Branch) Issue_type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
           (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
           )Temp
		End
		Else If(@ROLE='RH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
					and Role_ID not in ('BH', 'RH','ZH','CH'))
					And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='CH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
					and Role_ID not in ('BH', 'RH','ZH','CH'))
					And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='ZH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
								(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
					and Role_ID not in ('BH', 'RH','ZH','CH'))
					And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='BH')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
					And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='ITM')
		Begin
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
					And UM.Account_Status=1
			)Temp
		End
	End
	Else If(@Option=28) -- For Particular Branch and Particular Employee, BOTH IT and Branch (Total) Issue_type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
       		Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='RH')
		Begin
         	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
							(Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER)
				and Role_ID not in ('BH', 'RH','ZH','CH'))
				And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='CH')
		Begin
         	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
							(Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER)
				and Role_ID not in ('BH', 'RH','ZH','CH'))
				And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='ZH')
		Begin
         	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in 
							(Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER)
				and Role_ID not in ('BH', 'RH','ZH','CH'))
				And UM.Account_Status=1
			)Temp
		End
		Else If(@ROLE='BH')
		Begin
         	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where BranchHead=@USER))
				And UM.Account_Status=1
			)Temp
		End
			Else If(@ROLE='ITM')
		Begin
         	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Role_ID not in ('BH', 'RH','ZH','CH') And Branch_ID in (Select BranchTag from tbl_MISBranch where Emp_ID = @User))
				And UM.Account_Status=1
			)Temp
		End
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_CentralSupportWiseReport_NEW
-- --------------------------------------------------

CREATE Proc [dbo].[USP_MIS_CentralSupportWiseReport_NEW]

@CSO as nvarchar(50),
@Branch as Varchar(50),
@EMP As Varchar(20),
@From As nvarchar(22),
@To As nvarchar(22),
@Choice As Char(10),
@Status as Varchar(50),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20),
@Option As Int

As
Begin
--##############################################################################################################--
										    -- CSO Wise --	
--##############################################################################################################--
	If(@Option=1) --(@CSO='') -- CSO wise report
	Begin 
		Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[EBroking],[IT],[Total_Issue]
		From
		(
			select distinct(CentralSupport),
				sum(EBroking) as EBroking,
				sum(IT) As IT,
				sum(IT) + sum(EBroking) As Total_Issue  
			From 
			(
				Select tmp1.CentralSupport,tmp1.Branch_Tag,
					EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
					IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0)
				From
				(
					Select distinct(docket_number),issue_type,branch_tag,CentralSupport
					From Tbl_NewClient_Details D with (nolock)
						Join MUser_Master UM with (nolock) On D.Issue_Resolved_By=UM.Userid 
						Join tbl_CSOMaster CSO with (nolock) On UM.Branch_id=CSO.Branch_Tag 
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 group by CentralSupport,Branch_Tag,issue_type
			) As tmp Group By CentralSupport

			UNION
			
			Select Distinct CentralSupport,'0' As EBroking,'0' As  IT,'0' As Total_Issue
			From tbl_CSOMaster
			Where CentralSupport NOT IN
			(	
				Select Distinct(tmp1.CentralSupport)
				From
				(
					Select distinct(CentralSupport)
					From Tbl_NewClient_Details D with (nolock)
						Join MUser_Master UM with (nolock) On D.Issue_Resolved_By=UM.Userid  
						Join tbl_CSOMaster CSO with (nolock) On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
			) 
			Group By CentralSupport
		) Temp
		--Order BY Total_Issue DESC
	End
	Else If(@Option=2) --For particular CSO IT Issues Count (Status Wise)
	Begin
Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],
[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
from(
		select distinct(CentralSupport),
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
		From 
		(
			Select  CentralSupport,
					PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP','P','UP') THEN COUNT(STATUS_CODE) END,0),
					ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
					REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
					COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
					CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
					TOTAL = ISNULL(COUNT(STATUS_CODE),0),
					Issue_type
			From
			(
				Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_type
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid 
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			) as tmp1 
			group by CentralSupport,Status_Code,Issue_type
		) As tmp Group By CentralSupport,Issue_type
)Temp
	End
	Else If(@Option=3) --For particular CSO EBroking Issue Count  (Status Wise)
	Begin
Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],
[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
from(
		select distinct(CentralSupport),
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
		From 
		(
			Select  CentralSupport,
					PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
					ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
					REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
					COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
					CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
					TOTAL = ISNULL(COUNT(STATUS_CODE),0),
					Issue_type
			From
			(
				Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_type
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid 
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			) as tmp1 
			group by CentralSupport,Status_Code,Issue_type
		) As tmp Group By CentralSupport,Issue_type
)Temp
	End
	Else If(@Option=4) --For particular CSO Both EBroking and IT Count (Status Wise)
	Begin
Select ROW_NUMBER() OVER (ORDER BY CentralSupport) as [No],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],
[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
from(
		select distinct(CentralSupport),
			sum(PENDING) as [Pending Issues],
			sum(ESCALATED) As [Escalated Issues],
			sum(REASSIGNED) As [Reassigned Issues],
			sum(COMPLETED) As [Completed Issues],
			sum(CLOSED) As [Closed Issues],
			sum(Total) As [Total Issues],
			Issue_type
		From 
		(
			Select  CentralSupport,
					PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
					ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
					REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
					COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
					CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
					TOTAL = ISNULL(COUNT(STATUS_CODE),0),
					'Total' As Issue_type
			From
			(
				Select distinct(docket_number),Status_Code,branch_tag,CentralSupport
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By<>NULL) and D.Issue_type<>''
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			) as tmp1 
			group by CentralSupport,Status_Code
		) As tmp Group By CentralSupport,Issue_type
)Temp
	End
	If(@Option=5) --For particular CSO (EBroking/IT/BOTH) Status Count Wise Issue
	Begin
		If(@Status='Pending')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
             [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	         from	
            (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1 
              )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP') 
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
		End
		Else If(@Status='Completed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                 )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('C','ITC')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Closed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('X') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
		End
		Else If(@Status='Escalated')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1 
                )Temp
			End
			IF(@Choice='IT')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (	
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1 
               )Temp
			End
			Else If(@Choice='Total')
			Begin
                Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Reassigned')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1 
              )Temp
			End
			IF(@Choice='IT')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (	
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               ) Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
		End
		Else If(@Status='Total')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
			IF(@Choice='IT')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			 [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	          from	
              (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
	End
--##############################################################################################################--
								   --For Particular CSO, Branch Wise Report --	
--##############################################################################################################--	
	ELse If(@Option=6) --(@CSO<>'' and @Branch='') -- For Particular CSO Branch wise Report 
	Begin
      Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Branch_Tag],[Branch_Name],[CentralSupport],[EBroking],[IT],[Total_Issue]
		From
		(
		Select distinct Branch_Tag,Branch_Name,CentralSupport,Ebroking,IT,Total_Issue
		From
		(
			select distinct(Branch_Tag),Branch_Name,CentralSupport ,
					sum(EBroking) as EBroking,
					sum(IT) As IT,
					sum(IT) + sum(EBroking) As Total_Issue  
			From 
			(
				Select distinct tmp1.Branch_Tag,Branch_Name,CentralSupport ,
					EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
					IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0)
				From
				(
					Select distinct(docket_number),issue_type,branch_tag,Branch_Name,CentralSupport
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,CentralSupport,issue_type,Branch_Name
			) As tmp 
			Group By Branch_Tag,CentralSupport,Branch_Name
		
			UNION

			Select Distinct Branch_Tag,Branch_Name,CentralSupport,'0'Ebroking,'0' As IT,'0' As Total_Issue
			From tbl_CSOMaster
			Where Branch_Tag not IN
			(
				Select distinct(Branch_Tag)
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			)
			and CentralSupport=@CSO
		) T, MUser_Master UM
		Where UM.Branch_ID=T.Branch_Tag
		--Order By Total_Issue DESC
)Temp
	End
	Else If(@Option=7) --For particular CSO and Particular Branch, IT Issues Count (Status Wise)
	Begin
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
	from	
       (
		select distinct(Branch_Tag),CentralSupport,
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
		From 
		(
			Select  Branch_Tag,CentralSupport,
					PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP','P','UP') THEN COUNT(STATUS_CODE) END,0),
					ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
					REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
					COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
					CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
					TOTAL = ISNULL(COUNT(STATUS_CODE),0),Issue_type
			From
			(
				Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_Type
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			) as tmp1 
			group by Branch_Tag,CentralSupport,Status_Code,Issue_type
		) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
	End
	Else If(@Option=8) --For particular CSO and Particular Branch, EBroking Issue Count  (Status Wise)
	Begin
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
	from	
       (
		select distinct(Branch_Tag),CentralSupport,
				sum(PENDING) as [Pending Issues],
				sum(ESCALATED) As [Escalated Issues],
				sum(REASSIGNED) As [Reassigned Issues],
				sum(COMPLETED) As [Completed Issues],
				sum(CLOSED) As [Closed Issues],
				sum(Total) As [Total Issues],
				Issue_type
		From 
		(
			Select  Branch_Tag,CentralSupport,
					PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
					ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
					REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
					COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
					CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
					TOTAL = ISNULL(COUNT(STATUS_CODE),0),
					Issue_type
			From
			(
				Select distinct(docket_number),Status_Code,branch_tag,CentralSupport,D.Issue_type
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Issue_type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			) as tmp1 
			group by Branch_Tag,CentralSupport,Status_Code,Issue_type
		) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
	End
	Else If(@Option=9) --For particular CSO and Particular Branch, Both EBroking and IT Count (Status Wise)
	Begin
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[CentralSupport],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type]
	from	
       (
		select distinct(Branch_Tag),CentralSupport,
			sum(PENDING) as [Pending Issues],
			sum(ESCALATED) As [Escalated Issues],
			sum(REASSIGNED) As [Reassigned Issues],
			sum(COMPLETED) As [Completed Issues],
			sum(CLOSED) As [Closed Issues],
			sum(Total) As [Total Issues],
			Issue_type
		From 
		(
			Select  Branch_Tag,CentralSupport,
					PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
					ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
					REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
					COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
					CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
					TOTAL = ISNULL(COUNT(STATUS_CODE),0),
					'Total' As Issue_type
			From
			(
				Select distinct(docket_number),Status_Code,branch_tag,CentralSupport
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By<>NULL) and D.Issue_type<>''
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			) as tmp1 
			group by Branch_Tag,CentralSupport,Status_Code
		) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
	End
	If(@Option=10) --For particular CSO and Particular Branch, (EBroking/IT/BOTH) Status Count Wise Issue
	Begin
		If(@Status='Pending')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
			Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
				(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
             )Temp
			End
			Else If(@Choice='Total')
			Begin
            Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
				(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP') 
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                 )Temp
			End
		End
		Else If(@Status='Completed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
				(
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                  )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('C','ITC')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Closed')
		Begin
			IF(@Choice='EBro' or @Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('X') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
		End
		Else If(@Status='Escalated')
		Begin
			IF(@Choice='EBro')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
			IF(@Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
              )Temp
			End
		End
		Else If(@Status='Reassigned')
		Begin
			IF(@Choice='EBro')
			Begin	
              Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			IF(@Choice='IT')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
               )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
		End
		Else If(@Status='Total')
		Begin
			IF(@Choice='EBro')
			Begin	
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                 )Temp
			End
			IF(@Choice='IT')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
					and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
                )Temp
			End
			Else If(@Choice='Total')
			Begin
             Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			 from	
			  (
				Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
					D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
					D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
					convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
					Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
					JS.jobstatus_name As [Status]
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
				Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch
					and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
					and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
            )Temp
			End
		End
	End
--##############################################################################################################--
						--For Particular CSO and Particular Branch, Employee Wise Report --	
--##############################################################################################################--
	Else If (@Option=11)  -- For Particlar CSO and Particular Branch, Employee Wise Report
	Begin
      Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[Branch_Tag],[CentralSupport],[EBroking],[IT],[Total_Issue]
     
		From
		(
		Select Username, UserID,Branch_Tag,CentralSupport, EBroking, IT, Total_Issue
		from 
		(
			select distinct(Username),UserID,Branch_Tag,CentralSupport,
					sum(EBroking) as EBroking,
					sum(IT) As IT,
					sum(IT) + sum(EBroking) As Total_Issue  
			From 
			(
				Select UserID,Username,tmp1.Branch_Tag,CentralSupport,
					EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
					IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0)
				From
				(
					Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,branch_tag,CentralSupport
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
						and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by UserID,Username,Branch_Tag,CentralSupport,issue_type
			) As tmp Group By Username,UserID,Branch_Tag,CentralSupport

			UNION

			Select Username, UserID,Branch_ID As [Branch_Tag],CentralSupport, '0' AS Ebroking, '0' As IT,'0' As Total_Issue
			From MUser_Master , tbl_CSOMaster CSO 
			Where UserID not in 
			(
				Select distinct(UserID)
				From Tbl_NewClient_Details D
					Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
					Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
					and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
					and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
					and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
					and UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
					and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					And UM.Account_Status=1
			)
			and Branch_ID=@Branch and Branch_id=Branch_Tag
			and Team_ID not in ('M','S','Surveillance','F')
		) T
		Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
		--Order By Total_Issue desc
)Temp
	End
	Else If(@Option=12) -- For Particlar CSO and Particular Branch and Particular Employee, (IT/Branch) Issue_type Wise Report
	Begin
     	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
	    [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	    from	
	    (
		Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
			D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
			D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
			convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
			Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,			
			JS.jobstatus_name As [Status]
		From Tbl_NewClient_Details D
			Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
			Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
			Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
		Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
			and UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
			and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
			And UM.Account_Status=1
         )Temp
	End
	Else If(@Option=13) -- For Particlar CSO and Particular Branch and Particular Employee, BOTH IT and Branch (Total) Issue_type Wise Report
	Begin
     Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
	  [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	  from	
	  (
		Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
			D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
			D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
			convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
			Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
			JS.jobstatus_name As [Status]
		From Tbl_NewClient_Details D
			Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
			Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
			Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
		Where UM.Branch_id in ( Select Distinct Branch_Tag From tbl_CSOMaster where CentralSupport=@CSO)
			and UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
			and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
			And UM.Account_Status=1
      )Temp
	End

--##############################################################################################################--
								-- USP_MIS_BranchWiseReport_New --
--##############################################################################################################--
						--For Particular Branch, Employee Wise Report --	
--##############################################################################################################--
	Else If(@Option=21) -- Branch Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 

Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
from (
			select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
			From 
			(
				select distinct(Branch_Tag),Branch_Name,
						sum(EBroking) as EBroking,
						sum(IT) As IT,
						sum(IT) + sum(EBroking) As Total_Issue,
						CentralSupport
				From 
				(
					Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
						EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
						IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
					From
					(
						Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
						From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
							and UM.Branch_ID=CSO.Branch_Tag
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,issue_type,Branch_Name
				) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	

				UNION
			
				select distinct(CSO.Branch_Tag), CSO.Branch_Name, '0' as EBroking,
					'0' As IT, '0' As Total_Issue, ' ' As CentralSupport
				From Tbl_CSOMaster CSO 
				Where Branch_Tag NOT IN
				(
					Select distinct CSO.Branch_Tag
					From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
						and UM.Branch_ID=CSO.Branch_Tag
						and D.Issue_Resolved_By=UM.UserID 
						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) 
			) T , MUser_Master UM
			Where UM.Branch_ID=T.Branch_Tag
			--Order BY Total_Issue DESC
)temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
--			From 
--			(
--				select distinct(Branch_Tag),Branch_Name,
--						sum(EBroking) as EBroking,
--						sum(IT) As IT,
--						sum(IT) + sum(EBroking) As Total_Issue,
--						CentralSupport
--				From 
--				(
--					Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
--						EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
--						IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
--					From
--					(
--						Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
--						From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
--						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
--							and UM.Branch_ID=CSO.Branch_Tag
--							and D.Issue_Resolved_By=UM.UserID 
--							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--					) as tmp1 
--					group by Branch_Tag,issue_type,Branch_Name
--				) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
--
--				UNION
--			
--				select distinct(Branch_Tag), Branch_Name, '0' as EBroking,
--					'0' As IT, '0' As Total_Issue, ' ' As CentralSupport
--				From Tbl_CSOMaster
--				Where Branch_Tag NOT IN
--				(
--					Select distinct CSO.Branch_Tag
--					From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
--						and UM.Branch_ID=CSO.Branch_Tag
--						and D.Issue_Resolved_By=UM.UserID 
--						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				) 
--			) T Order BY Total_Issue DESC
--		End
		Else If(@ROLE='BH')
		Begin
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Branch_Name],[EBroking],[IT],[Total_Issue],[CentralSupport]
from	(
			select distinct(Branch_Tag), Branch_Name, EBroking, IT, Total_Issue, CentralSupport
			From 
			(
				select distinct(Branch_Tag),Branch_Name,
						sum(EBroking) as EBroking,
						sum(IT) As IT,
						sum(IT) + sum(EBroking) As Total_Issue,
						CentralSupport
				From 
				(
					Select Distinct tmp1.Branch_Tag As Branch_Tag,Branch_Name,
						EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
						IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport
					From
					(
						Select distinct D.Docket_number,D.Issue_Type,UM.Branch_ID As Branch_Tag,CSO.Branch_Name
						From Tbl_NewClient_Details D, MUser_Master UM, Tbl_CSOMaster CSO 
						Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master) 
							and UM.Branch_ID=CSO.Branch_Tag
							and D.Issue_Resolved_By=UM.UserID 
							and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Branch_Tag,issue_type,Branch_Name
				) As tmp Group By Branch_Tag,Branch_Name,CentralSupport	
			) T, MUser_Master UM
			Where UM.Branch_ID=T.Branch_Tag
			--Order BY Total_Issue DESC
) Temp
		End
	End
	Else If(@Option=22) --For Particular Branch, IT Issue_Type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
	from
  	(
			select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					Issue_type,
					CentralSupport
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D ,MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(Branch_Tag),
--					sum(PENDING) as [Pending Issues],
--					sum(ESCALATED) As [Escalated Issues],
--					sum(REASSIGNED) As [Reassigned Issues],
--					sum(COMPLETED) As [Completed Issues],
--					sum(CLOSED) As [Closed Issues],
--					sum(Total) As [Total Issues],
--					Issue_type,
--					CentralSupport
--			From 
--			(
--				Select  Branch_Tag,
--						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
--						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
--						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
--						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
--						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
--						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
--						'' As CentralSupport,Issue_type
--				From
--				(
--					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
--					From Tbl_NewClient_Details D ,MUser_Master UM 
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
--						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				) as tmp1 
--				group by Branch_Tag,Status_Code,Issue_type
--			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
--		End
		Else If(@ROLE='BH')
		Begin
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[Issue_type],[CentralSupport]
		from	
           (
			select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					Issue_type,
					CentralSupport
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D ,MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
		End
	End
	Else If(@Option=23) --For Particular Branch, EBroking Issue_Type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
	from
  	(
			select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					CentralSupport, Issue_type
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D, MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(Branch_Tag),
--					sum(PENDING) as [Pending Issues],
--					sum(ESCALATED) As [Escalated Issues],
--					sum(REASSIGNED) As [Reassigned Issues],
--					sum(COMPLETED) As [Completed Issues],
--					sum(CLOSED) As [Closed Issues],
--					sum(Total) As [Total Issues],
--					CentralSupport, Issue_type
--			From 
--			(
--				Select  Branch_Tag,
--						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
--						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
--						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
--						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
--						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
--						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
--						'' As CentralSupport,Issue_type
--				From
--				(
--					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
--					From Tbl_NewClient_Details D, MUser_Master UM 
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				) as tmp1 
--				group by Branch_Tag,Status_Code,Issue_type
--			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
--		End
		Else If(@ROLE='BH')
		Begin
Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
	from
  	(
	   select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					CentralSupport, Issue_type
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D, MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id=@Branch and D.Issue_type=@Choice 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code,Issue_type
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
		End
	End
	Else If(@Option=24) --For Particular Branch, Both IT and EBroking (Total) Issue_Type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 		
 Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
	from
  	(
			select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					CentralSupport,Issue_type
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,'Total' As Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D ,MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
)Temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(Branch_Tag),
--					sum(PENDING) as [Pending Issues],
--					sum(ESCALATED) As [Escalated Issues],
--					sum(REASSIGNED) As [Reassigned Issues],
--					sum(COMPLETED) As [Completed Issues],
--					sum(CLOSED) As [Closed Issues],
--					sum(Total) As [Total Issues],
--					CentralSupport,Issue_type
--			From 
--			(
--				Select  Branch_Tag,
--						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
--						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
--						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
--						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
--						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
--						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
--						'' As CentralSupport,'Total' As Issue_type
--				From
--				(
--					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
--					From Tbl_NewClient_Details D ,MUser_Master UM 
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
--						and D.Issue_Resolved_By=UM.UserID  
--						and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				) as tmp1 
--				group by Branch_Tag,Status_Code
--			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
--		End
		Else If(@ROLE='BH')
		Begin
   Select ROW_NUMBER() OVER (ORDER BY Branch_Tag ) as [No],[Branch_Tag],[Pending Issues],[Escalated Issues],[Reassigned Issues],[Completed Issues],[Closed Issues],[Total Issues],[CentralSupport],[Issue_type]
	from
  	(
			select distinct(Branch_Tag),
					sum(PENDING) as [Pending Issues],
					sum(ESCALATED) As [Escalated Issues],
					sum(REASSIGNED) As [Reassigned Issues],
					sum(COMPLETED) As [Completed Issues],
					sum(CLOSED) As [Closed Issues],
					sum(Total) As [Total Issues],
					CentralSupport,Issue_type
			From 
			(
				Select  Branch_Tag,
						PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP','ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
						ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') THEN COUNT(STATUS_CODE) END,0),
						REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R') THEN COUNT(STATUS_CODE) END,0),
						COMPLETED= ISNULL(CASE WHEN STATUS_CODE in ('C','ITC') THEN COUNT(STATUS_CODE) END,0),
						CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
						TOTAL = ISNULL(COUNT(STATUS_CODE),0),
						'' As CentralSupport,'Total' As Issue_type
				From
				(
					Select distinct(D.docket_number),D.Status_Code,UM.Branch_ID As Branch_Tag,D.Issue_type
					From Tbl_NewClient_Details D ,MUser_Master UM 
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
				) as tmp1 
				group by Branch_Tag,Status_Code
			) As tmp Group By Branch_Tag,CentralSupport,Issue_type
	)Temp
	End
	End
	If(@Option=25) --For Particular Branch And Particular Issue_type (EBroking/IT/BOTH), Status Count Wise Issue
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				    (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				)Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
              	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			    [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		        from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				(
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                 )Temp
				End
				IF(@Choice='IT')
				Begin	
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin	
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1 
                 )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                  )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				 (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                   )Temp
				End
				IF(@Choice='IT')
				Begin	
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
                     )Temp
				End
			End
		End
--		Else If(@ROLE='RH') --=============================== Regional Head =================================--
--		Begin
--			If(@Status='Pending')
--			Begin
--				IF(@Choice='EBro' or @Choice='IT')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				Else If(@Choice='Total')
--				Begin
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
--						and D.Issue_Resolved_By=UM.UserID  
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('P','UP','ITP','ITUP') 
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--			End
--			Else If(@Status='Completed')
--			Begin
--				IF(@Choice='EBro' or @Choice='IT')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				Else If(@Choice='Total')
--				Begin
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('C','ITC')
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--			End
--			Else If(@Status='Closed')
--			Begin
--				IF(@Choice='EBro' or @Choice='IT')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('X') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				Else If(@Choice='Total')
--				Begin
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
--						and D.Issue_Resolved_By=UM.UserID  
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--			End
--			Else If(@Status='Escalated')
--			Begin
--				IF(@Choice='EBro')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				IF(@Choice='IT')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
--						and D.Issue_Resolved_By=UM.UserID  
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				Else If(@Choice='Total')
--				Begin
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--			End
--			Else If(@Status='Reassigned')
--			Begin
--				IF(@Choice='EBro')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('R') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				IF(@Choice='IT')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
--						and D.Issue_Resolved_By=UM.UserID  
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				Else If(@Choice='Total')
--				Begin
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--			End
--			Else If(@Status='Total')
--			Begin
--				IF(@Choice='EBro')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
--						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				IF(@Choice='IT')
--				Begin	
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
--						and D.Issue_Resolved_By=UM.UserID  
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
--						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--				Else If(@Choice='Total')
--				Begin
--					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--						JS.jobstatus_name As [Status]
--					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
--					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
--						and D.Issue_Resolved_By=UM.UserID 
--						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
--						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
--						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				End
--			End
--		End
		Else If(@ROLE='BH')   --================================Branch Head=============================== --
		Begin
			If(@Status='Pending')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                     )Temp
				End
				Else If(@Choice='Total')
				Begin
                  Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			     [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			     from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Completed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin	
                   	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                      )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('C','ITC')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Closed')
			Begin
				IF(@Choice='EBro' or @Choice='IT')
				Begin
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			        from	
		     	   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('X') and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
			Else If(@Status='Escalated')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			        [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		             from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('L1E','E3','EF','ET') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                      )Temp
				End
				IF(@Choice='IT')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                   )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET') 
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                     )Temp
				End
			End
			Else If(@Status='Reassigned')
			Begin
				IF(@Choice='EBro')
				Begin	
                 	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                     )Temp
				End
				IF(@Choice='IT')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R') and D.Issue_Type=@Choice
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		           from	
				   (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R','R')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                   )Temp
				End
			End
			Else If(@Status='Total')
			Begin
				IF(@Choice='EBro')
				Begin	
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
		          (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','L1E','E3','EF','ET','R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                    )Temp
				End
				IF(@Choice='IT')
				Begin
                  	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			       [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			       from	
				   (	
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch)
						and D.Issue_Resolved_By=UM.UserID  
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL2RO','ITL2RN','ITL2RV','ITL3R','C','ITC','X') 
						and D.Issue_Type=@Choice and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                    )Temp
				End
				Else If(@Choice='Total')
				Begin
                 Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			      [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			      from	
				  (
					Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
						D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
						D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
						convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
						Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
						JS.jobstatus_name As [Status]
					From Tbl_NewClient_Details D, MUser_Master UM , jobstatusmaster JS
					Where D.Issue_Resolved_By in (Select Distinct Userid from MUser_Master where Branch_ID=@Branch) 
						and D.Issue_Resolved_By=UM.UserID 
						and UM.Branch_id=@Branch and D.Status_Code=JS.Jobstatus_ID
						and D.Status_Code in ('P','UP','ITP','ITUP','ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3','L1E','E3','EF','ET','ITL2RO','ITL2RN','ITL2RV','ITL3R','R','C','ITC','X')
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
                    )Temp
				End
			End
		End

	End
--##############################################################################################################--
							-- USP_MIS_BranchWiseReport_New --
--##############################################################################################################--
						--For Particular Branch, Employee Wise Report --	
--##############################################################################################################--
	Else If (@Option=26)  -- For Particular Branch, Employee Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
       Select ROW_NUMBER() OVER (ORDER BY Total_Issue) as [No],[Username],[UserID],[EBroking],[IT],[Total_Issue],
       [CentralSupport],[Branch_Tag]
		From
		(
			Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			from 
			(
				select distinct(Username),UserID,
						sum(EBroking) as EBroking,
						sum(IT) As IT,
						sum(IT) + sum(EBroking) As Total_Issue,
						CentralSupport,Branch_Tag 
				From 
				(
					Select UserID,Username,
						EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
						IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
					From
					(
						Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
					) as tmp1 
					group by Username,UserID,Branch_Tag,issue_type
				) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

				UNION

				Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
				From MUser_Master 
				Where UserID not in 
				(
					Select distinct UM.UserID
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						And UM.Account_Status=1
				)
				and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM')
			) T
			Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			--Order By Total_Issue desc
)Temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
--			from 
--			(
--				select distinct(Username),UserID,
--						sum(EBroking) as EBroking,
--						sum(IT) As IT,
--						sum(IT) + sum(EBroking) As Total_Issue,
--						CentralSupport,Branch_Tag 
--				From 
--				(
--					Select UserID,Username,
--						EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
--						IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
--					From
--					(
--						Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
--						From Tbl_NewClient_Details D
--							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
--							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
--						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--					) as tmp1 
--					group by Username,UserID,Branch_Tag,issue_type
--				) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 
--
--				UNION
--
--				Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
--				From MUser_Master 
--				Where UserID not in 
--				(
--					Select distinct UM.UserID
--					From Tbl_NewClient_Details D
--						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
--						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
--					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
--						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
--						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
--						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
--						and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--				)
--				and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM')
--			) T
--			Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
--			Order By Total_Issue desc
--		End
		Else If(@ROLE='BH')
		Begin
			Select Username, UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			from 
			(
				select distinct(Username),UserID,
						sum(EBroking) as EBroking,
						sum(IT) As IT,
						sum(IT) + sum(EBroking) As Total_Issue,
						CentralSupport,Branch_Tag 
				From 
				(
					Select UserID,Username,
						EBroking=ISNULL(CASE WHEN Issue_Type='EBro'  Then COUNT(Issue_Type) END, 0),
						IT=ISNULL(CASE WHEN Issue_Type='IT' Then COUNT(Issue_Type) END, 0),'' As CentralSupport,Branch_Tag
					From
					(
						Select distinct(docket_number),UM.UserID,UM.Username,Issue_type,CSO.Branch_Tag As Branch_Tag
						From Tbl_NewClient_Details D
							Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
							Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
						Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
							and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
							and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
							and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
							and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							And UM.Account_Status=1
					) as tmp1 
					group by Username,UserID,Branch_Tag,issue_type
				) As tmp Group By Username,UserID,CentralSupport,Branch_Tag 

				UNION

				Select Username, UserID, '0' AS Ebroking, '0' As IT,'0' As Total_Issue,'' As CentralSupport,Branch_ID As Branch_Tag
				From MUser_Master 
				Where UserID not in 
				(
					Select distinct UM.UserID
					From Tbl_NewClient_Details D
						Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
						Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
					Where D.Status_Code not like '%PDA%' and D.Status_Code<>'L' 
						and (D.Issue_Type<>'' or D.Issue_Type IS NOT NULL) 
						and (D.Status_Code<>'' or D.Status_Code IS NOT NULL)
						and (D.Issue_Resolved_By<>'' or D.Issue_Resolved_By IS NOT NULL)
						and UM.Branch_id=@Branch and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						And UM.Account_Status=1
				)
				and Branch_ID=@Branch and Team_ID not in ('M','S','Surveillance','F','BM','RM')
			) T
			Group By Username,UserID, EBroking, IT, Total_Issue,CentralSupport,Branch_Tag 
			Order By Total_Issue desc
		End
	
	End
	Else If(@Option=27) -- For Particular Branch and Particular Employee, (IT/Branch) Issue_type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
         Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
         [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	      from	
           (
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				And UM.Account_Status=1
           )Temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--				JS.jobstatus_name As [Status]
--			From Tbl_NewClient_Details D
--				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
--				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
--				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
--			Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
--				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--		End
		Else If(@ROLE='BH')
		Begin
         Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
         [Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
	      from	
          (
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Type=@Choice and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				And UM.Account_Status=1
		)Temp
	End
	Else If(@Option=28) -- For Particular Branch and Particular Employee, BOTH IT and Branch (Total) Issue_type Wise Report
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
       	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
		[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
		from	
		(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				And UM.Account_Status=1
          )Temp
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
--				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
--				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
--				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
--				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
--				JS.jobstatus_name As [Status]
--			From Tbl_NewClient_Details D
--				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
--				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
--				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
--			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
--				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
--		End
		Else If(@ROLE='BH')
		Begin
         	Select ROW_NUMBER() OVER (ORDER BY Docket_Number ) as [No],[Docket_Number],[Client_Code],[Product_Code],[Nature],[Problem],
			[Brief_Solution],[Issue_Raised_Datetime],[Resolution_Time],[Remark],[Status]
			from	
			(
			Select distinct D.Docket_number As [Docket_Number], D.Client_Code As [Client_Code] ,
				D.product_code As [Product_Code], D.nature As Nature, D.problem As Problem,
				D.Brief_Solution As [Brief_Solution], D.Issue_Raised_Datetime As [Issue_Raised_Datetime],
				convert(varchar(22),D.issue_resolving_time,8) As [Resolution_Time],
				Replace((D.L1_InitialRemark + D.L1_FinalRemark + D.L2_UserRemark +D.L3_UserRemark),'\n','==||==') AS Remark,
				JS.jobstatus_name As [Status]
			From Tbl_NewClient_Details D
				Join MUser_Master UM On D.Issue_Resolved_By=UM.Userid
				Join tbl_CSOMaster CSO On UM.Branch_id=CSO.Branch_Tag
				Join jobstatusmaster JS On D.Status_Code=JS.Jobstatus_ID
			Where UM.Branch_id=@Branch and D.Issue_Resolved_By=@EMP
				and Convert(Datetime,D.Issue_Raised_Datetime) Between Convert(Datetime,@From) And (Convert(Datetime,@To)+1)
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				And UM.Account_Status=1
			)Temp
		End
	End
  End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_CREWiseReport
-- --------------------------------------------------


CREATE proc [dbo].[usp_MIS_CREWiseReport]
@Executive_ID as nvarchar(50),
@Status as nvarchar(50)
as
if(@Executive_ID='' and @Status ='')
begin
	select distinct(issue_resolved_by)AS EXECUTIVE_ID,UM.userName AS USER_NAME ,sum(PENDING) as PENDING,sum(ESCALATED) as ESCALATED,sum(REASSIGNED) as REASSIGNED,sum(COMPLETED) as COMPLETED,sum(CLOSED) as CLOSED,sum(PENDING)+sum(ESCALATED)+sum(REASSIGNED)+sum(COMPLETED)+sum(CLOSED) as TOTAL from
	(
		select 
		issue_resolved_by,
		PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
		ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
		REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
		COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
		CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
		TOTAL = ISNULL(COUNT(STATUS_CODE),0)
		from (select issue_resolved_by,STATUS_CODE from tbl_newtaskdetails where issue_type='IT')
		as temp1
		GROUP BY temp1.STATUS_CODE,issue_resolved_by
	) temp,MUser_Master UM where temp.issue_resolved_by=UM.userid group by issue_resolved_by,UM.userName order by UM.userName
end
if(@Executive_ID<>'' and @Status <>'')
begin
	if(@Status='PENDING')
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
		where issue_resolved_by=@Executive_ID and issue_type='IT' and STATUS_CODE IN ('ITP','ITUP')
	if(@Status='ESCALATED')
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
		where issue_resolved_by=@Executive_ID and issue_type='IT'  and STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3')
	if(@Status='REASSIGNED')
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
		where issue_resolved_by=@Executive_ID and issue_type='IT' and STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
	if(@Status='COMPLETED')
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
		where issue_resolved_by=@Executive_ID and issue_type='IT' and STATUS_CODE ='ITC'
	if(@Status='CLOSED')
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
		where issue_resolved_by=@Executive_ID and issue_type='IT' and STATUS_CODE ='X'
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_EmpPerformance
-- --------------------------------------------------






CREATE Proc [dbo].[USP_MIS_EmpPerformance]
--Author:	Sanjay Lavu Kudtarkar
@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@EmpId as varchar(20),
@Status as varchar(50)
as
declare @Teamid varchar(10) 
select @Teamid=team_id from MUser_Master where userid=@EmpId
---- //////////////////// Status BLANK ///////////////// ----
if @Status=''
begin 
	if @FromDate='' and @ToDate=''
	begin
		select tmp1.*,tmp2.* from
		(select
		issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,sum(Total_issues) as Total_issues,
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Minimum_Time,
		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Default_Average_Time
		from
		(
		SELECT 
		product_name,issue_resolved_by,username,
		Periodic_Issues = ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate())  THEN count(docket_number) END,0),
		Total_issues=ISNULL(count(docket_number) ,0),
		Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
		FROM 
		(select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username from tbl_NewTaskDetails join vendor_product on tbl_NewTaskDetails.product_code=vendor_product.product_code join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by where tbl_NewTaskDetails.issue_resolved_by=@EmpId) as Als_Product_Main
		group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
		) as Temp  group by product_name,issue_resolved_by,username
		) as tmp1
		join
		(	
			select  issue_resolved_by1,product_name,
			--minimum time
			--Min(Total_Seconds) 
			isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Maximum_Time,  

			--Average Time
			isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
			as Average_Time
			from
			(
			select 
			issue_resolved_by as issue_Resolved_by1,product_name,
			Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
			from 
			(
			select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
			from tbl_NewTaskDetails join vendor_product
			on vendor_product.product_code=tbl_NewTaskDetails.product_code
			) 
			as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
			) as Temp2 group by issue_resolved_by1,product_name
			) as Tmp2 
			on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId 
	end
	else
	begin
		select tmp1.*,tmp2.* from
		(
		select
		issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,sum(Total_issues) as Total_issues,
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Minimum_Time,
		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Default_Average_Time
		from
		(
		SELECT 
		product_name,issue_resolved_by,username,
		Periodic_Issues = ISNULL(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(docket_number) END,0),
		Total_issues=ISNULL(count(docket_number) ,0),
		Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
		FROM 
		(select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username from tbl_NewTaskDetails join vendor_product on tbl_NewTaskDetails.product_code=vendor_product.product_code join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by where tbl_NewTaskDetails.issue_resolved_by=@EmpId) as Als_Product_Main
		group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
		) as Temp  group by product_name,issue_resolved_by,username
		) as tmp1
		join
		(	
			select  issue_resolved_by1,product_name,
			--minimum time
			--Min(Total_Seconds) 
			isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Maximum_Time,  

			--Average Time
			isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
			as Average_Time
			from
			(
			select 
			issue_resolved_by as issue_Resolved_by1,product_name,
			Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
			from 
			(
			select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
			from tbl_NewTaskDetails join vendor_product
			on vendor_product.product_code=tbl_NewTaskDetails.product_code
			) 
			as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
			) as Temp2 group by issue_resolved_by1,product_name
			) as Tmp2 
			on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId
	end
end
else ---- ////////////// Status IS GIVEN ///////////// ----
begin
	if charindex('IT',@Teamid)>0 ----//////////////   IT   ///////////----
	begin
		if @FromDate='' and @ToDate=''
		begin
			if @status<>'TI'
			begin
select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,xx.brief_solution as brief_solution,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select brief_solution,jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select x.brief_solution,X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (
					select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.brief_solution,
					ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,
					NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,
					MUser_Master.username as Employee, NTD.Client_Remark as Remarks,
					NTD.Issue_Raised_DateTime as CallMadeTime 
					from tbl_NewTaskDetails as NTD 
				inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
				join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
				join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
				where issue_type='IT' and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) 
				and datepart(yyyy,ntd.issue_raised_datetime)=datepart(yyyy,getdate())
				and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%') as X) as M where M.DuplicateCount = 1) as XX
				inner join
				(
				select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
				ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
				FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
				inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
				on XX.Client_Code = YY.Client_Code 
			end
			else
			begin
				select docket_number As [Docket No],
					--TAG As [Sub Broker Tag],
					Client_Code As [Client Code],'',
					Product_Code As Product, Nature, Problem, Issue_Raised_Datetime As [Issue Raised Datetime],
					Issue_Resolved_Datetime As [Issue Resolved Datetime] ,username As [Issue Resolved By],Status
				from
				(
					select distinct(d.tt_number), d.docket_number,
--						v.TAG,
						Client_Code,Product_Code,d.tagbranch, Nature, Problem,
						Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
					from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
--					view_subbroker v,
					where d.issue_type='IT' and d.issue_resolved_by=@EmpId
					and d.client_code=cd.ctcl_odinid 
					---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
					and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
					and datepart(mm,d.issue_raised_datetime)=datepart(mm,getdate())
					and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
				) temp
				order by Issue_Raised_Datetime
--				select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],
--				XX.product_code as [Product Name],XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as [Issue Raised Datetime],
--				XX.Issue_Resolved_Datetime as [Issue Resolved Datetime],XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
--				from (
--					select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
--					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
--					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
--					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
--					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
--					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
--					where issue_type='IT' and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) and ntd.issue_Resolved_by=@EmpId) as X) as M where M.DuplicateCount = 1) as XX
--					inner join
--					(
--					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
--					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
--					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
--					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
--					on XX.Client_Code = YY.Client_Code 

			end	
		end
		else
		begin
			if @status<>'TI'
			begin
				select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,xx.brief_solution as brief_solution,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select brief_solution,jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select x.brief_solution,X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (
					select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.brief_solution,
					ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,
					NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,
					MUser_Master.username as Employee, NTD.Client_Remark as Remarks,
					NTD.Issue_Raised_DateTime as CallMadeTime 
					from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='IT' and ntd.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%') as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 

			end
			else
			begin
				select docket_number As [Docket No],
					--TAG As [Sub Broker Tag],
					Client_Code As [Client Code],'',
					Product_Code As Product, Nature, Problem, Issue_Raised_Datetime As [Issue Raised Datetime],
					Issue_Resolved_Datetime As [Issue Resolved Datetime] ,username As [Issue Resolved By],Status
				from
				(
					select distinct(d.tt_number), d.docket_number,
--						v.TAG,
						Client_Code,Product_Code,d.tagbranch, Nature, Problem,
						Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
					from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
--					view_subbroker v,
					where d.issue_type='IT' and d.issue_resolved_by=@EmpId
					and d.client_code=cd.ctcl_odinid 
					---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
					and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
					and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
				) temp
				order by Issue_Raised_Datetime


--				select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],
--				XX.product_code as [Product Name],XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as [Issue Raised Datetime],
--				XX.Issue_Resolved_Datetime as [Issue Resolved Datetime],XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
--				from (
--					select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
--					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
--					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
--					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
--					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
--					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
--					where issue_type='IT' and ntd.issue_resolved_by=@EmpId and ntd.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)) as X) as M where M.DuplicateCount = 1) as XX
--					inner join
--					(
--					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
--					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
--					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
--					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
--					on XX.Client_Code = YY.Client_Code 
			end
		end
	end
	else ---- //////////////////  EBroking ////////////// ----
	begin
		if @FromDate='' and @ToDate=''
		begin
			if @status<>'TI'
			begin
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as [Issue Raised Datetime], convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId and tbl_NewTaskDetails.status_code like '%'+@Status+'%' and
				datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
				and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
			end
			else
			begin
				select docket_number As [Docket No],Client_Code As [Client Code],'',Product_Code As Product,
					type as [Type], Nature, Problem, Issue_Raised_Datetime As [Issue Raised Datetime],
					Issue_Resolved_Datetime As [Issue Resolved Datetime] ,username As [Issue Resolved By],Status
					from
					(
						select Distinct(d.tt_number),d.docket_number,d.client_code,d.product_code,
						d.type,d.nature,d.problem,d.issue_raised_datetime,d.issue_resolved_datetime,u.username,j.jobstatus_name as Status
						from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
						where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
						and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
						and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
						and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate())
						and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
					) temp
				order by Issue_Raised_Datetime				


--				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as [Issue Raised Datetime], convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
--				from tbl_NewTaskDetails 
--				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
--				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
--				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
--				where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId and 
--				datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			end	
		end
		else
		begin
			if @status<>'TI'
			begin
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as [Issue Raised Datetime], convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId and tbl_NewTaskDetails.status_code like '%'+@Status+'%' and
				tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
			end
			else
			begin
				select docket_number As [Docket No],Client_Code As [Client Code],'',Product_Code As Product,
					type as [Type], Nature, Problem, Issue_Raised_Datetime As [Issue Raised Datetime],
					Issue_Resolved_Datetime As [Issue Resolved Datetime] ,username As [Issue Resolved By],Status
					from
					(
						select Distinct(d.tt_number),d.docket_number,d.client_code,d.product_code,
						d.type,d.nature,d.problem,d.issue_raised_datetime,d.issue_resolved_datetime,u.username,j.jobstatus_name as Status
						from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
						where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
						and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
						and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
						and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
					) temp
				order by Issue_Raised_Datetime			


--				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as [Issue Raised Datetime], convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
--				from tbl_NewTaskDetails 
--				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
--				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
--				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
--				where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId and
--				tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
			end
		end
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_EmpPerformance_NEW
-- --------------------------------------------------


CREATE Proc [dbo].[USP_MIS_EmpPerformance_NEW]

-- Created BY	: Sanjay Lavu Kudtarkar 
-- Modified BY	: Mahendra Bonde

@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@EmpId as varchar(20),
@Status as varchar(50),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)

As

Begin

	declare @Teamid varchar(10) 
	select @Teamid=team_id from MUser_Master where userid=@EmpId

	If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M' or @Role = 'ITM')
	Begin
		---- //////////////////// Status BLANK ///////////////// ----
		If @Status=''
		begin 
			If @FromDate='' and @ToDate=''
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Default_Average_Time
					from
					(
						SELECT 	product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate())  THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username 
							from tbl_NewTaskDetails 
								join vendor_product on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
						) as Als_Product_Main Group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
						Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails join vendor_product
							on vendor_product.product_code=tbl_NewTaskDetails.product_code
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 
				on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY tmp1.Total_Issues DESC
				
			end
			else
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')	as Default_Average_Time
					from
					(
						SELECT product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username 
							From tbl_NewTaskDetails 
								join vendor_product on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
						) as Als_Product_Main group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username 
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
							Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails 
								join vendor_product	on vendor_product.product_code=tbl_NewTaskDetails.product_code
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY Tmp1.Total_Issues DESC
			end
		end
		else ---- ////////////// Status IS GIVEN ///////////// ----
		begin
			if charindex('IT',@Teamid)>0 ----//////////////   IT   ///////////----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
						from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
						ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
						FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
						inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
						join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
						join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
						where issue_type='IT' and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) 
						and datepart(yyyy,ntd.issue_raised_datetime)=datepart(yyyy,getdate()) And Account_Status=1
						and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%') as X) as M where M.DuplicateCount = 1) as XX
						inner join
						(
						select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
						ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
						FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
						inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
						on XX.Client_Code = YY.Client_Code 
					end
					else
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status				
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							and d.client_code=cd.ctcl_odinid And u.Account_Status=1
							---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and datepart(mm,d.issue_raised_datetime)=datepart(mm,getdate())
							and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
						) XX
						order by Issue_Raised_Datetime
					end	
				end
				else
				begin
					if @status='C'
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId And u.Account_Status=1
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code='ITC'
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) XX
						order by Issue_Raised_Datetime

					end
					Else If @status='E'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId And u.Account_Status=1
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3')
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='P'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId And u.Account_Status=1
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITP','ITUP')
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='R'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId And u.Account_Status=1
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='X'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId And u.Account_Status=1
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code='X'
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) XX
						order by Issue_Raised_Datetime
					End
					else If @Status='TI'
					begin
					
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId And u.Account_Status=1
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) XX
						order by Issue_Raised_Datetime
					end
				end
			end
			else ---- //////////////////  EBroking ////////////// ----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,jobstatusmaster.jobstatus_name as Status
						from tbl_NewTaskDetails 
						join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
						join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
						join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
						where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId and tbl_NewTaskDetails.status_code like '%'+@Status+'%' and
						datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
						and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					end
					else
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,
								Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id And u.Account_Status=1
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate())
								and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
							) temp
						order by Issue_Raised_Datetime				
					end	
				end
				else
				begin
					if @status='C'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code='C' And u.Account_Status=1
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='P'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('P','UP') And u.Account_Status=1
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='E'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('L1E','E3','EF','ET') And u.Account_Status=1
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime	
					End	
					Else if @status='R'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('R') And u.Account_Status=1
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='X'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('X') And u.Account_Status=1
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					else if @status='TI'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
							from
							(
								select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
								from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
								where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id And u.Account_Status=1
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime			
					end
				end
			end
		End

	End
--###############################################################################################################--
							--================== Regional Head =================--			
--###############################################################################################################--
	Else If(@ROLE='RH')
	Begin
		---- //////////////////// Status BLANK ///////////////// ----
		If @Status=''
		begin 
			If @FromDate='' and @ToDate=''
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Default_Average_Time
					from
					(
						SELECT 	product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate())  THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username 
							from tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) as Als_Product_Main Group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
						Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails with (NOLOCK) join vendor_product with (NOLOCK)
							on vendor_product.product_code=tbl_NewTaskDetails.product_code
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 
				on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY tmp1.Total_Issues DESC
				
			end
			else
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')	as Default_Average_Time
					from
					(
						SELECT product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username 
							From tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) as Als_Product_Main group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username 
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
							Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on vendor_product.product_code=tbl_NewTaskDetails.product_code
								join MUser_Master UM with (NOLOCK) On tbl_NewTaskDetails.Issue_resolved_BY=UM.UserID
							Where tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY Tmp1.Total_Issues DESC
			end
		end
		else ---- ////////////// Status IS GIVEN ///////////// ----
		begin
			if charindex('IT',@Teamid)>0 ----//////////////   IT   ///////////----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
						from 
						(
							select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,
								product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount 
							from 
							(
								select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,
									X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
										ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
								FROM 
								(
									select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,
										ntd.docket_number as docket_number,ntd.product_code as product_code,
										NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE,
										NTD.Contact_Person as Client_Name,MUser_Master.username as Employee,
										NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime 
									from tbl_NewTaskDetails as NTD with (NOLOCK)
										inner join tbl_it_odinmaster as OM  with (NOLOCK) on NTD.Client_Code = OM.Odin_Id 
										join MUser_Master with (NOLOCK) on NTD.issue_Resolved_by=MUser_Master.userid
										join jobstatusmaster with (NOLOCK) on NTD.status_code=jobstatusmaster.jobstatus_id
									where issue_type='IT' 
										And NTD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
										and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) 
										and datepart(yyyy,ntd.issue_raised_datetime)=datepart(yyyy,getdate())
										and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%'
										And Account_Status=1
								) as X
							) as M where M.DuplicateCount = 1
						) as XX
						inner join
						(
							select Client_Code,SUB_Broker_code,Location,Servers 
							From 
							(
								SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
									ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
								FROM 
								(
									Select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, 
										PM.Location as Location, PM.RM_Manager_Code as Servers 
									from tbl_it_odinmaster as OM 
										inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code
								) as Y
							)as Z where Z.DuplicateCount = 1
						) as YY on XX.Client_Code = YY.Client_Code 
					end
					else
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status				
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							and d.client_code=cd.ctcl_odinid 
							---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,d.issue_raised_datetime)=datepart(mm,getdate())
							and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end	
				end
				else
				begin
					if @status='C'
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code='ITC'
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime

					end
					Else If @status='E'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j  with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3')
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='P'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITP','ITUP')
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='R'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='X'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code='X'
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					else If @Status='TI'
					begin
					
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end
				end
			end
			else ---- //////////////////  EBroking ////////////// ----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,
							Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,
							tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
							tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							jobstatusmaster.jobstatus_name as Status
						from tbl_NewTaskDetails  with (NOLOCK)
							join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster with (NOLOCK) on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master with (NOLOCK) on client_master.client_code=tbl_NewTaskDetails.client_code
						where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId 
							and tbl_NewTaskDetails.status_code like '%'+@Status+'%' 
							And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH') And Account_Status=1)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
							
					end
					else
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,
								Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate())
								and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
								And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime				
					end	
				end
				else
				begin
					if @status='C'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code='C' And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='P'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('P','UP') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='E'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('L1E','E3','EF','ET') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime	
					End	
					Else if @status='R'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('R') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='X'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('X') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					else if @status='TI'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							    And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime			
					end
				end
			end
		End
	End
--###############################################################################################################--
							--================== Cluster Head =================--			
--###############################################################################################################--
	Else If(@ROLE='CH')
	Begin
		---- //////////////////// Status BLANK ///////////////// ----
		If @Status=''
		begin 
			If @FromDate='' and @ToDate=''
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Default_Average_Time
					from
					(
						SELECT 	product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate())  THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username 
							from tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) as Als_Product_Main Group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
						Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails with (NOLOCK) join vendor_product with (NOLOCK)
							on vendor_product.product_code=tbl_NewTaskDetails.product_code
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 
				on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY tmp1.Total_Issues DESC
				
			end
			else
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')	as Default_Average_Time
					from
					(
						SELECT product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username 
							From tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) as Als_Product_Main group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username 
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
							Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on vendor_product.product_code=tbl_NewTaskDetails.product_code
								join MUser_Master UM with (NOLOCK) On tbl_NewTaskDetails.Issue_resolved_BY=UM.UserID
							Where tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY Tmp1.Total_Issues DESC
			end
		end
		else ---- ////////////// Status IS GIVEN ///////////// ----
		begin
			if charindex('IT',@Teamid)>0 ----//////////////   IT   ///////////----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
						from 
						(
							select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,
								product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount 
							from 
							(
								select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,
									X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
										ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
								FROM 
								(
									select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,
										ntd.docket_number as docket_number,ntd.product_code as product_code,
										NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE,
										NTD.Contact_Person as Client_Name,MUser_Master.username as Employee,
										NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime 
									from tbl_NewTaskDetails as NTD with (NOLOCK)
										inner join tbl_it_odinmaster as OM  with (NOLOCK) on NTD.Client_Code = OM.Odin_Id 
										join MUser_Master with (NOLOCK) on NTD.issue_Resolved_by=MUser_Master.userid
										join jobstatusmaster with (NOLOCK) on NTD.status_code=jobstatusmaster.jobstatus_id
									where issue_type='IT' 
										And NTD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
										and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) 
										and datepart(yyyy,ntd.issue_raised_datetime)=datepart(yyyy,getdate())
										and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%'
										And Account_Status=1
								) as X
							) as M where M.DuplicateCount = 1
						) as XX
						inner join
						(
							select Client_Code,SUB_Broker_code,Location,Servers 
							From 
							(
								SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
									ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
								FROM 
								(
									Select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, 
										PM.Location as Location, PM.RM_Manager_Code as Servers 
									from tbl_it_odinmaster as OM 
										inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code
								) as Y
							)as Z where Z.DuplicateCount = 1
						) as YY on XX.Client_Code = YY.Client_Code 
					end
					else
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status				
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							and d.client_code=cd.ctcl_odinid 
							---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,d.issue_raised_datetime)=datepart(mm,getdate())
							and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end	
				end
				else
				begin
					if @status='C'
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code='ITC'
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime

					end
					Else If @status='E'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j  with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3')
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='P'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITP','ITUP')
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='R'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='X'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code='X'
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					else If @Status='TI'
					begin
					
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end
				end
			end
			else ---- //////////////////  EBroking ////////////// ----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,
							Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,
							tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
							tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							jobstatusmaster.jobstatus_name as Status
						from tbl_NewTaskDetails  with (NOLOCK)
							join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster with (NOLOCK) on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master with (NOLOCK) on client_master.client_code=tbl_NewTaskDetails.client_code
						where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId 
							and tbl_NewTaskDetails.status_code like '%'+@Status+'%' 
							And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH') And Account_Status=1)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
							
					end
					else
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,
								Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate())
								and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
								And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime				
					end	
				end
				else
				begin
					if @status='C'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code='C' And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='P'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('P','UP') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='E'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('L1E','E3','EF','ET') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime	
					End	
					Else if @status='R'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('R') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='X'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('X') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					else if @status='TI'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							    And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime			
					end
				end
			end
		End
	End
--###############################################################################################################--
							--================== Zonal Head =================--			
--###############################################################################################################--
	Else If(@ROLE='ZH')
	Begin
		---- //////////////////// Status BLANK ///////////////// ----
		If @Status=''
		begin 
			If @FromDate='' and @ToDate=''
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Default_Average_Time
					from
					(
						SELECT 	product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate())  THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username 
							from tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) as Als_Product_Main Group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
						Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails with (NOLOCK) join vendor_product with (NOLOCK)
							on vendor_product.product_code=tbl_NewTaskDetails.product_code
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 
				on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY tmp1.Total_Issues DESC
				
			end
			else
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')	as Default_Average_Time
					from
					(
						SELECT product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username 
							From tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) as Als_Product_Main group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username 
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
							Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails with (NOLOCK)
								join vendor_product with (NOLOCK) on vendor_product.product_code=tbl_NewTaskDetails.product_code
								join MUser_Master UM with (NOLOCK) On tbl_NewTaskDetails.Issue_resolved_BY=UM.UserID
							Where tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY Tmp1.Total_Issues DESC
			end
		end
		else ---- ////////////// Status IS GIVEN ///////////// ----
		begin
			if charindex('IT',@Teamid)>0 ----//////////////   IT   ///////////----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
						from 
						(
							select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,
								product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount 
							from 
							(
								select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,
									X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
										ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
								FROM 
								(
									select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,
										ntd.docket_number as docket_number,ntd.product_code as product_code,
										NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE,
										NTD.Contact_Person as Client_Name,MUser_Master.username as Employee,
										NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime 
									from tbl_NewTaskDetails as NTD with (NOLOCK)
										inner join tbl_it_odinmaster as OM  with (NOLOCK) on NTD.Client_Code = OM.Odin_Id 
										join MUser_Master with (NOLOCK) on NTD.issue_Resolved_by=MUser_Master.userid
										join jobstatusmaster with (NOLOCK) on NTD.status_code=jobstatusmaster.jobstatus_id
									where issue_type='IT' 
										And NTD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
										and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) 
										and datepart(yyyy,ntd.issue_raised_datetime)=datepart(yyyy,getdate())
										and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%'
										And Account_Status=1
								) as X
							) as M where M.DuplicateCount = 1
						) as XX
						inner join
						(
							select Client_Code,SUB_Broker_code,Location,Servers 
							From 
							(
								SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
									ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
								FROM 
								(
									Select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, 
										PM.Location as Location, PM.RM_Manager_Code as Servers 
									from tbl_it_odinmaster as OM 
										inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code
								) as Y
							)as Z where Z.DuplicateCount = 1
						) as YY on XX.Client_Code = YY.Client_Code 
					end
					else
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status				
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							and d.client_code=cd.ctcl_odinid 
							---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,d.issue_raised_datetime)=datepart(mm,getdate())
							and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end	
				end
				else
				begin
					if @status='C'
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code='ITC'
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime

					end
					Else If @status='E'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j  with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3')
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='P'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITP','ITUP')
							And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='R'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='X'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code='X'
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					else If @Status='TI'
					begin
					
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d with (NOLOCK), MUser_Master u with (NOLOCK), ctcl_details cd with (NOLOCK), jobstatusmaster j with (NOLOCK)
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end
				end
			end
			else ---- //////////////////  EBroking ////////////// ----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,
							Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,
							tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
							tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							jobstatusmaster.jobstatus_name as Status
						from tbl_NewTaskDetails  with (NOLOCK)
							join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster with (NOLOCK) on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master with (NOLOCK) on client_master.client_code=tbl_NewTaskDetails.client_code
						where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId 
							and tbl_NewTaskDetails.status_code like '%'+@Status+'%' 
							And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH') And Account_Status=1)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
							
					end
					else
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,
								Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate())
								and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
								And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime				
					end	
				end
				else
				begin
					if @status='C'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code='C' And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='P'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('P','UP') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='E'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('L1E','E3','EF','ET') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime	
					End	
					Else if @status='R'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('R') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='X'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('X') And u.Account_Status=1
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					else if @status='TI'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d with (NOLOCK), client_master cm with (NOLOCK), vendor_product vd with (NOLOCK), MUser_Master u with (NOLOCK), jobstatusmaster j with (NOLOCK)
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							    And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime			
					end
				end
			end
		End
	End
--###############################################################################################################--
							--================== Branch Head =================--			
--###############################################################################################################--
	Else If(@ROLE='BH')
	Begin
		---- //////////////////// Status BLANK ///////////////// ----
		If @Status=''
		begin 
			If @FromDate='' and @ToDate=''
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Default_Average_Time
					from
					(
						SELECT 	product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate())  THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username 
							from tbl_NewTaskDetails 
								join vendor_product on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) as Als_Product_Main Group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
						Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails join vendor_product
							on vendor_product.product_code=tbl_NewTaskDetails.product_code
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 
				on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY tmp1.Total_Issues DESC
				
			end
			else
			begin
				select tmp1.*,tmp2.* from
				(
					select issue_resolved_by,username,product_name,sum (Periodic_Issues) as Periodic_Issues ,
							sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00') as Default_Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Total_Seconds)/3600,120) + ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00') as Default_Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')	as Default_Average_Time
					from
					(
						SELECT product_name,issue_resolved_by,username,
							Periodic_Issues = ISNULL(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(docket_number) END,0),
							Total_issues=ISNULL(count(docket_number) ,0),
							Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number,tbl_NewTaskDetails.client_code,vendor_product.product_name,
								vendor_product.product_code,tbl_NewTaskDetails.issue_raised_dateTime,
								tbl_NewTaskDetails.issue_resolving_time,tbl_NewTaskDetails.issue_resolved_by,MUser_Master.username 
							From tbl_NewTaskDetails 
								join vendor_product on tbl_NewTaskDetails.product_code=vendor_product.product_code 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							where tbl_NewTaskDetails.issue_resolved_by=@EmpId And Account_Status=1
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) as Als_Product_Main group by product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by,username
					) as Temp  group by product_name,issue_resolved_by,username 
				) as tmp1 
				join
				(	
					select  issue_resolved_by1,product_name,
						--minimum time
						--Min(Total_Seconds) 
						isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2) + ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)	+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2) + ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00') as Average_Time
					from
					(
						select issue_resolved_by as issue_Resolved_by1,product_name,
							Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
						from 
						(
							select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,
								tbl_NewTaskDetails.issue_resolved_by ,vendor_product.product_name
							from tbl_NewTaskDetails 
								join vendor_product	on vendor_product.product_code=tbl_NewTaskDetails.product_code
								join MUser_Master UM On tbl_NewTaskDetails.Issue_resolved_BY=UM.UserID
							Where tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And Account_Status=1
						) as temp group by Total_Seconds_Productwise,issue_resolved_by,product_name
					) as Temp2 group by issue_resolved_by1,product_name
				) as Tmp2 on Tmp1.product_name=Tmp2.product_name where tmp2.issue_resolved_by1=@EmpId Order BY Tmp1.Total_Issues DESC
			end
		end
		else ---- ////////////// Status IS GIVEN ///////////// ----
		begin
			if charindex('IT',@Teamid)>0 ----//////////////   IT   ///////////----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select xx.docket_number,yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
						from 
						(
							select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,
								product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount 
							from 
							(
								select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,
									X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
										ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
								FROM 
								(
									select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,
										ntd.docket_number as docket_number,ntd.product_code as product_code,
										NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE,
										NTD.Contact_Person as Client_Name,MUser_Master.username as Employee,
										NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime 
									from tbl_NewTaskDetails as NTD 
										inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
										join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
										join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
									where issue_type='IT' 
										and NTD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
										and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) 
										and datepart(yyyy,ntd.issue_raised_datetime)=datepart(yyyy,getdate())
										and ntd.issue_Resolved_by=@EmpId and ntd.status_code like '%'+@Status+'%'
										And Account_Status=1
								) as X
							) as M where M.DuplicateCount = 1
						) as XX
						inner join
						(
							select Client_Code,SUB_Broker_code,Location,Servers 
							From 
							(
								SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
									ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
								FROM 
								(
									Select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, 
										PM.Location as Location, PM.RM_Manager_Code as Servers 
									from tbl_it_odinmaster as OM 
										inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code
								) as Y
							)as Z where Z.DuplicateCount = 1
						) as YY on XX.Client_Code = YY.Client_Code 
					end
					else
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status				
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							and d.client_code=cd.ctcl_odinid 
							---and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and datepart(mm,d.issue_raised_datetime)=datepart(mm,getdate())
							and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end	
				end
				else
				begin
					if @status='C'
					begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code='ITC'
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime

					end
					Else If @status='E'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL1E','ITEL2N','ITEL2O','ITEL2V','ITEL3')
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='P'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
							--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
							and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
							and d.status_code in ('ITP','ITUP')
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='R'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code in ('ITL2RO','ITL2RN','ITL2RV','ITL3R')
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					Else If @status='X'
					Begin
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
								XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
								XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
								XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and d.status_code='X'
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					End
					else If @Status='TI'
					begin
					
						select xx.docket_number,XX.client_code as [Client Code(OdinID)],
							XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,
							XX.Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,
							XX.username as [Issue Resolved By],XX.Status as Status		
						from
						(
							select distinct(d.tt_number), d.docket_number,
		--						v.TAG,
								Client_Code,Product_Code,d.tagbranch, Nature, Problem,
								Issue_Raised_Datetime,Issue_Resolved_Datetime,u.username,j.jobstatus_name as Status
							from tbl_newtaskdetails d, MUser_Master u, ctcl_details cd, jobstatusmaster j
		--					view_subbroker v,
							where d.issue_type='IT' and d.issue_resolved_by=@EmpId
								--and d.client_code=cd.ctcl_odinid and cd.ctcl_isbtag=v.TAG and d.tagbranch=v.tagbranch
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_id
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1
						) XX
						order by Issue_Raised_Datetime
					end
				end
			end
			else ---- //////////////////  EBroking ////////////// ----
			begin
				if @FromDate='' and @ToDate=''
				begin
					if @status<>'TI'
					begin
						select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,
							Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,
							tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
							tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							jobstatusmaster.jobstatus_name as Status
						from tbl_NewTaskDetails 
							join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
						where issue_type='EBro' and tbl_NewTaskDetails.issue_resolved_by=@EmpId 
							and tbl_NewTaskDetails.status_code like '%'+@Status+'%' 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH') And Account_Status=1)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
							
					end
					else
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,
								Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate())
								and datepart(yyyy,d.issue_raised_datetime)=datepart(yyyy,getdate())
								And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime				
					end	
				end
				else
				begin
					if @status='C'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code='C' And u.Account_Status=1
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='P'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('P','UP') And u.Account_Status=1
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='E'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('L1E','E3','EF','ET') And u.Account_Status=1
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime	
					End	
					Else if @status='R'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('R') And u.Account_Status=1
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					Else if @status='X'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and d.status_Code in ('X') And u.Account_Status=1
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							) temp
						order by Issue_Raised_Datetime		
					end
					else if @status='TI'
					begin
						select docket_number as Docket_Number,client_code as Client_code,
								short_name as Client_name,product_Code as product_name,
								type as _Type,nature as Nature,problem as Problem,
								client_remark as Remark,issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),issue_resolving_time,8)  as Resolution_time,Status as Status
						from
						(
							select Distinct(d.tt_number),d.docket_number,d.client_code,cm.short_name,d.product_code,
								d.type,d.nature,d.problem,d.client_remark,d.issue_raised_datetime,d.issue_resolving_time,u.username,j.jobstatus_name as Status
							from tbl_NewTaskDetails d, client_master cm, vendor_product vd, MUser_Master u, jobstatusmaster j
							where d.issue_type='EBro' and d.issue_resolved_by=@EmpId
								and d.client_code=cm.client_code and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by=u.userid and d.status_code=j.jobstatus_Id
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							    And u.Account_Status=1
							) temp
						order by Issue_Raised_Datetime			
					end
				end
			end
		End
	End

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_GenerateIssueAreaReport
-- --------------------------------------------------
CREATE proc [dbo].[usp_MIS_GenerateIssueAreaReport]
----- Helpdesk System Graphical Report
@From as datetime,
@To as datetime,
@CSO as varchar(50)
as
select tbl_CSOMaster.CentralSupport as [Central Support],tbl_it_kb_master.issue_area as [Issue Area], count(tbl_newclient_details.docket_number)as [Total Calls] from tbl_newclient_details
join tbl_it_kb_master on tbl_newclient_details.brief_solution=tbl_it_kb_master.brief_solution
join tbl_csomaster on tbl_CSOMaster.branch_tag=tbl_newclient_details.tagbranch
where tbl_newclient_details.issue_type='IT' and tbl_newclient_details.issue_resolved_datetime between @from and @to and tbl_CSOMaster.CentralSupport=@CSO
group by tbl_CSOMaster.CentralSupport ,tbl_it_kb_master.issue_area
order by Issue_Area

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_GenerateIssueTypeReport
-- --------------------------------------------------
CREATE proc [dbo].[usp_MIS_GenerateIssueTypeReport]
----- Helpdesk System Graphical Report
@From  as datetime,
@To as datetime,
@Issuearea as varchar(50)
as
select tbl_CSOMaster.CentralSupport as [Central Support],tbl_it_kb_master.issue_type as [Issue Type], count(tbl_newclient_details.docket_number)as [Total Calls] from tbl_newclient_details
join tbl_it_kb_master on tbl_newclient_details.brief_solution=tbl_it_kb_master.brief_solution
join tbl_csomaster on tbl_CSOMaster.branch_tag=tbl_newclient_details.tagbranch
where tbl_newclient_details.issue_type='IT' and tbl_newclient_details.issue_resolved_datetime between @from and @to and tbl_it_kb_master.Issue_Area=@Issuearea
group by tbl_CSOMaster.CentralSupport ,tbl_it_kb_master.issue_type
order by tbl_it_kb_master.issue_type

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_Locationwisereport
-- --------------------------------------------------

create Proc [dbo].[USP_MIS_Locationwisereport]  
@From datetime,
@To datetime
as
select tbl_CSOMaster.CentralSupport as [Central Support],count(tbl_newclient_details.issue_resolved_datetime)as [Total Calls] from tbl_CSOMaster
join tbl_newclient_details
on tbl_CSOMaster.branch_tag=tbl_newclient_details.tagbranch
where tbl_newclient_details.issue_raised_datetime between @from and @to
group by tbl_CSOMaster.centralsupport
order by count(tbl_newclient_details.issue_resolved_datetime)desc

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_Performance_Main
-- --------------------------------------------------
CREATE Proc [dbo].[USP_MIS_Performance_Main]
--Author:	Sanjay Lavu Kudtarkar
@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@TeamID as nvarchar(10),
@Status as varchar(50),
@Location as varchar(15)
as
if @TeamID='' and @Status=''
begin
	if @FromDate='' and @ToDate='' 
	begin
		if(@Location='')
		BEGIN
			select
			team_id AS TeamID,team_name AS Team,sum (all_issues) as Total ,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed from
			(
			SELECT 
			team_id,
			team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code from tbl_NewTaskDetails join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
			join (select distinct(team_id),team_name from team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
			where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			) as Als_Performance_Main
			group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id not like '%it%'
		END
		IF(@Location<>'')
		BEGIN
			select
			team_id AS TeamID,team_name AS Team,sum (all_issues) as Total ,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed from
			(
			SELECT 
			team_id,
			team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
					MUser_Master.Team_id as Team_ID,
					team_master.team_name as Team_Name,
					tbl_NewTaskDetails.status_code as Status_code 
					from tbl_NewTaskDetails 
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
					join (select distinct(team_id),team_name from team_master) as Team_master 
					on Team_master.team_id=MUser_Master.Team_id 
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
					and tbl_teamleadermaster.branch_name=@Location 
					and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			) as Als_Performance_Main
			group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id not like '%it%'			
		END
	end
	else
	begin
		if(@Location='')
		Begin
			select
			team_id AS TeamID,team_name AS Team,sum (all_issues) as Total ,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed from
			(
			SELECT team_id,team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
					MUser_Master.Team_id as Team_ID,
					team_master.team_name as Team_Name,
					tbl_NewTaskDetails.status_code as Status_code 
					from tbl_NewTaskDetails 
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
					join (select distinct(team_id),team_name from team_master) as Team_master 
					on Team_master.team_id=MUser_Master.Team_id 
					where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
					and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)) as Als_Performance_Main
					group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id not like '%it%'
		End
		if(@Location<>'')
		Begin
			select
			team_id AS TeamID,team_name AS Team,sum (all_issues) as Total ,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed from
			(
			SELECT team_id,team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
					MUser_Master.Team_id as Team_ID,
					team_master.team_name as Team_Name,
					tbl_NewTaskDetails.status_code as Status_code 
					from tbl_NewTaskDetails 
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
					join (select distinct(team_id),team_name from team_master) as Team_master 
					on Team_master.team_id=MUser_Master.Team_id 
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
					and tbl_teamleadermaster.branch_name=@Location
					and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)) as Als_Performance_Main
					group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id not like '%it%'
		End
	end
end
else
begin
if charindex('IT',@Teamid)>0
	begin
		if @Status='All'
			begin
			if @FromDate='' and @ToDate='' 
				begin	
				IF(@Location='')
				BEGIN	
					select xx.docket_number AS [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (
					select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,
					ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,
					NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,
					MUser_Master.username as Employee, NTD.Client_Remark as Remarks,
					NTD.Issue_Raised_DateTime as CallMadeTime 
					from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and datepart(mm,NTD.issue_raised_datetime)= datepart(mm,getdate()) and MUser_Master.team_id=@TeamID) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 
				END
				IF(@Location<>'')
				BEGIN	
					select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (
					select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,
					ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,
					NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,
					MUser_Master.username as Employee, NTD.Client_Remark as Remarks,
					NTD.Issue_Raised_DateTime as CallMadeTime 
					from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and tbl_teamleadermaster.branch_name=@Location and
					datepart(mm,NTD.issue_raised_datetime)= datepart(mm,getdate()) and MUser_Master.team_id=@TeamID) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 
				END
				end
			else
				begin
				IF(@Location='')
				BEGIN
					select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and ntd.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 
				END
				IF(@Location<>'')
				BEGIN
					select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and tbl_teamleadermaster.branch_name=@Location and 
					ntd.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 
				END
				end
			end
		else
			begin
			if @FromDate='' and @ToDate='' 
				begin
				IF(@Location='')
				BEGIN
					select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and MUser_Master.team_id=@TeamID and datepart(mm,ntd.issue_raised_datetime)= datepart(mm,getdate()) and upper(ntd.status_code) like upper(@Status) and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate())) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 
				END 
				IF(@Location<>'')
				BEGIN
					select xx.docket_number[Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and tbl_teamleadermaster.branch_name=@Location and 
					MUser_Master.team_id=@TeamID and datepart(mm,ntd.issue_raised_datetime)= datepart(mm,getdate()) and upper(ntd.status_code) like upper(@Status) and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate())) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code 
				END 
				end
			else
				begin
				IF(@Location='')
				BEGIN
					select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and upper(ntd.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and ntd.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) ) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code  
				END
				IF(@Location<>'')
				BEGIN
					select xx.docket_number as [Docket No],yy.sub_broker_code as [Sub Broker Tag],XX.client_code as [Client Code],XX.product_code as Product_Name,XX.nature as Nature,XX.problem as Problem,XX.CallMadeTime as Issue_Raised_Datetime ,XX.Issue_Resolved_Datetime as Issue_Resolved_Datetime,XX.Employee as [Issue Resolved By],XX.jobstatus_name as Status
					from (select jobstatus_name,Issue_Resolved_Datetime,problem,docket_number,Client_Code,product_code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.jobstatus_name,x.Issue_Resolved_Datetime,x.problem,x.nature,X.docket_number,X.Client_Code,X.product_code,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
					ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
					FROM (select jobstatusmaster.jobstatus_name,ntd.Issue_Resolved_Datetime,ntd.problem,ntd.docket_number as docket_number,ntd.product_code as product_code,NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
					inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
					join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					join jobstatusmaster on NTD.status_code=jobstatusmaster.jobstatus_id
					where issue_type='EBro' and tbl_teamleadermaster.branch_name=@Location and 
					upper(ntd.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and ntd.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) ) as X) as M where M.DuplicateCount = 1) as XX
					inner join
					(
					select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
					ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
					FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
					inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
					on XX.Client_Code = YY.Client_Code  
				END
				end		
			end 
		end
else
	begin
		if @Status='All'
			begin
			if @FromDate='' and @ToDate='' 
				begin		
				IF(@Location='')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
				END
				IF(@Location<>'')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
					and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
					datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
				END
				end
			else
				begin
				IF(@Location='')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
				END
				IF(@Location<>'')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
					MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
					tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
				END
				end
			end
		else
			begin
			if @FromDate='' and @ToDate='' 
				begin
				IF(@Location='')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
				END
				IF(@Location<>'')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
					MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
					upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
				END
				end
			else
				begin
				IF(@Location='')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
				END
				IF(@Location<>'')
				BEGIN
					select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
					from tbl_NewTaskDetails 
					join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
					join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
					join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
					where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
					MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
					upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
				END

				end		
			end 
	end	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_Performance_Main_NEW
-- --------------------------------------------------


CREATE Proc [dbo].[USP_MIS_Performance_Main_NEW]

--Created BY	:	Sanjay Lavu Kudtarkar.
--ModIfied By	:	Mahendra D. Bonde.

@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@TeamID as nvarchar(10),
@Status as varchar(50),
@Location as varchar(15),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)

As

Begin
	
	If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
	Begin 
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
					Select 
					team_id,
					team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					From 
					(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and team_master.Team_ID in ('L1','L2T','L2F','L3')
					) as Als_Performance_Main
					group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id not like '%it%'
					Order By Total_Issues DESC
				END
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
					Select 
					team_id,
					team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					From 
					(Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
							MUser_Master.Team_id as Team_ID,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							join (Select distinct(team_id),team_name From team_master) as Team_master 
							on Team_master.team_id=MUser_Master.Team_id 
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
							and tbl_teamleadermaster.branch_name=@Location 
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
							and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) as Als_Performance_Main
					group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,Total_Issues ,Escalated_Issues, Completed_issues,Pending_Issues,
						Reassigned_Issues,Closed_Issues 
					From
					(
						Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
						(
							Select team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							From 
							(	
								Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
									MUser_Master.Team_id as Team_ID,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
									join (Select distinct(team_id),team_name From team_master) as Team_master 
									on Team_master.team_id=MUser_Master.Team_id 
								Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' And MUser_Master.Account_Status=1
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
							) as Als_Performance_Main
							group by status_code,team_id,team_name
						) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') 
					
						UNION

						Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
								'0' as Pending_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
						From Team_Master 
						Where Team_ID NOT IN
						(
							Select Distinct MUser_Master.Team_id as Team_ID
							From tbl_NewTaskDetails 
								Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
								And MUser_Master.Account_Status=1
						)
						and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) T Order By Total_Issues DESC
				End
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
					Select team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					From 
					(
						Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
							MUser_Master.Team_id as Team_ID,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
						From tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							join (Select distinct(team_id),team_name From team_master) as Team_master 
							on Team_master.team_id=MUser_Master.Team_id 
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
							and tbl_teamleadermaster.branch_name=@Location And MUser_Master.Account_Status=1
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) as Als_Performance_Main
							
							group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') Order By Total_Issues DESC
				End
			End
		End
		Else
		Begin
			If (@Teamid in ('L1','L2F','L2T','L3','A'))
			Begin
				If @Status='All'
				Begin
					If @FromDate='' and @ToDate='' 
					Begin		
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
							and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
							datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
								Convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
							MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
							tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
						END
					End
				End
				Else --////////////// Status IS Specified /////////////////////////--
				Begin
					If @FromDate='' and @ToDate='' 
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
							MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
							upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Status='C')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code='C'
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1		
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code='C' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='P')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('P','UP') 
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('P','UP')  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='E')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('EF','ET','E3')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('EF','ET','E3') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='R')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('R')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('R') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='X')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									And MUser_Master.Account_Status=1
							END
						End

						--///////////////////////////////
					End		
				End 
			End	
		End
	End
--###############################################################################################################--
							--================== Regional Head =================--			
--###############################################################################################################--
	Else If(@ROLE='RH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,
						sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,
						sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,
						sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id,	Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
								And MUser_Master.Account_Status=1 And Team_master.team_id in ('L1','L2T','L2F','L3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select Team_id,	team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master 
								on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1 And Team_master.team_id in ('L1','L2T','L2F','L3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,Total_Issues ,Escalated_Issues, Completed_issues,Pending_Issues,
						Reassigned_Issues,Closed_Issues 
					From
					(
						Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
						(
							Select team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							From 
							(	
								Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
									MUser_Master.Team_id as Team_ID,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
									join (Select distinct(team_id),team_name From team_master) as Team_master 
									on Team_master.team_id=MUser_Master.Team_id 
								Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And MUser_Master.Account_Status=1 And Team_master.team_id in ('L1','L2T','L2F','L3')
							) as Als_Performance_Main
							group by status_code,team_id,team_name
						) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') 
					
						UNION

						Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
								'0' as Pending_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
						From Team_Master 
						Where Team_ID NOT IN
						(
							Select Distinct MUser_Master.Team_id as Team_ID
							From tbl_NewTaskDetails 
								Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH')) 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
								and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
						)
						and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) T Order By Total_Issues DESC
				End
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1 And Team_master.team_id in ('L1','L2T','L2F','L3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') Order By Total_Issues DESC
				End
			End
		End
		Else
		Begin
		If (@Teamid in ('L1','L2F','L2T','L3','A'))
			Begin
				If @Status='All'
				Begin
					If @FromDate='' and @ToDate='' 
					Begin		
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
								Convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
				End
				Else --////////////// Status IS Specified /////////////////////////--
				Begin
					If @FromDate='' and @ToDate='' 
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Status='C')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code='C'
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code='C' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='P')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('P','UP') 
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('P','UP')  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='E')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('EF','ET','E3')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('EF','ET','E3') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='R')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('R')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('R') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='X')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						--///////////////////////////////
					End		
				End 
			End	
		End
	End
--###############################################################################################################--
							--================== Cluster Head =================--			
--###############################################################################################################--
	Else If(@ROLE='CH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,
						sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,
						sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,
						sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id,	Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
								And MUser_Master.Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select Team_id,	team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master 
								on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,Total_Issues ,Escalated_Issues, Completed_issues,Pending_Issues,
						Reassigned_Issues,Closed_Issues 
					From
					(
						Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
						(
							Select team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							From 
							(	
								Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
									MUser_Master.Team_id as Team_ID,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
									join (Select distinct(team_id),team_name From team_master) as Team_master 
									on Team_master.team_id=MUser_Master.Team_id 
								Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And MUser_Master.Account_Status=1
							) as Als_Performance_Main
							group by status_code,team_id,team_name
						) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') 
					
						UNION

						Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
								'0' as Pending_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
						From Team_Master 
						Where Team_ID NOT IN
						(
							Select Distinct MUser_Master.Team_id as Team_ID
							From tbl_NewTaskDetails 
								Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH')) 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
								and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
						)
						and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) T Order By Total_Issues DESC
				End
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') Order By Total_Issues DESC
				End
			End
		End
		Else
		Begin
		If (@Teamid in ('L1','L2F','L2T','L3','A'))
			Begin
				If @Status='All'
				Begin
					If @FromDate='' and @ToDate='' 
					Begin		
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
								Convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
				End
				Else --////////////// Status IS Specified /////////////////////////--
				Begin
					If @FromDate='' and @ToDate='' 
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Status='C')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code='C'
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code='C' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='P')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('P','UP') 
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('P','UP')  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='E')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('EF','ET','E3')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('EF','ET','E3') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='R')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('R')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('R') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='X')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						--///////////////////////////////
					End		
				End 
			End	
		End
	End
--###############################################################################################################--
							--================== Zonal Head =================--			
--###############################################################################################################--
	Else If(@ROLE='ZH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,
						sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,
						sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,
						sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id,	Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
								And MUser_Master.Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select Team_id,	team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master 
								on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,Total_Issues ,Escalated_Issues, Completed_issues,Pending_Issues,
						Reassigned_Issues,Closed_Issues 
					From
					(
						Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
						(
							Select team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							From 
							(	
								Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
									MUser_Master.Team_id as Team_ID,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
									join (Select distinct(team_id),team_name From team_master) as Team_master 
									on Team_master.team_id=MUser_Master.Team_id 
								Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And MUser_Master.Account_Status=1
							) as Als_Performance_Main
							group by status_code,team_id,team_name
						) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') 
					
						UNION

						Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
								'0' as Pending_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
						From Team_Master 
						Where Team_ID NOT IN
						(
							Select Distinct MUser_Master.Team_id as Team_ID
							From tbl_NewTaskDetails 
								Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH')) 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
								and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
						)
						and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) T Order By Total_Issues DESC
				End
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') Order By Total_Issues DESC
				End
			End
		End
		Else
		Begin
		If (@Teamid in ('L1','L2F','L2T','L3','A'))
			Begin
				If @Status='All'
				Begin
					If @FromDate='' and @ToDate='' 
					Begin		
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
								Convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
				End
				Else --////////////// Status IS Specified /////////////////////////--
				Begin
					If @FromDate='' and @ToDate='' 
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Status='C')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code='C'
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code='C' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='P')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('P','UP') 
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('P','UP')  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='E')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('EF','ET','E3')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('EF','ET','E3') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='R')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('R')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('R') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='X')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						--///////////////////////////////
					End		
				End 
			End	
		End
	End
--###############################################################################################################--
							--================== Branch Head =================--			
--###############################################################################################################--
	Else If(@ROLE='BH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,
						sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,
						sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,
						sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id,	Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
								And MUser_Master.Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select Team_id,	team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master 
								on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,Total_Issues ,Escalated_Issues, Completed_issues,Pending_Issues,
						Reassigned_Issues,Closed_Issues 
					From
					(
						Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
						(
							Select team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							From 
							(	
								Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
									MUser_Master.Team_id as Team_ID,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
									join (Select distinct(team_id),team_name From team_master) as Team_master 
									on Team_master.team_id=MUser_Master.Team_id 
								Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And MUser_Master.Account_Status=1
							) as Als_Performance_Main
							group by status_code,team_id,team_name
						) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') 
					
						UNION

						Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
								'0' as Pending_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
						From Team_Master 
						Where Team_ID NOT IN
						(
							Select Distinct MUser_Master.Team_id as Team_ID
							From tbl_NewTaskDetails 
								Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
								and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
						)
						and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) T Order By Total_Issues DESC
				End
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') Order By Total_Issues DESC
				End
			End
		End
		Else
		Begin
		If (@Teamid in ('L1','L2F','L2T','L3','A'))
			Begin
				If @Status='All'
				Begin
					If @FromDate='' and @ToDate='' 
					Begin		
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
								Convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And MUser_Master.Account_Status=1
						END
					End
				End
				Else --////////////// Status IS Specified /////////////////////////--
				Begin
					If @FromDate='' and @ToDate='' 
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Status='C')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code='C'
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code='C' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='P')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('P','UP') 
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('P','UP')  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='E')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('EF','ET','E3')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('EF','ET','E3') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='R')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('R')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('R') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='X')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									And MUser_Master.Account_Status=1
							END
						End

						--///////////////////////////////
					End		
				End 
			End	
		End
	End
	--////////////////////////////////////// ITM /////////////////////////////////////
	
		Else If(@ROLE='ITM')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,
						sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,
						sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,
						sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id,	Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
								And MUser_Master.Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select Team_id,	team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master 
								on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3')
					Order By Total_Issues DESC
				END
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,Total_Issues ,Escalated_Issues, Completed_issues,Pending_Issues,
						Reassigned_Issues,Closed_Issues 
					From
					(
						Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
						(
							Select team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							From 
							(	
								Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
									MUser_Master.Team_id as Team_ID,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
									join (Select distinct(team_id),team_name From team_master) as Team_master 
									on Team_master.team_id=MUser_Master.Team_id 
								Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And MUser_Master.Account_Status=1
							) as Als_Performance_Main
							group by status_code,team_id,team_name
						) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') 
					
						UNION

						Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
								'0' as Pending_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
						From Team_Master 
						Where Team_ID NOT IN
						(
							Select Distinct MUser_Master.Team_id as Team_ID
							From tbl_NewTaskDetails 
								Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
								and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
						)
						and Team_Master.Team_ID in ('L1','L2T','L2F','L3')
					) T Order By Total_Issues DESC
				End
				If(@Location<>'')
				Begin
					Select
					team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues From
					(
						Select team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='EBro' 
								and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And MUser_Master.Account_Status=1
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('L1','L2T','L2F','L3') Order By Total_Issues DESC
				End
			End
		End
		Else
		Begin
		If (@Teamid in ('L1','L2F','L2T','L3','A'))
			Begin
				If @Status='All'
				Begin
					If @FromDate='' and @ToDate='' 
					Begin		
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
							join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
								Convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
				End
				Else --////////////// Status IS Specified /////////////////////////--
				Begin
					If @FromDate='' and @ToDate='' 
					Begin
						If(@Location='')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
								and MUser_Master.team_id=@TeamID 
								and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
						If(@Location<>'')
						Begin
							Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
								client_master.short_name as Client_name,Product_master.product_name as product_name,
								tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
								tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
								convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
								jobstatusmaster.jobstatus_name as Status
							From tbl_NewTaskDetails 
								join (Select * From vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
								join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
								join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
								MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
								upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And MUser_Master.Account_Status=1
						END
					End
					Else
					Begin
						If(@Status='C')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code='C'
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code='C' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='P')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('P','UP') 
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('P','UP')  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='E')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('EF','ET','E3')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('EF','ET','E3') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='R')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' 
									and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('R')
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('R') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End
						Else If(@Status='X')
						Begin
							If(@Location='')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and MUser_Master.team_id=@TeamID 
									and tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
							If(@Location<>'')
							Begin
								Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
									client_master.short_name as Client_name,Product_master.product_name as product_name,
									tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,
									tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
									convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.Username As [Issue Resolved By],
									jobstatusmaster.jobstatus_name as Status
								From tbl_NewTaskDetails 
									join (Select * From vendor_product) as Product_master on (tbl_NewTaskDetails.product_code=Product_master.product_code or tbl_NewTaskDetails.product_code=Product_master.product_name)
									join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
									join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								Where tbl_NewTaskDetails.docket_number <>'' and issue_type='EBro' and 
									MUser_Master.team_id=@TeamID and tbl_teamleadermaster.branch_name=@Location and 
									tbl_NewTaskDetails.status_code in ('X') and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									And MUser_Master.Account_Status=1
							END
						End

						--///////////////////////////////
					End		
				End 
			End	
		End
	End

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_Performance_MainIT
-- --------------------------------------------------







CREATE Proc [dbo].[USP_MIS_Performance_MainIT]
--Author:	Sanjay Lavu Kudtarkar
@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@TeamID as nvarchar(10),
@Status as varchar(50),
@Location as varchar(15)
as
if @TeamID='' and @Status=''
begin
	if @FromDate='' and @ToDate='' 
	begin
		IF(@Location='')
		BEGIN	
			select
			team_id AS TeamID,team_name AS Team,sum (all_issues) as Total,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed from
			(
			SELECT 
			team_id,
			team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select 
				distinct(tbl_NewTaskDetails.docket_number) as docket_number,
				MUser_Master.Team_id as Team_ID,
				team_master.team_name as Team_Name,
				tbl_NewTaskDetails.status_code as Status_code 
				from tbl_NewTaskDetails 
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
				join (select distinct(team_id),team_name from team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
				where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' and
				datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			) as Als_Performance_Main
			group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id like '%it%'
		END
		IF(@Location<>'')
		BEGIN	
			select
			team_id as TeamID,team_name as Team,sum (all_issues) as Total,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed  from
			(
			SELECT 
			team_id,
			team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select 
				distinct(tbl_NewTaskDetails.docket_number) as docket_number,
				MUser_Master.Team_id as Team_ID,
				team_master.team_name as Team_Name,
				tbl_NewTaskDetails.status_code as Status_code 
				from tbl_NewTaskDetails 
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
				join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
				join (select distinct(team_id),team_name from team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
				where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' and 
				tbl_teamleadermaster.branch_name=@Location and
				datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			) as Als_Performance_Main
			group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id like '%it%'
		END
	end
	else
	begin
		IF(@Location='')
		BEGIN
			select
			team_id as TeamID,team_name as Team,sum (all_issues) as Total,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed  from
			(
			SELECT 
			team_id,
			team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code from tbl_NewTaskDetails join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
			join (select distinct(team_id),team_name from team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
			where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)) as Als_Performance_Main
			group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id like '%it%'
		END
		IF(@Location<>'')
		BEGIN
			select
			team_id as TeamID,team_name as Team,sum (all_issues) as Total,sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,sum(Ressigned_Issues) as Reassigned,sum(Closed_Issues) as Closed  from
			(
			SELECT 
			team_id,
			team_name,
			All_Issues= ISNULL(count(docket_number),0),
			Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
			Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
			Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
			Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
			Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
			FROM 
			(select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
					MUser_Master.Team_id as Team_ID,
					team_master.team_name as Team_Name,
					tbl_NewTaskDetails.status_code as Status_code 
					from tbl_NewTaskDetails 
					join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
					join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
					join (select distinct(team_id),team_name from team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
					where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
					and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
					tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)) as Als_Performance_Main
					group by status_code,team_id,team_name
			) as Temp  group by team_id,team_name having team_id like '%it%'
		END
	end
end
else
begin
	if @Status='All'
		begin
		if @FromDate='' and @ToDate='' 
			begin		
			IF(@Location='')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and issue_type='IT' and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			END
			IF(@Location<>'')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and 
				issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
				datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			END
			end
		else
			begin
			IF(@Location='')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and issue_type='IT' and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
			END
			IF(@Location<>'')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and 
				issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
				tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
			END
			end
		end
	else
		begin
		if @FromDate='' and @ToDate='' 
			begin
			IF(@Location='')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			END
			IF(@Location<>'')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and 
				issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
				upper(tbl_NewTaskDetails.status_code) like upper(@Status) and MUser_Master.team_id=@TeamID and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
			END
			end
		else
			begin
			IF(@Location='')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
			END
			IF(@Location<>'')
			BEGIN
				select tbl_NewTaskDetails.docket_number as [Docket No],client_master.client_code as [Client Code],client_master.short_name as [Client Name],Product_master.product_name as [Product Name],tbl_NewTaskDetails.type as [Type],tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as [Resolving Time],jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
				where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and 
				issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
				upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
			END
			end		
		end 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_Performance_MainIT_NEW
-- --------------------------------------------------




CREATE Proc [dbo].[USP_MIS_Performance_MainIT_NEW]

--Created BY	:	Sanjay Lavu Kudtarkar
--ModIfied By	:	MahEndra D. Bonde

@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@TeamID as nvarchar(10),
@Status as varchar(50),
@Location as varchar(15),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)

As
Begin

	If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
	Begin 
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select team_id, team_name, 
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' and 
								tbl_teamleadermaster.branch_name=@Location and
								datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_ID, Team_Name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
								And Account_Status=1
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

					UNION
				
					Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
							'0' as PEnding_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
					From Team_Master 
					Where Team_ID NOT IN
					(
						Select distinct(Team_Master.Team_id) as Team_ID
						From tbl_NewTaskDetails 
							Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
							And tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
							And Account_Status=1
					)
					and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

						
				End
				If(@Location<>'')
				Begin
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
		End
		Else
		Begin
			If @Status='All'
			Begin
				If @FromDate='' and @ToDate='' 
				Begin		
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' And MUser_Master.Account_Status=1
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID and 
							issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
							datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,
							D.Brief_Solution As Brief_Solution,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' and 
							D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
							and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							And UM.Account_Status=1			
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
					End
				End
			End
			Else
			Begin
				If @FromDate='' and @ToDate='' 
				Begin
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,D.Brief_Solution As Brief_Solution,
							D.client_remark as Remark,D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' and 
						D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
						and upper(D.status_code) like upper(@Status) 
						and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
						And Account_Status=1

					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
							And MUser_Master.Account_Status=1
					End
				End		
			End 
		End
	End
--###############################################################################################################--
							--================== Regional Head =================--			
--###############################################################################################################--
	Else If(@ROLE='RH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select team_id, team_name, 
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_ID, Team_Name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails with (NOLOCK)
								join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
								And Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

					UNION
				
					Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
							'0' as PEnding_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
					From Team_Master 
					Where Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
					And Team_ID NOT IN
					(
						Select distinct(Team_Master.Team_id) as Team_ID
						From tbl_NewTaskDetails with (NOLOCK)
							Join MUser_Master with (NOLOCK) on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
							And tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3') And Account_Status=1
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					
				End
				If(@Location<>'')
				Begin
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
		End
		Else
		Begin
			If @Status='All'
			Begin
				If @FromDate='' and @ToDate='' 
				Begin		
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,
							D.Brief_Solution As Brief_Solution,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
							and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) 
							and issue_type='IT' 
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							And Account_Status=1			
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location  
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
					End
				End
			End
			Else
			Begin
				If @FromDate='' and @ToDate='' 
				Begin
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
							And MUser_Master.Account_Status=1 
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,D.Brief_Solution As Brief_Solution,
							D.client_remark as Remark,D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
						and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
						and upper(D.status_code) like upper(@Status) 
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
						And Account_Status=1

					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
							And MUser_Master.Account_Status=1
					End
				End		
			End 
		End
	End
--###############################################################################################################--
							--================== Cluster Head =================--			
--###############################################################################################################--
	Else If(@ROLE='CH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select team_id, team_name, 
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_ID, Team_Name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
								And Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

					UNION
				
					Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
							'0' as PEnding_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
					From Team_Master 
					Where Team_ID NOT IN
					(
						Select distinct(Team_Master.Team_id) as Team_ID
						From tbl_NewTaskDetails 
							Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
							And tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3') And Account_Status=1
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
		End
		Else
		Begin
			If @Status='All'
			Begin
				If @FromDate='' and @ToDate='' 
				Begin		
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,
							D.Brief_Solution As Brief_Solution,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
							and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) 
							and issue_type='IT' 
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							And Account_Status=1			
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location  
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
					End
				End
			End
			Else
			Begin
				If @FromDate='' and @ToDate='' 
				Begin
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
							And MUser_Master.Account_Status=1 
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,D.Brief_Solution As Brief_Solution,
							D.client_remark as Remark,D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
						and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
						and upper(D.status_code) like upper(@Status) 
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
						And Account_Status=1

					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
							And MUser_Master.Account_Status=1
					End
				End		
			End 
		End
	End
--###############################################################################################################--
							--================== Zonal Head =================--			
--###############################################################################################################--
	Else If(@ROLE='ZH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select team_id, team_name, 
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_ID, Team_Name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
								And Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

					UNION
				
					Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
							'0' as PEnding_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
					From Team_Master 
					Where Team_ID NOT IN
					(
						Select distinct(Team_Master.Team_id) as Team_ID
						From tbl_NewTaskDetails 
							Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
							And tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3') And Account_Status=1
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
		End
		Else
		Begin
			If @Status='All'
			Begin
				If @FromDate='' and @ToDate='' 
				Begin		
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,
							D.Brief_Solution As Brief_Solution,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
							and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) 
							and issue_type='IT' 
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							And Account_Status=1			
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location  
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
					End
				End
			End
			Else
			Begin
				If @FromDate='' and @ToDate='' 
				Begin
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
							And MUser_Master.Account_Status=1 
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,D.Brief_Solution As Brief_Solution,
							D.client_remark as Remark,D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
						and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
						and upper(D.status_code) like upper(@Status) 
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
						And Account_Status=1

					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
							And MUser_Master.Account_Status=1
					End
				End		
			End 
		End
	End
--###############################################################################################################--
							--================== Branch Head =================--			
--###############################################################################################################--
	Else If(@ROLE='BH')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select team_id, team_name, 
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_ID, Team_Name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
								And Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

					UNION
				
					Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
							'0' as PEnding_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
					From Team_Master 
					Where Team_ID NOT IN
					(
						Select distinct(Team_Master.Team_id) as Team_ID
						From tbl_NewTaskDetails 
							Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
							And tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3') And Account_Status=1
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
					)
					and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

						
				End
				If(@Location<>'')
				Begin
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
		End
		Else
		Begin
			If @Status='All'
			Begin
				If @FromDate='' and @ToDate='' 
				Begin		
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,
							D.Brief_Solution As Brief_Solution,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
							and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) 
							and issue_type='IT' 
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							And Account_Status=1			
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location  
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
					End
				End
			End
			Else
			Begin
				If @FromDate='' and @ToDate='' 
				Begin
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
							And MUser_Master.Account_Status=1 
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,D.Brief_Solution As Brief_Solution,
							D.client_remark as Remark,D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
						and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
						and upper(D.status_code) like upper(@Status) 
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
						And Account_Status=1

					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
							And MUser_Master.Account_Status=1
					End
				End		
			End 
		End
	End
		Else If(@ROLE='ITM')
	Begin
		If @TeamID='' and @Status=''
		Begin
			If @FromDate='' and @ToDate='' 
			Begin
				If(@Location='')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select team_id, team_name, 
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT'
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
				If(@Location<>'')
				Begin	
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select Distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number <>'' and  issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location 
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
			Else
			Begin
				If(@Location='')
				Begin
					Select team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_ID, Team_Name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,MUser_Master.Team_id as Team_ID,team_master.team_name as Team_Name,tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' and 
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
								And Account_Status=1 
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

					UNION
				
					Select Team_ID,Team_Name, '0' as Total_Issues ,'0' as Escalated_Issues,'0' as Completed_issues,
							'0' as PEnding_Issues,'0' as Reassigned_Issues, '0' as Closed_Issues 
					From Team_Master 
					Where Team_ID NOT IN
					(
						Select distinct(Team_Master.Team_id) as Team_ID
						From tbl_NewTaskDetails 
							Join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by 
							Join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
						Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
							And tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3') And Account_Status=1
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					and Team_Master.Team_ID in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')

						
				End
				If(@Location<>'')
				Begin
					Select Team_id,team_name,sum (all_issues) as Total_Issues ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(PEnding_Issues) as PEnding_Issues,
						sum(Ressigned_Issues) as Reassigned_Issues,sum(Closed_Issues) as Closed_Issues 
					From
					(
						Select Team_id, Team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) End,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) End,0),
							PEnding_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) End,0),
							Ressigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) End,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) End,0)
						From 
						(
							Select distinct(tbl_NewTaskDetails.docket_number) as docket_number,
								MUser_Master.Team_id as Team_ID,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id 
								join (Select distinct(team_id),team_name From team_master) as Team_master on Team_master.team_id=MUser_Master.Team_id 
							Where tbl_NewTaskDetails.docket_number<>'' and issue_type='IT' 
								and tbl_teamleadermaster.branch_name=@Location and tbl_teamleadermaster.branch_name=@Location and
								tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								And Account_Status=1 And Team_master.team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
						) as Als_Performance_Main Group by status_code,team_id,team_name
					) as Temp  group by team_id,team_name having team_id in ('ITL1','ITL2O','ITL2N','ITL2V','ITL3')
				End
			End
		End
		Else
		Begin
			If @Status='All'
			Begin
				If @FromDate='' and @ToDate='' 
				Begin		
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, 
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,
							D.Brief_Solution As Brief_Solution,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
							and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) 
							and issue_type='IT' 
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							And Account_Status=1			
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location  
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
							And MUser_Master.Account_Status=1
					End
				End
			End
			Else
			Begin
				If @FromDate='' and @ToDate='' 
				Begin
					If(@Location='')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID 
							and issue_type='IT' and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())
							And MUser_Master.Account_Status=1 
					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product ) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) 
							and MUser_Master.team_id=@TeamID 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							And MUser_Master.Account_Status=1
					End
				End
				Else
				Begin
					If(@Location='')
					Begin
						
						Select Distinct D.docket_number as Docket_Number,D.client_code as Client_code,
							D.SBTAG as SBTAG,PM.product_name as product_name,D.nature as Nature,D.problem as Problem,D.Brief_Solution As Brief_Solution,
							D.client_remark as Remark,D.issue_raised_datetime as Issue_raised_datetime,
							 convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							UM.UserName As [Issue Resolved By],
							JS.jobstatus_name as Status
						From tbl_NewTaskDetails D
							join tbl_it_productmaster PM on D.product_code=PM.product_name
							join jobstatusmaster JS on D.status_code=JS.jobstatus_id
							join MUser_Master UM on UM.Userid=D.issue_resolved_by
						Where D.docket_number <>'' 
						and D.issue_resolved_by in (Select userid From MUser_Master Where team_id=@TeamID) and issue_type='IT' 
						and upper(D.status_code) like upper(@Status) 
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and D.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
						And Account_Status=1

					End
					If(@Location<>'')
					Begin
						Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,
							client_master.short_name as Client_name,Product_master.product_name as product_name,
							tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,
							tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,
							tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8) as Resolution_time,
							MUser_Master.UserName As [Issue Resolved By],
							jobstatusmaster.jobstatus_name as Status
						From tbl_NewTaskDetails 
							join (Select * From vEndor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
							join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
							join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
						Where tbl_NewTaskDetails.docket_number <>'' and MUser_Master.team_id=@TeamID  
							and issue_type='IT' and tbl_teamleadermaster.branch_name=@Location 
							and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and upper(tbl_NewTaskDetails.status_code) like upper(@Status) and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and MUser_Master.team_id=@TeamID
							And MUser_Master.Account_Status=1
					End
				End		
			End 
		End
	End

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_ProductNatureProblemWiseReport
-- --------------------------------------------------


CREATE proc [dbo].[usp_MIS_ProductNatureProblemWiseReport] 
@Product_Name as varchar(100),
@Nature as nvarchar(150),
@Problem as nvarchar(max),
@period as varchar(50)
as
declare @t as varchar(max)
declare @7t as varchar(max)
declare @30t as varchar(max)

if(@period='')
begin
	if @Product_Name='Odin Client'  or @Product_Name='System'
	begin

					select @t=count(distinct(CD.Docket_number)) 
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name)  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)

					select @7t=count(distinct(CD.Docket_number)) 
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and datediff(day,CD.issue_raised_dateTime,getdate()) <8  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
					
					select @30t=count(distinct(CD.Docket_number)) 
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and datediff(day,CD.issue_raised_dateTime,getdate()) <31  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)

		select distinct(problem),@Product_Name as Product_name,@Nature as nature,sum(last_seven_Days_issues) as last_seven_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) as [Last_seven_days_issues_(%)],sum(last_thirty_Days_issues) as last_thirty_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) as [Last_thirty_days_issues_(%)],sum(Total_issues) as Total_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) as [Total_issues_(%)], 
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Minimum_Time,
		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Average_Time
		from
		(
			select 
			problem,
			last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),
			last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0),
			Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
			Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
			from (
					select distinct(CD.Docket_number),CD.Client_code,isnull(Fd.problem,'Not Specified') as problem ,Product_name,issue_raised_dateTime,issue_resolving_time 
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
				) as temp1
			GROUP BY issue_raised_dateTime,problem,issue_resolving_time
		) as temp group by  problem  order by problem
	end
	else
	begin

					select @t= count(distinct(CD.Docket_number) )
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name)  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)

					select @7t= count(distinct(CD.Docket_number) )
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name)  and datediff(day,CD.issue_raised_dateTime,getdate()) <8  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
					
					select @30t= count(distinct(CD.Docket_number) )
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name)  and datediff(day,CD.issue_raised_dateTime,getdate()) <31  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)

		select distinct(problem),@Product_Name as Product_name,@Nature as nature,sum(last_seven_Days_issues) as last_seven_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) as [Last_seven_days_issues_(%)],sum(last_thirty_Days_issues) as last_thirty_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) as [Last_thirty_days_issues_(%)],sum(Total_issues) as Total_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) as [Total_issues_(%)], 
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Minimum_Time,
		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Average_Time
		from
		(
			select 
			problem,
			last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),
			last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0),
			Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
			Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
			from (
					select distinct(CD.Docket_number),CD.Client_code,isnull(Fd.problem,'Not Specified') as problem ,Product_name,issue_raised_dateTime,issue_resolving_time 
					from tbl_newclient_details CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
				) as temp1
			GROUP BY issue_raised_dateTime,problem,issue_resolving_time
		) as temp group by  problem  order by problem
	end
end
else if @Product_Name='Odin Client'  or @Product_Name='System'
begin
	if(@period='ALL')
		begin
			select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=Muser_master.userid 
			where  tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name) and tbl_NewTaskDetails.nature=@Nature and tbl_NewTaskDetails.Problem=@Problem
		end
	else
		begin
			select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			where datediff(day,tbl_NewTaskDetails.issue_raised_dateTime,getdate()) <= convert(int,@period) and tbl_NewTaskDetails.Problem=@Problem and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name) and tbl_NewTaskDetails.nature =@Nature
		end
end
else if @Product_Name<>'Odin Client' and   @Product_Name<>'System'
	begin
	if(@period='ALL')
	begin
		select tbl_newclient_details.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_newclient_details.type as _Type,tbl_newclient_details.nature as Nature,tbl_newclient_details.problem as Problem,tbl_newclient_details.client_remark as Remark,tbl_newclient_details.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_newclient_details.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_newclient_details 
		join (select * from vendor_product) as Product_master on tbl_newclient_details.product_code=Product_master.product_code 
		join jobstatusmaster on tbl_newclient_details.status_code=jobstatusmaster.jobstatus_id
		join client_master on client_master.client_code=tbl_newclient_details.client_code
		join MUser_Master on MUser_Master.userid=tbl_newclient_details.issue_Resolved_by
		where
		tbl_newclient_details.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		and tbl_newclient_details.nature =@Nature and tbl_newclient_details.Problem=@Problem and not tbl_newclient_details.problem is null order by tbl_newclient_details.docket_number 
	end
	else
	begin
		select tbl_newclient_details.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_newclient_details.type as _Type,tbl_newclient_details.nature as Nature,tbl_newclient_details.problem as Problem,tbl_newclient_details.client_remark as Remark,tbl_newclient_details.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_newclient_details.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_newclient_details 
		join (select * from vendor_product) as Product_master on tbl_newclient_details.product_code=Product_master.product_code 
		join jobstatusmaster on tbl_newclient_details.status_code=jobstatusmaster.jobstatus_id
		join client_master on client_master.client_code=tbl_newclient_details.client_code
		join MUser_Master on MUser_Master.userid=tbl_newclient_details.issue_Resolved_by
		where
		tbl_newclient_details.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		and tbl_newclient_details.nature =@Nature and tbl_newclient_details.Problem=@Problem and not tbl_newclient_details.problem is null 
		and datediff(day,tbl_newclient_details.issue_raised_dateTime,getdate()) <= convert(int,@period)
		order by tbl_newclient_details.docket_number 
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_ProductNatureProblemWiseReport_New
-- --------------------------------------------------








CREATE proc [dbo].[USP_MIS_ProductNatureProblemWiseReport_New] 

--Created By	: Mahendra Bonde

@Product_Name as varchar(100),
@Nature as nvarchar(150),
@Problem as nvarchar(max),
@period as varchar(50),
@Choice As Char(10),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)


as

declare @t as varchar(max)
declare @7t as varchar(max)
declare @30t as varchar(max)

If((@period='' or @period<>'0') and @Problem='')
Begin
	-- ================================== IT Product Count=============================== --
	If(@Choice='IT') 
	Begin

		Select @t=ISNULL(count(Distinct(docket_number)) ,0)
		from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
		where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
				and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT'

		Select @7t=ISNULL(count(Distinct(docket_number)) ,0)
		from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
		where  cd.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <8  
				and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
				and cd.Issue_Type='IT'

		Select @30t=ISNULL(count(Distinct(docket_number)) ,0)
		from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
		where  cd.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <31  
				and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
				and cd.Issue_Type='IT'

		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),cd.Product_code As Product_Name,CD.Client_code,CD.Nature,
									isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
									and cd.Issue_Type='IT'
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 


				UNION

				Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				where Problem NOT IN 
				(
					Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
					from tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
						and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
						and cd.Issue_Type='IT'
				)
				and product_Name=@Product_Name and nature=@Nature
		
			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='RH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),cd.Product_code As Product_Name,CD.Client_code,CD.Nature,
									isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
									and cd.Issue_Type='IT'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 


				UNION

				Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				where Problem NOT IN 
				(
					Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
					from tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
						Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
						and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
						and cd.Issue_Type='IT'
						And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				)
				and product_Name=@Product_Name and nature=@Nature
	
			) T Order BY Total_Issues
		End
		Else If(@ROLE='CH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),cd.Product_code As Product_Name,CD.Client_code,CD.Nature,
									isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
									and cd.Issue_Type='IT'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 


				UNION

				Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				where Problem NOT IN 
				(
					Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
					from tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
						Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
						and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
						and cd.Issue_Type='IT'
						And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				)
				and product_Name=@Product_Name and nature=@Nature
	
			) T Order BY Total_Issues
		End
		Else If(@ROLE='ZH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),cd.Product_code As Product_Name,CD.Client_code,CD.Nature,
									isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
									and cd.Issue_Type='IT'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 


				UNION

				Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				where Problem NOT IN 
				(
					Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
					from tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
						Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
						and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
						and cd.Issue_Type='IT'
						And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				)
				and product_Name=@Product_Name and nature=@Nature
	
			) T Order BY Total_Issues
		End
		Else If(@ROLE='BH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),cd.Product_code As Product_Name,CD.Client_code,CD.Nature,
									isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
									and cd.Issue_Type='IT'
									and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 


				UNION

				Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				where Problem NOT IN 
				(
					Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
					from tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
						Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
						and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
						and cd.Issue_Type='IT'
						and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				)
				and product_Name=@Product_Name and nature=@Nature
	
			) T Order BY Total_Issues
		End
	End
	-- ================================== EBroking Product Count=============================== --
	Else If(@Choice='EBro')
	Begin
		Select @t=ISNULL(count(Distinct(docket_number)) ,0)
			from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
			where  VP.Product_Name=@Product_Name and CD.Nature=@Nature  and (cd.problem<>'' or cd.problem is not null) 
					and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'

		Select @7t=ISNULL(count(Distinct(docket_number)) ,0)
			from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
			where  VP.Product_Name=@Product_Name and CD.Nature=@Nature  and datediff(day,CD.issue_raised_dateTime,getdate()) <8  
					and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null)
					and cd.Issue_Type='EBro'
					
		Select @30t=ISNULL(count(Distinct(docket_number)) ,0)
			from tbl_newclient_details CD  
				full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
			where  VP.Product_Name=@Product_Name and CD.Nature=@Nature  and datediff(day,CD.issue_raised_dateTime,getdate()) <31  
					and (cd.problem<>'' or cd.problem is not null) and (cd.nature<>'' or cd.nature is not null)
					and cd.Issue_Type='EBro'					
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select distinct(Problem),Product_Name, Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues,[Last_Thirty_Days_Issues_(%)],Total_issues,[Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.Product_Name As Product_Name, CD.Client_code,
										isnull(Fd.problem,'Not Specified') as problem ,CD.Nature,
										issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
								where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature 
									and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 

				UNION
				
				Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where Problem NOT IN 
				(
					Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
					From tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
						and CD.Nature=@Nature 
						and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
				)
				and Product_Name=@Product_Name and faq_nature=@Nature
			
			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='RH')
		Begin
			Select distinct(Problem),Product_Name, Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues,[Last_Thirty_Days_Issues_(%)],Total_issues,[Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.Product_Name As Product_Name, CD.Client_code,
										isnull(Fd.problem,'Not Specified') as problem ,CD.Nature,
										issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature 
									and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 

				UNION
				
				Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where Problem NOT IN 
				(
					Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
					From tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
						And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and CD.Nature=@Nature 
						and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
				)
				and Product_Name=@Product_Name and faq_nature=@Nature
			
			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='CH')
		Begin
			Select distinct(Problem),Product_Name, Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues,[Last_Thirty_Days_Issues_(%)],Total_issues,[Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.Product_Name As Product_Name, CD.Client_code,
										isnull(Fd.problem,'Not Specified') as problem ,CD.Nature,
										issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature 
									and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 

				UNION
				
				Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where Problem NOT IN 
				(
					Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
					From tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
						And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and CD.Nature=@Nature 
						and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
				)
				and Product_Name=@Product_Name and faq_nature=@Nature
			
			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='ZH')
		Begin
			Select distinct(Problem),Product_Name, Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues,[Last_Thirty_Days_Issues_(%)],Total_issues,[Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.Product_Name As Product_Name, CD.Client_code,
										isnull(Fd.problem,'Not Specified') as problem ,CD.Nature,
										issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature 
									and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 

				UNION
				
				Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where Problem NOT IN 
				(
					Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
					From tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
						And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						and CD.Nature=@Nature 
						and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
				)
				and Product_Name=@Product_Name and faq_nature=@Nature
			
			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='BH')
		Begin
			Select distinct(Problem),Product_Name, Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues,[Last_Thirty_Days_Issues_(%)],Total_issues,[Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.Product_Name As Product_Name, CD.Client_code,
										isnull(Fd.problem,'Not Specified') as problem ,CD.Nature,
										issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature 
									and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature
				) as temp group by  problem,Product_Name,Nature 

				UNION
				
				Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where Problem NOT IN 
				(
					Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
					From tbl_newclient_details CD  
						full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
						and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						and CD.Nature=@Nature 
						and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
				)
				and Product_Name=@Product_Name and faq_nature=@Nature
			
			) T Order BY Total_Issues DESC
		End
	End
	-- ================================== ALL Product Count=============================== --
	Else If(@Choice='ALL')
	Begin
		
		Set @t	=(Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where VP.Product_Name=@Product_Name and CD.Nature=@Nature  and (cd.problem<>'' or cd.problem is not null) and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro')
					+
				 (Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT')
		

		Set @7t	=(Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where VP.Product_Name=@Product_Name and CD.Nature=@Nature  and datediff(day,CD.issue_raised_dateTime,getdate()) <8  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro' )
					+
				 (Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem where  cd.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <8  and (cd.problem<>'' or cd.problem is not null) and  (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT')
					
		Set @30t=(Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where VP.Product_Name=@Product_Name and CD.Nature=@Nature  and datediff(day,CD.issue_raised_dateTime,getdate()) <31 and (cd.problem<>'' or cd.problem is not null) and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro')
					+
				 (Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem where  cd.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <31  and (cd.problem<>'' or cd.problem is not null) and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT')
		
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(	
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.product_Name As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
								where  VP.product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
								
								UNION
				
								Select distinct(CD.Docket_number),CD.Product_Code As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT'
								
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature			
				) as temp group by  problem,Product_Name,Nature 

				UNION

				Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
					Minimum_Time, Maximum_Time, Average_Time
				From
				(
					Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where Problem NOT IN 
					(
						Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
						From tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
							and CD.Nature=@Nature 
							and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
					)
					and Product_Name=@Product_Name and faq_nature=@Nature
					
					UNION
					
					Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					where Problem NOT IN 
					(
						Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
						from tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
						where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
							and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
							and cd.Issue_Type='IT'
					)
					and product_Name=@Product_Name and nature=@Nature
				) TEMP

			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='RH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(	
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.product_Name As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  VP.product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								
								UNION
				
								Select distinct(CD.Docket_number),CD.Product_Code As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature			
				) as temp group by  problem,Product_Name,Nature 

				UNION

				Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
					Minimum_Time, Maximum_Time, Average_Time
				From
				(
					Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where Problem NOT IN 
					(
						Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
						From tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
							And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and CD.Nature=@Nature 
							and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
					)
					and Product_Name=@Product_Name and faq_nature=@Nature
					
					UNION
					
					Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					where Problem NOT IN 
					(
						Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
						from tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
							Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
							and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
							and cd.Issue_Type='IT'
							And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					and product_Name=@Product_Name and nature=@Nature
				) TEMP

			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='CH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(	
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.product_Name As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  VP.product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								
								UNION
				
								Select distinct(CD.Docket_number),CD.Product_Code As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature			
				) as temp group by  problem,Product_Name,Nature 

				UNION

				Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
					Minimum_Time, Maximum_Time, Average_Time
				From
				(
					Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where Problem NOT IN 
					(
						Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
						From tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
							And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and CD.Nature=@Nature 
							and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
					)
					and Product_Name=@Product_Name and faq_nature=@Nature
					
					UNION
					
					Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					where Problem NOT IN 
					(
						Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
						from tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
							Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
							and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
							and cd.Issue_Type='IT'
							And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					and product_Name=@Product_Name and nature=@Nature
				) TEMP

			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='ZH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(	
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.product_Name As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  VP.product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								
								UNION
				
								Select distinct(CD.Docket_number),CD.Product_Code As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT'
									And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature			
				) as temp group by  problem,Product_Name,Nature 

				UNION

				Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
					Minimum_Time, Maximum_Time, Average_Time
				From
				(
					Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where Problem NOT IN 
					(
						Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
						From tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
							And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							and CD.Nature=@Nature 
							and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
					)
					and Product_Name=@Product_Name and faq_nature=@Nature
					
					UNION
					
					Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					where Problem NOT IN 
					(
						Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
						from tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
							Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
							and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
							and cd.Issue_Type='IT'
							And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					)
					and product_Name=@Product_Name and nature=@Nature
				) TEMP

			) T Order BY Total_Issues DESC
		End
		Else If(@ROLE='BH')
		Begin
			Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
				Minimum_Time, Maximum_Time, Average_Time
			From
			(	
				Select distinct(problem),Product_Name,Nature,
					sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'), 
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Product_Name,Nature,sum(last_seven_Days_issues) As last_seven_Days_issues,
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from
					(
						Select problem,Product_Name,Nature,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) End,0),
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  End,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from (
								Select distinct(CD.Docket_number),VP.product_Name As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
									Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  VP.product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
									and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								
								UNION
				
								Select distinct(CD.Docket_number),CD.Product_Code As Product_Name,CD.Client_code,CD.Nature,
										isnull(Fd.problem,'Not Specified') as problem ,issue_raised_dateTime,issue_resolving_time 
								from tbl_newclient_details CD  
									full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
									Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
								where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
									and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='IT'
									and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								
							) as temp1
						GROUP BY issue_raised_dateTime,problem,Product_Name,Nature,issue_resolving_time
					) as temp2 group by  problem,Product_Name,Nature			
				) as temp group by  problem,Product_Name,Nature 

				UNION

				Select distinct(Problem),Product_Name,Nature,Last_Seven_Days_Issues,[Last_seven_days_issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_issues_(%)], 
					Minimum_Time, Maximum_Time, Average_Time
				From
				(
					Select distinct(Problem),Product_Name, faq_nature AS Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where Problem NOT IN 
					(
						Select distinct(isnull(FD.Problem,'Not Specified')) as Problem 
						From tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						Where VP.Product_Name=@Product_Name and (cd.problem<>'' or cd.problem is not null) 
							and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							and CD.Nature=@Nature 
							and (cd.nature<>'' or cd.nature is not null) and cd.Issue_Type='EBro'
					)
					and Product_Name=@Product_Name and faq_nature=@Nature
					
					UNION
					
					Select distinct(Problem),Product_Name,Nature,'0' As Last_Seven_Days_Issues,'0' As [Last_seven_days_issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_issues,	'0' As [Total_issues_(%)], 
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					where Problem NOT IN 
					(
						Select distinct(isnull(Fd.problem,'Not Specified')) as Problem 
						from tbl_newclient_details CD  
							full join (Select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
							Join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						where  cd.Product_code=@Product_Name and (cd.problem<>'' or cd.problem is not null)
							and CD.Nature=@Nature and (cd.nature<>'' or cd.nature is not null) 
							and cd.Issue_Type='IT'
							and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
					)
					and product_Name=@Product_Name and nature=@Nature
				) TEMP

			) T Order BY Total_Issues DESC
		End
	End
End
Else if(@period='ALL')  -- ======================== Period ALL ============================== --
Begin
	-- ================================== IT Product =============================== --
	If(@Choice='IT')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			select distinct(CD.docket_number) as Docket_Number,
					CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code,
					CD.product_Code as Product_Name,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
					and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='RH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
				CTCD.ctcl_isbtag as [Sub_broker],
				CD.client_code as Client_code,
				CD.product_Code as Product_Name,
				CD.nature as Nature,
				CD.problem as Problem,
				CD.client_remark as Remark,
				CD.issue_raised_datetime as Issue_raised_datetime,
				convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
				CD.brief_solution as brief_solution,
				UM.username as issue_resolved_by,
				JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
				and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='CH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
				CTCD.ctcl_isbtag as [Sub_broker],
				CD.client_code as Client_code,
				CD.product_Code as Product_Name,
				CD.nature as Nature,
				CD.problem as Problem,
				CD.client_remark as Remark,
				CD.issue_raised_datetime as Issue_raised_datetime,
				convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
				CD.brief_solution as brief_solution,
				UM.username as issue_resolved_by,
				JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
				and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='ZH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
				CTCD.ctcl_isbtag as [Sub_broker],
				CD.client_code as Client_code,
				CD.product_Code as Product_Name,
				CD.nature as Nature,
				CD.problem as Problem,
				CD.client_remark as Remark,
				CD.issue_raised_datetime as Issue_raised_datetime,
				convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
				CD.brief_solution as brief_solution,
				UM.username as issue_resolved_by,
				JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
				and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='BH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
				CTCD.ctcl_isbtag as [Sub_broker],
				CD.client_code as Client_code,
				CD.product_Code as Product_Name,
				CD.nature as Nature,
				CD.problem as Problem,
				CD.client_remark as Remark,
				CD.issue_raised_datetime as Issue_raised_datetime,
				convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
				CD.brief_solution as brief_solution,
				UM.username as issue_resolved_by,
				JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
				and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime
		End
	End
	-- ================================== EBroking Product =============================== --
	Else  if(@Choice='EBro')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
				and not CD.problem is null and CD.Issue_Type='EBro'
			Order BY CD.Issue_Raised_Datetime 
		End
		Else If(@ROLE='RH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
				and not CD.problem is null and CD.Issue_Type='EBro'
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime 
		End
		Else If(@ROLE='CH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
				and not CD.problem is null and CD.Issue_Type='EBro'
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime 
		End
		Else If(@ROLE='CH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
				and not CD.problem is null and CD.Issue_Type='EBro'
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime 
		End
		Else If(@ROLE='BH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
				and not CD.problem is null and CD.Issue_Type='EBro'
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime 
		End
	End -- ================================== ALL Product =============================== --
	Else If(@Choice='ALL') 
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
					and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd

				UNION
			
				select distinct CD.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as Product_Name,
						CD.type as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
						and not CD.problem is null and CD.Issue_Type='EBro'
					
			) Temp
			Order BY Issue_Raised_Datetime 
		End
		Else If(@ROLE='RH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
					and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

				UNION
			
				select distinct CD.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as Product_Name,
						CD.type as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
					and not CD.problem is null and CD.Issue_Type='EBro'
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

			) Temp
			Order BY Issue_Raised_Datetime 
		End
		Else If(@ROLE='CH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
					and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

				UNION
			
				select distinct CD.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as Product_Name,
						CD.type as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
					and not CD.problem is null and CD.Issue_Type='EBro'
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

			) Temp
			Order BY Issue_Raised_Datetime 
		End
		Else If(@ROLE='ZH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
					and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

				UNION
			
				select distinct CD.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as Product_Name,
						CD.type as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
					and not CD.problem is null and CD.Issue_Type='EBro'
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

			) Temp
			Order BY Issue_Raised_Datetime 
		End
		Else If(@ROLE='BH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where  CD.Product_code=@Product_Name and CD.nature=@Nature and CD.Problem=@Problem
					and CD.Issue_Type ='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				UNION
			
				select distinct CD.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as Product_Name,
						CD.type as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem 
					and not CD.problem is null and CD.Issue_Type='EBro'
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

			) Temp
			Order BY Issue_Raised_Datetime 
		End
	End	
End
Else If((@period<>'' or @period<>'ALL') and @Nature<>'') -- ======================== Period  ============================== --
Begin
	-- ================================== IT Product Period Wise=============================== --
	If(@Choice='IT')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			select distinct(CD.docket_number) as Docket_Number,
					CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code,
					CD.product_Code as Product_Name,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='RH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
					CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code,
					CD.product_Code as Product_Name,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='CH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
					CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code,
					CD.product_Code as Product_Name,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='ZH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
					CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code,
					CD.product_Code as Product_Name,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='BH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,
					CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code,
					CD.product_Code as Product_Name,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime
		End
	End 
	-- ================================== EBroking Product Period Wise =============================== --
	Else if(@Choice='EBro')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
				not CD.problem is null and CD.Issue_Type='EBro'
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='RH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
				not CD.problem is null and CD.Issue_Type='EBro'
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='CH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
				not CD.problem is null and CD.Issue_Type='EBro'
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='ZH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
				not CD.problem is null and CD.Issue_Type='EBro'
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
				And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			Order BY CD.Issue_Raised_Datetime
		End
		Else If(@ROLE='BH')
		Begin
			select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
				not CD.problem is null and CD.Issue_Type='EBro'
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime
		End
	End
	-- ================================== ALL Product Period Wise =============================== --
	Else If(@Choice='ALL')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd

				UNION

				select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					'' As [Sub_broker],
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
				from tbl_newclient_details CD
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
					not CD.problem is null and CD.Issue_Type='EBro'
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
			) Temp
			Order BY Issue_Raised_Datetime 
		End
		Else If(@ROLE='RH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
					and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
					and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

				UNION

				select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					'' As [Sub_broker],
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
				from tbl_newclient_details CD
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
					not CD.problem is null and CD.Issue_Type='EBro'
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			) Temp
			Order BY Issue_Raised_Datetime
		End
		Else If(@ROLE='CH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
					and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
					and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

				UNION

				select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					'' As [Sub_broker],
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
				from tbl_newclient_details CD
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
					not CD.problem is null and CD.Issue_Type='EBro'
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			) Temp
			Order BY Issue_Raised_Datetime
		End
		Else If(@ROLE='ZH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
					and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
					and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

				UNION

				select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					'' As [Sub_broker],
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
				from tbl_newclient_details CD
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
					not CD.problem is null and CD.Issue_Type='EBro'
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
					And CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
			) Temp
			Order BY Issue_Raised_Datetime
		End
		Else If(@ROLE='BH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number,
						CD.client_code as Client_code,
						'' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker],
						CD.product_Code as Product_Name,
						'' as _Type,
						CD.nature as Nature,
						CD.problem as Problem,
						CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution,
						UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
					and CD.Problem=@Problem and CD.Product_code=@Product_Name and CD.nature =@Nature 
					and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				UNION

				select distinct CD.docket_number as Docket_Number,
					CM.client_code as Client_code,
					CM.short_name as Client_name,
					'' As [Sub_broker],
					VP.product_Name as Product_Name,
					CD.type as _Type,
					CD.nature as Nature,
					CD.problem as Problem,
					CD.client_remark as Remark,
					CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
					CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
				from tbl_newclient_details CD
					Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.product_Name=@Product_Name and CD.nature =@Nature and CD.Problem=@Problem and 
					not CD.problem is null and CD.Issue_Type='EBro'
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period)
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			) Temp
			Order BY Issue_Raised_Datetime
		End
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_ProductNatureWiseReport
-- --------------------------------------------------







CREATE proc [dbo].[usp_MIS_ProductNatureWiseReport] 
@Product_Name as varchar(100),
@Nature as nvarchar(150),
@period as varchar(50)
as

--usp_MIS_ProductNatureWiseReport 'Angel Diet','',''
--usp_MIS_ProductNatureWiseReport 'Angel Diet','Internet','30'
--usp_MIS_ProductNatureWiseReport 'Angel Diet','Internet','ALL'
declare @t as varchar(max)
declare @7t as varchar(max)
declare @30t as varchar(max)

if(@period='')
begin
	if @product_name='Odin Client' or @product_name='System'
	begin
		select @t=count(distinct(CD.Docket_number))
					from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and (cd.nature<>'' or cd.nature is not null)

		select @7t=count(distinct(CD.Docket_number))
					from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and datediff(day,cd.issue_raised_dateTime,getdate()) <8 and (cd.nature<>'' or cd.nature is not null)

		select @30t=count(distinct(CD.Docket_number))
					from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and datediff(day,cd.issue_raised_dateTime,getdate()) <31 and (cd.nature<>'' or cd.nature is not null)

		select distinct(Nature),@Product_Name as Product_Name ,sum(last_seven_Days_issues) as last_seven_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) as [Last_seven_days_issues_(%)],sum(last_thirty_Days_issues) as last_thirty_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) as [Last_thirty_days_issues_(%)],sum(Total_issues) as Total_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) as [Total_issues_(%)], 
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Minimum_Time,
		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Average_Time
		from
		(
			select 
			Nature,
			last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),
			last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0),
			Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
			Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
			from (select distinct(CD.Docket_number),CD.Client_code,isnull(Fd.nature,'Not Specified') as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time
					from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and (cd.nature<>'' or cd.nature is not null)
				  ) as temp1
			GROUP BY issue_raised_dateTime,Nature,issue_resolving_time
		) as temp group by Nature order by Nature
	end
	else
	begin
					select @t=count(distinct(CD.Docket_number))
					from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) 

					select @7t=count(distinct(CD.Docket_number))
					from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and datediff(day,cd.issue_raised_dateTime,getdate()) <8

					select @30t=count(distinct(CD.Docket_number))
					from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and datediff(day,cd.issue_raised_dateTime,getdate()) <31

		select distinct(Nature),@Product_Name as Product_Name ,sum(last_seven_Days_issues) as last_seven_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) as [Last_seven_days_issues_(%)],sum(last_thirty_Days_issues) as last_thirty_Days_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) as [Last_thirty_days_issues_(%)],sum(Total_issues) as Total_issues,CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) as [Total_issues_(%)], 
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Minimum_Time,
		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Average_Time
		from
		(
			select 
			Nature,
			last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),
			last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0),
			Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
			Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
			from (select distinct(CD.Docket_number),CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time
					from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name) and (cd.nature<>'' or cd.nature is not null)
				  ) as temp1
			GROUP BY issue_raised_dateTime,Nature,issue_resolving_time
		) as temp group by Nature order by Nature
	end
end
else if @product_name='Odin Client'or @product_name='System'
begin
	if(@period='ALL')
	begin
			select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			where tbl_NewTaskDetails.nature =@Nature  and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
	end
	else
	begin
			select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			where tbl_NewTaskDetails.nature =@Nature and datediff(day,tbl_NewTaskDetails.issue_raised_dateTime,getdate()) <= convert(int,@period)
	end
end
else if @product_name<>'Odin Client' and @product_name<>'System'
	begin
	if(@period='ALL')
	begin
		select tbl_newclient_details.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_newclient_details.type as _Type,tbl_newclient_details.nature as Nature,tbl_newclient_details.problem as Problem,tbl_newclient_details.client_remark as Remark,tbl_newclient_details.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_newclient_details.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_newclient_details 
		join (select * from vendor_product) as Product_master on tbl_newclient_details.product_code=Product_master.product_code 
		join jobstatusmaster on tbl_newclient_details.status_code=jobstatusmaster.jobstatus_id
		join client_master on client_master.client_code=tbl_newclient_details.client_code
		join MUser_Master on MUser_Master.userid=tbl_newclient_details.issue_Resolved_by
		where
		tbl_newclient_details.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		and tbl_newclient_details.nature =@Nature and not tbl_newclient_details.problem is null order by tbl_newclient_details.docket_number 
	end
	else
	begin
		select tbl_newclient_details.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_newclient_details.type as _Type,tbl_newclient_details.nature as Nature,tbl_newclient_details.problem as Problem,tbl_newclient_details.client_remark as Remark,tbl_newclient_details.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_newclient_details.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_newclient_details 
		join (select * from vendor_product) as Product_master on tbl_newclient_details.product_code=Product_master.product_code 
		join jobstatusmaster on tbl_newclient_details.status_code=jobstatusmaster.jobstatus_id
		join client_master on client_master.client_code=tbl_newclient_details.client_code
		join MUser_Master on MUser_Master.userid=tbl_newclient_details.issue_Resolved_by
		where
		tbl_newclient_details.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		and tbl_newclient_details.nature =@Nature and not tbl_newclient_details.problem is null 
		and datediff(day,tbl_newclient_details.issue_raised_dateTime,getdate()) <= convert(int,@period)
		order by tbl_newclient_details.docket_number 
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_ProductNatureWiseReport_New
-- --------------------------------------------------




CREATE proc [dbo].[usp_MIS_ProductNatureWiseReport_New]

--Created By	:Mahendra Bonde

@Product_Name as varchar(100),
@Nature as nvarchar(150),
@period as varchar(50),
@Choice As Char(10),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)


As

--usp_MIS_ProductNatureWiseReport_New 'Angel Diet','','','EBro','','',''
--usp_MIS_ProductNatureWiseReport_New 'Angel Diet','Internet','30','EBro','','',''
--usp_MIS_ProductNatureWiseReport_New 'Angel Diet','Internet','ALL','EBro','','',''

declare @t as varchar(max)
declare @7t as varchar(max)
declare @30t as varchar(max)

If ((@period='' or @Period<>'0') and @Nature='')
begin
	-- ================================== IT Product Count=============================== --
	If(@Choice='IT')
	Begin
		select @t=ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
				where cd.Product_code=@Product_Name and CD.Issue_Type='IT' and (cd.nature<>'' or cd.nature is not null) 

		Select @7t=ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
				where  cd.Product_code=@Product_Name and CD.Issue_Type='IT'
					and datediff(day,cd.issue_raised_dateTime,getdate()) <8 and (cd.nature<>'' or cd.nature is not null)

		Select @30t=ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
				where cd.Product_code=@Product_Name and CD.Issue_Type='IT'
					and datediff(day,cd.issue_raised_dateTime,getdate()) <31 and (cd.nature<>'' or cd.nature is not null)
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				select distinct(Nature),Product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(	Select Nature, Product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(
						select Nature,Product_Name, last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),	last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
						Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
						Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
						Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number), CD.Product_code As Product_Name,CD.Client_code,
								isnull(Fd.nature,'Not Specified') as nature ,
								issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
							where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='IT'
						) as temp1 GROUP BY Nature,Product_Name,issue_raised_dateTime,issue_resolving_time
					) as Temp2 group by Nature,Product_Name
				) as temp group by Nature,Product_Name 

				UNION

				Select Distinct Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				Where Nature NOT IN
				(
					Select distinct(ISNULL(Fd.nature,'Not Specified')) as Nature 
					From Tbl_newclient_details CD  
						full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
					Where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='IT'
				)
				and Product_Name=rtrim(@Product_Name)
			
			) T Order BY Total_Issues DESC
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
--				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
--				Minimum_Time, Maximum_Time, Average_Time
--			From
--			(
--				select distinct(Nature),Product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
--					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
--					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
--					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
--					sum(Total_issues) as Total_issues,
--					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
--					--minimum time
--					--Min(Total_Seconds) 
--					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
--					--maximum time
--					--Max(Total_Seconds)
--					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
--					--Average Time
--					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
--				from
--				(	Select Nature, Product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
--						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
--						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
--						ISNULL(Min(Min_Time),0) As Min_Time,
--						ISNULL(Max(Max_Time),0) As Max_Time
--					from 
--					(
--						select Nature,Product_Name, last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),	last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
--						Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
--						Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
--						Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
--						from 
--						(
--							select distinct(CD.Docket_number), CD.Product_code As Product_Name,CD.Client_code,
--								isnull(Fd.nature,'Not Specified') as nature ,
--								issue_raised_dateTime ,issue_resolving_time
--							from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
--							where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='IT'
--						) as temp1 GROUP BY Nature,Product_Name,issue_raised_dateTime,issue_resolving_time
--					) as Temp2 group by Nature,Product_Name
--				) as temp group by Nature,Product_Name 
--
--				UNION
--
--				Select Distinct Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
--					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
--					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
--				From Tbl_IT_KB_Master
--				Where Nature NOT IN
--				(
--					Select distinct(ISNULL(Fd.nature,'Not Specified')) as Nature 
--					From Tbl_newclient_details CD  
--						full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
--					Where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='IT'
--				)
--				and Product_Name=rtrim(@Product_Name)
--			
--			) T Order BY Total_Issues DESC
--		End
		Else If(@ROLE='BH')
		Begin
			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				select distinct(Nature),Product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(	Select Nature, Product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(
						select Nature,Product_Name, last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0),	last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
						Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
						Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
						Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number), CD.Product_code As Product_Name,CD.Client_code,
								isnull(Fd.nature,'Not Specified') as nature ,
								issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  
								full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
								join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
							where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) 
								and CD.Issue_Type='IT'
								and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) as temp1 GROUP BY Nature,Product_Name,issue_raised_dateTime,issue_resolving_time
					) as Temp2 group by Nature,Product_Name
				) as temp group by Nature,Product_Name 

				UNION

				Select Distinct Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From Tbl_IT_KB_Master
				Where Nature NOT IN
				(
					Select distinct(ISNULL(Fd.nature,'Not Specified')) as Nature 
					From Tbl_newclient_details CD  
						full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
						join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					Where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) 
						and CD.Issue_Type='IT'
						and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				)
				and Product_Name=rtrim(@Product_Name)
			
			) T Order BY Total_Issues DESC
		End
	end
	-- ================================== EBroking Product Count =============================== --
	else If(@Choice='EBro')
	begin
		Select @t=ISNULL(count(Distinct(docket_number)) ,0) From tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
			join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name)
			where VP.Product_Name=@Product_Name and CD.Issue_Type='EBro'

		Select @7t=ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
			join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name)
		where  VP.Product_Name=@Product_Name and datediff(day,cd.issue_raised_dateTime,getdate()) <8 and CD.Issue_Type='EBro'

		Select @30t=ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
			join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name)
		where  VP.Product_Name=@Product_Name and datediff(day,cd.issue_raised_dateTime,getdate()) <31 and CD.Issue_Type='EBro'

		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				select distinct(Nature),product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Nature, product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(
						select Nature,product_Name, 
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0), 
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0), 
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),VP.product_Name As [Product_Name],CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  
								full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
								Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='EBro'
						
						) as temp1 GROUP BY issue_raised_dateTime,Nature,product_Name,issue_resolving_time
					) as Temp2 group by Nature,product_Name
				) as temp group by Nature,product_Name 

				UNION

				Select Distinct(faq_nature) As Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where faq_nature NOT IN
				(
					Select distinct(FD.faq_nature)
					From tbl_newclient_details CD  
						Full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
					Where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='EBro'
				)
				and Product_Name=rtrim(@Product_Name)

			) T Order by Total_Issues DESC
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
--				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
--				Minimum_Time, Maximum_Time, Average_Time
--			From
--			(
--				select distinct(Nature),product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
--					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
--					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
--					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
--					sum(Total_issues) as Total_issues,
--					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
--					--minimum time
--					--Min(Total_Seconds) 
--					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
--					--maximum time
--					--Max(Total_Seconds)
--					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
--					--Average Time
--					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
--				from
--				(
--					Select Nature, product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
--						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
--						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
--						ISNULL(Min(Min_Time),0) As Min_Time,
--						ISNULL(Max(Max_Time),0) As Max_Time
--					from 
--					(
--						select Nature,product_Name, 
--							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0), 
--							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), 
--							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0), 
--							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
--							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
--							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
--						from 
--						(
--							select distinct(CD.Docket_number),VP.product_Name As [Product_Name],CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
--							from tbl_newclient_details CD  
--								full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--								Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
--							where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='EBro'
--						
--						) as temp1 GROUP BY issue_raised_dateTime,Nature,product_Name,issue_resolving_time
--					) as Temp2 group by Nature,product_Name
--				) as temp group by Nature,product_Name 
--
--				UNION
--
--				Select Distinct(faq_nature) As Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
--					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
--					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
--				From faq_details
--				Where faq_nature NOT IN
--				(
--					Select distinct(FD.faq_nature)
--					From tbl_newclient_details CD  
--						Full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
--					Where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='EBro'
--				)
--				and Product_Name=rtrim(@Product_Name)
--
--			) T Order by Total_Issues DESC
--		End
		Else If(@ROLE='BH')
		Begin
			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				select distinct(Nature),product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Nature, product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(
						select Nature,product_Name, 
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0), 
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0), 
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),VP.product_Name As [Product_Name],CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  
								full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
								Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
								join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
							where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) 
								and CD.Issue_Type='EBro'
								and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						
						) as temp1 GROUP BY issue_raised_dateTime,Nature,product_Name,issue_resolving_time
					) as Temp2 group by Nature,product_Name
				) as temp group by Nature,product_Name 

				UNION

				Select Distinct(faq_nature) As Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
					'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
					'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
				From faq_details
				Where faq_nature NOT IN
				(
					Select distinct(FD.faq_nature)
					From tbl_newclient_details CD  
						Full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
						Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
					Where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) 
						and CD.Issue_Type='EBro'
						and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				)
				and Product_Name=rtrim(@Product_Name)

			) T Order by Total_Issues DESC
		End
	end
	-- ====================================== ALL Product Count ===========================--
	else If(@Choice='ALL')
	begin
		Set @t = (select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where VP.Product_Name=@Product_Name and CD.Issue_Type='EBro') 
					+
				 (select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where cd.Product_code=@Product_Name and CD.Issue_Type='IT' and (cd.nature<>'' or cd.nature is not null))

		Set @7t= (Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name ) FD on CD.nature=FD.faq_nature join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where VP.Product_Name=@Product_Name and CD.Issue_Type='EBro' and datediff(day,cd.issue_raised_dateTime,getdate()) <8)
					+ 
				 (select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where cd.Product_code=@Product_Name and CD.Issue_Type='IT' and datediff(day,cd.issue_raised_dateTime,getdate()) <8 and (cd.nature<>'' or cd.nature is not null))

		Set @30t= (Select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where VP.Product_Name=@Product_Name and CD.Issue_Type='EBro' and datediff(day,cd.issue_raised_dateTime,getdate()) <31) 
					+
				  (select ISNULL(count(Distinct(docket_number)) ,0) from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature join Vendor_Product VP On (CD.Product_Code=VP.Product_Code or CD.product_Code=VP.Product_Name) where cd.Product_code=@Product_Name and CD.Issue_Type='IT' and datediff(day,cd.issue_raised_dateTime,getdate()) <31 and (cd.nature<>'' or cd.nature is not null))

		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				select distinct(Nature),Product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Nature, Product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(
						select Nature,Product_Name,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0), 
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from
						(
							select distinct(CD.Docket_number),VP.product_Name As [Product_Name],CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  
								full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
								Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='EBro'
						
							Union	
				
							select distinct(CD.Docket_number),Product_code As [Product_Name],CD.Client_code,
										isnull(Fd.nature,'Not Specified') as nature ,
										issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
							where  cd.Product_code=@Product_Name and CD.Issue_Type='IT' and (cd.nature<>'' or cd.nature is not null)
						) as temp1 GROUP BY issue_raised_dateTime,Nature,Product_Name,issue_resolving_time
					) as Temp2 group by Nature,Product_Name
				) as temp group by Nature,Product_Name 

				UNION

				Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
					Minimum_Time, Maximum_Time, Average_Time
				From
				(	
					Select Distinct(faq_nature) As Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where faq_nature NOT IN
					(
						Select distinct(FD.faq_nature)
						From tbl_newclient_details CD  
							Full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
						Where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) 
							and CD.Issue_Type='EBro'
					)
					and Product_Name=rtrim(@Product_Name)
					
					UNION

					Select Distinct Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					Where Nature NOT IN
					(
						Select distinct(ISNULL(Fd.nature,'Not Specified')) as Nature 
						From Tbl_newclient_details CD  
							full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
						Where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) 
							and CD.Issue_Type='IT'
					)
					and Product_Name=rtrim(@Product_Name)

				) Temp
				
			) T Order by Total_Issues DESC
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
--				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
--				Minimum_Time, Maximum_Time, Average_Time
--			From
--			(
--				select distinct(Nature),Product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
--					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
--					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
--					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
--					sum(Total_issues) as Total_issues,
--					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
--					--minimum time
--					--Min(Total_Seconds) 
--					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
--					--maximum time
--					--Max(Total_Seconds)
--					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
--					--Average Time
--					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
--				from
--				(
--					Select Nature, Product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
--						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
--						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
--						ISNULL(Min(Min_Time),0) As Min_Time,
--						ISNULL(Max(Max_Time),0) As Max_Time
--					from 
--					(
--						select Nature,Product_Name,
--							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0), 
--							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), 
--							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
--							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
--							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
--							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
--						from
--						(
--							select distinct(CD.Docket_number),VP.product_Name As [Product_Name],CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
--							from tbl_newclient_details CD  
--								full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--								Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
--							where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) and CD.Issue_Type='EBro'
--						
--							Union	
--				
--							select distinct(CD.Docket_number),Product_code As [Product_Name],CD.Client_code,
--										isnull(Fd.nature,'Not Specified') as nature ,
--										issue_raised_dateTime ,issue_resolving_time
--							from tbl_newclient_details CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
--							where  cd.Product_code=@Product_Name and CD.Issue_Type='IT' and (cd.nature<>'' or cd.nature is not null)
--						) as temp1 GROUP BY issue_raised_dateTime,Nature,Product_Name,issue_resolving_time
--					) as Temp2 group by Nature,Product_Name
--				) as temp group by Nature,Product_Name 
--
--				UNION
--
--				Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
--					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
--					Minimum_Time, Maximum_Time, Average_Time
--				From
--				(	
--					Select Distinct(FD.faq_nature) As Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
--						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
--						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
--					From faq_details
--					Where faq_nature NOT IN
--					(
--						Select distinct(FD.faq_nature)
--						From tbl_newclient_details CD  
--							Full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
--						Where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) 
--							and CD.Issue_Type='EBro'
--					)
--					and Product_Name=rtrim(@Product_Name)
--					
--					UNION
--
--					Select Distinct Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
--						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
--						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
--					From Tbl_IT_KB_Master
--					Where Nature NOT IN
--					(
--						Select distinct(ISNULL(Fd.nature,'Not Specified')) as Nature 
--						From Tbl_newclient_details CD  
--							full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
--						Where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) 
--							and CD.Issue_Type='IT'
--					)
--					and Product_Name=rtrim(@Product_Name)
--
--				) Temp
--				
--			) T Order by Total_Issues DESC
--		End
		Else If(@ROLE='BH')
		Begin
			Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
				Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
				Minimum_Time, Maximum_Time, Average_Time
			From
			(
				select distinct(Nature),Product_Name,sum(last_seven_Days_issues) as last_seven_Days_issues,
					[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
					sum(last_thirty_Days_issues) as last_thirty_Days_issues,
					[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
					sum(Total_issues) as Total_issues,
					[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
					--minimum time
					--Min(Total_Seconds) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Total_Seconds)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Nature, Product_Name, sum(last_seven_Days_issues) As last_seven_Days_issues, 
						sum(last_thirty_Days_issues) As last_thirty_Days_issues, sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(
						select Nature,Product_Name,
							last_seven_Days_issues=isnull(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <8  THEN count(temp1.Docket_number) END,0), 
							last_thirty_Days_issues=ISNULL(CASE WHEN datediff(day,temp1.issue_raised_dateTime,getdate()) <31  THEN count(temp1.Docket_number)  END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from
						(
							select distinct(CD.Docket_number),VP.product_Name As [Product_Name],CD.Client_code,isnull(Fd.faq_Nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  
								full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
								Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
								join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
							where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) 
								and CD.Issue_Type='EBro'
								and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						
							Union	
				
							select distinct(CD.Docket_number),Product_code As [Product_Name],CD.Client_code,
								isnull(Fd.nature,'Not Specified') as nature ,issue_raised_dateTime ,issue_resolving_time
							from tbl_newclient_details CD  
								full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.Nature
								join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
							where  cd.Product_code=@Product_Name and CD.Issue_Type='IT' 
								and (cd.nature<>'' or cd.nature is not null)
								and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) as temp1 GROUP BY issue_raised_dateTime,Nature,Product_Name,issue_resolving_time
					) as Temp2 group by Nature,Product_Name
				) as temp group by Nature,Product_Name 

				UNION

				Select Nature, Product_Name, Last_Seven_Days_Issues, [Last_Seven_Days_Issues_(%)],
					Last_Thirty_Days_Issues, [Last_Thirty_Days_Issues_(%)], Total_Issues, [Total_Issues_(%)],
					Minimum_Time, Maximum_Time, Average_Time
				From
				(	
					Select Distinct(faq_nature) As Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From faq_details
					Where faq_nature NOT IN
					(
						Select distinct(FD.faq_nature)
						From tbl_newclient_details CD  
							Full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
							Join Vendor_Product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_Name)
							join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						Where  VP.Product_Name=@Product_Name and (cd.nature<>'' or cd.nature is not null) 
							and CD.Issue_Type='EBro'
							and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
					)
					and Product_Name=rtrim(@Product_Name)
					
					UNION

					Select Distinct Nature, Product_Name, '0' As Last_Seven_Days_Issues, '0' As [Last_Seven_Days_Issues_(%)],
						'0' As Last_Thirty_Days_Issues, '0' As [Last_Thirty_Days_Issues_(%)], '0' As Total_Issues, '0' As [Total_Issues_(%)],
						'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time
					From Tbl_IT_KB_Master
					Where Nature NOT IN
					(
						Select distinct(ISNULL(Fd.nature,'Not Specified')) as Nature 
						From Tbl_newclient_details CD  
							full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=rtrim(@Product_Name)) FD on CD.nature=FD.Nature
							join MUser_Master UM On CD.Issue_Resolved_BY=UM.UserID
						Where  cd.Product_code=rtrim(@Product_Name) and (cd.nature<>'' or cd.nature is not null) 
							and CD.Issue_Type='IT'
							and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
					)
					and Product_Name=rtrim(@Product_Name)

				) Temp
				
			) T Order by Total_Issues DESC
		End
	end
end
Else if @period='ALL'  -- ======================== Period ALL ============================== --
Begin
	-- ================================== IT Product =============================== --
	if(@Choice='IT')
	begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			select distinct(CD.docket_number) as Docket_Number,	CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code, CD.product_Code as product_name, CD.nature as Nature,
					CD.problem as Problem, CD.client_remark as Remark, 	CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where CD.nature =@Nature and CD.Product_code=@Product_Name and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
			Order BY CD.Issue_Raised_Datetime 
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(CD.docket_number) as Docket_Number,	CTCD.ctcl_isbtag as [Sub_broker],
--					CD.client_code as Client_code, CD.product_Code as product_name, CD.nature as Nature,
--					CD.problem as Problem, CD.client_remark as Remark, 	CD.issue_raised_datetime as Issue_raised_datetime,
--					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
--					CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
--			from tbl_NewTaskDetails CD
--				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
--				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
--			where CD.nature =@Nature and CD.Product_code=@Product_Name and CD.Issue_Type='IT'
--			Order BY CD.Issue_Raised_Datetime 
--		End
		Else If(@ROLE='BH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,	CTCD.ctcl_isbtag as [Sub_broker],
					CD.client_code as Client_code, CD.product_Code as product_name, CD.nature as Nature,
					CD.problem as Problem, CD.client_remark as Remark, 	CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
					CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where CD.nature =@Nature and CD.Product_code=@Product_Name and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime 
		End
	end
	-- ================================== EBroking Product =============================== --
	Else if(@Choice='EBro')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			select distinct CD.docket_number as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
					VP.product_name as product_name, CD.type as _Type, CD.nature as Nature,
					CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time, UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
				join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
					and CD.Issue_Type='EBro'
			Order BY CD.Issue_Raised_Datetime  
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct CD.docket_number as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
--					VP.product_name as product_name, CD.type as _Type, CD.nature as Nature,
--					CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
--					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time, UM.username as issue_resolved_by,
--					JS.jobstatus_name as Status
--			from tbl_newclient_details CD 
--				full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--				join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name)
--				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
--				join client_master CM on CM.client_code=CD.client_code
--				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
--			where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
--					and CD.Issue_Type='EBro'
--			Order BY CD.Issue_Raised_Datetime  
--		End
		Else If(@ROLE='BH')
		Begin
			select distinct CD.docket_number as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
					VP.product_name as product_name, CD.type as _Type, CD.nature as Nature,
					CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time, UM.username as issue_resolved_by,
					JS.jobstatus_name as Status
			from tbl_newclient_details CD 
				full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
				join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name)
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
				and CD.Issue_Type='EBro'
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime  
		End
	End
	ELse If(@Choice='ALL')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number, CD.client_code as Client_code, '' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker], CD.product_Code as product_name, '' as _Type,
						CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where CD.nature =@Nature and CD.Product_code=@Product_Name and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd

				UNION 

				select distinct CD.docket_number as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
						'' As [Sub_broker], VP.product_name as product_name, CD.type as _Type,
						CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
					join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
						and CD.Issue_Type='EBro'
				
			) Temp
			Order BY Issue_raised_datetime 
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
--					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
--			from
--			(
--				select distinct(CD.docket_number) as Docket_Number, CD.client_code as Client_code, '' As Client_name,
--						CTCD.ctcl_isbtag as [Sub_broker], CD.product_Code as product_name, '' as _Type,
--						CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark,
--						CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
--						CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
--				from tbl_NewTaskDetails CD
--					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
--					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
--					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
--					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
--				where CD.nature =@Nature and CD.Product_code=@Product_Name and CD.Issue_Type='IT'
--
--				UNION 
--
--				select distinct CD.docket_number as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
--						'' As [Sub_broker], VP.product_name as product_name, CD.type as _Type,
--						CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark,
--						CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
--						CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
--				from tbl_newclient_details CD 
--					full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--					join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name) 
--					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
--					join client_master CM on CM.client_code=CD.client_code
--					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
--				where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
--						and CD.Issue_Type='EBro'
--				
--			) Temp
--			Order BY Issue_raised_datetime 
--		End
		Else If(@ROLE='BH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number, CD.client_code as Client_code, '' As Client_name,
						CTCD.ctcl_isbtag as [Sub_broker], CD.product_Code as product_name, '' as _Type,
						CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,
						CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id 
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag 
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where CD.nature =@Nature and CD.Product_code=@Product_Name and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				UNION 

				select distinct CD.docket_number as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
						'' As [Sub_broker], VP.product_name as product_name, CD.type as _Type,
						CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark,
						CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time,
						CD.brief_solution as brief_solution, UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_newclient_details CD 
					full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
					join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name) 
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
					and CD.Issue_Type='EBro'
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				
			) Temp
			Order BY Issue_raised_datetime 
		End
	End
End
Else  if((@Period<>'' and @Period<>'ALL') and @Nature<>'') -- ======================== Period  ============================== --
Begin
	-- ================================== IT Product =============================== --
	if(@Choice='IT')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			select distinct(CD.docket_number) as Docket_Number,CTCD.ctcl_isbtag as [Sub_broker],CD.client_code as Client_code,CD.product_Code as product_name,CD.nature as Nature,CD.problem as Problem,CD.client_remark as Remark,CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time, CD.brief_solution as brief_solution,UM.username as issue_resolved_by,JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where CD.nature =@Nature and CD.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
			Order BY CD.Issue_Raised_Datetime 
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(CD.docket_number) as Docket_Number,CTCD.ctcl_isbtag as [Sub_broker],CD.client_code as Client_code,CD.product_Code as product_name,CD.nature as Nature,CD.problem as Problem,CD.client_remark as Remark,CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time, CD.brief_solution as brief_solution,UM.username as issue_resolved_by,JS.jobstatus_name as Status
--			from tbl_NewTaskDetails CD
--				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
--				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
--				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
--				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
--			where CD.nature =@Nature and CD.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
--				and CD.Issue_Type='IT'
--			Order BY CD.Issue_Raised_Datetime
--		End
		Else If(@ROLE='BH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,CTCD.ctcl_isbtag as [Sub_broker],CD.client_code as Client_code,CD.product_Code as product_name,CD.nature as Nature,CD.problem as Problem,CD.client_remark as Remark,CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time, CD.brief_solution as brief_solution,UM.username as issue_resolved_by,JS.jobstatus_name as Status
			from tbl_NewTaskDetails CD
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
				join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
				join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
			where CD.nature =@Nature and CD.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
				and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime
		End
	End
	-- ================================== EBroking Product =============================== --
	Else if(@Choice='EBro')
	begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin 
			select distinct(CD.docket_number) as Docket_Number,CM.client_code as Client_code,CM.short_name as Client_name,
				VP.product_name as product_name,CD.type as _Type,CD.nature as Nature,CD.problem as Problem,CD.client_remark as Remark,CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,UM.username as issue_resolved_by,JS.jobstatus_name as Status
			from tbl_newclient_details CD
				full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
				join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) and CD.Issue_Type='EBro'
			Order BY CD.Issue_Raised_Datetime  
		End
--		Else If(@ROLE='RH')
--		Begin
--			select distinct(CD.docket_number) as Docket_Number,CM.client_code as Client_code,CM.short_name as Client_name,
--				VP.product_name as product_name,CD.type as _Type,CD.nature as Nature,CD.problem as Problem,CD.client_remark as Remark,CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,UM.username as issue_resolved_by,JS.jobstatus_name as Status
--			from tbl_newclient_details CD
--				full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
--				join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name) 
--				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
--				join client_master CM on CM.client_code=CD.client_code
--				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
--			where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
--				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) and CD.Issue_Type='EBro'
--			Order BY CD.Issue_Raised_Datetime  
--		End
		Else If(@ROLE='BH')
		Begin
			select distinct(CD.docket_number) as Docket_Number,CM.client_code as Client_code,CM.short_name as Client_name,
				VP.product_name as product_name,CD.type as _Type,CD.nature as Nature,CD.problem as Problem,CD.client_remark as Remark,CD.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time,UM.username as issue_resolved_by,JS.jobstatus_name as Status
			from tbl_newclient_details CD
				full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
				join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name) 
				join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
				join client_master CM on CM.client_code=CD.client_code
				join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
			where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
				and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) and CD.Issue_Type='EBro'
				and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
			Order BY CD.Issue_Raised_Datetime  
		End
	end
	Else If(@Choice='ALL')
	Begin
		If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number, CD.client_code as Client_code, '' As Client_name,
					CTCD.ctcl_isbtag as [Sub_broker], CD.product_Code as product_name, '' as _Type,
					CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time, CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where CD.nature =@Nature and CD.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
					and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd

				UNION

				select Distinct (CD.docket_number) as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
					'' As [Sub_broker], VP.product_name as product_name, CD.type as _Type, CD.nature as Nature,
					CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time, CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_newclient_details CD
					full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature				
					join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) and CD.Issue_Type='EBro'
			) Temp
			Order BY Issue_raised_datetime
		End
--		Else If(@ROLE='RH')
--		Begin
--			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
--					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
--			from
--			(
--				select distinct(CD.docket_number) as Docket_Number, CD.client_code as Client_code, '' As Client_name,
--					CTCD.ctcl_isbtag as [Sub_broker], CD.product_Code as product_name, '' as _Type,
--					CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
--					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time, CD.brief_solution as brief_solution,
--					UM.username as issue_resolved_by, JS.jobstatus_name as Status
--				from tbl_NewTaskDetails CD
--					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
--					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
--					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
--					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
--				where CD.nature =@Nature and CD.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
--					and CD.Issue_Type='IT'
--
--				UNION
--
--				select Distinct (CD.docket_number) as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
--					'' As [Sub_broker], VP.product_name as product_name, CD.type as _Type, CD.nature as Nature,
--					CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
--					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time, CD.brief_solution as brief_solution,
--					UM.username as issue_resolved_by, JS.jobstatus_name as Status
--				from tbl_newclient_details CD
--					full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature				
--					join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name)
--					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
--					join client_master CM on CM.client_code=CD.client_code
--					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
--				where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
--					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) and CD.Issue_Type='EBro'
--			) Temp
--			Order BY Issue_raised_datetime
--		End
		Else If(@ROLE='BH')
		Begin
			Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
			from
			(
				select distinct(CD.docket_number) as Docket_Number, CD.client_code as Client_code, '' As Client_name,
					CTCD.ctcl_isbtag as [Sub_broker], CD.product_Code as product_name, '' as _Type,
					CD.nature as Nature, CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8)  as Resolution_time, CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_NewTaskDetails CD
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join ctcl_details CTCD on CD.client_code=CTCD.ctcl_odinid
					join view_subbroker VS on VS.tag=CTCD.ctcl_isbtag
					join MUser_Master UM on CD.Issue_Resolved_BY=UM.userid 
				where CD.nature =@Nature and CD.Product_code=@Product_Name and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) 
					and CD.Issue_Type='IT' and CD.tagbranch=CTCD.ctcl_ibranch_cd
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				UNION

				select Distinct (CD.docket_number) as Docket_Number, CM.client_code as Client_code, CM.short_name as Client_name,
					'' As [Sub_broker], VP.product_name as product_name, CD.type as _Type, CD.nature as Nature,
					CD.problem as Problem, CD.client_remark as Remark, CD.issue_raised_datetime as Issue_raised_datetime,
					convert(varchar(22),CD.issue_resolving_time,8) as Resolution_time, CD.brief_solution as brief_solution,
					UM.username as issue_resolved_by, JS.jobstatus_name as Status
				from tbl_newclient_details CD
					full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature				
					join vendor_product VP on (CD.product_code=VP.product_code or CD.product_code=VP.product_name)
					join jobstatusmaster JS on CD.status_code=JS.jobstatus_id
					join client_master CM on CM.client_code=CD.client_code
					join MUser_Master UM on UM.userid=CD.Issue_Resolved_BY
				where VP.Product_Name=@Product_Name	and CD.nature =@Nature and not CD.problem is null 
					and datediff(day,CD.issue_raised_dateTime,getdate()) <= convert(int,@period) and CD.Issue_Type='EBro'
					and CD.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

			) Temp
			Order BY Issue_raised_datetime
		End
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_ProductwiseEmpPerformance
-- --------------------------------------------------





--exec usp_MIS_ProductwiseEmpPerformance '','','E05109','angel diet','Connection Busy Error','PNWI'


CREATE proc [dbo].[usp_MIS_ProductwiseEmpPerformance] 
--Author	:	Sanjay Lavu Kudtarkar
@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@EmpId as varchar(20),
@Product_Name as varchar(100),
@Nature as nvarchar(150),
@period as varchar(50)
as
if(@period='' and @Nature='')
begin
	if @Product_Name='Odin Client' or @Product_Name='System'
		begin
		if @FromDate='' and @ToDate=''
			begin
			select distinct(tmp1.nature),tmp1.*,tmp2.* from 
			(select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
			--minimum time
			--Min(Total_Seconds) 
			isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Maximum_Time,  

			--Average Time
			isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
			as Default_Average_Time
			from
			(
				select 
				Nature,issue_resolved_by,username,
				Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate())   THEN count(temp1.Docket_number) END,0),
				Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
				Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
				from (select distinct(CD.Docket_number),MUser_Master.username,CD.Client_code,Fd.nature as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
						from tbl_NewTaskDetails CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.nature 
						join MUser_Master on 
						MUser_Master.userid=cd.issue_resolved_by
						where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
					  ) as temp1
				GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
			) as temp GROUP BY Nature,issue_resolved_by,username,nature
			) as Tmp1 
			join
			(	
				select  distinct(nature) as nature,issue_resolved_by1,
				--minimum time
				--Min(Total_Seconds) 
				isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Minimum_Time,

				--maximum time
				--Max(Total_Seconds)
				isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Maximum_Time,  

				--Average Time
				isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
				as Average_Time
				from
				(
				select 
				product_name,issue_Resolved_by as issue_Resolved_by1,nature,
				Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
				from 
				(
				select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,tbl_NewTaskDetails.issue_resolved_by,vendor_product.product_name ,tbl_NewTaskDetails.nature
				from tbl_NewTaskDetails join vendor_product
				on tbl_NewTaskDetails.product_code=tbl_NewTaskDetails.product_code
				where tbl_NewTaskDetails.Product_code in (select distinct(Product_code) from vendor_product where product_Name=@Product_Name) --@Product_Name
				) 
				as temp group  by Total_Seconds_Productwise,issue_resolved_by,product_name,nature
				) as Temp2 group by product_name,issue_Resolved_by1,nature
				) as Tmp2 
				on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId
			end
			else
			begin
			select tmp1.*,tmp2.* from 
			(
			select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
			--minimum time
			--Min(Total_Seconds) 
			isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Maximum_Time,  

			--Average Time
			isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
			as Default_Average_Time
			from
			(
				select 
				Nature,issue_resolved_by,username,
				Periodic_Issues=isnull(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(temp1.Docket_number) END,0),
				Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
				Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
				from (select distinct(CD.Docket_number),CD.Client_code,MUser_Master.username,Fd.nature as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
						from tbl_NewTaskDetails CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.nature
						join MUser_Master on MUser_Master.userid=cd.issue_resolved_by
						where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
					  ) as temp1
				GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
			) as temp group by Nature,issue_resolved_by,username ,nature
			) as Tmp1 
			join(
			select  distinct(nature) as nature,issue_resolved_by1,
				--minimum time
				--Min(Total_Seconds) 
				isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Minimum_Time,

				--maximum time
				--Max(Total_Seconds)
				isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Maximum_Time,  

				--Average Time
				isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
				as Average_Time
				from
				(
				select 
				issue_Resolved_by as issue_Resolved_by1,nature,
				Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
				from 
				(
				select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,tbl_NewTaskDetails.issue_resolved_by,vendor_product.product_name ,tbl_NewTaskDetails.nature
				from tbl_NewTaskDetails join vendor_product
				on tbl_NewTaskDetails.product_code=tbl_NewTaskDetails.product_code
				where tbl_NewTaskDetails.Product_code in (select distinct(Product_code) from vendor_product where product_Name=@Product_Name) --@Product_Name
				) 
				as temp group  by Total_Seconds_Productwise,issue_resolved_by,nature
				) as Temp2 group by issue_Resolved_by1,nature
				) as Tmp2 
				on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId
			end
		end
	else
		begin
			if @FromDate='' and @ToDate=''
			begin
			select distinct(tmp1.nature),tmp1.*,tmp2.* from 
			(select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
			--minimum time
			--Min(Total_Seconds) 
			isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Maximum_Time,  

			--Average Time
			isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
			as Default_Average_Time
			from
			(
				select 
				Nature,issue_resolved_by,username,
				Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate())  THEN count(temp1.Docket_number) END,0),
				Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
				Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
				from (select distinct(CD.Docket_number),MUser_Master.username,CD.Client_code,Fd.faq_nature as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
						from tbl_NewTaskDetails CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature 
						join MUser_Master on 
						MUser_Master.userid=cd.issue_resolved_by
						where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
					  ) as temp1
				GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
			) as temp GROUP BY Nature,issue_resolved_by,username,nature
			) as Tmp1 
			join
			(	
				select  distinct(nature) as nature,issue_resolved_by1,
				--minimum time
				--Min(Total_Seconds) 
				isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Minimum_Time,

				--maximum time
				--Max(Total_Seconds)
				isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Maximum_Time,  

				--Average Time
				isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
				as Average_Time
				from
				(
				select 
				product_name,issue_Resolved_by as issue_Resolved_by1,nature,
				Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
				from 
				(
				select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,tbl_NewTaskDetails.issue_resolved_by,vendor_product.product_name ,tbl_NewTaskDetails.nature
				from tbl_NewTaskDetails join vendor_product
				on tbl_NewTaskDetails.product_code=tbl_NewTaskDetails.product_code
				where tbl_NewTaskDetails.Product_code in (select distinct(Product_code) from vendor_product where product_Name=@Product_Name) --@Product_Name
				) 
				as temp group  by Total_Seconds_Productwise,issue_resolved_by,product_name,nature
				) as Temp2 group by product_name,issue_Resolved_by1,nature
				) as Tmp2 
				on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId
			end
			else
			begin
			select tmp1.*,tmp2.* from 
			(
			select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
			--minimum time
			--Min(Total_Seconds) 
			isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Maximum_Time,  

			--Average Time
			isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
			as Default_Average_Time
			from
			(
				select 
				Nature,issue_resolved_by,username,
				Periodic_Issues=isnull(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(temp1.Docket_number) END,0),
				Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
				Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
				from (select distinct(CD.Docket_number),CD.Client_code,MUser_Master.username,Fd.faq_nature as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
						from tbl_NewTaskDetails CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
						join MUser_Master on MUser_Master.userid=cd.issue_resolved_by
						where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
					  ) as temp1
				GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
			) as temp group by Nature,issue_resolved_by,username ,nature
			) as Tmp1 
			join(
			select  distinct(nature) as nature,issue_resolved_by1,
			--minimum time
			--Min(Total_Seconds) 
			isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Maximum_Time,  

			--Average Time
			isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
			as Average_Time
			from
			(
			select 
			issue_Resolved_by as issue_Resolved_by1,nature,
			Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
			from 
			(
			select tbl_NewTaskDetails.issue_resolving_time as Total_Seconds_Productwise,tbl_NewTaskDetails.issue_resolved_by,vendor_product.product_name ,tbl_NewTaskDetails.nature
			from tbl_NewTaskDetails join vendor_product
			on tbl_NewTaskDetails.product_code=tbl_NewTaskDetails.product_code
			where tbl_NewTaskDetails.Product_code in (select distinct(Product_code) from vendor_product where product_Name=@Product_Name) --@Product_Name
			) 
			as temp group  by Total_Seconds_Productwise,issue_resolved_by,nature
			) as Temp2 group by issue_Resolved_by1,nature
			) as Tmp2 
			on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId
		end
	end
end
---------------------------------------------Nature--------------------------------------------
else if (@period='' and @Nature<>'')
	if @product_name='Odin Client'  or @Product_Name='System'
	begin
		if @FromDate='' and @ToDate=''
		begin
			select distinct(tmp1.problem),tmp1.*,tmp2.* from 
			(
			select distinct(problem),issue_resolved_by,@product_name as product_name,Nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
			--minimum time
				--Min(Total_Seconds) 
				isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
				+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
				+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
				as Default_Minimum_Time,

				--maximum time
				--Max(Total_Seconds)
				isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
				+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
				+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
				as Default_Maximum_Time,  

				--Average Time
				isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
				+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
				+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
				as Default_Average_Time
				from
				(
					select 
					problem,issue_resolved_by ,nature, 
					Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate())  THEN count(temp1.Docket_number) END,0),
					Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
					Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
					from (
							select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem ,cd.nature as nature,Product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by 
							from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
							where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
						) as temp1
					GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
				) as temp group by  problem,issue_resolved_by,nature having not problem is null  
				) as Tmp1 
				join
				(	
				select  issue_resolved_by1,nature,problem,
				--minimum time
				--Min(Total_Seconds) 
				isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Minimum_Time,

				--maximum time
				--Max(Total_Seconds)
				isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Maximum_Time,  

				--Average Time
				isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
				as Average_Time
				from
				(
				select 
				distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
				Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
				from 
				(
				select issue_resolving_time as Total_Seconds_Productwise,issue_resolved_by,nature,problem
				from tbl_NewTaskDetails
				where nature=@Nature --@Product_Name
				) 
				as temp group  by Total_Seconds_Productwise,issue_resolved_by,nature,problem
				) as Temp2 group by issue_resolved_by1,nature,problem
				) as Tmp2 
				on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId
			end
			else
			begin

			select tmp1.*,tmp2.* from 
			(
			select distinct(problem),issue_resolved_by,@Product_Name as Product_name,nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
			--minimum time
			--Min(Total_Seconds) 
			isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
			as Default_Maximum_Time,  

			--Average Time
			isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
			+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
			as Default_Average_Time
			from
			(
				select 
				problem,issue_resolved_by,nature,
				Periodic_Issues=isnull(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(temp1.Docket_number) END,0),
				Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
				Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
				from (
						select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem,cd.nature as nature ,Product_name,issue_raised_dateTime,issue_resolving_time,issue_Resolved_by 
						from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
						where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
					) as temp1
				GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
			) as temp group by  problem,issue_resolved_by,nature having not problem is null  
			) as Tmp1 
			join
			(	
				select  issue_resolved_by1,nature,problem,
				--minimum time
				--Min(Total_Seconds) 
				isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
				+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Minimum_Time,

				--maximum time
				--Max(Total_Seconds)
				isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
				as Maximum_Time,  

				--Average Time
				isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
				+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
				as Average_Time
				from
				(
				select 
				distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
				Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
				from 
				(
				select issue_resolving_time as Total_Seconds_Productwise,issue_resolved_by ,nature,problem
				from tbl_NewTaskDetails
				where nature =@Nature --@Product_Name
				) 
				as temp group by Total_Seconds_Productwise,issue_resolved_by,nature,problem
				) as Temp2 group by issue_resolved_by1,nature,problem
				) as Tmp2 
				on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId
			end
		end
	else
	begin
if @FromDate='' and @ToDate=''
	begin
	select distinct(tmp1.problem),tmp1.*,tmp2.* from 
	(
	select distinct(problem),issue_resolved_by,@product_name as product_name,Nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
	--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Minimum_Time,

		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Default_Average_Time
		from
		(
			select 
			problem,issue_resolved_by ,nature, 
			Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) THEN count(temp1.Docket_number) END,0),
			Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
			Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
			from (
					select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem ,cd.nature as nature,Product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by 
					from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
				) as temp1
			GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
		) as temp group by  problem,issue_resolved_by,nature having not problem is null  
		) as Tmp1 
		join
		(	
			select  issue_resolved_by1,nature,problem,
			--minimum time
			--Min(Total_Seconds) 
			isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Maximum_Time,  

			--Average Time
			isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
			as Average_Time
			from
			(
			select 
			distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
			Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
			from 
			(
			select issue_resolving_time as Total_Seconds_Productwise,issue_resolved_by,nature,problem
			from tbl_NewTaskDetails
			where nature=@Nature --@Product_Name
			) 
			as temp group  by Total_Seconds_Productwise,issue_resolved_by,nature,problem
			) as Temp2 group by issue_resolved_by1,nature,problem
			) as Tmp2 
			on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId
	end
	else
	begin
		select tmp1.*,tmp2.* from 
		(
		select distinct(problem),issue_resolved_by,@Product_Name as Product_name,nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
		--minimum time
		--Min(Total_Seconds) 
		isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Minimum_Time,

		--maximum time
		--Max(Total_Seconds)
		isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
		as Default_Maximum_Time,  

		--Average Time
		isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
		+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
		as Default_Average_Time
		from
		(
			select 
			problem,issue_resolved_by,nature,
			Periodic_Issues=isnull(CASE WHEN issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) THEN count(temp1.Docket_number) END,0),
			Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
			Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
			from (
					select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem,cd.nature as nature ,Product_name,issue_raised_dateTime,issue_resolving_time,issue_Resolved_by 
					from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
					where  cd.Product_code in(select distinct(Product_code) from vendor_product where product_Name=@Product_Name and cd.issue_resolved_by=@EmpId) 
				) as temp1
			GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
		) as temp group by  problem,issue_resolved_by,nature having not problem is null  
		) as Tmp1 
		join
		(	
			select  issue_resolved_by1,nature,problem,
			--minimum time
			--Min(Total_Seconds) 
			isnull(left(convert(nvarchar,Min(Total_Seconds)/3600,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%3600)/60,120),2)
			+ ':' +left( convert(nvarchar,(Min(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Minimum_Time,

			--maximum time
			--Max(Total_Seconds)
			isnull(left(convert(nvarchar,Max(Total_Seconds)/3600,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(Max(Total_Seconds)%60)%60,120),2),'00:00:00')
			as Maximum_Time,  

			--Average Time
			isnull(left(convert(nvarchar,(avg(Total_Seconds)/3600),120) ,2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%3600)/60,120),2)
			+ ':' + left(convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,2),'00:00:00')
			as Average_Time
			from
			(
			select 
			distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
			Total_Seconds=DATEPART(hh,Total_Seconds_Productwise)*60*60 + DATEPART(mi,Total_Seconds_Productwise)*60 + DATEPART(ss,Total_Seconds_Productwise)
			from 
			(
			select issue_resolving_time as Total_Seconds_Productwise,issue_resolved_by ,nature,problem
			from tbl_NewTaskDetails
			where nature =@Nature --@Product_Name
			) 
			as temp group by Total_Seconds_Productwise,issue_resolved_by,nature,problem
			) as Temp2 group by issue_resolved_by1,nature,problem
			) as Tmp2 
			on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId
		end
	end
else if @product_name='Odin Client' or @Product_Name='System'
	begin
		if(@period='PI' and @Nature='')
		begin
		if @FromDate='' and @ToDate=''
		begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate())and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		end
		else
		begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		end
		end
		else if(@period='TI' and @Nature='')
		begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.issue_Resolved_by=@empid  and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		end
		else if(@period='PPWI' and @Nature<>'')
		begin
		if @FromDate='' and @ToDate=''
			begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			end
		else
			begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.nature =@Nature and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			end
			end
		else if(@period='TPWI' and @Nature<>'')
			begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.nature =@Nature and tbl_NewTaskDetails.issue_Resolved_by=@empid and  tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			end
		else if(@period='PNWI' and @Nature<>'')
		begin
		if @FromDate='' and @ToDate=''
			begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			end
		else
			begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.problem =@Nature and tbl_NewTaskDetails.issue_Resolved_by=@empid  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name) 
			end
			end
		else if(@period='TNWI' and @Nature<>'')
			begin
				select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
				where tbl_NewTaskDetails.problem =@Nature and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name) and tbl_NewTaskDetails.issue_Resolved_by=@empid
	end
	end
else if @product_name<>'Odin Client' and  @Product_Name<>'System'
	begin
		if(@period='PI' and @Nature='')
		begin
			if @FromDate='' and @ToDate=''
			begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate())and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) and tbl_NewTaskDetails.issue_Resolved_by=@empid 
			end
			else
			begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid order by tbl_NewTaskDetails.docket_number
			end
		end
		else if(@period='TI' and @Nature='')
		begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_Resolved_by=@empid  order by tbl_NewTaskDetails.docket_number
		end
		else if(@period='PPWI' and @Nature<>'')
		begin
			if @FromDate='' and @ToDate=''
			begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.nature =@Nature
			end
			else
			begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.nature =@Nature order by tbl_NewTaskDetails.docket_number
			end
		end
		else if(@period='TPWI' and @Nature<>'')
		begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.nature =@Nature order by tbl_NewTaskDetails.docket_number
		end
		else if(@period='PNWI' and @Nature<>'')
		begin
			if @FromDate='' and @ToDate=''
			begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,getdate()) and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.problem =@Nature
			end
			else
			begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.problem =@Nature order by tbl_NewTaskDetails.docket_number
			end
		end
		else if(@period='TNWI' and @Nature<>'')
		begin
				select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
				from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
				where
				tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.problem =@Nature order by tbl_NewTaskDetails.docket_number
		end
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_ProductwiseEmpPerformance_New
-- --------------------------------------------------







--exec USP_MIS_ProductwiseEmpPerformance_New '','','E05109','angel diet','Connection Busy Error','PNWI'


CREATE proc [dbo].[USP_MIS_ProductwiseEmpPerformance_New]

--Created By	: Mahendra Bonde
--Modified BY	:

@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@EmpId as varchar(20),
@Product_Name as varchar(100),
@Nature as nvarchar(150),
@period as varchar(50),
@Choice As Char(10),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)


As

If(@period='' and @Nature='')
begin
	--========================================== IT =========================================
	IF (@Choice='IT')
	begin
		IF @FromDate='' and @ToDate=''
		begin
			select distinct(tmp1.nature),tmp1.*,tmp2.* from 
			(
				select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					select 	Nature,issue_resolved_by,username, 
					sum(Periodic_Issues) as Periodic_Issues,
					sum(Total_issues) as Total_issues, 
					ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
					ISNULL(Min(Min_Time),0) As Min_Time,
					ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select 	Nature,issue_resolved_by,username, 
							Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)   THEN count(temp1.Docket_number) END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),	
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),MUser_Master.username,CD.Client_code,Fd.nature as nature,
									Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
							from tbl_NewTaskDetails CD  
								full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.nature 
								join MUser_Master on MUser_Master.userid=cd.issue_resolved_by
							where  CD.Product_code=@Product_Name and CD.issue_resolved_by=@EmpId and CD.issue_type='IT'
								And MUser_Master.Account_Status=1
						) as temp1 GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
					) T GROUP BY Nature,issue_resolved_by,username
				) as temp GROUP BY Nature,issue_resolved_by,username
			) as Tmp1 
			join
			(	
				select  distinct(nature) as nature,issue_resolved_by1,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Product_Name,issue_Resolved_by1,nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select product_name,issue_Resolved_by as issue_Resolved_by1,nature, 
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select CD.issue_resolving_time as Issue_Resolving_Time,CD.issue_resolved_by,
									ITPM.product_name ,CD.nature
							from tbl_NewTaskDetails CD join tbl_it_productmaster ITPM on CD.product_code=ITPM.product_Name
								join MUser_Master on CD.Issue_Resolved_By=MUser_Master.userid
							where CD.Product_code=@Product_Name and cd.issue_type='IT' And MUser_Master.Account_Status=1
						) as temp Group  by Issue_Resolving_Time,issue_resolved_by,product_name,nature
					) T Group BY product_name,issue_Resolved_by1,nature
				) as Temp2 Group by product_name,issue_Resolved_by1,nature
			) as Tmp2 on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		end
		else --======================== From n To Date Given ======================
		begin
			select tmp1.*,tmp2.* from 
			(
				select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					select 	Nature,issue_resolved_by,username, 
						sum(Periodic_Issues) as Periodic_Issues,
						sum(Total_issues) as Total_issues, 
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select 	Nature,issue_resolved_by,username, 
							Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)   THEN count(temp1.Docket_number) END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),	
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),CD.Client_code,MUser_Master.username,Fd.nature as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
							from tbl_NewTaskDetails CD  full join (select distinct(Nature),Product_name from tbl_IT_KB_Master where product_Name=@Product_Name) FD on CD.nature=FD.nature
								join MUser_Master on MUser_Master.userid=cd.issue_resolved_by  
							where  cd.Product_code=@Product_Name and cd.issue_resolved_by=@EmpId and cd.issue_type='IT' 
									And MUser_Master.Account_Status=1 
						) as temp1 GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
					) T GROUP BY Nature,issue_resolved_by,username
				) as temp GROUP BY Nature,issue_resolved_by,username
			) as Tmp1 
			join
			(
				select  distinct(nature) as nature,issue_resolved_by1,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Product_Name,issue_Resolved_by1,nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select product_name,issue_Resolved_by as issue_Resolved_by1,nature, 
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from
						( 
							select CD.issue_resolving_time as Issue_Resolving_Time,CD.issue_resolved_by,
									ITPM.product_name ,CD.nature
							from tbl_NewTaskDetails CD join tbl_it_productmaster ITPM on CD.product_code=ITPM.product_Name
								join MUser_Master on CD.Issue_Resolved_By=MUser_Master.Userid
							where CD.Product_code=@Product_Name and CD.issue_type='IT' And MUser_Master.Account_Status=1
						) as temp Group  by Issue_Resolving_Time,issue_resolved_by,product_name,nature
					) T Group BY product_name,issue_Resolved_by1,nature
				) as Temp2 Group by product_name,issue_Resolved_by1,nature
			) as Tmp2 on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		End
	End
	--========================================== EBroking =========================================
	else If(@Choice='EBro') 
	begin
		if @FromDate='' and @ToDate=''
		begin
			select distinct(tmp1.nature),tmp1.*,tmp2.* from 
			(
				select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					select 	Nature,issue_resolved_by,username, 
					sum(Periodic_Issues) as Periodic_Issues,
					sum(Total_issues) as Total_issues, 
					ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
					ISNULL(Min(Min_Time),0) As Min_Time,
					ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select 	Nature,issue_resolved_by,username, 
							Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)   THEN count(temp1.Docket_number) END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),	
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),MUser_Master.username,CD.Client_code,Fd.faq_nature as nature ,Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
							from tbl_NewTaskDetails CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature 
								join MUser_Master on MUser_Master.userid=cd.issue_resolved_by
							where  cd.Product_code=@Product_Name and cd.issue_resolved_by=@EmpId and cd.issue_type='EBro' 
								And MUser_Master.Account_Status=1
						) as temp1 GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
					) T GROUP BY Nature,issue_resolved_by,username
				) as temp GROUP BY Nature,issue_resolved_by,username,nature
			) as Tmp1 
			join
			(	
				select  distinct(nature) as nature,issue_resolved_by1,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Product_Name,issue_Resolved_by1,nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select product_name,issue_Resolved_by as issue_Resolved_by1,nature, 
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from  
						(
							select CD.issue_resolving_time as Issue_Resolving_Time,CD.issue_resolved_by,
								vendor_product.product_name ,CD.nature
							from tbl_NewTaskDetails CD join vendor_product on (CD.product_code=vendor_product.product_code or CD.product_code=vendor_product.product_Name)
								join MUser_Master on CD.Issue_Resolved_By=MUser_Master.Userid
							where CD.Product_code=@Product_Name and cd.issue_type='EBro' And MUser_Master.Account_Status=1
						) as temp group  by Issue_Resolving_Time,issue_resolved_by,product_name,nature
					) T Group BY product_name,issue_Resolved_by1,nature
				) as Temp2 group by product_name,issue_Resolved_by1,nature
			) as Tmp2 on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		end
		else --======================== From n To Date Given ======================
		begin
			select tmp1.*,tmp2.* from 
			(
				select username,issue_resolved_by,Nature,@product_name as product_name ,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues, 
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					select 	Nature,issue_resolved_by,username, 
						sum(Periodic_Issues) as Periodic_Issues,
						sum(Total_issues) as Total_issues, 
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select 	Nature,issue_resolved_by,username, 
							Periodic_Issues=isnull(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)   THEN count(temp1.Docket_number) END,0), 
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),	
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from
						(
							select distinct(CD.Docket_number),CD.Client_code,MUser_Master.username,Fd.faq_nature as nature ,vendor_product.Product_name,issue_raised_dateTime ,issue_resolving_time,issue_resolved_by
							from tbl_NewTaskDetails CD  full join (select distinct(faq_Nature),Product_name from faq_details where product_Name=@Product_Name) FD on CD.nature=FD.faq_nature
								join MUser_Master on MUser_Master.userid=cd.issue_resolved_by
								join vendor_product on (CD.product_code=vendor_product.product_code or CD.product_code=vendor_product.product_Name)
							where  vendor_product.product_name=@Product_Name and cd.issue_resolved_by=@EmpId and cd.issue_type='EBro'  
								And MUser_Master.Account_Status=1
						) as temp1 GROUP BY issue_raised_dateTime,Nature,issue_resolving_time,issue_resolved_by,username,nature
					) T GROUP BY Nature,issue_resolved_by,username
				) as temp group by Nature,issue_resolved_by,username 
			) as Tmp1 
			join
			(
				select  distinct(nature) as nature,issue_resolved_by1,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Product_Name,issue_Resolved_by1,nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select product_name,issue_Resolved_by as issue_Resolved_by1,nature, 
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select CD.issue_resolving_time as Issue_Resolving_Time,CD.issue_resolved_by,vendor_product.product_name ,CD.nature
							from Tbl_NewClient_Details CD join vendor_product on (CD.product_code=vendor_product.product_code or CD.product_code=vendor_product.product_Name)
								join MUser_Master on CD.Issue_Resolved_By=MUser_Master.Userid
							where vendor_product.product_name=@Product_Name and cd.issue_type='EBro' 
								And MUser_Master.Account_Status=1
						) as temp group  by Issue_Resolving_Time,issue_resolved_by,nature,product_name
					) T Group BY product_name,issue_Resolved_by1,nature
				) as Temp2 group by issue_Resolved_by1,nature
			) as Tmp2 on Tmp1.nature=Tmp2.nature  where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		End
	End
	--===================================== ALL Product =============================================
--	Else If(@Choice='ALL')
--	Begin
--		
--	End
End
--################################################################################################################--
--=================================================== NATURE =========================================================
--################################################################################################################--
Else If (@period='' and @Nature<>'')
Begin
	--========================================== IT =========================================
	If (@Choice='IT')
	begin
		If @FromDate='' and @ToDate=''
		begin
			select distinct(tmp1.problem),tmp1.*,tmp2.* from 
			(
				select distinct(problem),issue_resolved_by,@product_name as product_name,Nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select problem,issue_resolved_by ,nature, 
						sum(Periodic_Issues) as Periodic_Issues,
						sum(Total_issues) as Total_issues, 
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(	
						select problem,issue_resolved_by ,nature, 
							Periodic_Issues=ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)  THEN count(temp1.Docket_number) END,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem ,cd.nature as nature,Product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by 
							from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
								join MUser_Master on CD.Issue_Resolved_by=MUser_Master.Userid
							where  cd.Product_code=@Product_Name and cd.issue_resolved_by=@EmpId and cd.Issue_Type='IT' 
								And MUser_Master.Account_Status=1
						) as temp1 GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
					) T Group By problem,issue_resolved_by ,nature
				) as temp group by  problem,issue_resolved_by,nature having not problem is null  
			) as Tmp1 
			join
			(	
				Select  issue_resolved_by1,nature,problem,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Issue_Resolved_BY1,Nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select issue_resolving_time as Issue_Resolving_Time,issue_resolved_by,nature,problem
							from tbl_NewTaskDetails join MUser_Master on Issue_Resolved_By=Userid
							where nature=@Nature and Issue_Type='IT' And Account_Status=1--@Product_Name
						) as temp group  by Issue_Resolving_Time,issue_resolved_by,nature,problem
					) T Group By problem,issue_resolved_by1,nature
				) as Temp2 group by issue_resolved_by1,nature,problem
			) as Tmp2 on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		end
		else --======================== From n To Date Given ======================
		begin
			select tmp1.*,tmp2.* from 
			(
				Select distinct(problem),issue_resolved_by,@Product_Name as Product_name,nature as nature,
					sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select problem,issue_resolved_by ,nature, 
						sum(Periodic_Issues) as Periodic_Issues,
						sum(Total_issues) as Total_issues, 
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(	
						select problem,issue_resolved_by ,nature, 
							Periodic_Issues=ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)  THEN count(temp1.Docket_number) END,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem,cd.nature as nature ,Product_name,issue_raised_dateTime,issue_resolving_time,issue_Resolved_by 
							from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,nature from tbl_IT_KB_Master where product_Name=@Product_Name and nature=@Nature) FD on CD.problem=FD.problem
								join MUser_Master On CD.Issue_Resolved_By=MUser_Master.Userid
							where  cd.Product_code=@Product_Name and cd.issue_resolved_by=@EmpId and cd.Issue_Type='IT'
								And MUser_Master.Account_Status=1
						) as temp1 GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
					) T Group By problem,issue_resolved_by ,nature
				) as temp group by  problem,issue_resolved_by,nature having not problem is null 
			) as Tmp1 
			join
			(	
				Select  issue_resolved_by1,nature,problem,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Issue_Resolved_BY1,Nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select issue_resolving_time as Issue_Resolving_Time,issue_resolved_by ,nature,problem
							from tbl_NewTaskDetails join MUser_Master on Issue_Resolved_by=userid
							where nature =@Nature and Issue_Type='IT' And MUser_Master.Account_Status=1 --@Product_Name
						) as temp group by Issue_Resolving_Time,issue_resolved_by,nature,problem
					) T Group By problem,issue_resolved_by1,nature
				) as Temp2 group by issue_resolved_by1,nature,problem 
			) as Tmp2 on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		End
	End
	Else --========================================== EBroking =========================================
	Begin
		If @FromDate='' and @ToDate=''
		Begin
			select distinct(tmp1.problem),tmp1.*,tmp2.* from 
			(
				Select distinct(problem),issue_resolved_by,@product_name as product_name,Nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select problem,issue_resolved_by ,nature, 
						sum(Periodic_Issues) as Periodic_Issues,
						sum(Total_issues) as Total_issues, 
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(	
						select problem,issue_resolved_by ,nature, 
							Periodic_Issues=ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)  THEN count(temp1.Docket_number) END,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem ,cd.nature as nature,Product_name,issue_raised_dateTime,issue_resolving_time,issue_resolved_by 
							from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
								join MUser_Master  on CD.Issue_Resolved_BY=MUser_Master.Userid
							where  cd.Product_code=@Product_Name and cd.issue_resolved_by=@EmpId and cd.issue_type='EBro' 
								And MUser_Master.Account_Status=1 
						) as temp1 GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
					) T Group By problem,issue_resolved_by ,nature
				) as temp group by  problem,issue_resolved_by,nature having not problem is null  
			) as Tmp1 
			join
			(	
				Select  issue_resolved_by1,nature,problem,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Issue_Resolved_BY1,Nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select issue_resolving_time as Issue_Resolving_Time,issue_resolved_by,nature,problem
							from tbl_NewTaskDetails join MUser_Master on Issue_Resolved_BY=Userid
							where nature=@Nature and issue_type='EBro' And MUser_Master.Account_Status=1  --@Product_Name
						) 
						as temp group  by Issue_Resolving_Time,issue_resolved_by,nature,problem
					) T Group By problem,issue_resolved_by1,nature
				) as Temp2 group by issue_resolved_by1,nature,problem
			) as Tmp2 on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		End
		Else --======================== From n To Date Given ======================
		Begin
			select tmp1.*,tmp2.* from 
			(
				select distinct(problem),issue_resolved_by,@Product_Name as Product_name,nature as nature,sum(Periodic_Issues) as Periodic_Issues,sum(Total_issues) as Total_issues,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select problem,issue_resolved_by ,nature, 
						sum(Periodic_Issues) as Periodic_Issues,
						sum(Total_issues) as Total_issues, 
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					from 
					(	
						select problem,issue_resolved_by ,nature, 
							Periodic_Issues=ISNULL(CASE WHEN datepart(mm,issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)  THEN count(temp1.Docket_number) END,0),
							Total_issues=ISNULL(COUNT(temp1.Docket_number) ,0),
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select distinct(CD.Docket_number),CD.Client_code,Fd.problem as problem,cd.nature as nature ,Product_name,issue_raised_dateTime,issue_resolving_time,issue_Resolved_by 
							from tbl_NewTaskDetails CD  full join (select distinct(Problem),Product_name,faq_nature from faq_details where product_Name=@Product_Name and faq_nature=@Nature) FD on CD.problem=FD.problem
								join MUser_Master on CD.Issue_Resolved_By=Userid
							where  cd.Product_code=@Product_Name and cd.issue_resolved_by=@EmpId and cd.Issue_Type='EBro' 
									And MUser_Master.Account_Status=1 
						) as temp1 GROUP BY issue_raised_dateTime,problem,issue_resolving_time,issue_resolved_by,nature
					) T Group By problem,issue_resolved_by ,nature
				) as temp group by  problem,issue_resolved_by,nature having not problem is null  
			) as Tmp1 
			join
			(	
				Select  issue_resolved_by1,nature,problem,
					--minimum time
					--Min(Min_Time) 
					isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
					--maximum time
					--Max(Max_Time)
					isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
					--Average Time
					isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
				from
				(
					Select Problem,Issue_Resolved_BY1,Nature,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
					From
					(
						select distinct(problem) as problem,issue_resolved_by as issue_Resolved_by1,nature,
							Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
							Max_Time=Max(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
						from 
						(
							select issue_resolving_time as Issue_Resolving_Time,issue_resolved_by ,nature,problem
							from tbl_NewTaskDetails join MUser_Master on Issue_Resolved_By=Userid
							where nature =@Nature and issue_type='EBro' And MUser_Master.Account_Status=1  --@Product_Name
						) as temp group by Issue_Resolving_Time,issue_resolved_by,nature,problem
					) T Group By problem,issue_resolved_by1,nature
				) as Temp2 group by issue_resolved_by1,nature,problem 
			) as Tmp2 on Tmp1.problem=Tmp2.problem where tmp2.issue_resolved_by1=@EmpId Order BY Total_Issues DESC
		End
	End
End
--###################################################################################################--
------------------------------------------- Period = PI ------------------------------------------------------------
Else If(@period='PI' and @Nature='')
Begin
	If(@Choice='IT')
	Begin
		If @FromDate='' and @ToDate=''
		Begin
			Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			Where datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate)
				and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
		Else
		Begin
			Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			Where tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
				and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
	End
	If(@Choice='EBro')
	Begin
		If @FromDate='' and @ToDate=''
		Begin
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
			where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,@FromDate)and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid 
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
		Else
		Begin
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
			where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid 
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
	End
End
Else If(@period='TI' and @Nature='')
Begin
	If(@Choice='IT')
	Begin
		Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		From tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
		Where tbl_NewTaskDetails.issue_Resolved_by=@empid  and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
	End
	If(@Choice='EBro')
	Begin
		select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_NewTaskDetails 
			join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
			join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
		where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			and tbl_NewTaskDetails.issue_Resolved_by=@empid  Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
	End
End
Else if(@period='PPWI' and @Nature<>'')
Begin
	If(@Choice='IT')
	Begin
		If @FromDate='' and @ToDate=''
		Begin
			Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			where datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,@FromDate) 
				and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate) 
				and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
		Else
		Begin
			Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			Where tbl_NewTaskDetails.nature =@Nature and tbl_NewTaskDetails.issue_Resolved_by=@empid 
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
	End
	If(@Choice='EBro')
	Begin
		If @FromDate='' and @ToDate=''
		begin
			Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
			Where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.nature =@Nature
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
		Else
		Begin
			Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
			where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
				and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.nature =@Nature 
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
	End
End
Else If(@period='TPWI' and @Nature<>'')
Begin
	If(@Choice='IT')
	Begin
		Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		From tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 	
		Where tbl_NewTaskDetails.nature =@Nature and tbl_NewTaskDetails.issue_Resolved_by=@empid and  tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
		Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
	End
	If(@Choice='EBro')
	Begin
		Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		From tbl_NewTaskDetails 
			join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
			join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
		Where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.nature =@Nature 
		Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
	End
End
Else If(@period='PNWI' and @Nature<>'')
Begin
	If(@Choice='IT')
	Begin
		If @FromDate='' and @ToDate=''
		Begin
			Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			where datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
		Else
		Begin
			Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
				join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
				join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
			Where tbl_NewTaskDetails.problem =@Nature and tbl_NewTaskDetails.issue_Resolved_by=@empid  and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name) 
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
	End
	If(@Choice='EBro')
	Begin
		If @FromDate='' and @ToDate=''
		Begin
			select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			from tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
			where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,@FromDate) and datepart(yyyy,issue_raised_datetime)= datepart(yyyy,@FromDate) and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.problem =@Nature
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
		Else
		Begin
			Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
			From tbl_NewTaskDetails 
				join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
				join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
				join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
				join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
			Where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
				and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
				and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.problem =@Nature 
			Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
		End
	End
End
Else If(@period='TNWI' and @Nature<>'')
Begin
	If(@Choice='IT')
	Begin
		Select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		From tbl_NewTaskDetails 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
			join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
			join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid 
		Where tbl_NewTaskDetails.problem =@Nature 
			and tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name) and tbl_NewTaskDetails.issue_Resolved_by=@empid
		Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
	End
	If(@Choice='EBro')
	Begin
		Select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		From tbl_NewTaskDetails 
			join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
			join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
			join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
			join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
		Where tbl_NewTaskDetails.Product_code in (select distinct(product_code) from vendor_product where product_name=@Product_Name)
			and tbl_NewTaskDetails.issue_Resolved_by=@empid and tbl_NewTaskDetails.problem =@Nature
		Order BY tbl_NewTaskDetails.Issue_Raised_Datetime
	End
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_ProductWiseReport
-- --------------------------------------------------





CREATE proc [dbo].[usp_MIS_ProductWiseReport]
@Product_Name as varchar(50),
@period as varchar(50)
as
--Author		: Amit B Padekar
--Modified by	: Sanjay K
--Modification	: Query modified using case
--				  Min,Max and Average Time calculation 
--usp_MIS_ProductWiseReport '',''
--usp_MIS_ProductWiseReport 'Angel Diet','7'
--usp_MIS_ProductWiseReport 'Angel Diet','ALL'
declare @t as varchar(max)
declare @7t as varchar(max)
declare @30t as varchar(max)
select @t=count(distinct(tbl_newclient_details.docket_number)) from tbl_newclient_details join vendor_product on tbl_newclient_details.product_code=vendor_product.product_code  where tbl_newclient_details.product_code not in('Odin Client','System') 
select @7t =count(distinct(tbl_newclient_details.docket_number)) from tbl_newclient_details join vendor_product on tbl_newclient_details.product_code=vendor_product.product_code  where tbl_newclient_details.product_code not in('Odin Client','System') and datediff(day,tbl_newclient_details.issue_raised_dateTime,getdate())<8  
select @30t =count(distinct(tbl_newclient_details.docket_number)) from tbl_newclient_details join vendor_product on tbl_newclient_details.product_code=vendor_product.product_code  where tbl_newclient_details.product_code not in('Odin Client','System') and datediff(day,tbl_newclient_details.issue_raised_dateTime,getdate())<31  

if(@Product_Name='')
begin
	select
	product_name,sum (Last_seven_days_issues) as Last_seven_days_issues ,CONVERT(DECIMAL(10,2),(convert(float,sum(Last_seven_days_issues)*100)/@7t)) as [Last_seven_days_issues_(%)],sum(Last_thirty_days_issues) as Last_thirty_days_issues,CONVERT(DECIMAL(10,2),(convert(float,sum(Last_thirty_days_issues)*100)/@30t)) as [Last_thirty_days_issues_(%)],sum(Total_issues) as Total_issues,CONVERT(DECIMAL(10,2),(convert(float,sum(Total_issues)*100)/@t)) as [Total_issues_(%)],
	--minimum time
	--Min(Total_Seconds) 
	isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
	+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
	as Minimum_Time,
	--maximum time
	--Max(Total_Seconds)
	isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
	+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
	as Maximum_Time,  

	--Average Time
	isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
	+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
	+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
	as Average_Time
	from
	(
	SELECT 
	product_name,
	Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
	Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
	Total_issues=ISNULL(count(docket_number) ,0),
	Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
	FROM 
	(select distinct(tbl_newclient_details.docket_number),tbl_newclient_details.client_code,vendor_product.product_name,vendor_product.product_code,tbl_newclient_details.issue_raised_dateTime,tbl_newclient_details.issue_resolving_time from tbl_newclient_details join vendor_product on tbl_newclient_details.product_code=vendor_product.product_code ) as Als_Product_Main
	group by product_name,issue_raised_dateTime,issue_resolving_time
	) as Temp  group by product_name having product_name not in('Odin Client','System')
end
else if(@period='ALL')
begin
	select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
	from tbl_NewTaskDetails 
	join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
	join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
	join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
	join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
	where Product_master.Product_code in(select distinct(product_code) from vendor_product where product_name=@Product_Name) order by docket_number
end
else
begin
	select tbl_NewTaskDetails.docket_number as Docket_Number,client_master.client_code as Client_code,client_master.short_name as Client_name,Product_master.product_name as product_name,tbl_NewTaskDetails.type as _Type,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time,MUser_Master.username as Issue_resolved_by,jobstatusmaster.jobstatus_name as Status
	from tbl_NewTaskDetails 
	join (select * from vendor_product) as Product_master on tbl_NewTaskDetails.product_code=Product_master.product_code 
	join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
	join client_master on client_master.client_code=tbl_NewTaskDetails.client_code
	join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
	where Product_master.Product_code in(select distinct(product_code) from vendor_product where product_name=@Product_Name) and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_ProductWiseReport_New
-- --------------------------------------------------









CREATE Proc [dbo].[USP_MIS_ProductWiseReport_New]

-- Created By	: Mahendra Bonde

@Product_Name As Varchar(50),
@Period As Varchar(50),
@Choice As char(10),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)


as

Begin
	declare @t as varchar(max)
	declare @7t as varchar(max)
	declare @30t as varchar(max)
	
	--================================== EBroking =============================--
	--USP_MIS_ProductWiseReport_New '','','EBro','','',''
	--
	--USP_MIS_ProductWiseReport_New 'Angel Diet','ALL','EBro','','',''
	--
	--USP_MIS_ProductWiseReport_New 'Angel Diet','7','EBro','','',''

	If(@Choice='EBro')
	Begin	
		
		If(@Product_Name='')
		begin
			-- ================================================= ADM ============================================ --
			If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin 
				select @t=count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) where D.Issue_Type='EBro'
				select @7t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8  
				select @30t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31  

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_Issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time				
				From
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
							sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
							ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
							ISNULL(Min(Min_Time),0) As Min_Time,
							ISNULL(Max(Max_Time),0) As Max_Time
						from
						(				
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As [Product_Name],
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
									join MUser_Master UM On (D.Issue_Resolved_By=UM.Userid And UM.Account_Status=1)
								where D.Issue_Type='EBro'
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
							
					UNION
					
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								join MUser_Master UM On (D.Issue_Resolved_By=UM.Userid And UM.Account_Status=1)
							where D.Issue_Type='EBro'
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				select @t=count(distinct(D.docket_number))  from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID 	where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID  where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) 
		
				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_Issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time				
				From
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
							sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
							ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
							ISNULL(Min(Min_Time),0) As Min_Time,
							ISNULL(Max(Max_Time),0) As Max_Time
						from
						(				
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As [Product_Name],
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'
									And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
							
					UNION
					
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				select @t=count(distinct(D.docket_number))  from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID 	where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID  where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) 
		
				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_Issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time				
				From
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
							sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
							ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
							ISNULL(Min(Min_Time),0) As Min_Time,
							ISNULL(Max(Max_Time),0) As Max_Time
						from
						(				
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As [Product_Name],
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'
									And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
							
					UNION
					
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				select @t=count(distinct(D.docket_number))  from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID 	where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID  where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) 
		
				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_Issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time				
				From
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
							sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
							ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
							ISNULL(Min(Min_Time),0) As Min_Time,
							ISNULL(Max(Max_Time),0) As Max_Time
						from
						(				
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As [Product_Name],
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'
									And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
							
					UNION
					
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				select @t=count(distinct(D.docket_number))  from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID 	where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID  where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) 
		
				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_Issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time				
				From
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
							sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
							ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
							ISNULL(Min(Min_Time),0) As Min_Time,
							ISNULL(Max(Max_Time),0) As Max_Time
						from
						(				
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As [Product_Name],
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'
									and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
							
					UNION
					
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
		End
		else if(@period='ALL')
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin 
				select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
					CM.short_name as Client_name,VP.product_Name as Product_Name,
					D.type as _Type,D.nature as Nature,
					D.problem as Problem,D.client_remark as Remark,
					D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
					D.issue_resolving_time,8)  as Resolution_time,
					UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro' And UM.Account_Status=1 
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				Select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
					CM.short_name as Client_name,VP.product_Name as Product_Name,
					D.type as _Type,D.nature as Nature,
					D.problem as Problem,D.client_remark as Remark,
					D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
					D.issue_resolving_time,8)  as Resolution_time,
					UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				Select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
					CM.short_name as Client_name,VP.product_Name as Product_Name,
					D.type as _Type,D.nature as Nature,
					D.problem as Problem,D.client_remark as Remark,
					D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
					D.issue_resolving_time,8)  as Resolution_time,
					UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				Select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
					CM.short_name as Client_name,VP.product_Name as Product_Name,
					D.type as _Type,D.nature as Nature,
					D.problem as Problem,D.client_remark as Remark,
					D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
					D.issue_resolving_time,8)  as Resolution_time,
					UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				Select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
					CM.short_name as Client_name,VP.product_Name as Product_Name,
					D.type as _Type,D.nature as Nature,
					D.problem as Problem,D.client_remark as Remark,
					D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
					D.issue_resolving_time,8)  as Resolution_time,
					UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				Order by Issue_Raised_Datetime 
			End
		end
		else
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
						CM.short_name as Client_name,VP.product_Name as Product_Name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
						D.issue_resolving_time,8)  as Resolution_time,
						UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro' And UM.Account_Status=1 
					and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period) And UM.Account_Status=1 
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
						CM.short_name as Client_name,VP.product_Name as Product_Name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
						D.issue_resolving_time,8)  as Resolution_time,
						UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime				
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
						CM.short_name as Client_name,VP.product_Name as Product_Name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
						D.issue_resolving_time,8)  as Resolution_time,
						UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime				
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
						CM.short_name as Client_name,VP.product_Name as Product_Name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
						D.issue_resolving_time,8)  as Resolution_time,
						UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime				
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
						CM.short_name as Client_name,VP.product_Name as Product_Name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
						D.issue_resolving_time,8)  as Resolution_time,
						UM.username as Issue_resolved_by,JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
					join JobStatusMaster JS On D.status_code=JS.jobstatus_id
					join Client_Master CM On CM.client_code=D.client_code
					join MUser_Master UM On UM.userid=D.issue_resolved_by
				where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
					and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				Order by Issue_Raised_Datetime				
			End
		End		

	End
	--================================= IT ======================================--
	--	USP_MIS_ProductWiseReport_New '','','IT','','',''
	--
	--	USP_MIS_ProductWiseReport_New 'Odin Client','ALL','IT','','',''
	--
	--	USP_MIS_ProductWiseReport_New 'Odin Client','7','IT','','',''

	Else If(@Choice='IT')
	Begin	
		
		if(@Product_Name='')
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				select @t=count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name where D.Issue_Type='IT' 
				select @7t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name  where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8  
				select @30t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name  where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31  

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								select distinct(D.docket_number),D.client_code, D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
									join MUser_Master UM on (D.Issue_Resolved_BY=UM.UserID And UM.Account_Status=1)
								Where D.Issue_Type='IT'
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
						
					UNION
				
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
							Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
							Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct VP.Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								join MUser_Master UM on (D.Issue_Resolved_BY=UM.UserID And UM.Account_Status=1)
							Where D.Issue_Type='IT'
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				select @t=count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								select distinct(D.docket_number),D.client_code, D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								Where D.Issue_Type='IT'
									And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
						
					UNION
				
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
							Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
							Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct VP.Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
							Where D.Issue_Type='IT'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				select @t=count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								select distinct(D.docket_number),D.client_code, D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								Where D.Issue_Type='IT'
									And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
						
					UNION
				
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
							Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
							Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct VP.Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
							Where D.Issue_Type='IT'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				select @t=count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								select distinct(D.docket_number),D.client_code, D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								Where D.Issue_Type='IT'
									And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
						
					UNION
				
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
							Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
							Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct VP.Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
							Where D.Issue_Type='IT'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				select @t=count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @7t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				select @30t =count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31  and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								select distinct(D.docket_number),D.client_code, D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								Where D.Issue_Type='IT'
									and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
						
					UNION
				
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
							Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
							Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct VP.Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
							Where D.Issue_Type='IT'
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
		end
		else if(@period='ALL')
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				Select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
					join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
					And UM.Account_Status=1 
				 --and CD.Ctcl_Status='Active'
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				Select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
					join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
				And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime				
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				Select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
					join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
				And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime				
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				Select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
					join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
				And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				Order by Issue_Raised_Datetime				
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				Select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
					join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
				and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				Order by Issue_Raised_Datetime				
			End
		end
		else
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join ctcl_details CD on D.client_code=CD.ctcl_odinid
					join view_subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
					and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd And UM.Account_Status=1 			
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join ctcl_details CD on D.client_code=CD.ctcl_odinid
					join view_subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name 
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
					and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd				
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join ctcl_details CD on D.client_code=CD.ctcl_odinid
					join view_subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name 
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
					and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd				
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join ctcl_details CD on D.client_code=CD.ctcl_odinid
					join view_subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name 
					And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
					and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd				
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				select distinct(D.docket_number) as Docket_Number,
						CD.ctcl_isbtag as [Sub_broker],D.client_code as Client_code,
						D.product_Code as Product_Name,D.nature as Nature,
						D.problem as Problem,D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,UM.username as issue_resolved_by,
						JS.jobstatus_name as Status
				from Tbl_NewClient_Details D
					join JobStatusMaster JS on D.status_code=JS.jobstatus_id
					join ctcl_details CD on D.client_code=CD.ctcl_odinid
					join view_subbroker VS on VS.tag=CD.ctcl_isbtag
					join MUser_Master UM on D.issue_Resolved_by=UM.userid 
				where D.product_code=@Product_Name 
					and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
					and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
					and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd				
				Order by Issue_Raised_Datetime 
			End
		End
	End
	--============================== ALL (EBroking and IT) ==========================================
	--		USP_MIS_ProductWiseReport_New '','','ALL','','','','','',''
	--
	--		USP_MIS_ProductWiseReport_New 'Angel Diet','ALL','ALL','','',''
	--
	--		USP_MIS_ProductWiseReport_New 'Angel Diet','ALL','ALL','','',''
	--
	--		USP_MIS_ProductWiseReport_New 'Odin Client','7','ALL','','',''
	--
	--		USP_MIS_ProductWiseReport_New 'Angel diet','7','ALL','','',''

	Else If(@Choice='ALL')
	Begin	

		if(@Product_Name='')
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				Set @t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) where D.Issue_Type='EBro') + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name where D.Issue_Type='IT' )
				Set @7t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8  )  + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name  where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8  )
				Set @30t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 ) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name  where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31 )
	
				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As Product_Name,
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
									join MUser_Master UM on (D.Issue_Resolved_BY=UM.UserID And UM.Account_Status=1)
								where D.Issue_Type='EBro'
									
								Union

								select distinct(D.docket_number),D.client_code,D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
									join MUser_Master UM on (D.Issue_Resolved_BY=UM.UserID And UM.Account_Status=1)
								Where D.Issue_Type='IT'

							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
					
					UNION
			
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								join MUser_Master UM on (D.Issue_Resolved_BY=UM.UserID And UM.Account_Status=1)
							where D.Issue_Type='EBro'
						) 
						
						UNION

						SELECT Distinct Product_Name, '0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)], '0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)], '0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								join MUser_Master UM on (D.Issue_Resolved_BY=UM.UserID And UM.Account_Status=1)
							Where D.Issue_Type='IT'
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				Set @t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))
				Set @7t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )  + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )
				Set @30t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As Product_Name,
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'	
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									
								Union

								select distinct(D.docket_number),D.client_code,D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D 
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								Where D.Issue_Type='IT'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
					
					UNION
			
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
							And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
						
						UNION

						SELECT Distinct Product_Name, '0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)], '0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)], '0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D 
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
							Where D.Issue_Type='IT'
							And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				Set @t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))
				Set @7t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )  + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )
				Set @30t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As Product_Name,
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'	
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									
								Union

								select distinct(D.docket_number),D.client_code,D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D 
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								Where D.Issue_Type='IT'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
					
					UNION
			
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
							And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
						
						UNION

						SELECT Distinct Product_Name, '0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)], '0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)], '0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D 
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
							Where D.Issue_Type='IT'
							And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				Set @t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))
				Set @7t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )  + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )
				Set @30t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As Product_Name,
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'	
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									
								Union

								select distinct(D.docket_number),D.client_code,D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D 
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								Where D.Issue_Type='IT'
								And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
					
					UNION
			
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
							And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
						
						UNION

						SELECT Distinct Product_Name, '0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)], '0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)], '0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D 
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
							Where D.Issue_Type='IT'
							And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				Set @t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))
				Set @7t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )  + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<8 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')) )
				Set @30t = (select count(distinct(D.docket_number)) from Tbl_NewClient_Details D join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_name) join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='EBro' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))) + (Select count(distinct(D.docket_number)) from tbl_newclient_details D join tbl_it_productmaster ITPM on D.product_code=ITPM.product_name join MUser_Master UM On D.Issue_Resolved_BY=UM.UserID where D.Issue_Type='IT' and datediff(day,D.issue_raised_dateTime,getdate())<31 and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH')))

				Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
					Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
					Minimum_Time,Maximum_Time,Average_Time
				from
				(
					select Product_Name,
						sum(last_seven_Days_issues) as last_seven_Days_issues,
						[Last_seven_days_issues_(%)]= ISNULL(CASE WHEN @7t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_seven_days_issues)*100)/@7t)) END,'0'),
						sum(last_thirty_Days_issues) as last_thirty_Days_issues,
						[Last_thirty_days_issues_(%)]= ISNULL(CASE WHEN @30t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Last_thirty_days_issues)*100)/@30t)) END,'0'),
						sum(Total_issues) as Total_issues,
						[Total_issues_(%)]= ISNULL(CASE WHEN @t<>0 THEN CONVERT(DECIMAL(10,2),(convert(numeric,sum(Total_issues)*100)/@t)) END,'0'),
						--minimum time
						--Min(Total_Seconds) 
						isnull(convert(nvarchar,Min(Min_Time)/3600,120) + ':' + convert(nvarchar,(Min(Min_Time)%3600)/60,120) + ':' + convert(nvarchar,(Min(Min_Time)%60)%60,120),'00:00:00') as Minimum_Time,
						--maximum time
						--Max(Total_Seconds)
						isnull(convert(nvarchar,Max(Max_Time)/3600,120) + ':' + convert(nvarchar,(Max(Max_Time)%3600)/60,120) + ':' + convert(nvarchar,(Max(Max_Time)%60)%60,120),'00:00:00') as Maximum_Time,  
						--Average Time
						isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) + ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120) + ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00') as Average_Time
					from
					(
						Select Product_Name,sum(Last_seven_days_issues) As Last_seven_days_issues,
						sum(Last_thirty_days_issues) As Last_thirty_days_issues,sum(Total_issues) As Total_issues,
						ISNULL(AVG(Total_Seconds),0) As Total_Seconds,
						ISNULL(Min(Min_Time),0) As Min_Time,
						ISNULL(Max(Max_Time),0) As Max_Time
						from
						(
							SELECT Product_Name,
								Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
								Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
								Total_issues=ISNULL(count(docket_number) ,0),
								Total_Seconds=AVG(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Min_Time=MIN(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)),
								Max_Time=MAX(DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time))
							FROM 
							(
								Select Distinct(D.docket_number),D.client_code,VP.product_Name As Product_Name,
									D.issue_raised_dateTime,D.issue_resolving_time 
								from Tbl_NewClient_Details D
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
								where D.Issue_Type='EBro'	
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									
								Union

								select distinct(D.docket_number),D.client_code,D.Product_code As Product_Name,
									D.issue_raised_dateTime, D.issue_resolving_time 
								from tbl_newclient_details D 
									join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
									join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
								Where D.Issue_Type='IT'
								and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

							) as Als_Product_Main
							Group by Product_Name,issue_raised_dateTime,issue_resolving_time
						) Temp2 Group by Product_Name
					) as Temp  
					Group by Product_Name 
					
					UNION
			
					Select Product_Name,Last_seven_days_issues,[Last_seven_days_issues_(%)],
						Last_thirty_days_issues, [Last_thirty_days_issues_(%)],Total_issues,[Total_issues_(%)],
						Minimum_Time,Maximum_Time,Average_Time
					from
					(				
						SELECT Distinct Product_Name, 
							'0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)],
							'0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)],
							'0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From Vendor_Product VP
						Where VP.Product_Name NOT IN
						(
							Select Distinct VP.product_Name As [Product_Name]
							from Tbl_NewClient_Details D
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join Vendor_Product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
							where D.Issue_Type='EBro'
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) 
						
						UNION

						SELECT Distinct Product_Name, '0' As Last_seven_days_issues, '0' As [Last_seven_days_issues_(%)], '0' As Last_thirty_days_issues, '0' As [Last_thirty_days_issues_(%)],
							'0' As Total_issues, '0' As [Total_issues_(%)], '0' As Minimum_Time, '0' As Maximum_Time, '0' As Average_Time 
						From tbl_it_productmaster VP
						Where VP.Product_Name NOT IN
						(
							select distinct(VP.product_name)
							from tbl_newclient_details D 
								join MUser_Master UM On D.Issue_resolved_BY=UM.UserID
								join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on D.product_code=vp.product_name
							Where D.Issue_Type='IT'
							and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
						) 
					) Temp 
				) T
				Order BY Total_Issues DESC
			End
		End
		else if(@period='ALL')
		begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,brief_solution,
					Remark, Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				From
				(
					select Distinct D.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as product_name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,
						D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22), D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,
						UM.username as Issue_resolved_by,
						JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro' And UM.Account_Status=1 
						
					Union

					Select distinct(D.docket_number) as Docket_Number,
							D.client_code as Client_code, 
							'' As Client_name,
							CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,
							D.nature as Nature,
							D.problem as Problem,
							D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,
							UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
						join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' 
						and D.tagbranch=CD.ctcl_ibranch_cd	--and CD.Ctcl_Status='Active'
						And UM.Account_Status=1 
				) temp
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,brief_solution,
					Remark, Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				From
				(
					select Distinct D.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as product_name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,
						D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22), D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,
						UM.username as Issue_resolved_by,
						JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					
					Union

					Select distinct(D.docket_number) as Docket_Number,
							D.client_code as Client_code, 
							'' As Client_name,
							CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,
							D.nature as Nature,
							D.problem as Problem,
							D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,
							UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
						join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				) temp
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,brief_solution,
					Remark, Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				From
				(
					select Distinct D.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as product_name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,
						D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22), D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,
						UM.username as Issue_resolved_by,
						JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					
					Union

					Select distinct(D.docket_number) as Docket_Number,
							D.client_code as Client_code, 
							'' As Client_name,
							CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,
							D.nature as Nature,
							D.problem as Problem,
							D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,
							UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
						join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				) temp
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,brief_solution,
					Remark, Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				From
				(
					select Distinct D.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as product_name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,
						D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22), D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,
						UM.username as Issue_resolved_by,
						JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
					
					Union

					Select distinct(D.docket_number) as Docket_Number,
							D.client_code as Client_code, 
							'' As Client_name,
							CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,
							D.nature as Nature,
							D.problem as Problem,
							D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,
							UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
						join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				) temp
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,brief_solution,
					Remark, Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				From
				(
					select Distinct D.docket_number as Docket_Number,
						CM.client_code as Client_code,
						CM.short_name as Client_name,
						'' As [Sub_broker],
						VP.product_Name as product_name,
						D.type as _Type,D.nature as Nature,
						D.problem as Problem,
						D.client_remark as Remark,
						D.issue_raised_datetime as Issue_raised_datetime,
						convert(varchar(22), D.issue_resolving_time,8)  as Resolution_time,
						D.brief_solution as brief_solution,
						UM.username as Issue_resolved_by,
						JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join vendor_product VP on (D.product_code=VP.product_code or D.product_code=VP.product_Name)
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
					
					Union

					Select distinct(D.docket_number) as Docket_Number,
							D.client_code as Client_code, 
							'' As Client_name,
							CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,
							D.nature as Nature,
							D.problem as Problem,
							D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,
							UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join Ctcl_Details CD on D.client_code=CD.ctcl_odinid
						join View_Subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				) temp
				Order by Issue_Raised_Datetime 
			End
		End
		else
		Begin
			-- ================================================= ADM ============================================ --
			If (@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				from
				(
					select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
							CM.short_name as Client_name,'' As [Sub_broker],VP.product_Name as product_name,
							D.type as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
							D.issue_resolving_time,8)  as Resolution_time,D.brief_solution as brief_solution,
							UM.username as Issue_resolved_by,JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
						 And UM.Account_Status=1 
					Union
					
					select distinct(D.docket_number) as Docket_Number,D.client_code as Client_code,
							'' As Client_name, CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join ctcl_details CD on D.client_code=CD.ctcl_odinid
						join view_subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
						and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	--and CD.Ctcl_Status='Active'
						And UM.Account_Status=1 
				
				) As Temp
				Order by Issue_Raised_Datetime 
			End
			-- ================================================= RH ============================================ --
			Else If(@ROLE='RH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				from
				(
					select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
							CM.short_name as Client_name,'' As [Sub_broker],VP.product_Name as product_name,
							D.type as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
							D.issue_resolving_time,8)  as Resolution_time,D.brief_solution as brief_solution,
							UM.username as Issue_resolved_by,JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

					Union
					
					select distinct(D.docket_number) as Docket_Number,D.client_code as Client_code,
							'' As Client_name, CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join ctcl_details CD on D.client_code=CD.ctcl_odinid
						join view_subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				) As Temp
				Order by Issue_Raised_Datetime	
			End
			-- ================================================= CH ============================================ --
			Else If(@ROLE='CH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				from
				(
					select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
							CM.short_name as Client_name,'' As [Sub_broker],VP.product_Name as product_name,
							D.type as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
							D.issue_resolving_time,8)  as Resolution_time,D.brief_solution as brief_solution,
							UM.username as Issue_resolved_by,JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

					Union
					
					select distinct(D.docket_number) as Docket_Number,D.client_code as Client_code,
							'' As Client_name, CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join ctcl_details CD on D.client_code=CD.ctcl_odinid
						join view_subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				) As Temp
				Order by Issue_Raised_Datetime	
			End
			-- ================================================= ZH ============================================ --
			Else If(@ROLE='ZH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				from
				(
					select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
							CM.short_name as Client_name,'' As [Sub_broker],VP.product_Name as product_name,
							D.type as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
							D.issue_resolving_time,8)  as Resolution_time,D.brief_solution as brief_solution,
							UM.username as Issue_resolved_by,JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))

					Union
					
					select distinct(D.docket_number) as Docket_Number,D.client_code as Client_code,
							'' As Client_name, CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join ctcl_details CD on D.client_code=CD.ctcl_odinid
						join view_subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
						And D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
				) As Temp
				Order by Issue_Raised_Datetime	
			End
			-- ================================================= BH ============================================ --
			Else If(@ROLE='BH')
			Begin
				Select Docket_Number,Client_code,Client_name,Sub_broker,product_name,_Type,Nature,Problem,Remark,
					brief_solution,Issue_raised_datetime,Resolution_time,Issue_resolved_by,Status
				from
				(
					select Distinct D.docket_number as Docket_Number,CM.client_code as Client_code,
							CM.short_name as Client_name,'' As [Sub_broker],VP.product_Name as product_name,
							D.type as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),
							D.issue_resolving_time,8)  as Resolution_time,D.brief_solution as brief_solution,
							UM.username as Issue_resolved_by,JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join Vendor_Product VP On (D.product_code=VP.product_code or D.product_code=VP.product_Name) 
						join JobStatusMaster JS On D.status_code=JS.jobstatus_id
						join Client_Master CM On CM.client_code=D.client_code
						join MUser_Master UM On UM.userid=D.issue_resolved_by
					where VP.product_Name=@Product_Name and D.Issue_Type='EBro'
						and datediff(day,issue_raised_dateTime,getdate()) <= convert(int,@period)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))

					Union
					
					select distinct(D.docket_number) as Docket_Number,D.client_code as Client_code,
							'' As Client_name, CD.ctcl_isbtag as [Sub_broker],
							D.product_Code as product_name,'' as _Type,D.nature as Nature,
							D.problem as Problem,D.client_remark as Remark,
							D.issue_raised_datetime as Issue_raised_datetime,
							convert(varchar(22),D.issue_resolving_time,8)  as Resolution_time,
							D.brief_solution as brief_solution,UM.username as issue_resolved_by,
							JS.jobstatus_name as Status
					from Tbl_NewClient_Details D
						join JobStatusMaster JS on D.status_code=JS.jobstatus_id
						join ctcl_details CD on D.client_code=CD.ctcl_odinid
						join view_subbroker VS on VS.tag=CD.ctcl_isbtag
						join MUser_Master UM on D.issue_Resolved_by=UM.userid 
					where D.product_code=@Product_Name and D.Issue_Type='IT' and D.tagbranch=CD.ctcl_ibranch_cd	
						and datediff(day,D.issue_raised_dateTime,getdate()) <= convert(int,@period)
						and D.Issue_Resolved_BY in (Select UserID From MUser_Master Where Account_Status=1 And Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
				) As Temp
				Order by Issue_Raised_Datetime	
			End
		End		
	End	

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MIS_ProductWiseReportIT
-- --------------------------------------------------



CREATE proc [dbo].[usp_MIS_ProductWiseReportIT]
@Product_Name as varchar(50),
@period as varchar(50)
as
------------------------------------------------------------------------------------------------
--Author		: Amit B Padekar
--Modified by	: Sanjay K
--Modification	: Query modified using case
--				  Min,Max and Average Time calculation 
------------------------------------------------------------------------------------------------
--usp_MIS_ProductWiseReportIT '',''
--usp_MIS_ProductWiseReportIT 'Angel Diet','7'
--usp_MIS_ProductWiseReportIT 'Angel Diet','ALL'
declare @t as varchar(max)
declare @7t as varchar(max)
declare @30t as varchar(max)
select @t=count(distinct(tbl_newclient_details.docket_number)) from tbl_newclient_details join tbl_it_productmaster on tbl_newclient_details.product_code=tbl_it_productmaster.product_name  where tbl_newclient_details.product_code in('Odin Client','System') 
select @7t =count(distinct(tbl_newclient_details.docket_number)) from tbl_newclient_details join tbl_it_productmaster on tbl_newclient_details.product_code=tbl_it_productmaster.product_name  where tbl_newclient_details.product_code in('Odin Client','System') and datediff(day,tbl_newclient_details.issue_raised_dateTime,getdate())<8  
select @30t =count(distinct(tbl_newclient_details.docket_number)) from tbl_newclient_details join tbl_it_productmaster on tbl_newclient_details.product_code=tbl_it_productmaster.product_name  where tbl_newclient_details.product_code in('Odin Client','System') and datediff(day,tbl_newclient_details.issue_raised_dateTime,getdate())<31  

if(@Product_Name='')
begin
	select product_name,sum (Last_seven_days_issues) as Last_seven_days_issues ,CONVERT(DECIMAL(10,2),(convert(float,sum(Last_seven_days_issues)*100)/@7t)) as [Last_seven_days_issues_(%)],sum(Last_thirty_days_issues) as Last_thirty_days_issues,CONVERT(DECIMAL(10,2),(convert(float,sum(Last_thirty_days_issues)*100)/@30t)) as [Last_thirty_days_issues_(%)],sum(Total_issues) as Total_issues,CONVERT(DECIMAL(10,2),(convert(float,sum(Total_issues)*100)/@t)) as [Total_issues_(%)],
	--minimum time
	--Min(Total_Seconds) 
	isnull(convert(nvarchar,Min(Total_Seconds)/3600,120)
	+ ':' + convert(nvarchar,(Min(Total_Seconds)%3600)/60,120)
	+ ':' + convert(nvarchar,(Min(Total_Seconds)%60)%60,120),'00:00:00')
	as Minimum_Time,
	--maximum time
	--Max(Total_Seconds)
	isnull(convert(nvarchar,Max(Total_Seconds)/3600,120)
	+ ':' + convert(nvarchar,(Max(Total_Seconds)%3600)/60,120)
	+ ':' + convert(nvarchar,(Max(Total_Seconds)%60)%60,120),'00:00:00')
	as Maximum_Time,  

	--Average Time
	isnull(convert(nvarchar,(avg(Total_Seconds)/3600),120) 
	+ ':' + convert(nvarchar,(avg(Total_Seconds)%3600)/60,120)
	+ ':' + convert(nvarchar,(avg(Total_Seconds)%60)%60,120) ,'00:00:00')
	as Average_Time
	from
	(
	SELECT 
	product_name,
	Last_seven_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<8 THEN count(docket_number) END,0),
	Last_thirty_days_issues= ISNULL(CASE WHEN datediff(day,issue_raised_dateTime,getdate())<31 THEN count(docket_number) END,0),
	Total_issues=ISNULL(count(docket_number) ,0),
	Total_Seconds=DATEPART(hh,issue_resolving_time)*60*60 + DATEPART(mi,issue_resolving_time)*60 + DATEPART(ss,issue_resolving_time)
	FROM 
	(select distinct(tbl_newclient_details.docket_number),tbl_newclient_details.client_code,vp.product_name,vp.product_code,tbl_newclient_details.issue_raised_dateTime,tbl_newclient_details.issue_resolving_time from tbl_newclient_details join (select distinct(product_name), product_name as product_code from tbl_it_productmaster) as VP on tbl_newclient_details.product_code=vp.product_name) as Als_Product_Main
	group by product_name,issue_raised_dateTime,issue_resolving_time
	) as Temp  group by product_name having product_name in ('Odin Client','System')
end
else if(@period='ALL')
begin
		select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_NewTaskDetails 
		join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
		join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
		join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
		join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid where tbl_NewTaskDetails.product_code=@Product_Name 
end
else
begin
		select distinct(tbl_NewTaskDetails.docket_number) as Docket_Number,ctcl_details.ctcl_isbtag as [Sub_broker],tbl_NewTaskDetails.client_code as Client_code,tbl_NewTaskDetails.product_Code as product_name,tbl_NewTaskDetails.nature as Nature,tbl_NewTaskDetails.problem as Problem,tbl_NewTaskDetails.client_remark as Remark,tbl_NewTaskDetails.issue_raised_datetime as Issue_raised_datetime, convert(varchar(22),tbl_NewTaskDetails.issue_resolving_time,8)  as Resolution_time, tbl_NewTaskDetails.brief_solution as brief_solution,MUser_Master.username as issue_resolved_by,jobstatusmaster.jobstatus_name as Status
		from tbl_NewTaskDetails 
		join jobstatusmaster on tbl_NewTaskDetails.status_code=jobstatusmaster.jobstatus_id
		join ctcl_details on tbl_NewTaskDetails.client_code=ctcl_details.ctcl_odinid
		join view_subbroker on view_subbroker.tag=ctcl_details.ctcl_isbtag
		join MUser_Master on tbl_NewTaskDetails.issue_Resolved_by=MUser_Master.userid where tbl_NewTaskDetails.product_code=@Product_Name and datediff(day,tbl_NewTaskDetails.issue_raised_dateTime,getdate()) <= convert(int,@period)
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_TeamPerformance
-- --------------------------------------------------








CREATE Proc [dbo].[USP_MIS_TeamPerformance]
--Author:	Sanjay Lavu Kudtarkar
@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@TeamID as varchar(10),
@Location as varchar(15),
@EMPID as varchar(10),
@ACCESS as varchar(10)
as

----/////////////////////////////   FOR ADM   /////////////////////////////////----
IF(@ACCESS='ADM' or @ACCESS='ITL3TL' or @ACCESS='ITL3EX' or @ACCESS='L3TL' or @ACCESS='L3EX')
BEGIN
	if charindex('IT',@Teamid)>0
		begin
		if @FromDate='' and @ToDate=''
		begin
			IF(@Location='')
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and 
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct userid from MUser_Master where team_id=@TeamID)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
				Order By username  
			END
			IF(@Location<>'')
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct userid from MUser_Master where team_id=@TeamID)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
				Order By username
			END
		end
		else
		begin
			IF(@Location='')	
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and 
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct userid from MUser_Master where team_id=@TeamID)
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
				Order By username
			END
			IF(@Location<>'')	
			BEGIN
								select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
 							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct userid from MUser_Master where team_id=@TeamID)
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
				Order By username
			END
		end
		end
	else ---- ////////////////// Ebroking ///////////////////----
		begin
		if @FromDate='' and @ToDate=''
		begin
			IF(@Location='')
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT Issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					FROM 
					(
						select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
						d.issue_resolved_by as Issue_resolved_by,
						u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
						from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
						where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
						u.team_id=tm.team_id and d.team_id=@TeamID 
						and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
						d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
						and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
						and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
					) as Als_Team_Performance
					group by Issue_resolved_by,username,team_id,team_name,status_code
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
				Order By username
			END
			IF(@Location<>'')
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT Issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					FROM 
					(
						select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
						d.issue_resolved_by as Issue_resolved_by,
						u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
						from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
						where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
						u.team_id=tm.team_id and d.team_id=@TeamID 
						and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
						and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
						d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
						and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
						and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
					) as Als_Team_Performance
					group by Issue_resolved_by,username,team_id,team_name,status_code
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
				Order By username
 			END
		end
		else
		begin
			IF(@Location='')
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT Issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					FROM 
					(
						select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
						d.issue_resolved_by as Issue_resolved_by,
						u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
						from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
						where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
						u.team_id=tm.team_id and d.team_id=@TeamID 
						and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
						d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
						and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
					) as Als_Team_Performance
					group by Issue_resolved_by,username,team_id,team_name,status_code
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 	
				Order By username			
			END
			IF(@Location<>'')
			BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT Issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					FROM 
					(
						select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
						d.issue_resolved_by as Issue_resolved_by,
						u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
						from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
						where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
						u.team_id=tm.team_id and d.team_id=@TeamID 
						and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
						and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
						d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
						and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
					) as Als_Team_Performance
					group by Issue_resolved_by,username,team_id,team_name,status_code
				) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
				Order By username
			END
		end
		end
END
----/////////////////////////////   FOR OTHER   /////////////////////////////////----
ELSE
BEGIN 
	----/////  FOR IT  /////----
	if charindex('IT',@Teamid)>0
	begin 
		----//// FOR IT TEAMLEADER ////----
		IF(@ACCESS='ITL1TL' or @ACCESS='ITL2TLO' or @ACCESS='ITL2TLN' or @ACCESS='ITL2TLV')
		BEGIN 
			if @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and 
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID  
					Order By username  
				END
				IF(@Location<>'')
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username   
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
					select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and 
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID
					Order By username  
				END
				IF(@Location<>'')	
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
							tbl_NewTaskDetails.issue_resolved_by in 
							(select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
			end
		END
		ELSE ----//// FOR IT EXECUTIVE ////----
		BEGIN
			if @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and tbl_NewTaskDetails.issue_resolved_by=@EMPID
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID    
					Order By username
				END
				IF(@Location<>'')
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and tbl_NewTaskDetails.issue_resolved_by=@EMPID
							and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID
					Order By username    
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and tbl_NewTaskDetails.issue_resolved_by=@EMPID
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
				IF(@Location<>'')	
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
				sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
				sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
				from
					(
					SELECT 
					issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
					FROM 
					(select tbl_NewTaskDetails.docket_number as Docket_Number,
							tbl_NewTaskDetails.issue_resolved_by,
							MUser_Master.username,
							MUser_Master.Team_id as Team_id,
							team_master.team_name as Team_Name,
							tbl_NewTaskDetails.status_code as Status_code 
							from tbl_NewTaskDetails 
							join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
							join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							join (select distinct(team_id),team_name from team_master) as team_master on 
							MUser_Master.Team_id =team_master.team_id 
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and tbl_NewTaskDetails.issue_resolved_by=@EMPID
							and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
					) as Als_Team_Performance
					group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
			end
		END
	end
	else
		----/////  FOR EBROKING  /////----		
	begin
		----//// FOR EBROKING TEAMLEADER ////----
		IF(@ACCESS='L1TL' or @ACCESS='L2FTL' or @ACCESS='L2TTL')
		BEGIN 
			if @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
					select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
						sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
						sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
						from
						(
						SELECT Issue_resolved_by,username,team_id,team_name,
						All_Issues= ISNULL(count(docket_number),0),
						Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
						Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
						Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
						Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
						Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
							d.issue_resolved_by as Issue_resolved_by,
							u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
							u.team_id=tm.team_id and d.team_id=@TeamID 
							and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
							d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
				IF(@Location<>'')
				BEGIN
					select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
						sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
						sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
						from
						(
						SELECT Issue_resolved_by,username,team_id,team_name,
						All_Issues= ISNULL(count(docket_number),0),
						Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
						Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
						Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
						Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
						Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
							d.issue_resolved_by as Issue_resolved_by,
							u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
							u.team_id=tm.team_id and d.team_id=@TeamID and tlm.branch_name=@Location
							and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
							d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
							and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
			end
			else
			begin
				IF(@Location='')
				BEGIN
					select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
						sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
						sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
						from
						(
						SELECT Issue_resolved_by,username,team_id,team_name,
						All_Issues= ISNULL(count(docket_number),0),
						Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
						Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
						Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
						Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
						Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
							d.issue_resolved_by as Issue_resolved_by,
							u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
							u.team_id=tm.team_id and d.team_id=@TeamID 
							and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
							d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username   
				END
				IF(@Location<>'')
				BEGIN
					select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
						sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
						sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
						from
						(
						SELECT Issue_resolved_by,username,team_id,team_name,
						All_Issues= ISNULL(count(docket_number),0),
						Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
						Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
						Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
						Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
						Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
							d.issue_resolved_by as Issue_resolved_by,
							u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
							u.team_id=tm.team_id and d.team_id=@TeamID and tlm.branch_name=@Location
							and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
							d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
			end
		END
		ELSE ----//// FOR EBROKING EXECUTIVE ////----
		BEGIN
		if @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT Issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					FROM 
					(
						select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
						d.issue_resolved_by as Issue_resolved_by,
						u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
						from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
						where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
						u.team_id=tm.team_id and d.team_id=@TeamID 
						and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
						and	d.issue_resolved_by=@EMPID
						and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
						and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
					) as Als_Team_Performance
					group by Issue_resolved_by,username,team_id,team_name,status_code
				) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
				IF(@Location<>'')
				BEGIN
				select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
					sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
					sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
					from
					(
					SELECT Issue_resolved_by,username,team_id,team_name,
					All_Issues= ISNULL(count(docket_number),0),
					Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
					Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
					Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
					Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
					Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
					FROM 
					(
						select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
						d.issue_resolved_by as Issue_resolved_by,
						u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
						from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
						where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
						u.team_id=tm.team_id and d.team_id=@TeamID 
						and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
						and	d.issue_resolved_by=@EMPID and tlm.branch_name=@Location
						and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
						and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
					) as Als_Team_Performance
					group by Issue_resolved_by,username,team_id,team_name,status_code
				) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID   
					Order By username 
				END
			end
			else
			begin
				IF(@Location='')
				BEGIN
									select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
						sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
						sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
						from
						(
						SELECT Issue_resolved_by,username,team_id,team_name,
						All_Issues= ISNULL(count(docket_number),0),
						Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
						Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
						Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
						Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
						Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
							d.issue_resolved_by as Issue_resolved_by,
							u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
							u.team_id=tm.team_id and d.team_id=@TeamID 
							and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
							d.issue_resolved_by=@EMPID
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
				IF(@Location<>'')
				BEGIN
					select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
						sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
						sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total
						from
						(
						SELECT Issue_resolved_by,username,team_id,team_name,
						All_Issues= ISNULL(count(docket_number),0),
						Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
						Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
						Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
						Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
						Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
							d.issue_resolved_by as Issue_resolved_by,
							u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
							u.team_id=tm.team_id and d.team_id=@TeamID 
							and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
							and	d.issue_resolved_by=@EMPID and tlm.branch_name=@Location
							and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order By username 
				END
			end
		END
	end
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MIS_TeamPerformance_NEW
-- --------------------------------------------------



CREATE Proc [dbo].[USP_MIS_TeamPerformance_NEW]

--Created By	: Sanjay Lavu Kudtarkar
--Modified By	: Mahendra Bonde

@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@TeamID as varchar(10),
@Location as varchar(15),
@EMPID as varchar(10),
@ACCESS as varchar(10),
@USER As Varchar(25),
@ROLE As Varchar(20),
@LocationOrBranch As Varchar(20)

As

Begin
	
	If(@ROLE='ADM' or @ROLE='ITL3TL' or @ROLE='L3TL' or @ROLE='M')
	Begin
		-----/////////////////////////////   FOR ADM   /////////////////////////////////----
		IF(@ACCESS='ADM' or @ACCESS='ITL3TL' or @ACCESS='ITL3EX' or @ACCESS='L3TL' or @ACCESS='L3EX')
		BEGIN
			If charindex('IT',@Teamid)>0
			Begin
				If @FromDate='' and @ToDate=''
				begin
					IF(@Location='')
					BEGIN
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 			
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
								Where issue_type='IT' and 
									tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
									and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
									and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID   
						Order BY Total_Issues DESC
					END
					IF(@Location<>'')
					BEGIN
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username,
									MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
								where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and
									tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
									and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
									and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
						Order BY Total_Issues DESC
					END
				end
				else
				begin
					IF(@Location='')	
					BEGIN
						Select Issue_Resolved_BY, Username, Team_ID,Team_Name, Escalated_Issues,
								Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues,	Total_Issues
						From
						(	
							select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
								sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
								sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
								sum (all_issues) as Total_Issues 
							from
							(
								SELECT 	issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username,
										MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and 
										tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
										and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance
								group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
				
							UNION

							SELECT 	UM.UserID As Issue_resolved_by,UM.Username,TM.Team_id,TM.Team_name,
								'0' As Escalated_Issues, '0' As Completed_Issues,'0' As Pending_Issues,
								'0' As Reassigned_Issues, '0' As Closed_Issues, '0' As Total_Issues
							FROM MUser_Master UM, Team_Master TM
							Where UM.UserID NOT IN
							(
								select Distinct MUser_Master.Userid
								from tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
								Where issue_type='IT' And MUser_Master.Account_Status=1 and 
									tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
							)
							And UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID And um.Account_Status=1
						) T
						Order BY Total_Issues DESC 

					END
					IF(@Location<>'')	
					BEGIN
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,
									tbl_NewTaskDetails.status_code as Status_code 
								From tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
									join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
 								where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and
									tbl_NewTaskDetails.issue_resolved_by in 
									(select distinct userid from MUser_Master where team_id=@TeamID)
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
						Order BY Total_Issues DESC
					END
				end
			End
			Else ---- ////////////////// Ebroking ///////////////////----
			Begin
				If @FromDate='' and @ToDate=''
				Begin
					IF(@Location='')
					BEGIN
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
									u.team_id=tm.team_id and d.team_id=@TeamID 
									and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
									d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
									and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
									And u.Account_Status=1
							) as Als_Team_Performance
							group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
						Order BY Total_Issues DESC
					END
					IF(@Location<>'')
					BEGIN
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
								sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
								sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
								sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by, u.username,u.Team_id as Team_id,
									d.status_code as Status_code, tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
									u.team_id=tm.team_id and d.team_id=@TeamID 
									and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
									and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
									d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
									and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
									And u.Account_Status=1
							) as Als_Team_Performance
							group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
						Order BY Total_Issues DESC
 					END
				end
				else
				begin
					IF(@Location='')
					BEGIN
						SELECT Issue_Resolved_By,Username,Team_id,Team_name,Total_Issues,Escalated_Issues,
						Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues
						From
						(
							select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
								sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
								sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
								sum (all_issues) as Total_Issues 
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
										d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
										and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And u.Account_Status=1
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 		
								
							UNION

							SELECT UM.UserID As Issue_Resolved_By,UM.username As Username,TM.team_id As Team_ID,TM.team_name As Team_Name,
									'0' As Total_Issues, '0' As Escalated_Issues, '0' As Completed_Issues, '0' As Pending_Issues,
									'0' As Reassigned_Issues, '0' As Closed_Issues
							FROM MUser_Master UM , Team_Master TM
							Where UserID NOT IN
							(
								Select distinct d.issue_resolved_by as Issue_resolved_by
								From tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								Where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
									u.team_id=tm.team_id and d.team_id=@TeamID
									and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
									d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1
							) 
							and UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID And um.Account_Status=1
						) T
						Order BY Total_Issues DESC
						
					END
					IF(@Location<>'')
					BEGIN
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,
									tbl_teamleadermaster tlm
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
									u.team_id=tm.team_id and d.team_id=@TeamID 
									and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
									and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
									d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1 
							) as Als_Team_Performance
							group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
						Order BY Total_Issues DESC
					END
				End
			End
		END
	--######################################################################################################--
		----/////////////////////////////   FOR OTHER   /////////////////////////////////----
		ELSE
		BEGIN 
			----/////  FOR IT  /////----
			if charindex('IT',@Teamid)>0
			begin 
				----//// FOR IT TEAMLEADER ////----
				IF(@ACCESS='ITL1TL' or @ACCESS='ITL2TLO' or @ACCESS='ITL2TLN' or @ACCESS='ITL2TLV')
				BEGIN 
					if @FromDate='' and @ToDate=''
					begin
						IF(@Location='')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username,
										MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and 
										tbl_NewTaskDetails.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance
								group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID    
							Order BY Total_Issues DESC
						END
						IF(@Location<>'')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username,
										MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
										tbl_NewTaskDetails.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance
								group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID    
							Order BY Total_Issues DESC
						END
					End
					Else
					Begin
						IF(@Location='')	
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT 
								issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username, MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and 
										tbl_NewTaskDetails.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID  
							Order BY Total_Issues DESC
						END
						IF(@Location<>'')	
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username, MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and 
										tbl_NewTaskDetails.issue_resolved_by in 
										(select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And MUser_Master.Account_Status=1	
								) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID  
							Order BY Total_Issues DESC
						END
					end
				END
				ELSE ----//// FOR IT EXECUTIVE ////----
				BEGIN
					if @FromDate='' and @ToDate=''
					begin
						IF(@Location='')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
								(
								SELECT issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username, MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									From tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									Where issue_type='IT' and tbl_NewTaskDetails.issue_resolved_by=@EMPID
										and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC   
						END
						IF(@Location<>'')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
								(
								SELECT issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username, MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and tbl_NewTaskDetails.issue_resolved_by=@EMPID
										and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID  
							Order BY Total_Issues DESC  
						END
					end
					else
					begin
						IF(@Location='')	
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
							sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
							sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
								(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username,
										MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									From tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and tbl_NewTaskDetails.issue_resolved_by=@EMPID
										and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC 
						END
						IF(@Location<>'')	
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
							sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
							sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
								(
								SELECT 
								issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
								FROM 
								(
									select tbl_NewTaskDetails.docket_number as Docket_Number,
										tbl_NewTaskDetails.issue_resolved_by,
										MUser_Master.username, MUser_Master.Team_id as Team_id,
										team_master.team_name as Team_Name,
										tbl_NewTaskDetails.status_code as Status_code 
									from tbl_NewTaskDetails 
										join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
										join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
										join (select distinct(team_id),team_name from team_master) as team_master on 
										MUser_Master.Team_id =team_master.team_id 
									where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location and tbl_NewTaskDetails.issue_resolved_by=@EMPID
										and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And MUser_Master.Account_Status=1
								) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID  
							Order BY Total_Issues DESC
						END
					end
				END
			End
			Else
				----/////  FOR EBROKING  /////----		
			Begin
				----//// FOR EBROKING TEAMLEADER ////----
				IF(@ACCESS='L1TL' or @ACCESS='L2FTL' or @ACCESS='L2TTL')
				BEGIN 
					if @FromDate='' and @ToDate=''
					begin
						IF(@Location='')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							From
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
										d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
										And u.Account_Status=1
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC
						END
						IF(@Location<>'')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
								from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID and tlm.branch_name=@Location
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
										d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
										And u.Account_Status=1
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
						END
					end
					else
					begin
						IF(@Location='')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
										d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And u.Account_Status=1
								) as Als_Team_Performance
								group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID   
						END
						IF(@Location<>'')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID and tlm.branch_name=@Location
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
										d.issue_resolved_by in (select distinct Employee_ID from tbl_teamleadermaster where Teamleader=@EMPID)
										and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And u.Account_Status=1
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC
						END
					end
				END
				ELSE ----//// FOR EBROKING EXECUTIVE ////----
				BEGIN
				if @FromDate='' and @ToDate=''
					begin
						IF(@Location='')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
										and	d.issue_resolved_by=@EMPID
										and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate())
										And u.Account_Status=1 
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC
						END
						IF(@Location<>'')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
										and	d.issue_resolved_by=@EMPID and tlm.branch_name=@Location
										and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
										and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
										And u.Account_Status=1
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID  
							Order BY Total_Issues DESC 
						END
					end
					else
					begin
						IF(@Location='')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) and
										d.issue_resolved_by=@EMPID
										and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And u.Account_Status=1
								) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC
						END
						IF(@Location<>'')
						BEGIN
							select issue_resolved_by as [EmpID],username as [Employee],team_id as TeamID,team_name as Team,
								sum(escalated_issues) as Escalated,sum(completed_issues) as Completed,sum(Pending_Issues) as Pending,
								sum(Reassigned_Issues) as Reassigned,sum (Closed_Issues) as Closed,sum (all_issues) as Total_Issues
							from
							(
								SELECT Issue_resolved_by,username,team_id,team_name,
									All_Issues= ISNULL(count(docket_number),0),
									Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
									Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
									Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
									Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
									Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
								FROM 
								(
									select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
										d.issue_resolved_by as Issue_resolved_by,
										u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
									from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
									where d.issue_type='EBro' and d.issue_resolved_by=u.userid and
										u.team_id=tm.team_id and d.team_id=@TeamID 
										and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
										and	d.issue_resolved_by=@EMPID and tlm.branch_name=@Location
										and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
										And u.Account_Status=1
								) as Als_Team_Performance
								group by Issue_resolved_by,username,team_id,team_name,status_code
							) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
							Order BY Total_Issues DESC
						END
					end
				END
			end
		END
	End
--###############################################################################################################--
							--================== Regional Head =================--			
--###############################################################################################################--
	Else If(@ROLE='RH')
	Begin
		If charindex('IT',@Teamid)>0
		Begin
			If @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 			
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID   
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username,
								MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
					Select Issue_Resolved_BY, Username, Team_ID,Team_Name, Escalated_Issues,
						Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues,	Total_Issues
					From
					(	
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT 	issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,	tbl_NewTaskDetails.status_code as Status_code 
								from tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
								where issue_type='IT'  
									And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					
						UNION				
						
						SELECT 	UM.UserID As Issue_resolved_by,UM.Username,TM.Team_id,TM.Team_name,
								'0' As Escalated_Issues, '0' As Completed_Issues,'0' As Pending_Issues,
								'0' As Reassigned_Issues, '0' As Closed_Issues, '0' As Total_Issues
						FROM MUser_Master UM, Team_Master TM
						Where UM.UserID NOT IN
						(
							select Distinct MUser_Master.Userid
							from tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'  
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						)
						And UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID
						And UM.UserID in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
						And UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')	
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
		End
		Else ---- ////////////////// Ebroking ///////////////////----
		Begin
			If @FromDate='' and @ToDate=''
			Begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by, u.username,u.Team_id as Team_id,
								d.status_code as Status_code, tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
 				END
			End
			Else
			Begin
				IF(@Location='')
				BEGIN
					SELECT Issue_Resolved_By,Username,Team_id,Team_name,Total_Issues,Escalated_Issues,
							Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues
					From
					(
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
									and u.team_id=tm.team_id and d.team_id=@TeamID 
									and (d.product_code=vd.product_code or d.product_code=vd.product_name)
									and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1
							) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 		

						UNION

						SELECT UM.UserID As Issue_Resolved_By,UM.username As Username,TM.team_id As Team_ID,TM.team_name As Team_Name,
							'0' As Total_Issues, '0' As Escalated_Issues, '0' As Completed_Issues, '0' As Pending_Issues,
							'0' As Reassigned_Issues, '0' As Closed_Issues
						FROM MUser_Master UM , Team_Master TM
						Where UserID NOT IN
						(
							Select distinct d.issue_resolved_by as Issue_resolved_by
							From tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							Where d.issue_type='EBro' and d.issue_resolved_by=u.userid
								and u.team_id=tm.team_id and d.team_id=@TeamID
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And u.Account_Status=1
						) 
						and UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID 
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,
								tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where regionalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And u.Account_Status=1
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
				END
			End
		End
	End
--###############################################################################################################--
							--================== Cluster Head =================--			
--###############################################################################################################--
	Else If(@ROLE='CH')
	Begin
		If charindex('IT',@Teamid)>0
		Begin
			If @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 			
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID   
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username,
								MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
					Select Issue_Resolved_BY, Username, Team_ID,Team_Name, Escalated_Issues,
						Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues,	Total_Issues
					From
					(	
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT 	issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,	tbl_NewTaskDetails.status_code as Status_code 
								from tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
								where issue_type='IT'  
									And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					
						UNION				
						
						SELECT 	UM.UserID As Issue_resolved_by,UM.Username,TM.Team_id,TM.Team_name,
								'0' As Escalated_Issues, '0' As Completed_Issues,'0' As Pending_Issues,
								'0' As Reassigned_Issues, '0' As Closed_Issues, '0' As Total_Issues
						FROM MUser_Master UM, Team_Master TM
						Where UM.UserID NOT IN
						(
							select Distinct MUser_Master.Userid
							from tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'  
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						)
						And UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')	
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
		End
		Else ---- ////////////////// Ebroking ///////////////////----
		Begin
			If @FromDate='' and @ToDate=''
			Begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by, u.username,u.Team_id as Team_id,
								d.status_code as Status_code, tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
 				END
			End
			Else
			Begin
				IF(@Location='')
				BEGIN
					SELECT Issue_Resolved_By,Username,Team_id,Team_name,Total_Issues,Escalated_Issues,
							Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues
					From
					(
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
									and u.team_id=tm.team_id and d.team_id=@TeamID 
									and (d.product_code=vd.product_code or d.product_code=vd.product_name)
									and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1
							) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 		

						UNION

						SELECT UM.UserID As Issue_Resolved_By,UM.username As Username,TM.team_id As Team_ID,TM.team_name As Team_Name,
							'0' As Total_Issues, '0' As Escalated_Issues, '0' As Completed_Issues, '0' As Pending_Issues,
							'0' As Reassigned_Issues, '0' As Closed_Issues
						FROM MUser_Master UM , Team_Master TM
						Where UserID NOT IN
						(
							Select distinct d.issue_resolved_by as Issue_resolved_by
							From tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							Where d.issue_type='EBro' and d.issue_resolved_by=u.userid
								and u.team_id=tm.team_id and d.team_id=@TeamID
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And u.Account_Status=1
						) 
						and UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID 
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,
								tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where clusterhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And u.Account_Status=1
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
				END
			End
		End
	End
--###############################################################################################################--
							--================== Zonal Head =================--			
--###############################################################################################################--
	Else If(@ROLE='ZH')
	Begin
		If charindex('IT',@Teamid)>0
		Begin
			If @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 			
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID   
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username,
								MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
					Select Issue_Resolved_BY, Username, Team_ID,Team_Name, Escalated_Issues,
						Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues,	Total_Issues
					From
					(	
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT 	issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,	tbl_NewTaskDetails.status_code as Status_code 
								from tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
								where issue_type='IT'  
									And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					
						UNION				
						
						SELECT 	UM.UserID As Issue_resolved_by,UM.Username,TM.Team_id,TM.Team_name,
								'0' As Escalated_Issues, '0' As Completed_Issues,'0' As Pending_Issues,
								'0' As Reassigned_Issues, '0' As Closed_Issues, '0' As Total_Issues
						FROM MUser_Master UM, Team_Master TM
						Where UM.UserID NOT IN
						(
							select Distinct MUser_Master.Userid
							from tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'  
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						)
						And UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')	
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								And tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
		End
		Else ---- ////////////////// Ebroking ///////////////////----
		Begin
			If @FromDate='' and @ToDate=''
			Begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by, u.username,u.Team_id as Team_id,
								d.status_code as Status_code, tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
 				END
			End
			Else
			Begin
				IF(@Location='')
				BEGIN
					SELECT Issue_Resolved_By,Username,Team_id,Team_name,Total_Issues,Escalated_Issues,
							Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues
					From
					(
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
									and u.team_id=tm.team_id and d.team_id=@TeamID 
									and (d.product_code=vd.product_code or d.product_code=vd.product_name)
									and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1
							) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 		

						UNION

						SELECT UM.UserID As Issue_Resolved_By,UM.username As Username,TM.team_id As Team_ID,TM.team_name As Team_Name,
							'0' As Total_Issues, '0' As Escalated_Issues, '0' As Completed_Issues, '0' As Pending_Issues,
							'0' As Reassigned_Issues, '0' As Closed_Issues
						FROM MUser_Master UM , Team_Master TM
						Where UserID NOT IN
						(
							Select distinct d.issue_resolved_by as Issue_resolved_by
							From tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							Where d.issue_type='EBro' and d.issue_resolved_by=u.userid
								and u.team_id=tm.team_id and d.team_id=@TeamID
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And u.Account_Status=1
						) 
						and UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID 
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,
								tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								And d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID in (Select Bibranch From VLMS_RolemasterEquity	Where zonalhead=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And u.Account_Status=1
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
				END
			End
		End
	End
--###############################################################################################################--
							--================== Branch Head =================--			
--###############################################################################################################--
	Else If(@ROLE='BH')
	Begin
		If charindex('IT',@Teamid)>0
		Begin
			If @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 			
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID   
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username,
								MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
					Select Issue_Resolved_BY, Username, Team_ID,Team_Name, Escalated_Issues,
						Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues,	Total_Issues
					From
					(	
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT 	issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,	tbl_NewTaskDetails.status_code as Status_code 
								from tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
								where issue_type='IT'  
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					
						UNION				
						
						SELECT 	UM.UserID As Issue_resolved_by,UM.Username,TM.Team_id,TM.Team_name,
								'0' As Escalated_Issues, '0' As Completed_Issues,'0' As Pending_Issues,
								'0' As Reassigned_Issues, '0' As Closed_Issues, '0' As Total_Issues
						FROM MUser_Master UM, Team_Master TM
						Where UM.UserID NOT IN
						(
							select Distinct MUser_Master.Userid
							from tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'  
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						)
						And UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')	
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
		End
		Else ---- ////////////////// Ebroking ///////////////////----
		Begin
			If @FromDate='' and @ToDate=''
			Begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by, u.username,u.Team_id as Team_id,
								d.status_code as Status_code, tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
 				END
			End
			Else
			Begin
				IF(@Location='')
				BEGIN
					SELECT Issue_Resolved_By,Username,Team_id,Team_name,Total_Issues,Escalated_Issues,
							Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues
					From
					(
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
									and u.team_id=tm.team_id and d.team_id=@TeamID 
									and (d.product_code=vd.product_code or d.product_code=vd.product_name)
									and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1
							) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 		

						UNION

						SELECT UM.UserID As Issue_Resolved_By,UM.username As Username,TM.team_id As Team_ID,TM.team_name As Team_Name,
							'0' As Total_Issues, '0' As Escalated_Issues, '0' As Completed_Issues, '0' As Pending_Issues,
							'0' As Reassigned_Issues, '0' As Closed_Issues
						FROM MUser_Master UM , Team_Master TM
						Where UserID NOT IN
						(
							Select distinct d.issue_resolved_by as Issue_resolved_by
							From tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							Where d.issue_type='EBro' and d.issue_resolved_by=u.userid
								and u.team_id=tm.team_id and d.team_id=@TeamID
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And u.Account_Status=1
						) 
						and UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID 
						And UM.Branch_ID=@LocationOrBranch and UM.Role_ID not in ('BH', 'RH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,
								tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And u.Account_Status=1
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
				END
			End
		End
	End
	Else If(@ROLE='ITM')
	Begin
		If charindex('IT',@Teamid)>0
		Begin
			If @FromDate='' and @ToDate=''
			begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 			
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID   
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username,
								MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where Branch_ID=@LocationOrBranch and Role_ID not in ('BH', 'RH'))
								and datepart(mm,tbl_NewTaskDetails.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,tbl_NewTaskDetails.issue_raised_datetime)=datepart(yyyy,getdate())
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having  team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
			else
			begin
				IF(@Location='')	
				BEGIN
					Select Issue_Resolved_BY, Username, Team_ID,Team_Name, Escalated_Issues,
						Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues,	Total_Issues
					From
					(	
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT 	issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
							FROM 
							(
								select tbl_NewTaskDetails.docket_number as Docket_Number,
									tbl_NewTaskDetails.issue_resolved_by,
									MUser_Master.username, MUser_Master.Team_id as Team_id,
									team_master.team_name as Team_Name,	tbl_NewTaskDetails.status_code as Status_code 
								from tbl_NewTaskDetails 
									join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
									join (select distinct(team_id),team_name from team_master) as team_master on 
									MUser_Master.Team_id =team_master.team_id 
								where issue_type='IT'  
									and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
									And MUser_Master.Account_Status=1
							) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					
						UNION				
						
						SELECT 	UM.UserID As Issue_resolved_by,UM.Username,TM.Team_id,TM.Team_name,
								'0' As Escalated_Issues, '0' As Completed_Issues,'0' As Pending_Issues,
								'0' As Reassigned_Issues, '0' As Closed_Issues, '0' As Total_Issues
						FROM MUser_Master UM, Team_Master TM
						Where UM.UserID NOT IN
						(
							select Distinct MUser_Master.Userid
							from tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on MUser_Master.Team_id =team_master.team_id 
							Where issue_type='IT'  
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						)
						And UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID
						And UM.Branch_ID in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH')) And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')	
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('ITEL2N','ITEL2O','ITEL2V','ITEL3','ITL1E') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('ITC')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('ITP','ITUP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('ITL1R','ITL2RN','ITL2RO','ITL2RV','ITL3R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X') THEN count(docket_number) END,0)
						FROM 
						(
							select tbl_NewTaskDetails.docket_number as Docket_Number,
								tbl_NewTaskDetails.issue_resolved_by,
								MUser_Master.username, MUser_Master.Team_id as Team_id,
								team_master.team_name as Team_Name,
								tbl_NewTaskDetails.status_code as Status_code 
							From tbl_NewTaskDetails 
								join MUser_Master on MUser_Master.userid=tbl_NewTaskDetails.issue_resolved_by
								join (select distinct(team_id),team_name from team_master) as team_master on 
								MUser_Master.Team_id =team_master.team_id 
								join tbl_teamleadermaster on tbl_teamleadermaster.Branch_Id=MUser_Master.Branch_Id
							where issue_type='IT' and tbl_teamleadermaster.branch_name=@Location
								and tbl_NewTaskDetails.issue_resolved_by in (select distinct userid from MUser_Master where team_id=@TeamID)
								and tbl_NewTaskDetails.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and tbl_NewTaskDetails.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And MUser_Master.Account_Status=1
						) as Als_Team_Performance Group by status_code,issue_resolved_by,username,team_id,team_name
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
			end
		End
		Else ---- ////////////////// Ebroking ///////////////////----
		Begin
			If @FromDate='' and @ToDate=''
			Begin
				IF(@Location='')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by, u.username,u.Team_id as Team_id,
								d.status_code as Status_code, tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name)
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and datepart(mm,d.issue_raised_datetime)= datepart(mm,getdate()) 
								and datepart(yyyy,d.issue_raised_datetime)= datepart(yyyy,getdate()) 
								And u.Account_Status=1
						) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
 				END
			End
			Else
			Begin
				IF(@Location='')
				BEGIN
					SELECT Issue_Resolved_By,Username,Team_id,Team_name,Total_Issues,Escalated_Issues,
							Completed_Issues, Pending_Issues, Reassigned_Issues, Closed_Issues
					From
					(
						select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
							sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
							sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
							sum (all_issues) as Total_Issues 
						from
						(
							SELECT Issue_resolved_by,username,team_id,team_name,
								All_Issues= ISNULL(count(docket_number),0),
								Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
								Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
								Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
								Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
								Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
							FROM 
							(
								select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
									d.issue_resolved_by as Issue_resolved_by,
									u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
								from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
								where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
									and u.team_id=tm.team_id and d.team_id=@TeamID 
									and (d.product_code=vd.product_code or d.product_code=vd.product_name)
									and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
									and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
									and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
									And u.Account_Status=1
							) as Als_Team_Performance Group by Issue_resolved_by,username,team_id,team_name,status_code
						) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID 		

						UNION

						SELECT UM.UserID As Issue_Resolved_By,UM.username As Username,TM.team_id As Team_ID,TM.team_name As Team_Name,
							'0' As Total_Issues, '0' As Escalated_Issues, '0' As Completed_Issues, '0' As Pending_Issues,
							'0' As Reassigned_Issues, '0' As Closed_Issues
						FROM MUser_Master UM , Team_Master TM
						Where UserID NOT IN
						(
							Select distinct d.issue_resolved_by as Issue_resolved_by
							From tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd
							Where d.issue_type='EBro' and d.issue_resolved_by=u.userid
								and u.team_id=tm.team_id and d.team_id=@TeamID
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate)
								And u.Account_Status=1
						) 
						and UM.Team_ID=TM.Team_ID and UM.Team_ID=@TeamID 
						And UM.Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH') And um.Account_Status=1
					) T
					Order BY Total_Issues DESC
				END
				IF(@Location<>'')
				BEGIN
					select	issue_resolved_by,username,team_id,team_name ,sum(escalated_issues) as Escalated_Issues,
						sum(completed_issues) as Completed_issues,sum(Pending_Issues) as Pending_Issues,
						sum(Reassigned_Issues) as Reassigned_Issues,sum (Closed_Issues) as Closed_Issues,
						sum (all_issues) as Total_Issues 
					from
					(
						SELECT Issue_resolved_by,username,team_id,team_name,
							All_Issues= ISNULL(count(docket_number),0),
							Escalated_Issues= ISNULL(CASE WHEN status_code in ('E3','EF','ET') THEN count(docket_number) END,0),
							Completed_Issues=ISNULL(CASE WHEN status_code in ('C')  THEN count(docket_number) END,0),
							Pending_Issues=ISNULL(CASE WHEN status_code in ('P','UP')  THEN count(docket_number) END,0),
							Reassigned_Issues=ISNULL(CASE WHEN status_code in ('R')  THEN count(docket_number) END,0),
							Closed_Issues=ISNULL(CASE WHEN status_code in ('X')  THEN count(docket_number) END,0)
						FROM 
						(
							select distinct d.tt_number,d.docket_number as Docket_Number,d.client_code,
								d.issue_resolved_by as Issue_resolved_by,
								u.username,u.Team_id as Team_id,d.status_code as Status_code,tm.Team_name as team_name
							from tbl_NewTaskDetails d, MUser_Master u,team_master tm, vendor_product vd,
								tbl_teamleadermaster tlm
							where d.issue_type='EBro' and d.issue_resolved_by=u.userid 
								and u.team_id=tm.team_id and d.team_id=@TeamID 
								and tlm.branch_name=@Location and tlm.Branch_Id=u.Branch_Id
								and (d.product_code=vd.product_code or d.product_code=vd.product_name) 
								and d.issue_resolved_by in (select userid from MUser_Master where team_id=@TeamID)
								and d.Issue_Resolved_BY in (Select UserID From MUser_Master Where  Branch_ID in (Select BranchTag From tbl_MISBranch Where Emp_ID=@USER) and Role_ID not in ('BH', 'RH','ZH','CH'))
								and d.issue_raised_datetime between @FromDate and dateadd(dd,1,@ToDate) 
								And u.Account_Status=1
						) as Als_Team_Performance
						group by Issue_resolved_by,username,team_id,team_name,status_code
					) as Temp group by username,issue_resolved_by,team_id,team_name having team_id=@TeamID
					Order BY Total_Issues DESC
				END
			End
		End
	End
	
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MISReport_OUTBOUNDS
-- --------------------------------------------------


CREATE proc [dbo].[usp_MISReport_OUTBOUNDS]

--Created By	: Sanjay Lavu Kudtarkar
--Modified By	: Mahendra Bonde

@Employee nvarchar(50),
@Catagory nvarchar(50)
as

	select Y.Location,X.Client_Name as [Client Name],X.Remarks,@Employee as [Confirmation Taken By],Y.Servers as [Server],X.CallMadeTime as [Call made Data/Time] 
	from (select NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
		  inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id where NTD.Issue_Resolved_By = @Employee and NTD.Call_Type = 'OUTBOUND' and NTD.Nature = @Catagory) as X
	  inner join
		 (select Distinct (OM.Odin_Id) as Client_Code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
		  inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y
	  on X.Client_Code = Y.Client_Code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_MISReport_OUTBOUNDS2
-- --------------------------------------------------


CREATE proc [dbo].[usp_MISReport_OUTBOUNDS2]

--Created By	: Sanjay Lavu Kudtarkar
--Modified By	: Mahendra Bonde

@FromDate as nvarchar(22),
@ToDate as nvarchar(22),
@Category nvarchar(50)
as
	if(upper(@Category) != upper('All') and @FromDate='' and @ToDate='')
		--current month with selected category
		begin
			select YY.Location,XX.client_code as [Client Code(OdinID)],yy.sub_broker_code as [Sub Broker Tag],XX.Remarks,XX.Employee as [Confirmation Taken By],YY.Servers as [Server],XX.CallMadeTime as [Call made Data/Time] 
			from (select Client_Code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
			ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
			FROM (select NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
			inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
			join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
			where NTD.Call_Type = 'OUTBOUND'  and upper(ntd.nature)=upper(@category) and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate())) as X) as M where M.DuplicateCount = 1) as XX
			inner join
			(
			select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
			ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
			FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
			inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
			on XX.Client_Code = YY.Client_Code 
		end

	if(upper(@Category) = upper('All') and @FromDate='' and @ToDate='')
		-- current month with all
		begin
		select YY.Location,XX.client_code as [Client Code(OdinID)],yy.sub_broker_code as [Sub Broker Tag],XX.Remarks,XX.Employee as [Confirmation Taken By],YY.Servers as [Server],XX.CallMadeTime as [Call made Data/Time] 
		from (select Client_Code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
			ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
			FROM (select NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
			inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
			join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
			where NTD.Call_Type = 'OUTBOUND' and datepart(mm,ntd.issue_raised_datetime)=datepart(mm,getdate()) ) as X) as M where M.DuplicateCount = 1) as XX
			inner join
			 (	select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
			ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
			FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
			inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
			on XX.Client_Code = YY.Client_Code 
		end

		if(upper(@Category) != upper('All')  and @FromDate!='' and @ToDate!='')
		--periodic with selected category
		begin
			select YY.Location,XX.client_code as [Client Code(OdinID)],yy.sub_broker_code as [Sub Broker Tag],XX.Remarks,XX.Employee as [Confirmation Taken By],YY.Servers as [Server],XX.CallMadeTime as [Call made Data/Time] 
			from (select Client_Code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
			ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
			FROM (select NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
			inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
			join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
			where NTD.Call_Type = 'OUTBOUND' and upper(ntd.nature)=upper(@category) and ntd.issue_raised_datetime between @fromdate and dateadd(dd,1,@todate)) as X) as M where M.DuplicateCount = 1) as XX
			inner join
			 (	select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
			ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
			FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code, PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
			inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code ) as Y)as Z where Z.DuplicateCount = 1) as YY
			on XX.Client_Code = YY.Client_Code 
		end

	if(upper(@Category) = upper('All') and @FromDate!='' and @ToDate!='')
		-- periodic with all
		begin
		select YY.Location,XX.client_code as [Client Code(OdinID)],yy.sub_broker_code as [Sub Broker Tag],XX.Remarks,XX.Employee as [Confirmation Taken By],YY.Servers as [Server],XX.CallMadeTime as [Call made Data/Time] 
		from (select Client_Code,Nature,CRE,Client_Name,Remarks,Employee, CallMadeTime,DuplicateCount from (select X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime,
			ROW_NUMBER() OVER(PARTITION BY X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.Employee,X.CallMadeTime ORDER BY  X.Client_Code,X.Nature,X.CRE,X.Client_Name,X.Remarks,X.CallMadeTime) AS DuplicateCount
			FROM (select NTD.Client_Code as Client_Code,NTD.Nature,NTD.Issue_Resolved_By as CRE, NTD.Contact_Person as Client_Name,MUser_Master.username as Employee, NTD.Client_Remark as Remarks,NTD.Issue_Raised_DateTime as CallMadeTime from tbl_NewTaskDetails as NTD 
			inner join tbl_it_odinmaster as OM on NTD.Client_Code = OM.Odin_Id 
			join MUser_Master on NTD.issue_Resolved_by=MUser_Master.userid
			where NTD.Call_Type = 'OUTBOUND' and ntd.issue_raised_datetime between @fromdate and dateadd(dd,1,@todate)) as X) as M where M.DuplicateCount = 1) as XX
			inner join
			 (select Client_Code,SUB_Broker_code,Location,Servers from (SELECT Y.Client_Code,y.SUB_Broker_code,Y.Location,Y.Servers,
			ROW_NUMBER() OVER(PARTITION BY Y.Client_Code ORDER BY Y.Client_Code,Y.Location,Y.Servers) AS DuplicateCount
			FROM (select OM.Odin_Id as Client_Code,OM.SB_Code as SUB_Broker_code ,PM.Location as Location, PM.RM_Manager_Code as Servers from tbl_it_odinmaster as OM 
			inner join tbl_it_productmaster as PM on OM.Odin_Manager_Code = PM.Odin_Manager_Code) as Y)as Z where Z.DuplicateCount = 1) as YY
			on XX.Client_Code = YY.Client_Code 
		end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NEWUSER_INFO
-- --------------------------------------------------






CREATE PROC [dbo].[USP_NEWUSER_INFO] 
@UID AS VARCHAR(20)
AS
SELECT USERID,USERNAME,TEAM_ID,ROLE_ID,TEAMLEADER,ACCESS_ID,CREATION_DATE,ACCOUNT_STATUS
FROM USER_MASTER
WHERE USERID=@UID

Select [Emp No] As EMP_NO, Emp_Name As EMP_NAME, Birthdate As BIRTHDATE, 
		emailadd As EMAIL, Phone As PHONE, CostCode As BRANCH_CD
FROM [196.1.115.158].Helpdesk.DBO.VLMSInhouse
WHERE [Emp No]=@UID

--SELECT EMP_NO,EMP_NAME,BIRTHDATE,EMAIL,PHONE,BRANCH_CD
--FROM MISSC.DBO.EMPLOYEE_MASTER
--WHERE EMP_NO=@UID

If EXISTS(SELECT TEAMLEADER FROM TBL_TEAMLEADERMASTER WHERE EMPLOYEE_ID=@UID)
	SELECT TEAMLEADER FROM TBL_TEAMLEADERMASTER WHERE EMPLOYEE_ID=@UID
Else
	Select '' As TEAMLEADER

--SELECT Isnull(TEAMLEADER,0) FROM TBL_TEAMLEADERMASTER
--WHERE EMPLOYEE_ID=@UID

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PDA_DocketHistory
-- --------------------------------------------------



CREATE Proc [dbo].[USP_PDA_DocketHistory]
@Client_code As varchar(20)
As

Begin

	Select top 10 Docket_Number,  VD.Product_Name, Problem, Brief_Solution, Client_Remark, 
		Issue_Raised_Datetime, Issue_Resolved_Datetime,
				Replace((d.L1_InitialRemark + d.L1_FinalRemark + d.L2_UserRemark + d.L3_UserRemark),'\n','==||==') AS Remark,
				jobStatus_name As Status
	From tbl_NewClient_Details D, Vendor_Product VD, jobstatusmaster JS
	Where (D.Product_Code=VD.Product_Code or D.Product_Code=VD.Product_name) 
			and D.status_code=JS.jobstatus_ID and Issue_Type='EBro' and Client_code=@Client_code
	Order By Issue_Resolved_Datetime DESC

End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_RiskClientDetailsUpdate
-- --------------------------------------------------
/*----------------------------------------------
	Create Date:-		04/03/2010
	Last Modified Date:-04/03/2010
	Porcedure Name:-	usp_UpdateHelpdeskClientMaster
	Purpose:-           Updating the Helpdesk Client_Master Table
*/-----------------------------------------------


CREATE proc [dbo].[usp_RiskClientDetailsUpdate]
as
update Client_Master set
	Client_Master.Short_Name=left(Risk.Short_Name,60),
	Client_Master.Long_Name=left(Risk.Long_Name,150),
	Client_Master.DOB=Risk.DOB,
	Client_Master.Branch_Code=left(Risk.branch_cd,15),
	Client_Master.Subbroker_Code=left(Risk.sub_broker,15),
	Client_Master.Region_Code=left(Risk.region,15),
	Client_Master.Zone_Code='',
	Client_Master.Active_From=Risk.First_Active_date,
	Client_Master.PAN_Number=Risk.pan_gir_no,
	Client_Master.Address=left(Risk.l_address1,100),
	Client_Master.Address1=left(Risk.l_address2,60),
	Client_Master.Address2=left(Risk.l_address3,60),
	Client_Master.City=left(Risk.l_city,60),
	Client_Master.State=left(Risk.l_state,60),
	Client_Master.Country=left(Risk.l_nation,60),
	Client_Master.Permanent_Address=left(rtrim(ltrim(Risk.p_address1))+ '' + rtrim(ltrim(Risk.p_address2)) + '' +rtrim(ltrim(Risk.p_address3))+''+rtrim(ltrim(Risk.p_city))+''+rtrim(ltrim(Risk.p_state)),100),
	Client_Master.Landline_Number1=left(Risk.res_phone1,15),
	Client_Master.Landline_Number2=left(Risk.res_phone2,15),
	Client_Master.Office_Number1=left(Risk.off_phone1,15),
	Client_Master.Office_Number2=left(Risk.off_phone2,15),
	Client_Master.Mobile=left(Risk.mobile_pager,20),
	Client_Master.Email=left(Risk.email,100)
	from Client_Master,[INTRANET].risk.dbo.Client_details as Risk  
	where Client_Master.Client_Code=left(Risk.party_code,15)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SA_EM_submit
-- --------------------------------------------------


CREATE PROC [dbo].[usp_SA_EM_submit]
@Userid		varchar(15),
@UserName	varchar(120),
@DOB		datetime,
@Team_Id	char(15),
@Role_Id	char(15),
@TeamLeader	char(15),
@Branch_Id	char(15),
@Contact_Number	char(15),
@Mobile			char(15),
@Email			varchar(120),
@Access_Id		char(15),
@Creation_Date	datetime,
@Account_Status	char(15),
@option		char(15)
as
if @option='I'
		begin
			insert into user_master values(@Userid,@UserName,@DOB,@Team_Id,@Role_Id,@TeamLeader,@Branch_Id,@Contact_Number,@Mobile,@Email,@Access_Id,@Creation_Date,@Account_Status,'','','123')
 		end
if @option='U'
		begin
			update user_master 
			set Userid=@Userid,UserName=@UserName,DOB=@DOB,Team_Id=@Team_Id,Role_Id=@Role_Id,TeamLeader=@TeamLeader,Branch_Id=@Branch_Id,Contact_Number=@Contact_Number,Mobile=@Mobile,Email=@Email,Access_Id=@Access_Id,Creation_Date=@Creation_Date,Account_Status=@Account_Status 
			Where Userid=@Userid
 		end
if @option='D'
		begin
			delete from user_master 
			Where Userid=@Userid
		end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SA_EM_submit_New
-- --------------------------------------------------


CREATE PROC [dbo].[usp_SA_EM_submit_New]
@Userid		varchar(15),
@UserName	varchar(120),
@DOB		datetime,
@Team_Id	char(15),
@Role_Id	char(15),
@TeamLeader	char(15),
@TeamLeader2 char(15),
@Branch_Id	char(15),
@Contact_Number	char(15),
@Mobile			char(15),
@Email			varchar(120),
@Access_Id		char(15),
@Creation_Date	datetime,
@Account_Status	char(15),
@option		char(15)
as

declare 
@branch_name as Varchar(20)
set @branch_name=(Select branch_name from tbl_branch_master where branch_code=@Branch_Id)


if @option='I'
		begin

			insert into user_master (UserID, USerName, DOB, Team_ID, Role_ID, Teamleader, Branch_ID, Contact_Number,Mobile,Email,ACCESS_ID,Creation_Date,Account_Status,Login_Status,Lastlogin,Password,Separation_Date)
			values(@Userid,@UserName,@DOB,@Team_Id,@Role_Id,@TeamLeader,@Branch_Id,@Contact_Number,@Mobile,@Email,@Access_Id,@Creation_Date,@Account_Status,'1','','123',Convert(Datetime,'1900-01-01'))

			insert into tbl_teamleadermaster 
			values (@Userid,@TeamLeader,@Branch_Id,@branch_name)

			if(@TeamLeader2<>'')
			Begin
				insert into tbl_teamleadermaster 
				values (@Userid,@TeamLeader2,@Branch_Id,@branch_name)
			End

 		end
if @option='U'
		begin
			update user_master 
			set Userid=@Userid,UserName=@UserName,DOB=@DOB,Team_Id=@Team_Id,Role_Id=@Role_Id,
			TeamLeader=@TeamLeader,Branch_Id=@Branch_Id,Contact_Number=@Contact_Number,Mobile=@Mobile,
			Email=@Email,Access_Id=@Access_Id,Creation_Date=@Creation_Date,Account_Status=@Account_Status 
			Where Userid=@Userid

			update tbl_teamleadermaster
			set Employee_Id=@Userid,TeamLeader=@TeamLeader,Branch_Id=@Branch_Id,Branch_name=@branch_name
			where Employee_Id=@Userid 
			
			
			if(@TeamLeader2<>'')
			Begin
				print @TeamLeader2
				delete from tbl_teamleadermaster where Employee_Id=@Userid
				insert into tbl_teamleadermaster values (@Userid,@TeamLeader,@Branch_Id,@branch_name)
				insert into tbl_teamleadermaster values (@Userid,@TeamLeader2,@Branch_Id,@branch_name)
			End
 		end
if @option='D'
		begin
			delete from user_master 
			Where Userid=@Userid
		end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_SA_UserLogin
-- --------------------------------------------------

create proc [dbo].[usp_SA_UserLogin]
@user_id varchar (15),
@password nvarchar(25)
as 
declare @acces as nvarchar(50)
set @acces = (select Role_id from user_master where userid=@user_id)
if(@acces='SurveillanceEx')
begin
	select UM.UserName,UM.Role_ID,RM.Role_Name from User_Master as UM join Role_Master as RM on UM.Role_id=RM.Role_id Where userid=@user_id and password=@password
--	select * from user_master where userid=@user_id and password=@password
end
else
begin
	select UM.UserName,UM.Role_ID,RM.Role_Name from User_Master as UM join Role_Master as RM on UM.Role_id=RM.Role_id Where userid=@user_id
--	select * from user_master where userid=@user_id	
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPDATE_USER_Branch
-- --------------------------------------------------
  
CREATE Proc [dbo].[USP_UPDATE_USER_Branch]  
 ----Update User_Master (Branch And Account_Status) From   
 -- Old Source : [196.1.115.158].[MISSC].DBO.Emp_Master  
 -- New Source : [MIDDLEWARE].[Harmony].dbo.VLMSInhouse  
 ---- Execute on Weekly Basis  
As  
Begin  
  
 Select USERID  
 Into #empid  
 From User_Master Order By USERID  
  
 Select [Emp No] As emp, [Costcode] As branch  
 Into #branch  
 --From [196.1.115.158].[MISSC].DBO.Emp_Master  
 From [MIDDLEWARE].[Harmony].dbo.VLMSInhouse  
 Where [Emp No] In (Select USERID From #empid)  
  
 Declare @EMP As Varchar(20)  
 Declare @Branch As Varchar(30)  
 Declare @Total As Int  
 Declare @Count As Int  
  
 Set @Total = (Select Count(userid) From #empid)  
 Set @Count = 0;  
  
 While (@Count < @Total)  
 Begin  
  Set @Emp = (Select top 1 emp From #branch)  
  Set @Branch = (Select top 1 branch From #branch)  
  
  Update User_Master  
  Set Branch_ID=@Branch  
  Where userid=@Emp  
  
  Delete #branch  
  Where emp=@Emp    
  
  Set @Count = @Count + 1  
 End  
  
 Drop Table #empid  
 Drop Table #branch  
  
  
 Update User_Master  
 Set Account_Status=0  
 Where Userid in (Select [Emp No] From [MIDDLEWARE].[Harmony].dbo.VLMSInhouse Where Status not in ('A'))  
  
 Update User_Master  
 Set Account_Status=1  
 Where Userid in (Select [Emp No] From [MIDDLEWARE].[Harmony].dbo.VLMSInhouse Where Status in ('A'))  
   
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPDATE_VLMSINHOUSE_Daily
-- --------------------------------------------------
CREATE PROC [dbo].[USP_UPDATE_VLMSINHOUSE_Daily]  
 --Created By : Mahendra Bonde  
 --Created On : 28 DEC 2010  
 --Description : Update Daily VLMSINHOUSE From [MIDDLEWARE].[HARMONY] At 6 AM Sunday  
As  
Begin  
  
 Insert Into VLMSInhouse  
 Select * From [MIDDLEWARE].[HARMONY].DBO.VLMSInhouse with (nolock)  
 Where [Emp No] in ( Select Distinct [Emp No] From [MIDDLEWARE].[HARMONY].DBO.VLMSInhouse with (nolock)  
  Where [Emp NO] not in ( Select Distinct [Emp No] From VLMSInhouse with (nolock)))  
   
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateClientMaster
-- --------------------------------------------------

/*----------------------------------------------
	Author:-			Nachiket Bhingarde
	Create Date:-		12/11/2009
	modified Date:-		12/11/2009
	Porcedure Name:-	usp_UpdateClientMaster156_new
	Purpose:-           Updating the Client_Master Table
*/-----------------------------------------------

CREATE Proc [dbo].[usp_UpdateClientMaster]
--@varOption nvarchar(15)

as
--Insert new added client from riskinfo  to Helpdesk client Master
	insert into Client_Master
	SELECT  left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
	'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,First_Active_date as Active_From,pan_gir_no as PAN_Number,'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
	left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,
	left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda 
	FROM [196.1.115.132].risk.dbo.Client_details as A where A.party_code not in (select client_code from Client_Master)

--Update account status and product informatin of clients from PDA Client Master  to Helpdesk client Master
	update Client_Master set 
		Client_Master.Online_Client=isnull(PDA_Client_Master.Account_Status,0),
		Client_Master.Product_Code=isnull(PDA_Client_Master.primary_product,''),
		Client_Master.Manager_Code=isnull(PDA_Client_Master.Manager_Code,''),
		Client_Master.Account_Status=isnull(PDA_Client_Master.Account_Status,0),
		Client_Master.BSE=isnull(PDA_Client_Master.BSE,0),
		Client_Master.NSE=isnull(PDA_Client_Master.NSE,0),
		Client_Master.NSEFO=isnull(PDA_Client_Master.NSEFO,0),
		Client_Master.MCX=isnull(PDA_Client_Master.MCX,0),
		Client_Master.NCDEX=isnull(PDA_Client_Master.NCDEX,0)			
	from Client_Master join [196.1.115.156].pda4.dbo.Client_master	as PDA_Client_Master
	on client_master.Client_Code=PDA_Client_Master.Client_Code		

--if @varOption='Anywhere'
--	begin
--		--Adding the newly created client from the 196.1.115.132 risk_info database
--		insert into client_master
--		SELECT left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,
--		'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
--		'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,	First_Active_date as Active_From,pan_gir_no as PAN_Number,
--		'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
--		left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,
--		left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,
--		left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,
--		left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda 
--		FROM [196.1.115.132].risk.dbo.Client_details as A 
--		where A.party_code not in (select client_code from client_master)
--		
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Anywhere')) drop table Anywhere
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Anywhere')) 
--		select * into Anywhere FROM [196.1.115.156].PDA4.dbo.Anywhere$
--		update client_master set online_client=0,Account_Status=0
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Anywhere.Product,''),
--		Client_master.Secondary_Product=isnull(Anywhere.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Anywhere.Manager,''),
--		Client_master.Account_Status=isnull(Anywhere.Status,0) from client_master join Anywhere on client_master.Client_Code=Anywhere.Client_Code
--	end
--if @varOption='Anywhere43'
--	begin
--		--Adding the newly created client from the 196.1.115.132 risk_info database
--		insert into client_master
--		SELECT left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,
--		'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
--		'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,	First_Active_date as Active_From,pan_gir_no as PAN_Number,
--		'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
--		left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,
--		left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,
--		left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,
--		left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda 
--		FROM [196.1.115.132].risk.dbo.Client_details as A 
--		where A.party_code not in (select client_code from client_master)
--		
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Anywhere43')) drop table Anywhere43
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Anywhere43')) 
--		select * into Anywhere43 FROM [196.1.115.156].PDA4.dbo.Anywhere43$
--		update client_master set online_client=0,Account_Status=0
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Anywhere43.Product,''),
--		Client_master.Secondary_Product=isnull(Anywhere43.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Anywhere43.Manager,''),
--		Client_master.Account_Status=isnull(Anywhere43.Status,0) from client_master join Anywhere43 on client_master.Client_Code=Anywhere43.Client_Code
--	end
--if @varOption='Odins12'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins12')) drop table Odins12
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins12')) select * into Odins12 FROM [196.1.115.156].PDA4.dbo.Odins12$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins12.Product,''),
--		Client_master.Secondary_Product=isnull(Odins12.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins12.Manager,''),
--		Client_master.Account_Status=isnull(Odins12.Status,0) from client_master join Odins12 on client_master.Client_Code=Odins12.Client_Code
--	end
--if @varOption='Odins15'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins15')) drop table Odins15
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins15')) select * into Odins15 FROM [196.1.115.156].PDA4.dbo.Odins15$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins15.Product,''),
--		Client_master.Secondary_Product=isnull(Odins15.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins15.Manager,''),
--		Client_master.Account_Status=isnull(Odins15.Status,0) from client_master join Odins15 on client_master.Client_Code=Odins15.Client_Code
--	end
--if @varOption='Odins16'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins16')) drop table Odins16
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins16')) select * into Odins16 FROM [196.1.115.156].PDA4.dbo.Odins16$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins16.Product,''),
--		Client_master.Secondary_Product=isnull(Odins16.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins16.Manager,''),
--		Client_master.Account_Status=isnull(Odins16.Status,0) from client_master join Odins16 on client_master.Client_Code=Odins16.Client_Code
--	end
--if @varOption='Odins18'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins18')) drop table Odins18
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins18')) select * into Odins18 FROM [196.1.115.156].PDA4.dbo.Odins18$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins18.Product,''),
--		Client_master.Secondary_Product=isnull(Odins18.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins18.Manager,''),
--		Client_master.Account_Status=isnull(Odins18.Status,0) from client_master join Odins18 on client_master.Client_Code=Odins18.Client_Code
--	end
--if @varOption='Odins20'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins20')) drop table Odins20
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins20')) select * into Odins20 FROM [196.1.115.156].PDA4.dbo.Odins20$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins20.Product,''),
--		Client_master.Secondary_Product=isnull(Odins20.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins20.Manager,''),
--		Client_master.Account_Status=isnull(Odins20.Status,0) from client_master join Odins20 on client_master.Client_Code=Odins20.Client_Code
--	end
--if @varOption='Odins24'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins24')) drop table Odins24
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins24')) select * into Odins24 FROM [196.1.115.156].PDA4.dbo.Odins24$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins24.Product,''),
--		Client_master.Secondary_Product=isnull(Odins24.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins24.Manager,''),
--		Client_master.Account_Status=isnull(Odins24.Status,0) from client_master join Odins24 on client_master.Client_Code=Odins24.Client_Code
--	end
--if @varOption='Odins28'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins28')) drop table Odins28
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins28')) select * into Odins28 FROM [196.1.115.156].PDA4.dbo.Odins28$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins28.Product,''),
--		Client_master.Secondary_Product=isnull(Odins28.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins28.Manager,''),
--		Client_master.Account_Status=isnull(Odins28.Status,0) from client_master join Odins28 on client_master.Client_Code=Odins28.Client_Code
--	end
--if @varOption='Odins30'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins30')) drop table Odins30
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins30')) select * into Odins30 FROM [196.1.115.156].PDA4.dbo.Odins30$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins30.Product,''),
--		Client_master.Secondary_Product=isnull(Odins30.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins30.Manager,''),
--		Client_master.Account_Status=isnull(Odins30.Status,0) from client_master join Odins30 on client_master.Client_Code=Odins30.Client_Code
--	end
--if @varOption='Odins32'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins32')) drop table Odins32
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins32')) select * into Odins32 FROM [196.1.115.156].PDA4.dbo.Odins32$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins32.Product,''),
--		Client_master.Secondary_Product=isnull(Odins32.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins32.Manager,''),
--		Client_master.Account_Status=isnull(Odins32.Status,0) from client_master join Odins32 on client_master.Client_Code=Odins32.Client_Code
--	end
--if @varOption='Odins34'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins34')) drop table Odins34
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins34')) select * into Odins34 FROM [196.1.115.156].PDA4.dbo.Odins34$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins34.Product,''),
--		Client_master.Secondary_Product=isnull(Odins34.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins34.Manager,''),
--		Client_master.Account_Status=isnull(Odins34.Status,0) from client_master join Odins34 on client_master.Client_Code=Odins34.Client_Code
--	end
--if @varOption='Odins35'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins35')) drop table Odins35
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins35')) select * into Odins35 FROM [196.1.115.156].PDA4.dbo.Odins35$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins35.Product,''),
--		Client_master.Secondary_Product=isnull(Odins35.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins35.Manager,''),
--		Client_master.Account_Status=isnull(Odins35.Status,0) from client_master join Odins35 on client_master.Client_Code=Odins35.Client_Code
--	end
--if @varOption='Odins38'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins38')) drop table Odins38
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins38')) select * into Odins38 FROM [196.1.115.156].PDA4.dbo.Odins38$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins38.Product,''),
--		Client_master.Secondary_Product=isnull(Odins38.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins38.Manager,''),
--		Client_master.Account_Status=isnull(Odins38.Status,0) from client_master join Odins38 on client_master.Client_Code=Odins38.Client_Code
--	end
--if @varOption='Odins41'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins41')) drop table Odins41
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins41')) select * into Odins41 FROM [196.1.115.156].PDA4.dbo.Odins41$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins41.Product,''),
--		Client_master.Secondary_Product=isnull(Odins41.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins41.Manager,''),
--		Client_master.Account_Status=isnull(Odins41.Status,0) from client_master join Odins41 on client_master.Client_Code=Odins41.Client_Code
--	end
--
--if @varOption='Odins65'
--	begin
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Odins65')) drop table Odins65
--		if not exists (select * from sys.objects where [object_id] = object_id('dbo.Odins65')) select * into Odins65 FROM [196.1.115.156].PDA4.dbo.Odins65$
--		update client_master set Client_master.Online_Client='1',
--		Client_master.Product_Code=isnull(Odins65.Product,''),
--		Client_master.Secondary_Product=isnull(Odins65.Secondary_Product,''),
--		Client_master.Manager_Code=isnull(Odins65.Manager,''),
--		Client_master.Account_Status=isnull(Odins65.Status,0) from client_master join Odins65 on client_master.Client_Code=Odins65.Client_Code
--	end
--
--if @varOption='Others'
--	begin
--		--Adding the newly created client from the 196.1.115.132 risk_info database
--		insert into client_master
--		SELECT left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
--		'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,First_Active_date as Active_From,pan_gir_no as PAN_Number,'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
--		left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,
--		left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda 
--		FROM [196.1.115.132].risk.dbo.Client_details as A where A.party_code not in (select client_code from client_master)
--	
--	--Here make the table sanjay_updated_info from the 196.1.115.156 client_master table
--		if exists (select * from sys.objects where [object_id] = object_id('dbo.Sanjay_Updated_Info') )
--			begin
--					drop table Sanjay_Updated_Info
--					select Client_Code,primary_product,Manager_Code,Account_Status,BSE,NSE,NSEFO,MCX,NCDEX into Sanjay_Updated_Info from [196.1.115.156].pda4.dbo.Client_master				
--			end
--		else
--			begin
--				select Client_Code,primary_product,Manager_Code,Account_Status,BSE,NSE,NSEFO,MCX,NCDEX into Sanjay_Updated_Info from [196.1.115.156].PDA4.dbo.Client_master
--			end
--
--		update Client_master set 
--					Client_master.Online_Client=isnull(Sanjay_Updated_Info.Account_Status,0),
--					Client_master.Product_Code=isnull(Sanjay_Updated_Info.primary_product,''),
--					Client_master.Manager_Code=isnull(Sanjay_Updated_Info.Manager_Code,''),
--					Client_master.Account_Status=isnull(Sanjay_Updated_Info.Account_Status,0),
--					Client_master.BSE=isnull(Sanjay_Updated_Info.BSE,0),
--					Client_master.NSE=isnull(Sanjay_Updated_Info.NSE,0),
--					Client_master.NSEFO=isnull(Sanjay_Updated_Info.NSEFO,0),
--					Client_master.MCX=isnull(Sanjay_Updated_Info.MCX,0),
--					Client_master.NCDEX=isnull(Sanjay_Updated_Info.NCDEX,0)			
--		from client_master join Sanjay_Updated_Info
--		on client_master.Client_Code=Sanjay_Updated_Info.Client_Code		
--	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateEBHMSDatabase
-- --------------------------------------------------



-- =============================================
-- Author:		Siddharthpal
-- Create date: 23/05/2009
-- Description:	Update EBHMS database create User login in in User_master table
-- =============================================
CREATE PROCEDURE [dbo].[usp_UpdateEBHMSDatabase] 
	-- Add the parameters for the stored procedure here
	@Options nvarchar(15) 	
AS
--BEGIN
--		-- SET NOCOUNT ON added to prevent extra result sets from
--		-- interfering with SELECT statements.
--
----		SET NOCOUNT ON;
----	if @Options='I'
----		begin
----			Declare @EmpId as nvarchar(15)
----			Declare @TeamId as nvarchar(15)
----			Declare @RoleId as nvarchar(15)
----			set @EmpId='Enter Employee Code Here'
----			set @TeamID='Enter Team Id Here'
----			set @RoleId='Enter RoleId Here'
----			-- Insert statements for procedure here
----			insert into user_master
----			select emp_no,emp_name,birthdate,@TeamID,@RoleId,senior,branch_cd,'',Phone,email,'Guest',Getdate(),'True',0,'','123' from missc.dbo.employee_master where
----			emp_no=@EmpId
----			select * from user_master where userid=@EmpId			
----		end
--END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UpdateHelpdeskClientMaster
-- --------------------------------------------------
CREATE Proc usp_UpdateHelpdeskClientMaster

/*----------------------------------------------
	Author:-			Amit Padekar
	Create Date:-		04/03/2010
	Last Modified Date:-		04/03/2010
	Porcedure Name:-	usp_UpdateHelpdeskClientMaster
	Purpose:-           Updating the Helpdesk Client_Master Table
*/-----------------------------------------------

as
--Update existing clients Data from riskinfo  to Helpdesk client Master
	update Client_Master set
	Client_Master.Short_Name=left(Risk.Short_Name,60),
	Client_Master.Long_Name=left(Risk.Long_Name,150),
	Client_Master.DOB=Risk.DOB,
	Client_Master.Branch_Code=left(Risk.branch_cd,15),
	Client_Master.Subbroker_Code=left(Risk.sub_broker,15),
	Client_Master.Region_Code=left(Risk.region,15),
	Client_Master.Zone_Code='',
	Client_Master.Active_From=Risk.First_Active_date,
	Client_Master.PAN_Number=Risk.pan_gir_no,
	Client_Master.Address=left(Risk.l_address1,100),
	Client_Master.Address1=left(Risk.l_address2,60),
	Client_Master.Address2=left(Risk.l_address3,60),
	Client_Master.City=left(Risk.l_city,60),
	Client_Master.State=left(Risk.l_state,60),
	Client_Master.Country=left(Risk.l_nation,60),
	Client_Master.Permanent_Address=left(rtrim(ltrim(Risk.p_address1))+ '' + rtrim(ltrim(Risk.p_address2)) + '' +rtrim(ltrim(Risk.p_address3))+''+rtrim(ltrim(Risk.p_city))+''+rtrim(ltrim(Risk.p_state)),100),
	Client_Master.Landline_Number1=left(Risk.res_phone1,15),
	Client_Master.Landline_Number2=left(Risk.res_phone2,15),
	Client_Master.Office_Number1=left(Risk.off_phone1,15),
	Client_Master.Office_Number2=left(Risk.off_phone2,15),
	Client_Master.Mobile=left(Risk.mobile_pager,20),
	Client_Master.Email=left(Risk.email,100)
	from Client_Master,[196.1.115.132].risk.dbo.Client_details as Risk  
	where Client_Master.Client_Code=left(Risk.party_code,15)

--Insert new added client from riskinfo  to Helpdesk client Master
	insert into Client_Master
	SELECT  left(party_code,15) as Client_Code,left(short_name,60) as Short_Name,left(long_name,150) as Long_Name,dob as DOB,'0' as Online_Client,'0' as B2C,left(branch_cd,15) as Branch_Code,left(sub_broker,15) as Subbroker_Code,left(region,15) as Region_Code,'' as Zone_Code,'' as Product_Code,
	'' as Secondary_Product,left('PDA',50) as PDA,'' as Manager_Code,'0' as Account_Status,First_Active_date as Active_From,pan_gir_no as PAN_Number,'0' as BSE,'0' as NSE,'0' as NSEFO,'0' as MCX,'0' as NCDEX,left(l_address1,100) as Address,left(l_address2,60) as Address1,left(l_address3,60) as Address2,
	left(l_city,60) as City,left(l_state,60) as State,left(l_nation,60) as Country,left(rtrim(ltrim(p_address1))+ '' + rtrim(ltrim(p_address2)) + '' +rtrim(ltrim(p_address3))+''+rtrim(ltrim(p_city))+''+rtrim(ltrim(p_state)),100) as Permanent_Address,left(res_phone1,15) as Landline_Number1,left(res_phone2,15) as Landline_Number2,
	left(off_phone1,15) as Office_Number1,left(off_phone2,15) as Office_Number2,left(mobile_pager,20) as Mobile,left(email,100) as Email,'0' as SERIAL_ID,0 as EChopda 
	FROM [196.1.115.132].risk.dbo.Client_details as A where A.party_code not in (select client_code from Client_Master)

--Update account status and product informatin of clients from PDA Client Master  to Helpdesk client Master
	update Client_Master set 
		Client_Master.Online_Client=isnull(PDA_Client_Master.Account_Status,0),
		Client_Master.Product_Code=isnull(PDA_Client_Master.primary_product,''),
		Client_Master.Manager_Code=isnull(PDA_Client_Master.Manager_Code,''),
		Client_Master.Account_Status=isnull(PDA_Client_Master.Account_Status,0),
		Client_Master.BSE=isnull(PDA_Client_Master.BSE,0),
		Client_Master.NSE=isnull(PDA_Client_Master.NSE,0),
		Client_Master.NSEFO=isnull(PDA_Client_Master.NSEFO,0),
		Client_Master.MCX=isnull(PDA_Client_Master.MCX,0),
		Client_Master.NCDEX=isnull(PDA_Client_Master.NCDEX,0)			
	from Client_Master join [196.1.115.156].pda4.dbo.Client_master	as PDA_Client_Master
	on client_master.Client_Code=PDA_Client_Master.Client_Code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UploadedFiles
-- --------------------------------------------------


CREATE proc [dbo].[usp_UploadedFiles]
@Option varchar(50),
@UserID varchar(100),
@Manager nvarchar(100)
as
begin
Declare @user_role as nvarchar(10)
set @user_role=(select Role_id from user_master where userid=@UserID)
	if(@Option = 'LOGIN')
		BEGIN
			SELECT UM.USERID, UM.USERNAME, RM.Role_Name AS [ROLE], LM.branch_tag AS [BRANCH_TAG] FROM USER_MASTER UM
			INNER JOIN TBL_IT_LOCATIONMASTER LM ON  UM.BRANCH_ID = LM.BRANCH_TAG 
			INNER JOIN  role_master  RM ON  UM.Role_id = RM.Role_id
			WHERE UM.USERID =@UserID AND UM.PASSWORD = @Manager
		END


	if(@Option = 'GETMANAGERLIST') 
		begin 
			if(@user_role='ADM')
				begin
					select RM_Manager_Code from tbl_IT_ProductMaster 
				end
			else
				begin
					select PM.RM_Manager_Code as manager from User_Master UM 
					inner join tbl_IT_LocationMaster LM on UM.Branch_ID = LM.Branch_Tag
					inner join tbl_IT_ProductMaster PM on LM.CentralSupportName = PM.Location
					where  UM.UserID =@UserID
				end
		end

	if(@Option = 'INSERT')
		BEGIN
			declare @FileName nvarchar(100)
			declare @DatePart nvarchar(50)
			set @FileName = @Manager + '_' + convert(varchar(10),getdate(),112) + '.xls'

			Insert into UploadedFiles select UM.UserID, UM.UserName,LM.Branch_Tag,PM.RM_Manager_Code as [FileName], @FileName, getdate()
						from User_Master UM
						inner join tbl_IT_LocationMaster LM on UM.Branch_ID = LM.Branch_Tag
						inner join tbl_IT_ProductMaster PM on LM.CentralSupportName = PM.Location 
						where  UM.UserID = @UserID and PM.RM_Manager_Code = @Manager
			select UM.UserID,LM.Branch_Name,PM.RM_Manager_Code as [FileName], @FileName, getdate()
						from User_Master UM
						inner join tbl_IT_LocationMaster LM on UM.Branch_ID = LM.Branch_Tag
						inner join tbl_IT_ProductMaster PM on LM.CentralSupportName = PM.Location 
						where  UM.UserID = @UserID and PM.RM_Manager_Code = @Manager
		END

	if(@Option = 'SELECT')
		BEGIN
			Declare @indx int
			set @indx = charindex(' ',@UserID)

			declare @fromDate datetime 
			declare @toDate datetime
			
			set @fromDate = convert(datetime,substring(@UserID,0,@indx),101)
			set @toDate = convert(datetime,substring(@UserID,@indx + 1,len(@UserID)-@indx),101)

			select PM.Location,PM.Odin_Manager_Code as [Manager_IT],PM.RM_Manager_code as [Manager_RM], UF.File_Names as [Uploaded File Name],UF.UserName as [Uploaded By],UF.Uploaded_Date as [Uploaded Date]
			from UploadedFiles UF,tbl_IT_ProductMaster PM
			where UF.Manager=PM.RM_Manager_Code and Manager = @Manager and Uploaded_Date between @fromDate and @toDate+1 order by Uploaded_Date
		END

	if(@Option = 'ROWMANAGER')
		BEGIN
			select * from UploadedFiles where File_Names = @Manager
		END
	if(@Option = 'TODAY')
		begin 
			if(@user_role='ADM')
				begin
					select A.*, isnull(replace(UF.UserName,UF.UserName,'Uploaded'),'Not Uploaded') as Status,
					isnull(UF.UserName ,'...')as [UploadedBy], isnull(UF.Uploaded_Date ,null)as [Uploaded_Date],
					isnull(UF.File_Names ,'Upload File...')as [Upload_File]
					from(select PM.Location as [Location],PM.Odin_Manager_Code as [Manager_IT],PM.RM_Manager_code as [Manager_RM],PM.Product_Version as [Manager_Version] 
					from dbo.tbl_IT_ProductMaster as PM) A
					left join UploadedFiles UF on A.Manager_RM=Uf.Manager and datediff(day,Uf.uploaded_Date,getdate())=0
				end
			else
				begin
					select A.*, isnull(replace(UF.UserName,UF.UserName,'Uploaded'),'Not Uploaded') as Status,
					isnull(UF.UserName ,'...')as [UploadedBy], isnull(UF.Uploaded_Date ,null)as [Uploaded_Date],
					isnull(UF.File_Names ,'Upload File...')as [Upload_File]
					from(select PM.Location as [Location],PM.Odin_Manager_Code as [Manager_IT],PM.RM_Manager_code as [Manager_RM],PM.Product_Version as [Manager_Version] 
					from dbo.tbl_IT_ProductMaster as PM,tbl_IT_LocationMaster as LM,User_Master UM  
					where UM.Branch_ID = LM.Branch_Tag and LM.CentralSupportName = PM.Location and UM.UserID =@UserID) A
					left join UploadedFiles UF on A.Manager_RM=Uf.Manager and datediff(day,Uf.uploaded_Date,getdate())=0
				end
		END
	if(@Option = 'UPLOADEDFILES')
		begin
			select A.*,	UF.UserName as [UploadedBy], UF.Uploaded_Date as [Uploaded_Date],UF.File_Names as [Upload_File]
			from(select PM.Location as [Location],PM.Odin_Manager_Code as [Manager_IT],PM.RM_Manager_code as [Manager_RM],PM.Product_Version as [Manager_Version] 
			from dbo.tbl_IT_ProductMaster as PM) A
			left join UploadedFiles UF on A.Manager_RM=Uf.Manager and datediff(day,Uf.uploaded_Date,getdate())=0
			where UF.Uploaded_Date is not null
		end

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.uspFillAssignEmp
-- --------------------------------------------------


CREATE PROC [dbo].[uspFillAssignEmp]
@userid varchar(20),
@access varchar(20),
@issueby varchar(50),
@status varchar(30),
@issuetype varchar(4)
as

if (@access='ADM' or @access='L3TL' or @access='L3EX' or @access='ITL3TL' or @access='ITL3EX')
Begin
	if(@status='Escalated to L1 Team')
		Begin
			select username from User_Master where team_id='L1' And Account_STatus=1 order by username
		End
	Else if (@status='Escalated to IT L1 Team')
		Begin
			select username from User_Master where team_id='ITL1' And Account_STatus=1 order by username
		End
	Else if (@status='Escalated to IT L1 Branch Team')
		Begin
			select username from User_Master where team_id='ITL1BR' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 Odin')
		Begin
			select username from User_Master where team_id='ITL2O' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 Infra')
		Begin
			select username from User_Master where team_id='ITL2I' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 System')
		Begin
			select username from User_Master where team_id='ITL2S' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 Network')
		Begin
			select username from User_Master where team_id='ITL2N' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 VSAT')
		Begin
			select username from User_Master where team_id in ('ITL2V','ITL2N') And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L3')
		Begin
			select username from User_Master where team_id='ITL3' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 Technical')
		Begin
			select username from User_Master where team_id like 'L2T' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to L2 Functional')
		Begin
			select username from User_Master where team_id='L2F' And Account_STatus=1 order by username
		End
	Else if(@status='Escalated to Level 3')
		Begin
			select username from User_Master where team_id='L3' And Account_STatus=1 order by username
		End
	Else
		Begin
			select username from User_Master 
			where userid in (Select Employee_id from tbl_Teamleadermaster where
			Teamleader in (Select Teamleader from tbl_Teamleadermaster where Employee_id=@issueby)) 
			And Account_STatus=1
			order by username
		End
End
Else
Begin
	select username from User_Master 
	where userid in (Select Employee_id from tbl_Teamleadermaster where
	Teamleader in (Select Teamleader from tbl_Teamleadermaster where Employee_id=@issueby))
		And Account_STatus=1  
	order by username
END


--

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USPGetAllExecutive
-- --------------------------------------------------





CREATE proc [dbo].[USPGetAllExecutive]
@User_ID varchar(50),
@Role varchar(50),
@Team varchar(100),
@callType varchar(10),
@CSO Char(20)

as

if (@Role in ('L1TL','L2FTL','L2TTL','L3TL'))
begin
	select username,userid from user_master where teamLeader=@User_ID order by userName  
End      
if (@Role in ('ITL1TL','ITL2TLN','ITL2TLO','ITL2TLV','ITL1TLS','ITL1TLI'))
begin
	select distinct um.username,um.userid from user_master um
	where Userid in (select employee_id from tbl_teamleadermaster where teamLeader=@User_Id) 
	order by userName
end
if (@Role in('ITL1EX','ITL2EXBR','ITL2EXI','ITL2EXS','ITL2EXN','ITL2EXO','ITL2EXV','L1EX','L2FEX','L2TEX','L3EX'))
begin
	select username,userid from user_master where userid=@User_ID 
end
if (@Role in ('ADM','ITL3TL'))
begin
	if (@callType='EBro' and @Team<>'Administrator')
	begin
		If(@Team='ALL')
		Begin
			If(@CSO<>'ALL')
			Begin
				select username,userid from user_master where team_id not like 'IT%' and 
					team_id in (select team_id from team_master )
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				order by username 
			End
			Else If(@CSO='ALL')
			Begin
				select username,userid from user_master where team_id not like 'IT%' and 
					team_id in (select team_id from team_master )
				order by username 
			End
		End
		Else
		Begin
			If(@CSO<>'ALL')
			Begin
				select username,userid from user_master where team_id not like 'IT%' and 
					team_id in (select team_id from team_master where team_name=@Team)
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				Order by username
			End 
			Else
			Begin
				select username,userid from user_master where team_id not like 'IT%' and 
				team_id in (select team_id from team_master where team_name=@Team) order by username 
			End
		End
	End 
	if (@callType='IT' and @Team<>'Administrator')
	begin
		If(@Team='ALL')
		Begin
			IF(@CSO<>'ALL')
			Begin
				select username,userid from user_master where team_id like 'IT%' and 
					team_id in (select team_id from team_master) 
					And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				order by username 
			End
			Else If(@CSO='ALL')
			Begin
				select username,userid from user_master where team_id like 'IT%' and team_id in (select team_id from team_master) order by username 
			End
		End
		Else 
		Begin
			IF(@CSO<>'ALL')
			Begin
				select username,userid from user_master where team_id like 'IT%' and 
				team_id in (select team_id from team_master where team_name=@Team) 
				And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
				order by username 
			End
			Else If(@CSO='ALL')
			Begin
				select username,userid from user_master where team_id like 'IT%' and team_id in (select team_id from team_master where team_name=@Team) order by username 
			End
		End
	end 
	
	if(@Team='Administrator')
	Begin
		IF(@CSO<>'ALL')
		Begin
			Select username,userid from user_master 
			Where team_id=(select team_id from team_master where team_name=@Team) 
				And Branch_ID in (Select Branch_Code From tbl_ITBranchMaster Where CSO_Code=@CSO)
			order by username 
			
		End
		Else If(@CSO='ALL')
		Begin
			Select username,userid from user_master where team_id=(select team_id from team_master where team_name=@Team) order by username 
		End

	End
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Vidula_SPlevelsummary_DailynMonthly
-- --------------------------------------------------
CREATE procedure [dbo].[Vidula_SPlevelsummary_DailynMonthly]
@TL varchar(20),
@access varchar(15), 
@fromdate varchar(100),
@todate varchar(100),
@type varchar(20),
--@query2 varchar(max),
@count varchar(20),
@query varchar(max),
@query1 varchar(max)
as
drop table vidula
--------------------------------------------------------------------
-------------------Insert Into Exrate-------------------------------
select d.issue_resolved_by as issue_resolved_by,u.Lastlogin as [Last login],left(d.issue_raised_datetime,11) as [date],count(d.docket_number) as completed
into vidula
from client_details d,user_master u
where u.userid=d.issue_resolved_by and d.status_code='C' and d.issue_raised_datetime 
--between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)) 
between @fromdate and @todate
and issue_resolved_by in(select userid from user_master where teamleader=@TL and userid<>@TL) 
group by left(d.issue_raised_datetime,11) ,u.lastlogin,d.issue_resolved_by 
---------------------------------------------------------
DECLARE sysCursor1 CURSOR
for
select date from vidula
--where date between @Fromdate and @ToDate
where (date between convert(varchar(20),cast(@FromDate as datetime)) and convert(varchar(20),cast(dateadd(day,1,@ToDate)as datetime)))

OPEN sysCursor1
FETCH NEXT FROM SysCursor1 into @count

while @@FETCH_STATUS<>-1
begin 

set @query1= @query1+'['+ @count+']'+','
FETCH NEXT FROM SysCursor1 into @count
end
CLOSE sysCursor1
DEALLOCATE sysCursor1

-- Snatch off the final comma left at the end of the built string
SELECT @query1= left(@query1, len(@query1)-1)

if @query1 ='' --Start
begin	--1st begin if
print 'eror'
end 
else
begin
--SELECT @query1=left(@query1, len(@query1)-1)

if @Type = 'Daily'
begin


set @query='Select [Employee Name],[Last login],' + @query1 + ' from
(select u.username as "Employee Name",u.lastlogin as "Last login",left(t.date,11) as date,t.completed 
from vidula t, user_master u
where t.issue_resolved_by=u.userid   
)a

pivot
(
	 sum(completed)
     for date in ('+@query1+')
)b
order by [Employee Name]'
end
end
select @query
exec (@query)

GO

-- --------------------------------------------------
-- TABLE dbo.A_AKRUTI1
-- --------------------------------------------------
CREATE TABLE [dbo].[A_AKRUTI1]
(
    [Odinid] NVARCHAR(255) NULL,
    [GroupId] NVARCHAR(255) NULL,
    [TradingAllowed] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Admin
-- --------------------------------------------------
CREATE TABLE [dbo].[Admin]
(
    [Product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [Nature] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Brief Solution] NVARCHAR(255) NULL,
    [Detailed solution] NVARCHAR(255) NULL,
    [F7] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Advance_Information
-- --------------------------------------------------
CREATE TABLE [dbo].[Advance_Information]
(
    [Client_Code] CHAR(15) NOT NULL,
    [Operating_System] VARCHAR(100) NULL,
    [Service_Pack] INT NULL,
    [IP] CHAR(20) NULL,
    [ISP] VARCHAR(1000) NULL,
    [Processor] VARCHAR(40) NULL,
    [RAM] CHAR(20) NULL,
    [Executive_Remark] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Akruti1
-- --------------------------------------------------
CREATE TABLE [dbo].[Akruti1]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AKRUTI12
-- --------------------------------------------------
CREATE TABLE [dbo].[AKRUTI12]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AKRUTI2
-- --------------------------------------------------
CREATE TABLE [dbo].[AKRUTI2]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Akruti3
-- --------------------------------------------------
CREATE TABLE [dbo].[Akruti3]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AKRUTI4
-- --------------------------------------------------
CREATE TABLE [dbo].[AKRUTI4]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AKRUTI48
-- --------------------------------------------------
CREATE TABLE [dbo].[AKRUTI48]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AKRUTI6
-- --------------------------------------------------
CREATE TABLE [dbo].[AKRUTI6]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Anywhere
-- --------------------------------------------------
CREATE TABLE [dbo].[Anywhere]
(
    [client_code] NVARCHAR(255) NULL,
    [Branch_code] NVARCHAR(255) NULL,
    [name] NVARCHAR(255) NULL,
    [status] FLOAT NULL,
    [product] NVARCHAR(255) NULL,
    [secondary_product] NVARCHAR(255) NULL,
    [manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Anywhere43
-- --------------------------------------------------
CREATE TABLE [dbo].[Anywhere43]
(
    [client_code] NVARCHAR(255) NULL,
    [Branch_code] NVARCHAR(255) NULL,
    [name] NVARCHAR(255) NULL,
    [status] FLOAT NULL,
    [product] NVARCHAR(255) NULL,
    [secondary_product] NVARCHAR(255) NULL,
    [manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AutoMailer_User_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[AutoMailer_User_Master]
(
    [Userid] VARCHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [Branch_Tag] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [From_Email] NVARCHAR(100) NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.B_KARAD1
-- --------------------------------------------------
CREATE TABLE [dbo].[B_KARAD1]
(
    [Odinid] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bcktbl_NewTaskDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[bcktbl_NewTaskDetails]
(
    [TT_Number] BIGINT IDENTITY(1,1) NOT NULL,
    [Docket_Number] CHAR(8) NOT NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [TagBranch] VARCHAR(50) NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Call_From] CHAR(25) NULL,
    [Call_Type] CHAR(25) NULL,
    [Issue_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(200) NULL,
    [L1_FinalRemark] VARCHAR(200) NULL,
    [L2_UserRemark] VARCHAR(200) NULL,
    [L3_UserRemark] VARCHAR(200) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.branch_details
-- --------------------------------------------------
CREATE TABLE [dbo].[branch_details]
(
    [BRANCH_CODE] CHAR(6) NOT NULL,
    [BRANCH] CHAR(40) NULL,
    [Long_Name] CHAR(50) NULL,
    [Address1] CHAR(25) NULL,
    [Address2] CHAR(25) NULL,
    [City] CHAR(20) NULL,
    [State] CHAR(15) NULL,
    [Nation] CHAR(15) NULL,
    [Zip] CHAR(15) NULL,
    [Phone1] CHAR(15) NULL,
    [Phone2] CHAR(15) NULL,
    [Fax] CHAR(15) NULL,
    [Email] CHAR(50) NULL,
    [Remote] BIT NOT NULL,
    [Security_Net] BIT NOT NULL,
    [Money_Net] BIT NOT NULL,
    [Excise_Reg] CHAR(30) NULL,
    [Contact_Person] CHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.branch_master
-- --------------------------------------------------
CREATE TABLE [dbo].[branch_master]
(
    [Branch_cd] VARCHAR(10) NULL,
    [BrMast_cd] VARCHAR(16) NULL,
    [BrMast_name] VARCHAR(25) NULL,
    [Mapped_By] VARCHAR(50) NULL,
    [Mapped_On] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Branch_Support
-- --------------------------------------------------
CREATE TABLE [dbo].[Branch_Support]
(
    [Issue_area] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Brief_Solution] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BranchHeads
-- --------------------------------------------------
CREATE TABLE [dbo].[BranchHeads]
(
    [emp_no] VARCHAR(8) NOT NULL,
    [Emp_name] VARCHAR(120) NULL,
    [Status] CHAR(1) NULL,
    [email] VARCHAR(100) NULL,
    [BirthDate] DATETIME NULL,
    [Phone] VARCHAR(15) NULL,
    [Senior] VARCHAR(6) NULL,
    [Branch_cd] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BRKB_BACKUP
-- --------------------------------------------------
CREATE TABLE [dbo].[BRKB_BACKUP]
(
    [Issue_area] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Brief_Solution] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BU11
-- --------------------------------------------------
CREATE TABLE [dbo].[BU11]
(
    [Branch] NVARCHAR(255) NULL,
    [Branch Name (NEW)] NVARCHAR(255) NULL,
    [Employee id] NVARCHAR(255) NULL,
    [HOD ID] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BU12
-- --------------------------------------------------
CREATE TABLE [dbo].[BU12]
(
    [Employee_Id] NVARCHAR(255) NULL,
    [Employee_Name] NVARCHAR(255) NULL,
    [Role] NVARCHAR(255) NULL,
    [Team] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Email] NVARCHAR(255) NULL,
    [Access] NVARCHAR(255) NULL,
    [Reporting_officer] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.C_KARAD12
-- --------------------------------------------------
CREATE TABLE [dbo].[C_KARAD12]
(
    [OdinId] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Details]
(
    [Docket_Number] CHAR(8) NOT NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Inbound_Outbound] CHAR(10) NULL,
    [Call_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Solution] TEXT NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(200) NULL,
    [L1_FinalRemark] VARCHAR(200) NULL,
    [L2_UserRemark] VARCHAR(200) NULL,
    [L3_UserRemark] VARCHAR(200) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_details07092010
-- --------------------------------------------------
CREATE TABLE [dbo].[client_details07092010]
(
    [Docket_Number] CHAR(8) NOT NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Inbound_Outbound] CHAR(10) NULL,
    [Call_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Solution] TEXT NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(200) NULL,
    [L1_FinalRemark] VARCHAR(200) NULL,
    [L2_UserRemark] VARCHAR(200) NULL,
    [L3_UserRemark] VARCHAR(200) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Client_Master$
-- --------------------------------------------------
CREATE TABLE [dbo].[Client_Master$]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Short_Name] NVARCHAR(255) NULL,
    [Long_Name] NVARCHAR(255) NULL,
    [DOB] NVARCHAR(255) NULL,
    [Online_Client] FLOAT NULL,
    [B2C] FLOAT NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Subbroker_Code] NVARCHAR(255) NULL,
    [Region_Code] NVARCHAR(255) NULL,
    [Zone_Code] NVARCHAR(255) NULL,
    [Product_Code] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [PDA] NVARCHAR(255) NULL,
    [Manager_Code] NVARCHAR(255) NULL,
    [Account_Status] FLOAT NULL,
    [Active_From] NVARCHAR(255) NULL,
    [PAN_Number] NVARCHAR(255) NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [Address] NVARCHAR(255) NULL,
    [Address1] NVARCHAR(255) NULL,
    [Address2] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [State] NVARCHAR(255) NULL,
    [Country] NVARCHAR(255) NULL,
    [Permanent_Address] NVARCHAR(255) NULL,
    [Landline_Number1] FLOAT NULL,
    [Landline_Number2] NVARCHAR(255) NULL,
    [Office_Number1] FLOAT NULL,
    [Office_Number2] NVARCHAR(255) NULL,
    [Mobile] NVARCHAR(255) NULL,
    [Email] NVARCHAR(255) NULL,
    [SERIAL_ID] FLOAT NULL,
    [EChopda] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ClientExists
-- --------------------------------------------------
CREATE TABLE [dbo].[ClientExists]
(
    [Refrence_Number] CHAR(8) NOT NULL,
    [Long_Name] VARCHAR(150) NOT NULL,
    [Landline1] CHAR(20) NULL,
    [Landline2] CHAR(20) NULL,
    [Office1] CHAR(20) NULL,
    [Office2] CHAR(20) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(150) NULL,
    [City] VARCHAR(100) NULL,
    [Address] VARCHAR(250) NULL,
    [Branch] VARCHAR(100) NULL,
    [Subbroker] VARCHAR(100) NULL,
    [Region] VARCHAR(100) NULL,
    [Zone] VARCHAR(100) NULL,
    [IssueRaisedDateTime] DATETIME NULL,
    [IssueResolvedDatetime] DATETIME NULL,
    [Product] CHAR(20) NULL,
    [Type] VARCHAR(100) NULL,
    [Nature] VARCHAR(100) NULL,
    [Problem] VARCHAR(250) NULL,
    [Brief_Solution] VARCHAR(300) NULL,
    [Solution] TEXT NULL,
    [Issue_Resolvedby] CHAR(15) NULL,
    [Ex_Remark] VARCHAR(300) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Clienttags$
-- --------------------------------------------------
CREATE TABLE [dbo].[Clienttags$]
(
    [Client Tag] NVARCHAR(255) NULL,
    [Client Name] NVARCHAR(255) NULL,
    [Client Address] NVARCHAR(255) NULL,
    [Client Contact] FLOAT NULL,
    [Connectivity] NVARCHAR(255) NULL,
    [Client IP] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CodeRepository
-- --------------------------------------------------
CREATE TABLE [dbo].[CodeRepository]
(
    [Exname] VARCHAR(20) NULL,
    [Type] VARCHAR(20) NULL,
    [Language] VARCHAR(20) NULL,
    [Path] VARCHAR(200) NULL,
    [Description] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Conn
-- --------------------------------------------------
CREATE TABLE [dbo].[Conn]
(
    [SR# NO] FLOAT NULL,
    [Modeofconnectivity] NVARCHAR(255) NULL,
    [VSAT Installation Date] NVARCHAR(255) NULL,
    [SITE CODE] NVARCHAR(255) NULL,
    [sbcode] NVARCHAR(255) NULL,
    [BRANCH] NVARCHAR(255) NULL,
    [RELATIONSHIP] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [ADDRESS] NVARCHAR(255) NULL,
    [Contact_Number] VARCHAR(100) NULL,
    [Contact_Person] VARCHAR(100) NULL,
    [FAX] NVARCHAR(255) NULL,
    [GATEWAY] NVARCHAR(255) NULL,
    [PC IPADRESS] NVARCHAR(255) NULL,
    [SUBNET MASK] NVARCHAR(255) NULL,
    [EMAIL ] NVARCHAR(255) NULL,
    [USER ] NVARCHAR(255) NULL,
    [USERCOMMODITY] NVARCHAR(255) NULL,
    [SERVERIP] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_Details]
(
    [Branch_Name] NVARCHAR(50) NULL,
    [ctcl_odinid] NVARCHAR(50) NULL,
    [CtclBranch_Segment] VARCHAR(5) NULL,
    [CTCLID] NVARCHAR(4000) NULL,
    [Ctcl_ISBTag] NVARCHAR(50) NULL,
    [Ctcl_AllotDate] NVARCHAR(12) NULL,
    [Ctcl_DisablingDate] NVARCHAR(12) NULL,
    [Ctcl_RegValidDate] NVARCHAR(12) NULL,
    [CTCL_IBranch_cd] NVARCHAR(50) NULL,
    [Ctcl_Status] VARCHAR(8) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_Details_Mahendra
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_Details_Mahendra]
(
    [Branch_Name] NVARCHAR(50) NULL,
    [ctcl_odinid] NVARCHAR(50) NULL,
    [CtclBranch_Segment] VARCHAR(5) NULL,
    [CTCLID] NVARCHAR(4000) NULL,
    [Ctcl_ISBTag] NVARCHAR(50) NULL,
    [Ctcl_AllotDate] NVARCHAR(12) NULL,
    [Ctcl_DisablingDate] NVARCHAR(12) NULL,
    [Ctcl_RegValidDate] NVARCHAR(12) NULL,
    [CTCL_IBranch_cd] NVARCHAR(50) NULL,
    [Ctcl_Status] VARCHAR(8) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_Details_Yesterday
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_Details_Yesterday]
(
    [Branch_Name] NVARCHAR(50) NULL,
    [ctcl_odinid] NVARCHAR(50) NULL,
    [CtclBranch_Segment] VARCHAR(5) NULL,
    [CTCLID] NVARCHAR(4000) NULL,
    [Ctcl_ISBTag] NVARCHAR(50) NULL,
    [Ctcl_AllotDate] NVARCHAR(12) NULL,
    [Ctcl_DisablingDate] NVARCHAR(12) NULL,
    [Ctcl_RegValidDate] NVARCHAR(12) NULL,
    [CTCL_IBranch_cd] NVARCHAR(50) NULL,
    [Ctcl_Status] VARCHAR(8) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.D_AKRUTI2
-- --------------------------------------------------
CREATE TABLE [dbo].[D_AKRUTI2]
(
    [Odinid] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dotnettest
-- --------------------------------------------------
CREATE TABLE [dbo].[dotnettest]
(
    [Code] VARCHAR(15) NOT NULL,
    [Name] VARCHAR(50) NULL,
    [Branch] VARCHAR(20) NULL,
    [city] VARCHAR(20) NULL,
    [state] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.E_AKRUTI3
-- --------------------------------------------------
CREATE TABLE [dbo].[E_AKRUTI3]
(
    [Odinid] NVARCHAR(255) NULL,
    [Gid] NVARCHAR(255) NULL,
    [TA] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Executive_Rating
-- --------------------------------------------------
CREATE TABLE [dbo].[Executive_Rating]
(
    [Emp_Id] VARCHAR(15) NOT NULL,
    [Date] DATETIME NOT NULL,
    [Communication] VARCHAR(2) NOT NULL,
    [Product_Knowledge] VARCHAR(2) NOT NULL,
    [Interpersonal_Skills] VARCHAR(2) NOT NULL,
    [Conduct_on_calls] VARCHAR(2) NOT NULL,
    [Total] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Exrate
-- --------------------------------------------------
CREATE TABLE [dbo].[Exrate]
(
    [Emp_Id] VARCHAR(15) NOT NULL,
    [Date] DATETIME NOT NULL,
    [Total] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.F_AKRUTI4
-- --------------------------------------------------
CREATE TABLE [dbo].[F_AKRUTI4]
(
    [Odinid] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FAQ
-- --------------------------------------------------
CREATE TABLE [dbo].[FAQ]
(
    [Faq_ID] FLOAT NULL,
    [Product_Name] NVARCHAR(255) NULL,
    [Faq_Type] NVARCHAR(255) NULL,
    [Faq_Nature] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Solution] NVARCHAR(MAX) NULL,
    [BriefSolution] NVARCHAR(255) NULL,
    [Remark] NVARCHAR(255) NULL,
    [Reject_Reson] NVARCHAR(255) NULL,
    [FAQ_Status] NVARCHAR(255) NULL,
    [Added_By] NVARCHAR(255) NULL,
    [Added_On] NVARCHAR(255) NULL,
    [Reviewed_By] NVARCHAR(255) NULL,
    [Reviewed_On] NVARCHAR(255) NULL,
    [Faq_Identifier] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Faq_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[Faq_Details]
(
    [Faq_Id] INT IDENTITY(1,1) NOT NULL,
    [Product_Name] VARCHAR(40) NULL,
    [Faq_Type] CHAR(15) NULL,
    [Faq_Nature] VARCHAR(MAX) NULL,
    [Problem] VARCHAR(MAX) NULL,
    [Solution] TEXT NULL,
    [BriefSolution] TEXT NULL,
    [Remark] TEXT NULL,
    [Reject_Reson] TEXT NULL,
    [FAQ_Status] CHAR(5) NULL,
    [Added_By] VARCHAR(15) NULL,
    [Added_on] DATETIME NULL,
    [Reviewed_By] VARCHAR(15) NULL,
    [Reviewed_On] DATETIME NULL,
    [Faq_Identifier] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Faq_Identifier
-- --------------------------------------------------
CREATE TABLE [dbo].[Faq_Identifier]
(
    [Faq_Identifier] INT NOT NULL,
    [Identifier_Description] VARCHAR(80) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FAQ_Status
-- --------------------------------------------------
CREATE TABLE [dbo].[FAQ_Status]
(
    [FAQStatus_Id] CHAR(5) NOT NULL,
    [FADStatus_Name] CHAR(40) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FAQ_Type
-- --------------------------------------------------
CREATE TABLE [dbo].[FAQ_Type]
(
    [Faq_id] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FORT
-- --------------------------------------------------
CREATE TABLE [dbo].[FORT]
(
    [Odinid] NVARCHAR(255) NULL,
    [Group Id] NVARCHAR(255) NULL,
    [Status] NVARCHAR(255) NULL,
    [Manager Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FORT12
-- --------------------------------------------------
CREATE TABLE [dbo].[FORT12]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.H_AKRUTI48
-- --------------------------------------------------
CREATE TABLE [dbo].[H_AKRUTI48]
(
    [oDINID] NVARCHAR(255) NULL,
    [Group Id] NVARCHAR(255) NULL,
    [Trading Allowed] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.I_AKRUTI89
-- --------------------------------------------------
CREATE TABLE [dbo].[I_AKRUTI89]
(
    [Odinid] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'ID for Helpdesk Managment$'
-- --------------------------------------------------
CREATE TABLE [dbo].['ID for Helpdesk Managment$']
(
    [Sr# No#] FLOAT NULL,
    [BRANCH TAG] NVARCHAR(255) NULL,
    [BRANCH NAME] NVARCHAR(255) NULL,
    [CENTRAL SUPPORT] NVARCHAR(255) NULL,
    [IT PERSON] NVARCHAR(255) NULL,
    [IT CATEOGRY] NVARCHAR(255) NULL,
    [EMP_ID] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [F9] NVARCHAR(255) NULL,
    [F10] NVARCHAR(255) NULL,
    [F11] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL,
    [F13] NVARCHAR(255) NULL,
    [F14] NVARCHAR(255) NULL,
    [F15] NVARCHAR(255) NULL,
    [F16] NVARCHAR(255) NULL,
    [F17] NVARCHAR(255) NULL,
    [F18] NVARCHAR(255) NULL,
    [F19] NVARCHAR(255) NULL,
    [F20] NVARCHAR(255) NULL,
    [F21] NVARCHAR(255) NULL,
    [F22] NVARCHAR(255) NULL,
    [F23] NVARCHAR(255) NULL,
    [F24] NVARCHAR(255) NULL,
    [F25] NVARCHAR(255) NULL,
    [F26] NVARCHAR(255) NULL,
    [F27] NVARCHAR(255) NULL,
    [F28] NVARCHAR(255) NULL,
    [F29] NVARCHAR(255) NULL,
    [F30] NVARCHAR(255) NULL,
    [F31] NVARCHAR(255) NULL,
    [F32] NVARCHAR(255) NULL,
    [F33] NVARCHAR(255) NULL,
    [F34] NVARCHAR(255) NULL,
    [F35] NVARCHAR(255) NULL,
    [F36] NVARCHAR(255) NULL,
    [F37] NVARCHAR(255) NULL,
    [F38] NVARCHAR(255) NULL,
    [F39] NVARCHAR(255) NULL,
    [F40] NVARCHAR(255) NULL,
    [F41] NVARCHAR(255) NULL,
    [F42] NVARCHAR(255) NULL,
    [F43] NVARCHAR(255) NULL,
    [F44] NVARCHAR(255) NULL,
    [F45] NVARCHAR(255) NULL,
    [F46] NVARCHAR(255) NULL,
    [F47] NVARCHAR(255) NULL,
    [F48] NVARCHAR(255) NULL,
    [F49] NVARCHAR(255) NULL,
    [F50] NVARCHAR(255) NULL,
    [F51] NVARCHAR(255) NULL,
    [F52] NVARCHAR(255) NULL,
    [F53] NVARCHAR(255) NULL,
    [F54] NVARCHAR(255) NULL,
    [F55] NVARCHAR(255) NULL,
    [F56] NVARCHAR(255) NULL,
    [F57] NVARCHAR(255) NULL,
    [F58] NVARCHAR(255) NULL,
    [F59] NVARCHAR(255) NULL,
    [F60] NVARCHAR(255) NULL,
    [F61] NVARCHAR(255) NULL,
    [F62] NVARCHAR(255) NULL,
    [F63] NVARCHAR(255) NULL,
    [F64] NVARCHAR(255) NULL,
    [F65] NVARCHAR(255) NULL,
    [F66] NVARCHAR(255) NULL,
    [F67] NVARCHAR(255) NULL,
    [F68] NVARCHAR(255) NULL,
    [F69] NVARCHAR(255) NULL,
    [F70] NVARCHAR(255) NULL,
    [F71] NVARCHAR(255) NULL,
    [F72] NVARCHAR(255) NULL,
    [F73] NVARCHAR(255) NULL,
    [F74] NVARCHAR(255) NULL,
    [F75] NVARCHAR(255) NULL,
    [F76] NVARCHAR(255) NULL,
    [F77] NVARCHAR(255) NULL,
    [F78] NVARCHAR(255) NULL,
    [F79] NVARCHAR(255) NULL,
    [F80] NVARCHAR(255) NULL,
    [F81] NVARCHAR(255) NULL,
    [F82] NVARCHAR(255) NULL,
    [F83] NVARCHAR(255) NULL,
    [F84] NVARCHAR(255) NULL,
    [F85] NVARCHAR(255) NULL,
    [F86] NVARCHAR(255) NULL,
    [F87] NVARCHAR(255) NULL,
    [F88] NVARCHAR(255) NULL,
    [F89] NVARCHAR(255) NULL,
    [F90] NVARCHAR(255) NULL,
    [F91] NVARCHAR(255) NULL,
    [F92] NVARCHAR(255) NULL,
    [F93] NVARCHAR(255) NULL,
    [F94] NVARCHAR(255) NULL,
    [F95] NVARCHAR(255) NULL,
    [F96] NVARCHAR(255) NULL,
    [F97] NVARCHAR(255) NULL,
    [F98] NVARCHAR(255) NULL,
    [F99] NVARCHAR(255) NULL,
    [F100] NVARCHAR(255) NULL,
    [F101] NVARCHAR(255) NULL,
    [F102] NVARCHAR(255) NULL,
    [F103] NVARCHAR(255) NULL,
    [F104] NVARCHAR(255) NULL,
    [F105] NVARCHAR(255) NULL,
    [F106] NVARCHAR(255) NULL,
    [F107] NVARCHAR(255) NULL,
    [F108] NVARCHAR(255) NULL,
    [F109] NVARCHAR(255) NULL,
    [F110] NVARCHAR(255) NULL,
    [F111] NVARCHAR(255) NULL,
    [F112] NVARCHAR(255) NULL,
    [F113] NVARCHAR(255) NULL,
    [F114] NVARCHAR(255) NULL,
    [F115] NVARCHAR(255) NULL,
    [F116] NVARCHAR(255) NULL,
    [F117] NVARCHAR(255) NULL,
    [F118] NVARCHAR(255) NULL,
    [F119] NVARCHAR(255) NULL,
    [F120] NVARCHAR(255) NULL,
    [F121] NVARCHAR(255) NULL,
    [F122] NVARCHAR(255) NULL,
    [F123] NVARCHAR(255) NULL,
    [F124] NVARCHAR(255) NULL,
    [F125] NVARCHAR(255) NULL,
    [F126] NVARCHAR(255) NULL,
    [F127] NVARCHAR(255) NULL,
    [F128] NVARCHAR(255) NULL,
    [F129] NVARCHAR(255) NULL,
    [F130] NVARCHAR(255) NULL,
    [F131] NVARCHAR(255) NULL,
    [F132] NVARCHAR(255) NULL,
    [F133] NVARCHAR(255) NULL,
    [F134] NVARCHAR(255) NULL,
    [F135] NVARCHAR(255) NULL,
    [F136] NVARCHAR(255) NULL,
    [F137] NVARCHAR(255) NULL,
    [F138] NVARCHAR(255) NULL,
    [F139] NVARCHAR(255) NULL,
    [F140] NVARCHAR(255) NULL,
    [F141] NVARCHAR(255) NULL,
    [F142] NVARCHAR(255) NULL,
    [F143] NVARCHAR(255) NULL,
    [F144] NVARCHAR(255) NULL,
    [F145] NVARCHAR(255) NULL,
    [F146] NVARCHAR(255) NULL,
    [F147] NVARCHAR(255) NULL,
    [F148] NVARCHAR(255) NULL,
    [F149] NVARCHAR(255) NULL,
    [F150] NVARCHAR(255) NULL,
    [F151] NVARCHAR(255) NULL,
    [F152] NVARCHAR(255) NULL,
    [F153] NVARCHAR(255) NULL,
    [F154] NVARCHAR(255) NULL,
    [F155] NVARCHAR(255) NULL,
    [F156] NVARCHAR(255) NULL,
    [F157] NVARCHAR(255) NULL,
    [F158] NVARCHAR(255) NULL,
    [F159] NVARCHAR(255) NULL,
    [F160] NVARCHAR(255) NULL,
    [F161] NVARCHAR(255) NULL,
    [F162] NVARCHAR(255) NULL,
    [F163] NVARCHAR(255) NULL,
    [F164] NVARCHAR(255) NULL,
    [F165] NVARCHAR(255) NULL,
    [F166] NVARCHAR(255) NULL,
    [F167] NVARCHAR(255) NULL,
    [F168] NVARCHAR(255) NULL,
    [F169] NVARCHAR(255) NULL,
    [F170] NVARCHAR(255) NULL,
    [F171] NVARCHAR(255) NULL,
    [F172] NVARCHAR(255) NULL,
    [F173] NVARCHAR(255) NULL,
    [F174] NVARCHAR(255) NULL,
    [F175] NVARCHAR(255) NULL,
    [F176] NVARCHAR(255) NULL,
    [F177] NVARCHAR(255) NULL,
    [F178] NVARCHAR(255) NULL,
    [F179] NVARCHAR(255) NULL,
    [F180] NVARCHAR(255) NULL,
    [F181] NVARCHAR(255) NULL,
    [F182] NVARCHAR(255) NULL,
    [F183] NVARCHAR(255) NULL,
    [F184] NVARCHAR(255) NULL,
    [F185] NVARCHAR(255) NULL,
    [F186] NVARCHAR(255) NULL,
    [F187] NVARCHAR(255) NULL,
    [F188] NVARCHAR(255) NULL,
    [F189] NVARCHAR(255) NULL,
    [F190] NVARCHAR(255) NULL,
    [F191] NVARCHAR(255) NULL,
    [F192] NVARCHAR(255) NULL,
    [F193] NVARCHAR(255) NULL,
    [F194] NVARCHAR(255) NULL,
    [F195] NVARCHAR(255) NULL,
    [F196] NVARCHAR(255) NULL,
    [F197] NVARCHAR(255) NULL,
    [F198] NVARCHAR(255) NULL,
    [F199] NVARCHAR(255) NULL,
    [F200] NVARCHAR(255) NULL,
    [F201] NVARCHAR(255) NULL,
    [F202] NVARCHAR(255) NULL,
    [F203] NVARCHAR(255) NULL,
    [F204] NVARCHAR(255) NULL,
    [F205] NVARCHAR(255) NULL,
    [F206] NVARCHAR(255) NULL,
    [F207] NVARCHAR(255) NULL,
    [F208] NVARCHAR(255) NULL,
    [F209] NVARCHAR(255) NULL,
    [F210] NVARCHAR(255) NULL,
    [F211] NVARCHAR(255) NULL,
    [F212] NVARCHAR(255) NULL,
    [F213] NVARCHAR(255) NULL,
    [F214] NVARCHAR(255) NULL,
    [F215] NVARCHAR(255) NULL,
    [F216] NVARCHAR(255) NULL,
    [F217] NVARCHAR(255) NULL,
    [F218] NVARCHAR(255) NULL,
    [F219] NVARCHAR(255) NULL,
    [F220] NVARCHAR(255) NULL,
    [F221] NVARCHAR(255) NULL,
    [F222] NVARCHAR(255) NULL,
    [F223] NVARCHAR(255) NULL,
    [F224] NVARCHAR(255) NULL,
    [F225] NVARCHAR(255) NULL,
    [F226] NVARCHAR(255) NULL,
    [F227] NVARCHAR(255) NULL,
    [F228] NVARCHAR(255) NULL,
    [F229] NVARCHAR(255) NULL,
    [F230] NVARCHAR(255) NULL,
    [F231] NVARCHAR(255) NULL,
    [F232] NVARCHAR(255) NULL,
    [F233] NVARCHAR(255) NULL,
    [F234] NVARCHAR(255) NULL,
    [F235] NVARCHAR(255) NULL,
    [F236] NVARCHAR(255) NULL,
    [F237] NVARCHAR(255) NULL,
    [F238] NVARCHAR(255) NULL,
    [F239] NVARCHAR(255) NULL,
    [F240] NVARCHAR(255) NULL,
    [F241] NVARCHAR(255) NULL,
    [F242] NVARCHAR(255) NULL,
    [F243] NVARCHAR(255) NULL,
    [F244] NVARCHAR(255) NULL,
    [F245] NVARCHAR(255) NULL,
    [F246] NVARCHAR(255) NULL,
    [F247] NVARCHAR(255) NULL,
    [F248] NVARCHAR(255) NULL,
    [F249] NVARCHAR(255) NULL,
    [F250] NVARCHAR(255) NULL,
    [F251] NVARCHAR(255) NULL,
    [F252] NVARCHAR(255) NULL,
    [F253] NVARCHAR(255) NULL,
    [F254] NVARCHAR(255) NULL,
    [F255] NVARCHAR(255) NULL,
    [F256] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Image_pool
-- --------------------------------------------------
CREATE TABLE [dbo].[Image_pool]
(
    [Img] IMAGE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Issue_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Issue_Master]
(
    [Issue_Code] VARCHAR(40) NOT NULL,
    [Issue_Description] VARCHAR(200) NULL,
    [Issue_Type] CHAR(15) NOT NULL,
    [Issue_Sub_Code] VARCHAR(40) NOT NULL,
    [Product_Code] CHAR(15) NULL,
    [BriefSolution] VARCHAR(1000) NULL,
    [Remark] VARCHAR(200) NULL,
    [Solution] TEXT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Issue_Subcategory
-- --------------------------------------------------
CREATE TABLE [dbo].[Issue_Subcategory]
(
    [Issue_Sub_Code] VARCHAR(40) NOT NULL,
    [Issue_Cate_Code] VARCHAR(40) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IssueDetails_AKRUTI
-- --------------------------------------------------
CREATE TABLE [dbo].[IssueDetails_AKRUTI]
(
    [Docket_Number] CHAR(8) NOT NULL,
    [Branch_Code] CHAR(15) NOT NULL,
    [Branch] VARCHAR(100) NOT NULL,
    [Branch_Name] VARCHAR(100) NOT NULL,
    [Issue_Raised_Datetime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NOT NULL,
    [Product] VARCHAR(100) NULL,
    [Type] CHAR(20) NULL,
    [Nature] CHAR(15) NULL,
    [Problem] VARCHAR(200) NULL,
    [Brief_Solution] VARCHAR(200) NULL,
    [Solution] TEXT NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [Branch_Address] VARCHAR(200) NULL,
    [Phone] VARCHAR(200) NULL,
    [Contact] VARCHAR(200) NULL,
    [Remark] VARCHAR(200) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Call_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Call_Master]
(
    [product_Name] NVARCHAR(255) NULL,
    [call_Type] NVARCHAR(255) NULL,
    [Nature] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Category_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Category_Master]
(
    [Category_master] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Client_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Client_Details]
(
    [Docket_Number] CHAR(8) NOT NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Client_Name] NVARCHAR(MAX) NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NOT NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(200) NULL,
    [L1_FinalRemark] VARCHAR(200) NULL,
    [L2_UserRemark] VARCHAR(200) NULL,
    [L3_UserRemark] VARCHAR(200) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Status_Code] CHAR(15) NOT NULL,
    [branch] VARCHAR(40) NULL,
    [branch_code] VARCHAR(20) NULL,
    [email_id] VARCHAR(200) NULL,
    [sb_name] VARCHAR(200) NULL,
    [sb_tag] VARCHAR(40) NULL,
    [activation_date] DATETIME NULL,
    [mode_of_connectivity] VARCHAR(200) NULL,
    [site_code] NVARCHAR(200) NULL,
    [gateway] NVARCHAR(200) NULL,
    [subnet_mask] NVARCHAR(200) NULL,
    [address] NVARCHAR(200) NULL,
    [location] VARCHAR(100) NULL,
    [mode_of_connection] VARCHAR(200) NULL,
    [NCFM_valid_upto] DATETIME NULL,
    [Trading_Allowed] NVARCHAR(200) NULL,
    [manager_version] NVARCHAR(200) NULL,
    [PAN] VARCHAR(10) NULL,
    [DOB] DATETIME NULL,
    [RADDRESS1] VARCHAR(200) NULL,
    [RADDRESS2] VARCHAR(200) NULL,
    [RADDRESS3] VARCHAR(200) NULL,
    [rcity] VARCHAR(200) NULL,
    [rpin] VARCHAR(200) NULL,
    [oaddress1] VARCHAR(200) NULL,
    [oaddress2] VARCHAR(200) NULL,
    [oaddress3] VARCHAR(200) NULL,
    [opin] VARCHAR(200) NULL,
    [rmobile] VARCHAR(200) NULL,
    [ophone] VARCHAR(200) NULL,
    [rphone] VARCHAR(200) NULL,
    [RFAX] VARCHAR(200) NULL,
    [Nature] VARCHAR(200) NULL,
    [contact_person] VARCHAR(200) NULL,
    [Type] VARCHAR(MAX) NULL,
    [Problem] VARCHAR(MAX) NULL,
    [BriefSolution] VARCHAR(MAX) NULL,
    [manager_name] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Manager_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Manager_Master]
(
    [Manager_Location] NVARCHAR(255) NULL,
    [Server_name_IT] NVARCHAR(255) NULL,
    [Server_name_RM] NVARCHAR(255) NULL,
    [Manager_version] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_ODINID_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_ODINID_Master]
(
    [Manager_name] NVARCHAR(255) NULL,
    [User_Id] VARCHAR(50) NULL,
    [Group_Id] NVARCHAR(255) NULL,
    [Name] VARCHAR(50) NULL,
    [Category] NVARCHAR(255) NULL,
    [Status] BIT NULL,
    [Surv_OnOff] NVARCHAR(255) NULL,
    [Surv_AutoManual] NVARCHAR(255) NULL,
    [PRIME_OnOff] NVARCHAR(255) NULL,
    [Trading_Allowed] NVARCHAR(255) NULL,
    [IP_Address] NVARCHAR(255) NULL,
    [Max_BCast_Scrips] NVARCHAR(255) NULL,
    [Order_Nopersec] NVARCHAR(255) NULL,
    [Alias_DealerId] NVARCHAR(255) NULL,
    [PinCode] FLOAT NULL,
    [Branch_Name] NVARCHAR(255) NULL,
    [NSE_Cash_CTCL_BranchId] FLOAT NULL,
    [NSE_Cash_CTCL_Id] FLOAT NULL,
    [Derv_CTCL_BranchId] FLOAT NULL,
    [Derv_CTCL_Id] FLOAT NULL,
    [BSE_Cash_CTCL_BranchId] FLOAT NULL,
    [BSE_Cash_CTCL_Id] FLOAT NULL,
    [MCX_CTCL_BranchId] NVARCHAR(255) NULL,
    [MCX_CTC_Id] NVARCHAR(255) NULL,
    [NSEL_CTCL_branchd] NVARCHAR(255) NULL,
    [NSEL_CTCL_Id] NVARCHAR(255) NULL,
    [NCDEX_CTCL_BranchId] NVARCHAR(255) NULL,
    [NCDEX_CTCL_Id] NVARCHAR(255) NULL,
    [MCXSX_CTCL_BranchId] NVARCHAR(255) NULL,
    [MCXSX_CTCL_Id] NVARCHAR(255) NULL,
    [NSX_CTCL_BranchId] NVARCHAR(255) NULL,
    [NSX_CTCL_Id] NVARCHAR(255) NULL,
    [Group_Admin] NVARCHAR(255) NULL,
    [Login_Allowed] NVARCHAR(255) NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Participant_Type] NVARCHAR(255) NULL,
    [Mode_of_Connection] NVARCHAR(255) NULL,
    [ProductType] NVARCHAR(255) NULL,
    [MarketData_Allowed] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Role_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Role_Master]
(
    [Role_ID] NCHAR(10) NOT NULL,
    [Role_name] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_SBINFO_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_SBINFO_Master]
(
    [RegTAG] NVARCHAR(255) NULL,
    [RegAprRefNo] VARCHAR(100) NULL,
    [Type] NVARCHAR(255) NULL,
    [RegDOB] DATETIME NULL,
    [RegResAdd1] NVARCHAR(MAX) NULL,
    [RegResAdd2] NVARCHAR(MAX) NULL,
    [RegResAdd3] NVARCHAR(MAX) NULL,
    [RegResCity] NVARCHAR(255) NULL,
    [RegResPin] VARCHAR(100) NULL,
    [RegOffAdd1] NVARCHAR(MAX) NULL,
    [RegOffAdd2] NVARCHAR(MAX) NULL,
    [RegOffAdd3] NVARCHAR(MAX) NULL,
    [RegOffCity] NVARCHAR(255) NULL,
    [RegOffPin] NVARCHAR(255) NULL,
    [RegOffPhone] NVARCHAR(255) NULL,
    [RegMobile] NVARCHAR(255) NULL,
    [RegResPhone] VARCHAR(100) NULL,
    [RegResFax] VARCHAR(100) NULL,
    [RegPAN] NVARCHAR(255) NULL,
    [RegPAN_Applied] NVARCHAR(255) NULL,
    [RegCorrespondanceAdd] NVARCHAR(255) NULL,
    [RegMAPIN] NVARCHAR(255) NULL,
    [RegProprietorshipYN] NVARCHAR(255) NULL,
    [RegExpinYrs] NVARCHAR(255) NULL,
    [RegResidentialStatus] NVARCHAR(255) NULL,
    [RegEmailId] NVARCHAR(255) NULL,
    [RegReferenceTAG] NVARCHAR(255) NULL,
    [RegMkrId] NVARCHAR(255) NULL,
    [RegMkrDt] FLOAT NULL,
    [TAGBranch] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_SBs_Product
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_SBs_Product]
(
    [SB_TAG] NVARCHAR(50) NULL,
    [Product_Code] NVARCHAR(50) NULL,
    [Product_Name] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Status_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Status_Master]
(
    [JobStatus_Id] CHAR(15) NOT NULL,
    [JobStatus_Name] VARCHAR(60) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_SubCategory_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_SubCategory_Master]
(
    [Category] NVARCHAR(255) NULL,
    [Sub_Category] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_TeamID
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_TeamID]
(
    [Team_ID] NCHAR(10) NULL,
    [Team_Name] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Terminal_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Terminal_Master]
(
    [SR_NO] FLOAT NULL,
    [VSAT_Installation_Date] NVARCHAR(255) NULL,
    [SITE_CODE] NVARCHAR(255) NULL,
    [SUB_BROKER_TAG] NVARCHAR(255) NULL,
    [BRANCH] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [SB_NAME] NVARCHAR(255) NULL,
    [GATEWAY] NVARCHAR(255) NULL,
    [PC_IPADRESS] NVARCHAR(255) NULL,
    [SUBNET_MASK] NVARCHAR(255) NULL,
    [SERVER_IP] NVARCHAR(255) NULL,
    [PAN] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_User_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_User_Master]
(
    [Userid] VARCHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NOT NULL,
    [Role_Id] CHAR(15) NOT NULL,
    [TeamLeader] CHAR(15) NOT NULL,
    [Branch_Id] CHAR(15) NOT NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NOT NULL,
    [Creation_Date] DATETIME NOT NULL,
    [Account_Status] CHAR(15) NOT NULL,
    [Login_Status] BIT NOT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ITBranch
-- --------------------------------------------------
CREATE TABLE [dbo].[ITBranch]
(
    [Branch] NVARCHAR(255) NULL,
    [Category] NVARCHAR(255) NULL,
    [Employee id] NVARCHAR(255) NULL,
    [Name ] NVARCHAR(255) NULL,
    [E-mail Id] NVARCHAR(255) NULL,
    [HOD ID] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ITList
-- --------------------------------------------------
CREATE TABLE [dbo].[ITList]
(
    [Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Department] NVARCHAR(255) NULL,
    [Team_Id] NVARCHAR(255) NULL,
    [Role] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.JobStatusMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[JobStatusMaster]
(
    [JobStatus_Id] CHAR(15) NOT NULL,
    [JobStatus_Name] VARCHAR(60) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.KARAD1
-- --------------------------------------------------
CREATE TABLE [dbo].[KARAD1]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.KARAD12
-- --------------------------------------------------
CREATE TABLE [dbo].[KARAD12]
(
    [Odinid] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.KB_08_10_2010
-- --------------------------------------------------
CREATE TABLE [dbo].[KB_08_10_2010]
(
    [Name of the product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [Type of call] NVARCHAR(255) NULL,
    [Product Name] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr# No] FLOAT NULL,
    [Solution in Brief] NVARCHAR(255) NULL,
    [Detailed Solution] NVARCHAR(MAX) NULL,
    [Issue Area] NVARCHAR(255) NULL,
    [Type of Issue] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.KB123
-- --------------------------------------------------
CREATE TABLE [dbo].[KB123]
(
    [Name of the product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [Type of call] NVARCHAR(255) NULL,
    [Product Name] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr# No] FLOAT NULL,
    [Solution in Brief] NVARCHAR(255) NULL,
    [Detailed Solution] NVARCHAR(255) NULL,
    [Issue Area] NVARCHAR(255) NULL,
    [Type of Issue] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.levelsummary_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[levelsummary_Temp]
(
    [issue_resolved_by] VARCHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] DATETIME NOT NULL,
    [completed] CHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.levelsummary_Temp1
-- --------------------------------------------------
CREATE TABLE [dbo].[levelsummary_Temp1]
(
    [issue_resolved_by] VARCHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] DATETIME NOT NULL,
    [completed] CHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.levelsummary_Temp2
-- --------------------------------------------------
CREATE TABLE [dbo].[levelsummary_Temp2]
(
    [issue_resolved_by] VARCHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] DATETIME NOT NULL,
    [Escalated] CHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.levelsummary_Temp3
-- --------------------------------------------------
CREATE TABLE [dbo].[levelsummary_Temp3]
(
    [issue_resolved_by] VARCHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] DATETIME NOT NULL,
    [Pending] CHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.levelsummary_Temp4
-- --------------------------------------------------
CREATE TABLE [dbo].[levelsummary_Temp4]
(
    [issue_resolved_by] VARCHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] DATETIME NOT NULL,
    [Reassigned] CHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.levelsummary_Temp5
-- --------------------------------------------------
CREATE TABLE [dbo].[levelsummary_Temp5]
(
    [issue_resolved_by] VARCHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] DATETIME NOT NULL,
    [Closed] CHAR(8) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Manager_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[Manager_Details]
(
    [Manager_Code] CHAR(25) NULL,
    [MIP] CHAR(15) NULL,
    [GlobalIP] CHAR(20) NULL,
    [GlobalIP1] CHAR(20) NULL,
    [GlobalIP2] CHAR(20) NULL,
    [GlobalIP3] CHAR(20) NULL,
    [Port] CHAR(8) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[MMaster]
(
    [Userid] CHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NULL,
    [Role_Id] CHAR(15) NULL,
    [TeamLeader] CHAR(15) NULL,
    [Branch_Id] CHAR(15) NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [Creation_Date] DATETIME NULL,
    [Account_Status] BIT NULL,
    [Login_Status] BIT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MUser_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[MUser_Master]
(
    [Userid] CHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NULL,
    [Role_Id] CHAR(15) NULL,
    [TeamLeader] CHAR(15) NULL,
    [Branch_Id] CHAR(15) NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [Creation_Date] DATETIME NULL,
    [Account_Status] BIT NULL,
    [Login_Status] BIT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.new$
-- --------------------------------------------------
CREATE TABLE [dbo].[new$]
(
    [Sr# No#] FLOAT NULL,
    [BRANCH TAG] NVARCHAR(255) NULL,
    [BRANCH NAME] NVARCHAR(255) NULL,
    [CENTRAL SUPPORT] NVARCHAR(255) NULL,
    [IT PERSON] NVARCHAR(255) NULL,
    [IT CATEOGRY] NVARCHAR(255) NULL,
    [EMP_ID] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [F9] NVARCHAR(255) NULL,
    [F10] NVARCHAR(255) NULL,
    [F11] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL,
    [F13] NVARCHAR(255) NULL,
    [F14] NVARCHAR(255) NULL,
    [F15] NVARCHAR(255) NULL,
    [F16] NVARCHAR(255) NULL,
    [F17] NVARCHAR(255) NULL,
    [F18] NVARCHAR(255) NULL,
    [F19] NVARCHAR(255) NULL,
    [F20] NVARCHAR(255) NULL,
    [F21] NVARCHAR(255) NULL,
    [F22] NVARCHAR(255) NULL,
    [F23] NVARCHAR(255) NULL,
    [F24] NVARCHAR(255) NULL,
    [F25] NVARCHAR(255) NULL,
    [F26] NVARCHAR(255) NULL,
    [F27] NVARCHAR(255) NULL,
    [F28] NVARCHAR(255) NULL,
    [F29] NVARCHAR(255) NULL,
    [F30] NVARCHAR(255) NULL,
    [F31] NVARCHAR(255) NULL,
    [F32] NVARCHAR(255) NULL,
    [F33] NVARCHAR(255) NULL,
    [F34] NVARCHAR(255) NULL,
    [F35] NVARCHAR(255) NULL,
    [F36] NVARCHAR(255) NULL,
    [F37] NVARCHAR(255) NULL,
    [F38] NVARCHAR(255) NULL,
    [F39] NVARCHAR(255) NULL,
    [F40] NVARCHAR(255) NULL,
    [F41] NVARCHAR(255) NULL,
    [F42] NVARCHAR(255) NULL,
    [F43] NVARCHAR(255) NULL,
    [F44] NVARCHAR(255) NULL,
    [F45] NVARCHAR(255) NULL,
    [F46] NVARCHAR(255) NULL,
    [F47] NVARCHAR(255) NULL,
    [F48] NVARCHAR(255) NULL,
    [F49] NVARCHAR(255) NULL,
    [F50] NVARCHAR(255) NULL,
    [F51] NVARCHAR(255) NULL,
    [F52] NVARCHAR(255) NULL,
    [F53] NVARCHAR(255) NULL,
    [F54] NVARCHAR(255) NULL,
    [F55] NVARCHAR(255) NULL,
    [F56] NVARCHAR(255) NULL,
    [F57] NVARCHAR(255) NULL,
    [F58] NVARCHAR(255) NULL,
    [F59] NVARCHAR(255) NULL,
    [F60] NVARCHAR(255) NULL,
    [F61] NVARCHAR(255) NULL,
    [F62] NVARCHAR(255) NULL,
    [F63] NVARCHAR(255) NULL,
    [F64] NVARCHAR(255) NULL,
    [F65] NVARCHAR(255) NULL,
    [F66] NVARCHAR(255) NULL,
    [F67] NVARCHAR(255) NULL,
    [F68] NVARCHAR(255) NULL,
    [F69] NVARCHAR(255) NULL,
    [F70] NVARCHAR(255) NULL,
    [F71] NVARCHAR(255) NULL,
    [F72] NVARCHAR(255) NULL,
    [F73] NVARCHAR(255) NULL,
    [F74] NVARCHAR(255) NULL,
    [F75] NVARCHAR(255) NULL,
    [F76] NVARCHAR(255) NULL,
    [F77] NVARCHAR(255) NULL,
    [F78] NVARCHAR(255) NULL,
    [F79] NVARCHAR(255) NULL,
    [F80] NVARCHAR(255) NULL,
    [F81] NVARCHAR(255) NULL,
    [F82] NVARCHAR(255) NULL,
    [F83] NVARCHAR(255) NULL,
    [F84] NVARCHAR(255) NULL,
    [F85] NVARCHAR(255) NULL,
    [F86] NVARCHAR(255) NULL,
    [F87] NVARCHAR(255) NULL,
    [F88] NVARCHAR(255) NULL,
    [F89] NVARCHAR(255) NULL,
    [F90] NVARCHAR(255) NULL,
    [F91] NVARCHAR(255) NULL,
    [F92] NVARCHAR(255) NULL,
    [F93] NVARCHAR(255) NULL,
    [F94] NVARCHAR(255) NULL,
    [F95] NVARCHAR(255) NULL,
    [F96] NVARCHAR(255) NULL,
    [F97] NVARCHAR(255) NULL,
    [F98] NVARCHAR(255) NULL,
    [F99] NVARCHAR(255) NULL,
    [F100] NVARCHAR(255) NULL,
    [F101] NVARCHAR(255) NULL,
    [F102] NVARCHAR(255) NULL,
    [F103] NVARCHAR(255) NULL,
    [F104] NVARCHAR(255) NULL,
    [F105] NVARCHAR(255) NULL,
    [F106] NVARCHAR(255) NULL,
    [F107] NVARCHAR(255) NULL,
    [F108] NVARCHAR(255) NULL,
    [F109] NVARCHAR(255) NULL,
    [F110] NVARCHAR(255) NULL,
    [F111] NVARCHAR(255) NULL,
    [F112] NVARCHAR(255) NULL,
    [F113] NVARCHAR(255) NULL,
    [F114] NVARCHAR(255) NULL,
    [F115] NVARCHAR(255) NULL,
    [F116] NVARCHAR(255) NULL,
    [F117] NVARCHAR(255) NULL,
    [F118] NVARCHAR(255) NULL,
    [F119] NVARCHAR(255) NULL,
    [F120] NVARCHAR(255) NULL,
    [F121] NVARCHAR(255) NULL,
    [F122] NVARCHAR(255) NULL,
    [F123] NVARCHAR(255) NULL,
    [F124] NVARCHAR(255) NULL,
    [F125] NVARCHAR(255) NULL,
    [F126] NVARCHAR(255) NULL,
    [F127] NVARCHAR(255) NULL,
    [F128] NVARCHAR(255) NULL,
    [F129] NVARCHAR(255) NULL,
    [F130] NVARCHAR(255) NULL,
    [F131] NVARCHAR(255) NULL,
    [F132] NVARCHAR(255) NULL,
    [F133] NVARCHAR(255) NULL,
    [F134] NVARCHAR(255) NULL,
    [F135] NVARCHAR(255) NULL,
    [F136] NVARCHAR(255) NULL,
    [F137] NVARCHAR(255) NULL,
    [F138] NVARCHAR(255) NULL,
    [F139] NVARCHAR(255) NULL,
    [F140] NVARCHAR(255) NULL,
    [F141] NVARCHAR(255) NULL,
    [F142] NVARCHAR(255) NULL,
    [F143] NVARCHAR(255) NULL,
    [F144] NVARCHAR(255) NULL,
    [F145] NVARCHAR(255) NULL,
    [F146] NVARCHAR(255) NULL,
    [F147] NVARCHAR(255) NULL,
    [F148] NVARCHAR(255) NULL,
    [F149] NVARCHAR(255) NULL,
    [F150] NVARCHAR(255) NULL,
    [F151] NVARCHAR(255) NULL,
    [F152] NVARCHAR(255) NULL,
    [F153] NVARCHAR(255) NULL,
    [F154] NVARCHAR(255) NULL,
    [F155] NVARCHAR(255) NULL,
    [F156] NVARCHAR(255) NULL,
    [F157] NVARCHAR(255) NULL,
    [F158] NVARCHAR(255) NULL,
    [F159] NVARCHAR(255) NULL,
    [F160] NVARCHAR(255) NULL,
    [F161] NVARCHAR(255) NULL,
    [F162] NVARCHAR(255) NULL,
    [F163] NVARCHAR(255) NULL,
    [F164] NVARCHAR(255) NULL,
    [F165] NVARCHAR(255) NULL,
    [F166] NVARCHAR(255) NULL,
    [F167] NVARCHAR(255) NULL,
    [F168] NVARCHAR(255) NULL,
    [F169] NVARCHAR(255) NULL,
    [F170] NVARCHAR(255) NULL,
    [F171] NVARCHAR(255) NULL,
    [F172] NVARCHAR(255) NULL,
    [F173] NVARCHAR(255) NULL,
    [F174] NVARCHAR(255) NULL,
    [F175] NVARCHAR(255) NULL,
    [F176] NVARCHAR(255) NULL,
    [F177] NVARCHAR(255) NULL,
    [F178] NVARCHAR(255) NULL,
    [F179] NVARCHAR(255) NULL,
    [F180] NVARCHAR(255) NULL,
    [F181] NVARCHAR(255) NULL,
    [F182] NVARCHAR(255) NULL,
    [F183] NVARCHAR(255) NULL,
    [F184] NVARCHAR(255) NULL,
    [F185] NVARCHAR(255) NULL,
    [F186] NVARCHAR(255) NULL,
    [F187] NVARCHAR(255) NULL,
    [F188] NVARCHAR(255) NULL,
    [F189] NVARCHAR(255) NULL,
    [F190] NVARCHAR(255) NULL,
    [F191] NVARCHAR(255) NULL,
    [F192] NVARCHAR(255) NULL,
    [F193] NVARCHAR(255) NULL,
    [F194] NVARCHAR(255) NULL,
    [F195] NVARCHAR(255) NULL,
    [F196] NVARCHAR(255) NULL,
    [F197] NVARCHAR(255) NULL,
    [F198] NVARCHAR(255) NULL,
    [F199] NVARCHAR(255) NULL,
    [F200] NVARCHAR(255) NULL,
    [F201] NVARCHAR(255) NULL,
    [F202] NVARCHAR(255) NULL,
    [F203] NVARCHAR(255) NULL,
    [F204] NVARCHAR(255) NULL,
    [F205] NVARCHAR(255) NULL,
    [F206] NVARCHAR(255) NULL,
    [F207] NVARCHAR(255) NULL,
    [F208] NVARCHAR(255) NULL,
    [F209] NVARCHAR(255) NULL,
    [F210] NVARCHAR(255) NULL,
    [F211] NVARCHAR(255) NULL,
    [F212] NVARCHAR(255) NULL,
    [F213] NVARCHAR(255) NULL,
    [F214] NVARCHAR(255) NULL,
    [F215] NVARCHAR(255) NULL,
    [F216] NVARCHAR(255) NULL,
    [F217] NVARCHAR(255) NULL,
    [F218] NVARCHAR(255) NULL,
    [F219] NVARCHAR(255) NULL,
    [F220] NVARCHAR(255) NULL,
    [F221] NVARCHAR(255) NULL,
    [F222] NVARCHAR(255) NULL,
    [F223] NVARCHAR(255) NULL,
    [F224] NVARCHAR(255) NULL,
    [F225] NVARCHAR(255) NULL,
    [F226] NVARCHAR(255) NULL,
    [F227] NVARCHAR(255) NULL,
    [F228] NVARCHAR(255) NULL,
    [F229] NVARCHAR(255) NULL,
    [F230] NVARCHAR(255) NULL,
    [F231] NVARCHAR(255) NULL,
    [F232] NVARCHAR(255) NULL,
    [F233] NVARCHAR(255) NULL,
    [F234] NVARCHAR(255) NULL,
    [F235] NVARCHAR(255) NULL,
    [F236] NVARCHAR(255) NULL,
    [F237] NVARCHAR(255) NULL,
    [F238] NVARCHAR(255) NULL,
    [F239] NVARCHAR(255) NULL,
    [F240] NVARCHAR(255) NULL,
    [F241] NVARCHAR(255) NULL,
    [F242] NVARCHAR(255) NULL,
    [F243] NVARCHAR(255) NULL,
    [F244] NVARCHAR(255) NULL,
    [F245] NVARCHAR(255) NULL,
    [F246] NVARCHAR(255) NULL,
    [F247] NVARCHAR(255) NULL,
    [F248] NVARCHAR(255) NULL,
    [F249] NVARCHAR(255) NULL,
    [F250] NVARCHAR(255) NULL,
    [F251] NVARCHAR(255) NULL,
    [F252] NVARCHAR(255) NULL,
    [F253] NVARCHAR(255) NULL,
    [F254] NVARCHAR(255) NULL,
    [F255] NVARCHAR(255) NULL,
    [F256] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.new_data
-- --------------------------------------------------
CREATE TABLE [dbo].[new_data]
(
    [TT_NUMBER] VARCHAR(50) NOT NULL,
    [Docket_Number] CHAR(20) NULL,
    [SBTAG] VARCHAR(1) NOT NULL,
    [Client_Code] CHAR(50) NOT NULL,
    [Product_Code] VARCHAR(1) NOT NULL,
    [Tagbranch] VARCHAR(50) NULL,
    [Issue_Raised_Datetime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Call_From] CHAR(25) NULL,
    [Call_Type] CHAR(25) NULL,
    [Source] CHAR(10) NULL,
    [Issue_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Detailed_Solution] VARCHAR(MAX) NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(MAX) NULL,
    [L1_FinalRemark] VARCHAR(MAX) NULL,
    [L2_UserRemark] VARCHAR(MAX) NULL,
    [L3_UserRemark] VARCHAR(MAX) NULL,
    [Issue_resolved_By] VARCHAR(15) NULL,
    [Team_ID] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NewBranch
-- --------------------------------------------------
CREATE TABLE [dbo].[NewBranch]
(
    [Branch] NVARCHAR(255) NULL,
    [BranchName] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.newkb
-- --------------------------------------------------
CREATE TABLE [dbo].[newkb]
(
    [Product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [CallType] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr_No] FLOAT NULL,
    [Brief_Solution] NVARCHAR(255) NULL,
    [Detailed_Solution] NVARCHAR(255) NULL,
    [Issue_Area] NVARCHAR(255) NULL,
    [TypeofIssue] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.newkb1
-- --------------------------------------------------
CREATE TABLE [dbo].[newkb1]
(
    [Product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [CallType] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr_No] FLOAT NULL,
    [Brief_Solution] NVARCHAR(255) NULL,
    [Detailed_Solution] NVARCHAR(255) NULL,
    [Issue_Area] NVARCHAR(255) NULL,
    [TypeofIssue] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.newkbtest
-- --------------------------------------------------
CREATE TABLE [dbo].[newkbtest]
(
    [Product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [CallType] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr_No] FLOAT NULL,
    [Brief_Solution] NVARCHAR(255) NULL,
    [Detailed_Solution] NVARCHAR(255) NULL,
    [Issue_Area] NVARCHAR(255) NULL,
    [TypeofIssue] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE]
(
    [Branch Code] NVARCHAR(255) NULL,
    [SB# Tag] NVARCHAR(255) NULL,
    [OdinId] NVARCHAR(255) NULL,
    [Seg] NVARCHAR(255) NULL,
    [Terminal Status] FLOAT NULL,
    [Activation Date] DATETIME NULL,
    [NCFM Valid Upto] DATETIME NULL,
    [Contact Person] NVARCHAR(255) NULL,
    [Mode of connectivity] NVARCHAR(255) NULL,
    [NSE CTCL Server] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE$
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE$]
(
    [Server] VARCHAR(50) NULL,
    [BranchCode] VARCHAR(50) NULL,
    [SBCode] VARCHAR(50) NULL,
    [OdinId] VARCHAR(50) NULL,
    [Seg] VARCHAR(50) NULL,
    [Status] FLOAT NULL,
    [ActivationDate] DATETIME NULL,
    [NCFMDate] DATETIME NULL,
    [Contactperson] VARCHAR(50) NULL,
    [Connectivity] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins12
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins12]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins15
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins15]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins16
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins16]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins18
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins18]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins20
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins20]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins24
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins24]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins28
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins28]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins30
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins30]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins32
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins32]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins34
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins34]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins35
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins35]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins38
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins38]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins41
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins41]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odins65
-- --------------------------------------------------
CREATE TABLE [dbo].[Odins65]
(
    [Client_Code] NVARCHAR(255) NULL,
    [Branch_Code] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Status] FLOAT NULL,
    [BSE] FLOAT NULL,
    [NSE] FLOAT NULL,
    [NSEFO] FLOAT NULL,
    [MCX] FLOAT NULL,
    [NCDEX] FLOAT NULL,
    [User_Creation_Time] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Secondary_Product] NVARCHAR(255) NULL,
    [Manager] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OldCTCL_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[OldCTCL_Details]
(
    [Branch_Name] NVARCHAR(50) NULL,
    [ctcl_odinid] NVARCHAR(50) NULL,
    [CtclBranch_Segment] VARCHAR(5) NULL,
    [CTCLID] NVARCHAR(4000) NULL,
    [Ctcl_ISBTag] NVARCHAR(50) NULL,
    [Ctcl_AllotDate] NVARCHAR(12) NULL,
    [Ctcl_DisablingDate] NVARCHAR(12) NULL,
    [Ctcl_RegValidDate] NVARCHAR(12) NULL,
    [CTCL_IBranch_cd] NVARCHAR(50) NULL,
    [Ctcl_Status] VARCHAR(8) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OldView_Subbroker
-- --------------------------------------------------
CREATE TABLE [dbo].[OldView_Subbroker]
(
    [RefNo] VARCHAR(50) NOT NULL,
    [TAG] VARCHAR(25) NOT NULL,
    [Segment] VARCHAR(10) NOT NULL,
    [Regname] VARCHAR(100) NULL,
    [TradeName] VARCHAR(100) NULL,
    [Type] VARCHAR(50) NULL,
    [DOB] VARCHAR(20) NULL,
    [Sex] VARCHAR(10) NULL,
    [Resadd1] VARCHAR(300) NULL,
    [Resadd2] VARCHAR(300) NULL,
    [Resadd3] VARCHAR(300) NULL,
    [Rcity] VARCHAR(30) NULL,
    [ResPincode] VARCHAR(20) NULL,
    [OfAddress1] VARCHAR(100) NULL,
    [OffAddress2] VARCHAR(100) NULL,
    [OffAddress3] VARCHAR(100) NULL,
    [OffCity] VARCHAR(50) NULL,
    [OffPincode] VARCHAR(20) NULL,
    [OfficePhone] VARCHAR(25) NULL,
    [Mobile] VARCHAR(100) NULL,
    [ResPhone] VARCHAR(100) NULL,
    [Fax No] VARCHAR(25) NULL,
    [PAN] VARCHAR(15) NULL,
    [EmailID] VARCHAR(100) NULL,
    [Maker ID] VARCHAR(25) NULL,
    [Maker Date] VARCHAR(30) NULL,
    [TAGBranch] VARCHAR(50) NULL,
    [GL Unregistered code] VARCHAR(15) NULL,
    [GL Registered Code] VARCHAR(15) NULL,
    [Regstatus] VARCHAR(50) NULL,
    [Regdate] DATETIME NULL,
    [Registration No] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Online_Client_Master_Data1
-- --------------------------------------------------
CREATE TABLE [dbo].[Online_Client_Master_Data1]
(
    [Bo_PartyCode] VARCHAR(20) NOT NULL,
    [IH_B2C] VARCHAR(5) NULL,
    [OnlineOffline] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Online_Client_Master_Data2
-- --------------------------------------------------
CREATE TABLE [dbo].[Online_Client_Master_Data2]
(
    [Bo_PartyCode] VARCHAR(20) NOT NULL,
    [IH_B2C] VARCHAR(5) NULL,
    [OnlineOffline] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Parag_Rajkot
-- --------------------------------------------------
CREATE TABLE [dbo].[Parag_Rajkot]
(
    [ClientTag] NVARCHAR(255) NULL,
    [ClientName] NVARCHAR(255) NULL,
    [ClientAddress] NVARCHAR(255) NULL,
    [ClientContact] FLOAT NULL,
    [Connectivity] NVARCHAR(255) NULL,
    [ClientIP] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Parag_Rajkot$
-- --------------------------------------------------
CREATE TABLE [dbo].[Parag_Rajkot$]
(
    [ClientTag] NVARCHAR(255) NULL,
    [ClientAddress] NVARCHAR(255) NULL,
    [ClientContact] FLOAT NULL,
    [Connectivity] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Parag_Rajkot_New
-- --------------------------------------------------
CREATE TABLE [dbo].[Parag_Rajkot_New]
(
    [TAG] NVARCHAR(255) NULL,
    [ClientTag] NVARCHAR(255) NULL,
    [ClientName] NVARCHAR(255) NULL,
    [ClientAddress] NVARCHAR(255) NULL,
    [ClientContact] FLOAT NULL,
    [Connectivity] NVARCHAR(255) NULL,
    [ClientIP] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Rajkot_Data
-- --------------------------------------------------
CREATE TABLE [dbo].[Rajkot_Data]
(
    [Odin_Id] VARCHAR(50) NULL,
    [SB_Code] VARCHAR(50) NULL,
    [Branch_Code] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(100) NULL,
    [Segment] VARCHAR(50) NULL,
    [Terminal_Status] BIT NULL,
    [Activation_Date] DATETIME NULL,
    [NCFM_Validation_Date] DATETIME NULL,
    [Mode_of_Connectivity] VARCHAR(50) NULL,
    [Odin_Manager_Code] VARCHAR(50) NULL,
    [Contact_Person] VARCHAR(100) NULL,
    [Contact_Number] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.region
-- --------------------------------------------------
CREATE TABLE [dbo].[region]
(
    [Code] VARCHAR(255) NULL,
    [Name] VARCHAR(255) NULL,
    [FRANCHISEE] VARCHAR(255) NULL,
    [REG_CODE] VARCHAR(255) NULL,
    [REGION] VARCHAR(255) NULL,
    [ADMIN] VARCHAR(255) NULL,
    [regioncode] VARCHAR(10) NULL,
    [nbranchcode] VARCHAR(10) NULL,
    [ctcl_region] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.region_master
-- --------------------------------------------------
CREATE TABLE [dbo].[region_master]
(
    [Rgmast_code] VARCHAR(50) NULL,
    [RgMast_name] VARCHAR(50) NULL,
    [Region_cd] VARCHAR(50) NULL,
    [Mapped_on] DATETIME NULL,
    [Mapped_by] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Role_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Role_Master]
(
    [Role_Id] CHAR(15) NOT NULL,
    [Role_Name] VARCHAR(82) NOT NULL,
    [Team_ID] CHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Role_Master_Backup_7Jan2011
-- --------------------------------------------------
CREATE TABLE [dbo].[Role_Master_Backup_7Jan2011]
(
    [Role_Id] CHAR(15) NOT NULL,
    [Role_Name] VARCHAR(82) NOT NULL,
    [Team_ID] CHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SalesByQuarter
-- --------------------------------------------------
CREATE TABLE [dbo].[SalesByQuarter]
(
    [Y] INT NOT NULL,
    [Q] INT NOT NULL,
    [sales] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sanjay_Updated_Info
-- --------------------------------------------------
CREATE TABLE [dbo].[Sanjay_Updated_Info]
(
    [Client_Code] CHAR(25) NOT NULL,
    [primary_product] CHAR(25) NULL,
    [Manager_Code] CHAR(25) NULL,
    [Account_Status] BIT NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sbconn
-- --------------------------------------------------
CREATE TABLE [dbo].[sbconn]
(
    [SBCODE] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sent_messages
-- --------------------------------------------------
CREATE TABLE [dbo].[sent_messages]
(
    [Msg_id] INT IDENTITY(1,1) NOT NULL,
    [Sent_by] VARCHAR(50) NOT NULL,
    [Sent_to] VARCHAR(50) NOT NULL,
    [Date_in] DATETIME NOT NULL,
    [Mess_valid_from] DATETIME NOT NULL,
    [Mess_valid_to] DATETIME NOT NULL,
    [Message_sent] TEXT NOT NULL,
    [Critical] CHAR(15) NOT NULL,
    [Message_status] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SMU
-- --------------------------------------------------
CREATE TABLE [dbo].[SMU]
(
    [Location] NVARCHAR(255) NULL,
    [OdinManager] NVARCHAR(255) NULL,
    [RMManager] NVARCHAR(255) NULL,
    [Managerversion] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Surv_calls_tag$
-- --------------------------------------------------
CREATE TABLE [dbo].[Surv_calls_tag$]
(
    [Product] NVARCHAR(255) NULL,
    [Type] NVARCHAR(255) NULL,
    [Nature] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Brief Solution] NVARCHAR(255) NULL,
    [Detailed Solution] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sysdiagrams
-- --------------------------------------------------
CREATE TABLE [dbo].[sysdiagrams]
(
    [name] NVARCHAR(128) NOT NULL,
    [principal_id] INT NOT NULL,
    [diagram_id] INT IDENTITY(1,1) NOT NULL,
    [version] INT NULL,
    [definition] VARBINARY(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Task_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[Task_Details]
(
    [TT_Code] VARCHAR(25) NOT NULL,
    [Docket_Number] CHAR(8) NOT NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Inbound_Outbound] CHAR(10) NULL,
    [Call_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Solution] TEXT NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(200) NULL,
    [L1_FinalRemark] VARCHAR(200) NULL,
    [L2_UserRemark] VARCHAR(200) NULL,
    [L3_UserRemark] VARCHAR(200) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Application
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Application]
(
    [Name_Of_Application] VARCHAR(50) NULL,
    [Sub_Application] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BO_CallType
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BO_CallType]
(
    [Type_Of_Call] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BOIssueDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BOIssueDetails]
(
    [DID] CHAR(10) NOT NULL,
    [Docket_Number] VARCHAR(50) NULL,
    [Employee_Code] CHAR(25) NULL,
    [Employee_Name] VARCHAR(250) NULL,
    [Department] CHAR(50) NULL,
    [Mobile] CHAR(12) NULL,
    [Email] VARCHAR(50) NULL,
    [Attendance_Location] VARCHAR(100) NULL,
    [Product_Code] CHAR(25) NULL,
    [Application_Name] VARCHAR(100) NULL,
    [Nature] VARCHAR(50) NULL,
    [Problem] VARCHAR(250) NULL,
    [Issue_Type] VARCHAR(200) NULL,
    [Brief_Solution] VARCHAR(5000) NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL,
    [NSE_Currency] BIT NULL,
    [MCX_Currency] BIT NULL,
    [MFSS] BIT NULL,
    [NA] BIT NULL,
    [Call_Source] CHAR(10) NULL,
    [Issue_Raised_Datetime] DATETIME NULL,
    [Issue_Time] DATETIME NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolved_By] CHAR(25) NULL,
    [Executive_Remark] VARCHAR(2000) NULL,
    [Employee_ExistsFlag] BIT NULL,
    [Status_Code] CHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BOIssueMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BOIssueMaster]
(
    [Docket_Number] VARCHAR(50) NOT NULL,
    [Employee_Code] CHAR(25) NULL,
    [Employee_Name] VARCHAR(250) NULL,
    [Department] CHAR(50) NULL,
    [Mobile] CHAR(12) NULL,
    [Email] VARCHAR(50) NULL,
    [Attendance_Location] VARCHAR(100) NULL,
    [Product_Code] CHAR(25) NULL,
    [Application_Name] VARCHAR(100) NULL,
    [Nature] VARCHAR(50) NULL,
    [Problem] VARCHAR(250) NULL,
    [Issue_Type] VARCHAR(200) NULL,
    [Brief_Solution] VARCHAR(5000) NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL,
    [NSE_Currency] BIT NULL,
    [MCX_Currency] BIT NULL,
    [MFSS] BIT NULL,
    [NA] BIT NULL,
    [Call_Source] CHAR(10) NULL,
    [Issue_Raised_Datetime] DATETIME NULL,
    [Issue_Time] DATETIME NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolved_By] CHAR(25) NULL,
    [Executive_Remark] VARCHAR(2000) NULL,
    [Employee_ExistsFlag] BIT NULL,
    [Status_Code] CHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BOSolution
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BOSolution]
(
    [Solution] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Branch_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Branch_Master]
(
    [Branch_Code] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Branch_Master_1012
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Branch_Master_1012]
(
    [Branch_Code] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Branch_Master_OLD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Branch_Master_OLD]
(
    [Branch_Code] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_BRIssue_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_BRIssue_Details]
(
    [DID] VARCHAR(10) NOT NULL,
    [Docket_No] CHAR(10) NOT NULL,
    [Branch_Tag] VARCHAR(10) NULL,
    [Branch_Name] VARCHAR(100) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Boardline_No] VARCHAR(50) NULL,
    [Branch_State] VARCHAR(25) NULL,
    [Region] VARCHAR(25) NULL,
    [Zone] VARCHAR(25) NULL,
    [Employee_ID] VARCHAR(10) NULL,
    [Employee_Name] VARCHAR(100) NULL,
    [Dept_Desg] VARCHAR(100) NULL,
    [Issue_Raised_Datetime] DATETIME NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Issue_Type] CHAR(10) NULL,
    [Existing_Branch] BIT NULL,
    [Call_Type] CHAR(20) NULL,
    [Issue_Area] VARCHAR(50) NULL,
    [Nature] VARCHAR(50) NULL,
    [Problem] VARCHAR(200) NULL,
    [Brief_Solution] VARCHAR(5000) NULL,
    [Remark] VARCHAR(MAX) NULL,
    [Issue_Resolved_By] VARCHAR(50) NULL,
    [Team_ID] VARCHAR(50) NULL,
    [Status_Code] CHAR(20) NULL,
    [Emailadd] VARCHAR(100) NULL,
    [Call_Mail] CHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_BRIssue_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_BRIssue_Master]
(
    [Docket_No] CHAR(10) NOT NULL DEFAULT ((10000000)),
    [Branch_Tag] VARCHAR(10) NULL,
    [Branch_Name] VARCHAR(100) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Boardline_No] VARCHAR(50) NULL,
    [Branch_State] VARCHAR(25) NULL,
    [Region] VARCHAR(25) NULL,
    [Zone] VARCHAR(25) NULL,
    [Employee_ID] VARCHAR(10) NULL,
    [Employee_Name] VARCHAR(100) NULL,
    [Dept_Desg] VARCHAR(100) NULL,
    [Issue_Raised_Datetime] DATETIME NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Issue_Type] CHAR(10) NULL,
    [Existing_Branch] BIT NULL,
    [Call_Type] CHAR(20) NULL,
    [Issue_Area] VARCHAR(50) NULL,
    [Nature] VARCHAR(50) NULL,
    [Problem] VARCHAR(200) NULL,
    [Brief_Solution] VARCHAR(5000) NULL,
    [Remark] VARCHAR(MAX) NULL,
    [Issue_Resolved_By] VARCHAR(50) NULL,
    [Team_ID] VARCHAR(50) NULL,
    [Status_Code] CHAR(20) NULL,
    [Emailadd] VARCHAR(100) NULL,
    [Call_Mail] CHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_BRKB_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_BRKB_Master]
(
    [Issue_area] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Brief_Solution] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_BRSupport_KB 
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_BRSupport_KB ]
(
    [Issue_area] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Brief_Solution] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CSO_Master_OLD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CSO_Master_OLD]
(
    [CentralSupport] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name ] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CSOMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CSOMaster]
(
    [CentralSupport] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CSOmaster_09_OCT_2010
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CSOmaster_09_OCT_2010]
(
    [CentralSupport] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSOMaster_OLD2
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSOMaster_OLD2]
(
    [centralsupport] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CSOmaster_Test
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CSOmaster_Test]
(
    [CentralSupport] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_Call_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_Call_Master]
(
    [product_Name] NVARCHAR(255) NULL,
    [call_Type] NVARCHAR(255) NULL,
    [Nature] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_Category_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_Category_Master]
(
    [Category_master] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_KB_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_KB_Master]
(
    [Product_Name] VARCHAR(50) NULL,
    [Call_Type] VARCHAR(50) NULL,
    [Nature] VARCHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Sr_No] FLOAT NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Detailed_Solution] VARCHAR(MAX) NULL,
    [Issue_Area] VARCHAR(50) NULL,
    [Issue_Type] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_KB_Master_08_10_2010
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_KB_Master_08_10_2010]
(
    [Product_Name] VARCHAR(50) NULL,
    [Call_Type] VARCHAR(50) NULL,
    [Nature] VARCHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Sr_No] FLOAT NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Detailed_Solution] VARCHAR(MAX) NULL,
    [Issue_Area] VARCHAR(50) NULL,
    [Issue_Type] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_KB_Master_140909
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_KB_Master_140909]
(
    [product_Name] NVARCHAR(255) NULL,
    [call_type] NVARCHAR(255) NULL,
    [Nature] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr_No] FLOAT NULL,
    [Brief_Solution] NVARCHAR(255) NULL,
    [Detailed_Solution] NVARCHAR(MAX) NULL,
    [Issue_Area] NVARCHAR(255) NULL,
    [Issue_Type] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_KB_Master_Publish
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_KB_Master_Publish]
(
    [product_Name] VARCHAR(100) NOT NULL,
    [call_type] VARCHAR(50) NOT NULL,
    [Nature] VARCHAR(100) NOT NULL,
    [Problem] VARCHAR(255) NOT NULL,
    [Sr_No] INT NULL,
    [Brief_Solution] VARCHAR(MAX) NOT NULL,
    [Detailed_Solution] VARCHAR(MAX) NOT NULL,
    [Issue_Area] VARCHAR(100) NOT NULL,
    [Issue_Type] VARCHAR(100) NOT NULL,
    [Requested_By] CHAR(20) NULL,
    [Request_Approved_By] CHAR(20) NULL,
    [Request_DateTime] DATETIME NULL,
    [Request_Appr_DateTime] DATETIME NULL,
    [Publish_Status] BIT NOT NULL DEFAULT ((0)),
    [Admin_Remark] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_KB_Masternew
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_KB_Masternew]
(
    [Product Name] NVARCHAR(255) NULL,
    [Type of call] NVARCHAR(255) NULL,
    [Nature ] NVARCHAR(255) NULL,
    [Problem] NVARCHAR(255) NULL,
    [Sr# No] FLOAT NULL,
    [Solution in Brief] VARCHAR(700) NULL,
    [Detailed Solution] NVARCHAR(700) NULL,
    [Issue Area] NVARCHAR(255) NULL,
    [Type of Issue] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_locationmaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_locationmaster]
(
    [CentralSupportName] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_LocationMasterOLD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_LocationMasterOLD]
(
    [CentralSupportName] NVARCHAR(255) NULL,
    [Branch_Tag] NVARCHAR(255) NULL,
    [Branch_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_Manager_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_Manager_Master]
(
    [Manager_Location] NVARCHAR(255) NULL,
    [Server_name_IT] NVARCHAR(255) NULL,
    [Server_name_RM] NVARCHAR(255) NULL,
    [Manager_version] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_OdinMaster_Mahendra_Backup
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_OdinMaster_Mahendra_Backup]
(
    [Odin_Id] VARCHAR(50) NULL,
    [SB_Code] VARCHAR(50) NULL,
    [Branch_Code] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(100) NULL,
    [Segment] VARCHAR(50) NULL,
    [Terminal_Status] BIT NULL,
    [Activation_Date] DATETIME NULL,
    [NCFM_Validation_Date] DATETIME NULL,
    [Mode_of_Connectivity] VARCHAR(50) NULL,
    [Odin_Manager_Code] VARCHAR(50) NULL,
    [Contact_Person] VARCHAR(100) NULL,
    [Contact_Number] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_ProductMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_ProductMaster]
(
    [Product_Code] CHAR(25) NOT NULL,
    [Product_Name] VARCHAR(50) NOT NULL,
    [Product_Version] CHAR(10) NULL,
    [Odin_Manager_Code] VARCHAR(50) NULL,
    [RM_Manager_Code] VARCHAR(50) NULL,
    [Location] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_Role_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_Role_Master]
(
    [Role_ID] NCHAR(10) NOT NULL,
    [Role_name] NVARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_Status_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_Status_Master]
(
    [JobStatus_Id] CHAR(15) NOT NULL,
    [JobStatus_Name] VARCHAR(60) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_Subbroker_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_Subbroker_Master]
(
    [SB_Code] VARCHAR(50) NULL,
    [SB_Name] VARCHAR(50) NULL,
    [Manager_Code] CHAR(10) NULL,
    [Account_Status] BIT NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [BSEFO] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL,
    [Contact_Person] VARCHAR(50) NULL,
    [Address] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State] VARCHAR(50) NULL,
    [Country] VARCHAR(50) NULL,
    [Contact_Number] NCHAR(10) NULL,
    [Mobile] NCHAR(10) NULL,
    [Email] NCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_SubCategory_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_SubCategory_Master]
(
    [Category] NVARCHAR(255) NULL,
    [Sub_Category] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_TeamID
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_TeamID]
(
    [Team_ID] NCHAR(10) NULL,
    [Team_Name] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_User_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_User_Master]
(
    [Userid] VARCHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NOT NULL,
    [Role_Id] CHAR(15) NOT NULL,
    [TeamLeader] CHAR(15) NOT NULL,
    [Branch_Id] CHAR(15) NOT NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NOT NULL,
    [Creation_Date] DATETIME NOT NULL,
    [Account_Status] CHAR(15) NOT NULL,
    [Login_Status] BIT NOT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_ITBR_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_ITBR_Master]
(
    [Branch_Code] VARCHAR(60) NOT NULL,
    [Branch_Name] VARCHAR(250) NULL,
    [Region_Code] CHAR(25) NULL,
    [Zone_Code] CHAR(25) NULL,
    [CSO_Code] CHAR(25) NULL,
    [IT_Cat_Code] CHAR(25) NULL,
    [IT_Business_CateCode] CHAR(25) NULL,
    [Branch_Boardline] CHAR(20) NULL,
    [Branch_Mobile] VARCHAR(50) NULL,
    [Branch_Fax] CHAR(20) NULL,
    [Branch_Address] VARCHAR(250) NULL,
    [Branch_Pincode] CHAR(20) NULL,
    [Branch_City] VARCHAR(200) NULL,
    [Branch_State] VARCHAR(200) NULL,
    [Branch_Country] VARCHAR(200) NULL,
    [Branch_Email] VARCHAR(200) NULL,
    [Branch_HeadEmpNo] CHAR(25) NULL,
    [Branch_HeadName] VARCHAR(200) NULL,
    [Branch_HeadMobile] VARCHAR(50) NULL,
    [Branch_HeadEmail] VARCHAR(200) NULL,
    [ITContactPersonEmpno] CHAR(20) NULL,
    [ITContactPersonName] VARCHAR(200) NULL,
    [ITContactPersonEmail] VARCHAR(200) NULL,
    [ITContactPersonContactnumber] VARCHAR(80) NULL,
    [Regional_HeadName] VARCHAR(200) NULL,
    [Regional_HeadEmail] VARCHAR(250) NULL,
    [Regional_HeadMobile] VARCHAR(50) NULL,
    [Zonal_HeadName] VARCHAR(200) NULL,
    [Zonal_HeadEmail] VARCHAR(250) NULL,
    [Zonal_HeadMobile] VARCHAR(50) NULL,
    [Branch_Status] CHAR(1) NOT NULL,
    [Modified_By] CHAR(25) NULL,
    [Modified_Datetime] DATETIME NULL,
    [Modification_Remark] VARCHAR(250) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_ITBranchMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_ITBranchMaster]
(
    [Branch_Code] VARCHAR(60) NOT NULL,
    [Branch_Name] VARCHAR(250) NULL,
    [Region_Code] CHAR(25) NULL,
    [Zone_Code] CHAR(25) NULL,
    [CSO_Code] CHAR(25) NULL,
    [IT_Cat_Code] CHAR(25) NULL,
    [IT_Business_CateCode] CHAR(25) NULL,
    [Branch_Boardline] CHAR(20) NULL,
    [Branch_Mobile] VARCHAR(50) NULL,
    [Branch_Fax] CHAR(20) NULL,
    [Branch_Address] VARCHAR(250) NULL,
    [Branch_Pincode] CHAR(20) NULL,
    [Branch_City] VARCHAR(200) NULL,
    [Branch_State] VARCHAR(200) NULL,
    [Branch_Country] VARCHAR(200) NULL,
    [Branch_Email] VARCHAR(200) NULL,
    [Branch_HeadEmpNo] CHAR(25) NULL,
    [Branch_HeadName] VARCHAR(200) NULL,
    [Branch_HeadMobile] VARCHAR(50) NULL,
    [Branch_HeadEmail] VARCHAR(200) NULL,
    [ITContactPersonEmpno] CHAR(20) NULL,
    [ITContactPersonName] VARCHAR(200) NULL,
    [ITContactPersonEmail] VARCHAR(200) NULL,
    [ITContactPersonContactnumber] VARCHAR(80) NULL,
    [Regional_HeadName] VARCHAR(200) NULL,
    [Regional_HeadEmail] VARCHAR(250) NULL,
    [Regional_HeadMobile] VARCHAR(50) NULL,
    [Zonal_HeadName] VARCHAR(200) NULL,
    [Zonal_HeadEmail] VARCHAR(250) NULL,
    [Zonal_HeadMobile] VARCHAR(50) NULL,
    [Branch_Status] CHAR(1) NOT NULL,
    [Modified_By] CHAR(25) NULL,
    [Modified_Datetime] DATETIME NULL,
    [Modification_Remark] VARCHAR(250) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ITSubbroker_Exists
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ITSubbroker_Exists]
(
    [Refrence_Number] CHAR(8) NOT NULL,
    [Subbroker_Name] VARCHAR(200) NULL,
    [Branch_Tag] CHAR(25) NULL,
    [Branch_Name] VARCHAR(200) NULL,
    [Landline] CHAR(10) NULL,
    [Office_Number] CHAR(10) NULL,
    [Mobile] CHAR(10) NULL,
    [Region] VARCHAR(100) NULL,
    [State] VARCHAR(100) NULL,
    [Email] VARCHAR(100) NULL,
    [Address] VARCHAR(200) NULL,
    [City] CHAR(100) NULL,
    [Issue_Raised_Date] DATETIME NULL,
    [Issue_Resolved_Date] DATETIME NULL,
    [Product_Name] VARCHAR(50) NULL,
    [Nature] VARCHAR(100) NULL,
    [Problem] VARCHAR(100) NULL,
    [Brief_Solution] VARCHAR(200) NULL,
    [Remark] VARCHAR(500) NULL,
    [Issue_Resolved_By] CHAR(10) NULL,
    [Status] CHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBl_MGTID
-- --------------------------------------------------
CREATE TABLE [dbo].[TBl_MGTID]
(
    [Sr# No#] FLOAT NULL,
    [BRANCH TAG] NVARCHAR(255) NULL,
    [BRANCH NAME] NVARCHAR(255) NULL,
    [CENTRAL SUPPORT] NVARCHAR(255) NULL,
    [IT PERSON] NVARCHAR(255) NULL,
    [IT CATEOGRY] NVARCHAR(255) NULL,
    [EMP_ID] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'TBl_MGTID'
-- --------------------------------------------------
CREATE TABLE [dbo].['TBl_MGTID']
(
    [Sr# No#] FLOAT NULL,
    [BRANCH TAG] NVARCHAR(255) NULL,
    [BRANCH NAME] NVARCHAR(255) NULL,
    [CENTRAL SUPPORT] NVARCHAR(255) NULL,
    [IT PERSON] NVARCHAR(255) NULL,
    [IT CATEOGRY] NVARCHAR(255) NULL,
    [EMP_ID] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [F9] NVARCHAR(255) NULL,
    [F10] NVARCHAR(255) NULL,
    [F11] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL,
    [F13] NVARCHAR(255) NULL,
    [F14] NVARCHAR(255) NULL,
    [F15] NVARCHAR(255) NULL,
    [F16] NVARCHAR(255) NULL,
    [F17] NVARCHAR(255) NULL,
    [F18] NVARCHAR(255) NULL,
    [F19] NVARCHAR(255) NULL,
    [F20] NVARCHAR(255) NULL,
    [F21] NVARCHAR(255) NULL,
    [F22] NVARCHAR(255) NULL,
    [F23] NVARCHAR(255) NULL,
    [F24] NVARCHAR(255) NULL,
    [F25] NVARCHAR(255) NULL,
    [F26] NVARCHAR(255) NULL,
    [F27] NVARCHAR(255) NULL,
    [F28] NVARCHAR(255) NULL,
    [F29] NVARCHAR(255) NULL,
    [F30] NVARCHAR(255) NULL,
    [F31] NVARCHAR(255) NULL,
    [F32] NVARCHAR(255) NULL,
    [F33] NVARCHAR(255) NULL,
    [F34] NVARCHAR(255) NULL,
    [F35] NVARCHAR(255) NULL,
    [F36] NVARCHAR(255) NULL,
    [F37] NVARCHAR(255) NULL,
    [F38] NVARCHAR(255) NULL,
    [F39] NVARCHAR(255) NULL,
    [F40] NVARCHAR(255) NULL,
    [F41] NVARCHAR(255) NULL,
    [F42] NVARCHAR(255) NULL,
    [F43] NVARCHAR(255) NULL,
    [F44] NVARCHAR(255) NULL,
    [F45] NVARCHAR(255) NULL,
    [F46] NVARCHAR(255) NULL,
    [F47] NVARCHAR(255) NULL,
    [F48] NVARCHAR(255) NULL,
    [F49] NVARCHAR(255) NULL,
    [F50] NVARCHAR(255) NULL,
    [F51] NVARCHAR(255) NULL,
    [F52] NVARCHAR(255) NULL,
    [F53] NVARCHAR(255) NULL,
    [F54] NVARCHAR(255) NULL,
    [F55] NVARCHAR(255) NULL,
    [F56] NVARCHAR(255) NULL,
    [F57] NVARCHAR(255) NULL,
    [F58] NVARCHAR(255) NULL,
    [F59] NVARCHAR(255) NULL,
    [F60] NVARCHAR(255) NULL,
    [F61] NVARCHAR(255) NULL,
    [F62] NVARCHAR(255) NULL,
    [F63] NVARCHAR(255) NULL,
    [F64] NVARCHAR(255) NULL,
    [F65] NVARCHAR(255) NULL,
    [F66] NVARCHAR(255) NULL,
    [F67] NVARCHAR(255) NULL,
    [F68] NVARCHAR(255) NULL,
    [F69] NVARCHAR(255) NULL,
    [F70] NVARCHAR(255) NULL,
    [F71] NVARCHAR(255) NULL,
    [F72] NVARCHAR(255) NULL,
    [F73] NVARCHAR(255) NULL,
    [F74] NVARCHAR(255) NULL,
    [F75] NVARCHAR(255) NULL,
    [F76] NVARCHAR(255) NULL,
    [F77] NVARCHAR(255) NULL,
    [F78] NVARCHAR(255) NULL,
    [F79] NVARCHAR(255) NULL,
    [F80] NVARCHAR(255) NULL,
    [F81] NVARCHAR(255) NULL,
    [F82] NVARCHAR(255) NULL,
    [F83] NVARCHAR(255) NULL,
    [F84] NVARCHAR(255) NULL,
    [F85] NVARCHAR(255) NULL,
    [F86] NVARCHAR(255) NULL,
    [F87] NVARCHAR(255) NULL,
    [F88] NVARCHAR(255) NULL,
    [F89] NVARCHAR(255) NULL,
    [F90] NVARCHAR(255) NULL,
    [F91] NVARCHAR(255) NULL,
    [F92] NVARCHAR(255) NULL,
    [F93] NVARCHAR(255) NULL,
    [F94] NVARCHAR(255) NULL,
    [F95] NVARCHAR(255) NULL,
    [F96] NVARCHAR(255) NULL,
    [F97] NVARCHAR(255) NULL,
    [F98] NVARCHAR(255) NULL,
    [F99] NVARCHAR(255) NULL,
    [F100] NVARCHAR(255) NULL,
    [F101] NVARCHAR(255) NULL,
    [F102] NVARCHAR(255) NULL,
    [F103] NVARCHAR(255) NULL,
    [F104] NVARCHAR(255) NULL,
    [F105] NVARCHAR(255) NULL,
    [F106] NVARCHAR(255) NULL,
    [F107] NVARCHAR(255) NULL,
    [F108] NVARCHAR(255) NULL,
    [F109] NVARCHAR(255) NULL,
    [F110] NVARCHAR(255) NULL,
    [F111] NVARCHAR(255) NULL,
    [F112] NVARCHAR(255) NULL,
    [F113] NVARCHAR(255) NULL,
    [F114] NVARCHAR(255) NULL,
    [F115] NVARCHAR(255) NULL,
    [F116] NVARCHAR(255) NULL,
    [F117] NVARCHAR(255) NULL,
    [F118] NVARCHAR(255) NULL,
    [F119] NVARCHAR(255) NULL,
    [F120] NVARCHAR(255) NULL,
    [F121] NVARCHAR(255) NULL,
    [F122] NVARCHAR(255) NULL,
    [F123] NVARCHAR(255) NULL,
    [F124] NVARCHAR(255) NULL,
    [F125] NVARCHAR(255) NULL,
    [F126] NVARCHAR(255) NULL,
    [F127] NVARCHAR(255) NULL,
    [F128] NVARCHAR(255) NULL,
    [F129] NVARCHAR(255) NULL,
    [F130] NVARCHAR(255) NULL,
    [F131] NVARCHAR(255) NULL,
    [F132] NVARCHAR(255) NULL,
    [F133] NVARCHAR(255) NULL,
    [F134] NVARCHAR(255) NULL,
    [F135] NVARCHAR(255) NULL,
    [F136] NVARCHAR(255) NULL,
    [F137] NVARCHAR(255) NULL,
    [F138] NVARCHAR(255) NULL,
    [F139] NVARCHAR(255) NULL,
    [F140] NVARCHAR(255) NULL,
    [F141] NVARCHAR(255) NULL,
    [F142] NVARCHAR(255) NULL,
    [F143] NVARCHAR(255) NULL,
    [F144] NVARCHAR(255) NULL,
    [F145] NVARCHAR(255) NULL,
    [F146] NVARCHAR(255) NULL,
    [F147] NVARCHAR(255) NULL,
    [F148] NVARCHAR(255) NULL,
    [F149] NVARCHAR(255) NULL,
    [F150] NVARCHAR(255) NULL,
    [F151] NVARCHAR(255) NULL,
    [F152] NVARCHAR(255) NULL,
    [F153] NVARCHAR(255) NULL,
    [F154] NVARCHAR(255) NULL,
    [F155] NVARCHAR(255) NULL,
    [F156] NVARCHAR(255) NULL,
    [F157] NVARCHAR(255) NULL,
    [F158] NVARCHAR(255) NULL,
    [F159] NVARCHAR(255) NULL,
    [F160] NVARCHAR(255) NULL,
    [F161] NVARCHAR(255) NULL,
    [F162] NVARCHAR(255) NULL,
    [F163] NVARCHAR(255) NULL,
    [F164] NVARCHAR(255) NULL,
    [F165] NVARCHAR(255) NULL,
    [F166] NVARCHAR(255) NULL,
    [F167] NVARCHAR(255) NULL,
    [F168] NVARCHAR(255) NULL,
    [F169] NVARCHAR(255) NULL,
    [F170] NVARCHAR(255) NULL,
    [F171] NVARCHAR(255) NULL,
    [F172] NVARCHAR(255) NULL,
    [F173] NVARCHAR(255) NULL,
    [F174] NVARCHAR(255) NULL,
    [F175] NVARCHAR(255) NULL,
    [F176] NVARCHAR(255) NULL,
    [F177] NVARCHAR(255) NULL,
    [F178] NVARCHAR(255) NULL,
    [F179] NVARCHAR(255) NULL,
    [F180] NVARCHAR(255) NULL,
    [F181] NVARCHAR(255) NULL,
    [F182] NVARCHAR(255) NULL,
    [F183] NVARCHAR(255) NULL,
    [F184] NVARCHAR(255) NULL,
    [F185] NVARCHAR(255) NULL,
    [F186] NVARCHAR(255) NULL,
    [F187] NVARCHAR(255) NULL,
    [F188] NVARCHAR(255) NULL,
    [F189] NVARCHAR(255) NULL,
    [F190] NVARCHAR(255) NULL,
    [F191] NVARCHAR(255) NULL,
    [F192] NVARCHAR(255) NULL,
    [F193] NVARCHAR(255) NULL,
    [F194] NVARCHAR(255) NULL,
    [F195] NVARCHAR(255) NULL,
    [F196] NVARCHAR(255) NULL,
    [F197] NVARCHAR(255) NULL,
    [F198] NVARCHAR(255) NULL,
    [F199] NVARCHAR(255) NULL,
    [F200] NVARCHAR(255) NULL,
    [F201] NVARCHAR(255) NULL,
    [F202] NVARCHAR(255) NULL,
    [F203] NVARCHAR(255) NULL,
    [F204] NVARCHAR(255) NULL,
    [F205] NVARCHAR(255) NULL,
    [F206] NVARCHAR(255) NULL,
    [F207] NVARCHAR(255) NULL,
    [F208] NVARCHAR(255) NULL,
    [F209] NVARCHAR(255) NULL,
    [F210] NVARCHAR(255) NULL,
    [F211] NVARCHAR(255) NULL,
    [F212] NVARCHAR(255) NULL,
    [F213] NVARCHAR(255) NULL,
    [F214] NVARCHAR(255) NULL,
    [F215] NVARCHAR(255) NULL,
    [F216] NVARCHAR(255) NULL,
    [F217] NVARCHAR(255) NULL,
    [F218] NVARCHAR(255) NULL,
    [F219] NVARCHAR(255) NULL,
    [F220] NVARCHAR(255) NULL,
    [F221] NVARCHAR(255) NULL,
    [F222] NVARCHAR(255) NULL,
    [F223] NVARCHAR(255) NULL,
    [F224] NVARCHAR(255) NULL,
    [F225] NVARCHAR(255) NULL,
    [F226] NVARCHAR(255) NULL,
    [F227] NVARCHAR(255) NULL,
    [F228] NVARCHAR(255) NULL,
    [F229] NVARCHAR(255) NULL,
    [F230] NVARCHAR(255) NULL,
    [F231] NVARCHAR(255) NULL,
    [F232] NVARCHAR(255) NULL,
    [F233] NVARCHAR(255) NULL,
    [F234] NVARCHAR(255) NULL,
    [F235] NVARCHAR(255) NULL,
    [F236] NVARCHAR(255) NULL,
    [F237] NVARCHAR(255) NULL,
    [F238] NVARCHAR(255) NULL,
    [F239] NVARCHAR(255) NULL,
    [F240] NVARCHAR(255) NULL,
    [F241] NVARCHAR(255) NULL,
    [F242] NVARCHAR(255) NULL,
    [F243] NVARCHAR(255) NULL,
    [F244] NVARCHAR(255) NULL,
    [F245] NVARCHAR(255) NULL,
    [F246] NVARCHAR(255) NULL,
    [F247] NVARCHAR(255) NULL,
    [F248] NVARCHAR(255) NULL,
    [F249] NVARCHAR(255) NULL,
    [F250] NVARCHAR(255) NULL,
    [F251] NVARCHAR(255) NULL,
    [F252] NVARCHAR(255) NULL,
    [F253] NVARCHAR(255) NULL,
    [F254] NVARCHAR(255) NULL,
    [F255] NVARCHAR(255) NULL,
    [F256] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MISBranch
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MISBranch]
(
    [Emp_ID] NVARCHAR(255) NULL,
    [BranchTag] NVARCHAR(255) NULL,
    [BranchName] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Nature_Request
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Nature_Request]
(
    [Nature] NVARCHAR(255) NULL,
    [Request] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NewClient_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NewClient_Details]
(
    [Docket_Number] CHAR(8) NOT NULL,
    [SBTAG] CHAR(20) NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [TagBranch] VARCHAR(50) NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Call_From] CHAR(25) NULL,
    [Call_Type] CHAR(25) NULL,
    [Source] CHAR(10) NULL,
    [Issue_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Detailed_Solution] VARCHAR(MAX) NULL,
    [Client_Remark] VARCHAR(500) NULL,
    [L1_InitialRemark] VARCHAR(MAX) NULL,
    [L1_FinalRemark] VARCHAR(MAX) NULL,
    [L2_UserRemark] VARCHAR(MAX) NULL,
    [L3_UserRemark] VARCHAR(MAX) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NewClient_Details07092010
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NewClient_Details07092010]
(
    [Docket_Number] CHAR(8) NOT NULL,
    [SBTAG] CHAR(20) NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [TagBranch] VARCHAR(50) NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Call_From] CHAR(25) NULL,
    [Call_Type] CHAR(25) NULL,
    [Source] CHAR(10) NULL,
    [Issue_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Detailed_Solution] VARCHAR(MAX) NULL,
    [Client_Remark] VARCHAR(500) NULL,
    [L1_InitialRemark] VARCHAR(MAX) NULL,
    [L1_FinalRemark] VARCHAR(MAX) NULL,
    [L2_UserRemark] VARCHAR(MAX) NULL,
    [L3_UserRemark] VARCHAR(MAX) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NewTaskDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NewTaskDetails]
(
    [TT_Number] VARCHAR(50) NOT NULL,
    [Docket_Number] CHAR(8) NOT NULL,
    [SBTAG] CHAR(20) NULL,
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(50) NOT NULL,
    [TagBranch] VARCHAR(50) NULL,
    [Issue_Raised_DateTime] DATETIME NOT NULL,
    [Issue_Resolved_Datetime] DATETIME NULL,
    [Issue_Resolving_Time] DATETIME NULL,
    [Call_From] CHAR(25) NULL,
    [Call_Type] CHAR(25) NULL,
    [Source] CHAR(10) NULL,
    [Issue_Type] CHAR(25) NULL,
    [Type] CHAR(25) NULL,
    [Nature] CHAR(50) NULL,
    [Problem] VARCHAR(500) NULL,
    [Brief_Solution] VARCHAR(500) NULL,
    [Detailed_Solution] VARCHAR(MAX) NULL,
    [Client_Remark] VARCHAR(200) NULL,
    [L1_InitialRemark] VARCHAR(MAX) NULL,
    [L1_FinalRemark] VARCHAR(MAX) NULL,
    [L2_UserRemark] VARCHAR(MAX) NULL,
    [L3_UserRemark] VARCHAR(MAX) NULL,
    [Issue_Resolved_By] VARCHAR(15) NULL,
    [Team_Id] NCHAR(10) NULL,
    [Contact_Person] CHAR(50) NULL,
    [Status_Code] CHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Teamleadermaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Teamleadermaster]
(
    [Employee_Id] CHAR(15) NULL,
    [Teamleader] CHAR(15) NULL,
    [Branch_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_UserSMTPSettings
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_UserSMTPSettings]
(
    [Emp_Id] CHAR(25) NOT NULL,
    [SMTP] CHAR(50) NULL,
    [IP] VARCHAR(20) NULL,
    [Port] CHAR(6) NULL,
    [UserName] VARCHAR(150) NULL,
    [Password] VARCHAR(20) NULL,
    [LastUpdatedOn] DATETIME NULL,
    [LastUpdatedBy] CHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl1]
(
    [issue_resolved_by] CHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] VARCHAR(11) NULL,
    [Completed] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Team_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Team_Master]
(
    [Team_id] CHAR(15) NOT NULL,
    [Team_Name] VARCHAR(100) NOT NULL,
    [Team] VARCHAR(100) NULL,
    [Order] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp
-- --------------------------------------------------
CREATE TABLE [dbo].[temp]
(
    [Product_Code] NVARCHAR(255) NULL,
    [Product_Name] NVARCHAR(255) NULL,
    [Manager_Name] NVARCHAR(255) NULL,
    [Manager_Name_RM] NVARCHAR(255) NULL,
    [Version] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp1
-- --------------------------------------------------
CREATE TABLE [dbo].[temp1]
(
    [Product_Code] NVARCHAR(255) NULL,
    [Product_Name] NVARCHAR(255) NULL,
    [Manager_Name] NVARCHAR(255) NULL,
    [Manager_Name_RM] NVARCHAR(255) NULL,
    [Version] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test
-- --------------------------------------------------
CREATE TABLE [dbo].[test]
(
    [a] INT IDENTITY(1,1) NOT NULL,
    [b] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Test_Client_Master_Helpdesk
-- --------------------------------------------------
CREATE TABLE [dbo].[Test_Client_Master_Helpdesk]
(
    [Client_Code] CHAR(15) NOT NULL,
    [Short_Name] NVARCHAR(60) NULL,
    [Long_Name] NVARCHAR(150) NULL,
    [DOB] DATETIME NULL,
    [Online_Client] BIT NOT NULL,
    [B2C] BIT NULL,
    [Branch_Code] CHAR(15) NULL,
    [Subbroker_Code] CHAR(15) NULL,
    [Region_Code] CHAR(15) NULL,
    [Zone_Code] CHAR(15) NULL,
    [Product_Code] CHAR(15) NOT NULL,
    [Secondary_Product] CHAR(20) NULL,
    [PDA] NVARCHAR(50) NULL,
    [Manager_Code] VARCHAR(40) NOT NULL,
    [Account_Status] BIT NOT NULL,
    [Active_From] DATETIME NULL,
    [PAN_Number] NVARCHAR(MAX) NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL,
    [Address] VARCHAR(100) NULL,
    [Address1] VARCHAR(60) NULL,
    [Address2] VARCHAR(60) NULL,
    [City] VARCHAR(60) NULL,
    [State] VARCHAR(60) NULL,
    [Country] VARCHAR(60) NULL,
    [Permanent_Address] VARCHAR(100) NULL,
    [Landline_Number1] CHAR(15) NULL,
    [Landline_Number2] CHAR(15) NULL,
    [Office_Number1] CHAR(15) NULL,
    [Office_Number2] CHAR(15) NULL,
    [Mobile] CHAR(20) NULL,
    [Email] VARCHAR(100) NULL,
    [SERIAL_ID] INT NOT NULL,
    [EChopda] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Uclient
-- --------------------------------------------------
CREATE TABLE [dbo].[Uclient]
(
    [Client_Code] CHAR(15) NOT NULL,
    [Product_Code] CHAR(15) NOT NULL,
    [Secondary_Product] CHAR(20) NULL,
    [Manager_Code] VARCHAR(50) NOT NULL,
    [Account_Status] BIT NOT NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Update_Client_Master_Helpdesk
-- --------------------------------------------------
CREATE TABLE [dbo].[Update_Client_Master_Helpdesk]
(
    [BO_PartyCode] VARCHAR(20) NOT NULL,
    [IH_B2C] VARCHAR(5) NULL,
    [onlineoffline] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Updated_Info
-- --------------------------------------------------
CREATE TABLE [dbo].[Updated_Info]
(
    [Client_Code] VARCHAR(10) NULL,
    [Short_Name] VARCHAR(21) NULL,
    [Long_Name] VARCHAR(100) NULL,
    [DOB] DATETIME NULL,
    [Online_Client] VARCHAR(13) NOT NULL,
    [B2C] VARCHAR(3) NOT NULL,
    [Branch_Code] VARCHAR(10) NULL,
    [Subbroker_Code] VARCHAR(10) NULL,
    [Region_Code] VARCHAR(15) NULL,
    [Zone_Code] VARCHAR(9) NOT NULL,
    [Product_Code] VARCHAR(12) NULL,
    [Secondary_Product] VARCHAR(17) NULL,
    [PDA] VARCHAR(3) NULL,
    [Manager_Code] VARCHAR(7) NULL,
    [Account_Status] CHAR(1) NULL,
    [Active_From] DATETIME NULL,
    [PAN_Number] VARCHAR(50) NULL,
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDEX] VARCHAR(1) NULL,
    [Address] VARCHAR(40) NULL,
    [Address1] VARCHAR(40) NULL,
    [Address2] VARCHAR(40) NULL,
    [City] VARCHAR(40) NULL,
    [State] VARCHAR(50) NULL,
    [Country] VARCHAR(15) NULL,
    [Permanent_Address] VARCHAR(100) NULL,
    [Landline_Number1] VARCHAR(15) NULL,
    [Landline_Number2] VARCHAR(15) NULL,
    [Office_Number1] VARCHAR(15) NULL,
    [Office_Number2] VARCHAR(15) NULL,
    [Mobile] VARCHAR(20) NULL,
    [Email] VARCHAR(50) NULL,
    [SERIAL_ID] VARCHAR(9) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UploadedFiles
-- --------------------------------------------------
CREATE TABLE [dbo].[UploadedFiles]
(
    [UserID] VARCHAR(10) NULL,
    [UserName] VARCHAR(100) NULL,
    [Branch] NVARCHAR(50) NULL,
    [Manager] NVARCHAR(25) NULL,
    [File_Names] NVARCHAR(100) NULL,
    [Uploaded_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.User
-- --------------------------------------------------
CREATE TABLE [dbo].[User]
(
    [Employee id] NVARCHAR(255) NULL,
    [Name ] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Team] NVARCHAR(255) NULL,
    [HOD ID] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.User_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[User_Master]
(
    [Userid] CHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NULL,
    [Role_Id] CHAR(15) NULL,
    [TeamLeader] CHAR(15) NULL,
    [Branch_Id] CHAR(15) NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [Creation_Date] DATETIME NULL,
    [Account_Status] BIT NULL,
    [Login_Status] BIT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL,
    [Separation_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.User_Master_5_OCT_2010
-- --------------------------------------------------
CREATE TABLE [dbo].[User_Master_5_OCT_2010]
(
    [Userid] CHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NULL,
    [Role_Id] CHAR(15) NULL,
    [TeamLeader] CHAR(15) NULL,
    [Branch_Id] CHAR(15) NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [Creation_Date] DATETIME NULL,
    [Account_Status] BIT NULL,
    [Login_Status] BIT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.user_master_backup
-- --------------------------------------------------
CREATE TABLE [dbo].[user_master_backup]
(
    [Userid] VARCHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NOT NULL,
    [Role_Id] CHAR(15) NOT NULL,
    [TeamLeader] CHAR(15) NOT NULL,
    [Branch_Id] CHAR(15) NOT NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NOT NULL,
    [Creation_Date] DATETIME NOT NULL,
    [Account_Status] CHAR(15) NOT NULL,
    [Login_Status] BIT NOT NULL,
    [lastlogin] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.USER_MASTER_BACKUP17
-- --------------------------------------------------
CREATE TABLE [dbo].[USER_MASTER_BACKUP17]
(
    [Userid] CHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NULL,
    [Role_Id] CHAR(15) NULL,
    [TeamLeader] CHAR(15) NULL,
    [Branch_Id] CHAR(15) NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [Creation_Date] DATETIME NULL,
    [Account_Status] BIT NULL,
    [Login_Status] BIT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.User_Master_New
-- --------------------------------------------------
CREATE TABLE [dbo].[User_Master_New]
(
    [Userid] CHAR(15) NOT NULL,
    [UserName] VARCHAR(160) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NULL,
    [Role_Id] CHAR(15) NULL,
    [TeamLeader] CHAR(15) NULL,
    [Branch_Id] CHAR(15) NULL,
    [Contact_Number] CHAR(50) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NULL,
    [Creation_Date] DATETIME NULL,
    [Account_Status] BIT NULL,
    [Login_Status] BIT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.User_Master58
-- --------------------------------------------------
CREATE TABLE [dbo].[User_Master58]
(
    [Userid] VARCHAR(15) NOT NULL,
    [UserName] VARCHAR(120) NOT NULL,
    [DOB] DATETIME NULL,
    [Team_Id] CHAR(15) NOT NULL,
    [Role_Id] CHAR(15) NOT NULL,
    [TeamLeader] CHAR(15) NOT NULL,
    [Branch_Id] CHAR(15) NOT NULL,
    [Contact_Number] CHAR(15) NULL,
    [Mobile] CHAR(15) NULL,
    [Email] VARCHAR(120) NULL,
    [Access_Id] CHAR(15) NOT NULL,
    [Creation_Date] DATETIME NOT NULL,
    [Account_Status] CHAR(15) NOT NULL,
    [Login_Status] BIT NOT NULL,
    [lastlogin] DATETIME NULL,
    [Password] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.User_remark
-- --------------------------------------------------
CREATE TABLE [dbo].[User_remark]
(
    [Remark] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserID_TL
-- --------------------------------------------------
CREATE TABLE [dbo].[UserID_TL]
(
    [userid] VARCHAR(15) NOT NULL,
    [TeamLeader1] CHAR(15) NULL,
    [TeamLeader2] CHAR(15) NULL,
    [Branch_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Vendor_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Vendor_Master]
(
    [Vendor_Code] CHAR(15) NOT NULL,
    [Vendor_Name] VARCHAR(60) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Vendor_Product
-- --------------------------------------------------
CREATE TABLE [dbo].[Vendor_Product]
(
    [Product_Code] CHAR(50) NOT NULL,
    [Product_Name] VARCHAR(50) NULL,
    [Vendor_Code] CHAR(15) NOT NULL,
    [Product_version] CHAR(15) NOT NULL,
    [manager] CHAR(40) NULL,
    [Path] VARCHAR(100) NULL,
    [Vista_Path] VARCHAR(200) NULL,
    [FundsView] VARCHAR(120) NULL,
    [PDA_Version] CHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vendor_product_backup
-- --------------------------------------------------
CREATE TABLE [dbo].[vendor_product_backup]
(
    [Product_Code] CHAR(50) NOT NULL,
    [Product_Name] VARCHAR(50) NULL,
    [Vendor_Code] CHAR(15) NOT NULL,
    [Product_version] CHAR(15) NOT NULL,
    [manager] CHAR(40) NULL,
    [Path] VARCHAR(100) NULL,
    [Vista_Path] VARCHAR(200) NULL,
    [FundsView] VARCHAR(120) NULL,
    [PDA_Version] CHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vidula
-- --------------------------------------------------
CREATE TABLE [dbo].[vidula]
(
    [issue_resolved_by] CHAR(15) NULL,
    [Last login] DATETIME NULL,
    [date] VARCHAR(11) NULL,
    [completed] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.View_Subbroker
-- --------------------------------------------------
CREATE TABLE [dbo].[View_Subbroker]
(
    [RefNo] VARCHAR(50) NOT NULL,
    [TAG] VARCHAR(25) NOT NULL,
    [Segment] VARCHAR(10) NOT NULL,
    [Regname] VARCHAR(100) NULL,
    [TradeName] VARCHAR(100) NULL,
    [Type] VARCHAR(50) NULL,
    [DOB] VARCHAR(20) NULL,
    [Sex] VARCHAR(10) NULL,
    [Resadd1] VARCHAR(300) NULL,
    [Resadd2] VARCHAR(300) NULL,
    [Resadd3] VARCHAR(300) NULL,
    [Rcity] VARCHAR(30) NULL,
    [ResPincode] VARCHAR(20) NULL,
    [OfAddress1] VARCHAR(100) NULL,
    [OffAddress2] VARCHAR(100) NULL,
    [OffAddress3] VARCHAR(100) NULL,
    [OffCity] VARCHAR(50) NULL,
    [OffPincode] VARCHAR(20) NULL,
    [OfficePhone] VARCHAR(25) NULL,
    [Mobile] VARCHAR(100) NULL,
    [ResPhone] VARCHAR(100) NULL,
    [Fax No] VARCHAR(25) NULL,
    [PAN] VARCHAR(15) NULL,
    [EmailID] VARCHAR(100) NULL,
    [Maker ID] VARCHAR(25) NULL,
    [Maker Date] VARCHAR(30) NULL,
    [TAGBranch] VARCHAR(50) NULL,
    [GL Unregistered code] VARCHAR(15) NULL,
    [GL Registered Code] VARCHAR(15) NULL,
    [Regstatus] VARCHAR(50) NULL,
    [Regdate] DATETIME NULL,
    [Registration No] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.View_Subbroker_Mahendra
-- --------------------------------------------------
CREATE TABLE [dbo].[View_Subbroker_Mahendra]
(
    [RefNo] VARCHAR(50) NOT NULL,
    [TAG] VARCHAR(25) NOT NULL,
    [Segment] VARCHAR(10) NOT NULL,
    [Regname] VARCHAR(100) NULL,
    [TradeName] VARCHAR(100) NULL,
    [Type] VARCHAR(50) NULL,
    [DOB] VARCHAR(20) NULL,
    [Sex] VARCHAR(10) NULL,
    [Resadd1] VARCHAR(300) NULL,
    [Resadd2] VARCHAR(300) NULL,
    [Resadd3] VARCHAR(300) NULL,
    [Rcity] VARCHAR(30) NULL,
    [ResPincode] VARCHAR(20) NULL,
    [OfAddress1] VARCHAR(100) NULL,
    [OffAddress2] VARCHAR(100) NULL,
    [OffAddress3] VARCHAR(100) NULL,
    [OffCity] VARCHAR(50) NULL,
    [OffPincode] VARCHAR(20) NULL,
    [OfficePhone] VARCHAR(25) NULL,
    [Mobile] VARCHAR(100) NULL,
    [ResPhone] VARCHAR(100) NULL,
    [Fax No] VARCHAR(25) NULL,
    [PAN] VARCHAR(15) NULL,
    [EmailID] VARCHAR(100) NULL,
    [Maker ID] VARCHAR(25) NULL,
    [Maker Date] VARCHAR(30) NULL,
    [TAGBranch] VARCHAR(50) NULL,
    [GL Unregistered code] VARCHAR(15) NULL,
    [GL Registered Code] VARCHAR(15) NULL,
    [Regstatus] VARCHAR(50) NULL,
    [Regdate] DATETIME NULL,
    [Registration No] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.View_Subbroker_Yesterday
-- --------------------------------------------------
CREATE TABLE [dbo].[View_Subbroker_Yesterday]
(
    [RefNo] VARCHAR(50) NOT NULL,
    [TAG] VARCHAR(25) NOT NULL,
    [Segment] VARCHAR(10) NOT NULL,
    [Regname] VARCHAR(100) NULL,
    [TradeName] VARCHAR(100) NULL,
    [Type] VARCHAR(50) NULL,
    [DOB] VARCHAR(20) NULL,
    [Sex] VARCHAR(10) NULL,
    [Resadd1] VARCHAR(300) NULL,
    [Resadd2] VARCHAR(300) NULL,
    [Resadd3] VARCHAR(300) NULL,
    [Rcity] VARCHAR(30) NULL,
    [ResPincode] VARCHAR(20) NULL,
    [OfAddress1] VARCHAR(100) NULL,
    [OffAddress2] VARCHAR(100) NULL,
    [OffAddress3] VARCHAR(100) NULL,
    [OffCity] VARCHAR(50) NULL,
    [OffPincode] VARCHAR(20) NULL,
    [OfficePhone] VARCHAR(25) NULL,
    [Mobile] VARCHAR(100) NULL,
    [ResPhone] VARCHAR(100) NULL,
    [Fax No] VARCHAR(25) NULL,
    [PAN] VARCHAR(15) NULL,
    [EmailID] VARCHAR(100) NULL,
    [Maker ID] VARCHAR(25) NULL,
    [Maker Date] VARCHAR(30) NULL,
    [TAGBranch] VARCHAR(50) NULL,
    [GL Unregistered code] VARCHAR(15) NULL,
    [GL Registered Code] VARCHAR(15) NULL,
    [Regstatus] VARCHAR(50) NULL,
    [Regdate] DATETIME NULL,
    [Registration No] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VLMS_RoleMasterEquity
-- --------------------------------------------------
CREATE TABLE [dbo].[VLMS_RoleMasterEquity]
(
    [PID] INT NOT NULL,
    [biBranch] VARCHAR(510) NULL,
    [HarmonyCostCode] VARCHAR(510) NULL,
    [Zone] VARCHAR(100) NULL,
    [Region] VARCHAR(100) NULL,
    [costCodeHead] VARCHAR(510) NULL,
    [codeSpecification] VARCHAR(200) NULL,
    [commentsIfOthers] VARCHAR(510) NULL,
    [branchHead] VARCHAR(510) NULL,
    [clusterHead] VARCHAR(510) NULL,
    [regionalHead] VARCHAR(510) NULL,
    [regionalCommHead] VARCHAR(510) NULL,
    [zonalHead] VARCHAR(510) NULL,
    [franchiseeHead] VARCHAR(510) NULL,
    [comments] VARCHAR(500) NULL,
    [lastUpdatedEmpNo] VARCHAR(10) NULL,
    [lastUpdatedDate] DATETIME NULL,
    [lastUpdatedEmpNoComm] VARCHAR(50) NULL,
    [lastUpdatedDateComm] DATETIME NULL,
    [flgEquiComm] CHAR(10) NULL,
    [owner1] VARCHAR(10) NULL,
    [owner2] VARCHAR(10) NULL,
    [flgdel] BIT NULL,
    [hrmEmpNo] VARCHAR(50) NULL,
    [InsertionDate] DATETIME NULL,
    [BranchCoordinator] VARCHAR(100) NULL,
    [RegionalCoordinator] VARCHAR(100) NULL,
    [RegionalSalesManager] VARCHAR(100) NULL,
    [Shared resource cord] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VLMS_RoleMasterEquity_OLD
-- --------------------------------------------------
CREATE TABLE [dbo].[VLMS_RoleMasterEquity_OLD]
(
    [PID] INT NOT NULL,
    [biBranch] VARCHAR(510) NULL,
    [HarmonyCostCode] VARCHAR(510) NULL,
    [Zone] VARCHAR(100) NULL,
    [Region] VARCHAR(100) NULL,
    [costCodeHead] VARCHAR(510) NULL,
    [codeSpecification] VARCHAR(200) NULL,
    [commentsIfOthers] VARCHAR(510) NULL,
    [branchHead] VARCHAR(510) NULL,
    [clusterHead] VARCHAR(510) NULL,
    [regionalHead] VARCHAR(510) NULL,
    [regionalCommHead] VARCHAR(510) NULL,
    [zonalHead] VARCHAR(510) NULL,
    [franchiseeHead] VARCHAR(510) NULL,
    [comments] VARCHAR(500) NULL,
    [lastUpdatedEmpNo] VARCHAR(10) NULL,
    [lastUpdatedDate] DATETIME NULL,
    [lastUpdatedEmpNoComm] VARCHAR(50) NULL,
    [lastUpdatedDateComm] DATETIME NULL,
    [flgEquiComm] CHAR(10) NULL,
    [owner1] VARCHAR(10) NULL,
    [owner2] VARCHAR(10) NULL,
    [flgdel] BIT NULL,
    [hrmEmpNo] VARCHAR(50) NULL,
    [InsertionDate] DATETIME NULL,
    [BranchCoordinator] VARCHAR(100) NULL,
    [RegionalCoordinator] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VLMSINhouse
-- --------------------------------------------------
CREATE TABLE [dbo].[VLMSINhouse]
(
    [Emp No] VARCHAR(6) NOT NULL,
    [EMP_NAME] VARCHAR(150) NULL,
    [HOD No] VARCHAR(6) NULL,
    [HOD Name] VARCHAR(150) NULL,
    [Company Name] NVARCHAR(50) NULL,
    [SBU] VARCHAR(50) NULL,
    [Lob] INT NULL,
    [Zone] VARCHAR(50) NULL,
    [Region] VARCHAR(50) NULL,
    [Location] VARCHAR(50) NULL,
    [AttendanceLoc] VARCHAR(100) NULL,
    [Department] NVARCHAR(200) NULL,
    [Sub Department] VARCHAR(150) NULL,
    [Designation] VARCHAR(255) NULL,
    [Location Address] VARCHAR(5000) NULL,
    [LEVEL] VARCHAR(50) NULL,
    [categorydesc] VARCHAR(50) NULL,
    [Costcode] NVARCHAR(255) NULL,
    [Join Date] DATETIME NULL,
    [Separation Date] DATETIME NULL,
    [emailadd] VARCHAR(100) NULL,
    [sex] VARCHAR(1) NULL,
    [BirthDate] DATETIME NULL,
    [PHONE] VARCHAR(50) NULL,
    [JOINDATE] DATETIME NULL,
    [STATUS] CHAR(1) NULL,
    [Address] NVARCHAR(100) NULL,
    [City] VARCHAR(100) NULL,
    [State] NVARCHAR(25) NULL,
    [Account No] VARCHAR(20) NULL,
    [pincode] VARCHAR(20) NULL,
    [Functional Head] VARCHAR(500) NULL,
    [flgCSOBranch] NCHAR(6) NULL,
    [tpdlgcode] NVARCHAR(50) NULL,
    [LOBDESC] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Zone
-- --------------------------------------------------
CREATE TABLE [dbo].[Zone]
(
    [branch_cd] CHAR(10) NULL,
    [state] CHAR(15) NULL,
    [contact_person] CHAR(200) NULL,
    [Zone] VARCHAR(20) NULL,
    [branchcontact] VARCHAR(50) NULL,
    [regioncontact] VARCHAR(50) NULL,
    [branchcontactphone1] VARCHAR(50) NULL,
    [branchcontactphone2] VARCHAR(50) NULL,
    [regioncontactphone1] VARCHAR(50) NULL,
    [regioncontactphone2] VARCHAR(50) NULL,
    [Zonal_office] VARCHAR(12) NULL,
    [Regional_office] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TRIGGER dbo.generate_ID
-- --------------------------------------------------
Create  trigger [generate_ID] ON dbo.IssueDetails_AKRUTI
FOR INSERT
AS
DECLARE @docket_number VARCHAR(50)

--Trigger Created by	:Supriya Padhre
--can reset

select @docket_number=max(convert(int,docket_number)) from IssueDetails_AKRUTI 
--select @docket_number

if convert(int,@docket_number)>convert(int,'10000000')
	begin
	set @docket_number=convert(varchar(50),convert(bigint,@docket_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @docket_number=10000001
	--select @docket_number,'<'
	end

UPDATE IssueDetails_AKRUTI SET docket_number = @docket_number WHERE docket_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.Generate_NewSBRefno
-- --------------------------------------------------


CREATE trigger [Generate_NewSBRefno] ON [dbo].[tbl_ITSubbroker_Exists]
FOR INSERT
AS
DECLARE @Refrence_number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @Refrence_number=max(convert(int,Refrence_number)) from tbl_ITSubbroker_Exists
--select @docket_number

if convert(int,@Refrence_number)=convert(int,'0')
begin
	set @Refrence_number='60000000'
end

if convert(int,@Refrence_number)>convert(int,'60000000')
	begin
	set @Refrence_number=convert(varchar(50),convert(bigint,@Refrence_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @Refrence_number=60000001
	--select @docket_number,'<'
	end

UPDATE tbl_ITSubbroker_Exists SET Refrence_number = @Refrence_number WHERE Refrence_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.genrate_Clientexiststrigger
-- --------------------------------------------------
CREATE trigger [genrate_Clientexiststrigger] ON dbo.ClientExists
FOR INSERT
AS
DECLARE @Refrence_number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @Refrence_number=max(convert(int,Refrence_number)) from clientexists
--select @docket_number

if convert(int,@Refrence_number)>convert(int,'80000000')
	begin
	set @Refrence_number=convert(varchar(50),convert(bigint,@Refrence_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @Refrence_number=80000001
	--select @docket_number,'<'
	end

UPDATE clientexists SET Refrence_number = @Refrence_number WHERE Refrence_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.genrate_uniqueid
-- --------------------------------------------------
CREATE  trigger [genrate_uniqueid] ON dbo.Client_Details
FOR INSERT
AS
DECLARE @docket_number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @docket_number=max(convert(int,docket_number)) from client_details 
--select @docket_number

if convert(int,@docket_number)>convert(int,'10000000')
	begin
	set @docket_number=convert(varchar(50),convert(bigint,@docket_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @docket_number=10000001
	--select @docket_number,'<'
	end

UPDATE client_details SET docket_number = @docket_number WHERE docket_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.genrate_uniqueid07092010
-- --------------------------------------------------

create  trigger [genrate_uniqueid07092010] ON [dbo].[client_details07092010]
FOR INSERT
AS
DECLARE @docket_number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @docket_number=max(convert(int,docket_number)) from client_details07092010 
--select @docket_number

if convert(int,@docket_number)>convert(int,'10000000')
	begin
	set @docket_number=convert(varchar(50),convert(bigint,@docket_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @docket_number=10000001
	--select @docket_number,'<'
	end

UPDATE client_details07092010 SET docket_number = @docket_number WHERE docket_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_DID_tbl_BOIssueDetails
-- --------------------------------------------------
CREATE trigger [dbo].[tgr_DID_tbl_BOIssueDetails] ON dbo.tbl_BOIssueDetails
FOR INSERT
AS
DECLARE @DID VARCHAR(50)

--Created BY	: Mahendra Bonde
--Created On	: 28/10/2010
--can reset

select @DID=max(convert(int,DID)) from tbl_BOIssueDetails
--select @DID



	If convert(int,@DID)>convert(int,'1000000000')
	Begin
		set @DID=convert(varchar(50),convert(bigint,@DID)+1)
	--select @DID,'>'
	End
	Else
	Begin
		Set @DID=1000000001
	--select @DID,'<'
	End

UPDATE tbl_BOIssueDetails SET DID = @DID WHERE DID like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_GenerateDocket
-- --------------------------------------------------
CREATE  trigger [tgr_GenerateDocket] ON dbo.tbl_NewClient_Details
FOR INSERT
AS
DECLARE @docket_number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @docket_number=max(convert(int,docket_number)) from tbl_NewClient_Details
--select @docket_number

if convert(int,@docket_number)>convert(int,'10000000')
	begin
	set @docket_number=convert(varchar(50),convert(bigint,@docket_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @docket_number=10000001
	--select @docket_number,'<'
	end

UPDATE tbl_NewClient_Details SET docket_number = @docket_number WHERE docket_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_GenerateDocket_BO_Master
-- --------------------------------------------------
Create  trigger [dbo].[tgr_GenerateDocket_BO_Master] ON dbo.tbl_BOIssueMaster
FOR INSERT
AS
DECLARE @Docket_Number VARCHAR(50)

--Created BY	: Mahendra Bonde
--Created On	: 28/10/2010
--can reset

select @Docket_Number=max(convert(int,Docket_Number)) from tbl_BOIssueMaster
--select @docket_number

if convert(int,@Docket_Number)>convert(int,'10000000')
	begin
	set @Docket_Number=convert(varchar(50),convert(bigint,@Docket_Number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @Docket_Number=10000001
	--select @docket_number,'<'
	end

UPDATE tbl_BOIssueMaster SET Docket_Number = @Docket_Number WHERE Docket_Number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_GenerateDocket_BRIssue_Details
-- --------------------------------------------------

Create  trigger [tgr_GenerateDocket_BRIssue_Details] ON [dbo].[Tbl_BRIssue_Details]
FOR INSERT
AS
DECLARE @Docket_Number VARCHAR(50)

--Created BY	: Mahendra Bonde
--Created On	: 2/11/2010
--can reset

select @Docket_Number=max(convert(int,DID)) from Tbl_BRIssue_Details
--select @docket_number

if convert(int,@Docket_Number)>convert(int,'1000000000')
	begin
	set @Docket_Number=convert(varchar(50),convert(bigint,@Docket_Number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @Docket_Number=1000000001
	--select @docket_number,'<'
	end

UPDATE Tbl_BRIssue_Details SET DID = @Docket_Number WHERE DID like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_GenerateDocket_BRIssue_Master
-- --------------------------------------------------

Create  trigger [tgr_GenerateDocket_BRIssue_Master] ON [dbo].[Tbl_BRIssue_Master]
FOR INSERT
AS
DECLARE @Docket_Number VARCHAR(50)

--Created BY	: Mahendra Bonde
--Created On	: 2/11/2010
--can reset

select @Docket_Number=max(convert(int,Docket_No)) from Tbl_BRIssue_Master
--select @docket_number

if convert(int,@Docket_Number)>convert(int,'10000000')
	begin
	set @Docket_Number=convert(varchar(50),convert(bigint,@Docket_Number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @Docket_Number=10000001
	--select @docket_number,'<'
	end

UPDATE Tbl_BRIssue_Master SET Docket_No = @Docket_Number WHERE Docket_No like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_GenerateDocket07092010
-- --------------------------------------------------

create  trigger [tgr_GenerateDocket07092010] ON [dbo].[tbl_newclient_details07092010]
FOR INSERT
AS
DECLARE @docket_number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @docket_number=max(convert(int,docket_number)) from tbl_newclient_details07092010
--select @docket_number

if convert(int,@docket_number)>convert(int,'10000000')
	begin
	set @docket_number=convert(varchar(50),convert(bigint,@docket_number)+1)
	--select @docket_number,'>'
	end
else
	begin
	set @docket_number=10000001
	--select @docket_number,'<'
	end

UPDATE tbl_newclient_details07092010 SET docket_number = @docket_number WHERE docket_number like ''

GO

-- --------------------------------------------------
-- TRIGGER dbo.tgr_TTNumber
-- --------------------------------------------------
CREATE trigger [tgr_TTNumber] ON dbo.tbl_NewTaskDetails
FOR INSERT
AS
DECLARE @TT_Number VARCHAR(50)

--Owner					:Mastermind
--Trigger Created by	:Sanjay Lavu Kudtarkar
--can reset

select @TT_Number=max(convert(int,TT_Number)) from tbl_NewTaskDetails
--select @TT_Number

if convert(int,@TT_Number)>convert(int,'1000000000')
	begin
	set @TT_Number=convert(varchar(50),convert(bigint,@TT_Number)+1)
	--select @TT_Number,'>'
	end
else
	begin
	set @TT_Number=1000000001
	--select @TT_Number,'<'
	end

UPDATE tbl_NewTaskDetails SET TT_Number = @TT_Number WHERE TT_Number like ''

GO

-- --------------------------------------------------
-- VIEW dbo.execount
-- --------------------------------------------------
CREATE view execount 
as
select issue_resolved_by as Executive,[last login] as [Last login],(datename(MM,date)+' '+datename(yyyy,date)) as date,count(Closed) as Closed from levelsummary_Temp5
group by (datename(MM,date)+' '+datename(yyyy,date)),issue_resolved_by,[Last login]

GO

-- --------------------------------------------------
-- VIEW dbo.exeEscalate
-- --------------------------------------------------
CREATE view exeEscalate 
as
select issue_resolved_by as Executive,(datename(MM,date)+' '+datename(yyyy,date)) as date,count(Escalated) as Escalated from levelsummary_Temp2
group by (datename(MM,date)+' '+datename(yyyy,date)),issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.exeperpoint
-- --------------------------------------------------
CREATE view exeperpoint 
as
select issue_resolved_by as Executive,left(date,11) as date,total as [Total] from levelsummary_Temp1

GO

-- --------------------------------------------------
-- VIEW dbo.test2
-- --------------------------------------------------
CREATE view test2
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code='ET' or status_code='EF' or status_code='E3') and datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) and issue_resolved_by in(select userid from user_master where teamleader='e07072' and userid<>'e07072') group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.V_Ebro
-- --------------------------------------------------


CREATE VIEW [dbo].[V_Ebro]
AS
SELECT ISSUE_RESOLVED_BY, 
Sum(Total) As TODAYS_TOTAL,
SUM(T_COMPLETED) AS  TODAY_COMPLETED, 
SUM(T_ESCALATED) AS TODAY_ESCALTED, 
SUM(T_PENDING) AS TODAY_PENDING,   
SUM(T_REASSIGNED) AS TODAY_REASSINGNED, 
SUM(T_CLOSED) AS TODAY_CLOSED ,    
SUM(CM_COMPLETED) AS CurrentMonth_COMPLETED, 
SUM(CM_ESCALATED) AS CurrentMonth_ESCALATED, 
SUM(CM_PENDING) AS CurrentMonth_PENDING,  
SUM(CM_REASSIGNED) AS CurrentMonth_REASSIGNED, 
SUM(CM_CLOSED) AS CurrentMonth_CLOSED,   
SUM(LM_COMPLETED) AS LastMonth_COMPLETED, 
SUM(LM_ESCALATED) AS LastMonth_ESACLATED, 
SUM(LM_PENDING) AS LastMonth_PENDING,  
SUM(LM_REASSIGNED) AS LastMonth_REASSIGNED, 
SUM(LM_CLOSED) AS LastMonth_CLOSED FROM
(
SELECT * FROM
(
SELECT 
ISSUE_RESOLVED_BY,
Total=ISNULL(CASE WHEN STATUS_CODE IN ('C','EF','ET','E3','P','UP','R','X') THEN COUNT(STATUS_CODE) END,0 ),
T_COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'C' THEN COUNT(STATUS_CODE) END,0),
T_ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('EF','ET','E3') THEN COUNT(STATUS_CODE) END,0),
T_PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP') THEN COUNT(STATUS_CODE) END,0),
T_REASSIGNED = ISNULL(CASE WHEN STATUS_CODE = 'R' THEN COUNT(STATUS_CODE) END,0),
T_CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
CM_COMPLETED='',
CM_ESCALATED='',
CM_PENDING='',
CM_REASSIGNED='',
CM_CLOSED='',
LM_COMPLETED='',
LM_ESCALATED='',
LM_PENDING='',
LM_REASSIGNED='',
LM_CLOSED=''
FROM TBL_NEWTASKDETAILS (NOLOCK) WHERE 
ISSUE_RAISED_DATETIME >= CONVERT(VARCHAR(11),GETDATE()) AND
ISSUE_RAISED_DATETIME <= CONVERT(VARCHAR(11),GETDATE()) + ' 23:59:59'
GROUP BY ISSUE_RESOLVED_BY,STATUS_CODE
) X
UNION ALL
SELECT * FROM
(
SELECT 
ISSUE_RESOLVED_BY,
T='',A='',B='',C='',D='',E='',
COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'C' THEN COUNT(STATUS_CODE) END,0),
ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('EF','ET','E3') THEN COUNT(STATUS_CODE) END,0),
PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP') THEN COUNT(STATUS_CODE) END,0),
REASSIGNED = ISNULL(CASE WHEN STATUS_CODE = 'R' THEN COUNT(STATUS_CODE) END,0),
CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
F='',G='',H='',I='',J=''
FROM TBL_NEWTASKDETAILS (NOLOCK) WHERE 
DATEPART(MM,ISSUE_RAISED_DATETIME) = DATEPART(MM,GETDATE())
GROUP BY ISSUE_RESOLVED_BY,STATUS_CODE
) Y 
UNION ALL
SELECT * FROM
(
SELECT 
ISSUE_RESOLVED_BY,
T='',A='',B='',C='',D='',E='',F='',G='',H='',I='',J='',
COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'C' THEN COUNT(STATUS_CODE) END,0),
ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('EF','ET','E3') THEN COUNT(STATUS_CODE) END,0),
PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('P','UP') THEN COUNT(STATUS_CODE) END,0),
REASSIGNED = ISNULL(CASE WHEN STATUS_CODE = 'R' THEN COUNT(STATUS_CODE) END,0),
CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0)
FROM TBL_NEWTASKDETAILS (NOLOCK) WHERE 
DATEPART(MM,ISSUE_RAISED_DATETIME) = DATEPART(MM,GETDATE())-1
GROUP BY ISSUE_RESOLVED_BY,STATUS_CODE
) Z 
) X GROUP BY ISSUE_RESOLVED_BY

GO

-- --------------------------------------------------
-- VIEW dbo.V_IT
-- --------------------------------------------------

CREATE VIEW [dbo].[V_IT]
AS

SELECT ISSUE_RESOLVED_BY, 
Sum(Total) As TODAYS_TOTAL,
SUM(T_COMPLETED) AS  TODAY_COMPLETED, 
SUM(T_ESCALATED) AS TODAY_ESCALTED, 
SUM(T_PENDING) AS TODAY_PENDING,   
SUM(T_REASSIGNED) AS TODAY_REASSINGNED, 
SUM(T_CLOSED) AS TODAY_CLOSED ,    
SUM(CM_COMPLETED) AS CurrentMonth_COMPLETED, 
SUM(CM_ESCALATED) AS CurrentMonth_ESCALATED, 
SUM(CM_PENDING) AS CurrentMonth_PENDING,  
SUM(CM_REASSIGNED) AS CurrentMonth_REASSIGNED, 
SUM(CM_CLOSED) AS CurrentMonth_CLOSED,   
SUM(LM_COMPLETED) AS LastMonth_COMPLETED, 
SUM(LM_ESCALATED) AS LastMonth_ESACLATED, 
SUM(LM_PENDING) AS LastMonth_PENDING,  
SUM(LM_REASSIGNED) AS LastMonth_REASSIGNED, 
SUM(LM_CLOSED) AS LastMonth_CLOSED FROM
(
SELECT * FROM
(
SELECT 
ISSUE_RESOLVED_BY,
Total=ISNULL(CASE WHEN STATUS_CODE IN ('ITC','ITEL2N','ITEL2O','ITEL2V','ITEL3''ITP','ITUP','ITL2RO','ITL2RN','ITL2RV','ITL3R','X') THEN COUNT(STATUS_CODE) END,0),
T_COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
T_ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
T_PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
T_REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
T_CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
CM_COMPLETED='',
CM_ESCALATED='',
CM_PENDING='',
CM_REASSIGNED='',
CM_CLOSED='',
LM_COMPLETED='',
LM_ESCALATED='',
LM_PENDING='',
LM_REASSIGNED='',
LM_CLOSED=''
FROM TBL_NEWTASKDETAILS (NOLOCK) WHERE 
ISSUE_RAISED_DATETIME >= CONVERT(VARCHAR(11),GETDATE()) AND
ISSUE_RAISED_DATETIME <= CONVERT(VARCHAR(11),GETDATE()) + ' 23:59:59'
GROUP BY ISSUE_RESOLVED_BY,STATUS_CODE
) X
UNION ALL
SELECT * FROM
(
SELECT 
ISSUE_RESOLVED_BY,
T='',A='',B='',C='',D='',E='',
COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0),
F='',G='',H='',I='',J=''
FROM TBL_NEWTASKDETAILS (NOLOCK) WHERE 
DATEPART(MM,ISSUE_RAISED_DATETIME) = DATEPART(MM,GETDATE())
GROUP BY ISSUE_RESOLVED_BY,STATUS_CODE
) Y 
UNION ALL
SELECT * FROM
(
SELECT 
ISSUE_RESOLVED_BY,
T='',A='',B='',C='',D='',E='',F='',G='',H='',I='',J='',
COMPLETED= ISNULL(CASE WHEN STATUS_CODE = 'ITC' THEN COUNT(STATUS_CODE) END,0),
ESCALATED = ISNULL(CASE WHEN STATUS_CODE IN ('ITEL2N','ITEL2O','ITEL2V','ITEL3') THEN COUNT(STATUS_CODE) END,0),
PENDING = ISNULL(CASE WHEN STATUS_CODE IN ('ITP','ITUP') THEN COUNT(STATUS_CODE) END,0),
REASSIGNED = ISNULL(CASE WHEN STATUS_CODE IN ('ITL2RO','ITL2RN','ITL2RV','ITL3R') THEN COUNT(STATUS_CODE) END,0),
CLOSED = ISNULL(CASE WHEN STATUS_CODE = 'X' THEN COUNT(STATUS_CODE) END,0)
FROM TBL_NEWTASKDETAILS (NOLOCK) WHERE 
DATEPART(MM,ISSUE_RAISED_DATETIME) = DATEPART(MM,GETDATE())-1
GROUP BY ISSUE_RESOLVED_BY,STATUS_CODE
) Z 
) X GROUP BY ISSUE_RESOLVED_BY

GO

-- --------------------------------------------------
-- VIEW dbo.view_completed
-- --------------------------------------------------
CREATE view view_completed
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from tbl_newClient_details where status_code='ITC' and left(issue_raised_datetime,11)=left(getdate(),11) group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.view_completed_currentmonth
-- --------------------------------------------------
CREATE view view_completed_currentmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code='C' and  datename(month,issue_raised_datetime)=datename(month,getdate())
group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.view_completed_lastmonth
-- --------------------------------------------------
CREATE view view_completed_lastmonth
as 
select issue_resolved_by as issue_resolved_by,count(docket_number) as completed from client_details where status_code='C' and  datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate()))
group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.view_currentmonth
-- --------------------------------------------------
CREATE view [dbo].[view_currentmonth] 
as
select user_master.userid as userid,view_completed_currentmonth.completed as completed,view_escalated_currentmonth.Escalated as escalated,view_performancepoint_currentmonth.total as PerformancePoint from view_completed_currentmonth 
left join view_escalated_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_escalated_currentmonth.issue_resolved_by
left join view_performancepoint_currentmonth 
on view_completed_currentmonth.issue_resolved_by=view_performancepoint_currentmonth.emp_id 
left join user_master 
on view_completed_currentmonth.issue_resolved_by=user_master.userid

GO

-- --------------------------------------------------
-- VIEW dbo.view_escalated
-- --------------------------------------------------
CREATE view view_escalated
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from tbl_newClient_details where (status_code='ITEl2N' or status_code='ITEl2O' or status_code='ITEl2V' or status_code='ITEL3') and left(issue_raised_datetime,11)=left(getdate(),11)  group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.view_escalated_currentmonth
-- --------------------------------------------------
CREATE view view_escalated_currentmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code='ET' or status_code='EF' or status_code='E3') and  datename(month,issue_raised_datetime)=datename(month,getdate()) group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.view_escalated_lastmonth
-- --------------------------------------------------
CREATE view view_escalated_lastmonth
as
select issue_resolved_by as issue_resolved_by,count(docket_number) as Escalated from client_details where (status_code='ET' or status_code='EF' or status_code='E3') and  datename(month,issue_raised_datetime)=datename(month,dateadd(month,-1,getdate())) group by issue_resolved_by

GO

-- --------------------------------------------------
-- VIEW dbo.view_lastmonth
-- --------------------------------------------------
CREATE view view_lastmonth 
as
select user_master.userid as userid,view_completed_lastmonth.completed as completed,view_escalated_lastmonth.Escalated as escalated,view_performancepoint_lastmonth.total as PerformancePoint from view_completed_lastmonth 
left join view_performancepoint_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_performancepoint_lastmonth.emp_id
left join view_escalated_lastmonth 
on view_completed_lastmonth.issue_resolved_by=view_escalated_lastmonth.issue_resolved_by
left join user_master 
on view_completed_lastmonth.issue_resolved_by=user_master.userid

GO

-- --------------------------------------------------
-- VIEW dbo.view_Mastermind
-- --------------------------------------------------
CREATE view view_Mastermind 
as
select user_master.userid as userid,view_completed.completed as completed,view_escalated.Escalated as escalated,view_performancepoint.total as PerformancePoint from view_escalated 
left join view_performancepoint 
on view_escalated.issue_resolved_by=view_performancepoint.emp_id
left join view_completed 
on view_escalated.issue_resolved_by =view_completed.issue_resolved_by
left join user_master 
on view_escalated.issue_resolved_by=user_master.userid

GO

-- --------------------------------------------------
-- VIEW dbo.view_performancepoint
-- --------------------------------------------------
CREATE view view_performancepoint
as
select emp_id,date,total from executive_rating
where left(date,11)=left(getdate(),11) and emp_id in(select userid from user_master where teamleader='e03446'and userid<>'e03446') group by date,emp_id,total

GO

-- --------------------------------------------------
-- VIEW dbo.view_performancepoint_currentmonth
-- --------------------------------------------------
CREATE view view_performancepoint_currentmonth
as
select emp_id,sum(total) as Total from executive_rating
where  datename(month,date)=datename(month,getdate())
group by emp_id

GO

-- --------------------------------------------------
-- VIEW dbo.view_performancepoint_lastmonth
-- --------------------------------------------------
CREATE view view_performancepoint_lastmonth
as
select emp_id,sum(total) as Total from executive_rating
where  datename(month,date)=datename(month,dateadd(month,-1,getdate()))
group by emp_id

GO

-- --------------------------------------------------
-- VIEW dbo.VW_CRMS_ClientMaster
-- --------------------------------------------------

/*Created By Sanjay Patel
Created On 19-July-2010
Requested By Kamran*/
/*Altered By Jayesh Naik
Created On 26-July-2010, Added Region code and zone code*/
CREATE VIEW [dbo].[VW_CRMS_ClientMaster]
AS
SELECT     dbo.Client_Master.Client_Code, dbo.Client_Master.Short_Name, dbo.Client_Master.Long_Name, dbo.Client_Master.DOB, 
					  dbo.Client_Master.Region_code,dbo.Client_Master.zone_code,
                      dbo.Client_Master.Active_From, dbo.Client_Master.Online_Client, dbo.Client_Master.B2C, dbo.Client_Master.Branch_Code, 
                      dbo.Client_Master.Subbroker_Code, dbo.Vendor_Product.Product_Name, dbo.Client_Master.Secondary_Product, dbo.Client_Master.PDA, 
                      dbo.Client_Master.Manager_Code, dbo.Client_Master.Account_Status, dbo.Client_Master.PAN_Number, dbo.Client_Master.BSE, 
                      dbo.Client_Master.NSE, dbo.Client_Master.NSEFO, dbo.Client_Master.MCX, dbo.Client_Master.NCDEX, dbo.Client_Master.Address, 
                      dbo.Client_Master.Address1, dbo.Client_Master.Address2, dbo.Client_Master.City, dbo.Client_Master.State, dbo.Client_Master.Country, 
                      dbo.Client_Master.Permanent_Address, dbo.Client_Master.Landline_Number1, dbo.Client_Master.Landline_Number2, 
                      dbo.Client_Master.Office_Number1, dbo.Client_Master.Office_Number2, dbo.Client_Master.Mobile, dbo.Client_Master.Email, 
                      dbo.Client_Master.SERIAL_ID, dbo.Client_Master.EChopda
FROM         dbo.Client_Master INNER JOIN
                      dbo.Vendor_Product ON dbo.Client_Master.Product_Code = dbo.Vendor_Product.Product_Code
WHERE     (dbo.Client_Master.Account_Status = 1) AND (dbo.Client_Master.Online_Client = 1)

GO


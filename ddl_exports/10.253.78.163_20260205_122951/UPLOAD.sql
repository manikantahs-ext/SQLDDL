-- DDL Export
-- Server: 10.253.78.163
-- Database: UPLOAD
-- Exported: 2026-02-05T12:32:33.667404

USE UPLOAD;
GO

-- --------------------------------------------------
-- FOREIGN_KEY dbo.SCCS_deletecontrolclients_log
-- --------------------------------------------------
ALTER TABLE [dbo].[SCCS_deletecontrolclients_log] ADD CONSTRAINT [FK__SCCS_delet__srno__2C4E31CA] FOREIGN KEY ([srno]) REFERENCES [dbo].[SCCS_deletecontrolclients] ([srno])

GO

-- --------------------------------------------------
-- FUNCTION dbo.FILLSTRING
-- --------------------------------------------------
CREATE FUNCTION DBO.FILLSTRING
(
    @STR AS VARCHAR(1000),
    @REPLACESTR AS VARCHAR(1000),
    @TO_LEN AS SMALLINT,
    @BEFORE_AFTER AS BIT
)
RETURNS VARCHAR(1000)
BEGIN
    DECLARE @CURR_LEN AS INT
    SET @CURR_LEN = LEN(@STR)
    WHILE (@CURR_LEN<@TO_LEN)
    BEGIN
        SELECT @STR = CASE WHEN @BEFORE_AFTER = 0 THEN @REPLACESTR+@STR ELSE @STR+@REPLACESTR END
        --SET @CURR_LEN = LEN(@STR)
        SET @CURR_LEN = @CURR_LEN + 1
    END
    RETURN @STR
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fun_GetFileExists
-- --------------------------------------------------
create function fun_GetFileExists(@filePath varchar(4000))
returns int
begin
	declare @Cnt int;
	declare @exists nvarchar(4000)
	set @exists = 'dir ' + @filePath
	
	exec @Cnt = master..xp_cmdshell @exists,no_output
	return @Cnt;
	/*Value zero(0) return for file exsist*/
end

GO

-- --------------------------------------------------
-- FUNCTION dbo.getlastdate
-- --------------------------------------------------

create function getlastdate(@mmonth int, @myear int)  
RETURNs Datetime  
As  
Begin  
--set @mmonth =  2  
--set @myear  = 2007  
declare @tdate as datetime  
select @tdate=convert(datetime,convert(varchar(2),case when @mmonth < 12 then @mmonth+1 else 1 end)+'/01/'+convert(varchar(4),  
case when @mmonth < 12 then @myear else @myear+1 end))-1  
Return @tdate  
End

GO

-- --------------------------------------------------
-- FUNCTION dbo.Split
-- --------------------------------------------------
CREATE FUNCTION dbo.Split(@String varchar(8000), @Delimiter char(1))        
returns @temptable TABLE (items varchar(8000))        
as        
begin        
    declare @idx int        
    declare @slice varchar(8000)        
       
    select @idx = 1        
        if len(@String)<1 or @String is null  return        
       
    while @idx!= 0        
    begin        
        set @idx = charindex(@Delimiter,@String)        
        if @idx!=0        
          set @slice = left(@String,@idx - 1)        
        else        
            set @slice = @String        
           
        if(len(@slice)>0)   
            insert into @temptable(Items) values(@slice)        
  
        set @String = right(@String,len(@String) - @idx)        
        if len(@String) = 0 break        
    end    
return        
end

GO

-- --------------------------------------------------
-- INDEX dbo.a
-- --------------------------------------------------
CREATE CLUSTERED INDEX [apty] ON [dbo].[a] ([A_PARTY_ID])

GO

-- --------------------------------------------------
-- INDEX dbo.BlockScrip_nse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_BlockScrip_nse_Symbol_Group_delete_status] ON [dbo].[BlockScrip_nse] ([Symbol], [Group], [delete_status])

GO

-- --------------------------------------------------
-- INDEX dbo.BlockScrip_nse
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_delete_status] ON [dbo].[BlockScrip_nse] ([delete_status], [Group], [Symbol])

GO

-- --------------------------------------------------
-- INDEX dbo.BSEBlockScript
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SCRIPCODE] ON [dbo].[BSEBlockScript] ([SCRIPCODE]) INCLUDE ([SYMBOL], [SCRIPGROUP])

GO

-- --------------------------------------------------
-- INDEX dbo.Commo_dormant_t
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idxcli] ON [dbo].[Commo_dormant_t] ([cltcode])

GO

-- --------------------------------------------------
-- INDEX dbo.Commo_dormant_xx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idxcli] ON [dbo].[Commo_dormant_xx] ([cltcode])

GO

-- --------------------------------------------------
-- INDEX dbo.EBROK_EMAIL
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [idx_server] ON [dbo].[EBROK_EMAIL] ([server1])

GO

-- --------------------------------------------------
-- INDEX dbo.NSEBlockScript
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_SecuritySeries] ON [dbo].[NSEBlockScript] ([SecuritySeries], [SecuritySymbol])

GO

-- --------------------------------------------------
-- INDEX dbo.Odin_Clt_Map
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Fld_Date] ON [dbo].[Odin_Clt_Map] ([Fld_Date], [Fld_Server])

GO

-- --------------------------------------------------
-- INDEX dbo.omnesys_user_info_all
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idx_cli] ON [dbo].[omnesys_user_info_all] ([client_id])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Col_data
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_Fld_date] ON [dbo].[tbl_Col_data] ([Fld_Date])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_gen_odin_file
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Fld_date] ON [dbo].[tbl_gen_odin_file] ([Fld_Date], [Fld_Server])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_gen_odin_file_New
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_tbl_gen_odin_file_New_Fld_Date_Fld_Server] ON [dbo].[tbl_gen_odin_file_New] ([Fld_Date], [Fld_Server])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_Holding_Data
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Fld_Datetime] ON [dbo].[tbl_Holding_Data] ([Fld_Datetime])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_pincity_master
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ix_pincityMaster] ON [dbo].[tbl_pincity_master] ([State], [City], [Pin_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_rpt_status
-- --------------------------------------------------
CREATE CLUSTERED INDEX [ci_tbl_rpt_status] ON [dbo].[tbl_rpt_status] ([Fld_UpdateDate])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_tempPledgeRelease_hist
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ncidx_filter_update_time] ON [dbo].[tbl_tempPledgeRelease_hist] ([update_time])

GO

-- --------------------------------------------------
-- INDEX dbo.Test
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ__Test__65570293] ON [dbo].[Test] ([T3])

GO

-- --------------------------------------------------
-- INDEX dbo.Test
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ__Test__664B26CC] ON [dbo].[Test] ([T2])

GO

-- --------------------------------------------------
-- INDEX dbo.Test
-- --------------------------------------------------
CREATE UNIQUE NONCLUSTERED INDEX [UQ__Test__673F4B05] ON [dbo].[Test] ([T1])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.BlockScrip_BSE
-- --------------------------------------------------
ALTER TABLE [dbo].[BlockScrip_BSE] ADD CONSTRAINT [PK_BlockScrip_BSE] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.BlockScrip_nse
-- --------------------------------------------------
ALTER TABLE [dbo].[BlockScrip_nse] ADD CONSTRAINT [PK_BlockScrip_nse] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Category
-- --------------------------------------------------
ALTER TABLE [dbo].[Category] ADD CONSTRAINT [PK_Category] PRIMARY KEY ([CatID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Global_Upload_SANNAS
-- --------------------------------------------------
ALTER TABLE [dbo].[Global_Upload_SANNAS] ADD CONSTRAINT [PK_Global_Upload_SANNAS] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.InventoryData
-- --------------------------------------------------
ALTER TABLE [dbo].[InventoryData] ADD CONSTRAINT [PK_InventoryData] PRIMARY KEY ([ItemID], [CatID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.InventoryItem
-- --------------------------------------------------
ALTER TABLE [dbo].[InventoryItem] ADD CONSTRAINT [PK_InventoryItem] PRIMARY KEY ([ItemID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ModifiedRequest
-- --------------------------------------------------
ALTER TABLE [dbo].[ModifiedRequest] ADD CONSTRAINT [PK_ModifiedRequest] PRIMARY KEY ([ModID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Notifications
-- --------------------------------------------------
ALTER TABLE [dbo].[Notifications] ADD CONSTRAINT [PK_Notifications] PRIMARY KEY ([NoteID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Order_Queue
-- --------------------------------------------------
ALTER TABLE [dbo].[Order_Queue] ADD CONSTRAINT [PK_Order_Queue] PRIMARY KEY ([orderID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Order_VQueue
-- --------------------------------------------------
ALTER TABLE [dbo].[Order_VQueue] ADD CONSTRAINT [PK_Order_VQueue] PRIMARY KEY ([ReqID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.OrderTmpQueue
-- --------------------------------------------------
ALTER TABLE [dbo].[OrderTmpQueue] ADD CONSTRAINT [PK_OrderTmpQueue] PRIMARY KEY ([OrderID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ProcessIncharge
-- --------------------------------------------------
ALTER TABLE [dbo].[ProcessIncharge] ADD CONSTRAINT [PK_ProcessIncharge] PRIMARY KEY ([Emp_No], [ReqID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ReqModified
-- --------------------------------------------------
ALTER TABLE [dbo].[ReqModified] ADD CONSTRAINT [PK_ReqModified] PRIMARY KEY ([ReqID], [ModID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ReqStatus
-- --------------------------------------------------
ALTER TABLE [dbo].[ReqStatus] ADD CONSTRAINT [PK_ReqStatus] PRIMARY KEY ([ReqStatusCode])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SCCS_deletecontrolclients
-- --------------------------------------------------
ALTER TABLE [dbo].[SCCS_deletecontrolclients] ADD CONSTRAINT [PK__SCCS_del__36B150C626955874] PRIMARY KEY ([srno])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.SCCS_deletecontrolclients_log
-- --------------------------------------------------
ALTER TABLE [dbo].[SCCS_deletecontrolclients_log] ADD CONSTRAINT [PK__SCCS_del__D393F0472A65E958] PRIMARY KEY ([t_srno])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.scrip_master
-- --------------------------------------------------
ALTER TABLE [dbo].[scrip_master] ADD CONSTRAINT [PK_scrip_master] PRIMARY KEY ([scri_code], [scrip_symbol], [ISIN])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_master_daily_turnover
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_master_daily_turnover] ADD CONSTRAINT [PK_tbl_master_daily_turnover] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Test
-- --------------------------------------------------
ALTER TABLE [dbo].[Test] ADD CONSTRAINT [UQ__Test__65570293] UNIQUE ([T3])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Test
-- --------------------------------------------------
ALTER TABLE [dbo].[Test] ADD CONSTRAINT [UQ__Test__664B26CC] UNIQUE ([T2])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Test
-- --------------------------------------------------
ALTER TABLE [dbo].[Test] ADD CONSTRAINT [UQ__Test__673F4B05] UNIQUE ([T1])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TICKER_IMG_UPLOAD1
-- --------------------------------------------------
ALTER TABLE [dbo].[TICKER_IMG_UPLOAD1] ADD CONSTRAINT [PK__TICKER_IMG_UPLOA__1AED04F0] PRIMARY KEY ([ANGEL_TICKER_ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TR_IMAGE_UPLOAD
-- --------------------------------------------------
ALTER TABLE [dbo].[TR_IMAGE_UPLOAD] ADD CONSTRAINT [PK__TR_IMAGE__B399A9D05FC54ADD] PRIMARY KEY ([IMAGE_UPLOAD_ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TR_IMG_UPLOAD1
-- --------------------------------------------------
ALTER TABLE [dbo].[TR_IMG_UPLOAD1] ADD CONSTRAINT [PK__TR_IMG_UPLOAD__7D3CA678] PRIMARY KEY ([IMG_UPLOAD_ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.UserRequest
-- --------------------------------------------------
ALTER TABLE [dbo].[UserRequest] ADD CONSTRAINT [PK_UserRequest] PRIMARY KEY ([ReqID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.UserVIRequest
-- --------------------------------------------------
ALTER TABLE [dbo].[UserVIRequest] ADD CONSTRAINT [PK_UserVIRequest] PRIMARY KEY ([ReqID])

GO

-- --------------------------------------------------
-- PROCEDURE dbo.A_HE_Diff_Des_than_IT
-- --------------------------------------------------
CREATE procedure A_HE_Diff_Des_than_IT(@access_to varchar(20),@access_code varchar(20))    
AS    
select    
 e.emp_no,e.emp_name [Emp. Name],t.emp_designation [Designation in Exchange Server],t.emp_emailid [Email ID on Exchange] ,   
e.designation [Designation in Harmony],e.email [Email ID in Harmony] ,
  t.emp_alias sAMAccountName,givenName=substring(e.emp_name,0,charindex(' ',e.emp_name)),sn=reverse(substring(reverse(e.emp_name),0,charindex(' ',reverse(e.emp_name)))),
Title=emp_designation,displayNamePrintable=replace(emp_alias,'.',' '),description=emp_designation,
Departmentname=e.department,CompanyName=e.company,e.location,physicalDeliveryOfficeName=e.attendanceloc,
mail=emp_emailid,mailNickname=emp_alias,proxyAddresses='smtp:'+emp_emailid,mailboxEnabled='TRUE',passwordNeverExpires='TRUE'

from tbl_exchange_details_temp t    
join    
intranet.risk.dbo.emp_info e    
on t.emp_name=e.emp_name     
 where e.status='A' and replace(t.emp_designation,'.','')<>replace(e.designation,'.','')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.A_HE_DiffID_ExchngS
-- --------------------------------------------------
CREATE procedure A_HE_DiffID_ExchngS(@access_to varchar(20),@access_code varchar(20))    
AS    
select e.emp_no,e.emp_name [Emp. Name],e.Status,t.emp_emailid[Emp ID in Exchange Server],e.email [Emp.ID in Harmony],  
  t.emp_alias sAMAccountName,givenName=substring(e.emp_name,0,charindex(' ',e.emp_name)),sn=reverse(substring(reverse(e.emp_name),0,charindex(' ',reverse(e.emp_name)))),  
Title=emp_designation,displayNamePrintable=replace(emp_alias,'.',' '),description=emp_designation,  
Departmentname=e.department,CompanyName=e.company,e.location,physicalDeliveryOfficeName=e.attendanceloc,  
mail=emp_emailid,mailNickname=emp_alias,proxyAddresses='smtp:'+emp_emailid,mailboxEnabled='TRUE',passwordNeverExpires='TRUE'  
from tbl_exchange_details_temp t    
  join    
intranet.risk.dbo.emp_info e    
on t.emp_name=e.emp_name   
 where e.status='A' and t.emp_emailid<>e.email and e.email<>''

GO

-- --------------------------------------------------
-- PROCEDURE dbo.A_HE_IDMissingH
-- --------------------------------------------------
CREATE procedure A_HE_IDMissingH(@access_to varchar(20),@access_code varchar(20))
AS
select distinct emp_no [Emp. ID],emp_name [Emp. Name],Status,department [Emp. Department],Designation  from intranet.risk.dbo.emp_info 
where status='A' and email =''--5050

GO

-- --------------------------------------------------
-- PROCEDURE dbo.add_notice
-- --------------------------------------------------
create procedure add_notice
(
@nid varchar(50),
@reqID varchar(20),
@hodNo varchar(20),
@empno varchar(20),
@pino varchar(20),
@note varchar(80),
@noteDate varchar(20),
@message varchar(80),
@subject varchar(40),
@ischecked int,
@catname varchar(30),
@itemName varchar(30),
@status varchar(4)
)
as 
insert into Notifications values(@nid, @reqID, @hodNo, @empno,@pino, @note, @noteDate,@message,@subject,@ischecked,@catname,@itemname,@status)
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.addToOrderQueue
-- --------------------------------------------------
create procedure addToOrderQueue
(
@ordid varchar(50),
@hodid varchar(25),
@itemid varchar(50),
@qty float--,@reqid varchar(20)
--,@stat integer--,@initQty float,@newQty float
)
as
--@initQty = select qty from Order_Queue where hod_no = @hodid and itemid = @itemid
--@newQty = @qty - @initQty
Declare @rate float

select @rate=rate from InventoryItem where Itemid = @itemId

insert into Order_Queue values(@ordid,@hodid,@itemid,@qty,0,0,@rate)
--update UserRequest set orderID=@ordID where ReqID = @ReqID

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.All_order_rejection_file
-- --------------------------------------------------
CREATE procedure All_order_rejection_file
as            
--set nocount on            
declare @k as int            
select @k=count(distinct locaCode) from intranet.testdb.dbo.ctclmgrlocation            
select distinct locaCode into #temp from intranet.testdb.dbo.ctclmgrlocation            
while(@k > 0)            
begin            
begin            
 declare @loc_code as varchar(10)            
 select distinct @loc_code=replace(locaCode,'','') from(            
  SELECT ROW_NUMBER()                     
  OVER (order by locaCode) AS Row,locaCode                     
  FROM #temp) AS loc where Row=@k             
            
 declare @str as varchar(200) ,@result as varchar(11), @dt as varchar(11),@date as varchar(5)            
 set @dt=convert(varchar(11),getdate()-1,103)              
 set @date=substring(@dt,4,2) +substring(@dt,1,2)            
            
 set @str='declare @result as int'                    
 set @str=@str+' exec @result=MASTER.dbo.xp_cmdshell ''dir \\196.1.115.133\OrderRejection\'            
  +@loc_code+'\'+@date+'Rej.xls'', NO_OUTPUT'               
 set @str=@str+' select Result=@result '            
                                                  
 create table #temp1(status int)                
  insert into #temp1            
  exec(@str)                                                   
  select @result=status from #temp1            
            
 if(@result = '0')            
 begin try               
 begin            
  declare @str_temp as varchar(1000),@fname as varchar(500),@dif as varchar(11), @dd as varchar(5)            
            
  set @fname=' exec MASTER.dbo.xp_cmdshell''dir \\196.1.115.133\OrderRejection\'            
   +@loc_code+'\'+@date+'Rej.xls'''            
  create table #tmp1 (mdate varchar(8000))              
  insert #tmp1            
  exec(@fname);            
    with mdt as                 
     (select * ,row_number() over (order by mdate) as id from #tmp1)                
    select  mgr_code=@loc_code,mod_date=convert(varchar(11),convert(datetime,substring(mdate,1,11)),103),            
    corr_date=convert(varchar(11),convert(varchar(11),getdate()),103) into #data from mdt where id=9               
    drop table #tmp1                
    insert into mod_dt                
    select * from #data              
            
  set @str_temp=''            
            
  set @str_temp='insert into  intranet.mis.dbo.hist_tbl_ctcl_failed_new            
   select [User Id],Client,Reason,'''+@loc_code+''',convert(datetime,convert(varchar(11),getdate())) FROM              
   OPENROWSET(''Microsoft.ace.OLEDB.12.0'',''Excel 8.0;DATABASE=\\196.1.115.133\OrderRejection\'            
   +@loc_code+'\'+@date+'Rej.xls'',''Select * from [sheet1$]'');'            
              
  --print(@str_temp)            
  exec(@str_temp)            
              
  drop table #data  
  
 end            
 end try            
 BEGIN CATCH            
  drop table #data             
  insert into Rej_update_log values (convert(varchar(11),getdate()),@loc_code,            
     'file not exist')            
 END CATCH            
 else            
 begin            
            
  insert into Rej_update_log values (convert(varchar(11),getdate()),@loc_code,            
     'file not exist')             
 end            
 drop table #temp1            
set @k=@k-1   
  
end            
end     
         
drop table #temp            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.All_order_rejection_file_19112012
-- --------------------------------------------------
CREATE procedure All_order_rejection_file_19112012
as            
--set nocount on            
declare @k as int            
select @k=count(distinct locaCode) from intranet.testdb.dbo.ctclmgrlocation            
select distinct locaCode into #temp from intranet.testdb.dbo.ctclmgrlocation            
while(@k > 0)            
begin            
begin            
 declare @loc_code as varchar(10)            
 select distinct @loc_code=replace(locaCode,'','') from(            
  SELECT ROW_NUMBER()                     
  OVER (order by locaCode) AS Row,locaCode                     
  FROM #temp) AS loc where Row=@k             
            
 declare @str as varchar(200) ,@result as varchar(11), @dt as varchar(11),@date as varchar(5)            
 set @dt=convert(varchar(11),getdate()-1,103)              
 set @date=substring(@dt,4,2) +substring(@dt,1,2)            
            
 set @str='declare @result as int'                    
 set @str=@str+' exec @result=MASTER.dbo.xp_cmdshell ''dir \\196.1.115.133\OrderRejection\'            
  +@loc_code+'\'+@date+'Rej.xls'', NO_OUTPUT'               
 set @str=@str+' select Result=@result '            
                                                  
 create table #temp1(status int)                
  insert into #temp1            
  exec(@str)                                                   
  select @result=status from #temp1            
            
 if(@result = '0')            
 begin try               
 begin            
  declare @str_temp as varchar(1000),@fname as varchar(500),@dif as varchar(11), @dd as varchar(5)            
            
  set @fname=' exec MASTER.dbo.xp_cmdshell''dir \\196.1.115.133\OrderRejection\'            
   +@loc_code+'\'+@date+'Rej.xls'''            
  create table #tmp1 (mdate varchar(8000))              
  insert #tmp1            
  exec(@fname);            
    with mdt as                 
     (select * ,row_number() over (order by mdate) as id from #tmp1)                
    select  mgr_code=@loc_code,mod_date=convert(varchar(11),convert(datetime,substring(mdate,1,11)),103),            
    corr_date=convert(varchar(11),convert(varchar(11),getdate()),103) into #data from mdt where id=9               
    drop table #tmp1                
    insert into mod_dt                
    select * from #data              
            
  set @str_temp=''            
            
  set @str_temp='insert into  intranet.mis.dbo.hist_tbl_ctcl_failed_new            
   select [User Id],Client,Reason,'''+@loc_code+''',convert(datetime,convert(varchar(11),getdate())) FROM              
   OPENROWSET(''Microsoft.ace.OLEDB.12.0'',''Excel 8.0;DATABASE=\\196.1.115.133\OrderRejection\'            
   +@loc_code+'\'+@date+'Rej.xls'',''Select * from [sheet1$]'');'            
              
  --print(@str_temp)            
  exec(@str_temp)            
              
  drop table #data  
  
  
/* Condition For success  */  
  
declare @Smailrecipient varchar(2000)  
  
CREATE TABLE #EMAIL  
(  
EMAIL VARCHAR(2000)  
)  
  
INSERT INTO #EMAIL  
EXEC INTRANET.MISC.DBO.SP_GET_GLOBAL_EMAIL 'CSO_Survelience','TO','S'  
  
SELECT @Smailrecipient = EMAIL FROM #EMAIL  
  
EXEC msdb.dbo.Sp_send_dbmail  
 @profile_name='DBA',  
 @recipients =@Smailrecipient,  
 @copy_recipients='patel.prashant@angelbroking.com;ritesh.suryavanshi@angelbroking.com;bi.dba@angelbroking.com',  
 @subject = 'Version Order/Rejection JOB Successfully Completed (167)',  
 @body='Dear Team, <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Job "Version Order/Rejection" Completed Successfully',  
 @body_format = 'HTML'  
  
             
 end            
 end try            
 BEGIN CATCH            
  drop table #data             
  insert into Rej_update_log values (convert(varchar(11),getdate()),@loc_code,            
     'file not exist')            
 END CATCH            
 else            
 begin            
            
  insert into Rej_update_log values (convert(varchar(11),getdate()),@loc_code,            
     'file not exist')             
 end            
 drop table #temp1            
set @k=@k-1   
  
/*Condition For Failure*/  
  
declare @Fmailrecipient varchar(2000)  
  
CREATE TABLE #FEMAIL  
(  
EMAIL VARCHAR(2000)  
)  
  
INSERT INTO #FEMAIL  
EXEC INTRANET.MISC.DBO.SP_GET_GLOBAL_EMAIL 'CSO_Survelience','TO','S'  
  
SELECT @Fmailrecipient = EMAIL FROM #FEMAIL  
  
EXEC msdb.dbo.Sp_send_dbmail  
 @profile_name='DBA',  
 @recipients =@Fmailrecipient,  
 @copy_recipients='patel.prashant@angelbroking.com;ritesh.suryavanshi@angelbroking.com;bi.dba@angelbroking.com',  
 @subject = 'Version Order/Rejection JOB Failed (167)',  
 @body='Dear Team, <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Job "Version Order/Rejection" Failed',  
 @body_format = 'HTML'  
  
           
end            
end     
         
drop table #temp            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.All_order_rejection_file_datewise_process
-- --------------------------------------------------
CREATE procedure All_order_rejection_file_datewise_process (@tdate as varchar(11))  
as  
  
set @tdate= convert(datetime,@tdate,103)  
  
declare @k as int  
    select @k=count(distinct locaCode) from intranet.testdb.dbo.ctclmgrlocation  
    select distinct locaCode into #temp from intranet.testdb.dbo.ctclmgrlocation  
while(@k > 0)  
begin  
    begin  
        declare @loc_code as varchar(10)  
        select distinct @loc_code=replace(locaCode,'','') from(  
        SELECT ROW_NUMBER()  
        OVER (order by locaCode) AS Row,locaCode  
        FROM #temp) AS loc where Row=@k  
  
        declare @str as varchar(200) ,@result as varchar(11), @dt as varchar(11),@date as varchar(5)  
        set @dt=convert(varchar(11),convert(datetime,@tdate,103)-1,103)  
        set @date=substring(@dt,4,2) +substring(@dt,1,2)  
  
        set @str='declare @result as int'  
        set @str=@str+' exec @result=MASTER.dbo.xp_cmdshell ''dir \\196.1.115.133\OrderRejection\'  
        +@loc_code+'\'+@date+'Rej.xls'', NO_OUTPUT'  
        set @str=@str+' select Result=@result '  
  
        create table #temp1(status int)  
        insert into #temp1  
        exec(@str)  
        select @result=status from #temp1 
        print @result 
  
        if(@result = '0')  
        begin try  
            begin  
                declare @str_temp as varchar(1000),@fname as varchar(500),@dif as varchar(11), @dd as varchar(5)  
  
                set @fname=' exec MASTER.dbo.xp_cmdshell''dir \\196.1.115.133\OrderRejection\'  
                +@loc_code+'\'+@date+'Rej.xls'''  
  
                create table #tmp1 (mdate varchar(8000))  
                insert #tmp1  
                exec(@fname);  
                with mdt as  
                (select * ,row_number() over (order by mdate) as id from #tmp1)  
                select mgr_code=@loc_code,mod_date=convert(varchar(11),convert(datetime,substring(mdate,1,11)),103),  
                corr_date=convert(varchar(11),convert(varchar(11),@tdate),103) into #data from mdt where id=9  
                drop table #tmp1  
                insert into mod_dt  
                select * from #data  
  
                delete from intranet.mis.dbo.hist_tbl_ctcl_failed_new where entrydate=@tdate and branch_id=@loc_code  
  
                set @str_temp=''  
  
                set @str_temp='insert into intranet.mis.dbo.hist_tbl_ctcl_failed_new  
                select [User Id],Client,Reason,'''+@loc_code+''',convert(datetime,convert(varchar(11),'''+@tdate+''')) FROM  
                OPENROWSET(''Microsoft.ace.OLEDB.12.0'',''Excel 8.0;DATABASE=\\196.1.115.133\OrderRejection\'  
                +@loc_code+'\'+@date+'Rej.xls'',''Select * from [sheet1$]'');'  
				
				print @str_temp		
                exec(@str_temp)  
  
                drop table #data  
            end  
        end try  
        BEGIN CATCH  
        drop table #data  
            insert into Rej_update_log_Reprocess values (convert(varchar(11),@tdate),@loc_code,  
            @date+'Rej.xls Error in uploading April')  
        END CATCH  
        else  
        begin  
            insert into Rej_update_log_Reprocess values (convert(varchar(11),@tdate),@loc_code,  
            @date+'Rej.xls File not exist April')  
        end  
        drop table #temp1  
        set @k=@k-1  
    end  
end  
drop table #temp  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Allotment_Master_Upload
-- --------------------------------------------------
CREATE PROC [DBO].[ALLOTMENT_MASTER_UPLOAD](@FILENAME AS VARCHAR(50))                                
AS                                                           
BEGIN                                                          
                                
SET NOCOUNT ON                                                    
SET XACT_ABORT ON                          
  
EXEC [INTRANET].RISK.DBO.ALLOTMENT_MASTER_UPLOAD @FILENAME                
TRUNCATE table LUMP_ALLOTMENT_MASTER_TEMP   
  
                                              
SET NOCOUNT OFF                                        
                                                    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Allotment_Master_Upload_bk
-- --------------------------------------------------
CREATE PROC [DBO].[ALLOTMENT_MASTER_UPLOAD_BK](@FILENAME AS VARCHAR(50))                      
AS                                                 
BEGIN                                                


  TRUNCATE TABLE LUMP_ALLOTMENT_MASTER_TEMP    
  TRUNCATE TABLE LUMP_ALLOTMENT_MASTER_UPLOAD
    
 INSERT INTO LUMP_ALLOTMENT_MASTER_UPLOAD
 SELECT * FROM LUMP_ALLOTMENT_MASTER_TEMP                                                          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Angel_Holding_Process
-- --------------------------------------------------
CREATE Proc Angel_Holding_Process      
as      
        
select x.*,y.cltdpid,        
case         
when x.Fld_Segment = 'BSE' then '14216209'        
when x.Fld_Segment = 'NSE' then '13326100'        
when x.Fld_Segment = 'NSEFO' then '15464303'        
when x.Fld_Segment = 'MCX' then '11198145'        
when x.Fld_Segment = 'NCDEX' then '11198647'  end as Angel_Id,       
--when x.Fld_Segment = 'BSEFO' then '1203320000823448'        
case when len(y.cltdpid) > 8 then 'CDSL' else 'NSDL' end as DP        
into #x       
from         
(  
select * from tbl_HoldingShifting_Codes where   
Fld_Flag = 'P' and Fld_Date = convert(varchar(11),getdate())  
)x        
left outer join        
(select * from middleware.MIMANSA.dbo.AngelClientSummary)y        
on x.Fld_FromCode = y.Party_code           
        
-----------------------Holding Shifting From Old COde To New Code        
declare @FromDpClCode Varchar(15),        
@ToDpClCode Varchar(15),        
@Angel_Id Varchar(30),        
@cltdpid Varchar(30),        
@DP Varchar(10),        
@Exchange Varchar(10),      
@Fld_SrNo int      
        
DECLARE Old_To_New_cursor CURSOR FOR select Fld_SrNo,Fld_FromCode,Fld_ToCode,Angel_Id,cltdpid,DP,Fld_Segment from #x                                              
OPEN Old_To_New_cursor                                              
                                              
FETCH NEXT FROM Old_To_New_cursor                                              
INTO @Fld_SrNo,@FromDpClCode,@ToDpClCode,@Angel_Id,@cltdpid,@DP,@Exchange                                              
                                              
WHILE @@FETCH_STATUS = 0                                              
BEGIN                      
         
--exec('Exec middleware.mimansa.dbo.TransferParty  '''+@FromDpClCode+''','''+@ToDpClCode+''',''ALL'','''+@Angel_Id+''', 0,'''','''+rtrim(ltrim(@cltdpid))+''','''+@DP+''',''B'','''+@Exchange+''',''''')        
    
Exec middleware.mimansa.dbo.TransferParty @FromDpClCode,@ToDpClCode,'ALL',@Angel_Id,0,'',@cltdpid,@DP,'B',@Exchange,''     
      
update tbl_HoldingShifting_Codes set Fld_Flag = 'A',Fld_Date = getdate() where Fld_SrNo = @Fld_SrNo      
                                               
FETCH NEXT FROM Old_To_New_cursor                                               
INTO @Fld_SrNo,@FromDpClCode,@ToDpClCode,@Angel_Id,@cltdpid,@DP,@Exchange                                  
                         
END                                              
                                              
CLOSE Old_To_New_cursor                                              
DEALLOCATE Old_To_New_cursor

GO

-- --------------------------------------------------
-- PROCEDURE dbo.asset_createstockfile
-- --------------------------------------------------
CREATE proc asset_createstockfile  
(  
@PTO AS VARCHAR(2000), @cc_mail as varchar(7000),  
@frm as varchar(7000),@msg as varchar(7000),  
@Sub as varchar(7000),@file2 as varchar(7000)       
)  
as  
  
                                   
Declare  @file as varchar(1000)                                      
Declare  @s as varchar(1000)                                      
Declare  @s1 as varchar(1000)                                      
--Declare  @MSG1 as varchar(8000)  
  
truncate table temp_stockdata                                      
  
insert into temp_stockdata                                     
select a.itemid,b.itemname,sum(a.total_qty) as total_qty,b.minlevel from intranet.assetmg.dbo.stockdata a   
 inner join intranet.assetmg.dbo.inventoryitem b on a.itemid=b.itemid where (a.total_qty-b.minlevel)<10   
 group by a.itemid,b.minlevel,b.itemname                                             
                         
set @file = 'D:\upload1\AssetMG\Stockdetails.doc'                            
                                                                    
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT * FROM MIS.upload.DBO.temp_stockdata" queryout '+@file+' -c -SMIS -Usa -Pnirwan612'                                                                                
set @s1= @s+''''                     
exec(@s1)                                        
print @s1                                      
                            
declare @file1 as varchar(300)                            
set @file1 = @file+';'+'D:\upload1\AssetMG\Stockdetails.doc'                               
                                      
--Exec Asset_send_mail @Fld_Email,@MSG,@file1,@branch_cd                         
Exec intranet.assetmg.dbo.Asset_send_mail @PTO,'' , @frm , @msg, @Sub , @file1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.bounce_sifyReport
-- --------------------------------------------------
CREATE proc bounce_sifyReport          
(          
 @branch_cd varchar(20)          
)          
          
as           
SELECT COALESCE(a.branch_cd,b.branch_cd) as branch,COALESCE(a.Sub_Broker,b.Sub_Broker) as Sub_Broker,          
COALESCE(a.ClientCode,b.ClientCode) as ClientCode,COALESCE(a.ClientName,b.ClientName) as ClientName,          
b.Mobile1,b.ResPhone1,b.telcaller,b.Remark1,c.NewRemarkBounce,b.EmailID,b.newid, b.minorchangeid,a.mobile,a.ResPhone,a.TCName,b.code1,          
a.remark,c.NewRemarkSify,a.ChangeAddress         
FROM  tbl_ControlFileClientLetter a          
Full OUTER JOIN          
(select * from  tbl_clientdata_record )b       
on a.clientcode=b.clientcode    
left outer join       
(select * from tbl_kycupdatedata)c    
on COALESCE(a.ClientCode,b.ClientCode) = c.clientcode     
 where a.branch_Cd like ltrim(rtrim(@branch_cd)) or b.branch_cd like ltrim(rtrim(@branch_cd))  order by clientcode

GO

-- --------------------------------------------------
-- PROCEDURE dbo.bounce_sifyReport_all
-- --------------------------------------------------
CREATE proc bounce_sifyReport_all          
(          
@branch_cd varchar(20)          
)          
          
as   
  
if @branch_cd = 'All'                          
begin                          
set @branch_cd = '%%'                          
end  
          
SELECT COALESCE(a.branch_cd,b.branch_cd) as branch,COALESCE(a.Sub_Broker,b.Sub_Broker) as Sub_Broker,          
COALESCE(a.ClientCode,b.ClientCode) as ClientCode,COALESCE(a.ClientName,b.ClientName) as ClientName,          
b.Mobile1,b.ResPhone1,b.telcaller,b.Remark1,c.NewRemarkBounce,b.EmailID,b.newid, b.minorchangeid,a.mobile,a.ResPhone,a.TCName,b.code1,          
a.remark,c.NewRemarkSify,a.ChangeAddress         
FROM  tbl_ControlFileClientLetter a          
FULL OUTER JOIN          
(select * from  tbl_clientdata_record )b       
on a.clientcode=b.clientcode    
left outer join       
(select * from tbl_kycupdatedata)c    
on COALESCE(a.ClientCode,b.ClientCode) = c.clientcode    
where a.branch_Cd like ltrim(rtrim(@branch_cd)) or b.branch_cd like ltrim(rtrim(@branch_cd))  order by branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.bounce_sifyReport_all1
-- --------------------------------------------------
CREATE proc bounce_sifyReport_all1              
(              
@branch_cd varchar(20)              
)              
              
as       
      
if @branch_cd = 'All'                              
begin                              
set @branch_cd = '%%'                              
end      
              
SELECT d.branch_cd as branch,d.sub_broker as Sub_Broker,              
COALESCE(a.ClientCode,b.ClientCode) as ClientCode,COALESCE(a.ClientName,b.ClientName) as ClientName,              
b.Mobile1,b.ResPhone1,b.telcaller,b.Remark1,c.NewRemarkBounce,b.EmailID,b.newid, b.minorchangeid,a.mobile,a.ResPhone,a.TCName,b.code1,              
a.remark,c.NewRemarkSify,a.ChangeAddress             
FROM  tbl_ControlFileClientLetter a              
FULL OUTER JOIN              
(select * from  tbl_clientdata_record )b           
on a.clientcode=b.clientcode        
left OUTER JOIN              
(select * from intranet.risk.dbo.client_details)d  
on COALESCE(a.ClientCode,b.ClientCode)=d.cl_code  
left outer join           
(select * from tbl_kycupdatedata)c        
on COALESCE(a.ClientCode,b.ClientCode) = c.clientcode    
where d.branch_cd=@branch_cd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.bounce_sifyReport1
-- --------------------------------------------------
CREATE proc bounce_sifyReport1              
(              
 @branch_cd varchar(20)              
)              
              
as               
SELECT d.branch_cd as branch,d.sub_broker as sub_broker,              
COALESCE(a.ClientCode,b.ClientCode) as ClientCode,COALESCE(a.ClientName,b.ClientName) as ClientName,              
b.Mobile1,b.ResPhone1,b.telcaller,b.Remark1,c.NewRemarkBounce,b.EmailID,b.newid, b.minorchangeid,a.mobile,a.ResPhone,a.TCName,b.code1,              
a.remark,c.NewRemarkSify,a.ChangeAddress             
FROM  tbl_ControlFileClientLetter a              
Full OUTER JOIN              
(select * from  tbl_clientdata_record )b           
on a.clientcode=b.clientcode        
left OUTER JOIN              
(select * from intranet.risk.dbo.client_details)d  
on COALESCE(a.ClientCode,b.ClientCode)=d.cl_code  
left outer join           
(select * from tbl_kycupdatedata)c        
on COALESCE(a.ClientCode,b.ClientCode) = c.clientcode         
where d.branch_cd=@branch_cd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CDSL_FILE_UPLOAD
-- --------------------------------------------------
--CDSL_FILE_UPLOAD1 'NSDL','123','DPADM','\\196.1.115.183\d$\upload1\CDSL_CONVERTER\CDSLtoNDSL070313.csv','E43968'        
CREATE PROC CDSL_FILE_UPLOAD(
                                 @UPLOAD_TYPE VARCHAR(25),
                                 @INTER_REFNO BIGINT,
                                 @OPERATORID VARCHAR(20),
                                 @FILE VARCHAR(500),
                                 @UPLOADBY VARCHAR(15)
                             )
AS
BEGIN
INSERT INTO demat.dbo.CDSL_FILE_MASTER
(
 INTER_REFID,
 OPERATOR_ID,
 FILE_LOCATION,
 FLD_UPLOADBY,
 FLD_UPLOADTIME
)
VALUES
(
    @INTER_REFNO,
    @OPERATORID,
    @FILE,
    @UPLOADBY,
    GETDATE()
)
CREATE TABLE #tbl_test
  (
 [Sr. No.]  INT NOT NULL,
 [Client Code] VARCHAR(25),
 [DP Id] VARCHAR(8),
 [Client Id] VARCHAR(16),
 ISIN VARCHAR(12),
 [Scrip Name] VARCHAR(50),
 Quantity NUMERIC(16,3),
 [Our Beneficiary A/c] VARCHAR(16)
 --[FILENAME] VARCHAR(150),
 --UPD_DT DATETIME
  )
--DECLARE @FILE VARCHAR(500)  , @UPLOAD_TYPE VARCHAR(25)
--SET @UPLOAD_TYPE='CDSL'
--SET @FILE='\\172.29.19.10\d$\upload1\CDSL_CONVERTER\CDSLtoCDSL120313.csv'
--DECLARE @QRY VARCHAR(5000)
--SET @QRY='
--BULK
--INSERT #tbl_test
--FROM '''+@FILE+'''
--WITH
--(
--FIELDTERMINATOR = '','',
--ROWTERMINATOR = ''\n'',
--firstrow=2
--)
--'
----PRINT(@QRY)
--EXEC (@QRY)
exec Upload.dbo.usp_XLSU_CDSLuploadfile @FILE
insert into #tbl_test
select * from Upload.dbo.tbl_test
DECLARE @DPID AS VARCHAR(25),@BENFID VARCHAR(16),@CLTCODE VARCHAR(16)
DECLARE @FILENAME AS VARCHAR(150)
SELECT @DPID=LEN([Our Beneficiary A/c]) from #tbl_test
--SELECT @CLTCODE=LEN([Client Id]) from #tbl_test
SELECT @BENFID=[Our Beneficiary A/c] from #tbl_test
 if(@UPLOAD_TYPE='CDSL')
 BEGIN
  --PRINT @DPID
  IF(
 (SELECT COUNT(1) as [Count] from  #tbl_test
        where LEN([Client Id])<>16)>0)
   BEGIN
     SELECT 'CDSL DP ID SHOULD OF 16 DIGITS' AS OUTPUT
 RETURN
   END
  ELSE
   BEGIN
    SELECT @FILENAME='18'+@BENFID+'.'+replace(convert(varchar(11),getdate(),103),'/','')
     +'.'+convert(varchar,DBO.FILLSTRING(ISNULL(FLDSRNO, ''), '0', 3, 0) )
     FROM demat.dbo.CDSL_FILE_MASTER
     WHERE FILE_LOCATION=@FILE
  -- PRINT @FILENAME
  --PRINT @DPID
 SELECT @FILENAME
  END
 END
 ELSE if(@UPLOAD_TYPE='NSDL')
 BEGIN
  --SELECT @DPID =[Our Beneficiary A/c] from  #tbl_test
  --SELECT @DPID=LEN([Our Beneficiary A/c]) from #tbl_test
  --PRINT @DPID
    IF(
 (SELECT COUNT(1) as [Count] from  #tbl_test
        where LEN([Client Id])<>8)>0)
   BEGIN
      SELECT 'NSDL DP ID SHOULD OF 8 DIGITS' AS OUTPUT
   RETURN
   END
  ELSE
 BEGIN
    SELECT @FILENAME='18'+@BENFID+'.'+replace(convert(varchar(11),getdate(),103),'/','')
      +'.'+convert(varchar,DBO.FILLSTRING(ISNULL(FLDSRNO, ''), '0', 3, 0) )
      FROM demat.dbo.CDSL_FILE_MASTER
      WHERE FILE_LOCATION=@FILE
    --PRINT @FILENAME
   -- PRINT @DPID
    SELECT @FILENAME
 END
 END
     INSERT INTO demat.DBO.CDSL_FILE_DETAILS
     ([Sr. No.],[Client Code],[DP Id],[Client Id],ISIN,[Scrip Name],Quantity,[Our Beneficiary A/c],[FILENAME],UPD_DT)
     SELECT *,@FILENAME,GETDATE() FROM #tbl_test
     DECLARE @Count INT ,@OURDPID varchar(16),@FILEEXT VARCHAR(10),@SQL VARCHAR(5000),@HEADER VARCHAR(2000)--,@ISIN VARCHAR(12),QNTY INT
     SELECT @Count= COUNT(*) FROM #tbl_test
     SELECT @OURDPID=[DP Id] from #tbl_test
     SELECT @FILEEXT=convert(varchar,DBO.FILLSTRING(ISNULL(FLDSRNO, ''), '0', 3, 0) ) FROM demat.dbo.CDSL_FILE_MASTER  WHERE FILE_LOCATION=@FILE
     --SELECT convert(varchar,DBO.FILLSTRING('DPADM', ' ', 6,1))+replace(convert(varchar(11),getdate(),103),'/','')
 --SELECT @HEADER=SUBSTRING(@OURDPID, 3, LEN(@OURDPID))+convert(varchar,DBO.FILLSTRING(@OPERATORID,' ',6,1))+convert(varchar,DBO.FILLSTRING(@Count, '0', 6, 0) )+@FILEEXT+replace(convert(varchar(11),getdate(),103),'/','')
 SELECT @HEADER='033200'+convert(varchar,DBO.FILLSTRING(@OPERATORID,' ',6,1))+convert(varchar,DBO.FILLSTRING(@Count, '0', 6, 0) )+@FILEEXT+replace(convert(varchar(11),getdate(),103),'/','')
 if(@UPLOAD_TYPE='CDSL')
  BEGIN
   SELECT @HEADER
   UNION ALL
   SELECT '<Tp>5</Tp>'
        +'<Dt>'+replace(convert(varchar(11),getdate(),103),'/','')+'</Dt>'
        +'<Bnfcry>'+[Our Beneficiary A/c]+'</Bnfcry>'
        +'<CtrPty>'+[Client Id]+'</CtrPty>'
        +'<ISIN>'+ISIN+'</ISIN>'
        +'<Qty>'+CONVERT(VARCHAR,DBO.FILLSTRING(QUANTITY, '0', 5, 1))+'</Qty>'
        +'<Flg>S</Flg>'
        +'<Trf>X</Trf>'
        +'<Rsn>1</Rsn>'
        +'<Ref></Ref>'
        +'<Sttlm></Sttlm>'
        +'<CntrSttlm></CntrSttlm>'
        +'<Arf></Arf>'
       FROM #tbl_test
    --PRINT @SQL
   END
  ELSE if(@UPLOAD_TYPE='NSDL')
   BEGIN
    SELECT @HEADER
    UNION ALL
    SELECT '<Tp>4</Tp>'
        +'<Dt>'+replace(convert(varchar(11),getdate(),103),'/','')+'</Dt>'
        +'<Bnfcry>'+[Our Beneficiary A/c]+'</Bnfcry>'
        +'<ISIN>'+ISIN+'</ISIN>'
        +'<Qty>'+CONVERT(VARCHAR,DBO.FILLSTRING(QUANTITY, '0', 5, 1))+'</Qty>'
        +'<Flg>S</Flg>'
        +'<Trf>X</Trf>'
        +'<Clnt>'+[Client Id]+'</Clnt>'
        +'<Brkr>'+[DP Id]+'</Brkr>'
        +'<Sttlm></Sttlm>'
        +'<Ref></Ref>'
        +'<Arf></Arf>'
        FROM #tbl_test
   -- PRINT @SQL
   END
 --SELECT @HEADER
 --UNION ALL
 --SELECT @SQL
 --PRINT (@SQL)
   -- EXEC (@SQL)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CLIENT_LIMIT_UPLOAD_DELETE
-- --------------------------------------------------
 CREATE PROCEDURE CLIENT_LIMIT_UPLOAD_DELETE(@extract_file as varchar(25))  
AS  
  
SET NOCOUNT ON  
  
--declare @extract_file as varchar(25)     
--set @extract_file='NEW_SNEHAL.TXT'    
       
          
declare @sql3 as varchar(500),@path as varchar(100)  
  
select  @path=uploadserver from [CSOKYC-6].upload.dbo.global_upload where upd_srno=1          
 set @sql3='exec MASTER.dbo.xp_cmdshell ''del '+@path+'LIMIT\'+@extract_file+''''          
--print @sql3          
exec (@sql3)  
  
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CLIENT_LIMIT_UPLOAD_EXTRACT
-- --------------------------------------------------
CREATE PROCEDURE CLIENT_LIMIT_UPLOAD_EXTRACT(@filename as varchar(25))  
AS  
  
SET NOCOUNT ON  
  
--declare @filename as varchar(25)     
--set @filename='NEW_SNEHAL.zip'    
       
          
declare @sql1 as varchar(500),@path as varchar(100)          
         
                   
select  @path=uploadserver from [CSOKYC-6].upload.dbo.global_upload where upd_srno=1          
set @sql1 ='EXEC master..xp_cmdshell '''+@path+'limit\pkunzip.exe ' +@path +'limit\'+@filename+' '+@path+'limit'''          
--print @sql1          
exec (@sql1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Client_list_Akruti65
-- --------------------------------------------------
CREATE procedure Client_list_Akruti65
(
@filename as varchar(35),
@server as varchar(10),
@access_code as varchar(10)
)
as

delete from intranet.mis.dbo.tblCTCLDietClientList  where server=@server

insert into intranet.mis.dbo.tblCTCLDietClientList 

select party_code=[user id],GroupID=[Group id],PartyName=[username],category,status,
TradingAllowed=[trading allowed],AliasDealerId=[alias dealerid],branch_cd=@access_code,
server=@server
from temp_Akruti65 

truncate table temp_Akruti65

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CMSMails_Log_Online
-- --------------------------------------------------

CREATE Proc CMSMails_Log_Online
as

declare @ProcessDate datetime
select @ProcessDate = max(Updated_Date) from tbl_CMSMails_Log

Select MAX(Updated_Date) Updated_Date, PARTY_CODE = (SELECT COUNT(*) FROM tbl_CMSMails_Log WHERE convert(varchar(11), @ProcessDate) = convert(varchar(11), Updated_Date)),
EMAIL = (SELECT COUNT(*) FROM tbl_CMSMails_Log WHERE EMAIL <> '' and convert(varchar(11), @ProcessDate) = convert(varchar(11), Updated_Date)),
MOBILE_PAGER = (SELECT COUNT(*) FROM tbl_CMSMails_Log WHERE MOBILE_PAGER <> '' and convert(varchar(11), @ProcessDate) = convert(varchar(11), Updated_Date))
from tbl_CMSMails_Log

GO

-- --------------------------------------------------
-- PROCEDURE dbo.commModifyVIRequest
-- --------------------------------------------------
create procedure commModifyVIRequest
(
@ModID nvarchar(15),
@Pi_No nvarchar(15),
@ReqID nvarchar(15),
@ItemID varchar(20),
@ItemName varchar(50),
@UserNote varchar(80),
@HodNote varchar(80),
@ModBy varchar(10),
@ModDate datetime,
@Note varchar(80),
@CompleteByDate varchar(25),
@qty int,
@stat varchar(4),
@modtype int
)
as

update UserVIRequest set ItemID = @ItemID, ItemName = @ItemName, UserNote = @UserNote, HodNote=@HodNote,commnote = @note, Qty=@qty,CompleteByDate = @CompleteByDate, Pi_No = @Pi_No, ReqStatusCode = @stat where ReqID = @ReqID
insert into ModifiedVIRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@Note,@ModBy,@ModDate,@CompleteByDate,@stat,@modtype)
update ProcessIncharge set Emp_no = @Pi_no where reqid = @reqid 
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.createNVIRequest
-- --------------------------------------------------
CREATE procedure createNVIRequest
(
@ReqID nvarchar(15),
@ItemID varchar(20),
@CatID varchar(20),
@ItemName varchar(50),
@CategoryName varchar(50),
@UserNote varchar(80),
@ReqDate datetime,--varchar(50),
@CompleteByDate varchar(25),
@Emp_no varchar(10),
@Hod_no varchar(10),
--@Pi_no varchar(10),
@Qty int,
@ModID varchar(25),
@stat varchar(4)
)
as
Declare @Pi as Varchar(10)
set @Pi = (select Emp_No from ProcessIncharge where hod_no=@hod_no)

insert into UserRequest values (@ReqID,@ItemID,@CatID,@ItemName,@CategoryName,@UserNote,'',@stat,@ReqDate,@CompleteByDate,'','no',@Emp_no,@Hod_no,@Pi,@qty,'')
insert into ModifiedRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@UserNote,@Emp_no,@ReqDate,@CompleteByDate,@stat,0)
--insert into ProcessIncharge values (@Pi_no, @hod_no , @reqID)
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.createVIRequest
-- --------------------------------------------------
create procedure createVIRequest
(
@ReqID nvarchar(15),
@ItemID varchar(20),
@CatID varchar(20),
@ItemName varchar(50),
@CategoryName varchar(50),
@UserNote varchar(80),
@ReqDate datetime,
@CompleteByDate varchar(25),
@Emp_no varchar(10),
@Hod_no varchar(10),
@Pi_no varchar(10),
@qty int,
@ModID nvarchar(25),
@stat varchar(4)
)
as
insert into UserVIRequest values (@ReqID,@ItemID,@CatID,@ItemName,@CategoryName,@UserNote,'',@stat,@ReqDate,@CompleteByDate,'','no',@Emp_no,@Hod_no,@Pi_no,'',@qty)
insert into ModifiedVIRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@UserNote,@Emp_no,@ReqDate,@CompleteByDate,@stat,0)
insert into ProcessIncharge values (@Pi_no, @hod_no , @reqID)
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CSV_UPLOAD
-- --------------------------------------------------
CREATE proc CSV_UPLOAD              
(          
@filename as varchar(100)          
)           
as              
set transaction  isolation  level read uncommitted              
declare @path as varchar(100)    
declare @sql as varchar(1000)          
truncate table Penalty    
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename          
SET @SQL = 'BULK INSERT Self_Auction_duplicate FROM '''+@Path+''' WITH (FirstRow=2,KeepNULLS)'          
-- print @SQL          
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DBA_ConvertQueryInHTML
-- --------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE proc [dbo].[DBA_ConvertQueryInHTML] 
(@OBJECTNAME1 varchar(max),@HTMLBODY varchar(max) OUTPUT)
as
 
SET NOCOUNT ON 
 
DECLARE @CREATETABLE nvarchar(max)
--DECLARE @XMLQUERY2 nvarchar (max)
DECLARE @NAME varchar(max)
DECLARE @TEMPVAR nvarchar(max)
DECLARE @NEWCOLUMN nvarchar(max)
DECLARE @BODY nvarchar(max)
DECLARE @RETURNSTR2 nvarchar(max)
 
IF EXISTS
(SELECT 1 FROM sys.objects with (nolock) 
 where OBJECT_ID = OBJECT_ID('DBA_TempHTML') AND type = ('U'))
 
DROP TABLE DBA_TempHTML
 
SET @CREATETABLE ='select * into DBA_TempHTML from ( '+''+ @OBJECTNAME1+')A '
EXECUTE sp_executesql @CREATETABLE
 
DECLARE c1 CURSOR READ_ONLY
FOR select 'Column_name'= name from sys.all_columns 
where object_id = (select object_id from sys.all_objects 
                  where object_id = object_id('DBA_TempHTML'))
 
OPEN c1
 
      SET @NEWCOLUMN='' 
      SET @TEMPVAR=''
 
      FETCH NEXT FROM c1
      INTO @NAME
 
      WHILE @@FETCH_STATUS = 0
      BEGIN
            SET @NEWCOLUMN =@NEWCOLUMN+'<th bgcolor="#FFFF33">'+@NAME +'</th>'
            SET @TEMPVAR = @TEMPVAR+ 'cast('+@NAME +' as varchar(MAX) )'+'+' + '''</td><td>''' +'+'
 
            FETCH NEXT FROM c1
            INTO @NAME
      END
 
CLOSE c1
DEALLOCATE c1 
 
SET @TEMPVAR=LEFT (@TEMPVAR, LEN(@TEMPVAR)-13)
SET @BODY=' select cast( (select td = '+@TEMPVAR+ ' from (SELECT top 100 percent * FROM DBA_TempHTML order by 1 desc) as d '+' for xml path(''tr''), type) as varchar(max))'
--print@BODY
 
CREATE TABLE #TEMP (RETURNSTR nvarchar (max))
INSERT into #TEMP
exec sp_executesql @BODY
 
select @RETURNSTR2=LTRIM(RTRIM(RETURNSTR)) from #temp
 
SET @HTMLBODY = '<table cellpadding="1" cellspacing="1" border="1">'
            + '<tr>'+''+@NEWCOLUMN+ ''+'</tr>'
            + replace( replace( @RETURNSTR2, '&lt;', '<' ), '&gt;', '>')
            + '</table>'
 
--select @HTMLBODY
DROP TABLE #TEMP
DROP TABLE DBA_TempHTML

GO

-- --------------------------------------------------
-- PROCEDURE dbo.disp_req
-- --------------------------------------------------
create procedure disp_req
(
@uno as varchar(25),
@reqCode as varchar(5)
)
as

select a.ReqID, a.ItemName, a.CategoryName, b.ReqStatusName,a.Emp_No,a.CompleteByDate, a.reqStatusCode from UserRequest a,
ReqStatus b where a.Hod_no =@uno AND a.ReqStatusCode = b.ReqStatusCode AND a.ReqStatusCode=@reqCode order by a.ReqStatusCode 

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DP57_PLEDGEPROCESS
-- --------------------------------------------------
CREATE PROC DP57_PLEDGEPROCESS          
as          
set nocount on     
  
insert into DP57_processtime    
select GETDATE()         
 --PLEDGE          
 /*inserting Pledge details in master table from dp 57 file which are confirmed from CDSLs*/          
/*transaction type pledge 8 and transaction status 810 means confirmed from cdsl*/          
          
insert into Pledge_Unpledge_Master          
select holdindatetime,bo_id,pledgee_bo_id,x.isin,y.Scripname,transaction_id,pledgedate,quantity,unpledgeqty,balance,oldpsn_corp from          
(select holdindatetime=GETDATE(),bo_id,pledgee_bo_id,isin,transaction_id,pledgedate=stuff(last_modification_date,9,0,':'),          
quantity=convert(int,quantiy),unpledgeqty=0,balance=convert(int,quantiy),oldpsn_corp=parent_psn           
 from tbl_tempPledgeRelease where transaction_type=8 and transaction_status=810          
 and  transaction_id not in(select pledgeorder from Pledge_Unpledge_Master with (nolock))           
and bo_id in (SELECT distinct ACCNO FROM   [CSOKYC-6].GENERAL.DBO.TBL_LAS_BANK_AGREEMENT_MASTER WITH(NOLOCK)))x          
left outer join  [CSOKYC-6].general.dbo.Scrip_master y With(NOLOCK) On x.Isin = y.Isin            
          
/*inserting in the master table for 809 approved by cdsl*/          
insert into Pledge_Unpledge_Master          
select holdindatetime,bo_id,pledgee_bo_id,x.isin,y.Scripname,transaction_id,pledgedate,quantity,unpledgeqty,balance,oldpsn_corp from          
(          
select holdindatetime=GETDATE(),bo_id,pledgee_bo_id,isin,transaction_id,pledgedate=stuff(last_modification_date,9,0,':'),          
quantity=convert(int,quantiy),unpledgeqty=0,balance=convert(int,quantiy),oldpsn_corp=parent_psn           
 from tbl_tempPledgeRelease where transaction_type=8 and transaction_status=809          
 and  transaction_id not in(select pledgeorder from Pledge_Unpledge_Master with (nolock))           
and bo_id in (SELECT distinct ACCNO FROM   [CSOKYC-6].GENERAL.DBO.TBL_LAS_BANK_AGREEMENT_MASTER WITH(NOLOCK))          
)x          
left outer join  [CSOKYC-6].general.dbo.Scrip_master y With(NOLOCK) On x.Isin = y.Isin            
/*transferred due to auto ca hence updating the balance 813*/          
update Pledge_Unpledge_Master set unpledgeqty=pledgeqty,balance=0,holdingdatetime=GETDATE()          
from (select transaction_id,isin          
 from tbl_tempPledgeRelease where transaction_type=8 and transaction_status =813)b          
 where Pledge_Unpledge_Master.pledgeorder=b.transaction_id and Pledge_Unpledge_Master.isin=b.isin          
 and clientid in (SELECT distinct ACCNO FROM   [CSOKYC-6].GENERAL.DBO.TBL_LAS_BANK_AGREEMENT_MASTER WITH(NOLOCK))          
           
  /*closed due to auto ca hence updating the balance 814*/          
 delete from Pledge_Unpledge_Master where exists          
 (select transaction_id,isin from tbl_tempPledgeRelease b where transaction_type=8 and transaction_status =814          
 and  Pledge_Unpledge_Master.pledgeorder=b.transaction_id and Pledge_Unpledge_Master.isin=b.isin)          
 and clientid in (SELECT distinct ACCNO FROM   [CSOKYC-6].GENERAL.DBO.TBL_LAS_BANK_AGREEMENT_MASTER WITH(NOLOCK))          
          
--UNPLEDGE          
/*updating the unpledge value and balance 10 and 1002*/          
 update pledge_Unpledge_Master set unpledgeqty=unpledgeqty+b.quantity,balance=balance-b.quantity,holdingdatetime=GETDATE()          
 from            
(select Transaction_Id,quantity=convert(int,SUM(quantiy)),isin  from  tbl_tempPledgeRelease where transaction_type=10          
 and transaction_status =1002          
 and bo_id in (SELECT distinct ACCNO FROM   [CSOKYC-6].GENERAL.DBO.TBL_LAS_BANK_AGREEMENT_MASTER WITH(NOLOCK))          
 group by Transaction_Id,isin           
 )b where Pledge_Unpledge_Master.pledgeorder=b.transaction_id and Pledge_Unpledge_Master.isin=b.isin          
         
update pledge_Unpledge_Master set sc_isinname=y.Scripname from      
(select * from [CSOKYC-6].general.dbo.Scrip_master With(NOLOCK)) y  where pledge_Unpledge_Master.Isin = y.Isin        
  
      
 exec demat.dbo.PledgeModule_Data        
           
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DP57_UploadRpt
-- --------------------------------------------------
Create Proc DP57_UploadRpt
(
@access_to varchar(20),
@access_code varchar(20)
)
as
set nocount on
select * from tbl_tempPledgeRelease where Transaction_Type in (8,10)
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DPAgeing_Uploadcsv
-- --------------------------------------------------
  
            
--exec DPAgeing_Uploadcsv '30 Ageing_CDSL_20130330 CLUBBEDV1.CSV'          
              
CREATE PROCEDURE [DBO].[DPAGEING_UPLOADCSV]                    
(                          
@FILENAME VARCHAR(100)                      
--@USERNAME VARCHAR(15)                          
)                          
AS                        
                    
SET NOCOUNT ON                    
                    
DECLARE                    
 @STR  VARCHAR(2000),                    
 @PATH  VARCHAR(200)                        
           
BEGIN  TRY                        
 DELETE FROM MIS.DEMAT.DBO.DPAGEING_RPT                          
  --ADDED 30/11/2012                        
           
 SELECT           
 @PATH = UPLOADSERVER           
 FROM           
 [CSOKYC-6].UPLOAD.DBO.GLOBAL_UPLOAD           
 WHERE           
 UPD_SRNO=37                  
           
 SET @PATH=@PATH+@FILENAME                      
              print @path          
                         
 SET @STR='BULK INSERT DPAGEING_UPLOADTEMP  FROM '''+@PATH+ ''' WITH(FIELDTERMINATOR='','', FIRSTROW=3,KEEPNULLS)'                 
 EXEC (@STR)                        
   --TILL HERE END 30/11/2012               
 PRINT @PATH                        
           
INSERT INTO MIS.DEMAT.DBO.DPAGEING_RPT                          
  (ACCOUNTCODE,ACCOUNTDESC,[0_30DAYS],[31_60DAYS],[61_90DAYS],[91_120DAYS],                          
  [121_180DAYS],[181_240DAYS],[240_360DAYS],[>360DAYS],TOTAL,UPLOADEDBY,UPLOADEDON)                           
  SELECT ACCOUNTCODE,ACCOUNTDESC,[0_30DAYS],[31_60DAYS],[61_90DAYS],[91_120DAYS],[121_180DAYS],[181_240DAYS],[240_360DAYS],[>360DAYS],[TOTAL],UPLOADEDBY=NULL,UPLOADEDON=GETDATE()        
FROM           
 DPAGEING_UPLOADTEMP                          
           
                          
          
TRUNCATE TABLE DPAGEING_UPLOADTEMP                        
          
                         
END TRY                    
          
BEGIN CATCH                    
DECLARE                     
  @ERRORNUMBER VARCHAR(200),                    
  @ERRORMESSAGE VARCHAR(4000),                    
  @ERRORSEVERITY INT,                    
  @ERRORSTATE INT,                    
  @ERRORDATETIME DATETIME                    
          
 SET @ERRORNUMBER =ERROR_NUMBER()                    
 SET @ERRORMESSAGE=ERROR_MESSAGE()                    
 SET @ERRORSEVERITY=ERROR_SEVERITY()                    
 SET @ERRORSTATE=ERROR_STATE()                    
 SET @ERRORDATETIME=GETDATE()                    
                     
 INSERT INTO DPAGEING_ERRORLOG                    
 SELECT           
  @ERRORNUMBER AS ERRORNUMBER,           
  @ERRORMESSAGE AS ERRORMESSAGE,           
  @ERRORSEVERITY AS ERRORSEVERITY,           
  @ERRORSTATE AS ERRORSTATE,           
  @ERRORDATETIME AS ERRORDATETIME                     
                      
 RAISERROR(@ERRORMESSAGE, @ERRORSEVERITY,@ERRORSTATE);                    
END CATCH                    
                     
SET NOCOUNT  OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DPAgeing_Uploadcsvfile
-- --------------------------------------------------
CREATE Procedure [dbo].[DPAgeing_Uploadcsvfile]    
(          
@FileName varchar(45)              
)          
AS        
    
SET NOCOUNT ON      
BEGIN  TRY        
       
 insert into mis.demat.dbo.DPAgeing_Rpt          
 (AccountCode,AccountDesc,[0_30Days],[31_60Days],[61_90Days],[91_120Days],          
 [>121Days],Total,Uploadedby,Uploadedon)           
 select AccountCode,AccountDesc,[0_30Days],[31_60Days],[61_90Days],[91_120Days],[>121Days],Total,uploadedby=null,         
 uploadedby=getdate()          
  from DPAgeing_UploadTemp          
 set nocount on          
 truncate table DPAgeing_UploadTemp        
 set nocount off          
END TRY    
BEGIN CATCH    
    
Declare     
 @ErrorNumber varchar(200),    
 @ErrorMessage varchar(4000),    
 @ErrorSeverity int,    
 @ErrorState int,    
 @ErrorDateTime datetime    
     
     
 set @ErrorNumber =ERROR_NUMBER()    
 set @ErrorMessage=ERROR_MESSAGE()    
 set @ErrorSeverity=ERROR_SEVERITY()    
 set @ErrorState=ERROR_STATE()    
 set @ErrorDateTime=GETDATE()    
     
 insert into dpageing_errorlog    
 select @ErrorNumber as ErrorNumber, @ErrorMessage as ErrorMessage, @ErrorSeverity as ErrorSeverity, @ErrorState as ErrorState, @ErrorDateTime as ErrorDateTime     
     
  RAISERROR(@ErrorMessage, @ErrorSeverity,@ErrorState);    
 End Catch    
     
 Set nocount  off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dtc_csv_upload
-- --------------------------------------------------
      
CREATE  procedure dtc_csv_upload(@filename as varchar(25),@location as varchar(11),@path as varchar(18))              
as              
              
set nocount on              
              
              
declare @sql1 as varchar(500),@extract_file as varchar(25)              
declare @sql2 as varchar(500),@sql3 as varchar(300)              
          
              
SELECT top 0 Dealer,Party_Code           
into #file1           
from CTCL_DTCx (nolock)              
              
--set @sql2='BULK INSERT #file1 FROM '''+@path +'\D$\Upload1\ft\'+@extract_file+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'              
set @sql2='BULK INSERT #file1 FROM ''\\'+@path+'\D$\ServerSurveillance\'+@location+'\'+convert(varchar(10),getdate(),112)+'\RM\IN\'++'\'+@filename+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'     
exec (@sql2)            
              
update #file1 set party_code=replace(ltrim(rtrim(party_code)),char(32),'')              
update #file1 set dealer=replace(ltrim(rtrim(dealer)),char(32),'')              
              
delete from #file1 where party_code='' or party_Code ='------'              
              
delete from CTCL_DTCx where location=@location              
              
insert into CTCL_DTCx select *,location=@location,getdate() from #file1              
              
              
exec intranet.testdb.dbo.DTCUpload_opt @location               
              
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dtc_csv_upload_
-- --------------------------------------------------
CREATE  procedure dtc_csv_upload_(@filename as varchar(25),@location as varchar(11))          
as          
          
set nocount on          
          
--declare @filename as varchar(25)      
--set @filename='snehal.zip'            
          
declare @sql1 as varchar(500),@path as varchar(100),@filepath as varchar(100),@extract_file as varchar(25)          
declare @sql2 as varchar(500),@sql3 as varchar(300)          
      
        
set @extract_file=replace(@filename,'.zip','.txt')      
          
--print @extract_file          
          
select  @path=uploadserver from [CSOKYC-6].upload.dbo.global_upload where upd_srno=1          
select  @filepath=uploadserver from [CSOKYC-6].upload.dbo.global_upload where upd_srno=2          
set @sql1 ='EXEC master..xp_cmdshell '''+@path+'limit\pkunzip.exe ' +@filepath +'ft\'+@filename+' '+@filepath+'ft'''          
--print @sql1          
exec (@sql1)        
          
--EXEC master..xp_cmdshell '\\INHOUSELIVEAPP2-FS.angelone.in\D$\Upload\limit\pkunzip.exe \\INHOUSELIVEAPP2-FS.angelone.in\D$\Upload1\ft\snehal.zip \\INHOUSELIVEAPP2-FS.angelone.in\D$\Upload1\ft'          
          
          
SELECT top 0 Dealer,Party_Code       
into #file1       
from CTCL_DTCx (nolock)          
          
set @sql2='BULK INSERT #file1 FROM '''+@filepath +'ft\'+@extract_file+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'          
exec (@sql2)        
          
update #file1 set party_code=replace(ltrim(rtrim(party_code)),char(32),'')          
update #file1 set dealer=replace(ltrim(rtrim(dealer)),char(32),'')          
          
delete from #file1 where party_code='' or party_Code ='------'          
          
delete from CTCL_DTCx where location=@location          
          
insert into CTCL_DTCx select *,location=@location,getdate() from #file1          
          
           
          
set @sql3='exec MASTER.dbo.xp_cmdshell ''del '+@filepath+'ft\'+@extract_file+''''          
--print @sql3          
exec (@sql3)          
--exec MASTER.dbo.xp_cmdshell 'del \\INHOUSELIVEAPP2-FS.angelone.in\D$\Upload1\ft\snehal.txt'          
          
          
--delete from intranet.testdb.dbo.CTCL_DTC where location=@location          
--insert into intranet.testdb.dbo.CTCL_DTC select * from mis.upload.dbo.CTCL_DTCx where location=@location          
--          
          
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ebrok_terminal
-- --------------------------------------------------
CREATE procedure ebrok_terminal (@from_Date as varchar(25), @to_date as varchar(25))
as

set nocount on


select segment,terminal_id,servermapped
into #terminal
from mis.remisior.dbo.ebrok_terminal_master where from_Date<=@from_Date
and to_date>=@to_date

select company,terminal_id,party_code,turnover=sum(turnover),brokerage=sum(brokerage) 
into #Jun_162009
from Intranet.bsedb_ab.dbo.mis_to
where sauda_date>=@from_date
and sauda_date<=@to_Date
group by company,terminal_id,party_code

select  a.*,b.servermapped into #ebrok from #Jun_162009 a
join 
#terminal b
on a.company=replace(b.segment,'ACPLNCDX','ACPLNCDEX') and a.terminal_id=b.terminal_id

select * from #ebrok
order by servermapped,company,party_code

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ebrok_training
-- --------------------------------------------------
CREATE proc dbo.ebrok_training  (@filename as varchar(25))   
as   
set nocount on  
select party_code,trainingdate into #f from ebrok_training_temp  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ebrok_untrained
-- --------------------------------------------------
CREATE proc dbo.ebrok_untrained  (@filename as varchar(25))     
as     
set nocount on    
select party_code,ebrokingdate into #f from ebrok_untrained_temp    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Emer_DTV_Upload
-- --------------------------------------------------
  
CREATE procedure [dbo].[Emer_DTV_Upload](@filename as varchar(25),@locacode as varchar(25))      
as      
  
exec [196.1.115.245].test.dbo.DTC_CSV_Unzip @filename  
     
      
SELECT top 0 Dealer,Party_Code into #file1 from CTCL_DTCx (nolock)      
/* BULK INSERT #file1 FROM '\\196.1.115.183\d$\Upload1\ft\'+@filename WITH ( FIELDTERMINATOR=',',FIRSTROW=1,KEEPNULLS)*/      
declare @str as varchar(1000)      
  
set @filename=REPLACE(@filename,'.ZIP','.TXT')  
      
set @str='BULK INSERT #file1 FROM ''\\INHOUSELIVEAPP2-FS.angelone.in\d$\Upload1\ft\'+@filename+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'      
exec(@str)      
      
      
update #file1 set party_code=replace(ltrim(rtrim(party_code)),char(32),'')      
update #file1 set dealer=replace(ltrim(rtrim(dealer)),char(32),'')      
delete from #file1 where party_code='' or party_Code ='------'      
    
      
--delete from CTCL_DTCx where location=@locacode   
     
--insert into CTCL_DTCx select *,location=@locacode,getdate() from #file1      
    
    
delete from intranet.testdb.dbo.CTCL_DTC where location=@locacode      
--insert into intranet.testdb.dbo.CTCL_DTC select * from mis.upload.dbo.CTCL_DTCx where location=@locacode      
insert into intranet.testdb.dbo.CTCL_DTC(Dealer,Party_Code,Location,Last_updated) select *,location=@locacode,getdate() from #file1  
  
drop table #file1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.EXCEL_UPLOAD
-- --------------------------------------------------
CREATE PROC EXCEL_UPLOAD    
(    
 @filename as varchar(100)      
)    
AS    
declare @path as varchar(100)                        
declare @sql as varchar(1000)                     
-- set @filename = 'IT_Events'                
truncate table penalty              
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\'+  @filename    
SET @SQL = 'insert into penalty select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'     
--print @SQL    
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.exchange_emailid
-- --------------------------------------------------
CREATE procedure exchange_emailid (@filename as varchar(25))
AS

GO

-- --------------------------------------------------
-- PROCEDURE dbo.gen_report
-- --------------------------------------------------
create proc gen_report

@emp_no  varchar(15)

as
select itemid,sum(qty) as sum  into #tempabc from userrequest  where emp_no=@emp_no group by itemid


select b.itemid,a.sum,b.itemname from #tempabc a,inventoryitem b where b.itemid in(select itemid from #tempabc)
and a.itemid=b.itemid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.gen_report1
-- --------------------------------------------------
CREATE proc gen_report1      
(    
@emp_no  varchar(15),    
--@option varchar(10),  
@frmdate varchar(20),  
@todate varchar(20)     
)      
as    
    
  
--if @option = 'EMP'    
--BEGIN      
select itemid,sum(qty) as sum  into #tempabc from userrequest where emp_no=@emp_no 
and (reqdate>=@frmdate+' 00:00:00' and reqdate<=@todate+' 23:59:59')  
and (reqstatuscode=0 or reqstatuscode=1 or reqstatuscode=2)
group by itemid  

select b.itemid,a.sum,b.itemname from #tempabc a,inventoryitem b     
where b.itemid in(select itemid from #tempabc) and a.itemid=b.itemid 


RETURN

GO

-- --------------------------------------------------
-- PROCEDURE dbo.generate_po
-- --------------------------------------------------
create proc generate_po
@poID as varchar(50)
as
truncate table temptbl1
insert into temptbl1 
select sum(TotalQty), itemid from order_queue where orderid in (select orderid from purchase_order_queue where purchase_id=@poID) group by itemid
---select * from temptbl1

select * from  temptbl1 a
left outer join 
(select itemname,rate,vat,itemid from inventoryItem where itemid in (select itemid from temptbl1)) b
on a.itemid = b.itemid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.get_hodReqList
-- --------------------------------------------------
CREATE procedure get_hodReqList(@hod_no as varchar(25),@code as varchar(10), @code1 as varchar(10))        
as  
set transaction isolation level read uncommitted        
set nocount on        

--Declare 
--@hod_no as varchar(25),
--@code as varchar(10),
--@code1 as varchar(10)
--set @hod_no ='E01089'
--set @code = '2'
--set @code1=''
  
select a.itemID,a.ItemNAme,a.CategoryName,a.Qty,b.ReqStatusName into #allReq   
from UserRequest a,ReqStatus b where hod_no = @hod_no and (a.ReqStatusCOde =@code or a.ReqStatusCOde =@code1)  
and a.ReqStatusCode = b.ReqStatusCode  
order by a.Itemname  
  
select distinct ItemID, Itemname,CategoryName,ReqStatusName into #DistWOQty from #allReq order by itemname  
  
--select * from #DistWOQty   
select itemName,sum(Qty) as 'Qty' into #DistWQty from #allReq group by itemName order by itemname   
--select * from #DistWQty  
  
select a.ItemID,a.Itemname,a.CategoryName,a.ReqStatusName,b.Qty from #DistWOQty a left outer join  #DistWQty  b   
on a.Itemname = b.ItemName  
  
--drop table #allreq  
--drop table #DistWOQty  
--drop table #DistWQty  
--select * from #allReq  
  
set nocount off    
  return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.get_ReqsDetail
-- --------------------------------------------------
create procedure get_ReqsDetail(@hod_no as varchar(25),@code as varchar(10),@itmID as varchar(25))      
as
set transaction isolation level read uncommitted      
set nocount on      

select a.itemID,a.ItemNAme,a.CategoryName,a.Qty,b.ReqStatusName,a.pi_no,a.CatID into #allReq 
from UserRequest a,ReqStatus b where hod_no = @hod_no and a.ReqStatusCOde =@code 
and a.ReqStatusCode = b.ReqStatusCode and a.ItemID=@ItmID
order by ItemName

select distinct ItemID, Itemname,CategoryName,ReqStatusName,Pi_no,Catid into #DistWOQty from #allReq order by itemname

--select * from #DistWOQty 
select itemName,sum(Qty) as 'Qty' into #DistWQty from #allReq group by itemName order by itemname 
--select * from #DistWQty

select a.ItemID,a.Itemname,a.CategoryName,a.ReqStatusName,b.Qty,a.Pi_no,a.Catid from #DistWOQty a left outer join  #DistWQty  b 
on a.Itemname = b.ItemName

--drop table #allreq
--drop table #DistWOQty
--drop table #DistWQty
--select * from #allReq

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.HodmodifyNVIRequest
-- --------------------------------------------------
CREATE procedure HodmodifyNVIRequest
(
@ModID nvarchar(15),
@Pi_No nvarchar(15),
@ReqID nvarchar(15),
@ItemID varchar(20),
@ItemName varchar(50),
@UserNote varchar(80),
@HodNote varchar(80),
@ModBy varchar(10),
@ModDate datetime,--varchar(50),
@Note varchar(80),
@CompleteByDate varchar(25),
@qty int,
@stat varchar(4),
@modtype int,
@ordID varchar(50)
)
as

update UserRequest set ItemID = @ItemID, ItemName = @ItemName, UserNote = @UserNote, HodNote=@HodNote,Qty=@qty,CompleteByDate = @CompleteByDate, Pi_No = @Pi_No,ReqStatusCode = @stat,orderID=@ordID where ReqID = @ReqID

insert into ModifiedRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@Note,@ModBy,@ModDate,@CompleteByDate,@stat,@modtype)

update ProcessIncharge set Emp_no = @Pi_no where reqid = @reqid 

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.HodmodifyVIRequest
-- --------------------------------------------------
create procedure HodmodifyVIRequest
(
@ModID nvarchar(15),
@Pi_No nvarchar(15),
@ReqID nvarchar(15),
@ItemID varchar(20),
@ItemName varchar(50),
@UserNote varchar(80),
@HodNote varchar(80),
@ModBy varchar(10),
@ModDate datetime,
@Note varchar(80),
@CompleteByDate varchar(25),
@qty int,
@stat varchar(4),
@modtype int
)
as

update UserVIRequest set ItemID = @ItemID, ItemName = @ItemName, UserNote = @UserNote, HodNote=@HodNote,Qty=@qty,CompleteByDate = @CompleteByDate, Pi_No = @Pi_No, ReqStatusCode = @stat where ReqID = @ReqID
insert into ModifiedVIRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@Note,@ModBy,@ModDate,@CompleteByDate,@stat,@modtype)
update ProcessIncharge set Emp_no = @Pi_no where reqid = @reqid 
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.I_HE_IDonExchngS
-- --------------------------------------------------
CREATE Procedure I_HE_IDonExchngS(@access_to varchar(20),@access_code varchar(20))
AS
declare @status as varchar(11)
select e.emp_name [Emp. Name],t.emp_emailid [Emp ID in Exchange Server],Status='Inactive'
from tbl_exchange_details_temp t
join
intranet.risk.dbo.emp_info e
on t.emp_name=e.emp_name
 where e.status<>'A'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.insert_illscrip
-- --------------------------------------------------
CREATE Procedure insert_illscrip (@filename as varchar(25))
as
delete from intranet.misc.dbo.illScrip 
insert into intranet.misc.dbo.illScrip select * from illScrip_Month_Temp
delete from illScrip_Month_Temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.insert_Nse_illscrip
-- --------------------------------------------------

CREATE procedure insert_Nse_illscrip (@filename as varchar(25))
as
delete from intranet.misc.dbo.illScrip_nse
insert into intranet.misc.dbo.illScrip_nse select * from illScrip_Nse_Month_Temp 
delete from illScrip_Nse_Month_Temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.insertReq2
-- --------------------------------------------------
create procedure insertReq2
as 
declare 
@ireq nvarchar(50),
@name char(10),
@no int

set @no = (select count(name) from temp)
set @no = @no + 1
set @ireq = @no

insert into temp(ireq,name) values(@ireq,'sl')

return(0)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MCDX_MARGIN_FALIUREMAIL
-- --------------------------------------------------
/*Prepared by: Vasudha
PRMS ID: 
Request by: Vishal Kachalia
Approved by: Sneha Kolhi 
*/
CREATE PROCEDURE MCDX_MARGIN_FALIUREMAIL 
AS   
SET NOCOUNT ON    
  
BEGIN  
DECLARE @date varchar(11)
SELECT @date=CONVERT(Varchar(11),MAX(upd_date),103) from MCX_Margin
--PRINT @date
 
if(@date<>CONVERT(Varchar(11),getdate(),103))
      BEGIN
            EXEC MCDX_MARGIN_MAIL 'FAIL'
      END
ELSE 
      BEGIN
            PRINT 'SUCCESS'
      END
END
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MCDX_MARGIN_MAIL
-- --------------------------------------------------

  
CREATE PROCEDURE MCDX_MARGIN_MAIL(@STATUS Varchar(30))      
AS       
SET NOCOUNT ON        
      
BEGIN    
    
  DECLARE @date Varchar(30),@time Varchar(30),@email varchar(500),@SUB Varchar(50),@ATTACH VARCHAR(200),    
  @MAILBODY   VARCHAR(500),@RECP varchar(500)    
  SET @date=convert(char(10), getdate(), 101)    
  SET @time= convert(varchar(20),GETDATE(),108)+ ' ' +right(convert(varchar(30),GETDATE(),109),2)      
  PRINT @date      
  PRINT @time    
   
  CREATE TABLE #FILE  
  (  
   emailName VARCHAR(500)   
  )  
  -- finally, execute and insert into our table  
  INSERT INTO #FILE  
  (  
   emailName  
  )  
  EXEC INTRANET.MISC.DBO.SP_GET_GLOBAL_EMAIL [Commodity margin],'BCC','S'  
    
   SELECT @email= emailName FROM #FILE   
     
   CREATE TABLE #RECPFILE  
   (  
    RECPNAME VARCHAR(500)   
   )  
   -- finally, execute and insert into our table  
   INSERT INTO #RECPFILE  
   (  
    RECPNAME  
   )  
    EXEC INTRANET.MISC.DBO.SP_GET_GLOBAL_EMAIL [Commodity margin],'TO','S'  
    
   SELECT @RECP= RECPNAME FROM #RECPFILE  
    
  --SET @email='vasudha.mahana@angelbroking.com;patel.prashant@angelbroking.com;sneha.kohli@angelbroking.com;'    
    
  IF(@STATUS='SUCCESS')    
    BEGIN      
     SET @SUB='Daily margin file-MCDX-'+ @STATUS       
     SET @MAILBODY='Dear All,<br/><br/>Daily margin file uploaded for the day '+ @date + ' at '+ @TIME                  
     +'<br/><br/><br/><b><i>Regards,</i></b><br/><b><i>Commodity OPSTeam.</i></b><br/>'      
           
     EXEC msdb..sp_send_dbmail                   
     @profile_name='Angel broking',                  
     @recipients=@RECP,    
     @blind_copy_recipients=@email,    
     @subject = @SUB,                   
     @body_format = 'HTML',                  
     @body= @MAILBODY,                  
     @file_attachments= @ATTACH       
    END          
 ELSE IF (@STATUS='FAIL')    
    BEGIN    
   SET @SUB='Daily margin file-MCDX-'+ @STATUS    
   SET @MAILBODY='Dear All,<br/><br/>Daily margin file not uploaded for the day '+ @date + ' at '+ @TIME                  
    +'<br/><br/><br/><b><i>Regards,</i></b><br/><b><i>Commodity OPSTeam.</i></b><br/>'      
           
     EXEC msdb..sp_send_dbmail                   
     @profile_name='Angel broking',                  
     @recipients= @RECP,    
     @blind_copy_recipients=@email,    
     @subject = @SUB,                   
     @body_format = 'HTML',                  
     @body= @MAILBODY,                  
     @file_attachments= @ATTACH       
    END    
       
END          
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.modify_OrderQueue
-- --------------------------------------------------
create procedure modify_OrderQueue
(
@ordid varchar(50),
@stat int,
@newQty float
)
as

Declare @totalQty float, @stock float, @initQty float

select @totalQty = TotalQty from Order_queue where orderID = @ordid
select @stock = StockQty from Order_Queue where orderID = @ordid

set @initQty = @totalQty
set @totalQty = @newQty --(@totalQty - @initQty) + @newQty 
set @stock = @stock + (@initQty - @totalQty)

update Order_Queue set TotalQty = @totalQty, StockQty = @stock, status = @stat where orderID = @ordid

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.modifyNVIRequest
-- --------------------------------------------------
CREATE procedure modifyNVIRequest
(
@ModID nvarchar(15),
@ReqID nvarchar(15),
@ItemID varchar(20),
@ItemName varchar(50),
@UserNote varchar(80),
@HodNote varchar(80),
@ModBy varchar(10),
@ModDate datetime,--varchar(50),
@Note varchar(80),
@CompleteByDate varchar(25),
@qty int,
@stat varchar(4),
@modtype int
)
as

update UserRequest set ItemID = @ItemID, ItemName = @ItemName, UserNote = @UserNote, Qty=@qty, HodNote=@HodNote ,CompleteByDate = @CompleteByDate, ReqStatusCode = @stat where ReqID = @ReqID
insert into ModifiedRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@Note,@ModBy,@ModDate,@CompleteByDate,@stat,@modtype)
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.modifyOrderQueue
-- --------------------------------------------------
create procedure modifyOrderQueue
(
@ordid varchar(50),
@hodid varchar(25),
@itemid varchar(50),
@initQty float,
@newQty float
)
as

Declare @totalQty float, @stock float

select @totalQty = TotalQty from Order_queue where hod_no = @hodid and itemid = @itemid

--set @totalQty = select TotalQty from Order_queue where hod_no = @hodid and itemid = @itemid
select @stock = StockQty from Order_Queue where hod_no = @hodid and itemid = @itemid

set @totalQty = (@totalQty - @initQty) + @newQty 

if(@totalQty<0)
begin
 set @stock = @stock + @totalQty
 set @totalqty = 0
end 

update Order_Queue set TotalQty = @totalQty, StockQty = @stock where hod_no = @hodid and itemid = @itemid
--update Order_Queue set TotalQty = (TotalQty - @initQty) + @newQty where hod_no = @hodid and itemid = @itemid
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.modifyVIRequest
-- --------------------------------------------------
create procedure modifyVIRequest
(
@ModID nvarchar(15),
@ReqID nvarchar(15),
@ItemID varchar(20),
@ItemName varchar(50),
@UserNote varchar(80),
@HodNote varchar(80),
@ModBy varchar(10),
@ModDate datetime,
@Note varchar(80),
@CompleteByDate varchar(25),
@qty int,
@stat varchar(4),
@modtype int
)
as

update UserVIRequest set ItemID = @ItemID, ItemName = @ItemName, UserNote = @UserNote, Qty=@qty, HodNote=@HodNote ,CompleteByDate = @CompleteByDate where ReqID = @ReqID
insert into ModifiedVIRequest values (@ModID,@ReqID,@ItemID,@ItemName,@qty,@Note,@ModBy,@ModDate,@CompleteByDate,@stat,@modtype)
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NBFC_RPT_OPENPOS
-- --------------------------------------------------
  
CREATE PROC [dbo].[NBFC_RPT_OPENPOS](  
           @STATUSID   VARCHAR(20),  
           @STATUSNAME VARCHAR(20),  
           @FROMPARTY  VARCHAR(10),  
           @TOPARTY    VARCHAR(10),  
           @MARGINDATE VARCHAR(11))  
  
AS  
  
  
  SELECT @MARGINDATE = LEFT(CONVERT(DATETIME, RIGHT(@MARGINDATE,4) + '-' + SUBSTRING(@MARGINDATE,4,2) + '-' + LEFT(@MARGINDATE,2)),11)  
  
  SELECT T.PARTY_CODE,  
         T.SCRIP_CD,  
         B_F,  
         B_F_VALUE,  
         BUY,  
         SEL,  
         NET = BUY + SEL,  
         BUY_PRICE = CASE   
                       WHEN BUY <> 0 THEN ABS(BUY_VALUE / BUY)  
                       ELSE 0   
                     END,  
         SEL_PRICE = CASE   
                       WHEN SEL <> 0 THEN ABS(SEL_VALUE / SEL)  
                       ELSE 0   
                     END,  
         BUY_VALUE,  
         SEL_VALUE,  
         DAY_VALUE = BUY_VALUE + SEL_VALUE,  
         OPEN_POSITION = B_F + BUY + SEL,  
         CLOSING_PRICE = D.CL_RATE,  
         PORTFOLIO_VALUE = D.CL_RATE * (B_F + BUY + SEL),  
         NET_VALUE = B_F_VALUE + BUY_VALUE + SEL_VALUE  
  FROM   MARGINFIN.NBFC.DBO.CLIENT_DETAILS C,   
         (SELECT PARTY_CODE = ISNULL(BF.PARTY_CODE,BT.PARTY_CODE),   
                 SCRIP_CD = ISNULL(BF.SCRIP_CD,BT.SCRIP_CD),   
                 B_F = ISNULL(B_F,0),   
                 B_F_VALUE = ISNULL(B_F_VALUE,0),   
                 BUY = ISNULL(BUY,0),   
                 BUY_VALUE = ISNULL(BUY_VALUE,0),   
                 SEL = ISNULL(SEL,0),   
                 SEL_VALUE = ISNULL(SEL_VALUE,0)  
          FROM     
                (SELECT PARTY_CODE,   
                        SCRIP_CD,   
                        B_F = SUM(CASE   
                                    WHEN SELL_BUY = 1 THEN TRADEQTY  
                                    ELSE -TRADEQTY  
                                  END),   
                        B_F_VALUE = SUM(CASE   
                                          WHEN SELL_BUY = 1 THEN -(TRADEQTY*MARKETRATE)  
                                          ELSE (TRADEQTY*MARKETRATE)  
                                        END)   
                 FROM   MARGINFIN.NBFC.DBO.NBFC_TRANS   
                 WHERE  MARGINDATE LIKE @MARGINDATE + '%'  
                        AND PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY  
                        AND TRADETYPE <> 'BT'  
                 GROUP BY PARTY_CODE,SCRIP_CD) BF   
                 FULL OUTER JOIN   
                (SELECT PARTY_CODE,   
                        SCRIP_CD,   
                        BUY = SUM(CASE   
                                    WHEN SELL_BUY = 1 THEN TRADEQTY  
                                    ELSE 0  
                                  END),   
                        BUY_VALUE = SUM(CASE   
                                          WHEN SELL_BUY = 1 THEN -(TRADEQTY*MARKETRATE)  
                                          ELSE 0  
                                        END),   
                        SEL = SUM(CASE   
                                    WHEN SELL_BUY = 2 THEN -TRADEQTY  
                                    ELSE 0  
                                  END),   
                        SEL_VALUE = SUM(CASE   
                                          WHEN SELL_BUY = 2 THEN (TRADEQTY*MARKETRATE)  
                                          ELSE 0  
                                        END)   
                 FROM   MARGINFIN.NBFC.DBO.NBFC_TRANS   
                 WHERE  MARGINDATE LIKE @MARGINDATE + '%'  
                        AND PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY  
                        AND TRADETYPE = 'BT'  
                 GROUP BY PARTY_CODE,SCRIP_CD) BT   
                 ON BF.PARTY_CODE = BT.PARTY_CODE  
                    AND BF.SCRIP_CD = BT.SCRIP_CD) T,   
         MARGINFIN.NBFC.DBO.NBFCVALAN_DETAIL D   
  WHERE  T.PARTY_CODE = C.PARTY_CODE  
         AND T.PARTY_CODE = D.PARTY_CODE   
         AND T.SCRIP_CD = D.SCRIP_CD   
         AND D.PARTY_CODE = C.PARTY_CODE   
         AND D.MARGINDATE LIKE @MARGINDATE + '%'  
         AND C.PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY   
      AND @STATUSNAME =  CASE     
                              WHEN @STATUSID = 'BRANCH' THEN C.BRANCH_CD     
                              WHEN @STATUSID = 'SUBBROKER' THEN C.SUB_BROKER  
                              WHEN @STATUSID = 'TRADER' THEN C.TRADER     
                              WHEN @STATUSID = 'FAMILY' THEN C.FAMILY     
                              WHEN @STATUSID = 'AREA' THEN C.AREA     
                              WHEN @STATUSID = 'REGION' THEN C.REGION     
                              WHEN @STATUSID = 'CLIENT' THEN C.PARTY_CODE     
                              ELSE 'BROKER'     
                            END      
  ORDER BY 1,2

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NCDX_MARGIN_FALIUREMAIL
-- --------------------------------------------------

/*Prepared by: Vasudha 
PRMS ID: 17671001  
Request by: Vishal Kachalia  
Approved by: Sneha Kolhi   
*/  
CREATE PROCEDURE NCDX_MARGIN_FALIUREMAIL   
AS     
SET NOCOUNT ON      
    
BEGIN    
	DECLARE @date varchar(11)  
	SELECT @date=CONVERT(Varchar(11),MAX(upd_date),103) from NCDEX_Margin  
	--PRINT @date  
	   
	if(@date<>CONVERT(Varchar(11),getdate(),103))  
		  BEGIN  
				EXEC NCDX_MARGIN_MAIL 'FAIL'  
		  END  
	ELSE   
		  BEGIN  
				PRINT 'SUCCESS'  
		  END  
END  
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.NCDX_MARGIN_MAIL
-- --------------------------------------------------
CREATE PROCEDURE NCDX_MARGIN_MAIL(@STATUS Varchar(30))  
AS   
SET NOCOUNT ON    
  
BEGIN  
  
	 DECLARE @date Varchar(30),@time Varchar(30),@email varchar(500),@SUB Varchar(50),@ATTACH VARCHAR(200),  
	 @MAILBODY   VARCHAR(500),@RECP varchar(500)  
	 SET @date=convert(char(10), getdate(), 101)  
	 SET @time= convert(varchar(20),GETDATE(),108)+ ' ' +right(convert(varchar(30),GETDATE(),109),2)    
	 PRINT @date    
	 PRINT @time  
 
 
		CREATE TABLE #FILE
		(
			emailName VARCHAR(500)	
		)
		-- finally, execute and insert into our table
		INSERT INTO #FILE
		(
			emailName
		)
		EXEC INTRANET.MISC.DBO.SP_GET_GLOBAL_EMAIL [Commodity margin],'BCC','S'
	 
		 SELECT @email= emailName FROM #FILE
		 
		 CREATE TABLE #RECPFILE
			(
				RECPNAME VARCHAR(500)	
			)
			-- finally, execute and insert into our table
			INSERT INTO #RECPFILE
			(
				RECPNAME
			)
		  EXEC INTRANET.MISC.DBO.SP_GET_GLOBAL_EMAIL [Commodity margin],'TO','S'
	 
		 SELECT @RECP= RECPNAME FROM #RECPFILE
		
		--SET @email='vasudha.mahana@angelbroking.com;patel.prashant@angelbroking.com;sneha.kohli@angelbroking.com;'  
  
	 IF(@STATUS='SUCCESS')  
		  BEGIN    
			  SET @SUB='Daily margin file-NCDEX-'+ @STATUS     
			  SET @MAILBODY='Dear All,<br/><br/>Daily margin file uploaded for the day '+ @date + ' at '+ @TIME                
			  +'<br/><br/><br/><b><i>Regards,</i></b><br/><b><i>Commodity OPSTeam.</i></b><br/>'    
		       
			  EXEC msdb..sp_send_dbmail                 
			  @profile_name='Angel broking',                
			  @recipients=@RECP,  
			  @blind_copy_recipients=@email,  
			  @subject = @SUB,                 
			  @body_format = 'HTML',                
			  @body= @MAILBODY,                
			  @file_attachments= @ATTACH     
		  END        
	ELSE IF (@STATUS='FAIL')  
		  BEGIN  
			SET @SUB='Daily margin file-NCDEX-'+ @STATUS  
			SET @MAILBODY='Dear All,<br/><br/>Daily margin file not uploaded for the day '+ @date + ' at '+ @TIME                
			 +'<br/><br/><br/><b><i>Regards,</i></b><br/><b><i>Commodity OPSTeam.</i></b><br/>'    
		       
			  EXEC msdb..sp_send_dbmail                 
			  @profile_name='Angel broking',                
			  @recipients= @RECP,  
			  @blind_copy_recipients=@email,  
			  @subject = @SUB,                 
			  @body_format = 'HTML',                
			  @body= @MAILBODY,                
			  @file_attachments= @ATTACH     
		  END  
     
END        
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.omnesysOnlineUpload
-- --------------------------------------------------
CREATE proc omnesysOnlineUpload
(
@servermapped as varchar(16),
@filename AS VARCHAR(100),
@server AS VARCHAR(25)
)
AS
SET NOCOUNT ON 
    DECLARE @path AS VARCHAR(100),
            @sql AS VARCHAR(1000)

    truncate table temp_omnesys_userInfo

    SET @path='\\'+@server+'\d$\upload1\Omnesys\' + @filename

    SET @SQL = 'insert into temp_omnesys_userInfo 
                select * FROM OPENROWSET(''Microsoft.ACE.OLEDB.12.0'',''Excel 12.0;DATABASE='+@path+''',''Select * from [User_ID_Listing_0$]'' )'

    EXEC (@SQL)

    ----Insert deactivated client
    INSERT INTO intranet.ebroking.dbo.omnesys_deactivate
    Select *,getdate() 
    FROM intranet.ebroking.dbo.omnesys_userInfo with (nolock) 
    where userid not in (
                            select distinct userid 
                            from temp_omnesys_userInfo
                        )

    ----Delete Same Day Data
    DELETE FROM intranet.ebroking.dbo.omnesys_userInfo 
    WHERE serverip=@servermapped--Fname=@filename

    ----insert exception client
    select pcode 
    into #cli_diet 
    from INTRANET.mis.dbo.odinclientinfo with (nolock)

    insert into intranet.ebroking.dbo.OmnesysException
    select ltrim(rtrim(userid)),'Already Exist in Diet',GETDATE() 
    from temp_omnesys_userInfo
    where ltrim(rtrim(userid)) in (
                                    select pcode 
                                    from #cli_diet
                                  )

    insert into intranet.ebroking.dbo.OmnesysException
    select ltrim(rtrim(userid)),'Email ID Not present',GETDATE() 
    from temp_omnesys_userInfo
    where isnull(ltrim(rtrim(email)),'') =''

    insert into intranet.ebroking.dbo.OmnesysException
    select ltrim(rtrim(userid)),'PAN No not present',GETDATE() 
    from temp_omnesys_userInfo
    where isnull(ltrim(rtrim(PANNO)),'') =''

    insert into intranet.ebroking.dbo.OmnesysException
    select ltrim(rtrim(userid)),'User Address not present',GETDATE() 
    from temp_omnesys_userInfo
    where isnull(ltrim(rtrim(useraddress)),'') =''

    select top 0 * into #OmnesysException from intranet.ebroking.dbo.OmnesysException

    insert into #OmnesysException
    select * from
    (
        select 
            userid=ltrim(rtrim(userid)),reason='Already Exist in Diet',insertdate=GETDATE() 
        from temp_omnesys_userInfo
        where ltrim(rtrim(userid)) in (select pcode from #cli_diet)
        union
        select 
            ltrim(rtrim(userid)),'Email ID Not present',GETDATE() 
        from temp_omnesys_userInfo
        where isnull(ltrim(rtrim(email)),'') =''
        union
        select 
            ltrim(rtrim(userid)),'PAN No not present',GETDATE() 
        from temp_omnesys_userInfo
        where isnull(ltrim(rtrim(PANNO)),'') =''
        union
        select 
            ltrim(rtrim(userid)),'User Address not present',GETDATE() 
        from temp_omnesys_userInfo
        where isnull(ltrim(rtrim(useraddress)),'') =''
    ) a

    delete from temp_omnesys_userInfo
    where ltrim(rtrim(userid)) in (select pcode from #cli_diet)

    delete from temp_omnesys_userInfo
    where isnull(ltrim(rtrim(email)),'') =''

    delete from temp_omnesys_userInfo
    where isnull(ltrim(rtrim(PANNO)),'') =''

    delete from temp_omnesys_userInfo
    where isnull(ltrim(rtrim(useraddress)),'') =''

    ----Insert Fresh Data
    INSERT INTO intranet.ebroking.dbo.omnesys_userInfo
    Select 
        serverip=@servermapped,ltrim(rtrim(userid)),
        ltrim(rtrim(username)),ltrim(rtrim(useraddress)),
        ltrim(rtrim(userType)),ltrim(rtrim(ExchUser)),
        ltrim(rtrim(StatusIndicator)),ltrim(rtrim(ExprDate)),
        ltrim(rtrim(DaysToExpr)),ltrim(rtrim(Product)),
        ltrim(rtrim(ProdEnabled)),ltrim(rtrim(Pswd)),
        ltrim(rtrim(DispPriceDec)),ltrim(rtrim(Branch)),
        ltrim(rtrim(Brokr)),ltrim(rtrim(userAccessType)),
        ltrim(rtrim(userRole)),ltrim(rtrim(SpecPriceType)),
        ltrim(rtrim(Email)),ltrim(rtrim(PwdReset)),
        ltrim(rtrim(UserStatus)),ltrim(rtrim(ClientOverview)),
        ltrim(rtrim(FirmOrdersEnabled)),ltrim(rtrim(TransPwdReset)),
        ltrim(rtrim(TransPwd)),ltrim(rtrim(SourceUserId)),
        convert(datetime,ltrim(rtrim(Time_Stamp))),ltrim(rtrim(PANNo)),
        convert(datetime,ltrim(rtrim(CreationDate))),ltrim(rtrim(City)),
        ltrim(rtrim(Stat)),ltrim(rtrim(Zip)),convert(datetime,ltrim(rtrim(DOB))),
        ltrim(rtrim(LastName)),ltrim(rtrim(CellNo)),
        ltrim(rtrim(FirmId)),ltrim(rtrim(AlwaysOk)),
        ltrim(rtrim(IPAddr)),ltrim(rtrim(MACAddr)),
        ltrim(rtrim(UserTag)),ltrim(rtrim(MaxMWScripCount)),
        GETDATE()
    FROM temp_omnesys_userInfo

    select * from #OmnesysException
    
SET NOCOUNT OFF;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.onlinedrive_easi
-- --------------------------------------------------
CREATE proc dbo.onlinedrive_easi (@filename as varchar(45))               
as                       
set nocount on               
            
          
 delete from intranet.risk.dbo.easi_reg              
insert into intranet.risk.dbo.easi_reg                    
select * from onlinedrive_easi_reg --where dealer_id not in               
--(select dealer_id from omnesys_user_info_all)                  
               
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OrdRej_Reprocess
-- --------------------------------------------------
CREATE procedure OrdRej_Reprocess(@tdate as varchar(11),@loc_code as varchar(7))    
As    
--declare @tdate as varchar(11),@loc_code as varchar(7)    
    
--set @tdate='22 jul 2010'    
--set @loc_code='BNG5'    
    
set @tdate= convert(datetime,@tdate,103)    
    
declare @str_temp as varchar(500),@fname as varchar(500),@dif as varchar(11), @dd as varchar(5)    
    
 declare @str as varchar(200) ,@result as varchar(11), @dt as varchar(11),@date as varchar(5)    
 set @dt=convert(varchar(11),convert(datetime,@tdate),103)      
 set @date=substring(@dt,4,2) +substring(@dt,1,2)    
    
 set @str='declare @result as int'              
 set @str=@str+' exec @result=MASTER.dbo.xp_cmdshell ''dir \\196.1.115.133\D\OrderRejection\'      
   +@loc_code+'\'+@date+'Rej.xls'', NO_OUTPUT'         
 set @str=@str+' select Result=@result '      
                                            
 create table #temp1(status int)          
   insert into #temp1      
   exec(@str)                                             
   select @result=status from #temp1      
       
 if(@result = '0')      
 begin try         
 begin      
      
 set @fname=' exec MASTER.dbo.xp_cmdshell''dir \\196.1.115.133\D\OrderRejection\'      
  +@loc_code+'\'+@date+'Rej.xls'''      
 create table #tmp1 (mdate varchar(8000))        
  insert #tmp1      
  exec(@fname);      
  with mdt as           
  (select * ,row_number() over (order by mdate) as id from #tmp1)          
 select  mgr_code=@loc_code,mod_date=convert(varchar(11),convert(datetime,substring(mdate,1,11)),103),      
    corr_date=convert(varchar(11),convert(varchar(11),convert(datetime,@tdate)+1),103) into #data from mdt where id=9         
  drop table #tmp1          
  insert into mod_dt          
  select * from #data        
    
 delete from intranet.mis.dbo.hist_tbl_ctcl_failed_new where Branch_id=@loc_code and convert(varchar(11),EntryDate,103)=convert(varchar(11),convert(datetime,@tdate),103)          
    
 set @str_temp=''      
      
 set @str_temp='insert into intranet.mis.dbo.hist_tbl_ctcl_failed_new      
  select [User Id],Client,Reason,'''+@loc_code+''',convert(datetime,'''+@tdate+''')+1 FROM        
  OPENROWSET(''Microsoft.ACE.OLEDB.12.0'',''Excel 8.0;DATABASE=\\196.1.115.133\D\OrderRejection\'      
  +@loc_code+'\'+@date+'Rej.xls'',''Select * from [sheet1$]'');'      
        
 exec(@str_temp)      
        
  drop table #data       
 end      
 end try      
 BEGIN CATCH      
  drop table #data       
  insert into Rej_update_log values (convert(varchar(11),convert(datetime,@tdate)+1),@loc_code,      
   'file not exist')      
 END CATCH      
 else      
 begin      
      
  insert into Rej_update_log values (convert(varchar(11),convert(datetime,@tdate)+1),@loc_code,      
  'file not exist')       
 end      
 drop table #temp1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PenalRetroUpload
-- --------------------------------------------------
CREATE Proc [dbo].[PenalRetroUpload]  
(  
 @fdate  varchar(11),  
 @tdate  varchar(11),  
 @user  varchar(12),  
 @FILENAME AS VARCHAR(45) = NULL  
)            
as            
--Create table temp_uploadRetroBulkData            
--(            
--Party_Code  varchar(10),            
--Segment  varchar(10),            
--VoucherNo  varchar(50),            
--Consideration  varchar(11)            
--)            
declare @requestid as int            
/*            
declare @fdate as varchar(11),@tdate as varchar(11),@user as varchar(15),@requestid as int           
           
set @fdate=convert(datetime,'01/02/2012',103)            
set @tdate=convert(datetime,'15/02/2012',103)            
set @user='E05205'            
*/            
        
set @fdate=convert(datetime,@fdate,103)            
set @tdate=convert(datetime,@tdate,103)            
            
--truncate table temp_uploadRetroBulkData            
--bulk insert temp_uploadRetroBulkData from '\\196.1.115.183\d$\upload1\penal.txt' with (firstrow=2,fieldterminator=',',rowterminator='\n')            
            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #bse            
from            
(select * from temp_uploadRetroBulkData where segment='BSECM') a            
join            
AngelBSECM.ACCOUNT_AB.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #nse            
from            
(select * from temp_uploadRetroBulkData where segment='NSECM') a            
join            
AngelNseCM.ACCOUNT.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #fo            
from            
(select * from temp_uploadRetroBulkData where segment='NSEFO') a            
join            
ANGELFO.ACCOUNTFO.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #ncdex            
from            
(select * from temp_uploadRetroBulkData where segment='NSX') a            
join            
ANGELCOMMODITY.ACCOUNTNCDX.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #mcx            
from            
(select * from temp_uploadRetroBulkData where segment='MCX') a            
join            
ANGELCOMMODITY.ACCOUNTMCDX.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #mcd            
from            
(select * from temp_uploadRetroBulkData where segment='MCD') a            
join            
ANGELCOMMODITY.accountmcdxcds.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
            
select a.party_code,fromdate=@fdate,todate=@tdate,b.Vtyp,a.VoucherNo,a.Consideration,EnterBy=@user,dt=getdate(),a.segment,b.Vamt,b.drcr            
into #nsx            
from            
(select * from temp_uploadRetroBulkData where segment='NCDEX') a            
join            
Angelfo.accountcurfo.DBO.LEDGER b with (nolock)            
on a.party_code=b.cltcode and a.VoucherNo=b.vno            
            
select * into #combine         
from            
(            
  select * from #bse            
  union all            
  select * from #nse            
  union all            
  select * from #fo            
  union all            
  select * from #ncdex            
  union all            
  select * from #mcx            
  union all            
  select * from #mcd            
  union all            
  select * from #nsx            
) a            
            
            
select party_code=isnull(a.party_code,''),a.segment,VoucherNo=isnull(a.VoucherNo,''),a.Consideration,Amt=0             
into #missing             
from temp_uploadRetroBulkData a            
left join            
#combine b            
on a.party_code=b.party_code and a.VoucherNo=b.VoucherNo            
where b.VoucherNo is null            
            
            
select party_code,segment,VoucherNo,Consideration,Vamt into #duplicates from #combine a where exists             
(            
 select VoucherNo,segment from #combine  b            
 where a.VoucherNo=b.VoucherNo and a.segment=b.segment            
 group by VoucherNo,segment            
 having count(1)>1            
)            
            
select a.party_code,a.segment,a.VoucherNo,a.Consideration,b.Request_id into #exsisting from #combine a            
join            
INTRANET.MISC.DBO.penal_retro_request b (nolock)            
on a.segment=b.segment and a.VoucherNo=b.vno            
            
delete from #combine where exists (select party_code from #duplicates b where #combine.party_code=b.party_code) --all client with respect to duplicate record need to be removed            
delete from #combine where exists (select party_code from #exsisting b where #combine.segment=b.segment and #combine.VoucherNo=b.VoucherNo)            
          
select * into #rejected from            
(            
 select *,RejectedReason='Given client and voucher no record is missing in ledger' from #missing            
 union all            
 select *,RejectedReason='Double record exists for same voucher number' from #duplicates            
 union all            
 select  party_code,segment,VoucherNo,Consideration,Vamt=0,RejectedReason='Record already exists in retro system with request id '+convert(varchar(20),Request_id) from #exsisting            
) a            
          
            
if ((select count(1) from #combine)>0 and (select count(1) from #rejected)=0)            
Begin            
 Create table #requestid(requestid int)            
            
 insert into #requestid            
 exec INTRANET.MISC.DBO.usp_get_requestid            
            
            
 select @requestid=requestid from #requestid            
              
            
 insert into INTRANET.MISC.DBO.penal_retro_request            
 select @requestid,party_code,fromdate,todate,18.00,Vtyp,VoucherNo,convert(datetime,replace(rtrim(ltrim(Consideration)),char(13),''),103),EnterBy,dt,segment,Vamt,drcr            
 from #combine            
           
 select [Request Response]='Request ID generated for uploaded record is '+convert(varchar(10),@requestid)          
           
END            
Else            
Begin                  
              
 select Client=party_code,SEGMENT,[Voucher No.]=VOUCHERNO,[Consideration Date]=CONSIDERATION,Amount=Amt,[Rejection Reason]=REJECTEDREASON           
 from #rejected                  
                
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.pledgemasterRpt
-- --------------------------------------------------
Create Proc pledgemasterRpt
(
@access_to varchar(20),
@access_code varchar(20)
)
as
set nocount on

select * from Pledge_Unpledge_Master
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.po_status_update
-- --------------------------------------------------
CREATE proc po_status_update  
(  
@poID varchar(10),  
@status varchar(10),
@REQID VARCHAR(20),
@option varchar(20)
)  
as 
if @option  ='POGEN'
BEGIN
update purchase_order_queue set status=@status where purchase_id=@poID  

update order_queue set status=@status where orderID   
in (select orderID from purchase_order_queue where purchase_id =@poID)  
  
update userrequest set reqstatuscode=@status where orderID   
in (select orderID from purchase_order_queue where purchase_id =@poID)  
END

IF @OPTION ='USRDELI'
BEGIN
update userrequest set reqstatuscode=@STATUS where ReqID=@REQID

update purchase_order_queue  set status=@STATUS where orderID in 
(select orderID from userrequest where reqid=@REQID)

update order_queue set status=@STATUS where orderID in
(select orderID from userrequest where reqid=@REQID)

END
return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PR_BLOCK_CLIENTS
-- --------------------------------------------------
          
            
  CREATE PROCEDURE [dbo].[PR_BLOCK_CLIENTS]        
  (          
  @username      AS VARCHAR(50),                
                                    @IPADDRESS VARCHAR(50),                
                                    @filename  VARCHAR(100)=NULL          
  )           
            
  AS          
          
          
    --    select * into #aa from [INTRANET].CMS.DBO.CMS_partycode_blocked  with(nolock)   
  
   IF EXISTS (SELECT REASON FROM TBL_BLOCK WHERE REPLACE(RTRIM(LTRIM(REASON)),CHAR(13),'')<>'' )   
   BEGIN   
  UPDATE C          
  SET USERNAME=@username          
     ,IPADDRESS=@IPADDRESS          
     ,UPDDATE=GETDATE()          
     ,BLOCKED=T.BLOCKED          
     ,REASON=T.REASON          
  FROM [INTRANET].CMS.DBO.CMS_partycode_blocked C          
  INNER JOIN           
  TBL_BLOCK T          
  ON C.CHCODE=T.CHCODE          
   
 insert into TBL_BLOCK_hist  
 select chcode,Blocked,Reason,GETDATE() from TBL_BLOCK  
     
            
  DELETE T          
  FROM [INTRANET].CMS.DBO.CMS_partycode_blocked C          
  INNER JOIN           
  TBL_BLOCK T          
  ON C.CHCODE=T.CHCODE          
            
  INSERT INTO [INTRANET].CMS.DBO.CMS_partycode_blocked          
  SELECT CHCODE,@username,@IPADDRESS,GETDATE(),BLOCKED,REASON          
  FROM TBL_BLOCK          
          
  END  
    
  ELSE  
    
  BEGIN  
  RAISERROR('Please do not Keep the Reason Blank it will not Update in System',16,0)     
    
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PR_BLOCK_CLIENTS_20Jul2023
-- --------------------------------------------------
        
          
  Create PROCEDURE [dbo].[PR_BLOCK_CLIENTS_20Jul2023]      
  (        
  @username      AS VARCHAR(50),              
                                    @IPADDRESS VARCHAR(50),              
                                    @filename  VARCHAR(100)=NULL        
  )         
          
  AS        
        
        
    --    select * into #aa from [196.1.115.132].CMS.DBO.CMS_partycode_blocked  with(nolock) 

   IF EXISTS (SELECT REASON FROM TBL_BLOCK WHERE REPLACE(RTRIM(LTRIM(REASON)),CHAR(13),'')<>'' ) 
   BEGIN 
  UPDATE C        
  SET USERNAME=@username        
     ,IPADDRESS=@IPADDRESS        
     ,UPDDATE=GETDATE()        
     ,BLOCKED=T.BLOCKED        
     ,REASON=T.REASON        
  FROM [196.1.115.132].CMS.DBO.CMS_partycode_blocked C        
  INNER JOIN         
  TBL_BLOCK T        
  ON C.CHCODE=T.CHCODE        
 
 insert into TBL_BLOCK_hist
 select chcode,Blocked,Reason,GETDATE() from TBL_BLOCK
   
          
  DELETE T        
  FROM [196.1.115.132].CMS.DBO.CMS_partycode_blocked C        
  INNER JOIN         
  TBL_BLOCK T        
  ON C.CHCODE=T.CHCODE        
          
  INSERT INTO [196.1.115.132].CMS.DBO.CMS_partycode_blocked        
  SELECT CHCODE,@username,@IPADDRESS,GETDATE(),BLOCKED,REASON        
  FROM TBL_BLOCK        
        
  END
  
  ELSE
  
  BEGIN
  RAISERROR('Please do not Keep the Reason Blank it will not Update in System',16,0)   
  
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PR_BLOCK_CLIENTS_22Apr2020
-- --------------------------------------------------
        
          
  create PROCEDURE [dbo].[PR_BLOCK_CLIENTS_22Apr2020]      
  (        
  @username      AS VARCHAR(50),              
                                    @IPADDRESS VARCHAR(50),              
                                    @filename  VARCHAR(100)=NULL        
  )         
          
  AS        
        
        
    
   IF EXISTS (SELECT REASON FROM TBL_BLOCK WHERE REPLACE(RTRIM(LTRIM(REASON)),CHAR(13),'')<>'' ) 
   BEGIN 
  UPDATE C        
  SET USERNAME=@username        
     ,IPADDRESS=@IPADDRESS        
     ,UPDDATE=GETDATE()        
     ,BLOCKED=T.BLOCKED        
     ,REASON=T.REASON        
  FROM [196.1.115.132].CMS.DBO.CMS_partycode_blocked C        
  INNER JOIN         
  TBL_BLOCK T        
  ON C.CHCODE=T.CHCODE        
 
          
  DELETE T        
  FROM [196.1.115.132].CMS.DBO.CMS_partycode_blocked C        
  INNER JOIN         
  TBL_BLOCK T        
  ON C.CHCODE=T.CHCODE        
          
  INSERT INTO [196.1.115.132].CMS.DBO.CMS_partycode_blocked        
  SELECT CHCODE,@username,@IPADDRESS,GETDATE(),BLOCKED,REASON        
  FROM TBL_BLOCK        
        
  END
  
  ELSE
  
  BEGIN
  RAISERROR('Please do not Keep the Reason Blank it will not Update in System',16,0)   
  
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PR_SBBLOCK_SHARING
-- --------------------------------------------------
CREATE PROCEDURE Pr_sbblock_sharing (@user      AS VARCHAR(50),    
                                    @IPADDRESS VARCHAR(50),    
                                    @filename  VARCHAR(100)=NULL)    
AS    
    DECLARE @USER1 VARCHAR(100)    
    
    SET @USER1=@user + '|' + @IPADDRESS    
    
    IF NOT EXISTS (SELECT segment    
                   FROM   upld_sbclosed    
                   WHERE  segment NOT IN (SELECT coshrtname    
                                          FROM   remisior.dbo.company))    
      BEGIN    
          INSERT INTO remisior.dbo.sbclosed_log    
          SELECT S.segment,    
                 S.sub_broker,    
                 S.from_date,    
                 S.to_date,    
                 S.entered_by,    
                 Getdate(),    
                 @USER1,    
                 S.enteredon,    
                 S.remark,    
                 Getdate()    
          FROM   remisior.dbo.sbclosed S    
                 INNER JOIN upld_sbclosed U    
                         ON S.sub_broker = U.tag    
                            AND S.segment = U.segment    
    
          DELETE FROM remisior.dbo.sbclosed    
          WHERE  EXISTS (SELECT tag    
                         FROM   upld_sbclosed U    
                         WHERE  U.tag = sbclosed.sub_broker    
                                AND U.segment = sbclosed.segment)    
    
          INSERT INTO remisior.dbo.sbclosed    
          SELECT segment,    
                 tag,    
                 CONVERT(DATETIME, fromdate, 103),    
                 CONVERT(DATETIME, Replace(todate, Char(13), ''), 103),    
                 @USER1,    
                 '',    
                 '',    
                 Getdate(),    
                 remarks    
          FROM   upld_sbclosed    
      END    
    ELSE    
      BEGIN    
          RAISERROR('CHECK FILE',16,0)    
      END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PR_UPLOAD_GLCODE
-- --------------------------------------------------
CREATE PROCEDURE Pr_upload_glcode (@USERNAME  VARCHAR(100),  
                                   @IPADDRESS VARCHAR(20),  
                                   @FILENAME  VARCHAR(20)=NULL)  
AS  
    DECLARE @USERNAME1 VARCHAR(50)  
  
    SET @USERNAME1=@USERNAME + '|' + @IPADDRESS  
  
    IF NOT EXISTS (SELECT segment  
                   FROM   upld_glcode  
                   WHERE  segment NOT IN (SELECT coshrtname  
                                          FROM   remisior.dbo.company))  
        OR NOT EXISTS(SELECT DISTINCT status  
                      FROM   upld_glcode  
                      WHERE  replace(status,char(13),'') NOT IN (SELECT DISTINCT status  
                                            FROM  
                     remisior.dbo.remi_ledcode_status))  
      BEGIN  
          UPDATE G  
          SET    GLREGISTEREDCODE = U.newglcode,  
                 GLunregisteredcode = U.oldglcode,  
                 ledgercode = U.newglcode,  
                 status = Ltrim(Rtrim(replace(U.status,char(13),''))),  
                 update_by = @USERNAME1,  
                 update_on = Getdate()  
          FROM   upld_glcode U  
                 INNER JOIN remisior.dbo.remi_ledcode_status G  
                         ON U.sbcode = G.sbcode  
                            AND u.segment = G.coname  
      END  
    ELSE  
      BEGIN  
          RAISERROR('CHECK FILE',16,0)  
      END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Pr_upload_glcode_26july2013
-- --------------------------------------------------
CREATE PROCEDURE Pr_upload_glcode_26july2013 (@USERNAME  VARCHAR(100),  
                                   @IPADDRESS VARCHAR(20),  
                                   @FILENAME  VARCHAR(20)=NULL)  
AS  
    DECLARE @USERNAME1 VARCHAR(50)  
  
    SET @USERNAME1=@USERNAME + '|' + @IPADDRESS  
  
    IF NOT EXISTS (SELECT segment  
                   FROM   upld_glcode  
                   WHERE  segment NOT IN (SELECT coshrtname  
                                          FROM   remisior.dbo.company))  
        OR NOT EXISTS(SELECT DISTINCT status  
                      FROM   upld_glcode  
                      WHERE  status NOT IN (SELECT DISTINCT status  
                                            FROM  
                     remisior.dbo.remi_ledcode_status))  
      BEGIN  
          UPDATE G  
          SET    GLREGISTEREDCODE = U.newglcode,  
                 GLunregisteredcode = U.oldglcode,  
                 ledgercode = U.newglcode,  
                 status = Ltrim(Rtrim(U.status)),  
                 update_by = @USERNAME1,  
                 update_on = Getdate()  
          FROM   upld_glcode U  
                 INNER JOIN remisior.dbo.remi_ledcode_status G  
                         ON U.sbcode = G.sbcode  
                            AND u.segment = G.coname  
      END  
    ELSE  
      BEGIN  
          RAISERROR('CHECK FILE',16,0)  
      END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.proc_FileAutoUploadprocess
-- --------------------------------------------------

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE procedure proc_FileAutoUploadprocess (@mode varchar(10)= null)  
as  
begin try  
      
    if(isnull(@mode,'')<>'process')  
    return;  
      
 if exists (select * from tbl_Fileprocess where cast(processDate as date) = CAST(GETDATE() as date))  
 begin   
  print 'Already Executed'  
 end  
 else  
 begin  
  insert into tbl_FileprocessHist (ProcessDate, FileId, ProcessStartAt, FileName, FileRowCount, ProcessEndAt, ProcessStatus, histDate)  
  select ProcessDate, FileId, ProcessStartAt, FileName, FileRowCount, ProcessEndAt, ProcessStatus, GETDATE() from tbl_Fileprocess  
  truncate table tbl_Fileprocess  
  insert into tbl_Fileprocess (ProcessDate, FileId, ProcessStatus)  
  select CAST(GETDATE() as date), Upd_Srno, 0  
  from tbl_AutomationUpladFile  
 end  
 if exists ( select * from tbl_Fileprocess where isnull(FileRowCount, 0) = 0 and cast(processDate as date) = CAST(GETDATE() as date))  
 begin  
  update a set ProcessStatus = 0 from tbl_Fileprocess a where isnull(FileRowCount, 0) = 0  
  declare @Fileid int = 0  
  while (1 = 1)  
  begin   
  
   Label1: 
  set @Fileid =(select top 1 Fileid from tbl_Fileprocess where isnull(FileRowCount, 0) = 0 and cast(processDate as date) = CAST(GETDATE() as date) and ProcessStatus <= 3)  
   if (isnull(@Fileid, 0) = 0)  
   begin  
    break  
   end  
   else  
   begin  
			begin try
			exec proc_FileUploadAutomation @Fileid  
			end try
			begin catch
			goto Label1;
			end catch 
   end  
  end  
  print 'process completed successfully'  
 end  
 exec proc_SendFileStatusOnMail  
end try  
begin catch  
 exec proc_SendFileStatusOnMail  
end catch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.proc_FileUploadAutomation
-- --------------------------------------------------
  
CREATE proc proc_FileUploadAutomation(@upldsrno int)                              
as                              
begin                              
                             
Declare @Query varchar(max)=null;                    
Declare @Error int=0;                  
Declare @Count int=0;                   
                  
Declare @mUpd_TempTable varchar(100)=null;                              
Declare @mUpd_deli varchar(5)=null;                              
Declare @mUpd_FirstRow varchar(5)=null;                              
Declare @mUpd_FinSP varchar(50)=null;                              
Declare @FileLocation varchar(100)=null;                              
Declare @FileName varchar(1000)=null;                              
Declare @FileExtenstion varchar(10)=null;                              
Declare @FileSize numeric(18,2)=null                              
      
                              
select                                
@upldsrno=Upd_Srno ,                              
@mUpd_TempTable=Upd_TempTable,                              
@mUpd_deli=Upd_deli,                              
@mUpd_FirstRow=Upd_FirstRow,                              
@mUpd_FinSP=Upd_FinSP ,                              
@FileName=FileN ,                            
@FileExtenstion=Upd_Extension                              
from tbl_AutomationFileUpload   where Upd_Srno=@upldsrno                               
                  
-- to get fileName                    
Declare  @tbl as  table (FileN varchar(200))                    
Insert into @tbl  execute('select '+ @FileName)                      
select  @FileName=FileN  from @tbl                     
                    
                    
--if @upldsrno=101      
--begin      
--set @FileName= (select 'DerivativesMargin'+replace(LEFT(CONVERT(VARCHAR(10),date,105),5),'-','')+RIGHT(CONVERT(varchar(4),YEAR(date)),2)       
--from (select date = cast(min(start_date)as date) from general.dbo.bo_sett_mst with (nolock) where start_date>GETDATE())as a)      
--end                    
      
                    
set @FileLocation ='\\196.1.115.182\h\Contract\'+ltrim(rtrim(@FileName+@FileExtenstion));                     
print @FileLocation                      
                           
                    
Update a set ProcessStartAt=GETDATE(),ProcessStatus=ProcessStatus+1,FileName=@FileName  from tbl_Fileprocess a  where fileid =@upldsrno                            
                            
set @Query='truncate table '+Quotename(@mUpd_TempTable)+' ';                            
print @Query                            
execute (@Query)                            
                            
set @Query='bulk insert '+@mUpd_TempTable+' from '''+@FileLocation+''' WITH (FIRSTROW='+@mUpd_FirstRow+',FIELDTERMINATOR = '''+@mUpd_deli+''',KeepNULLS)';                  
print @Query                              
execute (@Query)                  
                  
set @Error =@@ERROR                   
set @Count=1;                  
if(@Error<>0)                          
GOTO HANDLEERROR;                     
                    
                             
insert into tbl_upload_info (Updinfo_RptSrno,Updinfo_filename,Updinfo_filesize,Updinfo_fileType,Updinfo_datetime,Updinfo_by)                               
values(@upldsrno,@FileName,@FileSize,@FileExtenstion,getdate(),'System')                              
                             
                              
set @Query ='update tbl_Fileprocess set FileRowCount = (select COUNT(0) from '+Quotename(@mUpd_TempTable)+')   where fileid  ='+convert(varchar(5),@upldsrno) +''                            
print @Query                            
execute (@Query);                            
                  
--set @Query ='exec  '+@mUpd_FinSP +'  '''+@Filename+'''';                              
--print @Query                              
--execute (@Query)                          
set @Error=@@ERROR                    
                    
set @Count =2                      
if(@Error<>0)                       
GOTO HANDLEERROR;                            
                  
SET @Count =3;-- to default update                  
                  
HANDLEERROR:                  
IF @Count = 1                    
INsert into [CSOKYC-6].general.dbo.EODBODDetail_Error (ErrTime ,ErrObject,ErrLine ,ErrMessage)                  
select GETDATE(),'proc_FileUploadAutomation',1,  'Error Occured While Bulk Insert file STEP 1 Please check if file exists ='+@Filename                                                        
IF @Count = 2                  
INsert into [CSOKYC-6].general.dbo.EODBODDetail_Error (ErrTime ,ErrObject,ErrLine ,ErrMessage)                  
select GETDATE(),'proc_FileUploadAutomation',2, 'Error Occured While Uploading file STEP 2='+@Filename                                                        
IF @Count = 3         
Update a set ProcessEndAt=GETDATE() from tbl_Fileprocess a  where fileid =cast(@upldsrno as int)                   
            
            
set @Query='truncate table '+Quotename(@mUpd_TempTable)+' ';                            
print @Query                            
execute (@Query)             
            
                  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.proc_notice
-- --------------------------------------------------
create procedure proc_notice
(
@nID varchar(50)
)
as

select distinct a.Emp_name, a.Sr_name, b.ReqID, b.ItemName, b.NoteDate, c.ReqStatusName, b.note 
from Emp_info a, Notifications b, ReqStatus c, InventoryItem d, Category e  

where a.Emp_no = b.Emp_No AND b.NoteID =@nID 
AND ( b.CatName = e.CatName AND e.CatID = d.CatID) 
and b.ReqStatusCode=c.ReqStatusCode	

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.proc_SendFileStatusOnMail
-- --------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE procedure proc_SendFileStatusOnMail    
as    
begin    
 DECLARE @SQL AS VARCHAR(MAX), @HTML_OUTPUT AS VARCHAR(MAX)      
 /*SENDING COUNTS*/          
 SET @HTML_OUTPUT = ''      
 EXEC [DBA_ConvertQueryInHTML] 'select * from upload.dbo.File_UploadStatus',@HTML_OUTPUT OUTPUT      
 set @HTML_OUTPUT=  '<b>Dear Team</br><br/>Please find status of Uploaded file <br/><br/> <br/> <br/></b>'+ @HTML_OUTPUT    
    
 EXEC INTRANET.MSDB.DBO.SP_SEND_DBMAIL         
 --@RECIPIENTS ='mgs.ashoks@angelbroking.com;vijay.mali@angelbroking.com;vishal@angelbroking.com;vishal.kanani@angelbroking.com;updationteam@angelbroking.com',                                        
 @RECIPIENTS ='unistanz.sneha@angelbroking.com;mindgate.rajni@angelbroking.com',
 -- @COPY_RECIPIENTS = '',                                        
 --@blind_copy_recipients='mgs.abha@angelbroking.com;',                              
 @PROFILE_NAME = 'AngelBroking',                                        
 @BODY_FORMAT ='HTML',                                        
 @SUBJECT = 'NRMS File Upload Automation' ,                                                                    
 @BODY =@HTML_OUTPUT      
end 


--select * from sys.procedures where name='proc_SendFileStatusOnMail'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ProvisionalOrder_upload
-- --------------------------------------------------
        
--ProvisionalOrder_upload 'Mandate_master.csv'        
CREATE PROC [dbo].[ProvisionalOrder_upload](@FILENAME AS VARCHAR(50))              
AS                                         
BEGIN                                        
              
Set nocount on                                  
--SET XACT_ABORT ON                                     
BEGIN TRY                                               
/*              
  CREATE TABLE #DirectoryTree (            
     id int IDENTITY(1,1)            
    ,subdirectory nvarchar(512)            
    ,depth int            
    ,isfile bit);            
            
  INSERT #DirectoryTree (subdirectory,depth,isfile)            
  EXEC master.sys.xp_dirtree 'D:\SIP_Masters\Mandate_Master\',1,1;            
 */        
  Declare @fname varchar(100) = '',@sql varchar(1000) = ''        
  SELECT  @fname=@filename        
        
    set @sql='BULK INSERT upload.dbo.ProvisionalOrdertemp FROM' + '  ' + ''''+@fname+'''' + '  ' + 'WITH (FIELDTERMINATOR ='','',FirstRow=2, ROWTERMINATOR =''\n'')'         
    --print @sql        
 exec(@sql)            
         
        
  exec intranet.risk.dbo.ProvisionalOrder_upload @fname        
          
        
         
    /*        
  TRUNCATE TABLE SIP_Mandate                                       
                                       
  INSERT INTO SIP_Mandate(MandateCode,ClientCode,CliName,MemberCode,BankName,BankBranch,RegnDate,Amount,Status,Fname,FetchDatetime)            
  SELECT MandateCode,ClientCode,CliName,MemberCode,BankName,BankBranch,RegnDate,Amount,Status,@fname,GETDATE()                                    
  FROM mis.upload.dbo.SIP_Mandate_temp          
      */        
    TRUNCATE TABLE ProvisionalOrdertemp            
            
        
            
End try                                       
BEGIN CATCH                                          
    
exec intranet.risk.dbo.ProvisionalOrder_upload @fname        
 /*                                     
 insert into SIP_Error(ErrTime,ErrObject,ErrLine,ErrMessage)               
 select GETDATE(),'SIP_Upload_Mandate',ERROR_LINE(),ERROR_MESSAGE()                                                
             
 DECLARE @ErrorMessage NVARCHAR(4000);                                            
 SELECT @ErrorMessage = ERROR_MESSAGE() + convert(varchar(10),error_line());                                            
 RAISERROR (@ErrorMessage , 16, 1);               
   */            
End catch                             
                                  
Set nocount off                            
                                        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rebuild_index
-- --------------------------------------------------
CREATE procedure [dbo].[rebuild_index]  
@database varchar(100)  
as  
begin  
  
declare @db_id int  
Select @db_id = db_id(@database)  
  
if @db_id is Null  
return  
  
SET NOCOUNT ON;  
DECLARE @objectid int;  
DECLARE @indexid int;  
DECLARE @partitioncount bigint;  
DECLARE @schemaname nvarchar(130);  
DECLARE @objectname nvarchar(130);  
DECLARE @indexname nvarchar(130);  
DECLARE @partitionnum bigint;  
DECLARE @partitions bigint;  
DECLARE @frag float;  
DECLARE @command nvarchar(4000);  
-- Conditionally select tables and indexes from the sys.dm_db_index_physical_stats function  
-- and convert object and index IDs to names.  
  
SELECT  
object_id AS objectid,  
index_id AS indexid,  
partition_number AS partitionnum,  
avg_fragmentation_in_percent AS frag  
INTO #work_to_do  
FROM sys.dm_db_index_physical_stats (@db_id, NULL, NULL , NULL, 'LIMITED')  
WHERE avg_fragmentation_in_percent > 10.0 AND index_id > 0;  
  
-- Declare the cursor for the list of partitions to be processed.  
DECLARE partitions CURSOR FOR SELECT objectid,indexid,partitionnum,frag FROM #work_to_do;  
  
-- Open the cursor.  
OPEN partitions;  
  
-- Loop through the partitions.  
WHILE (1=1)  
BEGIN;  
FETCH NEXT  
FROM partitions  
INTO @objectid, @indexid, @partitionnum, @frag;  
IF @@FETCH_STATUS < 0 BREAK;  
SELECT @objectname = QUOTENAME(o.name), @schemaname = QUOTENAME(s.name)  
FROM sys.objects AS o  
JOIN sys.schemas as s ON s.schema_id = o.schema_id  
WHERE o.object_id = @objectid;  
SELECT @indexname = QUOTENAME(name)  
FROM sys.indexes  
WHERE object_id = @objectid AND index_id = @indexid;  
SELECT @partitioncount = count (*)  
FROM sys.partitions  
WHERE object_id = @objectid AND index_id = @indexid;  
  
-- 30 is an arbitrary decision point at which to switch between reorganizing and rebuilding.  
IF @frag < 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REORGANIZE';  
IF @frag >= 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REBUILD';  
IF @partitioncount > 1  
      SET @command = @command + N' PARTITION=' + CAST(@partitionnum AS nvarchar(10));  
IF @frag >= 30.0  
      set @command = @command +N' WITH (SORT_IN_TEMPDB = ON)' 
 
EXEC (@command);  
PRINT N'Executed: ' + @command;  
END;  
  
-- Close and deallocate the cursor.  
CLOSE partitions;  
DEALLOCATE partitions;  
  
-- Drop the temporary table.  
DROP TABLE #work_to_do;  
  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Redemption_Upload
-- --------------------------------------------------
CREATE PROC [dbo].[Redemption_Upload](@FILENAME AS VARCHAR(50))                            
AS                                                       
BEGIN                                                      
                            
SET NOCOUNT ON                                                
SET XACT_ABORT ON                                                   
--TRUNCATE TABLE Lump_Redemption_Master_Temp                         
--DECLARE @FNAME VARCHAR(200) = '',@SQL VARCHAR(1000) = ''                      
--set @FNAME=@FILENAME                      
--print @FNAME             
--SET @SQL='BULK INSERT UPLOAD.DBO.Lump_Redemption_Master_Temp FROM' + '  ' + '''//196.1.115.173/D$/UPLOAD1/'+@FNAME+'''' + '  ' + 'WITH (FIELDTERMINATOR =''|'',FIRSTROW=1, ROWTERMINATOR =''\n'')'                       
--print    @SQL     
--EXEC(@SQL)            
EXEC [INTRANET].RISK.DBO.REDEMPTION_UPLOAD @FILENAME  
TRUNCATE TABLE Lump_Redemption_Master_Temp                         
                                                
SET NOCOUNT OFF                                          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.RejectionFile_upload
-- --------------------------------------------------
CREATE PROC [dbo].[RejectionFile_upload](@filename AS VARCHAR(50))          
AS                                     
BEGIN                                    
          
Set nocount on                              
SET XACT_ABORT ON                                 
BEGIN TRY                                           

  Declare @fname varchar(100) = '',@sql varchar(1000) = ''    
  SELECT  @fname=@filename    
    
    set @sql='BULK INSERT upload.dbo.RejectionOrderlumpsumTemp FROM' + '  ' + ''''+@fname+'''' + '  ' + 'WITH (FIELDTERMINATOR ='','',FirstRow=2, ROWTERMINATOR =''\n'')'     
    --print @sql    
 exec(@sql)        
     
    
  exec intranet.risk.dbo.[RejectionFile_upload] @fname    
      
    
     
    /*    
  TRUNCATE TABLE SIP_Mandate                                   
                                   
  INSERT INTO SIP_Mandate(MandateCode,ClientCode,CliName,MemberCode,BankName,BankBranch,RegnDate,Amount,Status,Fname,FetchDatetime)        
  SELECT MandateCode,ClientCode,CliName,MemberCode,BankName,BankBranch,RegnDate,Amount,Status,@fname,GETDATE()                                
  FROM mis.upload.dbo.SIP_Mandate_temp      
      */    
    TRUNCATE TABLE RejectionOrderlumpsumTemp        
        
    
        
End try                                   
BEGIN CATCH         
  exec intranet.risk.dbo.[RejectionFile_upload] @fname                                 
 /*                                 
 insert into SIP_Error(ErrTime,ErrObject,ErrLine,ErrMessage)           
 select GETDATE(),'SIP_Upload_Mandate',ERROR_LINE(),ERROR_MESSAGE()                                            
         
 DECLARE @ErrorMessage NVARCHAR(4000);                                        
 SELECT @ErrorMessage = ERROR_MESSAGE() + convert(varchar(10),error_line());                                        
 RAISERROR (@ErrorMessage , 16, 1);           
   */        
End catch                         
                              
Set nocount off                        
                                    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.restricted_scrip
-- --------------------------------------------------
CREATE procedure restricted_scrip
(  
@filename as varchar(35),
@segment as varchar(15)
)  
as

GO

-- --------------------------------------------------
-- PROCEDURE dbo.restricted_scrip1
-- --------------------------------------------------
CREATE procedure restricted_scrip1  
(    
@segment as varchar(15),
@filename as varchar(15)  
)    
as
--
if(@segment='BSE')
 begin
 insert into Intranet.risk.dbo.Restricted_Block_Scrips_temp (segment,[User],Group_Id,Deposit,ScripCode,Symbol,SecuritySeries,[Group],Periodicity,InstrumentName,Expiry,Strike_price,
    Opt_type,Gross_Exposure_Multiplier,Gross_Exposure_Limit,
    Net_Exposure_Multiplier,Net_Exposure,Net_Sale_Multiplier,
    Net_Sale_Limit,Net_Position_Multiplier,turnover,Turn_Over_Multiplier,Turn_Over_Limit,Pending_Order_Multiplier,
    Pending_Order_Limit,MTM_Multiplier,MTM_Limit,Initial_Margin_Multiplier,Initial_Margin_Limit,NQ_Limit,
    Max_Single_Trans_Limit,Max_Single_Trans_Quantity,Min_Order_Value,Min_Order_Quantity,Retain_Multiplier,Include_MTMP,
    Include_Net_Premium,GrossAndNet,Include_Exp_Margin) 
select 
--'BSE','-','','0','',convert(varchar(10),Symbol),'',
--    '-1','-1','','A','','','6',convert(varchar(10),Scrip_Code),'-1','-1','-1','-1','0','-1','-1','0','-1','-1','-1',
--    '-1','-1','-1','999999999','9999999','0.01','1','1','0','-1','0','-1','500000' 
	@segment,[User],Group_Id,Deposit,Scrip_Code,Symbol,Series,[Group],Periodicity,Instrument_Name,Expiry,Strike_Price,
    Option_Type,Gross_Exposure_Multiplier,Gross_Exposure_Limit,Net_Exposure_Multiplier,Net_Exposure,Net_Sale_Multiplier,
    Net_Sale_Limit,Net_Position_Multiplier,Net_Position_Limit,TurnOver_Multiplier,TurnOver_Limit,Pending_Order_Multiplier,
    Pending_Order_Limit,MTM_Multiplier,MTM_Limit,Ini_Margin_Multiplier,Ini_Margin_Limit,NQ_Limit,Max_Single_Trans_Limit,
    Max_Single_Trans_Quantity,Min_Order_Value,Min_Order_Quantity,Retain_Multiplier,Include_MTMP,Include_Net_Premium,GrossAndNet,
    Include_Exp_Margin from restricted_scrip_uploadTemp where Periodicity='6'

--  insert into Intranet.risk.dbo.Restricted_Block_Scrips(Segment,[User],Group_Id,Deposit,InstrumentName,Symbol,Strike_price,
--    Gross_Exposure_Limit,Gross_Exposure_Multiplier,Opt_type,SecuritySeries,[Group],Expiry,Periodicity,
--    ScripCode,Net_Exposure_Multiplier,Net_Exposure,Net_Sale_Multiplier,
--    Net_Sale_Limit,Net_Position_Multiplier,Turn_Over_Multiplier,Turn_Over_Limit,Pending_Order_Multiplier,
--    Pending_Order_Limit,MTM_Multiplier,MTM_Limit,Initial_Margin_Multiplier,Initial_Margin_Limit,NQ_Limit,
--    Max_Single_Trans_Limit,Max_Single_Trans_Quantity,Min_Order_Value,Min_Order_Quantity,Retain_Multiplier,Include_MTMP,
--    Include_Net_Premium,GrossAndNet,Include_Exp_Margin,turnover) select 'BSE','-','','0','',convert(varchar(10),Symbol),'',
--     '-1','-1','','A','','','6',convert(varchar(10),Scrip_Code),'-1','-1','-1','-1','0','-1','-1','0','-1','-1','-1',
--      '-1','-1','-1','999999999','9999999','0.01','1','1','0','-1','0','-1','500000'
--	from restricted_scrip_uploadTemp where Periodicity='6'

 end
 if(@segment='NSE')
 begin
 insert into  Intranet.risk.dbo.Restricted_Block_Scrips_temp (segment,[User],Group_Id,Deposit,ScripCode,Symbol,SecuritySeries,[Group],Periodicity,InstrumentName,Expiry,Strike_price,
    Opt_type,Gross_Exposure_Multiplier,Gross_Exposure_Limit,
    Net_Exposure_Multiplier,Net_Exposure,Net_Sale_Multiplier,
    Net_Sale_Limit,Net_Position_Multiplier,turnover,Turn_Over_Multiplier,Turn_Over_Limit,Pending_Order_Multiplier,
    Pending_Order_Limit,MTM_Multiplier,MTM_Limit,Initial_Margin_Multiplier,Initial_Margin_Limit,NQ_Limit,
    Max_Single_Trans_Limit,Max_Single_Trans_Quantity,Min_Order_Value,Min_Order_Quantity,Retain_Multiplier,Include_MTMP,
    Include_Net_Premium,GrossAndNet,Include_Exp_Margin)  
select 
--'NSE','-','','0','',convert(varchar(10),Symbol),'',
--     '-1','-1','','EQ','','','1',convert(varchar(10),Scrip_Code),'-1','-1','-1','-1','0','-1','-1','0','-1','-1','-1',
--     '-1','-1','-1','999999999','9999999','0.01','1','1','0','-1','0','-1','500000'
	@segment,[User],Group_Id,Deposit,Scrip_Code,Symbol,Series,[Group],Periodicity,Instrument_Name,Expiry,Strike_Price,
   Option_Type,Gross_Exposure_Multiplier,Gross_Exposure_Limit,Net_Exposure_Multiplier,Net_Exposure,Net_Sale_Multiplier,
   Net_Sale_Limit,Net_Position_Multiplier,Net_Position_Limit,TurnOver_Multiplier,TurnOver_Limit,Pending_Order_Multiplier,
  Pending_Order_Limit,MTM_Multiplier,MTM_Limit,Ini_Margin_Multiplier,Ini_Margin_Limit,NQ_Limit,Max_Single_Trans_Limit,
Max_Single_Trans_Quantity,Min_Order_Value,Min_Order_Quantity,Retain_Multiplier,Include_MTMP,Include_Net_Premium,GrossAndNet,
Include_Exp_Margin from restricted_scrip_uploadTemp where Periodicity='1'

--insert into  Intranet.risk.dbo.Restricted_Block_Scrips(Segment,[User],Group_Id,Deposit,InstrumentName,Symbol,Strike_price,
--    Gross_Exposure_Limit,Gross_Exposure_Multiplier,Opt_type,SecuritySeries,[Group],Expiry,Periodicity,
--    ScripCode,Net_Exposure_Multiplier,Net_Exposure,Net_Sale_Multiplier,
--    Net_Sale_Limit,Net_Position_Multiplier,Turn_Over_Multiplier,Turn_Over_Limit,Pending_Order_Multiplier,
--    Pending_Order_Limit,MTM_Multiplier,MTM_Limit,Initial_Margin_Multiplier,Initial_Margin_Limit,NQ_Limit,
--    Max_Single_Trans_Limit,Max_Single_Trans_Quantity,Min_Order_Value,Min_Order_Quantity,Retain_Multiplier,Include_MTMP,
--    Include_Net_Premium,GrossAndNet,Include_Exp_Margin,turnover) select 'NSE','-','','0','',convert(varchar(10),Symbol),'',
--     '-1','-1','','EQ','','','1',convert(varchar(10),Scrip_Code),'-1','-1','-1','-1','0','-1','-1','0','-1','-1','-1',
--      '-1','-1','-1','999999999','9999999','0.01','1','1','0','-1','0','-1','500000'
--	from restricted_scrip_uploadTemp where Periodicity='1'

 end


--drop table #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.RTAOrder_upload
-- --------------------------------------------------

          
--ProvisionalOrder_upload 'Mandate_master.csv'          
CREATE PROC [dbo].[RTAOrder_upload](@FILENAME AS VARCHAR(50))                
AS                                           
BEGIN                                          
                
Set nocount on                                    
--SET XACT_ABORT ON                                       
BEGIN TRY                                                 
/*                
  CREATE TABLE #DirectoryTree (              
     id int IDENTITY(1,1)              
    ,subdirectory nvarchar(512)              
    ,depth int              
    ,isfile bit);              
              
  INSERT #DirectoryTree (subdirectory,depth,isfile)              
  EXEC master.sys.xp_dirtree 'D:\SIP_Masters\Mandate_Master\',1,1;              
 */          
  Declare @fname varchar(100) = '',@sql varchar(1000) = ''          
  SELECT  @fname=@filename          
          
    set @sql='BULK INSERT upload.dbo.RTAOrdertemp FROM' + '  ' + ''''+@fname+'''' + '  ' + 'WITH (FIELDTERMINATOR ='','',FirstRow=1, ROWTERMINATOR =''\n'')'           
    --print @sql          
 exec(@sql)              
           
          
  EXEC INTRANET.RISK.DBO.[RTAORDER_UPLOAD] @FNAME      
            
          
           
    /*          
  TRUNCATE TABLE SIP_Mandate                                         
                                         
  INSERT INTO SIP_Mandate(MandateCode,ClientCode,CliName,MemberCode,BankName,BankBranch,RegnDate,Amount,Status,Fname,FetchDatetime)              
  SELECT MandateCode,ClientCode,CliName,MemberCode,BankName,BankBranch,RegnDate,Amount,Status,@fname,GETDATE()                                      
  FROM mis.upload.dbo.SIP_Mandate_temp            
      */          
    TRUNCATE TABLE RTAOrdertemp          
              
          
              
End try                                         
BEGIN CATCH                                            
      
EXEC INTRANET.RISK.DBO.[RTAORDER_UPLOAD] @FNAME      
 /*                                       
 insert into SIP_Error(ErrTime,ErrObject,ErrLine,ErrMessage)                 
 select GETDATE(),'SIP_Upload_Mandate',ERROR_LINE(),ERROR_MESSAGE()                                                  
               
 DECLARE @ErrorMessage NVARCHAR(4000);                                              
 SELECT @ErrorMessage = ERROR_MESSAGE() + convert(varchar(10),error_line());                                              
 RAISERROR (@ErrorMessage , 16, 1);                 
   */              
End catch                               
                                    
Set nocount off                              
                                          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sb_ebrok_training
-- --------------------------------------------------
CREATE proc dbo.sb_ebrok_training  (@filename as varchar(25))     
as     
set nocount on    
select * into #f  from sb_training 
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SCCS_isinBlk_upload
-- --------------------------------------------------



CREATE procedure SCCS_isinBlk_upload(@username as varchar(10),@ipaddr as varchar(15),@filename as varchar(45))  
as  
Insert into sccs.dbo.Sccs_blk_isin (isin ,uploadBy ,ipaddr ,UploadOn )   
select substring(isin,1,12),@username,@ipaddr,convert(varchar(11),getdate()) from tempSccsBlkIsin

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SIP_Upload_Mandate
-- --------------------------------------------------
  
--SIP_Upload_Mandate 'Mandate_0612_26NOV2015_1.txt'  
CREATE PROC [dbo].[SIP_Upload_Mandate](@FILENAME AS VARCHAR(1000))        
AS                                   
BEGIN                                  
        
Set nocount on                            
SET XACT_ABORT ON                               
BEGIN TRY                                         
  
Declare @fname varchar(1000) = '',@sql varchar(1000) = '' ,@path varchar(500) 
SELECT  @fname=@filename 
set @path= '//196.1.115.173/D$/Upload1/'+@FILENAME

--TRUNCATE TABLE upload.dbo.SIP_Mandate_temp 

--set @sql='BULK INSERT upload.dbo.SIP_Mandate_temp FROM' + '  ' + ''''+@path+'''' + '  ' + 
--'WITH (FIELDTERMINATOR =''|'',ROWTERMINATOR =''\n'',FirstRow=1,KeepNULLS)'   

--print (@sql)  
--exec(@sql) 
 
--exec intranet.risk.dbo.SIP_Upload_Mandate_30112015 '1.txt'  

exec intranet.risk.dbo.SIP_Upload_Mandate

      
End try                                 
BEGIN CATCH              
    
End catch                       
                            
Set nocount off                      
                                  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SIP_Upload_Scheme
-- --------------------------------------------------

--select * from tbl_upload where  upd_Srno=99
CREATE PROC [dbo].[SIP_Upload_Scheme](@FILENAME AS VARCHAR(50) )
AS                                 
BEGIN                                
      
Set nocount on                          
SET XACT_ABORT ON                             
BEGIN TRY                                       
  
  /*    
  CREATE TABLE #DirectoryTree (    
     id int IDENTITY(1,1)    
    ,subdirectory nvarchar(512)    
    ,depth int    
    ,isfile bit);    
    
  INSERT #DirectoryTree (subdirectory,depth,isfile)    
  EXEC master.sys.xp_dirtree 'D:\SIP_Masters\SIP_Scheme_Master\',1,1;    
*/
  Declare @fname varchar(100) = '',@sql varchar(1000) = ''

  
  SELECT  @fname=@filename

  set @sql='BULK INSERT upload.dbo.SIP_Scheme_temp FROM' + '  ' + ''''+@fname+'''' + '  ' + 'WITH (FIELDTERMINATOR ='','',FirstRow=2, ROWTERMINATOR =''\n'')' 
  exec(@sql)    
  
  exec intranet.risk.dbo.SIP_Upload_Scheme @fname
        
  /*
  TRUNCATE TABLE SIP_Scheme                               
                               
  INSERT INTO SIP_Scheme(AMCCode,AMCName,SchemeCode,SchemeName,SIPTransMode,SIPFrequency,SIPDates,SIPMinGap,SIPMaxGap,SIPInstallmentGap,SIPStatus,SIPMinInstallAmt,SIPMaxInstallAmt,SIPMultiplierAmt,SIPMinInstallNo,SIPMaxInstallNo,SchemeISIN,SchemeType,Fname,FetchDatetime)    
  SELECT AMCCode,AMCName,SchemeCode,SchemeName,SIPTransMode,SIPFrequency,SIPDates,SIPMinGap,SIPMaxGap,SIPInstallmentGap,SIPStatus,SIPMinInstallAmt,SIPMaxInstallAmt,SIPMultiplierAmt,SIPMinInstallNo,SIPMaxInstallNo,SchemeISIN,SchemeType,@fname,GETDATE()                            
  FROM SIP_Scheme_temp  
  */
  TRUNCATE TABLE SIP_Scheme_temp  
  
                   
End try                               
BEGIN CATCH                                  
                              
 --insert into SIP_Error(ErrTime,ErrObject,ErrLine,ErrMessage)       
 --select GETDATE(),'SIP_Upload_Scheme',ERROR_LINE(),ERROR_MESSAGE()                                        
     
 --DECLARE @ErrorMessage NVARCHAR(4000);                                    
 --SELECT @ErrorMessage = ERROR_MESSAGE() + convert(varchar(10),error_line());                                    
 --RAISERROR (@ErrorMessage , 16, 1);       
       
End catch                     
                          
Set nocount off                    
                                
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SIP_Upload_SIP_Registration
-- --------------------------------------------------
CREATE PROC [dbo].[SIP_Upload_SIP_Registration] (@FILENAME AS VARCHAR(50))          
AS                                     
BEGIN                                    
          
Set nocount on                              
SET XACT_ABORT ON                                 
BEGIN TRY                                           

  Declare @fname varchar(100) = '',@sql varchar(1000) = ''    
  SELECT  @fname=@filename    
      
 
    set @sql='BULK INSERT upload.dbo.SIP_Registration_temp FROM' + '  ' + ''''+@fname+'''' + '  ' + 'WITH (FIELDTERMINATOR ='','',FirstRow=2, ROWTERMINATOR =''\n'', KEEPNULLS)'     
 Print @sql     
 exec(@sql)     
exec intranet.risk.dbo.SIP_Upload_SIP_Registration @filename                
TRUNCATE TABLE SIP_Registration_temp     
End try                                   
BEGIN CATCH                                      
exec intranet.risk.dbo.SIP_Upload_SIP_Registration @filename                
 /*                                 
 insert into SIP_Error(ErrTime,ErrObject,ErrLine,ErrMessage)           
 select GETDATE(),'SIP_Upload_SIP_Registration',ERROR_LINE(),ERROR_MESSAGE()                                            
         
 DECLARE @ErrorMessage NVARCHAR(4000);                                        
 SELECT @ErrorMessage = ERROR_MESSAGE() + convert(varchar(10),error_line());                                        
 RAISERROR (@ErrorMessage , 16, 1);           
   */        
End catch                         
                              
Set nocount off                        
                                    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_add_new_client
-- --------------------------------------------------
CREATE proc dbo.sp_add_new_client (@filename as varchar(45),@server as varchar(25),@product as varchar(45),@user as varchar(25))               
as                       
set nocount on   
insert into genodinlimit.dbo.tbl_add_new_client    
select *,server=@server,product=@product,flag='0',approved_by=@user  from add_new_client_temp    
              
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_connectionlog_anywhere
-- --------------------------------------------------
CREATE proc dbo.sp_connectionlog_anywhere (@filename as varchar(45))         
as                 
set nocount on         
      
    
        
insert into genodinlimit.dbo.connlog_anywhere              
select *,server1='172.31.15.51' from connlog_anywhere_temp --where dealer_id not in         
--(select dealer_id from omnesys_user_info_all)            
         
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_ctcl_omnesys
-- --------------------------------------------------
create proc dbo.sp_ctcl_omnesys (@filename as varchar(45))           
as                   
set nocount on           
        
      
          
insert into genodinlimit.dbo.ctcl_omnesys                
select *,convert(varchar(11),getdate(),103) from ctcl_omnesys_temp --where dealer_id not in           
--(select dealer_id from omnesys_user_info_all)              
           
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Sp_Dispatch_Details_ForSauda
-- --------------------------------------------------
CREATE proc Sp_Dispatch_Details_ForSauda                            
(                            
@access_to as varchar(50),                            
@access_code as varchar(50),                            
@br_code as varchar(50),                            
@Fdate as varchar(30),                            
@Tdate as varchar(30)                            
)                            
                            
as                            
                            
set @Fdate = convert(datetime,@Fdate,103)                         
set @Tdate = convert(datetime,@Tdate,103)+'23:59:59.999'                          
              
/*                          
if @access_to = 'BROKER'                            
begin                            
                            
if @br_code = 'All'                            
begin                            
set @br_code = '%%'                            
end                            
                            
select a.*,convert(varchar(12),a.date,103) as Date,b.cl_code,b.branch_cd,b.sub_broker,c.reg_code from                            
(select distinct * from tbl_clientbulkupload_record (nolock)) a                            
inner join                            
(select * from intranet.risk.dbo.client_details where branch_cd like @br_code) b                            
on a.ClientID=b.cl_code                     
inner join                           
(select * from intranet.risk.dbo.region) c                            
on b.branch_cd = c.Code                            
where date >= @Fdate and date < @Tdate                    
                
end               
              
*/    
if @access_to = 'BROKER'                     
if @br_code = 'All'                            
begin                            
set @br_code = '%%'                            
         
select a.Clientno,b.branch_cd,b.sub_broker,b.cl_code,b.long_name as ClientName,convert(varchar(12),a.DispatchDate,103) as Dispatch_Date,a.DistinationName,a.pincode,c.reg_code from                            
(select distinct * from tbl_clientbulkupload_record (nolock)) a                            
inner join                            
(select * from intranet.risk.dbo.client_details where branch_cd like  @br_code) b                            
on a.ClientID=b.cl_code                     
inner join                           
(select * from intranet.risk.dbo.region) c                            
on b.branch_cd = c.Code                            
where DispatchDate >= @Fdate and DispatchDate <= @Tdate           
end  
  
if @access_to = 'BROKER'                     
if @br_code <> 'All'      
begin                        
  
select a.Clientno,b.branch_cd,b.sub_broker,b.cl_code,b.long_name as ClientName,convert(varchar(12),a.DispatchDate,103) as Dispatch_Date,a.DistinationName,a.pincode,c.reg_code from                            
(select distinct * from tbl_clientbulkupload_record (nolock)) a                            
inner join                            
(select * from intranet.risk.dbo.client_details where branch_cd = @br_code) b                            
on a.ClientID=b.cl_code                     
inner join                           
(select * from intranet.risk.dbo.region) c                            
on b.branch_cd = c.Code                            
where DispatchDate >= @Fdate and DispatchDate <= @Tdate           
end  
  
  
              
                           
               
if @access_to = 'BRANCH'                            
begin                            
select a.Clientno,b.branch_cd,b.sub_broker,b.cl_code,b.long_name as ClientName,convert(varchar(12),a.DispatchDate,103) as Dispatch_Date,a.DistinationName,a.pincode,c.reg_code from                            
(select distinct * from tbl_clientbulkupload_record (nolock)) a                            
inner join                            
(select * from intranet.risk.dbo.client_details where branch_cd = @access_code) b                            
on a.ClientID=b.cl_code                             
inner join       
(select * from intranet.risk.dbo.region) c                            
on b.branch_cd = c.Code                            
where DispatchDate >= @Fdate and DispatchDate <= @Tdate            
end                            
                            
if @access_to = 'REGION'                            
begin                            
                            
if @br_code = 'All'                            
begin                            
set @br_code = '%%'                            
end                            
                            
select a.Clientno,b.branch_cd,b.sub_broker,b.cl_code,b.long_name as ClientName,convert(varchar(12),a.DispatchDate,103) as Dispatch_Date,a.DistinationName,a.pincode,c.reg_code from                            
(select distinct * from tbl_clientbulkupload_record (nolock)) a                            
inner join                            
(select * from intranet.risk.dbo.client_details) b                            
on a.ClientID=b.cl_code                             
inner join                             
(select * from intranet.risk.dbo.region where Reg_Code = @access_code and code like @br_code) c                            
on b.branch_cd = c.Code                           
where DispatchDate >= @Fdate and DispatchDate <= @Tdate                           
end                            
                            
if @access_to = 'SB'                            
begin                            
select a.Clientno,b.branch_cd,b.sub_broker,b.cl_code,b.long_name as ClientName,convert(varchar(12),a.DispatchDate,103) as Dispatch_Date,a.DistinationName,a.pincode,c.reg_code  from                            
--select a.*,convert(varchar(12),a.DispatchDate,103) as DispatchDate,b.cl_code,b.branch_cd,b.sub_broker,c.reg_code from                            
(select distinct * from tbl_clientbulkupload_record (nolock)) a                            
inner join                            
(select * from intranet.risk.dbo.client_details where sub_broker = @access_code) b                            
on a.ClientID=b.cl_code                             
inner join                             
(select * from intranet.risk.dbo.region ) c                            
on b.branch_cd = c.Code                            
where DispatchDate >= @Fdate and DispatchDate <= @Tdate                         
end                        
      
if @access_to = 'BRMAST'                          
begin                          
select a.Clientno,b.branch_cd,b.sub_broker,b.cl_code,b.long_name as ClientName,convert(varchar(12),a.DispatchDate,103) as Dispatch_Date,a.DistinationName,a.pincode,c.brmast_cd as reg_code from                          
(select distinct * from tbl_clientbulkupload_record (nolock)) a                          
inner join                          
(select * from intranet.risk.dbo.client_details) b                          
on a.ClientID=b.cl_code                           
inner join                           
(select * from intranet.risk.dbo.branch_master where brmast_cd = @access_code) c                          
on b.branch_cd = c.brmast_cd                         
where DispatchDate >= @Fdate and DispatchDate <= @Tdate                    
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_ebrok_connlog
-- --------------------------------------------------
CREATE proc dbo.sp_ebrok_connlog (@server as varchar(17),@filename as varchar(45))             
as                     
set nocount on   
insert into genodinlimit.dbo.ebrok_connlog   
select client_code,client_name,branch,convert(datetime,date1,103),time1,status,segment,retail,b,  
c=replace(c,  
SUBSTRING(  
c,  
CHARINDEX(')',  
c,  
LEN(c)-7)+2,  
LEN(c)),'')  
,  
d=SUBSTRING(  
c,  
CHARINDEX(')',  
c,  
LEN(c)-7)+2,  
LEN(c)),  
@server  
 from ebrok_connlog_temp   
                 
--select *,@server from ebrok_connlog_temp --where dealer_id not in             
--(select dealer_id from omnesys_user_info_all)                
             
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_omnesys_user_info
-- --------------------------------------------------
CREATE proc dbo.sp_omnesys_user_info (@filename as varchar(45))     
as             
set nocount on   
truncate table  omnesys_user_info_all    
insert into omnesys_user_info_all           
select * from omnesys_user_info --where dealer_id not in     
--(select dealer_id from omnesys_user_info_all)        
     truncate table genodinlimit.dbo.ctcl_omnesys
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_SendMail_Offline
-- --------------------------------------------------
CREATE proc SP_SendMail_Offline
(@empid as varchar(25))
as

declare @fdate as varchar(11)
set @fdate = (select convert (datetime, convert(varchar(11),max(Updt)), 103) from intranet.cms.dbo.cmsdata)

--declare @mdate as varchar(11)
--
--set @fdate = (select convert(datetime,convert(varchar(11),max(updatedon)),103) from  intranet.risk.dbo.Online_cms_ProjRisk)
--set @mdate = (select convert(varchar(11),max(markeddate)) from intranet.risk.dbo.cms_online_marked_hist where markeddate < @fdate)
--
--/* insert into actual table*/
--
--insert into dbo.tbl_CMSMails_Log  
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                  
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                  
--from
--(
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'
--)x
--inner join
--(
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'
--)y on x.party_code = y.party_code
--inner join
--(
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                  
--)z on x.party_code = z.cl_code   
--
--/**-----------end-------------------------*/  
--
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                    
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                    
--into #cltMails                    
-- from                    
--(                    
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                     
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                    
--)x                     
--inner join                    
--(                    
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                    
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                     
--)y on x.party_code = y.party_code                      
--inner join                    
--(                    
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                    
--)z on x.party_code = z.cl_code          

create table #cltMails
(IdNo int identity(1,1) NOT NULL, cltcode varchar(10), 
bse money, nse money, fo money, mcx money, ncdx money, mcd money, nsx money,
bse1 money, nse1 money, fo1 money, mcx1 money, ncdx1 money, mcd1 money, nsx1 money,
Tot1 money, Tot2 money, email varchar(50), long_name varchar(100),
updatedon datetime, mobile_pager varchar(40), Updated_Date datetime, EmpCode varchar(10))

insert into #cltMails
(cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,
bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1,
Tot1, Tot2, email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode)

select P.cltcode, P.bse, P.nse, P.fo, P.mcx, P.ncdx, P.mcd, P.nsx,
	R.bse1, R.nse1, R.fo1, R.mcx1, R.ncdx1, R.mcd1, R.nsx1,
	Tot1 = P.bse + P.nse + P.fo + P.mcx + P.ncdx + P.mcd + P.nsx,
	Tot2 = R.bse1 + R.nse1 + R.fo1 + R.mcx1 + R.ncdx1 + R.mcd1 + R.nsx1,
	C.email, C.long_name, P.updt, C.mobile_pager, getdate(), @empid
from
	(select 
		a.cltcode, a.ablcm_amt as bse, a.acdlcm_amt as nse,  a.acdlfo_amt as fo,
		a.mcdx as mcx, a.ncdx_amt as ncdx, a.mcd_amt as mcd, a.nsx_amt as nsx, a.updt
	from intranet.cms.dbo.cmsdata a with (nolock)
	where generated = 2 and chqamt > 0 
		and cltcode not in (select cltcode from intranet.cms.dbo.cms_online_marked where isnull(chqmark,'N')='N')) P

	inner join 

	(select 
		a.cltcode, a.ablcm_amt as bse1, a.acdlcm_amt as nse1,  a.acdlfo_amt as fo1,
		a.mcdx_amt as mcx1, a.ncdx_amt as ncdx1, a.mcd_amt as mcd1, a.nsx_amt as nsx1
	from intranet.cms.dbo.cmsdata_Before_after_Adj a with (nolock)
	where convert(varchar(11), a.Updatedon) = (select convert(varchar(11),max(Updatedon)) from cmsdata_Before_after_Adj)) R

	on P.cltcode = R.cltcode

	inner join (select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details) C
		ON C.cl_code = P.cltcode

insert into tbl_CMSMails_Log
	(party_code, bse, nse, fo, mcx, ncdx, mcd, nsx,
	bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,
	email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, PayType)
select cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,
	bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2, 
	email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, 'Offline'
from #cltMails

declare @party_code as varchar(50)                      
declare @cltname as varchar(100)                                                                                                      
declare @bse as varchar(50)                                                                                                      
declare @nse as varchar(100)                                                              
declare @fo as varchar(50)                                                              
declare @mcx as varchar(50)
declare @ncdx as varchar(50)
declare @mcd as varchar(50)
declare @nsx as varchar(50)
                    
declare @bse1 as varchar(50)                                                              
declare @nse1 as varchar(50)                                                              
declare @fo1 as varchar(50) 
declare @mcx1 as varchar(50)
declare @ncdx1 as varchar(50)                                                                                                                           
declare @mcd1 as varchar(50)
declare @nsx1 as varchar(50)
                    
declare @tot1 as varchar(100)                                                              
declare @tot2 as varchar(100)                                                                                                    
                    
declare @msg as varchar(5000)                    
declare @Email as varchar(100)                    
declare @status as varchar(5000)                        

declare @row_cnts int
declare @idno int

set @idno = 1
select @row_cnts = COUNT(*) from #cltMails

while @row_cnts >= @idno
begin
	select @party_code = cltcode, @cltname = long_name, @bse = bse, @nse = nse,
		@fo = fo, @mcx = mcx, @ncdx = ncdx, @mcd = mcd, @nsx = nsx,
		@bse1 = bse1, @nse1 = nse1, @fo1 = fo1, @mcx1 = mcx1, @ncdx1 = ncdx1, @mcd1 = mcd1, @nsx1 = nsx1,
		@tot1 = tot1, @tot2 = tot2, @Email = Email
	from #cltMails where idno = @idno

	--set @email = 'mgs.vadivel@angeltrade.com'

--	set @status =
--		case
--			when convert(dec(15,2),@Tot1) = convert(dec(15,2),@Tot2) then
--			' processed and transfered to your registered Bank account.'
--			when convert(dec(15,2),@Tot1) < convert(dec(15,2),@Tot2)  and convert(dec(15,2),@Tot1) > 0.00 then
--			' partially processed and transfered to your registered Bank account. The rest has been rejected due to insufficient fund.'
--			when convert(dec(15,2),@Tot1) = 0.00 then
--			' rejected due to insufficient funds'
--		end

	set @msg = 'Dear '+@cltname+',<br><br>
	This is to intimate you that a Payout Request for Rs. '+@Tot1+'/- given by you on '+@fdate+' has been processed.<br><br>
	<center>
	<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>
	<tr><td><b>Segment</b></td><td><b>Requested Amount</b></td><td><b>Processed Amount</b></td></tr>
	<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse1+'</td><td align = right>'+@bse+'</td></tr>
	<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse1+'</td><td align = right>'+@nse+'</td></tr>
	<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo1+'</td><td align = right>'+@fo+'</td></tr>
	<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx1+'</td><td align = right>'+@mcx+'</td></tr>
	<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx1+'</td><td align = right>'+@ncdx+'</td></tr>
	<tr><td><font size = 2>MCD</font></td><td align = right>'+@mcd1+'</td><td align = right>'+@mcd+'</td></tr>
	<tr><td><font size = 2>NSX</font></td><td align = right>'+@nsx1+'</td><td align = right>'+@nsx+'</td></tr>
	<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@Tot2+'</b></td><td align = right><b>'+@Tot1+'</b></td></tr>
	</table></center><br>
	<p>If there is any query related to the same please get in touch with the respective Branch.<br><br>This is a system generated mail ;                     
	Please dont send your queries to this id.</p>Happy Trading,<br><br>Angel Group of companies'

	exec usp_AutoMail_CMS @email, @msg,'' 

	set @idno = @idno + 1
end

--select cltcode,max(refno) as refno into #b from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate+' 06:00:00'
--and markeddate <= @fdate+' 06:00:00' group by cltcode
--union
--select cltcode,max(refno) as refno from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate
--and markeddate <= @fdate+' 06:00:00' and EnteredBy = 'CMS_BRANCH' group by cltcode
--
--insert into intranet.sms.dbo.sms
--select mobile_pager,case
--when Tot1 = Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Approved - Angel.'
--when Tot1 <> Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Rejected - Angel.' end,
--convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'
--from
--(select party_code,mobile_pager,Tot1,Tot2,long_name from #cltMails where mobile_pager <> '' and len(mobile_pager) = 10 and left(mobile_pager,1) = '9')x            
--inner join
--(select * from #b)y on x.party_code = y.cltcode

--insert into intranet.sms.dbo.sms
select mobile_pager, 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- has been released - Angel.',
convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'
from
	#cltMails
where mobile_pager <> ''
	and len(mobile_pager) = 10
	and (left(mobile_pager,1) = '9' OR left(mobile_pager,1) = '8')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_SendMail_Online
-- --------------------------------------------------
CREATE proc SP_SendMail_Online
(@empid as varchar(25))                  
as                  
                  
--declare @empid as varchar(25)                  
--set @empid = 'Vadivel'                  
                  
--declare @mdate as varchar(11)                  
--                  
--set @fdate = (select convert(datetime,convert(varchar(11),max(updatedon)),103) from  intranet.risk.dbo.Online_cms_ProjRisk)                  
--set @mdate = (select convert(varchar(11),max(markeddate)) from intranet.risk.dbo.cms_online_marked_hist where markeddate < @fdate)                  
--                  
--/* insert into actual table*/                  
--                  
--insert into dbo.tbl_CMSMails_Log                    
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                                    
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                                    
--from                  
--(                  
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                  
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                  
--)x                  
--inner join                  
--(                  
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                  
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                  
--)y on x.party_code = y.party_code                  
--inner join                  
--(                  
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                                    
--)z on x.party_code = z.cl_code                     
--                  
--/**-----------end-------------------------*/                    
--                  
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                                      
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                                      
--into #cltMails                                      
-- from                                      
--(                                      
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                                       
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                                      
--)x                                       
--inner join                                      
--(                                      
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                                      
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                                       
--)y on x.party_code = y.party_code                                        
--inner join                                      
--(                                      
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                                      
--)z on x.party_code = z.cl_code                            
               
        
if (select convert(varchar(11),max(Updatedon)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online) <> convert(varchar(11),getdate())        
      OR (select convert(varchar(11),max(processDate)) from intranet.cms.dbo.Verification_data_online) <> convert(varchar(11),getdate())        
      Return        
        
           
create table #cltMails                  
(IdNo int identity(1,1) NOT NULL, cltcode varchar(10),                   
bse money, nse money, fo money, mcx money, ncdx money, mcd money, nsx money,                  
bse1 money, nse1 money, fo1 money, mcx1 money, ncdx1 money, mcd1 money, nsx1 money,                  
Tot1 money, Tot2 money, email varchar(50), long_name varchar(100),                  
updatedon datetime, mobile_pager varchar(40), Updated_Date datetime, EmpCode varchar(10))                  
                  
insert into #cltMails                  
(cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,                  
bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1,                  
Tot1, Tot2, email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode)                  
                  
select P.cltcode, P.bse, P.nse, P.fo, P.mcx, P.ncdx, P.mcd, P.nsx,                  
 R.bse1, R.nse1, R.fo1, R.mcx1, R.ncdx1, R.mcd1, R.nsx1,                  
 Tot1 = P.bse + P.nse + P.fo + P.mcx + P.ncdx + P.mcd + P.nsx,                  
 Tot2 = R.bse1 + R.nse1 + R.fo1 + R.mcx1 + R.ncdx1 + R.mcd1 + R.nsx1,                  
 C.email, C.long_name, P.ProcessDate, C.mobile_pager, getdate(), @empid                  
from                  
 (select                   
  a.cltcode, a.ablcm_amt as bse, a.acdlcm_amt as nse,  a.acdlfo_amt as fo,                  
  a.mcdx as mcx, a.ncdx_amt as ncdx, a.mcd_amt as mcd, a.nsx_amt as nsx, b.ProcessDate                  
 from intranet.cms.dbo.cmsdata_hist a with (nolock)                  
  inner join intranet.cms.dbo.Verification_data_online b on a.cltcode = b.cltcode                  
 where convert(varchar(11), a.updt) = (select convert(varchar(11),max(cms_Updt)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)                  
 and generated = 2) P                  
                  
 inner join                   
                  
 (select                   
  a.cltcode, a.ablcm_amt as bse1, a.acdlcm_amt as nse1,  a.acdlfo_amt as fo1,                  
  a.mcdx_amt as mcx1, a.ncdx_amt as ncdx1, a.mcd_amt as mcd1, a.nsx_amt as nsx1                  
 from intranet.cms.dbo.cmsdata_Before_after_Adj_online a with (nolock)                  
  inner join intranet.cms.dbo.Verification_data_online b on a.cltcode = b.cltcode                  
 where convert(varchar(11), a.cms_updt) = (select convert(varchar(11),max(cms_Updt)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)) R                  

 on P.cltcode = R.cltcode                  

 inner join (select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details where upper(left(cl_code,3)) <> 'ING') C                  
  ON C.cl_code = P.cltcode  
/*Added By Prashant on Sep 17 2011 :: As per Verbel Communication with Shweta :: Reference Mail Dated Sep 17 2011 
to  exclude ING clients*/
where left(P.cltcode,3) <> 'ING'


/*  
 Change By Prashant On 02 Aug 2011  
 To Delete Records having Zero Payout Amount  
*/  
DELETE FROM #cltMails WHERE Tot1 <5  
                  
insert into tbl_CMSMails_Log                  
 (party_code, bse, nse, fo, mcx, ncdx, mcd, nsx,                  
 bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,                  
 email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, PayType)                  
select cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,                  
 bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,                   
 email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, 'Online'                  
from #cltMails                  
                  
declare @party_code as varchar(50)                                        
declare @cltname as varchar(100)                                                                                                                        
declare @bse as varchar(50)                                                                                                                        
declare @nse as varchar(100)                                                                                
declare @fo as varchar(50)                                                                                
declare @mcx as varchar(50)                  
declare @ncdx as varchar(50)                  
declare @mcd as varchar(50)                  
declare @nsx as varchar(50)                  
                  
declare @bse1 as varchar(50)                                                      
declare @nse1 as varchar(50)                                                                                
declare @fo1 as varchar(50)                   
declare @mcx1 as varchar(50)                  
declare @ncdx1 as varchar(50)                                                                     
declare @mcd1 as varchar(50)                  
declare @nsx1 as varchar(50)                  
                                      
declare @tot1 as varchar(100)                                                          
declare @tot2 as varchar(100)                                                                                                                      
                                      
declare @msg as varchar(5000)                                     
declare @Email as varchar(100)                                      
declare @status as varchar(5000)                                          
                  
declare @row_cnts int                  
declare @idno int                  
                  
declare @fdate as varchar(11)                  
set @fdate = (select convert (datetime, convert(varchar(11),max(cms_Updt)), 103) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)                  
set @fdate = convert (datetime, convert(varchar(11), getdate()))    
                  
set @idno = 1                  
select @row_cnts = COUNT(*) from #cltMails                  
                  
while @row_cnts >= @idno            
begin                  
 select @party_code = cltcode, @cltname = long_name, @bse = bse, @nse = nse,                  
  @fo = fo, @mcx = mcx, @ncdx = ncdx, @mcd = mcd, @nsx = nsx,                  
  @bse1 = bse1, @nse1 = nse1, @fo1 = fo1, @mcx1 = mcx1, @ncdx1 = ncdx1, @mcd1 = mcd1, @nsx1 = nsx1,               
  @tot1 = tot1, @tot2 = tot2, @Email = Email                  
 from #cltMails where idno = @idno                  
                  
 --set @email = 'mgs.vadivel@angeltrade.com'                  
                  
-- set @status =                  
--  case                  
--   when convert(dec(15,2),@Tot1) = convert(dec(15,2),@Tot2) then                  
--   ' processed and transfered to your registered Bank account.'                  
--   when convert(dec(15,2),@Tot1) < convert(dec(15,2),@Tot2)  and convert(dec(15,2),@Tot1) > 0.00 then                  
--   ' partially processed and transfered to your registered Bank account. The rest has been rejected due to insufficient fund.'                  
--  when convert(dec(15,2),@Tot1) = 0.00 then                  
--   ' rejected due to insufficient funds'                  
--  end                  
                  
 set @msg = 'Dear '+@cltname+' ('+ @party_code +') ,<br><br>                  
 This is to intimate you that a Payout Request for Rs. '+@Tot1+'/- processed on '+@fdate+', in the form of Fund Transfer/NEFT/RTGS has been processed and transferred to your registered Bank account.<br><br>                  
 <b>*Subject to electronic clearance by the bank </b><br><br>      
 <center>                  
 <table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                  
 <tr><td><b>Segment</b></td><td><b>Requested Amount</b></td><td><b>Processed Amount</b></td></tr>                  
 <tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse1+'</td><td align = right>'+@bse+'</td></tr>                  
 <tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse1+'</td><td align = right>'+@nse+'</td></tr>                  
 <tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo1+'</td><td align = right>'+@fo+'</td></tr>                  
 <tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx1+'</td><td align = right>'+@mcx+'</td></tr>                  
 <tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx1+'</td><td align = right>'+@ncdx+'</td></tr>                  
 <tr><td><font size = 2>MCD</font></td><td align = right>'+@mcd1+'</td><td align = right>'+@mcd+'</td></tr>                  
 <tr><td><font size = 2>NSX</font></td><td align = right>'+@nsx1+'</td><td align = right>'+@nsx+'</td></tr>                  
 <tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@Tot2+'</b></td><td align = right><b>'+@Tot1+'</b></td></tr>                  
 </table></center><br>                  
 <p>If there is any query related to the same please get in touch with the respective Branch.<br><br>This is a system generated mail ;                                       
 Please dont send your queries to this id.</p>Happy Trading,<br><br>Angel Group of companies'            
                
WAITFOR DELAY '000:00:03'              
if ltrim(rtrim(@email)) <> ''            
begin            
 exec usp_AutoMail_CMS @email, @msg,''                   
end            
                  
 set @idno = @idno + 1                  
end           
                 
--select cltcode,max(refno) as refno into #b from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate+' 06:00:00'                  
--and markeddate <= @fdate+' 06:00:00' group by cltcode                  
--union                  
--select cltcode,max(refno) as refno from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate                  
--and markeddate <= @fdate+' 06:00:00' and EnteredBy = 'CMS_BRANCH' group by cltcode                  
--                  
--insert into intranet.sms.dbo.sms                  
--select mobile_pager,case                  
--when Tot1 = Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Approved - Angel.'                  
--when Tot1 <> Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Rejected - Angel.' end,                  
--convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'                  
--from                  
--(select party_code,mobile_pager,Tot1,Tot2,long_name from #cltMails where mobile_pager <> '' and len(mobile_pager) = 10 and left(mobile_pager,1) = '9')x                              
--inner join                  
--(select * from #b)y on x.party_code = y.cltcode                  
                  
insert into intranet.sms.dbo.sms                  
select mobile_pager, 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- has been released - Angel.',                  
convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'                  
from                  
 #cltMails                  
where mobile_pager <> ''                  
 and len(mobile_pager) = 10                  
 and (left(mobile_pager,1) = '9' OR left(mobile_pager,1) = '8')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_SendMail_Online_17092011
-- --------------------------------------------------
create proc [dbo].[SP_SendMail_Online_17092011]                
(@empid as varchar(25))                
as                
                
--declare @empid as varchar(25)                
--set @empid = 'Vadivel'                
                
--declare @mdate as varchar(11)                
--                
--set @fdate = (select convert(datetime,convert(varchar(11),max(updatedon)),103) from  intranet.risk.dbo.Online_cms_ProjRisk)                
--set @mdate = (select convert(varchar(11),max(markeddate)) from intranet.risk.dbo.cms_online_marked_hist where markeddate < @fdate)                
--                
--/* insert into actual table*/                
--                
--insert into dbo.tbl_CMSMails_Log                  
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                                  
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                                  
--from                
--(                
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                
--)x                
--inner join                
--(                
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                
--)y on x.party_code = y.party_code                
--inner join                
--(                
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                                  
--)z on x.party_code = z.cl_code                   
--                
--/**-----------end-------------------------*/                  
--                
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                                    
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                                    
--into #cltMails                                    
-- from                                    
--(                                    
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                                     
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                                    
--)x                                     
--inner join                                    
--(                                    
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                                    
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                                     
--)y on x.party_code = y.party_code                                      
--inner join                                    
--(                                    
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                                    
--)z on x.party_code = z.cl_code                          
             
      
if (select convert(varchar(11),max(Updatedon)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online) <> convert(varchar(11),getdate())      
      OR (select convert(varchar(11),max(processDate)) from intranet.cms.dbo.Verification_data_online) <> convert(varchar(11),getdate())      
      Return      
      
         
create table #cltMails                
(IdNo int identity(1,1) NOT NULL, cltcode varchar(10),                 
bse money, nse money, fo money, mcx money, ncdx money, mcd money, nsx money,                
bse1 money, nse1 money, fo1 money, mcx1 money, ncdx1 money, mcd1 money, nsx1 money,                
Tot1 money, Tot2 money, email varchar(50), long_name varchar(100),                
updatedon datetime, mobile_pager varchar(40), Updated_Date datetime, EmpCode varchar(10))                
                
insert into #cltMails                
(cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,                
bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1,                
Tot1, Tot2, email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode)                
                
select P.cltcode, P.bse, P.nse, P.fo, P.mcx, P.ncdx, P.mcd, P.nsx,                
 R.bse1, R.nse1, R.fo1, R.mcx1, R.ncdx1, R.mcd1, R.nsx1,                
 Tot1 = P.bse + P.nse + P.fo + P.mcx + P.ncdx + P.mcd + P.nsx,                
 Tot2 = R.bse1 + R.nse1 + R.fo1 + R.mcx1 + R.ncdx1 + R.mcd1 + R.nsx1,                
 C.email, C.long_name, P.ProcessDate, C.mobile_pager, getdate(), @empid                
from                
 (select                 
  a.cltcode, a.ablcm_amt as bse, a.acdlcm_amt as nse,  a.acdlfo_amt as fo,                
  a.mcdx as mcx, a.ncdx_amt as ncdx, a.mcd_amt as mcd, a.nsx_amt as nsx, b.ProcessDate                
 from intranet.cms.dbo.cmsdata_hist a with (nolock)                
  inner join intranet.cms.dbo.Verification_data_online b on a.cltcode = b.cltcode                
 where convert(varchar(11), a.updt) = (select convert(varchar(11),max(cms_Updt)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)                
 and generated = 2) P                
                
 inner join                 
                
 (select                 
  a.cltcode, a.ablcm_amt as bse1, a.acdlcm_amt as nse1,  a.acdlfo_amt as fo1,                
  a.mcdx_amt as mcx1, a.ncdx_amt as ncdx1, a.mcd_amt as mcd1, a.nsx_amt as nsx1                
 from intranet.cms.dbo.cmsdata_Before_after_Adj_online a with (nolock)                
  inner join intranet.cms.dbo.Verification_data_online b on a.cltcode = b.cltcode                
 where convert(varchar(11), a.cms_updt) = (select convert(varchar(11),max(cms_Updt)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)) R                
                
 on P.cltcode = R.cltcode                
                
 inner join (select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details) C                
  ON C.cl_code = P.cltcode

/*
	Change By Prashant On 02 Aug 2011
	To Delete Records having Zero Payout Amount
*/
DELETE FROM #cltMails WHERE Tot1 <5
                
insert into tbl_CMSMails_Log                
 (party_code, bse, nse, fo, mcx, ncdx, mcd, nsx,                
 bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,                
 email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, PayType)                
select cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,                
 bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,                 
 email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, 'Online'                
from #cltMails                
                
declare @party_code as varchar(50)                                      
declare @cltname as varchar(100)                                                                                                                      
declare @bse as varchar(50)                                                                                                                      
declare @nse as varchar(100)                                                                              
declare @fo as varchar(50)                                                                              
declare @mcx as varchar(50)                
declare @ncdx as varchar(50)                
declare @mcd as varchar(50)                
declare @nsx as varchar(50)                
                
declare @bse1 as varchar(50)                                                                              
declare @nse1 as varchar(50)                                                                              
declare @fo1 as varchar(50)                 
declare @mcx1 as varchar(50)                
declare @ncdx1 as varchar(50)                                                                   
declare @mcd1 as varchar(50)                
declare @nsx1 as varchar(50)                
                                    
declare @tot1 as varchar(100)                                                        
declare @tot2 as varchar(100)                                                                                                                    
                                    
declare @msg as varchar(5000)                                   
declare @Email as varchar(100)                                    
declare @status as varchar(5000)                                        
                
declare @row_cnts int                
declare @idno int                
                
declare @fdate as varchar(11)                
set @fdate = (select convert (datetime, convert(varchar(11),max(cms_Updt)), 103) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)                
set @fdate = convert (datetime, convert(varchar(11), getdate()))  
                
set @idno = 1                
select @row_cnts = COUNT(*) from #cltMails                
                
while @row_cnts >= @idno          
begin                
 select @party_code = cltcode, @cltname = long_name, @bse = bse, @nse = nse,                
  @fo = fo, @mcx = mcx, @ncdx = ncdx, @mcd = mcd, @nsx = nsx,                
  @bse1 = bse1, @nse1 = nse1, @fo1 = fo1, @mcx1 = mcx1, @ncdx1 = ncdx1, @mcd1 = mcd1, @nsx1 = nsx1,             
  @tot1 = tot1, @tot2 = tot2, @Email = Email                
 from #cltMails where idno = @idno                
                
 --set @email = 'mgs.vadivel@angeltrade.com'                
                
-- set @status =                
--  case                
--   when convert(dec(15,2),@Tot1) = convert(dec(15,2),@Tot2) then                
--   ' processed and transfered to your registered Bank account.'                
--   when convert(dec(15,2),@Tot1) < convert(dec(15,2),@Tot2)  and convert(dec(15,2),@Tot1) > 0.00 then                
--   ' partially processed and transfered to your registered Bank account. The rest has been rejected due to insufficient fund.'                
--  when convert(dec(15,2),@Tot1) = 0.00 then                
--   ' rejected due to insufficient funds'                
--  end                
                
 set @msg = 'Dear '+@cltname+' ('+ @party_code +') ,<br><br>                
 This is to intimate you that a Payout Request for Rs. '+@Tot1+'/- processed on '+@fdate+', in the form of Fund Transfer/NEFT/RTGS has been processed and transferred to your registered Bank account.<br><br>                
 <b>*Subject to electronic clearance by the bank </b><br><br>    
 <center>                
 <table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                
 <tr><td><b>Segment</b></td><td><b>Requested Amount</b></td><td><b>Processed Amount</b></td></tr>                
 <tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse1+'</td><td align = right>'+@bse+'</td></tr>                
 <tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse1+'</td><td align = right>'+@nse+'</td></tr>                
 <tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo1+'</td><td align = right>'+@fo+'</td></tr>                
 <tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx1+'</td><td align = right>'+@mcx+'</td></tr>                
 <tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx1+'</td><td align = right>'+@ncdx+'</td></tr>                
 <tr><td><font size = 2>MCD</font></td><td align = right>'+@mcd1+'</td><td align = right>'+@mcd+'</td></tr>                
 <tr><td><font size = 2>NSX</font></td><td align = right>'+@nsx1+'</td><td align = right>'+@nsx+'</td></tr>                
 <tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@Tot2+'</b></td><td align = right><b>'+@Tot1+'</b></td></tr>                
 </table></center><br>                
 <p>If there is any query related to the same please get in touch with the respective Branch.<br><br>This is a system generated mail ;                                     
 Please dont send your queries to this id.</p>Happy Trading,<br><br>Angel Group of companies'          
              
WAITFOR DELAY '000:00:03'            
if ltrim(rtrim(@email)) <> ''          
begin          
 exec usp_AutoMail_CMS @email, @msg,''                 
end          
                
 set @idno = @idno + 1                
end         
               
--select cltcode,max(refno) as refno into #b from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate+' 06:00:00'                
--and markeddate <= @fdate+' 06:00:00' group by cltcode                
--union                
--select cltcode,max(refno) as refno from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate                
--and markeddate <= @fdate+' 06:00:00' and EnteredBy = 'CMS_BRANCH' group by cltcode                
--                
--insert into intranet.sms.dbo.sms                
--select mobile_pager,case                
--when Tot1 = Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Approved - Angel.'                
--when Tot1 <> Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Rejected - Angel.' end,                
--convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'                
--from                
--(select party_code,mobile_pager,Tot1,Tot2,long_name from #cltMails where mobile_pager <> '' and len(mobile_pager) = 10 and left(mobile_pager,1) = '9')x                            
--inner join                
--(select * from #b)y on x.party_code = y.cltcode                
                
insert into intranet.sms.dbo.sms                
select mobile_pager, 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- has been released - Angel.',                
convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'                
from                
 #cltMails                
where mobile_pager <> ''                
 and len(mobile_pager) = 10                
 and (left(mobile_pager,1) = '9' OR left(mobile_pager,1) = '8')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_SendMail_Online_bkp
-- --------------------------------------------------
    
    
CREATE proc SP_SendMail_Online_bkp              
(@empid as varchar(25))              
as              
              
--declare @empid as varchar(25)              
--set @empid = 'Vadivel'              
              
--declare @mdate as varchar(11)              
--              
--set @fdate = (select convert(datetime,convert(varchar(11),max(updatedon)),103) from  intranet.risk.dbo.Online_cms_ProjRisk)              
--set @mdate = (select convert(varchar(11),max(markeddate)) from intranet.risk.dbo.cms_online_marked_hist where markeddate < @fdate)              
--              
--/* insert into actual table*/              
--              
--insert into dbo.tbl_CMSMails_Log                
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                                
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                                
--from              
--(              
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon              
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'              
--)x              
--inner join              
--(              
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1              
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'              
--)y on x.party_code = y.party_code              
--inner join              
--(              
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                                
--)z on x.party_code = z.cl_code                 
--              
--/**-----------end-------------------------*/                
--              
--select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                                  
--Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                                  
--into #cltMails                                  
-- from                                  
--(                                  
--select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                                   
--from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                                  
--)x                                   
--inner join                                  
--(                                  
--select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                                  
--from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                                   
--)y on x.party_code = y.party_code                                    
--inner join                                  
--(                                  
--select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                                  
--)z on x.party_code = z.cl_code                        
           
    
if (select convert(varchar(11),max(Updatedon)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online) <> convert(varchar(11),getdate())    
      OR (select convert(varchar(11),max(processDate)) from intranet.cms.dbo.Verification_data_online) <> convert(varchar(11),getdate())    
      Return    
    
       
create table #cltMails              
(IdNo int identity(1,1) NOT NULL, cltcode varchar(10),               
bse money, nse money, fo money, mcx money, ncdx money, mcd money, nsx money,              
bse1 money, nse1 money, fo1 money, mcx1 money, ncdx1 money, mcd1 money, nsx1 money,              
Tot1 money, Tot2 money, email varchar(50), long_name varchar(100),              
updatedon datetime, mobile_pager varchar(40), Updated_Date datetime, EmpCode varchar(10))              
              
insert into #cltMails              
(cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,              
bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1,              
Tot1, Tot2, email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode)              
              
select P.cltcode, P.bse, P.nse, P.fo, P.mcx, P.ncdx, P.mcd, P.nsx,              
 R.bse1, R.nse1, R.fo1, R.mcx1, R.ncdx1, R.mcd1, R.nsx1,              
 Tot1 = P.bse + P.nse + P.fo + P.mcx + P.ncdx + P.mcd + P.nsx,              
 Tot2 = R.bse1 + R.nse1 + R.fo1 + R.mcx1 + R.ncdx1 + R.mcd1 + R.nsx1,              
 C.email, C.long_name, P.ProcessDate, C.mobile_pager, getdate(), @empid              
from              
 (select               
  a.cltcode, a.ablcm_amt as bse, a.acdlcm_amt as nse,  a.acdlfo_amt as fo,              
  a.mcdx as mcx, a.ncdx_amt as ncdx, a.mcd_amt as mcd, a.nsx_amt as nsx, b.ProcessDate              
 from intranet.cms.dbo.cmsdata_hist a with (nolock)              
  inner join intranet.cms.dbo.Verification_data_online b on a.cltcode = b.cltcode              
 where convert(varchar(11), a.updt) = (select convert(varchar(11),max(cms_Updt)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)              
 and generated = 2) P              
              
 inner join               
              
 (select               
  a.cltcode, a.ablcm_amt as bse1, a.acdlcm_amt as nse1,  a.acdlfo_amt as fo1,              
  a.mcdx_amt as mcx1, a.ncdx_amt as ncdx1, a.mcd_amt as mcd1, a.nsx_amt as nsx1              
 from intranet.cms.dbo.cmsdata_Before_after_Adj_online a with (nolock)              
  inner join intranet.cms.dbo.Verification_data_online b on a.cltcode = b.cltcode              
 where convert(varchar(11), a.cms_updt) = (select convert(varchar(11),max(cms_Updt)) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)) R              
              
 on P.cltcode = R.cltcode              
              
 inner join (select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details) C              
  ON C.cl_code = P.cltcode              
              
insert into tbl_CMSMails_Log              
 (party_code, bse, nse, fo, mcx, ncdx, mcd, nsx,              
 bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,              
 email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, PayType)              
select cltcode, bse, nse, fo, mcx, ncdx, mcd, nsx,              
 bse1, nse1, fo1, mcx1, ncdx1, mcd1, nsx1, Tot1, Tot2,               
 email, long_name, updatedon, mobile_pager, Updated_Date, EmpCode, 'Online'              
from #cltMails              
              
declare @party_code as varchar(50)                                    
declare @cltname as varchar(100)                                                                                                                    
declare @bse as varchar(50)                                                                                                                    
declare @nse as varchar(100)                                                                            
declare @fo as varchar(50)                                                                            
declare @mcx as varchar(50)              
declare @ncdx as varchar(50)              
declare @mcd as varchar(50)              
declare @nsx as varchar(50)              
              
declare @bse1 as varchar(50)                                                                            
declare @nse1 as varchar(50)                                                                            
declare @fo1 as varchar(50)               
declare @mcx1 as varchar(50)              
declare @ncdx1 as varchar(50)                                                                                                                                         
declare @mcd1 as varchar(50)              
declare @nsx1 as varchar(50)              
                                  
declare @tot1 as varchar(100)                                                      
declare @tot2 as varchar(100)                                                                                                                  
                                  
declare @msg as varchar(5000)                                 
declare @Email as varchar(100)                                  
declare @status as varchar(5000)                                      
              
declare @row_cnts int              
declare @idno int              
              
declare @fdate as varchar(11)              
set @fdate = (select convert (datetime, convert(varchar(11),max(cms_Updt)), 103) from intranet.cms.dbo.cmsdata_Before_after_Adj_online)              
              
set @idno = 1              
select @row_cnts = COUNT(*) from #cltMails              
              
while @row_cnts >= @idno        
begin              
 select @party_code = cltcode, @cltname = long_name, @bse = bse, @nse = nse,              
  @fo = fo, @mcx = mcx, @ncdx = ncdx, @mcd = mcd, @nsx = nsx,              
  @bse1 = bse1, @nse1 = nse1, @fo1 = fo1, @mcx1 = mcx1, @ncdx1 = ncdx1, @mcd1 = mcd1, @nsx1 = nsx1,           
  @tot1 = tot1, @tot2 = tot2, @Email = Email              
 from #cltMails where idno = @idno              
              
 --set @email = 'mgs.vadivel@angeltrade.com'              
              
-- set @status =              
--  case              
--   when convert(dec(15,2),@Tot1) = convert(dec(15,2),@Tot2) then              
--   ' processed and transfered to your registered Bank account.'              
--   when convert(dec(15,2),@Tot1) < convert(dec(15,2),@Tot2)  and convert(dec(15,2),@Tot1) > 0.00 then              
--   ' partially processed and transfered to your registered Bank account. The rest has been rejected due to insufficient fund.'              
--  when convert(dec(15,2),@Tot1) = 0.00 then              
--   ' rejected due to insufficient funds'              
--  end              
              
 set @msg = 'Dear '+@cltname+' ('+ @party_code +') ,<br><br>              
 This is to intimate you that a Payout Request for Rs. '+@Tot1+'/- given by you on '+@fdate+', in the form of Fund Transfer/NEFT/RTGS has been processed and transferred to your registered Bank account.<br><br>              
 <center>              
 <table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>              
 <tr><td><b>Segment</b></td><td><b>Requested Amount</b></td><td><b>Processed Amount</b></td></tr>              
 <tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse1+'</td><td align = right>'+@bse+'</td></tr>              
 <tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse1+'</td><td align = right>'+@nse+'</td></tr>              
 <tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo1+'</td><td align = right>'+@fo+'</td></tr>              
 <tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx1+'</td><td align = right>'+@mcx+'</td></tr>              
 <tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx1+'</td><td align = right>'+@ncdx+'</td></tr>              
 <tr><td><font size = 2>MCD</font></td><td align = right>'+@mcd1+'</td><td align = right>'+@mcd+'</td></tr>              
 <tr><td><font size = 2>NSX</font></td><td align = right>'+@nsx1+'</td><td align = right>'+@nsx+'</td></tr>              
 <tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@Tot2+'</b></td><td align = right><b>'+@Tot1+'</b></td></tr>              
 </table></center><br>              
 <p>If there is any query related to the same please get in touch with the respective Branch.<br><br>This is a system generated mail ;                                   
 Please dont send your queries to this id.</p>Happy Trading,<br><br>Angel Group of companies'        
            
WAITFOR DELAY '000:00:03'          
if ltrim(rtrim(@email)) <> ''        
begin        
 exec usp_AutoMail_CMS @email, @msg,''               
end        
              
 set @idno = @idno + 1              
end       
             
--select cltcode,max(refno) as refno into #b from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate+' 06:00:00'              
--and markeddate <= @fdate+' 06:00:00' group by cltcode              
--union              
--select cltcode,max(refno) as refno from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate              
--and markeddate <= @fdate+' 06:00:00' and EnteredBy = 'CMS_BRANCH' group by cltcode              
--              
--insert into intranet.sms.dbo.sms              
--select mobile_pager,case              
--when Tot1 = Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Approved - Angel.'              
--when Tot1 <> Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Rejected - Angel.' end,              
--convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'              
--from              
--(select party_code,mobile_pager,Tot1,Tot2,long_name from #cltMails where mobile_pager <> '' and len(mobile_pager) = 10 and left(mobile_pager,1) = '9')x                          
--inner join              
--(select * from #b)y on x.party_code = y.cltcode              
              
insert into intranet.sms.dbo.sms              
select mobile_pager, 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- has been released - Angel.',              
convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'              
from              
 #cltMails              
where mobile_pager <> ''              
 and len(mobile_pager) = 10              
 and (left(mobile_pager,1) = '9' OR left(mobile_pager,1) = '8')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_SentMail
-- --------------------------------------------------
CREATE proc SP_SentMail   
(@empid as varchar(25))  
as                
        
declare @fdate as varchar(11)                  
declare @mdate as varchar(11)          
                  
set @fdate = (select convert(datetime,convert(varchar(11),max(updatedon)),103) from  intranet.risk.dbo.Online_cms_ProjRisk)                
set @mdate = (select convert(varchar(11),max(markeddate)) from intranet.risk.dbo.cms_online_marked_hist where markeddate < @fdate)          
         
/* insert into actual table*/  

insert into dbo.tbl_CMSMails_Log
select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                
Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                
 from                
(                
select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                 
from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                
)x                 
inner join                
(                
select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                
from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                 
)y on x.party_code = y.party_code                  
inner join                
(                
select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                
)z on x.party_code = z.cl_code 

/**-----------end-------------------------*/


select x.party_code,bse,nse,fo,ncdx,mcx,bse1,nse1,fo1,ncdx1,mcx1,Tot1=bse+nse+fo+ncdx+mcx,                  
Tot2=bse1+nse1+fo1+ncdx1+mcx1,email,long_name,updatedon,mobile_pager,GETDATE() AS Updated_Date,@empid as EmpCode                  
into #cltMails                  
 from                  
(                  
select party_code,ablcm_amt as bse,acdlcm_amt as nse,acdlfo_amt as fo,ncdx_amt as ncdx,mcdx as mcx,updatedon                   
from intranet.risk.dbo.Online_cms_ProjRisk where updatedon like @fdate+'%'                  
)x                   
inner join                  
(                  
select party_code,ablcm_amt as bse1,acdlcm_amt as nse1,acdlfo_amt as fo1,ncdx_amt as ncdx1,mcdx as mcx1                  
from intranet.risk.dbo.Online_cms_ProjRisk_AfterAdj where updatedon like @fdate+'%'                   
)y on x.party_code = y.party_code                    
inner join                  
(                  
select cl_code,long_name,email=lower(email),mobile_pager from intranet.risk.dbo.client_details                  
)z on x.party_code = z.cl_code        
          
declare @party_code as varchar(50)                    
declare @cltname as varchar(100)                                                                                                    
declare @bse as varchar(50)                                                                                                    
declare @nse as varchar(100)                                                            
declare @fo as varchar(50)                                                            
declare @mcx as varchar(50)                                                            
declare @ncdx as varchar(50)                    
                  
declare @bse1 as varchar(50)                                                            
declare @nse1 as varchar(50)                                                            
declare @fo1 as varchar(50)                                                            
declare @mcx1 as varchar(50)                                                            
declare @ncdx1 as varchar(50)                                                           
                  
declare @tot1 as varchar(100)                                                            
declare @tot2 as varchar(100)                                                                                                  
                  
declare @msg as varchar(5000)                  
declare @Email as varchar(100)                  
declare @status as varchar(5000)                      
              
              
DECLARE cmsmail_cursor CURSOR FOR                   
select party_code,                  
bse=convert(varchar,bse),                  
nse=convert(varchar,nse),                  
fo=convert(varchar,fo),                  
ncdx=convert(varchar,ncdx),                  
mcx=convert(varchar,mcx),                  
bse1=convert(varchar,bse1),                  
nse1=convert(varchar,nse1),                  
fo1=convert(varchar,fo1),                  
ncdx1=convert(varchar,ncdx1),                  
mcx1=convert(varchar,mcx1),                  
Tot1=convert(varchar,Tot1),                  
Tot2=convert(varchar,Tot2),                  
email,long_name from #cltMails where email <> '' /*and party_code in ('KOLK655')*/  and (bse > 0 or nse > 0 or fo > 0 or ncdx > 0 or  mcx > 0)            
OPEN cmsmail_cursor                                                 
                                                                              
FETCH NEXT FROM cmsmail_cursor                                                                               
INTO  @party_code,@bse,@nse,@fo,@ncdx,@mcx,@bse1,@nse1,@fo1,@ncdx1,@mcx1,@Tot1,@Tot2,@email,@cltname                                                                            
                             
WHILE @@FETCH_STATUS = 0                      
BEGIN                
        
set @status =                   
case                   
when convert(dec(15,2),@Tot1) = convert(dec(15,2),@Tot2) then                
' processed and transfered to your registered Bank account.'                  
when convert(dec(15,2),@Tot2) < convert(dec(15,2),@Tot1)  and convert(dec(15,2),@Tot2) > 0.00 then                  
' partially processed and transfered to your registered Bank account. The rest has been rejected due to insufficient fund.'                  
when convert(dec(15,2),@Tot2) = 0.00 then                  
' rejected due to insufficient funds'                  
end                   
                
set @msg = 'Dear '+@cltname+',<br><br>                                                            
This is to intimate you that a Payout Request for Rs. '+@Tot1+'/- given by you on '+@fdate+', in the form of Fund Transfer has been '+@status+' .<br><br>                                                            
<center>                                                            
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                                            
<tr><td><b>Segment</b></td><td><b>Requested Amount</b></td><td><b>Processed Amount</b></td></tr>                  
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td><td align = right>'+@bse1+'</td></tr>                                                            
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td><td align = right>'+@nse1+'</td></tr>                                                            
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td><td align = right>'+@fo1+'</td></tr>                                                            
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td><td align = right>'+@mcx1+'</td></tr>                                    
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td><td align = right>'+@ncdx1+'</td></tr>                                                            
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@Tot1+'</b></td><td align = right><b>'+@Tot2+'</b></td></tr>                                                            
</table></center><br>                                                            
<p>If there is any query related to the same please get in touch with the respective Branch.<br><br>This is a system generated mail ;                   
Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                   
                  
exec usp_AutoMail_CMS  @email,@msg,''                 
--exec usp_AutoMail_CMS  'george@angeltrade.com',@msg,''                 
        
--print @msg        
                
FETCH NEXT FROM cmsmail_cursor                               
INTO @party_code,@bse,@nse,@fo,@ncdx,@mcx,@bse1,@nse1,@fo1,@ncdx1,@mcx1,@Tot1,@Tot2,@email,@cltname                                                 
                                                      
END                                                                            
                                                                            
CLOSE cmsmail_cursor                                                      
DEALLOCATE cmsmail_cursor          
          
select cltcode,max(refno) as refno into #b from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate+' 06:00:00'           
and markeddate <= @fdate+' 06:00:00' group by cltcode          
union          
select cltcode,max(refno) as refno from intranet.risk.dbo.cms_online_marked_hist where markeddate >= @mdate          
and markeddate <= @fdate+' 06:00:00' and EnteredBy = 'CMS_BRANCH' group by cltcode          
          
insert into intranet.sms.dbo.sms          
select mobile_pager,case           
when Tot1 = Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Approved - Angel.'          
when Tot1 <> Tot2 then 'Dear '+LTRIM(RTRIM(cltcode))+',your funds payout request for Rs.'+convert(varchar,Tot1)+'/- Reference No. '+convert(varchar,Refno)+' has been Rejected - Angel.' end,          
convert(varchar(11),getdate(),103),left(convert(varchar(11),getdate(),108),5),'P','','Online Funds Payout Bulk SMS'          
 from          
(select party_code,mobile_pager,Tot1,Tot2,long_name from #cltMails where mobile_pager <> '' and len(mobile_pager) = 10 and left(mobile_pager,1) = '9')x          
inner join          
(select * from #b)y on x.party_code = y.cltcode

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_SMTPMail
-- --------------------------------------------------
Create Procedure sp_SMTPMail

	@SenderName varchar(100),
	@SenderAddress varchar(100),
	@RecipientName varchar(100),
	@RecipientAddress varchar(100),
	@Subject varchar(200),
	@Body varchar(8000),
	@MailServer varchar(100) = '196.1.115.136'

	AS	
	
	SET nocount on
	
	declare @oMail int --Object reference
	declare @resultcode int
	
	EXEC @resultcode = sp_OACreate 'SMTPsvg.Mailer', @oMail OUT
	
	if @resultcode = 0
	BEGIN
		EXEC @resultcode = sp_OASetProperty @oMail, 'RemoteHost', @mailserver
		EXEC @resultcode = sp_OASetProperty @oMail, 'FromName', @SenderName
		EXEC @resultcode = sp_OASetProperty @oMail, 'FromAddress', @SenderAddress
	
		EXEC @resultcode = sp_OAMethod @oMail, 'AddRecipient', NULL, @RecipientName, @RecipientAddress
	
		EXEC @resultcode = sp_OASetProperty @oMail, 'Subject', @Subject
		EXEC @resultcode = sp_OASetProperty @oMail, 'BodyText', @Body
	
	
		EXEC @resultcode = sp_OAMethod @oMail, 'SendMail', NULL
	
		EXEC sp_OADestroy @oMail
	END	
	

	SET nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Sp_SysObj
-- --------------------------------------------------
/*  
Author :- Prashant  
Date :- 28/01/2011  
*/  
CREATE Procedure Sp_SysObj  
(  
 @objName as varchar(20),  
 @objType as varchar(3)=''  
)  
as  
Begin  
 select * from sysobjects where name like '%'+@objName+'%' and type like '%'+@objType+'%'--'%batch%'  
 order by name,type  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_Tradeanywhere_master
-- --------------------------------------------------
CREATE proc dbo.sp_Tradeanywhere_master (@filename as varchar(45))       
as               
set nocount on 
---added on 30th dec 2009-----
insert into intranet.mis.dbo.Deactivated_clients 
select b.client_code as PartyCode,servermapped='172.31.15.51',DeactivationDate=getdate(),          
username=''  from Tradeanywhere_master_temp  a right outer join 
(select client_code from testdb.dbo.Tradeanywhere_master_newver  ) b          
on a.client_code = b.client_code where a.client_code IS NULL       
------------------------------------    
truncate table testdb.dbo.Tradeanywhere_master_newver     
      
insert into testdb.dbo.Tradeanywhere_master_newver             
select * from Tradeanywhere_master_temp --where dealer_id not in       
--(select dealer_id from omnesys_user_info_all)   
--select * from intranet.mis.dbo.eBrokingClientMaster  
delete from intranet.mis.dbo.eBrokingClientMaster where server='TradeAnyWhere'   
  
insert into intranet.mis.dbo.eBrokingClientMaster   
(party_code,party_name,FT_Code1,Region,FT_Code2,FT_Code3,Branch_cd,product,window,  
Server,LastUpdatedOn)   
select client_Code,'','','','','',profile_code,'','','TradeAnyWhere',getdate()   
from testdb.dbo.tradeanywhere_master_newver (nolock)     
  
update genodinlimit.dbo.diet_cli_all  set eflag='Y'  
 where party_code in (select party_Code from intranet.mis.dbo.eBrokingClientMaster where server='TradeAnyWhere')  
  
insert into genodinlimit.dbo.diet_cli_all_hist(Date,Time,Server,Party_Code,  
Products_Allowed,Segment_Allowed_code,Insert_date,Flag,PWD,Email,Eflag,NRIFlag,  
chkodin,chknet,chkiwin,chkinv,chklite,Product_type,UserCode,IPAddress,EFlag_UserEmail)   
select Date,Time,Server,Party_Code,Products_Allowed,Segment_Allowed_code,  
Insert_date=getdate(),'A',PWD,Email,Eflag,NRIFlg,chkodin,chknet,chkiwin,chkinv,  
chklite,Product_type,UserCode,IPAddress,EFlag_UserEmail   
from genodinlimit.dbo.diet_cli_all (nolock) where EFlag = 'Y'    
and products_allowed='TradeAnywhere'     
  
delete from genodinlimit.dbo.diet_cli_all   
where EFlag = 'Y'  and products_allowed='TradeAnywhere'  
  
exec intranet.ctcl.dbo.check_tradeanywhere_master2  
       
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_UPLOADCSV
-- --------------------------------------------------
CREATE PROC SP_UPLOADCSV               
(              
@filename as varchar(100)              
)               
as                  
--print @filename      
set transaction  isolation  level read uncommitted                  
truncate table uploadtempcsv              
declare @path as varchar(200)              
declare @sql as varchar(1000)              
--set @path='G:\MIS\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
set @path='\\INHOUSEALLAPP-FS.angelone.in\D$\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
--print @filename      
--print @path      
      
SET @SQL = 'BULK INSERT uploadtempcsv FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'              
--print @SQL              
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SP_UPLOADCSV_new
-- --------------------------------------------------
CREATE PROC SP_UPLOADCSV_new               
(              
@filename as varchar(100),
@servername as varchar(100)              
)               
as                  
--print @filename      
set transaction  isolation  level read uncommitted                  
truncate table uploadtempcsvnew              
declare @path as varchar(200)              
declare @sql as varchar(1000)              
--set @path='G:\MIS\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
set @path='\\'+ @servername +'\D$\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
--print @filename      
--print @path      
      
SET @SQL = 'BULK INSERT uploadtempcsvnew FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'              
--print @SQL              
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPGetUploadData
-- --------------------------------------------------
CREATE Proc [dbo].[SPGetUploadData]    
as    
select upd_srno as [Sr No], upd_title as [Title], upd_connection as [Connection], upd_temptable as [Temporary Table],
upd_deli as [Delimeter], upd_firstrow as [First Row], upd_finSP as [Stored Procedure], upd_extension as [Extension], 
upd_info as [Information], added_by as [Added By], convert(varchar(11),convert(datetime,added_on),109) as [Added On],
Upload_format,parameter,GU_srno    
from tbl_upload

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SPInsertUploadData
-- --------------------------------------------------
CREATE proc [dbo].[SPInsertUploadData]        
@SrNo int, @Title varchar(100),@conn varchar(100),@TempTable varchar(100),@Delimeter varchar(10),@FirstRow int,@StoredProc varchar(100),@Extension varchar(100),@Info varchar(200),@Addedby varchar(100),@IP varchar(100), @upload_format varchar(2000), 
@parameter varchar(100), @gu_srno varchar(5) /* ,@ResultDisplay varchar(1) ,@ResultDisplayOpt varchar(1) */ 
as        
if @SrNo = ''        
begin        
 insert into tbl_upload values(@Title,@conn,@TempTable,@Delimeter,@FirstRow,@StoredProc,@Extension,@Info,@Addedby,getdate(),@IP,@upload_format,@parameter,@gu_srno,'N','F'/* ,@ResultDisplay,@ResultDisplayOpt*/)        
        
set @SrNo=(select upd_srno from tbl_upload where added_on=getdate())        
end        
else        
begin        
 --insert into tbl_report_history select * from tbl_report where rpt_srno=@SrNo        
        
 update tbl_upload set upd_title = @Title, upd_connection=@conn, upd_temptable = @TempTable, upd_deli =@Delimeter, upd_firstrow=@FirstRow, upd_finsp = @StoredProc, upd_extension = @Extension, upd_info = @Info, added_by = @Addedby, added_on     
= getdate(), machine_ip = @IP , upload_format=@upload_format  ,parameter = @parameter   , gu_srno=@gu_srno  /*,ResultDisplay = @ResultDisplay   , ResultDisplayOpt=@ResultDisplayOpt  */  
 where upd_srno=@SrNo        
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Spx_BrProd_Details
-- --------------------------------------------------


CREATE procedure Spx_BrProd_Details

AS

select region as Region, branch_cd as Branch, Age ,ExistingCliB2B_NoOFClis as [B2B Cli. Base],
ExistingCliB2B_PercentActivation as [B2B % Active],RevPerDayB2B as [B2B Rev], 
ExistingCliB2C_NoOFClis as [B2C Cli. Base],ExistingCliB2c_PercentActivation as [B2C % Active],
RevPerDayB2C as [B2C Rev], TotalRevenue as [Total Rev], Expense , Productivity ,
NewCliAdd_B2BClis as B2B,  NewCliAdd_B2CClis as B2C, B2B_client_base as [B2B Cl Base],
B2C_client_base as [B2C Cl Base], f_Total_revenue as [Total Rev], f_pRODUCTIVITY as [Productivity]
  from BRPRODUCTIVITY order by region,branch_cd

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_Import_FromExcel
-- --------------------------------------------------
    
    
    
    
    
    --Exec spx_Import_FromExcel '20102010.xls','.xls','127.0.0.1'
    
--Exec [spx_Import_FromExcel] '30092010.xls', '.xls' 
--Exec spx_Import_FromExcel '20102010.xls','.xls','127.0.0.1'   
    
CREATE PROCEDURE [dbo].[spx_Import_FromExcel]    
        
    @FileName varchar(100),    
    @Extension varchar(10),  
    @Server varchar(50)    
    
AS    
    
BEGIN    
 TRUNCATE TABLE tbl_temp_branchdata    
      DECLARE @SQL nvarchar(1000)    
      DECLARE @TableName varchar(50)    
      DECLARE @HDR varchar(3)    
      DECLARE @SheetName varchar(20)  
      DECLARE @FilePath varchar(500)    
       SET @SheetName='Sheet1$'    
       SET @HDR='Yes'    
       --SET @FilePath='\\196.1.115.136\d$\upload1\RETURNED\'+@FilePath --'\\'+@server+'\d$\   
         SET @FilePath='\\'+@Server+'\d$\upload1\RETURNED\'+@FileName  
       SET @TableName='tbl_temp_branchdata'  
         
--------Start Step 1. Import from Excel    
      IF OBJECT_ID (@TableName,'U') IS NOT NULL    
      BEGIN    
            SET @SQL = 'DELETE FROM ' + @TableName --to delete from temp table    
            EXEC sp_executesql @SQL    
            SET @SQL = 'INSERT INTO ' + @TableName + ' SELECT * FROM OPENDATASOURCE'    
      END       
      ELSE    
            SET @SQL = 'SELECT * INTO ' + @TableName + ' FROM OPENDATASOURCE'    
     
      IF @Extension = '.xls' --For Excel 97-03    
      BEGIN     
            SET @SQL = @SQL + '(''Microsoft.Jet.OLEDB.4.0'',''Data Source='    
            SET @SQL = @SQL + @FilePath + ';Extended Properties=''''Excel 8.0;HDR='     
      END     
      ELSE IF @Extension = '.xlsx' --For Excel 2007    
            BEGIN     
            SET @SQL = @SQL + '(''Microsoft.ACE.OLEDB.12.0'',''Data Source='    
            SET @SQL = @SQL + @FilePath + ';Extended Properties=''''Excel 12.0;HDR='     
      END     
    
    SET @SQL = @SQL + @HDR + ''''''')...['     
    SET @SQL = @SQL + @SheetName + ']'    
    
      PRINT @SQL    
      EXEC sp_executesql @SQL    
      select  count(*) as count from tbl_temp_branchdata    
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spx_sms_upload
-- --------------------------------------------------
--create table tbl_sms_type
--(
--Party_Code varchar(20),sms_type varchar(50),creation_date datetime)

--drop table tbl_sms_type
-- spx_sms_upload 'New Microsoft Office Excel Worksheet.xlsx','.xlsx','196.1.115.183','RTO WELCOME KIT'
create procedure spx_sms_upload
(

 @FileName varchar(200),                                                            
  @extension varchar(20),         
  @server varchar(200),
  --@Party_Code varchar(25),
  @sms_type  varchar(50)
  )                                                                                   
   
 as
 
  Set  XACT_ABORT oN                                                                                                                                                      
DECLARE @SQL nvarchar(1000)                                                     
DECLARE @path varchar(1000)                                                                
DECLARE @TableName varchar(200)                                                                            
DECLARE @HDR varchar(3)                                                                            
DECLARE @SheetName varchar(50)   

SET @SheetName='Sheet1$'                                                                           
SET @HDR='Yes'                                            
SET @path='\\'+@server+'\d$\upload1\SMSUPLOAD\' + @FileName                                                            
SET @TableName='[196.1.115.219].Kyc.dbo.tbl_sms_type'

--truncate table [196.1.115.219].Kyc.dbo.tbl_sms_type

create table #temp (Party_code varchar(20),sms_type varchar(50),creation_date datetime) 

SET @SQL = 'INSERT INTO  #temp (Party_Code, sms_type, creation_date)'  

  
IF @extension = '.xls' --For Excel 97-03            
          
  Begin        
   SET @SQL=@SQL+' SELECT Party_Code, '''+@sms_type+''',GetDate() FROM OPENROWSET(''MICROSOFT.Jet.OLEDB.12.0'',''EXCEL 12.0;DATABASE='                                                
                                                                             
   SET @SQL = @SQL + @path + ''',''SELECT * FROM [SHEET1$]'')'          
          
  End    
    
  ELSE IF @extension = '.xlsx' --For Excel 2007                     
BEGIN                                                               
   SET @SQL=@SQL+' SELECT Party_Code, '''+@sms_type+''',GetDate() FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='                                                
                                                                             
   SET @SQL = @SQL + @path + ''',''SELECT * FROM [Sheet1$]'')'                 
END

EXEC sp_executesql @SQL    
  
insert into [196.1.115.219].Kyc.dbo.tbl_sms_type (Party_Code, sms_type,creation_date)

select Party_code, sms_type,creation_date from #temp   

select 'Data inserted successfully...' 

--select * from [196.1.115.219].Kyc.dbo.tbl_sms_type

--select * from tbl_sms_type

GO

-- --------------------------------------------------
-- PROCEDURE dbo.srv_logfile
-- --------------------------------------------------

CREATE proc srv_logfile (@path varchar(300),@server varchar(100),@date varchar(11))                
as              
SET NOCOUNT ON       
insert into crv_log_temp select data,@path as path       
from crv_log where data like '%: Client Logged On%'      
      
delete crv_log      
      
update crv_log_temp set data=substring(data,charindex('-',data)+2,len(data))      
      
update crv_log_temp set data=replace(data,'from','@')      
      
insert into srv_log       
select pcode=substring(data,1,(charindex('@',data)-1)),      
IP1=substring(data,(charindex('@',data)-1)+2,(charindex('||',data)-1)-(charindex('@',data)-1)-1)      
,IP2=substring(data,(charindex('||',data)-1)+3,len(data)),path,server=@server,upload_date=@date     
from crv_log_temp      
      
delete crv_log_temp      
      
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.srv_report
-- --------------------------------------------------
CREATE proc srv_report (@flag varchar(5),@pcode varchar(10),@ip varchar(25),@server varchar(50))        
as                  
SET NOCOUNT ON         
      
          
if @flag='y'         
begin        
-- INSERT into #file        
         
 SELECT distinct pcode,Ip1,cnt into #file1 FROM        
 (        
 SELECT pcode,ip1,server,cnt=count(ip1)         
 from srv_log (nolock)        
 where ip1=ip2 and pcode=@pcode and LTRIM(RTRIM(IP1)) like @ip and server=@server       
 group by pcode,ip1,server        
 ) A   
 group by pcode,Ip1,cnt    
 order by pcode    
  
select a.branch_cd,a.sub_broker,b.pcode,b.ip1,b.cnt  
from #file1 b left outer join intranet.risk.dbo.client_details a  
on a.party_code=b.pcode   
      
/*and pcode=@pcode and LTRIM(RTRIM(IP1)) like @ip          
 select distinct pcode,Ip1,cnt        
 from #file         
 group by pcode,Ip1,cnt        
 order by pcode        
*/        
end        
else         
begin        
        
 select pcode,Ip=case when count(pcode)>1 then convert(varchar(6),count(pcode))        
 else max(ip1) end,cnt=sum(cnt) into #file2 FROM        
 (        
 SELECT pcode,ip1,server,cnt=count(ip1)         
 from srv_log (nolock)        
 where LTRIM(RTRIM(IP1))=LTRIM(RTRIM(IP2)) and server=@server      
 group by pcode,ip1,server        
 ) A   
 group by pcode  
 order by pcode    
  
select a.branch_cd,a.sub_broker,b.pcode,b.ip,b.cnt  
from #file2 b left outer join intranet.risk.dbo.client_details a  
on a.party_code=b.pcode 
order by b.ip desc   
       
end        
         
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.SUB_TRAINING
-- --------------------------------------------------
CREATE PROC SUB_TRAINING
AS
SET NOCOUNT ON
select distinct a.branch_tag,branch_name=replace(a.branch_name,'',''),
a.branch,a.region,a.sub_tag,a.sub_name,a.training_date,
before_date=sum(case when convert(datetime,a.training_date)>FIRST_active_date then 1 else 0 end),
after_date=sum(case when convert(datetime,a.training_date)<=FIRST_active_date then 1 else 0 end) ,
Ebefore_date=sum(case when convert(datetime,a.training_date)>FIRST_active_date AND isnull(c.party_code,'')<>'' then 1 else 0 end),
Eafter_date=sum(case when convert(datetime,a.training_date)<=FIRST_active_date AND isnull(c.party_code,'')<>'' then 1 else 0 end) 
from sb_training a (nolock) join intranet.risk.dbo.client_details b on a.sub_tag=b.sub_broker 
LEFT OUTER join genodinlimit.dbo.diet_cli_all_hist c (nolock) on  b.party_code=c.party_code 
where last_inactive_date>getdate() 
group by a.sub_tag,a.sub_name,a.training_date,a.branch_tag,a.branch_name,a.branch,a.region 
order by a.sub_tag
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_excel
-- --------------------------------------------------
create proc temp_excel (@filename as varchar(11))  as

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test_uni
-- --------------------------------------------------
create proc test_uni (@filename as varchar(25),@flag as varchar(1))
as
if(@flag= 'y')
begin
insert into tbl_test_uni select *from temp_test_uni
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test_uni1
-- --------------------------------------------------
CREATE proc test_uni1 (@filename as varchar(25))
as
insert into tbl_test_uni values (@filename,'09/09/2009')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upd_BSEequityTrades_FNL
-- --------------------------------------------------
CREATE PROC [dbo].[Upd_BSEequityTrades_FNL]                
(                
@USERNAME AS VARCHAR(11) ,              
@FILENAME AS VARCHAR(45)                 
)                
AS                
                
                
BEGIN                
set nocount oN         
    
 declare @dt as datetime = getdate()    
--set @dt = getdate()-1
     
 SELECT top 1     
 /* @dt=convert(datetime,substring([trade date],4,3)+substring([trade date],1,3)+substring([trade date],7,4)) */    
 @dt=CONVERT(datetime,  
 SUBSTRING([trade date],charindex('/',[trade date],1)+1,(charindex('/',[trade date],charindex('/',
 [trade date],1)+1))-(charindex('/',[trade date],1)+1))+'/'+  
 SUBSTRING([trade date],1,charindex('/',[trade date],1)-1)+'/'+  
 SUBSTRING([trade date],charindex('/',[trade date],charindex('/',[trade date],1)+1)+1,4)  
 )  
 FROM Upd_BSEequityTrades_TMP     
    
    
 delete from intranet.misc.dbo.BSEequityTrades where sauda_Date >=@dt and sauda_Date <=convert(varchar(11),@dt)+' 23:59:59'    
    
 INSERT INTO intranet.misc.dbo.BSEequityTrades     
 ([Sr No.],[Scrip Code],[Scrip Name],[Deal Id],[Trade No.],[Trade Date],[Trade Time],[Member Code],[Member Name],[Client Code],    
 [Client Type],[Old Client Code],[Old Client Type],[Quantity],[Price],[Value],[Trade Type],[Order No.],[Order Time],[Terminal No.],    
 [Custodian Id],[Buy/Sell],[Location Id.],[Sauda_date],[UploadedBy],[UploadedOn])    
 select     
 [Sr No.],[Scrip Code],[Scrip Name],[Deal Id],[Trade No.],[Trade Date],[Trade Time],[Member Code],[Member Name],[Client Code],    
 [Client Type],[Old Client Code],[Old Client Type],[Quantity],[Price],[Value],[Trade Type],[Order No.],[Order Time],[Terminal No.],    
 [Custodian Id],[Buy/Sell],[Location Id.],    
 /* convert(datetime,substring([trade date],4,3)+substring([trade date],1,3)+substring([trade date],7,4)+' '+left([Trade Time],13)) */  
 CONVERT(datetime,  
 SUBSTRING([trade date],charindex('/',[trade date],1)+1,(charindex('/',[trade date],charindex('/',[trade date],1)+1))-(charindex('/',[trade date],1)+1))+'/'+  
 SUBSTRING([trade date],1,charindex('/',[trade date],1)-1)+'/'+  
 SUBSTRING([trade date],charindex('/',[trade date],charindex('/',[trade date],1)+1)+1,4)  
 ) as  Sauda_date,    
 @USERNAME as UploadedBy,GETDATE() as UploadedOn    
 from Upd_BSEequityTrades_TMP     
    
 SELECT CONVERT(VARCHAR(10),COUNT(1))+' Records Uploaded.' FROM Upd_BSEequityTrades_TMP    
    
SET NOCOUNT OFF    
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upd_BSEequityTrades_FNL_bkp02Nov2016
-- --------------------------------------------------
create PROC [dbo].[Upd_BSEequityTrades_FNL_bkp02Nov2016]                
(                
@USERNAME AS VARCHAR(11) ,              
@FILENAME AS VARCHAR(45)                 
)                
AS                
                
                
BEGIN                
set nocount oN         
    
 declare @dt as datetime = getdate()    
--set @dt = getdate()-1
     
 SELECT top 1     
 /* @dt=convert(datetime,substring([trade date],4,3)+substring([trade date],1,3)+substring([trade date],7,4)) */    
 @dt=CONVERT(datetime,  
 SUBSTRING([trade date],charindex('/',[trade date],1)+1,(charindex('/',[trade date],charindex('/',
 [trade date],1)+1))-(charindex('/',[trade date],1)+1))+'/'+  
 SUBSTRING([trade date],1,charindex('/',[trade date],1)-1)+'/'+  
 SUBSTRING([trade date],charindex('/',[trade date],charindex('/',[trade date],1)+1)+1,4)  
 )  
 FROM Upd_BSEequityTrades_TMP     
    
    
 delete from intranet.misc.dbo.BSEequityTrades where sauda_Date >=@dt and sauda_Date <=convert(varchar(11),@dt)+' 23:59:59'    
    
 INSERT INTO intranet.misc.dbo.BSEequityTrades     
 ([Sr No.],[Scrip Code],[Scrip Name],[Deal Id],[Trade No.],[Trade Date],[Trade Time],[Member Code],[Member Name],[Client Code],    
 [Client Type],[Old Client Code],[Old Client Type],[Quantity],[Price],[Value],[Trade Type],[Order No.],[Order Time],[Terminal No.],    
 [Custodian Id],[Buy/Sell],[Location Id.],[Sauda_date],[UploadedBy],[UploadedOn])    
 select     
 [Sr No.],[Scrip Code],[Scrip Name],[Deal Id],[Trade No.],[Trade Date],[Trade Time],[Member Code],[Member Name],[Client Code],    
 [Client Type],[Old Client Code],[Old Client Type],[Quantity],[Price],[Value],[Trade Type],[Order No.],[Order Time],[Terminal No.],    
 [Custodian Id],[Buy/Sell],[Location Id.],    
 /* convert(datetime,substring([trade date],4,3)+substring([trade date],1,3)+substring([trade date],7,4)+' '+left([Trade Time],13)) */  
 CONVERT(datetime,  
 SUBSTRING([trade date],charindex('/',[trade date],1)+1,(charindex('/',[trade date],charindex('/',[trade date],1)+1))-(charindex('/',[trade date],1)+1))+'/'+  
 SUBSTRING([trade date],1,charindex('/',[trade date],1)-1)+'/'+  
 SUBSTRING([trade date],charindex('/',[trade date],charindex('/',[trade date],1)+1)+1,4)  
 ) as  Sauda_date,    
 @USERNAME as UploadedBy,GETDATE() as UploadedOn    
 from Upd_BSEequityTrades_TMP     
    
 SELECT CONVERT(VARCHAR(10),COUNT(1))+' Records Uploaded.' FROM Upd_BSEequityTrades_TMP    
    
SET NOCOUNT OFF    
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upd_BSEequityTrades_FNL_bkp16Nov2016
-- --------------------------------------------------
create PROC [dbo].[Upd_BSEequityTrades_FNL_bkp16Nov2016]                
(                
@USERNAME AS VARCHAR(11) ,              
@FILENAME AS VARCHAR(45)                 
)                
AS                
                
                
BEGIN                
set nocount oN         
    
 declare @dt as datetime = getdate()    
--set @dt = getdate()-1
     
 SELECT top 1     
 /* @dt=convert(datetime,substring([trade date],4,3)+substring([trade date],1,3)+substring([trade date],7,4)) */    
 @dt=CONVERT(datetime,  
 SUBSTRING([trade date],charindex('-',[trade date],1)+1,(charindex('-',[trade date],charindex('-',
 [trade date],1)+1))-(charindex('-',[trade date],1)+1))+'-'+  
 SUBSTRING([trade date],1,charindex('-',[trade date],1)-1)+'-'+  
 SUBSTRING([trade date],charindex('-',[trade date],charindex('-',[trade date],1)+1)+1,4)  
 )  
 FROM Upd_BSEequityTrades_TMP     
    
    
 delete from intranet.misc.dbo.BSEequityTrades where sauda_Date >=@dt and sauda_Date <=convert(varchar(11),@dt)+' 23:59:59'    
    
 INSERT INTO intranet.misc.dbo.BSEequityTrades     
 ([Sr No.],[Scrip Code],[Scrip Name],[Deal Id],[Trade No.],[Trade Date],[Trade Time],[Member Code],[Member Name],[Client Code],    
 [Client Type],[Old Client Code],[Old Client Type],[Quantity],[Price],[Value],[Trade Type],[Order No.],[Order Time],[Terminal No.],    
 [Custodian Id],[Buy/Sell],[Location Id.],[Sauda_date],[UploadedBy],[UploadedOn])    
 select     
 [Sr No.],[Scrip Code],[Scrip Name],[Deal Id],[Trade No.],[Trade Date],[Trade Time],[Member Code],[Member Name],[Client Code],    
 [Client Type],[Old Client Code],[Old Client Type],[Quantity],[Price],[Value],[Trade Type],[Order No.],[Order Time],[Terminal No.],    
 [Custodian Id],[Buy/Sell],[Location Id.],    
 /* convert(datetime,substring([trade date],4,3)+substring([trade date],1,3)+substring([trade date],7,4)+' '+left([Trade Time],13)) */  
 CONVERT(datetime,  
 SUBSTRING([trade date],charindex('-',[trade date],1)+1,(charindex('-',[trade date],charindex('-',[trade date],1)+1))-(charindex('-',[trade date],1)+1))+'-'+  
 SUBSTRING([trade date],1,charindex('-',[trade date],1)-1)+'-'+  
 SUBSTRING([trade date],charindex('-',[trade date],charindex('-',[trade date],1)+1)+1,4)  
 ) as  Sauda_date,    
 @USERNAME as UploadedBy,GETDATE() as UploadedOn    
 from Upd_BSEequityTrades_TMP     
    
 SELECT CONVERT(VARCHAR(10),COUNT(1))+' Records Uploaded.' FROM Upd_BSEequityTrades_TMP    
    
SET NOCOUNT OFF    
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_Collateral_NBFC
-- --------------------------------------------------
CREATE procedure upd_Collateral_NBFC(@filename as varchar(25))  
as 

declare @tdate as datetime  
set @tdate = convert(datetime,substring(@filename,3,2)+'/'+substring(@filename,1,2)+'/'+substring(@filename,5,4))  
delete from nbfc.dbo.NBFC_Collateral where tdate = @tdate  
insert into nbfc.dbo.NBFC_Collateral select *,@tdate from NBFC_Collateral_temp  
truncate table NBFC_Collateral_temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_deact_ebroking_segment
-- --------------------------------------------------
CREATE procedure dbo.upd_deact_ebroking_segment(@SERVER  as varchar(50))                                                    
as                                                 
set nocount on                                 
                                
delete from genodinlimit.DBO.deact_ebroking_segment                                 
where server=@SERVER or isnull(server,'')=''             
            
delete from EBROK_EMAIL           
where   server1=@SERVER or isnull(server1,'')=''                                           
                            
insert into genodinlimit.DBO.deact_ebroking_segment                                      
select DISTINCT pcode,User_Creation_Time='',LOGIN_ALLOWED,                                
nse=case when b.nse_1 <>'' then 1 else 0 end,                                
nsefo=case when b.NSEFO_2 <>'' then 1 else 0 end,                                
bse=case when b.BSE_8 <>'' then 1 else 0 end,                                
bsefo=case when b.BSEFO_4 <>'' then 1 else 0 end,                                
mcx=case when b.MCX_16 <>'' then 1 else 0 end,                                
ncdex=case when b.NCDX_64 <>'' then 1 else 0 end,                                
mcxsx=case when b.MCXSX_1024 <>'' then 1 else 0 end,  
nsx=0,  
SERVER=@server                             
from list_ebroking_segment A (nolock)  left outer join genodinlimit.DBO.SEG_CODE_COMBINATION B                   
on LOGIN_ALLOWED=b.total    --order by user_creation_time                
                        
update genodinlimit.DBO.deact_ebroking_segment set user_id=replace(user_id,'"','')                            
 where user_id like '%"%'                               
        
INSERT INTO EBROK_EMAIL            
SELECT DISTINCT pcode,Email,@server         
FROM  list_ebroking_segment            
                       
--select * from list_ebroking_segment                                
      
delete from  list_ebroking_segment                       
set nocount off         
      
/*CREATE procedure dbo.upd_deact_ebroking_segment(@SERVER  as varchar(50))                                                  
as                                               
set nocount on                               
                              
delete from genodinlimit.DBO.deact_ebroking_segment                               
where server=@SERVER or isnull(server,'')=''           
          
delete from EBROK_EMAIL         
where   server1=@SERVER or isnull(server1,'')=''                                         
                          
if @SERVER='172.31.15.13' or @SERVER='172.31.15.51'                             
begin                                        
insert into genodinlimit.DBO.deact_ebroking_segment                                    
select DISTINCT User_Id,User_Creation_Time='',pcode as login_allowed,                              
nse=case when pcode like '%NSE%' then 1 else 0 end,                              
nsefo=case when pcode like '%FNO%' then 1 else 0 end,                              
bse=case when pcode like '%BSE%' then 1 else 0 end,                              
bsefo=0,                              
mcx=case when pcode like '%MCX%'  then 1 else 0 end,                              
ncdex=case when pcode like '%NCDEX%' then 1 else 0 end,                              
mcxsx=case when pcode like '%MCXSX%' then 1 else 0 end,                              
nsx=case when pcode like '%NSX%' then 1 else 0 end,SERVER=@SERVER                               
from list_ebroking_segment_anywhere  (nolock)                   
                
                    
                      
update genodinlimit.DBO.deact_ebroking_segment set user_id=replace(user_id,'"','')                          
 where user_id like '%"%'                             
UPDATE genodinlimit.DBO.deact_ebroking_segment SET MCX=1 where login_allowed='MCX'                       
                       
select * from list_ebroking_segment_anywhere                      
              
 end                             
else                            
begin                            
insert into genodinlimit.DBO.deact_ebroking_segment             
select DISTINCT User_Id=a.group_id,User_Creation_Time='',LOGIN_ALLOWED=a.I,                              
nse=case when b.nsecm <>'' then 1 else 0 end,                              
nsefo=case when b.nsefo <>'' then 1 else 0 end,                              
bse=case when b.bsecm <>'' then 1 else 0 end,                              
bsefo=case when b.bsefo <>'' then 1 else 0 end,                              
mcx=case when b.mcx <>'' then 1 else 0 end,                              
ncdex=case when b.ncdex <>'' then 1 else 0 end,                              
--mcxsx=case when b.nsecm <>'' then 1 else 0 end,nsx=case when b.nsecm <>'' then 1 else 0 end,                
mcxsx=0,nsx=0,SERVER=@server                           
from list_ebroking_segment A (nolock)  left outer join intranet.ctcl.dbo.ctclsegmentcombination_TEMP B                 
on a.I=b.total    --order by user_creation_time              
                      
update genodinlimit.DBO.deact_ebroking_segment set user_id=replace(user_id,'"','')                          
 where user_id like '%"%'                             
--UPDATE genodinlimit.DBO.deact_ebroking_segment SET MCX=1 where login_allowed='MCX'                         
INSERT INTO EBROK_EMAIL          
SELECT DISTINCT GROUP_ID,ALIAS_DEALERID,@server FROM  list_ebroking_segment          
          
                     
select * from list_ebroking_segment                              
end                     
                    
--delete from  list_ebroking_segment15                      
delete from  list_ebroking_segment_anywhere                      
delete from  list_ebroking_segment                      
set nocount off */  
  
  
/*select distinct BSECM,NSECM,NSEFO,MCX,NCDEX,BSEFO,TOTAL,MCXSX   
from  intranet.ctcl.dbo.ctclsegmentcombination_TEMP*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_deact_ebroking_segment_temp
-- --------------------------------------------------
CREATE procedure dbo.upd_deact_ebroking_segment_temp(@SERVER  as varchar(50))                                            
as                                         
set nocount on                         
                        
delete from genodinlimit.DBO.deact_ebroking_segment                         
where server=@SERVER or isnull(server,'')=''     
    
delete from EBROK_EMAIL   
where   server1=@SERVER or isnull(server1,'')=''                                   
                    
/*if @SERVER='172.31.15.13' or @SERVER='172.31.15.51'                       
begin                                  
insert into genodinlimit.DBO.deact_ebroking_segment                              
select DISTINCT User_Id,User_Creation_Time='',pcode as login_allowed,                        
nse=case when pcode like '%NSE%' then 1 else 0 end,                        
nsefo=case when pcode like '%FNO%' then 1 else 0 end,                        
bse=case when pcode like '%BSE%' then 1 else 0 end,                        
bsefo=0,                        
mcx=case when pcode like '%MCX%'  then 1 else 0 end,                        
ncdex=case when pcode like '%NCDEX%' then 1 else 0 end,                        
mcxsx=case when pcode like '%MCXSX%' then 1 else 0 end,                        
nsx=case when pcode like '%NSX%' then 1 else 0 end,SERVER=@SERVER                         
from list_ebroking_segment_temp_anywhere  (nolock)             
          
              
                
update genodinlimit.DBO.deact_ebroking_segment set user_id=replace(user_id,'"','')                    
 where user_id like '%"%'                       
UPDATE genodinlimit.DBO.deact_ebroking_segment SET MCX=1 where login_allowed='MCX'                 
                 
select * from list_ebroking_segment_temp_anywhere                
                                        
 end                       
else                      
begin  */                    
insert into genodinlimit.DBO.deact_ebroking_segment                              
select DISTINCT pcode,User_Creation_Time='',LOGIN_ALLOWED,                        
nse=case when b.nsecm <>'' then 1 else 0 end,                        
nsefo=case when b.nsefo <>'' then 1 else 0 end,                        
bse=case when b.bsecm <>'' then 1 else 0 end,                        
bsefo=case when b.bsefo <>'' then 1 else 0 end,                        
mcx=case when b.mcx <>'' then 1 else 0 end,                        
ncdex=case when b.ncdex <>'' then 1 else 0 end,                        
mcxsx=0,nsx=0,SERVER=@server                     
from list_ebroking_segment_temp A (nolock)  left outer join intranet.ctcl.dbo.ctclsegmentcombination_TEMP B           
on LOGIN_ALLOWED=b.total    --order by user_creation_time        
                
update genodinlimit.DBO.deact_ebroking_segment set user_id=replace(user_id,'"','')                    
 where user_id like '%"%'                       

INSERT INTO EBROK_EMAIL    
SELECT DISTINCT pcode,Email,@server 
FROM  list_ebroking_segment_temp    
               
select * from list_ebroking_segment_temp                        
/*end               
              
--delete from  list_ebroking_segment_temp15                
delete from  list_ebroking_segment_temp_anywhere*/
delete from  list_ebroking_segment_temp                
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ECN_LOWBROK_delivered
-- --------------------------------------------------
CREATE procedure upd_ECN_LOWBROK_delivered(@filename as varchar(25))                    
as                 
set nocount on              
              
update INTRANET.MISC.DBO.LOW_BROK_CLI_DISPATCHSTATUS           
set delivered_dt=convert(datetime,a.delivered_dt,103),delivered_status='delivered' from ECN_LOWBROK_delivered a                   
where party_code=a.client_code  and a.client_code not in     
(select party_code from INTRANET.MISC.DBO.LOW_BROK_CLI_DISPATCHSTATUS)      
       
        
--begin tran                
set nocount off              
truncate table ECN_LOWBROK_delivered

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ECN_LOWBROK_DISPATCH
-- --------------------------------------------------
CREATE procedure upd_ECN_LOWBROK_DISPATCH(@filename as varchar(25))                  
as               
set nocount on            
            
insert into INTRANET.MISC.DBO.LOW_BROK_CLI_DISPATCHSTATUS       
select POD_NO,dispatch_dt=convert(datetime,dispatch_dt,103),desitination,        
client_name,pincode,party_code,delivered_dt='',delivered_status='',reason_return=''   
from ECN_LOWBROK_DISPATCH                  
where party_code not in (select party_code from INTRANET.MISC.DBO.LOW_BROK_CLI_DISPATCHSTATUS  
 WHERE PARTY_CODE IS NOT NULL)                
--begin tran              
set nocount off            
truncate table ECN_LOWBROK_DISPATCH

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ECN_LOWBROK_returned
-- --------------------------------------------------
CREATE procedure upd_ECN_LOWBROK_returned(@filename as varchar(25))                        
as                     
set nocount on                  
  insert into logs1 values  ('upd_ECN_LOWBROK_returned-s')              
update INTRANET.MISC.DBO.LOW_BROK_CLI_DISPATCHSTATUS               
set delivered_dt=convert(datetime,a.delivered_dt,103),delivered_status='returned',reason_return=a.reason from ECN_LOWBROK_RETURNED a (nolock)                      
where party_code=a.client_code and a.client_code not in           
(select party_code from INTRANET.MISC.DBO.LOW_BROK_CLI_DISPATCHSTATUS where delivered_status='delivered')            
            
--begin tran                    
set nocount off                  
truncate table ECN_LOWBROK_RETURNED 

  insert into logs1 values  ('upd_ECN_LOWBROK_returned-s')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_Market_Share
-- --------------------------------------------------
CREATE procedure [dbo].[upd_Market_Share](@filename as varchar(25))                        
as                        
                    
--select * into #tbl_market_share from tbl_market_share                     
--where convert(datetime,fld_tradedate,103) not in                     
--(select fld_tradedate from MIDDLEWARE.dashboard.dbo.tbl_market_share)                    
        
delete from [ABVSINSURANCEBO].dashboard.dbo.tbl_market_share where fld_tradedate in        
(select convert(datetime,fld_tradedate,103) from tbl_market_share)        
        
select * into #tbl_market_share         
from tbl_market_share                     
where convert(datetime,fld_tradedate,103) not in                     
(select fld_tradedate from [ABVSINSURANCEBO].dashboard.dbo.tbl_market_share)        
                    
select                       
convert(datetime,Fld_TradeDate,103) as Fld_TradeDate,                      
convert(money,Fld_BSEExchangeTo) as Fld_BSEExchangeTo ,                      
convert(money,Fld_BSEAngelTo) as Fld_BSEAngelTo,                      
convert(decimal(18,2),Fld_BSEShare) as Fld_BSEShare,                      
convert(money,Fld_BSEGrossDel) as Fld_BSEGrossDel,                      
convert(money,Fld_BSEAngelInfin) as Fld_BSEAngelInfin ,                      
convert(money,Fld_NSEExchangeTo) as Fld_NSEExchangeTo,                      
convert(money,Fld_NSEAngelTo) as Fld_NSEAngelTo,                      
convert(decimal(18,2),Fld_NSEShare) as Fld_NSEShare ,                      
convert(money,Fld_NSEGrossDel) as Fld_NSEGrossDel,                      
convert(money,Fld_NSEAngelInfin) as Fld_NSEAngelInfin,                      
convert(money,Fld_FOExchangeTo) as Fld_FOExchangeTo,                      
convert(money,Fld_FOAngelTo) as Fld_FOAngelTo,                      
convert(decimal(18,2),Fld_FOShare) as Fld_FOShare,                      
convert(money,Fld_FOAngelInfin) as Fld_FOAngelInfin,                      
convert(money,Fld_TotalExchangeTO) as Fld_TotalExchangeTO ,                      
convert(money,Fld_TotalAngelTO) as Fld_TotalAngelTO,                      
convert(decimal(18,2),Fld_TotalShare) as Fld_TotalShare ,                      
convert(money,Fld_TotalGrosssDel) as Fld_TotalGrosssDel,                      
convert(money,Fld_TotalInfinDel) as Fld_TotalInfinDel,                      
convert(decimal(18,2),Fld_TotalPerShare) as Fld_TotalPerShare,                      
convert(money,Fld_NcdexExchangeTo) as Fld_NcdexExchangeTo,                      
convert(money,Fld_NcdexAngelTo) as Fld_NcdexAngelTo,                      
convert(decimal(18,2),Fld_NcdexShare) as Fld_NcdexShare ,                      
convert(money,Fld_McxExchangeTo) as Fld_McxExchangeTo,                      
convert(money,Fld_McxAngelTo) as Fld_McxAngelTo,                      
convert(decimal(18,2),Fld_McxShare) as Fld_McxShare,                      
convert(money,Fld_TotalCommAngelTO) as Fld_TotalCommAngelTO ,                      
convert(money,Fld_TotalAngelGrosssDel) as Fld_TotalAngelGrosssDel,                      
convert(decimal(18,2),Fld_TotalCommShare) as Fld_TotalCommShare,                      
convert(money,Fld_CurNSEExchangeTo) as Fld_CurNSEExchangeTo ,                      
convert(money,Fld_CurNSEAngelTo) as Fld_CurNSEAngelTo,                      
convert(decimal(18,2),Fld_CurNSEShare) as Fld_CurNSEShare ,                      
convert(money,Fld_CurMcxExchangeTo) as Fld_CurMcxExchangeTo ,                      
convert(money,Fld_CurMcxAngelTo) as Fld_CurMcxAngelTo ,                      
convert(decimal(18,2),Fld_CurMcxShare) as Fld_CurMcxShare ,                      
convert(money,Fld_CurTotalExchangeTo) as Fld_CurTotalExchangeTo,                      
convert(money,Fld_CurTotalAngelTo) as Fld_CurTotalAngelTo,                      
convert(decimal(18,2),Fld_CurTotalAngelPer) as Fld_CurTotalAngelPer ,                      
convert(money,Fld_GrandExchangesTotal) as Fld_GrandExchangesTotal ,                      
convert(money,Fld_GrandAngelTotal) as Fld_GrandAngelTotal,                    
convert(money,Fld_GrandPer) as Fld_GrandPer                      
into #tbl_market_share_New         
from #tbl_market_share                     
                
                
declare @count int                     
set @count = (select count(*) from #tbl_market_share)                    
                    
if @count > 0                    
begin                     
insert into [ABVSINSURANCEBO].dashboard.dbo.tbl_market_share                       
(                      
Fld_TradeDate,Fld_BSEExchangeTo,Fld_BSEAngelTo,Fld_BSEShare,                      
Fld_BSEGrossDel,Fld_BSEAngelInfin,Fld_NSEExchangeTo,                      
Fld_NSEAngelTo,Fld_NSEShare,Fld_NSEGrossDel,Fld_NSEAngelInfin,                      
Fld_FOExchangeTo,Fld_FOAngelTo,Fld_FOShare,Fld_FOAngelInfin,Fld_TotalExchangeTO,                      
Fld_TotalAngelTO,Fld_TotalShare,Fld_TotalGrosssDel,Fld_TotalInfinDel,                      
Fld_TotalPerShare,Fld_NcdexExchangeTo,Fld_NcdexAngelTo,Fld_NcdexShare,                      
Fld_McxExchangeTo,Fld_McxAngelTo,Fld_McxShare,Fld_TotalCommAngelTO,               
Fld_TotalAngelGrosssDel,Fld_TotalCommShare,Fld_CurNSEExchangeTo,                      
Fld_CurNSEAngelTo,Fld_CurNSEShare,Fld_CurMcxExchangeTo,                      
Fld_CurMcxAngelTo,Fld_CurMcxShare,Fld_CurTotalExchangeTo,Fld_CurTotalAngelTo,                      
Fld_CurTotalAngelPer,Fld_GrandExchangesTotal,Fld_GrandAngelTotal,Fld_GrandPer                      
)                      
select                       
Fld_TradeDate,Fld_BSEExchangeTo ,Fld_BSEAngelTo,Fld_BSEShare,Fld_BSEGrossDel,Fld_BSEAngelInfin ,                
Fld_NSEExchangeTo,Fld_NSEAngelTo,Fld_NSEShare ,Fld_NSEGrossDel,Fld_NSEAngelInfin,Fld_FOExchangeTo,                
Fld_FOAngelTo,Fld_FOShare,Fld_FOAngelInfin,Fld_TotalExchangeTO , Fld_TotalAngelTO,Fld_TotalShare ,                
Fld_TotalGrosssDel,Fld_TotalInfinDel,Fld_TotalPerShare,Fld_NcdexExchangeTo,Fld_NcdexAngelTo,                
Fld_NcdexShare ,Fld_McxExchangeTo,Fld_McxAngelTo,Fld_McxShare,Fld_TotalCommAngelTO ,                
Fld_TotalAngelGrosssDel,Fld_TotalCommShare,Fld_CurNSEExchangeTo ,Fld_CurNSEAngelTo,                
Fld_CurNSEShare ,Fld_CurMcxExchangeTo ,Fld_CurMcxAngelTo , Fld_CurMcxShare ,Fld_CurTotalExchangeTo,                
Fld_CurTotalAngelTo,Fld_CurTotalAngelPer ,Fld_GrandExchangesTotal,Fld_GrandAngelTotal,Fld_GrandPer                
from #tbl_market_share_New                      
end                    
                
select * into #tbl_market_share_update from tbl_market_share                     
where convert(datetime,fld_tradedate,103) in                     
(select fld_tradedate from [ABVSINSURANCEBO].dashboard.dbo.tbl_market_share)                 
                
                
select                       
convert(datetime,Fld_TradeDate,103) as Fld_TradeDate_Update,                      
convert(money,Fld_BSEExchangeTo) as Fld_BSEExchangeTo ,                      
convert(money,Fld_BSEAngelTo) as Fld_BSEAngelTo,                      
convert(decimal(18,2),Fld_BSEShare) as Fld_BSEShare,                      
convert(money,Fld_BSEGrossDel) as Fld_BSEGrossDel,                      
convert(money,Fld_BSEAngelInfin) as Fld_BSEAngelInfin ,                      
convert(money,Fld_NSEExchangeTo) as Fld_NSEExchangeTo,                      
convert(money,Fld_NSEAngelTo) as Fld_NSEAngelTo,                      
convert(decimal(18,2),Fld_NSEShare) as Fld_NSEShare ,                      
convert(money,Fld_NSEGrossDel) as Fld_NSEGrossDel,                      
convert(money,Fld_NSEAngelInfin) as Fld_NSEAngelInfin,                      
convert(money,Fld_FOExchangeTo) as Fld_FOExchangeTo,                      
convert(money,Fld_FOAngelTo) as Fld_FOAngelTo,                      
convert(decimal(18,2),Fld_FOShare) as Fld_FOShare,                      
convert(money,Fld_FOAngelInfin) as Fld_FOAngelInfin,                      
convert(money,Fld_TotalExchangeTO) as Fld_TotalExchangeTO ,                      
convert(money,Fld_TotalAngelTO) as Fld_TotalAngelTO,                      
convert(decimal(18,2),Fld_TotalShare) as Fld_TotalShare ,                      
convert(money,Fld_TotalGrosssDel) as Fld_TotalGrosssDel,                      
convert(money,Fld_TotalInfinDel) as Fld_TotalInfinDel,            
convert(decimal(18,2),Fld_TotalPerShare) as Fld_TotalPerShare,                      
convert(money,Fld_NcdexExchangeTo) as Fld_NcdexExchangeTo,                      
convert(money,Fld_NcdexAngelTo) as Fld_NcdexAngelTo,                      
convert(decimal(18,2),Fld_NcdexShare) as Fld_NcdexShare ,                      
convert(money,Fld_McxExchangeTo) as Fld_McxExchangeTo,                      
convert(money,Fld_McxAngelTo) as Fld_McxAngelTo,                      
convert(decimal(18,2),Fld_McxShare) as Fld_McxShare,                      
convert(money,Fld_TotalCommAngelTO) as Fld_TotalCommAngelTO ,                      
convert(money,Fld_TotalAngelGrosssDel) as Fld_TotalAngelGrosssDel,                      
convert(decimal(18,2),Fld_TotalCommShare) as Fld_TotalCommShare,                      
convert(money,Fld_CurNSEExchangeTo) as Fld_CurNSEExchangeTo ,                      
convert(money,Fld_CurNSEAngelTo) as Fld_CurNSEAngelTo,                      
convert(decimal(18,2),Fld_CurNSEShare) as Fld_CurNSEShare ,                      
convert(money,Fld_CurMcxExchangeTo) as Fld_CurMcxExchangeTo ,                      
convert(money,Fld_CurMcxAngelTo) as Fld_CurMcxAngelTo ,                      
convert(decimal(18,2),Fld_CurMcxShare) as Fld_CurMcxShare ,                      
convert(money,Fld_CurTotalExchangeTo) as Fld_CurTotalExchangeTo,                      
convert(money,Fld_CurTotalAngelTo) as Fld_CurTotalAngelTo,            convert(decimal(18,2),Fld_CurTotalAngelPer) as Fld_CurTotalAngelPer ,                      
convert(money,Fld_GrandExchangesTotal) as Fld_GrandExchangesTotal ,                      
convert(money,Fld_GrandAngelTotal) as Fld_GrandAngelTotal,                      
convert(money,Fld_GrandPer) as Fld_GrandPer                      
into #tbl_market_share_update_New from #tbl_market_share_update                
                
                
declare @count1 int                     
set @count1 = (select count(*) from #tbl_market_share_update)                    
if @count1 > 0                    
begin                   
update [ABVSINSURANCEBO].dashboard.dbo.tbl_market_share                    
set                      
Fld_BSEExchangeTo = #tbl_market_share_update_New.Fld_BSEExchangeTo  ,                      
Fld_BSEAngelTo = #tbl_market_share_update_New.Fld_BSEAngelTo ,                      
Fld_BSEShare = #tbl_market_share_update_New.Fld_BSEShare ,                      
Fld_BSEGrossDel = #tbl_market_share_update_New.Fld_BSEGrossDel ,                      
Fld_BSEAngelInfin = #tbl_market_share_update_New.Fld_BSEAngelInfin,                      
Fld_NSEExchangeTo = #tbl_market_share_update_New.Fld_NSEExchangeTo,                      
Fld_NSEAngelTo = #tbl_market_share_update_New.Fld_NSEAngelTo,                      
Fld_NSEShare = #tbl_market_share_update_New.Fld_NSEShare ,                      
Fld_NSEGrossDel = #tbl_market_share_update_New.Fld_NSEGrossDel ,                      
Fld_NSEAngelInfin = #tbl_market_share_update_New.Fld_NSEAngelInfin ,                      
Fld_FOExchangeTo = #tbl_market_share_update_New.Fld_FOExchangeTo ,                      
Fld_FOAngelTo = #tbl_market_share_update_New.Fld_FOAngelTo ,                      
Fld_FOShare = #tbl_market_share_update_New.Fld_FOShare ,               
Fld_FOAngelInfin = #tbl_market_share_update_New.Fld_FOAngelInfin ,                      
Fld_TotalExchangeTO = #tbl_market_share_update_New.Fld_TotalExchangeTO  ,                      
Fld_TotalAngelTO = #tbl_market_share_update_New.Fld_TotalAngelTO ,                      
Fld_TotalShare = #tbl_market_share_update_New.Fld_TotalShare ,                      
Fld_TotalGrosssDel = #tbl_market_share_update_New.Fld_TotalGrosssDel ,                      
Fld_TotalInfinDel = #tbl_market_share_update_New.Fld_TotalInfinDel ,                      
Fld_TotalPerShare = #tbl_market_share_update_New.Fld_TotalPerShare,                      
Fld_NcdexExchangeTo = #tbl_market_share_update_New.Fld_NcdexExchangeTo ,                      
Fld_NcdexAngelTo = #tbl_market_share_update_New.Fld_NcdexAngelTo,                      
Fld_NcdexShare = #tbl_market_share_update_New.Fld_NcdexShare,                      
Fld_McxExchangeTo = #tbl_market_share_update_New.Fld_McxExchangeTo,                      
Fld_McxAngelTo = #tbl_market_share_update_New.Fld_McxAngelTo,                      
Fld_McxShare = #tbl_market_share_update_New.Fld_McxShare,                      
Fld_TotalCommAngelTO = #tbl_market_share_update_New.Fld_TotalCommAngelTO,                      
Fld_TotalAngelGrosssDel = #tbl_market_share_update_New.Fld_TotalAngelGrosssDel,                      
Fld_TotalCommShare = #tbl_market_share_update_New.Fld_TotalCommShare,                      
Fld_CurNSEExchangeTo = #tbl_market_share_update_New.Fld_CurNSEExchangeTo,                      
Fld_CurNSEAngelTo = #tbl_market_share_update_New.Fld_CurNSEAngelTo,                      
Fld_CurNSEShare = #tbl_market_share_update_New.Fld_CurNSEShare,                      
Fld_CurMcxExchangeTo = #tbl_market_share_update_New.Fld_CurMcxExchangeTo,                      
Fld_CurMcxAngelTo = #tbl_market_share_update_New.Fld_CurMcxAngelTo,                      
Fld_CurMcxShare = #tbl_market_share_update_New.Fld_CurMcxShare ,                      
Fld_CurTotalExchangeTo = #tbl_market_share_update_New.Fld_CurTotalExchangeTo ,                      
Fld_CurTotalAngelTo = #tbl_market_share_update_New.Fld_CurTotalAngelTo ,                      
Fld_CurTotalAngelPer = #tbl_market_share_update_New.Fld_CurTotalAngelPer ,                      
Fld_GrandExchangesTotal = #tbl_market_share_update_New.Fld_GrandExchangesTotal ,                     
Fld_GrandAngelTotal = #tbl_market_share_update_New.Fld_GrandAngelTotal ,                      
Fld_GrandPer = #tbl_market_share_update_New.Fld_GrandPer                    
from #tbl_market_share_update_New where                   
Fld_TradeDate = #tbl_market_share_update_New.Fld_TradeDate_Update                
end                  
                  
truncate table tbl_market_share      
      
Exec [ABVSINSURANCEBO].DASHBOARD.dbo.USP_MOBILE_MARKETSHARE      
    
Exec [ABVSINSURANCEBO].DASHBOARD.dbo.USP_DRM_ENTERPRISE_MARKETSHARE

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_mcdx_margin
-- --------------------------------------------------
CREATE PROCEDURE [DBO].[UPD_MCDX_MARGIN](@FILENAME AS VARCHAR(50))                  
AS                  
BEGIN TRY            
 ---------------------INSERT NEW CP-----------------------        
IF(ISDATE( CONVERT(DATETIME,SUBSTRING(@FILENAME,4,2)+'/'+SUBSTRING(@FILENAME,6,2)+'/'+SUBSTRING(@FILENAME,8,4)))=1)      
BEGIN              
 DELETE FROM MCX_MARGIN WHERE FILENAME=@FILENAME          
 INSERT INTO MCX_MARGIN(SYMBOL,EXPIRYDATE,PRICE,MULTIPLIER,IM,SBM,SSM,AML,AMS,TENDERM,TM,ICV,margin,FILENAME,UPD_DATE)  
 SELECT SYMBOL,EXPIRYDATE,PRICE,MULTIPLIER,IM,SBM,SSM,AML,AMS,TENDERM,TM,ICV,margin,@FILENAME,GETDATE()   
 FROM TEMP_MCDX_MARGIN          
   
   
 EXEC MCDX_MARGIN_MAIL 'SUCCESS'        
 TRUNCATE TABLE TEMP_MCDX_MARGIN          
END       
END TRY            
BEGIN CATCH            
 EXEC MCDX_MARGIN_MAIL 'FAIL'         
 TRUNCATE TABLE TEMP_MCDX_MARGIN          
END CATCH            
          
    -----------------insert CP in History data---------------              
--insert into History.dbo.MCX_Margin select * from general.dbo.MCX_Margin

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_nbfc_position
-- --------------------------------------------------
create procedure upd_nbfc_position(@filename as varchar(25))
as

declare @tdate as datetime
set @tdate = convert(datetime,substring(@filename,3,2)+'/'+substring(@filename,1,2)+'/'+substring(@filename,5,4))
delete from nbfc.dbo.NBFC_Del_POSITION where tdate = @tdate
insert into nbfc.dbo.NBFC_Del_POSITION select @tdate,* from NBFC_Del_POSITION_temp
truncate table NBFC_Del_POSITION_temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ncdx_margin
-- --------------------------------------------------
CREATE  PROCEDURE [DBO].[UPD_NCDX_MARGIN](@FILENAME AS VARCHAR(50))                
AS                
BEGIN TRY          
 ---------------------INSERT NEW CP-----------------------            
IF(ISDATE( CONVERT(DATETIME,SUBSTRING(@FILENAME,6,2)+'/'+SUBSTRING(@FILENAME,8,2)+'/'+SUBSTRING(@FILENAME,10,4)))=1)    
BEGIN        
 DELETE FROM NCDEX_MARGIN WHERE FILENAME=@FILENAME        
   
   
   
 INSERT INTO NCDEX_MARGIN(SYMBOL,EXPIRYDATE,PRICE,MULTIPLIER,IM,EM,APEM,TM,AML,AMS,SCML,SCMS,ICV,margin,FILENAME,UPD_DATE)   
 SELECT SYMBOL,EXPIRYDATE,PRICE,MULTIPLIER,IM,EM,APEM,TM,AML,AMS,SCML,SCMS,ICV,margin,@FILENAME,GETDATE()   
 FROM TEMP_NCDX_MARGIN        
   
   
 EXEC NCDX_MARGIN_MAIL 'SUCCESS'      
 TRUNCATE TABLE TEMP_NCDX_MARGIN        
END      
END TRY          
BEGIN CATCH          
 EXEC NCDX_MARGIN_MAIL 'FAIL'      
 TRUNCATE TABLE TEMP_NCDX_MARGIN        
END CATCH          
        
    -----------------INSERT CP IN HISTORY DATA---------------            
--INSERT INTO HISTORY.DBO.MCX_MARGIN SELECT * FROM GENERAL.DBO.MCX_MARGIN

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPD_Now_UserInfo_Upload
-- --------------------------------------------------
CREATE procedure  UPD_Now_UserInfo_Upload(@filename as varchar(100))      
as      
      
set nocount on      
 /*  
 delete from [196.1.115.245].general_new.dbo.NOW_UserInfo_Upload      
       
 insert into [196.1.115.245].general_new.dbo.NOW_UserInfo_Upload      
 */  
   
 delete from [CSOKYC-6].general.dbo.NOW_UserInfo_Upload      
   
 insert into [CSOKYC-6].general.dbo.NOW_UserInfo_Upload  
 Select       
 ltrim(rtrim([Type])) ,      
 ltrim(rtrim(BrokerId)) ,      
 ltrim(rtrim(substring(BranchId,0,charindex('-',BranchId,0)))) ,      
 ltrim(rtrim(substring(DealerId,0,charindex('-',DealerId,0)))) ,      
 ltrim(rtrim(substring(ClientGroup,0,charindex('-',ClientGroup,0)))) ,      
 ltrim(rtrim(substring(ClientId,0,charindex('-',ClientId,0)))) ,      
 ltrim(rtrim(Privilege))      
 from NOW_UserInfo_Upload_temp    
      
Set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_rel
-- --------------------------------------------------
CREATE procedure upd_rel    
as                      
SET NOCOUNT ON                      
                      
DECLARE @dnfrom as varchar(25),    
@dnto as varchar(25),@circle as varchar(50),    
@brtag as varchar(25),@std as varchar(25),    
@tel as varchar(25)    
                    
DECLARE error_cursor CURSOR FOR                       
--SELECT branchtag,dnfrom,dnto,std,TelecomCircle from reliance order by branchTag    
SELECT branchtag=branch,dnfrom=[from],dnto=[to],std,TelecomCircle=circle from reliance1 order by branchTag    
                      
OPEN error_cursor                      
         
set @tel =''    
                 
FETCH NEXT FROM error_cursor                       
INTO @brtag,@dnfrom,@dnto,@std,@Circle                  
                      
WHILE @@FETCH_STATUS = 0                      
BEGIN           
      
      
 while convert(int,@dnfrom) <= convert(int,@dnto)     
 begin    
 set @tel = @std+@dnfrom    
 insert into RELNO select @Circle,@brtag,@dnfrom,ltrim(rtrim(@std))    
 set @dnfrom=ltrim(rtrim(convert(varchar(25),convert(int,@dnfrom)+1)))    
 end    
           
  FETCH NEXT FROM error_cursor                       
  INTO @brtag,@dnfrom,@dnto,@std,@Circle                  
                      
END                     
                      
CLOSE error_cursor                      
DEALLOCATE error_cursor

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_Sify_Return_file
-- --------------------------------------------------
CREATE procedure upd_Sify_Return_file(@filename as varchar(25))                
as             
                 
         
set nocount on          
          
insert into Sify_Return_fin 
select party_code,convert(datetime,Udate,121),Status,getdate() from Sify_Return_temp                
where party_code not in (select party_code from Sify_Return_fin where status='COMPLETED')              
            
            
--begin tran            
set nocount off          
           
update intranet.misc.dbo.sifyclient set SifyActStatus='A',SifyActDt=getdate() where party_code            
in (select party_code from Sify_Return_temp where status like '%COMPLETED%' or status like '%User already exists%' )
and SifyActStatus<>'A'             
            
truncate table Sify_Return_temp               

--commit tran

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_tempCNT1
-- --------------------------------------------------
CREATE proc [dbo].[upd_tempCNT1]                     
          
 @filename nvarchar (100),@str nvarchar (1000) ,@localadd as varchar(15)                   
as                    
-- set @filename='asd.csv'          
-- set @str=''          
--set @localadd     ='196.1.115.136'          
declare @path as varchar(100)                    
set @path='\\'+@localadd+'\d$\upload1\cntbulk\' + @filename                   
set @str = 'BULK                     
INSERT call_trade_bulk_Temp                    
        FROM '''+@path+'''                  
            WITH                    
    (                    
                FIELDTERMINATOR = '','',                    
                ROWTERMINATOR = ''\n''                    
    )                    
'                    
exec (@str)                    
                    
                    
select e.party_code as [Party Code],e.[Branch Code],e.[Sub Broker],e.Product,e.Scheme,        
--Type= case when f.b2c_sb is null then 'B2B' else 'B2C' end ,    
Type= case f.b2c   when 'N' then 'B2B' else 'B2C' end ,    
 [Current Active Server] = e.odin_server        
into #tempfile         
from                     
(                    
 select distinct c.*, Product = case when d.odin_server = 'Anywhere' then  'Anywhere'                          
    when d.odin_server = '172.31.15.15' then 'Angel Trade'                          
    when d.odin_server is null then 'No Product'                          
    else  'Angel Diet' end ,Scheme = case when d.odin_server = 'Anywhere' then  '2'                          
    when d.odin_server = '172.31.15.15' then '1'                          
    when d.odin_server is null then '0'                          
    else  '2' end  ,d.odin_server                   
 from                    
 (                    
 select a.* ,b.branch_cd as [Branch Code],b.sub_broker as [Sub broker] from                    
  (                    
   select party_code from call_trade_bulk_Temp (nolock)                
  )a                    
  left outer join                    
  (                    
   select branch_cd,sub_broker,party_code from intranet.risk.dbo.client_details where branch_cd <> 'calnt'                
  ) b                    
  on a.party_code=b.party_code                    
 )c                    
 left outer join                     
 (                    
  select * from intranet.ctcl.dbo.ebrok_client                    
 ) d                    
 on c.party_code=d.party_code                    
)e                    
left outer join                    
(select party_code,b2c from intranet.risk.dbo.client_details )f                    
on e.party_code=f.party_code                    
   order by  e.party_code               
                    
select * from #tempfile                    
                    
delete from call_trade_bulk_Temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_tempCNT1_new
-- --------------------------------------------------
CREATE proc [dbo].[upd_tempCNT1_new]               
    
 @filename nvarchar (100),@str nvarchar (1000) ,@localadd as varchar(15)             
as              
-- set @filename='asd.csv'    
-- set @str=''    
--set @localadd     ='196.1.115.136'    
declare @path as varchar(100)              
set @path='\\'+@localadd+'\d$\upload1\cntbulk\' + @filename             
set @str = 'BULK               
INSERT call_trade_bulk_Temp              
        FROM '''+@path+'''            
            WITH              
    (              
                FIELDTERMINATOR = '','',              
                ROWTERMINATOR = ''\n''              
    )              
'              
exec (@str)              
              
              
select e.party_code as [Party Code],e.[Branch Code],e.[Sub Broker],e.Product,e.Scheme,  
Type= case when f.b2c_sb is null then 'B2B' else 'B2C' end , [Current Active Server] = e.odin_server  
into #tempfile   
from               
(              
 select distinct c.*, Product = case when d.odin_server = 'Anywhere' then  'Anywhere'                    
    when d.odin_server = '172.31.15.15' then 'Angel Trade'                    
    when d.odin_server is null then 'No Product'                    
    else  'Angel Diet' end ,Scheme = case when d.odin_server = 'Anywhere' then  '2'                    
    when d.odin_server = '172.31.15.15' then '1'                    
    when d.odin_server is null then '0'                    
    else  '2' end  ,d.odin_server             
 from              
 (              
 select a.* ,b.branch_cd as [Branch Code],b.sub_broker as [Sub broker] from              
  (              
   select party_code from call_trade_bulk_Temp (nolock)          
  )a              
  left outer join              
  (              
   select branch_cd,sub_broker,party_code from intranet.risk.dbo.client_details where branch_cd <> 'calnt'          
  ) b              
  on a.party_code=b.party_code              
 )c              
 left outer join               
 (              
  select * from intranet.ctcl.dbo.ebrok_client              
 ) d              
 on c.party_code=d.party_code              
)e              
left outer join              
(select * from MIS.remisior.dbo.B2C_sb)f              
on e.party_code=f.b2c_sb              
   order by  e.party_code         
              
select * from #tempfile              
              
delete from call_trade_bulk_Temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPD_USERLIST_DEACT_EBROKING_SEGMENT
-- --------------------------------------------------
/*
	167/UPLOAD
*/
CREATE PROCEDURE DBO.UPD_USERLIST_DEACT_EBROKING_SEGMENT(@BATCHID INT)
AS
SET NOCOUNT ON
    
    SELECT MANAGERIP
        INTO #SERVERLIST
    FROM INTRANET.MIS.DBO.USERLIST_BATCHES_MANAGER_LOG WITH(NOLOCK)
    WHERE BATCHID = @BATCHID AND NOOFRECORDS > 0
    
    SELECT PCODE,LOGIN_ALLOWED,SERVERMAPPED
        INTO #USER_LIST
    FROM   INTRANET.MIS.DBO.USERLIST_UPLOADED_FILES_TMP A WITH(NOLOCK)
            INNER JOIN #SERVERLIST B
              ON A.SERVERMAPPED = B.MANAGERIP
    /*
        DELETE FROM EBROK_EMAIL
        WHERE SERVER1=@SERVER OR ISNULL(SERVER1,'')=''
    */
    
    DELETE A
    FROM GENODINLIMIT.DBO.DEACT_EBROKING_SEGMENT A 
        INNER JOIN #SERVERLIST B
            ON A.SERVER = B.MANAGERIP
    
    INSERT INTO GENODINLIMIT.DBO.DEACT_EBROKING_SEGMENT
    SELECT DISTINCT
            REPLACE(PCODE,'"',''),
            USER_CREATION_TIME='',
            LOGIN_ALLOWED,
            NSE=CASE WHEN B.NSE_1 <>'' THEN 1 ELSE 0 END,
            NSEFO=CASE WHEN B.NSEFO_2 <>'' THEN 1 ELSE 0 END,
            BSE=CASE WHEN B.BSE_8 <>'' THEN 1 ELSE 0 END,
            BSEFO=CASE WHEN B.BSEFO_4 <>'' THEN 1 ELSE 0 END,
            MCX=CASE WHEN B.MCX_16 <>'' THEN 1 ELSE 0 END,
            NCDEX=CASE WHEN B.NCDX_64 <>'' THEN 1 ELSE 0 END,
            MCXSX=CASE WHEN B.MCXSX_1024 <>'' THEN 1 ELSE 0 END,
            NSX=0,
            SERVER=SERVERMAPPED
    --FROM LIST_EBROKING_SEGMENT A (NOLOCK)
    FROM #USER_LIST A WITH(NOLOCK)
        LEFT OUTER JOIN GENODINLIMIT.DBO.SEG_CODE_COMBINATION B WITH(NOLOCK)
            ON LOGIN_ALLOWED=B.TOTAL
    --ORDER BY USER_CREATION_TIME
    /*
        UPDATE GENODINLIMIT.DBO.DEACT_EBROKING_SEGMENT 
            SET USER_ID=REPLACE(USER_ID,'"','')
        WHERE USER_ID LIKE '%"%'
    */
    
    /*
        INSERT INTO EBROK_EMAIL
        SELECT DISTINCT PCODE,EMAIL,@SERVER
        FROM  LIST_EBROKING_SEGMENT
    */
    
    --SELECT * FROM LIST_EBROKING_SEGMENT
    --DELETE FROM  LIST_EBROKING_SEGMENT
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UpdCNT_Upload
-- --------------------------------------------------
CREATE proc UpdCNT_Upload(@filename as varchar(11))  
as                      
--supriya                      
insert into kyc.dbo.tbl_call_trade  
--(sr_no,client_id,product_id,from_date,to_date,flag,entry_by,amount,reqdate,type)                  
--values   
--(  
select distinct a.party_code, cast(replace(a.scheme,' ','') as int),  
getdate(), '2049-12-03 00:00:00.000','A','Bulk',0 ,'Bulk Upload',getdate(),type=case when b.party_code is null then 'Offline' else 'Online' end                     
 from                
(SELECT party_code,scheme from mis.upload.dbo.temp_CNT2Bulk where party_code not in (select client_id from kyc.dbo.tbl_caLL_TRADE where flag in ('2','A'))) a                      
left outer join                      
(select * from intranet.ctcl.dbo.ebrok_client) b                      
on a.party_code=b.party_code               
              
delete  from temp_CNT2Bulk

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UpdCNT_Upload_new
-- --------------------------------------------------
              
CREATE proc UpdCNT_Upload_new(@filename as varchar(11))                      
as                  
begin                  
/*    
to mantain log    
*/    
insert into temp_CNT2Bulk_log     
select *,GETDATE() from temp_CNT2Bulk    
  
 /* Add online clients from ebrok_client in call n trade */                  
 --insert into kyc.dbo.tbl_call_trade                  
 select distinct a.party_code, scheme=cast(replace(a.scheme,' ','') as int),               
 from_date=getdate(), to_date='2049-12-03 00:00:00.000',flag='A',entry_by='Bulk',amount=0 ,remark='Bulk Upload',  
 req_date=getdate(),              
 type=case when b.party_code is null then 'Offline' else 'Online' end  
 into #cntinsert  
 from                                
 (SELECT party_code,scheme from mis.upload.dbo.temp_CNT2Bulk where party_code not in               
 (select client_id from ABVSKYCMIS.kyc.dbo.tbl_caLL_TRADE where flag in ('2','A'))) a                                      
 left outer join                                      
 (select * from intranet.ctcl.dbo.ebrok_client) b                                      
 on a.party_code=b.party_code                                      
 where b.party_code is null                  
                   
insert into ABVSKYCMIS.kyc.dbo.tbl_call_trade    
select *  
from #cntinsert  
  
  
 /* Rejected client list */                  
 --truncate table temp_failed                   
delete from cnt_failed_upload       
where convert(datetime,generatedate) >=convert(datetime,convert(varchar(11),GETDATE())+' 00:00:00')       
and convert(datetime,generatedate)<= convert(datetime,convert(varchar(11),GETDATE())+' 23:59:59')      
  
                   
insert into cnt_failed_upload  
select *,GETDATE(),'' from temp_CNT2Bulk where party_code not in (select party_code from #cntinsert)  
  
UPDATE cnt_failed_upload   
SET SERVERMAPPED = odin_server  
from intranet.ctcl.dbo.ebrok_client a   
where a.party_code=cnt_failed_upload.party_code   
and  isnull(cnt_failed_upload.servermapped,'')=''  
            
delete from temp_CNT2Bulk              
               
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UpdCNT_Upload_new_r
-- --------------------------------------------------
CREATE proc UpdCNT_Upload_new_r(@filename as varchar(11))                  
as              
begin              
 /* Add online clients from ebrok_client in call n trade */              
 insert into kyc.dbo.tbl_call_trade_r              
 select distinct a.party_code, cast(replace(a.scheme,' ','') as int),           
 getdate(), '2049-12-03 00:00:00.000','A','Bulk',0 ,'Bulk Upload',getdate(),          
 type=case when b.party_code is null then 'Offline' else 'Online' end                                 
 from                            
 (SELECT party_code,scheme from mis.upload.dbo.temp_CNT2Bulk_r where party_code not in           
 (select client_id from kyc.dbo.tbl_caLL_TRADE_r where flag in ('2','A'))) a                                  
 left outer join                                  
 (select * from intranet.ctcl.dbo.ebrok_client) b                                  
 on a.party_code=b.party_code                                  
 where b.party_code is null              
               
 /* Rejected client list */              
 --truncate table temp_failed               
delete from temp_failed_r   
where convert(datetime,generatedate) >=convert(datetime,convert(varchar(11),GETDATE())+' 00:00:00')   
and convert(datetime,generatedate)<= convert(datetime,convert(varchar(11),GETDATE())+' 23:59:59')  
               
insert into temp_failed_r               
select a.*,GETDATE(),servermapped=b.odin_server         
from temp_CNT2Bulk_r a        
left outer join         
intranet.ctcl.dbo.ebrok_client b        
on a.Party_code =b.party_code        
where a.Party_code not in           
(select client_id from kyc.dbo.tbl_call_trade_r)              
        
 delete from temp_CNT2Bulk_r          
           
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.updCNT_Upload1
-- --------------------------------------------------
  
CREATE proc updCNT_Upload1  
as  
insert into #tempfile  
select e.*,Type= case when f.b2c_sb is null then 'B2B' else 'B2C' end from  
(  
 select distinct c.*, Product = case when d.odin_server = 'Anywhere' then  'Anywhere'        
    when d.odin_server = '172.31.15.15' then 'Angel Trade'        
    when d.odin_server is null then 'No Product'        
    else  'Angel Diet' end ,Scheme = case when d.odin_server = 'Anywhere' then  '2'        
    when d.odin_server = '172.31.15.15' then '1'        
    when d.odin_server is null then '0'        
    else  '2' end   
 from  
 (  
 select a.*,b.branch_cd,b.sub_broker from  
  (  
   select * from mis.upload.dbo.call_trade_bulk_Temp  
  )a  
  left outer join  
  (  
   select branch_cd,sub_broker,party_code from intranet.risk.dbo.client_details  
  ) b  
  on a.party_code=b.party_code  
 )c  
 left outer join   
 (  
  select * from intranet.ctcl.dbo.ebrok_client  
 ) d  
 on c.party_code=d.party_code  
)e  
left outer join  
(select * from MIS.remisior.dbo.B2C_sb)f  
on e.party_code=f.b2c_sb

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_BSE_BlockScript
-- --------------------------------------------------
CREATE Procedure Upload_BSE_BlockScript (@filename as varchar(45) )      
as      
      
set nocount on       
truncate table BSEBlockScript      
insert into BSEBlockScript       
Select SCRIPCODE,EXCHNAGE,SYMBOL,SCRIPNAME,EQUITY_DEBENTURE,SCRIPGROUP,TICKSIZE,Status,ISINNO,'N' from BSE_BlockScript_Temp_upload      
    
insert into intranet.risk.dbo.upload_block_file values ('BSEEx',getdate(),'')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_bseblock_Master
-- --------------------------------------------------
CREATE proc Upload_bseblock_Master(                                  
@filename as varchar(100),          
@server as varchar(20)                                        
)                                    
as                      
declare @path as varchar(100)  
declare @sql as varchar(1000)  
                   
delete from intranet.misc.dbo.tbl_bse_blockscrips  
  
create table #temp(
symbol varchar(50),  
sc_code varchar(50),    
sc_group varchar(50)  
)                
  
set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename  
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'  
---print @SQL                                  
exec (@sql)  
                                 
insert into intranet.misc.dbo.tbl_bse_blockscrips  
Select * from #temp  
  
select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_BSX_CONTRACTFILE
-- --------------------------------------------------


    
CREATE PROCEDURE [dbo].[UPLOAD_BSX_CONTRACTFILE] (@FILENAME AS VARCHAR(45))            
AS            
    SET NOCOUNT ON            
          
    TRUNCATE TABLE BSXBLOCKSCRIPT             
            
    INSERT INTO BSXBLOCKSCRIPT          
    SELECT CONTRACTTOKENNUMBER,            
           ASSETTOKENNUMBER,            
           INSTRUMENT,            
           SYMBOL,            
           SERIES,            
           FILLER,            
           EXPIRYDATE, --= CONVERT (DATETIME, ( ( ( CONVERT(BIGINT, EXPIRYDATE) ) / 86400 ) + 29221 - 2 ), 106),-- AS FORMULA DIVIDE THAT NUMBER BY 86400 & ADD 29221. CONVERT THE RESULT TO DATE FORMAT              
           STRIKEPRICE,            
           OPTIONTYPE,            
           PRECISION_1 CALEVEL,            
           FILLER_1,            
           ADMISSIONTYPE,            
           ISSUERATE,            
           TRADINGSTATUS_N,            
           ELIGIBILITY_N,            
           FILLER_N,            
           TRADINGSTATUS,            
           ELIGIBILITY,            
           FILLER_2,            
           TRADINGSTATUS_S,            
           ELIGIBILITY_S,            
           FILLER_3,            
           TRADINGSTATUS_A,            
           ELIGIBILITY_A,            
           FILLER_A,            
           ISSUESTART,            
           SETTLEMENT,            
           CONTRACTMATURITY,            
           MARGINPERCENTAGE,            
           MINIMUMLOTSIZE,            
           BOARDLOTQUANTITY,            
           TICKSIZE,            
           ISSUEDCAPITAL,            
           VOLUMEFREEZEQUANTITY,            
           WARNINGQUANTITY,            
           ADMISSIONDATE,            
           EXPULSIONDATE,            
           READMISSIONDATE,            
           RECORDDATE,            
           NODELIVERYSTARTDATE,            
           NODELIVERYENDDATE,            
           OPERATINGRANGE_LOW,            
           OPERATINGRAGE_HIGH,            
           EXDATE,            
           BOOKCLOSURESTARTDATE,            
           BOOKCLOSUREENDDATE,            
           UPDATEDATEANDTIME,            
           EXERCISESTARTDATE,            
           EXERCISEENDDATE,            
           TICKERSELECTION,            
           QUANTITYMULTIPLIER,            
           CREDITRATING,            
           STOCKNAME,            
           CORPORATEPURPOSE_AGMEGM,            
           CORPORATEPURPOSE_INTERESTDIVIDEND,            
           CORPORATEPURPOSE_RIGHTSBONUS,            
           SPECIALTERMS,            
           REMARKS,            
           EXERCISESTYLE,            
           EXERCISEALLOWED,            
           EXERCISEREJECTIONALLOWED,            
           POSITIONLIQUIDATIONALLOWED,            
           CHECKSUM,            
           CORPORATEACTIONADJUSTED,            
           UNDERLYINGASSETSYMBOL,            
           ASSETINSTRUMENT,            
           BASEPRICE,            
           DELETEFLAG,        
           GETDATE()        
    FROM   BSX_BLOCKSCRIPT_TEMP_UPLOAD            
    WHERE            
      EXPIRYDATE NOT IN ( '0', '-1' )            
            
    INSERT INTO INTRANET.RISK.DBO.UPLOAD_BLOCK_FILE VALUES('BSX',GETDATE(),'')            
            
            
    SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_BSX_CONTRACTFILE_24042018
-- --------------------------------------------------
  
Create PROCEDURE [dbo].[UPLOAD_BSX_CONTRACTFILE_24042018] (@FILENAME AS VARCHAR(45))          
AS          
    SET NOCOUNT ON          
        
    TRUNCATE TABLE BSXBLOCKSCRIPT           
          
    INSERT INTO BSXBLOCKSCRIPT        
    SELECT CONTRACTTOKENNUMBER,          
           ASSETTOKENNUMBER,          
           INSTRUMENT,          
           SYMBOL,          
           SERIES,          
           FILLER,          
           EXPIRYDATE = CONVERT (DATETIME, ( ( ( CONVERT(BIGINT, EXPIRYDATE) ) / 86400 ) + 29221 - 2 ), 106),-- AS FORMULA DIVIDE THAT NUMBER BY 86400 & ADD 29221. CONVERT THE RESULT TO DATE FORMAT            
           STRIKEPRICE,          
           OPTIONTYPE,          
           PRECISION_1 CALEVEL,          
           FILLER_1,          
           ADMISSIONTYPE,          
           ISSUERATE,          
           TRADINGSTATUS_N,          
           ELIGIBILITY_N,          
           FILLER_N,          
           TRADINGSTATUS,          
           ELIGIBILITY,          
           FILLER_2,          
           TRADINGSTATUS_S,          
           ELIGIBILITY_S,          
           FILLER_3,          
           TRADINGSTATUS_A,          
           ELIGIBILITY_A,          
           FILLER_A,          
           ISSUESTART,          
           SETTLEMENT,          
           CONTRACTMATURITY,          
           MARGINPERCENTAGE,          
           MINIMUMLOTSIZE,          
           BOARDLOTQUANTITY,          
           TICKSIZE,          
           ISSUEDCAPITAL,          
           VOLUMEFREEZEQUANTITY,          
           WARNINGQUANTITY,          
           ADMISSIONDATE,          
           EXPULSIONDATE,          
           READMISSIONDATE,          
           RECORDDATE,          
           NODELIVERYSTARTDATE,          
           NODELIVERYENDDATE,          
           OPERATINGRANGE_LOW,          
           OPERATINGRAGE_HIGH,          
           EXDATE,          
           BOOKCLOSURESTARTDATE,          
           BOOKCLOSUREENDDATE,          
           UPDATEDATEANDTIME,          
           EXERCISESTARTDATE,          
           EXERCISEENDDATE,          
           TICKERSELECTION,          
           QUANTITYMULTIPLIER,          
           CREDITRATING,          
           STOCKNAME,          
           CORPORATEPURPOSE_AGMEGM,          
           CORPORATEPURPOSE_INTERESTDIVIDEND,          
           CORPORATEPURPOSE_RIGHTSBONUS,          
           SPECIALTERMS,          
           REMARKS,          
           EXERCISESTYLE,          
           EXERCISEALLOWED,          
           EXERCISEREJECTIONALLOWED,          
           POSITIONLIQUIDATIONALLOWED,          
           CHECKSUM,          
           CORPORATEACTIONADJUSTED,          
           UNDERLYINGASSETSYMBOL,          
           ASSETINSTRUMENT,          
           BASEPRICE,          
           DELETEFLAG,      
           GETDATE()      
    FROM   BSX_BLOCKSCRIPT_TEMP_UPLOAD          
    WHERE          
      EXPIRYDATE NOT IN ( '0', '-1' )          
          
    INSERT INTO INTRANET.RISK.DBO.UPLOAD_BLOCK_FILE VALUES('BSX',GETDATE(),'')          
          
          
    SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_CLT_PREMIUMDATA
-- --------------------------------------------------
             
                                              
CREATE PROC UPLOAD_CLT_PREMIUMDATA                                                
(                                                  
@ACCESS_TO AS VARCHAR(11) = NULL,                                                  
@ACCESS_CODE AS VARCHAR(11) = NULL,                                                  
@USERNAME AS VARCHAR(11) = NULL,                                                
@FILENAME AS VARCHAR(45) = NULL                                                
)                                                  
AS                                                     
BEGIN                                   
                                  
--IF (SELECT COUNT(1) FROM CLT_PREMIUMDATA_TEMP                                
--WHERE [CLIENT CODE] Like '%[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]%') > 0                        
----WHERE [CLIENT CODE] LIKE '%[^a-zA-Z0-9]%') > 0                                  
----WHERE [CLIENT CODE] NOT LIKE '[A-Z0-9]') > 0                          
--BEGIN                                
-- RAISERROR ('Special character exists in client Code.',16,1);                                
--END                                
--ELSE                                 
--BEGIN                                                  
-- if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))                     
--and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'10:15')))                    
                    
--begin                    
--     Raiserror ('Upload Not Allowed till 12 PM',16,0);                    
--end               
           
  --else          
 --  begin     
 declare @IsBlock as nvarchar      
declare @IsPremium as nvarchar                        
select @IsBlock = Block from [INTRANET].CMS.DBO.TBL_Verifier_Status with  (nolock)      
select @IsPremium = Premium from [INTRANET].CMS.DBO.TBL_Verifier_Status with (nolock)      
    
 IF(@IsBlock = 'Y' AND @IsPremium = 'Y')  
 begin                         
INSERT INTO [INTRANET].CMS.DBO.CLT_PREMIUMDATA_HIST                                                    
SELECT *,GETDATE() AS HISTDATE FROM [INTRANET].CMS.DBO.CLT_PREMIUMDATA                                                    
                                                    
DELETE FROM [INTRANET].CMS.DBO.CLT_PREMIUMDATA                                                    
                                                    
INSERT INTO [INTRANET].CMS.DBO.CLT_PREMIUMDATA                                                    
SELECT                                       
ISNULL([Ro Code],'') AS [Ro Code],                                      
ISNULL([Branch Code],'') AS  [Branch Code],                                      
ISNULL([Family Code],'') AS [Family Code],                                      
ISNULL([Sub Group Code],'') AS  [Sub Group Code],                                      
--ISNULL([Client Code],'') AS  [Client Code],                                      
LTRIM(RTRIM(ISNULL([Client Code],''))) AS  [Client Code],                                      
ISNULL([Client Name],'') AS  [Client Name],                                      
ISNULL(Convert(money,[Ledger Balance]),0) AS  [Ledger Balance],                                      
ISNULL(Convert(money,[Holding]),0) AS  [Holding],                                      
ISNULL(Convert(money,[POA]),0) AS  [POA],                                      
ISNULL(Convert(money,[Today MTM]),0) AS  [Today MTM],                                      
ISNULL(Convert(money,[Logical MTM]),0) AS  [Logical MTM],                                      
ISNULL(Convert(money,[Fut. MTM]),0) AS  [Fut. MTM],                                      
ISNULL(Convert(money,[Opt. MTM]),0) AS  [Opt. MTM],                                      
ISNULL(Convert(money,[MTM]),0) AS  [MTM],                                      
ISNULL(Convert(money,[Pure risk / net available]),0) AS  [Pure risk / net available],                                      
ISNULL(Convert(money,[Projected Risk]),0) AS  [Projected Risk],                                      
ISNULL(Convert(money,[Gross Exposure]),0) AS  [Gross Exposure],                                      
ISNULL(Convert(money,[Net Exposure]),0) AS  [Net Exposure],                                      
ISNULL(Convert(money,[FO Margin ]),0) AS  [FO Margin ],                                      
ISNULL(Convert(money,[Comm Margin]),0) AS  [Comm Margin],                             
ISNULL(Convert(money,[Curr margin]),0) AS  [Curr margin],              
ISNULL(Convert(money,[Total Margin]),0) AS  [Total Margin],                                      
ISNULL(Convert(money,[Prev. Margin]),0) AS  [Prev. Margin],                                      
ISNULL(Convert(money,[Diff. Margin]),0) AS  [Diff. Margin],                                      
ISNULL(Convert(money,[Today Premium]),0) AS  [Today Premium],                                      
ISNULL(Convert(money,[Cash Payin / Payout]),0) AS  [Cash Payin / Payout],                                      
ISNULL(Convert(money,[Shortsell]),0) AS  [Shortsell],                                      
ISNULL(Convert(money,[FO Shortfall]),0) AS  [FO Shortfall]                                      
FROM CLT_PREMIUMDATA_TEMP                                                    
             
             
--update [INTRANET].CMS.DBO.verifierstatus                    
-- set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),PREMIUM='Y'--,LD='Y',PREMIUM='Y'    
  
UPDATE [INTRANET].CMS.DBO.TBL_Verifier_Status        
 SET IsPremium = 'Y',StatusUpdatedBy = @USERNAME, StatusUpdatedOn = GETDATE()                  
--END                                
END                                                    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_CLT_PREMIUMDATA_16aug2013
-- --------------------------------------------------
     
                                      
CREATE PROC UPLOAD_CLT_PREMIUMDATA_16aug2013                                        
(                                          
@ACCESS_TO AS VARCHAR(11) = NULL,                                          
@ACCESS_CODE AS VARCHAR(11) = NULL,                                          
@USERNAME AS VARCHAR(11) = NULL,                                        
@FILENAME AS VARCHAR(45) = NULL                                        
)                                          
AS                                             
BEGIN                           
                          
--IF (SELECT COUNT(1) FROM CLT_PREMIUMDATA_TEMP                        
--WHERE [CLIENT CODE] Like '%[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]%') > 0                
----WHERE [CLIENT CODE] LIKE '%[^a-zA-Z0-9]%') > 0                          
----WHERE [CLIENT CODE] NOT LIKE '[A-Z0-9]') > 0                  
--BEGIN                        
-- RAISERROR ('Special character exists in client Code.',16,1);                        
--END                        
--ELSE                         
--BEGIN                                          
 if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))             
and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'11:59')))            
            
begin            
     Raiserror ('Upload Not Allowed till 12 PM',16,0);            
end       
   
  else  
   begin                    
INSERT INTO [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA_HIST                                            
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                            
                                            
DELETE FROM [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                            
                                            
INSERT INTO [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                            
SELECT                               
ISNULL([Ro Code],'') AS [Ro Code],                              
ISNULL([Branch Code],'') AS  [Branch Code],                              
ISNULL([Family Code],'') AS [Family Code],                              
ISNULL([Sub Group Code],'') AS  [Sub Group Code],                              
--ISNULL([Client Code],'') AS  [Client Code],                              
LTRIM(RTRIM(ISNULL([Client Code],''))) AS  [Client Code],                              
ISNULL([Client Name],'') AS  [Client Name],                              
ISNULL(Convert(money,[Ledger Balance]),0) AS  [Ledger Balance],                              
ISNULL(Convert(money,[Holding]),0) AS  [Holding],                              
ISNULL(Convert(money,[POA]),0) AS  [POA],                              
ISNULL(Convert(money,[Today MTM]),0) AS  [Today MTM],                              
ISNULL(Convert(money,[Logical MTM]),0) AS  [Logical MTM],                              
ISNULL(Convert(money,[Fut. MTM]),0) AS  [Fut. MTM],                              
ISNULL(Convert(money,[Opt. MTM]),0) AS  [Opt. MTM],                              
ISNULL(Convert(money,[MTM]),0) AS  [MTM],                              
ISNULL(Convert(money,[Pure risk / net available]),0) AS  [Pure risk / net available],                              
ISNULL(Convert(money,[Projected Risk]),0) AS  [Projected Risk],                              
ISNULL(Convert(money,[Gross Exposure]),0) AS  [Gross Exposure],                              
ISNULL(Convert(money,[Net Exposure]),0) AS  [Net Exposure],                              
ISNULL(Convert(money,[FO Margin ]),0) AS  [FO Margin ],                              
ISNULL(Convert(money,[Comm Margin]),0) AS  [Comm Margin],                              
ISNULL(Convert(money,[Curr margin]),0) AS  [Curr margin],                              
ISNULL(Convert(money,[Total Margin]),0) AS  [Total Margin],                              
ISNULL(Convert(money,[Prev. Margin]),0) AS  [Prev. Margin],                              
ISNULL(Convert(money,[Diff. Margin]),0) AS  [Diff. Margin],                              
ISNULL(Convert(money,[Today Premium]),0) AS  [Today Premium],                              
ISNULL(Convert(money,[Cash Payin / Payout]),0) AS  [Cash Payin / Payout],                              
ISNULL(Convert(money,[Shortsell]),0) AS  [Shortsell],                              
ISNULL(Convert(money,[FO Shortfall]),0) AS  [FO Shortfall]                              
FROM CLT_PREMIUMDATA_TEMP                                            
     
     
update [196.1.115.132].CMS.DBO.verifierstatus            
 set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),PREMIUM='Y'--,LD='Y',PREMIUM='Y'           
--END                        
END                                            
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_CLT_PREMIUMDATA_20nov2013
-- --------------------------------------------------
           
                                            
CREATE PROC UPLOAD_CLT_PREMIUMDATA_20nov2013                                              
(                                                
@ACCESS_TO AS VARCHAR(11) = NULL,                                                
@ACCESS_CODE AS VARCHAR(11) = NULL,                                                
@USERNAME AS VARCHAR(11) = NULL,                                              
@FILENAME AS VARCHAR(45) = NULL                                              
)                                                
AS                                                   
BEGIN                                 
                                
--IF (SELECT COUNT(1) FROM CLT_PREMIUMDATA_TEMP                              
--WHERE [CLIENT CODE] Like '%[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]%') > 0                      
----WHERE [CLIENT CODE] LIKE '%[^a-zA-Z0-9]%') > 0                                
----WHERE [CLIENT CODE] NOT LIKE '[A-Z0-9]') > 0                        
--BEGIN                              
-- RAISERROR ('Special character exists in client Code.',16,1);                              
--END                              
--ELSE                               
--BEGIN                                                
 if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))                   
and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'10:15')))                  
                  
begin                  
     Raiserror ('Upload Not Allowed till 12 PM',16,0);                  
end             
         
  else        
   begin                          
INSERT INTO [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA_HIST                                                  
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                                  
                                                  
DELETE FROM [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                                  
                                                  
INSERT INTO [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                                  
SELECT                                     
ISNULL([Ro Code],'') AS [Ro Code],                                    
ISNULL([Branch Code],'') AS  [Branch Code],                                    
ISNULL([Family Code],'') AS [Family Code],                                    
ISNULL([Sub Group Code],'') AS  [Sub Group Code],                                    
--ISNULL([Client Code],'') AS  [Client Code],                                    
LTRIM(RTRIM(ISNULL([Client Code],''))) AS  [Client Code],                                    
ISNULL([Client Name],'') AS  [Client Name],                                    
ISNULL(Convert(money,[Ledger Balance]),0) AS  [Ledger Balance],                                    
ISNULL(Convert(money,[Holding]),0) AS  [Holding],                                    
ISNULL(Convert(money,[POA]),0) AS  [POA],                                    
ISNULL(Convert(money,[Today MTM]),0) AS  [Today MTM],                                    
ISNULL(Convert(money,[Logical MTM]),0) AS  [Logical MTM],                                    
ISNULL(Convert(money,[Fut. MTM]),0) AS  [Fut. MTM],                                    
ISNULL(Convert(money,[Opt. MTM]),0) AS  [Opt. MTM],                                    
ISNULL(Convert(money,[MTM]),0) AS  [MTM],                                    
ISNULL(Convert(money,[Pure risk / net available]),0) AS  [Pure risk / net available],                                    
ISNULL(Convert(money,[Projected Risk]),0) AS  [Projected Risk],                                    
ISNULL(Convert(money,[Gross Exposure]),0) AS  [Gross Exposure],                                    
ISNULL(Convert(money,[Net Exposure]),0) AS  [Net Exposure],                                    
ISNULL(Convert(money,[FO Margin ]),0) AS  [FO Margin ],                                    
ISNULL(Convert(money,[Comm Margin]),0) AS  [Comm Margin],                           
ISNULL(Convert(money,[Curr margin]),0) AS  [Curr margin],            
ISNULL(Convert(money,[Total Margin]),0) AS  [Total Margin],                                    
ISNULL(Convert(money,[Prev. Margin]),0) AS  [Prev. Margin],                                    
ISNULL(Convert(money,[Diff. Margin]),0) AS  [Diff. Margin],                                    
ISNULL(Convert(money,[Today Premium]),0) AS  [Today Premium],                                    
ISNULL(Convert(money,[Cash Payin / Payout]),0) AS  [Cash Payin / Payout],                                    
ISNULL(Convert(money,[Shortsell]),0) AS  [Shortsell],                                    
ISNULL(Convert(money,[FO Shortfall]),0) AS  [FO Shortfall]                                    
FROM CLT_PREMIUMDATA_TEMP                                                  
           
           
update [196.1.115.132].CMS.DBO.verifierstatus                  
 set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),PREMIUM='Y'--,LD='Y',PREMIUM='Y'                 
--END                              
END                                                  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_CLT_PREMIUMDATA_5thAug2013
-- --------------------------------------------------
        
                                    
CREATE PROC UPLOAD_CLT_PREMIUMDATA_5thAug2013
(                                        
@ACCESS_TO AS VARCHAR(11) = NULL,                                        
@ACCESS_CODE AS VARCHAR(11) = NULL,                                        
@USERNAME AS VARCHAR(11) = NULL,                                      
@FILENAME AS VARCHAR(45) = NULL                                      
)                                        
AS                                           
BEGIN                         
                        
--IF (SELECT COUNT(1) FROM CLT_PREMIUMDATA_TEMP                      
--WHERE [CLIENT CODE] Like '%[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]%') > 0              
----WHERE [CLIENT CODE] LIKE '%[^a-zA-Z0-9]%') > 0                        
----WHERE [CLIENT CODE] NOT LIKE '[A-Z0-9]') > 0                
--BEGIN                      
-- RAISERROR ('Special character exists in client Code.',16,1);                      
--END                      
--ELSE                       
--BEGIN                                        
                      
INSERT INTO [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA_HIST                                          
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                          
                                          
DELETE FROM [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                          
                                          
INSERT INTO [196.1.115.132].CMS.DBO.CLT_PREMIUMDATA                                          
SELECT                             
ISNULL([Ro Code],'') AS [Ro Code],                            
ISNULL([Branch Code],'') AS  [Branch Code],                            
ISNULL([Family Code],'') AS [Family Code],                            
ISNULL([Sub Group Code],'') AS  [Sub Group Code],                            
--ISNULL([Client Code],'') AS  [Client Code],                            
LTRIM(RTRIM(ISNULL([Client Code],''))) AS  [Client Code],                            
ISNULL([Client Name],'') AS  [Client Name],                            
ISNULL(Convert(money,[Ledger Balance]),0) AS  [Ledger Balance],                            
ISNULL(Convert(money,[Holding]),0) AS  [Holding],                            
ISNULL(Convert(money,[POA]),0) AS  [POA],                            
ISNULL(Convert(money,[Today MTM]),0) AS  [Today MTM],                            
ISNULL(Convert(money,[Logical MTM]),0) AS  [Logical MTM],                            
ISNULL(Convert(money,[Fut. MTM]),0) AS  [Fut. MTM],                            
ISNULL(Convert(money,[Opt. MTM]),0) AS  [Opt. MTM],                            
ISNULL(Convert(money,[MTM]),0) AS  [MTM],                            
ISNULL(Convert(money,[Pure risk / net available]),0) AS  [Pure risk / net available],                            
ISNULL(Convert(money,[Projected Risk]),0) AS  [Projected Risk],                            
ISNULL(Convert(money,[Gross Exposure]),0) AS  [Gross Exposure],                            
ISNULL(Convert(money,[Net Exposure]),0) AS  [Net Exposure],                            
ISNULL(Convert(money,[FO Margin ]),0) AS  [FO Margin ],                            
ISNULL(Convert(money,[Comm Margin]),0) AS  [Comm Margin],                            
ISNULL(Convert(money,[Curr margin]),0) AS  [Curr margin],                            
ISNULL(Convert(money,[Total Margin]),0) AS  [Total Margin],                            
ISNULL(Convert(money,[Prev. Margin]),0) AS  [Prev. Margin],                            
ISNULL(Convert(money,[Diff. Margin]),0) AS  [Diff. Margin],                            
ISNULL(Convert(money,[Today Premium]),0) AS  [Today Premium],                            
ISNULL(Convert(money,[Cash Payin / Payout]),0) AS  [Cash Payin / Payout],                            
ISNULL(Convert(money,[Shortsell]),0) AS  [Shortsell],                            
ISNULL(Convert(money,[FO Shortfall]),0) AS  [FO Shortfall]                            
FROM CLT_PREMIUMDATA_TEMP                                          
          
--END                      
                                          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_CLT_PREMIUMDATA_UAT
-- --------------------------------------------------
                  
CREATE PROC [dbo].[UPLOAD_CLT_PREMIUMDATA_UAT]                                                
(                                                  
@ACCESS_TO AS VARCHAR(11) = NULL,                                                  
@ACCESS_CODE AS VARCHAR(11) = NULL,                                                  
@USERNAME AS VARCHAR(11) = NULL,                                                
@FILENAME AS VARCHAR(45) = NULL                                                
)                                                  
AS                                                     
BEGIN                                   
                  
--IF((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))           
--and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'15:59')))          
--BEGIN  
  
declare @IsBlock as nvarchar  
declare @IsPremium as nvarchar                    
select @IsBlock = Block from [196.1.115.219].CMS.DBO.TBL_Verifier_Status with  (nolock)  
select @IsPremium = Premium from [196.1.115.219].CMS.DBO.TBL_Verifier_Status with (nolock)  
  
IF(@IsBlock = 'Y' AND @IsPremium = 'Y')  
BEGIN  
  
INSERT INTO [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA_HIST                                                    
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA                                                    
                                                    
DELETE FROM [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA                                                    
                                                    
INSERT INTO [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA                                                    
SELECT                                       
ISNULL([Ro Code],'') AS [Ro Code],                                      
ISNULL([Branch Code],'') AS  [Branch Code],                                      
ISNULL([Family Code],'') AS [Family Code],                                      
ISNULL([Sub Group Code],'') AS  [Sub Group Code],                                      
--ISNULL([Client Code],'') AS  [Client Code],                                      
LTRIM(RTRIM(ISNULL([Client Code],''))) AS  [Client Code],                                      
ISNULL([Client Name],'') AS  [Client Name],                                      
ISNULL(Convert(money,[Ledger Balance]),0) AS  [Ledger Balance],                                      
ISNULL(Convert(money,[Holding]),0) AS  [Holding],                                      
ISNULL(Convert(money,[POA]),0) AS  [POA],                                      
ISNULL(Convert(money,[Today MTM]),0) AS  [Today MTM],                                      
ISNULL(Convert(money,[Logical MTM]),0) AS  [Logical MTM],                                      
ISNULL(Convert(money,[Fut. MTM]),0) AS  [Fut. MTM],                                      
ISNULL(Convert(money,[Opt. MTM]),0) AS  [Opt. MTM],                                      
ISNULL(Convert(money,[MTM]),0) AS  [MTM],                                      
ISNULL(Convert(money,[Pure risk / net available]),0) AS  [Pure risk / net available],                                      
ISNULL(Convert(money,[Projected Risk]),0) AS  [Projected Risk],                                      
ISNULL(Convert(money,[Gross Exposure]),0) AS  [Gross Exposure],                                      
ISNULL(Convert(money,[Net Exposure]),0) AS  [Net Exposure],                                      
ISNULL(Convert(money,[FO Margin ]),0) AS  [FO Margin ],              
ISNULL(Convert(money,[Comm Margin]),0) AS  [Comm Margin],                                      
ISNULL(Convert(money,[Curr margin]),0) AS  [Curr margin],                                      
ISNULL(Convert(money,[Total Margin]),0) AS  [Total Margin],                                      
ISNULL(Convert(money,[Prev. Margin]),0) AS  [Prev. Margin],                                      
ISNULL(Convert(money,[Diff. Margin]),0) AS  [Diff. Margin],                                      
ISNULL(Convert(money,[Today Premium]),0) AS  [Today Premium],                                      
ISNULL(Convert(money,[Cash Payin / Payout]),0) AS  [Cash Payin / Payout],               
ISNULL(Convert(money,[Shortsell]),0) AS  [Shortsell],                                      
ISNULL(Convert(money,[FO Shortfall]),0) AS  [FO Shortfall]                                      
FROM CLT_PREMIUMDATA_TEMP_UAT    

UPDATE [196.1.115.219].CMS.DBO.TBL_Verifier_Status    
 SET IsPremium = 'Y',StatusUpdatedBy = @USERNAME, StatusUpdatedOn = GETDATE()        
  
END  
ELSE  
BEGIN  
  
Raiserror ('Upload Not Allowed',16,0);          
  
END   
  
END         
  
-------- Commented by Ranu on 21st Aug 2013 ------------------   
--update [196.1.115.219].CMS.DBO.verifierstatus          
--set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),PREMIUM='Y'--,LD='Y',PREMIUM='Y'                                                 
                    
-------- Added by Ranu on 21st Aug 2013 ------------------  
                       
                                                    
--END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_CLT_PREMIUMDATA_UAT_Old
-- --------------------------------------------------
                
                                            
CREATE PROC UPLOAD_CLT_PREMIUMDATA_UAT                                              
(                                                
@ACCESS_TO AS VARCHAR(11) = NULL,                                                
@ACCESS_CODE AS VARCHAR(11) = NULL,                                                
@USERNAME AS VARCHAR(11) = NULL,                                              
@FILENAME AS VARCHAR(45) = NULL                                              
)                                                
AS                                                   
BEGIN                                 
                
                
     if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))         
and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'15:59')))        
        
begin        
     Raiserror ('Upload Not Allowed till 4 PM',16,0);        
end        
                                 
--IF (SELECT COUNT(1) FROM CLT_PREMIUMDATA_TEMP                              
--WHERE [CLIENT CODE] Like '%[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]%') > 0                      
----WHERE [CLIENT CODE] LIKE '%[^a-zA-Z0-9]%') > 0                                
----WHERE [CLIENT CODE] NOT LIKE '[A-Z0-9]') > 0                        
--BEGIN                              
-- RAISERROR ('Special character exists in client Code.',16,1);                              
--END                              
--ELSE                               
--BEGIN                                                
                              
INSERT INTO [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA_HIST                                                  
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA                                                  
                                                  
DELETE FROM [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA                                                  
                                                  
INSERT INTO [196.1.115.219].CMS.DBO.CLT_PREMIUMDATA                                                  
SELECT                                     
ISNULL([Ro Code],'') AS [Ro Code],                                    
ISNULL([Branch Code],'') AS  [Branch Code],                                    
ISNULL([Family Code],'') AS [Family Code],                                    
ISNULL([Sub Group Code],'') AS  [Sub Group Code],                                    
--ISNULL([Client Code],'') AS  [Client Code],                                    
LTRIM(RTRIM(ISNULL([Client Code],''))) AS  [Client Code],                                    
ISNULL([Client Name],'') AS  [Client Name],                                    
ISNULL(Convert(money,[Ledger Balance]),0) AS  [Ledger Balance],                                    
ISNULL(Convert(money,[Holding]),0) AS  [Holding],                                    
ISNULL(Convert(money,[POA]),0) AS  [POA],                                    
ISNULL(Convert(money,[Today MTM]),0) AS  [Today MTM],                                    
ISNULL(Convert(money,[Logical MTM]),0) AS  [Logical MTM],                                    
ISNULL(Convert(money,[Fut. MTM]),0) AS  [Fut. MTM],                                    
ISNULL(Convert(money,[Opt. MTM]),0) AS  [Opt. MTM],                                    
ISNULL(Convert(money,[MTM]),0) AS  [MTM],                                    
ISNULL(Convert(money,[Pure risk / net available]),0) AS  [Pure risk / net available],                                    
ISNULL(Convert(money,[Projected Risk]),0) AS  [Projected Risk],                                    
ISNULL(Convert(money,[Gross Exposure]),0) AS  [Gross Exposure],                                    
ISNULL(Convert(money,[Net Exposure]),0) AS  [Net Exposure],                                    
ISNULL(Convert(money,[FO Margin ]),0) AS  [FO Margin ],            
ISNULL(Convert(money,[Comm Margin]),0) AS  [Comm Margin],                                    
ISNULL(Convert(money,[Curr margin]),0) AS  [Curr margin],                                    
ISNULL(Convert(money,[Total Margin]),0) AS  [Total Margin],                                    
ISNULL(Convert(money,[Prev. Margin]),0) AS  [Prev. Margin],                                    
ISNULL(Convert(money,[Diff. Margin]),0) AS  [Diff. Margin],                                    
ISNULL(Convert(money,[Today Premium]),0) AS  [Today Premium],                                    
ISNULL(Convert(money,[Cash Payin / Payout]),0) AS  [Cash Payin / Payout],             
ISNULL(Convert(money,[Shortsell]),0) AS  [Shortsell],                                    
ISNULL(Convert(money,[FO Shortfall]),0) AS  [FO Shortfall]                                    
FROM CLT_PREMIUMDATA_TEMP_UAT     
  
 update [196.1.115.219].CMS.DBO.verifierstatus        
 set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),PREMIUM='Y'--,LD='Y',PREMIUM='Y'                                               
                  
--END                              
                                                  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upload_contractfile_mcx
-- --------------------------------------------------
CREATE proc upload_contractfile_mcx(@filename as varchar(100))  
as  
  
declare @path as varchar(150)    
declare @sql as varchar(1000)                           
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\Contract\' + @filename     
truncate table ContractFile_MCX  
SET @SQL = 'BULK INSERT ContractFile_MCX FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                            
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upload_contractfile_mcx1
-- --------------------------------------------------
create proc upload_contractfile_mcx1(@path as varchar(300))  
as  
  
--declare @path as varchar(150)    
declare @sql as varchar(1000)                           
--set @path='\\196.1.115.136\d$\upload1\Contract\' + @filename     
truncate table ContractFile_MCX  
SET @SQL = 'BULK INSERT ContractFile_MCX FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                            
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upload_contractfile_mcxsx
-- --------------------------------------------------
CREATE proc upload_contractfile_mcxsx(@filename as varchar(100))    
as    
    
declare @path as varchar(150)      
declare @sql as varchar(1000)                             
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\Contract\' + @filename       
truncate table ContractFile_MCX    
SET @SQL = 'BULK INSERT ContractFile_MCXSX FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                              
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upload_contractfile_mcxsx1
-- --------------------------------------------------
CREATE proc upload_contractfile_mcxsx1(@path as varchar(300))    
as    
    
--declare @path as varchar(150)      
declare @sql as varchar(1000)                             
--set @path='\\196.1.115.136\d$\upload1\Contract\' + @filename       
truncate table ContractFile_MCXSX    
SET @SQL = 'BULK INSERT ContractFile_MCXSX FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                              
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_IL_SCAN_IMAGE
-- --------------------------------------------------

  
  
  
CREATE PROCEDURE [DBO].[UPLOAD_IL_SCAN_IMAGE] (@IL_UID AS VARCHAR(45))          
AS          
    SET NOCOUNT ON          
        
    TRUNCATE TABLE IL_SCAN_IMAGE          
          
    INSERT INTO IL_SCAN_IMAGE          
    SELECT     
           @IL_UID,
           Scan_IMG,
           getdate()               
    FROM   IL_SCAN_IMAGE_UPLOAD          
         
         
    --INSERT INTO [196.1.115.245].risk.dbo.IL_Scancopy VALUES('NSX',GETDATE(),'')          
          
          
    SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_Illiqiquid_Master
-- --------------------------------------------------
CREATE proc Upload_Illiqiquid_Master(                                    
@filename as varchar(100),            
@server as varchar(20)                                          
)                                      
as                        
declare @path as varchar(100)    
declare @sql as varchar(1000)    
                     
delete from intranet.misc.dbo.tbl_restricted_scrips    
    
create table #temp(  
sc_code varchar(50),    
symbol varchar(50),
sc_name varchar(50),      
sc_group varchar(50)    
)                  
    
set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename    
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'    
---print @SQL                                    
exec (@sql)    
                                   
insert into intranet.misc.dbo.tbl_restricted_scrips    
Select * from #temp    
    
select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_Illiquid_Master
-- --------------------------------------------------
CREATE proc Upload_Illiquid_Master(                                
@filename as varchar(100),        
@server as varchar(20)                                      
)                                  
as                    
declare @path as varchar(100)
declare @sql as varchar(1000)
                 
delete from intranet.misc.dbo.tbl_restricted_scrips

create table #temp(
sc_code varchar(50),
symbol varchar(50),
sc_name varchar(50),
sc_group varchar(50)
)              

set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'
---print @SQL                                
exec (@sql)
                               
insert into intranet.misc.dbo.tbl_restricted_scrips
Select * from #temp

select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_Illiquid_Master1
-- --------------------------------------------------
CREATE proc Upload_Illiquid_Master1    
(                                      
@filename as varchar(100),              
@server as varchar(20)    
--@flag as varchar(10)                                            
)                                        
as                          
declare @path as varchar(100)      
declare @sql as varchar(1000)      
                       
delete from intranet.misc.dbo.tbl_restricted_scrips      
      
create table #temp    
(      
sc_code varchar(50),      
--symbol varchar(50),      
sc_name varchar(50),      
sc_group varchar(50),  
segment  varchar(50),  
isin_no varchar(50),  
status varchar(50),     
)                    
      
set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename      
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'      
print @SQL                                      
exec (@sql)      
                                     
insert into intranet.misc.dbo.tbl_restricted_scrips      
Select * from #temp     
--    
--select sc_code,sc_name,sc_group,Status='Up to 5 Lacs' from intranet.misc.dbo.tbl_restricted_scrips      
      
select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_Illiquid_Master11
-- --------------------------------------------------
CREATE PROCEDURE UPLOAD_ILLIQUID_MASTER11                                
(                                                                  
 @FILENAME AS VARCHAR(100),                                          
 @SEGMENT AS VARCHAR(10),        
 @STATUS AS VARCHAR(20)                                                                       
 --@SERVER AS VARCHAR(20)                                
)            
                                                        
AS                                                      
      
 --DECLARE @PATH AS VARCHAR(100)                                  
 --DECLARE @SQL AS VARCHAR(1000)         
      
 IF(@STATUS='RESTRICTED')        
 BEGIN        
  SET @STATUS = 'UP TO 5 LACS'        
 END                          
      
 IF(@SEGMENT='BSE')                          
      
 BEGIN               
      
  DELETE FROM INTRANET.MISC.DBO.TBL_RESTRICTED_SCRIPS                
  WHERE LTRIM(RTRIM(STATUS)) LIKE @STATUS + '%' AND SEGMENT = @SEGMENT        
      
  INSERT INTO INTRANET.MISC.DBO.TBL_RESTRICTED_SCRIPS                
  (                 
   SC_CODE,                
   --SC_NAME,            
   SYMBOL,      
   SC_GROUP,                
   SEGMENT,            
   ISIN_NO,                
   STATUS                
  )            
      
  SELECT LTRIM(RTRIM(SC_CODE)),                
   LTRIM(RTRIM(SYMBOL)),                
   LTRIM(RTRIM(SC_GROUP)),                
   LTRIM(RTRIM(@SEGMENT)),                
   LTRIM(RTRIM(ISIN_NO)),                
   UPPER(LTRIM(RTRIM(STATUS)))             
  FROM TBL_RESTRICTED_SCRIPS_TEMP                          
      
 END                        
      
 IF(@SEGMENT='NSE')                          
      
 BEGIN            
      
  DELETE FROM INTRANET.MISC.DBO.TBL_RESTRICTED_SCRIPS                
  WHERE LTRIM(RTRIM(STATUS)) LIKE @STATUS + '%' AND SEGMENT = @SEGMENT        
      
  INSERT INTO INTRANET.MISC.DBO.TBL_RESTRICTED_SCRIPS            
  (            
   SYMBOL,            
   SC_GROUP,            
   --SYMBOL,      
   SEGMENT,            
   ISIN_NO,            
   STATUS            
  )                          
      
  SELECT LTRIM(RTRIM(SYMBOL)),                
   LTRIM(RTRIM(SC_GROUP)),                
   LTRIM(RTRIM(@SEGMENT)),                
   LTRIM(RTRIM(ISIN_NO)),                
   UPPER(LTRIM(RTRIM(STATUS)))             
  FROM TBL_RESTRICTED_SCRIPS_TEMP_NSE                        
      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_Illiquid_Master111
-- --------------------------------------------------
create proc Upload_Illiquid_Master111              
(                                                
@filename as varchar(100),                        
--@server as varchar(20)              
@segment as varchar(10)                                                      
)                                                  
as                                    
--declare @path as varchar(100)                
--declare @sql as varchar(1000)         
           
if(@segment='NSE')        
begin            
insert into intranet.misc.dbo.tbl_restricted_scrips(symbol,sc_group,segment,isin_no,status)        
select symbol,sc_group,@segment,isin_no,status from tbl_restricted_scrips_TEMP_NSE      
end      
        
-- if(@segment='BSE')                               
----delete from intranet.misc.dbo.tbl_restricted_scrips                
--                 
--end        
--        
--if(@segment='NSE')          
--        
--end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_CLIENTDATA
-- --------------------------------------------------
                    
CREATE PROC UPLOAD_LD_CLIENTDATA                         
(                        
@ACCESS_TO AS VARCHAR(11) = NULL,                        
@ACCESS_CODE AS VARCHAR(11) = NULL,                        
@USERNAME AS VARCHAR(11) = NULL,                      
@FILENAME AS VARCHAR(45) = NULL                      
)                        
AS                           
BEGIN                          
               
--if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))                         
--and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'10:15')))                        
--begin                        
--     Raiserror ('Upload Not Allowed till 12 PM',16,0);                        
--end                 
--else             
--begin          
    
declare @IsBlock as nvarchar        
declare @IsLD as nvarchar                          
select @IsBlock = Block from [INTRANET].CMS.DBO.TBL_Verifier_Status with  (nolock)        
select @IsLD = LD from [INTRANET].CMS.DBO.TBL_Verifier_Status with (nolock)        
    
IF(@IsBlock = 'Y' AND @IsLD = 'Y')        
BEGIN        
                   
INSERT INTO [INTRANET].CMS.DBO.LD_CLIENTDATA_HIST                          
SELECT *,GETDATE() AS HISTDATE FROM [INTRANET].CMS.DBO.LD_CLIENTDATA                          
                          
DELETE FROM [INTRANET].CMS.DBO.LD_CLIENTDATA                          
                          
INSERT INTO [INTRANET].CMS.DBO.LD_CLIENTDATA                          
SELECT [Client Code],[Client Name],[Branch Code],              
ISNULL(Convert(money,[Final Margin]),0),                  
ISNULL(Convert(money,[Utilization]),0),                  
ISNULL(Convert(money,[Adhoc Dr/Cr]),0),                  
ISNULL(Convert(money,[Net Margin]),0),                  
ISNULL(Convert(money,[BSE MTM]),0),                  
ISNULL(Convert(money,[BSE Var]),0),                  
ISNULL(Convert(money,[NSE MTM]),0),                  
ISNULL(Convert(money,[NSE Var]),0),                  
ISNULL(Convert(money,[NSEF Span]),0),                  
ISNULL(Convert(money,[NSEF MVM]),0) as [NSEF Exposure],                  
ISNULL(Convert(money,[NSEF MTM]),0),                  
ISNULL(Convert(money,[MCX Span]),0),                    
ISNULL(Convert(money,[MCX MVM]),0) as [MCX Exposure],                    
ISNULL(Convert(money,[MCX MTM]),0),                  
ISNULL(Convert(money,[NCDX Span]),0),                  
ISNULL(Convert(money,[NCDX MVM]),0) as [NCDX Exposure],                  
ISNULL(Convert(money,[NCDX MTM]),0),                  
ISNULL(Convert(money,[NSEC Span]),0),                  
ISNULL(Convert(money,[NSEC MVM]),0),                  
ISNULL(Convert(money,[NSEC MTM]),0),                  
ISNULL(Convert(money,[MCXC Span]),0),                    
ISNULL(Convert(money,[MCXC MVM]),0),                  
ISNULL(Convert(money,[MCXC MTM]),0),                    
ISNULL(Convert(money,[Log Mtm]),0)                     
FROM LD_CLIENTDATA_TEMP                          
              
 -- update [INTRANET].CMS.DBO.verifierstatus                      
 --set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),LD='Y'--,LD='Y',PREMIUM='Y'             
     
  UPDATE [INTRANET].CMS.DBO.TBL_Verifier_Status          
 SET IsLD = 'Y',StatusUpdatedBy = @USERNAME, StatusUpdatedOn = GETDATE()                             
                    
END                          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_CLIENTDATA_16aug2013
-- --------------------------------------------------
          
CREATE PROC UPLOAD_LD_CLIENTDATA_16aug2013               
(              
@ACCESS_TO AS VARCHAR(11) = NULL,              
@ACCESS_CODE AS VARCHAR(11) = NULL,              
@USERNAME AS VARCHAR(11) = NULL,            
@FILENAME AS VARCHAR(45) = NULL            
)              
AS                 
BEGIN                
     
if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))               
and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'11:59')))              
begin              
     Raiserror ('Upload Not Allowed till 12 PM',16,0);              
end       
else   
begin               
INSERT INTO [196.1.115.132].CMS.DBO.LD_CLIENTDATA_HIST                
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.132].CMS.DBO.LD_CLIENTDATA                
                
DELETE FROM [196.1.115.132].CMS.DBO.LD_CLIENTDATA                
                
INSERT INTO [196.1.115.132].CMS.DBO.LD_CLIENTDATA                
SELECT [Client Code],[Client Name],[Branch Code],    
ISNULL(Convert(money,[Final Margin]),0),        
ISNULL(Convert(money,[Utilization]),0),        
ISNULL(Convert(money,[Adhoc Dr/Cr]),0),        
ISNULL(Convert(money,[Net Margin]),0),        
ISNULL(Convert(money,[BSE MTM]),0),        
ISNULL(Convert(money,[BSE Var]),0),        
ISNULL(Convert(money,[NSE MTM]),0),        
ISNULL(Convert(money,[NSE Var]),0),        
ISNULL(Convert(money,[NSEF Span]),0),        
ISNULL(Convert(money,[NSEF MVM]),0) as [NSEF Exposure],        
ISNULL(Convert(money,[NSEF MTM]),0),        
ISNULL(Convert(money,[MCX Span]),0),          
ISNULL(Convert(money,[MCX MVM]),0) as [MCX Exposure],          
ISNULL(Convert(money,[MCX MTM]),0),        
ISNULL(Convert(money,[NCDX Span]),0),        
ISNULL(Convert(money,[NCDX MVM]),0) as [NCDX Exposure],        
ISNULL(Convert(money,[NCDX MTM]),0),        
ISNULL(Convert(money,[NSEC Span]),0),        
ISNULL(Convert(money,[NSEC MVM]),0),        
ISNULL(Convert(money,[NSEC MTM]),0),        
ISNULL(Convert(money,[MCXC Span]),0),          
ISNULL(Convert(money,[MCXC MVM]),0),        
ISNULL(Convert(money,[MCXC MTM]),0),          
ISNULL(Convert(money,[Log Mtm]),0)           
FROM LD_CLIENTDATA_TEMP                
    
  update [196.1.115.132].CMS.DBO.verifierstatus            
 set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),LD='Y'--,LD='Y',PREMIUM='Y'                        
          
END                
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_CLIENTDATA_20nov2013
-- --------------------------------------------------
                
CREATE PROC UPLOAD_LD_CLIENTDATA_20nov2013                     
(                    
@ACCESS_TO AS VARCHAR(11) = NULL,                    
@ACCESS_CODE AS VARCHAR(11) = NULL,                    
@USERNAME AS VARCHAR(11) = NULL,                  
@FILENAME AS VARCHAR(45) = NULL                  
)                    
AS                       
BEGIN                      
           
if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))                     
and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'10:15')))                    
begin                    
     Raiserror ('Upload Not Allowed till 12 PM',16,0);                    
end             
else         
begin                     
INSERT INTO [196.1.115.132].CMS.DBO.LD_CLIENTDATA_HIST                      
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.132].CMS.DBO.LD_CLIENTDATA                      
                      
DELETE FROM [196.1.115.132].CMS.DBO.LD_CLIENTDATA                      
                      
INSERT INTO [196.1.115.132].CMS.DBO.LD_CLIENTDATA                      
SELECT [Client Code],[Client Name],[Branch Code],          
ISNULL(Convert(money,[Final Margin]),0),              
ISNULL(Convert(money,[Utilization]),0),              
ISNULL(Convert(money,[Adhoc Dr/Cr]),0),              
ISNULL(Convert(money,[Net Margin]),0),              
ISNULL(Convert(money,[BSE MTM]),0),              
ISNULL(Convert(money,[BSE Var]),0),              
ISNULL(Convert(money,[NSE MTM]),0),              
ISNULL(Convert(money,[NSE Var]),0),              
ISNULL(Convert(money,[NSEF Span]),0),              
ISNULL(Convert(money,[NSEF MVM]),0) as [NSEF Exposure],              
ISNULL(Convert(money,[NSEF MTM]),0),              
ISNULL(Convert(money,[MCX Span]),0),                
ISNULL(Convert(money,[MCX MVM]),0) as [MCX Exposure],                
ISNULL(Convert(money,[MCX MTM]),0),              
ISNULL(Convert(money,[NCDX Span]),0),              
ISNULL(Convert(money,[NCDX MVM]),0) as [NCDX Exposure],              
ISNULL(Convert(money,[NCDX MTM]),0),              
ISNULL(Convert(money,[NSEC Span]),0),              
ISNULL(Convert(money,[NSEC MVM]),0),              
ISNULL(Convert(money,[NSEC MTM]),0),              
ISNULL(Convert(money,[MCXC Span]),0),                
ISNULL(Convert(money,[MCXC MVM]),0),              
ISNULL(Convert(money,[MCXC MTM]),0),                
ISNULL(Convert(money,[Log Mtm]),0)                 
FROM LD_CLIENTDATA_TEMP                      
          
  update [196.1.115.132].CMS.DBO.verifierstatus                  
 set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),LD='Y'--,LD='Y',PREMIUM='Y'                              
                
END                      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_CLIENTDATA_5thAug2013
-- --------------------------------------------------
        
CREATE PROC UPLOAD_LD_CLIENTDATA_5thAug2013              
(            
@ACCESS_TO AS VARCHAR(11) = NULL,            
@ACCESS_CODE AS VARCHAR(11) = NULL,            
@USERNAME AS VARCHAR(11) = NULL,          
@FILENAME AS VARCHAR(45) = NULL          
)            
AS               
BEGIN              
              
INSERT INTO [196.1.115.132].CMS.DBO.LD_CLIENTDATA_HIST              
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.132].CMS.DBO.LD_CLIENTDATA              
              
DELETE FROM [196.1.115.132].CMS.DBO.LD_CLIENTDATA              
              
INSERT INTO [196.1.115.132].CMS.DBO.LD_CLIENTDATA              
SELECT [Client Code],[Client Name],[Branch Code],  
ISNULL(Convert(money,[Final Margin]),0),      
ISNULL(Convert(money,[Utilization]),0),      
ISNULL(Convert(money,[Adhoc Dr/Cr]),0),      
ISNULL(Convert(money,[Net Margin]),0),      
ISNULL(Convert(money,[BSE MTM]),0),      
ISNULL(Convert(money,[BSE Var]),0),      
ISNULL(Convert(money,[NSE MTM]),0),      
ISNULL(Convert(money,[NSE Var]),0),      
ISNULL(Convert(money,[NSEF Span]),0),      
ISNULL(Convert(money,[NSEF MVM]),0) as [NSEF Exposure],      
ISNULL(Convert(money,[NSEF MTM]),0),      
ISNULL(Convert(money,[MCX Span]),0),        
ISNULL(Convert(money,[MCX MVM]),0) as [MCX Exposure],        
ISNULL(Convert(money,[MCX MTM]),0),      
ISNULL(Convert(money,[NCDX Span]),0),      
ISNULL(Convert(money,[NCDX MVM]),0) as [NCDX Exposure],      
ISNULL(Convert(money,[NCDX MTM]),0),      
ISNULL(Convert(money,[NSEC Span]),0),      
ISNULL(Convert(money,[NSEC MVM]),0),      
ISNULL(Convert(money,[NSEC MTM]),0),      
ISNULL(Convert(money,[MCXC Span]),0),        
ISNULL(Convert(money,[MCXC MVM]),0),      
ISNULL(Convert(money,[MCXC MTM]),0),        
ISNULL(Convert(money,[Log Mtm]),0)         
FROM LD_CLIENTDATA_TEMP              
              
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_CLIENTDATA_uat
-- --------------------------------------------------
                      
CREATE PROC [dbo].[UPLOAD_LD_CLIENTDATA_uat]                            
(                          
@ACCESS_TO AS VARCHAR(11) = NULL,                          
@ACCESS_CODE AS VARCHAR(11) = NULL,                          
@USERNAME AS VARCHAR(11) = NULL,                        
@FILENAME AS VARCHAR(45) = NULL                        
)                          
AS                             
BEGIN                            
                            
                            
--select CONVERT(DATETIME,'00:00')              
--if ((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108)) >= select CONVERT(DATETIME,'00:00'))              
--and (select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108)) <= select CONVERT(DATETIME,'11:59')))              
              
--IF((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))               
--and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'15:59')))              
--BEGIN  
  
declare @IsBlock as nvarchar  
declare @IsLD as nvarchar                    
select @IsBlock = Block from [196.1.115.219].CMS.DBO.TBL_Verifier_Status with  (nolock)  
select @IsLD = LD from [196.1.115.219].CMS.DBO.TBL_Verifier_Status with (nolock)  
  
IF(@IsBlock = 'Y' AND @IsLD = 'Y')  
BEGIN  
  
INSERT INTO [196.1.115.219].CMS.DBO.LD_CLIENTDATA_HIST_uat                            
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.219].CMS.DBO.LD_CLIENTDATA_uat                            
                            
DELETE FROM [196.1.115.219].CMS.DBO.LD_CLIENTDATA_uat                             
                            
INSERT INTO [196.1.115.219].CMS.DBO.LD_CLIENTDATA_uat                             
SELECT [Client Code],[Client Name],[Branch Code],                
ISNULL(Convert(money,[Final Margin]),0),                    
ISNULL(Convert(money,[Utilization]),0),                    
ISNULL(Convert(money,[Adhoc Dr/Cr]),0),                    
ISNULL(Convert(money,[Net Margin]),0),                    
ISNULL(Convert(money,[BSE MTM]),0),                    
ISNULL(Convert(money,[BSE Var]),0),                    
ISNULL(Convert(money,[NSE MTM]),0),                    
ISNULL(Convert(money,[NSE Var]),0),                    
ISNULL(Convert(money,[NSEF Span]),0),                    
ISNULL(Convert(money,[NSEF MVM]),0) as [NSEF Exposure],                    
ISNULL(Convert(money,[NSEF MTM]),0),                    
ISNULL(Convert(money,[MCX Span]),0),                      
ISNULL(Convert(money,[MCX MVM]),0) as [MCX Exposure],                      
ISNULL(Convert(money,[MCX MTM]),0),                    
ISNULL(Convert(money,[NCDX Span]),0),                    
ISNULL(Convert(money,[NCDX MVM]),0) as [NCDX Exposure],                    
ISNULL(Convert(money,[NCDX MTM]),0),                    
ISNULL(Convert(money,[NSEC Span]),0),                    
ISNULL(Convert(money,[NSEC MVM]),0),                    
ISNULL(Convert(money,[NSEC MTM]),0),                    
ISNULL(Convert(money,[MCXC Span]),0),                      
ISNULL(Convert(money,[MCXC MVM]),0),                    
ISNULL(Convert(money,[MCXC MTM]),0),                      
ISNULL(Convert(money,[Log Mtm]),0)                       
FROM   LD_CLIENTDATA_TEMP_UAT   

 UPDATE [196.1.115.219].CMS.DBO.TBL_Verifier_Status    
 SET IsLD = 'Y',StatusUpdatedBy = @USERNAME, StatusUpdatedOn = GETDATE()     
  
END   
ELSE          
BEGIN    
 Raiserror ('Upload Not Allowed',16,0);              
END   
END             
                          
-------- Commented by Ranu on 21st Aug 2013 ------------------     
 --update [196.1.115.219].CMS.DBO.verifierstatus            
 --set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),LD='Y'--,LD='Y',PREMIUM='Y'   
   
-------- Added by Ranu on 21st Aug 2013 ------------------  
                     
          
--END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_CLIENTDATA_uat_Old
-- --------------------------------------------------
                  
CREATE PROC UPLOAD_LD_CLIENTDATA_uat                        
(                      
@ACCESS_TO AS VARCHAR(11) = NULL,                      
@ACCESS_CODE AS VARCHAR(11) = NULL,                      
@USERNAME AS VARCHAR(11) = NULL,                    
@FILENAME AS VARCHAR(45) = NULL                    
)                      
AS                         
BEGIN                        
                        
                        
--select CONVERT(DATETIME,'00:00')          
--if ((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108)) >= select CONVERT(DATETIME,'00:00'))          
--and (select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108)) <= select CONVERT(DATETIME,'11:59')))          
          
if((select CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),108))) >=(select CONVERT(DATETIME,'00:00'))           
and (select CONVERT(datetime,CONVERT(VARCHAR,GETDATE(),108))) <= (select CONVERT(datetime,'15:59')))          
begin          
     Raiserror ('Upload Not Allowed till 4 PM',16,0);          
end          
ELSE      
BEGIN                        
                        
INSERT INTO [196.1.115.219].CMS.DBO.LD_CLIENTDATA_HIST_uat                        
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.219].CMS.DBO.LD_CLIENTDATA_uat                        
                        
DELETE FROM [196.1.115.219].CMS.DBO.LD_CLIENTDATA_uat                         
                        
INSERT INTO [196.1.115.219].CMS.DBO.LD_CLIENTDATA_uat                         
SELECT [Client Code],[Client Name],[Branch Code],            
ISNULL(Convert(money,[Final Margin]),0),                
ISNULL(Convert(money,[Utilization]),0),                
ISNULL(Convert(money,[Adhoc Dr/Cr]),0),                
ISNULL(Convert(money,[Net Margin]),0),                
ISNULL(Convert(money,[BSE MTM]),0),                
ISNULL(Convert(money,[BSE Var]),0),                
ISNULL(Convert(money,[NSE MTM]),0),                
ISNULL(Convert(money,[NSE Var]),0),                
ISNULL(Convert(money,[NSEF Span]),0),                
ISNULL(Convert(money,[NSEF MVM]),0) as [NSEF Exposure],                
ISNULL(Convert(money,[NSEF MTM]),0),                
ISNULL(Convert(money,[MCX Span]),0),                  
ISNULL(Convert(money,[MCX MVM]),0) as [MCX Exposure],                  
ISNULL(Convert(money,[MCX MTM]),0),                
ISNULL(Convert(money,[NCDX Span]),0),                
ISNULL(Convert(money,[NCDX MVM]),0) as [NCDX Exposure],                
ISNULL(Convert(money,[NCDX MTM]),0),                
ISNULL(Convert(money,[NSEC Span]),0),                
ISNULL(Convert(money,[NSEC MVM]),0),                
ISNULL(Convert(money,[NSEC MTM]),0),                
ISNULL(Convert(money,[MCXC Span]),0),                  
ISNULL(Convert(money,[MCXC MVM]),0),                
ISNULL(Convert(money,[MCXC MTM]),0),                  
ISNULL(Convert(money,[Log Mtm]),0)                   
FROM   LD_CLIENTDATA_TEMP_UAT    
  
 update [196.1.115.219].CMS.DBO.verifierstatus        
 set blkonline = 'Y',updatedby = @USERNAME,updatedon=Getdate(),LD='Y'--,LD='Y',PREMIUM='Y'                    
      
END                     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_LD_VARDATA
-- --------------------------------------------------
CREATE PROC UPLOAD_LD_VARDATA
(  
@ACCESS_TO AS VARCHAR(11) = NULL,  
@ACCESS_CODE AS VARCHAR(11) = NULL,  
@USERNAME AS VARCHAR(11) = NULL,
@FILENAME AS VARCHAR(45) = NULL
)  
AS   
BEGIN  
  
INSERT INTO [196.1.115.219].CMS.DBO.LD_VARDATA_HIST  
SELECT *,GETDATE() AS HISTDATE FROM [196.1.115.219].CMS.DBO.LD_VARDATA  
  
DELETE FROM [196.1.115.219].CMS.DBO.LD_VARDATA  
  
INSERT INTO [196.1.115.219].CMS.DBO.LD_VARDATA  
SELECT * FROM LD_VARDATA_TEMP  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upload_MCX_BlockScrip
-- --------------------------------------------------
create procedure upload_MCX_BlockScrip(@filename as varchar(45))
as
set nocount on

truncate table tbl_MCXBlockScrip
insert into tbl_MCXBlockScrip select * from tbl_tempMCXBlockScrip 
--insert into intranet.risk.dbo.upload_mcx_file values ()

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_NSE_BlockScript
-- --------------------------------------------------
CREATE Procedure Upload_NSE_BlockScript (@filename as varchar(45) )      
as      
      
set nocount on       
truncate table NSEBlockScript      
insert into NSEBlockScript Select *,'N' from NSE_BlockScript_Temp_upload     
  
insert into intranet.risk.dbo.upload_block_file values ('NSEEx',getdate(),'')   
    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_nseblock_Master
-- --------------------------------------------------
CREATE proc Upload_nseblock_Master(                                  
@filename as varchar(100),          
@server as varchar(20)                                        
)                                    
as                      
declare @path as varchar(100)  
declare @sql as varchar(1000)  
                   
delete from intranet.misc.dbo.tbl_nse_blockscrips  
  
create table #temp(
symbol varchar(50),  
sc_code varchar(50),    
sc_group varchar(50)  
)                
  
set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename  
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'  
---print @SQL                                  
exec (@sql)  
                                 
insert into intranet.misc.dbo.tbl_nse_blockscrips  
Select * from #temp  
  
select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_NSX_CONTRACTFILE
-- --------------------------------------------------




CREATE PROCEDURE [DBO].[UPLOAD_NSX_CONTRACTFILE] (@FILENAME AS VARCHAR(45))        
AS        
    SET NOCOUNT ON        
      
    TRUNCATE TABLE NSXBLOCKSCRIPT        
        
    INSERT INTO NSXBLOCKSCRIPT        
    SELECT CONTRACTTOKENNUMBER,        
           ASSETTOKENNUMBER,        
           INSTRUMENT,        
           SYMBOL,        
           SERIES,        
           FILLER,        
           EXPIRYDATE = CONVERT (DATETIME, ( ( ( CONVERT(BIGINT, EXPIRYDATE) ) / 86400 ) + 29221 - 2 ), 106),-- AS FORMULA DIVIDE THAT NUMBER BY 86400 & ADD 29221. CONVERT THE RESULT TO DATE FORMAT          
           STRIKEPRICE,        
           OPTIONTYPE,        
           PRECISION_1 CALEVEL,        
           FILLER_1,        
           ADMISSIONTYPE,        
           ISSUERATE,        
           TRADINGSTATUS_N,        
           ELIGIBILITY_N,        
           FILLER_N,        
           TRADINGSTATUS,        
           ELIGIBILITY,        
           FILLER_2,        
           TRADINGSTATUS_S,        
           ELIGIBILITY_S,        
           FILLER_3,        
           TRADINGSTATUS_A,        
           ELIGIBILITY_A,        
           FILLER_A,        
           ISSUESTART,        
           SETTLEMENT,        
           CONTRACTMATURITY,        
           MARGINPERCENTAGE,        
           MINIMUMLOTSIZE,        
           BOARDLOTQUANTITY,        
           TICKSIZE,        
           ISSUEDCAPITAL,        
           VOLUMEFREEZEQUANTITY,        
           WARNINGQUANTITY,        
           ADMISSIONDATE,        
           EXPULSIONDATE,        
           READMISSIONDATE,        
           RECORDDATE,        
           NODELIVERYSTARTDATE,        
           NODELIVERYENDDATE,        
           OPERATINGRANGE_LOW,        
           OPERATINGRAGE_HIGH,        
           EXDATE,        
           BOOKCLOSURESTARTDATE,        
           BOOKCLOSUREENDDATE,        
           UPDATEDATEANDTIME,        
           EXERCISESTARTDATE,        
           EXERCISEENDDATE,        
           TICKERSELECTION,        
           QUANTITYMULTIPLIER,        
           CREDITRATING,        
           STOCKNAME,        
           CORPORATEPURPOSE_AGMEGM,        
           CORPORATEPURPOSE_INTERESTDIVIDEND,        
           CORPORATEPURPOSE_RIGHTSBONUS,        
           SPECIALTERMS,        
           REMARKS,        
           EXERCISESTYLE,        
           EXERCISEALLOWED,        
           EXERCISEREJECTIONALLOWED,        
           POSITIONLIQUIDATIONALLOWED,        
           CHECKSUM,        
           CORPORATEACTIONADJUSTED,        
           UNDERLYINGASSETSYMBOL,        
           ASSETINSTRUMENT,        
           BASEPRICE,        
           DELETEFLAG,    
           GETDATE()    
    FROM   NSX_BLOCKSCRIPT_TEMP_UPLOAD        
    WHERE        
      EXPIRYDATE NOT IN ( '0', '-1' )        
        
    INSERT INTO INTRANET.RISK.DBO.UPLOAD_BLOCK_FILE VALUES('NSX',GETDATE(),'')        
        
        
    SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPLOAD_ReverseFile_Tracker
-- --------------------------------------------------
--[UPLOAD_ReverseFile_Tracker] '','failedcase001_10112013.csv'       
CREATE PROC [dbo].[UPLOAD_ReverseFile_Tracker]          
(          
@USERNAME AS VARCHAR(11) ,        
@FILENAME AS VARCHAR(45)           
)          
AS          
          
          
BEGIN          
          
--Declare @ClientCode varchar(10),          
--    @DpId varchar(50),          
--    @ClientID varchar(50),          
--    @DpType varchar(4),          
--    @UplodedBy varchar(50),                 
--    @ipAddress varchar(50)          
        
--Declare @FILENAME AS VARCHAR(45) = NULL          
--set @FILENAME='failedcase001_29092013.csv'          
          
 set nocount off         
if (substring (@FILENAME,CHARINDEX('_',@FILENAME)+1,          
CHARINDEX('.',@FILENAME)-CHARINDEX('_',@FILENAME)-1)=      
     (select replace(Convert(varchar(11),MAX(update_date),103),'/','')       
     from mis.sccs.dbo.sccs_sharepo_hist with (nolock)))      
BEGIN            
    
 --if not exists (select [filename] from [196.1.115.219].test.dbo.payout_tracker with (nolock) where [filename] = (@FILENAME))       
 
-- if not exists (select * from   
--[ReverseFile_Tracker] RT inner join [196.1.115.219].test.dbo.payout_tracker PT  
--on RT.ClientID=PT.ClientID  
--where substring (@FILENAME,CHARINDEX('_',@FILENAME)+1,          
--CHARINDEX('.',@FILENAME)-CHARINDEX('_',@FILENAME)-1)=substring (PT.[FILENAME],CHARINDEX('_',PT.[FILENAME])+1,          
--CHARINDEX('.',PT.[FILENAME])-CHARINDEX('_',PT.[FILENAME])-1))  
-- BEGIN          
          
  --insert into [196.1.115.219].test.dbo.Payout_Tracker        
  --(ClientCode,DpId,ClientId,DpType,TranLastFailur,ConsecuteCount,AgeOfFailure,[Status],UplodedBy,UplodedOn,IPaddress,[FileName])        
  -- select ClientCode,DpId,ClientID,DpType,GETDATE(),1,0,'P',uploadedBy=@USERNAME,UplodedOn=GETDATE(),'',[Filename]=@FILENAME          
  --  from [ReverseFile_Tracker] with (nolock)          
          
  delete from [196.1.115.219].test.dbo.[ReverseFile_Tracker]         
          
  insert into [196.1.115.219].test.dbo.[ReverseFile_Tracker]          
  (ClientCode,DpId,ClientId,DpType,UplodedBy,UplodedOn,[Filename])          
   select ClientCode,DpId,ClientID,DpType,UplodedBy=@USERNAME,UplodedOn=GETDATE(),[Filename]=@FILENAME          
    from [ReverseFile_Tracker] with (nolock)  
    where ClientCode not in 
						(select ClientCode from [196.1.115.219].test.dbo.payout_tracker  PT
						where substring (@FILENAME,CHARINDEX('_',@FILENAME)+1,          
							  CHARINDEX('.',@FILENAME)-CHARINDEX('_',@FILENAME)-1)
							  =substring (PT.[FILENAME],CHARINDEX('_',PT.[FILENAME])+1,          
							  CHARINDEX('.',PT.[FILENAME])-CHARINDEX('_',PT.[FILENAME])-1))
	and ClientId not in 
						(select ClientId from [196.1.115.219].test.dbo.payout_tracker  PT
						where substring (@FILENAME,CHARINDEX('_',@FILENAME)+1,          
							  CHARINDEX('.',@FILENAME)-CHARINDEX('_',@FILENAME)-1)
							  =substring (PT.[FILENAME],CHARINDEX('_',PT.[FILENAME])+1,          
							  CHARINDEX('.',PT.[FILENAME])-CHARINDEX('_',PT.[FILENAME])-1))
            
           
   set nocount on        
   exec [196.1.115.219].test.dbo.usp_uploadReverseFile        
   set nocount off        
        
 select 'not working'      
       
 --END          
 --else      
 --begin      
 -- select 'Same file cannot be uploaded again'      
 --end      
end          
ELSE           
BEGIN           
  select 'Backdated/FutureDated Entries not allowed'          
END           
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upload_sifyecn
-- --------------------------------------------------
create procedure upload_sifyecn (@filename as varchar(75))
as
BULK INSERT SIFYUPLOAD_TEMP FROM '''+@filename+''' WITH (FIELDTERMINATOR = ',', FirstRow=2,KeepNULLS)

select party_code=LTRIM(RTRIM(party_code)),DOB=Replace(convert(varchar(11),dob,103),'/',''),
cm_name=long_Name,
cm_add1=L_Address1, 
cm_add2=L_Address2,
cm_add3=L_Address3,
cm_city=l_city+' - '+l_zip,
cm_pin=l_state,
Contact_no=case when isnull(mobile_pager,'')<>'' and isnull(res_phone1,'')<>'' 
then mobile_pager+'/'+res_phone1
when isnull(mobile_pager,'')<>'' and isnull(res_phone1,'')='' then mobile_pager
when isnull(mobile_pager,'')='' and isnull(res_phone1,'')<>'' then res_phone1
else '' end
from intranet.risk.dbo.client_Details b  where repatriat_bank_ac_no like '%ECN%' 
AND party_code IN (select party_code from SIFYUPLOAD (nolock))

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_turnoverlist_Master
-- --------------------------------------------------
CREATE proc Upload_turnoverlist_Master(                                  
@filename as varchar(100),          
@server as varchar(20)                                        
)                                    
as                      
declare @path as varchar(100)  
declare @sql as varchar(1000)  
                   
delete from intranet.misc.dbo.tbl_turnoverlist  
  
create table #temp(
sc_code varchar(50), 
symbol varchar(50),     
sc_name varchar(50)  
)                
  
set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename  
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'  
---print @SQL                                  
exec (@sql)  
                                 
insert into intranet.misc.dbo.tbl_turnoverlist  
Select * from #temp  
  
select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Upload_UpdateClientDetails
-- --------------------------------------------------
CREATE proc [dbo].[Upload_UpdateClientDetails] --'update_clientdetails1.txt'                     
(                                              
@filename as varchar(100)                                                    
)                                                
as               
    
create table #t       
(      
Cl_Code varchar(10),      
L_Add1 varchar(500),      
L_City varchar(100),      
L_Add2 varchar(500),      
L_State varchar(200),    
L_Add3 varchar(500),       
L_Zip varchar(30),      
Mobile_pager varchar(25),      
EmailId varchar(150)    
--RowId int identity      
)        
  
declare @path as varchar(100)              
declare @sql as varchar(1000)          
  
select @path =  uploadserver from [CSOKYC-6].upload.dbo.global_upload where upd_srno = 2        
set @path = @path+'\KycUpdatePartyDetails\'+@filename   
--print  @path   
--set @path='\\196.1.115.136\d$\upload1\KycUpdatePartyDetails\'+ @filename
                    
SET @SQL = 'BULK INSERT #t FROM '''+@Path+''' WITH (FIELDTERMINATOR = ''\t'', FirstRow=2,KeepNULLS)'                                               
exec (@sql)       
select @@RowCount as [count]     
    
create table #temp       
(      
Cl_Code varchar(10),      
L_Add1 varchar(500),      
L_City varchar(100),      
L_Add2 varchar(500),      
L_State varchar(200),    
L_Add3 varchar(500),       
L_Zip varchar(30),      
Mobile_pager varchar(25),      
EmailId varchar(150),    
RowId int identity      
)      
    
insert into #temp    
select * from #t    
    
    
Declare @Cl_Code varchar(10),@L_Add1 varchar(50),@L_City varchar(10),@L_Add2 varchar(50),@L_State varchar(20),@L_Add3 varchar(50),@L_Zip varchar(10),@Mobile_pager varchar(25),@EmailId varchar(50)    
Declare @MinRowId int,@MaxRowId int,@CurrRowId int      
select @MinRowId=min(RowId),@MaxRowId=max(RowId) from #temp        
while(@MinRowId <=@MaxRowId)      
Begin      
select @Cl_Code=Cl_Code,@L_Add1=L_Add1,@L_City=L_City,@L_Add2=L_Add2,@L_State=L_State,@L_Add3=L_Add3,@L_Zip=L_Zip,@Mobile_pager=Mobile_pager,@EmailId=EmailId from #temp(nolock)      
where RowId=@MinRowId     
    
if @L_Add1<>''    
update AngelNseCM.msajag.dbo.Client_details set l_address1=@L_Add1 where cl_code=@Cl_Code    
if @L_City<>''    
update AngelNseCM.msajag.dbo.Client_details set l_city=@L_City where cl_code=@Cl_Code    
if @L_Add2<>''    
update AngelNseCM.msajag.dbo.Client_details set l_address2=@L_Add2 where cl_code=@Cl_Code    
if @L_State<>''    
update AngelNseCM.msajag.dbo.Client_details set l_state=@L_State where cl_code=@Cl_Code    
if @L_Add3<>''    
update AngelNseCM.msajag.dbo.Client_details set l_address3=@L_Add3 where cl_code=@Cl_Code    
if @L_Zip<>''    
update AngelNseCM.msajag.dbo.Client_details set l_zip=@L_Zip where cl_code=@Cl_Code    
if @Mobile_pager<>''    
update AngelNseCM.msajag.dbo.Client_details set mobile_pager=@Mobile_pager where cl_code=@Cl_Code    
if @EmailId<>''    
update AngelNseCM.msajag.dbo.Client_details set email=@EmailId where cl_code=@Cl_Code    
    
set @MinRowId=@MinRowId+1       
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPS_RECOMMENDEDSCHEMEUPLOAD
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[UPS_RECOMMENDEDSCHEMEUPLOAD](@filename VARCHAR(100))  
AS  
SET NOCOUNT ON                                                  
SET XACT_ABORT ON                        
BEGIN TRY                   
                                       
  --TRUNCATE TABLE tbl_mfssRecommendedScheme_Temp            
            
  DECLARE @FNAME VARCHAR(100) = '',@SQL VARCHAR(1000) = ''                  
  SELECT  @FNAME=@FILENAME                  
              
 -- SET @SQL='BULK INSERT UPLOAD.DBO.tbl_mfssRecommendedScheme_Temp FROM' + '  ' + '''//196.1.115.173/D$/UPLOAD1/'+@FNAME+'''' + '  ' + 'WITH (FIELDTERMINATOR ='','',FIRSTROW=2, ROWTERMINATOR =''\n'')'                   
 --    PRINT @SQL         
              
 --EXEC(@SQL)                            
                       
 EXEC [INTRANET].RISK.DBO.UPS_RECOMMENDEDSCHEMEUPLOAD @FNAME              
                            
END TRY                                                 
BEGIN CATCH                                                    
           
END CATCH                                       
                                            
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_accrual_charges
-- --------------------------------------------------
CREATE PROC usp_accrual_charges     
(      
   @FILENAME AS VARCHAR(45)      
)      
AS      
BEGIN       
 SET NOCOUNT ON       
      
DELETE FROM DEMAT.DBO.tbl_accrual_charges      
     
     
INSERT INTO DEMAT.DBO.tbl_accrual_charges      
          
SELECT *,GETDATE() FROM  upload.dbo.tbl_tmp_accrual_charges      
      
SET NOCOUNT OFF       
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_ariel
-- --------------------------------------------------






CREATE proc [dbo].[usp_ariel]
as

drop table #a
drop table #b
drop table #xx
drop table #fin
drop table #brok
drop table #fin1
drop table #ncdex
drop table #trdDays

select code into #clients from tbl_ariel (nolock) group by code

select cl_code,active_date=min(active_date) into #adate from AngelNseCM.msajag.dbo.client_brok_details
group by cl_code

select distinct cl_code into #Bo from AngelNseCM.msajag.dbo.client_brok_details
where inactive_from > getdate()

select * into #A_Clients from #clients where code in
(
select * from #Bo
)


select cl_code,branch_cd,l_city,sub_broker,long_name,
Address=L_address1+' '+L_address2+' '+L_address3+' '+L_city+' '+L_zip,
Tel=Res_Phone1,mobile=mobile_pager,email into #x from AngelNseCM.msajag.dbo.client_details x where exists
(select * from #A_Clients y where x.cl_code = y.code)


select x.cl_code,branch_cd,sub_broker,long_name,Address,Tel,mobile,email,
active_date into #a from #x x, #adate y where x.cl_code = y.cl_code


select distinct * into #b from tbl_ariel

select * into #xx from #a x,#b y (nolock) where x.cl_code = y.code

delete from #xx where cl_code in
(
select cl_code from #xx
group by cl_code having count(*) > 1
)


delete from #xx where city not in
(
'Mumbai','Hyderabad','Kolkata','Ahmedabad','Vishakapatnam','lucknow','indore','Ernakulam'
)



select x.*,
B2B2C= case when b2c_sb is null then 'B2B' else 'B2C' end,
Tier= 
case 
when city in ('Mumbai','Hyderabad','Kolkata') then 'Tier1'
when city in ('Ahmedabad','Vishakapatnam','lucknow') then 'Tier2'
when city in ('indore','Ernakulam') then 'Tier3' end into #fin
from #xx x left outer join  remisior.dbo.b2c_sb y on x.sub_broker = y.b2c_sb

select party_code,brokerage=sum(brokerage) into #brok from 
intranet.bsedb_Ab.dbo.mis_to with (nolock) where 
sauda_date >= 'Apr 01 2009'
and sauda_date < 'Apr 01 2010'
group by party_code


select *,vintage_month=datediff(mm,active_Date,getdate()) into #fin1
from #fin x left outer join #brok y on x.cl_code = y.party_code COLLATE SQL_Latin1_General_CP1_CI_AS

select cltcode,count(*) bse into #bse  from
(
select cltcode,max(vdt) vdt --into #bse 
from AngelBSECM.account_ab.dbo.ledger where vtyp = 15 
and vdt >= 'Apr 01 2009' and vdt < 'Apr 01 2010' group by cltcode,vdt
)x group by cltcode

select cltcode,count(*) nse into #nse  from
(
select cltcode,max(vdt) vdt --into #bse 
from AngelNseCM.inhouse.dbo.ledger where vtyp = 15 
and vdt >= 'Apr 01 2009' and vdt < 'Apr 01 2010' group by cltcode,vdt
)x group by cltcode


select cltcode,count(*) nsefo into #nsefo  from
(
select cltcode,max(vdt) vdt --into #bse 
from angelfo.inhouse.dbo.ledger where vtyp = 15 
and vdt >= 'Apr 01 2009' and vdt < 'Apr 01 2010' group by cltcode,vdt
)x group by cltcode



select cltcode,count(*) mcx into #mcx  from
(
select cltcode,max(vdt) vdt from angelcommodity.accountmcdx.dbo.ledger where vtyp = 15 
and vdt >= 'Apr 01 2009' and vdt < 'Apr 01 2010' and vdt not in
(
select tdate from sett_mst where tdate >= 'Apr 01 2009'
and tdate <'Apr 01 2010' and bse = 0
) group by cltcode,vdt
)x group by cltcode



select cltcode,count(*) ncdex into #ncdex  from
(
select cltcode,max(vdt) vdt from angelcommodity.accountncdx.dbo.ledger where vtyp = 15 
and vdt >= 'Apr 01 2009' and vdt < 'Apr 01 2010' and vdt not in
(
select tdate from sett_mst where tdate >= 'Apr 01 2009'
and tdate <'Apr 01 2010' and bse = 0
) group by cltcode,vdt
)x group by cltcode




update #mcx set mcx = 244 where mcx >= 244
update #ncdex set ncdex = 244 where ncdex >= 244

select cltcode,max(bse) as TotCount into #trdDays
from
(
select * from #bse
union all
select * from #nse
union all
select * from #nsefo
union all
select * from #mcx 
union all
select * from #ncdex
)x group by cltcode


select top 10 x.*,reg_code from #fin1 x left outer join #trdDays y on cl_code = y.cltcode 
left outer join intranet.risk.dbo.region z on x.branch_cd = z.code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Asian_scrip_count
-- --------------------------------------------------
CREATE proc USP_Asian_scrip_count      
      
as      
        
declare @cnt as int      
declare @cnt1 as int      
declare @cnt2 as int      
      
set @cnt =  (select count(*) from Asian_Basket)      
set @cnt1 = (select count(*) from [172.31.15.52].Orerms_v2.dbo.orescripgroupmapping)      
set @cnt2 = (@cnt - 2 ) - @cnt1      
      
select * into #t from      
(select Total=@cnt-2,Upload=@cnt1,diff=@cnt2)x      
      
select * from #t

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Asian_scrip_master
-- --------------------------------------------------
CREATE proc USP_Asian_scrip_master(@filename as varchar(100),@fbasket as varchar(50),@tbasket as varchar(50))                                     
as                            
                            
set transaction  isolation  level read uncommitted                                        
                            
declare @s as varchar(500)                            
declare @s1 as varchar(500)                            
declare @file as varchar(500)                            
declare @path as varchar(100)                                    
declare @sql as varchar(1000)                              
--declare @filename as varchar(1000)                              
                            
--delete from [196.1.115.52].Orerms_v2.dbo.orescripgroupmapping                             
--delete from [172.31.0.48].Orerms_v2.dbo.orescripgroupmapping                             
                            
--set @filename = 'Approve.csv'                            
set @file = '\\196.1.115.136\d$\upload1\Asian\BAS'+replace(convert(varchar(11),getdate(),102),'.','')+'01.txt'                            
set @path='\\196.1.115.136\d$\upload1\Asian\' + @filename                                    
                            
-------------------For upload Approved Script FIle---------------------------                            
truncate table Approve                            
SET @SQL = 'BULK INSERT Approve FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                                    
-- print @SQL                                    
exec (@sql)                               
                            
--------------------------Generate Non Apporved File                            
truncate table Asian_Basket                            
select * into #t from [172.31.15.52].FONSEDATABASE.dbo.FONSEScripMaster                             
                            
select a=InstrumentName+Symbol+convert(varchar(11),ExpiryDate,103)+convert(varchar,(convert(dec(15,2),StrikePrice)))+OptionType into #t1 from #t where  InstrumentName  in ('OPTIDX','OPTSTK')                            
and InstrumentName+Symbol+convert(varchar(11),ExpiryDate,103)+convert(varchar,(convert(dec(15,2),StrikePrice)))+OptionType not in                              
(select InstrumentType+Symbol+convert(varchar(11),ExpiryDate,103)+convert(varchar,(convert(dec(15,2),StrikePrice)))+OptionType from Approve)                            
                            
insert into Asian_Basket                            
select '00|BAS|'+replace(convert(varchar(11),getdate(),102),'.','')+'|01'                            
union all      
select '18|FONSE|'+symbol+'~O:'+replace(convert(varchar(9),ExpiryDate,6),' ','-')+':'+OptionType+':'+                            
convert(varchar,(convert(dec(15,0),StrikePrice)))+'|'+@fbasket+'|'+@tbasket    
from #t where  InstrumentName  in ('OPTIDX','OPTSTK')                            
and InstrumentName+Symbol+convert(varchar(11),ExpiryDate,103)+convert(varchar,(convert(dec(15,2),StrikePrice)))+OptionType not in                              
(select InstrumentType+Symbol+convert(varchar(11),ExpiryDate,103)+convert(varchar,(convert(dec(15,2),StrikePrice)))+OptionType from Approve where StrikePrice is not null)                            
union all                            
select '18|FONSE|'+symbol+'~F:'+replace(convert(varchar(9),ExpiryDate,6),' ','-')+'|'+@fbasket+'|'+@tbasket    
from #t where  InstrumentName  in ('FUTIDX','FUTSTK')                            
and Symbol+convert(varchar(11),ExpiryDate,103) not in                              
(select Symbol+convert(varchar(11),ExpiryDate,103) from Approve)    
    
/*                              
union all                            
select '99|'+convert(varchar(15),count(*)) from #t where  InstrumentName  in ('OPTIDX','OPTSTK')                            
*/        
insert into Asian_Basket    
select '99|'+convert(varchar(15),count(*)) from Asian_Basket    
      
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT a FROM MIS.UPload.DBO.Asian_Basket order by a" queryout '+@file+' -c -Sintranet -Uinhouse -Pinh6014'                                          
set @s1= @s+''''                                          
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AutoMail_CMS
-- --------------------------------------------------
CREATE proc usp_AutoMail_CMS(@PTo as varchar(50),@msg as varchar(5000),@file as varchar(500))                                        
as                                  
         
DECLARE @rc INT           
                    
IF NOT EXISTS (SELECT * FROM msdb.sys.service_queues                           
WHERE name = N'ExternalMailQueue' AND is_receive_enabled = 1)                          
EXEC @rc = msdb.dbo.sysmail_start_sp      

                                   
EXEC msdb.dbo.sp_send_dbmail                                                                                                         
@recipients = @PTo,                                      
@profile_name = 'pay-outbanking',                                 
--@from = 'pay-outbanking@angelbroking.com',                                             
--@blind_copy_recipients  = 'tzackgeorge@yahoo.com',                           
@body = @msg,                                                      
@subject = 'Angel Approved Funds Payout Detail',                                      
--@subject = 'Test',                                                        
@file_attachments   = @file,                                                  
@body_format  = 'html'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_AutoMail_COMM
-- --------------------------------------------------

CREATE proc usp_AutoMail_COMM(@To as varchar(500),@msg as varchar(5000),@file as varchar(500),@Branch as varchar(15))          
as          
          
DECLARE @rc INT          
IF NOT EXISTS (SELECT * FROM intranet.msdb.sys.service_queues          
WHERE name = N'ExternalMailQueue' AND is_receive_enabled = 1)          
EXEC @rc = intranet.msdb.dbo.sysmail_start_sp          
          
Begin Tran          
EXEC intranet.msdb.dbo.sp_send_dbmail          
@recipients = @To,          
@profile_name = 'intranet',          
--@from = 'vishal.kachalia@angelbroking.com',          
--@copy_recipients = 'sandeep.kothana@angeltrade.com;deepak.somani@angeltrade.com',          
/* @copy_recipients = '', */         
/* @blind_copy_recipients='rahulc.shah@angelbroking.com', */         
@body = @msg,          
@subject = 'Dormant clients in Commodities',          
@file_attachments = @file,          
@body_format = 'html'          
          
Update Tbl_Comm_Mails_Branch set Status = 'Y' where Fld_Br_Code = @Branch          
          
IF @@ERROR <> 0          
Rollback Tran          
Else          
Commit Tran

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AutoMail_Odin
-- --------------------------------------------------
CREATE proc Usp_AutoMail_Odin(@ToID as varchar(500),@Branch as varchar(20))                                                                      
as                         
         
DECLARE @rc INT                         
IF NOT EXISTS (SELECT * FROM intranet.msdb.sys.service_queues                         
WHERE name = N'ExternalMailQueue' AND is_receive_enabled = 1)                        
EXEC @rc = intranet.msdb.dbo.sysmail_start_sp    
         
Declare @Msg as Varchar(1000)               
              
Set @Msg = 'Dear Sir/Madam,<br><br>              
Today We havent  received your mapping mismatch file('+@Branch+' Branch).<br><br>              
Note : <font color = ''red''> <b> <u> This is compulsory activity & it has to be done before market on daily basis.</u></b></font>'                                                               
                                                                     
EXEC intranet.msdb.dbo.sp_send_dbmail                                                                                                                                                           
@recipients  = @ToID,            
@copy_recipients  ='sachin.rahate@angeltrade.com;vikas@angeltrade.com;dilipkumar.shukla@angeltrade.com',    
@profile_name = 'intranet',                                                                   
--@from = 'sachin.rahate@angeltrade.com',                                                                                                            
@body  = @Msg,                                                                         
@subject = 'Generation of Mismatch Report',                                                                    
@body_format  = 'html'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Axis_Bank
-- --------------------------------------------------
CREATE proc USP_Axis_Bank  
(            
@filename as varchar(100)            
)             
as                
  
set transaction  isolation  level read uncommitted                
declare @path as varchar(100)            
declare @sql as varchar(1000)          
  
truncate table tbl_upload_axis      
  
set @path='d:\upload1\' + @filename  
SET @SQL = 'BULK INSERT tbl_upload_axis FROM '''+@Path+''' WITH (FIELDTERMINATOR = ''\t'', FirstRow=2,KeepNULLS)'            
--print @SQL            
exec (@sql)            
  
create table #t  
(  
Fld_SrNo  int identity(1,1),  
Fld_Data varchar(220)  
)  
  
insert into #t  
select * from tbl_upload_axis  
  
delete from #t where Fld_SrNo in  
(  
select top 5 Fld_SrNo from #t ORDER BY Fld_SrNo desc  
)  
  
select substring(Fld_Data,1,4) as Fld_id,  
substring(Fld_Data,5,10) as Fld_Party_Code,  
substring(Fld_Data,15,11) as Fld_Date,  
substring(Fld_Data,35,30) as Fld_Narration,  
substring(Fld_Data,88,2) as DrCr,  
substring(Fld_Data,90,charindex('.',substring(Fld_Data,90,30))+2) as Fld_Amt,  
substring(Fld_Data,90+charindex('.',substring(Fld_Data,90,30))+2,12) as Fld_Bal   
into #y from #t where Fld_SrNo > 16 and Fld_SrNo not in(17,18)  
and Fld_Data not like '%Not Available%'  
  
insert into tbl_Axis_Bank  
select * from #y where Fld_Party_Code+Fld_Date+DrCr+Fld_Amt Not in  
(select Fld_Party_Code+Fld_Date+Fld_DrCr+Fld_Amt from tbl_Axis_Bank)  
select @@rowcount

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Bank_Statment
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Bank_Statment](@file as varchar(20),@Date as varchar(11))          
as          
          
declare @path as varchar(100)                                  
declare @SQL as varchar(500)                                  
declare @s as varchar(500)                          
declare @s1 as varchar(500)                           
        
/*        
declare @file as varchar(20)        
set @path= 'd:\upload1\' + @file            
set @file = '0600340007964.stmt'        
*/        
          
set @path= 'd:\upload1\' + @file            
        
truncate table tlb_Bank_Statment_1          
truncate table tlb_Bank_Statment          
truncate table tlb_Gen_File          
        
          
SET @SQL = 'BULK INSERT tlb_Bank_Statment FROM '''+@path+''' with (ROWTERMINATOR = ''\n'')'                                
exec(@SQL)          
          
insert into tlb_Bank_Statment_1          
--select replace(Fld_Stat,',',' ') from tlb_Bank_Statment             
select Fld_Stat from tlb_Bank_Statment             
          
select * into #t from tlb_Bank_Statment_1          
        
/*        
delete from #t where Fld_Sr_No >= 2745 and Fld_Sr_No <= 2748          
delete from #t where Fld_Sr_No >= 2750          
*/        
        
delete from #t where Fld_Sr_No <= 18          
        
delete from #t where Fld_Sr_No >= (select Fld_Sr_No-6 from #t where charindex('End Of Statement',Fld_Stat) <> 0)        
and Fld_Sr_No <= (select (select Fld_Sr_No-6 from #t where charindex('End Of Statement',Fld_Stat) <> 0)+3)        
        
delete from #t where Fld_Sr_No  >= (select Fld_Sr_No from #t where charindex('End Of Statement',Fld_Stat) <> 0)-1        
        
          
/*          
select           
left(Fld_Stat,21),          
substring(Fld_Stat,21,41),          
substring(Fld_Stat,62,17),          
substring(Fld_Stat,79,12),          
substring(Fld_Stat,91,17),          
substring(Fld_Stat,108,17),          
substring(Fld_Stat,125,15)          
from #t          
*/          
          
select Fld_Sr_No,           
left(replace(Fld_Stat,',',' '),21) as Branch,          
substring(replace(Fld_Stat,',',' '),21,41) as Descr,          
substring(Fld_Stat,62,17) as Ref_No,          
substring(Fld_Stat,79,12) as Value_Date,          
substring(Fld_Stat,91,17) as Debit,          
substring(Fld_Stat,108,17) as Credit,          
substring(Fld_Stat,125,15) as Bal          
into #t1  from #t            
    
          
update #t1 set Descr = 'Opening balance' where Fld_Sr_No = '19'          
          
update #t1 set Debit = '' where rtrim(ltrim(debit)) = '0.00'          
update #t1 set Credit = '' where rtrim(ltrim(Credit)) = '0.00'          
          
insert into tlb_Gen_File          
select 'Book Date'+'|'+'Description'+'|'+'Ledger Balance'+'|'+'Credit'+'|'+'Debit'+'|'+'Value Date'+'|'+'Reference No'+'|'+'Transaction Branch'            
          
insert into tlb_Gen_File          
select @Date+'|'+rtrim(ltrim(Descr))+'|'+rtrim(ltrim(Bal))+''+'|'+'|'+'|'+'|'+'|'+'|' from #t1 where Fld_Sr_No = '19'          
          
insert into tlb_Gen_File          
select @Date+'|'+rtrim(ltrim(Descr))+'|'+'|'+ltrim(rtrim(credit))+'|'+ltrim(rtrim(debit))+'|'+rtrim(ltrim(convert(varchar(11),convert(datetime,value_date,112),103)))+'|'+ltrim(rtrim(Ref_No))+'|'+ltrim(rtrim(branch))from #t1 where Fld_Sr_No <> (select Fld_Sr_No from #t where charindex('Closing',Fld_Stat) <> 0)        
        
insert into tlb_Gen_File select ' '          
          
insert into tlb_Gen_File          
select @Date+'|'+rtrim(ltrim(Descr))+'|'+rtrim(ltrim(Bal))+''+'|'+'|'+'|'+'|'+'|'+'|' from #t1 where Fld_Sr_No = (select Fld_Sr_No from #t where charindex('Closing',Fld_Stat) <> 0)        
          
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT fld_stat FROM mis.UPLOAD.DBO.tlb_Gen_File " queryout '+'d:\upload1\HDFC.txt -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                        
set @s1= @s+''''                               
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Bounce_Sify_proc
-- --------------------------------------------------
CREATE proc usp_Bounce_Sify_proc
(                
@access_to as varchar(50),                
@access_code as varchar(50),                
@br_code as varchar(50)                         
)                
                
as                
    

if @access_to = 'BROKER'                
begin   

SELECT COALESCE(a.branch_cd,b.branch_cd) as branch,COALESCE(a.Sub_Broker,b.Sub_Broker) as Sub_Broker,
COALESCE(a.ClientCode,b.ClientCode) as ClientCode,COALESCE(a.ClientName,b.ClientName) as ClientName,a.clientaddress,
a.Pincode,a.Mobile,a.ResPhone,a.TCName,a.Code,a.Remark,b.EmailID,b.mobile,b.ResPhone,b.telcaller,b.code,
b.remark,b.minorchangeid,b.newid
FROM  tbl_ControlFileClientLetter a
FULL OUTER JOIN
(select * from  tbl_clientdata_record )b
on a.clientcode=b.clientcode where a.branch_Cd='acm' or b.branch_cd='acm' order by clientcode
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_branch_upload_Data
-- --------------------------------------------------
CREATE procedure usp_branch_upload_Data(@filename as varchar(25))              
as          
        
declare @cnt int        
select @cnt=count(clientcode) from tbl_temp_branchdata_temp where clientcode in (select clientcode from  tbl_temp_branchdata)        
        
if @cnt = 0        
begin        
insert into tbl_temp_branchdata select * from tbl_temp_branchdata_temp         
truncate table tbl_temp_branchdata_temp        
end     
    
select         
a.clientcode,        
b.cour_compn_name,        
a.dispatchdate,        
a.reason,        
a.pod ,case when a.clientcode = b.client_code then  'KIT IS ALREADY DISPATCHED TO BRANCH.'        
else 'KIT IS NOT DISPATCHED YET' end as status,        
case when a.reason = c.reason then 'Active status' else 'Invalid Status' end as Invalidstatus        
from mis.upload.dbo.tbl_temp_branchdata a          
left outer join intranet.nsecourier.dbo.delivered b on a.clientcode = b.client_code        
left outer join intranet.nsecourier.dbo.return_remarks c on a.reason = c.reason        
      
declare @cnt2 as int      
      
set @cnt2 = (select count(client_code) from intranet.nsecourier.dbo.tbl_temp_branchdata where client_code in (select fld_clcode from intranet.nsecourier.dbo.Tbl_Delivered_Branch))      
if @cnt2 = 0                                                                    
begin      
insert into intranet.nsecourier.dbo.Tbl_Delivered_Branch        
select b.client_code,b.client_name,a.pod,b.cour_compn_name,b.branch_cd,b.sb_code,        
a.reason,b.surface_zone,'0-250' as weight,'8.00' as rate,convert(datetime,a.dispatchdate,103) as branch_delivered_date,b.dispatch_date,''        
from        
mis.upload.dbo.tbl_temp_branchdata a inner join intranet.nsecourier.dbo.delivered b         
on a.clientcode = b.client_code  
--print @cnt2      
end    

select         
a.clientcode,        
b.cour_compn_name,        
convert(varchar(11),a.dispatchdate,103) as dispatch_date,        
a.reason,        
a.pod ,case when a.clientcode = b.client_code then  'KIT IS ALREADY DISPATCHED TO BRANCH.'        
else 'KIT IS NOT DISPATCHED YET' end as status,        
case when a.reason = c.reason then 'Active status' else 'Invalid Status' end as Invalidstatus into #temp        
from MIS.upload.dbo.tbl_temp_branchdata a          
left outer join intranet.nsecourier.dbo.delivered b on a.clientcode = b.client_code        
left outer join intranet.nsecourier.dbo.return_remarks c on a.reason = c.reason        
order by dispatch_Date    
        
UPDATE delivered        
SET delivered ='BR'          
FROM delivered INNER JOIN #temp        
ON delivered.client_code = #temp.clientcode       
      
delete from delivery_ack  where client_code in(select clientcode from #temp)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_branch_upload_Data_new1
-- --------------------------------------------------
  
--exec   usp_branch_upload_Data_new1 '30092010.xls'  
CREATE proc usp_branch_upload_Data_new1                                                               
(                                                                                
@filename as varchar(100)                         
---@server as varchar(25)                          
)                                                                                  
as                                 
truncate table tbl_temp_branchdata                                                  
--declare @filename as varchar(100)                                                               
--set @filename='29_03_2010.xls'                                              
--                    
--declare @server as varchar(100)                                                               
--set @server='196.1.115.173'                                              
                    
declare @path as varchar(200)                                                                                            
declare @sql as varchar(1000)                                                                      
declare @sql1 as varchar(1000)                                                                    
--truncate table tbl_shortageApproved                                              
--set @path='\\'+@server+'\d$\upload1\RETURNED\'+@filename                              
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\RETURNED\'+@filename                              
                       
SET @SQL1 = 'insert into tbl_temp_branchdata select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;HDR=''Yes'';DATABASE='''+@path+''',''Select * from [Sheet1$]'' )'            
                                                                       
print @sql1                                                      
exec (@sql1)             
            
select  count(*) as count from tbl_temp_branchdata

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Bse_illscrip
-- --------------------------------------------------
CREATE PROCEDURE USP_BSE_ILLSCRIP (@FILENAME AS VARCHAR(25))                  
AS        
BEGIN    
      
INSERT INTO INTRANET.MISC.DBO.ILLSCRIP       
SELECT SCRIP_CD ,REPLACE(SCRIPTNAME,',',''),      
    DATENAME(MM,GETDATE()),    
       DATENAME(MM,GETDATE()-30),DATENAME(YY,GETDATE()-30)    
FROM ILLSCRIP_MONTH_TEMP      
WHERE SCRIP_CD IS NOT NULL                
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_bse_scrip
-- --------------------------------------------------

CREATE procedure [dbo].[Usp_bse_scrip](@filename as varchar(25))
AS
declare @added_by as varchar(50),@added_on as varchar(50),@type as varchar(50)
set @added_by=''
set @added_on=getdate()
 set @type='NA'
insert into scrip_master 
select ltrim(rtrim(a.scri_code)),a.exchange,a.scrip_symbol,a.scrip_name,a.series,a.ISIN,@type,@added_by,@added_on 
from scrip_master_bse_temp a
left outer join
scrip_master b
on isnull(ltrim(rtrim(a.scri_code)),'')=isnull(ltrim(rtrim(b.scri_code)),'') and isnull(ltrim(rtrim(a.scrip_symbol)),'')=isnull(ltrim(rtrim(b.scrip_symbol)),'') and isnull(ltrim(rtrim(a.isin)),'')=isnull(ltrim(rtrim(b.isin)),'')
where b.scri_code is null

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_bsefo_mismatch
-- --------------------------------------------------
CREATE PROC [dbo].[Usp_bsefo_mismatch]      
AS        
    SET NOCOUNT ON        
    SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED      
        
  BEGIN        
      SELECT TradeNumber,        
             TradeDateTime,        
             TradeStatus,        
             SegmentIndicator,      
             SettlementType,        
             ProductType,        
             ProductCode,        
             AssetCode,        
             ExpiryDate,        
             StrikePrice,        
             optiontype,        
             CALevel,        
             BuyBroker,        
             SellBroker,        
             TradePrice,        
             TradeQuantity,        
             seriesid,        
             TradeBuyerlocation,        
             buyCMCode,        
             SellCMCode,        
             tradeSellerLocation,        
             buyCustodianParticipant,        
             BuySideConfirmation,        
             SellCustodialParticipant,        
             SellSideConfirmation,        
             BuyCoveredUncoveredFlag,        
             SellCoveredUncoveredFlag,        
             BuyOldCustodialParticipant,        
             BuyOldCM,        
             SellOldCustodialParticipant,        
             SellOldCM,        
             TermId=CASE        
                      WHEN Isnull(TRADEBUYERTERMINALID, '') = '' THEN TRADESELLERTERMINALID        
                      ELSE TRADEBUYERTERMINALID        
                    END,        
             buyOrder,        
             sellOrder,        
             ClientCode=CASE        
                          WHEN Isnull(buyClientCode, '') = '' THEN sellClientCode        
                          ELSE buyClientCode        
                        END,        
             buyRemark,        
             sellRemark,        
             buyPosition,        
             sellPosition,        
             BuyProprietorClientFlag,        
             SellProprietorClientFlag,        
             BuyOrderTimeStamp,        
             SellOrderTimeStamp,        
             BuyOrderActiveFlag,        
             SellOrderActiveFlag        
      INTO   #BSEFO_TRD        
      FROM   bse.DBO.bsefotrd WITH(NOLOCK)        
        
      SELECT *        
      INTO   #BSE_TERMID        
      FROM   BSE.DBO.BSE_TERMID WITH (nolock)        
      WHERE  segment = 'BSE FO'      
        
      TRUNCATE TABLE TBL_BSEFO_MISMATCH  
        
      --------------MISSING SCRIP-------------------      
      INSERT INTO TBL_BSEFO_MISMATCH       
      SELECT DISTINCT ProductCode,        
                      [AssetCode],      
                      '',      
                      '',      
                      '',      
                      'MS',      
                      '',      
                      GETDATE()      
      FROM   #BSEFO_TRD X        
      WHERE  NOT EXISTS (SELECT Product_Code        
                         FROM   AngelCommodity.bsefo.dbo.BFOSCRIP2 y WITH (nolock)        
                         WHERE  Cast(x.ProductCode AS VARCHAR) = y.Product_Code)        
        
      --------------MISSING TERMINAL ID---------------        
      INSERT INTO TBL_BSEFO_MISMATCH      
      SELECT DISTINCT'','',      
              X.termid,      
             '',      
             '',      
             'MT',      
             '',      
             GETDATE()      
      FROM   #BSEFO_TRD X WITH (nolock)        
             LEFT OUTER JOIN (SELECT termid        
                              FROM   #BSE_TERMID)Y        
               ON x.termid = y.termid        
      WHERE  Isnull(y.termid, '') = ''        
        
      --------------MISSING CLIENTS-------------------      
      INSERT INTO TBL_BSEFO_MISMATCH      
      SELECT '','',      
             a.termid,      
             a.ClientCode,      
             b.branch_cd,      
             'MC',      
             '<B>PARTY CODE :</B>' + ClientCode + ' ' + '<B>TERMINAL ID :</B>' + CONVERT(VARCHAR,A.termid) + ' ' + '<B> BRANCH CODE : </B>' + b.branch_cd,      
             GETDATE()       
      FROM   (SELECT DISTINCT ClientCode,        
                              termid        
              FROM   #BSEFO_TRD x WITH (nolock)        
              WHERE  NOT EXISTS (SELECT *        
                              FROM   AngelCommodity.bsefo.dbo.client1 y WITH (nolock)        
                                 WHERE  x.ClientCode = y.cl_code))a        
             LEFT OUTER JOIN (SELECT termid,        
             branch_cd        
                              FROM   #BSE_TERMID) b        
               ON a.termid = b.termid        
        
  /*       */        
      --------------INACTIVE CLIENTS------------------      
      SELECT DISTINCT CL_CODE        
      INTO   #TEMPCLIENT5        
      FROM   AngelNseCM.MSAJAG.DBO.CLIENT5 WITH (NOLOCK)        
      WHERE  INACTIVEFROM <= Getdate()        
            
      INSERT INTO TBL_BSEFO_MISMATCH       
      SELECT DISTINCT '','',      
                     a.termid,       
                     a.ClientCode,      
                     b.branch_cd,      
                     'IC',      
                     '<B>PARTY CODE :</B>' + a.ClientCode + '<B>TERMINAL ID :</B>' + CONVERT(VARCHAR,A.termid) + ' ' + '<B> BRANCH CODE : </B>' + b.branch_cd,      
                      GETDATE()        
      FROM   (SELECT DISTINCT ClientCode,        
                              termid        
              FROM   #BSEFO_TRD x WITH (nolock)        
              WHERE  EXISTS (SELECT CL_CODE        
                             FROM   #tempclient5 y        
                             WHERE  x.ClientCode = y.cl_code))a        
             LEFT OUTER JOIN (SELECT termid,        
                                     branch_cd        
                              FROM   #BSE_TERMID) b        
               ON a.termid = b.termid        
        
      --------------DORMANT CLIENTS-------------------      
      INSERT INTO TBL_BSEFO_MISMATCH      
      SELECT DISTINCT '','',      
                     a.termid,      
                     a.ClientCode,      
                     c.branch_cd,      
                     'DC',      
                     '<B>PARTY CODE :</B>' + a.ClientCode +       
                     '<B>TERMINAL ID :</B>' + CONVERT(VARCHAR(10), a.termid) + ' ' +       
                     '<B> BRANCH CODE : </B>' + c.branch_cd,      
                      GETDATE()        
      FROM   #BSEFO_TRD A        
             INNER JOIN (SELECT PARTY_CODE        
                         FROM   INTRANET.RISK.DBO.DORMANT_CLIENT WITH(NOLOCK)        
                         WHERE  EXCHANGE = 'BSE'        
                                AND SEGMENT = 'FUTURES') B        
               ON A.ClientCode = B.PARTY_CODE        
             LEFT OUTER JOIN (SELECT termID,        
                                     BRANCH_CD        
                              FROM   #BSE_TERMID) c        
               ON a.termid = c.termid        
      ORDER  BY A.ClientCode        
        
      --------------MISMATCH BRANCHES-------------------        
      SELECT *        
      INTO   #WRONG_BRANCH        
      FROM   (SELECT a.*,        
                     b.branch_cd        
              FROM   (SELECT x.ClientCode,        
                             x.termid,        
                             y.branch_cd1,        
                             y.sub_broker        
                      FROM   (SELECT DISTINCT ClientCode,        
                                              termid        
                              FROM   #BSEFO_TRD (nolock)) x        
                             INNER JOIN (SELECT cl_code,        
                                                branch_Cd AS branch_cd1,        
                                                SUB_BROKER        
                                         FROM   AngelNseCM.msajag.dbo.client1 WITH (nolock)) y        
                               ON x.ClientCode = y.cl_code) a        
                     INNER JOIN (SELECT termid,        
                                        branch_cd        
                                 FROM   #BSE_TERMID WITH (nolock)        
                                 WHERE  segment = ' '        
                                        AND branch_cd <> 'ALL') b        
                       ON a.termid = b.termid) g        
      WHERE  branch_cd1 <> branch_CD        
            
      INSERT INTO TBL_BSEFO_MISMATCH       
      SELECT '','',      
             CONVERT(VARCHAR,termid),      
             ClientCode,      
             BRANCH_CD,      
             'MBR',      
             '<B>PARTY CODE :</B>' + ClientCode + ' ' +       
             '<B> BR :</B>' + BRANCH_CD1 + '<B> SB : </B>' + sub_broker +       
             '<B> TERMINAL ID : </B>' + CONVERT(VARCHAR,termid) + '<B> TERM BR : </B>' + BRANCH_CD,      
             GETDATE()        
      FROM   #WRONG_BRANCH x        
      WHERE  NOT EXISTS (SELECT *        
                         FROM   mis.ps03.dbo.alternatebranchsb y WITH (nolock)        
                         WHERE  y.alt_Exchange = 'BSEFO'        
                                AND x.termid = y.alt_termid        
                                AND x.branch_cd1 = y.alt_branchSB)        
        
      --------------NRI CLIENTS-------------------        
  /*        
   SELECT party_code,        
          branch_cd,        
          sub_broker        
   INTO   #NRI        
   FROM   AngelNseCM.msajag.dbo.client_details WITH (nolock)        
   WHERE  cl_status = 'NRI'        
          
   SELECT a.[Account Number],        
          a.symbol        
   INTO   #NRI1        
   FROM   (SELECT DISTINCT ClientCode,        
                           ProductCode        
           FROM   #BSEFO_TRD WITH (nolock)        
           WHERE  ClientCode IN (SELECT party_code        
                                 FROM   #NRI)        
                  AND [buy/sell] = 1)a        
          INNER JOIN (SELECT DISTINCT ClientCode,        
                                      ProductCode        
                      FROM   #BSEFO_TRD WITH (nolock)        
                      WHERE  ClientCode IN (SELECT party_code        
                                            FROM   #NRI)        
   AND [buy/sell] = 2)b        
            ON a.ClientCode = b.ClientCode        
               AND a.ProductCode = b.ProductCode         
           
   SELECT x.[Account Number],        
          x.symbol,        
          y.branch_cd,        
          y.sub_broker        
   INTO   #temp2        
   FROM   (SELECT *        
           FROM   #temp1)x        
          INNER JOIN (SELECT *        
                      FROM   #temp)y        
            ON x.[Account Number] = y.PARTY_CODE        
          
   INSERT INTO tbl_NseCurrency_Mismatch        
   SELECT '<B>NRI CLIENTS</B>',        
          '',        
          '',        
          ''        
          
   INSERT INTO tbl_NseCurrency_Mismatch        
   SELECT '<B>NRIClientId :</B>' + ' ' + Cast([Account Number] AS VARCHAR) + ' ' + '<B> Of Branch :</B>' + ' ' + branch_cd + '<B> and SubBroker :</B>' + sub_broker + ' ' + '<B> has Traded on :</B>' + symbol + ' ',        
          [Account Number],        
          '',        
          branch_cd        
   FROM   #temp2 (nolock)         
          
  */        
      --------------SEBI BANNED CLIENTS-------------------        
      SELECT *        
      INTO   #Sebi_banned        
      FROM   BSE.dbo.Sebi_bannedFromintranet WITH(nolock)        
            
      INSERT INTO TBL_BSEFO_MISMATCH      
      SELECT DISTINCT '','','',      
                      a.ClientCode,      
                      '',      
                      'SBC',      
                      '<B>PARTY CODE :</B>' + a.ClientCode,      
                      GETDATE()      
      FROM   #BSEFO_TRD a WITH (nolock)        
             INNER JOIN #Sebi_banned b(nolock)        
               ON a.ClientCode = b.Party_Code        
  --------------SEBI BANNED SCRIPS-------------------        
  --SELECT * FROM [196.1.115.182].GENERAL.DBO.VW_BLK_RESTRICT_SCRIP        
        
      
        
        
        
  END        
        
    SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_bsefo_mismatch_rpt
-- --------------------------------------------------

CREATE PROC Usp_bsefo_mismatch_rpt (@RPT_TYPE    AS VARCHAR(10),    
                                   @ACCESS_TO   AS VARCHAR(20),    
                                   @ACCESS_CODE AS VARCHAR(20))    
AS    
    IF @ACCESS_TO = 'BROKER'    
      BEGIN    
          SELECT ProductCode as [PRODUCT CODE],    
                 AssetCode AS [ASSET CODE],    
                 TermID AS [TERMINAL ID],    
                 ClientCode AS [CLIENT CODE],    
                 branch_cd AS [BRANCH],    
                 CASE    
                   WHEN RPT_TYPE = 'MS' THEN 'MISSING SCRIP'    
                   WHEN RPT_TYPE = 'MT' THEN 'MISSING TERMINALID'    
                   WHEN RPT_TYPE = 'MC' THEN 'MISSING CLIENTS'    
                   WHEN RPT_TYPE = 'IC' THEN 'INACTIVE CLIENTS'    
                   WHEN RPT_TYPE = 'DC' THEN 'DORMANT CLIENTS'    
                   WHEN RPT_TYPE = 'MBR' THEN 'MISMATCH BRANCHES'    
                   WHEN RPT_TYPE = 'NRI' THEN 'NRI CLIENTS'    
                   WHEN RPT_TYPE = 'SBC' THEN 'SEBI BANNED CLIENTS'    
                 END       AS [REPORT TYPE],    
                 REMARKS,    
                 Updated_on AS [UPDATED ON]    
          FROM   TBL_BSEFO_MISMATCH WITH(NOLOCK)    
          WHERE  RPT_TYPE LIKE @RPT_TYPE    
      END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BSEFOTrade_Upload
-- --------------------------------------------------
CREATE PROC USP_BSEFOTrade_Upload    
 (                       
   @FILENAME AS VARCHAR(45)    
   --,@USERNAME AS VARCHAR(20)    
 )                  
 AS                  
 BEGIN         
 BEGIN                
   SET NOCOUNT ON      
   DELETE FROM bse.DBO.bsefotrd    
      
  END       
           
INSERT INTO bse.DBO.bsefotrd    
SELECT * FROM UPLOAD.DBO.bsefotrade_temp with (nolock)          
SET NOCOUNT OFF      
    
insert into bse.DBO.bsefotrdhist    
select *,GETDATE(),'' from bse.DBO.bsefotrd with (nolock)    
  
--exec [196.1.115.219].test_data.dbo.Usp_bsefo_mismatch  

exec Usp_bsefo_mismatch  
    
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_bulk__NSE_SPAN
-- --------------------------------------------------
CREATE proc USP_bulk__NSE_SPAN  
as          
          
set transaction  isolation  level read uncommitted                              

declare @sql as varchar(1000)     
declare @path as varchar(500)          
  
set @path = 'D:\upload1\NSESPAN\ael.csv'      
  
truncate table tblnseSpan  

SET @SQL = 'BULK INSERT tblnseSpan FROM '''+@path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                  
--print @SQL   
  
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_COMMODITY_MARGIN
-- --------------------------------------------------
  
CREATE proc [dbo].[USP_BULK_COMMODITY_MARGIN]              
(                      
@filename as varchar(100)                      
)                       
as                          
set transaction  isolation  level read uncommitted                          
              
declare @path as varchar(100)                      
declare @sql as varchar(1000)                   
declare @s as varchar(1000)                
declare @s1 as varchar(1000)               
                     
truncate table comm_margin_text               
              
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename                      
SET @SQL = 'BULK INSERT comm_margin_text FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                      
-- print @SQL                      
exec (@sql)                         
               
truncate table comm_margin              
              
--select * from comm_margin_text              
            
-- insert into comm_margin              
-- select Sr_No,Instrument_Type,Symbol,Expiry_Date,Exposure_margin,Additional_Pre_expiry_margins,              
-- Additional_Margin_Long=Additional_Margin_Long+Special_Ch_Margin_Long,Additional_Margin_Short=Special_Ch_Margin_Short+Additional_Margin_Short              
-- from comm_margin_text              
            
insert into comm_margin              
select Sr_No,Instrument_Type,Symbol,Expiry_Date,Exposure_margin=Exposure_margin+Additional_Pre_expiry_margins+Additional_Margin_Long+Special_Ch_Margin_Long,Additional_Pre_expiry_margins,              
Additional_Margin_Long=Additional_Margin_Long+Special_Ch_Margin_Long,Additional_Margin_Short=Special_Ch_Margin_Short+Additional_Margin_Short              
from comm_margin_text              
              
truncate table Comm_Txt              
              
insert into Comm_Txt              
select 'Sr_No'+','+'Instrument_Type'+','+'Symbol'+','+'Expiry_Date'+','+'[Exposure_Margin%]'+','+'Additional_Pre_expiry_margins'+','+'[Additional_Margin_Long%]'+','+'[Additional_Margin_Short%]'              
              
insert into Comm_Txt              
select  convert(varchar,Sr_No)+','+rtrim(ltrim(Instrument_Type))+','+rtrim(ltrim(Symbol))+','+rtrim(ltrim(Expiry_Date))+','+ convert(varchar,[Exposure_Margin%] )+','+ convert(varchar,Additional_Pre_expiry_margins )+','+convert(varchar,[Additional_Margin_Long%])+','+convert(varchar,[Additional_Margin_Short%]) from comm_margin              
              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp "select margin from mis.upload.DBO.Comm_Txt" queryout \\INHOUSEALLAPP-FS.angelone.in\D$\upload1\RM\Commodity_Margin.txt -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
set @s1= @s+''''                                          
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_MAILS_COMM
-- --------------------------------------------------
CREATE Proc [dbo].[USP_BULK_MAILS_COMM]                  
AS                  
                
                
Declare  @branch_cd as varchar(100)           
Declare  @Fld_Email as varchar(500)               
Declare  @file as varchar(1000)                
Declare  @s as varchar(1000)                
Declare  @s1 as varchar(1000)                
Declare  @MSG as varchar(8000)                
                
                
SET @MSG = '<BR>Dear All,<BR>'                
SET @MSG = @MSG+'<P>Please find the enclosed list of inactive clients (clients not traded since last 6 months)                 
     from your branch.<br>You are requested to obtain the written request in the attached format before                 
     executing any trades for these clients.</P>'                
SET @MSG = @MSG+'<P>Please ensure not to execute any trades without obtaining necessary authority letter from the client.<br>                 
    Failing which, the branch will be solely responsible for any action taken / penalty imposed by exchange.</P>'                
SET @MSG = @MSG+'<P>For further clarification, please feel free to contact Commodities team @ 022-30871400 ext 320/276.</P>'                  
              
select cl_code,branch_cd,sub_broker,              
case when MCDX_LAST_DATE <= GETDATE()-180 then 'DEACTIVE' else 'ACTIVE' end as MCDX,              
case when NCDX_LAST_DATE <= GETDATE()-180 then 'DEACTIVE' else 'ACTIVE' end as NCDX,              
case when res_phone1 = '' then res_phone2 when res_phone2 = '' then mobile_pager  else res_phone2 end as Contact_No              
into #t              
from intranet.risk.dbo.client_details where                   
(NCDX_LAST_DATE <= GETDATE()-180 OR                   
MCDX_LAST_DATE <= GETDATE()-180)                   
AND (isnull(NCDX,'N') = 'Y' OR isnull(MCDX,'N') = 'Y') and                  
Last_inactive_date >= getdate() and long_name not like '%Vandha%' and    
(MCDX_LAST_DATE <> '1900-01-01 00:00:00.000' or NCDX_LAST_DATE <> '1900-01-01 00:00:00.000')                
              
--select * into #y from #t where MCDX = 'DEACTIVE' and NCDX = 'DEACTIVE'               
--select * from #t where MCDX = 'DEACTIVE'   
              
select cltcode,max(vdt) as vdt into #mcdx from angelcommodity.accountmcdx.dbo.ledger x where               
exists              
(              
select * from #t y where x.cltcode = y.cl_code and              
MCDX = 'DEACTIVE'  
) and vtyp = 15 group by cltcode              
              
select cltcode,max(vdt) as vdt into #ncdx from angelcommodity.accountncdx.dbo.ledger x where               
exists              
(              
select * from #t y where x.cltcode = y.cl_code and              
MCDX = 'DEACTIVE'   
) and vtyp = 15 group by cltcode              
  
  
insert into tbl_Comm_HIST  
select *,'MCDX' as Segment,getdate() as Fld_Date from #mcdx  
union all  
select *,'NCDX' as Segment,getdate() as Fld_Date from #ncdx  
  
----------------------Deactive MCDX Clients  
begin tran  
  
set XACT_ABORT on  
update angelcommodity.mcdx.dbo.tblusercontrolmaster set fldstatus=1 where flduserid in  
(  
select fldauto from angelcommodity.mcdx.dbo.tblpradnyausers   
where fldstname in (select cltcode from #mcdx)  
)  
  
----------------------Deactive NCDX Clients  
update angelcommodity.Ncdx.dbo.tblusercontrolmaster set fldstatus=1 where flduserid in  
(  
select fldauto from angelcommodity.ncdx.dbo.tblpradnyausers   
where fldstname in (select cltcode from #ncdx)  
)  
  
IF  @@ERROR <> 0    
       Rollback Tran    
Else    
       Commit Tran    
  
-----------------------End For Update Part-----------------    
              
select x.*,              
convert(varchar(11),y.vdt) as MCDX_Bill_date,              
convert(varchar(11),z.vdt) as NCDX_Bill_date              
into #xx   
from               
(select * from #t) x              
left outer join              
(select * from #mcdx) y              
on x.cl_code = y.cltcode              
left outer join              
(select * from #ncdx) z on              
x.cl_code = z.cltcode   
        
select distinct branch_cd into #branches from #xx                    
                
DECLARE Comm_Mails CURSOR FOR select Fld_Email,Fld_Br_Code from Tbl_Comm_Mails_Branch where Fld_Br_Code in (select branch_cd from #branches)          
OPEN Comm_Mails                                       
                                                                    
FETCH NEXT FROM Comm_Mails                                                                     
INTO @Fld_Email,@branch_cd                                                                
                                                                    
WHILE @@FETCH_STATUS = 0                                              
                                                                
BEGIN                
                
truncate table Tbl_Comm_Mails                
                
insert into Tbl_Comm_Mails                
select 'Party Code'+','+'Branch Code'+','+'Sub Broker'+','+'MCDX'+','+'NCDEX'+','+'MCDX LAST BILL DATE'+','+'NCDX LAST BILL DATE'+','+'CONTACT NO'+','+'NARATION'                  
                
insert into Tbl_Comm_Mails                
select rtrim(ltrim(cl_code))+','+ltrim(rtrim(branch_cd))+','+ltrim(rtrim(sub_broker))+','+                
rtrim(ltrim(MCDX))+','+                
rtrim(ltrim(NCDX))+','+                
rtrim(ltrim(isnull(MCDX_bill_date,'Opening Bal')))+','+              
rtrim(ltrim(isnull(NCDX_bill_date,'Opening Bal')))+','+              
rtrim(ltrim(Contact_No))+','+'Being client not trading since last 6 month'                
from #xx where branch_Cd = @branch_cd                            
                
set @file = 'D:\upload1\Comm_Mails\'+'Inactive_list'+'_'+ltrim(rtrim(@branch_cd))+'.csv'      
                                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_Msg FROM MIS.upload.DBO.Tbl_Comm_Mails" queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                          
set @s1= @s+''''                                                          
exec(@s1)                  
--print @s1                
      
declare @file1 as varchar(300)      
set @file1 = @file+';'+'D:\upload1\Comm_Mails\Client_Confirmation.doc'         
                
Exec usp_AutoMail_COMM @Fld_Email,@MSG,@file1                   
                
FETCH NEXT FROM Comm_Mails                                                                     
INTO @Fld_Email,@branch_cd                                            
                                          
END                                                                    
                                            
CLOSE Comm_Mails                                                                    
DEALLOCATE Comm_Mails

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_MAILS_COMM_Insp
-- --------------------------------------------------
  
CREATE Proc [dbo].[USP_BULK_MAILS_COMM_Insp](@mdate as varchar(11))                                                          
AS                                                          
                                                        
                                                        
Declare  @branch_cd as varchar(100)                                                   
Declare  @Fld_Email as varchar(500)                                                       
Declare  @file as varchar(1000)                                                        
Declare  @s as varchar(1000)                                                        
Declare  @s1 as varchar(1000)                                                        
Declare  @MSG as varchar(8000)                                                        
declare @tdate as datetime  
set @tdate = CONVERT(datetime,@mdate)                                      
                                                        
                                                        
SET @MSG = '<BR>Dear All,<BR>'                                                        
SET @MSG = @MSG+'<P>Please find the enclosed list of inactive clients (clients not traded since last 6 months)                                                         
          from your branch.<br>You are requested to obtain the written request in the attached format before                                                         
     executing any trades for these clients.</P>'                                                        
SET @MSG = @MSG+'<P>Please ensure not to execute any trades without obtaining necessary authority letter from the client.<br>                                                         
     Failing which, the branch will be solely responsible for any action taken / penalty imposed by exchange.</P>'                                                        
SET @MSG = @MSG+'<P>For further clarification, please feel free to contact Commodities team @ 022-28358800 ext 775. </P>'                                                                             
                                        
--------------------------------MCX Clients                                        
                                  
select cl_code into #mcdx_clt from intranet.risk.dbo.client_Brok_details                                         
where Exchange = 'MCX' and Active_Date < @tdate-180 /*and inactive_from > 'Dec 31 2044'*/                                      
order by Active_Date desc                                        
                                        
select cltcode,max(vdt) as vdt into #mcdx_bill from angelcommodity.accountmcdx.dbo.ledger x where                                                       
exists                                                      
(                                                      
select * from #mcdx_clt y where x.cltcode = y.cl_code                                        
) and vtyp = 15 group by cltcode                                            
                                        
select cltcode,min(vdt) as Vdt into #mcdx_open from angelcommodity.accountmcdx.dbo.ledger x where                                                       
exists                                                      
(                                                      
select * from #mcdx_clt y where x.cltcode = y.cl_code                                        
) and vtyp in (18,8) group by cltcode                                                     
                                      
                                      
select x.cl_code,z.mcx_open_date,y.mcx_bill_date into #m from                                      
(select * from #mcdx_clt) x                                      
left outer join                                      
(select cltcode,vdt as mcx_bill_date from #mcdx_bill)y                                      
on x.cl_code = y.cltcode                                      
left outer join                                  
(select cltcode,vdt as mcx_open_date from #mcdx_open)z                                      
on x.cl_code = z.cltcode                                      
                                      
                                   
select                                   
cl_code,                 
case                                   
when mcx_bill_date >= @tdate - 180 and mcx_bill_date <= @tdate then 'ACTIVE'                                   
when mcx_bill_date is null then 'NO TRADE' else convert(varchar(11),mcx_bill_date)  end as mcx_bill_date                                  
into #mcx from #m                           
-------------------------------NCDEX CLIENTs                                        
                     
select cl_code into #ncdx_clt from intranet.risk.dbo.client_Brok_details                                         
where Exchange = 'NCX' and Active_Date < @tdate-180 /*and inactive_from >  'Dec 31 2044'*/                                      
order by Active_Date desc                                        
                                        
select cltcode,max(vdt) as vdt into #ncdx_bill from angelcommodity.accountncdx.dbo.ledger x where                                                       
exists                                                      
(                                             
select * from #ncdx_clt y where x.cltcode = y.cl_code                                        
) and vtyp = 15 group by cltcode                                            
                                        
select cltcode,min(vdt) as Vdt into #ncdx_open from angelcommodity.accountncdx.dbo.ledger x where                                                       
exists                                                      
(                                                      
select * from #ncdx_clt y where x.cltcode = y.cl_code                                        
) and vtyp in (18,8) group by cltcode                                                     
                                        
select x.cl_code,z.ncdx_open_date,y.ncdx_bill_date into #n from                                      
(select * from #ncdx_clt) x                                      
left outer join                                      
(select cltcode,vdt as ncdx_bill_date from #ncdx_bill)y                                      
on x.cl_code = y.cltcode                                      
left outer join                                      
(select cltcode,vdt as ncdx_open_date from #ncdx_open)z                                      
on x.cl_code = z.cltcode                                      
                                        
                                  
select                                   
cl_code,                                  
case                                   
when ncdx_bill_date >= @tdate - 180 and ncdx_bill_date <= @tdate then 'ACTIVE'                                   
when ncdx_bill_date is null then 'NO TRADE' else convert(varchar(11),ncdx_bill_date)  end as ncdx_bill_date                                  
into #ncdx                                   
from #n                                   
                                  
                                        
--------------------------Combined VDT ----                                        
select                                         
case when MCX is null then NCDEX else MCX end as cltcode,                                        
case when MCX_billdate is null then 'NO A/C' else MCX_billdate end as MCX_billdate,                                  
case when  NCDEX_Billdate is null then 'NO A/C' else NCDEX_Billdate end as NCDEX_Billdate                                  
into #x                                       
from                                        
(select cl_code as MCX,MCX_Bill_date as MCX_billdate from #mcx)x                                        
full outer join                                        
(select cl_code as NCDEX,ncdx_Bill_date as NCDEX_Billdate from #ncdx)y                                        
on x.MCX = y.NCDEX                                        
                                  
select * into #t from #x  where (mcx_billdate <> 'ACTIVE' AND NCDEX_billdate <> 'ACTIVE')                                             
---------------------                                        
                                        
select branch_cd,sub_broker,x.*,                                        
case when res_phone1 = '' then res_phone2 when res_phone2 = '' then mobile_pager  else res_phone2 end as Contact_No                                                      
into #xx                                        
 from                                        
(select * from #t) x                                        
inner join                                        
(select * from intranet.risk.dbo.client_details where long_name not like '%Vandha%' )y                                        
on x.cltcode = y.cl_code                             
                              
--truncate table Commo_dormant_t     
insert into Commo_dormant_insp_t select *,getdate() as upd_date from #t     
    
--truncate table Commo_dormant_xx    
insert into Commo_dormant_insp_xx select *,getdate() as upd_date from #xx    
  
                                 
----------------------Deactive MCDX Clients             
/*Added ,Deactive_value='D',Deactive_Remarks='Dormant client' on 03/04/2012 By Shweta Tiwari*/                                       
    
/*begin tran*/                                          
  
                                          
--set XACT_ABORT on         
--exec AngelNseCM.inhouse.dbo.Commo_dormant_upd                                      
--set XACT_ABORT off    
    
/*                                                           
update AngelNseCM.msajag.dbo.client_brok_details set Inactive_from = @tdate,Deactive_value='D',Deactive_Remarks='Dormant client',Imp_status=0,Status='U',modifiedon=@tdate,modifiedby='InactiveCommodity'                                      
where Exchange = 'MCX' and cl_code in                              
(                              
select cltcode from #t where Mcx_billdate not in ('NO A/C') and cltcode in (select cltcode from #xx)                             
and cltcode not in                              
(select cltcode from tbl_Comm_insp__HIST where Segment = 'MCDX')                               
)                              
                              
update AngelNseCM.msajag.dbo.client_brok_details set Inactive_from = @tdate,Deactive_value='D',Deactive_Remarks='Dormant client',Imp_status=0,Status='U' ,modifiedon=@tdate,modifiedby='InactiveCommodity'                                           
where Exchange = 'NCX' and cl_code in                              
(                              
select cltcode from #t where Ncdex_billdate not in ('NO A/C') and                               
cltcode in (select cltcode from #xx)                            
and cltcode not in                              
(select cltcode from tbl_Comm_insp__HIST where Segment = 'NCDX')                               
)                              
    
    
    
              
IF  @@ERROR <> 0                                            
       Rollback Tran                                            
Else                                        
       Commit Tran                                                    
      
*/      
  
insert into tbl_Comm_insp__HIST                                          
Select *,@tdate from                     
(                            
select a.cltcode,a.mcx_billdate,'MCDX' as Segment,@tdate as Fld_Date,b.branch_cd from                      
(select * from #t where mcx_billdate not in ('NO A/C'))a                      
inner join #xx b on b.cltcode = a.cltcode                                        
union all                   
select a.cltcode,a.ncdex_billdate,'NCDX' as Segment,@tdate as Fld_Date,b.Branch_cd from          
(select * from #t where ncdex_billdate not in ('NO A/C'))a                      
inner join #xx b on b.cltcode = a.cltcode)x   
where cltcode not in (Select distinct cltcode from tbl_Comm_insp__HIST)                                        
      
                                          
-----------------------End For Update Part-----------------                                                         
                                                
select distinct branch_cd into #branches from #xx                                      
                      
                       
Update tbl_Comm_insp__Mails_Branch Set Status = ''                                      
DECLARE Comm_Mails CURSOR FOR select Fld_Email,Fld_Br_Code from tbl_Comm_insp__Mails_Branch where Fld_Br_Code in (select branch_cd from #branches) and Fld_Email<>''                                      
OPEN Comm_Mails                                                                               
                                                                                                            
FETCH NEXT FROM Comm_Mails                                                                                            
INTO @Fld_Email,@branch_cd                                                                                                        
                                                                                                            
WHILE @@FETCH_STATUS = 0                                                                              
                                                                                                        
BEGIN                                                        
                              
  
truncate table tbl_Comm_insp__Mails                                                        
                                                        
insert into tbl_Comm_insp__Mails                                                        
select 'Party Code'+','+'Branch Code'+','+'Sub Broker'+','+'MCDX LAST BILL DATE'+','+'NCDX LAST BILL DATE'+','+'CONTACT NO'+','+'NARATION'                                                          
                                                        
insert into tbl_Comm_insp__Mails                                                        
select rtrim(ltrim(cltcode))+','+ltrim(rtrim(branch_cd))+','+ltrim(rtrim(sub_broker))+','+                                  
rtrim(ltrim(MCX_billdate))+','+                                            
rtrim(ltrim(NCDEX_billdate))+','+                                                      
rtrim(ltrim(Contact_No))+','+'Being client not trading since last 6 month'                                                        
from #xx where branch_Cd = @branch_cd                                                                    
  
insert into tbl_Comm_insp__Mails_hist select *,@tdate from tbl_Comm_insp__Mails  
                           
declare @path as varchar(100)                                                 
set @path = (Select uploadserver from [CSOKYC-6].Upload.DBO.Global_Upload where upd_srno = 2)                                  
--set @file = 'D:\upload1\Comm_Mails\'+'Inactive_list'+'_'+ltrim(rtrim(@branch_cd))+'.csv'                    
set @file = @path+'\Comm_Mails\'+'Inactive_list'+'_'+ltrim(rtrim(@branch_cd))+'.csv'                                            
                                                                                     
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_Msg FROM MIS.upload.DBO.tbl_Comm_insp__Mails" queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                
                  
set @s1= @s+''''                                       
exec(@s1)                                 
--print @s1                                                        
                                              
declare @file1 as varchar(300)                                   
set @file1 = @file+';'+@path+'\Comm_Mails\Client_Confirmation.doc'                                                 
                                                        
--Exec usp_AutoMail_COMM @Fld_Email,@MSG,@file1,@branch_cd                                                           
                                                        
FETCH NEXT FROM Comm_Mails                                                                         
INTO @Fld_Email,@branch_cd                                                                                    
                                                        
END                         
                                                                                    
CLOSE Comm_Mails                                                                                                            
DEALLOCATE Comm_Mails

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_MAILS_COMM_New
-- --------------------------------------------------
  
  
    
CREATE Proc [dbo].[USP_BULK_MAILS_COMM_New]                                                              
AS                                                              
                                                            
                                                            
Declare  @branch_cd as varchar(100)                                                       
Declare  @Fld_Email as varchar(500)                                                           
Declare  @file as varchar(1000)                                                            
Declare  @s as varchar(1000)                                                            
Declare  @s1 as varchar(1000)                                                            
Declare  @MSG as varchar(8000)                                                            
                                                            
                                                            
SET @MSG = '<BR>Dear All,<BR>'                                                            
SET @MSG = @MSG+'<P>Please find the enclosed list of dormant clients (clients not traded since last 6 months)                                                             
          from your branch.<br>You are requested to obtain the written request in the attached format before                                                             
     executing any trades for these clients.</P>'                                                            
SET @MSG = @MSG+'<P>Please ensure not to execute any trades without obtaining necessary authority letter from the client.<br>                                                             
     Failing which, the branch will be solely responsible for any action taken / penalty imposed by exchange.</P>'                                                            
SET @MSG = @MSG+'<P>For further clarification, please feel free to contact Commodities team @ 022-28358800 ext 599/724. </P>'                                                                                 
                                            
--------------------------------MCX Clients                                            
/*                                      
select cl_code into #mcdx_clt1 from intranet.risk.dbo.client_Brok_details                                             
where Exchange = 'MCX' and Active_Date < GETDATE()-180 /*and inactive_from > 'Dec 31 2044'*/                                          
order by Active_Date desc                                            
*/    
    
select cl_code into #mcdx_clt from AngelNseCM.msajag.dbo.client_brok_details       
where Exchange = 'MCX' and Active_Date < GETDATE()-180 /*and inactive_from > 'Dec 31 2044'*/                                          
and Inactive_from>getdate() and cl_code not like '98%'                  
and isnull(Deactive_value,'') not in ('D','C','I','B','T')       
order by Active_Date desc                                            
                                            
select cltcode,max(vdt) as vdt into #mcdx_bill from angelcommodity.accountmcdx.dbo.ledger x where                                                           
exists                                                          
(                                                          
select * from #mcdx_clt y where x.cltcode = y.cl_code                                            
) and vtyp = 15 group by cltcode                                                
                                            
select cltcode,min(vdt) as Vdt into #mcdx_open from angelcommodity.accountmcdx.dbo.ledger x where                                                           
exists                                                          
(                                                          
select * from #mcdx_clt y where x.cltcode = y.cl_code                                            
) and vtyp in (18,8) group by cltcode   
                                          
                                          
select x.cl_code,z.mcx_open_date,y.mcx_bill_date into #m from                                          
(select * from #mcdx_clt) x                                          
left outer join                                          
(select cltcode,vdt as mcx_bill_date from #mcdx_bill)y                                          
on x.cl_code = y.cltcode                                          
left outer join                                          
(select cltcode,vdt as mcx_open_date from #mcdx_open)z                                          
on x.cl_code = z.cltcode                                          
                                          
                                       
select                                       
cl_code,                     
case                                       
when mcx_bill_date >= getdate() - 180 and mcx_bill_date <= getdate() then 'ACTIVE'                                       
when mcx_bill_date is null then 'NO TRADE' else convert(varchar(11),mcx_bill_date)  end as mcx_bill_date                                      
into #mcx from #m                               
-------------------------------NCDEX CLIENTs                                            
/*                         
select cl_code into #ncdx_clt from intranet.risk.dbo.client_Brok_details                                             
where Exchange = 'NCX' and Active_Date < GETDATE()-180 /*and inactive_from >  'Dec 31 2044'*/                                          
order by Active_Date desc                                            
*/    
    
select cl_code into #ncdx_clt from AngelNseCM.msajag.dbo.client_brok_details       
where Exchange = 'NCX' and Active_Date < GETDATE()-180 /*and inactive_from > 'Dec 31 2044'*/                                          
and Inactive_from>getdate() and cl_code not like '98%'                  
and isnull(Deactive_value,'') not in ('D','C','I','B','T')       
order by Active_Date desc                                            
    
                                            
select cltcode,max(vdt) as vdt into #ncdx_bill from angelcommodity.accountncdx.dbo.ledger x where                                                           
exists                                                          
(                                                 
select * from #ncdx_clt y where x.cltcode = y.cl_code                                            
) and vtyp = 15 group by cltcode                                                
                                            
select cltcode,min(vdt) as Vdt into #ncdx_open from angelcommodity.accountncdx.dbo.ledger x where                                                           
exists                                                          
(                                                          
select * from #ncdx_clt y where x.cltcode = y.cl_code                                            
) and vtyp in (18,8) group by cltcode                                                         
                                            
select x.cl_code,z.ncdx_open_date,y.ncdx_bill_date into #n from                                          
(select * from #ncdx_clt) x                                          
left outer join                                          
(select cltcode,vdt as ncdx_bill_date from #ncdx_bill)y                                          
on x.cl_code = y.cltcode                                          
left outer join                                          
(select cltcode,vdt as ncdx_open_date from #ncdx_open)z                                          
on x.cl_code = z.cltcode                                          
                                            
                                      
select                                       
cl_code,                                      
case                                       
when ncdx_bill_date >= getdate() - 180 and ncdx_bill_date <= getdate() then 'ACTIVE'                                       
when ncdx_bill_date is null then 'NO TRADE' else convert(varchar(11),ncdx_bill_date)  end as ncdx_bill_date                                      
into #ncdx                                       
from #n                                       
                                      
                                            
--------------------------Combined VDT ----                                            
select                                             
case when MCX is null then NCDEX else MCX end as cltcode,                                            
case when MCX_billdate is null then 'NO A/C' else MCX_billdate end as MCX_billdate,                                      
case when  NCDEX_Billdate is null then 'NO A/C' else NCDEX_Billdate end as NCDEX_Billdate                                      
into #x                                           
from                                            
(select cl_code as MCX,MCX_Bill_date as MCX_billdate from #mcx)x                                            
full outer join                                            
(select cl_code as NCDEX,ncdx_Bill_date as NCDEX_Billdate from #ncdx)y                                            
on x.MCX = y.NCDEX                              
                                      
select * into #t from #x  where (mcx_billdate <> 'ACTIVE' AND NCDEX_billdate <> 'ACTIVE')                                                 
---------------------                                            
                                            
select branch_cd,sub_broker,x.*,                                            
case when res_phone1 = '' then res_phone2 when res_phone2 = '' then mobile_pager  else res_phone2 end as Contact_No                                                          
into #xx                                            
 from                                            
(select * from #t) x                                            
inner join                                            
(select * from intranet.risk.dbo.client_details where long_name not like '%Vandha%' )y                                            
on x.cltcode = y.cl_code                                 
                                  
truncate table Commo_dormant_t         
insert into Commo_dormant_t select * from #t         
        
truncate table Commo_dormant_xx        
insert into Commo_dormant_xx select * from #xx        
        
                                     
----------------------Deactive MCDX Clients                 
/*Added ,Deactive_value='D',Deactive_Remarks='Dormant client' on 03/04/2012 By Shweta Tiwari*/                                           
        
/*begin tran*/                                              
                                              
set XACT_ABORT on             
exec AngelNseCM.inhouse.dbo.Commo_dormant_upd                                          
set XACT_ABORT off        
        
/*                                                               
update AngelNseCM.msajag.dbo.client_brok_details set Inactive_from = getdate(),Deactive_value='D',Deactive_Remarks='Dormant client',Imp_status=0,Status='U',modifiedon=GETDATE(),modifiedby='InactiveCommodity'                                          
where Exchange = 'MCX' and cl_code in                                  
(                                  
select cltcode from #t where Mcx_billdate not in ('NO A/C') and cltcode in (select cltcode from #xx)                                 
and cltcode not in                                  
(select cltcode from tbl_Comm_HIST where Segment = 'MCDX')                                   
)                                  
                                  
update AngelNseCM.msajag.dbo.client_brok_details set Inactive_from = getdate(),Deactive_value='D',Deactive_Remarks='Dormant client',Imp_status=0,Status='U' ,modifiedon=GETDATE(),modifiedby='InactiveCommodity'             
where Exchange = 'NCX' and cl_code in                                  
(                                  
select cltcode from #t where Ncdex_billdate not in ('NO A/C') and                                   
cltcode in (select cltcode from #xx)                                
and cltcode not in                                  
(select cltcode from tbl_Comm_HIST where Segment = 'NCDX')                                   
)                                  
        
        
        
                  
IF  @@ERROR <> 0                                                
       Rollback Tran                                                
Else                                            
       Commit Tran                                                        
          
*/          
               
insert into tbl_Comm_HIST                                              
Select * from                         
(                                
select a.cltcode,a.mcx_billdate,'MCDX' as Segment,getdate() as Fld_Date,b.branch_cd from                          
(select * from #t where mcx_billdate not in ('NO A/C'))a                          
inner join #xx b on b.cltcode = a.cltcode                                            
union all                       
select a.cltcode,a.ncdex_billdate,'NCDX' as Segment,getdate() as Fld_Date,b.Branch_cd from                                    
(select * from #t where ncdex_billdate not in ('NO A/C'))a                          
inner join #xx b on b.cltcode = a.cltcode)x where cltcode not in (Select distinct cltcode from tbl_Comm_HIST)                                            
          
                                     
                                              
-----------------------End For Update Part-----------------                                                             
                                                    
select distinct branch_cd into #branches from #xx                                          
                            
Update Tbl_Comm_Mails_Branch Set Status = ''                                          
DECLARE Comm_Mails CURSOR FOR select Fld_Email,Fld_Br_Code from Tbl_Comm_Mails_Branch where Fld_Br_Code in (select branch_cd from #branches) and Fld_Email<>''                                          
OPEN Comm_Mails                                                                                   
                                                                                                                
FETCH NEXT FROM Comm_Mails                                                                                                
INTO @Fld_Email,@branch_cd                                                                                                            
                                                                                                                
WHILE @@FETCH_STATUS = 0                                                                                  
                                                                                                            
BEGIN                                                            
                                                            
truncate table Tbl_Comm_Mails                                                            
                                                            
insert into Tbl_Comm_Mails                                                            
select 'Party Code'+','+'Branch Code'+','+'Sub Broker'+','+'MCDX LAST BILL DATE'+','+'NCDX LAST BILL DATE'+','+'CONTACT NO'+','+'NARATION'                                                              
                                                            
insert into Tbl_Comm_Mails                                                            
select rtrim(ltrim(cltcode))+','+ltrim(rtrim(branch_cd))+','+ltrim(rtrim(sub_broker))+','+                                      
rtrim(ltrim(MCX_billdate))+','+                                                
rtrim(ltrim(NCDEX_billdate))+','+                                                          
rtrim(ltrim(Contact_No))+','+'Being client not trading since last 6 month'                                                            
from #xx where branch_Cd = @branch_cd                                                                        
                               
declare @path as varchar(100)                                                     
set @path = (Select uploadserver from [CSOKYC-6].Upload.DBO.Global_Upload where upd_srno = 2)                                      
--set @file = 'D:\upload1\Comm_Mails\'+'Inactive_list'+'_'+ltrim(rtrim(@branch_cd))+'.csv'                        
set @file = @path+'\Comm_Mails\'+'CommodityDormant_list'+'_'+ltrim(rtrim(@branch_cd))+'.csv'                                                
                                                                                         
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_Msg FROM MIS.upload.DBO.Tbl_Comm_Mails" queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                      
                
set @s1= @s+''''                                           
exec(@s1)                                     
--print @s1                                                            
                                                  
declare @file1 as varchar(300)                                                  
set @file1 = @file+';'+@path+'\Comm_Mails\Client_Confirmation.doc'                                                     
                                                            
Exec usp_AutoMail_COMM @Fld_Email,@MSG,@file1,@branch_cd                                
                                                            
FETCH NEXT FROM Comm_Mails                                                                             
INTO @Fld_Email,@branch_cd                                                                                        
                                                            
END                             
                                                                                        
CLOSE Comm_Mails                                                                                                                
DEALLOCATE Comm_Mails

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_PayInPayOut
-- --------------------------------------------------
CREATE proc USP_BULK_PayInPayOut       
(                      
@filename as varchar(100),@server as varchar(25)
)                       
as                          
set transaction  isolation  level read uncommitted                          
              
declare @path as varchar(100)                      
declare @sql as varchar(1000)                   
                     
truncate table tbl_bulk_PayinPayout               
  
/*set @path = (Select uploadserver from [196.1.115.182].Upload.DBO.Global_Upload where upd_srno = 2)  
set @path = @path +'Pledgefile\' + @filename*/  
  
set @path='\\'+@server+'\d$\upload1\' + @filename                      
SET @SQL = 'BULK INSERT tbl_bulk_PayinPayout FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                      
exec (@sql)         
      
select * from tbl_bulk_PayinPayout

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_PayInPayOut_TextFile
-- --------------------------------------------------
CREATE proc USP_BULK_PayInPayOut_TextFile      
(                        
@filename as varchar(100)                        
)                         
as                            
set transaction  isolation  level read uncommitted                            
    
declare @path as varchar(100)                
declare @sql as varchar(1000)                     
truncate table tbl_bulk_PayinPayout    
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename        
SET @SQL = 'BULK INSERT tbl_bulk_PayinPayout FROM '''+@Path+''' WITH (FIELDTERMINATOR = ''/t'', FirstRow=2,KeepNULLS)'                
exec (@sql)       
select * from tbl_bulk_PayinPayout

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_BULK_VALedger
-- --------------------------------------------------
CREATE Proc [dbo].[USP_BULK_VALedger](@segment as varchar(10),@sett_type as varchar(10),@sett_No as varchar(15),@file as varchar(50),@server as varchar(20))            
as            
            
declare @Path as varchar(100)                                                
declare @SQL as varchar(500)                                                          
Declare @s as varchar(1000)            
Declare @s1 as varchar(1000)            
--declare @File as varchar(100)    
  
/*set @path = (Select uploadserver from [196.1.115.182].Upload.DBO.Global_Upload where upd_srno = 2)  
set @path = @path +'Pledgefile\' + @filename*/          
            
set @path= '\\'+@server+'\d$\upload1\' + @file                          
--set @file = 'VA1001.612'                                      
set @path= '\\'+@server+'\d$\upload1\' + @file                 
        
            
truncate table tbl_VA_Ledger            
truncate table tbl_VA_Ledger_1          
truncate table tbl_t          
Drop table temp_tbl            
            
SET @SQL = 'BULK INSERT tbl_VA_Ledger FROM '''+@path+''' with (ROWTERMINATOR = ''\n'')'               
Exec(@SQL)            
            
insert into tbl_VA_Ledger_1 select * from tbl_VA_Ledger (nolock)           
            
delete from tbl_VA_Ledger_1 where isnumeric(left(fld_stat,1)) = 1  and charindex('--',fld_stat) = 1            
delete from tbl_VA_Ledger_1 where Fld_Stat like '%Trn.date%'            
delete from tbl_VA_Ledger_1 where Fld_Stat like '%BOI%'            
delete from tbl_VA_Ledger_1 where Fld_Stat like '%Clearing%' or  Fld_Stat like '%statement%'            
delete from tbl_VA_Ledger_1 where Fld_Stat like  '%# %' or  Fld_Stat like '%statement%' or Fld_Stat like '%Balance B/F%'            
delete from tbl_VA_Ledger_1 where Fld_Stat like  '%-- %' or  Fld_Stat like '%CONTINUED ON NEXT PAGE....%'             
delete from tbl_VA_Ledger_1 where isnumeric(left(fld_stat,1))  = 0            
delete from tbl_VA_Ledger_1 where Fld_stat = ''                
      
select replace(rtrim(ltrim(substring(Fld_stat,1,65))),' ','|') as a into temp_tbl from tbl_VA_Ledger_1 where Fld_stat like '%CLOUT%'                 
      
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT a FROM mis.UPLOAD.DBO.temp_tbl" queryout '+'\\'+@server+'\d$\upload1\temp.txt -c -SMis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                            
set @s1= @s+''''                                     
exec(@s1)                
      
set @file = 'temp.txt'                      
set @path= '\\'+@server+'\d$\upload1\' + @file                          
      
SET @SQL = 'BULK INSERT tbl_t FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS)'                                
Exec(@SQL)               
      
truncate table temp_tbl        
      
insert into temp_tbl        
select @sett_No+','+@sett_type+','+Fld_e+','+'BSE'+','+Fld_g+','+Fld_g from tbl_t where Fld_h like '%OddLot%'           
      
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct a FROM mis.UPLOAD.DBO.temp_tbl" queryout '+'\\'+@server+'\d$\upload1\VA'+replace(convert(varchar(11),getdate(),3),'/','')+'.csv -c -SMis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'      
set @s1= @s+''''      
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_bulkupload_branch
-- --------------------------------------------------
CREATE proc usp_bulkupload_branch                            
(                                            
@filename as varchar(100),
@SERVER AS VARCHAR(15)                                            
)                                             
as                                                
set transaction  isolation  level read uncommitted                                                
                                    
declare @path as varchar(100)                                            
declare @sql as varchar(1000)                                         
                                  
set @path= '\\'+@SERVER+'\d$\upload1\'+ @filename                                            
                                  
truncate table tbl_clientbulkupload                 
                                  
SET @SQL = 'insert into v_clientbulkupload select *  FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                                  
--print @sql                  
exec (@SQL)                     
           
insert into tbl_clientbulkupload_record                
--select Ddate,Destination_Name,Client_ID,Client_Name,Pin_code,F7,F8,F9,F10,F11,F12 from tbl_clientbulkupload        
select clientno,DispatchDate,DistinationName,ClientID,ClientName,Pincode,Date from tbl_clientbulkupload

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_bulkupload_postionfile
-- --------------------------------------------------
CREATE proc USP_bulkupload_postionfile       
as                
set transaction  isolation  level read uncommitted                
    
declare @path as varchar(100)            
declare @sql as varchar(1000)                
    
truncate table nseps03    
    
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\ps03.csv'    
SET @SQL = 'BULK INSERT nseps03 FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'            
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Calculate_NBFC_CM
-- --------------------------------------------------
CREATE Proc USP_Calculate_NBFC_CM                                  
as                                  
                                  
---------------Find Trade Dates from Settlement Master-----                                  
                                  
declare @First_day as varchar(11)                                  
declare @Second_day as varchar(11)                                  
declare @Third_day as varchar(11)                                  
                                  
set @Third_day = (select convert(varchar(11),max(start_date),103) from MARGINFIN.NBFC.DBO.Sett_Mst where start_date < convert(varchar(11),getdate()) and sett_type = 'D')                                  
set @Second_day = (select convert(varchar(11),max(start_date),103) from MARGINFIN.NBFC.DBO.Sett_Mst where start_date < convert(datetime,@Third_day,103) and sett_type = 'D')                                  
set @First_day =  (select convert(varchar(11),max(start_date),103) from MARGINFIN.NBFC.DBO.Sett_Mst where start_date < convert(datetime,@Second_day,103) and sett_type = 'D')                                  
                                  
/*                                  
print @Third_day                                  
print @Second_day                                  
print @First_day                                  
                                  
drop table #First_day                                  
drop table #Second_day                                  
drop table #Third_day                                  
                                  
sp_helptext USP_Col_UPload                                  
                                  
select * from tbl_collateral_upload                                  
select * from #First_day                                  
select * from #Second_day                                  
select * from #Third_day                                  
                                  
*/                                  
                                  
---------------------------------Fetching Open Postion from NBFC Back Office Server------------------                                  
CREATE TABLE #First_day                                  
(                                  
PARTY_CODE varchar(15),                                  
SCRIP_CD varchar(15),                                  
B_F money,                                  
B_F_VALUE money,                                  
BUY money,                                  
SEL money,                                  
NET money,                                  
BUY_PRICE money,                                  
SEL_PRICE money,                                  
BUY_VALUE money,                                  
SEL_VALUE money,                                  
DAY_VALUE money,                                  
OPEN_POSITION int,                                  
CLOSING_PRICE money,                                  
PORTFOLIO_VALUE money,                                  
NET_VALUE money                                  
)                                  
                                  
CREATE TABLE #Second_day                                  
(                                  
PARTY_CODE varchar(15),                                  
SCRIP_CD varchar(15),                                  
B_F money,                                  
B_F_VALUE money,                                  
BUY money,                                  
SEL money,                                  
NET money,                                  
BUY_PRICE money,                                  
SEL_PRICE money,                                  
BUY_VALUE money,                                  
SEL_VALUE money,                                  
DAY_VALUE money,                                  
OPEN_POSITION int,                                  
CLOSING_PRICE money,                                  
PORTFOLIO_VALUE money,                                  
NET_VALUE money                                  
)                                  
                                  
                                  
CREATE TABLE #Third_day               
(                                  
PARTY_CODE varchar(15),                                  
SCRIP_CD varchar(15),                                  
B_F money,                                  
B_F_VALUE money,                                  
BUY money,                                  
SEL money,          
NET money,                                  
BUY_PRICE money,                                  
SEL_PRICE money,                                  
BUY_VALUE money,            
SEL_VALUE money,                                  
DAY_VALUE money,                                  
OPEN_POSITION int,                                  
CLOSING_PRICE money,                                
PORTFOLIO_VALUE money,                                  
NET_VALUE money                                  
)                                  
                                  
insert into #first_day                                   
EXEC MARGINFIN.NBFC.DBO.NBFC_RPT_OPENPOS  @StatusId='broker', @StatusName='broker', @FromParty='0', @ToParty='ZZZ', @MarginDate=@First_day                                  
                                  
insert into #Second_day                                   
EXEC MARGINFIN.NBFC.DBO.NBFC_RPT_OPENPOS  @StatusId='broker', @StatusName='broker', @FromParty='0', @ToParty='ZZZ', @MarginDate=@Second_day                                  
                         
insert into #Third_day                                   
EXEC MARGINFIN.NBFC.DBO.NBFC_RPT_OPENPOS  @StatusId='broker', @StatusName='broker', @FromParty='0', @ToParty='ZZZ', @MarginDate=@Third_day                     
                                  
------------------------------Adjusting Open Position and NCM Qty and Marking the Remark-------                                  
                                  
                                  
select x.*,isnull(y.open_Position,0) as open_Position,                                  
case when x.Fld_Qty - isnull(y.open_Position,0) < 0 then isnull(x.Fld_Qty,0) else isnull(y.open_Position,0) end                                  
 as BF_Qty,                                  
case when x.Fld_Qty - isnull(y.open_Position,0) < 0 then 'Error' else 'OK' end Remark                                   
into #NCM_QTY                                  
 from                                  
(select * from tbl_collateral_upload (nolock))x                                  
left outer join                                  
(select * from #first_day (nolock))y                                  
on x.Fld_Party_Code = y.Party_Code and Fld_Scrip_Code = y.Scrip_cd                                  
                                  
                                  
-----------Calculate Non Cash Qty------                                  
select *,convert(int,Fld_Qty)-convert(int,BF_Qty) as NCM_Qty into #NCM_Qty1  from #NCM_QTY                                 
                                  
select x.*,convert(money,NCM_Qty)*convert(money,y.cls) as NCM_Value,                                  
convert(money,BF_Qty)*convert(money,y.cls) as BF_Value,convert(money,y.cls) as Fld_Cl_Rate into #NCM_BF_value from                                  
(                                  
select * from #NCM_Qty1                                 
)x                                  
left outer join                                  
(                                  
select * from V_GetScripClsRate                                 
)y on x.Fld_Isin = y.isin                                  
                                  
/*                                  
select *,convert(money,NCM_Qty)*convert(money,Fld_cl_rate) as NCM_Value,                                  
convert(money,BF_Qty)*convert(money,Fld_cl_rate) as BF_Value into #NCM_BF_value                                  
from #NCM_Qty1                                  
*/                                                                  
                                  
----------Calculate Hair Cut-----------                                 
                                  
select *,(NCM_Value*(100-replace(Fld_Hair_Cut,'#N/A','0')))/100 as NCM_Value_After_HairCut,                        
(BF_Value*(100-replace(Fld_Hair_Cut,'#N/A','0')))/100 as BF_Value_After_HairCut into #NCM_First_Day                                  
from #NCM_BF_value       
                   
------------Calulating Second Buy Sell data------                                  
                                  
select *           
into #Day1_Buy_Sell          
  from                                  
(select * from #NCM_First_Day)x                                  
full outer join                                  
(                              
select Party_code,x.Scrip_cd,Net,x.cls,Buy_sell,Day_Value,(Day_Value*(100-hair_cut))/100 as Day_Value_After_Haircut,y.hair_cut from                                  
(          
select a.*,b.cls from                                   
(select Party_code,Scrip_cd,Net,                                  
case                           
when Net < 0 then 'S'                                   
when Net > 0 then 'B'                                  
end as Buy_Sell,                                  
case                                   
when Day_Value < 0 then convert(money,Day_Value)*-1 else Day_Value end                                  
as Day_Value  from #Second_day (nolock))a          
left outer join          
(select * from V_scrip_master)b          
on a.Scrip_cd = b.scrip           
) x                                  
left outer join                                  
(                                  
select * from V_NBFC_HC                                   
) y on x.Scrip_cd = y.Scrip_cd                                  
)y on x.fld_party_code = y.party_code and x.Fld_Scrip_code = y.Scrip_cd                                 
                                  
-----------Final Data From Second Day Buy Sell Data---------                                  
           
select case when Fld_Party_Code is null then Party_Code else Fld_Party_Code end as Fld_Party_Code,                                  
case when Fld_Scrip_Code is null then scrip_cd else Fld_Scrip_Code end as scrip_cd,Fld_Qty,Fld_Cash_Margin,          
Fld_Cl_Rate=isnull(replace(Fld_Cl_Rate,'#N/A',''),isnull(cls,0)),                   
case when replace(Fld_Hair_Cut,'#N/A','') is null then hair_cut else replace(Fld_Hair_Cut,'#N/A','') end Fld_Hair_Cut,open_Position,BF_Qty,Remark,                                  
NCM_Qty,NCM_Value,BF_Value,NCM_Value_After_HairCut,BF_Value_After_HairCut,Net,Buy_Sell,Day_Value,Day_Value_After_Haircut                                   
into #Final_Day2 
from #Day1_Buy_Sell       
      
------------Calulating Third Day Buy Sell data------                                  
                                  
select *           
 into #Day2_Buy_Sell          
  from                                  
(select * from #Final_Day2)x                                  
full outer join                                  
(                                  
select Second_Party_code,Second_Scrip,Second_Net,x.cls,Second_Buy_Sell,Second_Day_Value,(Second_Day_Value*(100-hair_cut))/100 as Second_Day_Value_After_Haircut,y.hair_cut from                                  
(          
select a.*,b.cls from                                                            
(select Party_code as Second_Party_code,Scrip_cd as Second_Scrip,Net as Second_Net,                                  
case                                   
when Net < 0 then 'S'                                   
when Net > 0 then 'B'                                  
end as Second_Buy_Sell,                                  
case                                   
when Day_Value < 0 then convert(money,Day_Value)*-1 else Day_Value end                                  
as Second_Day_Value  from #Third_day (nolock))a          
left outer join          
(select * from V_scrip_master)b          
on a.Second_Scrip= b.scrip                                   
) x                                  
left outer join                                  
(                                  
select * from V_NBFC_HC                                   
) y on x.Second_Scrip = y.Scrip_cd                                  
)y on x.fld_party_code = y.Second_Party_code and x.Scrip_cd = y.Second_Scrip                                  
                                  
-----------Final Data From Third Day Buy Sell Data---------                                  
                                  
select case when Fld_Party_Code is null then Second_Party_code else Fld_Party_Code end as Fld_Party_Code,                               
case when Scrip_Cd is null then Second_Scrip else Scrip_Cd end as scrip_cd,Fld_Qty,                                  
isnull(convert(money,Fld_Cash_Margin),0) as Fld_Cash_Margin,                                  
isnull(convert(money,Fld_Cl_Rate),isnull(cls,0)) as Fld_Cl_Rate,                              
isnull(case when Fld_Hair_Cut is null then hair_cut else Fld_Hair_Cut end,0) as Fld_Hair_Cut,                                  
isnull(open_Position,0) as open_Position,                                  
convert(int,isnull(BF_Qty,0)) as BF_Qty,                    
Remark,                    
convert(int,isnull(NCM_Qty,0)) as NCM_Qty,                    
isnull(NCM_Value,0) as NCM_Value,                                  
isnull(BF_Value,0) as BF_Value,                                  
isnull(NCM_Value_After_HairCut,0) as NCM_Value_After_HairCut,                                  
isnull(BF_Value_After_HairCut,0) as BF_Value_After_HairCut,                                  
convert(int,isnull(Net,0)) as Net,                                  
isnull(Buy_Sell,0) Buy_Sell,                                  
isnull(Day_Value,0) Day_Value,                                  
isnull(Day_Value_After_Haircut,0) Day_Value_After_Haircut,                                  
convert(int,isnull(Second_Net,0)) Second_Net,                                  
isnull(Second_Buy_Sell,0) as Second_Buy_Sell,                                  
isnull(Second_Day_Value,0) as Second_Day_Value,                                  
isnull(Second_Day_Value_After_Haircut,0) as  Second_Day_Value_After_Haircut                                  
into #final_rel                                  
from #Day2_Buy_Sell                             
                                  
-----------Fetch Ledger Bal From NBFC Backoffice--------                                  
                                  
select x.party_code,isnull(x.Total_amt,0) as Total_amt,y.NCM_Value,y.NCM_Value_After_HairCut,y.BF_Value,y.BF_Value_After_HairCut                                  
into #fin  from                                  
(                                  
select * from MARGINFIN.accountnbfc.dbo.V_Client_Bal                                   
) x                 
left outer join                                  
(                                  
select Fld_Party_code,                                  
sum(NCM_Value) as NCM_Value,                                  
sum(NCM_Value_After_HairCut) as NCM_Value_After_HairCut,                                  
sum(BF_Value) as BF_Value,                                  
sum(BF_Value_After_HairCut) as BF_Value_After_HairCut                                  
from #final_rel group by Fld_Party_code                                  
) y on x.party_code = y.Fld_Party_code                                  
                                  
                                  
----------------Deleting Data less than 2000 and greater than 2000                                  
                                  
delete from #fin where (Total_amt < 2000 and Total_amt > -2000) and NCM_Value is null and  BF_Value is null                                  
                                  
select x.*,y.Total_Amt into #fin1 from                                  
(                    
select Fld_Party_code,                                  
sum(NCM_Value) as NCM_Value,                                  
sum(NCM_Value_After_HairCut) as NCM_Value_After_HairCut,                                  
sum(BF_Value) as BF_Value,                                  
sum(BF_Value_After_HairCut) as BF_Value_After_HairCut                                  
from #final_rel group by Fld_Party_code                                  
)x            
left outer join                                  
(select * from #fin)y on x.Fld_Party_code = y.party_code                                  
                                  
                                  
delete from #fin1 where (NCM_Value = 0 and NCM_Value_After_HairCut = 0 and BF_Value = 0 and BF_Value_After_HairCut = 0 and Total_Amt = 0)                                  
delete from #fin1 where (NCM_Value = 0 and NCM_Value_After_HairCut = 0 and  BF_Value = 0 and BF_Value_After_HairCut = 0) and Total_Amt < 2000 and Total_Amt > -2000                                   
                                  
------------------Union Data ------                                  
                                  
select * into #fin2 from                                  
(                                  
select * from #fin                                  
union                                  
select Fld_Party_code,Total_Amt,NCM_Value,NCM_Value_After_HairCut,BF_Value,                                  
BF_Value_After_HairCut from #fin1 where Total_Amt is null                                  
) x                       
                                  
---------------Generating Holding File-------                                  
select Fld_Party_Code,Scrip_cd,Fld_Hair_cut,isnull(NCM_Qty,0) as NCM_Qty,isnull(BF_Qty,0) as BF_Qty,                                  
isnull(Fld_Cl_Rate,0) as Fld_Cl_Rate,isnull((NCM_Qty+BF_Qty)*convert(money,Fld_Cl_Rate),0) as PF_Value,                                  
isnull(Net,0) as Net,isnull(Day_Value,0) as Day_Value,isnull(Second_Net,0) as Second_Net,isnull(Second_Day_Value,0) as Second_Day_Value into #holding from #final_rel                                  
                                  
                                  
---------------Calulating Margin Amt---------                              
                                  
delete from tbl_Holding_Data where convert(varchar(11),Fld_DateTime) =convert (varchar(11),getdate())                                  
delete from tbl_Col_data where convert(varchar(11),Fld_Date) =convert (varchar(11),getdate())                                  
                                  
insert into tbl_Col_data                                  
select distinct *,getdate() from #final_rel                                  
                                  
insert into tbl_Holding_Data                            
select Fld_Party_Code,              
Current_Holding,Holding_After_Haircut,                                  
isnull(Total_Amt,0)as Total_Amt,              
day_value_After_Haircut,              
isnull(Total_Amt+Net_BuySell,0) as Logical_Led_bal,                                  
isnull(Holding_After_Haircut,0)+isnull(Total_Amt,0)+isnull(Net_BuySell,0) as Callexcess_Shortage,                                  
isnull(case                                   
when Current_Holding <= 0 then Current_Holding else                                  
((Total_Amt+Current_Holding)/Current_Holding)*100 end,0) as Margin_Maintain,Net_BuySell,getdate()                                  
  from                                  
(                                   
select Fld_Party_Code,isnull(sum(NCM_Value+BF_Value),0) as Current_Holding,                
isnull(sum(NCM_Value_After_HairCut+BF_Value_After_HairCut),0) as Holding_After_Haircut,                                  
sum(                            
convert(money,isnull(                            
case                                   
when Buy_sell = 'S' then day_value            
when Buy_sell = 'B' then day_value*-1 end,0))                                  
) +                                  
sum(                            
convert(money,isnull(                            
case                                   
when Second_Buy_sell = 'S' then Second_day_value                                  
when Second_Buy_sell = 'B' then Second_day_value*-1 end,0))                                  
) +                                  
sum(                     
convert(money,isnull(case                                   
when Buy_sell = 'S' then day_value_After_Haircut *-1                                   
when Buy_sell = 'B' then day_value_After_Haircut end,0))                                  
) +                                  
sum(                            
convert(money,isnull(                            
case                                   
when Second_Buy_sell = 'S' then Second_day_value_After_Haircut *-1                                  
when Second_Buy_sell = 'B' then Second_day_value_After_Haircut end,0))                                  
) as day_value_After_Haircut,              
sum(                            
convert(money,isnull(                            
case                                   
when Buy_sell = 'S' then day_value                                  
when Buy_sell = 'B' then day_value*-1 end,0))                                  
) +                                  
sum(                            
convert(money,isnull(                            
case                                   
when Second_Buy_sell = 'S' then Second_day_value                                  
when Second_Buy_sell = 'B' then Second_day_value*-1 end,0))                                  
) as Net_BuySell from #final_rel               
group by Fld_Party_Code                                   
) x                               
left outer join           
(select * from #fin2) y                                  
on x.Fld_Party_Code = y.party_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CHECK_FOR_DATE_CONSTRAINT
-- --------------------------------------------------
/******************************************************************************
CREATED BY: RUTVIJ S. PATIL
DATE: 30/09/2010
PURPOSE: USE TO CHECK WHETHER DATA IS PRESENT
		FOR INPUT FROM-DATE AND TO-DATE
		IN TABLE TR_IMG_UPLOAD

MODIFIED BY: PROGRAMMER NAME
DATED: DD/MM/YYYY
REASON: REASON TO CHANGE STORE PROCEDURE
******************************************************************************/

CREATE PROCEDURE USP_CHECK_FOR_DATE_CONSTRAINT

	@IMG_UPLOAD_ID INT,  -- USE TO STORE IMG_UPLOAD_ID
	@FROM_DATE DATETIME, -- USE TO HOLD FROM DATE IN DATETIME FORMAT
	@FROM_HH INT,        -- USE TO HOLD FROM DATE HOURS
	@FROM_MM INT,        -- USE TO HOLD FROM DATE MINUTES

	@TO_DATE DATETIME,   -- USE TO HOLD TO DATE IN DATETIME FORMAT
	@TO_HH INT,          -- USE TO HOLD TO DATE HOURS
	@TO_MM INT			 -- USE TO HOLD TO DATE MINUTES

AS
BEGIN

	-- ADDING FROMDATE HOURS AND MINUTES IN FROM_DATE
	SET @FROM_DATE = (SELECT DATEADD(HH,@FROM_HH,DATEADD(MI,@FROM_MM,@FROM_DATE)))
	
	-- ADDING TODATE HOURS AND MINUTES IN TO_DATE
	SET @TO_DATE = (SELECT DATEADD(HH,@TO_HH,DATEADD(MI,@TO_MM,@TO_DATE)))

	SELECT IMG_UPLOAD_ID,
				FOR_EMP,
				FOR_SB_ADMIN,
				FOR_SB_USER,
				TIME_FROM,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,
				TIME_TO,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO
	INTO #TEMP FROM TR_IMG_UPLOAD
	WHERE IMG_UPLOAD_ID <> @IMG_UPLOAD_ID

	SELECT * 
	FROM #TEMP
	WHERE 
		( @FROM_DATE  BETWEEN DATE_FROM AND DATE_TO ) 
		OR ( @TO_DATE  BETWEEN DATE_FROM AND DATE_TO) 
		OR ((@FROM_DATE <= DATE_FROM) AND (DATE_TO <= @TO_DATE ))

	DROP TABLE #TEMP

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CHECK_FOR_TICKER_DATE_CONSTRAINT
-- --------------------------------------------------
/******************************************************************************  
CREATED BY: RUTVIJ S. PATIL  
DATE: 19/11/2010  
PURPOSE: USE TO CHECK WHETHER DATA IS PRESENT  
  FOR INPUT FROM-DATE AND TO-DATE  
  IN TABLE TICKER_IMG_UPLOAD  
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
  
CREATE PROCEDURE USP_CHECK_FOR_TICKER_DATE_CONSTRAINT  
  
 @ANGEL_TICKER_ID INT,  -- USE TO STORE IMG_UPLOAD_ID  
 @FROM_DATE DATETIME,   -- USE TO HOLD FROM DATE IN DATETIME FORMAT  
 @FROM_HH INT,          -- USE TO HOLD FROM DATE HOURS  
 @FROM_MM INT,          -- USE TO HOLD FROM DATE MINUTES  
  
 @TO_DATE DATETIME,     -- USE TO HOLD TO DATE IN DATETIME FORMAT  
 @TO_HH INT,            -- USE TO HOLD TO DATE HOURS  
 @TO_MM INT             -- USE TO HOLD TO DATE MINUTES  
  
AS  
BEGIN  
  
 -- ADDING FROMDATE HOURS AND MINUTES IN FROM_DATE  
 SET @FROM_DATE = (SELECT DATEADD(HH,@FROM_HH,DATEADD(MI,@FROM_MM,@FROM_DATE)))  
   
 -- ADDING TODATE HOURS AND MINUTES IN TO_DATE  
 SET @TO_DATE = (SELECT DATEADD(HH,@TO_HH,DATEADD(MI,@TO_MM,@TO_DATE)))  
  
 SELECT ANGEL_TICKER_ID,  
    TIME_FROM,  
    DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,  
    TIME_TO,  
    DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO  
 INTO #TEMP FROM TICKER_IMG_UPLOAD  
 WHERE ANGEL_TICKER_ID <> @ANGEL_TICKER_ID  
  
 SELECT *   
 FROM #TEMP  
 WHERE   
  ( @FROM_DATE  BETWEEN DATE_FROM AND DATE_TO )   
  OR ( @TO_DATE  BETWEEN DATE_FROM AND DATE_TO)   
  OR ((@FROM_DATE <= DATE_FROM) AND (DATE_TO <= @TO_DATE ))  
  
 DROP TABLE #TEMP  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Check_Odin
-- --------------------------------------------------
CREATE Proc Usp_Check_Odin @AccessCode Varchar(15)
As

Set Nocount on
Declare @Str as varchar(5000)

Set @Str = 'If Exists(Select * from sysobjects where name = ''Tbl_Odin_'+@AccessCode+''')'
Set @Str = @Str + ' Begin' 
Set @Str = @Str + ' 	IF Exists(Select * from Tbl_Odin_'+@AccessCode+' where Flag = ''1'')'	
Set @Str = @Str + ' 		Select 1'
Set @Str = @Str + ' 	Else'
Set @Str = @Str + ' 		Select 0'
Set @Str = @Str + ' End'
Set @Str = @Str + ' Else'
Set @Str = @Str + ' 	Select 0'

--Print @Str
Exec (@Str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CHK_CLIENT_EXIST
-- --------------------------------------------------
  
  
/******************************************************************************        
CREATED BY: RUTVIJ PATIL        
DATE: 02/12/2010      
PURPOSE: USED TO CHECK CLIENT EXISTS  
        
MODIFIED BY: PROGRAMMER NAME        
DATED: DD/MM/YYYY        
REASON: REASON TO CHANGE STORE PROCEDURE        
******************************************************************************/      
  
CREATE PROCEDURE USP_CHK_CLIENT_EXIST  
  
 @PARTY_CODE VARCHAR(50)  
  
AS  
BEGIN  
  
 SELECT PARTY_CODE   
 FROM INTRANET.RISK.DBO.CLIENT_DETAILS   
 WHERE PARTY_CODE = @PARTY_CODE AND LAST_INACTIVE_DATE >= GETDATE()  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CHK_POPUP_NAME
-- --------------------------------------------------
/******************************************************************************  
CREATED BY: RUTVIJ S. PATIL  
DATE: 29/09/2010  
PURPOSE: USE TO CHECK POPUP NAME WHILE EDITING DATA  
  
MODIFIED BY: RUTVIJ S. PATIL  
DATE: 13/10/2010  
PURPOSE: USE TO CHECK POPUP NAME BETWEEN (CURRENT DATE AND ABOVE) RECORDS

MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  

CREATE PROCEDURE USP_CHK_POPUP_NAME  

	@POPUP_NAME VARCHAR(15),  
	@IMG_UPLOAD_ID INT  

AS  
BEGIN  
  
	/*
	SELECT IMG_UPLOAD_ID   
	FROM TR_IMG_UPLOAD   
	WHERE POPUP_NAME LIKE @POPUP_NAME AND IMG_UPLOAD_ID <> @IMG_UPLOAD_ID  
	*/

	SELECT IMG_UPLOAD_ID,
				POPUP_NAME,
				FOR_EMP,
				FOR_SB_ADMIN,
				FOR_SB_USER,
				TIME_FROM,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,
				TIME_TO,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO
	INTO #TEMP 
	FROM TR_IMG_UPLOAD

	SELECT IMG_UPLOAD_ID FROM #TEMP WHERE GETDATE() < DATE_TO AND POPUP_NAME LIKE @POPUP_NAME AND IMG_UPLOAD_ID <> @IMG_UPLOAD_ID

	DROP TABLE #TEMP

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CHK_RIECO_IMAGE_EXIST
-- --------------------------------------------------
/******************************************************************************                  
CREATED BY: RUTVIJ PATIL                  
DATE: 03/12/2010                  
PURPOSE: USE TO CHECK IMAGE EXISTS IN TABLE TR_IMAGE_UPLOAD        
                  
MODIFIED BY: RASHMI PIMPLIKAR                  
DATED: 18/03/2011
REASON: CONDITION FOR DDNO IS ADDED
******************************************************************************/                  
        
CREATE PROCEDURE USP_CHK_RIECO_IMAGE_EXIST        
         
 @PARTY_CODE VARCHAR(50),  -- USE TO HOLD PARTY_CODE         
 @APPLICATION_NAME VARCHAR(50), -- USE TO HOLD APPLICATION NAME  
 @DDNO VARCHAR(10)        -- USE TO HOLD CHEQUE NO
AS        
BEGIN        
        
  SELECT IMAGE_UPLOAD_ID,IMAGE_NAME         
  FROM TR_IMAGE_UPLOAD        
  WHERE CLIENT_ID = @PARTY_CODE AND APPLICATION_NAME = @APPLICATION_NAME AND DDNO = @DDNO    
         
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CHK_TICKER_MESSAGE
-- --------------------------------------------------
/******************************************************************************    
CREATED BY: RUTVIJ S. PATIL    
DATE: 29/09/2010    
PURPOSE: USE TO CHECK TICKER MESSAGE WHILE EDITING DATA    
    
******************************************************************************/    
  
CREATE PROCEDURE USP_CHK_TICKER_MESSAGE   
  
 @TICKER_MESSAGE VARCHAR(60),    
 @ANGEL_TICKER_ID INT    
  
AS    
BEGIN    
    
 /*  
 SELECT IMG_UPLOAD_ID     
 FROM TR_IMG_UPLOAD     
 WHERE POPUP_NAME LIKE @POPUP_NAME AND IMG_UPLOAD_ID <> @IMG_UPLOAD_ID    
 */  
  
 SELECT ANGEL_TICKER_ID,  
    TICKER_MESSAGE,  
    TIME_FROM,  
    DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,  
    TIME_TO,  
    DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO  
 INTO #TEMP   
 FROM TICKER_IMG_UPLOAD  
  
 SELECT ANGEL_TICKER_ID FROM #TEMP WHERE GETDATE() < DATE_TO AND TICKER_MESSAGE LIKE @TICKER_MESSAGE AND ANGEL_TICKER_ID <> @ANGEL_TICKER_ID  
  
 DROP TABLE #TEMP  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_cibil_insert
-- --------------------------------------------------
create procedure Usp_cibil_insert(@filename as varchar(25))
AS

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CMSMails_LogDetails
-- --------------------------------------------------
CREATE proc dbo.USP_CMSMails_LogDetails    
(@value as varchar(25))    
as    
    
if @value='PARTYCODE'    
begin    
Select party_code [PARTY CODE],convert(decimal(10,2),bse) [BSE],convert(decimal(10,2),nse) [NSE],convert(decimal(10,2),fo) [FO],convert(decimal(10,2),ncdx) [NCDEX],    
convert(decimal(10,2),mcx) [MCX],convert(decimal(10,2),mcd) [MCD], convert(decimal(10,2),nsx) [NSX],convert(decimal(10,2),bse1) [BSE1],convert(decimal(10,2),nse1) [NSE1],convert(decimal(10,2),fo1) [FO1],    
convert(decimal(10,2),ncdx1) [NCDX1],convert(decimal(10,2),mcx1) [MCX1],convert(decimal(10,2),mcd1) [MCD1], convert(decimal(10,2),nsx1) [NSX1],convert(decimal(10,2),Tot1) [TOTAL1],convert(decimal(10,2),Tot2) [TOTAL2],email [EMAILS],long_name [NAME]    
,mobile_pager [MOBILE/PAGER NO],Updated_Date [UPDATED DATE]    
from tbl_CMSMails_Log    
where convert(varchar(11),Updated_Date) = (select convert(varchar(11),max(Updated_Date)) from tbl_CMSMails_Log where payType = 'Online')   
and payType = 'Online'
end    
    
if @value='EMAIL'    
begin    
Select party_code [PARTY CODE],convert(decimal(10,2),bse) [BSE],convert(decimal(10,2),nse) [NSE],convert(decimal(10,2),fo) [FO],convert(decimal(10,2),ncdx) [NCDEX],    
convert(decimal(10,2),mcx) [MCX],convert(decimal(10,2),mcd) [MCD], convert(decimal(10,2),nsx) [NSX],convert(decimal(10,2),bse1) [BSE1],convert(decimal(10,2),nse1) [NSE1],convert(decimal(10,2),fo1) [FO1],    
convert(decimal(10,2),ncdx1) [NCDX1],convert(decimal(10,2),mcx1) [MCX1],convert(decimal(10,2),mcd1) [MCD1], convert(decimal(10,2),nsx1) [NSX1],convert(decimal(10,2),Tot1) [TOTAL1],convert(decimal(10,2),Tot2) [TOTAL2],email [EMAILS],long_name [NAME]    
,mobile_pager [MOBILE/PAGER NO],Updated_Date [UPDATED DATE]    
from tbl_CMSMails_Log    
where EMAIL <> ''    
and convert(varchar(11),Updated_Date) = (select convert(varchar(11),max(Updated_Date)) from tbl_CMSMails_Log where payType = 'Online')   
and payType = 'Online'
end    
    
if @value='SMS'    
begin    
Select party_code [PARTY CODE],convert(decimal(10,2),bse) [BSE],convert(decimal(10,2),nse) [NSE],convert(decimal(10,2),fo) [FO],convert(decimal(10,2),ncdx) [NCDEX],    
convert(decimal(10,2),mcx) [MCX],convert(decimal(10,2),mcd) [MCD], convert(decimal(10,2),nsx) [NSX],convert(decimal(10,2),bse1) [BSE1],convert(decimal(10,2),nse1) [NSE1],convert(decimal(10,2),fo1) [FO1],    
convert(decimal(10,2),ncdx1) [NCDX1],convert(decimal(10,2),mcx1) [MCX1],convert(decimal(10,2),mcd1) [MCD1], convert(decimal(10,2),nsx1) [NSX1],convert(decimal(10,2),Tot1) [TOTAL1],convert(decimal(10,2),Tot2) [TOTAL2],email [EMAILS],long_name [NAME]    
,mobile_pager [MOBILE/PAGER NO],Updated_Date [UPDATED DATE]    
from tbl_CMSMails_Log    
where MOBILE_PAGER <> ''    
and convert(varchar(11),Updated_Date) = (select convert(varchar(11),max(Updated_Date)) from tbl_CMSMails_Log where payType = 'Online')   
and payType = 'Online'
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Col_UPload
-- --------------------------------------------------
CREATE proc USP_Col_UPload           
(                            
@filename as varchar(100),@server as varchar(20)                            
)                             
as            
------------Upload Collateral Data---          
          
set transaction  isolation  level read uncommitted                                  
declare @path as varchar(100)                              
declare @sql as varchar(1000)                               
                  
truncate table tbl_collateral_upload           
                  
--set @path='d:\upload1\' + 'Base File Upload.csv'                
set @path='\\'+@server+'\d$\upload1\' + @filename              
SET @SQL = 'BULK INSERT tbl_collateral_upload FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                              
exec (@sql)                                      
select records=Count(*) from tbl_collateral_upload    
/*          
create table tbl_collateral_upload          
(          
Fld_Party_Code varchar(15),          
Fld_Scrip_Code varchar(20),          
Fld_Qty varchar(20),          
Fld_Cash_Margin varchar(50),      
Fld_Hair_Cut varchar(50)             
)      
drop table   tbl_collateral_upload      
      
) */

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Comm_Mail2
-- --------------------------------------------------
CREATE Proc [dbo].[Usp_Comm_Mail2]  
as  
  
Declare  @branch_cd as varchar(100)                               
Declare  @Fld_Email as varchar(500)  
Declare  @file as varchar(1000)                                    
Declare  @s as varchar(1000)                                    
Declare  @s1 as varchar(1000)                                    
Declare  @MSG as varchar(8000)                                    
                                    
                                    
SET @MSG = '<BR>Dear All,<BR>'                                    
SET @MSG = @MSG+'<P>Please find the enclosed list of inactive clients (clients not traded since last 6 months)                                     
          from your branch.<br>You are requested to obtain the written request in the attached format before                                     
     executing any trades for these clients.</P>'                                    
SET @MSG = @MSG+'<P>Please ensure not to execute any trades without obtaining necessary authority letter from the client.<br>                                     
     Failing which, the branch will be solely responsible for any action taken / penalty imposed by exchange.</P>'                                    
SET @MSG = @MSG+'<P>For further clarification, please feel free to contact Commodities team @ 022-30871400 ext 320/276.</P>'     
  
Select * into #xx from tbl_Comm_HIST where fld_date >= convert(varchar(11),getdate())  and fld_date <= convert(varchar(11),getdate())+' 23:59:59' and branch_cd in  
(Select fld_br_code from Tbl_Comm_Mails_Branch where status = '')  
  
Select distinct branch_cd into #branches from #xx                       
                 
DECLARE Comm_Mails CURSOR FOR Select Fld_Email,Fld_Br_Code from Tbl_Comm_Mails_Branch where Fld_Br_Code in (select branch_cd from #branches)                  
OPEN Comm_Mails                                                           
                                                                                        
FETCH NEXT FROM Comm_Mails                                                                         
INTO @Fld_Email,@branch_cd                                                                                    
                                                                                        
WHILE @@FETCH_STATUS = 0                                                                  
                                                                                    
BEGIN                                    
                                    
truncate table Tbl_Comm_Mails                                    
                                    
insert into Tbl_Comm_Mails                                    
select 'Party Code'+','+'Branch Code'+','+'Sub Broker'+','+'MCDX LAST BILL DATE'+','+'NCDX LAST BILL DATE'+','+'CONTACT NO'+','+'NARATION'                                      
                                    
insert into Tbl_Comm_Mails                                    
select rtrim(ltrim(cltcode))+','+ltrim(rtrim(branch_cd))+','+ltrim(rtrim(sub_broker))+','+                                    
rtrim(ltrim(MCX_billdate))+','+                        
rtrim(ltrim(NCDEX_billdate))+','+                                  
rtrim(ltrim(Contact_No))+','+'Being client not trading since last 6 month'                                    
from #xx where branch_Cd = @branch_cd                                                
                       
set @file = 'D:\upload1\Comm_Mails\'+'Inactive_list'+'_'+ltrim(rtrim(@branch_cd))+'.csv'                          
                                                                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_Msg FROM MIS.upload.DBO.Tbl_Comm_Mails" queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                              
set @s1= @s+''''                   
exec(@s1)                                      
--print @s1                                    
        
declare @file1 as varchar(300)                          
set @file1 = @file+';'+'D:\upload1\Comm_Mails\Client_Confirmation.doc'                             
                                    
Exec usp_AutoMail_COMM @Fld_Email,@MSG,@file1,@branch_cd                                       
                                    
FETCH NEXT FROM Comm_Mails                                                     
INTO @Fld_Email,@branch_cd                                                                
                                                              
END                                                                                        
                                                                
CLOSE Comm_Mails                                                                                        
DEALLOCATE Comm_Mails

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Comm_Mails_Branch
-- --------------------------------------------------

CREATE proc USP_Comm_Mails_Branch    
(    
@Val as char(1),    
@Fld_Br_Code as varchar(15),    
@Fld_Email as varchar(2000)    
)    
    
as    
    
If @Val = 'I'    
    
Begin     
insert into Tbl_Comm_Mails_Branch values (@Fld_Br_Code,@Fld_Email,'')    
    
Select 'Records Saved'    
End    
    
Else    
    
If @Val = 'U'    
Begin    
update Tbl_Comm_Mails_Branch set Fld_Email = @Fld_Email where Fld_Br_Code = @Fld_Br_Code    
    
Select 'Records Updated'    
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_ControlFileClientLetter
-- --------------------------------------------------
CREATE proc usp_ControlFileClientLetter          
(                                                
@filename as varchar(100)                                                
)                                                 
as                                                    
set transaction  isolation  level read uncommitted                                                    
                                        
declare @path as varchar(100)                                                
declare @sql as varchar(1000)                                             
-- declare @filename as varchar(100)                                                
-- set @filename = 'IT_Events'                                        
                                      
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename                                                
                                      
truncate table tbl_ControlFileClientLetter                     
                                      
SET @SQL = 'insert into tbl_ControlFileClientLetter select *  FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                                      
--print @sql                      
exec (@SQL)               
  
  
insert into tbl_ControlFileClientLetter_record                  
--select Ddate+Destination_Name+Client_ID+Client_Name+Pin_code+F7+F8+F9,F10,F11,F12 from tbl_clientbulkupload            
select  Branch_cd,Sub_Broker,ClientCode,ClientName,ClientAddress,PinCode,Mobile,ResPhone,TCName,Code,Remark,MinorChangeAddress,ChangeAddress from  tbl_ControlFileClientLetter    
where  
(Branch_cd+Sub_broker+ClientCode)not in  
(Select Branch_cd+Sub_broker+ClientCode from tbl_ControlFileClientLetter_record)  
  
            
 /*                  
insert into tbl_ControlFileClientLetter_record                      
--select Ddate,Destination_Name,Client_ID,Client_Name,Pin_code,F7,F8,F9,F10,F11,F12 from tbl_clientbulkupload                
select Branch_cd,Sub_Broker,ClientCode,ClientName,ClientAddress,PinCode,Mobile,ResPhone,TCName,Code,Remark,MinorChangeAddress,ChangeAddress from  tbl_ControlFileClientLetter          
select * from tbl_ControlFileClientLetter  
*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_CSO_BULK_UPDATION
-- --------------------------------------------------
--UPLOAD CSV FOR CTCK BULK UPDATE  
--DATE 01/10/2013  
  
CREATE PROCEDURE [DBO].[USP_CTCL_CSO_BULK_UPDATION]  
(  
@FILENAME VARCHAR(100)  
)  
AS  
  
SET NOCOUNT ON   
DECLARE   
  @STR VARCHAR(2000),  
  @PATH VARCHAR(200)  
    
BEGIN  
DELETE FROM [INTRANET].CTCLNEW.DBO.TBL_CTCL_BULKUPLOAD  
SELECT @PATH= UPLOADSERVER   
FROM  [CSOKYC-6].UPLOAD.DBO.GLOBAL_UPLOAD  
WHERE UPD_SRNO='57'  
SET @PATH=@PATH + @FILENAME  
PRINT @PATH  
SET @STR='BULK INSERT TBL_CTCL_BULKUPD  FROM '''+@PATH+ ''' WITH(FIELDTERMINATOR=''|'', FIRSTROW=2,KEEPNULLS)'                   
EXEC (@STR)                          
select * from TBL_CTCL_BULKUPD  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_DeletionReplication
-- --------------------------------------------------
CREATE procedure USP_CTCL_DeletionReplication(@filename as varchar(25))  
as    
set nocount on  
delete from intranet.[CTCL1.1].dbo.tbl_deleteRepliCTCLid  
set nocount off  
insert into intranet.[CTCL1.1].dbo.tbl_deleteRepliCTCLid  
select fld_RecordNo,fld_DisableReason,fld_server from temp_deleteRepliCTCLid  

--select * from tbl_deleteRepliCTCLid  
  
--exec intranet.[ctcl1.1].dbo.USP_CTCL_DeletionReplication

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_DeletionReplication_BSE
-- --------------------------------------------------
CREATE procedure USP_CTCL_DeletionReplication_BSE(@filename as varchar(25))    
as      
set nocount on    
delete from intranet.[CTCL1.1].dbo.tbl_deleteRepliCTCLid_BSE    
set nocount off    
insert into intranet.[CTCL1.1].dbo.tbl_deleteRepliCTCLid_BSE    
select fld_RecordNo,fld_DisableReason,fld_server from temp_deleteRepliCTCLid_BSE    
  
--select * from tbl_deleteRepliCTCLid
--exec intranet.[ctcl1.1].dbo.USP_CTCL_DeletionReplication

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Ctcl_FailedOrder
-- --------------------------------------------------
CREATE Proc USP_Ctcl_FailedOrder                                                                          
(                                                                          
@file as varchar(50),                                                                          
@Type as Char,                                                                          
@Code as Varchar(15),            
@server as varchar(50)                                                                        
)                                                                                                                                    
as                                                                                         
                                                                          
/*                                                                          
declare @file as varchar(50)                                                                          
declare @Type as Char                                                                          
declare @Code as Varchar(15)                                                                             
                                                                          
set @file = '070809 Karad.xls'                                                                          
set @Type = 'F'                                                                          
set @Code = 'CSO19'*/                                                                          
                                                                                                                    
  declare @path as varchar(100)                                                                                                                                  
  declare @str as varchar(5000)                                                                                                                    
  Declare @result as varchar(10)                                                                                                                    
  Declare @tblname as varchar(20)       
  declare @str3 as varchar(5000)                                                                                                                                                                                                     
                                                                                                                                                     
--set @path= '\\196.1.115.136\d$\Upload1\ctcl\FailedOrders\' + @file                                                                                       
set @path= '\\'+@server+'\d$\Upload1\ctcl\FailedOrders\' + @file                                                                                       
                                                                          
declare @table as varchar(25)                                                                          
declare @table1 as varchar(25)                                                                          
                                                                          
set @table =                                                                           
case                                                                           
when @Type = 'C' then @Code+'_chatmsg'                                                                          
when @Type = 'F' then @Code+'_failed' end                                                      
                                                      
                                                                        
set @str = 'drop table tbl_ctcl_'+@table+';'                                        
                                                                       
set @table1 =                                                                           
case                                                                           when @Type = 'C' then 'tbl_ctcl_chatMsg'                                    
when @Type = 'F' then 'tbl_ctcl_failed1' end                                                            
                  
                                          
Set @str = @str+'If Not Exists(Select top 0 * from sysobjects where name like ''tbl_ctcl_'+@table+''')'                  
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                                       
              
Set @str = @str+' If Exists(Select Count(*) from tbl_ctcl_'+@table+')'                                         
                  
set @str = 'drop table tbl_ctcl_'+@table+';'                                 
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                     
                              
declare @str12 as varchar(1000)                                 
                  
if @Type='F'                          
begin       
      
    
declare @str1 as varchar(1000)     
set @str1='select * from tbl_ctcl_'+@Code+'_failed'    
    
                  
    
set @str12='drop table tbl_ctcl_'+@Code+'_failed;Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'                              
exec(@str12)                                                            
        
set @str = 'insert into tbl_ctcl_'+@Code+'_failed select [User Id],Client,Reason FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from tbl_ctcl_'+@Code+'_failed'                     
 
     
set @str3 = 'insert into hist_tbl_ctcl_failed ([User Id],Client,Reason) Select [User Id],Client,Reason from tbl_ctcl_'+@Code+'_failed'         
--print @str3    
--print @str    
exec(@str)                        
exec(@str3)      
  
declare @str5 varchar(5000)  
set @str5='update hist_tbl_ctcl_failed set branch_id='''+@Code+''',EntryDate=getdate() from   
(select [User Id],Client,Reason from tbl_ctcl_'+@Code+'_failed)b  
where hist_tbl_ctcl_failed.[User Id]=b.[User Id]   
and hist_tbl_ctcl_failed.client=b.client and hist_tbl_ctcl_failed.reason=b.reason'  
--print @str5  
exec (@str5)  
   
--set @str12='drop table tbl_ctcl_'+@Code+'_failed;Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'                              
--exec(@str12)                                                            
--               
--                 
--EXEC [172.29.2.158,2000].MASTER.DBO.usp_uploadmis @path,@table,@Code                    
--PRINT (@path)                 
--PRINT (@table)              
--PRINT (@Code)              
              
end                         
                                                                       
if @Type = 'C'                      
begin                                                               
set @str=@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                                  
exec(@str)                
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Ctcl_FailedOrder_temptemp
-- --------------------------------------------------
CREATE Proc USP_Ctcl_FailedOrder_temptemp                                                                      
(                                                                      
@file as varchar(50),                                                                      
@Type as Char,                                                                      
@Code as Varchar(15),        
@server as varchar(50)                                                                      
)                                                                                                                                
as                                                                                     
                                                                      
/*                                                                      
declare @file as varchar(50)                                                                      
declare @Type as Char                                                                      
declare @Code as Varchar(15)                                                                         
                                                                      
set @file = '070809 Karad.xls'                                                                      
set @Type = 'F'                                                                      
set @Code = 'CSO19'*/                                                                      
                                                                                                                
  declare @path as varchar(100)                                                                                                                              
  declare @str as varchar(5000)                                                                                                                
  Declare @result as varchar(10)                                                                                                                
  Declare @tblname as varchar(20)                                                                                    
                                                                                                                                                 
--set @path= '\\196.1.115.136\d$\Upload1\ctcl\FailedOrders\' + @file                                                                                   
set @path= '\\'+@server+'\d$\Upload1\ctcl\FailedOrders\' + @file                                                                                   
                                                                      
declare @table as varchar(25)                                                                      
declare @table1 as varchar(25)                                                                      
                                                                      
set @table =                                                                       
case                                                                       
when @Type = 'C' then @Code+'_chatmsg'                                                                      
when @Type = 'F' then @Code+'_failed' end                                                  
                                                  
                                                                    
set @str = 'drop table tbl_ctcl_'+@table+';'                                    
                                                                   
set @table1 =                                                                       
case                                                                       
when @Type = 'C' then 'tbl_ctcl_chatMsg'                                                                      
when @Type = 'F' then 'tbl_ctcl_failed1' end                                                        
              
                                      
Set @str = @str+'If Not Exists(Select top 0 * from sysobjects where name like ''tbl_ctcl_'+@table+''')'              
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                                   
          
Set @str = @str+' If Exists(Select Count(*) from tbl_ctcl_'+@table+')'                                     
              
set @str = 'drop table tbl_ctcl_'+@table+';'                             
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                 
                          
declare @str12 as varchar(1000)                             
              
if @Type='F'                      
begin   
  
set @str12='drop table tbl_ctcl_'+@Code+'_failed;Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'                          
exec(@str12)                                                        
    
set @str = 'insert into tbl_ctcl_'+@Code+'_failed select [User Id],Client,Reason FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from tbl_ctcl_'+@Code+'_failed'                     
 print    (@str)                        
exec(@str)  
             
              
--set @str12='drop table tbl_ctcl_'+@Code+'_failed;Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'                          
--exec(@str12)                                                        
--           
--             
--EXEC [172.29.2.158,2000].MASTER.DBO.usp_uploadmis @path,@table,@Code                
--PRINT (@path)             
--PRINT (@table)          
--PRINT (@Code)          
          
end                     
                                                                   
if @Type = 'C'                  
begin                                                           
set @str=@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                              
exec(@str)            
print (@str)   
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Ctcl_FailedOrder1
-- --------------------------------------------------
CREATE Proc USP_Ctcl_FailedOrder1                                                                  
(                                                                  
@file as varchar(50),                                                                  
@Type as Char,                                                                  
@Code as Varchar(15),    
@server as varchar(50)                                                                  
)                                                                                                                            
as                                                                                 
                                                                  
/*                                                                  
declare @file as varchar(50)                                                                  
declare @Type as Char                                                                  
declare @Code as Varchar(15)                                                                     
                                                                  
set @file = '070809 Karad.xls'                                                                  
set @Type = 'F'                                                                  
set @Code = 'CSO19'*/                                                                  
                                                                                                            
  declare @path as varchar(100)                                                                                                                          
  declare @str as varchar(5000)                                                                                                            
  Declare @result as varchar(10)                                                                                                            
  Declare @tblname as varchar(20)                                                                                
                                                                                                                                             
--set @path= '\\196.1.115.136\d$\Upload1\ctcl\FailedOrders\' + @file                                                                               
set @path= '\\'+@server+'\d$\Upload1\ctcl\FailedOrders\' + @file                                                                               
                                                                  
declare @table as varchar(25)                                                                  
declare @table1 as varchar(25)                                                                  
                                                                  
set @table =                                                                   
case                                                                   
when @Type = 'C' then @Code+'_chatmsg'                                                                  
when @Type = 'F' then @Code+'_failed' end                                              
                                              
                                                                
set @str = 'drop table tbl_ctcl_'+@table+';'                                
                                                               
set @table1 =                                                                   
case                                                                   
when @Type = 'C' then 'tbl_ctcl_chatMsg'                                                                  
when @Type = 'F' then 'tbl_ctcl_failed1' end                                                    
          
                                  
Set @str = @str+'If Not Exists(Select top 0 * from sysobjects where name like ''tbl_ctcl_'+@table+''')'                               
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                               
      
Set @str = @str+' If Exists(Select Count(*) from tbl_ctcl_'+@table+')'                                 
          
set @str = 'drop table tbl_ctcl_'+@table+';'                         
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1             
                      
declare @str12 as varchar(1000)                         
          
if @Type='F'                  
begin               
          
--set @str12='drop table tbl_ctcl_'+@Code+'_failed;Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'                      
--exec(@str12)                                                    
--       
--         
--EXEC [172.29.2.158,2000].MASTER.DBO.usp_uploadmis @path,@table,@Code            
--PRINT (@path)         
--PRINT (@table)      
--PRINT (@Code) 
set @str = 'insert into mis.UPLOAD.dbo.tbl_ctcl_'+@Code+' select [User Id],Client,Reason FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from mis.upload.dbo.tbl_ctcl_'+@Code                                   
exec(@str)         
end                 
                                                               
if @Type = 'C'              
begin                                                       
set @str=@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                          
exec(@str)        
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Ctcl_FailedOrdertemp
-- --------------------------------------------------
    
CREATE Proc USP_Ctcl_FailedOrdertemp                                                        
(                                                        
@file as varchar(50),                                                        
@Type as Char,                                                        
@Code as Varchar(15)                                                        
)                                                                                                                  
as                                                                       
                                                        
/*                                                        
declare @file as varchar(50)                                                        
declare @Type as Char                                                        
declare @Code as Varchar(15)                                                           
                                                        
set @file = '070809 Karad.xls'                                                        
set @Type = 'F'                                                        
set @Code = 'CSO19'*/                                                        
                                                                                                  
  declare @path as varchar(100)                                                                                                                
  declare @str as varchar(5000)                                                                                                  
  Declare @result as varchar(10)                                                                                                  
  Declare @tblname as varchar(20)                                                                      
                                                                                                                                   
set @path= '\\INHOUSEALLAPP-FS.angelone.in\d$\Upload1\ctcl\FailedOrders\' + @file                                                                     
                                                        
declare @table as varchar(25)                                                        
declare @table1 as varchar(25)                                                        
                                                        
set @table =                                                         
case                                                         
when @Type = 'C' then @Code+'_chatmsg'                                                        
when @Type = 'F' then @Code+'_failed' end                                    
                                    
                                                      
set @str = 'drop table tbl_ctcl_'+@table+';'                      
                                                     
set @table1 =                                                         
case                                                         
when @Type = 'C' then 'tbl_ctcl_chatMsg'                                                        
when @Type = 'F' then 'tbl_ctcl_failed1' end                                          
/*              
---when @type = 'F' then 'tbl_ctcl_failed' end                                          
--when @type = 'F' then 'tbl_FailedCodes' end                                         
*/                                 
                        
Set @str = @str+'If Not Exists(Select top 0 * from sysobjects where name like ''tbl_ctcl_'+@table+''')'                     
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                         
                                                        
Set @str = @str+' If Exists(Select Count(*) from tbl_ctcl_'+@table+')'                       
---megha                 
set @str = 'drop table tbl_ctcl_'+@table+';'               
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1            
            
declare @str12 as varchar(1000)                                                       
if @Type='F'        
begin        
set @str12='drop table tbl_ctcl_'+@Code+'_failed;            
Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'            
end            
exec(@str12)            
                                 
---end                    
--Set @str = @str+' Begin Truncate table tbl_ctcl_'+@table+' End'                                                                                                      
                      
/*--mangesh                        
Set @str =                                                         
case                                                         
when @type = 'C' then                                                        
@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                
when @type = 'F' then                                        
@str+' insert into tbl_ctcl_'+@table+' select [User Id],Client,[Pro/Cli],[Order Type],[B/S],[Group Id],Exchange,Quantity,Price,[Strike Price],[Ser/Exp],[Scrip Name],Status,Reason,[Product Type],[Date/Time],[B/S],[O/C] FROM OPENROWSET(''Microsoft.Jet.OLED 
  
   
B.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from tbl_ctcl_'+@Code+'_failed'                                                        
end*/                           
  
                                           
                                            
Set @str =                                                         
case                                                         
when @Type = 'C' then                                                
@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                
when @Type = 'F' then                                                        
@str+' insert into tbl_ctcl_'+@table+' select [User Id],Client,Reason FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from tbl_ctcl_'+@Code+'_failed'                                
  
      
end                                    
                                  
Print @str         
                                                  
---Exec (@str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Ctcl_FailedOrdertest
-- --------------------------------------------------
    
CREATE Proc USP_Ctcl_FailedOrdertest                                                        
(                                                        
@file as varchar(50),                                                        
@Type as Char,                                                        
@Code as Varchar(15)                                                        
)                                                                                                                  
as                                                                       
                                                        
/*                                                        
declare @file as varchar(50)                                                        
declare @Type as Char                                                        
declare @Code as Varchar(15)                                                           
                                                        
set @file = '070809 Karad.xls'                                                        
set @Type = 'F'                                                        
set @Code = 'CSO19'*/                                                        
                                                                                                  
  declare @path as varchar(100)                                                                                                                
  declare @str as varchar(5000)                                                                                                  
  Declare @result as varchar(10)                                                                                                  
  Declare @tblname as varchar(20)                                                                      
                                                                                                                                   
set @path= '\\INHOUSEALLAPP-FS.angelone.in\d$\Upload1\ctcl\FailedOrders\' + @file                                                                     
                                                        
declare @table as varchar(25)                                                        
declare @table1 as varchar(25)                                                        
                                                        
set @table =                                                         
case                                                         
when @Type = 'C' then @Code+'_chatmsg'                                                        
when @Type = 'F' then @Code+'_failed' end                                    
                                    
                                                      
set @str = 'drop table tbl_ctcl_'+@table+';'                      
                                                     
set @table1 =                                                         
case                                                         
when @Type = 'C' then 'tbl_ctcl_chatMsg'                                                        
when @Type = 'F' then 'tbl_ctcl_failed1' end                                          
/*              
---when @type = 'F' then 'tbl_ctcl_failed' end                                          
--when @type = 'F' then 'tbl_FailedCodes' end                                         
*/                                 
                        
Set @str = @str+'If Not Exists(Select top 0 * from sysobjects where name like ''tbl_ctcl_'+@table+''')'                     
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1                         
                                                        
Set @str = @str+' If Exists(Select Count(*) from tbl_ctcl_'+@table+')'                       
---megha                 
set @str = 'drop table tbl_ctcl_'+@table+';'               
Set @str = @str+' Select top 0 * into tbl_ctcl_'+@table+' from '+@table1            
            
declare @str12 as varchar(1000)                                                       
if @Type='F'        
begin        
set @str12='drop table tbl_ctcl_'+@Code+'_failed;            
Select top 0 * into tbl_ctcl_'+@Code+'_failed from tbl_ctcl_failed1'            
end            
exec(@str12)            
                                 
---end                    
--Set @str = @str+' Begin Truncate table tbl_ctcl_'+@table+' End'                                                                                                      
                      
/*--mangesh                        
Set @str =                                                         
case                                                         
when @type = 'C' then                                                        
@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                
when @type = 'F' then                                        
@str+' insert into tbl_ctcl_'+@table+' select [User Id],Client,[Pro/Cli],[Order Type],[B/S],[Group Id],Exchange,Quantity,Price,[Strike Price],[Ser/Exp],[Scrip Name],Status,Reason,[Product Type],[Date/Time],[B/S],[O/C] FROM OPENROWSET(''Microsoft.Jet.OLED 
  
   
B.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from tbl_ctcl_'+@Code+'_failed'                                                        
end*/                           
                                            
                                            
Set @str =                                                         
case                                                         
when @Type = 'C' then                                                
@str+' BULK INSERT tbl_ctcl_'+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS);Select Count(*) from tbl_ctcl_'+@Code+'_chatmsg'                                                                
when @Type = 'F' then                                                        
@str+' insert into tbl_ctcl_'+@table+' select [User Id],Client,Reason FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'');Select Count(*) from tbl_ctcl_'+@Code+'_failed'                                
  
      
end                                    
                                  
Print @str         
                                                  
--Exec (@str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_OdinFile_Generation
-- --------------------------------------------------

CREATE Proc [dbo].[USP_CTCL_OdinFile_Generation](@flag as varchar(2),@server as varchar(25),@fld_date as varchar(11),@serveradd as varchar(30))                                                        
as                                              
set nocount on                                             
declare @s as varchar(8000)                                  
declare @s1 as varchar(8000)                                  
declare @file as varchar(500)                           
declare @@server as varchar(25)                                 
--declare @Fld_Date as varchar(11)                                  
                                  
set @fld_date = convert(varchar(11),@fld_date)                                
                            
--set @file = ltrim(rtrim(replace(@server,' ','')))+'.txt'      
                      
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New where Convert(varchar(11),Fld_Date,103) = '''''+@Fld_Date+''''' and fld_server = '''''+@server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin
--\CTCL_'+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'  
--set @s1= @s+''''                                                                  
            
----print(@s1)                                  
--exec(@s1)          

if @flag='1'
begin      
	--SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Deletion_OCNC       
	--where Convert(varchar(11),Fld_Date,103) = @Fld_Date and fld_server = @server      
	SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Deletion_OCNC       
	where Fld_Date = @Fld_Date and fld_server = @server      
end                               


if @flag='2'
begin                                   
	select distinct fld_gen,ID=row_number() over(order by fld_gen) into #tmp       
	from             
	 mis.upload.DBO.tbl_gen_odin_file_New with(nolock)            
	 where Convert(varchar(11),Fld_Date,103)=@Fld_Date      
	 and fld_server = @server      
	       
	       
	 ;WITH       
	cteReason AS      
	(--==== Split the REASON_TYPE and include the EmpID and the position the data was in      
		 -- as an "ElementNumber" so we can rejoin with the correct REASON.      
	 SELECT ROW_NUMBER() OVER (PARTITION BY ID   ORDER BY t.Number  ) AS ElementNumber,      
			ID,fld_gen,      
			Identifier  = SUBSTRING(','+s.fld_gen, t.Number+1, CHARINDEX(',', s.fld_gen+',', t.Number+1)-t.Number)      
	   FROM Master.dbo.spt_Values t      
	  RIGHT OUTER JOIN --Necessary in case SomeCsv is NULL      
			#Tmp s       
		 ON SUBSTRING(','+s.fld_gen, t.Number, 1) = ','       
		AND t.Number BETWEEN 1 AND LEN(','+s.fld_gen)      
		AND t.Type = 'P'  --Identifies rows with numbers from 0 to 2047      
	)      
	--===== Join each REASON with its corresponding REASON_TYPE      
	SELECT r.ID,fld_gen, r.ElementNumber,r.Identifier      
	into #Tmp2      
	FROM cteReason r      
	      
	select a.fld_gen from       
	 (SELECT fld_gen, [1],[2],[3]as odin,[4],[5],[6],@server as server      
	 FROM       
	 (SELECT fld_gen, ElementNumber, Identifier      
	 FROM #Tmp2) p      
	 PIVOT      
	 (      
	 max(Identifier)      
	 FOR ElementNumber IN ([1],[2],[3],[4],[5],[6])      
	 ) AS pvt)a      
	       
	 left outer join intranet.[ctcl1.1].dbo.TBL_TERMINAL_BLOCKING b with(nolock)      
	 on a.server=b.fld_server  and  a.odin=b.fld_termid      
	 where ISNULL(b.fld_termid,'')=''      
	       
	ORDER BY a.fld_gen      
             
 end                              
                                  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_UserMaintaince_OdinFile
-- --------------------------------------------------
CREATE Proc [dbo].[USP_CTCL_UserMaintaince_OdinFile](@server as varchar(25),@fld_date as varchar(11),@serveradd as varchar(30))                                              
as                                    
set nocount on                                   
 declare @s as varchar(8000)    
declare @s1 as varchar(8000)    
declare @file as varchar(500)    
declare @@server as varchar(25)                       
--declare @Fld_Date as varchar(11)                        
                        
set @fld_date = convert(varchar(11),@fld_date)                      
                  
                  
select @@server=old_server from intranet.[ctcl1.1].dbo.TBL_SURVIL_SERVER where new_server=@Server                  
                  
--sELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New a                   
--inner join intranet.[CTCL1.1].dbo.V_ServerMapping b on a.Fld_Server=b.Branch_Name                   
--and LocaName =  @Server                  
--print @Server                  
                        
set @file = ltrim(rtrim(replace(@server,' ','')))+'.txt'                                                                                
  /*                      
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New a inner join intranet.[CTCL1.1].dbo.V_ServerMapping b on a.Fld_Server=b.Branch_Name where Convert(varchar(11),Fld_Date,103) = '''''+@Fld_Date
  
    
      
        
          
+'            
--'''' and LocaName = '''''+@server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\CTCL_'+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc                    
--set @s1= @s+''''  */             
            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New where Convert(varchar(11),Fld_Date,103) = '''''+@Fld_Date+''''' and fld_server = '''''+@server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\CTCL_'+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'
set @s1= @s+''''                                                        
                        
exec(@s1)  
  
--set @s=''   
--set @s1=''                     
                        
set @file = 'ClientMap_'+ltrim(rtrim(replace(@server,' ','')))+'.txt'                                                                                  
                                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select distinct fld_gen from mis.upload.DBO.tbl_gen_odin_file_New where Convert(varchar(11),Fld_Date,103)='''''+@Fld_Date+''''' and fld_server = '''''+@server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\'+rtrim(ltrim(@file))+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'
set @s1= @s+''''                                                                                            
                        
exec(@s1)                         
                        
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_UserMaintaince_OdinFile_new
-- --------------------------------------------------
CREATE Proc [dbo].[USP_CTCL_UserMaintaince_OdinFile_new](@flag as varchar(2),@server as varchar(25),@fld_date as varchar(11),@serveradd as varchar(30))                                                          
as                                                
set nocount on                                               
declare @s as varchar(8000)                                    
declare @s1 as varchar(8000)                                    
declare @file as varchar(500)                             
declare @@server as varchar(25)                                   
--declare @Fld_Date as varchar(11)                                    
                                    
if(@server='AKRUTI DIET CLIENT (66)')
Begin
	set @server='AKRUTI CLIENT (66)'
End
print @server
set @fld_date = convert(varchar(11),@fld_date)                                  
                              
--set @file = ltrim(rtrim(replace(@server,' ','')))+'.txt'        
                        
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New where Convert(varchar(11),Fld_Date,103) = '''''+@Fld_Date+''''' and fld_server = '''''+@server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin  
--\CTCL_'+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'    
--set @s1= @s+''''                                                                    
              
----print(@s1)                                    
--exec(@s1)            
  
if @flag='1'  
begin        
 SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New         
 where Convert(varchar(11),Fld_Date,103) = @Fld_Date and fld_server = @server        
end                                 
  
  
if @flag='2'  
begin                                     
 select distinct fld_gen,ID=row_number() over(order by fld_gen) into #tmp         
 from               
  mis.upload.DBO.tbl_gen_odin_file_New with(nolock)              
  where Convert(varchar(11),Fld_Date,103)=@Fld_Date        
  and fld_server = @server        
          
          
  ;WITH         
 cteReason AS        
 (--==== Split the REASON_TYPE and include the EmpID and the position the data was in        
   -- as an "ElementNumber" so we can rejoin with the correct REASON.        
  SELECT ROW_NUMBER() OVER (PARTITION BY ID   ORDER BY t.Number  ) AS ElementNumber,        
   ID,fld_gen,        
   Identifier  = SUBSTRING(','+s.fld_gen, t.Number+1, CHARINDEX(',', s.fld_gen+',', t.Number+1)-t.Number)        
    FROM Master.dbo.spt_Values t        
   RIGHT OUTER JOIN --Necessary in case SomeCsv is NULL        
   #Tmp s         
   ON SUBSTRING(','+s.fld_gen, t.Number, 1) = ','         
  AND t.Number BETWEEN 1 AND LEN(','+s.fld_gen)        
  AND t.Type = 'P'  --Identifies rows with numbers from 0 to 2047        
 )        
 --===== Join each REASON with its corresponding REASON_TYPE        
 SELECT r.ID,fld_gen, r.ElementNumber,r.Identifier        
 into #Tmp2        
 FROM cteReason r        
         
 select a.fld_gen from         
  (SELECT fld_gen, [1],[2],[3]as odin,[4],[5],[6],@server as server        
  FROM         
  (SELECT fld_gen, ElementNumber, Identifier        
  FROM #Tmp2) p        
  PIVOT        
  (        
  max(Identifier)        
  FOR ElementNumber IN ([1],[2],[3],[4],[5],[6])        
  ) AS pvt)a        
          
  left outer join intranet.[ctcl1.1].dbo.TBL_TERMINAL_BLOCKING b with(nolock)        
  on a.server=(case when b.fld_server='AKRUTI DIET CLIENT (66)' then 'AKRUTI CLIENT (66)' else b.fld_server end) and  a.odin=b.fld_termid        
  where ISNULL(b.fld_termid,'')=''        
          
 ORDER BY a.fld_gen        
               
 end                                
                                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CTCL_UserMaintaince_OdinFile_new_30052018
-- --------------------------------------------------
Create Proc [dbo].[USP_CTCL_UserMaintaince_OdinFile_new_30052018](@flag as varchar(2),@server as varchar(25),@fld_date as varchar(11),@serveradd as varchar(30))                                                          
as                                                
set nocount on                                               
declare @s as varchar(8000)                                    
declare @s1 as varchar(8000)                                    
declare @file as varchar(500)                             
declare @@server as varchar(25)                                   
--declare @Fld_Date as varchar(11)                                    
                                    
if(@server='AKRUTI DIET CLIENT (66)')
Begin
	set @server='AKRUTI CLIENT (66)'
End
print @server
set @fld_date = convert(varchar(11),@fld_date)                                  
                              
--set @file = ltrim(rtrim(replace(@server,' ','')))+'.txt'        
                        
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New where Convert(varchar(11),Fld_Date,103) = '''''+@Fld_Date+''''' and fld_server = '''''+@server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin  
--\CTCL_'+@file+' -c -Sintranet -Usa -Pnirwan612'    
--set @s1= @s+''''                                                                    
              
----print(@s1)                                    
--exec(@s1)            
  
if @flag='1'  
begin        
 SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map_New         
 where Convert(varchar(11),Fld_Date,103) = @Fld_Date and fld_server = @server        
end                                 
  
  
if @flag='2'  
begin                                     
 select distinct fld_gen,ID=row_number() over(order by fld_gen) into #tmp         
 from               
  mis.upload.DBO.tbl_gen_odin_file_New with(nolock)              
  where Convert(varchar(11),Fld_Date,103)=@Fld_Date        
  and fld_server = @server        
          
          
  ;WITH         
 cteReason AS        
 (--==== Split the REASON_TYPE and include the EmpID and the position the data was in        
   -- as an "ElementNumber" so we can rejoin with the correct REASON.        
  SELECT ROW_NUMBER() OVER (PARTITION BY ID   ORDER BY t.Number  ) AS ElementNumber,        
   ID,fld_gen,        
   Identifier  = SUBSTRING(','+s.fld_gen, t.Number+1, CHARINDEX(',', s.fld_gen+',', t.Number+1)-t.Number)        
    FROM Master.dbo.spt_Values t        
   RIGHT OUTER JOIN --Necessary in case SomeCsv is NULL        
   #Tmp s         
   ON SUBSTRING(','+s.fld_gen, t.Number, 1) = ','         
  AND t.Number BETWEEN 1 AND LEN(','+s.fld_gen)        
  AND t.Type = 'P'  --Identifies rows with numbers from 0 to 2047        
 )        
 --===== Join each REASON with its corresponding REASON_TYPE        
 SELECT r.ID,fld_gen, r.ElementNumber,r.Identifier        
 into #Tmp2        
 FROM cteReason r        
         
 select a.fld_gen from         
  (SELECT fld_gen, [1],[2],[3]as odin,[4],[5],[6],@server as server        
  FROM         
  (SELECT fld_gen, ElementNumber, Identifier        
  FROM #Tmp2) p        
  PIVOT        
  (        
  max(Identifier)        
  FOR ElementNumber IN ([1],[2],[3],[4],[5],[6])        
  ) AS pvt)a        
          
  left outer join intranet.[ctcl1.1].dbo.TBL_TERMINAL_BLOCKING b with(nolock)        
  on a.server=(case when b.fld_server='AKRUTI DIET CLIENT (66)' then 'AKRUTI CLIENT (66)' else b.fld_server end) and  a.odin=b.fld_termid        
  where ISNULL(b.fld_termid,'')=''        
          
 ORDER BY a.fld_gen        
               
 end                                
                                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_daily_turnover
-- --------------------------------------------------
CREATE procedure dbo.Usp_daily_turnover(@fdate as varchar(11),@tdate as varchar(11),@segment as varchar(11),@access_to as varchar(11),@access_code as varchar(11))          
AS          
--declare @date as varchar(20),@segment as varchar(10),@entered_by as varchar(15)          
--set @date='12/05/1985'          
--set @segment='BSE'          
--set @entered_by='E15318'          
--insert into tbl_master_daily_turnover           
--select @entered_by,getdate(),@date,@segment,date,exchange_volumes,delivery,trading,total,          
--delievery_per_angel,total_margin,bank_guarantee,cash_deposite,FDR,shares,total_capital          
--from tbl_MISDaily_turnover_trade_details   
--declare @fdate as varchar(11),@tdate as varchar(11),@segment as varchar(10)
--set @fdate='01/07/2009'
--set @tdate= '31/07/2009'
--set @segment='bse'      
set nocount on        
 SELECT [Date],[exchange_volumes],[delivery],[trading],[total],[delievery_per_angel] , [txtsegment] , [total_margin] , [bank_guarantee], [cash_deposite] , [FDR], [shares], [total_capital]        
FROM [tbl_master_daily_turnover]         
WHERE ((convert(datetime,txtdate,103) >= convert(datetime,@fdate,103)) AND (convert(datetime,txtdate,103) <= convert(datetime,@tdate,103)) AND ([txtsegment] LIKE @segment)) order by [Date],[txtsegment]        
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DELETE_TICKER_IMG_UPLOAD
-- --------------------------------------------------
/******************************************************************************    
CREATED BY: RUTVIJ PATIL    
DATE: 20/09/2010    
PURPOSE: USE TO DELETE DATA INTO TABLE TICKER_IMG_UPLOAD  
    
MODIFIED BY: PROGRAMMER NAME    
DATED: DD/MM/YYYY    
REASON: REASON TO CHANGE STORE PROCEDURE    
******************************************************************************/    
    
CREATE PROCEDURE USP_DELETE_TICKER_IMG_UPLOAD  
     
 @ANGEL_TICKER_ID INT -- USE TO STORE PRIMARY KEY    
    
AS    
BEGIN    
    
 DELETE FROM TICKER_IMG_UPLOAD     
 WHERE ANGEL_TICKER_ID = @ANGEL_TICKER_ID  
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DELETE_TR_IMAGE_UPLOAD
-- --------------------------------------------------
/******************************************************************************        
CREATED BY: RUTVIJ PATIL        
DATE: 18/11/2010        
PURPOSE: USE TO DELETE DATA INTO TABLE TR_IMAGE_UPLOAD      
        
MODIFIED BY: PROGRAMMER NAME        
DATED: DD/MM/YYYY        
REASON: REASON TO CHANGE STORE PROCEDURE        
******************************************************************************/        
        
CREATE PROCEDURE [DBO].[USP_DELETE_TR_IMAGE_UPLOAD]  
         
 @IMAGE_UPLOAD_ID INT  
        
AS        
BEGIN        
        
 DELETE FROM TR_IMAGE_UPLOAD      
 WHERE IMAGE_UPLOAD_ID = @IMAGE_UPLOAD_ID  
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DELETE_TR_IMG_UPLOAD
-- --------------------------------------------------

/******************************************************************************
CREATED BY: RUTVIJ PATIL
DATE: 20/09/2010
PURPOSE: USE TO DELETE DATA INTO TABLE TR_IMG_UPLOAD

MODIFIED BY: PROGRAMMER NAME
DATED: DD/MM/YYYY
REASON: REASON TO CHANGE STORE PROCEDURE
******************************************************************************/

CREATE PROCEDURE USP_DELETE_TR_IMG_UPLOAD
	
	@IMG_UPLOAD_ID INT -- USE TO STORE PRIMARY KEY

AS
BEGIN

	DELETE FROM TR_IMG_UPLOAD 
	WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_deleteRepliCTCLid
-- --------------------------------------------------
CREATE Procedure USP_deleteRepliCTCLid
(
@filename as varchar(100)
,@server as varchar(25)
)    
AS    
declare @path as varchar(100)                        
declare @sql as varchar(1000)                     
-- set @filename = 'IT_Events'                
delete from intranet.[CTCL1.1].dbo.tbl_deleteRepliCTCLid              
--'\\'+ @server +'
set @path='\d$\upload1\ctcl\'+  @filename    
SET @SQL = 'insert into intranet.[CTCL1.1].dbo.tbl_deleteRepliCTCLid select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'     
--print @SQL    
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DPJV
-- --------------------------------------------------
CREATE Proc USP_DPJV        
as        
      
--------------------------------------      
truncate table tbl_BseDPJV      
truncate table tbl_NseDPJV      
--------------------BSE---------------        
select * into #cltMaster from DPBACKOFFICE.acercross.dbo.client_master x  where cm_brcode not in         
(000019,000337,000392) and exists        
(        
select cl_code from anand.bsedb_ab.dbo.client5 y where InactiveFrom > getdate() and cl_code <> ''        
and x.cm_blsavingcd = y.cl_code        
)        
        
select * into #bse from        
(        
select '1~'++replace(convert(varchar(11),getdate(),111),'/','')+'~VILASN~' as BSE        
union all        
select '1~'+ltrim(rtrim(convert(varchar,x.cm_cd)))+'~'+        
ltrim(rtrim(convert(varchar,left(x.cm_cd,8))))+'~'+ltrim(rtrim(cm_blsavingcd))+'~D~'+convert(varchar,DPLEDBAL)+'~'+replace(convert(varchar(11),getdate(),111),'/','')+'~'+        
'Being the Dp charges as on '+convert(varchar(11),getdate(),106)+' for the client id '+ltrim(rtrim(convert(varchar,x.cm_cd)))+' charged to client code '+ltrim(rtrim(cm_blsavingcd))+'~'        
from        
(select *  from #cltMaster)x        
inner join        
(select * from DPBACKOFFICE.acercross.dbo.Angel_V_DpBal where DPLEDBAL <> 0  and DPLEDBAL > 0)y        
on x.cm_cd = y.cm_cd        
) x        
       
insert into tbl_BseDPJV  
Select * from #bse  
------------------NSE------------------        
select * into #cltNSEMaster from DPBACKOFFICE.acercross.dbo.client_master x  where cm_brcode not in         
(000019,000337,000392) and exists        
(        
select cl_code from anand1.msajag.dbo.client5 y where InactiveFrom > getdate() and cl_code <> ''        
and x.cm_blsavingcd = y.cl_code        
)        
        
select * into #nsejv from #cltNSEMaster x where not exists        
(        
select * from #cltMaster y where x.cm_blsavingcd = y.cm_blsavingcd        
)        
        
select * into #nse from        
(        
select '1~'++replace(convert(varchar(11),getdate(),111),'/','')+'~VILASN~' as NSE        
union all        
select '1~'+ltrim(rtrim(convert(varchar,x.cm_cd)))+'~'+        
ltrim(rtrim(convert(varchar,left(x.cm_cd,8))))+'~'+ltrim(rtrim(cm_blsavingcd))+'~D~'+convert(varchar,DPLEDBAL)+'~'+replace(convert(varchar(11),getdate(),111),'/','')+'~'+        
'Being the Dp charges as on '+convert(varchar(11),getdate(),106)+' for the client id '+ltrim(rtrim(convert(varchar,x.cm_cd)))+' charged to client code '+ltrim(rtrim(cm_blsavingcd))+'~'        
from        
(select *  from #nsejv)x        
inner join        
(select * from DPBACKOFFICE.acercross.dbo.Angel_V_DpBal where DPLEDBAL <> 0  and DPLEDBAL > 0)y        
on x.cm_cd = y.cm_cd        
) x        
      
insert into tbl_NseDPJV  
Select * from #nse  
--------------------------------------------------------------------------------      
--Select * from tbl_NseDPJV      
--Select * from tbl_BseDPJV      
----------------------------------------------------------------------------------      
Declare @bs as varchar(1000)                        
Declare @bs1 as varchar(1000)                        
Declare @ns as varchar(1000)                        
Declare @ns1 as varchar(1000)                        
Declare @file as varchar(50)                        
Declare @file1 as varchar(50)       
      
set @file = (select replace(convert(varchar,getdate(),6),' ','')+'BSEJV'+'.txt')                        
set @file1 = (select replace(convert(varchar,getdate(),6),' ','')+'NSEJV'+'.txt')      
      
set @bs = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select bse from upload..tbl_BseDPJV (nolock)" queryout \\INHOUSEALLAPP-FS.angelone.in\D$\upload1\NSE_BSE_JV\'+@file+' -c'                                                                                      
set @bs1= @bs+''''      
--print @bs1      
exec(@bs1)      
      
set @ns = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select nse from upload..tbl_NseDPJV(nolock)" queryout \\INHOUSEALLAPP-FS.angelone.in\D$\upload1\NSE_BSE_JV\'+@file1+' -c'                  
set @ns1= @ns+''''      
--print @ns1      
exec(@ns1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_EBrok_insert
-- --------------------------------------------------
CREATE procedure Usp_EBrok_insert(@filename as varchar(35))      
AS   
  
delete from ebrok_trade_file  where date in (select date from ebrok_trade_file_temp)

insert into ebrok_trade_file   
select getdate(),Date,EUser,EGroup,Exchange_Code,MemberId,TraderId,Instrument_Type,Instrument_Name,  
Scrip_code,Symbol,Spread_Symbol,Ser_Exp_Group,Strike_Price,Option_Type,Scrip_Name,Order_Type,B_S,Quantity,  
Price,Spread_Price,Spread,Pro_Cli,Client,Client_Name=replace(Client_Name,'',''),Exch_Order_No,Trade_No,time,Settlor,User_Remarks,  
New_Client,Part_Type,Product_Type,Order_Entry_Time,Client_Order_No  
from ebrok_trade_file_temp  

/*
delete from terminalmaster.dbo.ebroking_trades where convert(varchar(11),dcurrenttime,103)
 in (select top 1 date from ebrok_trade_file_temp) and serverip='172.31.15.65'

insert into terminalmaster.dbo.ebroking_trades
select '172.31.15.65',Symbol=rtrim(ltrim(Symbol)),Scrip_code=rtrim(ltrim(Scrip_code)),Quantity=rtrim(ltrim(Quantity)),
Price=rtrim(ltrim(convert(money,Price))),
rtrim(ltrim(convert(varchar(35),Trade_No))),b_s=case when b_s='B' then 1 else 2 end,rtrim(ltrim(Exch_Order_No)),'','','',
exchange_code=case when rtrim(ltrim(exchange_code))='BSE' then 8 
when rtrim(ltrim(exchange_code))='NSE' then 1
when rtrim(ltrim(exchange_code))='FO' then  2
when rtrim(ltrim(exchange_code))='MCX' then 16
when rtrim(ltrim(exchange_code))='NCDEX' then 64
when rtrim(ltrim(exchange_code))='MCXSX' then 1024
 end,rtrim(ltrim(Client_Name)),
rtrim(ltrim(convert(datetime,Date))),
rtrim(ltrim(Product_Type)),rtrim(ltrim(EUser)),
rtrim(ltrim(Instrument_Name)),'',rtrim(ltrim(Strike_Price)),
rtrim(ltrim(Option_Type))
from 
ebrok_trade_file
  where rtrim(ltrim(pro_cli))='CLI' and date in (select top 1 date from ebrok_trade_file_temp)

*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Fetch_Data
-- --------------------------------------------------
Create Proc Usp_Fetch_Data (@clientcode varchar(15))
As

Select branch_cd,sub_broker,clientcode,clientname from tbl_clientdata_record where clientcode =  @clientcode
union
Select branch_cd,sub_broker,clientcode,clientname from tbl_ControlFileClientLetter where clientcode =  @clientcode

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Find_Table
-- --------------------------------------------------
Create Proc Usp_Find_Table(@Name as varchar(50),@Type as Char(1))
as

Create TABLE #tblDBObjects 
(
dbName sysname,
objName varchar(200),
objtype char(2)
)
Declare @sqlstr as nvarchar(200)
Select @sqlstr = 'sp_msforeachdb ''Insert #tblDBObjects select ''''?'''' as DBName, name, xtype From ?..sysobjects'''
Exec sp_executesql @sqlstr
Select * From #tblDBObjects Where objname like @Name and objtype = @Type

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_findinJobs
-- --------------------------------------------------

Create Procedure usp_findinJobs(@Str as varchar(500))  
as  
select b.name,  
Case when b.enabled=1 then 'Active' else 'Deactive' end as Status,  
date_created,date_modified,a.step_id,a.step_name,a.command  
from msdb.dbo.sysjobsteps a, msdb.dbo.sysjobs b  
where command like '%'+@Str+'%'  
and a.job_id=b.job_id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_findInUSP
-- --------------------------------------------------
CREATE PROCEDURE usp_findInUSP    
@dbname varchar(500),  
@srcstr varchar(500)    
AS    
    
 set nocount on  
 set @srcstr  = '%' + @srcstr + '%'    
  
 declare @str as varchar(1000)  
 set @str=''  
 if @dbname <>''  
 Begin  
 set @dbname=@dbname+'.dbo.'  
 End  
 else  
 begin  
 set @dbname=db_name()+'.dbo.'  
 End  
 print @dbname  
  
 set @str='select O.name,O.xtype from '+@dbname+'sysComments  C '   
 set @str=@str+' join '+@dbname+'sysObjects O on O.id = C.id '   
 set @str=@str+' where O.xtype in (''P'',''V'') and C.text like '''+@srcstr+''''    
 --print @str  
  exec(@str)  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FOMARGINUPLOADCSV
-- --------------------------------------------------
CREATE PROC USP_FOMARGINUPLOADCSV               
(              
@filename as varchar(100),
@server as varchar(30)              
)               
as                  
--print @filename      
set transaction  isolation  level read uncommitted                  
delete  from  mis.FOBKG.dbo.FO_margin              
declare @path as varchar(200)              
declare @sql as varchar(1000)              
--set @path='G:\MIS\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
set @path='\\'+@server+'\D$\upload1\Fovar_margin\' + @filename              
--print @filename      
--print @path      
      
SET @SQL = 'BULK INSERT mis.FOBKG.dbo.FO_margin FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'              
print @SQL              
--exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_functions_findInUSP
-- --------------------------------------------------
create PROCEDURE usp_functions_findInUSP
@str varchar(500)
AS

	set @str = '%' + @str + '%'
	
	select O.name from sysComments  C
	join sysObjects O on O.id = C.id
	where O.xtype = 'P' and C.text like @str

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Gen_CTCL_FailedOrder
-- --------------------------------------------------
CREATE Proc Usp_Gen_CTCL_FailedOrder (@Val as varchar(15))                   
As                    
                 
declare @str as varchar(1000)                
                 
Truncate Table tbl_FailedCodes              
                    
Set @Str = 'Insert into tbl_FailedCodes'                    
Set @Str = @Str+' Select Client from tbl_ctcl_'+@Val+'_failed group by Client having Count(*) > 4;'               
Exec (@Str)                   
                    
Declare @Code as Varchar(20)                    
Declare Ctcl_Order Cursor for Select * from tbl_FailedCodes  where client is not null Order by Client                                     
                                    
Open Ctcl_Order                                     
Fetch Next from Ctcl_Order into @Code                    
                                        
While @@FETCH_STATUS = 0                                        
Begin                                        
 Set @Str = ' If Exists(Select * from tbl_ctcl_'+@Val+'_chatmsg(nolock) where Description like ''%' + @Code + '%'')'                    
 Set @Str = @Str+' Delete from tbl_FailedCodes where Client = '''+@Code+''''                    
 Exec(@Str)                                        
Fetch Next from Ctcl_Order into @Code                    
End                                        
                                        
Close Ctcl_Order                                        
Deallocate Ctcl_Order                        
             
Set @Str = ' Select * from tbl_ctcl_'+@Val+'_failed where Client in (Select Client from tbl_FailedCodes) order by Client;'              
Set @Str = @Str + ' Select [User ID],Count(*) Cnt from tbl_ctcl_'+@Val+'_failed group by [User ID] Order by Cnt desc;'            
Set @Str = @Str + ' Select Client,count(distinct Replace(substring(reason,charindex(''='',reason)+1,charindex('','',reason)-charindex(''='',reason)-1),'' '','''')) Cnt into #t from tbl_ctcl_'+@Val+'_failed'            
Set @Str = @Str + ' where reason like ''Margin_%'' group by client;'             
Set @Str = @Str + ' Select * from tbl_ctcl_'+@Val+'_failed(nolock) where Client in (Select Client from #t Where Cnt > 1) Order by Client'            
     
    
--Print(@Str)        
Exec(@Str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Gen_IPO_File
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Gen_IPO_File](@Type as varchar(20))        
as        
        
truncate table tbl_import_ipo        
        
if @Type = 'CLIENTMASTER'        
Begin         
        
 insert into tbl_import_ipo        
 select left(replace(rtrim(ltrim(party_code)),'|',''),20)+'|'+        
 left(replace(rtrim(ltrim(long_name)),'|',''),25)+'|'+        
 left(replace(rtrim(ltrim(l_address1)),'|',''),50)+'|'+        
 left(replace(rtrim(ltrim(l_address2)),'|',''),50)+'|'+        
 left(replace(rtrim(ltrim(l_address3)),'|',''),50)+'|'+        
 left(replace(rtrim(ltrim(l_city))+' '+rtrim(ltrim(l_zip)),'|',''),50)+'|'+        
 left(replace(rtrim(ltrim(cl_type)),'|',''),5)+'|'+        
 ltrim(rtrim(left(case when DpID1 is null then DpID2 when DpID2 is null then DpID3 else DpID1 end,8)))+'|'+        
 ltrim(rtrim(left(case when cltdpid1 is null then cltdpid2 when cltdpid2 is null then cltdpid3 else cltdpid1 end,16)))+'|'+'A'+'|'+        
 left(replace(rtrim(ltrim(pan_gir_no)),'|',''),20)+'|'+        
 --left(replace(rtrim(ltrim(bsecm)),'|',''),20)+'|'+        
 case when bsecm is null then 'NSE' else 'BSE' end +'|'+        
 left(replace(rtrim(ltrim(lower(email))),'|',''),100)+'|'+rtrim(ltrim(branch_cd))+'|'+ltrim(rtrim(sub_broker))  
 from intranet.risk.dbo.client_details where party_code <> '' and long_name <> '' and cl_type <> '' and (bsecm = 'Y' or NSECM = 'Y')        
 and party_code in (select USERID from intranet.risk.dbo.tbl_mf WHERE USERID not in        
 (select Fld_Code from tbl_IPO_Code))       
         
 insert into tbl_IPO_Code        
 select party_code from intranet.risk.dbo.client_details where party_code <> '' and long_name <> '' and cl_type <> '' and (bsecm = 'Y' or NSECM = 'Y')        
 and party_code in (select USERID from intranet.risk.dbo.tbl_mf WHERE  USERID not in        
 (select Fld_Code from tbl_IPO_Code))        
        
end    

if @Type = 'SUBBROKERMASTER'  
BEGIN

INSERT INTO tbl_import_ipo
SELECT DISTINCT 'S'+','+RTRIM(LTRIM(SUB_BROKER))+','+RTRIM(LTRIM(NAME)) FROM INTRANET.RISK.DBO.SUBBROKERS
WHERE SUB_BROKER NOT IN (SELECT Fld_Branch_Code FROM tbl_SB_Code)


INSERT INTO tbl_SB_Code
SELECT RTRIM(LTRIM(SUB_BROKER)) FROM INTRANET.RISK.DBO.SUBBROKERS
WHERE SUB_BROKER NOT IN (SELECT Fld_Branch_Code FROM tbl_SB_Code)

END

if @Type = 'CLIENTMASTER'            
        
begin        
 insert into tbl_import_ipo        
 select rtrim(ltrim(branch_code))+'|'+rtrim(ltrim(branch))+'|'+rtrim(ltrim(Address1))+'|'+rtrim(ltrim(Address2))+'|'+rtrim(ltrim(city))+'|'+rtrim(ltrim(state))+'|'+'A'+'|'+'Y'+'|'+'Y'+'|'+email from intranet.risk.dbo.branches        
         
 insert into tbl_Branch_Code        
 select branch_code from intranet.risk.dbo.branches where branch_code not in (select * from tbl_Branch_Code)        
end         
        
Declare @s as varchar(1000)        
Declare @s1 as varchar(1000)        
        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_IPO FROM mis.upload.DBO.tbl_import_ipo" queryout '+'d:\upload1\'+@Type+'.csv -c -SMis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
set @s1= @s+''''                                       
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Gen_ODin_File
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Gen_ODin_File](@server as varchar(100))                        
as                  
                  
declare @s as varchar(500)                          
declare @s1 as varchar(500)                          
declare @date as varchar(15)                              
declare @file as varchar(50)                              
                  
--set @file = @server+(select replace(convert(varchar(11),getdate(),112),'/',''))+'.txt'                               
set @file = @server+'.txt'            
    
            
select *, space(10) as A,space(10) as B,             
space(10) as C,space(10) as D,space(10) as E,space(100) as Odin_id,space(100) as server            
into #t from Tbl_ODin     
    
delete from #t where branch = 'ACM' and subbroker = 'acm'    
            
update #t set Odin_id = case when charindex(',',termid) = 0 then termid else substring(termid,0, charindex(',',termid)) end  from #t            
            
update #t set A = NSE            
update #t set B = BSE            
update #t set C = FO            
update #t set D = NCDX            
update #t set E = MCX            
            
update #t set server = b.branch_name from View_Odin_mast b where Odin_Id = b.ctcl_OdinId and b.Ctcl_Status in ('A','Y')            
            
update #t set NSE = 1 where NSE = 'YES' or NSE = 'NEW'                  
update #t set NSE = 0 where NSE = 'NO'                  
                  
update #t set BSE = 8 where BSE = 'YES' or BSE = 'NEW'                  
update #t set BSE = 0 where BSE = 'NO'                  
                  
update #t set FO = 2 where FO = 'YES' or FO = 'NEW'                  
update #t set FO = 0 where FO = 'NO'                  
                  
update #t set MCX = 16 where MCX = 'YES' or MCX = 'NEW'                  
update #t set MCX = 0 where MCX = 'NO'                   
                  
update #t set NCDX = 64 where NCDX = 'YES' or  NCDX = 'NEW'                  
update #t set NCDX = 0 where NCDX =  'NO'                   
                  
truncate table Odin_Clt_Map                  
            
select * into #t1 from #t where server = @server            
                  
insert into Odin_Clt_Map                  
select case when A+B+C+D+E like '%yes%' then '2' else '1' end +'|'+rtrim(ltrim(Party_code))+'|'+rtrim(ltrim(case when branch = b.fld_Branch_name then b.Fld_Branch_id else branch end))+'|'+rtrim(ltrim(party_name))+'|'+'|'+'2'+'|'                
+'['+ case when charindex(',',termid) = 0 then termid else left(replace(termid,',','-'), charindex(',',termid)+charindex(',',substring(termid,charindex(',',termid)+1,10))+charindex(',',substring(termid,charindex(',',termid)+        
charindex(',',substring(termid,charindex(',',termid)+1,10))+1,10))-1) end +']'+'|'+'|'+'|'+'|'+'|'+'|'+'|'+'A'+'|'+'0'+'|'+'1'+'|'+'0'+'|'+'0'+'|'+'|'+'|'+'|'+'|'+'|'+convert(varchar,convert(int,nse)+convert(int,bse)+        
convert(int,fo)+convert(int,ncdx)+convert(int,mcx))+'|'+'1'+'|'+'1'+'|'+'|'+'|'+'|'+'|'+rtrim(ltrim(Party_code))+'|'+'|'+'0'+'|'+'0'+'|'+'0'+'|'+'0'+'|'+'0'+'|'+'0'+'|'+'|'+'|'+'|'+'|'+'|'+        
rtrim(ltrim(case when branch = b.fld_Branch_name then b.Fld_Group_Name else branch end))+                  
'|'+'|'+'|'+convert(varchar,convert(int,nse)+convert(int,bse)+convert(int,fo)+convert(int,ncdx)+convert(int,mcx))+'|'+'|'+                  
'0'+'|'+'0'+'|'+'0'+'|'+'0'+'|'+'|'+'|'+'|'+'|'+'Margin'+'|'                   
from #t1 a (nolock) left outer join tbl_admin b (nolock)  on a.branch = b.fld_Branch_name and  b.Fld_Server_Name = @server                   
            
                  
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT odin FROM INTRANET.[ctcl1.1].DBO.Odin_Clt_Map" queryout D:\upload1\Odin\CTCL_'+@file+' -c -Sintranet -Usa -Pnirwan612'                                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT odin FROM INTRANET.[ctcl1.1].DBO.Odin_Clt_Map" queryout D:\upload1\Odin\'+rtrim(ltrim(@file))+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                             
set @s1= @s+''''                                              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Gen_ODin_File_1
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Gen_ODin_File_1](@server as varchar(25),@Fld_Date as varchar(11),@serveradd as varchar(30))                
as                
                
declare @s as varchar(500)                                            
declare @s1 as varchar(5000)                                            
declare @file as varchar(50)                  
              
set @file = 'ClientMap_'+@server+'.txt'                                                    
              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select distinct fld_gen from mis.upload.dbo.tbl_gen_odin_file where Fld_Date = '''''+@Fld_Date+''''' and Fld_Server = '''''+@Server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\'+rtrim(ltrim(@file))
+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'               
                                                       
set @s1= @s+''''                                                              
--print @s1              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Gen_ODin_File_1_New
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Gen_ODin_File_1_New](@server as varchar(25),@Fld_Date as varchar(11),@serveradd as varchar(30),@status as varchar(30))                      
as                      
                      
declare @s as varchar(500)                                                  
declare @s1 as varchar(5000)                                                  
declare @file as varchar(50)                        
                    
set @file = 'ClientMap_'+@server+@status+'.txt'                                                          
                    
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select distinct fld_gen from mis.upload.dbo.tbl_gen_odin_file where Fld_Date = '''''+@Fld_Date+''''' and Fld_Server = '''''+@Server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\'+rtrim(ltrim(@file))+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                     
                                                             
set @s1= @s+''''                                                                    
--print @s1                    
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Generate_DNC_File
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Generate_DNC_File](@filename as varchar(50))                
as            
            
truncate table tbl_upld_DNC            
truncate table Tbl_DNC_File            
            
declare @path as varchar(100)            
declare @SQL as varchar(200)            
            
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename                                  
SET @SQL = 'BULK INSERT tbl_upld_DNC FROM '''+@Path+''' WITH (FIELDTERMINATOR = ''\n'', FirstRow=2,KeepNULLS)'                         
exec (@sql)             
                
insert into Tbl_DNC_File                
select 'C_INDEX'+','+'LAN_LIN_1'+','+'LAN_LIN_2'+','+'MOB_NUM_1'+','+'MOB_NUM_2'+','+'CUS_CTY'+','+'LAN_STD_1'+','+'LAN_STD_2'+','+'EMAIL_1'+','+'EMAIL_2'+','+'PIN_COD'                   
            
SELECT DISTINCT rtrim(ltrim(replace(Fld_NAME,'  ','')))as Fld_NAME,            
CASE WHEN LEN(Fld_Office) = 7 THEN '2'+Fld_Office end as phone1,                
case WHEN LEN(Fld_Office) = 6 THEN '22'+Fld_Office end as phone2,                   
case WHEN LEN(Fld_Office) = 10 THEN Fld_Office end as mobile            
into #x         
FROM Tbl_NDNC_File WHERE                 
Fld_Msg in (select Fld_upld from tbl_upld_DNC)            
            
insert into Tbl_DNC_File            
select Fld_Name+','+isnull(phone1,'')+','+isnull(phone2,'')+','+isnull(mobile,'')+','+''+','+''+','+''+','+''+','+''+','+''+','+'' from #x where (phone1 <> '' or phone2 <> '' or mobile <> '')          
                
declare @s as varchar(5000)                
declare @s1 as varchar(5000)                
                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_Msg FROM mis.UPLOAD.DBO.Tbl_DNC_File" queryout '+'\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\DNC.txt -c -SMis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                      
set @s1= @s+''''                                               
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Generate_DNC_NDNC_File
-- --------------------------------------------------
CREATE Proc USP_Generate_DNC_NDNC_File(@filename as varchar(50))          
as          
          
/*          
SELECT           
OFFICE_PHONE,          
CHARINDEX('/',OFFICE_PHONE),           
SUBSTRING(OFFICE_PHONE,0,CHARINDEX('/',OFFICE_PHONE))           
FROM #T          
          
SELECT * FROM #T WHERE OFFICE_PHONE NOT IN          
(          
SELECT * FROM #T WHERE           
OFFICE_PHONE LIKE '%/%' OR          
OFFICE_PHONE LIKE '%-%' OR          
OFFICE_PHONE LIKE '%,%' OR          
OFFICE_PHONE LIKE '%.%' OR           
OFFICE_PHONE LIKE '%''%'          
)AND ISNUMERIC(OFFICE_PHONE) = 0          
*/          
          
declare @path as varchar(50)          
declare @SQL as varchar(500)          
        
         
truncate table NDNC               
truncate table Tbl_NDNC_File              
      
                    
set @path='\\INHOUSEALLAPP-FS.angelone.in\D$\upload1\' + @filename         
SET @SQL = 'BULK INSERT NDNC FROM '''+@Path+''' WITH (FIELDTERMINATOR = ''\t'', FirstRow=2,KeepNULLS)'                            
-- print @SQL                            
exec (@sql)                
      
-------------NDNC-------------------          
SELECT * INTO #T FROM          
(          
SELECT NAME,OFFICE_PHONE FROM NDNC WHERE LEN(OFFICE_PHONE) > 7          
UNION ALL          
SELECT NAME,MOBILE_PHONE FROM NDNC WHERE LEN(MOBILE_PHONE) > 7          
UNION ALL          
SELECT NAME,RES_PHONE FROM NDNC WHERE LEN(RES_PHONE) > 7          
) X          
          
insert into Tbl_NDNC_File          
SELECT DISTINCT CASE           
WHEN LEN(OFFICE_PHONE) = 9 THEN '2'+OFFICE_PHONE          
WHEN LEN(OFFICE_PHONE) = 8 THEN '22'+OFFICE_PHONE          
WHEN LEN(OFFICE_PHONE) = 7 THEN '222'+OFFICE_PHONE           
ELSE OFFICE_PHONE END,NAME,OFFICE_PHONE FROM #T WHERE ISNUMERIC(OFFICE_PHONE) = 1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECN
-- --------------------------------------------------
CREATE Proc [dbo].[USP_GENERATE_ECN]                
as                
                
truncate table tbl_ECN                
                
insert into tbl_ECN                


select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                 
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                  
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+               
case     
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'Nri@angeltrade.com;'+rtrim(ltrim(cl_code))+'@ecn.sify.com'     
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(replace(replace(email + ';Nri@angeltrade.com;'+rtrim(ltrim(cl_code))+'@ecn.sify.com',',',''),'|',''),'"','')))    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(replace(replace(email+';'+rtrim(ltrim(cl_code))+'@ecn.sify.com',',',''),'|',''),'"','')))    
end +'|'+'1'+'|'+' '+'|'+rtrim(ltrim(pan_gir_no))                 
from AngelNseCM.msajag.dbo.client_details where isnumeric(cl_code)  = 0 and cl_code in                
(                
select distinct cl_code from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                
)              
union              
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                 
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                  
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))                
end+'|'+               
case     
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'Nri@angeltrade.com;'+rtrim(ltrim(cl_code))+'@ecn.sify.com'     
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''     
--when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(replace(replace(email + ';Nri@angeltrade.com',',',''),'|',''),'"',''))) 
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(replace(replace(email + ';Nri@angeltrade.com;'+rtrim(ltrim(cl_code))+'@ecn.sify.com',',',''),'|',''),'"','')))    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(replace(replace(email+';'+rtrim(ltrim(cl_code))+'@ecn.sify.com',',',''),'|',''),'"','')))    
end    
    
/*case when Repatriat_bank_ac_no not like 'ECN%' then '' else Case when cl_status = 'nri' then rtrim(ltrim(replace(replace(replace(email + ';Nri@angeltrade.com',',',''),'|',''),'"',''))) else rtrim(ltrim(replace(replace(replace(email,',',''),'|',''),'"','
'))) end end  */  
    
    
+'|'+'1'+'|'+' '+'|'+rtrim(ltrim(pan_gir_no))                 
from AngelNseCM.msajag.dbo.client_details where isnumeric(cl_code)  = 0 and cl_code in                
(                
select distinct cl_code from AngelNseCM.msajag.dbo.client_details_log where Edit_on >= convert(varchar(11),getdate()-7)  and  Edit_on <= convert(varchar(11),getdate()) + ' 23:59:59'  and isnumeric(cl_code)  = 0                  
)     
                
Declare @s as varchar(1000)                
Declare @s1 as varchar(1000)                
Declare @file as varchar(50)                
                
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.csv')                
                
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM mis.upload.DBO.tbl_ECN" queryout D:\upload1\'+@file+' -c'        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN(nolock)" queryout D:\upload1\'+@file+' -c'                                                                              
set @s1= @s+''''                                          
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECN_NEW
-- --------------------------------------------------
  
CREATE Proc [dbo].[USP_GENERATE_ECN_NEW]   
(  
@server as varchar(50)  
)                                     
as                     
                
 select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,  
  Repatriat_bank_ac_no,email,pan_gir_no,modifidedon  
  into #tempClientDetails from AngelNseCM.msajag.dbo.client_details  with(nolock)     
    
  Select Cl_code,Active_date into #AllBrokData from AngelNseCM.msajag.dbo.client_Brok_details  with(Nolock) where Inactive_From>Getdate()                   
          
          
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'   
  
truncate table #Sify     
                                                        
select distinct cl_code into #CltBrok from #AllBrokData   
where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')  and cl_code not like '98%'  
                        
select distinct cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log   
where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and cl_code not like '98%'                        
                 
                      
--select distinct  x.cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x                         
--left outer join intranet.risk.dbo.client_details z with(nolock)                        
--on z.party_code = x.cl_code                        
--where x.modifidedon >= convert(varchar(11),getdate()-7) and                         
--x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                              
--and z.last_inactive_date > = GETDATE()                        
                        
select distinct  x.cl_code into #Cltdetails from #tempClientDetails x                         
left outer join #AllBrokData z with(nolock)                        
on z.cl_code = x.cl_code                        
where x.modifidedon >= convert(varchar(11),getdate()-7) and                         
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                              
                 
                        
select * into #yahoocode from ecn_yahoo_partycode                         
                                            
select * into #cltcode from                                                    
(                                                    
select * from #CltBrok                                                    
union                                                    
select * from #CltBrokLog                                              
union                                              
select * from #Cltdetails                                            
)x                                            
    
                                
  
select x.* into #Cltdetails7days from #tempClientDetails x with(nolock)                                 
inner join  #cltcode y                         
on x.cl_code=y.cl_code where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%'   
  
delete from #Cltdetails7days where cl_code not in (select cl_code from #AllBrokData)  
                              
--left outer join intranet.risk.dbo.client_details z with(nolock)                        
--on z.party_code = x.cl_code                        
--where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%' and z.last_inactive_date > = GETDATE()                        
                        
/*-------------------------------Sify CLients----------------------------------------------------- */                                        
                        
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                                     
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                                      
and x.party_code not like '98%'                                            
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                                    
                        
   truncate table #S                     
               
                        
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                         
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                            
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''     
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                      
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                            
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                             
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                         
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                                        
when (x.cl_code = y.party_code) then ''                            
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                    
into #temp  from                                             
(                                            
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                                  
select * from #Cltdetails7days x where exists                                           
(                                            
select * from  #cltcode y where x.cl_code = y.cl_code                                                        
)                                            
)x                                            
left outer join                                                            
(select * from #Sify) y                                                        
on x.cl_code = y.party_code               
              
          
                                            
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                             
                                            
delete from #temp where cl_code in (select * from #yahoocode)                           
                                           
/*select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                            
union                                            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */            
            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no  into #temp3 from #temp2                                            
union                                            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                           
                                        
                                        
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                             
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                            
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                             
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                            
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                                    
when (x.cl_code = y.party_code) then ''                          
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                              
into #tempS  from                                             
(                  
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                                  
select * from #Cltdetails7days x where exists           
(                                            
select * from  #S y where x.cl_code = y.party_code                                                        
)                                            
)x                                            
left outer join                                  
(select * from #Sify) y                                                        
on x.cl_code = y.party_code                                             
                                            
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                            
                                            
delete from #tempS where cl_code in (select * from #yahoocode)                                             
/*                                            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                            
union                                            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                            
                                            
*/                                            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no  into #temp5 from #temps2                                            
union                                            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                            
            
            
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                                            
union                                             
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                                            
                               
                               
---Aravind 12/12/2012 for email in sid for non-ecn                  
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join                   
AngelNseCM.msajag.dbo.client_details bo with (nolock)                  
on #TEMPECN.cl_code=bo.cl_code                   
where bo.Repatriat_bank_ac_no  not like 'ECN%' */                  
                 
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''                 
update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                   
AngelNseCM.msajag.dbo.client_details bo with (nolock)                  
on #TEMPECN.cl_code=bo.cl_code                   
where                 
bo.Repatriat_bank_ac_no='' and #TEMPECN.sid like '%sify%'                
              
              
update #TEMPECN set #TEMPECN.sid=''   from               
tbl_SecondaryEmailBypass t with (nolock)              
where t.cl_code=#TEMPECN.cl_code                                             
          
update #TEMPECN set #TEMPECN.sid=''    
update #TEMPECN set #TEMPECN.pid=''  where pid like '%@Ecn.Sify.Com'         
                 
--end                           
                 
         
                                         
                                            
truncate table tbl_ECN_new                                                                          
insert into tbl_ECN_new                                              
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                          
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                                              
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                             
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                              
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                     
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                               
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                    
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+pid +'|'+sid+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))         
                                                        
from  #TEMPECN T with(nolock) left outer join ABVSKYCMIS.kyc.dbo.tbl_Ecnreference TE on T.cl_code = TE.client_code              
              
      
        
    
                                            
Declare @s as varchar(1000)                             
Declare @s1 as varchar(1000)                                                                      
Declare @file as varchar(50)                                                                              
                                                                              
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                        
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                    
 
    
      
        
          
            
              
                
                                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
                                
set @s1= @s+''''                                                          
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECN_NEW_Bak
-- --------------------------------------------------
CREATE Proc [dbo].[USP_GENERATE_ECN_NEW_Bak]                      
as     
     
truncate table tbl_ECN_new    
    
insert into tbl_ECN_new    
    
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                      
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                      
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                      
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                      
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                      
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                       
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                        
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+  
case           
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then '' /*'|' +rtrim(ltrim(cl_code))+'@ecn.sify.com'*/           
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))          
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))end  
+'|'+  
case           
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))  
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))end   
+'|'+'1'+'|'+rtrim(ltrim(pan_gir_no))                       
from AngelNseCM.msajag.dbo.client_details where isnumeric(cl_code)  = 0 and cl_code in                      
(                      
select distinct cl_code from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                      
)     
union    
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                      
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                      
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                      
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                      
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                      
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                       
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                        
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))    
end+'|'+                     
case           
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''  
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))          
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))           
end +'|'+  
case           
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then  'nri@angeltrade.com'                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))         
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))      
end+'|'+'1'+'|'+rtrim(ltrim(pan_gir_no))                       
from AngelNseCM.msajag.dbo.client_details where isnumeric(cl_code)  = 0 and cl_code in                      
(                      
select distinct cl_code from AngelNseCM.msajag.dbo.client_details_log where Edit_on >= convert(varchar(11),getdate()-7)  and  Edit_on <= convert(varchar(11),getdate()) + ' 23:59:59'  and isnumeric(cl_code)  = 0                        
)    
    
Declare @s as varchar(1000)                      
Declare @s1 as varchar(1000)                      
Declare @file as varchar(50)                      
                      
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                      
                      
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM mis.upload.DBO.tbl_ECN" queryout D:\upload1\'+@file+' -c'              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout D:\upload1\'+@file+' -c'                                                                                    
set @s1= @s+''''                                                
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW
-- --------------------------------------------------
                        
--USP_GENERATE_ECNFILE_NEW_aravind      '172.29.19.10'                                   
                              
-- [USP_GENERATE_ECNFILE_NEW] '196.1.115.147'                              
                                         
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW]                                                 
(                        
@server as varchar(50)                        
)                                                                                                  
as                                                                      
      
  Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,                        
  Repatriat_bank_ac_no,email,pan_gir_no,modifidedon                        
  into #tempClientDetails from AngelNseCM.msajag.dbo.client_details  with(nolock)                           
                          
Select Cl_code,Active_date into #AllBrokData from AngelNseCM.msajag.dbo.client_Brok_details  with(Nolock) where Inactive_From>Getdate()          
                                
                               
--Select Party_Code into #Sify from intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                         
      
  Select '' as Party_Code into #Sify                      
  Truncate table #Sify                           
                                                                              
Select distinct Cl_code into #CltBrok from #AllBrokData                         
where     
Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                        
and     
    
Cl_code not like '98%'                        
                                              
Select distinct Cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log                         
where Active_Date >= convert(varchar(11),getdate()-7)                       
and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and Cl_code not like '98%'                                              
                                       
                                            
--Select distinct  x.Cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x                                               
--left outer join intranet.risk.dbo.client_details z with(nolock)                                              
--on z.party_code = x.Cl_code                                              
--where x.modifidedon >= convert(varchar(11),getdate()-7) and                                               
--x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.Cl_code not like '98%'                                                                    
--and z.last_inactive_date > = GETDATE()                                              
                                              
Select distinct  x.Cl_code into #Cltdetails from #tempClientDetails x                                               
left outer join #AllBrokData z with(nolock)                                              
on z.Cl_code = x.Cl_code                                              
where x.modifidedon >= convert(varchar(11),getdate()-7) and                                               
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.Cl_code not like '98%'          
                                       
                                              
Select * into #yahoocode from ecn_yahoo_partycode                                               
                                                                  
Select * into #cltcode from                                                                          
(                                                                          
Select * from #CltBrok                                                                          
union         
Select * from #CltBrokLog                                                                    
union                                          
Select * from #Cltdetails                                                                  
)x                                                 
                          
          
                        
Select x.* into #Cltdetails7days from #tempClientDetails x with(nolock)                                      
inner join  #cltcode y                                               
on x.Cl_code = y.Cl_code where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%'                         
                        
Delete from #Cltdetails7days where Cl_code not in (Select Cl_code from #AllBrokData)                        
                                                    
--left outer join intranet.risk.dbo.client_details z with(nolock)                                              
--on z.party_code = x.Cl_code                                              
--where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%' and z.last_inactive_date > = GETDATE()                                              
                         
/*-------------------------------Sify CLients----------------------------------------------------- */                                   
                                              
Select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                                                           
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                                                            
and x.party_code not like '98%'                                                                  
and not exists (Select * from #cltcode  y where x.party_code = y.Cl_code)                                                                          
                                              
   Truncate table #S                                           
                                     
                                              
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                                               
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                                  
case                 
--when ISNULL(Email,'') <>'' and Cl_code like 'ZR_%' then ''                           
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code not like 'ZR_%' then ''                                            
--when ISNULL(Email,'') <>'' and Cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                                  
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,                                                   
case when ISNULL(Email,'') ='' and Cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                               
when (x.Cl_code = y.party_code) then ((rtrim(ltrim(Cl_code))+'@ecn.sify.com'))                                                                              
when (x.Cl_code = y.party_code) then ''                                                  
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                          
into #temp  from                                                                   
(                                                                  
--Select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(Cl_code)  = 0 and exists                                                        
Select * from #Cltdetails7days x where exists                                                                 
(                   
Select * from  #cltcode y where x.Cl_code = y.Cl_code                                                                              
)                         
)x                                                 
left outer join                                                                                  
(Select * from #Sify) y                                                             
on x.Cl_code = y.party_code                                     
                                    
                        
                                                                  
Select * into #temp2  from #temp where Cl_code in (Select * from #yahoocode)        
                                                                  
Delete from #temp where Cl_code in (Select * from #yahoocode)                                  
                                                                 
/*Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no           
 into #temp3 from #temp2                                                                  
union                     
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */                                  
                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no           
 into #temp3 from #temp2                                                                  
union                                                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp        
                                                              
                                                              
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                                                   
        
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                                  
case                 
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code like 'ZR_%' then ''                                                                  
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code not like 'ZR_%' then ''                                                                   
--when ISNULL(Email,'') <>'' like 'ECN%' and Cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                                  
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                                                  
when ISNULL(Email,'') ='' and Cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                                                          
when (x.Cl_code = y.party_code) then ''                                                
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                                                    
into #tempS  from                                                                   
(                                        
--Select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(Cl_code)  = 0 and exists                                                        
Select * from #Cltdetails7days x where exists                                 
(                                                                  
Select * from  #S y where x.Cl_code = y.party_code                                                                              
)                            
)x                                                                  
left outer join                                                        
(Select * from #Sify) y                                            
on x.Cl_code = y.party_code                                                                
                                                                  
Select * into #temps2 from #tempS where Cl_code in (Select * from #yahoocode)                                                
                                                                  
Delete from #tempS where Cl_code in (Select * from #yahoocode)                                                                   
/*                                                                 
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no         
 into #temp5 from #temps2                                                                  
union                                                 
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                                                  
                
*/                                                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no                        
into #temp5 from #temps2                                              
union                                                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no                       
from #temps                                                                  
                                  
                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,                      
pan_gir_no into #TEMPECN from #temp3                                                                  
union                                                                   
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,                      
pan_gir_no from #temp5                                                     
                                                     
                                                     
---Aravind 12/12/2012 for email in sid for non-ecn                                        
/*Update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join                                         
AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
on #TEMPECN.Cl_code=bo.Cl_code                                         
where bo.Repatriat_bank_ac_no  not like 'ECN%' */                                        
                                       
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''                                       
--Update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                                         
--AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
--on #TEMPECN.Cl_code=bo.Cl_code                                         
--where                                       
--bo.Repatriat_bank_ac_no=''                       
--and #TEMPECN.sid like '%sify%'                         
          
      Alter table #TEMPECN Add Category varchar(2)    
     
     
          
     
  -- code commented by amit on 24/11/2015 flag 1 stands for ECn and 2 stands for non ecn     
          
  Update #TEMPECN set Category=case when ISNULL(bo.Repatriat_bank_ac_no,'') like 'ECN%' then '1' else '2' end    
  from #TEMPECN  inner join                                         
AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
on #TEMPECN.Cl_code = bo.Cl_code      
    
-- deleting record for bounce log for non ecn clients    
    
  Update #TEMPECN set pid='',sid='' where pid in (select Email from tbl_email_Bounce_Log) and Category='2'    
    
         
          
                      
--Update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                                         
--AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
--on #TEMPECN.Cl_code = bo.Cl_code                                         
-- where bo.Repatriat_bank_ac_no not like 'ECN%' or #TEMPECN.sid like '%@ECn.sify.com%'                    
--This has been modified as per Dharmesh 06/03/2014.  Non Ecn client email ID Blank               
                                   
                                    
                                    
Update #TEMPECN set #TEMPECN.sid=''   from                                     
tbl_SecondaryEmailBypass t with (nolock)                                    
where t.Cl_code = #TEMPECN.Cl_code                                                                   
                                
Update #TEMPECN set #TEMPECN.sid='' where Cl_code not like 'ZR%'                         
Update #TEMPECN set #TEMPECN.pid='' where pid like '%@Ecn.Sify.Com'                               
                  
     
     
           
                                       
--end                                                 
                                       
                     
            
                                                                  
Truncate table tbl_ECN_new        
                                                                                                
Insert into tbl_ECN_new                                         
Select rtrim(ltrim(Cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                                                
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                     
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                                   
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                                                    
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                                          
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                                                     
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                                  
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))        
end+'|'+ltrim(rtrim(isnull(pid,''))) +'|'+ltrim(rtrim(isnull(sid,'')))+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))       
+ '|'+ Category                               
                                                                              
from  #TEMPECN T with(nolock) left outer join ABVSKYCMIS.kyc.dbo.tbl_Ecnreference TE on T.Cl_code = TE.client_code                                    
                                    
                            
                              
                          
                                                                  
Declare @s as varchar(1000)                                                   
Declare @s1 as varchar(1000)                                                                                            
Declare @file as varchar(50)              
                                                                                                    
set @file = (Select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                                              
                                                                                                     
                                                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "Select Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\upload1\'+@file+' -c -SABVSMIS.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                 
   
                                                      
set @s1= @s+''''                                                                                
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_10Apr2020
-- --------------------------------------------------
                    
--USP_GENERATE_ECNFILE_NEW_aravind      '172.29.19.10'                               
                          
-- [USP_GENERATE_ECNFILE_NEW] '196.1.115.183'                          
                                     
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_10Apr2020]                                             
(                    
@server as varchar(50)                    
)                                                                                              
as                                                                  
  
  Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,                    
  Repatriat_bank_ac_no,email,pan_gir_no,modifidedon                    
  into #tempClientDetails from anand1.msajag.dbo.client_details  with(nolock)                       
                      
Select Cl_code,Active_date into #AllBrokData from anand1.msajag.dbo.client_Brok_details  with(Nolock) where Inactive_From>Getdate()      
                            
                           
--Select Party_Code into #Sify from intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                     
  
  Select '' as Party_Code into #Sify                  
  Truncate table #Sify                       
                                                                          
Select distinct Cl_code into #CltBrok from #AllBrokData                     
where 
Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                    
and 

Cl_code not like '98%'                    
                                          
Select distinct Cl_code  into #CltBrokLog from anand1.msajag.dbo.client_Brok_details_log                     
where Active_Date >= convert(varchar(11),getdate()-7)                   
and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and Cl_code not like '98%'                                          
                                   
                                        
--Select distinct  x.Cl_code into #Cltdetails from anand1.msajag.dbo.client_details x                                           
--left outer join intranet.risk.dbo.client_details z with(nolock)                                          
--on z.party_code = x.Cl_code                                          
--where x.modifidedon >= convert(varchar(11),getdate()-7) and                                           
--x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.Cl_code not like '98%'                                                                
--and z.last_inactive_date > = GETDATE()                                          
                                          
Select distinct  x.Cl_code into #Cltdetails from #tempClientDetails x                                           
left outer join #AllBrokData z with(nolock)                                          
on z.Cl_code = x.Cl_code                                          
where x.modifidedon >= convert(varchar(11),getdate()-7) and                                           
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.Cl_code not like '98%'      
                                   
                                          
Select * into #yahoocode from ecn_yahoo_partycode                                           
                                                              
Select * into #cltcode from                                                                      
(                                                                      
Select * from #CltBrok                                                                      
union                                                                      
Select * from #CltBrokLog                                                                
union                                           
Select * from #Cltdetails                                                              
)x                                             
                      
      
                    
Select x.* into #Cltdetails7days from #tempClientDetails x with(nolock)                                  
inner join  #cltcode y                                           
on x.Cl_code = y.Cl_code where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%'                     
                    
Delete from #Cltdetails7days where Cl_code not in (Select Cl_code from #AllBrokData)                    
                                                
--left outer join intranet.risk.dbo.client_details z with(nolock)                                          
--on z.party_code = x.Cl_code                                          
--where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%' and z.last_inactive_date > = GETDATE()                                          
                     
/*-------------------------------Sify CLients----------------------------------------------------- */                               
                                          
Select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                                                       
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                                                        
and x.party_code not like '98%'                                                              
and not exists (Select * from #cltcode  y where x.party_code = y.Cl_code)                                                                      
                                          
   Truncate table #S                                       
                                 
                                          
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                                           
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                              
case             
--when ISNULL(Email,'') <>'' and Cl_code like 'ZR_%' then ''                       
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code not like 'ZR_%' then ''                                        
--when ISNULL(Email,'') <>'' and Cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                              
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,                                               
case when ISNULL(Email,'') ='' and Cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                           
when (x.Cl_code = y.party_code) then ((rtrim(ltrim(Cl_code))+'@ecn.sify.com'))                                                                          
when (x.Cl_code = y.party_code) then ''                                              
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                      
into #temp  from                                                               
(                                                              
--Select * from anand1.msajag.dbo.client_details x where isnumeric(Cl_code)  = 0 and exists                                                    
Select * from #Cltdetails7days x where exists                                                             
(                                                              
Select * from  #cltcode y where x.Cl_code = y.Cl_code                                                                          
)                     
)x                                                              
left outer join                                                                              
(Select * from #Sify) y                                                         
on x.Cl_code = y.party_code                                 
                                
                    
                                                              
Select * into #temp2  from #temp where Cl_code in (Select * from #yahoocode)    
                                                              
Delete from #temp where Cl_code in (Select * from #yahoocode)                              
                                                             
/*Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no       
 into #temp3 from #temp2                                                              
union                 
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */                              
                              
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no       
 into #temp3 from #temp2                                                              
union                                                              
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp    
                                                          
                                                          
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                                               
    
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                              
case             
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code like 'ZR_%' then ''                                                              
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code not like 'ZR_%' then ''                                                               
--when ISNULL(Email,'') <>'' like 'ECN%' and Cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                              
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                                              
when ISNULL(Email,'') ='' and Cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                                                      
when (x.Cl_code = y.party_code) then ''                                            
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                                                
into #tempS  from                                                               
(                                    
--Select * from anand1.msajag.dbo.client_details x where isnumeric(Cl_code)  = 0 and exists                                                    
Select * from #Cltdetails7days x where exists                             
(                                                              
Select * from  #S y where x.Cl_code = y.party_code                                                                          
)                                                              
)x                                                              
left outer join                                                    
(Select * from #Sify) y                                        
on x.Cl_code = y.party_code                                                               
                                                              
Select * into #temps2 from #tempS where Cl_code in (Select * from #yahoocode)                                            
                                                              
Delete from #tempS where Cl_code in (Select * from #yahoocode)                                                               
/*                                                             
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no     
 into #temp5 from #temps2                                                              
union                                             
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                                              
            
*/                                                              
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no                    
into #temp5 from #temps2                                          
union                                                              
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no                   
from #temps                                                              
                              
                              
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,                  
pan_gir_no into #TEMPECN from #temp3                                                              
union                                                               
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,                  
pan_gir_no from #temp5                                                 
                                                 
                                                 
---Aravind 12/12/2012 for email in sid for non-ecn                                    
/*Update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join                                     
anand1.msajag.dbo.client_details bo with (nolock)                                    
on #TEMPECN.Cl_code=bo.Cl_code                                     
where bo.Repatriat_bank_ac_no  not like 'ECN%' */                                    
                                   
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''                                   
--Update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                                     
--anand1.msajag.dbo.client_details bo with (nolock)                                    
--on #TEMPECN.Cl_code=bo.Cl_code                                     
--where                                   
--bo.Repatriat_bank_ac_no=''                   
--and #TEMPECN.sid like '%sify%'                     
      
      Alter table #TEMPECN Add Category varchar(2)
 
 
      
 
  -- code commented by amit on 24/11/2015 flag 1 stands for ECn and 2 stands for non ecn 
      
  Update #TEMPECN set Category=case when ISNULL(bo.Repatriat_bank_ac_no,'') like 'ECN%' then '1' else '2' end
  from #TEMPECN  inner join                                     
anand1.msajag.dbo.client_details bo with (nolock)                                    
on #TEMPECN.Cl_code = bo.Cl_code  

-- deleting record for bounce log for non ecn clients

  Update #TEMPECN set pid='',sid='' where pid in (select Email from tbl_email_Bounce_Log) and Category='2'

     
      
                  
--Update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                                     
--anand1.msajag.dbo.client_details bo with (nolock)                                    
--on #TEMPECN.Cl_code = bo.Cl_code                                     
-- where bo.Repatriat_bank_ac_no not like 'ECN%' or #TEMPECN.sid like '%@ECn.sify.com%'                
--This has been modified as per Dharmesh 06/03/2014.  Non Ecn client email ID Blank           
                               
                                
                                
Update #TEMPECN set #TEMPECN.sid=''   from                                 
tbl_SecondaryEmailBypass t with (nolock)                                
where t.Cl_code = #TEMPECN.Cl_code                                                               
                            
Update #TEMPECN set #TEMPECN.sid='' where Cl_code not like 'ZR%'                     
Update #TEMPECN set #TEMPECN.pid='' where pid like '%@Ecn.Sify.Com'                           
              
 
 
       
                                   
--end                                             
                                   
                 
        
                                                              
Truncate table tbl_ECN_new    
                                                                                            
Insert into tbl_ECN_new                                     
Select rtrim(ltrim(Cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                                            
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                 
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                               
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                                                
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                                      
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                                                 
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                              
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))    
end+'|'+ltrim(rtrim(isnull(pid,''))) +'|'+ltrim(rtrim(isnull(sid,'')))+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))   
+ '|'+ Category                           
                                                                          
from  #TEMPECN T with(nolock) left outer join kyc.dbo.tbl_Ecnreference TE on T.Cl_code = TE.client_code                                
                                
                        
                          
                      
                                                              
Declare @s as varchar(1000)                                               
Declare @s1 as varchar(1000)                                                                                        
Declare @file as varchar(50)                                                
                                                                                                
set @file = (Select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                                          
                                                                                                 
                                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "Select Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -S196.1.115.167 -Uinhouse -Pinh6014'                                                
                                                  
set @s1= @s+''''                                                                            
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_Allfile
-- --------------------------------------------------
                        
--USP_GENERATE_ECNFILE_NEW_aravind      '172.29.19.10'                                   
                              
-- exec [USP_GENERATE_ECNFILE_NEW_Allfile] '196.1.115.183'                              
                                         
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_Allfile]                                                 
(                        
 @server as varchar(50)                        
)                                                                                                  
as                                                                      
      
  Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,                        
  Repatriat_bank_ac_no,email,pan_gir_no,modifidedon                        
  into #tempClientDetails from AngelNseCM.msajag.dbo.client_details  with(nolock)                           
                          
Select Cl_code,Active_date into #AllBrokData from AngelNseCM.msajag.dbo.client_Brok_details  with(Nolock)        
                                
                               
Select Party_Code into #Sify from intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                         
                        
Truncate table #Sify                           
                                                                              
Select distinct Cl_code into #CltBrok from #AllBrokData                         
where     
Cl_code not like '98%'                        
                                              
Select distinct Cl_code  into #CltBrokLog from   #AllBrokData                                          
                                            
                                              
Select distinct  x.Cl_code into #Cltdetails from #tempClientDetails x                                               
left outer join #AllBrokData z with(nolock)                                              
on z.Cl_code = x.Cl_code                                              
where x.Cl_code not like '98%'          
                                       
             
         Select * into #yahoocode from ecn_yahoo_partycode                                       
                                                                  
Select * into #cltcode from                                                                          
(                                                                          
Select * from #CltBrok                                                                          
union                                                                          
Select * from #CltBrokLog                                                                    
union                                                                    
Select * from #Cltdetails                                                                  
)x                                                 
                          
          
                        
Select x.* into #Cltdetails7days from #tempClientDetails x with(nolock)                                      
inner join  #cltcode y                                               
on x.Cl_code = y.Cl_code where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%'                         
                        
--Delete from #Cltdetails7days where Cl_code not in (Select Cl_code from #AllBrokData)                        
                                                    
--left outer join intranet.risk.dbo.client_details z with(nolock)                                              
--on z.party_code = x.Cl_code                                              
--where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%' and z.last_inactive_date > = GETDATE()                                              
                         
/*-------------------------------Sify CLients----------------------------------------------------- */   
                                              
Select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                                                           
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                                                            
and x.party_code not like '98%'                                                                  
and not exists (Select * from #cltcode  y where x.party_code = y.Cl_code)                                                                          
                                              
   Truncate table #S                                           
                                     
                                              
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                                               
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                                  
case                 
--when ISNULL(Email,'') <>'' and Cl_code like 'ZR_%' then ''                           
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code not like 'ZR_%' then ''                                            
--when ISNULL(Email,'') <>'' and Cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                                  
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,                                                   
case when ISNULL(Email,'') ='' and Cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                               
when (x.Cl_code = y.party_code) then ((rtrim(ltrim(Cl_code))+'@ecn.sify.com'))                                                                              
when (x.Cl_code = y.party_code) then ''                                                  
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                          
into #temp  from                                                                   
(                                                                  
--Select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(Cl_code)  = 0 and exists                                                        
Select * from #Cltdetails7days x where exists                                                                 
(                                                                  
Select * from  #cltcode y where x.Cl_code = y.Cl_code                                                                              
)                                                                  
)x                                                                  
left outer join                                                                                  
(Select * from #Sify) y                                                             
on x.Cl_code = y.party_code                                     
                                    
                        
                                                                  
Select * into #temp2  from #temp where Cl_code in (Select * from #yahoocode)        
     
   Delete from #temp where Cl_code in (Select * from #yahoocode)       
      
                             
                                                                 
/*Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no           
 into #temp3 from #temp2                                                                  
union                     
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */                                  
                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no           
 into #temp3 from #temp2                                                                  
union                                                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp        
                                                              
                                                              
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                                                   
        
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                                  
case                 
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code like 'ZR_%' then ''                                                                  
--when Repatriat_bank_ac_no not like 'ECN%' and Cl_code not like 'ZR_%' then ''                                                                   
--when ISNULL(Email,'') <>'' like 'ECN%' and Cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                                  
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                                                  
when ISNULL(Email,'') ='' and Cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                                                          
when (x.Cl_code = y.party_code) then ''                                                
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                                                    
into #tempS  from                                                                   
(                                        
--Select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(Cl_code)  = 0 and exists                                                        
Select * from #Cltdetails7days x where exists                                 
(                                                                  
Select * from  #S y where x.Cl_code = y.party_code                                                                              
)                                                                  
)x                                                                  
left outer join                                                        
(Select * from #Sify) y                                                                              
on x.Cl_code = y.party_code                                                                   
                                                                  
Select * into #temps2 from #tempS where Cl_code in (Select * from #yahoocode)                                                
                                                                  
Delete from #tempS where Cl_code in (Select * from #yahoocode)                                                                   
/*                                                                 
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no         
 into #temp5 from #temps2                                                                  
union                                                 
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                     
                
*/                                                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no                        
into #temp5 from #temps2                                           
union                                                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no                       
from #temps                                                                  
                                  
                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,                      
pan_gir_no into #TEMPECN from #temp3                                                                  
union                                                                   
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,                      
pan_gir_no from #temp5                                                     
                                                     
                                                     
---Aravind 12/12/2012 for email in sid for non-ecn                                        
/*Update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join                                         
AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
on #TEMPECN.Cl_code=bo.Cl_code                                         
where bo.Repatriat_bank_ac_no  not like 'ECN%' */                                        
                                       
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''                                       
--Update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                                         
--AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
--on #TEMPECN.Cl_code=bo.Cl_code                                         
--where                                       
--bo.Repatriat_bank_ac_no=''                       
--and #TEMPECN.sid like '%sify%'                         
          
      Alter table #TEMPECN Add Category varchar(2)    
     
     
          
     
  -- code commented by amit on 24/11/2015 flag 1 stands for ECn and 2 stands for non ecn     
          
  Update #TEMPECN set Category=case when ISNULL(bo.Repatriat_bank_ac_no,'') like 'ECN%' then '1' else '2' end    
  from #TEMPECN  inner join                                         
AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
on #TEMPECN.Cl_code = bo.Cl_code      
    
-- deleting record for bounce log for non ecn clients    
    
  Update #TEMPECN set pid='',sid='' where pid in (select Email from tbl_email_Bounce_Log) and Category='2'    
    
         
          
                      
--Update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                                         
--AngelNseCM.msajag.dbo.client_details bo with (nolock)                                        
--on #TEMPECN.Cl_code = bo.Cl_code                                         
-- where bo.Repatriat_bank_ac_no not like 'ECN%' or #TEMPECN.sid like '%@ECn.sify.com%'                    
--This has been modified as per Dharmesh 06/03/2014.  Non Ecn client email ID Blank               
                                   
                                    
                                    
Update #TEMPECN set #TEMPECN.sid=''   from                                     
tbl_SecondaryEmailBypass t with (nolock)                                    
where t.Cl_code = #TEMPECN.Cl_code                   
                                
Update #TEMPECN set #TEMPECN.sid='' where Cl_code not like 'ZR%'                         
Update #TEMPECN set #TEMPECN.pid='' where pid like '%@Ecn.Sify.Com'                               
                  
     
     
           
                                       
--end                                                 
                                       
          
            
                                                                  
Truncate table tbl_ECN_new        
                                                                                                
Insert into tbl_ECN_new                                         
Select rtrim(ltrim(Cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                                                
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                     
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                                   
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                                                    
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                                          
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                                                     
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                                  
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))        
end+'|'+ltrim(rtrim(isnull(pid,''))) +'|'+ltrim(rtrim(isnull(sid,'')))+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))       
+ '|'+ Category                               
                                                                              
from  #TEMPECN T with(nolock) left outer join ABVSKYCMIS.kyc.dbo.tbl_Ecnreference TE on T.Cl_code = TE.client_code                                    
                                    
                            
                              
                          
                                                                  
Declare @s as varchar(1000)                                                   
Declare @s1 as varchar(1000)                                                                                            
Declare @file as varchar(50)                                                    
                                                                                                    
set @file = (Select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                                              
                                                                                                     
                                                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "Select Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -SABVSMIS.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                              
      
                                                      
set @s1= @s+''''                                                                                
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_ara
-- --------------------------------------------------
--USP_GENERATE_ECNFILE_NEW_aravind                              '172.29.19.10'                
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_ara]                   
(@server as varchar(50) )                                                                    
as                                        
              
select   '              '  Party_Code into #finalclient
  
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%' and party_code in (select party_code from #finalclient)                                                    
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details where cl_code in (select party_code from #finalclient) and cl_code not like '98%'                
select distinct cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log where cl_code in (select party_code from #finalclient) and cl_code not like '98%'                
         
              
select distinct  x.cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x                 
left outer join intranet.risk.dbo.client_details z with(nolock)                
on z.party_code = x.cl_code                
where x.cl_code not like '98%'                                      
and x.cl_code in (select party_code from #finalclient)
                
         
                
select * into #yahoocode from ecn_yahoo_partycode                 
                                    
select * into #cltcode from                                            
(                                            
select * from #CltBrok                                            
union                                            
select * from #CltBrokLog                                      
union                                      
select * from #Cltdetails                                    
)x                                    
                           
select x.* into #Cltdetails7days from AngelNseCM.msajag.dbo.client_details x with(nolock)                         
inner join  #cltcode y                 
on x.cl_code=y.cl_code                        
left outer join intranet.risk.dbo.client_details z with(nolock)                
on z.party_code = x.cl_code                
where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%'                
                
/*-------------------------------Sify CLients----------------------------------------------------- */                                
                
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                             
and x.party_code not like '98%'                                    
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                            
                
                
       
                
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                 
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                    
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                     
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                 
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                                
when (x.cl_code = y.party_code) then ''                    
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no            
into #temp  from                                     
(                                    
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                          
select * from #Cltdetails7days x where exists                                   
(                                    
select * from  #cltcode y where x.cl_code = y.cl_code                                                
)                                    
)x                                    
left outer join                                                    
(select * from #Sify) y                                                
on x.cl_code = y.party_code       
      
  
                                    
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                     
                                    
delete from #temp where cl_code in (select * from #yahoocode)                   
                                   
/*select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */    
    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no  into #temp3 from #temp2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                   
                                
                                
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                     
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                    
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                            
when (x.cl_code = y.party_code) then ''                  
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                      
into #tempS  from                                     
(                                    
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                          
select * from #Cltdetails7days x where exists                         
(                                    
select * from  #S y where x.cl_code = y.party_code                                                
)                                    
)x                                    
left outer join                          
(select * from #Sify) y                                                
on x.cl_code = y.party_code                                     
                                    
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                    
                                    
delete from #tempS where cl_code in (select * from #yahoocode)                                     
/*                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                    
                                    
*/                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no  into #temp5 from #temps2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                    
    
    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                                    
union                                     
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                                    
                       
                       
---Aravind 12/12/2012 for email in sid for non-ecn          
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join           
AngelNseCM.msajag.dbo.client_details bo with (nolock)          
on #TEMPECN.cl_code=bo.cl_code           
where bo.Repatriat_bank_ac_no  not like 'ECN%' */          
         
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''         
update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join           
AngelNseCM.msajag.dbo.client_details bo with (nolock)          
on #TEMPECN.cl_code=bo.cl_code           
where         
bo.Repatriat_bank_ac_no='' and #TEMPECN.sid like '%sify%'        
      
      
update #TEMPECN set #TEMPECN.sid=''   from       
tbl_SecondaryEmailBypass t with (nolock)      
where t.cl_code=#TEMPECN.cl_code                                     
  
  
         
--end                   
         
         
                                 
                                    
truncate table tbl_ECN_new                                                                  
insert into tbl_ECN_new                                      
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                  
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                                      
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                      
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                      
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                      
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                       
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                            
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+pid +'|'+sid+'|'+rtrim(ltrim(pan_gir_no))                                                   
from  #TEMPECN        
      
      
  
      
                                    
Declare @s as varchar(1000)                     
Declare @s1 as varchar(1000)                                                              
Declare @file as varchar(50)                                                                      
                                                                      
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                   
  
    
      
        
                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                      
                        
set @s1= @s+''''                                                  
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_automation
-- --------------------------------------------------
--USP_GENERATE_ECNFILE_NEW_aravind                              '172.29.19.10'                
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_automation]                   
(@server as varchar(50) )                                                                    
as                                        
              
  
  
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                                                    
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')  and cl_code not like '98%'                
select distinct cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and cl_code not like '98%'                
         
              
select distinct  x.cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x                 
left outer join intranet.risk.dbo.client_details z with(nolock)                
on z.party_code = x.cl_code                
where x.modifidedon >= convert(varchar(11),getdate()-7) and                 
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                      
and z.last_inactive_date > = GETDATE()                
                
         
                
select * into #yahoocode from ecn_yahoo_partycode                 
                                    
select * into #cltcode from                                            
(                                            
select * from #CltBrok                                            
union                                            
select * from #CltBrokLog                                      
union                                      
select * from #Cltdetails                                    
)x                                    
                           
select x.* into #Cltdetails7days from AngelNseCM.msajag.dbo.client_details x with(nolock)                         
inner join  #cltcode y                 
on x.cl_code=y.cl_code                        
left outer join intranet.risk.dbo.client_details z with(nolock)                
on z.party_code = x.cl_code                
where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%' and z.last_inactive_date > = GETDATE()                
                
/*-------------------------------Sify CLients----------------------------------------------------- */                                
                
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                             
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                              
and x.party_code not like '98%'                                    
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                            
                
                
       
                
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                 
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                    
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                     
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                 
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                                
when (x.cl_code = y.party_code) then ''                    
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no            
into #temp  from                                     
(                                    
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                          
select * from #Cltdetails7days x where exists                                   
(                                    
select * from  #cltcode y where x.cl_code = y.cl_code                                                
)                                    
)x                                    
left outer join                                                    
(select * from #Sify) y                                                
on x.cl_code = y.party_code       
      
  
                                    
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                     
                                    
delete from #temp where cl_code in (select * from #yahoocode)                   
                                   
/*select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */    
    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no  into #temp3 from #temp2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                   
                                
                                
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                     
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                    
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                            
when (x.cl_code = y.party_code) then ''                  
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                      
into #tempS  from                                     
(                                    
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                          
select * from #Cltdetails7days x where exists                         
(                                    
select * from  #S y where x.cl_code = y.party_code                                                
)                                    
)x                                    
left outer join                          
(select * from #Sify) y                                                
on x.cl_code = y.party_code                                     
                                    
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                    
                                    
delete from #tempS where cl_code in (select * from #yahoocode)                                     
/*                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                    
                                    
*/                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no  into #temp5 from #temps2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                    
    
    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                                    
union                                     
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                                    
                       
                       
---Aravind 12/12/2012 for email in sid for non-ecn          
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join           
AngelNseCM.msajag.dbo.client_details bo with (nolock)          
on #TEMPECN.cl_code=bo.cl_code           
where bo.Repatriat_bank_ac_no  not like 'ECN%' */          
         
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''         
update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join           
AngelNseCM.msajag.dbo.client_details bo with (nolock)          
on #TEMPECN.cl_code=bo.cl_code           
where         
bo.Repatriat_bank_ac_no='' and #TEMPECN.sid like '%sify%'        
      
      
update #TEMPECN set #TEMPECN.sid=''   from       
tbl_SecondaryEmailBypass t with (nolock)      
where t.cl_code=#TEMPECN.cl_code                                     
  
  
         
--end                   
         
         
                                 
                                    
--truncate table tbl_ECN_new                                                                  
--insert into tbl_ECN_new                                      
select rtrim(ltrim(cl_code)) cl_code,rtrim(ltrim(long_name)) long_name,
l_address1 + ' ' + l_address2 + ' ' + l_address3 Address,l_city,case when isnull(res_phone1,'')='' then isnull(res_phone2,'') else isnull(res_phone1,'') end Phone ,pid  [Primary ID],sid [Secondary ID],pan_gir_no
from  #TEMPECN

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_BackUp04022014
-- --------------------------------------------------
        
--USP_GENERATE_ECNFILE_NEW_aravind                              '172.29.19.10'                   
              
-- USP_GENERATE_ECNFILE_NEW_Manish '196.1.115.183'              
                         
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_BackUp04022014]                                 
(        
@server as varchar(50)        
)                                                                                  
as                                                      
  select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,        
  Repatriat_bank_ac_no,email,pan_gir_no,modifidedon        
  into #tempClientDetails from anand1.msajag.dbo.client_details  with(nolock)           
          
  Select Cl_code,Active_date into #AllBrokData from anand1.msajag.dbo.client_Brok_details  with(Nolock) where Inactive_From>Getdate()                         
                
                
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'         
        
truncate table #Sify           
                                                              
select distinct cl_code into #CltBrok from #AllBrokData         
where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')        
and cl_code not like '98%'        
                              
select distinct cl_code  into #CltBrokLog from anand1.msajag.dbo.client_Brok_details_log         
where Active_Date >= convert(varchar(11),getdate()-7)       
and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and cl_code not like '98%'                              
                       
                            
--select distinct  x.cl_code into #Cltdetails from anand1.msajag.dbo.client_details x                               
--left outer join intranet.risk.dbo.client_details z with(nolock)                              
--on z.party_code = x.cl_code                              
--where x.modifidedon >= convert(varchar(11),getdate()-7) and                               
--x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                                    
--and z.last_inactive_date > = GETDATE()                              
                              
select distinct  x.cl_code into #Cltdetails from #tempClientDetails x                               
left outer join #AllBrokData z with(nolock)                              
on z.cl_code = x.cl_code                              
where x.modifidedon >= convert(varchar(11),getdate()-7) and                               
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                                    
                       
                              
select * into #yahoocode from ecn_yahoo_partycode                               
                                                  
select * into #cltcode from                                                          
(                                                          
select * from #CltBrok                                                          
union                                                          
select * from #CltBrokLog                                                    
union                                                    
select * from #Cltdetails                                                  
)x                                                  
          
                                      
        
select x.* into #Cltdetails7days from #tempClientDetails x with(nolock)                                       
inner join  #cltcode y                               
on x.cl_code=y.cl_code where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%'         
        
delete from #Cltdetails7days where cl_code not in (select cl_code from #AllBrokData)        
                                    
--left outer join intranet.risk.dbo.client_details z with(nolock)                              
--on z.party_code = x.cl_code                              
--where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%' and z.last_inactive_date > = GETDATE()                              
         
/*-------------------------------Sify CLients----------------------------------------------------- */                   
                              
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                                           
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                                            
and x.party_code not like '98%'                                                  
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                                          
                              
   truncate table #S                           
                     
                              
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                               
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                  
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''           
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                            
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                  
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                                   
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                               
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                                              
when (x.cl_code = y.party_code) then ''                                  
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                          
into #temp  from                                                   
(                                                  
--select * from anand1.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                                        
select * from #Cltdetails7days x where exists                                                 
(                                                  
select * from  #cltcode y where x.cl_code = y.cl_code                                                              
)                                                  
)x                                                  
left outer join                                                                  
(select * from #Sify) y                                                              
on x.cl_code = y.party_code                     
                    
                
                                                  
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                                   
                                                  
delete from #temp where cl_code in (select * from #yahoocode)                                 
                                                 
/*select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                                  
union                                                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */                  
                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no  into #temp3 from #temp2                                                  
union                                                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                                 
                                              
                                              
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                                   
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                  
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                                  
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                                   
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                                  
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                                  
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                                          
when (x.cl_code = y.party_code) then ''                                
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                                    
into #tempS  from                                                   
(                        
--select * from anand1.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                                        
select * from #Cltdetails7days x where exists                 
(                                                  
select * from  #S y where x.cl_code = y.party_code                                                              
)                                                  
)x                                                  
left outer join                                        
(select * from #Sify) y                                                              
on x.cl_code = y.party_code                                                   
                                                  
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                                  
                                                  
delete from #tempS where cl_code in (select * from #yahoocode)                                                   
/*                                                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                                  
union                                                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                                  
                                                  
*/                                                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no        
into #temp5 from #temps2                                                  
union                                                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no       
from #temps                                                  
                  
                  
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,      
pan_gir_no into #TEMPECN from #temp3                                                  
union                                                   
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,      
pan_gir_no from #temp5                                     
                                     
                                     
---Aravind 12/12/2012 for email in sid for non-ecn                        
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join                         
anand1.msajag.dbo.client_details bo with (nolock)                        
on #TEMPECN.cl_code=bo.cl_code                         
where bo.Repatriat_bank_ac_no  not like 'ECN%' */                        
                       
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''                       
--update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                         
--anand1.msajag.dbo.client_details bo with (nolock)                        
--on #TEMPECN.cl_code=bo.cl_code                         
--where                       
--bo.Repatriat_bank_ac_no=''       
--and #TEMPECN.sid like '%sify%'         
      
      
update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                         
anand1.msajag.dbo.client_details bo with (nolock)                        
on #TEMPECN.cl_code=bo.cl_code                         
where                       
--bo.Repatriat_bank_ac_no=''       
#TEMPECN.sid like '%@ECn.sify.com%'                    
                    
                    
update #TEMPECN set #TEMPECN.sid=''   from                     
tbl_SecondaryEmailBypass t with (nolock)                    
where t.cl_code=#TEMPECN.cl_code                                                   
                
update #TEMPECN set #TEMPECN.sid=''          
update #TEMPECN set #TEMPECN.pid=''  where pid like '%@Ecn.Sify.Com'               
                       
--end                                 
                       
               
                                               
                                                  
truncate table tbl_ECN_new                                                                                
insert into tbl_ECN_new                                                    
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                                
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                                                    
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                   
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                                    
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                           
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                                     
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                          
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+pid +'|'+sid+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))               
                                                              
from  #TEMPECN T with(nolock) left outer join kyc.dbo.tbl_Ecnreference TE on T.cl_code = TE.client_code                    
                    
            
              
          
                                                  
Declare @s as varchar(1000)                                   
Declare @s1 as varchar(1000)                                                                            
Declare @file as varchar(50)                                    
                                                                                    
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                              
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                    
 
    
      
        
          
            
              
                
                  
                    
                      
                                      
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uinhouse -Pinh6014'                                    
                                      
set @s1= @s+''''                                                                
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_bak
-- --------------------------------------------------
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_bak]           
(@server as varchar(50) )                                                
as                    
                
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A'                                 
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                                                  
select distinct cl_code into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                                                  
select distinct cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details where modifidedon >= convert(varchar(11),getdate()-7) and modifidedon <= convert(varchar(11),getdate() + ' 23:59:59')                  
select *  into #yahoocode  from ecn_yahoo_partycode                 
                
select * into #cltcode from                        
(                        
select * from #CltBrok                        
union                        
select * from #CltBrokLog                  
union                  
select * from #Cltdetails                
)x                
       
select x.* into #Cltdetails7days from AngelNseCM.msajag.dbo.client_details x with(nolock)     
inner join  #cltcode y on x.cl_code=y.cl_code    
where isnumeric(x.cl_code) = 0            
/*-------------------------------Sify CLients----------------------------------------------------- */            
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                         
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                              
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                        
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */             
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                 
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,      
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                        
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                             
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                  
into #temp  from                 
(                
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists      
select * from #Cltdetails7days x where exists               
(                
select * from  #cltcode y where x.cl_code = y.cl_code                            
)                
)x                
left outer join                                
(select * from #Sify) y                            
on x.cl_code = y.party_code                  
                
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                 
                
delete from #temp where cl_code in (select * from #yahoocode)                
               
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                
union                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                
            
            
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                 
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                 
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                        
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                             
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                  
into #tempS  from                 
(                
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists      
select * from #Cltdetails7days x where exists     
(                
select * from  #S y where x.cl_code = y.party_code                            
)                
)x                
left outer join                                
(select * from #Sify) y                            
on x.cl_code = y.party_code                 
                
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                
                
delete from #tempS where cl_code in (select * from #yahoocode)                 
                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                
union                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                
                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                
union                 
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                
                
                
truncate table tbl_ECN_new                                              
insert into tbl_ECN_new                  
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                                  
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                  
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                  
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                  
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                  
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                   
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                                    
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+Sid +'|'+Pid+'|'+rtrim(ltrim(pan_gir_no))                               
from  #TEMPECN                
                
Declare @s as varchar(1000)                                                  
Declare @s1 as varchar(1000)                                          
Declare @file as varchar(50)                                                  
                                                  
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                            
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                   
   
    
      
        
            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uinhouse -Pinh6014'  
    
      
        
set @s1= @s+''''                              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_Manish
-- --------------------------------------------------
--USP_GENERATE_ECNFILE_NEW_aravind                              '172.29.19.10'           
      
-- USP_GENERATE_ECNFILE_NEW_Manish '196.1.115.183'      
                 
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_Manish]                         
(@server as varchar(50) )                                                                          
as                                              
                    
        
        
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                                                          
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')  and cl_code not like '98%'                      
select distinct cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and cl_code not like '98%'                  
    
               
                    
select distinct  x.cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x                       
left outer join intranet.risk.dbo.client_details z with(nolock)                      
on z.party_code = x.cl_code                      
where x.modifidedon >= convert(varchar(11),getdate()-7) and                       
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                            
and z.last_inactive_date > = GETDATE()                      
                      
               
                      
select * into #yahoocode from ecn_yahoo_partycode                       
                                          
select * into #cltcode from                                                  
(                                                  
select * from #CltBrok                                                  
union                                                  
select * from #CltBrokLog                                            
union                                            
select * from #Cltdetails                                          
)x                                          
                                 
select x.* into #Cltdetails7days from AngelNseCM.msajag.dbo.client_details x with(nolock)                               
inner join  #cltcode y                       
on x.cl_code=y.cl_code                              
left outer join intranet.risk.dbo.client_details z with(nolock)                      
on z.party_code = x.cl_code                      
where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%' and z.last_inactive_date > = GETDATE()                      
                      
/*-------------------------------Sify CLients----------------------------------------------------- */                                      
                      
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                                   
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                                    
and x.party_code not like '98%'                                          
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                                  
                      
                      
             
                      
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                       
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                          
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                  
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                          
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                           
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                       
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                                      
when (x.cl_code = y.party_code) then ''                          
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                  
into #temp  from                                           
(                                          
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                                
select * from #Cltdetails7days x where exists                                         
(                                          
select * from  #cltcode y where x.cl_code = y.cl_code                                                      
)                                          
)x                                          
left outer join                                                          
(select * from #Sify) y                                                      
on x.cl_code = y.party_code             
            
        
                                          
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                           
                                          
delete from #temp where cl_code in (select * from #yahoocode)                         
                                         
/*select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                          
union                                          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */          
          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no  into #temp3 from #temp2                                          
union                                          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                         
                                      
                                      
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                           
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                          
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                          
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                          
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                          
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                                  
when (x.cl_code = y.party_code) then ''                        
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                            
into #tempS  from                                           
(                
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                                
select * from #Cltdetails7days x where exists         
(                                          
select * from  #S y where x.cl_code = y.party_code                                                      
)                                          
)x                                          
left outer join                                
(select * from #Sify) y                                                      
on x.cl_code = y.party_code                                           
                                          
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                          
                                          
delete from #tempS where cl_code in (select * from #yahoocode)                                           
/*                                          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                          
union                                          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                          
                                          
*/                                          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no  into #temp5 from #temps2                                          
union                                          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                          
          
          
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                                          
union                                           
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                                          
                             
                             
---Aravind 12/12/2012 for email in sid for non-ecn                
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join                 
AngelNseCM.msajag.dbo.client_details bo with (nolock)                
on #TEMPECN.cl_code=bo.cl_code                 
where bo.Repatriat_bank_ac_no  not like 'ECN%' */                
               
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''               
update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join                 
AngelNseCM.msajag.dbo.client_details bo with (nolock)                
on #TEMPECN.cl_code=bo.cl_code                 
where               
bo.Repatriat_bank_ac_no='' and #TEMPECN.sid like '%sify%'              
            
            
update #TEMPECN set #TEMPECN.sid=''   from             
tbl_SecondaryEmailBypass t with (nolock)            
where t.cl_code=#TEMPECN.cl_code                                           
        
update #TEMPECN set #TEMPECN.sid=''         
               
--end                         
               
               
                                       
                                          
truncate table tbl_ECN_new                                                                        
insert into tbl_ECN_new                                            
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                        
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                                            
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                           
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                            
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                   
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                             
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                  
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+pid +'|'+sid+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))       
                                                      
from  #TEMPECN T with(nolock) left outer join ABVSKYCMIS.kyc.dbo.tbl_Ecnreference TE on T.cl_code = TE.client_code            
            
            
  
                                          
Declare @s as varchar(1000)                           
Declare @s1 as varchar(1000)                                                                    
Declare @file as varchar(50)                                                                            
                                                                            
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                      
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                   
  
    
      
        
          
            
              
                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                            
                              
set @s1= @s+''''                                                        
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_MM
-- --------------------------------------------------
--USP_GENERATE_ECNFILE_NEW_aravind                              '172.29.19.10'                
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_MM]                  
(@server as varchar(50) )                                                                    
as                                        
              
  
  
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                                                    
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')  and cl_code not like '98%'                
select distinct cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and cl_code not like '98%'                
         
              
select distinct  x.cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x                 
left outer join intranet.risk.dbo.client_details z with(nolock)                
on z.party_code = x.cl_code                
where x.modifidedon >= convert(varchar(11),getdate()-7) and                 
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                      
and z.last_inactive_date > = GETDATE()                
                
         
                
select * into #yahoocode from ecn_yahoo_partycode                 
                                    
select * into #cltcode from                                            
(                                            
select * from #CltBrok                                            
union                                            
select * from #CltBrokLog                                      
union                                      
select * from #Cltdetails                                    
)x                                    
                           
select x.* into #Cltdetails7days from AngelNseCM.msajag.dbo.client_details x with(nolock)                         
inner join  #cltcode y                 
on x.cl_code=y.cl_code                        
left outer join intranet.risk.dbo.client_details z with(nolock)                
on z.party_code = x.cl_code                
where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%' and z.last_inactive_date > = GETDATE()                
                
/*-------------------------------Sify CLients----------------------------------------------------- */                                
                
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                             
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                              
and x.party_code not like '98%'                                    
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                            
                
                
       
                
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                 
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                    
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                     
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                 
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                                
when (x.cl_code = y.party_code) then ''                    
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no            
into #temp  from                                     
(                                    
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                          
select * from #Cltdetails7days x where exists                                   
(                                    
select * from  #cltcode y where x.cl_code = y.cl_code                                                
)                                    
)x                                    
left outer join                                                    
(select * from #Sify) y                                                
on x.cl_code = y.party_code       
      
  
                                    
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                     
                                    
delete from #temp where cl_code in (select * from #yahoocode)                   
                                   
/*select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                */    
    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no  into #temp3 from #temp2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                   
                                
                                
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                     
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                    
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                     
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                    
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                    
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                            
when (x.cl_code = y.party_code) then ''                  
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                      
into #tempS  from                                     
(                                    
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                          
select * from #Cltdetails7days x where exists                         
(                                    
select * from  #S y where x.cl_code = y.party_code                                                
)                                    
)x                                    
left outer join                          
(select * from #Sify) y                                                
on x.cl_code = y.party_code                                     
                                    
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                    
                                    
delete from #tempS where cl_code in (select * from #yahoocode)                                     
/*                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                    
                                    
*/                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no  into #temp5 from #temps2                                    
union                                    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                    
    
    
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                                    
union                                     
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                                    
                       
                       
---Aravind 12/12/2012 for email in sid for non-ecn          
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join           
AngelNseCM.msajag.dbo.client_details bo with (nolock)          
on #TEMPECN.cl_code=bo.cl_code           
where bo.Repatriat_bank_ac_no  not like 'ECN%' */          
         
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''         
update #TEMPECN set #TEMPECN.pid='',#TEMPECN.sid=''   from #TEMPECN  inner join           
AngelNseCM.msajag.dbo.client_details bo with (nolock)          
on #TEMPECN.cl_code=bo.cl_code           
where         
bo.Repatriat_bank_ac_no='' and #TEMPECN.sid like '%sify%'        
      
      
update #TEMPECN set #TEMPECN.sid=''   from       
tbl_SecondaryEmailBypass t with (nolock)      
where t.cl_code=#TEMPECN.cl_code                                     
  
  
         
--end                   
         
         
                                 
                                    
truncate table tbl_ECN_new                                                                  
insert into tbl_ECN_new                                      
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                  
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                                      
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                      
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                      
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                      
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                       
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                            
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+pid +'|'+sid+'|'+rtrim(ltrim(pan_gir_no))                                                   
from  #TEMPECN        
      
      
  
      
                                    
Declare @s as varchar(1000)                     
Declare @s1 as varchar(1000)                                                              
Declare @file as varchar(50)                                                                      
                                                                      
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                   
  
    
      
        
                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                      
                        
set @s1= @s+''''                                                  
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW_org
-- --------------------------------------------------
--USP_GENERATE_ECNFILE_NEW '172.29.19.10'            
CREATE Proc [dbo].[USP_GENERATE_ECNFILE_NEW_org]                           
(@server as varchar(50) )                                                                
as                                    
                          
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A' and party_code not like '98%'                                                
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')  and cl_code not like '98%'            
select distinct cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and cl_code not like '98%'            
     
          
select distinct  x.cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details x             
left outer join intranet.risk.dbo.client_details z with(nolock)            
on z.party_code = x.cl_code            
where x.modifidedon >= convert(varchar(11),getdate()-7) and             
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.cl_code not like '98%'                                  
and z.last_inactive_date > = GETDATE()            
            
     
            
select * into #yahoocode from ecn_yahoo_partycode             
                                
select * into #cltcode from                                        
(                                        
select * from #CltBrok                                        
union                                        
select * from #CltBrokLog                                  
union                                  
select * from #Cltdetails                                
)x                                
                       
select x.* into #Cltdetails7days from AngelNseCM.msajag.dbo.client_details x with(nolock)                     
inner join  #cltcode y             
on x.cl_code=y.cl_code                    
left outer join intranet.risk.dbo.client_details z with(nolock)            
on z.party_code = x.cl_code            
where isnumeric(x.cl_code) = 0 and x.cl_code not like '98%' and z.last_inactive_date > = GETDATE()            
            
/*-------------------------------Sify CLients----------------------------------------------------- */                            
            
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'                                         
and SifyActDt >= convert(varchar(11),getdate()-7) and SifyActDt <= convert(varchar(11),getdate() + ' 23:59:59')                                          
and x.party_code not like '98%'                                
and not exists (select * from #cltcode  y where x.party_code = y.cl_code)                                        
            
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                             
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                 
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,                      
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                        
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                                            
when (x.cl_code = y.party_code) then ''                
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no        
into #temp  from                                 
(                                
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                      
select * from #Cltdetails7days x where exists                               
(                                
select * from  #cltcode y where x.cl_code = y.cl_code                                            
)                                
)x                                
left outer join                                                
(select * from #Sify) y                                            
on x.cl_code = y.party_code   
  
  
                                
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)                                 
                                
delete from #temp where cl_code in (select * from #yahoocode)               
                               
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2                                
union                                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp                                
                            
                            
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */                                 
select  cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''                                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''                                 
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))                                
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case                                
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                                        
when (x.cl_code = y.party_code) then ''              
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no                                  
into #tempS  from                                 
(                                
--select * from AngelNseCM.msajag.dbo.client_details x where isnumeric(cl_code)  = 0 and exists                      
select * from #Cltdetails7days x where exists                     
(                                
select * from  #S y where x.cl_code = y.party_code                                            
)                                
)x                                
left outer join                                                
(select * from #Sify) y                                            
on x.cl_code = y.party_code                                 
                                
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)                                
                                
delete from #tempS where cl_code in (select * from #yahoocode)                                 
                                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2                                
union                                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps                                
                                
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3                                
union                                 
select cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'1' as Status,pan_gir_no from #temp5                                
                   
                   
---Aravind 12/12/2012 for email in sid for non-ecn      
/*update #TEMPECN set  #TEMPECN.sid=bo.email from #TEMPECN  inner join       
AngelNseCM.msajag.dbo.client_details bo with (nolock)      
on #TEMPECN.cl_code=bo.cl_code       
where bo.Repatriat_bank_ac_no  not like 'ECN%' */      
     
--Updating blank for sify id deactivation as per Samindhra 19/12/2012 when bo.Repatriat_bank_ac_no=''     
update #TEMPECN set #TEMPECN.pid=''   from #TEMPECN  inner join       
AngelNseCM.msajag.dbo.client_details bo with (nolock)      
on #TEMPECN.cl_code=bo.cl_code       
where     
bo.Repatriat_bank_ac_no='' and #TEMPECN.pid like '%sify%'    
  
  
update #TEMPECN set #TEMPECN.sid=''   from   
tbl_SecondaryEmailBypass t with (nolock)  
where t.cl_code=#TEMPECN.cl_code                                 
     
     
--end               
     
     
                             
                                
truncate table tbl_ECN_new                                                              
insert into tbl_ECN_new                                  
select rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                              
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                                  
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                  
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                  
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                  
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                                   
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                                                    
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+Sid +'|'+Pid+'|'+rtrim(ltrim(pan_gir_no))                                               
from  #TEMPECN    
  
                                
Declare @s as varchar(1000)                                                                  
Declare @s1 as varchar(1000)                                                          
Declare @file as varchar(50)                                                                  
                                                                  
set @file = (select 'ECN_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                            
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                   
  
    
                    
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                  
                    
set @s1= @s+''''                                              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_ECNFILE_NEW10022011
-- --------------------------------------------------
--USP_GENERATE_ECNFILE_NEW10022011 '172.29.19.10'
CREATE PROC USP_GENERATE_ECNFILE_NEW10022011
(@server AS varchar(50) )
AS

BEGIN
    

SET nocount ON
SELECT Party_Code INTO #Sify
FROM   intranet.misc.dbo.sifyClient WITH(nolock)
WHERE  SifyActStatus = 'A'
  AND  party_code NOT LIKE '98%'
  
SELECT DISTINCT cl_code INTO #CltBrok
FROM   anand1.msajag.dbo.client_Brok_details WITH(nolock)
WHERE  Active_Date >= CONVERT(varchar(11),getdate()-7)
  AND  Active_Date <= CONVERT(varchar(11),getdate() + ' 23:59:59')
  AND  cl_code NOT LIKE '98%'
  
SELECT DISTINCT cl_code INTO #CltBrokLog
FROM   anand1.msajag.dbo.client_Brok_details_log WITH(nolock)
WHERE  Active_Date >= CONVERT(varchar(11),getdate()-7)
  AND  Active_Date <= CONVERT(varchar(11),getdate() + ' 23:59:59')
  AND  cl_code NOT LIKE '98%'


SELECT DISTINCT x.cl_code INTO #Cltdetails
FROM   anand1.msajag.dbo.client_details x
LEFT OUTER JOIN   intranet.risk.dbo.client_details z WITH(nolock)
  ON   z.party_code = x.cl_code
WHERE  x.modifidedon >= CONVERT(varchar(11),getdate()-7)
  AND  x.modifidedon <= CONVERT(varchar(11),getdate() + ' 23:59:59')
  AND  x.cl_code NOT LIKE '98%'
  AND  z.last_inactive_date >= GETDATE()


SELECT * INTO #yahoocode
FROM   ecn_yahoo_partycode WITH(nolock)

SELECT * INTO #cltcode
FROM   (
           SELECT *
           FROM   #CltBrok
           UNION
           SELECT *
           FROM   #CltBrokLog
           UNION
           SELECT *
           FROM   #Cltdetails
       )x

SELECT x.* INTO #Cltdetails7days
FROM   anand1.msajag.dbo.client_details x WITH(nolock)
INNER JOIN   #cltcode y
  ON   x.cl_code = y.cl_code
LEFT OUTER JOIN   intranet.risk.dbo.client_details z WITH(nolock)
  ON   z.party_code = x.cl_code
WHERE  isnumeric(x.cl_code) = 0
  AND  x.cl_code NOT LIKE '98%'
  AND  z.last_inactive_date >= GETDATE()
  
  /*-------------------------------Sify CLients----------------------------------------------------- */

SELECT Party_Code INTO #S
FROM   intranet.misc.dbo.sifyClient x WITH(nolock)
WHERE  SifyActStatus = 'A'
  AND  SifyActDt >= CONVERT(varchar(11),getdate()-7)
  AND  SifyActDt <= CONVERT(varchar(11),getdate() + ' 23:59:59')
  AND  x.party_code NOT LIKE '98%'
  AND  NOT EXISTS (
              SELECT *
              FROM   #cltcode y
              WHERE  x.party_code = y.cl_code
           )
           
           /*-------------------------------Last 7 Days Clients from Client Details For New Clients --------------------------------- */
SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       email,
       CASE 
            WHEN Repatriat_bank_ac_no NOT LIKE 'ECN%' AND cl_code
            LIKE 'ZR_%' THEN ''
            WHEN Repatriat_bank_ac_no NOT LIKE 'ECN%' AND cl_code
            NOT LIKE
            'ZR_%' THEN ''
            WHEN Repatriat_bank_ac_no LIKE 'ECN%' AND cl_code
            LIKE 'ZR_%' THEN rtrim(ltrim(replace(email,',','')))
            WHEN Repatriat_bank_ac_no LIKE 'ECN%' AND cl_code NOT
            LIKE 'ZR_%' THEN rtrim(ltrim(replace(email,',','')))
       END AS pid,
       CASE 
            WHEN Repatriat_bank_ac_no NOT LIKE 'ECN%' AND cl_code
            LIKE 'ZR_%' THEN 'nri@angeltrade.com'
            --when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))
            WHEN (x.cl_code = y.party_code) THEN ''
            WHEN email LIKE '%@ecn.sify.com%' THEN ''
            ELSE ''
       END AS sid,
       pan_gir_no
       INTO #temp
FROM   (
           --select * from anand1.msajag.dbo.client_details x where isnumeric(cl_code) = 0 and exists
           SELECT *
           FROM   #Cltdetails7days x
           WHERE  EXISTS
           (
           SELECT *
           FROM   #cltcode y
           WHERE  x.cl_code = y.cl_code
           )
       )x
LEFT OUTER JOIN   (SELECT * FROM   #Sify ) y
  ON   x.cl_code = y.party_code

SELECT * INTO #temp2
FROM   #temp
WHERE  cl_code IN (SELECT * FROM   #yahoocode)

DELETE 
FROM   #temp
WHERE  cl_code IN (SELECT * FROM   #yahoocode)

SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       email,
       pid AS sid,
       sid AS pid,
       pan_gir_no INTO #temp3
FROM   #temp2
UNION
               
SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       email,
       pid,
       sid,
       pan_gir_no
FROM   #temp


/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */
SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       email,
       CASE 
            WHEN Repatriat_bank_ac_no NOT LIKE 'ECN%' AND cl_code
            LIKE 'ZR_%' THEN ''
            WHEN Repatriat_bank_ac_no NOT LIKE 'ECN%' AND cl_code
            NOT LIKE
            'ZR_%' THEN ''
            WHEN Repatriat_bank_ac_no LIKE 'ECN%' AND cl_code
            LIKE 'ZR_%' THEN rtrim(ltrim(replace(email,',','')))
            WHEN Repatriat_bank_ac_no LIKE 'ECN%' AND cl_code NOT
            LIKE 'ZR_%' THEN rtrim(ltrim(replace(email,',','')))
       END AS pid,
       CASE 
            WHEN Repatriat_bank_ac_no NOT LIKE 'ECN%' AND cl_code
            LIKE 'ZR_%' THEN 'nri@angeltrade.com'
            WHEN (x.cl_code = y.party_code) THEN ''
            WHEN email LIKE '%@ecn.sify.com%' THEN ''
            ELSE ''
       END AS sid,
       pan_gir_no
       INTO #tempS
FROM   (
           --select * from anand1.msajag.dbo.client_details x where isnumeric(cl_code) = 0 and exists
           SELECT *
           FROM   #Cltdetails7days x
           WHERE  EXISTS
           (
           SELECT *
           FROM   #S y
           WHERE  x.cl_code = y.party_code
           )
       )x
LEFT OUTER JOIN   (SELECT * FROM   #Sify ) y
  ON   x.cl_code = y.party_code

SELECT * INTO #temps2
FROM   #tempS
WHERE  cl_code IN (SELECT * FROM   #yahoocode)

DELETE 
FROM   #tempS
WHERE  cl_code IN (SELECT * FROM   #yahoocode)

SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       email,
       pid AS sid,
       sid AS pid,
       pan_gir_no INTO #temp5
FROM   #temps2
UNION
               
SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       email,
       pid,
       sid,
       pan_gir_no
FROM   #temps

SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       pid,
       sid,
       '1' AS Status,
       pan_gir_no INTO #TEMPECN
FROM   #temp3
UNION
               
SELECT cl_code,
       long_name,
       l_address1,
       l_address2,
       l_address3,
       l_city,
       res_phone1,
       res_phone2,
       Repatriat_bank_ac_no,
       pid,
       sid,
       '1' AS Status,
       pan_gir_no
FROM   #temp5


TRUNCATE TABLE tbl_ECN_new
               
INSERT INTO tbl_ECN_new
SELECT rtrim(ltrim(cl_code))+'|'+rtrim(ltrim(long_name))+'|'+
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'
+rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"',''
)))+' '+'|'+
CASE 
     WHEN rtrim(ltrim(replace(replace(replace(res_phone1,',',''),
     '|',''),'"',''))) = ' ' 
     THEN rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"','')))
     ELSE rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))
END +'|'+Sid +'|'+Pid+'|'+rtrim(ltrim(pan_gir_no))
FROM #TEMPECN

DECLARE @s AS varchar(1000)
DECLARE @s1 AS varchar(1000)
DECLARE @file AS varchar(50)

SET @file = (SELECT 'ECN_'+replace(CONVERT(varchar(11),getdate(),3),'/','')+
'.txt')
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'
SET @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +
'bcp "SELECT Fld_File FROM upload..tbl_ECN_new(nolock)" queryout \\'+@server+
'\D$\upload1\'+@file+' -c -Smis -Uinhouse -Pinh6014'



SET @s1 = @s+''''
EXEC (@s1)
SET NOCOUNT OFF;
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Generate_File
-- --------------------------------------------------
CREATE Proc [dbo].[usp_Generate_File](@segment as varchar(10))    
as    
    
declare @file as varchar(100)    
declare @s as varchar(1000)    
declare @s1 as varchar(1000)    
declare @UploadPath as varchar(100)  
  
set @UploadPath = (select uploadServer from [CSOKYC-6].upload.dbo.global_upload where upd_srno = '2')  
set @file = @UploadPath+'\Account\'+ltrim(rtrim(@segment))+''+convert(varchar,getdate(),112)+'.txt'      
  
--set @file = '\\196.1.115.136\D$\upload1\Account\'+ltrim(rtrim(@segment))+''+convert(varchar,getdate(),112)+'.txt'                                           
                                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT txt FROM mis.upload.DBO.Ledger_txt" queryout '+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                    
set @s1= @s+''''                                                    
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GENERATE_NONECNFILE_WithEmail
-- --------------------------------------------------
    
                               
                              
-- USP_GENERATE_NONECNFILE_WithEmail '196.1.115.183'                              
                                         
CREATE Proc [dbo].[USP_GENERATE_NONECNFILE_WithEmail]                                                 
(                        
@server as varchar(50)                        
)                                                                                                  
as       
        
                                                                     
  Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,                        
  Repatriat_bank_ac_no,email,pan_gir_no,modifidedon                        
  into #tempClientDetails from AngelNseCM.msajag.dbo.client_details  with(nolock)  where Repatriat_bank_ac_no not like 'ECN%'       
  and isnull(email,'')<>''      
   and cl_code not like '98%' and isnumeric(Cl_code)  = 0      
        
        
  -- delete from process for bad email      
        
       
delete from  #tempClientDetails where email in (select email from tbl_email_Bounce_Log)                        
                          
Select Cl_code,Active_date into #AllBrokData from AngelNseCM.msajag.dbo.client_Brok_details  with(Nolock) where Inactive_From>Getdate()          
                                
                       
   delete from  #tempClientDetails where cl_code not in (select cl_code from    #AllBrokData)                 
                        
                                                                              
Select distinct Cl_code into #CltBrok from #AllBrokData                         
where Active_Date >= convert(varchar(11),getdate()-7) and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59')                        
and Cl_code not like '98%'                        
                                              
Select distinct Cl_code  into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log                         
where Active_Date >= convert(varchar(11),getdate()-7)                       
and Active_Date <= convert(varchar(11),getdate() + ' 23:59:59') and Cl_code not like '98%'                                              
                                       
                                            
                                              
Select distinct  x.Cl_code into #Cltdetails from #tempClientDetails x                                               
left outer join #AllBrokData z with(nolock)                                              
on z.Cl_code = x.Cl_code                                              
where      
-- x.modifidedon >= convert(varchar(11),getdate()-7) and      
      
                                               
x.modifidedon <= convert(varchar(11),getdate() + ' 23:59:59') and x.Cl_code not like '98%'          
                                            
                                                                  
Select * into #cltcode from                                                                          
(                                                                          
Select * from #CltBrok                                                                          
union                                                                          
Select * from #CltBrokLog                                                                    
union                                                                    
Select * from #Cltdetails                                                                  
)x                                                                  
                          
          
                        
Select x.* into #Cltdetails7days from #tempClientDetails x with(nolock)                                      
inner join  #cltcode y                                               
on x.Cl_code = y.Cl_code where isnumeric(x.Cl_code) = 0 and x.Cl_code not like '98%'                         
                  
--Delete from #Cltdetails7days where Cl_code not in (Select Cl_code from #AllBrokData)        
      
                
    
                                       
                                     
                                              
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                                                               
Select  Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,                                                                  
case                 
                                                          
when ISNULL(Email,'') <>'' then rtrim(ltrim(replace(email,',','')))  end as pid ,                                                   
                                               
                                               
 ''  as sid ,pan_gir_no                                          
into #temp  from                                                                   
(                                                                  
                                                    
Select * from #Cltdetails7days x where exists                                                                 
(                                                                  
Select * from  #cltcode y where x.Cl_code = y.Cl_code                                                                              
)                                                                  
)x                                                                  
                                   
                         
                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid ,sid ,pan_gir_no           
 into #temp3 from #temp                                                                 
      
                                                               
                                  
                                  
Select Cl_code,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,pid,sid,'0' as Status,                      
pan_gir_no,'2' as Category into #TEMPECN from #temp3                                                                  
                            
                                            
                    
                          
                        
Update #TEMPECN set #TEMPECN.pid='' where pid like '%@Ecn.Sify.Com'                               
                  
                  
                                       
--end                                                 
                                       
                               
          
                                                                  
Truncate table tbl_NonECN_Email        
                                                                                                
Insert into tbl_NonECN_Email                                         
Select rtrim(ltrim(Cl_code))+'|'+rtrim(ltrim(long_name))+'|'+                                                                
rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                                     
rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                                                                   
rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                                                                                    
rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                                                                          
case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                                        
rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                                  
rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))        
end+'|'+ltrim(rtrim(isnull(pid,''))) +'|'+ltrim(rtrim(isnull(sid,'')))+'|'+RTRIM(ltrim (isnull(TE.Bcc_Mail,'')))+ '|'+  rtrim(ltrim(pan_gir_no))     
+ '|'+ Category                              
                                                                              
from  #TEMPECN T with(nolock) left outer join ABVSKYCMIS.kyc.dbo.tbl_Ecnreference TE on T.Cl_code = TE.client_code                                    
                                    
                            
                              
                          
                                                                  
Declare @s as varchar(1000)                                                   
Declare @s1 as varchar(1000)                                                                                            
Declare @file as varchar(50)                                                    
                                                                                                    
set @file = (Select 'NONECNEmail_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                                                                              
                                                                                                     
                                                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "Select Fld_File FROM upload..tbl_NonECN_Email(nolock)" queryout \\'+@server+'\D$\upload1\'+@file+' -c -SABVSMIS.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                         
         
    
                                                      
set @s1= @s+''''                                                                                
exec(@s1)      
      
      
drop table #AllBrokData      
drop table #CltBrok      
drop table #CltBrokLog      
drop table #Cltdetails      
drop table #Cltdetails7days      
drop table #TEMPECN      
drop table #cltcode      
drop table #temp      
drop table #temp3      
drop table #tempClientDetails

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Generate_STT_CSV1
-- --------------------------------------------------
CREATE Proc USP_Generate_STT_CSV1(@fdate as varchar(11))      
as      
      
Truncate table Tbl_Stt1      
      
declare @ledgercode as varchar(20)      
declare @sbcode as varchar(20)      
declare @mon as varchar(20)      
declare @srno as varchar(20)      
declare @Qry as varchar(5000)      
declare @path as varchar(100)                      
declare @sql as varchar(1000)                   
declare @s1 as varchar(5000)                    
declare @s as varchar(5000)          
      
set @srno=1      
      
--declare @Provision_amt as varchar(50)      
--insert into Tbl_Stt1      
---select entry_date as VDate,entry_date as Edate,ledgercode,'C' as DRCR,Provision_amt,Service_tax_reg_no,@srno as srno into Tbl_Stt1 from   intranet.risk.dbo.sb_service_tax where ledgercode = '28001011'      
    
    
DECLARE STT_cursor CURSOR FOR       
select ledgercode,sb_code,mon from  intranet.risk.dbo.sb_service_tax where ledgercode is not null  and JVmarking='N' and entry_date=@fdate   
OPEN STT_cursor                              
                              
FETCH NEXT FROM STT_cursor                               
INTO @ledgercode,@sbcode,@mon      
--,@Provision_amt      
                              
WHILE @@FETCH_STATUS = 0                              
BEGIN       
      
insert into Tbl_Stt1      
select entry_date as VDate,entry_date as Edate,ledgercode,'C' as DRCR,Provision_amt,Service_tax_reg_no,@srno as srno from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
union all      
select entry_date ,entry_date ,ledgercode,'D' as DRCR,service_tax,Service_tax_reg_no,@srno as srno from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
union all      
select entry_date,entry_date,ledgercode,'D',cess_tax,Service_tax_reg_no,@srno as srno from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
union all      
select entry_date,entry_date,ledgercode,'D',Edu_tax,Service_tax_reg_no,@srno as srno from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
      
set @srno=@srno + 1      
      
FETCH NEXT FROM STT_cursor                               
INTO @ledgercode,@sbcode,@mon      
--,@Provision_amt      
END                              
                              
CLOSE STT_cursor                              
DEALLOCATE STT_cursor                 
      
--select * from Tbl_Stt1      
update sb_service_tax set JVmarking='Y' from Tbl_Stt1 b where sb_service_tax.ledgercode=b.ledgercode  and entry_date=@fdate   
      
truncate table sb_jv               
insert into sb_jv      
select 'Vdate'+','+'Edate'+','+'Ledgercode'+','+'DRCR'+','+'Provision_Amt'+','+'service_tax_reg_no'+','+'srno'       
  
  
      
set @Qry='insert into sb_jv select convert(varchar(11),vdate,103)+'',''+convert(varchar(11),edate,103)+'',''+ledgercode+'',''+drcr+'',''+provision_amt+'',''+service_tax_reg_no+'',''+srno from Tbl_Stt1'      
---print @Qry           
exec(@Qry)        
      
      
            
set @path='d:\upload1\SBJV\JV_'+replace(convert(varchar(11),getdate(),103),'/','')+'.csv'                     
      
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select data from INTRANET.RISK.DBO.sb_jv " queryout '+@path+' -c -Sintranet -Usa -Pnirwan612'                                              
set @s1= @s+''''                                              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Generate_STT_CSV2
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Generate_STT_CSV2](@fdate as varchar(11))      
as      
      
Truncate table Tbl_Stt1      

/*declare @fdate as varchar(11)
set @fdate='oct 03 2007'      
*/
declare @ledgercode as varchar(20)      
declare @sbcode as varchar(20)      
declare @mon as varchar(20)      
declare @srno as varchar(20)      
declare @Qry as varchar(5000)      
declare @path as varchar(100)                      
declare @sql as varchar(1000)                   
declare @s1 as varchar(5000)                    
declare @s as varchar(5000)          
      
set @srno=1      
      
--declare @Provision_amt as varchar(50)      
--insert into Tbl_Stt1      
---select entry_date as VDate,entry_date as Edate,ledgercode,'C' as DRCR,Provision_amt,Narration,@srno as srno into Tbl_Stt1 from   intranet.risk.dbo.sb_service_tax where ledgercode = '28001011'      
    
    
DECLARE STT_cursor CURSOR FOR       
select ledgercode,sb_code,mon from  intranet.risk.dbo.sb_service_tax where ledgercode is not null  and JVmarking='N' and entry_date=@fdate   
OPEN STT_cursor                              
                              
FETCH NEXT FROM STT_cursor                               
INTO @ledgercode,@sbcode,@mon      
--,@Provision_amt      
                              
WHILE @@FETCH_STATUS = 0                              
BEGIN       
      
insert into Tbl_Stt1      
select entry_date as VDate,entry_date as Edate,ledgercode as cltcode,'C' as DRCR,Provision_amt as Amount,Service_tax_reg_no as Narration,@srno as srno,branch_cd from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
union all      
select entry_date ,entry_date ,ledgercode,'D' as DRCR,service_tax,Service_tax_reg_no,@srno as srno,branch_cd from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
union all      
select entry_date,entry_date,ledgercode,'D',cess_tax,Service_tax_reg_no,@srno as srno,branch_cd from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
union all      
select entry_date,entry_date,ledgercode,'D',Edu_tax,Service_tax_reg_no,@srno as srno,branch_cd from   intranet.risk.dbo.sb_service_tax where ledgercode = @ledgercode  and sb_code=@sbcode and mon=@mon    
      
set @srno=@srno + 1      
      
FETCH NEXT FROM STT_cursor                               
INTO @ledgercode,@sbcode,@mon      
--,@Provision_amt      
END                              
                              
CLOSE STT_cursor                              
DEALLOCATE STT_cursor                 
      
--select * from Tbl_Stt1      
update sb_service_tax set JVmarking='Y' from Tbl_Stt1 b where sb_service_tax.ledgercode=b.cltcode  and entry_date=@fdate   
      
truncate table sb_jv               
insert into sb_jv      
select 'Vdate'+','+'Edate'+','+'Cltcode'+','+'DRCR'+','+'Amount'+','+'Narration'+','+'srno'+','+'Branch_cd'       
  
  
      
set @Qry='insert into sb_jv select convert(varchar(11),vdate,103)+'',''+convert(varchar(11),edate,103)+'',''+Cltcode+'',''+drcr+'',''+Amount+'',''+Narration+'',''+srno+'',''+Branch_cd from Tbl_Stt1'      
--print @Qry           
exec(@Qry)        
      
            
set @path='d:\upload1\SBJV\JV_'+replace(convert(varchar(11),getdate(),103),'/','')+'.csv'                     
     
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select data from INTRANET.RISK.DBO.sb_jv " queryout '+@path+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                              
--set @s1= @s+''''                                              
--exec(@s1)          
      
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "select data from OLDINTRANET.UPLOAD.DBO.sb_jv " queryout '+@path+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                              
set @s1= @s+''''                                              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Generate_XML
-- --------------------------------------------------
CREATE Proc [dbo].[USP_Generate_XML](@fdate as varchar(11),@tdate as varchar(11))    
as    
  
set nocount on  
    
declare @filepath as varchar(100)          
declare @str as varchar(500)          
set @filepath=(select replace(convert(varchar(11),getdate(),112),'/',''))+'.xml'          
  
set @fdate = convert(datetime,@fdate,103)      
set @tdate = convert(datetime,@tdate,103)      
    
truncate table BPAN    
    
insert into BPAN    
select party_code,pan_gir_no,short_name,'','',replace(convert(varchar(10),dob,111),'/','-'),'ANGEL   BROKING     LIMITED'     
from intranet.risk.dbo.client_details where Modifidedon >= @fdate and Modifidedon <= @tdate + ' 23:59:59' and   IMP_Status = 1    
    
set @str='exec MASTER.dbo.xp_cmdshell '+ '''' +' bcp "SELECT UniqueSRNO,pan,firstname,dob,address FROM  mis.UPLOAD.DBO.BPAN  FOR XML AUTO,ELEMENTS" queryout D:\upload1\Xml_Pan\'+@filepath+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'          
set @str=@str+''''            
exec(@str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_genrate_ecn_dpid
-- --------------------------------------------------
CREATE proc [dbo].[usp_genrate_ecn_dpid]        
as        
        
truncate table tbl_ecn_dpid        
insert into tbl_ecn_dpid        
SELECT ltrim(rtrim(cm_cd))+'|'+cm_email FROM ABCSOORACLEMDLW.synergy.dbo.CLIENT_MASTER where cm_statements = 'E' and cm_schedule = '49843750'        
        
Declare @s as varchar(1000)                                          
Declare @s1 as varchar(1000)                                          
Declare @file as varchar(50)         
        
set @file = (select 'ECN_DPID_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                    
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM mis.upload.dbo.tbl_ecn_dpid" queryout \\INHOUSEALLAPP-FS.angelone.in\D$\upload1\'+@file+' -c'                                                                                                      
  
set @s1= @s+''''                                                                    
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_genrate_ecn_dpid_new
-- --------------------------------------------------
CREATE proc [dbo].[usp_genrate_ecn_dpid_new] (@serverip as varchar(25))           
as            
           
      
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A'                             
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details       
select distinct cl_code into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log       
select distinct cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details       
select *  into #yahoocode  from ecn_yahoo_partycode       
      
select * into #cltcode from                    
(                    
select * from #CltBrok                    
union                    
select * from #CltBrokLog              
union              
select * from #Cltdetails            
)x        
      
/*-------------------------------Sify CLients----------------------------------------------------- */        
select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A'          
/*-------------------------------Last 7 Days Clients from Client Details For New Clients  --------------------------------- */                    
select  cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,            
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''             
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))            
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                    
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                         
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no              
into #temp  from             
(            
select * from AngelNseCM.msajag.dbo.client_details x where cltdpid1 <> '' and isnumeric(cl_code)  = 0 and exists            
(            
select * from  #cltcode y where x.cl_code = y.cl_code                        
)            
)x            
left outer join                            
(select * from #Sify) y                        
on x.cl_code = y.party_code              
            
select   * into #temp2  from #temp where cl_code in (select * from #yahoocode)             
            
delete from #temp where cl_code in (select * from #yahoocode)            
           
select cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2            
union            
select cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp        
      
/*-----------Clients Not have in Last 7 Days in Client Details table but exists in sify table for last 7 days ------------ */             
select  cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,            
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''             
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))            
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case            
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                    
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                         
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no              
into #tempS  from             
(            
select * from AngelNseCM.msajag.dbo.client_details x where cltdpid1 <> '' and isnumeric(cl_code)  = 0 and exists            
(            
select * from  #S y where x.cl_code = y.party_code                        
)            
)x            
left outer join                            
(select * from #Sify) y                        
on x.cl_code = y.party_code             
            
select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)            
            
delete from #tempS where cl_code in (select * from #yahoocode)             
            
select cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2            
union            
select cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps            
      
      
select cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3            
union             
select cl_code,cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,'1' as Status,pan_gir_no from #temp5            
      
--truncate table tbl_ecn_dpid            
--insert into tbl_ecn_dpid                
--select rtrim(ltrim(cltdpid1))+'|'+rtrim(ltrim(long_name))+'|'+                                              
--rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                              
--rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                              
--rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                              
--rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                              
--case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                               
--rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                                
--rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+Pid +'|'+Sid+'|'+status+'|'+rtrim(ltrim(pan_gir_no))                           
--from  #TEMPECN      



truncate table tbl_ecn_dpid            
insert into tbl_ecn_dpid                
select rtrim(ltrim(cltdpid1))+'|'+rtrim(ltrim(email)) from  #TEMPECN where  email <> ''
      
      
    
Declare @s as varchar(1000)                                            
Declare @s1 as varchar(1000)                                            
Declare @file as varchar(50)           
          
--set @file = (select 'ECN_DPID_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')        
set @file = (select 'ECN_DPID.txt')                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM mis.upload.dbo.tbl_ecn_dpid" queryout \\'+@serverip+'\D$\upload1\'+@file+' -c'                                                                                                      
  
    
set @s1= @s+''''                                                                      
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_genrate_ecn_dpid_new1
-- --------------------------------------------------
CREATE proc [dbo].[usp_genrate_ecn_dpid_new1] (@serverip as varchar(25))           
as            
           
select Party_Code into #Sify from  intranet.misc.dbo.sifyClient where SifyActStatus = 'A'                           
select distinct cl_code into #CltBrok from AngelNseCM.msajag.dbo.client_Brok_details     
select distinct cl_code into #CltBrokLog from AngelNseCM.msajag.dbo.client_Brok_details_log     
select distinct cl_code into #Cltdetails from AngelNseCM.msajag.dbo.client_details     
select *  into #yahoocode  from ecn_yahoo_partycode  

select * into #cltcode from                  
(                  
select * from #CltBrok                  
union                  
select * from #CltBrokLog            
union            
select * from #Cltdetails          
)x 

select Party_Code into #S from  intranet.misc.dbo.sifyClient x where SifyActStatus = 'A' 

select  cl_code,
case when dpid1 like '%IN%' then dpid1+cltdpid1 else cltdpid1 end as cltid,
cltdpid1,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,          
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''          
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))          
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case          
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                  
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                       
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no            
into #temp  from           
(          
select * from AngelNseCM.msajag.dbo.client_details x where cltdpid1 <> '' and isnumeric(cl_code)  = 0 and exists          
(          
select * from  #cltcode y where x.cl_code = y.cl_code                      
)          
)x          
left outer join                          
(select * from #Sify) y                      
on x.cl_code = y.party_code  

select * into #temp2  from #temp where cl_code in (select * from #yahoocode)           
  
delete from #temp where cl_code in (select * from #yahoocode)  

select cl_code,cltid,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp3 from #temp2          
union          
select cl_code,cltid,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temp         

select  cl_code,case when dpid1 like '%IN%' then dpid1+cltdpid1 else cltdpid1 end as cltid,cltdpid1,
long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,          
case when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then ''          
when Repatriat_bank_ac_no not like 'ECN%' and cl_code not like 'ZR_%' then ''           
when Repatriat_bank_ac_no like 'ECN%' and cl_code like 'ZR_%' then rtrim(ltrim(replace(email,',','')))          
when Repatriat_bank_ac_no like 'ECN%' and cl_code not like 'ZR_%' then rtrim(ltrim(replace(email,',','')))  end as pid ,case          
when Repatriat_bank_ac_no not like 'ECN%' and cl_code like 'ZR_%' then 'nri@angeltrade.com'                                  
when (x.cl_code = y.party_code) then ((rtrim(ltrim(cl_code))+'@ecn.sify.com'))                       
when email like '%@ecn.sify.com%' then '' else '' end as sid ,pan_gir_no            
into #tempS  from           
(          
select * from AngelNseCM.msajag.dbo.client_details x where cltdpid1 <> '' and isnumeric(cl_code)  = 0 and exists          
(          
select * from  #S y where x.cl_code = y.party_code                      
)          
)x          
left outer join                          
(select * from #Sify) y                      
on x.cl_code = y.party_code 

select * into #temps2 from #tempS where cl_code in (select * from #yahoocode)          
          
delete from #tempS where cl_code in (select * from #yahoocode)

select cl_code,cltid,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid as sid,sid as pid,pan_gir_no  into #temp5 from #temps2          
union          
select cl_code,cltid,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,pan_gir_no from #temps          

select cl_code,cltid,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,'1' as Status,pan_gir_no into #TEMPECN from #temp3          
union           
select cl_code,cltid,long_name,l_address1,l_address2,l_address3,l_city,res_phone1,res_phone2,Repatriat_bank_ac_no,email,pid,sid,'1' as Status,pan_gir_no from #temp5          

--drop table #TEMPECN
--select rtrim(ltrim(cltid))+'|'+rtrim(ltrim(long_name))+'|'+                                            
--rtrim(ltrim(replace(replace(replace(l_address1,',',''),'|',''),'"','')))+' '+                                            
--rtrim(ltrim(replace(replace(replace(l_address2,',',''),'|',''),'"','')))+' '+                                            
--rtrim(ltrim(replace(replace(replace(l_address3,',',''),'|',''),'"','')))+' '+'|'+                                            
--rtrim(ltrim(replace(replace(replace(l_city,',',''),'|',''),'"','')))+' '+'|'+                                            
--case when rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"',''))) = ' ' then                                             
--rtrim(ltrim(replace(replace(replace(res_phone2,',',''),'|',''),'"',''))) else                                              
--rtrim(ltrim(replace(replace(replace(res_phone1,',',''),'|',''),'"','')))end+'|'+Pid +'|'+Sid+'|'+status+'|'+rtrim(ltrim(pan_gir_no))                         
--from  #TEMPECN  

truncate table tbl_ecn_dpid            
insert into tbl_ecn_dpid   
select  rtrim(ltrim(cltid))+'|'+rtrim(ltrim(Email)) from  #TEMPECN  where Email <> ''

Declare @s as varchar(1000)                                            
Declare @s1 as varchar(1000)                                            
Declare @file as varchar(50)           
          
--set @file = (select 'ECN_DPID_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')        
set @file = (select 'ECN_DPID.txt')                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM mis.upload.dbo.tbl_ecn_dpid" queryout \\'+@serverip+'\D$\upload1\'+@file+' -c'                                                                                                      
  
set @s1= @s+''''                                                                      
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_genrate_ecn_dpid31122012
-- --------------------------------------------------
CREATE proc usp_genrate_ecn_dpid31122012      
as      
      
truncate table tbl_ecn_dpid      
insert into tbl_ecn_dpid      
SELECT ltrim(rtrim(cm_cd))+'|'+cm_email FROM DPBACKOFFICE.ACERCROSS.DBO.CLIENT_MASTER where cm_statements = 'E' and cm_schedule = '49843750'      
      
Declare @s as varchar(1000)                                        
Declare @s1 as varchar(1000)                                        
Declare @file as varchar(50)       
      
set @file = (select 'ECN_DPID_'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM mis.upload.dbo.tbl_ecn_dpid" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                      
set @s1= @s+''''                                                                  
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_ALL_IMG_DETAILS
-- --------------------------------------------------


/******************************************************************************
CREATED BY: RUTVIJ PATIL
DATE: 20/09/2010
PURPOSE: USE TO GET DATA FROM TABLE TR_IMG_UPLOAD

MODIFIED BY: PROGRAMMER NAME
DATED: DD/MM/YYYY
REASON: REASON TO CHANGE STORE PROCEDURE
******************************************************************************/

CREATE PROCEDURE [dbo].[USP_GET_ALL_IMG_DETAILS]
AS
BEGIN
	
	SELECT 
		IMG_UPLOAD_ID,
		POPUP_NAME,
		FOR_EMP,
		FOR_SB_ADMIN,
		FOR_SB_USER,
		DATE_FROM,
		TIME_FROM,
		DATE_TO,
		TIME_TO,
		IMG_NAME,
		[FILE_NAME]

	FROM TR_IMG_UPLOAD

	ORDER BY DATE_FROM DESC
	--ORDER BY CREATED_DATE DESC

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_ALL_TICKER_DETAILS
-- --------------------------------------------------
/******************************************************************************      
CREATED BY: RUTVIJ PATIL      
DATE: 18/11/2010      
PURPOSE: USE TO GET ALL DATA FROM TABLE TICKER_IMG_UPLOAD    
      
MODIFIED BY: PROGRAMMER NAME      
DATED: DD/MM/YYYY      
REASON: REASON TO CHANGE STORE PROCEDURE      
******************************************************************************/      
      
CREATE PROCEDURE DBO.USP_GET_ALL_TICKER_DETAILS    
      
AS      
BEGIN      
      
	SELECT *,
		DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO_SEL  
	INTO #TEMP
	FROM TICKER_IMG_UPLOAD    

	SELECT * 
	FROM #TEMP
	ORDER BY DATE_TO_SEL DESC     
    
	DROP TABLE #TEMP
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_DISPLAY_IMAGE
-- --------------------------------------------------
/******************************************************************************          
CREATED BY: RUTVIJ PATIL          
DATE: 03/12/2010          
PURPOSE: USE TO GET DATA INTO TABLE TR_IMAGE_UPLOAD        
          
MODIFIED BY: PROGRAMMER NAME          
DATED: DD/MM/YYYY          
REASON: REASON TO CHANGE STORE PROCEDURE          
******************************************************************************/          

CREATE PROCEDURE USP_GET_DISPLAY_IMAGE

	@IMAGE_UPLOAD_ID INT -- USE TO HOLD IMAGE UPLOAD ID  

AS

BEGIN

	SELECT IMAGE_NAME,IMAGE_CONTENT
	FROM TR_IMAGE_UPLOAD
	WHERE IMAGE_UPLOAD_ID = @IMAGE_UPLOAD_ID

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_IMAGE_FOR_TODAY
-- --------------------------------------------------
/******************************************************************************
CREATED BY: RUTVIJ S. PATIL
DATE: 27/09/2010
PURPOSE: USE TO FETCH RECORD FROM TR_IMG_UPLOAD TABLE
		 WHERE DATE TIME CONDITION CHECK TO CURRENT DATE

MODIFIED BY: PROGRAMMER NAME
DATED: DD/MM/YYYY
REASON: REASON TO CHANGE STORE PROCEDURE
******************************************************************************/
CREATE PROCEDURE USP_GET_IMAGE_FOR_TODAY

AS
	BEGIN
		SELECT M.* 
		FROM
		(
			SELECT IMG_UPLOAD_ID,
				FOR_EMP,
				FOR_SB_ADMIN,
				FOR_SB_USER,
				TIME_FROM,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,
				TIME_TO,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO
			FROM TR_IMG_UPLOAD
		)AS M
		WHERE M.DATE_FROM <= GETDATE() AND M.DATE_TO >= GETDATE()
	END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_POPUP_NAME_COUNT
-- --------------------------------------------------
/******************************************************************************  
CREATED BY: RUTVIJ PATIL  
DATE: 21/09/2010  
PURPOSE: USE TO CHECK WHETHER POPUP NAME IS ALREADY EXIST 

MODIFIED BY: RUTVIJ S. PATIL  
DATE: 13/10/2010  
PURPOSE: USE TO CHECK POPUP NAME BETWEEN (CURRENT DATE AND ABOVE) RECORDS 
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
  
CREATE PROCEDURE USP_GET_POPUP_NAME_COUNT  
  
 @POPUPNAME VARCHAR(15) -- USE TO STORE POPUP NAME TO CHECK  
  
AS  
BEGIN  
   
	/*
	 SELECT COUNT(POPUP_NAME)   
	 FROM TR_IMG_UPLOAD  
	 WHERE POPUP_NAME LIKE @POPUPNAME  
	*/

	SELECT IMG_UPLOAD_ID,
				POPUP_NAME,
				FOR_EMP,
				FOR_SB_ADMIN,
				FOR_SB_USER,
				TIME_FROM,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,
				TIME_TO,
				DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO
	INTO #TEMP 
	FROM TR_IMG_UPLOAD

	SELECT COUNT(POPUP_NAME) FROM #TEMP WHERE GETDATE() < DATE_TO AND POPUP_NAME LIKE @POPUPNAME

	DROP TABLE #TEMP
   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_TICKER_FOR_TODAY
-- --------------------------------------------------
/******************************************************************************  
CREATED BY: RUTVIJ S. PATIL  
DATE: 20/11/2010
PURPOSE: USE TO FETCH RECORD FROM TICKER_IMG_UPLOAD TABLE  
   WHERE DATE TIME CONDITION CHECK TO CURRENT DATE  
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
CREATE PROCEDURE USP_GET_TICKER_FOR_TODAY  
  
AS  

BEGIN  

	SELECT M.*   
	FROM  
	(  
		SELECT ANGEL_TICKER_ID,  
			TICKER_MESSAGE,
			TIME_FROM,  
			DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,  
			TIME_TO,  
			DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO  
		FROM TICKER_IMG_UPLOAD  
	)AS M  
	WHERE M.DATE_FROM <= GETDATE() AND M.DATE_TO >= GETDATE()  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_TICKER_NAME_COUNT
-- --------------------------------------------------
/******************************************************************************      
CREATED BY: RUTVIJ PATIL      
DATE: 21/09/2010      
PURPOSE: USE TO CHECK TICKER MESSAGE BETWEEN (CURRENT DATE AND ABOVE) RECORDS     
******************************************************************************/      
      
CREATE PROCEDURE USP_GET_TICKER_NAME_COUNT      
      
 @TICKER_MESSAGE VARCHAR(60) -- USE TO STORE POPUP NAME TO CHECK      
      
AS      
BEGIN      
       
 /*    
  SELECT COUNT(POPUP_NAME)       
  FROM TR_IMG_UPLOAD      
  WHERE POPUP_NAME LIKE @POPUPNAME      
 */    
    
 SELECT ANGEL_TICKER_ID,    
    TICKER_MESSAGE,    
    TIME_FROM,    
    DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_FROM)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_FROM)),DATE_FROM))AS DATE_FROM,    
    TIME_TO,    
    DATEADD(MI,DATEPART(MI,CONVERT(DATETIME,TIME_TO)),DATEADD(HH, DATEPART(HH,CONVERT(DATETIME,TIME_TO)),DATE_TO))AS DATE_TO    
 INTO #TEMP     
 FROM TICKER_IMG_UPLOAD    
    
 SELECT COUNT(TICKER_MESSAGE) FROM #TEMP WHERE GETDATE() < DATE_TO AND TICKER_MESSAGE LIKE @TICKER_MESSAGE   
    
 DROP TABLE #TEMP    
       
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetUserInfoLogTime
-- --------------------------------------------------
--exec USP_GetUserInfoLogTime

CREATE  Proc USP_GetUserInfoLogTime 
  
As   
begin
	declare @MaxDate datetime
	select @MaxDate =max(StartTime)  from Tbl_UserInfoLogTime 
	
	select * from Tbl_UserInfoLogTime where StartTime=@MaxDate  
	

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_HDFC_Bank
-- --------------------------------------------------
CREATE proc USP_HDFC_Bank    
(                
@filename as varchar(100)                
)                 
as                    
      
set transaction  isolation  level read uncommitted                      
declare @path as varchar(100)                  
declare @sql as varchar(1000)                   
      
Create table #x      
(      
Fld_SrNo varchar(10),  
Fld_Date varchar(50),      
Fld_Desc varchar(100),      
Fld_ChqNo varchar(50),      
Fld_Cr_Dr varchar(50),      
Fld_Trans_Amt varchar(50),      
Fld_Bal varchar(50)      
)       
      
set @path='d:\upload1\' + @filename        
SET @SQL = 'BULK INSERT #x FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                  
--print @SQL                  
exec (@sql)                  
      
insert into tbl_Upload_HDFC      
select * from #x where Fld_Date+Fld_Desc+Fld_Trans_Amt+Fld_Bal Not in      
(select Fld_Date+Fld_Desc+Fld_Trans_Amt+Fld_Bal from tbl_Upload_HDFC (nolock)) 
select @@rowcount

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_hr_pendingdoc_mail
-- --------------------------------------------------
CREATE proc Usp_hr_pendingdoc_mail        
(        
@filename as  varchar(100) ,       
@server as varchar(100)                                                              
)            
as        
        
declare @path as varchar(100)                 
declare @SQL as varchar(1000)                              
          
--set @path='\\196.1.115.175\d$\upload1\HR_Pen_Doc\'+ @filename         
set @path= '\\'+@server+'\d$\upload1\HR_Pen_Doc\'+ @filename           
--print @path                
--SET @SQL = 'Insert into tbl_hr_pnddoc Select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                        
truncate table tbl_hr_pnddoc             
SET @SQL = 'Insert into tbl_hr_pnddoc Select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                                                                    
--SET @SQL ='BULK INSERT tbl_hr_pnddoc FROM '''+@Path+''' WITH (FirstRow=2,KeepNULLS)'
exec (@SQL)        
select @@RowCount as [count]

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ICICI_Bank
-- --------------------------------------------------
CREATE proc USP_ICICI_Bank  
(            
@filename as varchar(100)            
)             
as                
  
set transaction  isolation  level read uncommitted                  
declare @path as varchar(100)              
declare @sql as varchar(1000)             
  
  
Create table #x  
(  
Fld_Id varchar(50),  
Fld_Txn_Id varchar(50),  
Fld_Value_Date varchar(50),  
Fld_Txn_Date varchar(50),  
Fld_ChqNo varchar(50),  
Fld_Desc varchar(100),  
Fld_DrCr varchar(5),  
Fld_Txn_Amt varchar(50),  
Fld_Bal varchar(50)  
)  
  
  
set @path='d:\upload1\' + @filename    
SET @SQL = 'BULK INSERT #x FROM '''+@Path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=2,KeepNULLS)'              
--print @SQL              
exec (@sql)              
  
insert into tbl_Upload_ICICI  
select Fld_Id,Fld_Txn_Id,Fld_Value_Date,Fld_Desc,Fld_DrCr,Fld_Txn_Amt,Fld_Bal from #x where Fld_Txn_id+Fld_Value_date+Fld_DrCr Not in  
(select Fld_Txn_id+Fld_Value_date+Fld_DrCr from tbl_Upload_ICICI (nolock))  
select @@rowcount

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ICICIBank_Stment
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ICICIBank_Stment](@file as varchar(25),@Date as varchar(11))                              
as                              
set nocount on                                   
              
declare @path as varchar(100)                                                      
declare @SQL as varchar(500)                                                      
declare @s as varchar(500)                                              
declare @s1 as varchar(500)                                               
                            
/*                                 
declare @file as varchar(50)                            
set @file = '000405024925-260308.csv'                            
set @path= 'd:\upload1\ICICI_RECO\' + @file                                
  */                        
                              
set @path= 'd:\upload1\' + @file                               
                          
                             
truncate table icici_statment        
drop table tlb_ICICIReco_file               
truncate table tlb_ICICIGen_File                              
                                     
SET @SQL = 'BULK INSERT icici_statment FROM '''+@path+''' with (FIELDTERMINATOR = '','', rowterminator=''\n'',FirstRow=3,KeepNULLS)'                                                    
      
exec(@SQL)        
                            
--select * from tlb_ICICIReco_file                             
             
select * into #t from icici_statment                
              
select * into #t1 from #t where acc_number in ('Ac No:000405024925','Ac No:000405030380','Ac No:000405030379','Ac No:000405031381','Ac No:000405031380' )             
--drop table tlb_ICICIReco_file              
        
select Tran_date as 'BookDate',Tran_Particular as 'Description',bal_amt as 'LedgerBalance',Cr_tran_amt as 'Credit',           
Dr_tran_amt as 'Debit',@Date as 'ValueDate',0 as 'ReferenceNo',Deposit_branch as 'TransactionBranch'           
into tlb_ICICIReco_file from #t1         
        
insert into tlb_ICICIGen_File                    
select 'BookDate'+'|'+'Description'+'|'+'LedgerBalance'+'|'+'Credit'+'|'+'Debit'+'|'+'ValueDate'+'|'+'ReferenceNo'+'|'+'TransactionBranch'                      
        
insert into tlb_ICICIGen_File                    
select rtrim(ltrim(BookDate))+'|'+rtrim(ltrim(Description))+'|'+ltrim(rtrim(LedgerBalance))+'|'
+ltrim(rtrim(Credit))+'|'+ltrim(rtrim(Debit))+'|'+ltrim(rtrim(convert(varchar(11),convert(datetime,ValueDate,103))))    
+'|'+ltrim(rtrim(ReferenceNo))      
+'|'+ltrim(rtrim(TransactionBranch)) from tlb_ICICIReco_file        
          
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT fld_stat FROM mis.UPLOAD.DBO.tlb_ICICIGen_File " queryout '+'d:\upload1\ICICI_RECO\ICICI.xls -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                        
set @s1= @s+''''                                         
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ING_OBUF
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ING_OBUF]            
(            
@fdate as varchar(11),            
@Fld_entryBy as varchar(11)            
)            
as            
          
drop table #x          
drop table #y          
        
declare @batchNo varchar(10)            
declare @filename varchar(20)            
declare @fileExn as varchar(5)        
            
set @fdate = convert(varchar(11),convert(datetime,@fdate,103))            
            
create table #x            
(            
Fld_SrNo int identity(1,1),            
Fld_CltCode varchar(15),            
Fld_Cif varchar(15),            
Fld_AcNum varchar(25),            
Fld_Dpid varchar(25),            
Fld_ActiveDate datetime,            
Fld_deActiveDate datetime            
)            
            
truncate table tbl_ING_Clients            
            
insert into tbl_ING_Clients(Fld_ClCode,Fld_Cif,Fld_ActiveDate,Fld_AcNum,Fld_Dp,Fld_SystemDate,Fld_ActiveStatus,Fld_Flag)
select cl_code,'CIF',First_Active_Date,Ac_Num,Dpid1+cltdpid1,getdate(),1,'P'             
from client_details x(nolock) where First_Active_Date >= @fdate            
and First_Active_Date <= @fdate+' 23:59:59' and not exists            
(select Fld_ClCode from tbl_ING_Clients y (nolock) where x.cl_code = y.Fld_ClCode)            
            
insert into tbl_ING_Clients(Fld_ClCode,Fld_Cif,Fld_DeactivateDate,Fld_AcNum,Fld_Dp,    
Fld_SystemDate,Fld_ActiveStatus,Fld_Flag)    
select cl_code,'CIF',Last_inActive_Date,Ac_Num,Dpid1+cltdpid1,getdate(),0,'P'             
from client_details x(nolock) where Last_inActive_Date >= @fdate    
and Last_inActive_Date <= @fdate+' 23:59:59' and not exists            
(select Fld_ClCode from tbl_ING_Clients y (nolock) where x.cl_code = y.Fld_ClCode)            
            
insert into #x            
select Fld_ClCode,Fld_Cif,Fld_AcNum,Fld_Dp,Fld_ActiveDate,Fld_DeactivateDate from tbl_ING_Clients (nolock)    
where Fld_Flag not in ('F','S') and Fld_ActiveStatus = 1    
            
create table #y            
(            
Fld_Srno int identity(1,1),            
Fld_Data varchar(100)            
)        
          
set @batchNo = (select replace(str(isnull(max(Fld_BatchNo),0)+1,5),' ','0') from  tbl_ING_Clients (nolock) where        
convert(varchar(11),Fld_SystemDate)  = convert(varchar(11),getdate()) and Fld_Flag not in ('P','G') and   
Fld_ActiveStatus = 1)
            
insert into #y            
select 'H|IVBL|OBP|'+convert(varchar(11),getdate(),105)+'|OBUF|1|'+@batchNo            
            
insert into #y            
select 'D|'+convert(varchar,Fld_SrNo)+'|'+case when Fld_ActiveDate is not null then '1' else '0' end +'|'+convert(varchar(11),getdate(),103)+'|'+Fld_Cif+'|' +Fld_AcNum+'|'+Fld_CltCode+'|'+Fld_Dpid+'|'+            
case when Fld_DeActiveDate is not null then convert(varchar(11),Fld_DeActiveDate,103) else '' end             
 from #x (nolock)             
            
insert into #y            
select 'T|'+convert(varchar,count(*)) from #x
            
update tbl_ING_Clients set Fld_RequestTime = getdate(),Fld_Flag = 'G',Fld_BatchNo = @batchNo,            
Fld_entryBy = @Fld_entryBy where convert(varchar(11),Fld_SystemDate)  = convert(varchar(11),getdate()) and Fld_RequestTime is null AND Fld_ActiveStatus = 1     
        
--------------------------File Name--------        
set @fileExn =           
(          
select           
case           
when datepart(mm,getdate()) = 10 then 'A'          
when datepart(mm,getdate()) = 11 then 'B'          
when datepart(mm,getdate()) = 12 then 'C'          
else datepart(mm,getdate()) end          
)                  
          
        
set @filename = (select 'OBPOBUF2'+@batchNo+'.'+convert(varchar,datepart(dd,getdate()))+@fileExn) 
                
truncate table Tbl_FileGen        
        
insert into Tbl_FileGen        
select Fld_Data from #y order by Fld_Srno        
        
declare @s as varchar(1000)        
declare @s1 as varchar(1000)                                                                         

set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_Data FROM ANGEL.risk.DBO.Tbl_FileGen" queryout D:\upload1\'+@filename+' -c -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                
set @s1= @s+''''                                                                
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Insert_MailId
-- --------------------------------------------------
CREATE Proc Usp_Insert_MailId (@BrCode Varchar(11),@BrName Varchar(50),@EmpCode Varchar(11),@Email Varchar(50))      
as      
      
Declare @EmpName as Varchar(70)      
Select @EmpName = Emp_Name from [MIDDLEWARE].harmony.dbo.vlmsinhouse where [Emp No] = @EmpCode      
      
Insert into tbl_OdinMail Values(@EmpName,@EmpCode,@BrCode,@Email,@BrName,'N')

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INSERT_TICKER_IMG_UPLOAD
-- --------------------------------------------------
/******************************************************************************      
CREATED BY: RUTVIJ PATIL      
DATE: 18/11/2010      
PURPOSE: USE TO INSERT DATA INTO TABLE TICKER_IMG_UPLOAD    
      
MODIFIED BY: PROGRAMMER NAME      
DATED: DD/MM/YYYY      
REASON: REASON TO CHANGE STORE PROCEDURE      
******************************************************************************/      
      
CREATE PROCEDURE DBO.[USP_INSERT_TICKER_IMG_UPLOAD]
       
 @TICKER_MESSAGE VARCHAR(60),    
 @DATE_FROM DATETIME,    
 @TIME_FROM VARCHAR(5),    
 @DATE_TO DATETIME,    
 @TIME_TO VARCHAR(5),    
 @IMAGE_NAME VARCHAR(200),    
 @IMAGE_CONTENT VARBINARY(MAX),    
 @CREATED_BY VARCHAR(10),    
 @CREATED_DATE DATETIME,    
 @MODIFIED_BY VARCHAR(10),    
 @MODIFIED_DATE DATETIME      
      
AS      
BEGIN      
      
 DECLARE @ANGEL_TICKER_ID INT -- USE TO HOLD PRIMARY KEY      
    
 SELECT @ANGEL_TICKER_ID = ISNULL(MAX(ANGEL_TICKER_ID),0) FROM TICKER_IMG_UPLOAD    
    
 INSERT INTO TICKER_IMG_UPLOAD    
 VALUES      
 (      
  @ANGEL_TICKER_ID + 1,      
  @TICKER_MESSAGE,    
  @DATE_FROM,    
  @TIME_FROM,    
  @DATE_TO,    
  @TIME_TO,    
  @IMAGE_NAME,    
  @IMAGE_CONTENT,    
  @CREATED_BY,    
  @CREATED_DATE,    
  @MODIFIED_BY,    
  @MODIFIED_DATE    
 )      
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INSERT_TR_IMAGE_UPLOAD
-- --------------------------------------------------
/******************************************************************************          
CREATED BY: RUTVIJ PATIL          
DATE: 18/11/2010          
PURPOSE: USE TO INSERT DATA INTO TABLE TR_IMAGE_UPLOAD        
          
MODIFIED BY: PROGRAMMER NAME          
DATED: DD/MM/YYYY          
REASON: REASON TO CHANGE STORE PROCEDURE          
******************************************************************************/          
          
CREATE PROCEDURE [DBO].[USP_INSERT_TR_IMAGE_UPLOAD]    
           
 @IMAGE_NAME VARCHAR(50),    
 @CLIENT_ID VARCHAR(50),    
 @IMAGE_CONTENT VARBINARY(MAX),    
 @APPLICATION_NAME VARCHAR(50),    
 @UPLOADED_BY VARCHAR(50),    
 @UPLOADED_DATE DATETIME,    
 @MODIFIED_BY VARCHAR(50),    
 @MODIFIED_DATE DATETIME,
 @DDNO VARCHAR(10)         
AS          
BEGIN          
          
 DECLARE @IMAGE_UPLOAD_ID INT -- USE TO HOLD PRIMARY KEY          
        
 SELECT @IMAGE_UPLOAD_ID = ISNULL(MAX(IMAGE_UPLOAD_ID),0) FROM TR_IMAGE_UPLOAD        
        
 INSERT INTO TR_IMAGE_UPLOAD        
 VALUES          
 (          
 @IMAGE_UPLOAD_ID + 1,    
 @IMAGE_NAME,    
 @CLIENT_ID,    
 @IMAGE_CONTENT,    
 @APPLICATION_NAME,    
 @UPLOADED_BY,    
 @UPLOADED_DATE,    
 @MODIFIED_BY,    
 @MODIFIED_DATE,
 @DDNO     
 )          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_INSERT_TR_IMG_UPLOAD
-- --------------------------------------------------
/******************************************************************************
CREATED BY: RUTVIJ PATIL
DATE: 20/09/2010
PURPOSE: USE TO INSERT DATA INTO TABLE TR_IMG_UPLOAD

MODIFIED BY: PROGRAMMER NAME
DATED: DD/MM/YYYY
REASON: REASON TO CHANGE STORE PROCEDURE
******************************************************************************/

CREATE PROCEDURE USP_INSERT_TR_IMG_UPLOAD
	
	@POPUP_NAME VARCHAR(200),
	@FOR_EMP BIT,
	@FOR_SB_ADMIN BIT,
	@FOR_SB_USER BIT,
	@DATE_FROM DATETIME,
	@TIME_FROM VARCHAR(5),
	@DATE_TO DATETIME,
	@TIME_TO VARCHAR(5),
	@IMG_NAME VARCHAR(200),
	@IMG_CONTENT VARBINARY(MAX),
	@HLINK_REQD BIT,
	@FILE_NAME VARCHAR(200),
	@FILE_CONTENT VARBINARY(MAX),
	@CREATED_BY VARCHAR(100),
	@CREATED_DATE DATETIME,
	@MODIFIED_BY VARCHAR(100),
	@MODIFIED_DATE DATETIME

AS
BEGIN

	DECLARE @IMG_UPLOAD_ID INT -- USE TO HOLD PRIMARY KEY

	SELECT @IMG_UPLOAD_ID = ISNULL(MAX(IMG_UPLOAD_ID),0) FROM TR_IMG_UPLOAD

	INSERT INTO TR_IMG_UPLOAD
	VALUES
	(
		@IMG_UPLOAD_ID + 1,
		@POPUP_NAME,
		@FOR_EMP,
		@FOR_SB_ADMIN,
		@FOR_SB_USER,
		@DATE_FROM,
		@TIME_FROM,
		@DATE_TO,
		@TIME_TO,
		@IMG_NAME,
		@IMG_CONTENT,
		@HLINK_REQD,
		@FILE_NAME,
		@FILE_CONTENT,
		@CREATED_BY,
		@CREATED_DATE,
		@MODIFIED_BY,
		@MODIFIED_DATE
	)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_IPDATA
-- --------------------------------------------------
   CREATE PROCEDURE USP_IPDATA 
   @FILENAME AS VARCHAR(25)   
   AS    
   BEGIN    
    INSERT INTO [196.1.115.211].BIDB.DBO.IP_LOC_IND_TBL1    
    SELECT * FROM TBL_IPDATA_TEMP    
    EXCEPT    
    SELECT * FROM [196.1.115.211].BIDB.DBO.IP_LOC_IND_TBL1    
    TRUNCATE TABLE TBL_IPDATA_TEMP
   END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_IPDATA_UPDATE
-- --------------------------------------------------
/******************************************************************************  
CREATED BY: SHIVAKUMAR LAKKAMPELLI  
DATE: 01/11/2010  
PURPOSE: USED TO UPDATE IPDATA IN FDS  
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
 
CREATE PROCEDURE USP_IPDATA_UPDATE  
(  
 @FILENAME AS VARCHAR(100)  
)  
  
AS  
BEGIN  
  select * into #IP_LOC_IND_TBL1 from [196.1.115.211].BIDB.DBO.IP_LOC_IND_TBL1    with (nolock)
  
 INSERT INTO [196.1.115.211].BIDB.DBO.IP_LOC_IND_TBL1   
 SELECT distinct * FROM  TEMP_IP_LOC_IND_TBL1 a where not exists
 (select * from  #IP_LOC_IND_TBL1 b where a.ipfrom=b.ipfrom and a.ipto=b.ipto and a.countryshort=b.countryshort 
 and a.country=b.country and a.[state]=b.[state] and a.city=b.city and a.isp=b.isp )  
  --[196.1.115.211].BIDB.DBO.
 --DELETE FROM [196.1.115.211].BIDB.DBO.TEMP_IP_LOC_IND_TBL1   
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_IPO_Dailfeed_upload
-- --------------------------------------------------
CREATE proc USP_IPO_Dailfeed_upload                   
(                                    
@filename as varchar(200)                                    
)                                     
as                                        
set transaction  isolation  level read uncommitted                                        
                            
declare @path as varchar(200)                                    
declare @sql as varchar(1000)                                 
--declare @filename as varchar(100)                                    
--set @filename = 'daily_feed.txt'                            
                          
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\ipo\' + @filename                                    
                          
truncate table daily_feed                          
                
SET @SQL = 'BULK INSERT daily_feed FROM '''+@Path+''' WITH (FirstRow=2,KeepNULLS)'      
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_IPO_inc_cal_upload
-- --------------------------------------------------
CREATE proc USP_IPO_inc_cal_upload                
(                                  
@filename as varchar(200)                                  
)                                   
as                                      
set transaction  isolation  level read uncommitted                                      
                          
declare @path as varchar(200)                                  
declare @sql as varchar(1000)                               
--declare @filename as varchar(100)                                  
--set @filename = 'Book1.txt'                          
                        
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\ipo\' + @filename      
truncate table ipo_tranpur     
--SET @SQL = 'select * into ipo_tranpur  FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'              
SET @SQL = 'BULK INSERT ipo_tranpur FROM '''+@Path+''' WITH (FirstRow=2,KeepNULLS)'    
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_IPO_RECO
-- --------------------------------------------------
Create Proc USP_IPO_RECO
as

select [INSTRUMENT NUMBER] AS chq_num,
[Application Number] as App_num,
[Investor Name] as Appl_Name,
AMOUNT as Amt INTO #daily_feed from daily_feed

select [Cheque No] AS chq_num_y,
[App No] as App_num_y,
Applicant as Appl_Name_y,
AMOUNT as Amt_y  INTO #tr_entry from tr_entry


---Ist Condition all Parameters

select * into #all from
(SELECT * FROM #daily_feed)x
full outer join
(SELECT * FROM #tr_entry) y
on rtrim(ltrim(
replace(x.chq_num,' ','')
)) = rtrim(ltrim(replace(y.chq_num_y,' ',''))) and 
rtrim(ltrim(replace(x.App_num,' ',''))) = rtrim(ltrim(replace(y.App_num_y,' ',''))) 
and rtrim(ltrim(replace(x.Appl_Name,' ',''))) = rtrim(ltrim(replace(y.Appl_Name_y,' ','')))
and rtrim(ltrim(replace(x.Amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))


/*
select * from #all where 
(
Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null and
Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null
)
*/
-----------------3 Parameters

select * into #3p from #all where 
(
Chq_num is null or App_num is null or Appl_Name is null or Amt is null or
Chq_num_y is null or App_num_y is null or Appl_Name_y is null or Amt_y is null
/*Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null and
Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null*/
)

select * from #3p

-----------------------1,2,3---

----------------------Name Mismatch
select count(*) from #Name

select * into #Name from 
(select chq_num,App_num,Appl_Name,Amt from #3p where Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null) x 
inner join
(select chq_num_y,App_num_y,Appl_Name_y,Amt_y from #3p where Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null) y
on 
rtrim(ltrim(replace(x.Chq_num,' ',''))) = rtrim(ltrim(replace(y.Chq_num_y,' ',''))) and
rtrim(ltrim(replace(x.App_num,' ',''))) = rtrim(ltrim(replace(y.App_num_y,' ',''))) 
and rtrim(ltrim(replace(x.amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))


----------------------Cheque Mismatch
select * into #cheque from 
(select chq_num,App_num,Appl_Name,Amt from #3p where Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null) x 
inner join
(select chq_num_y,App_num_y,Appl_Name_y,Amt_y from #3p where Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null) y
on 
rtrim(ltrim(replace(x.Appl_Name,' ',''))) = rtrim(ltrim(replace(y.Appl_Name_y,' ',''))) and
rtrim(ltrim(replace(x.App_num,' ',''))) = rtrim(ltrim(replace(y.App_num_y,' ',''))) 
and rtrim(ltrim(replace(x.amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))


----------------------App No Mismatch
select * into #App_num from 
(select chq_num,App_num,Appl_Name,Amt from #3p where Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null) x 
inner join
(select chq_num_y,App_num_y,Appl_Name_y,Amt_y from #3p where Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null) y
on 
rtrim(ltrim(replace(x.Appl_Name,' ',''))) = rtrim(ltrim(replace(y.Appl_Name_y,' ',''))) and
rtrim(ltrim(replace(x.chq_num,' ',''))) = rtrim(ltrim(replace(y.chq_num_y,' ',''))) 
and rtrim(ltrim(replace(x.amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))


----------------------Amt Mismatch
select * into #amt from 
(select chq_num,App_num,Appl_Name,Amt from #3p where Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null) x 
inner join
(select chq_num_y,App_num_y,Appl_Name_y,Amt_y from #3p where Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null) y
on 
rtrim(ltrim(replace(x.Appl_Name,' ',''))) = rtrim(ltrim(replace(y.Appl_Name_y,' ',''))) and
rtrim(ltrim(replace(x.chq_num,' ',''))) = rtrim(ltrim(replace(y.chq_num_y,' ',''))) 
and rtrim(ltrim(replace(x.App_num,' ',''))) = rtrim(ltrim(replace(y.App_num_y,' ','')))


-------------------end with 3 parameters--------------


------------------------Balance Records for match 2 paramerters-----------
select chq_num,App_num,Appl_Name,Amt from #3p where (Chq_num is not null and App_num is not null and Appl_Name is not null and Amt is not null)
and 
rtrim(ltrim(replace(chq_num,' ','')))+
rtrim(ltrim(replace(App_num,' ','')))+
rtrim(ltrim(replace(Appl_Name,' ','')))+
rtrim(ltrim(replace(Amt,' ',''))) not in
(
select 
rtrim(ltrim(replace(chq_num,' ','')))+
rtrim(ltrim(replace(App_num,' ','')))+
rtrim(ltrim(replace(Appl_Name,' ','')))+
rtrim(ltrim(replace(Amt,' ','')))
 from
(
select * from #Name
union
select * from #cheque
union
select * from #App_num
union
select * from #amt
) x
)



select chq_num_y,App_num_y,Appl_Name_y,Amt_y into #2p_2 from #3p where (Chq_num_y is not null and App_num_y is not null and Appl_Name_y is not null and Amt_y is not null)
and  rtrim(ltrim(replace(chq_num_y,' ','')))+
rtrim(ltrim(replace(App_num_y,' ','')))+
rtrim(ltrim(replace(Appl_Name_y,' ','')))+
rtrim(ltrim(replace(Amt_y,' ',''))) not in
(
select 
rtrim(ltrim(replace(chq_num_y,' ','')))+
rtrim(ltrim(replace(App_num_y,' ','')))+
rtrim(ltrim(replace(Appl_Name_y,' ','')))+
rtrim(ltrim(replace(Amt_y,' ','')))
 from
(
select * from #Name
union
select * from #cheque
union
select * from #App_num
union
select * from #amt
) x
)

------------------------Chque No and Application No

select *  from
(select * from #2p_1)x
inner join
(select * from #2p_2)y  on
rtrim(ltrim(replace(x.chq_num,' ',''))) = rtrim(ltrim(replace(y.chq_num_y,' ',''))) and
rtrim(ltrim(replace(x.App_Num,' ',''))) = rtrim(ltrim(replace(y.App_Num_y,' ','')))


------------------------Chque No and Application Name

select * from
(select * from #2p_1)x
inner join
(select * from #2p_2)y  on
rtrim(ltrim(replace(x.chq_num,' ',''))) = rtrim(ltrim(replace(y.chq_num_y,' ',''))) and
rtrim(ltrim(replace(x.Appl_Name,' ',''))) = rtrim(ltrim(replace(y.Appl_Name_y,' ','')))


------------------------Chque No and Amount

select * from
(select * from #2p_1)x
inner join
(select * from #2p_2)y  on
rtrim(ltrim(replace(x.chq_num,' ',''))) = rtrim(ltrim(replace(y.chq_num_y,' ',''))) and
rtrim(ltrim(replace(x.amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))


------------------------App No and Name

select * from
(select * from #2p_1)x
inner join
(select * from #2p_2)y  on
rtrim(ltrim(replace(x.app_num,' ',''))) = rtrim(ltrim(replace(y.app_num_y,' ',''))) and
rtrim(ltrim(replace(x.Appl_Name,' ',''))) = rtrim(ltrim(replace(y.Appl_Name_y,' ','')))


------------------------App No and Amt

select * from
(select * from #2p_1)x
inner join
(select * from #2p_2)y  on
rtrim(ltrim(replace(x.app_num,' ',''))) = rtrim(ltrim(replace(y.app_num_y,' ',''))) and
rtrim(ltrim(replace(x.amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))


------------------------App Name and Amt

select * from
(select * from #2p_1)x
inner join
(select * from #2p_2)y  on
rtrim(ltrim(replace(x.appl_name,' ',''))) = rtrim(ltrim(replace(y.appl_name_y,' ',''))) and
rtrim(ltrim(replace(x.amt,' ',''))) = rtrim(ltrim(replace(y.amt_y,' ','')))

----------------------------End With 2 Parameters

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_IPO_Trentry_upload
-- --------------------------------------------------
CREATE proc USP_IPO_Trentry_upload                   
(                                    
@filename as varchar(100)                                    
)                                     
as                                        
set transaction  isolation  level read uncommitted                                        
                            
declare @path as varchar(200)                                    
declare @sql as varchar(1000)                                 
 --declare @filename as varchar(100)                                    
--set @filename = 'tr_entries.txt'                            
                          
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\ipo\' + @filename                                    
                          
truncate table tr_entry                          
                
SET @SQL = 'BULK INSERT tr_entry FROM '''+@Path+''' WITH ( FirstRow=2,KeepNULLS)'                                    
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Kotak_Bank
-- --------------------------------------------------
CREATE proc USP_Kotak_Bank    
(              
@filename as varchar(100)              
)               
as                  
    
set transaction  isolation  level read uncommitted                    
declare @path as varchar(100)                
declare @sql as varchar(1000)                 
    
Create table #x    
(    
Fld_Date varchar(50),    
Fld_Desc varchar(100),    
Fld_ChqNo varchar(50),    
Fld_Value_Date varchar(50),    
Fld_Wit_Amt varchar(50),    
Fld_Dep_amt varchar(50),    
Fld_Bal varchar(50)    
)     
    
set @path='d:\upload1\' + @filename      
SET @SQL = 'BULK INSERT #x FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=7,KeepNULLS)'                
--print @SQL                
exec (@sql)                
    
insert into tbl_Upload_Kotak    
select * from #x where Fld_Date+Fld_Desc+Fld_wit_amt+Fld_Dep_amt Not in    
(select Fld_Date+Fld_Desc+Fld_wit_amt+Fld_Dep_amt from tbl_Upload_Kotak (nolock))    
select @@rowcount

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC
-- --------------------------------------------------
CREATE Proc USP_KYC(@file as varchar(50))          
as          
          
declare @path as varchar(100)                                  
declare @SQL as varchar(500)                                  
          
set @path= 'd:\upload1\' + @file  
truncate table tbl_ODin                   
    
set @sql = 'BULK INSERT tbl_ODin FROM '''+@path+''' WITH (FIELDTERMINATOR = ''\t'', FirstRow=2,KeepNULLS)'                  
exec(@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Kyc_clientupload_Data
-- --------------------------------------------------
CREATE proc usp_Kyc_clientupload_Data        
(                                              
@filename as varchar(100)                                              
)                                               
as                                                  
set transaction  isolation  level read uncommitted                                                  
                                      
declare @path as varchar(100)                                              
declare @sql as varchar(1000)                                           
-- declare @filename as varchar(100)                                              
-- set @filename = 'IT_Events'                                      
                                    
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\120209 BOUNCE.xls' --+ @filename                                              
                                    
truncate table tbl_clientdata                   
                                    
SET @SQL = 'insert into tbl_clientdata select *  FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                                    
--print @sql                    
exec (@SQL)                       
  
insert into tbl_clientdata_record                  
--select Ddate+Destination_Name+Client_ID+Client_Name+Pin_code+F7+F8+F9,F10,F11,F12 from tbl_clientbulkupload            
select branch_cd,sub_broker,clientcode,clientname,emailid,mobile1,  
resphone1,telcaller,code1,remark1,minorchangeid,newid from  tbl_clientdata    
where  
(Branch_cd+Sub_broker+ClientCode)not in  
(Select Branch_cd+Sub_broker+ClientCode from tbl_clientdata_record)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_New
-- --------------------------------------------------
CREATE Proc USP_KYC_New(@file as varchar(50),@access_code as varchar(50))                  
as                  
                  
declare @path as varchar(100)                                          
declare @str as varchar(5000)                                          
declare @tablename as varchar(1000)  
  
  
set @path= 'd:\upload1\' + @file       
   
set @tablename = 'tbl_odin_'+@access_code                      

  
set @str='Truncate table '+@tablename+''                   
exec(@str)

set @str = 'BULK INSERT '+@tablename+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=2,KeepNULLS)'                          
exec(@str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_New_1
-- --------------------------------------------------
CREATE PROC USP_KYC_NEW_1(@FILE AS VARCHAR(50),@ACCESS_CODE AS VARCHAR(50),@SERVERADD AS VARCHAR(30))
AS

DECLARE @PATH AS VARCHAR(50)
DECLARE @STR AS VARCHAR(5000)
DECLARE @RESULT AS VARCHAR(10)
DECLARE @TBLNAME AS VARCHAR(20)

SET @PATH= '\\'+ @SERVERADD +'\D$\UPLOAD1\' + @FILE
SET @TBLNAME = 'TBL_ODIN_'+@ACCESS_CODE+''

SET @RESULT = (SELECT COUNT(*) FROM SYSOBJECTS WHERE NAME = @TBLNAME)

TRUNCATE TABLE TBL_ODIN_NEW

IF @RESULT = '0'
BEGIN
	
	SET @STR = 'SELECT TOP 0 * INTO TBL_ODIN_'+@ACCESS_CODE+' FROM TBL_ODIN_NEW'
	EXEC (@STR)

	SET @STR = 'SELECT TOP 0 * INTO TBL_RECO_'+@ACCESS_CODE+' FROM TBL_RECO'
	EXEC (@STR)

	SET @STR = 'BULK INSERT '+@TBLNAME+' FROM '''+@PATH+''' WITH (FIELDTERMINATOR = ''|'', FIRSTROW=2,KEEPNULLS)'
	EXEC (@STR)

END
ELSE

BEGIN

	SET @STR = 'TRUNCATE TABLE '+@TBLNAME+''
	EXEC (@STR)

	SET @STR = 'BULK INSERT '+@TBLNAME+' FROM '''+@PATH+''' WITH (FIELDTERMINATOR = ''|'', FIRSTROW=2,KEEPNULLS)'
	EXEC (@STR)

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_New_2
-- --------------------------------------------------
CREATE Proc USP_KYC_New_2(@file as varchar(50),@access_code as varchar(50),@UserName as Varchar(15))                            
as                                                          
            
declare @path as varchar(50)                          
declare @str as varchar(5000)            
Declare @result as varchar(10)            
Declare @tblname as varchar(20)            
                   
set @path= 'd:\upload1\' + @file               
set @tblname = 'tbl_Odin_'+@access_code+''            
    
Begin Transaction    
    
set @str = 'Drop table '+@tblname+' ; Drop table tbl_reco_'+@access_code+''            
exec (@str)            
     
          
set @str = 'Select Top 0 * into tbl_Odin_'+@access_code+' from tbl_ODin_new'            
exec (@str)            
          
set @str = 'Select Top 0 * into tbl_reco_'+@access_code+' from tbl_reco'          
exec (@str)          
            
set @str = 'BULK INSERT '+@tblname+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS)'                                    
exec (@str)            
         
set @str = 'Alter table '+@tblname+' add UserName varchar(15),Flag bit'      
exec (@str)   
  
set @str = 'Update '+@tblname+' Set Username = '''+@Username+''',Flag = 1'      
exec (@str)        
    
Commit

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_New_inhouse
-- --------------------------------------------------
CREATE Proc USP_KYC_New_inhouse(@file as varchar(50),@access_code as varchar(50),@serveradd as varchar(30))                                    
as                                                                  
                    
declare @path as varchar(50)                                  
declare @str as varchar(5000)                    
Declare @result as varchar(10)                    
Declare @tblname as varchar(20)                    
                             
set @path= '\\'+ @serveradd +'\d\upload1\' + @file                       
set @tblname = 'tbl_Odin_'+@access_code+''                    
              
set @result = (select count(*) from sysobjects where Name = @tblname)                    
                    
truncate table tbl_ODin_new                       
                    
If @result = '0'                    
Begin                              
 set @str = 'Select Top 0 * into tbl_Odin_'+@access_code+' from tbl_ODin_new'                    
 exec (@str)                    
                   
 set @str = 'Select Top 0 * into tbl_reco_'+@access_code+' from tbl_reco'                  
 exec (@str)                  
                     
 set @str = 'BULK INSERT '+@tblname+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=2,KeepNULLS)'                                            
 exec (@str)                      
End                    
Else                    
Begin                             
 set @str = 'Truncate table '+@tblname+''                    
 exec (@str)                    
               
 set @str = 'BULK INSERT '+@tblname+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=2,KeepNULLS)'                                            
 exec (@str)                  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_NEW_PATCH
-- --------------------------------------------------
CREATE PROC USP_KYC_NEW_PATCH(@FILE AS VARCHAR(50),@ACCESS_CODE AS VARCHAR(50),@SERVERADD AS VARCHAR(30))
AS
SET NOCOUNT ON

DECLARE @PATH AS VARCHAR(50)
DECLARE @STR AS VARCHAR(5000)
DECLARE @RESULT AS VARCHAR(10)
DECLARE @TBLNAME AS VARCHAR(20)

SET @PATH= '\\'+ @SERVERADD +'\D$\UPLOAD1\' + @FILE
SET @TBLNAME = 'TBL_ODIN_'+@ACCESS_CODE+''

SET @RESULT = (SELECT COUNT(*) FROM SYSOBJECTS WHERE NAME = @TBLNAME)

TRUNCATE TABLE TBL_ODIN_PATCH

IF @RESULT = '0'
BEGIN
	
	SET @STR = 'SELECT TOP 0 * INTO TBL_ODIN_'+@ACCESS_CODE+' FROM TBL_ODIN_PATCH'
	EXEC (@STR)

	SET @STR = 'SELECT TOP 0 * INTO TBL_RECO_'+@ACCESS_CODE+' FROM TBL_RECO'
	EXEC (@STR)

	SET @STR = 'BULK INSERT '+@TBLNAME+' FROM '''+@PATH+''' WITH (FIELDTERMINATOR = ''|'', FIRSTROW=2,KEEPNULLS)'
	EXEC (@STR)

END
ELSE

BEGIN

	SET @STR = 'DROP TABLE '+@TBLNAME+''
	EXEC (@STR)

	SET @STR = 'SELECT TOP 0 * INTO TBL_ODIN_'+@ACCESS_CODE+' FROM TBL_ODIN_PATCH'
	EXEC (@STR)


	SET @STR = 'TRUNCATE TABLE '+@TBLNAME+''
	EXEC (@STR)

	SET @STR = 'BULK INSERT '+@TBLNAME+' FROM '''+@PATH+''' WITH (FIELDTERMINATOR = ''|'', FIRSTROW=2,KEEPNULLS)'
	--PRINT @STR
	EXEC (@STR)

END

SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_ODIN_Mismatch
-- --------------------------------------------------
CREATE Proc USP_KYC_ODIN_Mismatch                      
as                      
                      
-------------------------Odin File-----------------------                      
select x.party_code,y.* into #Odin_file from                      
(select * from tbl_ODin_new (nolock)) x                      
left outer join                      
(select * from segments (nolock)) y on rtrim(ltrim(x.segment)) = rtrim(ltrim(y.No))                        
                      
---------------------client details                      
select distinct x.* into #client_det from                      
(                      
select                       
cl_code,                      
long_name,                      
branch_cd,                      
sub_broker,                      
isnull(bsecm,'N') as bsecm,                      
isnull(nsecm,'N') as nsecm,                      
isnull(nsefo,'N') as fo,                      
isnull(mcdx,'N') as mcdx,                      
isnull(ncdx,'N') as ncdex,                      
isnull(bsefo,'N') as bse_fo                      
from intranet.risk.dbo.client_details where First_Active_Date <= getdate()) x                      
inner join                      
(select * from #Odin_file) y                      
on x.cl_code = y.party_code                      
                      
                      
-----------------client details no                      
select a.*,b.No into #cli_no from                      
(select * from #client_det) a                      
left outer join                      
(select * from segments (nolock)) b                       
ON A.bsecm = B.BSE AND A.NSEcm = B.NSE AND A.FO = B.NSEFO                       
AND A.MCDX = B.MCX AND A.NCDeX = B.NCDX AND A.BSE_FO = B.BSEFO                         
                  
            
select x.party_code,y.long_name,             
case when y.bsecm = 'N' then '0' else '8' end as bsecm,                    
case when y.nsecm = 'N' then '0' else '1' end as nsecm,                    
case when y.fo = 'N' then '0' else '2' end as fo,                    
case when y.mcdx = 'N' then '0' else '16' end as mcdx,                    
case when y.ncdex = 'N' then '0'  else '64' end as ncdex,                    
case when y.bse_fo = 'N' then '0' else '4' end as bse_fo                    
into #x from                       
(select * from #Odin_file) x                      
inner join                    
(select * from #cli_no) y                      
on x.party_code = y.cl_code and x.no <> y.no                  
            
            
select party_Code,Long_name,        
convert(varchar,convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex)+convert(int,bse_fo)) as Seg into #y from #x            
          
truncate table   tbl_reco          
            
insert into tbl_reco          
select Opcode+'|'+x.Party_Code+'|'+Branch_cd+'|'+Client_name+'|'+isnull(Passwrd,'')+'|'+Category+'|'+isnull(Address1,'')+'|'+isnull(Address2,'')+'|'          
+isnull(City,'')+'|'+isnull(State_pin,'')+'|'+isnull(Telephone_No,'')+'|'+isnull(FaxNo,'')+'|'+isnull(Email,'')+'|'+status+'|'+isnull(Brokerage,'')+'|'+isnull(Surv_On_Off,'')+'|'+isnull(Surv_Auto_Manual,'')+'|'          
+isnull(BankDPOnOff,'')+'|'+isnull(ParticipantCode,'')+'|'+isnull(Filler1,'')+'|'+isnull(Filler2,'')+'|'+isnull(Filler3,'')+'|'+isnull(Filler4,'')+'|'+isnull(y.seg,'')+'|'+isnull(ClientValidationOnOff,'')+'|'          
+isnull(SpanOnOff,'')+'|'+isnull(DervPartCode,'')+'|'+isnull(IP_Address,'')+'|'+isnull(MaxNoOfOrder,'')+'|'+isnull(Max_BCast_Scrips,'')+'|'+isnull(Alias_DealerId,'')+'|'+isnull(Family_Name,'')+'|'+isnull(EqFlag,'')+'|'+          
isnull(DervFlag,'')+'|'+isnull(CombFlag,'')+'|'+isnull(BSEEq,'')+'|'+isnull(NEBEComb,'')+'|'+isnull(NEBEEq,'')+'|'+isnull(NSE_Cash_CTCL_BranchId,'')+'|'+isnull(NSE_Cash_CTCL_Id,'')+'|'+isnull(Branch_Name,'')+'|'+          
isnull(Derv_CTCL_BranchId,'')+'|'+isnull(Derv_CTCL_Id,'')+'|'+isnull(Group_Admin,'')+'|'+isnull(BSE_Cash_CTCL_BranchId,'')+'|'+isnull(BSE_Cash_CTCL_Id,'')+'|'+isnull(y.Seg,'')+'|'+          
isnull(ParticipantType,'')+'|'+isnull(DIET,'')+'|'+isnull(Net,'')+'|'+isnull(iWin,'')+'|'+isnull(NetNetLite,'')+'|'+isnull(MCX_CTCL_BranchId,'')+'|'+isnull(MCX_CTCLId,'')+'|'+isnull(NCDEX_CTCLBranchId,'')+'|'+          
isnull(NCDEXCTCL_Id,'')+'|'+isnull(ProductType,'') from (select * from tbl_ODin_new  (nolock)) x          
inner join (select * from #y) y on x.party_code = y.party_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_ODIN_Mismatch_inhouse
-- --------------------------------------------------
CREATE Proc [dbo].[USP_KYC_ODIN_Mismatch_inhouse](@access_code as varchar(50),@BranchCd as Varchar(15),@EmpCode varchar(30))                                                                                    
as                                                                                         
                                                            
                                                            
Declare @tblname as varchar(20)                                                              
Declare @tblname1 as varchar(20)                                                              
                                                      
set @tblname = 'tbl_Odin_'+@access_code+''                                                              
set @tblname1 = 'tbl_reco_'+@access_code+''                                                              
                                                              
/*                                                           
Declare @access_code as varchar(20)                                                              
set @access_code = 'ACM'                                                            
print @tblname                                                            
*/                                                        
                                                                             
-------------------------Odin File-----------------------                                                                                    
--Declare @str1 as varchar(1000)                                                    
declare @str as varchar(8000)                                                            
                                                        
set @str = ''                                                        
set @str = 'select x.party_code,y.* into #Odin_file from (select * from '+@tblname+' (nolock)) x left outer join'                                                                                    
set @str=@str+'(select * from segments (nolock)) y on rtrim(ltrim(x.segment)) = rtrim(ltrim(y.No)) '                                                                                      
                                                        
--exec (@str1)                                                      
                                                    
set @str = @str+' select distinct cl_code,case when convert(varchar,Inactive_from) > getdate() and Exchange = ''BSE'' then ''8'''                                                     
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and (Exchange = ''NSE'' and segment = ''CAPITAL'') then ''1'''                                                    
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and (Exchange = ''NSE'' and segment = ''FUTURES'') then ''2'''                                                     
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and Exchange = ''MCX'' then ''16'''                                                     
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and Exchange = ''NCX'' then ''64'''                                                     
set @str = @str+' else ''0'' end as Segment into #t from (select * from #Odin_file) x'                                                    
set @str = @str+' inner join'                                                    
set @str = @str+' (select * from AngelNseCM.msajag.dbo.client_brok_details with(nolock)) y'                                                    
set @str = @str+' on x.party_code = y.cl_code;select * into #t1 from #t where segment <> ''0'''                                                         
set @str = @str+' select *  into #temp1 from (select * from #Odin_file) x left outer join ('                                                
set @str = @str+' select cl_code,sum(convert(int,segment)) as Segment from #t1 group by cl_code )'                        
set @str = @str+' y on x.party_code = y.cl_code'                                                  
set @str = @str+' select * into #temp from #temp1 where No <> segment '                                                     
set @str = @str+' select a.party_code,b.* into #Odin_file_1 from'                         
set @str = @str+' (select * from #temp) a'                            
set @str = @str+' left outer join'                            
set @str = @str+' (select * from segments (nolock)) b'                            
set @str = @str+' on a.segment = b.no'                                 
                                                    
                                   
---------------------client details---------------------------------                                                    
set @str=@str+' select distinct bsecm=y.bse,nsecm=y.nse,fo=y.nsefo,mcdx=y.mcx,ncdex=y.ncdx,bse_fo=y.bsefo,x.* into #client_det from (select cl_code,long_name,branch_cd,sub_broker'                                                                           
  
set @str=@str+' from AngelNseCM.msajag.dbo.client_details with(nolock)) x '                                                                
set @str=@str+' inner join (select * from #Odin_file_1) y on x.cl_code = y.party_code '                                                               
                                                                                        
                                                                              
-----------------client details no---------------------------                              
set @str=@str+'Select a.*,b.No into #cli_no from (select * from #client_det) a left outer join (select * from segments (nolock)) b '                                                                                     
set @str=@str+'ON A.bsecm = B.BSE AND A.NSEcm = B.NSE AND A.FO = B.NSEFO AND A.MCDX = B.MCX AND A.NCDeX = B.NCDX AND A.BSE_FO = B.BSEFO '                                                                                                    
set @str=@str+' Select x.party_code,y.long_name,case when y.bsecm = ''N'' then ''0'' else ''8'' end as bsecm,'                                                                                  
set @str=@str+' case when y.nsecm = ''N'' then ''0'' else ''1'' end as nsecm,'                                                        
set @str=@str+' case when y.fo = ''N'' then ''0'' else ''2'' end as fo,'                                                                                  
set @str=@str+' case when y.mcdx = ''N'' then ''0'' else ''16'' end as mcdx,'                                                                                  
set @str=@str+' case when y.ncdex = ''N'' then ''0''  else ''64'' end as ncdex,'                                                                                  
set @str=@str+' case when y.bse_fo = ''N'' then ''0'' else ''4'' end as bse_fo'                                                                                  
set @str=@str+' into #x from (select * from #Odin_file_1) x'                                                                                    
set @str=@str+' inner join (select * from #cli_no) y on x.party_code = y.cl_code /*and x.no <> y.no*/ '                                                                                                                                             
set @str=@str+'alter table #x add  segallowed varchar(30); update #x set segallowed=b.segmentallowed from (select segmentallowed from intranet.Testdb.dbo.CtclMgrLocation with(nolock) where Locacode='''+@access_code+''')b '                     
set @str=@str+'select party_code,long_name,bsecm,nsecm,fo,mcdx,ncdex,bse_fo,Seg=case when segallowed=''Equity'' then convert(int,bsecm)+convert(int,nsecm)+convert(int,fo) when segallowed=''Commodities'' then convert(int,mcdx)+convert(int,ncdex) when segallowed=''Equity_Commo'' then convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex) '                     
set @str=@str+'when segallowed=''Currency_Commo'' then convert(int,mcdx)+convert(int,ncdex) when segallowed=''All'' then convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex) end into #y from #x  '      
--set @str=@str+' select party_Code,Long_name,convert(varchar,convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex)+convert(int,bse_fo)) as Seg into #y from #x '                                                         
  
    
      
set @str=@str+' select * into #y1 from #y where seg<>0 '      
set @str=@str+' Truncate table '+@tblname1+';Insert into '+@tblname1+' Select Distinct Opcode+''|''+x.Party_Code+''|''+isnull(Branch_cd,'''')+''|''+Client_name+''|''+isnull(Passwrd,'''')+''|''+Category+''|''+isnull(Address1,'''')+''|''+isnull(Address2,'''')+''|'''                              
set @str=@str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+status+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''+isnull(Surv_Auto_Manual,'''')+''|'''                                                                        
set @str=@str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Convert(varchar,y.seg),'''')+''|''+isnull(ClientValidationOnOff,'''')+''|'''                                                                        
set @str=@str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFlag,'''')+''|''+'                                                                        
set @str=@str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')+''|''+'                                                                        
set @str=@str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Convert(varchar,y.Seg),'''')+''|''+'      
set @str=@str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                             
set @str=@str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from (select * from '+@tblname+' (nolock)) x'                                                                
set @str=@str+' inner join (select * from #y1) y on x.party_code = y.party_code and x.Trading_Allowed<>y.seg'                                                                                                              
                      
--print (@str)         
      
exec(@str)                           
      
declare @log varchar(5000)      
      
set @log='update MisMatchMapping_inhouse_log set Mismatch=b.cnt,updated_on=getdate(),updated_by='''+@EmpCode+''' from (select cnt=count(*) from '+@tblname1+')b where locacode='''+@BranchCd+''''      
--print @log
exec(@log)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_ODIN_Mismatch_patch
-- --------------------------------------------------
CREATE PROC [dbo].[USP_KYC_ODIN_Mismatch_patch](@ACCESS_CODE AS VARCHAR(50))              
                    
AS                    
SET NOCOUNT ON                    
                    
DECLARE @TBLNAME AS VARCHAR(20)                    
DECLARE @TBLNAME1 AS VARCHAR(20)                    
                    
SET @TBLNAME = 'TBL_ODIN_'+@ACCESS_CODE+''                
SET @TBLNAME1 = 'TBL_RECO_'+@ACCESS_CODE+''                    
                    
/*                    
DECLARE @ACCESS_CODE AS VARCHAR(20)                    
SET @ACCESS_CODE = 'ACM'                    
PRINT @TBLNAME                    
*/                    
                    
-------------------------ODIN FILE-----------------------                    
--DECLARE @STR1 AS VARCHAR(1000)                    
DECLARE @STR AS VARCHAR(8000)                    
                    
SET @STR = ''                    
SET @STR = 'SELECT X.PARTY_CODE,Y.* INTO #ODIN_FILE FROM (SELECT * FROM '+@TBLNAME+' (NOLOCK)) X LEFT OUTER JOIN'                    
SET @STR=@STR+'(SELECT * FROM MIS.UPLOAD.DBO.SEGMENTS WITH(NOLOCK)) Y ON RTRIM(LTRIM(X.SEGMENT)) = RTRIM(LTRIM(Y.NO)) '                    
SET @STR = @STR+' SELECT DISTINCT CL_CODE,CASE WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''BSE'' THEN ''8'''                    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND (EXCHANGE = ''NSE'' AND SEGMENT = ''CAPITAL'') THEN ''1'''                    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND (EXCHANGE = ''NSE'' AND SEGMENT = ''FUTURES'') THEN ''2'''                    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''MCX'' THEN ''16'''                    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''NCX'' THEN ''64'''                    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''MCD'' THEN ''1024'''                  
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''NSX'' THEN ''2048'''                  
SET @STR = @STR+' ELSE ''0'' END AS SEGMENT INTO #T FROM (SELECT * FROM #ODIN_FILE) X'                    
SET @STR = @STR+' INNER JOIN'                    
SET @STR = @STR+' (SELECT * FROM AngelNseCM.MSAJAG.DBO.CLIENT_BROK_DETAILS WITH(NOLOCK)) Y'                    
SET @STR = @STR+' ON X.PARTY_CODE = Y.CL_CODE;SELECT * INTO #T1 FROM #T WHERE SEGMENT <> ''0'''                    
SET @STR = @STR+' SELECT * INTO #TEMP1 FROM (SELECT * FROM #ODIN_FILE) X LEFT OUTER JOIN ('                    
SET @STR = @STR+' SELECT CL_CODE,SUM(CONVERT(INT,SEGMENT)) AS SEGMENT FROM #T1 GROUP BY CL_CODE )'                    
SET @STR = @STR+' Y ON X.PARTY_CODE = Y.CL_CODE'                    
SET @STR = @STR+' SELECT * INTO #TEMP FROM #TEMP1 WHERE NO <> SEGMENT '                    
SET @STR = @STR+' SELECT A.PARTY_CODE,B.* INTO #ODIN_FILE_1 FROM'                    
SET @STR = @STR+' (SELECT * FROM #TEMP) A'                    
SET @STR = @STR+' LEFT OUTER JOIN'                    
SET @STR = @STR+' (SELECT * FROM MIS.UPLOAD.DBO.SEGMENTS WITH(NOLOCK)) B'                    
SET @STR = @STR+' ON A.SEGMENT = B.NO'                    
                    
                    
---------------------CLIENT DETAILS---------------------------------                    
SET @STR=@STR+' SELECT DISTINCT BSECM=Y.BSE,NSECM=Y.NSE,FO=Y.NSEFO,MCDX=Y.MCX,NCDEX=Y.NCDX,BSE_FO=Y.BSEFO,MCD=Y.MCD,NSX=Y.NSX,X.* INTO #CLIENT_DET FROM (SELECT CL_CODE,LONG_NAME,BRANCH_CD,SUB_BROKER'                    
SET @STR=@STR+' FROM AngelNseCM.MSAJAG.DBO.CLIENT_DETAILS WITH(NOLOCK)) X '                    
SET @STR=@STR+' INNER JOIN (SELECT * FROM #ODIN_FILE_1) Y ON X.CL_CODE = Y.PARTY_CODE '                    
                    
                    
-----------------CLIENT DETAILS NO---------------------------                    
SET @STR=@STR+'SELECT A.*,B.NO INTO #CLI_NO FROM (SELECT * FROM #CLIENT_DET) A LEFT OUTER JOIN (SELECT * FROM MIS.UPLOAD.DBO.SEGMENTS WITH(NOLOCK)) B '                    
SET @STR=@STR+'ON A.BSECM = B.BSE AND A.NSECM = B.NSE AND A.FO = B.NSEFO AND A.MCDX = B.MCX AND A.NCDEX = B.NCDX AND A.BSE_FO = B.BSEFO and A.NSX=B.NSX'                    
SET @STR=@STR+' SELECT X.PARTY_CODE,Y.LONG_NAME,CASE WHEN Y.BSECM = ''N'' THEN ''0'' ELSE ''8'' END AS BSECM,'                    
SET @STR=@STR+' CASE WHEN Y.NSECM = ''N'' THEN ''0'' ELSE ''1'' END AS NSECM,'                    
SET @STR=@STR+' CASE WHEN Y.FO = ''N'' THEN ''0'' ELSE ''2'' END AS FO,'                    
SET @STR=@STR+' CASE WHEN Y.MCDX = ''N'' THEN ''0'' ELSE ''16'' END AS MCDX,'                    
SET @STR=@STR+' CASE WHEN Y.NCDEX = ''N'' THEN ''0'' ELSE ''64'' END AS NCDEX,'                    
SET @STR=@STR+' CASE WHEN Y.BSE_FO = ''N'' THEN ''0'' ELSE ''4'' END AS BSE_FO,'                    
SET @STR=@STR+' CASE WHEN Y.MCD = ''N'' THEN ''0'' ELSE ''1024'' END AS MCD,'                  
SET @STR=@STR+' CASE WHEN Y.NSX = ''N'' THEN ''0'' ELSE ''2048'' END AS NSX'
SET @STR=@STR+' INTO #X FROM (SELECT * FROM #ODIN_FILE_1) X'                    
SET @STR=@STR+' INNER JOIN (SELECT * FROM #CLI_NO) Y ON X.PARTY_CODE = Y.CL_CODE /*AND X.NO <> Y.NO*/ '                    
SET @STR=@STR+' ALTER TABLE #X ADD SEGALLOWED VARCHAR(30); UPDATE #X SET SEGALLOWED=B.SEGMENTALLOWED FROM (SELECT SEGMENTALLOWED FROM INTRANET.TESTDB.DBO.CTCLMGRLOCATION WITH(NOLOCK) WHERE LOCACODE='''+@ACCESS_CODE+''')B '                    
SET @STR=@STR+' SELECT PARTY_CODE,LONG_NAME,BSECM,NSECM,FO,MCDX,NCDEX,BSE_FO,MCD,SEG=CASE WHEN SEGALLOWED=''EQUITY'' THEN CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO) WHEN SEGALLOWED=''COMMODITIES'' THEN CONVERT(INT,MCDX)+CONVERT(INT,NCDEX) '    
  
   
       
        
          
            
              
                
SET @STR=@STR+' WHEN SEGALLOWED=''EQUITY_COMMO'' THEN CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO)+CONVERT(INT,MCDX)+CONVERT(INT,NCDEX) '                    
SET @STR=@STR+'WHEN SEGALLOWED=''CURRENCY_COMMO'' THEN CONVERT(INT,MCDX)+CONVERT(INT,NCDEX)+CONVERT(INT,MCD)+CONVERT(INT,NSX) WHEN SEGALLOWED=''ALL'' THEN CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO)+CONVERT(INT,MCDX)+CONVERT(INT,NCDEX)+         
  
   
CONVERT(INT,MCD)+CONVERT(INT,NSX) END INTO #Y FROM #X '            
--SET @STR=@STR+' SELECT PARTY_CODE,LONG_NAME,CONVERT(VARCHAR,CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO)+CONVERT(INT,MCDX)+CONVERT(INT,NCDEX)+CONVERT(INT,BSE_FO)) AS SEG INTO #Y FROM #X '                    
SET @STR=@STR+' SELECT * INTO #Y1 FROM #Y WHERE SEG<>0 '                    
SET @STR=@STR+' TRUNCATE TABLE '+@TBLNAME1+';INSERT INTO '+@TBLNAME1+' SELECT DISTINCT OPCODE+''|''+X.PARTY_CODE+''|''+ISNULL(BRANCH_CD,'''')+''|''+CLIENT_NAME+''|''+ISNULL(PASSWRD,'''')+''|''+CATEGORY+''|''+ISNULL(ADDRESS1,'''')+''|'''                   
 
SET @STR=@STR+' +ISNULL(ADDRESS2,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(CITY,'''')+''|''+ISNULL(STATE_PIN,'''')+''|''+ISNULL(TELEPHONE_NO,'''')+''|''+ISNULL(FAXNO,'''')+''|''+ISNULL(EMAIL,'''')+''|''+STATUS+''|''+ISNULL(BROKERAGE,'''')+''|''+ISNULL(SURV_ON_OFF,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(SURV_AUTO_MANUAL,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(BANKDPONOFF,'''')+''|''+ISNULL(PARTICIPANTCODE,'''')+''|''+ISNULL(FILLER1,'''')+''|''+ISNULL(FILLER2,'''')+''|''+ISNULL(FILLER3,'''')+''|''+ISNULL(FILLER4,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(CONVERT(VARCHAR,Y.SEG),'''')+''|''+ISNULL(CLIENTVALIDATIONONOFF,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(SPANONOFF,'''')+''|''+ISNULL(DERVPARTCODE,'''')+''|''+ISNULL(IP_ADDRESS,'''')+''|''+ISNULL(MAXNOOFORDER,'''')+''|''+ISNULL(MAX_BCAST_SCRIPS,'''')+''|''+ISNULL(ALIAS_DEALERID,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(FAMILY_NAME,'''')+''|''+ISNULL(EQFLAG,'''')+''|''+'                    
SET @STR=@STR+' ISNULL(DERVFLAG,'''')+''|''+ISNULL(COMBFLAG,'''')+''|''+ISNULL(BSEEQ,'''')+''|''+ISNULL(NEBECOMB,'''')+''|''+ISNULL(NEBEEQ,'''')+''|''+ISNULL(NSE_CASH_CTCL_BRANCHID,'''')+''|'''                    
SET @STR=@STR+' +ISNULL(NSE_CASH_CTCL_ID,'''')+''|''+ISNULL(BRANCH_NAME,'''')+''|''+'                    
SET @STR=@STR+' ISNULL(DERV_CTCL_BRANCHID,'''')+''|''+ISNULL(DERV_CTCL_ID,'''')+''|''+ISNULL(GROUP_ADMIN,'''')+''|''+ISNULL(BSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(BSE_CASH_CTCL_ID,'''')+''|''+ISNULL(CONVERT(VARCHAR,Y.SEG),'''')+''|''+'            
                
--SET @STR=@STR+' ISNULL(PARTICIPANTTYPE,'''')+''|''+ISNULL(DIET,'''')+''|''+ISNULL(NET,'''')+''|''+ISNULL(IWIN,'''')+''|''+ISNULL(NETNETLITE,'''')+''|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|'''          
SET @STR=@STR+' ISNULL(PARTICIPANTTYPE,'''')+''|0|0|0|0|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|'''         
                  
SET @STR=@STR+' +ISNULL(MCX_CTCLID,'''')+''|''+ISNULL(NCDEX_CTCLBRANCHID,'''')+''|''+'                  
SET @STR=@STR+' ISNULL(NCDEXCTCL_ID,'''')+''|''+ISNULL(LEFT(PRODUCTTYPE,13),'''')+''|||||||||||||||''+ISNULL(Market_Data_Allowed,'''')+''|||||||||''       
FROM (SELECT * FROM '+@TBLNAME+' (NOLOCK)) X'                    
SET @STR=@STR+' INNER JOIN (SELECT * FROM #Y1) Y ON X.PARTY_CODE = Y.PARTY_CODE AND X.TRADING_ALLOWED<>Y.SEG'                    
                    
--PRINT (@STR)                   
EXEC(@STR)                    
                    
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_ODIN_MISMATCH_PATCH23012012
-- --------------------------------------------------
CREATE PROC [dbo].[USP_KYC_ODIN_MISMATCH_PATCH23012012](@ACCESS_CODE AS VARCHAR(50))    
    
AS    
SET NOCOUNT ON    
    
DECLARE @TBLNAME AS VARCHAR(20)    
DECLARE @TBLNAME1 AS VARCHAR(20)    
    
SET @TBLNAME = 'TBL_ODIN_'+@ACCESS_CODE+''    
SET @TBLNAME1 = 'TBL_RECO_'+@ACCESS_CODE+''    
    
/*    
DECLARE @ACCESS_CODE AS VARCHAR(20)    
SET @ACCESS_CODE = 'ACM'    
PRINT @TBLNAME    
*/    
    
-------------------------ODIN FILE-----------------------    
--DECLARE @STR1 AS VARCHAR(1000)    
DECLARE @STR AS VARCHAR(8000)    
    
SET @STR = ''    
SET @STR = 'SELECT X.PARTY_CODE,Y.* INTO #ODIN_FILE FROM (SELECT * FROM '+@TBLNAME+' (NOLOCK)) X LEFT OUTER JOIN'    
SET @STR=@STR+'(SELECT * FROM SEGMENTS (NOLOCK)) Y ON RTRIM(LTRIM(X.SEGMENT)) = RTRIM(LTRIM(Y.NO)) '    
SET @STR = @STR+' SELECT DISTINCT CL_CODE,CASE WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''BSE'' THEN ''8'''    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND (EXCHANGE = ''NSE'' AND SEGMENT = ''CAPITAL'') THEN ''1'''    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND (EXCHANGE = ''NSE'' AND SEGMENT = ''FUTURES'') THEN ''2'''    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''MCX'' THEN ''16'''    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''NCX'' THEN ''64'''    
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''MCD'' THEN ''1024'''  
SET @STR = @STR+' WHEN CONVERT(VARCHAR,INACTIVE_FROM) > GETDATE() AND EXCHANGE = ''NSX'' THEN ''2048'''  
SET @STR = @STR+' ELSE ''0'' END AS SEGMENT INTO #T FROM (SELECT * FROM #ODIN_FILE) X'    
SET @STR = @STR+' INNER JOIN'    
SET @STR = @STR+' (SELECT * FROM AngelNseCM.MSAJAG.DBO.CLIENT_BROK_DETAILS WITH(NOLOCK)) Y'    
SET @STR = @STR+' ON X.PARTY_CODE = Y.CL_CODE;SELECT * INTO #T1 FROM #T WHERE SEGMENT <> ''0'''    
SET @STR = @STR+' SELECT * INTO #TEMP1 FROM (SELECT * FROM #ODIN_FILE) X LEFT OUTER JOIN ('    
SET @STR = @STR+' SELECT CL_CODE,SUM(CONVERT(INT,SEGMENT)) AS SEGMENT FROM #T1 GROUP BY CL_CODE )'    
SET @STR = @STR+' Y ON X.PARTY_CODE = Y.CL_CODE'    
SET @STR = @STR+' SELECT * INTO #TEMP FROM #TEMP1 WHERE NO <> SEGMENT '    
SET @STR = @STR+' SELECT A.PARTY_CODE,B.* INTO #ODIN_FILE_1 FROM'    
SET @STR = @STR+' (SELECT * FROM #TEMP) A'    
SET @STR = @STR+' LEFT OUTER JOIN'    
SET @STR = @STR+' (SELECT * FROM SEGMENTS (NOLOCK)) B'    
SET @STR = @STR+' ON A.SEGMENT = B.NO'    
    
    
---------------------CLIENT DETAILS---------------------------------    
SET @STR=@STR+' SELECT DISTINCT BSECM=Y.BSE,NSECM=Y.NSE,FO=Y.NSEFO,MCDX=Y.MCX,NCDEX=Y.NCDX,BSE_FO=Y.BSEFO,MCD=Y.MCD,NSX=Y.NSX,X.* INTO #CLIENT_DET FROM (SELECT CL_CODE,LONG_NAME,BRANCH_CD,SUB_BROKER'    
SET @STR=@STR+' FROM AngelNseCM.MSAJAG.DBO.CLIENT_DETAILS WITH(NOLOCK)) X '    
SET @STR=@STR+' INNER JOIN (SELECT * FROM #ODIN_FILE_1) Y ON X.CL_CODE = Y.PARTY_CODE '    
    
    
-----------------CLIENT DETAILS NO---------------------------    
SET @STR=@STR+'SELECT A.*,B.NO INTO #CLI_NO FROM (SELECT * FROM #CLIENT_DET) A LEFT OUTER JOIN (SELECT * FROM SEGMENTS (NOLOCK)) B '    
SET @STR=@STR+'ON A.BSECM = B.BSE AND A.NSECM = B.NSE AND A.FO = B.NSEFO AND A.MCDX = B.MCX AND A.NCDEX = B.NCDX AND A.BSE_FO = B.BSEFO and A.NSX=B.NSX'    
SET @STR=@STR+' SELECT X.PARTY_CODE,Y.LONG_NAME,CASE WHEN Y.BSECM = ''N'' THEN ''0'' ELSE ''8'' END AS BSECM,'    
SET @STR=@STR+' CASE WHEN Y.NSECM = ''N'' THEN ''0'' ELSE ''1'' END AS NSECM,'    
SET @STR=@STR+' CASE WHEN Y.FO = ''N'' THEN ''0'' ELSE ''2'' END AS FO,'    
SET @STR=@STR+' CASE WHEN Y.MCDX = ''N'' THEN ''0'' ELSE ''16'' END AS MCDX,'    
SET @STR=@STR+' CASE WHEN Y.NCDEX = ''N'' THEN ''0'' ELSE ''64'' END AS NCDEX,'    
SET @STR=@STR+' CASE WHEN Y.BSE_FO = ''N'' THEN ''0'' ELSE ''4'' END AS BSE_FO,'    
SET @STR=@STR+' CASE WHEN Y.MCD = ''N'' THEN ''0'' ELSE ''1024'' END AS MCD,'  
SET @STR=@STR+' CASE WHEN Y.NSX = ''N'' THEN ''0'' ELSE ''2048'' END AS NSX'  
SET @STR=@STR+' INTO #X FROM (SELECT * FROM #ODIN_FILE_1) X'    
SET @STR=@STR+' INNER JOIN (SELECT * FROM #CLI_NO) Y ON X.PARTY_CODE = Y.CL_CODE /*AND X.NO <> Y.NO*/ '    
SET @STR=@STR+' ALTER TABLE #X ADD SEGALLOWED VARCHAR(30); UPDATE #X SET SEGALLOWED=B.SEGMENTALLOWED FROM (SELECT SEGMENTALLOWED FROM INTRANET.TESTDB.DBO.CTCLMGRLOCATION WITH(NOLOCK) WHERE LOCACODE='''+@ACCESS_CODE+''')B '    
SET @STR=@STR+' SELECT PARTY_CODE,LONG_NAME,BSECM,NSECM,FO,MCDX,NCDEX,BSE_FO,MCD,SEG=CASE WHEN SEGALLOWED=''EQUITY'' THEN CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO) WHEN SEGALLOWED=''COMMODITIES'' THEN CONVERT(INT,MCDX)+CONVERT(INT,NCDEX) '    
SET @STR=@STR+' WHEN SEGALLOWED=''EQUITY_COMMO'' THEN CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO)+CONVERT(INT,MCDX)+CONVERT(INT,NCDEX) '    
SET @STR=@STR+'WHEN SEGALLOWED=''CURRENCY_COMMO'' THEN CONVERT(INT,MCDX)+CONVERT(INT,NCDEX)+CONVERT(INT,MCD)+CONVERT(INT,NSX) WHEN SEGALLOWED=''ALL'' THEN CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO)+CONVERT(INT,MCDX)+CONVERT(INT,NCDEX)+CONVERT(I
NT,MCD)+CONVERT(INT,NSX) END INTO #Y FROM #X '    
--SET @STR=@STR+' SELECT PARTY_CODE,LONG_NAME,CONVERT(VARCHAR,CONVERT(INT,BSECM)+CONVERT(INT,NSECM)+CONVERT(INT,FO)+CONVERT(INT,MCDX)+CONVERT(INT,NCDEX)+CONVERT(INT,BSE_FO)) AS SEG INTO #Y FROM #X '    
SET @STR=@STR+' SELECT * INTO #Y1 FROM #Y WHERE SEG<>0 '    
SET @STR=@STR+' TRUNCATE TABLE '+@TBLNAME1+';INSERT INTO '+@TBLNAME1+' SELECT DISTINCT OPCODE+''|''+X.PARTY_CODE+''|''+ISNULL(BRANCH_CD,'''')+''|''+CLIENT_NAME+''|''+ISNULL(PASSWRD,'''')+''|''+CATEGORY+''|''+ISNULL(ADDRESS1,'''')+''|'''    
SET @STR=@STR+' +ISNULL(ADDRESS2,'''')+''|'''    
SET @STR=@STR+' +ISNULL(CITY,'''')+''|''+ISNULL(STATE_PIN,'''')+''|''+ISNULL(TELEPHONE_NO,'''')+''|''+ISNULL(FAXNO,'''')+''|''+ISNULL(EMAIL,'''')+''|''+STATUS+''|''+ISNULL(BROKERAGE,'''')+''|''+ISNULL(SURV_ON_OFF,'''')+''|'''    
SET @STR=@STR+' +ISNULL(SURV_AUTO_MANUAL,'''')+''|'''    
SET @STR=@STR+' +ISNULL(BANKDPONOFF,'''')+''|''+ISNULL(PARTICIPANTCODE,'''')+''|''+ISNULL(FILLER1,'''')+''|''+ISNULL(FILLER2,'''')+''|''+ISNULL(FILLER3,'''')+''|''+ISNULL(FILLER4,'''')+''|'''    
SET @STR=@STR+' +ISNULL(CONVERT(VARCHAR,Y.SEG),'''')+''|''+ISNULL(CLIENTVALIDATIONONOFF,'''')+''|'''    
SET @STR=@STR+' +ISNULL(SPANONOFF,'''')+''|''+ISNULL(DERVPARTCODE,'''')+''|''+ISNULL(IP_ADDRESS,'''')+''|''+ISNULL(MAXNOOFORDER,'''')+''|''+ISNULL(MAX_BCAST_SCRIPS,'''')+''|''+ISNULL(ALIAS_DEALERID,'''')+''|'''    
SET @STR=@STR+' +ISNULL(FAMILY_NAME,'''')+''|''+ISNULL(EQFLAG,'''')+''|''+'    
SET @STR=@STR+' ISNULL(DERVFLAG,'''')+''|''+ISNULL(COMBFLAG,'''')+''|''+ISNULL(BSEEQ,'''')+''|''+ISNULL(NEBECOMB,'''')+''|''+ISNULL(NEBEEQ,'''')+''|''+ISNULL(NSE_CASH_CTCL_BRANCHID,'''')+''|'''    
SET @STR=@STR+' +ISNULL(NSE_CASH_CTCL_ID,'''')+''|''+ISNULL(BRANCH_NAME,'''')+''|''+'    
SET @STR=@STR+' ISNULL(DERV_CTCL_BRANCHID,'''')+''|''+ISNULL(DERV_CTCL_ID,'''')+''|''+ISNULL(GROUP_ADMIN,'''')+''|''+ISNULL(BSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(BSE_CASH_CTCL_ID,'''')+''|''+ISNULL(CONVERT(VARCHAR,Y.SEG),'''')+''|''+'    
SET @STR=@STR+' ISNULL(PARTICIPANTTYPE,'''')+''|''+ISNULL(DIET,'''')+''|''+ISNULL(NET,'''')+''|''+ISNULL(IWIN,'''')+''|''+ISNULL(NETNETLITE,'''')+''|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|'''    
SET @STR=@STR+' +ISNULL(MCX_CTCLID,'''')+''|''+ISNULL(NCDEX_CTCLBRANCHID,'''')+''|''+'    
SET @STR=@STR+' ISNULL(NCDEXCTCL_ID,'''')+''|''+ISNULL(LEFT(PRODUCTTYPE,13),'''')+''|||||||||||||||''+ISNULL(Market_Data_Allowed,'''')+''|||||||'' FROM (SELECT * FROM '+@TBLNAME+' (NOLOCK)) X'    
SET @STR=@STR+' INNER JOIN (SELECT * FROM #Y1) Y ON X.PARTY_CODE = Y.PARTY_CODE AND X.TRADING_ALLOWED<>Y.SEG'    
    
--PRINT (@STR)    
EXEC(@STR)    
    
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_ODIN_Mismatch1
-- --------------------------------------------------
CREATE Proc [dbo].[USP_KYC_ODIN_Mismatch1](@access_code as varchar(50))                                                                            
as                                                                                 
                                                    
                                                    
Declare @tblname as varchar(20)                                                      
Declare @tblname1 as varchar(20)                                                      
                                              
set @tblname = 'tbl_Odin_'+@access_code+''                                                      
set @tblname1 = 'tbl_reco_'+@access_code+''                                                      
                                                      
/*                                                   
Declare @access_code as varchar(20)                                                      
set @access_code = 'ACM'                                                    
print @tblname                                                    
*/                                                
                                                                     
-------------------------Odin File-----------------------                                                                            
--Declare @str1 as varchar(1000)                                            
declare @str as varchar(8000)                                                    
                                                
set @str = ''                                                
set @str = 'select x.party_code,y.* into #Odin_file from (select * from '+@tblname+' (nolock)) x left outer join'                                                                            
set @str=@str+'(select * from segments (nolock)) y on rtrim(ltrim(x.segment)) = rtrim(ltrim(y.No)) '                                                                              
                                                
--exec (@str1)                                              
                                            
set @str = @str+' select distinct cl_code,case when convert(varchar,Inactive_from) > getdate() and Exchange = ''BSE'' then ''8'''                                             
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and (Exchange = ''NSE'' and segment = ''CAPITAL'') then ''1'''                                            
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and (Exchange = ''NSE'' and segment = ''FUTURES'') then ''2'''                                             
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and Exchange = ''MCX'' then ''16'''                                             
set @str = @str+' when convert(varchar,Inactive_from) > getdate() and Exchange = ''NCX'' then ''64'''                                             
set @str = @str+' else ''0'' end as Segment into #t from (select * from #Odin_file) x'                                            
set @str = @str+' inner join'                                            
set @str = @str+' (select * from AngelNseCM.msajag.dbo.client_brok_details with(nolock)) y'                                            
set @str = @str+' on x.party_code = y.cl_code;select * into #t1 from #t where segment <> ''0'''                                                 
set @str = @str+' select *  into #temp1 from (select * from #Odin_file) x left outer join ('                                        
set @str = @str+' select cl_code,sum(convert(int,segment)) as Segment from #t1 group by cl_code )'                                            
set @str = @str+' y on x.party_code = y.cl_code'                                            
set @str = @str+' select * into #temp from #temp1 where No <> segment '                                             
set @str = @str+' select a.party_code,b.* into #Odin_file_1 from'                 
set @str = @str+' (select * from #temp) a'                    
set @str = @str+' left outer join'                    
set @str = @str+' (select * from segments (nolock)) b'                    
set @str = @str+' on a.segment = b.no'                         
                                            
                           
---------------------client details---------------------------------                                            
set @str=@str+' select distinct bsecm=y.bse,nsecm=y.nse,fo=y.nsefo,mcdx=y.mcx,ncdex=y.ncdx,bse_fo=y.bsefo,x.* into #client_det from (select cl_code,long_name,branch_cd,sub_broker'                                                                     
set @str=@str+' from AngelNseCM.msajag.dbo.client_details with(nolock)) x '                                                        
set @str=@str+' inner join (select * from #Odin_file_1) y on x.cl_code = y.party_code '                                                       
                                                                                
                                                                      
-----------------client details no---------------------------                      
set @str=@str+'Select a.*,b.No into #cli_no from (select * from #client_det) a left outer join (select * from segments (nolock)) b '                                                                             
set @str=@str+'ON A.bsecm = B.BSE AND A.NSEcm = B.NSE AND A.FO = B.NSEFO AND A.MCDX = B.MCX AND A.NCDeX = B.NCDX AND A.BSE_FO = B.BSEFO '                                                                                            
set @str=@str+' Select x.party_code,y.long_name,case when y.bsecm = ''N'' then ''0'' else ''8'' end as bsecm,'                                                                          
set @str=@str+' case when y.nsecm = ''N'' then ''0'' else ''1'' end as nsecm,'                                                
set @str=@str+' case when y.fo = ''N'' then ''0'' else ''2'' end as fo,'                                                                          
set @str=@str+' case when y.mcdx = ''N'' then ''0'' else ''16'' end as mcdx,'                                                                          
set @str=@str+' case when y.ncdex = ''N'' then ''0''  else ''64'' end as ncdex,'                                                                          
set @str=@str+' case when y.bse_fo = ''N'' then ''0'' else ''4'' end as bse_fo'                                                                          
set @str=@str+' into #x from (select * from #Odin_file_1) x'                                                                            
set @str=@str+' inner join (select * from #cli_no) y on x.party_code = y.cl_code /*and x.no <> y.no*/ '                                                                                                                                     
set @str=@str+'alter table #x add  segallowed varchar(30); update #x set segallowed=b.segmentallowed from (select segmentallowed from intranet.Testdb.dbo.CtclMgrLocation with(nolock) where Locacode='''+@access_code+''')b '             
set @str=@str+'select party_code,long_name,bsecm,nsecm,fo,mcdx,ncdex,bse_fo,Seg=case when segallowed=''Equity'' then convert(int,bsecm)+convert(int,nsecm)+convert(int,fo) when segallowed=''Commodities'' then convert(int,mcdx)+convert(int,ncdex)   
when segallowed=''Equity_Commo'' then convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex) '             
set @str=@str+'when segallowed=''Currency_Commo'' then convert(int,mcdx)+convert(int,ncdex) when segallowed=''All'' then convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex) end into #y from #x  '             
--set @str=@str+' select party_Code,Long_name,convert(varchar,convert(int,bsecm)+convert(int,nsecm)+convert(int,fo)+convert(int,mcdx)+convert(int,ncdex)+convert(int,bse_fo)) as Seg into #y from #x '                                                        
set @str=@str+' select * into #y1 from #y where seg<>0 '                                                             
set @str=@str+' Truncate table '+@tblname1+';Insert into '+@tblname1+' Select Distinct Opcode+''|''+x.Party_Code+''|''+isnull(Branch_cd,'''')+''|''+Client_name+''|''+isnull(Passwrd,'''')+''|''+Category+''|''+isnull(Address1,'''')+''|''+isnull(Address2,'''')+''|'''                      
set @str=@str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+status+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''+isnull(Surv_Auto_Manual,'''')+''|'''                                                                
set @str=@str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Convert(varchar,y.seg),'''')+''|''+isnull(ClientValidationOnOff,'''')+''|'''                                                                
set @str=@str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFlag,'''')+''|''+'                                                                
set @str=@str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')+''|''+'                                                                
set @str=@str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Convert(varchar,y.Seg),'''')+''|''+'          
set @str=@str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                     
set @str=@str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from (select * from '+@tblname+' (nolock)) x'                                                        
set @str=@str+' inner join (select * from #y1) y on x.party_code = y.party_code and x.Trading_Allowed<>y.seg'                                                                                                      
              
--print (@str)              
exec(@str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_KYC_ODIN_Reco1_New
-- --------------------------------------------------
CREATE Proc [dbo].[USP_KYC_ODIN_Reco1_New](@stat as varchar(2))                                    
as                                
                              
declare @str as varchar(5000)                                          
declare @file as varchar(100)                                          
declare @s as varchar(1000)                                           
declare @s1 as varchar(1000)                              
declare @type as varchar(20)                                  
                                         
--EXEC mis.UPLOAD.DBO.USP_KYC @file                                  
--declare @stat as varchar(2)                              
--set @stat = 'A'                                    
                                    
if @stat = 'A'                                    
begin                              
                              
set @type = 'ACTIVE_CLIENTS'                               
                              
truncate table tbl_reco                              
                              
insert into tbl_reco                             
select 'Party Code'+'|'+'PartyName'+'|'+'Branch'+'|'+'SubBroker'+'|'+'Bsecm'+'|'+'Nsecm'+'|'+'Nsefo'+'|'+'Mcdx'+'|'+'Ncdx'+'|'+'Bsefo'                            
                                  
set @str = 'insert into tbl_reco select rtrim(ltrim(cl_code))+''|''+rtrim(ltrim(long_name))+''|''+rtrim(ltrim(branch_cd))+''|''+rtrim(ltrim(sub_broker))+''|''+                                  
 isnull(bsecm,''N'')                                  
 +''|''+isnull(nsecm,''N'')                                  
 +''|''+isnull(nsefo,''N'')                                  
 +''|''+isnull(mcdx,''N'')                                  
 +''|''+isnull(ncdx,''N'')                                  
 +''|''+isnull(bsefo,''N'')                                  
from intranet.risk.dbo.client_details where cl_code in                                    
( select party_code from mis.upload.dbo.tbl_ODin_new ) and Last_Inactive_date >= getdate()'                                    
                              
                              
end                                   
                                  
if @stat = 'D'                                         
Begin                              
                              
set @type = 'DEACTIVE_CLIENTS'                               
                              
truncate table tbl_reco                              
                              
-- insert into tbl_reco                             
-- select 'Party Code'+'|'+'PartyName'+'|'+'Branch'+'|'+'SubBroker'+'|'+'Bsecm'+'|'+'Nsecm'+'|'+'Nsefo'+'|'+'Mcdx'+'|'+'Ncdx'+'|'+'Bsefo'+'|'+'InActiveDate'                            
--                                   
-- set @str = 'insert into tbl_reco select rtrim(ltrim(cl_code))+''|''+rtrim(ltrim(long_name))+''|''+rtrim(ltrim(branch_cd))+''|''+rtrim(ltrim(sub_broker))+''|''+                                  
--  isnull(bsecm,''N'')+''|''+                                  
--  isnull(nsecm,''N'')+''|''+                                  
--  isnull(nsefo,''N'')+''|''+                                  
--  isnull(mcdx,''N'')+''|''+                                  
--  isnull(ncdx,''N'')+''|''+                                  
--  isnull(bsefo,''N'')+''|''+convert(varchar,Last_Inactive_date,103) from intranet.risk.dbo.client_details (nolock) where cl_code in                                     
--  (                                    
--  select party_code from mis.upload.dbo.tbl_ODin_new where Last_Inactive_date <= getdate()                                    
--  )'                                    
-- end                   
              
-------------------Deactivate Clients--------------              
              
select cl_code into #x from intranet.risk.dbo.client_details where cl_code in                                     
(select party_code from mis.upload.dbo.tbl_ODin_new where Last_Inactive_date <= getdate())              
              
insert into tbl_reco              
select Opcode+'|'+x.Party_Code+'|'+Branch_cd+'|'+'CLOSED BY KYC'+'|'+isnull(Passwrd,'')+'|'+Category+'|'+isnull(Address1,'')+'|'+isnull(Address2,'')+'|'              
+isnull(City,'')+'|'+isnull(State_pin,'')+'|'+isnull(Telephone_No,'')+'|'+isnull(FaxNo,'')+'|'+isnull(Email,'')+'|'+'S'+'|'+isnull(Brokerage,'')+'|'+isnull(Surv_On_Off,'')+'|'+isnull(Surv_Auto_Manual,'')+'|'              
+isnull(BankDPOnOff,'')+'|'+isnull(ParticipantCode,'')+'|'+isnull(Filler1,'')+'|'+isnull(Filler2,'')+'|'+isnull(Filler3,'')+'|'+isnull(Filler4,'')+'|'+isnull(Trading_Allowed,'')+'|'+isnull(ClientValidationOnOff,'')+'|'              
+isnull(SpanOnOff,'')+'|'+isnull(DervPartCode,'')+'|'+isnull(IP_Address,'')+'|'+isnull(MaxNoOfOrder,'')+'|'+isnull(Max_BCast_Scrips,'')+'|'+isnull(Alias_DealerId,'')+'|'+isnull(Family_Name,'')+'|'+isnull(EqFlag,'')+'|'+              
isnull(DervFlag,'')+'|'+isnull(CombFlag,'')+'|'+isnull(BSEEq,'')+'|'+isnull(NEBEComb,'')+'|'+isnull(NEBEEq,'')+'|'+isnull(NSE_Cash_CTCL_BranchId,'')+'|'+isnull(NSE_Cash_CTCL_Id,'')+'|'+isnull(Branch_Name,'')+'|'+              
isnull(Derv_CTCL_BranchId,'')+'|'+isnull(Derv_CTCL_Id,'')+'|'+isnull(Group_Admin,'')+'|'+isnull(BSE_Cash_CTCL_BranchId,'')+'|'+isnull(BSE_Cash_CTCL_Id,'')+'|'+isnull(Segment,'')+'|'+              
isnull(ParticipantType,'')+'|'+isnull(DIET,'')+'|'+isnull(Net,'')+'|'+isnull(iWin,'')+'|'+isnull(NetNetLite,'')+'|'+isnull(MCX_CTCL_BranchId,'')+'|'+isnull(MCX_CTCLId,'')+'|'+isnull(NCDEX_CTCLBranchId,'')+'|'+              
isnull(NCDEXCTCL_Id,'')+'|'+isnull(ProductType,'') from (select * from mis.upload.dbo.tbl_ODin_new ) x              
inner join (select * from #x) y on x.party_code = y.cl_code              
              
end                               
                                    
if @stat = 'R'                                    
                                    
begin                                
                              
set @type = 'MISSING_CLIENTS'                               
                              
truncate table tbl_reco                              
                              
-- insert into tbl_reco                             
-- select 'Party Code'+'|'+'PartyName'+'|'+'Branch'+'|'+'Segment'                            
--                               
-- set @str = 'insert into tbl_reco select rtrim(ltrim(Party_code))+''|''+rtrim(ltrim(client_name))+''|''+rtrim(ltrim(branch_cd))+''|''+rtrim(ltrim(segment))                                
-- from mis.upload.dbo.tbl_ODin_new where  party_code not in   (select cl_code from intranet.risk.dbo.client_details )'                                    
              
insert into tbl_reco              
select Opcode+'|'+Party_Code+'|'+Branch_cd+'|'+'CLOSED BY KYC'+'|'+isnull(Passwrd,'')+'|'+Category+'|'+isnull(Address1,'')+'|'+isnull(Address2,'')+'|'              
+isnull(City,'')+'|'+isnull(State_pin,'')+'|'+isnull(Telephone_No,'')+'|'+isnull(FaxNo,'')+'|'+isnull(Email,'')+'|'+'S'+'|'+isnull(Brokerage,'')+'|'+isnull(Surv_On_Off,'')+'|'+isnull(Surv_Auto_Manual,'')+'|'              
+isnull(BankDPOnOff,'')+'|'+isnull(ParticipantCode,'')+'|'+isnull(Filler1,'')+'|'+isnull(Filler2,'')+'|'+isnull(Filler3,'')+'|'+isnull(Filler4,'')+'|'+isnull(Trading_Allowed,'')+'|'+isnull(ClientValidationOnOff,'')+'|'              
+isnull(SpanOnOff,'')+'|'+isnull(DervPartCode,'')+'|'+isnull(IP_Address,'')+'|'+isnull(MaxNoOfOrder,'')+'|'+isnull(Max_BCast_Scrips,'')+'|'+isnull(Alias_DealerId,'')+'|'+isnull(Family_Name,'')+'|'+isnull(EqFlag,'')+'|'+              
isnull(DervFlag,'')+'|'+isnull(CombFlag,'')+'|'+isnull(BSEEq,'')+'|'+isnull(NEBEComb,'')+'|'+isnull(NEBEEq,'')+'|'+isnull(NSE_Cash_CTCL_BranchId,'')+'|'+isnull(NSE_Cash_CTCL_Id,'')+'|'+isnull(Branch_Name,'')+'|'+              
isnull(Derv_CTCL_BranchId,'')+'|'+isnull(Derv_CTCL_Id,'')+'|'+isnull(Group_Admin,'')+'|'+isnull(BSE_Cash_CTCL_BranchId,'')+'|'+isnull(BSE_Cash_CTCL_Id,'')+'|'+isnull(Segment,'')+'|'+              
isnull(ParticipantType,'')+'|'+isnull(DIET,'')+'|'+isnull(Net,'')+'|'+isnull(iWin,'')+'|'+isnull(NetNetLite,'')+'|'+isnull(MCX_CTCL_BranchId,'')+'|'+isnull(MCX_CTCLId,'')+'|'+isnull(NCDEX_CTCLBranchId,'')+'|'+              
isnull(NCDEXCTCL_Id,'')+'|'+isnull(ProductType,'') from tbl_ODin_new  x  (nolock) where   
not exists (select * from AngelNseCM.msajag.dbo.client_details y where x.Party_Code = y.cl_code  )              
--not exists (select * from intranet.risk.dbo.client_details y where x.Party_Code = y.cl_code  )  
              
              
end                   
                    
                        
if @stat = 'M'                                 
                        
begin                         
                        
set @type = 'MISMATCH_CLIENTS'                        
              
--truncate table tbl_reco                        
                        
/*                
insert into tbl_reco                        
select 'party_code'+'|'+'Long_Name'+'|'+'A_Bse'+'|'+'Bk_Bse'+'|'+'A_Nse'+'|'+'Bk_Nse'+'|'+'A_Nsefo'+'|'+'Bk_Nsefo'+'|'+'A_Mcx'+'|'+'Bk_Mcx'+'|'+'A_Ncdx'+'|'+'Bk_Ncdx'+'|'+'A_Bsefo'+'|'+'Bk_Bsefo'                        
*/                
                
--insert into tbl_reco                        
--select 'party_code'+'|'+'Long_Name'+'|'+'Total'                
set @str = 'exec USP_KYC_ODIN_Mismatch'                         
       
--print(@str)                       
exec(@str)                              
end  
set @file = 'D:\upload1\KYCODIN\'+@type+'.txt'                                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.tbl_reco" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                          
set @s1= @s+''''                                                                          
--print @s1                              
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_liquidbeesConvertor_Unix
-- --------------------------------------------------
    
 CREATE Procedure USP_liquidbeesConvertor_Unix    
(    
@path varchar(100),    
@filename varchar(75)    
)    
as    
--declare     
--@path varchar(100),    
--@filename varchar(75)    
    
--set @path='\\172.29.19.10\d$\CDSL_CONVERTER\'    
--set @filename='181203320000000066.06032013.001'    
declare @sql varchar(8000)    
set @sql='EXEC master..xp_cmdshell '''+@path+'DOS2UNIX.EXE '+@path+@filename+''''    
print @sql    
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_LS_Upload_SB_Arn_Euin
-- --------------------------------------------------
--[USP_LS_Upload_SB_Arn_Euin] 'NEW SB ARN-EUIN 05-12-2015.csv','NEW SB ARN-EUIN 05-12-2015.csv'
CREATE Proc [dbo].[USP_LS_Upload_SB_Arn_Euin] (@ArnEuinFile AS VARCHAR(100),
@filename varchar(100))                       
AS        
Begin               
Set nocount on       
                   
BEGIN TRY          
                   
Declare @strnse as varchar(100),@Delimiter as varchar(10),@newline as varchar(10),@path as varchar(100),@strbse as varchar(100)                  
set @path= '//196.1.115.173/D$/Upload1/';    
set @strbse = (@path+@filename);    
set @Delimiter = ',';set @newline = '\n'                  
  
--truncate table tbl_mf_ls_arn_euins_tEMP       
  
--begin                  
--exec('BULK INSERT tbl_mf_ls_arn_euins_tEMP FROM ''' +@strbse+''' WITH (FIRSTROW = 2,FIELDTERMINATOR = '''+@Delimiter+''', ROWTERMINATOR = '''+@newline+''')')                  
--end   
             
EXEC [intranet].risk.dbo.[USP_LS_Upload_SB_Arn_Euin_New]        
            
End try        
                                     
BEGIN CATCH                                          
				                         
	 insert into tbl_Mfss_Lumusm_Error(ErrTime,ErrObject,ErrLine,ErrMessage)               
	 select GETDATE(),'SB_Upload_ArnEuin',ERROR_LINE(),ERROR_MESSAGE()                                                
	             
	 DECLARE @ErrorMessage NVARCHAR(4000);                                            
	 SELECT @ErrorMessage = ERROR_MESSAGE() + convert(varchar(10),error_line());                                            
	 RAISERROR (@ErrorMessage , 16, 1);               
				  
End catch                            
                                  
Set nocount off                            
                                        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Mail_Report
-- --------------------------------------------------
CREATE Proc Usp_Mail_Report(@Date varchar(11),@Status char(1))          
As          
          
Set @Date = Convert(Varchar(11),Convert(datetime,@Date,103))          
        
Select Fld_Branch_Code,Count(*) Cnt into #t from tbl_rpt_status where convert(varchar(11),fld_updatedate) = @Date          
and Fld_Report_Status = @Status and Fld_Report_Name <> 'A' group by Fld_Branch_Code        
          
Select a.Fld_Empcode,Fld_Branch_Code=a.Fld_Branch_Code+'--'+isnull(b.branchname,''),a.Fld_ModifiedDate,        
Case when a.Fld_Report_Name = 'A' then 'ACTIVE CLIENTS'        
when a.Fld_Report_Name = 'D' then 'DEACTIVE CLIENTS'        
when a.Fld_Report_Name = 'M' then 'MISMATCH CLIENTS'        
when a.Fld_Report_Name = 'R' then 'MISSING CLIENTS' End as Fld_Report_Name        
,b.Name,Fld_CodeCount into #t1 from          
(Select * from tbl_rpt_status where convert(varchar(11),fld_updatedate) = @Date          
and Fld_Report_Status = @Status and Fld_Report_Name <> 'A' and   
Fld_Branch_Code <> 'VSET' and Fld_Branch_Code <> 'VSET1') a          
Left outer join          
tbl_OdinMail b on a.Fld_EmpCode = b.EmpCode and a.Fld_Branch_Code = b.Branch order by Fld_Branch_Code          
         
Select a.*,b.Cnt from #t1 a        
left outer join #t b on a.Fld_Branch_Code = b.Fld_Branch_Code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MCX_CURRENCY
-- --------------------------------------------------
 CREATE PROC USP_MCX_CURRENCY    
 (         
   @FILENAME AS VARCHAR(45)    
 )    
 AS    
 BEGIN    
       
  INSERT INTO FOBKG.DBO.TBL_MCX_CURRENCY1
  SELECT  [Trade_no]  ,  
 [Trade_Status]  ,  
 [Instrument_id]='',  
 [Instrument_Name] ,   
 [Symbol]  ,  
 [expirydate] ,  
 [Reserved]  ,  
 [Strike Price] ,  
 [Reserved1]='',  
 [Options Type] ,  
 [Product Description] ,  
 [Book Tpe Name]  ,  
 [Book Type]  ,  
 [user id]  ,  
 [Branch No] ,  
 [Buy Sell]  ,  
 [Trade quantity]  ,  
 [Price]  ,  
 [Account Type] ,  
 [Account ID]  ,  
 [Participant Settler] ,  
 [Spread Price] ,  
 [TM ID]  ,  
 [Reserved3]  ,  
 [Activity Time]  ,  
 [Last Modified time]  ,  
 [Order Number]  ,  
 [Opposite Broker Id]='',  
 [Order User Last Update Time] ,  
 [Mod Date Time]=GETDATE(),  
 [Order Entered/Mod Date Time]=GETDATE(),
 RESERVED5,  
 RESERVED6
  FROM MCX_CURRENCY_TEMP    
      
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MCX_VarMargin
-- --------------------------------------------------
CREATE proc USP_MCX_VarMargin                
(                          
@filename as varchar(100),@Margin_Date as varchar(11) ,@server as varchar(20)                         
)                           
as                              
set transaction  isolation  level read uncommitted                              
declare @path as varchar(100)                          
declare @sql as varchar(1000)                         
          
set @Margin_Date = convert(datetime,@Margin_Date,103)          
                          
truncate table Tbl_Upload_MCX_Margin                     
                         
set @path='\\'+@server+'\d$\upload1\' + @filename                          
SET @SQL = 'BULK INSERT Tbl_Upload_MCX_Margin FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=1,KeepNULLS)'                          
-- print @SQL                          
exec (@sql)            
  
          
delete from Bak_SECURITYHAIRCUT where LoginTime >= convert(varchar(11),getdate())            
            
insert into Bak_SECURITYHAIRCUT            
select * from  ANGELCOMMODITY.MSAJAG.dbo.SECURITYHAIRCUT            
  
set XACT_ABORT on                  
delete from ANGELCOMMODITY.MSAJAG.dbo.SECURITYHAIRCUT where Exchange = 'MCX'              
             
insert into ANGELCOMMODITY.MSAJAG.dbo.SECURITYHAIRCUT                
select @Margin_Date,'MCX','FUTURES','','',Fld_Scrip_cd,Fld_Series,'',Fld_ISIN,Fld_col3,'Dec 31 2049',1,1,'','',getdate() from Tbl_Upload_MCX_Margin where Fld_Series = 'EQ'                
                
select * from Tbl_Upload_MCX_Margin where Fld_Series = 'EQ'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MCXCURRENCY
-- --------------------------------------------------
       
      --select count(*) from MIS.FOBKG.DBO.TBL_MCXCURRENCY_EXCHANGE  
        
        
        
CREATE PROC USP_MCXCURRENCY          
 (               
   @FILENAME AS VARCHAR(45)          
 )          
 AS          
 BEGIN  
 set nocount on   
 begin      
 delete from MIS.FOBKG.DBO.TBL_MCXCURRENCY_EXCHANGE    
 end   
  set nocount off  
   
INSERT INTO MIS.FOBKG.DBO.TBL_MCXCURRENCY_EXCHANGE  
(  
    [Trade Number] ,  
 [Trade Status] ,  
 [Instrument ID] ,  
 [Instrument Name] ,  
 [Symbol] ,  
 [Expiry Date] ,  
 [Reserved]  ,  
 [Strike Price]  ,  
 [Options Type]  ,  
 [Product Description]  ,  
 [Book Type]  ,  
 [Book Type Name]  ,  
 [Market Type]  ,  
 [User ID]  ,  
 [Branch No]  ,  
 [Buy/Sell Indicator]  ,  
 [Trade quantity]  ,  
 [Price]  ,  
 [Account Type]  ,  
 [Account ID]  ,  
 [Participant Settler]  ,  
 [Spread Price] ,  
 [TM ID]  ,  
 [Reserved1]  ,  
 [Trade time]  ,  
 [Last Modified Time]  ,  
 [Order Number]  ,  
 [Reserved2]  ,  
 [Remarks]  ,  
 [Order User Last Update Time] ,  
 [Reserved3]  ,  
 [Reference Number]  ,  
 [Reserved4]  )  
       
  
  SELECT   [Trade Number] ,  
 [Trade Status] ,  
 [Instrument ID] ,  
 [Instrument Name] ,  
 [Symbol] ,  
 [Expiry Date] ,  
 [Reserved]  ,  
 [Strike Price]  ,  
 [Options Type]  ,  
 [Product Description]  ,  
 [Book Type]  ,  
 [Book Type Name]  ,  
 [Market Type]  ,  
 [User ID]  ,  
 [Branch No]  ,  
 [Buy/Sell Indicator]  ,  
 [Trade quantity]  ,  
 [Price]  ,  
 [Account Type]  ,  
 [Account ID]  ,  
 [Participant Settler]  ,  
 [Spread Price] ,  
 [TM ID]  ,  
 [Reserved1]  ,  
 [Trade time]  ,  
 [Last Modified Time]  ,  
 [Order Number]  ,  
 [Reserved2]  ,  
 [Remarks]  ,  
 [Order User Last Update Time] ,  
 [Reserved3]  ,  
 [Reference Number]  ,  
 [Reserved4]   FROM  TBL_MCXCURRENCY_TEMP   
         
   
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MCXCURRENCY_ADMIN
-- --------------------------------------------------
        
          
CREATE PROC USP_MCXCURRENCY_ADMIN            
 (                 
   @FILENAME AS VARCHAR(45)            
 )            
 AS            
 BEGIN 
  SET NOCOUNT ON 
  BEGIN
  DELETE FROM  MIS.FOBKG.DBO.TBL_MCX_ADMIN 
  END 
  SET NOCOUNT OFF
           
  INSERT INTO MIS.FOBKG.DBO.TBL_MCX_ADMIN          
  SELECT * FROM           
  TBL_MCXADMIN_TEMP        
           
            
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MISDaily_turnover_trade_details
-- --------------------------------------------------

create procedure Usp_MISDaily_turnover_trade_details(@filename as varchar(25))    
AS

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MISMarket_Share
-- --------------------------------------------------
CREATE proc USP_MISMarket_Share    
(@filename as varchar(25))    
as    
    
select * into #tbl_mis_marketshare from tbl_mis_marketshare               
where convert(datetime,Fld_Date,103) not in               
(select Fld_Date from MIDDLEWARE.dashboard.dbo.tbl_mis_marketshare)     
    
declare @count int               
set @count = (select count(*) from #tbl_mis_marketshare)       
    
if @count > 0              
begin     
insert MIDDLEWARE.dashboard.dbo.tbl_mis_marketshare    
select  convert(datetime,Fld_Date,103) as Fld_Date,Fld_Mktopen_int,Fld_FONet,  
Fld_Gross,Fld_M888Net,Fld_M888Gross,Fld_NetDebit,FLd_od_Bank,FLd_Bse,  
Fld_Nse_FO,Fld_NSe,Fld_Margins,Fld_ActivityRatio,Fld_Openpos_percli,  
Fld_brokNet,Fld_brokGross,Fld_Pledged,Fld_PledgablewithICICI,  
Fld_Freeholding from #tbl_mis_marketshare    
end    
    
select * into #tbl_mis_marketshare_update from tbl_mis_marketshare               
where convert(datetime,Fld_Date,103) in                
(select Fld_Date from MIDDLEWARE.dashboard.dbo.tbl_mis_marketshare) 



    
select convert(datetime,Fld_Date,103) as fld_date_update,Fld_Mktopen_int,Fld_FONet,Fld_Gross,Fld_M888Net,    
Fld_M888Gross,Fld_NetDebit,FLd_od_Bank,FLd_Bse,Fld_Nse_FO,Fld_NSe,    
Fld_Margins,Fld_ActivityRatio,Fld_Openpos_percli,Fld_brokNet,Fld_brokGross,    
Fld_Pledged,Fld_PledgablewithICICI,Fld_Freeholding 
into #tbl_mis_marketshare_update_NEw    
from #tbl_mis_marketshare_update    
    
declare @count1 int               
set @count1 = (select count(*) from #tbl_mis_marketshare_update_NEw)              
if @count1 > 0              
begin        
update MIDDLEWARE.dashboard.dbo.tbl_mis_marketshare              
set         
Fld_Mktopen_int = #tbl_mis_marketshare_update_NEw.Fld_Mktopen_int,    
Fld_FONet = #tbl_mis_marketshare_update_NEw.Fld_FONet,    
Fld_Gross = #tbl_mis_marketshare_update_NEw.Fld_Gross,    
Fld_M888Net = #tbl_mis_marketshare_update_NEw.Fld_M888Net,    
Fld_M888Gross = #tbl_mis_marketshare_update_NEw.Fld_M888Gross,    
Fld_NetDebit = #tbl_mis_marketshare_update_NEw.Fld_NetDebit,    
FLd_od_Bank = #tbl_mis_marketshare_update_NEw.FLd_od_Bank,    
FLd_Bse = #tbl_mis_marketshare_update_NEw.FLd_Bse,    
Fld_Nse_FO = #tbl_mis_marketshare_update_NEw.Fld_Nse_FO,    
Fld_NSe = #tbl_mis_marketshare_update_NEw.Fld_NSe,    
Fld_Margins = #tbl_mis_marketshare_update_NEw.Fld_Margins,    
Fld_ActivityRatio = #tbl_mis_marketshare_update_NEw.Fld_ActivityRatio,    
Fld_Openpos_percli = #tbl_mis_marketshare_update_NEw.Fld_Openpos_percli,    
Fld_brokNet = #tbl_mis_marketshare_update_NEw.Fld_brokNet,    
Fld_brokGross = #tbl_mis_marketshare_update_NEw.Fld_brokGross,    
Fld_Pledged = #tbl_mis_marketshare_update_NEw.Fld_Pledged,    
Fld_PledgablewithICICI = #tbl_mis_marketshare_update_NEw.Fld_PledgablewithICICI,    
Fld_Freeholding = #tbl_mis_marketshare_update_NEw.Fld_Freeholding    
from #tbl_mis_marketshare_update_NEw where             
Fld_Date = #tbl_mis_marketshare_update_NEw.fld_date_update    
end     
    
    
truncate table tbl_mis_marketshare

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MisMKTShare_Rpt
-- --------------------------------------------------
CREATE proc Usp_MisMKTShare_Rpt       
(     
@access_to as varchar(15),    
@access_code as varchar(15),    
@fromdate as varchar(20),    
@todate as varchar(20)    
)    
as    

/*declare   
@fromdate as varchar(20),    
@todate as varchar(20)    
set @fromdate = '01/02/2010'  
set @todate = '30/03/2010'  
 */
select 
convert(varchar(11),Fld_Date,103) as [Date],
isnull(Fld_Mktopen_int,0) as [Market Open Interest],
isnull(Fld_FONet,0) as [FO Net],
isnull(Fld_Gross,0) as [FO Gross],
isnull(Fld_M888Net,0) as [M888 Net],
isnull(Fld_M888Gross,0) as [M888 Gross],
isnull(Fld_NetDebit,0) as [Net],
isnull(FLd_od_Bank,0) as [Od Bank],
isnull(FLd_Bse,0) as [BSE],
isnull(Fld_Nse_FO,0) as [NSEFO],
isnull(Fld_NSe,0) as [NSE],
isnull(Fld_Margins,0) as [Margins],
isnull(Fld_ActivityRatio,0) as [Activity Ratio],
isnull(Fld_Openpos_percli,0) as [Open position per client ],
isnull(Fld_brokNet,0) as [Brok Net],
isnull(Fld_brokGross,0) as [Brok Gross],
isnull(Fld_Pledged,0) as [Pledged],
isnull(Fld_PledgablewithICICI,0) as [Pledgable with ICICI],
isnull(Fld_Freeholding,0) as [Free holding ]
from MIDDLEWARE.dashboard.dbo.tbl_mis_marketshare  
where fld_Date >= convert(datetime,convert(varchar(11),@fromdate),103) and     
fld_Date <= convert(datetime,convert(varchar(11),@todate),103) + ' 23:59:59.000'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_MKTShare_Rpt
-- --------------------------------------------------
CREATE proc Usp_MKTShare_Rpt     
(   
@access_to as varchar(15),  
@access_code as varchar(15),  
@fromdate as varchar(20),  
@todate as varchar(20)  
)  
as   

/*declare 
@fromdate as varchar(20),  
@todate as varchar(20)  
set @fromdate = '01/03/2010'
set @todate = '30/03/2010'
*/  
select   
convert(varchar(10),Fld_TradeDate,103) as [Trade Date],  
isnull(Fld_BSEExchangeTo,0) as [BSE Exch],  
isnull(Fld_BSEAngelTo,0) [BSE Angel To],  
isnull(Fld_BSEShare,0) as [BSE Share],  
isnull(Fld_BSEGrossDel,0) as [BSE Gross Del],  
isnull(Fld_BSEAngelInfin,0) as [BSE Angel Infin],  
isnull(Fld_NSEExchangeTo,0) as [NSE Exch To],  
isnull(Fld_NSEAngelTo,0) [NSE Angel To],  
isnull(Fld_NSEShare,0) as [NSE Share],  
isnull(Fld_NSEGrossDel,0) as [NSE Gross Del],  
isnull(Fld_NSEAngelInfin,0) as [NSE Angel Infin],  
isnull(Fld_FOExchangeTo,0) as [Fo Exch],  
isnull(Fld_FOAngelTo,0) as [Fo Angel To],  
isnull(Fld_FOShare,0) as [Fo Share],  
isnull(Fld_FOAngelInfin,0) as [Fo Angel Infin],  
isnull(Fld_TotalExchangeTO,0) as [Total Exch To ],  
isnull(Fld_TotalAngelTO,0) as [Total Angel To],  
isnull(Fld_TotalShare,0) as [Total Share],  
isnull(Fld_TotalGrosssDel,0) as [Total Gross Del],  
isnull(Fld_TotalInfinDel,0) as [Total Infin Del],  
isnull(Fld_TotalPerShare,0) as [Total Per Share],  
isnull(Fld_NcdexExchangeTo,0) as [NCDEX Exch To],  
isnull(Fld_NcdexAngelTo,0) as [NCDEX Angel To],  
isnull(Fld_NcdexShare,0) as [NCDEX Share],  
isnull(Fld_McxExchangeTo,0) as [MCX Exch To],    
isnull(Fld_McxAngelTo,0) as [MCX Angel To],  
isnull(Fld_McxShare,0) as [MCX Share],  
isnull(Fld_TotalCommAngelTO,0) as [Total CommAngel TO],  
isnull(Fld_TotalAngelGrosssDel,0) [Total Angel Gross Del],  
isnull(Fld_TotalCommShare,0) as [Total Comm Share],  
isnull(Fld_CurNSEExchangeTo,0) as [NSX Exch To],  
isnull(Fld_CurNSEAngelTo,0) as [NSX Angel To],  
isnull(Fld_CurNSEShare,0) as [NSX Share],  
isnull(Fld_CurMcxExchangeTo,0) as [MCX Exch To],  
isnull(Fld_CurMcxAngelTo,0) as [MCX Angel To],  
isnull(Fld_CurMcxShare,0) as [MCX Share],  
isnull(Fld_CurTotalExchangeTo,0) as [Cur Total Exch To],  
isnull(Fld_CurTotalAngelTo,0) as [Total Angel To],  
isnull(Fld_CurTotalAngelPer,0) as [Toatl Angel Per],  
isnull(Fld_GrandExchangesTotal,0) [Exch Total],  
isnull(Fld_GrandAngelTotal,0) as [Angel Total],  
isnull(Fld_GrandPer,0) as [Grand Per]  
from MIDDLEWARE.dashboard.dbo.tbl_market_share with (nolock)   
where fld_tradedate >= convert(datetime,convert(varchar(11),@fromdate),103) and   
fld_tradedate <= convert(datetime,convert(varchar(11),@todate),103) + ' 23:59:59.000'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_nbfc_date
-- --------------------------------------------------
create proc usp_nbfc_date 
as

declare @Third_day as varchar(11)
declare @Second_day as varchar(11)
declare @First_day as varchar(11)

set @Third_day = (select convert(varchar(11),max(start_date),103) from MARGINFIN.NBFC.DBO.Sett_Mst where start_date < convert(varchar(11),getdate()) and sett_type = 'D')        
set @Second_day = (select convert(varchar(11),max(start_date),103) from MARGINFIN.NBFC.DBO.Sett_Mst where start_date < convert(datetime,@Third_day,103) and sett_type = 'D')        
set @First_day =  (select convert(varchar(11),max(start_date),103) from MARGINFIN.NBFC.DBO.Sett_Mst where start_date < convert(datetime,@Second_day,103) and sett_type = 'D')    

select @Third_day as Third_day,@Second_day as Second_Day,@First_day as First_Day

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NBFC_HoldingColReport
-- --------------------------------------------------
CREATE Procedure USP_NBFC_HoldingColReport(@tablename varchar(30),@partycode varchar(30),@remark varchar(20),@date varchar(11) )    
as    
--declare    
--@tablename varchar(30),@partycode varchar(30),@remark varchar(20),@date varchar(30)    
--set @tablename='tbl_col_data'    
--set @partycode='%%'    
--set @remark='OK'    
if(@date<>'%%')  
 begin  
 set @date=Convert(varchar(11),Convert(datetime,@date,103))    
 end  
    
DECLARE @STR AS VARCHAR(5000)    
if(@tablename='tbl_Col_data')    
begin    
 declare @condition as varchar(200)    
 if(@partycode='%%')    
  begin    
  set @condition=' fld_party_code like ''%'''     
  end    
 else    
  begin    
  set @condition=' fld_party_code ='''+ @partycode + ''''    
  end    
    
 declare @condition1 as varchar(200)    
 if(@remark='%%')    
  begin    
  set @condition1=' isnull(Fld_remark,'''') like ''%'''     
  end    
 else    
  begin    
  set @condition1=' isnull(Fld_remark,'''') ='''+ @remark + ''''    
  end    
    
 declare @condition2 as varchar(200)    
 if(@date='%%')    
  begin     
  set @condition2=' Fld_date like ''%'''     
  end    
 else    
  begin     
  set @condition2=' Fld_date >='''+ @date+' 00:00:00' + ''' and Fld_date <='''+ @date+' 23:59:59' + ''''    
  end    
set @STR='select * from '+@tablename+' where '+@condition+' and '+@condition1+' and  '+@condition2+''    
end    
else    
begin    
 declare @condition3 as varchar(200)    
 if(@partycode='%%')    
  begin    
  set @condition3=' fld_party_code like ''%'''     
  end    
 else    
  begin    
  set @condition3=' fld_party_code ='''+ @partycode + ''''    
  end    
    
 declare @condition4 as varchar(200)    
 if(@date='%%')    
  begin     
  set @condition4=' Fld_Datetime like ''%'''     
  end    
 else    
  begin     
  set @condition4=' Fld_Datetime >='''+ @date+' 00:00:00' + ''' and Fld_Datetime <='''+ @date+' 23:59:59' + ''''    
  end    
set @STR='select * from '+@tablename+' where '+@condition3+' and  '+@condition4+''    
end    
--print @str    
exec (@str)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NBFC_RPT_OPENPOS
-- --------------------------------------------------
CREATE PROC USP_NBFC_RPT_OPENPOS
(    
           @STATUSID   VARCHAR(20),    
           @STATUSNAME VARCHAR(20),    
           @FROMPARTY  VARCHAR(10),    
           @TOPARTY    VARCHAR(10),    
           @MARGINDATE VARCHAR(11))    
    
AS    
  
/*  
Declare    @STATUSID   VARCHAR(20),    
           @STATUSNAME VARCHAR(20),    
           @FROMPARTY  VARCHAR(10),    
           @TOPARTY    VARCHAR(10),    
           @MARGINDATE VARCHAR(11)  
  
set @STATUSID = 'broker'  
set @STATUSNAME = 'broker'  
set @FROMPARTY = '0'  
set @TOPARTY = 'zzz'  
set @MARGINDATE = '17/12/2008'  
*/  
    
    
  SELECT @MARGINDATE = LEFT(CONVERT(DATETIME, RIGHT(@MARGINDATE,4) + '-' + SUBSTRING(@MARGINDATE,4,2) + '-' + LEFT(@MARGINDATE,2)),11)    
  
 truncate table tbl_NBFC_OpenPos  
    
  insert into tbl_NBFC_OpenPos   
  SELECT T.PARTY_CODE,    
         T.SCRIP_CD,    
         B_F,    
         B_F_VALUE,    
         BUY,    
         SEL,    
         NET = BUY + SEL,    
         BUY_PRICE = CASE     
                       WHEN BUY <> 0 THEN ABS(BUY_VALUE / BUY)    
                       ELSE 0     
                     END,    
         SEL_PRICE = CASE     
                       WHEN SEL <> 0 THEN ABS(SEL_VALUE / SEL)    
                       ELSE 0     
                     END,    
         BUY_VALUE,    
         SEL_VALUE,    
         DAY_VALUE = BUY_VALUE + SEL_VALUE,    
         OPEN_POSITION = B_F + BUY + SEL,    
         CLOSING_PRICE = D.CL_RATE,    
         PORTFOLIO_VALUE = D.CL_RATE * (B_F + BUY + SEL),    
         NET_VALUE = B_F_VALUE + BUY_VALUE + SEL_VALUE    
  FROM   MARGINFIN.NBFC.DBO.CLIENT_DETAILS C,     
         (SELECT PARTY_CODE = ISNULL(BF.PARTY_CODE,BT.PARTY_CODE),     
                 SCRIP_CD = ISNULL(BF.SCRIP_CD,BT.SCRIP_CD),     
                 B_F = ISNULL(B_F,0),     
                 B_F_VALUE = ISNULL(B_F_VALUE,0),     
                 BUY = ISNULL(BUY,0),     
                 BUY_VALUE = ISNULL(BUY_VALUE,0),     
                 SEL = ISNULL(SEL,0),     
                 SEL_VALUE = ISNULL(SEL_VALUE,0)    
          FROM       
                (SELECT PARTY_CODE,     
                        SCRIP_CD,     
                        B_F = SUM(CASE     
                                    WHEN SELL_BUY = 1 THEN TRADEQTY    
                                    ELSE -TRADEQTY    
                                  END),     
                        B_F_VALUE = SUM(CASE     
                                          WHEN SELL_BUY = 1 THEN -(TRADEQTY*MARKETRATE)    
                                          ELSE (TRADEQTY*MARKETRATE)    
                                        END)     
                 FROM   MARGINFIN.NBFC.DBO.NBFC_TRANS     
                 WHERE  MARGINDATE LIKE @MARGINDATE + '%'    
                        AND PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY    
                        AND TRADETYPE <> 'BT'    
                 GROUP BY PARTY_CODE,SCRIP_CD) BF     
                 FULL OUTER JOIN     
                (SELECT PARTY_CODE,     
                        SCRIP_CD,     
                        BUY = SUM(CASE     
                                    WHEN SELL_BUY = 1 THEN TRADEQTY    
                                    ELSE 0    
                                  END),     
                        BUY_VALUE = SUM(CASE     
                                          WHEN SELL_BUY = 1 THEN -(TRADEQTY*MARKETRATE)    
                                          ELSE 0    
                                        END),     
                        SEL = SUM(CASE     
                                    WHEN SELL_BUY = 2 THEN -TRADEQTY    
                                    ELSE 0    
                                  END),     
                        SEL_VALUE = SUM(CASE     
                                          WHEN SELL_BUY = 2 THEN (TRADEQTY*MARKETRATE)    
                                          ELSE 0    
                                        END)     
                 FROM   MARGINFIN.NBFC.DBO.NBFC_TRANS     
                 WHERE  MARGINDATE LIKE @MARGINDATE + '%'    
                        AND PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY    
                        AND TRADETYPE = 'BT'    
                 GROUP BY PARTY_CODE,SCRIP_CD) BT     
                 ON BF.PARTY_CODE = BT.PARTY_CODE    
                    AND BF.SCRIP_CD = BT.SCRIP_CD) T,     
         MARGINFIN.NBFC.DBO.NBFCVALAN_DETAIL D     
  WHERE  T.PARTY_CODE = C.PARTY_CODE    
         AND T.PARTY_CODE = D.PARTY_CODE     
         AND T.SCRIP_CD = D.SCRIP_CD     
         AND D.PARTY_CODE = C.PARTY_CODE     
         AND D.MARGINDATE LIKE @MARGINDATE + '%'    
         AND C.PARTY_CODE BETWEEN @FROMPARTY AND @TOPARTY     
      AND @STATUSNAME =  CASE       
                              WHEN @STATUSID = 'BRANCH' THEN C.BRANCH_CD       
                              WHEN @STATUSID = 'SUBBROKER' THEN C.SUB_BROKER    
                              WHEN @STATUSID = 'TRADER' THEN C.TRADER       
                              WHEN @STATUSID = 'FAMILY' THEN C.FAMILY       
                              WHEN @STATUSID = 'AREA' THEN C.AREA       
                              WHEN @STATUSID = 'REGION' THEN C.REGION       
                              WHEN @STATUSID = 'CLIENT' THEN C.PARTY_CODE       
                              ELSE 'BROKER'       
                            END        
  ORDER BY 1,2

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NSE_CURRENCY
-- --------------------------------------------------
CREATE PROC USP_NSE_CURRENCY            
 (                 
   @FILENAME AS VARCHAR(45)            
 )            
 AS            
 BEGIN   
 BEGIN          
   SET NOCOUNT ON
			DELETE FROM FOBKG.DBO.TBL_NSE_CURRENCY_EXCHANGE2          
  SET NOCOUNT OFF
  END 
     
INSERT INTO FOBKG.DBO.TBL_NSE_CURRENCY_EXCHANGE2   
 SELECT     *  FROM UPLOAD.DBO.TBL_NSECURRENCY_TEMP    
            
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Nse_illscrip
-- --------------------------------------------------
CREATE PROCEDURE USP_NSE_ILLSCRIP (@FILENAME AS VARCHAR(25))            
AS      
BEGIN          
INSERT INTO  INTRANET.MISC.DBO.ILLSCRIP_NSE      
SELECT Scrip_cd,ScriptName,   
       DATENAME(mm,getdate()),DateName(MM,GETDATE()-30),DATENAME(yy,getdate()-30)    
       FROM ILLSCRIP_NSE_MONTH_TEMP         
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_nse_scrip
-- --------------------------------------------------
CREATE procedure [dbo].[Usp_nse_scrip](@filename as varchar(25))  
AS  
declare @added_by as varchar(50),@added_on as varchar(50),@type as varchar(50),@exchange as varchar(50)  
set @added_by=''  
set @added_on=getdate()  
 set @type='NA'  
set @exchange='NSE'  
insert into scrip_master 
--select ltrim(nse_code),@exchange,symbol,scrip_name,series,ISIN=isnull(ISIN,''),@type,@added_by,@added_on from scrip_master_nse_temp  
--where ltrim(nse_code) not in(select scri_code from scrip_master) OR symbol not in(select scrip_symbol from scrip_master) OR ISIN not in(select ISIN from scrip_master)  
select ltrim(nse_code),@exchange,symbol,a.scrip_name,a.series,ISIN=isnull(a.ISIN,''),@type,@added_by,@added_on
from scrip_master_nse_temp a
left outer join
scrip_master b
on isnull(a.nse_code,'')=isnull(b.scri_code,'') and isnull(a.symbol,'')=isnull(b.scrip_symbol,'') and isnull(a.isin,'')=isnull(b.isin,'')
where b.scri_code is null

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NSE_SPAN
-- --------------------------------------------------
CREATE proc USP_NSE_SPAN  
as          
          
set transaction  isolation  level read uncommitted                              
  
declare @path as varchar(500)          
declare @file as varchar(500)          
declare @sql as varchar(1000)     
declare @s as varchar(1000)     
declare @s1 as varchar(1000)     
         
  
set @path = 'D:\upload1\NSESPAN\ael.csv'      
--set @file = 'D:\upload1\NSESPAN\Exposure_Margin.txt'                 
  
truncate table tblnseSpan  
  
SET @SQL = 'BULK INSERT tblnseSpan FROM '''+@path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                  
--print @SQL   
  
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NSE_SPAN1
-- --------------------------------------------------
CREATE proc USP_NSE_SPAN1    
as            
            
set transaction  isolation  level read uncommitted                                
    
declare @path as varchar(500)            
declare @file as varchar(500)            
declare @sql as varchar(1000)       
declare @s as varchar(1000)       
declare @s1 as varchar(1000)       
           
    
set @path = 'D:\upload1\margin_file\elm.csv'        
--set @file = 'D:\upload1\NSESPAN\Exposure_Margin.txt'                   
    
truncate table tblnseSpan1    
    
SET @SQL = 'BULK INSERT tblnseSpan1 FROM '''+@path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                    
--print @SQL     
    
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NSECURRENCY
-- --------------------------------------------------
  
/******************************************************************************  
CREATED BY: SHIVAKUMAR LAKKAMPELLI  
DATE: November 01 2011  
PURPOSE: TO INSERT NSE CURRENCY TRADE DATA INTO MAIN TABLE  
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
  
CREATE PROC USP_NSECURRENCY    
 (         
   @FILENAME AS VARCHAR(45)    
 )    
 AS    
 BEGIN   
        --TRUNCATE TABLE mis.fobkg.dbo.tbl_NSEcurrency_exchange    
		INSERT INTO mis.fobkg.dbo.tbl_NSEcurrency_exchange   
		SELECT * FROM   
		tbl_nsecurrency_temp   
    
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_NSECURRENCY_ADMIN
-- --------------------------------------------------
           
            
CREATE PROC USP_NSECURRENCY_ADMIN              
 (                   
   @FILENAME AS VARCHAR(45)              
 )              
 AS              
 BEGIN        
  BEGIN                
   SET NOCOUNT ON         
  delete from  MIS.FOBKG.DBO.TBL_NSE_ADMIN      
   SET NOCOUNT OFF     
   End     
  INSERT INTO MIS.FOBKG.DBO.TBL_NSE_ADMIN            
  SELECT * FROM TBL_NSEADMIN_TEMP          
             
              
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Odin_Daily_Report
-- --------------------------------------------------
CREATE Proc Usp_Odin_Daily_Report        
as  
  
Declare @Val as bit      
  
If Exists(Select distinct start_date from intranet.risk.dbo.bse_sett_mst where Convert(varchar(11),start_date) = Convert(varchar(11),getdate()))  
 Set @Val = 1    
Else If(Datename(dw, getdate()) = 'Saturday')  
 Set @Val = 1    
Else  
 Set @Val = 0    
        
If(@Val = 1)  
Begin  
 create table #temp        
 (        
  Fld_stat varchar(2)        
 )        
         
 insert into #temp values ('M')        
 insert into #temp values ('A')        
 insert into #temp values ('D')        
 insert into #temp values ('R')        
         
 insert into tbl_rpt_status        
 select distinct '','',Branch,Fld_stat,'P',0,getdate(),'' from tbl_Odinmail         
 cross join #temp        
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_FILE
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ODIN_FILE](@server as varchar(25),@Fld_Date as varchar(11),@serveradd as varchar(30))                    
as                    
                    
declare @s as varchar(500)                                                
declare @s1 as varchar(500)                                                
--declare @date as varchar(15)                                                    
declare @file as varchar(50)                      
                  
set @file = @server+'.txt'                                                    
                    
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT odin FROM mis.upload.DBO.Odin_Clt_Map" queryout '+'\upload1\Odin\'+rtrim(ltrim(@file))+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                   
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map where Fld_Date = '''''+@Fld_Date+''''' and Fld_Server = '''''+@Server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\CTCL_'+@file+' -c'           
  
                    
      
        
                              
                     
set @s1= @s+''''                              
--print @s1                  
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_FILE_New
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ODIN_FILE_New](@server as varchar(25),@Fld_Date as varchar(11),@serveradd as varchar(30),@status as varchar(30))                        
as                        
                        
declare @s as varchar(500)                                                    
declare @s1 as varchar(500)                                                    
--declare @date as varchar(15)                                                        
declare @file as varchar(50)                          
                      
set @file = @server+@status+'.txt'                                                        
                        
--set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT odin FROM mis.upload.DBO.Odin_Clt_Map" queryout '+'\upload1\Odin\'+rtrim(ltrim(@file))+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                       
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.Odin_Clt_Map where Fld_Date = '''''+@Fld_Date+''''' and Fld_Server = '''''+@Server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\CTCL_'+@file+' -c -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'          
  
     
      
                        
          
            
                                  
                         
set @s1= @s+''''                                  
--print @s1                      
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Odin_Mail
-- --------------------------------------------------
CREATE Proc Usp_Odin_Mail                      
As                      
           
Declare @Val as bit            
        
If Exists(Select distinct start_date from intranet.risk.dbo.bse_sett_mst where Convert(varchar(11),start_date) = Convert(varchar(11),getdate()))        
 Set @Val = 1          
Else        
 Set @Val = 0          
   print   @Val         
If(@Val = 1)        
Begin        
                   
 Declare @BrCode as varchar(500)                                         
 Declare Check_Branch Cursor for Select distinct Fld_Branch_Code from tbl_rpt_status where Fld_Report_Status = 'P' and                 
 Convert(varchar(11),Fld_UpdateDate) = Convert(varchar(11),getdate()) and Fld_Report_Name <> 'A' and Fld_Branch_Code <> 'VSET' and Fld_Branch_Code <> 'VSET1'                                                
                                         
 Open Check_Branch                                        
 Fetch Next from Check_Branch into @BrCode                                        
                                         
 While @@Fetch_Status = 0                                        
 Begin                         
   Declare @EID as varchar(500)                      
   Declare @EmailId as varchar(50)                                         
   Declare @Cnt as int                      
   Declare Check_Email Cursor for Select Distinct Email from tbl_Odinmail where Branch =@BrCode  and block_mail='N'       
                                           
   Open Check_Email                                        
   Fetch Next from Check_Email into @EmailId                         
                                       
   Set @Cnt = 1                                        
   While @@Fetch_Status = 0                                        
    Begin                         
  If @Cnt = 1                      
   Set @EID = @EmailId                      
  Else                      
   Set @EID = @EID+';'+@EmailId                      
  Set @Cnt = @Cnt+1                      
  Fetch Next from Check_Email into @EmailId                                        
   End                                                        
                                                            
   Close Check_Email                                                        
   Deallocate Check_Email                
                
  Declare @Str as Varchar(500)                    
  Set @Str = 'Exec Usp_AutoMail_Odin '''+@EID+''','''+@BrCode+''''              
 Exec(@Str)                       
                          
  Fetch Next from Check_Branch into @BrCode                                        
 End                                                        
                                                           
 Close Check_Branch                                                        
 Deallocate Check_Branch                       
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_UPLOAD_REPORT
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ODIN_UPLOAD_REPORT](@status as char(1),@access_code as varchar(15))                    
AS                    
                    
--Declare @access_code as varchar(100)                     
                    
--------------                    
Declare @tablename as varchar(100)                     
Declare @type as varchar(100)                     
Declare @tablename1 as varchar(100)                     
Declare @str as varchar(5500)                    
                
Declare @file as varchar(100)                  
Declare @s as varchar(500)                  
Declare @s1 as varchar(500)                  
                
                   
                    
--set @access_code = 'ACM'                    
set @tablename = 'tbl_reco_'+@access_code                    
set @tablename1 = 'tbl_ODin_'+@access_code                    
                    
                    
set @str='Truncate table '+@tablename+''               
exec(@str)                     
                    
---------Case Active Clients-----------                    
If @status = 'A'                      
Begin                  
set @type = 'ACTIVE_CLIENTS'                  
                  
set @str = @str+' insert into '+@tablename+''                     
set @str = @str + ' select ''Party Code''+''|''+''PartyName''+''|''+''isnull(Branch,'''')''+''|''+''SubBroker''+''|''+''Bsecm''+''|''+''Nsecm''+''|''+''Nsefo''+''|''+''Mcdx''+''|''+''Ncdx''+''|''+''Bsefo'''                                                 
 
set @str = @str + ' insert into '+@tablename+' select rtrim(ltrim(cl_code))+''|''+rtrim(ltrim(long_name))+''|''+rtrim(ltrim(branch_cd))+''|''+rtrim(ltrim(sub_broker))+''|''+'                                                        
set @str = @str + ' isnull(bsecm,''N'')+''|''+isnull(nsecm,''N'')+''|''+isnull(nsefo,''N'')+''|''+isnull(mcdx,''N'')+''|''+isnull(ncdx,''N'')+''|''+isnull(bsefo,''N'')from intranet.risk.dbo.client_details x where exists '                                  
  
                          
set @str = @str + ' (select * from '+@tablename1+' y (nolock) where x.cl_code = y.party_code ) and Last_Inactive_date >= getdate()'                                                          
exec(@str)                
                
set @file = '\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                  
            
set @s1= @s+''''                 
exec(@s1)                  
                
End                  
                  
                    
-------------------------Case Deactive Clients-----                    
If @status = 'D'                    
                
                  
Begin                  
set @type = 'DEACTIVE_CLIENTS'                   
                  
set @str = @str+' select cl_code,branch_cd into #x from intranet.risk.dbo.client_details x where exists '                    
set @str = @str+' (select * from '+@tablename1+' y where x.cl_code = y.party_code and (Last_Inactive_date <= getdate() or x.branch_cd = ''CALNT''))'                                          
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+x.Party_Code+''|''+isnull(x.Branch_cd,'''')+''|''+ Case when y.branch_cd = ''CALNT'' then ''(CALL AND TRADE)'' else ''CLOSED BY KYC'' End +''|''+isnull(Passwrd,'''')+''|''+Category+''|''+  C
ase when y.branch_cd = ''CALNT'' then ''(CALL&TRADE)TOLL FREE NO 18003003333/4'' else isnull(Address1,'''') End +''|''+ Case when y.branch_cd = ''CALNT'' then ''(CONTACT NO- 39527000 EXT 115)'' else isnull(Address1,'''') End+''|'''                    
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''+isnull(Surv_Auto_Manual,'''')
 +''|'''                                    
set @str = @str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''+isnull(ClientValidationOnOf
f,'''')+''|'''                                    
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFla
g,'''')+''|''+'                                    
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')
+''|''+'                                    
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'                              
  
set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''
 |''+'                                    
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(ProductType,'''') from '+@tablename1+' x (nolock)'                                    
set @str = @str+' inner join #x y on x.party_code = y.cl_code'                      
--exec(@str)                
print @str  
                
set @file = '\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                  
            
set @s1= @s+''''           
--exec(@str)                
print @s1  
                 
End                    
-------------------------Case Deactive Clients-----                    
If @status = 'R'                  
                
                  
Begin                  
set @type = 'MISSING_CLIENTS'                   
                  
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+Party_Code+''|''+isnull(Branch_cd,'''')+''|''+''CLOSED BY KYC''+''|''+isnull(Passwrd,'''')+''|''+Category+''|''+isnull(Address1,'''')+''|''+isnull(Address2,'''')+''|'''                      
      
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''+isnull(Surv_Auto_Manual,'''')
  +''|'''                                    
set @str = @str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''+isnull(ClientValidationOnOf
f,'''')+''|'''                                    
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFla
g,'''')+''|''+'                                    
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')
+''|''+'                                    
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'                              
  
set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''
|''+'               
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(ProductType,'''') from '+@tablename1+' x (nolock) where'                         
set @str = @str+' not exists (select * from AngelNseCM.msajag.dbo.client_details y where x.Party_Code = y.cl_code) and x.Opcode<>''opcode'''                    
--print @str          
--exec(@str)           
exec(@str)                
                
set @file = '\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                  
            
set @s1= @s+''''            
--print  @s1             
exec(@s1)                  
                
End                    
                    
                  
If @status = 'M'                  
                  
Begin                    
set @type = 'MISMATCH_CLIENTS'                  
exec USP_KYC_ODIN_Mismatch1 @access_code                
                
set @file = '\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                  
            
set @s1= @s+''''                 
exec(@s1)                                
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_UPLOAD_REPORT_1
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ODIN_UPLOAD_REPORT_1](@status as char(1),@access_code as varchar(15),@EmpCode varchar(30),@BranchCd as Varchar(15),@ip as varchar(20))                                                                
AS                                                                
                                                                
--Declare @access_code as varchar(100)                                                                 
                                                                
--------------                                                      
/*If Not Exists(Select * from tbl_rpt_status where Convert(varchar(11),Fld_UpdateDate) = Convert(varchar(11),getdate()))                                                
 Exec Usp_Odin_Daily_Report           */                                            
                                                   
Declare @tablename as varchar(100)                                                                 
Declare @type as varchar(100)                                                                 
Declare @tablename1 as varchar(100)                                                                 
Declare @str as varchar(5000)                                                                                    
                                                            
Declare @file as varchar(100)                                                              
Declare @s as varchar(500)                                                              
Declare @s1 as varchar(500)                                                              
                                                               
                                                            
set @tablename = 'tbl_reco_'+@access_code                                                                
set @tablename1 = 'tbl_ODin_'+@access_code                                                                 
                        
set @str='Truncate table '+@tablename+''                                                           
exec(@str)                                                         
                                         
Select EmpCode into #Emp from tbl_Odinmail group by EmpCode,Name having Count(*) > 1                            
                            
If Not Exists(Select * from #Emp where EmpCode = @EmpCode)                            
Begin                            
 Select @BranchCd = Branch from tbl_Odinmail where EmpCode = @EmpCode                                       
End                            
                                                                
---------Case Active Clients-----------                                                                
If @status = 'A'                                                                  
Begin                                                              
set @type = 'ACTIVE_CLIENTS'                                                              
                          
set @str = @str+' insert into '+@tablename+''                                                                 
set @str = @str + ' Select ''Party Code''+''|''+''PartyName''+''|''+''Branch''+''|''+''SubBroker''+''|''+''Bsecm''+''|''+''Nsecm''+''|''+''Nsefo''+''|''+''Mcdx''+''|''+''Ncdx''+''|''+''Bsefo'''                                                              
  
    
      
        
          
            
set @str = @str + ' insert into '+@tablename+' select rtrim(ltrim(cl_code))+''|''+rtrim(ltrim(long_name))+''|''+rtrim(ltrim(branch_cd))+''|''+rtrim(ltrim(sub_broker))+''|''+'                                                                                 
  
    
      
        
          
            
set @str = @str + ' isnull(bsecm,''N'')+''|''+isnull(nsecm,''N'')+''|''+isnull(nsefo,''N'')+''|''+isnull(mcdx,''N'')+''|''+isnull(ncdx,''N'')+''|''+isnull(bsefo,''N'')from intranet.risk.dbo.client_details x where exists '                                  
  
    
      
        
          
            
set @str = @str + ' (select * from '+@tablename1+' y (nolock) where x.cl_code = y.party_code ) and Last_Inactive_date >= getdate()'                              
exec(@str)                                                            
                                             
set @file = '\\'+@ip+'\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'               
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                                 
 
                    
                      
                        
set @s1= @s+''''                                                             
exec(@s1)                                                          
                                                  
End                                                              
                                                           
-------------------------Case Deactive Clients-----                                            
If @status = 'D'                                                                
                                                                
Begin                                                              
set @type = 'DEACTIVE_CLIENTS'                                      
                          
set @str = @str+' Select cl_code,branch_cd,Last_Inactive_date into #Det from intranet.risk.dbo.client_details where Last_Inactive_date <= getdate() or branch_cd = ''CALNT'';'                      
set @str = @str+' Select cl_code,branch_cd into #x from #Det x where exists '                                         
set @str = @str+' (select * from '+@tablename1+' y where x.cl_code = y.party_code);'                                                                          
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+x.Party_Code+''|''+isnull(x.Branch_cd,'''')+''|''+ Case when y.branch_cd = ''CALNT'' then ''(CALL AND TRADE)'' else ''CLOSED BY KYC'' End +''|''+isnull(Passwrd,'''')+''|''+Category+''|''  
+Case when y.branch_cd = ''CALNT'' then ''(CALL&TRADE)TOLL FREE NO 18003003333/4'' else isnull(Address1,'''') End +''|''+ Case when y.branch_cd = ''CALNT'' then ''(CONTACT NO- 39527000 EXT 115)'' else isnull(Address1,'''') End+''|'''                      
     
   
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''  
+isnull(Surv_Auto_Manual,'''')+''|'''                                                                    
set @str = @str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''  
+isnull(ClientValidationOnOff,'''')+''|'''                                                                    
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''  
+isnull(EqFlag,'''')+''|''+'                                                                  
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''  
+isnull(Branch_Name,'''')+''|''+'                                                                  
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'                              
  set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''  
+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                                  
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from '+@tablename1+' x (nolock)'                                                                    
set @str = @str+' inner join #x y on x.party_code = y.cl_code'                                                            
--print @str  
exec(@str)                                                            
                   
set @file = '\\'+@ip+'\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                                                                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                       
                      
                      
set @s1= @s+''''    
--print @s1                                                           
exec(@s1)                                                                                   
End                                                                
-------------------------Case Deactive Clients-----                               
If @status = 'R'                                                              
                                                            
                                                              
Begin                                                     
set @type = 'MISSING_CLIENTS'                                                        
                          
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+Party_Code+''|''+Branch_cd+''|''+''CLOSED BY KYC''+''|''+isnull(Passwrd,'''')+''|''+Category+''|''+isnull(Address1,'''')+''|''+isnull(Address2,'''')+''|'''                
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''  
+isnull(Surv_Auto_Manual,'''')+''|'''                                                                                
set @str = @str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''  
+isnull(ClientValidationOnOff,'''')+''|'''                                                                                
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''  
+isnull(EqFlag,'''')+''|''+'                                                                                
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''  
+isnull(Branch_Name,'''')+''|''+'                                                                                
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'          
set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''  
+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                                  
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from '+@tablename1+' x (nolock)  where Nse_Cash_ctcl_Branchid is null and Nse_cash_ctcl_id is null and Derv_CTCL_BranchId is null and Derv_CTCL_Id is null   
and BSE_Cash_CTCL_BranchId is null     and BSE_Cash_CTCL_Id is null and MCX_CTCL_BranchId is null and MCX_CTCLId is null and NCDEX_CTCLBranchId is null and NCDEXCTCL_Id is null and'                                                                     
set @str = @str+' not exists (select * from AngelNseCM.msajag.dbo.client_details y where x.Party_Code = y.cl_code) and x.Opcode<>''opcode'''                                          
--print @str
exec(@str)                      
                  
Set @file = '\\'+@ip+'\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                                                          
Set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                            
                          
set @s1= @s+''''                                                             
--print @s1  
exec(@s1)                                                     
                                                        
End                                                                
                                                                
                                                              
If @status = 'M'                                         
                                                              
Begin                                                                
set @type = 'MISMATCH_CLIENTS'                                                              
                              
Exec USP_KYC_ODIN_Mismatch1 @access_code                          
                                                          
set @file = '\\'+@ip+'\d$\upload1\KYCODIN\'+@type+'-'+@access_code+'.txt'                                                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                                    
  
    
      
        
                              
set @s1= @s+''''                                                             
exec(@s1)                                                                            
End                                                       
                                            
Set @s = 'Update tbl_rpt_status set Fld_EmpCode = '''+@EmpCode+''',Fld_Access_Code='''+@access_code+''',Fld_ModifiedDate=getdate(),Fld_CodeCount = (Select Count(1) from '+@tablename+'),Fld_Report_Status=''C'' where Fld_Branch_Code='''+@BranchCd+'''       
  
    
      
and Fld_Report_Name = '''+@status+''' and convert(varchar(11),fld_updatedate) = convert(varchar(11),getdate())'                             
--print @s                
exec(@s)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_UPLOAD_REPORT_inhouse
-- --------------------------------------------------
CREATE Proc [dbo].[USP_ODIN_UPLOAD_REPORT_inhouse](@status as char(1),@access_code as varchar(15),@EmpCode varchar(30),@BranchCd as Varchar(15),@ip as varchar(20))                                                                          
AS                                                                          
                                                                          
--Declare @access_code as varchar(100)                                                                           
                                                                          
--------------                                                                
/*If Not Exists(Select * from tbl_rpt_status where Convert(varchar(11),Fld_UpdateDate) = Convert(varchar(11),getdate()))                                                          
 Exec Usp_Odin_Daily_Report           */                                                      
                                                             
Declare @tablename as varchar(100)                                                                           
Declare @type as varchar(100)                                                                           
Declare @tablename1 as varchar(100)                                                                           
Declare @str as varchar(5000)                                                                                              
                                                                      
Declare @file as varchar(100)                                                                        
Declare @s as varchar(500)                                                                        
Declare @s1 as varchar(500)                                                                        
                                                                         
                                                                      
set @tablename = 'tbl_reco_'+@access_code                                                                          
set @tablename1 = 'tbl_ODin_'+@access_code                                                                           
                                  
set @str='Truncate table '+@tablename+''     
print(@str)                                                                 
--exec(@str)                                   
        
        
        
declare @cnt int        
        
select @cnt=count(locacode) from MisMatchMapping_inhouse_log where locacode=@BranchCd        
        
if(@cnt=0)        
begin         
        
insert into MisMatchMapping_inhouse_log        
select Deactive=0,Missing=0,Mismatch=0,surv_onoff=0,locacode=@BranchCd,updated_on=getdate(),updated_by='System'          
        
end        
        
        
                                                   
Select EmpCode into #Emp from tbl_Odinmail group by EmpCode,Name having Count(*) > 1                                      
                                      
If Not Exists(Select * from #Emp where EmpCode = @EmpCode)                                      
Begin                                      
 Select @BranchCd = Branch from tbl_Odinmail where EmpCode = @EmpCode                                                 
End                                      
                                                                          
    
Exec USP_KYC_ODIN_Mismatch_inhouse @access_code,@BranchCd,@EmpCode                                    
                                                                    
set @file = '\\'+@ip+'\d$\upload1\KYCODIN\Mismatch-'+@access_code+'.txt'                                                                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                           
set @s1= @s+''''                                                                       
exec(@s1)     
        
                                    
set @str = ''    
set @str = @str+' Select cl_code,branch_cd,Last_Inactive_date into #Det from intranet.risk.dbo.client_details where Last_Inactive_date <= getdate() or branch_cd = ''CALNT'';'                                
set @str = @str+' Select cl_code,branch_cd into #x from #Det x where exists '                                                   
set @str = @str+' (select * from '+@tablename1+' y where x.cl_code = y.party_code);'                                                                                    
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+x.Party_Code+''|''+isnull(x.Branch_cd,'''')+''|''+ Case when y.branch_cd = ''CALNT'' then ''(CALL AND TRADE)'' else ''CLOSED BY KYC'' End +''|''+isnull(Passwrd,'''')+''|''+Category+''|''+Case when y.branch_cd = ''CALNT'' then ''(CALL&TRADE)TOLL FREE NO 18003003333/4'' else isnull(Address1,'''') End +''|''+ Case when y.branch_cd = ''CALNT'' then ''(CONTACT NO- 39527000 EXT 115)'' else isnull(Address1,'''') End+''|'''                         
   
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''+isnull(Surv_Auto_Manual,'''')+''|'''                                                                              
set @str = @str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''+isnull(ClientValidationOnOff,'''')+''|'''                                                                              
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFlag,'''')+''|''+'                                                                            
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')+''|''+'                                                                            
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'        
set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                                            
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from '+@tablename1+' x (nolock)'                                                                              
set @str = @str+' inner join #x y on x.party_code = y.cl_code'                                                                      
print @str            
--exec(@str)                                                                      
                             
set @file = '\\'+@ip+'\d$\upload1\KYCODIN\DeActive-'+@access_code+'.txt'                                                                                                          
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                                 
        
                                
set @s1= @s+''''              
print @s1                                                                     
--exec(@s1)                                                                                             
        
declare @log varchar(5000)        
        
set @log='update MisMatchMapping_inhouse_log set Deactive=b.cnt,updated_on=getdate(),updated_by='''+@EmpCode+''' from (select cnt=count(*) from '+@tablename+')b where locacode='''+@BranchCd+''''        
        
print @log        
--exec(@log)                                                                                             
                                                             
set @str = ''        
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+Party_Code+''|''+Branch_cd+''|''+''CLOSED BY KYC''+''|''+isnull(Passwrd,'''')+''|''+Category+''|''+isnull(Address1,'''')+''|''+isnull(Address2,'''')+''|'''                          
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|''+isnull(Brokerage,'''')+''|''+isnull(Surv_On_Off,'''')+''|''+isnull(Surv_Auto_Manual,'''')+''|'''                                                                      
set @str = @str+' +isnull(BankDPOnOff,'''')+''|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''+isnull(ClientValidationOnOff,'''')+''|'''                                                                                          
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFlag,'''')+''|''+'                                                                                          
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')+''|''+'                                                                                          
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'                    
set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                                            
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from '+@tablename1+' x (nolock)  where Nse_Cash_ctcl_Branchid is null and Nse_cash_ctcl_id is null and Derv_CTCL_BranchId is null and Derv_CTCL_Id is null and BSE_Cash_CTCL_BranchId is null     
		and BSE_Cash_CTCL_Id is null and MCX_CTCL_BranchId is null and MCX_CTCLId is null and NCDEX_CTCLBranchId is null and NCDEXCTCL_Id is null and'                                                                               
set @str = @str+' not exists (select * from AngelNseCM.msajag.dbo.client_details y where x.Party_Code = y.cl_code) and x.Opcode<>''opcode'''                                                    
print @str          
--exec(@str)                                
                            
Set @file = '\\'+@ip+'\d$\upload1\KYCODIN\Missing-'+@access_code+'.txt'                                                                                                    
Set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                      
                            
set @s1= @s+''''                                                                       
print @s1            
--exec(@s1)                                                               
      
set @log='update MisMatchMapping_inhouse_log set Missing=b.cnt,updated_on=getdate(),updated_by='''+@EmpCode+''' from (select cnt=count(*) from '+@tablename+')b where locacode='''+@BranchCd+''''        
print(@log)  
--exec(@log)                                                                   
                                                                        
                                                                      
                                        
                                                                                     
                                                  
                                                      
Set @s = 'Update tbl_rpt_status set Fld_EmpCode = '''+@EmpCode+''',Fld_Access_Code='''+@access_code+''',Fld_ModifiedDate=getdate(),Fld_CodeCount = (Select Count(1) from '+@tablename+'),Fld_Report_Status=''C'' where Fld_Branch_Code='''+@BranchCd+''' and Fld_Report_Name = '''+@status+''' and convert(varchar(11),fld_updatedate) = convert(varchar(11),getdate())'                                       
print @s  
--exec(@s)        
  
  
  
set @str = ''        
set @str = @str+' insert into '+@tablename+' select Opcode+''|''+Party_Code+''|''+Branch_cd+''|''+''CLOSED BY KYC''+''|''+isnull(Passwrd,'''')+''|''+Category+''|''+isnull(Address1,'''')+''|''+isnull(Address2,'''')+''|'''                          
set @str = @str+' +isnull(City,'''')+''|''+isnull(State_pin,'''')+''|''+isnull(Telephone_No,'''')+''|''+isnull(FaxNo,'''')+''|''+isnull(Email,'''')+''|''+''S''+''|0.00|1|0|'                                                                      
set @str = @str+' 0|''+isnull(ParticipantCode,'''')+''|''+isnull(Filler1,'''')+''|''+isnull(Filler2,'''')+''|''+isnull(Filler3,'''')+''|''+isnull(Filler4,'''')+''|''+isnull(Trading_Allowed,'''')+''|''+isnull(ClientValidationOnOff,'''')+''|'''             
                                                                             
set @str = @str+' +isnull(SpanOnOff,'''')+''|''+isnull(DervPartCode,'''')+''|''+isnull(IP_Address,'''')+''|''+isnull(MaxNoOfOrder,'''')+''|''+isnull(Max_BCast_Scrips,'''')+''|''+isnull(Alias_DealerId,'''')+''|''+isnull(Family_Name,'''')+''|''+isnull(EqFlag,'''')+''|''+'                                                                                          
set @str = @str+' isnull(DervFlag,'''')+''|''+isnull(CombFlag,'''')+''|''+isnull(BSEEq,'''')+''|''+isnull(NEBEComb,'''')+''|''+isnull(NEBEEq,'''')+''|''+isnull(NSE_Cash_CTCL_BranchId,'''')+''|''+isnull(NSE_Cash_CTCL_Id,'''')+''|''+isnull(Branch_Name,'''')+''|''+'                                                                                          
set @str = @str+' isnull(Derv_CTCL_BranchId,'''')+''|''+isnull(Derv_CTCL_Id,'''')+''|''+isnull(Group_Admin,'''')+''|''+isnull(BSE_Cash_CTCL_BranchId,'''')+''|''+isnull(BSE_Cash_CTCL_Id,'''')+''|''+isnull(Segment,'''')+''|''+'                    
set @str = @str+' isnull(ParticipantType,'''')+''|''+isnull(DIET,'''')+''|''+isnull(Net,'''')+''|''+isnull(iWin,'''')+''|''+isnull(NetNetLite,'''')+''|''+isnull(MCX_CTCL_BranchId,'''')+''|''+isnull(MCX_CTCLId,'''')+''|''+isnull(NCDEX_CTCLBranchId,'''')+''|''+'                                                                            
set @str = @str+' isnull(NCDEXCTCL_Id,'''')+''|''+isnull(left(producttype,13),'''') from '+@tablename1+' x (nolock)  where Brokerage<>0.00 or Surv_On_off<>1 or Surv_Auto_manual<>0 or BankDPOnoff<>0'                                                         
                      
  
print @str          
--exec(@str)   
  
Set @file = '\\'+@ip+'\d$\upload1\KYCODIN\Surv_onoff-'+@access_code+'.txt'                                                                                                    
Set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM MIS.UPLOAD.DBO.'+@tablename+'" queryout '+@file+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                                                      
                                    
set @s1= @s+''''                                                                       
print @s1            
--exec(@s1)   
  
set @log='update MisMatchMapping_inhouse_log set surv_onoff=b.cnt,updated_on=getdate(),updated_by='''+@EmpCode+''' from (select cnt=count(*) from '+@tablename+')b where locacode='''+@BranchCd+''''    
print(@log)    
--exec(@log)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_UPLOAD_REPORT_Patch
-- --------------------------------------------------
CREATE PROC [dbo].[USP_ODIN_UPLOAD_REPORT_Patch](@STATUS AS CHAR(1),@ACCESS_CODE AS VARCHAR(15),@EMPCODE VARCHAR(30),@BRANCHCD AS VARCHAR(15),@IP AS VARCHAR(20))                                        
AS                                        
SET NOCOUNT ON                                        
--DECLARE @ACCESS_CODE AS VARCHAR(100)                                        
                                        
--------------                                        
/*IF NOT EXISTS(SELECT * FROM TBL_RPT_STATUS WHERE CONVERT(VARCHAR(11),FLD_UPDATEDATE) = CONVERT(VARCHAR(11),GETDATE()))                                        
EXEC USP_ODIN_DAILY_REPORT */                                        
                                        
DECLARE @TABLENAME AS VARCHAR(100)                                        
DECLARE @TYPE AS VARCHAR(100)                                        
DECLARE @TABLENAME1 AS VARCHAR(100)                                        
DECLARE @STR AS VARCHAR(5000)                                        
                                        
DECLARE @FILE AS VARCHAR(100)                                        
DECLARE @S AS VARCHAR(500)                                        
DECLARE @S1 AS VARCHAR(500)                                        
                                        
                                        
SET @TABLENAME = 'TBL_RECO_'+@ACCESS_CODE                                        
SET @TABLENAME1 = 'TBL_ODIN_'+@ACCESS_CODE                                        
                                        
SET @STR='TRUNCATE TABLE '+@TABLENAME+''                                        
--PRINT(@STR)                                  
EXEC(@STR)                                        
                                        
SELECT EMPCODE INTO #EMP FROM TBL_ODINMAIL GROUP BY EMPCODE,NAME HAVING COUNT(*) > 1                                        
                                        
IF NOT EXISTS(SELECT * FROM #EMP WHERE EMPCODE = @EMPCODE)                                        
BEGIN                                        
 SELECT @BRANCHCD = BRANCH FROM TBL_ODINMAIL WHERE EMPCODE = @EMPCODE              
END                                        
                                        
---------CASE ACTIVE CLIENTS-----------                                        
IF @STATUS = 'A'                                        
BEGIN                                        
                                        
 SET @TYPE = 'ACTIVE_CLIENTS'                                        
 SET @STR = @STR+' INSERT INTO '+@TABLENAME+''                                        
 SET @STR = @STR + ' SELECT ''PARTY CODE''+''|''+''PARTYNAME''+''|''+''BRANCH''+''|''+''SUBBROKER''+''|''+''BSECM''+''|''+''NSECM''+''|''+''NSEFO''+''|''+''MCDX''+''|''+''NCDX''+''|''+''BSEFO'''                                        
 SET @STR = @STR + ' INSERT INTO '+@TABLENAME+' SELECT RTRIM(LTRIM(CL_CODE))+''|''+RTRIM(LTRIM(LONG_NAME))+''|''+RTRIM(LTRIM(BRANCH_CD))+''|''+RTRIM(LTRIM(SUB_BROKER))+''|''+'                                        
 SET @STR = @STR + ' ISNULL(BSECM,''N'')+''|''+ISNULL(NSECM,''N'')+''|''+ISNULL(NSEFO,''N'')+''|''+ISNULL(MCDX,''N'')+''|''+ISNULL(NCDX,''N'')+''|''+ISNULL(BSEFO,''N'')FROM INTRANET.RISK.DBO.CLIENT_DETAILS X WHERE EXISTS '                                 
  
    
      
       
 SET @STR = @STR + ' (SELECT * FROM '+@TABLENAME1+' Y (NOLOCK) WHERE X.CL_CODE = Y.PARTY_CODE ) AND LAST_INACTIVE_DATE >= GETDATE()'                                        
                                        
 EXEC(@STR)                                        
                                        
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                                        
                                        
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SUTINHOUSE -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                        
 SET @S1= @S+''''                                        
                                        
 EXEC(@S1)                          
                                        
END                                        
                              
-------------------------CASE DEACTIVE CLIENTS-----                                        
IF @STATUS = 'D'                                        
                                        
BEGIN            
 SET @TYPE = 'DEACTIVE_CLIENTS'                                        
                                        
 SET @STR = @STR+' SELECT CL_CODE,BRANCH_CD,LAST_INACTIVE_DATE INTO #DET FROM INTRANET.RISK.DBO.CLIENT_DETAILS WHERE LAST_INACTIVE_DATE <= GETDATE() OR BRANCH_CD = ''CALNT'';'                                        
 SET @STR = @STR+' SELECT CL_CODE,BRANCH_CD INTO #X FROM #DET X WHERE EXISTS '                                        
 SET @STR = @STR+' (SELECT * FROM '+@TABLENAME1+' Y WHERE X.CL_CODE = Y.PARTY_CODE);'                                        
 SET @STR = @STR+' INSERT INTO '+@TABLENAME+' SELECT OPCODE+''|''+X.PARTY_CODE+''|''+ISNULL(X.BRANCH_CD,'''')+''|''+ CASE WHEN Y.BRANCH_CD = ''CALNT'' THEN ''(CALL AND TRADE)'' ELSE ''CLOSED BY KYC'' END +''|''+ISNULL(PASSWRD,'''')+''|''+CATEGORY+''|'''  
 
     
      
       
           
            
              
                
 SET @STR = @STR+' +CASE WHEN Y.BRANCH_CD = ''CALNT'' THEN ''(CALL&TRADE)TOLL FREE NO 18003003333/4'' ELSE ISNULL(ADDRESS1,'''') END +''|''+ CASE WHEN Y.BRANCH_CD = ''CALNT'' THEN ''(CONTACT NO- 39527000 EXT 115)'' ELSE ISNULL(ADDRESS1,'''') END+''|'''   
  
    
      
        
          
            
              
                
                 
 SET @STR = @STR+' +ISNULL(CITY,'''')+''|''+ISNULL(STATE_PIN,'''')+''|''+ISNULL(TELEPHONE_NO,'''')+''|''+ISNULL(FAXNO,'''')+''|''+ISNULL(EMAIL,'''')+''|''+''S''+''|''+ISNULL(BROKERAGE,'''')+''|''+ISNULL(SURV_ON_OFF,'''')+''|'''                            
  
    
      
        
          
            
 SET @STR = @STR+' +ISNULL(SURV_AUTO_MANUAL,'''')+''|'''                                 
 SET @STR = @STR+' +ISNULL(BANKDPONOFF,'''')+''|''+ISNULL(PARTICIPANTCODE,'''')+''|''+ISNULL(FILLER1,'''')+''|''+ISNULL(FILLER2,'''')+''|''+ISNULL(FILLER3,'''')+''|''+ISNULL(FILLER4,'''')+''|''+ISNULL(TRADING_ALLOWED,'''')+''|'''                          
  
    
      
        
          
            
              
 SET @STR = @STR+' +ISNULL(CLIENTVALIDATIONONOFF,'''')+''|'''                                         
 SET @STR = @STR+' +ISNULL(SPANONOFF,'''')+''|''+ISNULL(DERVPARTCODE,'''')+''|''+ISNULL(IP_ADDRESS,'''')+''|''+ISNULL(MAXNOOFORDER,'''')+''|''+ISNULL(MAX_BCAST_SCRIPS,'''')+''|''+ISNULL(ALIAS_DEALERID,'''')+''|''+ISNULL(FAMILY_NAME,'''')+''|'''           
  
    
      
        
          
            
              
                 
                
                
 SET @STR = @STR+' +ISNULL(EQFLAG,'''')+''|''+'                                        
 SET @STR = @STR+' ISNULL(DERVFLAG,'''')+''|''+ISNULL(COMBFLAG,'''')+''|''+ISNULL(BSEEQ,'''')+''|''+ISNULL(NEBECOMB,'''')+''|''+ISNULL(NEBEEQ,'''')+''|''+ISNULL(NSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(NSE_CASH_CTCL_ID,'''')+''|'''                       
  
    
      
        
          
            
              
                
                 
 SET @STR = @STR+' +ISNULL(BRANCH_NAME,'''')+''|''+'                                        
 SET @STR = @STR+' ISNULL(DERV_CTCL_BRANCHID,'''')+''|''+ISNULL(DERV_CTCL_ID,'''')+''|''+ISNULL(GROUP_ADMIN,'''')+''|''+ISNULL(BSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(BSE_CASH_CTCL_ID,'''')+''|''+ISNULL(SEGMENT,'''')+''|''+'                             
  
    
      
        
          
 /*          
 SET @STR = @STR+' ISNULL(PARTICIPANTTYPE,'''')+''|''+ISNULL(DIET,'''')+''|''+ISNULL(NET,'''')+''|''+ISNULL(IWIN,'''')+''|''+ISNULL(NETNETLITE,'''')+''|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|''+ISNULL(MCX_CTCLID,'''')+''|'''       */    
     
  SET @STR = @STR+' ISNULL(PARTICIPANTTYPE,'''')+''|0|0|0|0|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|''+ISNULL(MCX_CTCLID,'''')+''|'''                                                               
      
       
 SET @STR = @STR+' +ISNULL(NCDEX_CTCLBRANCHID,'''')+''|''+'                                        
 SET @STR = @STR+' ISNULL(NCDEXCTCL_ID,'''')+''|''+ISNULL(LEFT(PRODUCTTYPE,13),'''')+''|||||||||||||||''+ISNULL(Market_Data_Allowed,'''')+''|||||||||'' FROM '+@TABLENAME1+' X (NOLOCK)'                                        
 SET @STR = @STR+' INNER JOIN #X Y ON X.PARTY_CODE = Y.CL_CODE'                                        
             
 --PRINT @STR                                        
 EXEC(@STR)                                        
       
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                                        
                                        
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
 --SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SUTINHOUSE -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
 SET @S1= @S+''''              
             
 --PRINT @S1                                        
 EXEC(@S1)                                        
         
END                                        
-------------------------CASE DEACTIVE CLIENTS-----              
IF @STATUS = 'R'                                        
                                        
                                        
BEGIN                                        
SET @TYPE = 'MISSING_CLIENTS'                                        
                                
 SET @STR = @STR+' INSERT INTO '+@TABLENAME+' SELECT OPCODE+''|''+PARTY_CODE+''|''+BRANCH_CD+''|''+''CLOSED BY KYC''+''|''+ISNULL(PASSWRD,'''')+''|''+CATEGORY+''|''+ISNULL(ADDRESS1,'''')+''|''+ISNULL(ADDRESS2,'''')+''|'''                    
 SET @STR = @STR+' +ISNULL(CITY,'''')+''|''+ISNULL(STATE_PIN,'''')+''|''+ISNULL(TELEPHONE_NO,'''')+''|''+ISNULL(FAXNO,'''')+''|''+ISNULL(EMAIL,'''')+''|''+''S''+''|''+ISNULL(BROKERAGE,'''')+''|''+ISNULL(SURV_ON_OFF,'''')+''|'''                            
  
    
      
        
         
             
 SET @STR = @STR+' +ISNULL(SURV_AUTO_MANUAL,'''')+''|'''                                        
 SET @STR = @STR+' +ISNULL(BANKDPONOFF,'''')+''|''+ISNULL(PARTICIPANTCODE,'''')+''|''+ISNULL(FILLER1,'''')+''|''+ISNULL(FILLER2,'''')+''|''+ISNULL(FILLER3,'''')+''|''+ISNULL(FILLER4,'''')+''|''+ISNULL(TRADING_ALLOWED,'''')+''|'''                          
  
    
      
        
          
            
             
               
 SET @STR = @STR+' +ISNULL(CLIENTVALIDATIONONOFF,'''')+''|'''                                        
 SET @STR = @STR+' +ISNULL(SPANONOFF,'''')+''|''+ISNULL(DERVPARTCODE,'''')+''|''+ISNULL(IP_ADDRESS,'''')+''|''+ISNULL(MAXNOOFORDER,'''')+''|''+ISNULL(MAX_BCAST_SCRIPS,'''')+''|''+ISNULL(ALIAS_DEALERID,'''')+''|''+ISNULL(FAMILY_NAME,'''')+''|'''           
  
    
      
        
          
            
              
                
                 
 SET @STR = @STR+' +ISNULL(EQFLAG,'''')+''|''+'                                        
 SET @STR = @STR+' ISNULL(DERVFLAG,'''')+''|''+ISNULL(COMBFLAG,'''')+''|''+ISNULL(BSEEQ,'''')+''|''+ISNULL(NEBECOMB,'''')+''|''+ISNULL(NEBEEQ,'''')+''|''+ISNULL(NSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(NSE_CASH_CTCL_ID,'''')+''|'''                       
  
    
      
        
          
            
              
                
                 
 SET @STR = @STR+' +ISNULL(BRANCH_NAME,'''')+''|''+'                                        
 SET @STR = @STR+' ISNULL(DERV_CTCL_BRANCHID,'''')+''|''+ISNULL(DERV_CTCL_ID,'''')+''|''+ISNULL(GROUP_ADMIN,'''')+''|''+ISNULL(BSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(BSE_CASH_CTCL_ID,'''')+''|''+ISNULL(SEGMENT,'''')+''|''+'                             
  
    
      
        
          
/*           
 SET @STR = @STR+' ISNULL(PARTICIPANTTYPE,'''')+''|''+ISNULL(DIET,'''')+''|''+ISNULL(NET,'''')+''|''+ISNULL(IWIN,'''')+''|''+ISNULL(NETNETLITE,'''')+''|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|''+ISNULL(MCX_CTCLID,'''')+''|''' */    
     
  SET @STR = @STR+' ISNULL(PARTICIPANTTYPE,'''')+''|0|0|0|0|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|''+ISNULL(MCX_CTCLID,'''')+''|'''                                      
      
       
 SET @STR = @STR+' +ISNULL(NCDEX_CTCLBRANCHID,'''')+''|''+'                                        
 SET @STR = @STR+' ISNULL(NCDEXCTCL_ID,'''')+''|''+ISNULL(LEFT(PRODUCTTYPE,13),'''')+''|||||||||||||||''+ISNULL(Market_Data_Allowed,'''')+''|||||||||'' FROM '+@TABLENAME1+' X (NOLOCK) '                                        
 SET @STR = @STR+' WHERE NSE_CASH_CTCL_BRANCHID IS NULL AND NSE_CASH_CTCL_ID IS NULL AND DERV_CTCL_BRANCHID IS NULL AND DERV_CTCL_ID IS NULL AND BSE_CASH_CTCL_BRANCHID IS NULL AND BSE_CASH_CTCL_ID IS NULL '                                        
 SET @STR = @STR+' AND MCX_CTCL_BRANCHID IS NULL AND MCX_CTCLID IS NULL AND NCDEX_CTCLBRANCHID IS NULL AND NCDEXCTCL_ID IS NULL AND '                            
 SET @STR = @STR+' NOT EXISTS (SELECT * FROM AngelNseCM.MSAJAG.DBO.CLIENT_DETAILS Y WHERE X.PARTY_CODE = Y.CL_CODE) AND X.OPCODE<>''OPCODE'''                                        
 --PRINT @STR                                        
 EXEC(@STR)                                        
                                        
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                                        
                                        
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
 --SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SUTINHOUSE -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
 SET @S1= @S+''''                                        
 --PRINT @S1              
 EXEC(@S1)                                        
                                        
END                                        
                           
                                        
IF @STATUS = 'M'                                        
                                        
BEGIN                                        
 SET @TYPE = 'MISMATCH_CLIENTS'                                        
                                        
 EXEC USP_KYC_ODIN_MISMATCH_PATCH @ACCESS_CODE                                
                                        
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                                        
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
 --SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SUTINHOUSE -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'              
                                        
 SET @S1= @S+''''                                        
 EXEC(@S1)                   
END                                        
                                        
SET @S = 'UPDATE TBL_RPT_STATUS SET FLD_EMPCODE = '''+@EMPCODE+''',FLD_ACCESS_CODE='''+@ACCESS_CODE+''',FLD_MODIFIEDDATE=GETDATE(),FLD_CODECOUNT = (SELECT COUNT(1) FROM '+@TABLENAME+'),FLD_REPORT_STATUS=''C'' WHERE FLD_BRANCH_CODE='''+@BRANCHCD+''''      
  
   
       
        
          
           
              
                 
                
SET @S = @S+' AND FLD_REPORT_NAME = '''+@STATUS+''' AND CONVERT(VARCHAR(11),FLD_UPDATEDATE) = CONVERT(VARCHAR(11),GETDATE())'                                        
--PRINT @S                                        
EXEC(@S)                                        
                                        
                                        
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ODIN_UPLOAD_REPORT_PATCH23012012
-- --------------------------------------------------
CREATE PROC [dbo].[USP_ODIN_UPLOAD_REPORT_PATCH23012012](@STATUS AS CHAR(1),@ACCESS_CODE AS VARCHAR(15),@EMPCODE VARCHAR(30),@BRANCHCD AS VARCHAR(15),@IP AS VARCHAR(20))                      
AS                      
SET NOCOUNT ON                      
--DECLARE @ACCESS_CODE AS VARCHAR(100)                      
                      
--------------                      
/*IF NOT EXISTS(SELECT * FROM TBL_RPT_STATUS WHERE CONVERT(VARCHAR(11),FLD_UPDATEDATE) = CONVERT(VARCHAR(11),GETDATE()))                      
EXEC USP_ODIN_DAILY_REPORT */                      
                      
DECLARE @TABLENAME AS VARCHAR(100)                      
DECLARE @TYPE AS VARCHAR(100)                      
DECLARE @TABLENAME1 AS VARCHAR(100)                      
DECLARE @STR AS VARCHAR(5000)                      
                      
DECLARE @FILE AS VARCHAR(100)                      
DECLARE @S AS VARCHAR(500)                      
DECLARE @S1 AS VARCHAR(500)                      
                      
                      
SET @TABLENAME = 'TBL_RECO_'+@ACCESS_CODE                      
SET @TABLENAME1 = 'TBL_ODIN_'+@ACCESS_CODE                      
                      
SET @STR='TRUNCATE TABLE '+@TABLENAME+''                      
--PRINT(@STR)                
EXEC(@STR)                      
                      
SELECT EMPCODE INTO #EMP FROM TBL_ODINMAIL GROUP BY EMPCODE,NAME HAVING COUNT(*) > 1                      
                      
IF NOT EXISTS(SELECT * FROM #EMP WHERE EMPCODE = @EMPCODE)                      
BEGIN                      
 SELECT @BRANCHCD = BRANCH FROM TBL_ODINMAIL WHERE EMPCODE = @EMPCODE                      
END                      
                      
---------CASE ACTIVE CLIENTS-----------                      
IF @STATUS = 'A'                      
BEGIN                      
                      
 SET @TYPE = 'ACTIVE_CLIENTS'                      
 SET @STR = @STR+' INSERT INTO '+@TABLENAME+''                      
 SET @STR = @STR + ' SELECT ''PARTY CODE''+''|''+''PARTYNAME''+''|''+''BRANCH''+''|''+''SUBBROKER''+''|''+''BSECM''+''|''+''NSECM''+''|''+''NSEFO''+''|''+''MCDX''+''|''+''NCDX''+''|''+''BSEFO'''                      
 SET @STR = @STR + ' INSERT INTO '+@TABLENAME+' SELECT RTRIM(LTRIM(CL_CODE))+''|''+RTRIM(LTRIM(LONG_NAME))+''|''+RTRIM(LTRIM(BRANCH_CD))+''|''+RTRIM(LTRIM(SUB_BROKER))+''|''+'                      
 SET @STR = @STR + ' ISNULL(BSECM,''N'')+''|''+ISNULL(NSECM,''N'')+''|''+ISNULL(NSEFO,''N'')+''|''+ISNULL(MCDX,''N'')+''|''+ISNULL(NCDX,''N'')+''|''+ISNULL(BSEFO,''N'')FROM INTRANET.RISK.DBO.CLIENT_DETAILS X WHERE EXISTS '                      
 SET @STR = @STR + ' (SELECT * FROM '+@TABLENAME1+' Y (NOLOCK) WHERE X.CL_CODE = Y.PARTY_CODE ) AND LAST_INACTIVE_DATE >= GETDATE()'                      
                      
 EXEC(@STR)                      
                      
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                      
                      
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -UINHOUSE -Pinh6014'                      
 SET @S1= @S+''''                      
                      
 EXEC(@S1)                      
                      
END                      
                      
-------------------------CASE DEACTIVE CLIENTS-----                      
IF @STATUS = 'D'                      
                      
BEGIN                      
 SET @TYPE = 'DEACTIVE_CLIENTS'                      
                      
 SET @STR = @STR+' SELECT CL_CODE,BRANCH_CD,LAST_INACTIVE_DATE INTO #DET FROM INTRANET.RISK.DBO.CLIENT_DETAILS WHERE LAST_INACTIVE_DATE <= GETDATE() OR BRANCH_CD = ''CALNT'';'                      
 SET @STR = @STR+' SELECT CL_CODE,BRANCH_CD INTO #X FROM #DET X WHERE EXISTS '                      
 SET @STR = @STR+' (SELECT * FROM '+@TABLENAME1+' Y WHERE X.CL_CODE = Y.PARTY_CODE);'                      
 SET @STR = @STR+' INSERT INTO '+@TABLENAME+' SELECT OPCODE+''|''+X.PARTY_CODE+''|''+ISNULL(X.BRANCH_CD,'''')+''|''+ CASE WHEN Y.BRANCH_CD = ''CALNT'' THEN ''(CALL AND TRADE)'' ELSE ''CLOSED BY KYC'' END +''|''+ISNULL(PASSWRD,'''')+''|''+CATEGORY+''|'''  
  
    
      
        
          
            
              
                
                  
                    
 SET @STR = @STR+' +CASE WHEN Y.BRANCH_CD = ''CALNT'' THEN ''(CALL&TRADE)TOLL FREE NO 18003003333/4'' ELSE ISNULL(ADDRESS1,'''') END +''|''+ CASE WHEN Y.BRANCH_CD = ''CALNT'' THEN ''(CONTACT NO- 39527000 EXT 115)'' ELSE ISNULL(ADDRESS1,'''') END+''|'''   
  
    
      
        
          
            
              
                
                  
                   
SET @STR = @STR+' +ISNULL(CITY,'''')+''|''+ISNULL(STATE_PIN,'''')+''|''+ISNULL(TELEPHONE_NO,'''')+''|''+ISNULL(FAXNO,'''')+''|''+ISNULL(EMAIL,'''')+''|''+''S''+''|''+ISNULL(BROKERAGE,'''')+''|''+ISNULL(SURV_ON_OFF,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(SURV_AUTO_MANUAL,'''')+''|'''               
 SET @STR = @STR+' +ISNULL(BANKDPONOFF,'''')+''|''+ISNULL(PARTICIPANTCODE,'''')+''|''+ISNULL(FILLER1,'''')+''|''+ISNULL(FILLER2,'''')+''|''+ISNULL(FILLER3,'''')+''|''+ISNULL(FILLER4,'''')+''|''+ISNULL(TRADING_ALLOWED,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(CLIENTVALIDATIONONOFF,'''')+''|'''                      
SET @STR = @STR+' +ISNULL(SPANONOFF,'''')+''|''+ISNULL(DERVPARTCODE,'''')+''|''+ISNULL(IP_ADDRESS,'''')+''|''+ISNULL(MAXNOOFORDER,'''')+''|''+ISNULL(MAX_BCAST_SCRIPS,'''')+''|''+ISNULL(ALIAS_DEALERID,'''')+''|''+ISNULL(FAMILY_NAME,'''')+''|'''            
  
    
      
        
          
 SET @STR = @STR+' +ISNULL(EQFLAG,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(DERVFLAG,'''')+''|''+ISNULL(COMBFLAG,'''')+''|''+ISNULL(BSEEQ,'''')+''|''+ISNULL(NEBECOMB,'''')+''|''+ISNULL(NEBEEQ,'''')+''|''+ISNULL(NSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(NSE_CASH_CTCL_ID,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(BRANCH_NAME,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(DERV_CTCL_BRANCHID,'''')+''|''+ISNULL(DERV_CTCL_ID,'''')+''|''+ISNULL(GROUP_ADMIN,'''')+''|''+ISNULL(BSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(BSE_CASH_CTCL_ID,'''')+''|''+ISNULL(SEGMENT,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(PARTICIPANTTYPE,'''')+''|''+ISNULL(DIET,'''')+''|''+ISNULL(NET,'''')+''|''+ISNULL(IWIN,'''')+''|''+ISNULL(NETNETLITE,'''')+''|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|''+ISNULL(MCX_CTCLID,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(NCDEX_CTCLBRANCHID,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(NCDEXCTCL_ID,'''')+''|''+ISNULL(LEFT(PRODUCTTYPE,13),'''')+''|||||||||||||||''+ISNULL(Market_Data_Allowed,'''')+''|||||||'' FROM '+@TABLENAME1+' X (NOLOCK)'                      
 SET @STR = @STR+' INNER JOIN #X Y ON X.PARTY_CODE = Y.CL_CODE'                      
 --PRINT @STR                      
 EXEC(@STR)                      
                      
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                      
                      
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -UINHOUSE -Pinh6014'                      
 SET @S1= @S+''''                      
 --PRINT @S1                      
 EXEC(@S1)                      
END                      
-------------------------CASE DEACTIVE CLIENTS-----                      
IF @STATUS = 'R'                      
                      
                      
BEGIN                      
SET @TYPE = 'MISSING_CLIENTS'                      
                      
 SET @STR = @STR+' INSERT INTO '+@TABLENAME+' SELECT OPCODE+''|''+PARTY_CODE+''|''+BRANCH_CD+''|''+''CLOSED BY KYC''+''|''+ISNULL(PASSWRD,'''')+''|''+CATEGORY+''|''+ISNULL(ADDRESS1,'''')+''|''+ISNULL(ADDRESS2,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(CITY,'''')+''|''+ISNULL(STATE_PIN,'''')+''|''+ISNULL(TELEPHONE_NO,'''')+''|''+ISNULL(FAXNO,'''')+''|''+ISNULL(EMAIL,'''')+''|''+''S''+''|''+ISNULL(BROKERAGE,'''')+''|''+ISNULL(SURV_ON_OFF,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(SURV_AUTO_MANUAL,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(BANKDPONOFF,'''')+''|''+ISNULL(PARTICIPANTCODE,'''')+''|''+ISNULL(FILLER1,'''')+''|''+ISNULL(FILLER2,'''')+''|''+ISNULL(FILLER3,'''')+''|''+ISNULL(FILLER4,'''')+''|''+ISNULL(TRADING_ALLOWED,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(CLIENTVALIDATIONONOFF,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(SPANONOFF,'''')+''|''+ISNULL(DERVPARTCODE,'''')+''|''+ISNULL(IP_ADDRESS,'''')+''|''+ISNULL(MAXNOOFORDER,'''')+''|''+ISNULL(MAX_BCAST_SCRIPS,'''')+''|''+ISNULL(ALIAS_DEALERID,'''')+''|''+ISNULL(FAMILY_NAME,'''')+''|'''           
  
    
      
        
          
           
 SET @STR = @STR+' +ISNULL(EQFLAG,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(DERVFLAG,'''')+''|''+ISNULL(COMBFLAG,'''')+''|''+ISNULL(BSEEQ,'''')+''|''+ISNULL(NEBECOMB,'''')+''|''+ISNULL(NEBEEQ,'''')+''|''+ISNULL(NSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(NSE_CASH_CTCL_ID,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(BRANCH_NAME,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(DERV_CTCL_BRANCHID,'''')+''|''+ISNULL(DERV_CTCL_ID,'''')+''|''+ISNULL(GROUP_ADMIN,'''')+''|''+ISNULL(BSE_CASH_CTCL_BRANCHID,'''')+''|''+ISNULL(BSE_CASH_CTCL_ID,'''')+''|''+ISNULL(SEGMENT,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(PARTICIPANTTYPE,'''')+''|''+ISNULL(DIET,'''')+''|''+ISNULL(NET,'''')+''|''+ISNULL(IWIN,'''')+''|''+ISNULL(NETNETLITE,'''')+''|''+ISNULL(MCX_CTCL_BRANCHID,'''')+''|''+ISNULL(MCX_CTCLID,'''')+''|'''                      
 SET @STR = @STR+' +ISNULL(NCDEX_CTCLBRANCHID,'''')+''|''+'                      
 SET @STR = @STR+' ISNULL(NCDEXCTCL_ID,'''')+''|''+ISNULL(LEFT(PRODUCTTYPE,13),'''')+''|||||||||||||||''+ISNULL(Market_Data_Allowed,'''')+''|||||||'' FROM '+@TABLENAME1+' X (NOLOCK) '                      
 SET @STR = @STR+' WHERE NSE_CASH_CTCL_BRANCHID IS NULL AND NSE_CASH_CTCL_ID IS NULL AND DERV_CTCL_BRANCHID IS NULL AND DERV_CTCL_ID IS NULL AND BSE_CASH_CTCL_BRANCHID IS NULL AND BSE_CASH_CTCL_ID IS NULL '                      
 SET @STR = @STR+' AND MCX_CTCL_BRANCHID IS NULL AND MCX_CTCLID IS NULL AND NCDEX_CTCLBRANCHID IS NULL AND NCDEXCTCL_ID IS NULL AND '                      
 SET @STR = @STR+' NOT EXISTS (SELECT * FROM AngelNseCM.MSAJAG.DBO.CLIENT_DETAILS Y WHERE X.PARTY_CODE = Y.CL_CODE) AND X.OPCODE<>''OPCODE'''                      
 --PRINT @STR                      
 EXEC(@STR)                      
                      
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                      
                      
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -UINHOUSE -Pinh6014'                      
 SET @S1= @S+''''                      
 PRINT @S1                      
 EXEC(@S1)                      
                      
END                      
                      
                      
IF @STATUS = 'M'                      
                      
BEGIN                      
 SET @TYPE = 'MISMATCH_CLIENTS'                      
                      
 EXEC USP_KYC_ODIN_MISMATCH_PATCH @ACCESS_CODE                      
                      
 SET @FILE = '\\'+@IP+'\D$\UPLOAD1\KYCODIN\'+@TYPE+'-'+@ACCESS_CODE+'.TXT'                      
 SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT HEADING FROM MIS.UPLOAD.DBO.'+@TABLENAME+'" QUERYOUT '+@FILE+' -c -SINTRANET -UINHOUSE -Pinh6014'                      
                      
 SET @S1= @S+''''                      
 EXEC(@S1)                      
END                      
                      
SET @S = 'UPDATE TBL_RPT_STATUS SET FLD_EMPCODE = '''+@EMPCODE+''',FLD_ACCESS_CODE='''+@ACCESS_CODE+''',FLD_MODIFIEDDATE=GETDATE(),FLD_CODECOUNT = (SELECT COUNT(1) FROM '+@TABLENAME+'),FLD_REPORT_STATUS=''C'' WHERE FLD_BRANCH_CODE='''+@BRANCHCD+''''      
  
    
      
        
          
           
               
               
                 
SET @S = @S+' AND FLD_REPORT_NAME = '''+@STATUS+''' AND CONVERT(VARCHAR(11),FLD_UPDATEDATE) = CONVERT(VARCHAR(11),GETDATE())'                      
--PRINT @S                      
EXEC(@S)                      
                      
                      
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OldCOde_To_NewCode_Shifing
-- --------------------------------------------------
CREATE Proc USP_OldCOde_To_NewCode_Shifing              
(              
@filename as varchar(50),  
@server as varchar(50)  
)              
as              
              
create table #t              
(              
Fld_FromCode varchar(11),              
Fld_ToCode varchar(11)            
)              
              
declare @path as varchar(50)              
declare @sql as varchar(500)              
              
set @path='\\'+@server+'\d$\upload1\' + @filename                          
SET @SQL = 'BULK INSERT #t FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'                          
exec (@sql)                   
            
select distinct Dpclcode,accountid into #dpclcode from middleware.mimansa.dbo.angeldptran where DPTRFTAG <> 'T'            
      
delete from tbl_HoldingShifting_Codes where convert(varchar(11),Fld_Date) = convert(varchar(11),getdate())        
and Fld_Flag = 'P'      
            
insert into tbl_HoldingShifting_Codes            
select Fld_FromCode,Fld_ToCode,            
case               
when y.accountid = '14216209' then 'BSE'            
when y.accountid = '13326100' then 'NSE'            
when y.accountid = '15464303' then 'NSEFO'            
when y.accountid = '11198145' then 'MCX'            
when y.accountid = '11198647' then 'NCDEX' end,'P',getdate() from #t x,#dpclcode y where x.Fld_FromCode = y.Dpclcode            
            
select * from tbl_HoldingShifting_Codes (nolock) where         
Fld_Flag = 'P' and convert(varchar(11),Fld_Date) = convert(varchar(11),getdate())

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_omnesys_user_info
-- --------------------------------------------------
CREATE proc USP_omnesys_user_info       
(      
  @filename as varchar(45),      
  @Total int out       
)             
as                     
set nocount on           
      
 --truncate table  omnesys_user_info_all            
 --insert into omnesys_user_info_all                   
 --select * from omnesys_user_info --where dealer_id not in             
 ----(select dealer_id from omnesys_user_info_all)                
 --truncate table genodinlimit.dbo.ctcl_omnesys        
   ---omnesys_user_info_testing    
     --Omn_User_info_new  
            
    Declare @filePath varchar(500)=''                  
    --Declare @FileName varchar(500)='uploadAdvChart.csv'                  
    set @filePath ='\\INHOUSELIVEAPP2-FS.angelone.in\D$\UploadAdvChart\'+@FileName+''                  
    --set @filePath ='\\196.1.115.183\D$\UploadAdvChart\Omnsye.CSV'                
    DECLARE @sql NVARCHAR(4000) = 'BULK INSERT Tbl_OmnUserinfo FROM ''' + @filePath + ''' WITH ( FIELDTERMINATOR ='','', ROWTERMINATOR =''\n'',FirstRow=1 )';                  
    EXEC(@sql)                  
    print (@sql)                  
    print @filePath

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto
-- --------------------------------------------------
        
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'        
CREATE Procedure [dbo].[Usp_OmnUserInfoAuto]        
(        
    @USERNAME VARCHAR(100),                      
    @IPADDR   VARCHAR(100)        
)        
As        
BEGIN         
         
 declare  @StartDate datetime  =getdate()         
        
         
 ----///*****Hist Table ***************///---------------        
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)        
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo       
         
 ----///*****Insert In Main Omnesys Table ***************///---------------        
 truncate table Tbl_OmnUserinfo        
         
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------      
 --insert into Tbl_OmnUserinfo        
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]      
       
       
 --insert into Tbl_OmnUserinfo        
 --select distinct mnmUser,mnmBroker       
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a       
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b      
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI      
       
       
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)      
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '10.253.33.65'    
               when OmneManagerID='2' then  '10.253.33.66'    
               when OmneManagerID='3' then  '10.253.33.67'    
               when OmneManagerID='4' then  '10.253.33.68'    
               when OmneManagerID='6' then  '10.253.33.77'    
               when OmneManagerID='7' then  '10.253.33.79'    
               When OmneManagerId='8' then  '10.253.33.80'    
               When OmneManagerId='9' then  '10.253.33.81'     
               When OmneManagerId='10' then  '10.253.33.163'   
      When OmneManagerId='12' then  '10.253.78.159'    
               --When OmneManagerId='104' then  '10.253.33.68'    
               --When OmneManagerId='106' then  '10.253.33.77'    
               When OmneManagerId='102' then  '10.253.33.66'    
               --When OmneManagerId='107' then  '10.253.33.79'    
               --When OmneManagerId='108' then  '10.253.33.80'    
               When OmneManagerId='11' then  '10.253.33.78'  
      When OmneManagerId='12' then  '10.253.78.159'  
      When OmneManagerId='13' then  '10.253.78.160'     
                end ) as OmneManagerID                 
 from [10.253.33.65].[Uploader-db-amx].dbo.tbl_usermasterinfo where ClientStatus='A'     
     
      
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId       
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'      
 --union all       
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId      
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all      
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId      
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all       
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId        
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId        
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId        
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
      
 ----------------------------------------END---------------------------------------------------------------------------      
        
         
 declare @userCount varchar(10)        
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.65'       
       
 declare @userCount_B2B varchar(10)        
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'        
       
 declare @userCount_GM3 varchar(10)        
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'      
       
 declare @userCount_GM4 varchar(10)        
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'     
     
 declare @userCount_GM6 varchar(10)        
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'     
     
 declare @userCount_GM7 varchar(10)        
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'    
     
 declare @userCount_GM8 varchar(10)        
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'    
     
 declare @userCount_GM9 varchar(10)        
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.81'    
     
 declare @userCount_GM10 varchar(10)        
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'    
     
 --declare @userCount_GPX_104 varchar(10)        
 --select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'     
     
 --declare @userCount_GPX_106 varchar(10)        
 --select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'      
     
 declare @userCount_GPX_102 varchar(10)        
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'     
     
 --declare @userCount_GPX_107 varchar(10)        
 --select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'    
     
 --declare @userCount_GPX_108 varchar(10)        
 --select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'     
     
 --declare @userCount_GPX_103 varchar(10)        
 --select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 declare @userCount_GM11 varchar(10)        
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'      
   
   
 declare @userCount_GM12 varchar(10)        
 select @userCount_GM12 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.159'  
   
 declare @userCount_GM13 varchar(10)        
 select @userCount_GM13 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.160'      
         
 ---------------///**********Log Table **********************/////-------------------------        
  insert into Tbl_UserInfoLogTime         
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR        
           
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR       
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR      
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR      
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR    
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM12',@StartDate,getdate(),@userCount_GM12,'UserInfo_GM12',@USERNAME,@IPADDR    
  
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM13',@StartDate,getdate(),@userCount_GM13,'UserInfo_GM13',@USERNAME,@IPADDR   
         
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------      
        
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys      
        
  --------------------------///////////////END*********************---------------------       
              
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc     
   drop table UserInfoFileDownload         
          
   select distinct ClientCode,GroupId,Brokerid,ServerId      
   into UserInfoFileDownload      
   from Tbl_OmnUserinfo with (nolock)       
          
             
   DECLARE @filename1 as varchar(100)                                                        
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND VARCHAR(350)                                    
   DECLARE @FILENAME VARCHAR(250)                             
   declare @s1 as varchar(max)                            
                        
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.65''" QUERYOUT "'                            
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND      
         
         
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------      
   DECLARE @filename2 as varchar(100)                                                        
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_2 VARCHAR(350)                                    
   DECLARE @FILENAME_2 VARCHAR(250)                             
   declare @s2 as varchar(max)                            
                        
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
    
                         
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2         
         
         
        
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------      
         
   DECLARE @filename3 as varchar(100)                                                        
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_3 VARCHAR(350)                                    
   DECLARE @FILENAME_3 VARCHAR(250)                             
   declare @s3 as varchar(max)                            
                        
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
   
                         
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3      
         
         
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------        
           
   DECLARE @filename4 as varchar(100)                                                          
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_4 VARCHAR(350)                                      
   DECLARE @FILENAME_4 VARCHAR(250)                               
   declare @s4 as varchar(max)                              
                          
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                              
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4        
       
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------        
           
   DECLARE @filename6 as varchar(100)                                                          
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_6 VARCHAR(350)                                      
   DECLARE @FILENAME_6 VARCHAR(250)                               
   declare @s6 as varchar(max)                              
                          
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                              
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6     
       
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------        
           
   DECLARE @filename7 as varchar(100)                                                          
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_7 VARCHAR(350)                                      
   DECLARE @FILENAME_7 VARCHAR(250)                       
   declare @s7 as varchar(max)                              
                          
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                              
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7     
       
       
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------        
           
   DECLARE @filename8 as varchar(100)                                                          
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_8 VARCHAR(350)                                      
   DECLARE @FILENAME_8 VARCHAR(250)                               
   declare @s8 as varchar(max)                              
                          
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                              
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8     
       
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------        
           
   DECLARE @filename9 as varchar(100)                                                          
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_9 VARCHAR(350)                                      
   DECLARE @FILENAME_9 VARCHAR(250)                               
   declare @s9 as varchar(max)                              
                          
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.81'' " QUERYOUT "'                              
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9    
       
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------        
           
   DECLARE @filename10 as varchar(100)                                                          
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_10 VARCHAR(350)                                      
   DECLARE @FILENAME_10 VARCHAR(250)                               
   declare @s10 as varchar(max)                              
                          
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                              
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10    
       
       
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------        
           
   --DECLARE @filename104 as varchar(100)                                                          
   --select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_104 VARCHAR(250)                                      
   --DECLARE @FILENAME_104 VARCHAR(250)                               
   --declare @s104 as varchar(max)                              
                          
   --SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104    
       
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------        
           
   --DECLARE @filename106 as varchar(100)                                                          
 --select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_106 VARCHAR(250)                                      
   --DECLARE @FILENAME_106 VARCHAR(250)                               
   --declare @s106 as varchar(max)                              
                          
   --SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106    
       
       
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------        
           
   DECLARE @filename102 as varchar(100)                                                          
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_102 VARCHAR(350)                                      
   DECLARE @FILENAME_102 VARCHAR(250)                               
   declare @s102 as varchar(max)                              
                          
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                              
                           
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                              
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102    
       
       
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------        
           
   --DECLARE @filename107 as varchar(100)                                                          
   --select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_107 VARCHAR(250)                                      
   --DECLARE @FILENAME_107 VARCHAR(250)                               
   --declare @s107 as varchar(max)                              
                          
   --SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107    
       
      
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------        
           
   --DECLARE @filename108 as varchar(100)                                                          
   --select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_108 VARCHAR(250)                                      
   --DECLARE @FILENAME_108 VARCHAR(250)                               
   --declare @s108 as varchar(max)                              
                          
   --SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108    
       
       
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------        
           
   --DECLARE @filename103 as varchar(100)                                                          
   --select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_103 VARCHAR(250)                                      
   --DECLARE @FILENAME_103 VARCHAR(250)                               
   --declare @s103 as varchar(max)                              
                          
   --SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103    
       
       
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------        
           
   DECLARE @filename11 as varchar(100)                                                          
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_11 VARCHAR(350)                                      
   DECLARE @FILENAME_11 VARCHAR(250)                               
   declare @s11 as varchar(max)                              
                          
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                              
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11  
  
  
   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------        
           
   DECLARE @filename12 as varchar(100)                                                          
   select @filename12='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_12 VARCHAR(350)                                      
   DECLARE @FILENAME_12 VARCHAR(350)                               
   declare @s12 as varchar(max)                              
                          
   SET @FILENAME_12 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_12 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.159'' " QUERYOUT "'                              
   SET @BCPCOMMAND_12 = @BCPCOMMAND_12 + @filename12 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_12  
  
  
   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------        
           
   DECLARE @filename13 as varchar(100)                                                          
   select @filename13='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM13'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_13 VARCHAR(350)                                      
   DECLARE @FILENAME_13 VARCHAR(350)                               
   declare @s13 as varchar(max)                              
                          
   SET @FILENAME_13 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM13'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_13 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.160'' " QUERYOUT "'                              
   SET @BCPCOMMAND_13 = @BCPCOMMAND_13 + @filename13 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_13  
     
     
     
       
         
            
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_02042021
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_02042021]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)  
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo 
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------
 --insert into Tbl_OmnUserinfo  
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]
 
 
 --insert into Tbl_OmnUserinfo  
 --select distinct mnmUser,mnmBroker 
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a 
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI
 
 
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId) 
 select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId 
 from [172.31.15.250].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId
 from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId
 from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'

 ----------------------------------------END---------------------------------------------------------------------------
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250' 
 
 declare @userCount_B2B varchar(10)  
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'  
 
 declare @userCount_GM3 varchar(10)  
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154' 
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR 
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload   
    
   select distinct ClientCode,GroupId,Brokerid,ServerId
   into UserInfoFileDownload
   from Tbl_OmnUserinfo with (nolock) 
    
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND
   
   
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------
   DECLARE @filename2 as varchar(100)                                                  
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                              
   DECLARE @FILENAME_2 VARCHAR(250)                       
   declare @s2 as varchar(max)                      
                  
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                      
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2   
   
   
  
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------
   
   DECLARE @filename3 as varchar(100)                                                  
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                              
   DECLARE @FILENAME_3 VARCHAR(250)                       
   declare @s3 as varchar(max)                      
                  
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                      
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_04082023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_04082023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' 
									      When OmneManagerId='10' then  '10.253.33.163'
									      When OmneManagerId='104' then  '10.253.33.68'
									      When OmneManagerId='106' then  '10.253.33.77'
									      When OmneManagerId='102' then  '10.253.33.66'
									      When OmneManagerId='107' then  '10.253.33.79'
									      When OmneManagerId='108' then  '10.253.33.80'
									      When OmneManagerId='103' then  '10.253.33.67'
									       end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'
 
 declare @userCount_GM10 varchar(10)    
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'
 
 declare @userCount_GPX_104 varchar(10)    
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68' 
 
 declare @userCount_GPX_106 varchar(10)    
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'  
 
 declare @userCount_GPX_102 varchar(10)    
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66' 
 
 declare @userCount_GPX_107 varchar(10)    
 select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'
 
 declare @userCount_GPX_108 varchar(10)    
 select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80' 
 
 declare @userCount_GPX_103 varchar(10)    
 select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
   
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------    
       
   DECLARE @filename10 as varchar(100)                                                      
   select @filename10='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                  
   DECLARE @FILENAME_10 VARCHAR(250)                           
   declare @s10 as varchar(max)                          
                      
   SET @FILENAME_10 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                          
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10
   
   
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------    
       
   DECLARE @filename104 as varchar(100)                                                      
   select @filename104='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                  
   DECLARE @FILENAME_104 VARCHAR(250)                           
   declare @s104 as varchar(max)                          
                      
   SET @FILENAME_104 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                          
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104
   
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------    
       
   DECLARE @filename106 as varchar(100)                                                      
   select @filename106='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                  
   DECLARE @FILENAME_106 VARCHAR(250)                           
   declare @s106 as varchar(max)                          
                      
   SET @FILENAME_106 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                          
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106
   
   
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------    
       
   DECLARE @filename102 as varchar(100)                                                      
   select @filename102='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                  
   DECLARE @FILENAME_102 VARCHAR(250)                           
   declare @s102 as varchar(max)                          
                      
   SET @FILENAME_102 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102
   
   
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------    
       
   DECLARE @filename107 as varchar(100)                                                      
   select @filename107='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_107 VARCHAR(250)                                  
   DECLARE @FILENAME_107 VARCHAR(250)                           
   declare @s107 as varchar(max)                          
                      
   SET @FILENAME_107 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                          
   SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107
   
  
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------    
       
   DECLARE @filename108 as varchar(100)                                                      
   select @filename108='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_108 VARCHAR(250)                                  
   DECLARE @FILENAME_108 VARCHAR(250)                           
   declare @s108 as varchar(max)                          
                      
   SET @FILENAME_108 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                          
   SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108
   
   
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------    
       
   DECLARE @filename103 as varchar(100)                                                      
   select @filename103='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_103 VARCHAR(250)                                  
   DECLARE @FILENAME_103 VARCHAR(250)                           
   declare @s103 as varchar(max)                          
                      
   SET @FILENAME_103 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                          
   SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_04112024
-- --------------------------------------------------
        
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'        
Create Procedure [dbo].[Usp_OmnUserInfoAuto_04112024]        
(        
    @USERNAME VARCHAR(100),                      
    @IPADDR   VARCHAR(100)        
)        
As        
BEGIN         
         
 declare  @StartDate datetime  =getdate()         
        
         
 ----///*****Hist Table ***************///---------------        
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)        
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo       
         
 ----///*****Insert In Main Omnesys Table ***************///---------------        
 truncate table Tbl_OmnUserinfo        
         
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------      
 --insert into Tbl_OmnUserinfo        
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]      
       
       
 --insert into Tbl_OmnUserinfo        
 --select distinct mnmUser,mnmBroker       
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a       
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b      
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI      
       
       
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)      
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '10.253.33.65'    
               when OmneManagerID='2' then  '10.253.33.66'    
               when OmneManagerID='3' then  '10.253.33.67'    
               when OmneManagerID='4' then  '10.253.33.68'    
               when OmneManagerID='6' then  '10.253.33.77'    
               when OmneManagerID='7' then  '10.253.33.79'    
               When OmneManagerId='8' then  '10.253.33.80'    
               When OmneManagerId='9' then  '10.253.33.81'     
               When OmneManagerId='10' then  '10.253.33.163'   
      When OmneManagerId='12' then  '10.253.78.159'    
               --When OmneManagerId='104' then  '10.253.33.68'    
               --When OmneManagerId='106' then  '10.253.33.77'    
               When OmneManagerId='102' then  '10.253.33.66'    
               --When OmneManagerId='107' then  '10.253.33.79'    
               --When OmneManagerId='108' then  '10.253.33.80'    
               When OmneManagerId='11' then  '10.253.33.78'  
      When OmneManagerId='12' then  '10.253.78.159'  
      When OmneManagerId='13' then  '10.253.78.160'     
                end ) as OmneManagerID                 
 from [10.253.33.65].[Uploader-db-amx].dbo.tbl_usermasterinfo where ClientStatus='A'     
     
      
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId       
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'      
 --union all       
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId      
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all      
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId      
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all       
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId        
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId        
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId        
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
      
 ----------------------------------------END---------------------------------------------------------------------------      
        
         
 declare @userCount varchar(10)        
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.65'       
       
 declare @userCount_B2B varchar(10)        
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'        
       
 declare @userCount_GM3 varchar(10)        
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'      
       
 declare @userCount_GM4 varchar(10)        
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'     
     
 declare @userCount_GM6 varchar(10)        
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'     
     
 declare @userCount_GM7 varchar(10)        
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'    
     
 declare @userCount_GM8 varchar(10)        
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'    
     
 declare @userCount_GM9 varchar(10)        
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.81'    
     
 declare @userCount_GM10 varchar(10)        
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'    
     
 --declare @userCount_GPX_104 varchar(10)        
 --select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'     
     
 --declare @userCount_GPX_106 varchar(10)        
 --select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'      
     
 declare @userCount_GPX_102 varchar(10)        
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'     
     
 --declare @userCount_GPX_107 varchar(10)        
 --select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'    
     
 --declare @userCount_GPX_108 varchar(10)        
 --select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'     
     
 --declare @userCount_GPX_103 varchar(10)        
 --select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 declare @userCount_GM11 varchar(10)        
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'      
   
   
 declare @userCount_GM12 varchar(10)        
 select @userCount_GM12 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.159'  
   
 declare @userCount_GM13 varchar(10)        
 select @userCount_GM13 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.160'      
         
 ---------------///**********Log Table **********************/////-------------------------        
  insert into Tbl_UserInfoLogTime         
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR        
           
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR       
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR      
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR      
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR    
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM12',@StartDate,getdate(),@userCount_GM12,'UserInfo_GM12',@USERNAME,@IPADDR    
  
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM13',@StartDate,getdate(),@userCount_GM13,'UserInfo_GM13',@USERNAME,@IPADDR   
         
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------      
        
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys      
        
  --------------------------///////////////END*********************---------------------       
              
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc     
   drop table UserInfoFileDownload         
          
   select distinct ClientCode,GroupId,Brokerid,ServerId      
   into UserInfoFileDownload      
   from Tbl_OmnUserinfo with (nolock)       
          
             
   DECLARE @filename1 as varchar(100)                                                        
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND VARCHAR(250)                                    
   DECLARE @FILENAME VARCHAR(250)                             
   declare @s1 as varchar(max)                            
                        
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.65''" QUERYOUT "'                            
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND      
         
         
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------      
   DECLARE @filename2 as varchar(100)                                                        
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                    
   DECLARE @FILENAME_2 VARCHAR(250)                             
   declare @s2 as varchar(max)                            
                        
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
    
                         
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2         
         
         
        
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------      
         
   DECLARE @filename3 as varchar(100)                                                        
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                    
   DECLARE @FILENAME_3 VARCHAR(250)                             
   declare @s3 as varchar(max)                            
                        
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
   
                         
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3      
         
         
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------        
           
   DECLARE @filename4 as varchar(100)                                                          
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                      
   DECLARE @FILENAME_4 VARCHAR(250)                               
   declare @s4 as varchar(max)                              
                          
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                              
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4        
       
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------        
           
   DECLARE @filename6 as varchar(100)                                                          
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                      
   DECLARE @FILENAME_6 VARCHAR(250)                               
   declare @s6 as varchar(max)                              
                          
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                              
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6     
       
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------        
           
   DECLARE @filename7 as varchar(100)                                                          
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                      
   DECLARE @FILENAME_7 VARCHAR(250)                       
   declare @s7 as varchar(max)                              
                          
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                              
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7     
       
       
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------        
           
   DECLARE @filename8 as varchar(100)                                                          
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                      
   DECLARE @FILENAME_8 VARCHAR(250)                               
   declare @s8 as varchar(max)                              
                          
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                              
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8     
       
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------        
           
   DECLARE @filename9 as varchar(100)                                                          
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                      
   DECLARE @FILENAME_9 VARCHAR(250)                               
   declare @s9 as varchar(max)                              
                          
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.81'' " QUERYOUT "'                              
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9    
       
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------        
           
   DECLARE @filename10 as varchar(100)                                                          
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                      
   DECLARE @FILENAME_10 VARCHAR(250)                               
   declare @s10 as varchar(max)                              
                          
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                              
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10    
       
       
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------        
           
   --DECLARE @filename104 as varchar(100)                                                          
   --select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_104 VARCHAR(250)                                      
   --DECLARE @FILENAME_104 VARCHAR(250)                               
   --declare @s104 as varchar(max)                              
                          
   --SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104    
       
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------        
           
   --DECLARE @filename106 as varchar(100)                                                          
 --select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_106 VARCHAR(250)                                      
   --DECLARE @FILENAME_106 VARCHAR(250)                               
   --declare @s106 as varchar(max)                              
                          
   --SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106    
       
       
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------        
           
   DECLARE @filename102 as varchar(100)                                                          
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                      
   DECLARE @FILENAME_102 VARCHAR(250)                               
   declare @s102 as varchar(max)                              
                          
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                              
                           
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                              
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102    
       
       
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------        
           
   --DECLARE @filename107 as varchar(100)                                                          
   --select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_107 VARCHAR(250)                                      
   --DECLARE @FILENAME_107 VARCHAR(250)                               
   --declare @s107 as varchar(max)                              
                          
   --SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107    
       
      
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------        
           
   --DECLARE @filename108 as varchar(100)                                                          
   --select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_108 VARCHAR(250)                                      
   --DECLARE @FILENAME_108 VARCHAR(250)                               
   --declare @s108 as varchar(max)                              
                          
   --SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108    
       
       
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------        
           
   --DECLARE @filename103 as varchar(100)                                                          
   --select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_103 VARCHAR(250)                                      
   --DECLARE @FILENAME_103 VARCHAR(250)                               
   --declare @s103 as varchar(max)                              
                          
   --SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103    
       
       
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------        
           
   DECLARE @filename11 as varchar(100)                                                          
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                      
   DECLARE @FILENAME_11 VARCHAR(250)                               
   declare @s11 as varchar(max)                              
                          
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                              
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11  
  
  
   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------        
           
   DECLARE @filename12 as varchar(100)                                                          
   select @filename12='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_12 VARCHAR(350)                                      
   DECLARE @FILENAME_12 VARCHAR(350)                               
   declare @s12 as varchar(max)                              
                          
   SET @FILENAME_12 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_12 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.159'' " QUERYOUT "'                              
   SET @BCPCOMMAND_12 = @BCPCOMMAND_12 + @filename12 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_12  
  
  
   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------        
           
   DECLARE @filename13 as varchar(100)                                                          
   select @filename13='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM13'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_13 VARCHAR(350)                                      
   DECLARE @FILENAME_13 VARCHAR(350)                               
   declare @s13 as varchar(max)                              
                          
   SET @FILENAME_13 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM13'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_13 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.160'' " QUERYOUT "'                              
   SET @BCPCOMMAND_13 = @BCPCOMMAND_13 + @filename13 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_13  
     
     
     
       
         
            
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_07012022
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_07012022]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)   
 select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 union all   
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 union all  
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 union all   
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169'  
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
    
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM4,'Omnesys6',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_09062023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_09062023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' 
									      When OmneManagerId='10' then  '10.253.33.163'
									      When OmneManagerId='104' then  '10.253.33.68'
									      When OmneManagerId='106' then  '10.253.33.77'
									      When OmneManagerId='102' then  '10.253.33.66'
									       end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'
 
 declare @userCount_GM10 varchar(10)    
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'
 
 declare @userCount_GPX_104 varchar(10)    
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68' 
 
 declare @userCount_GPX_106 varchar(10)    
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'  
 
 declare @userCount_GPX_102 varchar(10)    
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'    
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
   
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------    
       
   DECLARE @filename10 as varchar(100)                                                      
   select @filename10='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                  
   DECLARE @FILENAME_10 VARCHAR(250)                           
   declare @s10 as varchar(max)                          
                      
   SET @FILENAME_10 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                          
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10
   
   
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------    
       
   DECLARE @filename104 as varchar(100)                                                      
   select @filename104='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                  
   DECLARE @FILENAME_104 VARCHAR(250)                           
   declare @s104 as varchar(max)                          
                      
   SET @FILENAME_104 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                          
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104
   
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------    
       
   DECLARE @filename106 as varchar(100)                                                      
   select @filename106='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                  
   DECLARE @FILENAME_106 VARCHAR(250)                           
   declare @s106 as varchar(max)                          
                      
   SET @FILENAME_106 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                          
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106
   
   
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------    
       
   DECLARE @filename102 as varchar(100)                                                      
   select @filename102='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                  
   DECLARE @FILENAME_102 VARCHAR(250)                           
   declare @s102 as varchar(max)                          
                      
   SET @FILENAME_102 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_10042024
-- --------------------------------------------------
      
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'      
Create Procedure [dbo].[Usp_OmnUserInfoAuto_10042024]      
(      
    @USERNAME VARCHAR(100),                    
    @IPADDR   VARCHAR(100)      
)      
As      
BEGIN       
       
 declare  @StartDate datetime  =getdate()       
      
       
 ----///*****Hist Table ***************///---------------      
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)      
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo     
       
 ----///*****Insert In Main Omnesys Table ***************///---------------      
 truncate table Tbl_OmnUserinfo      
       
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------    
 --insert into Tbl_OmnUserinfo      
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]    
     
     
 --insert into Tbl_OmnUserinfo      
 --select distinct mnmUser,mnmBroker     
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a     
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b    
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI    
     
     
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)    
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '10.253.33.65'  
               when OmneManagerID='2' then  '10.253.33.66'  
               when OmneManagerID='3' then  '10.253.33.67'  
               when OmneManagerID='4' then  '10.253.33.68'  
               when OmneManagerID='6' then  '10.253.33.77'  
               when OmneManagerID='7' then  '10.253.33.79'  
               When OmneManagerId='8' then  '10.253.33.80'  
               When OmneManagerId='9' then  '10.253.33.81'   
               When OmneManagerId='10' then  '10.253.33.163' 
			   When OmneManagerId='12' then  '10.253.78.159'  
               --When OmneManagerId='104' then  '10.253.33.68'  
               --When OmneManagerId='106' then  '10.253.33.77'  
               When OmneManagerId='102' then  '10.253.33.66'  
               --When OmneManagerId='107' then  '10.253.33.79'  
               --When OmneManagerId='108' then  '10.253.33.80'  
               When OmneManagerId='11' then  '10.253.33.78'
			   When OmneManagerId='12' then  '10.253.78.159'  
                end ) as OmneManagerID               
 from [10.253.33.65].[Uploader-db-amx].dbo.tbl_usermasterinfo where ClientStatus='A'   
   
    
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId     
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId    
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all    
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId    
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId      
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId      
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId      
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
    
 ----------------------------------------END---------------------------------------------------------------------------    
      
       
 declare @userCount varchar(10)      
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.65'     
     
 declare @userCount_B2B varchar(10)      
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'      
     
 declare @userCount_GM3 varchar(10)      
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 declare @userCount_GM4 varchar(10)      
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 declare @userCount_GM6 varchar(10)      
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'   
   
 declare @userCount_GM7 varchar(10)      
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 declare @userCount_GM8 varchar(10)      
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'  
   
 declare @userCount_GM9 varchar(10)      
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.81'  
   
 declare @userCount_GM10 varchar(10)      
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'  
   
 --declare @userCount_GPX_104 varchar(10)      
 --select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 --declare @userCount_GPX_106 varchar(10)      
 --select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'    
   
 declare @userCount_GPX_102 varchar(10)      
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'   
   
 --declare @userCount_GPX_107 varchar(10)      
 --select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 --declare @userCount_GPX_108 varchar(10)      
 --select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'   
   
 --declare @userCount_GPX_103 varchar(10)      
 --select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'  
   
 declare @userCount_GM11 varchar(10)      
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'    
 
 
 declare @userCount_GM12 varchar(10)      
 select @userCount_GM12 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.159'   
       
 ---------------///**********Log Table **********************/////-------------------------      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR      
         
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR     
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR    
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR  
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR


  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM12',@StartDate,getdate(),@userCount_GM12,'UserInfo_GM12',@USERNAME,@IPADDR  
       
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------    
      
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys    
      
  --------------------------///////////////END*********************---------------------     
            
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014   
   drop table UserInfoFileDownload       
        
   select distinct ClientCode,GroupId,Brokerid,ServerId    
   into UserInfoFileDownload    
   from Tbl_OmnUserinfo with (nolock)     
        
           
   DECLARE @filename1 as varchar(100)                                                      
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND VARCHAR(250)                                  
   DECLARE @FILENAME VARCHAR(250)                           
   declare @s1 as varchar(max)                          
                      
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.65''" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND    
       
       
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------    
   DECLARE @filename2 as varchar(100)                                                      
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                  
   DECLARE @FILENAME_2 VARCHAR(250)                           
   declare @s2 as varchar(max)                          
                      
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2       
       
       
      
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------    
       
   DECLARE @filename3 as varchar(100)                                                      
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                  
   DECLARE @FILENAME_3 VARCHAR(250)                           
   declare @s3 as varchar(max)                          
                      
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                          
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3    
       
       
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------      
         
   DECLARE @filename4 as varchar(100)                                                        
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                    
   DECLARE @FILENAME_4 VARCHAR(250)                             
   declare @s4 as varchar(max)                            
                        
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4      
     
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------      
         
   DECLARE @filename6 as varchar(100)                                                        
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                    
   DECLARE @FILENAME_6 VARCHAR(250)                             
   declare @s6 as varchar(max)                            
                        
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6   
     
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------      
         
   DECLARE @filename7 as varchar(100)                                                        
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                    
   DECLARE @FILENAME_7 VARCHAR(250)                     
   declare @s7 as varchar(max)                            
                        
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7   
     
     
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------      
         
   DECLARE @filename8 as varchar(100)                                                        
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                    
   DECLARE @FILENAME_8 VARCHAR(250)                             
   declare @s8 as varchar(max)                            
                        
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8   
     
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------      
         
   DECLARE @filename9 as varchar(100)                                                        
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                    
   DECLARE @FILENAME_9 VARCHAR(250)                             
   declare @s9 as varchar(max)                            
                        
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.81'' " QUERYOUT "'                            
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9  
     
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------      
         
   DECLARE @filename10 as varchar(100)                                                        
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                    
   DECLARE @FILENAME_10 VARCHAR(250)                             
   declare @s10 as varchar(max)                            
                        
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                            
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10  
     
     
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------      
         
   --DECLARE @filename104 as varchar(100)                                                        
   --select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_104 VARCHAR(250)                                    
   --DECLARE @FILENAME_104 VARCHAR(250)                             
   --declare @s104 as varchar(max)                            
                        
   --SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104  
     
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------      
         
   --DECLARE @filename106 as varchar(100)                                                        
   --select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_106 VARCHAR(250)                                    
   --DECLARE @FILENAME_106 VARCHAR(250)                             
   --declare @s106 as varchar(max)                            
                        
   --SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106  
     
     
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------      
         
   DECLARE @filename102 as varchar(100)                                                        
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                    
   DECLARE @FILENAME_102 VARCHAR(250)                             
   declare @s102 as varchar(max)                            
                        
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                            
                         
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102  
     
     
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------      
         
   --DECLARE @filename107 as varchar(100)                                                        
   --select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_107 VARCHAR(250)                                    
   --DECLARE @FILENAME_107 VARCHAR(250)                             
   --declare @s107 as varchar(max)                            
                        
   --SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107  
     
    
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------      
         
   --DECLARE @filename108 as varchar(100)                                                        
   --select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_108 VARCHAR(250)                                    
   --DECLARE @FILENAME_108 VARCHAR(250)                             
   --declare @s108 as varchar(max)                            
                        
   --SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108  
     
     
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------      
         
   --DECLARE @filename103 as varchar(100)                                                        
   --select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_103 VARCHAR(250)                                    
   --DECLARE @FILENAME_103 VARCHAR(250)                             
   --declare @s103 as varchar(max)                            
                        
   --SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103  
     
     
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------      
         
   DECLARE @filename11 as varchar(100)                                                        
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                    
   DECLARE @FILENAME_11 VARCHAR(250)                             
   declare @s11 as varchar(max)                            
                        
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                            
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11


   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------      
         
   DECLARE @filename12 as varchar(100)                                                        
   select @filename12='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_12 VARCHAR(250)                                    
   DECLARE @FILENAME_12 VARCHAR(250)                             
   declare @s12 as varchar(max)                            
                        
   SET @FILENAME_12 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_12 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.159'' " QUERYOUT "'                            
   SET @BCPCOMMAND_12 = @BCPCOMMAND_12 + @filename12 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_12
   
   
   
     
       
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_12052022
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_12052022]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)   
 select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 union all   
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 union all  
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 union all   
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'  
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
    
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_13012021
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_13012021]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)  
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo 
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------
 --insert into Tbl_OmnUserinfo  
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]
 
 
 --insert into Tbl_OmnUserinfo  
 --select distinct mnmUser,mnmBroker 
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a 
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI
 
 
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId) 
 select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId 
 from [172.31.15.250].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId
 from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'

 ----------------------------------------END---------------------------------------------------------------------------
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250' 
 
 declare @userCount_B2B varchar(10)  
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'  
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR 
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload   
    
   select distinct ClientCode,GroupId,Brokerid,ServerId
   into UserInfoFileDownload
   from Tbl_OmnUserinfo with (nolock) 
    
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND
   
   
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------
   DECLARE @filename2 as varchar(100)                                                  
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                              
   DECLARE @FILENAME_2 VARCHAR(250)                       
   declare @s2 as varchar(max)                      
                  
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                      
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2   
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_17072021
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_17072021]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)  
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo 
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------
 --insert into Tbl_OmnUserinfo  
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]
 
 
 --insert into Tbl_OmnUserinfo  
 --select distinct mnmUser,mnmBroker 
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a 
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI
 
 
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId) 
 select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId 
 from [172.31.15.250].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId
 from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId
 from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId  
 from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A' 

 ----------------------------------------END---------------------------------------------------------------------------
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250' 
 
 declare @userCount_B2B varchar(10)  
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'  
 
 declare @userCount_GM3 varchar(10)  
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'
 
 declare @userCount_GM4 varchar(10)  
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR 
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload   
    
   select distinct ClientCode,GroupId,Brokerid,ServerId
   into UserInfoFileDownload
   from Tbl_OmnUserinfo with (nolock) 
    
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND
   
   
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------
   DECLARE @filename2 as varchar(100)                                                  
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                              
   DECLARE @FILENAME_2 VARCHAR(250)                       
   declare @s2 as varchar(max)                      
                  
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                      
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2   
   
   
  
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------
   
   DECLARE @filename3 as varchar(100)                                                  
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                              
   DECLARE @FILENAME_3 VARCHAR(250)                       
   declare @s3 as varchar(max)                      
                  
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                      
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3
   
   
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------  
     
   DECLARE @filename4 as varchar(100)                                                    
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                
   DECLARE @FILENAME_4 VARCHAR(250)                         
   declare @s4 as varchar(max)                        
                    
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                        
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4  
   
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_19032024
-- --------------------------------------------------
      
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'      
Create Procedure [dbo].[Usp_OmnUserInfoAuto_19032024]      
(      
    @USERNAME VARCHAR(100),                    
    @IPADDR   VARCHAR(100)      
)      
As      
BEGIN       
       
 declare  @StartDate datetime  =getdate()       
      
       
 ----///*****Hist Table ***************///---------------      
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)      
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo     
       
 ----///*****Insert In Main Omnesys Table ***************///---------------      
 truncate table Tbl_OmnUserinfo      
       
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------    
 --insert into Tbl_OmnUserinfo      
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]    
     
     
 --insert into Tbl_OmnUserinfo      
 --select distinct mnmUser,mnmBroker     
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a     
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b    
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI    
     
     
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)    
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'  
               when OmneManagerID='2' then  '172.31.15.69'  
               when OmneManagerID='3' then  '172.31.15.154'  
               when OmneManagerID='4' then  '172.31.15.253'  
               when OmneManagerID='6' then  '172.31.15.169'  
               when OmneManagerID='7' then  '172.31.15.46'  
               When OmneManagerId='8' then  '172.31.29.198'  
               When OmneManagerId='9' then  '172.31.29.197'   
               When OmneManagerId='10' then  '10.253.33.163'  
               When OmneManagerId='104' then  '10.253.33.68'  
               When OmneManagerId='106' then  '10.253.33.77'  
               When OmneManagerId='102' then  '10.253.33.66'  
               When OmneManagerId='107' then  '10.253.33.79'  
               When OmneManagerId='108' then  '10.253.33.80'  
               When OmneManagerId='11' then  '10.253.33.78'  
                end ) as OmneManagerID               
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A'   
   
    
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId     
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId    
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all    
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId    
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId      
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId      
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId      
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
    
 ----------------------------------------END---------------------------------------------------------------------------    
      
       
 declare @userCount varchar(10)      
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'     
     
 declare @userCount_B2B varchar(10)      
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'      
     
 declare @userCount_GM3 varchar(10)      
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'    
     
 declare @userCount_GM4 varchar(10)      
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253'   
   
 declare @userCount_GM6 varchar(10)      
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169'   
   
 declare @userCount_GM7 varchar(10)      
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'  
   
 declare @userCount_GM8 varchar(10)      
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'  
   
 declare @userCount_GM9 varchar(10)      
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'  
   
 declare @userCount_GM10 varchar(10)      
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'  
   
 declare @userCount_GPX_104 varchar(10)      
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 declare @userCount_GPX_106 varchar(10)      
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'    
   
 declare @userCount_GPX_102 varchar(10)      
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'   
   
 declare @userCount_GPX_107 varchar(10)      
 select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 declare @userCount_GPX_108 varchar(10)      
 select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'   
   
 declare @userCount_GPX_103 varchar(10)      
 select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'  
   
 declare @userCount_GM11 varchar(10)      
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'      
       
 ---------------///**********Log Table **********************/////-------------------------      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR      
         
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR     
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR    
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR  
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR  
       
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------    
      
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys    
      
  --------------------------///////////////END*********************---------------------     
            
    ------------///**********User Info File Download Code **********************/////-------------------------       
   drop table UserInfoFileDownload       
        
   select distinct ClientCode,GroupId,Brokerid,ServerId    
   into UserInfoFileDownload    
   from Tbl_OmnUserinfo with (nolock)     
        
           
   DECLARE @filename1 as varchar(100)                                                      
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND VARCHAR(250)                                  
   DECLARE @FILENAME VARCHAR(250)                           
   declare @s1 as varchar(max)                          
                      
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND    
       
       
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------    
   DECLARE @filename2 as varchar(100)                                                      
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                  
   DECLARE @FILENAME_2 VARCHAR(250)                           
   declare @s2 as varchar(max)                          
                      
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                          
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2       
       
       
      
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------    
       
   DECLARE @filename3 as varchar(100)                                                      
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                  
   DECLARE @FILENAME_3 VARCHAR(250)                           
   declare @s3 as varchar(max)                          
                      
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                          
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3    
       
       
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------      
         
   DECLARE @filename4 as varchar(100)                                                        
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                    
   DECLARE @FILENAME_4 VARCHAR(250)                             
   declare @s4 as varchar(max)                            
                        
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                            
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4      
     
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------      
         
   DECLARE @filename6 as varchar(100)                                                        
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                    
   DECLARE @FILENAME_6 VARCHAR(250)                             
   declare @s6 as varchar(max)                            
                        
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                            
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6   
     
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------      
         
   DECLARE @filename7 as varchar(100)                                                        
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                    
   DECLARE @FILENAME_7 VARCHAR(250)                     
   declare @s7 as varchar(max)                            
                        
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                            
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7   
     
     
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------      
         
   DECLARE @filename8 as varchar(100)                                                        
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                    
   DECLARE @FILENAME_8 VARCHAR(250)                             
   declare @s8 as varchar(max)                            
                        
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                            
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8   
     
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------      
         
   DECLARE @filename9 as varchar(100)                                                        
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                    
   DECLARE @FILENAME_9 VARCHAR(250)                             
   declare @s9 as varchar(max)                            
                        
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                            
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9  
     
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------      
         
   DECLARE @filename10 as varchar(100)                                                        
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                    
   DECLARE @FILENAME_10 VARCHAR(250)                             
   declare @s10 as varchar(max)                            
                        
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                            
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10  
     
     
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------      
         
   DECLARE @filename104 as varchar(100)                                                        
   select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                    
   DECLARE @FILENAME_104 VARCHAR(250)                             
   declare @s104 as varchar(max)                            
                        
   SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104  
     
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------      
         
   DECLARE @filename106 as varchar(100)                                                        
   select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                    
   DECLARE @FILENAME_106 VARCHAR(250)                             
   declare @s106 as varchar(max)                            
                        
   SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106  
     
     
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------      
         
   DECLARE @filename102 as varchar(100)                                                        
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                    
   DECLARE @FILENAME_102 VARCHAR(250)                             
   declare @s102 as varchar(max)                            
                        
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                            
                         
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102  
     
     
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------      
         
   DECLARE @filename107 as varchar(100)                                                        
   select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_107 VARCHAR(250)                                    
   DECLARE @FILENAME_107 VARCHAR(250)                             
   declare @s107 as varchar(max)                            
                        
   SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107  
     
    
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------      
         
   DECLARE @filename108 as varchar(100)                                                        
   select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_108 VARCHAR(250)                                    
   DECLARE @FILENAME_108 VARCHAR(250)                             
   declare @s108 as varchar(max)                            
                        
   SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108  
     
     
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------      
         
   DECLARE @filename103 as varchar(100)                                                        
   select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_103 VARCHAR(250)                                    
   DECLARE @FILENAME_103 VARCHAR(250)                             
   declare @s103 as varchar(max)                            
                        
   SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103  
     
     
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------      
         
   DECLARE @filename11 as varchar(100)                                                        
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                    
   DECLARE @FILENAME_11 VARCHAR(250)                             
   declare @s11 as varchar(max)                            
                        
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                            
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11  
       
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_19052023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_19052023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' 
									      When OmneManagerId='10' then  '10.253.33.163' end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'
 
 declare @userCount_GM10 varchar(10)    
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'    
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
   
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------    
       
   DECLARE @filename10 as varchar(100)                                                      
   select @filename10='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                  
   DECLARE @FILENAME_10 VARCHAR(250)                           
   declare @s10 as varchar(max)                          
                      
   SET @FILENAME_10 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                          
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_21032024
-- --------------------------------------------------
      
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'      
Create Procedure [dbo].[Usp_OmnUserInfoAuto_21032024]      
(      
    @USERNAME VARCHAR(100),                    
    @IPADDR   VARCHAR(100)      
)      
As      
BEGIN       
       
 declare  @StartDate datetime  =getdate()       
      
       
 ----///*****Hist Table ***************///---------------      
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)      
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo     
       
 ----///*****Insert In Main Omnesys Table ***************///---------------      
 truncate table Tbl_OmnUserinfo      
       
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------    
 --insert into Tbl_OmnUserinfo      
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]    
     
     
 --insert into Tbl_OmnUserinfo      
 --select distinct mnmUser,mnmBroker     
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a     
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b    
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI    
     
     
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)    
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'  
               when OmneManagerID='2' then  '172.31.15.69'  
               when OmneManagerID='3' then  '172.31.15.154'  
               when OmneManagerID='4' then  '172.31.15.253'  
               when OmneManagerID='6' then  '172.31.15.169'  
               when OmneManagerID='7' then  '172.31.15.46'  
               When OmneManagerId='8' then  '172.31.29.198'  
               When OmneManagerId='9' then  '172.31.29.197'   
               When OmneManagerId='10' then  '10.253.33.163'  
               When OmneManagerId='104' then  '10.253.33.68'  
               When OmneManagerId='106' then  '10.253.33.77'  
               When OmneManagerId='102' then  '10.253.33.66'  
               When OmneManagerId='107' then  '10.253.33.79'  
               When OmneManagerId='108' then  '10.253.33.80'  
               When OmneManagerId='11' then  '10.253.33.78'  
                end ) as OmneManagerID               
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A'   
   
    
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId     
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId    
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all    
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId    
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId      
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId      
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId      
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
    
 ----------------------------------------END---------------------------------------------------------------------------    
      
       
 declare @userCount varchar(10)      
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'     
     
 declare @userCount_B2B varchar(10)      
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'      
     
 declare @userCount_GM3 varchar(10)      
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'    
     
 declare @userCount_GM4 varchar(10)      
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253'   
   
 declare @userCount_GM6 varchar(10)      
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169'   
   
 declare @userCount_GM7 varchar(10)      
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'  
   
 declare @userCount_GM8 varchar(10)      
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'  
   
 declare @userCount_GM9 varchar(10)      
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'  
   
 declare @userCount_GM10 varchar(10)      
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'  
   
 declare @userCount_GPX_104 varchar(10)      
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 declare @userCount_GPX_106 varchar(10)      
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'    
   
 declare @userCount_GPX_102 varchar(10)      
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'   
   
 declare @userCount_GPX_107 varchar(10)      
 select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 declare @userCount_GPX_108 varchar(10)      
 select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'   
   
 declare @userCount_GPX_103 varchar(10)      
 select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'  
   
 declare @userCount_GM11 varchar(10)      
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'      
       
 ---------------///**********Log Table **********************/////-------------------------      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR      
         
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR     
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR    
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR  
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR  
       
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------    
      
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys    
      
  --------------------------///////////////END*********************---------------------     
            
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014   
   drop table UserInfoFileDownload       
        
   select distinct ClientCode,GroupId,Brokerid,ServerId    
   into UserInfoFileDownload    
   from Tbl_OmnUserinfo with (nolock)     
        
           
   DECLARE @filename1 as varchar(100)                                                      
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND VARCHAR(250)                                  
   DECLARE @FILENAME VARCHAR(250)                           
   declare @s1 as varchar(max)                          
                      
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND    
       
       
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------    
   DECLARE @filename2 as varchar(100)                                                      
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                  
   DECLARE @FILENAME_2 VARCHAR(250)                           
   declare @s2 as varchar(max)                          
                      
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                          
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2       
       
       
      
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------    
       
   DECLARE @filename3 as varchar(100)                                                      
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                  
   DECLARE @FILENAME_3 VARCHAR(250)                           
   declare @s3 as varchar(max)                          
                      
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                          
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3    
       
       
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------      
         
   DECLARE @filename4 as varchar(100)                                                        
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                    
   DECLARE @FILENAME_4 VARCHAR(250)                             
   declare @s4 as varchar(max)                            
                        
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                            
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4      
     
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------      
         
   DECLARE @filename6 as varchar(100)                                                        
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                    
   DECLARE @FILENAME_6 VARCHAR(250)                             
   declare @s6 as varchar(max)                            
                        
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                            
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6   
     
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------      
         
   DECLARE @filename7 as varchar(100)                                                        
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                    
   DECLARE @FILENAME_7 VARCHAR(250)                     
   declare @s7 as varchar(max)                            
                        
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                            
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7   
     
     
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------      
         
   DECLARE @filename8 as varchar(100)                                                        
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                    
   DECLARE @FILENAME_8 VARCHAR(250)                             
   declare @s8 as varchar(max)                            
                        
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                            
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8   
     
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------      
         
   DECLARE @filename9 as varchar(100)                                                        
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                    
   DECLARE @FILENAME_9 VARCHAR(250)                             
   declare @s9 as varchar(max)                            
                        
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                            
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9  
     
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------      
         
   DECLARE @filename10 as varchar(100)                                                        
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                    
   DECLARE @FILENAME_10 VARCHAR(250)                             
   declare @s10 as varchar(max)                            
                        
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                            
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10  
     
     
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------      
         
   DECLARE @filename104 as varchar(100)                                                        
   select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                    
   DECLARE @FILENAME_104 VARCHAR(250)                             
   declare @s104 as varchar(max)                            
                        
   SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104  
     
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------      
         
   DECLARE @filename106 as varchar(100)                                                        
   select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                    
   DECLARE @FILENAME_106 VARCHAR(250)                             
   declare @s106 as varchar(max)                            
                        
   SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106  
     
     
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------      
         
   DECLARE @filename102 as varchar(100)                                                        
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                    
   DECLARE @FILENAME_102 VARCHAR(250)                             
   declare @s102 as varchar(max)                            
                        
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                            
                         
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102  
     
     
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------      
         
   DECLARE @filename107 as varchar(100)                                                        
   select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_107 VARCHAR(250)                                    
   DECLARE @FILENAME_107 VARCHAR(250)                             
   declare @s107 as varchar(max)                            
                        
   SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107  
     
    
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------      
         
   DECLARE @filename108 as varchar(100)                                                        
   select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_108 VARCHAR(250)                                    
   DECLARE @FILENAME_108 VARCHAR(250)                             
   declare @s108 as varchar(max)                            
                        
   SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108  
     
     
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------      
         
   DECLARE @filename103 as varchar(100)                                                        
   select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_103 VARCHAR(250)                                    
   DECLARE @FILENAME_103 VARCHAR(250)                             
   declare @s103 as varchar(max)                            
                        
   SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103  
     
     
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------      
         
   DECLARE @filename11 as varchar(100)                                                        
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                    
   DECLARE @FILENAME_11 VARCHAR(250)                             
   declare @s11 as varchar(max)                            
                        
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                            
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11  
       
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_22July2020
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_22July2020]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist   
 select ClientCode,GroupId,GETDATE() from Tbl_OmnUserinfo  
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
 insert into Tbl_OmnUserinfo  
 select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo  
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload    
   select * into UserInfoFileDownload from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_23062023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_23062023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' 
									      When OmneManagerId='10' then  '10.253.33.163'
									      When OmneManagerId='104' then  '10.253.33.68'
									      When OmneManagerId='106' then  '10.253.33.77'
									      When OmneManagerId='102' then  '10.253.33.66'
									      When OmneManagerId='107' then  '10.253.33.79'
									      When OmneManagerId='108' then  '10.253.33.80'
									       end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'
 
 declare @userCount_GM10 varchar(10)    
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'
 
 declare @userCount_GPX_104 varchar(10)    
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68' 
 
 declare @userCount_GPX_106 varchar(10)    
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'  
 
 declare @userCount_GPX_102 varchar(10)    
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66' 
 
 declare @userCount_GPX_107 varchar(10)    
 select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'
 
 declare @userCount_GPX_108 varchar(10)    
 select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'    
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
   
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------    
       
   DECLARE @filename10 as varchar(100)                                                      
   select @filename10='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                  
   DECLARE @FILENAME_10 VARCHAR(250)                           
   declare @s10 as varchar(max)                          
                      
   SET @FILENAME_10 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                          
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10
   
   
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------    
       
   DECLARE @filename104 as varchar(100)                                                      
   select @filename104='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                  
   DECLARE @FILENAME_104 VARCHAR(250)                           
   declare @s104 as varchar(max)                          
                      
   SET @FILENAME_104 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                          
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104
   
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------    
       
   DECLARE @filename106 as varchar(100)                                                      
   select @filename106='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                  
   DECLARE @FILENAME_106 VARCHAR(250)                           
   declare @s106 as varchar(max)                          
                      
   SET @FILENAME_106 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                          
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106
   
   
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------    
       
   DECLARE @filename102 as varchar(100)                                                      
   select @filename102='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                  
   DECLARE @FILENAME_102 VARCHAR(250)                           
   declare @s102 as varchar(max)                          
                      
   SET @FILENAME_102 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102
   
   
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------    
       
   DECLARE @filename107 as varchar(100)                                                      
   select @filename107='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_107 VARCHAR(250)                                  
   DECLARE @FILENAME_107 VARCHAR(250)                           
   declare @s107 as varchar(max)                          
                      
   SET @FILENAME_107 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                          
   SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107
   
  
  ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------    
       
   DECLARE @filename108 as varchar(100)                                                      
   select @filename108='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_108 VARCHAR(250)                                  
   DECLARE @FILENAME_108 VARCHAR(250)                           
   declare @s108 as varchar(max)                          
                      
   SET @FILENAME_108 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                          
   SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_25102022
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_25102022]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46' end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'  
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
    
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_26042024
-- --------------------------------------------------
      
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'      
Create Procedure [dbo].[Usp_OmnUserInfoAuto_26042024]      
(      
    @USERNAME VARCHAR(100),                    
    @IPADDR   VARCHAR(100)      
)      
As      
BEGIN       
       
 declare  @StartDate datetime  =getdate()       
      
       
 ----///*****Hist Table ***************///---------------      
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)      
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo     
       
 ----///*****Insert In Main Omnesys Table ***************///---------------      
 truncate table Tbl_OmnUserinfo      
       
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------    
 --insert into Tbl_OmnUserinfo      
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]    
     
     
 --insert into Tbl_OmnUserinfo      
 --select distinct mnmUser,mnmBroker     
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a     
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b    
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI    
     
     
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)    
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '10.253.33.65'  
               when OmneManagerID='2' then  '10.253.33.66'  
               when OmneManagerID='3' then  '10.253.33.67'  
               when OmneManagerID='4' then  '10.253.33.68'  
               when OmneManagerID='6' then  '10.253.33.77'  
               when OmneManagerID='7' then  '10.253.33.79'  
               When OmneManagerId='8' then  '10.253.33.80'  
               When OmneManagerId='9' then  '10.253.33.81'   
               When OmneManagerId='10' then  '10.253.33.163' 
			   When OmneManagerId='12' then  '10.253.78.159'  
               --When OmneManagerId='104' then  '10.253.33.68'  
               --When OmneManagerId='106' then  '10.253.33.77'  
               When OmneManagerId='102' then  '10.253.33.66'  
               --When OmneManagerId='107' then  '10.253.33.79'  
               --When OmneManagerId='108' then  '10.253.33.80'  
               When OmneManagerId='11' then  '10.253.33.78'
			   When OmneManagerId='12' then  '10.253.78.159'  
                end ) as OmneManagerID               
 from [10.253.33.65].[Uploader-db-amx].dbo.tbl_usermasterinfo where ClientStatus='A'   
   
    
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId     
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId    
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all    
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId    
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId      
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId      
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId      
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
    
 ----------------------------------------END---------------------------------------------------------------------------    
      
       
 declare @userCount varchar(10)      
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.65'     
     
 declare @userCount_B2B varchar(10)      
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'      
     
 declare @userCount_GM3 varchar(10)      
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 declare @userCount_GM4 varchar(10)      
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 declare @userCount_GM6 varchar(10)      
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'   
   
 declare @userCount_GM7 varchar(10)      
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 declare @userCount_GM8 varchar(10)      
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'  
   
 declare @userCount_GM9 varchar(10)      
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.81'  
   
 declare @userCount_GM10 varchar(10)      
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'  
   
 --declare @userCount_GPX_104 varchar(10)      
 --select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 --declare @userCount_GPX_106 varchar(10)      
 --select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'    
   
 declare @userCount_GPX_102 varchar(10)      
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'   
   
 --declare @userCount_GPX_107 varchar(10)      
 --select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 --declare @userCount_GPX_108 varchar(10)      
 --select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'   
   
 --declare @userCount_GPX_103 varchar(10)      
 --select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'  
   
 declare @userCount_GM11 varchar(10)      
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'    
 
 
 declare @userCount_GM12 varchar(10)      
 select @userCount_GM12 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.159'   
       
 ---------------///**********Log Table **********************/////-------------------------      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR      
         
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR     
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR    
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR  
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR


  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM12',@StartDate,getdate(),@userCount_GM12,'UserInfo_GM12',@USERNAME,@IPADDR  
       
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------    
      
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys    
      
  --------------------------///////////////END*********************---------------------     
            
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014   
   drop table UserInfoFileDownload       
        
   select distinct ClientCode,GroupId,Brokerid,ServerId    
   into UserInfoFileDownload    
   from Tbl_OmnUserinfo with (nolock)     
        
           
   DECLARE @filename1 as varchar(100)                                                      
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND VARCHAR(250)                                  
   DECLARE @FILENAME VARCHAR(250)                           
   declare @s1 as varchar(max)                          
                      
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.65''" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND    
       
       
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------    
   DECLARE @filename2 as varchar(100)                                                      
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                  
   DECLARE @FILENAME_2 VARCHAR(250)                           
   declare @s2 as varchar(max)                          
                      
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2       
       
       
      
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------    
       
   DECLARE @filename3 as varchar(100)                                                      
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                  
   DECLARE @FILENAME_3 VARCHAR(250)                           
   declare @s3 as varchar(max)                          
                      
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                          
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3    
       
       
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------      
         
   DECLARE @filename4 as varchar(100)                                                        
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                    
   DECLARE @FILENAME_4 VARCHAR(250)                             
   declare @s4 as varchar(max)                            
                        
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4      
     
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------      
         
   DECLARE @filename6 as varchar(100)                                                        
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                    
   DECLARE @FILENAME_6 VARCHAR(250)                             
   declare @s6 as varchar(max)                            
                        
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6   
     
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------      
         
   DECLARE @filename7 as varchar(100)                                                        
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                    
   DECLARE @FILENAME_7 VARCHAR(250)                     
   declare @s7 as varchar(max)                            
                        
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7   
     
     
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------      
         
   DECLARE @filename8 as varchar(100)                                                        
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                    
   DECLARE @FILENAME_8 VARCHAR(250)                             
   declare @s8 as varchar(max)                            
                        
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8   
     
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------      
         
   DECLARE @filename9 as varchar(100)                                                        
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                    
   DECLARE @FILENAME_9 VARCHAR(250)                             
   declare @s9 as varchar(max)                            
                        
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.81'' " QUERYOUT "'                            
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9  
     
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------      
         
   DECLARE @filename10 as varchar(100)                                                        
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                    
   DECLARE @FILENAME_10 VARCHAR(250)                             
   declare @s10 as varchar(max)                            
                        
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                            
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10  
     
     
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------      
         
   --DECLARE @filename104 as varchar(100)                                                        
   --select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_104 VARCHAR(250)                                    
   --DECLARE @FILENAME_104 VARCHAR(250)                             
   --declare @s104 as varchar(max)                            
                        
   --SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104  
     
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------      
         
   --DECLARE @filename106 as varchar(100)                                                        
   --select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_106 VARCHAR(250)                                    
   --DECLARE @FILENAME_106 VARCHAR(250)                             
   --declare @s106 as varchar(max)                            
                        
   --SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106  
     
     
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------      
         
   DECLARE @filename102 as varchar(100)                                                        
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                    
   DECLARE @FILENAME_102 VARCHAR(250)                             
   declare @s102 as varchar(max)                            
                        
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                            
                         
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102  
     
     
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------      
         
   --DECLARE @filename107 as varchar(100)                                                        
   --select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_107 VARCHAR(250)                                    
   --DECLARE @FILENAME_107 VARCHAR(250)                             
   --declare @s107 as varchar(max)                            
                        
   --SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107  
     
    
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------      
         
   --DECLARE @filename108 as varchar(100)                                                        
   --select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_108 VARCHAR(250)                                    
   --DECLARE @FILENAME_108 VARCHAR(250)                             
   --declare @s108 as varchar(max)                            
                        
   --SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108  
     
     
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------      
         
   --DECLARE @filename103 as varchar(100)                                                        
   --select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_103 VARCHAR(250)                                    
   --DECLARE @FILENAME_103 VARCHAR(250)                             
   --declare @s103 as varchar(max)                            
                        
   --SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103  
     
     
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------      
         
   DECLARE @filename11 as varchar(100)                                                        
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                    
   DECLARE @FILENAME_11 VARCHAR(250)                             
   declare @s11 as varchar(max)                            
                        
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                            
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11


   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------      
         
   DECLARE @filename12 as varchar(100)                                                        
   select @filename12='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_12 VARCHAR(250)                                    
   DECLARE @FILENAME_12 VARCHAR(250)                             
   declare @s12 as varchar(max)                            
                        
   SET @FILENAME_12 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_12 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.159'' " QUERYOUT "'                            
   SET @BCPCOMMAND_12 = @BCPCOMMAND_12 + @filename12 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_12
   
   
   
     
       
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_26052023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_26052023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' 
									      When OmneManagerId='10' then  '10.253.33.163'
									      When OmneManagerId='104' then  '10.253.33.68'
									      When OmneManagerId='106' then  '10.253.33.77'
									       end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'
 
 declare @userCount_GM10 varchar(10)    
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'
 
 declare @userCount_GPX_104 varchar(10)    
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68' 
 
 declare @userCount_GPX_106 varchar(10)    
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'    
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
   
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------    
       
   DECLARE @filename10 as varchar(100)                                                      
   select @filename10='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                  
   DECLARE @FILENAME_10 VARCHAR(250)                           
   declare @s10 as varchar(max)                          
                      
   SET @FILENAME_10 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                          
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10
   
   
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------    
       
   DECLARE @filename104 as varchar(100)                                                      
   select @filename104='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                  
   DECLARE @FILENAME_104 VARCHAR(250)                           
   declare @s104 as varchar(max)                          
                      
   SET @FILENAME_104 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                          
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104
   
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------    
       
   DECLARE @filename106 as varchar(100)                                                      
   select @filename106='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                  
   DECLARE @FILENAME_106 VARCHAR(250)                           
   declare @s106 as varchar(max)                          
                      
   SET @FILENAME_106 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                          
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_27112021
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_27112021]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)  
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo 
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------
 --insert into Tbl_OmnUserinfo  
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]
 
 
 --insert into Tbl_OmnUserinfo  
 --select distinct mnmUser,mnmBroker 
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a 
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI
 
 
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId) 
 select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId 
 from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId
 from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId
 from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 union all 
 select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId  
 from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A' 

 ----------------------------------------END---------------------------------------------------------------------------
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250' 
 
 declare @userCount_B2B varchar(10)  
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'  
 
 declare @userCount_GM3 varchar(10)  
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'
 
 declare @userCount_GM4 varchar(10)  
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR 
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime 
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload   
    
   select distinct ClientCode,GroupId,Brokerid,ServerId
   into UserInfoFileDownload
   from Tbl_OmnUserinfo with (nolock) 
    
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND
   
   
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------
   DECLARE @filename2 as varchar(100)                                                  
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                              
   DECLARE @FILENAME_2 VARCHAR(250)                       
   declare @s2 as varchar(max)                      
                  
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                      
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2   
   
   
  
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------
   
   DECLARE @filename3 as varchar(100)                                                  
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                              
   DECLARE @FILENAME_3 VARCHAR(250)                       
   declare @s3 as varchar(max)                      
                  
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                      
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3
   
   
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------  
     
   DECLARE @filename4 as varchar(100)                                                    
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                
   DECLARE @FILENAME_4 VARCHAR(250)                         
   declare @s4 as varchar(max)                        
                    
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                        
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4  
   
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_28042023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_28042023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'  
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uinhouse -Pinh6014'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_28072023
-- --------------------------------------------------
    
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'    
Create Procedure [dbo].[Usp_OmnUserInfoAuto_28072023]    
(    
    @USERNAME VARCHAR(100),                  
    @IPADDR   VARCHAR(100)    
)    
As    
BEGIN     
     
 declare  @StartDate datetime  =getdate()     
    
     
 ----///*****Hist Table ***************///---------------    
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)    
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo   
     
 ----///*****Insert In Main Omnesys Table ***************///---------------    
 truncate table Tbl_OmnUserinfo    
     
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------  
 --insert into Tbl_OmnUserinfo    
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  
   
   
 --insert into Tbl_OmnUserinfo    
 --select distinct mnmUser,mnmBroker   
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a   
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b  
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
   
   
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)  
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '172.31.15.250'
									      when OmneManagerID='2' then  '172.31.15.69'
									      when OmneManagerID='3' then  '172.31.15.154'
									      when OmneManagerID='4' then  '172.31.15.253'
									      when OmneManagerID='6' then  '172.31.15.169'
									      when OmneManagerID='7' then  '172.31.15.46'
									      When OmneManagerId='8' then  '172.31.29.198'
									      When OmneManagerId='9' then  '172.31.29.197' 
									      When OmneManagerId='10' then  '10.253.33.163'
									      When OmneManagerId='104' then  '10.253.33.68'
									      When OmneManagerId='106' then  '10.253.33.77'
									      When OmneManagerId='102' then  '10.253.33.66'
									      When OmneManagerId='107' then  '10.253.33.79'
									      When OmneManagerId='108' then  '10.253.33.80'
									      When OmneManagerId='103' then  '10.253.33.67'
									       end ) as OmneManagerID								     
 from [172.31.15.250].[Uploader-db].dbo.tbl_usermasterinfo where ClientStatus='A' 
 
  
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId   
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId  
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all  
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId  
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId    
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId    
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'
 --union all 
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId    
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
  
 ----------------------------------------END---------------------------------------------------------------------------  
    
     
 declare @userCount varchar(10)    
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.250'   
   
 declare @userCount_B2B varchar(10)    
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.69'    
   
 declare @userCount_GM3 varchar(10)    
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.154'  
   
 declare @userCount_GM4 varchar(10)    
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.253' 
 
 declare @userCount_GM6 varchar(10)    
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.169' 
 
 declare @userCount_GM7 varchar(10)    
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.15.46'
 
 declare @userCount_GM8 varchar(10)    
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.198'
 
 declare @userCount_GM9 varchar(10)    
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='172.31.29.197'
 
 declare @userCount_GM10 varchar(10)    
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'
 
 declare @userCount_GPX_104 varchar(10)    
 select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68' 
 
 declare @userCount_GPX_106 varchar(10)    
 select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'  
 
 declare @userCount_GPX_102 varchar(10)    
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66' 
 
 declare @userCount_GPX_107 varchar(10)    
 select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'
 
 declare @userCount_GPX_108 varchar(10)    
 select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80' 
 
 declare @userCount_GPX_103 varchar(10)    
 select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 ---------------///**********Log Table **********************/////-------------------------    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR    
       
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR   
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR  
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR
    
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR
  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR
     
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------  
    
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys  
    
  --------------------------///////////////END*********************---------------------   
          
    ------------///**********User Info File Download Code **********************/////-------------------------     
   drop table UserInfoFileDownload     
      
   select distinct ClientCode,GroupId,Brokerid,ServerId  
   into UserInfoFileDownload  
   from Tbl_OmnUserinfo with (nolock)   
      
         
   DECLARE @filename1 as varchar(100)                                                    
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND VARCHAR(250)                                
   DECLARE @FILENAME VARCHAR(250)                         
   declare @s1 as varchar(max)                        
                    
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.250''" QUERYOUT "'                        
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
     
     
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------  
   DECLARE @filename2 as varchar(100)                                                    
   select @filename2='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                
   DECLARE @FILENAME_2 VARCHAR(250)                         
   declare @s2 as varchar(max)                        
                    
   SET @FILENAME_2 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.69'' " QUERYOUT "'                        
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2     
     
     
    
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------  
     
   DECLARE @filename3 as varchar(100)                                                    
   select @filename3='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                         
                           
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                
   DECLARE @FILENAME_3 VARCHAR(250)                         
   declare @s3 as varchar(max)                        
                    
   SET @FILENAME_3 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
                     
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.154'' " QUERYOUT "'                        
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                              
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3  
     
     
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------    
       
   DECLARE @filename4 as varchar(100)                                                      
   select @filename4='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                  
   DECLARE @FILENAME_4 VARCHAR(250)                           
   declare @s4 as varchar(max)                          
                      
   SET @FILENAME_4 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.253'' " QUERYOUT "'                          
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4    
   
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------    
       
   DECLARE @filename6 as varchar(100)                                                      
   select @filename6='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                  
   DECLARE @FILENAME_6 VARCHAR(250)                           
   declare @s6 as varchar(max)                          
                      
   SET @FILENAME_6 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.169'' " QUERYOUT "'                          
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6 
   
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------    
       
   DECLARE @filename7 as varchar(100)                                                      
   select @filename7='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                  
   DECLARE @FILENAME_7 VARCHAR(250)                           
   declare @s7 as varchar(max)                          
                      
   SET @FILENAME_7 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.15.46'' " QUERYOUT "'                          
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7 
   
   
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------    
       
   DECLARE @filename8 as varchar(100)                                                      
   select @filename8='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                  
   DECLARE @FILENAME_8 VARCHAR(250)                           
   declare @s8 as varchar(max)                          
                      
   SET @FILENAME_8 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.198'' " QUERYOUT "'                          
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8 
   
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------    
       
   DECLARE @filename9 as varchar(100)                                                      
   select @filename9='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                  
   DECLARE @FILENAME_9 VARCHAR(250)                           
   declare @s9 as varchar(max)                          
                      
   SET @FILENAME_9 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''172.31.29.197'' " QUERYOUT "'                          
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9
   
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------    
       
   DECLARE @filename10 as varchar(100)                                                      
   select @filename10='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                  
   DECLARE @FILENAME_10 VARCHAR(250)                           
   declare @s10 as varchar(max)                          
                      
   SET @FILENAME_10 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                          
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10
   
   
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------    
       
   DECLARE @filename104 as varchar(100)                                                      
   select @filename104='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_104 VARCHAR(250)                                  
   DECLARE @FILENAME_104 VARCHAR(250)                           
   declare @s104 as varchar(max)                          
                      
   SET @FILENAME_104 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                          
   SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104
   
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------    
       
   DECLARE @filename106 as varchar(100)                                                      
   select @filename106='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_106 VARCHAR(250)                                  
   DECLARE @FILENAME_106 VARCHAR(250)                           
   declare @s106 as varchar(max)                          
                      
   SET @FILENAME_106 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                          
   SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106
   
   
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------    
       
   DECLARE @filename102 as varchar(100)                                                      
   select @filename102='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                  
   DECLARE @FILENAME_102 VARCHAR(250)                           
   declare @s102 as varchar(max)                          
                      
   SET @FILENAME_102 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102
   
   
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------    
       
   DECLARE @filename107 as varchar(100)                                                      
   select @filename107='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_107 VARCHAR(250)                                  
   DECLARE @FILENAME_107 VARCHAR(250)                           
   declare @s107 as varchar(max)                          
                      
   SET @FILENAME_107 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                          
   SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107
   
  
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------    
       
   DECLARE @filename108 as varchar(100)                                                      
   select @filename108='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_108 VARCHAR(250)                                  
   DECLARE @FILENAME_108 VARCHAR(250)                           
   declare @s108 as varchar(max)                          
                      
   SET @FILENAME_108 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                          
   SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108
   
   
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------    
       
   DECLARE @filename103 as varchar(100)                                                      
   select @filename103='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_103 VARCHAR(250)                                  
   DECLARE @FILENAME_103 VARCHAR(250)                           
   declare @s103 as varchar(max)                          
                      
   SET @FILENAME_103 = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                          
   SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -Smis -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103
     
        
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_29102020
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_29102020]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist   
 select ClientCode,GroupId,GETDATE() from Tbl_OmnUserinfo  
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------
 --insert into Tbl_OmnUserinfo  
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]
 
 
 --insert into Tbl_OmnUserinfo  
 --select distinct mnmUser,mnmBroker 
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a 
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI
 
 
 insert into Tbl_OmnUserinfo  
 select distinct AccountId , BranchId 
 from [172.31.15.250].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'

 ----------------------------------------END---------------------------------------------------------------------------
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo  
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload   
    
   select distinct AccountId,BranchId
   into UserInfoFileDownload
   from [172.31.15.250].[uploader-db].dbo.investorclient a  with (nolock)  where ClientStatus='A'  
    
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_30042024
-- --------------------------------------------------
      
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'      
Create Procedure [dbo].[Usp_OmnUserInfoAuto_30042024]      
(      
    @USERNAME VARCHAR(100),                    
    @IPADDR   VARCHAR(100)      
)      
As      
BEGIN       
       
 declare  @StartDate datetime  =getdate()       
      
       
 ----///*****Hist Table ***************///---------------      
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)      
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo     
       
 ----///*****Insert In Main Omnesys Table ***************///---------------      
 truncate table Tbl_OmnUserinfo      
       
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------    
 --insert into Tbl_OmnUserinfo      
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]    
     
     
 --insert into Tbl_OmnUserinfo      
 --select distinct mnmUser,mnmBroker     
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a     
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b    
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI    
     
     
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)    
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '10.253.33.65'  
               when OmneManagerID='2' then  '10.253.33.66'  
               when OmneManagerID='3' then  '10.253.33.67'  
               when OmneManagerID='4' then  '10.253.33.68'  
               when OmneManagerID='6' then  '10.253.33.77'  
               when OmneManagerID='7' then  '10.253.33.79'  
               When OmneManagerId='8' then  '10.253.33.80'  
               When OmneManagerId='9' then  '10.253.33.81'   
               When OmneManagerId='10' then  '10.253.33.163' 
			   When OmneManagerId='12' then  '10.253.78.159'  
               --When OmneManagerId='104' then  '10.253.33.68'  
               --When OmneManagerId='106' then  '10.253.33.77'  
               When OmneManagerId='102' then  '10.253.33.66'  
               --When OmneManagerId='107' then  '10.253.33.79'  
               --When OmneManagerId='108' then  '10.253.33.80'  
               When OmneManagerId='11' then  '10.253.33.78'
			   When OmneManagerId='12' then  '10.253.78.159'  
                end ) as OmneManagerID               
 from [10.253.33.65].[Uploader-db-amx].dbo.tbl_usermasterinfo where ClientStatus='A'   
   
    
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId     
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId    
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all    
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId    
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId      
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId      
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'  
 --union all   
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId      
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
    
 ----------------------------------------END---------------------------------------------------------------------------    
      
       
 declare @userCount varchar(10)      
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.65'     
     
 declare @userCount_B2B varchar(10)      
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'      
     
 declare @userCount_GM3 varchar(10)      
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 declare @userCount_GM4 varchar(10)      
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 declare @userCount_GM6 varchar(10)      
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'   
   
 declare @userCount_GM7 varchar(10)      
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 declare @userCount_GM8 varchar(10)      
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'  
   
 declare @userCount_GM9 varchar(10)      
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.81'  
   
 declare @userCount_GM10 varchar(10)      
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'  
   
 --declare @userCount_GPX_104 varchar(10)      
 --select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'   
   
 --declare @userCount_GPX_106 varchar(10)      
 --select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'    
   
 declare @userCount_GPX_102 varchar(10)      
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'   
   
 --declare @userCount_GPX_107 varchar(10)      
 --select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'  
   
 --declare @userCount_GPX_108 varchar(10)      
 --select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'   
   
 --declare @userCount_GPX_103 varchar(10)      
 --select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'  
   
 declare @userCount_GM11 varchar(10)      
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'    
 
 
 declare @userCount_GM12 varchar(10)      
 select @userCount_GM12 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.159'   
       
 ---------------///**********Log Table **********************/////-------------------------      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR      
         
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR     
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR    
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR  
      
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR  
    
  --insert into Tbl_UserInfoLogTime     
  --select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR  
    
  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR


  insert into Tbl_UserInfoLogTime     
  select 'UserInfo_GM12',@StartDate,getdate(),@userCount_GM12,'UserInfo_GM12',@USERNAME,@IPADDR  
       
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------    
      
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys    
      
  --------------------------///////////////END*********************---------------------     
            
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014   
   drop table UserInfoFileDownload       
        
   select distinct ClientCode,GroupId,Brokerid,ServerId    
   into UserInfoFileDownload    
   from Tbl_OmnUserinfo with (nolock)     
        
           
   DECLARE @filename1 as varchar(100)                                                      
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND VARCHAR(250)                                  
   DECLARE @FILENAME VARCHAR(250)                           
   declare @s1 as varchar(max)                          
                      
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.65''" QUERYOUT "'                          
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND    
       
       
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------    
   DECLARE @filename2 as varchar(100)                                                      
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                  
   DECLARE @FILENAME_2 VARCHAR(250)                           
   declare @s2 as varchar(max)                          
                      
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                          
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2       
       
       
      
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------    
       
   DECLARE @filename3 as varchar(100)                                                      
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                           
                             
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                  
   DECLARE @FILENAME_3 VARCHAR(250)                           
   declare @s3 as varchar(max)                          
                      
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                         
                       
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                          
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3    
       
       
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------      
         
   DECLARE @filename4 as varchar(100)                                                        
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                    
   DECLARE @FILENAME_4 VARCHAR(250)                             
   declare @s4 as varchar(max)                            
                        
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4      
     
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------      
         
   DECLARE @filename6 as varchar(100)                                                        
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                    
   DECLARE @FILENAME_6 VARCHAR(250)                             
   declare @s6 as varchar(max)                            
                        
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6   
     
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------      
         
   DECLARE @filename7 as varchar(100)                                                        
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                    
   DECLARE @FILENAME_7 VARCHAR(250)                     
   declare @s7 as varchar(max)                            
                        
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7   
     
     
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------      
         
   DECLARE @filename8 as varchar(100)                                                        
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                    
   DECLARE @FILENAME_8 VARCHAR(250)                             
   declare @s8 as varchar(max)                            
                        
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8   
     
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------      
         
   DECLARE @filename9 as varchar(100)                                                        
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                    
   DECLARE @FILENAME_9 VARCHAR(250)                             
   declare @s9 as varchar(max)                            
                        
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.81'' " QUERYOUT "'                            
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9  
     
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------      
         
   DECLARE @filename10 as varchar(100)                                                        
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                    
   DECLARE @FILENAME_10 VARCHAR(250)                             
   declare @s10 as varchar(max)                            
                        
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                            
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10  
     
     
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------      
         
   --DECLARE @filename104 as varchar(100)                                                        
   --select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_104 VARCHAR(250)                                    
   --DECLARE @FILENAME_104 VARCHAR(250)                             
   --declare @s104 as varchar(max)                            
                        
   --SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104  
     
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------      
         
   --DECLARE @filename106 as varchar(100)                                                        
   --select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_106 VARCHAR(250)                                    
   --DECLARE @FILENAME_106 VARCHAR(250)                             
   --declare @s106 as varchar(max)                            
                        
   --SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106  
     
     
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------      
         
   DECLARE @filename102 as varchar(100)                                                        
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                    
   DECLARE @FILENAME_102 VARCHAR(250)                             
   declare @s102 as varchar(max)                            
                        
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                            
                         
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102  
     
     
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------      
         
   --DECLARE @filename107 as varchar(100)                                                        
   --select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_107 VARCHAR(250)                                    
   --DECLARE @FILENAME_107 VARCHAR(250)                             
   --declare @s107 as varchar(max)                            
                        
   --SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107  
     
    
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------      
         
   --DECLARE @filename108 as varchar(100)                                                        
   --select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_108 VARCHAR(250)                                    
   --DECLARE @FILENAME_108 VARCHAR(250)                             
   --declare @s108 as varchar(max)                            
                        
   --SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108  
     
     
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------      
         
   --DECLARE @filename103 as varchar(100)                                                        
   --select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   --DECLARE @BCPCOMMAND_103 VARCHAR(250)                                    
   --DECLARE @FILENAME_103 VARCHAR(250)                             
   --declare @s103 as varchar(max)                            
                        
   --SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   --SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   --SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103  
     
     
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------      
         
   DECLARE @filename11 as varchar(100)                                                        
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                    
   DECLARE @FILENAME_11 VARCHAR(250)                             
   declare @s11 as varchar(max)                            
                        
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                            
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11


   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------      
         
   DECLARE @filename12 as varchar(100)                                                        
   select @filename12='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_12 VARCHAR(250)                                    
   DECLARE @FILENAME_12 VARCHAR(250)                             
   declare @s12 as varchar(max)                            
                        
   SET @FILENAME_12 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND_12 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.159'' " QUERYOUT "'                            
   SET @BCPCOMMAND_12 = @BCPCOMMAND_12 + @filename12 + '" -c -t, -SABVSMIS.internal.angelone.in -Uinhouse -Pinh6014'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_12
   
   
   
     
       
          
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_30102024
-- --------------------------------------------------
        
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'        
Create Procedure [dbo].[Usp_OmnUserInfoAuto_30102024]        
(        
    @USERNAME VARCHAR(100),                      
    @IPADDR   VARCHAR(100)        
)        
As        
BEGIN         
         
 declare  @StartDate datetime  =getdate()         
        
         
 ----///*****Hist Table ***************///---------------        
 insert into Tbl_OmnUserinfo_Hist (ClientCode,GroupId,Update_Date,BrokerId,ServerId)        
 select ClientCode,GroupId, GETDATE(),BrokerId,ServerId from Tbl_OmnUserinfo       
         
 ----///*****Insert In Main Omnesys Table ***************///---------------        
 truncate table Tbl_OmnUserinfo        
         
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------      
 --insert into Tbl_OmnUserinfo        
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]      
       
       
 --insert into Tbl_OmnUserinfo        
 --select distinct mnmUser,mnmBroker       
 --from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a       
 --inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b      
 --on a.mnmUser=b.AccountId collate Latin1_General_CI_AI      
       
       
 insert into Tbl_OmnUserinfo (ClientCode,GroupId,BrokerId,ServerId)      
 select AccountId,BranchId,BrokerId,(Case when OmneManagerID='1' then  '10.253.33.65'    
               when OmneManagerID='2' then  '10.253.33.66'    
               when OmneManagerID='3' then  '10.253.33.67'    
               when OmneManagerID='4' then  '10.253.33.68'    
               when OmneManagerID='6' then  '10.253.33.77'    
               when OmneManagerID='7' then  '10.253.33.79'    
               When OmneManagerId='8' then  '10.253.33.80'    
               When OmneManagerId='9' then  '10.253.33.81'     
               When OmneManagerId='10' then  '10.253.33.163'   
      When OmneManagerId='12' then  '10.253.78.159'    
               --When OmneManagerId='104' then  '10.253.33.68'    
               --When OmneManagerId='106' then  '10.253.33.77'    
               When OmneManagerId='102' then  '10.253.33.66'    
               --When OmneManagerId='107' then  '10.253.33.79'    
               --When OmneManagerId='108' then  '10.253.33.80'    
               When OmneManagerId='11' then  '10.253.33.78'  
      When OmneManagerId='12' then  '10.253.78.159'  
      When OmneManagerId='13' then  '10.253.78.160'     
                end ) as OmneManagerID                 
 from [10.253.33.65].[Uploader-db-amx].dbo.tbl_usermasterinfo where ClientStatus='A'     
     
      
 --select distinct AccountId , BranchId,BrokerId,'172.31.15.250' as ServerId       
 --from [172.31.15.250].[Uploader-db-NEW].dbo.investorclient with (nolock) where ClientStatus='A'      
 --union all       
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.69' as ServerId      
 --from [172.31.15.69].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all      
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.154' as ServerId      
 --from [172.31.15.154].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all       
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.253' as ServerId        
 --from [172.31.15.253].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.169' as ServerId        
 --from [172.31.15.169].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'    
 --union all     
 --select distinct AccountId collate SQL_Latin1_General_CP1_CI_AS , BranchId collate SQL_Latin1_General_CP1_CI_AS,BrokerId collate SQL_Latin1_General_CP1_CI_AS,'172.31.15.46' as ServerId        
 --from [172.31.15.46].[uploader-db].dbo.investorclient   with (nolock) where ClientStatus='A'      
      
 ----------------------------------------END---------------------------------------------------------------------------      
        
         
 declare @userCount varchar(10)        
 select @userCount = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.65'       
       
 declare @userCount_B2B varchar(10)        
 select @userCount_B2B = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'        
       
 declare @userCount_GM3 varchar(10)        
 select @userCount_GM3 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'      
       
 declare @userCount_GM4 varchar(10)        
 select @userCount_GM4 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'     
     
 declare @userCount_GM6 varchar(10)        
 select @userCount_GM6 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'     
     
 declare @userCount_GM7 varchar(10)        
 select @userCount_GM7 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'    
     
 declare @userCount_GM8 varchar(10)        
 select @userCount_GM8 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'    
     
 declare @userCount_GM9 varchar(10)        
 select @userCount_GM9 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.81'    
     
 declare @userCount_GM10 varchar(10)        
 select @userCount_GM10 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.163'    
     
 --declare @userCount_GPX_104 varchar(10)        
 --select @userCount_GPX_104 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.68'     
     
 --declare @userCount_GPX_106 varchar(10)        
 --select @userCount_GPX_106 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.77'      
     
 declare @userCount_GPX_102 varchar(10)        
 select @userCount_GPX_102 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.66'     
     
 --declare @userCount_GPX_107 varchar(10)        
 --select @userCount_GPX_107 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.79'    
     
 --declare @userCount_GPX_108 varchar(10)        
 --select @userCount_GPX_108 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.80'     
     
 --declare @userCount_GPX_103 varchar(10)        
 --select @userCount_GPX_103 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.67'    
     
 declare @userCount_GM11 varchar(10)        
 select @userCount_GM11 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.33.78'      
   
   
 declare @userCount_GM12 varchar(10)        
 select @userCount_GM12 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.159'  
   
 declare @userCount_GM13 varchar(10)        
 select @userCount_GM13 = COUNT(*) from Tbl_OmnUserinfo where ServerId='10.253.78.160'      
         
 ---------------///**********Log Table **********************/////-------------------------        
  insert into Tbl_UserInfoLogTime         
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR        
           
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_B2B',@StartDate,getdate(),@userCount_B2B,'Omnesys2',@USERNAME,@IPADDR       
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM3',@StartDate,getdate(),@userCount_GM3,'Omnesys3',@USERNAME,@IPADDR      
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM4',@StartDate,getdate(),@userCount_GM4,'Omnesys4',@USERNAME,@IPADDR      
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM6',@StartDate,getdate(),@userCount_GM6,'Omnesys6',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM7',@StartDate,getdate(),@userCount_GM7,'Omnesys7',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM8',@StartDate,getdate(),@userCount_GM8,'Omnesys8',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM9',@StartDate,getdate(),@userCount_GM9,'Omnesys9',@USERNAME,@IPADDR    
        
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM10',@StartDate,getdate(),@userCount_GM10,'Omnesys10',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_104',@StartDate,getdate(),@userCount_GPX_104,'OMNESYS_GPX_104',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_106',@StartDate,getdate(),@userCount_GPX_106,'OMNESYS_GPX_106',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GPX_102',@StartDate,getdate(),@userCount_GPX_102,'OMNESYS_GPX_102',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_107',@StartDate,getdate(),@userCount_GPX_107,'OMNESYS_GPX_107',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_108',@StartDate,getdate(),@userCount_GPX_108,'OMNESYS_GPX_108',@USERNAME,@IPADDR    
      
  --insert into Tbl_UserInfoLogTime       
  --select 'UserInfo_GPX_103',@StartDate,getdate(),@userCount_GPX_103,'OMNESYS_GPX_103',@USERNAME,@IPADDR    
      
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM11',@StartDate,getdate(),@userCount_GM11,'UserInfo_GM11',@USERNAME,@IPADDR  
  
  
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM12',@StartDate,getdate(),@userCount_GM12,'UserInfo_GM12',@USERNAME,@IPADDR    
  
  insert into Tbl_UserInfoLogTime       
  select 'UserInfo_GM13',@StartDate,getdate(),@userCount_GM13,'UserInfo_GM13',@USERNAME,@IPADDR   
         
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------      
        
  exec [CSOKYC-6].General.dbo.USP_UserListDetails_Omnesys      
        
  --------------------------///////////////END*********************---------------------       
              
    ------------///**********User Info File Download Code **********************/////-------------------------    SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc     
   drop table UserInfoFileDownload         
          
   select distinct ClientCode,GroupId,Brokerid,ServerId      
   into UserInfoFileDownload      
   from Tbl_OmnUserinfo with (nolock)       
          
             
   DECLARE @filename1 as varchar(100)                                                        
   select @filename1='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND VARCHAR(250)                                    
   DECLARE @FILENAME VARCHAR(250)                             
   declare @s1 as varchar(max)                            
                        
   SET @FILENAME = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                           
                         
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.65''" QUERYOUT "'                            
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND      
         
         
   ---------------------------------Omnesys Server B2B Code------------------------------------------------------------------      
   DECLARE @filename2 as varchar(100)                                                        
   select @filename2='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_2 VARCHAR(250)                                    
   DECLARE @FILENAME_2 VARCHAR(250)                             
   declare @s2 as varchar(max)                            
                        
   SET @FILENAME_2 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_B2B'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                       
    
                         
   SET @BCPCOMMAND_2 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                            
   SET @BCPCOMMAND_2 = @BCPCOMMAND_2 + @filename2 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_2         
         
         
        
   -----------------------------------------Omnesys Server B2C GM3 Server ----------------------------------------------------      
         
   DECLARE @filename3 as varchar(100)                                                        
   select @filename3='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                             
                               
   DECLARE @BCPCOMMAND_3 VARCHAR(250)                                    
   DECLARE @FILENAME_3 VARCHAR(250)                             
   declare @s3 as varchar(max)                            
                        
   SET @FILENAME_3 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM3'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
   
                         
   SET @BCPCOMMAND_3 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                            
   SET @BCPCOMMAND_3 = @BCPCOMMAND_3 + @filename3 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                  
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_3      
         
         
   ---------------------------------------------Omnesys Server B2C GM4 Server ----------------------------------------------------        
           
   DECLARE @filename4 as varchar(100)                                                          
   select @filename4='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_4 VARCHAR(250)                                      
   DECLARE @FILENAME_4 VARCHAR(250)                               
   declare @s4 as varchar(max)                              
                          
   SET @FILENAME_4 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM4'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_4 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                              
   SET @BCPCOMMAND_4 = @BCPCOMMAND_4 + @filename4 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_4        
       
   ---------------------------------------------Omnesys Server B2C GM6 Server ----------------------------------------------------        
           
   DECLARE @filename6 as varchar(100)                                                          
   select @filename6='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_6 VARCHAR(250)                                      
   DECLARE @FILENAME_6 VARCHAR(250)                               
   declare @s6 as varchar(max)                              
                          
   SET @FILENAME_6 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM6'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_6 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                              
   SET @BCPCOMMAND_6 = @BCPCOMMAND_6 + @filename6 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_6     
       
   ---------------------------------------------Omnesys Server B2C GM7 Server ----------------------------------------------------        
           
   DECLARE @filename7 as varchar(100)                                                          
   select @filename7='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_7 VARCHAR(250)                                      
   DECLARE @FILENAME_7 VARCHAR(250)                       
   declare @s7 as varchar(max)                              
                          
   SET @FILENAME_7 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM7'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_7 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                              
   SET @BCPCOMMAND_7 = @BCPCOMMAND_7 + @filename7 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_7     
       
       
   ---------------------------------------------Omnesys Server B2C GM8 Server ----------------------------------------------------        
           
   DECLARE @filename8 as varchar(100)                                                          
   select @filename8='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_8 VARCHAR(250)                                      
   DECLARE @FILENAME_8 VARCHAR(250)                               
   declare @s8 as varchar(max)                              
                          
   SET @FILENAME_8 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM8'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_8 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                              
   SET @BCPCOMMAND_8 = @BCPCOMMAND_8 + @filename8 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_8     
       
  ---------------------------------------------Omnesys Server B2C GM9 Server ----------------------------------------------------        
           
   DECLARE @filename9 as varchar(100)                                                          
   select @filename9='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_9 VARCHAR(250)                                      
   DECLARE @FILENAME_9 VARCHAR(250)                               
   declare @s9 as varchar(max)                              
                          
   SET @FILENAME_9 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM9'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                        
     
                           
   SET @BCPCOMMAND_9 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.81'' " QUERYOUT "'                              
   SET @BCPCOMMAND_9 = @BCPCOMMAND_9 + @filename9 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_9    
       
   ---------------------------------------------Omnesys Server B2C GM10 Server ----------------------------------------------------        
           
   DECLARE @filename10 as varchar(100)                                                          
   select @filename10='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_10 VARCHAR(250)                                      
   DECLARE @FILENAME_10 VARCHAR(250)                               
   declare @s10 as varchar(max)                              
                          
   SET @FILENAME_10 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM10'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_10 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.163'' " QUERYOUT "'                              
   SET @BCPCOMMAND_10 = @BCPCOMMAND_10 + @filename10 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_10    
       
       
   ---------------------------------------------Omnesys Server B2B GPX_104 Server ----------------------------------------------------        
           
   --DECLARE @filename104 as varchar(100)                                                          
   --select @filename104='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_104 VARCHAR(250)                                      
   --DECLARE @FILENAME_104 VARCHAR(250)                               
   --declare @s104 as varchar(max)                              
                          
   --SET @FILENAME_104 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM104'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_104 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.68'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_104 = @BCPCOMMAND_104 + @filename104 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_104    
       
   ---------------------------------------------Omnesys Server B2B GPX_106 Server ----------------------------------------------------        
           
   --DECLARE @filename106 as varchar(100)                                                          
 --select @filename106='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_106 VARCHAR(250)                                      
   --DECLARE @FILENAME_106 VARCHAR(250)                               
   --declare @s106 as varchar(max)                              
                          
   --SET @FILENAME_106 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM106'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_106 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.77'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_106 = @BCPCOMMAND_106 + @filename106 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_106    
       
       
    ---------------------------------------------Omnesys Server B2B GPX_102 Server ----------------------------------------------------        
           
   DECLARE @filename102 as varchar(100)                                                          
   select @filename102='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_102 VARCHAR(250)                                      
   DECLARE @FILENAME_102 VARCHAR(250)                               
   declare @s102 as varchar(max)                              
                          
   SET @FILENAME_102 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM102'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                              
                           
   SET @BCPCOMMAND_102 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.66'' " QUERYOUT "'                              
   SET @BCPCOMMAND_102 = @BCPCOMMAND_102 + @filename102 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_102    
       
       
 ---------------------------------------------Omnesys Server B2C GPX_107 Server ----------------------------------------------------        
           
   --DECLARE @filename107 as varchar(100)                                                          
   --select @filename107='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_107 VARCHAR(250)                                      
   --DECLARE @FILENAME_107 VARCHAR(250)                               
   --declare @s107 as varchar(max)                              
                          
   --SET @FILENAME_107 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM107'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_107 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.79'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_107 = @BCPCOMMAND_107 + @filename107 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_107    
       
      
  ---------------------------------------------Omnesys Server B2C GPX_108 Server ----------------------------------------------------        
           
   --DECLARE @filename108 as varchar(100)                                                          
   --select @filename108='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_108 VARCHAR(250)                                      
   --DECLARE @FILENAME_108 VARCHAR(250)                               
   --declare @s108 as varchar(max)                              
                          
   --SET @FILENAME_108 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM108'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_108 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.80'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_108 = @BCPCOMMAND_108 + @filename108 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_108    
       
       
   ---------------------------------------------Omnesys Server B2C GPX_103 Server ----------------------------------------------------        
           
   --DECLARE @filename103 as varchar(100)                                                          
   --select @filename103='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   --DECLARE @BCPCOMMAND_103 VARCHAR(250)                                      
   --DECLARE @FILENAME_103 VARCHAR(250)                               
   --declare @s103 as varchar(max)                              
                          
   --SET @FILENAME_103 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM103'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                  
           
                           
   --SET @BCPCOMMAND_103 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.67'' " QUERYOUT "'                              
   --SET @BCPCOMMAND_103 = @BCPCOMMAND_103 + @filename103 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   --EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_103    
       
       
    ---------------------------------------------Omnesys Server B2C GM11 Server ----------------------------------------------------        
           
   DECLARE @filename11 as varchar(100)                                                          
   select @filename11='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_11 VARCHAR(250)                                      
   DECLARE @FILENAME_11 VARCHAR(250)                               
   declare @s11 as varchar(max)                              
                          
   SET @FILENAME_11 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM11'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_11 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.33.78'' " QUERYOUT "'                              
   SET @BCPCOMMAND_11 = @BCPCOMMAND_11 + @filename11 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_11  
  
  
   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------        
           
   DECLARE @filename12 as varchar(100)                                                          
   select @filename12='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_12 VARCHAR(350)                                      
   DECLARE @FILENAME_12 VARCHAR(350)                               
   declare @s12 as varchar(max)                              
                          
   SET @FILENAME_12 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM12'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_12 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.159'' " QUERYOUT "'                              
   SET @BCPCOMMAND_12 = @BCPCOMMAND_12 + @filename12 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_12  
  
  
   ---------------------------------------------Omnesys Server B2C GM12 Server ----------------------------------------------------        
           
   DECLARE @filename13 as varchar(100)                                                          
   select @filename13='\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM13'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                               
                                 
   DECLARE @BCPCOMMAND_13 VARCHAR(350)                                      
   DECLARE @FILENAME_13 VARCHAR(350)                               
   declare @s13 as varchar(max)                              
                          
   SET @FILENAME_13 = '\\INHOUSELIVEAPP1-FS.angelone.in\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile_GM13'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                      
       
                           
   SET @BCPCOMMAND_13 = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload where ServerId=''10.253.78.160'' " QUERYOUT "'                              
   SET @BCPCOMMAND_13 = @BCPCOMMAND_13 + @filename13 + '" -c -t, -SABVSMIS.internal.angelone.in -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND_13  
     
     
     
       
         
            
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_OmnUserInfoAuto_4Sept2020
-- --------------------------------------------------
  
  
--Usp_OmnUserInfoAuto 'E66460','172.29.31.8'  
Create Procedure [dbo].[Usp_OmnUserInfoAuto_4Sept2020]  
(  
    @USERNAME VARCHAR(100),                
    @IPADDR   VARCHAR(100)  
)  
As  
BEGIN   
   
 declare  @StartDate datetime  =getdate()   
  
   
 ----///*****Hist Table ***************///---------------  
 insert into Tbl_OmnUserinfo_Hist   
 select ClientCode,GroupId,GETDATE() from Tbl_OmnUserinfo  
   
 ----///*****Insert In Main Omnesys Table ***************///---------------  
 truncate table Tbl_OmnUserinfo  
   
-----------------New Migration Plan insert the new  table Changes by Prashant Patade on 22 july 2020 ---------------
 --insert into Tbl_OmnUserinfo  
 --select mnmUser,mnmBroker from [172.31.15.250].Omnet.dbo.[DealerAddMrv]
 
 
 insert into Tbl_OmnUserinfo  
 select distinct mnmUser,mnmBroker 
 from [172.31.15.250].Omnet.dbo.[DealerAddMrv]  a 
 inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
 on a.mnmUser=b.AccountId collate Latin1_General_CI_AI

 ----------------------------------------END---------------------------------------------------------------------------
  
   
 declare @userCount varchar(10)  
 select @userCount = COUNT(*) from Tbl_OmnUserinfo  
   
 ---------------///**********Log Table **********************/////-------------------------  
  insert into Tbl_UserInfoLogTime   
  select 'UserInfo',@StartDate,getdate(),@userCount,'Omnesys1',@USERNAME,@IPADDR  
   
  ----------------------/////////******Omesys user List Servere /////////////--------------------------------------------
  
  exec [196.1.115.182].General.dbo.USP_UserListDetails_Omnesys
  
  --------------------------///////////////END*********************--------------------- 
        
    ------------///**********User Info File Download Code **********************/////-------------------------   
   drop table UserInfoFileDownload   
    
   select distinct * 
   into UserInfoFileDownload
   from [172.31.15.250].Omnet.dbo.[DealerAddMrv] a 
   inner join  [172.31.15.250].[uploader-db].dbo.Tbl_ClientCodeMagriation b
   on a.mnmUser=b.AccountId collate Latin1_General_CI_AI  
       
   DECLARE @filename1 as varchar(100)                                                  
   select @filename1='\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                       
                         
   DECLARE @BCPCOMMAND VARCHAR(250)                              
   DECLARE @FILENAME VARCHAR(250)                       
   declare @s1 as varchar(max)                      
                  
   SET @FILENAME = '\\196.1.115.147\Upload1\OmnesysFileFormat\UserInfo\UserInfoFile'+replace (convert (varchar(12),GETDATE(),103),'/','')+'.txt'                                                                                     
                   
   SET @BCPCOMMAND = 'BCP "SELECT  * from Upload.dbo.UserInfoFileDownload" QUERYOUT "'                      
   SET @BCPCOMMAND = @BCPCOMMAND + @filename1 + '" -c -t, -Smis -Uinhouse -Pinh6014'                            
   EXEC MASTER..XP_CMDSHELL @BCPCOMMAND  
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ORACLE_INVOICE_UPLOAD
-- --------------------------------------------------
CREATE PROC USP_ORACLE_INVOICE_UPLOAD      
(                       
   @FILENAME AS VARCHAR(45)                  
 )         
AS      
BEGIN       
 INSERT INTO remisior.DBO.ORACLE_UPLOAD      
 SELECT INVOICE_NUM,    
INVOICE_TYPE_LOOKUP_CODE,    
INVOICE_DATE,    
VENDOR_NUM,    
VENDOR_SITE_CODE,    
INVOICE_AMOUNT,    
INVOICE_CURRENCY_CODE,    
TERMS_NAME,    
Description,    
STATUS,    
SOURCE,    
DOC_CATEGORY_CODE,    
PAYMENT_METHOD_LOOKUP_CODE,    
GL_DATE,    
ORG_ID,    
LINE_NUMBER,    
LINE_TYPE_LOOKUP_CODE,    
LINE_AMOUNT,    
Line_DESCRIPTION,    
DIST_LINE_NUMBER,    
DIST_AMOUNT,    
DIST_CODE_CONCATENATED,    
ACCOUNTING_DATE,    
DIST_DESCRIPTION,    
PAY_GROUP_LOOKUP_CODE,    
SEGMENT_1,    
SEGMENT_2,    
SEGMENT_3,    
SEGMENT_4,    
SEGMENT_5,    
SEGMENT_6,    
SEGMENT_7,    
SEGMENT_8,    
SEGMENT_9,    
SEGMENT_10,    
SEGMENT_11,    
ASSETS_TRACKING_FLAG,    
ATTRIBUTE_CATEGORY,    
ATTRIBUTE1,    
ATTRIBUTE2,    
ATTRIBUTE3,    
ATTRIBUTE4,    
ATTRIBUTE5,    
ATTRIBUTE6,    
ATTRIBUTE7,    
ATTRIBUTE8,    
ATTRIBUTE9,    
ATTRIBUTE10,    
ATTRIBUTE11,    
ATTRIBUTE12,    
ATTRIBUTE13,    
ATTRIBUTE14,    
ATTRIBUTE15,    
DIST_ATTRIBUTE_CATEGORY,    
DIST_ATTRIBUTE1,    
DIST_ATTRIBUTE2,    
DIST_ATTRIBUTE3,    
DIST_ATTRIBUTE4,    
DIST_ATTRIBUTE5,    
DIST_GLOBAL_ATT_CATEGORY,    
GLOBAL_ATTRIBUTE1,    
GLOBAL_ATTRIBUTE2,    
GLOBAL_ATTRIBUTE3,    
GLOBAL_ATTRIBUTE4,    
GLOBAL_ATTRIBUTE5,    
PREPAY_NUM,    
PREPAY_DIST_NUM,    
PREPAY_APPLY_AMOUNT,    
PREPAY_GL_DATE,    
INVOICE_INCLUDES_PREPAY_FLAG,    
PREPAY_LINE_NUM,    
CREATED_BY,    
CREATION_DATE,    
PROCESSED_STATUS,    
ERROR_MESSAGE,    
INVOICE_STATUS,    
REPLACE(REPLACE(BATCH_NAME,CHAR(13),''),',','') as BATCH_NAME     
FROM ORACLE_UPLOAD_TEMP      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PledgeConvertor_Unix
-- --------------------------------------------------
CREATE Procedure USP_PledgeConvertor_Unix
(
@path varchar(100),
@filename varchar(75)
)
as
--declare 
--@path varchar(100),
--@filename varchar(75)

--set @path='\\172.29.19.10\d$\PledgeUpload\'
--set @filename='07033200.00040'
declare @sql varchar(8000)
set @sql='EXEC master..xp_cmdshell '''+@path+'DOS2UNIX.EXE '+@path+@filename+''''
--print @sql
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PLEDGRELEASE
-- --------------------------------------------------
CREATE PROC [dbo].[USP_PLEDGRELEASE]              
(              
   @FILENAME AS VARCHAR(45)              
)              
AS              
BEGIN               
 --SET NOCOUNT ON               
         
 --truncate table  tbl_tempPledgeRelease        
    
set nocount off      
     
 --INSERT INTO DEMAT.DBO.TBL_PLEDGERELEASE              
 --SELECT * FROM  TBL_tempPLEDGERELEASE              
              
  insert into tbl_tempPledgeRelease_hist(ID,Transaction_Type,Bo_ID,ISIN,Transaction_Id,Quantiy,Transaction_Status,Trans_Setup_date,business_Date,
  Free_Locking_Flag,Pledgee_Bo_Id,Field1,Field2,Field3,Parent_Psn,Field4,Field5,Document_Number,Agreement_Number,PledgeDP_Int_Ref_NO,Field6,Lockin_Code,
  Lockin_Expiry_Date,Pledge_Expiry_Date,Maker_Checker_Flag,Field7,Field8,Field9,Pledge_Value,Field10,Field11,Field12,Financial_Flag,EFTS_Code,
  Transaction_Code,Modification_Flag,Pledg_Or_DP_Int_RefNo,Pledg_Or_DP_Remarks,Pledgee_DP_Remarks,Operation_ID,Transaction_Source,Last_Modification_Date,
  Lockin_Id,Field13,Filler1,Filler2,Filler3,Filler4,Filler5,FILLER6,FILLER7,FILLER8,FILLER9,FILLER10,update_time,UPDATE_by)        
 select *,GETDATE(),'E10398' from tbl_tempPledgeRelease        
    
set nocount on      
  
if Convert(varchar(11),GETDATE(),103)<>(select Convert(varchar(11),max(process_date),103) from DP57_processtime with (nolock))    
begin     
 exec DP57_PLEDGEPROCESS       
 --print 'test'
end    
    
set nocount off      
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPT_TICKER_IMG_UPLOAD
-- --------------------------------------------------
    
/******************************************************************************    
CREATED BY: RUTVIJ PATIL    
DATE: 19/11/2010    
PURPOSE: USE TO GET DATA FOR MIS REPORT OF TICKER IMAGE UTILITY
    
MODIFIED BY: PROGRAMMER NAME    
DATED: DD/MM/YYYY    
REASON: REASON TO CHANGE STORE PROCEDURE    
******************************************************************************/    
    
CREATE PROCEDURE USP_RPT_TICKER_IMG_UPLOAD

	@ACCESS_TO VARCHAR(100),    
	@ACCESS_CODE VARCHAR(100)  

AS    
    
BEGIN    
    
	SELECT TICKER_MESSAGE AS [TICKER MESSAGE],    
		CONVERT(VARCHAR(9), DATE_FROM, 6)AS [FROM DATE],    
		TIME_FROM AS [FROM TIME],    
		CONVERT(VARCHAR(9), DATE_TO, 6) AS [TO DATE],    
		TIME_TO AS [TO TIME],    
		CREATED_BY AS [USER],    
		CONVERT(VARCHAR(9), CREATED_DATE, 6) AS [REQUEST/ENTRY DATE],    
		CONVERT(VARCHAR(5), CREATED_DATE, 108) AS [REQUEST/ENTRY TIME]    
	FROM TICKER_IMG_UPLOAD    
	ORDER BY CREATED_DATE DESC    
    
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RPT_TR_IMG_UPLOAD_MIS
-- --------------------------------------------------
  
/******************************************************************************  
CREATED BY: RUTVIJ PATIL  
DATE: 21/09/2010  
PURPOSE: USE TO GET DATA FOR MIS REPORT OF IMAGE UPLOAD UTILITY  
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
  
CREATE PROCEDURE USP_RPT_TR_IMG_UPLOAD_MIS
 @ACCESS_TO VARCHAR(100),  
 @ACCESS_CODE VARCHAR(100)
-- @USERNAME VARCHAR(100)  
AS  
  
BEGIN  
  
 SELECT POPUP_NAME AS [POP UP Title],  
  CONVERT(VARCHAR(9), DATE_FROM, 6)AS [From Date],  
  TIME_FROM AS [From Time],  
  CONVERT(VARCHAR(9), DATE_TO, 6) AS [To Date],  
  TIME_TO AS [To Time],  
  FOR_EMP AS [Employee Angel in-house login / NRMS login],  
  FOR_SB_ADMIN AS [SB (Remiser) login],  
  FOR_SB_USER AS [SB (Non - Remiser) login],  
  HLINK_REQD AS [Hyperlink],  
  CREATED_BY AS [User],  
  CONVERT(VARCHAR(9), CREATED_DATE, 6) AS [Request/Entry Date],  
  CONVERT(VARCHAR(5), CREATED_DATE, 108) AS [Request/Entry Time]  
 FROM TR_IMG_UPLOAD  
 ORDER BY CREATED_DATE DESC  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_SbInterview_06Nov2025
-- --------------------------------------------------
CREATE proc Usp_SbInterview_06Nov2025     
    
as      
select Sub_Broker, TurnOver = sum(Turnover), Brokerage = Sum(Brokerage) into #t      
from intranet.bsedb_ab.dbo.MIS_To       
where sauda_date >= 'Apr 01 2009' and       
sauda_date <= 'Mar 31 2010 23:59:59'       
group by Sub_Broker      
      
  
select Dev,a.Region,Sub_Broker, Branch_cd into #City      
from upload.dbo.br_region a      
inner join      
upload.dbo.sb_comp b      
on a.[branch code] = b.branch_cd    
where sub_broker <> branch_cd  
and  
sub_broker not in   
(select  B2c_SB from remisior.dbo.b2c_sb)  
  
      
select x.Sub_Broker,TurnOver,Brokerage,city=Dev,Region,Branch_cd    
into #x from #t x,#city y where x.sub_broker = y.sub_broker    
      
select regtag,regdate=max(regdate) into #y    
from sb_comp.dbo.bpregmaster   
where regstatus = 'registered' and  
regreferencetag<>regtag  
and regreferencetag <> ''  
and regreferencetag is not null  
group by regtag    
  
    
select a.regtag,b.RegTradeName, JoiningDate=b.RegDate,      
Address=b.RegResadd1+','+b.RegResadd2,Landline=RegResPhone,Mobile=RegMobile, Email=RegEmailid    
into #c   
from #y a      
inner join      
sb_comp.dbo.bpregmaster b      
on a.regtag = b.RegTag and a.RegDate = b.RegDate    
    
select * into #2 from #c x, #x y where x.regtag = y.sub_broker    
    
select * from #2 where city in     
('Mumbai','Ahmedabad','Rajkot','Bangalore','Coimbatore','Ernakulam','Kolkata','Delhi')      

/*-https://angelbrokingpl.atlassian.net/browse/SRE-41572*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_SbInterview_tobedeleted09jan2026
-- --------------------------------------------------
CREATE proc Usp_SbInterview      
    
as     
insert into Dustbin.dbo.tbl_SP_log
values(OBJECT_NAME(@@PROCID),getdate())

select Sub_Broker, TurnOver = sum(Turnover), Brokerage = Sum(Brokerage) into #t      
from intranet.bsedb_ab.dbo.MIS_To       
where sauda_date >= 'Apr 01 2009' and       
sauda_date <= 'Mar 31 2010 23:59:59'       
group by Sub_Broker      
      
  
select Dev,a.Region,Sub_Broker, Branch_cd into #City      
from upload.dbo.br_region a      
inner join      
upload.dbo.sb_comp b      
on a.[branch code] = b.branch_cd    
where sub_broker <> branch_cd  
and  
sub_broker not in   
(select  B2c_SB from remisior.dbo.b2c_sb)  
  
      
select x.Sub_Broker,TurnOver,Brokerage,city=Dev,Region,Branch_cd    
into #x from #t x,#city y where x.sub_broker = y.sub_broker    
      
select regtag,regdate=max(regdate) into #y    
from sb_comp.dbo.bpregmaster   
where regstatus = 'registered' and  
regreferencetag<>regtag  
and regreferencetag <> ''  
and regreferencetag is not null  
group by regtag    
  
    
select a.regtag,b.RegTradeName, JoiningDate=b.RegDate,      
Address=b.RegResadd1+','+b.RegResadd2,Landline=RegResPhone,Mobile=RegMobile, Email=RegEmailid    
into #c   
from #y a      
inner join      
sb_comp.dbo.bpregmaster b      
on a.regtag = b.RegTag and a.RegDate = b.RegDate    
    
select * into #2 from #c x, #x y where x.regtag = y.sub_broker    
    
select * from #2 where city in     
('Mumbai','Ahmedabad','Rajkot','Bangalore','Coimbatore','Ernakulam','Kolkata','Delhi')      

/*-https://angelbrokingpl.atlassian.net/browse/SRE-41572*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SCCS_deletecontrolclients
-- --------------------------------------------------
CREATE Procedure USP_SCCS_deletecontrolclients
(@username varchar(20))
as
set nocount on

truncate table SCCS_deletecontrolclients

insert into SCCS_deletecontrolclients(party_code,enteredby,enteredon)
select party_code,@username,GETDATE() from SCCS_deletecontrolclients_tempupload

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SCCS_deletecontrolclients_rpt
-- --------------------------------------------------
CREATE proc USP_SCCS_deletecontrolclients_rpt
(
@access_to varchar(20),
@access_code varchar(20)
)
as
set nocount on

select [branch code]=branch_cd,[SB Code]=sub_broker,[Party Code]=x.party_code,[Party Name]=short_name from 
(select srno,party_code,enteredby,enteredon
 from SCCS_deletecontrolclients with (nolock))x
 left outer join 
 (select party_code,branch_cd,sub_broker,short_name from intranet.risk.dbo.client_details with (nolock))y
 on x.party_code=y.party_code
 
 set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Sebi_Mail
-- --------------------------------------------------
CREATE proc Usp_Sebi_Mail(@Pan varchar(1000))  
As                       
   
DECLARE @rc INT                     
IF NOT EXISTS (SELECT * FROM intranet.msdb.sys.service_queues                     
WHERE name = N'ExternalMailQueue' AND is_receive_enabled = 1)                    
EXEC @rc = intranet.msdb.dbo.sysmail_start_sp

Declare @Msg as Varchar(2000)  
Declare @Code Varchar(15),@Name varchar(50),@Br varchar(10),@Sb varchar(10),@Order Varchar(200),@Part Varchar(300)  
  
Select @Code=b.Cl_code,@Name=a.Name,@Br=b.Branch_Cd,@Sb=b.Sub_broker,@Order=a.order_no,@Part=Convert(Varchar,a.brief_particulars) from   
Intranet.testdb.dbo.Sebi_Banned a,Intranet.risk.dbo.Client_details b   
Where a.Pan_No = b.Pan_Gir_No and a.Pan_No = @Pan       
  
Set @Msg = '<html><body><form>Dear All,<br><br><b><font family = verdana>This SebiBanned Client is found in our Database.</font><br></b><br><table border=1><tr><td>Client Code</td><td>Client Name</td><td>BranchCd</td><td>SubbrokerCd</td><td>PanNo</td><td>
OrderNo</td><td>Particulars</td></tr>'            
Set @Msg = @Msg+'<tr><td><b>'+@Code+'</b></td><td>'+@Name+'</td><td>'+@Br+'</td><td>'+@Sb+'</td><td>'+@Pan+'</td><td>'+@Order+'</td><td>'+@Part+'</td></tr></table></form></body></html>'  
  
EXEC intranet.msdb.dbo.sp_send_dbmail                                                                                                                                            
@recipients = 'Selvin.turai@angeltrade.com',
@profile_name = 'intranet',                                     
--@from = 'Soft@angeltrade.com',                                                                                                          
@body = @Msg,                                                                       
@subject = 'Sebi-Banned Clients',                                                                  
@body_format  = 'html'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SEBI_UPLOAD
-- --------------------------------------------------
CREATE PROC [dbo].[USP_SEBI_UPLOAD]      
(                       
   @FILENAME AS VARCHAR(45)                  
 )         
AS      
BEGIN       
INSERT INTO [196.1.115.219].genodinlimit.dbo.tbl_BankAxis (AccounNO,Balance,Narration)     
SELECT 
       [AccounNO]
      ,[Balance]
      ,[Narration]  
FROM tbl_BankAxis_Temp   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_sebiforcefuldata
-- --------------------------------------------------
CREATE Procedure USP_sebiforcefuldata(@username varchar(25)='E10398',@filename  VARCHAR(100)=NULL )
as
begin 
	
	select * from temp_sebiforcefuldata
	
	DELETE FROM SCCS.DBO.Sebi_ForcefulPayout WHERE CONVERT(VARCHAR(11),entered_on,103)=CONVERT(VARCHAR(11),GETDATE(),103)
	
	
	insert into SCCS.DBO.Sebi_ForcefulPayout
	select *,GETDATE(),@username from temp_sebiforcefuldata
		
		
	truncate table temp_sebiforcefuldata
		
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_sendmail_hrpendoc
-- --------------------------------------------------
CREATE proc [dbo].[Usp_sendmail_hrpendoc]    
(    
@type as varchar(15),    
@server as varchar(100)     
)                      
as                      
    /*    
declare @type as varchar(15) ,@server as varchar(100)         
set @type = 'HOD'     
set @server = '196.1.115.183'    
  */  
    
select a.fld_hod_no,email          
 into #regmail           
from tbl_hr_pnddoc a                       
left outer join                       
intranet.risk.dbo.emp_info b on a.fld_hod_no = b.emp_no                      
                      
declare @tag varchar(50),@email varchar(4000),@mess as varchar(8000)                                                                                             
                                                                                            
DECLARE email_hr CURSOR FOR                                                  
select distinct fld_hod_no from #regmail                                   
OPEN email_hr                                                 
FETCH NEXT FROM email_hr                                                                     
INTO @tag                                                                                 
WHILE @@FETCH_STATUS = 0                                           
BEGIN        
                 
if(@type = 'REGION')   
set @mess = (select fld_message_regional from  tbl_hrpen_msgcontent) 
                                      
if(@type = 'HOD')                      
set @mess = (select fld_message_hod from  tbl_hrpen_msgcontent )                            
                     
                      
select distinct @email=replace(email ,'/',',') from #regmail where fld_hod_no = @tag                       
                      
                      
declare @s as varchar(4000),@s1 as varchar(4000)                                                                                                                                
truncate table tbl_hr_pnddoc_attach                                                                                                                              
insert into tbl_hr_pnddoc_attach values ('Emp No','Emp Name','Designation','Departmentname','Region','Attnlocation','HOD NO','HOD Name','Hire Date','Pending Details','NCFM Status','Pan NO')                      
                                                                                                                             
insert into tbl_hr_pnddoc_attach                                                                                                             
select * from tbl_hr_pnddoc where fld_hod_no = @tag                                                                                                              
                                                                                                          
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  " select * from mis.upload.DBO.tbl_hr_pnddoc_attach" queryout '+'\\'+@server+'\d$\upload1\HR_Pen_Doc\HR\'+@tag+'.xls -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                               
set @s1= @s+''''                                                                                                                                               
exec(@s1)                                            
                    
declare @attach as varchar(1000)                                                                         
--set @attach='\\196.1.115.175\d$\upload1\HR_Pen_Doc\HR\'+@tag+'.xls'    
--print   @attach    
set @attach='\\'+@server+'\d$\upload1\HR_Pen_Doc\HR\'+@tag+'.xls'                                 
           
/*                                                      
exec msdb.dbo.sp_send_dbmail                                                                     
@recipients  = @email,                          
@profile_name = 'HRD',                                                
--@from ='Suhas.Supal@angeltrade.com',                                   
@body_format ='html',                    
@subject = 'Pending Joining Formalities/NCFM Certifications & PAN No. Updations',                                                                                                                                                   
@file_attachments =@attach,                     
@body =@mess                        
        
*/        
exec msdb.dbo.sp_send_dbmail         
@recipients  = @email,                                                      
--@recipients  = 'jagdish.kolhapure@angeltrade.com',            
--@copy_recipients    = @cc,        
@profile_name = 'HRD',                                  
@body_format ='html',                                                                                                                                                                    
@subject = 'Pending Joining Formalities/NCFM Certifications & PAN No. Updations',          
@file_attachments =@attach,          
@body =@mess                                                                                      
                        
                      
FETCH NEXT FROM email_hr                                                                      
INTO @tag                                                                                                          
END                              
CLOSE email_hr                                                                                                          
DEALLOCATE email_hr                             
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Cms_mail
-- --------------------------------------------------
CREATE proc [dbo].[USP_Sent_Cms_mail]                                    
as                                                      
/*    
set nocount on                                   
declare @chqamt as varchar(50)                                                      
declare @branch as varchar(100)                                                      
declare @cltname as varchar(100)                                                      
declare @bse as varchar(50)                                                      
declare @nse as varchar(50)                                                      
declare @fo as varchar(50)                                                      
declare @mcx as varchar(50)                                                      
declare @ncdx as varchar(50)                                                      
declare @time as varchar(50)                                                       
declare @msg as varchar(5000)                                                      
declare @Email as varchar(100)                                                         
declare @sql as varchar(500)                                                    
declare @s as varchar(500)                                                    
declare @s1 as varchar(500)                                                    
declare @file as varchar(500)                                                    
declare @file1 as varchar(500)                                                      
declare @file2 as varchar(500)                                                      
declare @count as varchar(10)                                                  
declare @count1 as varchar(10)                                                  
declare @cltcode as varchar(10)                                                
declare @Mark_amt as varchar(50)                                                 
declare @bank as varchar(50)                                                 
declare @cltemail as varchar(100)                        
declare @designation as varchar(50)                                            
declare @Cnt int                                                     
----------------------------------cms data--------------------------------------------                                                  
select cltcode,branch,subgroup,PARTY_NAME,chqamt,acdlcm_amt,acdlfo_amt,ablcm_amt,ncdx_amt,a.mcdx,maker,b.email,                                                
phone =                                                   
case when b.res_phone1 = '' then '' else b.res_phone1 + ' - ' end +                                                  
case when b.res_phone2 = '' then '' else b.res_phone2 + ' - ' end +                                                  
case when b.off_phone1 = '' then '' else b.off_phone1 + ' - ' end +                                                  
case when b.off_phone2 = '' then '' else b.off_phone2 + ' - ' end +                                                  
case when b.mobile_pager = '' then '' else b.mobile_pager end,                                                  
branch_cd = (case when left(maker,1) = 'B' then ' the Branch - ' + branch + ' on your behalf '                                                       
when left(maker,1) = 'S' then ' the Sub-broker - ' + subgroup  + ' on your behalf ' else ' you ' end),space(50) as Mark_amt,space(50) as Bank                                              
into #client_details from intranet.risk.dbo.cmsdata a inner join intranet.risk.dbo.client_details b on a.cltcode = b.cl_code and cltcode not in (select cltcode from intranet.risk.dbo.cms_online_marked)                                           
and chqamt > 0 and generated = 2 and subgroup not in ('BH','INS')                                          
                          
-- added by manesh to block mails to the clients who had requested funds transfer.                          
delete from #client_details where cltcode in (select cltcode from intranet.risk.dbo.cms_online_marked     
where isnull(chqmark,'Y')='N' and flag='A')                     
                          
/*and b.email <> ''*/                                                                                
--------------------------------------------------------------------------------------------                              
-- pcmsdata = mark Amt                                                
-- cmsdata = MOdified Amt                                                
                                              
select a.cltcode,mark=a.chqamt,modified=b.chqamt,b.maker,diff=a.chqamt-b.chqamt into #t from intranet.risk.dbo.pcmsdata a left outer join #client_details b on a.cltcode = b.cltcode                                                 
                          
update #client_details set Mark_amt = convert(varchar,#t.mark) from #t where #client_details.cltcode = #t.cltcode and #t.diff <> 0                                                 
                                              
update #client_details set Bank = (case when b.Hdfc = 'Y' then 'HDFC' else 'CITI' end) from intranet.risk.dbo.cmssb b inner join #client_details a on a.subgroup = b.sbtag                                              
                                                
                                                  
----------------------Case I----------------------                                                  
--select * from #client_details where email <> '' and branch not in (select branch from #client_details where email = '' group by branch)                                                  
                                                
---------------------------------branch mail id--------------------------------------------------                                     
--select branch_code,Email=lower(Email) into #branch_email from AngelNseCM.msajag.dbo.branch where branch_code in (select branch from #client_details  group by branch) and Email <> ''                                                            
                                
--select branch_cd as branch_code,Email=lower(Email) into #branch_email from [196.1.115.215].website.dbo.contact_final where email <> '' and branch_cd is not null                                 
select designation,branch_cd as branch_code,email into #branch_email from     
intranet.risk.dbo.emp_info where email <> '' and branch_cd is not null and designation in ('Branch Manager','Branch Head','Cluster Head')                            
                                
------------------------------------CLient Mail -------------------------------------------                                     
DECLARE cmsmail_cursor CURSOR FOR select chqamt=convert(varchar(50),chqamt),                                                      
branch_cd,                                        
ablcm_amt=convert(varchar(50),ablcm_amt),                                                      
acdlcm_amt=convert(varchar(50),acdlcm_amt),                                                      
acdlfo_amt=convert(varchar(50),acdlfo_amt),                                                      
mcdx=convert(varchar(50),mcdx),                                                      
ncdx_amt=convert(varchar(50),ncdx_amt),                                                      
maker=right(maker,22),party_name,cltcode,mark_amt,bank,email from #client_details where email <> ''                                               
OPEN cmsmail_cursor                                           
                                                                        
FETCH NEXT FROM cmsmail_cursor                                                                         
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                                                       
                                                                        
WHILE @@FETCH_STATUS = 0           
                                                                    
BEGIN                                                                         
                                            
if @Mark_amt = ''                                                
       
begin                                                
                                              
set @msg = 'Dear '+@cltname+',<br><br>         
This is to intimate you that a Payout Request for Rs. '+@chqamt+'/- has been given by '+@branch+' on '+@time+', details of which are as below.<br><br>                                               
<center>                                                      
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                       
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                                      
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                                      
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                                      
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                                      
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                              
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                                      
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                                      
</table></center><br>                                                      
The Payout has been requested in the form of cheque.The same will be processed and                                                   
delivered to your respective branch.<p> If there is any query related to the same please                                                       
get in touch with the respective Branch.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                                              
                  
                  
                                              
/*                    
if @bank = 'HDFC'                                              
 Begin                                              
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                               
 end                                              
else                                                
 begin                                              
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                        
 end                     
*/                    
                                               
end                                              
                                                
else                                                
                                                
begin                                                
                                              
set @msg = 'Dear '+@cltname+',<br><br>                                                      
This is to intimate you that a Payout Request for Rs. '+@mark_amt+'/- had been given by '+@branch+' on '+@time+' and a payout for Rs. '+@chqamt+'/- has been approved, details of which are as below.<br><br>                                                 
  
    
     
<center>                                                      
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                                      
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                                      
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                                      
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                                      
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                                      
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                 
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                                      
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                                      
</table></center><br>                                                      
The Payout has been requested in the form of cheque.The same will be processed and                  
delivered to your respective branch.<p> If there is any query related to the same please                                                       
get in touch with the respective Branch.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                                              
                    
/*                                             
                    
if @bank = 'HDFC'                                              
 Begin                                              
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                              
 end                                              
else                                                
 begin                                              
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                                      
 end                                
*/                    
                    
end                                              
                                                      
exec usp_AutoMail_CMS  @cltemail,@msg,@file                                               
--print @cltemail                                            
FETCH NEXT FROM cmsmail_cursor                                                                         
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                       
                                              
END                                                                        
                                                
CLOSE cmsmail_cursor                                                                        
DEALLOCATE cmsmail_cursor                                                              
                                              
-------------------------------cursor branch Mail --------------------------------                                                           
                                                  
DECLARE cmsbranchmail_cursor CURSOR FOR select designation,branch_code,Email from #branch_email where email <> ''                                                     
OPEN cmsbranchmail_cursor                                                    
                                                                      
FETCH NEXT FROM cmsbranchmail_cursor                                                    
INTO @designation,@branch,@Email                                                    
                                                                        
WHILE @@FETCH_STATUS = 0                                 
                                                 
BEGIN                                                                            
                                    
truncate table branch_cms                                                    
truncate table branch_without_email                                              
                                                  
insert into branch_cms                                                    
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                                                    
                                              
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+''
   
   
,''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                                                    
insert into branch_cms                                                    
exec(@sql)                                 
                                                  
set @file = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                                                     
                                                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                              
set @s1= @s+''''                                                              
exec(@s1)                                                                         
                                               
-------------------------------without email -----------------------------------------                                                  
                                                  
set @msg = 'Dear '+@designation+',<br><br>                                                  
<p>Please find attached the details of all the clients whose payout requests have been processed.                                               
You would be receiving cheques for the same for disbursement. If there are any query related to the same                                               
please get in touch with CSO - Banking.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                                                                        
                    
/*                    
<p><a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a> In case of HDFC</p>                             
<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a> In case of CITI</p>'                                                 
*/                    
                                              
set @count = (select count(*) from #client_details where email = '' and branch = @branch)                                                  
                                                  
if @count <> 0                                                   
                                                  
begin                                                   
truncate table branch_without_email                                                  
                                                  
insert into branch_without_email                                                  
select 'Client Code'+','+'Client Name'+','+'Phone No'                                      
                                                  
insert into branch_without_email                                              
select rtrim(ltrim(cltcode))+','+rtrim(ltrim(party_name))+','+rtrim(ltrim(phone)) from #client_details where email = '' and branch = @branch                                                  
                   
                    
             
set @file1 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'no_email.csv'                                                      
                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_without_email " queryout '+@file1+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                              
set @s1= @s+''''                                                              
exec(@s1)                                                   
                                
set @file2 = @file+';'+@file1+';'+'D:\upload1\cms\ECN consent.Doc'                                                                 
                                                  
set @msg = @msg+'                                                  
<p><B>Please note - </B>Henceforth email id would be compulsory for all E-Broking clients and all clients who are using fund payout facility, as all communication will be done online on this registered email id.</p>                                        
  
    
     
        
           
<p>Attached is the list of clients whose email ids are not registered with us and because of which we are not able to send the payout confirmation mail. Please update the KYC department with the email ids of these clients through the attached ECN Consent 
  
    
      
        
          
            
             
                 
                 
                     
                      
                        
                          
document.</p>'                                                  
end                                                  
                                                  
Else                                                  
                                                  
begin                                                  
                                                  
truncate table branch_cms                                                    
                                                  
insert into branch_cms                                                    
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                                                    
                                                  
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'',
  
''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                                                    
insert into branch_cms                                                    
exec(@sql)                                                    
                                                  
set @file2 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                                                     
                                                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                              
set @s1= @s+''''                                                              
exec(@s1)                                                                 
                         
end                                       
                                                  
set @msg = @msg+'Attached:<br><br>                                                  
1. Payout Request Details. <br>'                                                  
                                                  
if @count <> 0                                                   
                                                  
begin                                                  
set @msg = @msg+'2. List of clients whose email ids are not registered with us. <br>                                  
3. ECN Consent form '                   
end                                                      
                                                  
set @msg = @msg+'<br><br>Regards,<br><br><br>Angel Banking - CSO'                                                  
    
SELECT  @cnt = count(*) FROM MIS.upload.DBO.branch_cms group by jv  
  
if @cnt >1   
begin                                                  
 exec usp_AutoMail_CMS @Email,@msg,@file2                                                  
end    
    
    
--print @Email                                            
FETCH NEXT FROM cmsbranchmail_cursor                           
INTO @designation,@branch,@Email                                                    
                                                  
END                                                                        
                                                                        
CLOSE cmsbranchmail_cursor                                                  
DEALLOCATE cmsbranchmail_cursor                                                
  */            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Cms_mail_bak
-- --------------------------------------------------
CREATE proc USP_Sent_Cms_mail_bak              
as                                
                        
declare @chqamt as varchar(50)                                
declare @branch as varchar(100)                                
declare @cltname as varchar(100)                                
declare @bse as varchar(50)                                
declare @nse as varchar(50)                                
declare @fo as varchar(50)                                
declare @mcx as varchar(50)                                
declare @ncdx as varchar(50)                                
declare @time as varchar(50)                                 
declare @msg as varchar(5000)                                
declare @Email as varchar(100)                                   
declare @sql as varchar(500)                              
declare @s as varchar(500)                              
declare @s1 as varchar(500)                              
declare @file as varchar(500)                              
declare @file1 as varchar(500)                                
declare @file2 as varchar(500)                                
declare @count as varchar(10)                            
declare @count1 as varchar(10)                            
declare @cltcode as varchar(10)                          
declare @Mark_amt as varchar(50)                           
declare @bank as varchar(50)                           
declare @cltemail as varchar(100)                         
                              
----------------------------------cms data--------------------------------------------                            
select cltcode,branch,subgroup,PARTY_NAME,chqamt,acdlcm_amt,acdlfo_amt,ablcm_amt,ncdx_amt,a.mcdx,maker,b.email,                          
phone =                             
case when b.res_phone1 = '' then '' else b.res_phone1 + ' - ' end +                            
case when b.res_phone2 = '' then '' else b.res_phone2 + ' - ' end +                            
case when b.off_phone1 = '' then '' else b.off_phone1 + ' - ' end +                            
case when b.off_phone2 = '' then '' else b.off_phone2 + ' - ' end +                            
case when b.mobile_pager = '' then '' else b.mobile_pager end,                            
branch_cd = (case when left(maker,1) = 'B' then ' the Branch - ' + branch + ' on your behalf '                                 
when left(maker,1) = 'S' then ' the Sub-broker - ' + subgroup  + ' on your behalf ' else ' you ' end),space(50) as Mark_amt,space(50) as Bank                        
into #client_details from intranet.risk.dbo.cmsdata a inner join intranet.risk.dbo.client_details b on a.cltcode = b.cl_code and cltcode not in (select party_code from  intranet.risk.dbo.RTGS_IFSC_Master)                     
and chqamt > 0 and generated = 2 and subgroup not in ('BH','INS')                    
    
-- added by manesh to block mails to the clients who had requested funds transfer.    
delete from #client_details where cltcode in (select cltcode from intranet.risk.dbo.cms_online_marked where isnull(chqmark,'Y')='N' and flag='A')    
    
    
/*and b.email <> ''*/                                
                         
--------------------------------------------------------------------------------------------                          
-- pcmsdata = mark Amt                          
-- cmsdata = MOdified Amt                          
                        
select a.cltcode,mark=a.chqamt,modified=b.chqamt,b.maker,diff=a.chqamt-b.chqamt into #t from intranet.risk.dbo.pcmsdata a left outer join #client_details b on a.cltcode = b.cltcode                           
                          
update #client_details set Mark_amt = convert(varchar,#t.mark) from #t where #client_details.cltcode = #t.cltcode and #t.diff <> 0                           
                        
update #client_details set Bank = (case when b.Hdfc = 'Y' then 'HDFC' else 'CITI' end) from intranet.risk.dbo.cmssb b inner join #client_details a on a.subgroup = b.sbtag                        
                          
                            
----------------------Case I----------------------                            
--select * from #client_details where email <> '' and branch not in (select branch from #client_details where email = '' group by branch)                            
                          
---------------------------------branch mail id--------------------------------------------------               
--select branch_code,Email=lower(Email) into #branch_email from anand1.msajag.dbo.branch where branch_code in (select branch from #client_details  group by branch) and Email <> ''                                      
          
--select branch_cd as branch_code,Email=lower(Email) into #branch_email from [196.1.115.215].website.dbo.contact_final where email <> '' and branch_cd is not null           
select branch_cd as branch_code,email into #branch_email from intranet.risk.dbo.emp_info where email <> '' and branch_cd is not null and designation in ('Branch Manager','Branch Head')      
          
------------------------------------CLient Mail -------------------------------------------               
DECLARE cmsmail_cursor CURSOR FOR select chqamt=convert(varchar(50),chqamt),                                
branch_cd,                  
ablcm_amt=convert(varchar(50),ablcm_amt),                                
acdlcm_amt=convert(varchar(50),acdlcm_amt),                                
acdlfo_amt=convert(varchar(50),acdlfo_amt),                                
mcdx=convert(varchar(50),mcdx),                                
ncdx_amt=convert(varchar(50),ncdx_amt),                                
maker=right(maker,22),party_name,cltcode,mark_amt,bank,email from #client_details where email <> ''                         
OPEN cmsmail_cursor                     
                                                  
FETCH NEXT FROM cmsmail_cursor                                                   
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                                 
                                                  
WHILE @@FETCH_STATUS = 0                            
                                              
BEGIN                                                   
                          
if @Mark_amt = ''                          
                          
begin                          
                        
set @msg = 'Dear '+@cltname+',<br><br>                                
This is to intimate you that a Payout Request for Rs. '+@chqamt+'/- has been given by '+@branch+' on '+@time+', details of which are as below.<br><br>                                
<center>                                
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                                
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                
</table></center><br>                                
The Payout has been requested in the form of cheque.The same will be processed and                                 
delivered to your respective branch.<p> If there is any query related to the same please                                 
get in touch with the respective Branch or mail your queries to'                        
                        
if @bank = 'HDFC'                        
 Begin                        
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                         
 end                        
else                          
 begin                        
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                  
 end                          
end                        
                          
else                          
                          
begin                          
                        
set @msg = 'Dear '+@cltname+',<br><br>                                
This is to intimate you that a Payout Request for Rs. '+@mark_amt+'/- had been given by '+@branch+' on '+@time+' and a payout for Rs. '+@chqamt+'/- has been approved, details of which are as below.<br><br>                                
<center>                                
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                                
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                
</table></center><br>                                
The Payout has been requested in the form of cheque.The same will be processed and                                 
delivered to your respective branch.<p> If there is any query related to the same please                                 
get in touch with the respective Branch or mail your queries to</p>'                         
                        
if @bank = 'HDFC'                        
 Begin                        
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                        
 end                        
else                          
 begin                        
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                
 end            end                        
                                
exec usp_AutoMail_CMS  @cltemail,@msg,@file                                
--print @cltemail                      
FETCH NEXT FROM cmsmail_cursor                                                   
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                   
                        
END                                                  
                          
CLOSE cmsmail_cursor                                                  
DEALLOCATE cmsmail_cursor                                        
                        
-------------------------------cursor branch Mail --------------------------------                                     
                            
DECLARE cmsbranchmail_cursor CURSOR FOR select branch_code,Email from #branch_email where email <> ''                               
OPEN cmsbranchmail_cursor                              
                                                
FETCH NEXT FROM cmsbranchmail_cursor                              
INTO @branch,@Email                              
                                                  
WHILE @@FETCH_STATUS = 0           
                           
BEGIN                                                      
              
truncate table branch_cms                              
truncate table branch_without_email                            
                            
insert into branch_cms                              
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                              
                            
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+''
   
   
,''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                              
insert into branch_cms                              
exec(@sql)                              
                            
set @file = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                               
                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Usa -Pnirwan612'                                        
set @s1= @s+''''                                        
exec(@s1)                                                   
                         
-------------------------------without email -----------------------------------------                            
                            
set @msg = 'Dear BM,<br><br>                            
<p>Please find attached the details of all the clients whose payout requests have been processed.                         
You would be receiving cheques for the same for disbursement. If there are any query related to the same                         
please get in touch with CSO - Banking or mail your  queries to</p>                         
<p><a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a> In case of HDFC</p>                        
<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a> In case of CITI</p>'                           
                        
set @count = (select count(*) from #client_details where email = '' and branch = @branch)                            
                            
if @count <> 0                             
                            
begin                             
truncate table branch_without_email                            
                            
insert into branch_without_email                            
select 'Client Code'+','+'Client Name'+','+'Phone No'                            
                            
insert into branch_without_email                        
select rtrim(ltrim(cltcode))+','+rtrim(ltrim(party_name))+','+rtrim(ltrim(phone)) from #client_details where email = '' and branch = @branch                            
                            
set @file1 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'no_email.csv'                                
                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_without_email " queryout '+@file1+' -c -SMIS -Usa -Pnirwan612'                                        
set @s1= @s+''''                                        
exec(@s1)                             
                            
set @file2 = @file+';'+@file1+';'+'D:\upload1\cms\ECN consent.doc'                                           
                            
set @msg = @msg+'                            
<p><B>Please note - </B>Henceforth email id would be compulsory for all E-Broking clients and all clients who are using fund payout facility, as all communication will be done online on this registered email id.</p>                            
<p>Attached is the list of clients whose email ids are not registered with us and because of which we are not able to send the payout confirmation mail. Please update the KYC department with the email ids of these clients through the attached ECN Consent 
  
    
document.</p>'                            
end                            
                            
Else                            
                            
begin                            
                            
truncate table branch_cms                              
                            
insert into branch_cms                              
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                              
                            
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'',
  
    
''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                              
insert into branch_cms                              
exec(@sql)                              
                            
set @file2 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                               
                            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Usa -Pnirwan612'                                        
set @s1= @s+''''                                        
exec(@s1)                                           
                            
end                 
                            
set @msg = @msg+'Attached:<br><br>                            
1. Payout Request Details. <br>'                            
                            
if @count <> 0                             
                            
begin                            
set @msg = @msg+'2. List of clients whose email ids are not registered with us. <br>                            
3. ECN Consent form '                            
end                                
                            
set @msg = @msg+'<br><br>Regards,<br><br><br>Angel Banking - CSO'                            
                            
exec usp_AutoMail_CMS @Email,@msg,@file2                            
--print @Email                      
FETCH NEXT FROM cmsbranchmail_cursor                            
INTO @branch,@Email                              
                            
END                                                  
                                                  
CLOSE cmsbranchmail_cursor                            
DEALLOCATE cmsbranchmail_cursor

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Cms_mail_bkp_March_11_2010
-- --------------------------------------------------
CREATE proc USP_Sent_Cms_mail_bkp_March_11_2010
as

set nocount on
declare @chqamt as varchar(50)
declare @branch as varchar(100)
declare @cltname as varchar(100)
declare @bse as varchar(50)
declare @nse as varchar(50)
declare @fo as varchar(50)
declare @mcx as varchar(50)
declare @ncdx as varchar(50)
declare @time as varchar(50)
declare @msg as varchar(5000)
declare @Email as varchar(100)
declare @sql as varchar(500)
declare @s as varchar(500)
declare @s1 as varchar(500)
declare @file as varchar(500)
declare @file1 as varchar(500)
declare @file2 as varchar(500)
declare @count as varchar(10)
declare @count1 as varchar(10)
declare @cltcode as varchar(10)
declare @Mark_amt as varchar(50)
declare @bank as varchar(50)
declare @cltemail as varchar(100)
declare @designation as varchar(50)

----------------------------------cms data--------------------------------------------
select cltcode,branch,subgroup,PARTY_NAME,chqamt,acdlcm_amt,acdlfo_amt,ablcm_amt,ncdx_amt,a.mcdx,maker,b.email,
phone =
case when b.res_phone1 = '' then '' else b.res_phone1 + ' - ' end +
case when b.res_phone2 = '' then '' else b.res_phone2 + ' - ' end +
case when b.off_phone1 = '' then '' else b.off_phone1 + ' - ' end +
case when b.off_phone2 = '' then '' else b.off_phone2 + ' - ' end +
case when b.mobile_pager = '' then '' else b.mobile_pager end,
branch_cd = (case when left(maker,1) = 'B' then ' the Branch - ' + branch + ' on your behalf '
when left(maker,1) = 'S' then ' the Sub-broker - ' + subgroup + ' on your behalf ' else ' you ' end),space(50) as Mark_amt,space(50) as Bank
into #client_details from intranet.risk.dbo.cmsdata a inner join intranet.risk.dbo.client_details b on a.cltcode = b.cl_code and cltcode not in (select cltcode from intranet.risk.dbo.cms_online_marked)
and chqamt > 0 and generated = 2 and subgroup not in ('BH','INS')

-- added by manesh to block mails to the clients who had requested funds transfer.
delete from #client_details where cltcode in (select cltcode from intranet.risk.dbo.cms_online_marked
where isnull(chqmark,'Y')='N' and flag='A')

/*and b.email <> ''*/
--------------------------------------------------------------------------------------------
-- pcmsdata = mark Amt
-- cmsdata = MOdified Amt

select a.cltcode,mark=a.chqamt,modified=b.chqamt,b.maker,diff=a.chqamt-b.chqamt into #t from intranet.risk.dbo.pcmsdata a left outer join #client_details b on a.cltcode = b.cltcode

update #client_details set Mark_amt = convert(varchar,#t.mark) from #t where #client_details.cltcode = #t.cltcode and #t.diff <> 0

update #client_details set Bank = (case when b.Hdfc = 'Y' then 'HDFC' else 'CITI' end) from intranet.risk.dbo.cmssb b inner join #client_details a on a.subgroup = b.sbtag


----------------------Case I----------------------
--select * from #client_details where email <> '' and branch not in (select branch from #client_details where email = '' group by branch)

---------------------------------branch mail id--------------------------------------------------
--select branch_code,Email=lower(Email) into #branch_email from anand1.msajag.dbo.branch where branch_code in (select branch from #client_details group by branch) and Email <> ''

--select branch_cd as branch_code,Email=lower(Email) into #branch_email from [196.1.115.215].website.dbo.contact_final where email <> '' and branch_cd is not null
select designation,branch_cd as branch_code,email into #branch_email from
intranet.risk.dbo.emp_info where email <> '' and branch_cd is not null and designation in ('Branch Manager','Branch Head','Cluster Head')

------------------------------------CLient Mail -------------------------------------------
DECLARE cmsmail_cursor CURSOR FOR select chqamt=convert(varchar(50),chqamt),
branch_cd,
ablcm_amt=convert(varchar(50),ablcm_amt),
acdlcm_amt=convert(varchar(50),acdlcm_amt),
acdlfo_amt=convert(varchar(50),acdlfo_amt),
mcdx=convert(varchar(50),mcdx),
ncdx_amt=convert(varchar(50),ncdx_amt),
maker=right(maker,22),party_name,cltcode,mark_amt,bank,email from #client_details where email <> ''
OPEN cmsmail_cursor

FETCH NEXT FROM cmsmail_cursor
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail

WHILE @@FETCH_STATUS = 0

BEGIN

if @Mark_amt = ''

begin

set @msg = 'Dear '+@cltname+',<br><br>
This is to intimate you that a Payout Request for Rs. '+@chqamt+'/- has been given by '+@branch+' on '+@time+', details of which are as below.<br><br>
<center>
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>
</table></center><br>
The Payout has been requested in the form of cheque.The same will be processed and
delivered to your respective branch.<p> If there is any query related to the same please
get in touch with the respective Branch.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'



/*
if @bank = 'HDFC'
Begin
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'
end
else
begin
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'
end
*/

end

else

begin

set @msg = 'Dear '+@cltname+',<br><br>
This is to intimate you that a Payout Request for Rs. '+@mark_amt+'/- had been given by '+@branch+' on '+@time+' and a payout for Rs. '+@chqamt+'/- has been approved, details of which are as below.<br><br>


<center>
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>
</table></center><br>
The Payout has been requested in the form of cheque.The same will be processed and
delivered to your respective branch.<p> If there is any query related to the same please
get in touch with the respective Branch.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'

/*

if @bank = 'HDFC'
Begin
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'
end
else
begin
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'
end
*/

end

exec usp_AutoMail_CMS @cltemail,@msg,@file
--print @cltemail
FETCH NEXT FROM cmsmail_cursor
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail

END

CLOSE cmsmail_cursor
DEALLOCATE cmsmail_cursor

-------------------------------cursor branch Mail --------------------------------

DECLARE cmsbranchmail_cursor CURSOR FOR select designation,branch_code,Email from #branch_email where email <> ''
OPEN cmsbranchmail_cursor

FETCH NEXT FROM cmsbranchmail_cursor
INTO @designation,@branch,@Email

WHILE @@FETCH_STATUS = 0

BEGIN

truncate table branch_cms
truncate table branch_without_email

insert into branch_cms
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'

set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+''

,''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''
insert into branch_cms
exec(@sql)

set @file = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'

set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Usa -Pnirwan612'
set @s1= @s+''''
exec(@s1)

-------------------------------without email -----------------------------------------

set @msg = 'Dear '+@designation+',<br><br>
<p>Please find attached the details of all the clients whose payout requests have been processed.
You would be receiving cheques for the same for disbursement. If there are any query related to the same
please get in touch with CSO - Banking.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'

/*
<p><a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a> In case of HDFC</p>
<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a> In case of CITI</p>'
*/

set @count = (select count(*) from #client_details where email = '' and branch = @branch)

if @count <> 0

begin
truncate table branch_without_email

insert into branch_without_email
select 'Client Code'+','+'Client Name'+','+'Phone No'

insert into branch_without_email
select rtrim(ltrim(cltcode))+','+rtrim(ltrim(party_name))+','+rtrim(ltrim(phone)) from #client_details where email = '' and branch = @branch



set @file1 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'no_email.csv'

set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp "SELECT jv FROM MIS.upload.DBO.branch_without_email " queryout '+@file1+' -c -SMIS -Usa -Pnirwan612'
set @s1= @s+''''
exec(@s1)

set @file2 = @file+';'+@file1+';'+'D:\upload1\cms\ECN consent.Doc'

set @msg = @msg+'
<p><B>Please note - </B>Henceforth email id would be compulsory for all E-Broking clients and all clients who are using fund payout facility, as all communication will be done online on this registered email id.</p>




<p>Attached is the list of clients whose email ids are not registered with us and because of which we are not able to send the payout confirmation mail. Please update the KYC department with the email ids of these clients through the attached ECN Consent












document.</p>'
end

Else

begin

truncate table branch_cms

insert into branch_cms
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'

set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'',
''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''
insert into branch_cms
exec(@sql)

set @file2 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'

set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Usa -Pnirwan612'
set @s1= @s+''''
exec(@s1)

end

set @msg = @msg+'Attached:<br><br>
1. Payout Request Details. <br>'

if @count <> 0

begin
set @msg = @msg+'2. List of clients whose email ids are not registered with us. <br>
3. ECN Consent form '
end

set @msg = @msg+'<br><br>Regards,<br><br><br>Angel Banking - CSO'

if (SELECT count(*) FROM MIS.upload.DBO.branch_cms group by jv) > 1

begin
exec usp_AutoMail_CMS @Email,@msg,@file2
end


--print @Email
FETCH NEXT FROM cmsbranchmail_cursor
INTO @designation,@branch,@Email

END

CLOSE cmsbranchmail_cursor
DEALLOCATE cmsbranchmail_cursor

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Cms_mail_bkp_march112010
-- --------------------------------------------------
CREATE proc USP_Sent_Cms_mail_bkp_march112010
as                                                    
  
set nocount on                                 
declare @chqamt as varchar(50)                                                    
declare @branch as varchar(100)                                                    
declare @cltname as varchar(100)                                                    
declare @bse as varchar(50)                                                    
declare @nse as varchar(50)                                                    
declare @fo as varchar(50)                                                    
declare @mcx as varchar(50)                                                    
declare @ncdx as varchar(50)                                                    
declare @time as varchar(50)                                                     
declare @msg as varchar(5000)                                                    
declare @Email as varchar(100)                                                       
declare @sql as varchar(500)                                                  
declare @s as varchar(500)                                                  
declare @s1 as varchar(500)                                                  
declare @file as varchar(500)                                                  
declare @file1 as varchar(500)                                                    
declare @file2 as varchar(500)                                                    
declare @count as varchar(10)                                                
declare @count1 as varchar(10)                                                
declare @cltcode as varchar(10)                                              
declare @Mark_amt as varchar(50)                                               
declare @bank as varchar(50)                                               
declare @cltemail as varchar(100)                      
declare @designation as varchar(50)                                          
                                                  
----------------------------------cms data--------------------------------------------                                                
select cltcode,branch,subgroup,PARTY_NAME,chqamt,acdlcm_amt,acdlfo_amt,ablcm_amt,ncdx_amt,a.mcdx,maker,b.email,                                              
phone =                                                 
case when b.res_phone1 = '' then '' else b.res_phone1 + ' - ' end +                                                
case when b.res_phone2 = '' then '' else b.res_phone2 + ' - ' end +                                                
case when b.off_phone1 = '' then '' else b.off_phone1 + ' - ' end +                                                
case when b.off_phone2 = '' then '' else b.off_phone2 + ' - ' end +                                                
case when b.mobile_pager = '' then '' else b.mobile_pager end,                                                
branch_cd = (case when left(maker,1) = 'B' then ' the Branch - ' + branch + ' on your behalf '                                                     
when left(maker,1) = 'S' then ' the Sub-broker - ' + subgroup  + ' on your behalf ' else ' you ' end),space(50) as Mark_amt,space(50) as Bank                                            
into #client_details from intranet.risk.dbo.cmsdata a inner join intranet.risk.dbo.client_details b on a.cltcode = b.cl_code and cltcode not in (select cltcode from intranet.risk.dbo.cms_online_marked)                                         
and chqamt > 0 and generated = 2 and subgroup not in ('BH','INS')                                        
                        
-- added by manesh to block mails to the clients who had requested funds transfer.                        
delete from #client_details where cltcode in (select cltcode from intranet.risk.dbo.cms_online_marked   
where isnull(chqmark,'Y')='N' and flag='A')                   
                        
/*and b.email <> ''*/                                                                              
--------------------------------------------------------------------------------------------                            
-- pcmsdata = mark Amt                                              
-- cmsdata = MOdified Amt                                              
                                            
select a.cltcode,mark=a.chqamt,modified=b.chqamt,b.maker,diff=a.chqamt-b.chqamt into #t from intranet.risk.dbo.pcmsdata a left outer join #client_details b on a.cltcode = b.cltcode                                               
                        
update #client_details set Mark_amt = convert(varchar,#t.mark) from #t where #client_details.cltcode = #t.cltcode and #t.diff <> 0                                               
                                            
update #client_details set Bank = (case when b.Hdfc = 'Y' then 'HDFC' else 'CITI' end) from intranet.risk.dbo.cmssb b inner join #client_details a on a.subgroup = b.sbtag                                            
                                              
                                                
----------------------Case I----------------------                                                
--select * from #client_details where email <> '' and branch not in (select branch from #client_details where email = '' group by branch)                                                
                                              
---------------------------------branch mail id--------------------------------------------------                                   
--select branch_code,Email=lower(Email) into #branch_email from anand1.msajag.dbo.branch where branch_code in (select branch from #client_details  group by branch) and Email <> ''                                                          
                              
--select branch_cd as branch_code,Email=lower(Email) into #branch_email from [196.1.115.215].website.dbo.contact_final where email <> '' and branch_cd is not null                               
select designation,branch_cd as branch_code,email into #branch_email from   
intranet.risk.dbo.emp_info where email <> '' and branch_cd is not null and designation in ('Branch Manager','Branch Head','Cluster Head')                          
                              
------------------------------------CLient Mail -------------------------------------------                                   
DECLARE cmsmail_cursor CURSOR FOR select chqamt=convert(varchar(50),chqamt),                                                    
branch_cd,                                      
ablcm_amt=convert(varchar(50),ablcm_amt),                                                    
acdlcm_amt=convert(varchar(50),acdlcm_amt),                                                    
acdlfo_amt=convert(varchar(50),acdlfo_amt),                                                    
mcdx=convert(varchar(50),mcdx),                                                    
ncdx_amt=convert(varchar(50),ncdx_amt),                                                    
maker=right(maker,22),party_name,cltcode,mark_amt,bank,email from #client_details where email <> ''                                             
OPEN cmsmail_cursor                                         
                                                                      
FETCH NEXT FROM cmsmail_cursor                                                                       
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                                                     
                                                                      
WHILE @@FETCH_STATUS = 0                                                
                                                                  
BEGIN                                                                       
                                          
if @Mark_amt = ''                                              
     
begin                                              
                                            
set @msg = 'Dear '+@cltname+',<br><br>       
This is to intimate you that a Payout Request for Rs. '+@chqamt+'/- has been given by '+@branch+' on '+@time+', details of which are as below.<br><br>                                             
<center>                                                    
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                     
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                                    
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                                    
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                                    
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                                    
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                            
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                                    
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                                    
</table></center><br>                                                    
The Payout has been requested in the form of cheque.The same will be processed and                                                 
delivered to your respective branch.<p> If there is any query related to the same please                                                     
get in touch with the respective Branch.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                                            
                
                
                                            
/*                  
if @bank = 'HDFC'                                            
 Begin                                            
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                             
 end                                            
else                                              
 begin                                            
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                      
 end                   
*/                  
                                             
end                                            
                                              
else                                              
                                              
begin                                              
                                            
set @msg = 'Dear '+@cltname+',<br><br>                                                    
This is to intimate you that a Payout Request for Rs. '+@mark_amt+'/- had been given by '+@branch+' on '+@time+' and a payout for Rs. '+@chqamt+'/- has been approved, details of which are as below.<br><br>                                                 
  
   
<center>                                                    
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                                    
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                                    
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                                    
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                                    
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                                    
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>               
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                                    
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                                    
</table></center><br>                                                    
The Payout has been requested in the form of cheque.The same will be processed and                
delivered to your respective branch.<p> If there is any query related to the same please                                                     
get in touch with the respective Branch.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                                            
                  
/*                                           
                  
if @bank = 'HDFC'                                            
 Begin                                            
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                            
 end                                            
else                                              
 begin                                            
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                                    
 end                              
*/                  
                  
end                                            
                                                    
exec usp_AutoMail_CMS  @cltemail,@msg,@file                                             
--print @cltemail                                          
FETCH NEXT FROM cmsmail_cursor                                                                       
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                     
                                            
END                                                                      
                                              
CLOSE cmsmail_cursor                                                                      
DEALLOCATE cmsmail_cursor                                                            
                                            
-------------------------------cursor branch Mail --------------------------------                                                         
                                                
DECLARE cmsbranchmail_cursor CURSOR FOR select designation,branch_code,Email from #branch_email where email <> ''                                                   
OPEN cmsbranchmail_cursor                                                  
                                                                    
FETCH NEXT FROM cmsbranchmail_cursor                                                  
INTO @designation,@branch,@Email                                                  
                                                                      
WHILE @@FETCH_STATUS = 0                               
                                               
BEGIN                                                                          
                                  
truncate table branch_cms                                                  
truncate table branch_without_email                                                
                                                
insert into branch_cms                                                  
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                                                  
                                            
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'' 
 
,''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                                                  
insert into branch_cms                                                  
exec(@sql)                               
                                                
set @file = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                                                   
                                                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Usa -Pnirwan612'                                                            
set @s1= @s+''''                                                            
exec(@s1)                                                                       
                                             
-------------------------------without email -----------------------------------------                                                
                                                
set @msg = 'Dear '+@designation+',<br><br>                                                
<p>Please find attached the details of all the clients whose payout requests have been processed.                                             
You would be receiving cheques for the same for disbursement. If there are any query related to the same                                             
please get in touch with CSO - Banking.<br><br>This is a system generated mail ; Please dont send your queries to this id.</p>Regards,<br><br>Angel Banking'                                                                      
                  
/*                  
<p><a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a> In case of HDFC</p>                           
<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a> In case of CITI</p>'                                               
*/                  
                                            
set @count = (select count(*) from #client_details where email = '' and branch = @branch)                                                
                                                
if @count <> 0                                                 
                                                
begin                                                 
truncate table branch_without_email                                                
                                                
insert into branch_without_email                                                
select 'Client Code'+','+'Client Name'+','+'Phone No'                                    
                                                
insert into branch_without_email                                            
select rtrim(ltrim(cltcode))+','+rtrim(ltrim(party_name))+','+rtrim(ltrim(phone)) from #client_details where email = '' and branch = @branch                                                
                 
                  
           
set @file1 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'no_email.csv'                                                    
                                                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_without_email " queryout '+@file1+' -c -SMIS -Usa -Pnirwan612'                                                            
set @s1= @s+''''                                                            
exec(@s1)                                                 
                              
set @file2 = @file+';'+@file1+';'+'D:\upload1\cms\ECN consent.Doc'                                                               
                                                
set @msg = @msg+'                                                
<p><B>Please note - </B>Henceforth email id would be compulsory for all E-Broking clients and all clients who are using fund payout facility, as all communication will be done online on this registered email id.</p>                                        
  
   
      
         
<p>Attached is the list of clients whose email ids are not registered with us and because of which we are not able to send the payout confirmation mail. Please update the KYC department with the email ids of these clients through the attached ECN Consent 
  
    
      
        
          
           
               
               
                   
                    
                      
                        
document.</p>'                                                
end                                                
                                                
Else                                                
                                                
begin                                                
                                                
truncate table branch_cms                                                  
                                                
insert into branch_cms                                                  
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                                                  
                                                
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'',
''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                                                  
insert into branch_cms                                                  
exec(@sql)                                                  
                                                
set @file2 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                                                   
                                                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Usa -Pnirwan612'                                                            
set @s1= @s+''''                                                            
exec(@s1)                                                               
                       
end                                     
                                                
set @msg = @msg+'Attached:<br><br>                                                
1. Payout Request Details. <br>'                                                
                                                
if @count <> 0                                                 
                                                
begin                                                
set @msg = @msg+'2. List of clients whose email ids are not registered with us. <br>                                
3. ECN Consent form '                                                
end                                                    
                                                
set @msg = @msg+'<br><br>Regards,<br><br><br>Angel Banking - CSO'                                                
  
if (SELECT count(*) FROM MIS.upload.DBO.branch_cms group by jv)  > 1  
  
begin                                                
 exec usp_AutoMail_CMS @Email,@msg,@file2                                                
end  
  
  
--print @Email                                          
FETCH NEXT FROM cmsbranchmail_cursor                         
INTO @designation,@branch,@Email                                                  
                                                
END                                                                      
                                                                      
CLOSE cmsbranchmail_cursor                                                
DEALLOCATE cmsbranchmail_cursor                                              
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Cms_mail_old
-- --------------------------------------------------
CREATE proc [dbo].[USP_Sent_Cms_mail_old]                
as                                  
                          
declare @chqamt as varchar(50)                                  
declare @branch as varchar(100)                                  
declare @cltname as varchar(100)                                  
declare @bse as varchar(50)                                  
declare @nse as varchar(50)                                  
declare @fo as varchar(50)                                  
declare @mcx as varchar(50)                                  
declare @ncdx as varchar(50)                                  
declare @time as varchar(50)                                   
declare @msg as varchar(5000)                                  
declare @Email as varchar(100)                                     
declare @sql as varchar(500)                                
declare @s as varchar(500)                                
declare @s1 as varchar(500)                                
declare @file as varchar(500)                                
declare @file1 as varchar(500)                                  
declare @file2 as varchar(500)                                  
declare @count as varchar(10)                              
declare @count1 as varchar(10)                              
declare @cltcode as varchar(10)                            
declare @Mark_amt as varchar(50)                             
declare @bank as varchar(50)                             
declare @cltemail as varchar(100)    
declare @designation as varchar(50)                        
                                
----------------------------------cms data--------------------------------------------                              
select cltcode,branch,subgroup,PARTY_NAME,chqamt,acdlcm_amt,acdlfo_amt,ablcm_amt,ncdx_amt,a.mcdx,maker,b.email,                            
phone =                               
case when b.res_phone1 = '' then '' else b.res_phone1 + ' - ' end +                              
case when b.res_phone2 = '' then '' else b.res_phone2 + ' - ' end +                              
case when b.off_phone1 = '' then '' else b.off_phone1 + ' - ' end +                              
case when b.off_phone2 = '' then '' else b.off_phone2 + ' - ' end +                              
case when b.mobile_pager = '' then '' else b.mobile_pager end,                              
branch_cd = (case when left(maker,1) = 'B' then ' the Branch - ' + branch + ' on your behalf '                                   
when left(maker,1) = 'S' then ' the Sub-broker - ' + subgroup  + ' on your behalf ' else ' you ' end),space(50) as Mark_amt,space(50) as Bank                          
into #client_details from intranet.risk.dbo.cmsdata a inner join intranet.risk.dbo.client_details b on a.cltcode = b.cl_code and cltcode not in (select party_code from  intranet.risk.dbo.RTGS_IFSC_Master)                       
and chqamt > 0 and generated = 2 and subgroup not in ('BH','INS')                      
      
-- added by manesh to block mails to the clients who had requested funds transfer.      
delete from #client_details where cltcode in (select cltcode from intranet.risk.dbo.cms_online_marked where isnull(chqmark,'Y')='N' and flag='A')      
      
      
/*and b.email <> ''*/                                  
                           
--------------------------------------------------------------------------------------------                            
-- pcmsdata = mark Amt                            
-- cmsdata = MOdified Amt                            
                          
select a.cltcode,mark=a.chqamt,modified=b.chqamt,b.maker,diff=a.chqamt-b.chqamt into #t from intranet.risk.dbo.pcmsdata a left outer join #client_details b on a.cltcode = b.cltcode                             
                            
update #client_details set Mark_amt = convert(varchar,#t.mark) from #t where #client_details.cltcode = #t.cltcode and #t.diff <> 0                             
                          
update #client_details set Bank = (case when b.Hdfc = 'Y' then 'HDFC' else 'CITI' end) from intranet.risk.dbo.cmssb b inner join #client_details a on a.subgroup = b.sbtag                          
                            
                              
----------------------Case I----------------------                              
--select * from #client_details where email <> '' and branch not in (select branch from #client_details where email = '' group by branch)                              
                            
---------------------------------branch mail id--------------------------------------------------                 
--select branch_code,Email=lower(Email) into #branch_email from AngelNseCM.msajag.dbo.branch where branch_code in (select branch from #client_details  group by branch) and Email <> ''                                        
            
--select branch_cd as branch_code,Email=lower(Email) into #branch_email from [196.1.115.215].website.dbo.contact_final where email <> '' and branch_cd is not null             
select designation,branch_cd as branch_code,email into #branch_email from intranet.risk.dbo.emp_info where email <> '' and branch_cd is not null and designation in ('Branch Manager','Branch Head','Cluster Head')        
            
------------------------------------CLient Mail -------------------------------------------                 
DECLARE cmsmail_cursor CURSOR FOR select chqamt=convert(varchar(50),chqamt),                                  
branch_cd,                    
ablcm_amt=convert(varchar(50),ablcm_amt),                                  
acdlcm_amt=convert(varchar(50),acdlcm_amt),                                  
acdlfo_amt=convert(varchar(50),acdlfo_amt),                                  
mcdx=convert(varchar(50),mcdx),                                  
ncdx_amt=convert(varchar(50),ncdx_amt),                                  
maker=right(maker,22),party_name,cltcode,mark_amt,bank,email from #client_details where email <> ''                           
OPEN cmsmail_cursor                       
                                                    
FETCH NEXT FROM cmsmail_cursor                                                     
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                                   
                                                    
WHILE @@FETCH_STATUS = 0                              
                                                
BEGIN                                                     
                            
if @Mark_amt = ''                            
                            
begin                            
                          
set @msg = 'Dear '+@cltname+',<br><br>                                  
This is to intimate you that a Payout Request for Rs. '+@chqamt+'/- has been given by '+@branch+' on '+@time+', details of which are as below.<br><br>                                  
<center>                                  
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                  
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                  
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                  
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                  
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                  
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                                  
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                  
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                  
</table></center><br>                                  
The Payout has been requested in the form of cheque.The same will be processed and                               
delivered to your respective branch.<p> If there is any query related to the same please                                   
get in touch with the respective Branch or mail your queries to'                          
                          
if @bank = 'HDFC'                          
 Begin                          
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                           
 end                          
else                            
 begin                          
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                    
 end                            
end                          
                            
else                            
                            
begin                            
                          
set @msg = 'Dear '+@cltname+',<br><br>                                  
This is to intimate you that a Payout Request for Rs. '+@mark_amt+'/- had been given by '+@branch+' on '+@time+' and a payout for Rs. '+@chqamt+'/- has been approved, details of which are as below.<br><br>                                  
<center>                                  
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                                  
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                                  
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                                  
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                                  
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                                  
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                                  
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                                  
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                                  
</table></center><br>                                  
The Payout has been requested in the form of cheque.The same will be processed and                                   
delivered to your respective branch.<p> If there is any query related to the same please                                   
get in touch with the respective Branch or mail your queries to</p>'                           
                          
if @bank = 'HDFC'                          
 Begin                          
set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                          
 end                          
else                            
 begin                          
set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                                  
 end            end                          
                                  
exec usp_AutoMail_CMS  @cltemail,@msg,@file                                  
--print @cltemail                        
FETCH NEXT FROM cmsmail_cursor                                                     
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                     
                          
END                                                    
                            
CLOSE cmsmail_cursor                                                    
DEALLOCATE cmsmail_cursor                                          
                          
-------------------------------cursor branch Mail --------------------------------                                       
                              
DECLARE cmsbranchmail_cursor CURSOR FOR select designation,branch_code,Email from #branch_email where email <> ''                                 
OPEN cmsbranchmail_cursor                                
                                                  
FETCH NEXT FROM cmsbranchmail_cursor                                
INTO @designation,@branch,@Email                                
                                                    
WHILE @@FETCH_STATUS = 0             
                             
BEGIN                                                        
                
truncate table branch_cms                                
truncate table branch_without_email                              
                              
insert into branch_cms                                
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                                
                              
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+''
,''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                                
insert into branch_cms                                
exec(@sql)                                
                              
set @file = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                                 
                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                          
set @s1= @s+''''                                          
exec(@s1)                                                     
                           
-------------------------------without email -----------------------------------------                              
                              
set @msg = 'Dear '+@designation+',<br><br>                              
<p>Please find attached the details of all the clients whose payout requests have been processed.                           
You would be receiving cheques for the same for disbursement. If there are any query related to the same                           
please get in touch with CSO - Banking or mail your  queries to</p>                           
<p><a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a> In case of HDFC</p>                          
<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a> In case of CITI</p>'                             
                          
set @count = (select count(*) from #client_details where email = '' and branch = @branch)                              
                              
if @count <> 0                               
                              
begin                               
truncate table branch_without_email                              
                              
insert into branch_without_email                              
select 'Client Code'+','+'Client Name'+','+'Phone No'                              
                              
insert into branch_without_email                          
select rtrim(ltrim(cltcode))+','+rtrim(ltrim(party_name))+','+rtrim(ltrim(phone)) from #client_details where email = '' and branch = @branch                              
                              
set @file1 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'no_email.csv'                                  
                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_without_email " queryout '+@file1+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                          
set @s1= @s+''''                                          
exec(@s1)                               
            
set @file2 = @file+';'+@file1+';'+'D:\upload1\cms\ECN consent.doc'                                             
                              
set @msg = @msg+'                              
<p><B>Please note - </B>Henceforth email id would be compulsory for all E-Broking clients and all clients who are using fund payout facility, as all communication will be done online on this registered email id.</p>                              
<p>Attached is the list of clients whose email ids are not registered with us and because of which we are not able to send the payout confirmation mail. Please update the KYC department with the email ids of these clients through the attached ECN Consent 
  
    
      
document.</p>'                              
end                              
                              
Else                              
                              
begin                              
                              
truncate table branch_cms                                
                              
insert into branch_cms                                
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                                
                              
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'',
''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                                
insert into branch_cms                                
exec(@sql)                                
                              
set @file2 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                                 
                              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                          
set @s1= @s+''''                                          
exec(@s1)                                             
                              
end                   
                              
set @msg = @msg+'Attached:<br><br>                              
1. Payout Request Details. <br>'                              
                              
if @count <> 0                               
                              
begin                              
set @msg = @msg+'2. List of clients whose email ids are not registered with us. <br>                              
3. ECN Consent form '                              
end                                  
                              
set @msg = @msg+'<br><br>Regards,<br><br><br>Angel Banking - CSO'                              
                              
exec usp_AutoMail_CMS @Email,@msg,@file2                              
--print @Email                        
FETCH NEXT FROM cmsbranchmail_cursor                              
INTO @designation,@branch,@Email                                
                              
END                                                    
                                                    
CLOSE cmsbranchmail_cursor                              
DEALLOCATE cmsbranchmail_cursor

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Cms_mail_online
-- --------------------------------------------------
CREATE proc [dbo].[USP_Sent_Cms_mail_online]          
as                            
                    
declare @chqamt as varchar(50)                            
declare @branch as varchar(100)                            
declare @cltname as varchar(100)                            
declare @bse as varchar(50)                            
declare @nse as varchar(50)                            
declare @fo as varchar(50)                            
declare @mcx as varchar(50)                            
declare @ncdx as varchar(50)                            
declare @time as varchar(50)                             
declare @msg as varchar(5000)                            
declare @Email as varchar(100)                               
declare @sql as varchar(500)                          
declare @s as varchar(500)                          
declare @s1 as varchar(500)                          
declare @file as varchar(500)                          
declare @file1 as varchar(500)                            
declare @file2 as varchar(500)                            
declare @count as varchar(10)                        
declare @count1 as varchar(10)                        
declare @cltcode as varchar(10)                      
declare @Mark_amt as varchar(50)                       
declare @bank as varchar(50)                       
declare @cltemail as varchar(100)                     
                          
----------------------------------cms data--------------------------------------------                        
select cltcode,branch,subgroup,PARTY_NAME,chqamt,acdlcm_amt,acdlfo_amt,ablcm_amt,ncdx_amt,a.mcdx,maker,b.email,                      
phone =                         
case when b.res_phone1 = '' then '' else b.res_phone1 + ' - ' end +                        
case when b.res_phone2 = '' then '' else b.res_phone2 + ' - ' end +                        
case when b.off_phone1 = '' then '' else b.off_phone1 + ' - ' end +                        
case when b.off_phone2 = '' then '' else b.off_phone2 + ' - ' end +                        
case when b.mobile_pager = '' then '' else b.mobile_pager end,                        
branch_cd = (case when left(maker,1) = 'B' then ' the Branch - ' + branch + ' on your behalf '                             
when left(maker,1) = 'S' then ' the Sub-broker - ' + subgroup  + ' on your behalf ' else ' you ' end),space(50) as Mark_amt,space(50) as Bank                    
into #client_details from intranet.risk.dbo.cmsdata a inner join intranet.risk.dbo.client_details b on a.cltcode = b.cl_code and cltcode not in (select party_code from  intranet.risk.dbo.RTGS_IFSC_Master)                 
and chqamt > 0 and generated = 2 and subgroup not in ('BH','INS')                

-- added by manesh to block mails to the clients who had requested funds transfer.
delete from #client_details where cltcode not in (select cltcode from intranet.risk.dbo.cms_online_marked where isnull(chqmark,'Y')='N' and flag='A')

/*and b.email <> ''*/                            
                     
--------------------------------------------------------------------------------------------                      
-- pcmsdata = mark Amt                      
-- cmsdata = MOdified Amt                      
                    
select a.cltcode,mark=a.chqamt,modified=b.chqamt,b.maker,diff=a.chqamt-b.chqamt into #t from intranet.risk.dbo.pcmsdata a left outer join #client_details b on a.cltcode = b.cltcode                       
                      
update #client_details set Mark_amt = convert(varchar,#t.mark) from #t where #client_details.cltcode = #t.cltcode and #t.diff <> 0                       
                    
--update #client_details set Bank = (case when b.Hdfc = 'Y' then 'HDFC' else 'CITI' end) from intranet.risk.dbo.cmssb b inner join #client_details a on a.subgroup = b.sbtag                    
update #client_details set Bank = b.bank_name from
(select cltcode,bank_name from intranet.risk.dbo.cms_online_marked where isnull(chqmark,'Y')='N' and flag='A') b
where  #client_details.cltcode=b.cltcode
                     
                        
----------------------Case I----------------------                        
--select * from #client_details where email <> '' and branch not in (select branch from #client_details where email = '' group by branch)                        
                      
---------------------------------branch mail id--------------------------------------------------           
--select branch_code,Email=lower(Email) into #branch_email from AngelNseCM.msajag.dbo.branch where branch_code in (select branch from #client_details  group by branch) and Email <> ''                                  
      
--select branch_cd as branch_code,Email=lower(Email) into #branch_email from [196.1.115.215].website.dbo.contact_final where email <> '' and branch_cd is not null       
select branch_cd as branch_code,email into #branch_email from intranet.risk.dbo.emp_info where email <> '' and branch_cd is not null and designation in ('Branch Manager','Branch Head')  
      
------------------------------------CLient Mail -------------------------------------------           
DECLARE cmsmail_cursor CURSOR FOR select chqamt=convert(varchar(50),chqamt),                            
branch_cd,              
ablcm_amt=convert(varchar(50),ablcm_amt),                            
acdlcm_amt=convert(varchar(50),acdlcm_amt),                            
acdlfo_amt=convert(varchar(50),acdlfo_amt),                            
mcdx=convert(varchar(50),mcdx),                            
ncdx_amt=convert(varchar(50),ncdx_amt),                            
maker=right(maker,22),party_name,cltcode,mark_amt,bank,email from #client_details where email <> ''                     
OPEN cmsmail_cursor                 
                                              
FETCH NEXT FROM cmsmail_cursor                                               
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                                             
                                              
WHILE @@FETCH_STATUS = 0                        
                                          
BEGIN                                               
                      
if @Mark_amt = ''                      
                      
begin                      
                    
set @msg = 'Dear '+@cltname+',<br><br>                            
This is to intimate you that a Payout Request for Rs. '+@chqamt+'/- has been given by '+@branch+' on '+@time+', details of which are as below.<br><br>                            
<center>                            
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                            
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                            
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                            
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                            
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                            
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                            
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                            
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                            
</table></center><br>                            
The Payout has been requested in the form of Fund Transfer.The same will be processed and                             
transfered to your registered Bank Account.<p> If there is any query related to the same please                             
get in touch with the respective Branch or mail your queries to'                    
                    
if @bank = 'HDFC'                    
 Begin                    
 set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                     
 end                    

if @bank = 'CITI'                    
 begin                    
 set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'              
 end                      

if @bank = 'ICICI'                    
 begin                    
 set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutICICI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'              
 end                      

end                    
                      
else                      
                      
begin                      
                    
set @msg = 'Dear '+@cltname+',<br><br>                            
This is to intimate you that a Payout Request for Rs. '+@mark_amt+'/- had been given by '+@branch+' on '+@time+' and a payout for Rs. '+@chqamt+'/- has been approved, details of which are as below.<br><br>                            
<center>                            
<table border = 1 cellpadding = 4 cellspacing = 0 width = 40%>                            
<tr><td><b>Segment</b></td><td><b>Amount</b></td></tr>                            
<tr><td><font size = 2>BSE-CM</font></td><td align = right>'+@bse+'</td></tr>                            
<tr><td><font size = 2>NSE-CM</font></td><td align = right>'+@nse+'</td></tr>                            
<tr><td><font size = 2>NSE-FO</font></td><td align = right>'+@fo+'</td></tr>                            
<tr><td><font size = 2>MCX</font></td><td align = right>'+@mcx+'</td></tr>                            
<tr><td><font size = 2>NCDEX</font></td><td align = right>'+@ncdx+'</td></tr>                            
<tr><td><b><font size = 2>TOTAL</font><b></td><td align = right><b>'+@chqamt+'</b></td></tr>                            
</table></center><br>                            
The Payout has been requested in the form of Fund Transfer.The same will be processed and                             
transfer to your registered bank account.<p> If there is any query related to the same please                             
get in touch with the respective Branch or mail your queries to</p>'                     
                    
if @bank = 'HDFC'                    
 Begin                    
 set @msg = @msg+'<a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'                     
 end                    

if @bank = 'CITI'                    
 begin                    
 set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'              
 end                      

if @bank = 'ICICI'                    
 begin                    
 set @msg = @msg+'<a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutICICI@angeltrade.com</a>.</p>Regards,<br><br>Angel Banking'              
 end                      


end                    
                            
exec usp_AutoMail_CMS  @cltemail,@msg,@file                            
--print @cltemail                  
FETCH NEXT FROM cmsmail_cursor                                               
INTO @chqamt,@branch,@bse,@nse,@fo,@mcx,@ncdx,@time,@cltname,@cltcode,@Mark_amt,@bank,@cltemail                               
                    
END                                              
                      
CLOSE cmsmail_cursor                                              
DEALLOCATE cmsmail_cursor                                    
                    
-------------------------------cursor branch Mail --------------------------------                                 
                        
DECLARE cmsbranchmail_cursor CURSOR FOR select branch_code,Email from #branch_email where email <> ''                           
OPEN cmsbranchmail_cursor                          
                                            
FETCH NEXT FROM cmsbranchmail_cursor                          
INTO @branch,@Email                          
                                              
WHILE @@FETCH_STATUS = 0                                              
                       
BEGIN                                                  
          
truncate table branch_cms                          
truncate table branch_without_email                        
                        
insert into branch_cms                          
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                          
                        
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+''
,''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                          
insert into branch_cms                          
exec(@sql)                          
                        
set @file = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                           
                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
set @s1= @s+''''                                    
exec(@s1)                                               
                     
-------------------------------without email -----------------------------------------                        
                        
set @msg = 'Dear BM,<br><br>                        
<p>Please find attached the details of all the clients whose payout requests have been processed for Funds Transfer.                     
If there are any query related to the same please get in touch with CSO - Banking or mail your  queries to</p>                     
<p><a href= mailto:cmspayoutHDFC@angeltrade.com> cmspayoutHDFC@angeltrade.com</a> In case of HDFC</p>                    
<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutICICI@angeltrade.com</a> In case of ICICI</p>'                       
--<p><a href= mailto:cmspayoutCITI@angeltrade.com> cmspayoutCITI@angeltrade.com</a> In case of CITI</p>                       
                    
set @count = (select count(*) from #client_details where email = '' and branch = @branch)                        
                        
if @count <> 0                         
                        
begin                         
truncate table branch_without_email                        
                        
insert into branch_without_email                        
select 'Client Code'+','+'Client Name'+','+'Phone No'                        
                        
insert into branch_without_email                    
select rtrim(ltrim(cltcode))+','+rtrim(ltrim(party_name))+','+rtrim(ltrim(phone)) from #client_details where email = '' and branch = @branch                        
                        
set @file1 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'no_email.csv'                            
                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_without_email " queryout '+@file1+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
set @s1= @s+''''                                    
exec(@s1)                         
                        
set @file2 = @file+';'+@file1+';'+'D:\upload1\cms\ECN consent.doc'                                       
                        
set @msg = @msg+'                        
<p><B>Please note - </B>Henceforth email id would be compulsory for all E-Broking clients and all clients who are using fund payout facility, as all communication will be done online on this registered email id.</p>                        
<p>Attached is the list of clients whose email ids are not registered with us and because of which we are not able to send the payout confirmation mail. Please update the KYC department with the email ids of these clients through the attached ECN Consent 
document.</p>'                        
end                        
                        
Else                        
                        
begin                        
                        
truncate table branch_cms                          
                        
insert into branch_cms                          
select 'Client Code'+','+'Client Name'+','+'BSE'+','+'NSE'+','+'NSEFO'+','+'MCX'+','+'NCDEX'+','+'Total Payout'+','+'Drawee Bank'                          
                        
set @sql ='select rtrim(ltrim(cltcode))+'',''+rtrim(ltrim(party_name))+'',''+convert(varchar(15),ablcm_amt)+'',''+convert(varchar(15),acdlcm_amt)+'',''+convert(varchar(15),acdlfo_amt)+'',''+convert(varchar(15),mcdx)+'',''+convert(varchar(15),ncdx_amt)+'',
''+convert(varchar(15),chqamt)+'',''+Bank from #client_details where branch ='+''''+@branch+''''                          
insert into branch_cms                          
exec(@sql)                          
                        
set @file2 = 'D:\upload1\cms\'+ltrim(rtrim(@branch))+''+convert(varchar,getdate()-1,112)+'.csv'                           
                        
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT jv FROM MIS.upload.DBO.branch_cms " queryout '+@file+' -c -SMIS -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                    
set @s1= @s+''''                                    
exec(@s1)                                       
                        
end             
                        
set @msg = @msg+'Attached:<br><br>                        
1. Payout Request Details. <br>'                        
                        
if @count <> 0                         
                        
begin                        
set @msg = @msg+'2. List of clients whose email ids are not registered with us. <br>                        
3. ECN Consent form '                        
end                            
                        
set @msg = @msg+'<br><br>Regards,<br><br><br>Angel Banking - CSO'                        
                        
exec usp_AutoMail_CMS @Email,@msg,@file2                        
--print @Email                  
FETCH NEXT FROM cmsbranchmail_cursor                        
INTO @branch,@Email                          
                        
END                                              
                                              
CLOSE cmsbranchmail_cursor                        
DEALLOCATE cmsbranchmail_cursor

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Sent_Mail
-- --------------------------------------------------
CREATE Proc USP_Sent_Mail
as

insert into tbl_Sent_mail
select Emp_no+','+convert(varchar(11),Getdate())+','+ emailadd,emailadd from HRSOFT.angelbroking.dbo.emplmst  where Emp_No in
(
SELECT Emp_no
FROM HRSOFT.angelbroking.dbo.ip_track group by Emp_no having DATEDIFF(day, max(Login_Date), getdate()) = 0
) and status = 'A' and Emp_No = 'P00212'

Declare @str as varchar(1000)
Declare @filepath as varchar(1000)


set @filepath = (select 'D:\upload1\Absent'+replace(convert(varchar(11),getdate(),3),'/',''))+'.csv'

set @str='exec MASTER.dbo.xp_cmdshell '+ '''' +' bcp "select Fld_Data from HRSOFT.angelbroking.dbo.tbl_Sent_mail" queryout '+@filepath+' -c -Sintranet -Usa -Pnirwan612'            
set @str=@str+''''              
exec(@str)

Exec usp_AutoMail_CMS 'aravind.shenoy@angeltrade.com','Test',@filepath

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SQOF_OdinFile
-- --------------------------------------------------
CREATE Proc USP_SQOF_OdinFile(@server as varchar(25),@fld_date as varchar(11),@serveradd as varchar(30))                          
as                
set nocount on               
 declare @s as varchar(8000)    
declare @s1 as varchar(8000)    
declare @file as varchar(500)    
--declare @Fld_Date as varchar(11)    
    
set @fld_date = convert(varchar(11),@fld_date)    
    
set @file = ltrim(rtrim(replace(@server,' ','')))+'.txt'                                                            
    
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT distinct odin FROM mis.upload.DBO.SQOF_ODIN_CLT_MAP a inner join intranet.[CTCL1.1].dbo.V_ServerMapping b on a.Fld_Server=b.Branch_Name where Convert(varchar(11),Fld_Date,103) = '''''+@Fld_Date+'
'''' and LocaName = '''''+@Server+'''''" queryout \\'+@serveradd+'\D$\upload1\Odin\CTCL_'+@file+' -c'              
set @s1= @s+''''                                      
    
exec(@s1)     

    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_squareof_download
-- --------------------------------------------------
CREATE PROC [dbo].[usp_squareof_download](@SERVER AS VARCHAR(25),@FLD_DATE AS VARCHAR(11),@SERVERADD AS VARCHAR(30),@FTYPE AS VARCHAR(25),@CLTYPE AS VARCHAR(25))                                                            
AS                                                  
SET NOCOUNT ON                                  
                            
                            
DECLARE @S AS VARCHAR(8000)                                      
DECLARE @S1 AS VARCHAR(8000)                                      
DECLARE @FILE AS VARCHAR(500)                           
DECLARE @TBL AS VARCHAR(100)                           
                            
IF @FTYPE='SQ_SUSPEND_'                      
 BEGIN                      
 SET @TBL='MIS.UPLOAD.DBO.SQOF_ODIN_CLT_MAP'                      
 END                      
                      
IF @FTYPE='SQ_REACTIVATION_'                      
 BEGIN                      
 SET @TBL='MIS.UPLOAD.DBO.SQOF_ODIN_CLT_MAP_ACTIVATION'                      
 END                      
                            
                            
SET @FLD_DATE = CONVERT(DATETIME,@FLD_DATE,103)                                   
IF  @SERVER='%'                
BEGIN                
SET @FILE='ALL.TXT'                
END                
ELSE                
BEGIN                
SET @FILE = LTRIM(RTRIM(REPLACE(@SERVER,' ','')))+'.TXT'                                                                                              
END                
                           
SET @S ='EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT DISTINCT ODIN FROM '+@TBL+' WHERE ODIN IS NOT NULL AND STATUSOFCLIENT LIKE '''''+@CLTYPE+'''''AND FLD_DATE = '''''+@FLD_DATE+''''' AND FLD_SERVER LIKE '''''+@SERVER+'''''" QUERYOUT \\'+@SERVERADD+'\D\UPLOAD1\ODIN\'+@FTYPE+@FILE+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'  
SET @S1= @S+''''                                                                        
                            
--PRINT(@S1)                             
EXEC (@S1)                             
                       
IF @FTYPE='SQ_SUSPEND_'                      
 BEGIN                      
 SELECT DISTINCT ODIN FROM DBO.SQOF_ODIN_CLT_MAP WHERE ODIN IS NOT NULL AND STATUSOFCLIENT LIKE @CLTYPE AND  FLD_DATE = @FLD_DATE AND FLD_SERVER LIKE @SERVER                          
 END                      
                      
IF @FTYPE='SQ_REACTIVATION_'                      
 BEGIN                      
 SELECT DISTINCT ODIN FROM DBO.SQOF_ODIN_CLT_MAP_ACTIVATION WHERE ODIN IS NOT NULL AND STATUSOFCLIENT LIKE @CLTYPE AND  FLD_DATE = @FLD_DATE AND FLD_SERVER LIKE @SERVER                      
 END                      
                           
                          
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_squareof_download_suspend
-- --------------------------------------------------
CREATE PROC [dbo].[usp_squareof_download_suspend](@CLTYPE AS VARCHAR(25),@SERVER AS VARCHAR(25),@FLD_DATE AS VARCHAR(11),@SERVERADD AS VARCHAR(30))                                                
AS                                      
SET NOCOUNT ON                      
                
                
DECLARE @S AS VARCHAR(8000)                          
DECLARE @S1 AS VARCHAR(8000)                          
DECLARE @FILE AS VARCHAR(500)               
                         
         
                
SET @FLD_DATE = CONVERT(DATETIME,@FLD_DATE,103)                       
IF  @SERVER='%'    
BEGIN    
SET @FILE='ALL_Hist.TXT'    
END    
ELSE    
BEGIN    
SET @FILE = LTRIM(RTRIM(REPLACE(@SERVER,' ','')))+'_Hist.TXT'                                                                                  
END    
               
SET @S = 'EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP  "SELECT DISTINCT ODIN FROM MIS.UPLOAD.DBO.SQOF_ODIN_CLT_MAP  WHERE STATUSOFCLIENT LIKE '''''+@CLTYPE+'''''AND FLD_DATE = '''''+@FLD_DATE+''''' AND FLD_SERVER LIKE '''''+@SERVER+'''''" QUERYOUT \\'+@SERVERADD+'\D$\UPLOAD1\ODIN\SQ_Suspend_'+@FILE+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'
SET @S1= @S+''''                                                            
                
--PRINT(@S1)                 
EXEC (@S1)                 
           
        
SELECT DISTINCT ODIN FROM DBO.SQOF_ODIN_CLT_MAP WHERE STATUSOFCLIENT LIKE @CLTYPE AND  FLD_DATE = @FLD_DATE AND FLD_SERVER LIKE @SERVER              
      
  
              
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SQUAREOF_DOWNLOAD_Test
-- --------------------------------------------------
--USP_SQUAREOF_DOWNLOAD_Test '%','07/03/2014','196.1.115.183','SQ_Suspend_NSE_','','NSE'    
--USP_SQUAREOF_DOWNLOAD_Test '%','07/03/2014','172.29.19.10','SQ_Suspend_NSE_','','NSE'    
    
CREATE PROC [dbo].[USP_SQUAREOF_DOWNLOAD_Test]                      
(                      
    @SERVER AS VARCHAR(25),                      
    @FLD_DATE AS VARCHAR(11),                      
    @SERVERADD AS VARCHAR(30),                      
    @FTYPE AS VARCHAR(50),            
    @CLTYPE AS VARCHAR(25),                      
    @SEGMENT AS VARCHAR(15)                      
)                                                                                    
AS                                                                          
SET NOCOUNT ON                                                          
                                                    
                                                    
DECLARE @S AS VARCHAR(8000)                                                              
DECLARE @S1 AS VARCHAR(8000)                                                              
DECLARE @FILE AS VARCHAR(500)                                                   
DECLARE @TBL AS VARCHAR(100)                                                   
                                                    
IF @FTYPE='SQ_SUSPEND_'+@SEGMENT+'_'              
 BEGIN                                              
 --SET @TBL='MIS.UPLOAD.DBO.SQOF_ODIN_CLT_MAP'                      
 --SET @TBL='UPLOAD.DBO.SQOF_ODIN_CLT_MAP'                
 SET @TBL='[196.1.115.219].UPLOAD.DBO.SQOF_ODIN_CLT_MAP'                
 END                                              
                                              
IF @FTYPE='SQ_REACTIVATION_'+@SEGMENT+'_'              
 BEGIN                                              
 --SET @TBL='MIS.UPLOAD.DBO.SQOF_ODIN_CLT_MAP_ACTIVATION'                      
 SET @TBL='[196.1.115.219].UPLOAD.DBO.SQOF_ODIN_CLT_MAP_ACTIVATION'                      
 END                                              
                                                    
                                                    
SET @FLD_DATE = CONVERT(DATETIME,@FLD_DATE,103)                                                           
IF  @SERVER='%'                                        
BEGIN                                        
SET @FILE='ALL.TXT'                                        
END                                        
ELSE                                        
BEGIN                                        
SET @FILE = LTRIM(RTRIM(REPLACE(@SERVER,' ','')))+'.TXT'                                                                                                                      
END                                        
                                                   
SET @S ='EXEC MASTER.DBO.XP_CMDSHELL '+ '''' +'BCP "SELECT DISTINCT ODIN FROM '+@TBL+' WHERE ODIN IS NOT NULL AND SEGMENT='''''+@SEGMENT+''''' AND FLD_DATE = '''''+@FLD_DATE+''''' AND FLD_SERVER LIKE '''''+@SERVER+'''''" QUERYOUT \\'+@SERVERADD+'\D$\UPLOAD1\ODIN\'
+@FTYPE+@FILE+' -c -SMISOLD -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                          
SET @S1= @S+''''                                                                                                
                                                    
PRINT(@S1)                                                     
EXEC (@S1)                                                     
                                               
IF @FTYPE='SQ_SUSPEND_'+@SEGMENT+'_'              
 BEGIN                                              
 SELECT DISTINCT ODIN FROM [196.1.115.219].UPLOAD.DBO.SQOF_ODIN_CLT_MAP WHERE ODIN IS NOT NULL AND SEGMENT=@SEGMENT AND FLD_DATE = @FLD_DATE AND FLD_SERVER LIKE @SERVER                                                  
 END                                              
                                              
IF @FTYPE='SQ_REACTIVATION_'+@SEGMENT+'_'              
 BEGIN                                              
 SELECT DISTINCT ODIN FROM [196.1.115.219].UPLOAD.DBO.SQOF_ODIN_CLT_MAP_ACTIVATION WHERE ODIN IS NOT NULL AND SEGMENT=@SEGMENT AND  FLD_DATE = @FLD_DATE AND FLD_SERVER LIKE @SERVER              
 END              
              
              
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_statecitymaster
-- --------------------------------------------------
CREATE procedure usp_statecitymaster(@filename as varchar(25))      
as      
 
select * into #t from  tbl_pincity_master_temp where ISNUMERIC(pin_code)= 1 and len(pin_code)>=6

declare @cnt as int

select @cnt=count(*) from #t where pin_code in (select pin_code from tbl_pincity_master)

if @cnt =0
begin
--delete  from tbl_pincity_master_temp where pin_code in (select pin_code from tbl_pincity_master)   
insert into tbl_pincity_master select * from tbl_pincity_master_temp 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_subbrokerstatusupload
-- --------------------------------------------------
CREATE proc [dbo].[USP_subbrokerstatusupload]            
(        
@filename as varchar(100)        
)         
as            
set transaction  isolation  level read uncommitted            
declare @path as varchar(100)        
declare @sql as varchar(1000)        
truncate table tagstatus            
--set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename        
select @path=uploadserver from [196.1.115.182].upload.dbo.global_upload where upd_srno=2
set @path=@path + @filename
SET @SQL = 'BULK INSERT tagstatus FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'        
-- print @SQL        
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_surplus_dispatch
-- --------------------------------------------------
CREATE proc [dbo].[usp_surplus_dispatch]    
(                    
@filename as varchar(100)                          
)                      
as        
declare @path as varchar(100)                                
declare @sql as varchar(1000)          
--truncate table tbl_Vanishing_company        
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\'+ @filename     
  
SET @SQL = 'insert into V_mis_diverse_dispatch select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'         
--print @SQL                        
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_trade_anywhere
-- --------------------------------------------------
CREATE procedure Usp_trade_anywhere(@filename as varchar(25))  
AS  
truncate table tbl_ScripFile_Equity
insert into tbl_ScripFile_Equity
select * from tradeanywhere_upload_temp
--insert into tradeanywhere_upload_temp(instrument_type,code,symbol,security_descrip,series)  
--values(

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Trade_File
-- --------------------------------------------------
CREATE proc [dbo].[USP_Trade_File](@filename as varchar(100),@settlement as varchar(20),@value as integer)                  
as                  
                  
set transaction  isolation  level read uncommitted                      
                  
                           
declare @str as varchar(5000)                              
declare @file as varchar(100)                              
declare @file1 as varchar(100)                              
declare @s as varchar(1000)                               
declare @s1 as varchar(1000)                   
declare @path as varchar(100)                                  
declare @sql as varchar(1000)                          
declare @table as varchar(100)      
                  
--declare @settlement as varchar(1000)                             
--set @settlement = '2007'                  
--declare @filename as varchar(100)                  
--set @filename = 'aa.txt'                  
--declare @value as integer      
--set @value = 2      
      

set @table = (select      
(case       
when @value = 1 then 'tbl_trade_1' else 'tbl_trade_3' end))               
      
set @path='d:\upload1\' + @filename                   
                  
truncate table tbl_trade_1      
truncate table tbl_trade_3      
                  
set @sql = 'BULK INSERT '+@table+' FROM '''+@path+''' WITH (FIELDTERMINATOR = ''|'', FirstRow=1,KeepNULLS)'                  
--print @sql                  
exec(@sql)                  
                  
truncate table tbl_trade_2                  

set @str = 'insert into tbl_trade_2 select ltrim(rtrim(BrokerID))+''|''+ltrim(rtrim(TerminalID))+''|''+ltrim(rtrim(ScriptCd))+''|''+ltrim(rtrim(ScripName))+''|''+ltrim(rtrim(Rate))+''|''+ltrim(rtrim(Qty))+''|''+                  
ltrim(rtrim(A))+''|''+ltrim(rtrim(B))+''|''+ltrim(rtrim(TradeTime))+''|''+ltrim(rtrim(replace(TradeDate,''/'',''-'')))+''|''+                  
ltrim(rtrim(ClientCode))+''|''+ltrim(rtrim(OrderNo))+''|''+ltrim(rtrim(C))+''|''+ltrim(rtrim(BuySell))+''|''+ltrim(rtrim(D))+''|''+ltrim(rtrim(ClientType))+''|''+ltrim(rtrim(ISIN))+''|''+ltrim(rtrim(Group_name))+''|''+'''+@settlement+'''+''|''+ltrim(rtrim(right(OrderTime,10)))+''|'' from '+@table+''                                 

exec(@str)                  
                  
--set @file = 'D:\upload1\Trade\'+@filename+'.txt'           
set @file1 = 'D:\upload1\Trade\'+'BR'+replace(convert(varchar(11),getdate(),3),'/','')+'.Dat'    
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Heading FROM OLDINTRANET.upload.DBO.tbl_trade_2" queryout '+@file1+' -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'                                                
set @s1= @s+''''                                                
exec(@s1)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Trun_Asian_Scrip
-- --------------------------------------------------
CREATE proc USP_Trun_Asian_Scrip      
as      
delete from [172.31.15.52].Orerms_v2.dbo.orescripgroupmapping where Exchange = 'FONSE'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_Update_Flag
-- --------------------------------------------------
CREATE Proc Usp_Update_Flag @AccessCode Varchar(15),@NewCode Varchar(15)    
As    
Declare @Str as Varchar(5000)    
Declare @EmpCode as Varchar(15)  
  
Create Table #t  
(EmpCode Varchar(15))  
  
Set @Str = 'Insert into #t Select top 1 UserName from MIS.Upload.dbo.Tbl_Odin_'+@AccessCode+''  
Exec(@Str)  
  
Set @EmpCode = (Select EmpCode from #t)  
  
If(@EmpCode = @NewCode)  
Begin  
	Set @Str = 'Update Tbl_Odin_CSO Set Flag = ''0'''      
	Exec(@Str)  
	Select 1 Cnt
End  
Else  
	Select @EmpCode Cnt

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPDATE_TICKER_IMG_UPLOAD
-- --------------------------------------------------
/******************************************************************************      
CREATED BY: RUTVIJ PATIL      
DATE: 20/09/2010      
PURPOSE: USE TO UPDATE DATA INTO TABLE TICKER_IMG_UPLOAD  
      
MODIFIED BY: PROGRAMMER NAME      
DATED: DD/MM/YYYY      
REASON: REASON TO CHANGE STORE PROCEDURE      
******************************************************************************/      
      
CREATE PROCEDURE [DBO].[USP_UPDATE_TICKER_IMG_UPLOAD]      
       
 @ANGEL_TICKER_ID INT,      
 @TICKER_MESSAGE VARCHAR(200),      
 @DATE_FROM DATETIME,      
 @TIME_FROM VARCHAR(5),      
 @DATE_TO DATETIME,      
 @TIME_TO VARCHAR(5),      
 @IMAGE_NAME VARCHAR(200),      
 @IMAGE_CONTENT VARBINARY(MAX),      
 @CREATED_BY VARCHAR(100),      
 @CREATED_DATE DATETIME,      
 @MODIFIED_BY VARCHAR(100),      
 @MODIFIED_DATE DATETIME      
      
AS      
BEGIN      
      
 UPDATE TICKER_IMG_UPLOAD      
  
 SET       
  
  TICKER_MESSAGE = @TICKER_MESSAGE,  
  DATE_FROM = @DATE_FROM,      
  TIME_FROM = @TIME_FROM,      
  DATE_TO = @DATE_TO,      
  TIME_TO = @TIME_TO,      
  IMAGE_NAME = CASE        
      WHEN @IMAGE_NAME = ''      
      THEN (SELECT IMAGE_NAME FROM TICKER_IMG_UPLOAD WHERE ANGEL_TICKER_ID = @ANGEL_TICKER_ID)      
      ELSE @IMAGE_NAME      
     END,      
  IMAGE_CONTENT = CASE       
       WHEN @IMAGE_NAME = ''      
       THEN (SELECT IMAGE_CONTENT FROM TICKER_IMG_UPLOAD WHERE ANGEL_TICKER_ID = @ANGEL_TICKER_ID)      
       ELSE @IMAGE_CONTENT      
       END,      
  MODIFIED_BY = @MODIFIED_BY,      
  MODIFIED_DATE = @MODIFIED_DATE      
  
 WHERE ANGEL_TICKER_ID = @ANGEL_TICKER_ID      
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPDATE_TR_IMAGE_UPLOAD
-- --------------------------------------------------
/******************************************************************************          
CREATED BY: RUTVIJ PATIL          
DATE: 18/11/2010          
PURPOSE: USE TO INSERT DATA INTO TABLE TR_IMAGE_UPLOAD        
          
MODIFIED BY: PROGRAMMER NAME          
DATED: DD/MM/YYYY          
REASON: REASON TO CHANGE STORE PROCEDURE          
******************************************************************************/          
          
CREATE PROCEDURE [DBO].[USP_UPDATE_TR_IMAGE_UPLOAD]    

	@IMAGE_UPLOAD_ID INT,			-- USE TO STORE IMAGE UPLOAD ID
	@IMAGE_NAME VARCHAR(50),		-- USE TO HOLD IMAGE NAME
	@CLIENT_ID VARCHAR(50),		-- USE TO HOLD CLIENT ID
	@IMAGE_CONTENT VARBINARY(MAX), -- USE TO HOLD IMAGE COMTENT   
	@APPLICATION_NAME VARCHAR(50), -- USE TO HOLD APPLICATION NAME   
	@MODIFIED_BY VARCHAR(50),      -- USE TO HOLD MODIFIER EMPLOYEE ID
	@MODIFIED_DATE DATETIME        -- USE TO HOLD MODIFIED DATE 

AS          
BEGIN          

UPDATE TR_IMAGE_UPLOAD        

SET 

IMAGE_NAME = @IMAGE_NAME,    
CLIENT_ID = @CLIENT_ID,    
IMAGE_CONTENT = @IMAGE_CONTENT,    
APPLICATION_NAME = @APPLICATION_NAME,    
MODIFIED_BY = @MODIFIED_BY,    
MODIFIED_DATE = @MODIFIED_DATE

WHERE IMAGE_UPLOAD_ID = @IMAGE_UPLOAD_ID

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPDATE_TR_IMG_UPLOAD
-- --------------------------------------------------
  
  
/******************************************************************************  
CREATED BY: RUTVIJ PATIL  
DATE: 20/09/2010  
PURPOSE: USE TO UPDATE DATA INTO TABLE TR_IMG_UPLOAD  
  
MODIFIED BY: PROGRAMMER NAME  
DATED: DD/MM/YYYY  
REASON: REASON TO CHANGE STORE PROCEDURE  
******************************************************************************/  
  
CREATE PROCEDURE [dbo].[USP_UPDATE_TR_IMG_UPLOAD]  
   
 @IMG_UPLOAD_ID INT,  
 @POPUP_NAME VARCHAR(200),  
 @FOR_EMP BIT,  
 @FOR_SB_ADMIN BIT,  
 @FOR_SB_USER BIT,  
 @DATE_FROM DATETIME,  
 @TIME_FROM VARCHAR(5),  
 @DATE_TO DATETIME,  
 @TIME_TO VARCHAR(5),  
 @IMG_NAME VARCHAR(200),  
 @IMG_CONTENT VARBINARY(MAX),  
 @HLINK_REQD BIT,  
 @FILE_NAME VARCHAR(200),  
 @FILE_CONTENT VARBINARY(MAX),  
 @CREATED_BY VARCHAR(100),  
 @CREATED_DATE DATETIME,  
 @MODIFIED_BY VARCHAR(100),  
 @MODIFIED_DATE DATETIME  
  
AS  
BEGIN  
  
 UPDATE TR_IMG_UPLOAD  
  
 SET   
   
  POPUP_NAME = @POPUP_NAME,  
  FOR_EMP = @FOR_EMP,  
  FOR_SB_ADMIN = @FOR_SB_ADMIN,  
  FOR_SB_USER = @FOR_SB_USER,  
  DATE_FROM = @DATE_FROM,  
  TIME_FROM = @TIME_FROM,  
  DATE_TO = @DATE_TO,  
  TIME_TO = @TIME_TO,  
  IMG_NAME = CASE    
     WHEN @IMG_NAME = ''  
      THEN (SELECT IMG_NAME FROM TR_IMG_UPLOAD WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID)  
     ELSE @IMG_NAME  
       END,  
  IMG_CONTENT = CASE   
      WHEN @IMG_NAME = ''  
       THEN (SELECT IMG_CONTENT FROM TR_IMG_UPLOAD WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID)  
      ELSE @IMG_CONTENT  
       END,  
  HLINK_REQD = CASE    
      WHEN @HLINK_REQD = 0  
        THEN (SELECT HLINK_REQD FROM TR_IMG_UPLOAD WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID)  
      ELSE @HLINK_REQD  
      END,  
  [FILE_NAME] = CASE   
      WHEN @FILE_NAME = ''  
       THEN (SELECT [FILE_NAME] FROM TR_IMG_UPLOAD WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID)  
      ELSE @FILE_NAME  
       END,  
  FILE_CONTENT = CASE   
      WHEN @FILE_NAME = ''  
       THEN (SELECT [FILE_CONTENT] FROM TR_IMG_UPLOAD WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID)  
      ELSE @FILE_CONTENT  
       END,  
  --CREATED_BY = @CREATED_BY,  
  --CREATED_DATE = @CREATED_DATE,  
  MODIFIED_BY = @MODIFIED_BY,  
  MODIFIED_DATE = @MODIFIED_DATE  
   
 WHERE IMG_UPLOAD_ID = @IMG_UPLOAD_ID  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_updExchangeDetail
-- --------------------------------------------------
CREATE proc usp_updexchangedetail      
(                                                  
@filename as varchar(100),      
@username as varchar(20)                           
)                                                    
as                               
set nocount on;      
 
delete from intranet.misc.dbo.ipobiddetails --where fname=@filename                
           
----insert fresh data                  
insert into intranet.misc.dbo.ipobiddetails       
select exchipocode,system_ipocode,applicationno,applicationlotqty,party_code,      
pricepershare,allottedqty,allotmentamt,refundamt,      
@filename,@username,    
getdate()       
from ipoexchangedetail_temp 

----insert into history                  
insert into intranet.misc.dbo.ipobiddetailshistory                   
select * from intranet.misc.dbo.ipobiddetails                   

                 
set nocount off;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[usp_upload_BSEQE]                      
(                      
  @Server AS VARCHAR(20),                      
  @FileName AS VARCHAR(50)                      
)                      
AS                      
BEGIN                      
  SET NOCOUNT ON;                  
 delete from  intranet.misc.dbo.qe where fname=@FileName  
   
  /*declare @Server AS VARCHAR(20)='196.1.115.183',                      
  @FileName AS VARCHAR(50) ='QE200818' */  
     
   select top 0 * into #tmpqe from  QE160221                
  declare @sql as varchar(1000)    
     
SET @sql='BULK INSERT #tmpqe FROM ''' + '\\'+@Server+'\d\UPLOAD1\SELFTRADE\' + +@FileName+ + ''' WITH (FIELDTERMINATOR = '','', keepnulls, firstrow=2)'                
                  
  --set @sql='insert into intranet.misc.dbo.qe                   
  --  (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
  --   NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                   
  --  SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
  --     NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(                  
  --   ''Microsoft.ACE.OLEDB.12.0'',                  
  --   ''dBase IV;HDR=NO;IMEX=2;  
  --   DATABASE=\\'+@Server+'\c\UPLOAD\SELFTRADE\'',                  
  --   ''Select * from '+@FileName+''')'                  
   --PRINT (@SQL)            
   exec(@sql)        
     
   insert into intranet.misc.dbo.qe                   
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname=+@FileName,date=convert(char(11),getdate(),121) FROM #tmpqe             
                  
   SET NOCOUNT ON;                   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE_01Mar2021
-- --------------------------------------------------
CREATE PROCEDURE dbo.usp_upload_BSEQE_01Mar2021                    
(                    
  @Server AS VARCHAR(20),                    
  @FileName AS VARCHAR(50)                    
)                    
AS                    
BEGIN                    
  SET NOCOUNT ON;                
 delete from  intranet.misc.dbo.qe where fname=@FileName
 
  /*declare @Server AS VARCHAR(20)='196.1.115.183',                    
  @FileName AS VARCHAR(50) ='QE200818' */
                 
  declare @sql as varchar(1000)                
                
  set @sql='insert into intranet.misc.dbo.qe                 
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                 
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(                
     ''Microsoft.ACE.OLEDB.12.0'',                
     ''dBase IV;HDR=NO;IMEX=2;
     DATABASE=\\'+@Server+'\c\UPLOAD\SELFTRADE\'',                
     ''Select * from '+@FileName+''')'                
   --PRINT (@SQL)          
   exec(@sql)                 
                
   SET NOCOUNT ON;                 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE_03Jan2022
-- --------------------------------------------------
CREATE PROCEDURE dbo.usp_upload_BSEQE_03Jan2022                    
(                      
  @Server AS VARCHAR(20),                      
  @FileName AS VARCHAR(50)                      
)                      
AS                      
BEGIN                      
  SET NOCOUNT ON;                  
 delete from  intranet.misc.dbo.qe where fname=@FileName  
   
  /*declare @Server AS VARCHAR(20)='196.1.115.183',                      
  @FileName AS VARCHAR(50) ='QE200818' */  
     
   select top 0 * into #tmpqe from  QE160221                
  declare @sql as varchar(1000)    
     
SET @sql='BULK INSERT #tmpqe FROM ''' + '\\'+@Server+'\c\UPLOAD\SELFTRADE\' + +@FileName+ + ''' WITH (FIELDTERMINATOR = '','', keepnulls, firstrow=2)'                
                  
  --set @sql='insert into intranet.misc.dbo.qe                   
  --  (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
  --   NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                   
  --  SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
  --     NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(                  
  --   ''Microsoft.ACE.OLEDB.12.0'',                  
  --   ''dBase IV;HDR=NO;IMEX=2;  
  --   DATABASE=\\'+@Server+'\c\UPLOAD\SELFTRADE\'',                  
  --   ''Select * from '+@FileName+''')'                  
   --PRINT (@SQL)            
   exec(@sql)        
     
   insert into intranet.misc.dbo.qe                   
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                  
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname=+@FileName,date=convert(char(11),getdate(),121) FROM #tmpqe             
                  
   SET NOCOUNT ON;                   
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE_09Mar2020
-- --------------------------------------------------
CREATE PROCEDURE dbo.usp_upload_BSEQE_09Mar2020                    
(                    
  @Server AS VARCHAR(20),                    
  @FileName AS VARCHAR(50)                    
)                    
AS                    
BEGIN                    
  SET NOCOUNT ON;                
 delete from  intranet.misc.dbo.qe where fname=@FileName
 
  /*declare @Server AS VARCHAR(20)='196.1.115.183',                    
  @FileName AS VARCHAR(50) ='QE200818' */
                 
  declare @sql as varchar(1000)                
                
  set @sql='insert into intranet.misc.dbo.qe                 
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                 
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(                
     ''Microsoft.ACE.OLEDB.12.0'',                
     ''dBase IV;HDR=NO;IMEX=2;
     DATABASE=\\'+@Server+'\c$\UPLOAD\SELFTRADE\'',                
     ''Select * from '+@FileName+''')'                
   --PRINT (@SQL)          
   exec(@sql)                 
                
   SET NOCOUNT ON;                 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE_25Aug2018
-- --------------------------------------------------
CREATE PROCEDURE dbo.usp_upload_BSEQE_25Aug2018                    
(                    
  @Server AS VARCHAR(20),                    
  @FileName AS VARCHAR(50)                    
)                    
AS                    
BEGIN                    
  SET NOCOUNT ON;                
 delete from  intranet.misc.dbo.qe where fname=@FileName                
  declare @sql as varchar(1000)                
                
  set @sql='insert into intranet.misc.dbo.qe                 
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,UOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)                 
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,                
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(                
     ''MSDASQL'',                
     ''Driver={Microsoft dBase Driver (*.dbf)};DBQ=\\'+@Server+'\c$\UPLOAD\SELFTRADE\'',                
     ''Select * from '+@FileName+''')'                
    --  PRINT (@SQL)          
 exec(@sql)                 
                
   SET NOCOUNT ON;                 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE_test
-- --------------------------------------------------

CREATE  PROCEDURE [dbo].[usp_upload_BSEQE_test]                
(                
  @Server AS VARCHAR(20),                
  @FileName AS VARCHAR(50)                
)                
AS                
BEGIN                
  SET NOCOUNT ON;            
--- delete from  intranet.misc.dbo.qe where fname=@FileName            
  declare @sql as varchar(1000)            
            
  set @sql='insert into intranet.misc.dbo.qe             
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,            
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)             
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,            
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(            
     ''Microsoft.ACE.OLEDB.12.0'',            
     ''dBase 5.0;Database=\\'+@Server+'\c$\UPLOAD\SELFTRADE\'',            
     ''Select * from '+@FileName+''')'            
      PRINT (@SQL)      
 --exec(@sql)             
            
   SET NOCOUNT ON;             
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_BSEQE_Test1
-- --------------------------------------------------
CREATE PROCEDURE dbo.usp_upload_BSEQE_Test1                
(                
  @Server AS VARCHAR(20),                
  @FileName AS VARCHAR(50)                
)                
AS                
BEGIN                
  SET NOCOUNT ON;            
 delete from  intranet.misc.dbo.qe where fname=@FileName            
  declare @sql as varchar(1000)            
            
  set @sql='insert into intranet.misc.dbo.qe             
    (SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,            
     NO_OF_SHRS,NET_TURNOV,ROLLING,fname,pddate)             
    SELECT SC_CODE,SC_NAME,SC_GROUP,SC_TYPE,QUOT_1,QUOT_2,QUOT_3,QUOT_4,TDCLOINDI,NO_TRADES,            
       NO_OF_SHRS,NET_TURNOV,ROLLING,fname='''+@FileName+''',date=convert(char(11),getdate(),121) FROM OPENROWSET(            
     ''MSDASQL'',            
     ''Driver={Microsoft dBase Driver (*.dbf)};DBQ=\\'+@Server+'\c$\UPLOAD\SELFTRADE\'',            
     ''Select * from '+@FileName+''')'            
    --  PRINT (@SQL)      
 exec(@sql)             
            
   SET NOCOUNT ON;             
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPload_DpCls
-- --------------------------------------------------
CREATE Proc USP_UPload_DpCls(@filename varchar(25),@server varchar(50))  
as  
  
declare @path varchar(50)  
declare @SQL varchar(250)  
  
truncate table dpinitiatedclosure  
  
set @path='\\'+@server+'\d$\upload1\' + @filename            
SET @SQL = 'BULK INSERT dpinitiatedclosure FROM '''+@Path+''' WITH (FirstRow=2,KeepNULLS)'    
  
exec(@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_IPOExcel
-- --------------------------------------------------
CREATE proc usp_upload_IPOExcel                                  
 (                                              
 @filename AS VARCHAR(100),                  
 @server AS VARCHAR(25)                        
 )                                                
 AS                           
 SET NOCOUNT ON;                     
 DECLARE @path AS VARCHAR(100)                                                          
 DECLARE @sql AS VARCHAR(1000)                 
 truncate table IPOTransaction              
 SET @path='\\'+@server+'\d$\upload1\IPO\' + @filename                        
   
 /*SET @SQL = 'insert into IPOTransaction select [Application No],[Bid ID],              
 [IPO Code],Quantity,Price,[Best Bid Amount],[Margin Amount],[Mode of Payment],[Cheque No],              
 [Confirmation No],[Bid Status],[Rejection Code],[Rejection Remark],[Revision No],[Client ID],              
 [Client Name],Status,[Bid Date],[Group ID],BrokerCode,SubBrokerCode,[Entered By],[DP ID],              
 convert(varchar,cast([Client Benificiary ID] as decimal)) as [Client Benificiary ID],              
 convert(varchar ,[RTA Link]) as [RTA Link]               
 FROM OPENROWSET(''Microsoft.ACE.OLEDB.12.0'',''Excel 12.0;DATABASE='+@path+''',''Select * from [TransactionBook_04Oct2010_new$]'' )'   */            
 /*SET @SQL = 'insert into IPOTransaction select [Application No],[Bid ID],              
 [IPO Code],Quantity,Price,[Best Bid Amount],[Margin Amount],[Mode of Payment],[Cheque No],              
 [Confirmation No],[Bid Status],[Rejection Code],[Rejection Remark],[Revision No],[Client ID],              
 [Client Name],Status,[Bid Date],[Group ID],BrokerCode,SubBrokerCode,[Entered By],[DP ID],              
 convert(varchar,cast([Client Benificiary ID] as decimal)) as [Client Benificiary ID],              
 convert(varchar ,space(1)) as [RTA Link]               
 FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 4.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'  */     
   
 SET @SQL = 'insert into IPOTransaction select [Application No],[Bid ID],              
 [IPO Code],Quantity,Price,[Best Bid Amount],[Margin Amount],[Mode of Payment],[Cheque No],              
 [Confirmation No],[Bid Status],[Rejection Code],[Rejection Remark],[Revision No],[Client ID],              
 [Client Name],Status,[Bid Date],[Group ID],BrokerCode,SubBrokerCode,[Entered By],[DP ID],              
 convert(varchar,cast([Client Benificiary ID] as decimal)) as [Client Benificiary ID],              
 convert(varchar ,space(1)) as [RTA Link]               
 FROM OPENROWSET(''Microsoft.ACE.OLEDB.12.0'',''Excel 12.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                                                       
  
 print @SQL                                                  
 EXEC (@SQL)              
   
 ----Delete Same Day Data    
 DELETE FROM INTRANET.MISC.dbo.IPOTransaction ---WHERE Fname=@filename              
   
 ----Insert Fresh Data              
 INSERT INTO INTRANET.MISC.dbo.IPOTransaction               
 Select ApplicationNo,BidID,IPOCode,Quantity,Price,BestBidAmount,MarginAmount,      
 ModeofPayment,ChequeNo,ConfirmationNo,BidStatus,RejectionCode,      
 RejectionRemark,RevisionNo,ClientID,ClientName,Status,BidDate=CONVERT(DATETIME,BidDate,105),      
 GroupID,BrokerCode,SBCode,EnteredBy,DPID,ClientBenificiaryID,RTA,      
 FUploadDt=CONVERT(VARCHAR,getdate(),106),Fname=@filename FROM IPOTransaction            
  
 ----Insert into history              
 INSERT INTO INTRANET.MISC.dbo.IPOTransactionHISTORY               
 Select *,      
 BKPDate=CONVERT(VARCHAR,getdate(),106) FROM INTRANET.MISC.dbo.IPOTransaction               
  
 SET NOCOUNT OFF;

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_IT_Events
-- --------------------------------------------------
CREATE PROC [dbo].[USP_UPLOAD_IT_Events](                               
           @filename AS VARCHAR(100),@server AS VARCHAR(100))                               
AS                               
  SET TRANSACTION  ISOLATION  LEVEL  READ  uncommitted                               
                                 
  DECLARE  @path  AS VARCHAR(100)                               
                                 
  DECLARE  @sql  AS VARCHAR(1000)                               
                                 
  --declare @filename as varchar(100)                                                           
  --set @filename = 'IT_Events'                               
--  SET @path = (SELECT uploadserver                               
--               FROM   [CSOKYC-6].upload.dbo.global_upload                               
--               WHERE  upd_srno = 6) + @filename                             
set  @path='\\'+@server+'\d$\upload1\IT_Issues\'+@filename                          
                                 
                             
    
BEGIN TRY                               
SET @SQL = 'insert into MIS.upload.dbo.IT_Events select Date,Type,Server,    
right (convert (varchar(100),[Time From]),7) as [Time From],    
right (convert (varchar(100),[Time To]),7) as [Time To],            
[Event Particulars],convert(varchar(max),Solution),[Type of Problem],            
[Downtime in minutes],[Impacted Segment] , Remark FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='                 
+ @path + ''',''Select * from [Sheet1$]'' )'            
Exec(@SQL)                                              
END TRY        
        
        
BEGIN CATCH          
SET @SQL = 'insert into MIS.upload.dbo.IT_Events select Date,Type,Server,    
right (convert (varchar(100),[Time From]),7) as [Time From],    
right (convert (varchar(100),[Time To]),7)  as [Time To],            
[Event Particulars],convert(varchar(max),Solution),[Type of Problem],            
[Downtime in minutes],[Impacted Segment] , Remark FROM OPENROWSET(''Microsoft.ACE.OLEDB.12.0'',''Excel 12.0 Xml;DATABASE='                 
+ @path + ''',''Select * from [Sheet1$]'' )'            
EXEC(@SQL)       
END CATCH

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_IT_IPDATA
-- --------------------------------------------------
CREATE proc [dbo].[USP_UPLOAD_IT_IPDATA]          
(                          
@filename as varchar(100)                          
)                           
as                              
set transaction  isolation  level read uncommitted                              
                  
declare @path as varchar(100)                          
declare @sql as varchar(1000)                       
-- declare @filename as varchar(100)                          
-- set @filename = 'IT_Events'                  
                
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename                          
                
truncate table tbl_IT_IPaddress            
                
--SET @SQL = 'insert into mis.helpdesk.dbo.tbl_IT_IPaddress select Date,Server,[Time From],[Time To],[Event Particulars],convert(varchar(3000),Solution),[Type of Problem],[Downtime in minutes],[Impacted Segment] FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'                
SET @SQL = 'insert into tbl_IT_IPaddress select Branch,IPFRom,IPTo,SubNet,DefaultGW,convert(varchar(500),Remark) FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Upload_ITServer_Uptime
-- --------------------------------------------------
CREATE PROCEDURE USP_Upload_ITServer_Uptime(@filename as varchar(25))        
AS        
 BEGIN      
          
 DECLARE @NumberRecords int     
 DECLARE @RowCount int    
 DECLARE @Count int    
 DECLARE @tdate datetime    
     
 DECLARE @Bse varchar(25)    
 DECLARE @Cm varchar(25)    
 DECLARE @Fo varchar(25)    
 DECLARE @Mcx varchar(25)    
 DECLARE @Ncdex varchar(25)    
 DECLARE @ACDLNSX varchar(25)    
 DECLARE @ACPLMCD varchar(25)    
     
 SELECT @NumberRecords = COUNT(*) FROM tbl_Uptime_report    
 SET @RowCount = 1    
     
 WHILE @RowCount <= @NumberRecords    
 BEGIN    
 SELECT @Count = COUNT(*) FROM helpdesk.dbo.sett_mst WHERE tdate =(SELECT tdate FROM  tbl_Uptime_report WHERE sr_no = @RowCount)     
 SELECT @tdate = tdate FROM  tbl_Uptime_report WHERE sr_no = @RowCount    
 SELECT @Bse =Case When Bse = 'Holiday' Then 0 Else Bse End,  
  @Cm  =Case When Cm = 'Holiday' Then 0 Else Cm End  ,  
  @Fo =Case When Fo = 'Holiday' Then 0 Else Fo End ,  
  @Mcx =Case When Mcx = 'Holiday' Then 0 Else Mcx End ,  
  @Ncdex=Case When Ncdex = 'Holiday' Then 0 Else Ncdex End  ,  
  @ACDLNSX =Case When ACDLNSX = 'Holiday' Then 0 Else ACDLNSX End ,  
  @ACPLMCD =Case When ACPLMCD = 'Holiday' Then 0 Else ACPLMCD End   
  FROM tbl_Uptime_report   
  WHERE tdate =(SELECT tdate FROM  tbl_Uptime_report WHERE sr_no = @RowCount)     
       
 If @Count = 0 or @Count is NULL     
 BEGIN    
 --INSERT INTO helpdesk.dbo.temptable(tdate,Bse,Cm,Fo,Mcx,Ncdex,ACDLNSX,ACPLMCD)  SELECT tdate ,      
   INSERT INTO helpdesk.dbo.sett_mst(tdate,Bse,Cm,Fo,Mcx,Ncdex,ACDLNSX,ACPLMCD)  SELECT tdate ,      
   CASE WHEN Bse='Holiday' THEN 0 ELSE Bse END,      
   CASE WHEN Cm='Holiday' THEN 0 ELSE Cm END,      
   CASE WHEN Fo = 'Holiday' THEN 0 ELSE Fo END,      
   CASE WHEN Mcx='Holiday' THEN 0 ELSE Mcx END,      
   CASE WHEN Ncdex='Holiday' THEN 0 ELSE Ncdex END,      
   CASE WHEN ACDLNSX= 'Holiday' THEN 0 ELSE ACDLNSX END,      
   CASE WHEN ACPLMCD = 'Holiday' THEN 0 ELSE ACPLMCD END       
   FROM tbl_Uptime_report WHERE sr_no = @RowCount      
 END    
 --If exists, update data    
 ELSE    
 BEGIN    
  UPDATE helpdesk.dbo.sett_mst     
  SET  tdate = @tdate,    
  Bse = (CASE WHEN @Bse ='Holiday' THEN 0 ELSE @Bse END),    
  Cm = (CASE WHEN @Cm ='Holiday' THEN 0 ELSE @Cm END),     
  Fo = (CASE WHEN @Fo ='Holiday' THEN 0 ELSE @Fo END),   
  Mcx = (CASE WHEN @Mcx ='Holiday' THEN 0 ELSE @Mcx END),  
  Ncdex = (CASE WHEN @Ncdex ='Holiday' THEN 0 ELSE @Ncdex END),  
  ACDLNSX = (CASE WHEN @ACDLNSX ='Holiday' THEN 0 ELSE @ACDLNSX END),   
  ACPLMCD = (CASE WHEN @ACPLMCD ='Holiday' THEN 0 ELSE @ACPLMCD END)  
  WHERE tdate = @tdate    
 END    
  SET @RowCount = @RowCount + 1    
 END     
  TRUNCATE TABLE tbl_Uptime_report     
                 
 END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_marginshortfall
-- --------------------------------------------------
CREATE PROC [dbo].[USP_UPLOAD_marginshortfall] -- '172.29.19.10','MarginShortfall02092011131136_defaultE.Xls'              
(                
@SERVER AS VARCHAR(25),              
@FILENAME AS VARCHAR(100),          
@UPlOADEDBY AS VARCHAR(20)                
)                
AS                
BEGIN                
SET NOCOUNT ON;                
DECLARE @PATH AS VARCHAR(200)                
DECLARE @SQL AS VARCHAR(8000)                
              
TRUNCATE TABLE temp_marginshortfall                
SET @PATH='\\'+@SERVER+'\D$\UPLOAD1\'+@FILENAME          
                
SET @SQL = 'INSERT INTO temp_marginshortfall SELECT [Ro Code],[Branch Code],[Family Code],[Client Code],[Client Name],[Ledger Balance],[Collateral],[Span Margin],                
[Shortfall],[% Of Penalty],[Penalty Amount],[Span Margin1],[Shortfall1],[% Of Penalty1],[Penalty Amount1],[Span Margin2],[Shortfall2],                
[% Of Penalty2],[Penalty Amount2],GETDATE(),''e10398''                
FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''select [Ro Code],[Branch Code],[Family Code],[Client Code],[Client Name],[Ledger Balance],[Collateral],[Span Margin],                
[Shortfall],[% Of Penalty],[Penalty Amount],[Span Margin1],[Shortfall1],[% Of Penalty1],[Penalty Amount1],[Span Margin2],[Shortfall2],                
[% Of Penalty2],[Penalty Amount2] from [Sheet1$]'' )'                
                
                
--PRINT @SQL                
EXEC (@SQL)                
exec intranet.risk.dbo.USP_UPLOAD_marginshortfall              
end                
SET NOCOUNT off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_MCDX_BhavCopy
-- --------------------------------------------------
CREATE proc USP_UPLOAD_MCDX_BhavCopy                      
(                                
@filename as varchar(100),@server as varchar(20)                                
)                                 
as                                    
set transaction  isolation  level read uncommitted                                    
                        
declare @path as varchar(100)                                
declare @sql as varchar(1000)                             
--declare @filename as varchar(100)                                
--set @filename = 'MCX22042008.csv'                        
                      
set @path='\\'+@server+'\d$\upload1\bhavcopy\' + @filename                                
              
insert into MCDX_Bhav_Copy_Hist select * from MCDX_Bhav_Copy          
truncate table MCDX_Bhav_Copy                      
                      
SET @SQL = 'BULK INSERT MCDX_Bhav_Copy FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'      
update bhavcopy_upload_date set updatedate=getdate() where segment='MCDX'                            
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_MCX_MARGIN
-- --------------------------------------------------
CREATE PROCEDURE USP_UPLOAD_MCX_MARGIN  
@FILENAME VARCHAR(MAX)
AS  
BEGIN  
delete from MCX_MARGIN_TEST  
insert INTO MCX_MARGIN_TEST select * FROM TEMP_MCX  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_MCXSX_BhavCopy
-- --------------------------------------------------
CREATE proc USP_UPLOAD_MCXSX_BhavCopy                                  
(                                            
@filename as varchar(100) ,@server as varchar(20)                       
)                                             
as                                                
set transaction  isolation  level read uncommitted                                                
                                    
declare @path as varchar(100)                                            
declare @sql as varchar(1000)                                         
--declare @filename as varchar(100)                                            
--set @filename = 'NCDEX Bhav copy.csv'                          
                              
Set @path='\\'+@server+'\d$\upload1\bhavcopy\' + @filename                    
                                                                  
truncate table mcxsx_cp     
                                         
SET @SQL ='BULK INSERT mcxsx_cp FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS);'                       
-- print @SQL                        
exec (@SQL)   

truncate table mcxsx_cp_F  
            
SET @SQL =''  
SET @SQL ='BULK INSERT mcxsx_cp_F FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS);'                             
exec (@SQL)   
        
delete from  mcxsx_cp   where symbol is null and [instrument name] is null        
update bhavcopy_upload_date set updatedate=getdate() where segment='MCXSX'                  
    
insert into mcxsx_cp_hist select *,GETDATE() from mcxsx_cp with (nolock)    
INSERT INTO MCXSX_CP_F_HIST SELECT *,GETDATE() AS UPD_DATE FROM mcxsx_cp_F

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_nbfc_client
-- --------------------------------------------------
CREATE proc usp_upload_nbfc_client        
(        
@filename as varchar(100) ,@server as varchar(20)         
)        
as        
declare @path as varchar(100)                                              
declare @sql as varchar(1000)         
--declare @filename as varchar(25)        
--set @filename = 'Upload Format.txt'        
  
truncate table tbl_uploadnbfc_clientlist   
set @path='\\'+@server+'\d$\upload1\NBFCClient\'+ @filename            
SET @SQL ='BULK INSERT tbl_uploadnbfc_clientlist FROM '''+@Path+''' WITH (FirstRow=1,KeepNULLS)'        
--print @SQL        
exec(@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Upload_NBFC_CreditNote
-- --------------------------------------------------
CREATE PROCEDURE usp_Upload_NBFC_CreditNote --'2010-05-01' ,'klkl'     
(      
 @DebitMonth AS DATETIME,    
 @filename as varchar(50)      
)      
AS      
BEGIN      
       
 SET NOCOUNT ON;      
     
 DELETE FROM intranet.RISK.DBO.nbfc_intamt_master   WHERE [Debit Month]=@DebitMonth      
 INSERT INTO intranet.RISK.DBO.nbfc_intamt_master       
   ([Client Code],Amount,[Name of Customer],[Address 1],[Address 2],[Address 3],City,      
      State,PIN,[PAN No],[Mobile No],[Debit Month],ImportDate,RptGenerateDate,GenerateFlg)      
  SELECT REPLACE([Client Code],'"',''),REPLACE(REPLACE(Amount,'"',''),',',''),REPLACE([Name of Customer],'"',''),  
   REPLACE([Address 1],'"',''),REPLACE([Address 2],'"',''),REPLACE([Address 3],'"',''),  
   REPLACE(City,'"',''),REPLACE(State,'"',''),REPLACE(PIN,'"',''),  
   'AAACM 6094R',REPLACE([Mobile No],'"',''),@DebitMonth,GETDATE(),NULL,0      
  FROM nbfc_intamt_temp   WHERE REPLACE([Client Code],'"','') IS NOT NULL  
       
     
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_NCDEX_BhavCopy
-- --------------------------------------------------
CREATE proc USP_UPLOAD_NCDEX_BhavCopy                              
(                                        
@filename as varchar(100) ,@date as varchar(11) ,@server as varchar(20)                   
)                                         
as                                            
set transaction  isolation  level read uncommitted                                            
                                
declare @path as varchar(100)                                        
declare @sql as varchar(1000)                                     
--declare @filename as varchar(100)                                        
--set @filename = 'NCDEX Bhav copy.csv'                      
--declare @date as varchar(11)                    
--set @date='22/04/2008'                              
 set @date=convert(datetime,@date,103)                             
Set @path='\\'+@server+'\d$\upload1\bhavcopy\' + @filename                
                                        
--alter table NCDEX_Bhav_Copy drop column tdate                             
truncate table temp_ncdex_bhav_copy                    
                                     
SET @SQL ='BULK INSERT temp_ncdex_bhav_copy FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS);              
drop table NCDEX_Bhav_Copy;              
select *,tdate='''+ @date+'''into NCDEX_Bhav_Copy from temp_ncdex_bhav_copy'              
insert into NCDEX_Bhav_Copy_hist             
select * from NCDEX_Bhav_Copy        
update bhavcopy_upload_date set updatedate=getdate() where segment='NCDX'        
 print @SQL                    
exec (@SQL)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_NEFTEXCEL
-- --------------------------------------------------
CREATE PROC USP_UPLOAD_NEFTEXCEL --'172.29.19.10'           
    (                                                                  
      
    @SERVER AS VARCHAR(25)                                            
    )                                                                    
    AS         
    BEGIN                                            
    SET NOCOUNT ON;                                         
    DECLARE @PATH AS VARCHAR(100)                                                                              
    DECLARE @SQL AS VARCHAR(1000)             
    --DECLARE @SQL1 AS VARCHAR(1000)                                   
    TRUNCATE TABLE test_neft                                  
    SET @PATH='\\'+@SERVER+'\D$\UPLOAD\68774.xls'                       
      
    --SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC],[BRANCH],[ADDRESS]                                  
      
    --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI]'' )'                                                                           
      
    -- SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                                 
      
    --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI]'' )'                                                                                                                  
  
    
          
      
      
    SET @SQL = 'INSERT INTO test_neft (BANK_NAME,IFSC_CODE,BRANCH_NAME,BRANCH_ADDRESS,micr_code) SELECT [BANK],[IFSC Code] ,[Branch Name],[ADDRESS],[MICR Code]                     
    FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [Sheet1$]'' )'         
      
      
    --SET @SQL1 = 'INSERT INTO TEST_RTGS (BANK_NAME,IFSC_CODE,BRANCH_NAME,BRANCH_ADDRESS) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                     
    --FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI$]'' )'         
      
    --PRINT @SQL             
      
    EXEC (@SQL)          
    --EXEC (@SQL1)       
 --FOR UPDATING ORIGINAL RTGS MASTER    
        
        
 --UPDATE INTRANET.RISK.DBO.RTGS_MASTER SET BANK_NAME=B.BANK_NAME,BRANCH_NAME=B.BRANCH_NAME,BRANCH_ADDRESS=B.BRANCH_ADDRESS    
 --FROM INTRANET.RISK.DBO.RTGS_MASTER R,    
 --(SELECT * FROM TEST_RTGS WITH (NOLOCK))B    
 --WHERE R.IFSC_CODE = B.IFSC_CODE    
    
 ----FOR EXTRA RECORDS INSERT IN RTGS MASTER     
    
 --INSERT INTO INTRANET.RISK.DBO.RTGS_MASTER(BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE)     
 --SELECT BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE     
 --FROM TEST_RTGS WITH(NOLOCK) WHERE IFSC_CODE NOT IN (    
 --SELECT IFSC_CODE FROM INTRANET.RISK.DBO.RTGS_MASTER WITH(NOLOCK))    
 --ORDER BY SR_NO       
     
        
        
          
    end      
    SET NOCOUNT off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_nsepd
-- --------------------------------------------------
CREATE procedure [dbo].[usp_upload_nsepd]              
(              
 @server as varchar(20),              
 @filename as varchar(50)              
)              
as              
begin              
  set nocount on;            
    select top 0 mkt,series,symbol,security,prev_cl_pr,open_price,high_price,low_price,close_price,net_trdval,net_trdqty,ind_sec,corp_ind,trades,hi_52_wk,lo_52_wk              
     into  #sifyupload_temp from intranet.misc.dbo.pd301203            
                 
    alter table #sifyupload_temp alter column net_trdval varchar(30)              
    alter table #sifyupload_temp alter column net_trdqty varchar(30)              
    alter table #sifyupload_temp alter column trades varchar(30)              
    alter table #sifyupload_temp alter column hi_52_wk varchar(30)      
    alter table #sifyupload_temp alter column lo_52_wk varchar(30)          
              
                 
           --note when alter the sp rowterminator is fixed it is special charecter it must be same.....      
    declare @str as varchar(500)               
                           
    set @str='bulk insert #sifyupload_temp from ''\\'+@server+'\d\upload1\selftrade\'+@filename+''' with (fieldterminator = '','', firstrow=2,rowterminator='''+(select char(10))+''', keepnulls)'                          
   --print(@str)                          
     exec(@str)                
 delete from  intranet.misc.dbo.pd301203 where fname=@filename                 
    insert into intranet.misc.dbo.pd301203          
    select *,fname=@filename,date=convert(char(11),getdate(),121)               
    from #sifyupload_temp where symbol<>'' and symbol is not null    
        
    insert into intranet.misc.dbo.logpdqe (fname,pddate,uploadby)    
    values(@filename,getdate(),'')              
   set nocount off;             
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_nsepd_01Apr2020
-- --------------------------------------------------
CREATE procedure [dbo].[usp_upload_nsepd_01Apr2020]            
(            
 @server as varchar(20),            
 @filename as varchar(50)            
)            
as            
begin            
  set nocount on;          
    select top 0 mkt,series,symbol,security,prev_cl_pr,open_price,high_price,low_price,close_price,net_trdval,net_trdqty,ind_sec,corp_ind,trades,hi_52_wk,lo_52_wk            
     into  #sifyupload_temp from intranet.misc.dbo.pd301203          
               
    alter table #sifyupload_temp alter column net_trdval varchar(30)            
    alter table #sifyupload_temp alter column net_trdqty varchar(30)            
    alter table #sifyupload_temp alter column trades varchar(30)            
    alter table #sifyupload_temp alter column hi_52_wk varchar(30)    
    alter table #sifyupload_temp alter column lo_52_wk varchar(30)        
            
               
           --note when alter the sp rowterminator is fixed it is special charecter it must be same.....    
    declare @str as varchar(500)             
                         
    set @str='bulk insert #sifyupload_temp from ''\\'+@server+'\c\upload\selftrade\'+@filename+''' with (fieldterminator = '','', firstrow=2,rowterminator='''', keepnulls)'                        
   --print(@str)                        
     exec(@str)              
	delete from  intranet.misc.dbo.pd301203 where fname=@filename               
    insert into intranet.misc.dbo.pd301203        
    select *,fname=@filename,date=convert(char(11),getdate(),121)             
    from #sifyupload_temp where symbol<>'' and symbol is not null  
      
    insert into intranet.misc.dbo.logpdqe (fname,pddate,uploadby)  
    values(@filename,getdate(),'')            
   set nocount off;           
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_nsepd_03jan2022
-- --------------------------------------------------
CREATE procedure [dbo].[usp_upload_nsepd_03jan2022]              
(              
 @server as varchar(20),              
 @filename as varchar(50)              
)              
as              
begin              
  set nocount on;            
    select top 0 mkt,series,symbol,security,prev_cl_pr,open_price,high_price,low_price,close_price,net_trdval,net_trdqty,ind_sec,corp_ind,trades,hi_52_wk,lo_52_wk              
     into  #sifyupload_temp from intranet.misc.dbo.pd301203            
                 
    alter table #sifyupload_temp alter column net_trdval varchar(30)              
    alter table #sifyupload_temp alter column net_trdqty varchar(30)              
    alter table #sifyupload_temp alter column trades varchar(30)              
    alter table #sifyupload_temp alter column hi_52_wk varchar(30)      
    alter table #sifyupload_temp alter column lo_52_wk varchar(30)          
              
                 
           --note when alter the sp rowterminator is fixed it is special charecter it must be same.....      
    declare @str as varchar(500)               
                           
    set @str='bulk insert #sifyupload_temp from ''\\'+@server+'\c\upload\selftrade\'+@filename+''' with (fieldterminator = '','', firstrow=2,rowterminator='''+(select char(10))+''', keepnulls)'                          
   --print(@str)                          
     exec(@str)                
 delete from  intranet.misc.dbo.pd301203 where fname=@filename                 
    insert into intranet.misc.dbo.pd301203          
    select *,fname=@filename,date=convert(char(11),getdate(),121)               
    from #sifyupload_temp where symbol<>'' and symbol is not null    
        
    insert into intranet.misc.dbo.logpdqe (fname,pddate,uploadby)    
    values(@filename,getdate(),'')              
   set nocount off;             
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_nsepd_09Mar2020
-- --------------------------------------------------
Create procedure [dbo].[usp_upload_nsepd_09Mar2020]            
(            
 @server as varchar(20),            
 @filename as varchar(50)            
)            
as            
begin            
  set nocount on;          
    select top 0 mkt,series,symbol,security,prev_cl_pr,open_price,high_price,low_price,close_price,net_trdval,net_trdqty,ind_sec,corp_ind,trades,hi_52_wk,lo_52_wk            
     into  #sifyupload_temp from intranet.misc.dbo.pd301203          
               
    alter table #sifyupload_temp alter column net_trdval varchar(30)            
    alter table #sifyupload_temp alter column net_trdqty varchar(30)            
    alter table #sifyupload_temp alter column trades varchar(30)            
    alter table #sifyupload_temp alter column hi_52_wk varchar(30)    
    alter table #sifyupload_temp alter column lo_52_wk varchar(30)        
            
               
           --note when alter the sp rowterminator is fixed it is special charecter it must be same.....    
    declare @str as varchar(500)             
                         
    set @str='bulk insert #sifyupload_temp from ''\\'+@server+'\c$\upload\selftrade\'+@filename+''' with (fieldterminator = '','', firstrow=2,rowterminator=''
'', keepnulls)'                        
   --print(@str)                        
     exec(@str)              
	delete from  intranet.misc.dbo.pd301203 where fname=@filename               
    insert into intranet.misc.dbo.pd301203        
    select *,fname=@filename,date=convert(char(11),getdate(),121)             
    from #sifyupload_temp where symbol<>'' and symbol is not null  
      
    insert into intranet.misc.dbo.logpdqe (fname,pddate,uploadby)  
    values(@filename,getdate(),'')            
   set nocount off;           
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_NSX_BHAVCOPY
-- --------------------------------------------------


CREATE PROC USP_UPLOAD_NSX_BHAVCOPY                              
(                                        
@FILENAME AS VARCHAR(100) ,@SERVER AS VARCHAR(20)                   
)                                         
AS                                            
SET TRANSACTION  ISOLATION  LEVEL READ UNCOMMITTED                                            
                                
DECLARE @PATH AS VARCHAR(100)                                        
DECLARE @SQL AS VARCHAR(1000)                                     
--DECLARE @FILENAME AS VARCHAR(100)                                        
--SET @FILENAME = 'NCDEX BHAV COPY.CSV'                      
                          
SET @PATH='\\'+@SERVER+'\D$\UPLOAD1\BHAVCOPY\' + @FILENAME                
                                                              
TRUNCATE TABLE NSX_BHAV_COPY                    
                                     
SET @SQL ='BULK INSERT NSX_BHAV_COPY  FROM '''+@PATH+''' WITH (FIELDTERMINATOR = ''|'', FIRSTROW=2,KEEPNULLS);'                   
    
-- PRINT @SQL                    
EXEC (@SQL)         
    
DELETE FROM  NSX_BHAV_COPY   WHERE SYMBOL IS NULL AND [INSTRUMENT] IS NULL    
UPDATE BHAVCOPY_UPLOAD_DATE SET UPDATEDATE=GETDATE() WHERE SEGMENT='NSX'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_upload_RTGSExcel
-- --------------------------------------------------
CREATE PROC USP_UPLOAD_RTGSEXCEL --'172.29.19.10'               
    (                                                                      
          
    @SERVER AS VARCHAR(25)                                                
    )                                                                        
    AS             
    BEGIN                                                
    SET NOCOUNT ON;                                             
    DECLARE @PATH AS VARCHAR(100)                                                                                  
    DECLARE @SQL AS VARCHAR(1000)                 
    DECLARE @SQL1 AS VARCHAR(1000)                                       
    TRUNCATE TABLE TEST_RTGS                                      
    SET @PATH='\\'+@SERVER+'\D$\UPLOAD\RTGEB1110.XLS'                           
          
    --SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC],[BRANCH],[ADDRESS]                                      
          
    --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI]'' )'                                                                               
          
    -- SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                                     
          
    --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI]'' )'                                                                                                                  
  
    
      
        
              
          
          
    SET @SQL = 'INSERT INTO TEST_RTGS (BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,ifsc_code) SELECT [BANK NAME],[BRANCH]  ,[ADDRESS],[IFSC]                       
    FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI$]'' )'             
          
          
    SET @SQL1 = 'INSERT INTO TEST_RTGS (BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,ifsc_code) SELECT [BANK NAME],[BRANCH]  ,[ADDRESS],[IFSC]                           
    FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI$]'' )'             
          
    --PRINT @SQL                 
    --PRINT @SQL1   
    EXEC (@SQL)              
    EXEC (@SQL1)           
    
    select * into #file1 from TEST_RTGS 
    
    select Ifsc_Code,cnt=count(Ifsc_Code) into #duplicate
     from #file1 with (nolock)
     group by Ifsc_Code having count(Ifsc_Code)>1
     
     select * from #duplicate
     
     delete from #file1 where Ifsc_Code in (select Ifsc_Code from #duplicate)
     
	SELECT IFSC_CODE into #t FROM INTRANET.RISK.DBO.RTGS_MASTER WITH(NOLOCK)
 
  UPDATE INTRANET.RISK.DBO.RTGS_MASTER SET BANK_NAME=B.BANK_NAME,BRANCH_NAME=B.BRANCH_NAME,BRANCH_ADDRESS=B.BRANCH_ADDRESS        
 FROM INTRANET.RISK.DBO.RTGS_MASTER R,        
 (SELECT * FROM #file1 )B        
 WHERE R.IFSC_CODE = B.IFSC_CODE            
             
 INSERT INTO INTRANET.RISK.DBO.RTGS_MASTER(BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE,MICR_CODE)         
 SELECT BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE,MICR_CODE         
 FROM #file1  WHERE IFSC_CODE NOT IN (        
 SELECT IFSC_CODE FROM #t )        
 
         
     
     
 --FOR UPDATING ORIGINAL RTGS MASTER        
            
            
 --UPDATE INTRANET.RISK.DBO.RTGS_MASTER SET BANK_NAME=B.BANK_NAME,BRANCH_NAME=B.BRANCH_NAME,BRANCH_ADDRESS=B.BRANCH_ADDRESS        
 --FROM INTRANET.RISK.DBO.RTGS_MASTER R,        
 --(SELECT * FROM TEST_RTGS WITH (NOLOCK))B        
 --WHERE R.IFSC_CODE = B.IFSC_CODE        
        
 ----FOR EXTRA RECORDS INSERT IN RTGS MASTER         
        
 --INSERT INTO INTRANET.RISK.DBO.RTGS_MASTER(BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE)         
 --SELECT BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE         
 --FROM TEST_RTGS WITH(NOLOCK) WHERE IFSC_CODE NOT IN (        
 --SELECT IFSC_CODE FROM INTRANET.RISK.DBO.RTGS_MASTER WITH(NOLOCK))        
 --ORDER BY SR_NO           
         
            
            
              
    end          
    SET NOCOUNT off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_RTGSEXCEL1
-- --------------------------------------------------
CREATE PROC [dbo].[USP_UPLOAD_RTGSEXCEL1] --'196.1.115.183'                              
    (                                                                                      
                          
    @SERVER AS VARCHAR(25)                                                                
    )                                                                                        
    AS                             
    TRUNCATE TABLE TEST_RTGS                    
    TRUNCATE TABLE TEST_neft       
    EXEC [MIS\SQLEXPRESS].XLSUPLOAD.DBO.USP_UPLOAD_RTGSEXCEL1 @server                                                             
 --   SET NOCOUNT ON;                                                             
 --   DECLARE @PATH AS VARCHAR(100)                      
 --   DECLARE @PATH1 AS VARCHAR(100)                                                                                                  
 --   DECLARE @SQL AS VARCHAR(1000)                                 
 --   DECLARE @SQL1 AS VARCHAR(1000)                      
 --   DECLARE @SQL2 AS VARCHAR(1000)                                                        
                                                         
 --   SET @PATH='\\'+@SERVER+'\D$\UPLOAD\RTGEB1110.XLS'                                           
 --   SET @PATH1='\\'+@SERVER+'\D$\UPLOAD\68774.xls'                        
 ----   --SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC],[BRANCH],[ADDRESS]                                                      
                          
 ----   --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI]'' )'                                                                                               
                          
 ----   -- SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                                                     
                          
 ----   --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI]'' )'                                                                                                              
    
    
        
        
          
            
              
                
                  
                    
                      
                        
                              
                          
                          
 --  SET @SQL = 'INSERT INTO TEST_RTGS (BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,ifsc_code) SELECT [BANK NAME],[BRANCH]  ,[ADDRESS],[IFSC]                                         
 --   FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI$]'' )'                               
                            
                            
 --   SET @SQL1 = 'INSERT INTO TEST_RTGS (BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,ifsc_code) SELECT [BANK NAME],[BRANCH]  ,[ADDRESS],[IFSC]                                             
 --   FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI$]'' )'                               
                            
                          
 --   SET @SQL2 = 'INSERT INTO TEST_neft (BANK_NAME,IFSC_CODE,BRANCH_NAME,BRANCH_ADDRESS,micr_code) SELECT [Bank],[IFSC Code] ,[Branch Name],[ADDRESS],[MICR Code]=Convert(numeric(28,0),[MICR Code])                                         
 --   FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH1+''',''SELECT * FROM [Sheet 1$]'' )'                             
                          
                          
 ----   --PRINT @SQL                                 
                          
 --   EXEC (@SQL)                              
 --   EXEC (@SQL1)                      
 --   EXEC (@SQL2)             
 ------FOR UPDATING ORIGINAL RTGS MASTER                        
                            
                            
 --UPDATE INTRANET.RISK.DBO.RTGS_MASTER SET BANK_NAME=B.BANK_NAME,BRANCH_NAME=B.BRANCH_NAME,BRANCH_ADDRESS=B.BRANCH_ADDRESS,Micr_Code=ltrim(rtrim(B.micr_code))                       
 --FROM INTRANET.RISK.DBO.RTGS_MASTER R,                        
 --(SELECT * FROM TEST_neft WITH (NOLOCK))B                        
 --WHERE ltrim(rtrim(R.IFSC_CODE)) = ltrim(rtrim(B.IFSC_CODE))                        
                        
 ----FOR EXTRA RECORDS INSERT IN RTGS MASTER  FROM TEST_NEFT                       
                        
 --INSERT INTO INTRANET.RISK.DBO.RTGS_MASTER(BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE,micr_code)                         
 --SELECT BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, ltrim(rtrim(IFSC_CODE)) ,ltrim(rtrim(micr_code))                     
 --FROM TEST_neft WITH(NOLOCK) WHERE IFSC_CODE NOT IN (                        
 --SELECT ltrim(rtrim(IFSC_CODE)) FROM INTRANET.RISK.DBO.RTGS_MASTER WITH(NOLOCK))                        
 --ORDER BY SR_NO                           
                     
 ----FOR EXTRA RECORDS INSERT IN RTGS MASTER  FROM TEST_RTGS                       
                     
 -- INSERT INTO INTRANET.RISK.DBO.RTGS_MASTER(BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE)                       
 --SELECT BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, ltrim(rtrim(IFSC_CODE))                       
 --FROM TEST_RTGS WITH(NOLOCK) WHERE IFSC_CODE NOT IN ( SELECT ltrim(rtrim(IFSC_CODE)) FROM INTRANET.RISK.DBO.RTGS_MASTER WITH(NOLOCK))                        
 --ORDER BY SR_NO                            
                            
                            
                              
                          
    SET NOCOUNT off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_RTGSEXCEL4
-- --------------------------------------------------
 create PROC USP_UPLOAD_RTGSEXCEL4 --'172.29.19.10'       
    (                                                              
  
    @SERVER AS VARCHAR(25)                                        
    )                                                                
    AS     
    BEGIN                                        
    SET NOCOUNT ON;                                     
    DECLARE @PATH AS VARCHAR(100)
    DECLARE @PATH1 AS VARCHAR(100)                                                                           
    DECLARE @SQL AS VARCHAR(1000)         
    DECLARE @SQL1 AS VARCHAR(1000)
    DECLARE @SQL2 AS VARCHAR(1000)                               
    TRUNCATE TABLE TEST_RTGS                              
    SET @PATH='\\'+@SERVER+'\D$\UPLOAD\RTGEB1110.XLS' 
     SET @PATH1='\\'+@SERVER+'\D$\UPLOAD\68774.xls'                   
  
    --SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC],[BRANCH],[ADDRESS]                              
  
    --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI]'' )'                                                                       
  
    -- SET @SQL = 'INSERT INTO TEST_RTGS(BANK_NAME,BRANCH_NAME,BRANCH_ADDRESS,IFSC_CODE) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                             
  
    --  FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI]'' )'                                                                                                                  
      
  
  
    SET @SQL = 'INSERT INTO TEST_RTGS (BANK_NAME,IFSC_CODE,BRANCH_NAME,BRANCH_ADDRESS) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                 
    FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_M_W_DI$]'' )'     
  
  
    SET @SQL1 = 'INSERT INTO TEST_RTGS (BANK_NAME,IFSC_CODE,BRANCH_NAME,BRANCH_ADDRESS) SELECT [BANK NAME],[IFSC] ,[BRANCH],[ADDRESS]                 
    FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [RTGS_BRANCHES_SORT_STATE_A_L_DI$]'' )'     
  
    SET @SQL2 = 'INSERT INTO test_neft (BANK_NAME,IFSC_CODE,BRANCH_NAME,BRANCH_ADDRESS,micr_code) SELECT [BANK],[IFSC Code] ,[Branch Name],[ADDRESS],[MICR Code]                     
    FROM OPENROWSET(''MICROSOFT.ACE.OLEDB.12.0'',''EXCEL 12.0;DATABASE='+@PATH+''',''SELECT * FROM [Sheet1$]'' )'         
      
    
    --PRINT @SQL         
  
    EXEC (@SQL)      
    EXEC (@SQL1)
    EXEC (@SQL2)     
	--FOR UPDATING ORIGINAL RTGS MASTER
				
				
	--UPDATE INTRANET.RISK.DBO.RTGS_MASTER SET BANK_NAME=B.BANK_NAME,BRANCH_NAME=B.BRANCH_NAME,BRANCH_ADDRESS=B.BRANCH_ADDRESS
	--FROM INTRANET.RISK.DBO.RTGS_MASTER R,
	--(SELECT * FROM TEST_RTGS WITH (NOLOCK))B
	--WHERE R.IFSC_CODE = B.IFSC_CODE

	----FOR EXTRA RECORDS INSERT IN RTGS MASTER 

	--INSERT INTO INTRANET.RISK.DBO.RTGS_MASTER(BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE) 
	--SELECT BANK_NAME, BRANCH_NAME, BRANCH_ADDRESS, IFSC_CODE 
	--FROM TEST_RTGS WITH(NOLOCK) WHERE IFSC_CODE NOT IN (
	--SELECT IFSC_CODE FROM INTRANET.RISK.DBO.RTGS_MASTER WITH(NOLOCK))
	--ORDER BY SR_NO			
	
				
    
      
    end  
    SET NOCOUNT off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_Upload2FactorCli
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_Upload2FactorCli]
(
 @filename  Varchar(20),
 @Upload_By Varchar(20)
)
As
Begin
 Set Nocount On;

  Insert Into INTRANET.risk.dbo.Tbl_2factorcli_log
  Select *,Getdate()
  From   INTRANET.risk.dbo.Tbl_2factorcli With(nolock)
  Where  Convert(Varchar, Upload_date, 106) = Convert(Varchar, Getdate(), 106)

  Delete From INTRANET.risk.dbo.Tbl_2factorcli
  Where  Convert(Varchar, Upload_date, 106) = Convert(Varchar, Getdate(), 106)

  Insert Into INTRANET.risk.dbo.Tbl_2factorcli
  Select Userid,Group_id,Isnull(Token, ''),Vendor,Applicationallowed,Loginlevel,Transactionlevel,
         @Upload_By,
         Getdate()
  From   Tbl_2factorcli_temp With(nolock)

 Set Nocount Off;
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UploadBankMaster
-- --------------------------------------------------
CREATE Procedure [dbo].[usp_UploadBankMaster]
(
 @FileName Varchar(50)
)
As
Begin
   Set NOCOUNT On;

   Delete From INTRANET.risk.dbo.Ebroking_bank_id

   Insert Into INTRANET.risk.dbo.Ebroking_bank_id
   Select Bankid,
          Bankname=Ltrim(Rtrim(Bankname)),
          [Status]=(Case
                     When Ltrim(Rtrim([Status])) Like 'ACTIVE%' Then 1
                     Else 0
                    End),
          Mappingcode,
          Getdate()
   From   Bank_master
   Order  By Bankid

   Set NOCOUNT Off;
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_uploadClient
-- --------------------------------------------------
CREATE proc [dbo].[usp_uploadClient]    
(
@File varchar(500),
@server varchar(100)
)    
as    
declare @path as varchar(100)                                
declare @sql as varchar(1000)                      
--set @filename = 'pledge'                       
truncate table tbl_Upload_ClientID    
    
/*set @path = (Select uploadserver from [CSOKYC-6].Upload.DBO.Global_Upload where upd_srno = 2)      
set @path = @path +'Pledgefile\' + @filename*/    
    
--set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\CSV_GetClient\'+@File     
set @path='\\'+@server+'\d$\upload1\CSV_GetClient\'+@File     
SET @SQL = 'BULK INSERT tbl_Upload_ClientID FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=1,KeepNULLS)'                                
---print @SQL                        
exec (@sql)     
    
select a.Cl_code as [Client Code], a.long_name as [Name],    
a.branch_cd as [Branch],    
a.sub_broker as [Sub Broker],     
a.l_address1+' , '+a.l_address2+' ,'+l_address3+' , '+l_city+' , '+l_state as [Address], l_zip as [Pin No.]    
from intranet.risk.dbo.client_details a, tbl_Upload_ClientID b (nolock)     
where a.cl_code = b.clientid

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOADCTCLEmp
-- --------------------------------------------------
CREATE PROC [dbo].[USP_UPLOADCTCLEmp]
(              
@filename as varchar(100)              
)               
as                  
--print @filename      
set transaction  isolation  level read uncommitted                  
--truncate table uploadtempemp
declare @path as varchar(200)              
declare @sql as varchar(1000)              
--set @path='G:\MIS\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
--set @path='\\INHOUSEALLAPP-FS.angelone.in\D$\Inetpub\wwwroot\CTCL1.1\Uploaded\' + @filename              
----print @filename      
----print @path      
--      
--SET @SQL = 'BULK INSERT uploadtempemp FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'              
--print @SQL              
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UploadIPOBankReceipt
-- --------------------------------------------------
  
-- =============================================  
-- Author:  <Amit>  
-- Create date: <07-10-2010>  
-- Description: <Upload IPO Bank Receipt>  
-- =============================================  
CREATE PROCEDURE usp_UploadIPOBankReceipt  
(  
  @filename as varchar(50)   
)  
AS  
BEGIN  
   
 SET NOCOUNT ON;  
  ----Insert into history table 
	 
  INSERT INTO INTRANET.MISC.DBO.IPOBANKRECEIPTHISTORY   
   SELECT *,GETDATE() FROM INTRANET.MISC.DBO.IPOBANKRECEIPT  
  
  ----Trancate Table  
  DELETE FROM INTRANET.MISC.DBO.IPOBANKRECEIPT   
    
  ----Upload Data into main table  
  INSERT INTO INTRANET.MISC.DBO.IPOBANKRECEIPT   
   SELECT	SR_No,CONVERT(DATETIME,Edate,103) AS Edate,
			CONVERT(DATETIME,Vdate,103) AS Vdate,Cltcode,
			CONVERT(MONEY,Amount) AS Amount,DRCR,
			Narration,BankCode,
			BankName,DDNo,
			Branchcode,	BranchName,
			chqmode,CONVERT(DATETIME,chqdate,103) AS chqdate,
			chqname,LTRIM(RTRIM(clmode)) AS clmode
	 FROM IPOBANKRECEIPT_TEMP  
  
 SET NOCOUNT OFF;  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UploadNonPromotersHolding
-- --------------------------------------------------
CREATE proc usp_UploadNonPromotersHolding
(	
	@fileName varchar(20)
)
as
begin
set nocount on;


insert into tblNonPromotersHolding
select *,replace(convert(varchar(11),getdate(),103),'/',''),@fileName,GETDATE(),0 from tblNonPromotersHolding_Temp

delete from INTRANET.risk.dbo.tblNonPromotersHolding

insert into INTRANET.risk.dbo.tblNonPromotersHolding (srno,symbol,volume,date,UploadDt)
select srno,symbol,volume,date,GETDATE() from tblNonPromotersHolding
where uploded=0


update tblNonPromotersHolding set uploded=1
where uploded=0 and fname=@fileName

set nocount off;
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_UploadNRIPISLimit
-- --------------------------------------------------
CREATE proc usp_UploadNRIPISLimit
(
	@filename varchar(50)
)
as
set nocount on
	delete from intranet.risk.dbo.tblNRIPISLimit  where fname=@filename
	insert into intranet.risk.dbo.tblNRIPISLimitHistory
	select party_code=upper(party_code),LmtAllowEquity,LmtAllowCommodity,PMSScheme,FName,UploadDT,
	CONVERT(varchar(11),GETDATE(),106)
	from intranet.risk.dbo.tblNRIPISLimit with(nolock) where fname=@filename
	
	insert into intranet.risk.dbo.tblNRIPISLimit
	select *,@filename,GETDATE()
	from tblNRIPISLimit_temp (nolock)
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_XLSU_CDSLuploadfile
-- --------------------------------------------------
CREATE proc usp_XLSU_CDSLuploadfile
(@FILE varchar(200))
AS
BEGIN

if exists (select 1 from sysobjects where name='tbl_test' and type='u')
Drop table tbl_test

CREATE TABLE tbl_test          
  (                            
 [Sr. No.]  INT NOT NULL,           
 [Client Code] VARCHAR(25),          
 [DP Id] VARCHAR(8),          
 [Client Id] VARCHAR(16),          
 ISIN VARCHAR(12),          
 [Scrip Name] VARCHAR(50),          
 Quantity NUMERIC(16,3),          
 [Our Beneficiary A/c] VARCHAR(16)          
 --[FILENAME] VARCHAR(150),          
 --UPD_DT DATETIME          
  )          
--DECLARE @FILE VARCHAR(500)  , @UPLOAD_TYPE VARCHAR(25)        
--SET @UPLOAD_TYPE='CDSL'        
--SET @FILE='\\172.29.19.10\d$\upload1\CDSL_CONVERTER\CDSLtoCDSL120313.csv'          
DECLARE @QRY VARCHAR(5000)           
SET @QRY='          
BULK          
INSERT tbl_test          
FROM '''+@FILE+'''           
WITH          
(          
FIELDTERMINATOR = '','',          
ROWTERMINATOR = ''\n'',          
firstrow=2          
)          
'          
--PRINT(@QRY)          
EXEC (@QRY)  

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_xml_bulkupload
-- --------------------------------------------------
CREATE proc [dbo].[USP_xml_bulkupload]                                 
(@filename as varchar(100),@val as Varchar(10))                                       
as                                          
                            
set transaction  isolation  level read uncommitted                                          
                           
declare @path as varchar(100)                                      
declare @sql as varchar(1000)                                   
                  
          
if @val = 'Pan'        
begin                          
truncate table Tbl_reversefile                      
                            
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename                                      
SET @SQL ='BULK INSERT Tbl_reversefile  FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=1);'                                    
--print @sql                      
exec (@sql)                      
                      
insert into intranet.risk.dbo.hist_Pan_MismatchReport                  
/*          
select a.sr_no,first_name+mid_name+last_name as Client_Name,replace(b.name,'','') as Name,Party_code,pan_gir_no,dob,Entry_Date,First_Name,Mid_Name,Last_Name from intranet.risk.dbo.Tbl_xml_file a                            
inner join Tbl_reversefile b                            
on a.sr_no = b.sr_no */          
select * from          
(select a.sr_no,first_name+mid_name+last_name as Client_Name,replace(b.name,'','') as Name,Party_code,pan_gir_no,dob,Entry_Date,First_Name,Mid_Name,Last_Name from intranet.risk.dbo.Tbl_xml_file a                            
inner join Tbl_reversefile b                            
on a.sr_no = b.sr_no) x where Party_code not in                 
(          
select party_code from intranet.risk.dbo.hist_Pan_MismatchReport where party_code in          
(          
select Party_code from intranet.risk.dbo.Tbl_xml_file a                            
inner join Tbl_reversefile b                            
on a.sr_no = b.sr_no                  
)          
)          
end        
else        
begin         
truncate table Tbl_ReverseUCCfile                      
                            
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename                                      
SET @SQL ='BULK INSERT Tbl_ReverseUCCfile  FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=1);'                                    
--print @sql                      
exec (@sql)        
      
truncate table kyc..hist_Ucc_Mismatch      
      
insert into kyc..hist_Ucc_Mismatch      
select convert(numeric,a.sr_no) as sr_no,Pan_No=b.Fld_Pan_No,Client_Name=b.fld_Name,IT_Name=replace(a.name,'',''),Party_code=b.fld_PartyCode,    
replace(convert(varchar(10),convert(datetime,Fld_Dob,103),111),'/','-') as dob,  
substring(b.Fld_Name,0,charindex(' ',replace(b.Fld_Name,'&',' '))) as First_Name,    
substring(b.Fld_Name,charindex(' ',replace(b.Fld_Name,'&',' ')),charindex(' ',substring(replace(b.Fld_Name,'&',' '),charindex(' ',replace(b.Fld_Name,'&',' '))+1,100)))  as Mid_Name,                          
substring(b.Fld_Name,charindex(' ',replace(b.Fld_Name,'&',' '))+charindex(' ',substring(replace(b.Fld_Name,'&',' '),charindex(' ',replace(b.Fld_Name,'&',' '))+1,100)),100) as Last_Name,                                                  
'ANGEL   BROKING     LIMITED' as Address,'' from mis.upload.dbo.Tbl_ReverseUCCfile a inner join           
mis.kyc.dbo.tbl_Ucc_Data b on a.sr_no = b.sr_no     
        
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USPJV_back_bulkupload
-- --------------------------------------------------
CREATE proc [dbo].[USPJV_back_bulkupload]       
(            
@filename as varchar(100)            
)             
as                
set transaction  isolation  level read uncommitted                
declare @path as varchar(100)            
declare @sql as varchar(1000)            
    
delete from MIS.JVFILE.DBO.back_jvrequest where BatchNo = 0    
truncate table Back_Histoy_bulkUpload    
set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename            
SET @SQL = 'BULK INSERT Back_Histoy_bulkUpload FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'            
-- print @SQL            
exec (@sql)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USPJV_bulkupload
-- --------------------------------------------------
CREATE proc [dbo].[USPJV_bulkupload]       
(            
@filename as varchar(100),
@IP as varchar(50)           
)             
as                
set transaction  isolation  level read uncommitted                
declare @path as varchar(100)            
declare @sql as varchar(1000)      
      
declare @dt as varchar(11)                          
set @dt =(select convert(varchar(11),getdate(),111))                     
      
delete from Mis.JVFILE.DBo.jvrequest where JVdate = @dt and BatchNo = 0      
            
truncate table Histoy_bulkUpload        
set @path= '\\'+@IP+'\d$\upload1\' + @filename                  
--set @path='\\INHOUSEALLAPP-FS.angelone.in\d$\upload1\' + @filename            
SET @SQL = 'BULK INSERT Histoy_bulkUpload FROM '''+@Path+''' WITH (FIELDTERMINATOR = '','', FirstRow=2,KeepNULLS)'            
-- print @SQL            
exec (@sql)

GO

-- --------------------------------------------------
-- TABLE dbo.a
-- --------------------------------------------------
CREATE TABLE [dbo].[a]
(
    [C_PARTY_NETWORK_ID] VARCHAR(255) NULL,
    [A_PARTY_ID] VARCHAR(255) NULL,
    [B_PARTY_ID] VARCHAR(255) NULL,
    [CHARGE_START_DATE] VARCHAR(255) NULL,
    [SUBSTR(NE.GENERAL_1,1,10)] VARCHAR(255) NULL,
    [DURATION] VARCHAR(255) NULL,
    [SUBSTR(NE.GENERAL_4,1,20)] VARCHAR(255) NULL,
    [SUBSTR(NE.GENERAL_5,1,20)] VARCHAR(255) NULL,
    [GENERAL_3] VARCHAR(255) NULL,
    [CHARGE] VARCHAR(255) NULL,
    [a_TelecomCircle] VARCHAR(255) NULL,
    [b_TelecomCircle] VARCHAR(255) NULL,
    [AngelCharge] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.aaa
-- --------------------------------------------------
CREATE TABLE [dbo].[aaa]
(
    [merit] NCHAR(10) NULL,
    [upload] NCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ABLAgeing
-- --------------------------------------------------
CREATE TABLE [dbo].[ABLAgeing]
(
    [Column 0] NVARCHAR(50) NULL,
    [Column 1] NVARCHAR(50) NULL,
    [Column 2] NVARCHAR(50) NULL,
    [Column 3] NVARCHAR(50) NULL,
    [Column 4] NVARCHAR(50) NULL,
    [Column 5] NVARCHAR(50) NULL,
    [Column 6] NVARCHAR(50) NULL,
    [Column 7] NVARCHAR(50) NULL,
    [Column 8] NVARCHAR(50) NULL,
    [Column 9] NVARCHAR(50) NULL,
    [Column 10] NVARCHAR(50) NULL,
    [Column 11] NVARCHAR(50) NULL,
    [Column 12] NVARCHAR(50) NULL,
    [Column 13] NVARCHAR(50) NULL,
    [Column 14] NVARCHAR(50) NULL,
    [Column 15] NVARCHAR(50) NULL,
    [Column 16] NVARCHAR(50) NULL,
    [Column 17] NVARCHAR(50) NULL,
    [Column 18] NVARCHAR(50) NULL,
    [Column 19] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.add_new_client_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[add_new_client_temp]
(
    [party_code] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.addnewcli_file
-- --------------------------------------------------
CREATE TABLE [dbo].[addnewcli_file]
(
    [OpCode] VARCHAR(25) NULL,
    [User_Id] VARCHAR(25) NULL,
    [Group_Id] VARCHAR(25) NULL,
    [UserName] VARCHAR(175) NULL,
    [Password] VARCHAR(25) NULL,
    [Category] VARCHAR(25) NULL,
    [Address1] VARCHAR(175) NULL,
    [Address2] VARCHAR(75) NULL,
    [City] VARCHAR(75) NULL,
    [State_pin] VARCHAR(25) NULL,
    [Tel_No] VARCHAR(25) NULL,
    [Fax_No] VARCHAR(25) NULL,
    [Email] VARCHAR(75) NULL,
    [Status] VARCHAR(25) NULL,
    [Brokerage] VARCHAR(25) NULL,
    [Surv_On] VARCHAR(25) NULL,
    [Surv_Auto] VARCHAR(25) NULL,
    [BankDPOnOff] VARCHAR(25) NULL,
    [ParticipantCode] VARCHAR(25) NULL,
    [Filler1] VARCHAR(25) NULL,
    [Filler2] VARCHAR(25) NULL,
    [Filler3] VARCHAR(25) NULL,
    [Filler4] VARCHAR(25) NULL,
    [Trading_Allowed] VARCHAR(25) NULL,
    [ClientValidationOnOff] VARCHAR(25) NULL,
    [SpanOnOff] VARCHAR(25) NULL,
    [DervPartCode] VARCHAR(25) NULL,
    [IP_Address] VARCHAR(25) NULL,
    [MaxNoOfOrder] VARCHAR(25) NULL,
    [Max_BCast_Scrips] VARCHAR(25) NULL,
    [Alias_DealerId] VARCHAR(25) NULL,
    [Family_Name] VARCHAR(25) NULL,
    [EqFlag] VARCHAR(25) NULL,
    [DervFlag] VARCHAR(25) NULL,
    [CombFlag] VARCHAR(25) NULL,
    [BSEEq] VARCHAR(25) NULL,
    [NEBEComb] VARCHAR(25) NULL,
    [NEBEEq] VARCHAR(25) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(25) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(25) NULL,
    [Branch_Name] VARCHAR(25) NULL,
    [Derv_CTCL_BranchId] VARCHAR(25) NULL,
    [Derv_CTCL_Id] VARCHAR(25) NULL,
    [Group_Admin] VARCHAR(25) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(25) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(25) NULL,
    [Login_Allowed] VARCHAR(25) NULL,
    [Participant_Type] VARCHAR(25) NULL,
    [DIET] VARCHAR(25) NULL,
    [Net] VARCHAR(25) NULL,
    [iWin] VARCHAR(25) NULL,
    [NetNetLite] VARCHAR(25) NULL,
    [MCX_CTCL_BranchId] VARCHAR(25) NULL,
    [MCX_CTCL_Id] VARCHAR(25) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(25) NULL,
    [NCDEX_CTCL_Id] VARCHAR(25) NULL,
    [Product_Type] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.angelids
-- --------------------------------------------------
CREATE TABLE [dbo].[angelids]
(
    [clientcode] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Annexure_B
-- --------------------------------------------------
CREATE TABLE [dbo].[Annexure_B]
(
    [No#] FLOAT NULL,
    [Entity / Individual Name] NVARCHAR(255) NULL,
    [ADDRESS] NVARCHAR(255) NULL,
    [PAN] NVARCHAR(255) NULL,
    [Date of Order] DATETIME NULL,
    [Order No#] NVARCHAR(255) NULL,
    [Brief Particulars] NTEXT NULL,
    [Start Date] DATETIME NULL,
    [End Date] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Approve
-- --------------------------------------------------
CREATE TABLE [dbo].[Approve]
(
    [TrxDate] VARCHAR(255) NULL,
    [InstrumentType] VARCHAR(255) NULL,
    [Symbol] VARCHAR(255) NULL,
    [ExpiryDate] VARCHAR(255) NULL,
    [StrikePrice] VARCHAR(255) NULL,
    [OptionType] VARCHAR(255) NULL,
    [OpenInterest] VARCHAR(255) NULL,
    [ClosingRate] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Asian_Basket
-- --------------------------------------------------
CREATE TABLE [dbo].[Asian_Basket]
(
    [A] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Back_Histoy_bulkUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[Back_Histoy_bulkUpload]
(
    [FCode] VARCHAR(50) NULL,
    [TCode] VARCHAR(50) NULL,
    [FSegment] VARCHAR(50) NULL,
    [TSegment] VARCHAR(50) NULL,
    [Amt] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.backup_tbl_pincity_master
-- --------------------------------------------------
CREATE TABLE [dbo].[backup_tbl_pincity_master]
(
    [State] VARCHAR(100) NULL,
    [City] VARCHAR(100) NULL,
    [Pin_Code] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Bak_SECURITYHAIRCUT
-- --------------------------------------------------
CREATE TABLE [dbo].[Bak_SECURITYHAIRCUT]
(
    [EffDate] DATETIME NOT NULL,
    [Exchange] VARCHAR(3) NOT NULL,
    [Segment] VARCHAR(20) NOT NULL,
    [Client_Type] VARCHAR(4) NULL,
    [Party_code] VARCHAR(10) NULL,
    [Scrip_Cd] VARCHAR(15) NULL,
    [Series] VARCHAR(3) NULL,
    [Group_Cd] VARCHAR(20) NULL,
    [Isin] VARCHAR(15) NULL,
    [Haircut] NUMERIC(18, 2) NOT NULL,
    [End_Date] DATETIME NULL,
    [Active] TINYINT NULL,
    [Tcode] NUMERIC(18, 0) NULL,
    [Remarks] VARCHAR(100) NULL,
    [LoginName] VARCHAR(25) NULL,
    [LoginTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Bank_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Bank_Master]
(
    [BankID] VARCHAR(50) NULL,
    [BankID1] VARCHAR(50) NULL,
    [BankName] VARCHAR(250) NULL,
    [MappingCode] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BANKCMS
-- --------------------------------------------------
CREATE TABLE [dbo].[BANKCMS]
(
    [row_type] VARCHAR(255) NULL,
    [entry_id] VARCHAR(255) NULL,
    [type_of_en] VARCHAR(255) NULL,
    [dr_cr] VARCHAR(255) NULL,
    [entry_amt] VARCHAR(255) NULL,
    [val_dt] VARCHAR(255) NULL,
    [post_dt] VARCHAR(255) NULL,
    [prod_code] VARCHAR(255) NULL,
    [pkup_loc] VARCHAR(255) NULL,
    [pkup_pt] VARCHAR(255) NULL,
    [pkup_dt] VARCHAR(255) NULL,
    [dept_slip] VARCHAR(255) NULL,
    [dept_dt] VARCHAR(255) NULL,
    [dept_amt] VARCHAR(255) NULL,
    [no_of_inst] VARCHAR(255) NULL,
    [dept_rmk] VARCHAR(255) NULL,
    [inst_no] VARCHAR(255) NULL,
    [drawee_bk] VARCHAR(255) NULL,
    [cl_loc] VARCHAR(255) NULL,
    [inst_amt] VARCHAR(255) NULL,
    [inst_dt] VARCHAR(255) NULL,
    [drawer_nam] VARCHAR(255) NULL,
    [enric_details] VARCHAR(255) NULL,
    [return reason] VARCHAR(255) NULL,
    [Col025] VARCHAR(7552) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bhavcopy_upload_date
-- --------------------------------------------------
CREATE TABLE [dbo].[bhavcopy_upload_date]
(
    [segment] VARCHAR(10) NULL,
    [updatedate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Bill_generate
-- --------------------------------------------------
CREATE TABLE [dbo].[Bill_generate]
(
    [Cycle] VARCHAR(50) NULL,
    [ISIN] VARCHAR(50) NULL,
    [DPID] VARCHAR(50) NULL,
    [DP Name] VARCHAR(50) NULL,
    [CLID] VARCHAR(50) NULL,
    [Client Name] VARCHAR(50) NULL,
    [Qty] VARCHAR(50) NULL,
    [Start Date] VARCHAR(50) NULL,
    [End Date] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL,
    [Amount Inc lST] MONEY NULL,
    [WH Name] VARCHAR(50) NULL,
    [Commodity] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [WH Code] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_BSE]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [scripID] INT NOT NULL,
    [ScriptCode] VARCHAR(50) NULL,
    [BseScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [Delete_status] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_BSE(16-4-09)
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_BSE(16-4-09)]
(
    [scripID] INT IDENTITY(1,1) NOT NULL,
    [ScriptCode] VARCHAR(50) NULL,
    [BseScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [Delete_status] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_Bse_15072009
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_Bse_15072009]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [scripID] INT NOT NULL,
    [ScriptCode] VARCHAR(50) NULL,
    [BseScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [Delete_status] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_Bse_27072010
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_Bse_27072010]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [scripID] INT NOT NULL,
    [ScriptCode] VARCHAR(50) NULL,
    [BseScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [Delete_status] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_nse]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ScriptCode] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [ScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [CapitalOfCo] VARCHAR(50) NOT NULL,
    [delete_status] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_Nse(16-4-09)
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_Nse(16-4-09)]
(
    [ScriptCode] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [ScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [CapitalOfCo] VARCHAR(50) NOT NULL,
    [delete_status] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BlockScrip_nse_632010
-- --------------------------------------------------
CREATE TABLE [dbo].[BlockScrip_nse_632010]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ScriptCode] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [ScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [CapitalOfCo] VARCHAR(50) NOT NULL,
    [delete_status] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Book1
-- --------------------------------------------------
CREATE TABLE [dbo].[Book1]
(
    [Code] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BPAN
-- --------------------------------------------------
CREATE TABLE [dbo].[BPAN]
(
    [UniqueSRNO] INT IDENTITY(1,1) NOT NULL,
    [Cl_Code] VARCHAR(30) NULL,
    [Pan] VARCHAR(30) NULL,
    [firstname] VARCHAR(70) NULL,
    [midname] VARCHAR(50) NULL,
    [lastname] VARCHAR(50) NULL,
    [dob] DATETIME NULL,
    [address] VARCHAR(40) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.br_region
-- --------------------------------------------------
CREATE TABLE [dbo].[br_region]
(
    [Branch code] NVARCHAR(50) NULL,
    [Dev] NVARCHAR(50) NULL,
    [Region] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.branch_cms
-- --------------------------------------------------
CREATE TABLE [dbo].[branch_cms]
(
    [jv] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.branch_csv
-- --------------------------------------------------
CREATE TABLE [dbo].[branch_csv]
(
    [Branch] VARCHAR(255) NULL,
    [Email] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.branch_without_email
-- --------------------------------------------------
CREATE TABLE [dbo].[branch_without_email]
(
    [jv] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.brsub
-- --------------------------------------------------
CREATE TABLE [dbo].[brsub]
(
    [party_code] VARCHAR(10) NULL,
    [before_5] MONEY NULL,
    [after_5] MONEY NULL,
    [new_partycode] VARCHAR(10) NULL,
    [branch_cd] VARCHAR(10) NULL,
    [sub_broker] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bsccsv
-- --------------------------------------------------
CREATE TABLE [dbo].[bsccsv]
(
    [tradingcode] VARCHAR(100) NULL,
    [clientcode] VARCHAR(100) NULL,
    [CLT_NAME] VARCHAR(MAX) NULL,
    [statuss] VARCHAR(MAX) NULL,
    [existing] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BSE_BlockScript_Temp_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[BSE_BlockScript_Temp_upload]
(
    [SCRIPCODE] INT NULL,
    [EXCHNAGE] VARCHAR(7) NULL,
    [SYMBOL] VARCHAR(15) NULL,
    [SCRIPNAME] VARCHAR(50) NULL,
    [a] VARCHAR(20) NULL,
    [EQUITY_DEBENTURE] VARCHAR(3) NULL,
    [SCRIPGROUP] VARCHAR(3) NULL,
    [b] VARCHAR(3) NULL,
    [c] VARCHAR(18) NULL,
    [d] VARCHAR(17) NULL,
    [TICKSIZE] DECIMAL(18, 0) NULL,
    [e] VARCHAR(3) NULL,
    [Status] VARCHAR(3) NULL,
    [f] VARCHAR(15) NULL,
    [g] VARCHAR(15) NULL,
    [h] VARCHAR(15) NULL,
    [i] VARCHAR(15) NULL,
    [ISINNO] VARCHAR(20) NULL,
    [j] VARCHAR(15) NULL,
    [k] VARCHAR(15) NULL,
    [l] VARCHAR(15) NULL,
    [m] VARCHAR(15) NULL,
    [n] VARCHAR(15) NULL,
    [o] VARCHAR(15) NULL,
    [p] VARCHAR(15) NULL,
    [q] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BSE_BlockScript_Temp_upload_BKP_28_03_2025
-- --------------------------------------------------
CREATE TABLE [dbo].[BSE_BlockScript_Temp_upload_BKP_28_03_2025]
(
    [SCRIPCODE] INT NULL,
    [EXCHNAGE] VARCHAR(7) NULL,
    [SYMBOL] VARCHAR(15) NULL,
    [SCRIPNAME] VARCHAR(50) NULL,
    [a] VARCHAR(20) NULL,
    [EQUITY_DEBENTURE] VARCHAR(3) NULL,
    [SCRIPGROUP] VARCHAR(3) NULL,
    [b] VARCHAR(3) NULL,
    [c] VARCHAR(18) NULL,
    [d] VARCHAR(7) NULL,
    [TICKSIZE] DECIMAL(18, 0) NULL,
    [e] VARCHAR(3) NULL,
    [Status] VARCHAR(3) NULL,
    [f] VARCHAR(15) NULL,
    [g] VARCHAR(15) NULL,
    [h] VARCHAR(15) NULL,
    [i] VARCHAR(15) NULL,
    [ISINNO] VARCHAR(20) NULL,
    [j] VARCHAR(15) NULL,
    [k] VARCHAR(15) NULL,
    [l] VARCHAR(15) NULL,
    [m] VARCHAR(15) NULL,
    [n] VARCHAR(15) NULL,
    [o] VARCHAR(15) NULL,
    [p] VARCHAR(15) NULL,
    [q] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BSEBlockScript
-- --------------------------------------------------
CREATE TABLE [dbo].[BSEBlockScript]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SCRIPCODE] INT NULL,
    [EXCHNAGE] VARCHAR(7) NULL,
    [SYMBOL] VARCHAR(15) NULL,
    [SCRIPNAME] VARCHAR(50) NULL,
    [EQUITY_DEBENTURE] VARCHAR(3) NULL,
    [SCRIPGROUP] VARCHAR(3) NULL,
    [TICKSIZE] DECIMAL(18, 0) NULL,
    [Status] VARCHAR(3) NULL,
    [ISINNO] VARCHAR(20) NULL,
    [Delete_Status] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BSEBlockScript_02052024
-- --------------------------------------------------
CREATE TABLE [dbo].[BSEBlockScript_02052024]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SCRIPCODE] INT NULL,
    [EXCHNAGE] VARCHAR(7) NULL,
    [SYMBOL] VARCHAR(15) NULL,
    [SCRIPNAME] VARCHAR(50) NULL,
    [EQUITY_DEBENTURE] VARCHAR(3) NULL,
    [SCRIPGROUP] VARCHAR(3) NULL,
    [TICKSIZE] DECIMAL(18, 0) NULL,
    [Status] VARCHAR(3) NULL,
    [ISINNO] VARCHAR(20) NULL,
    [Delete_Status] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bsefotrade_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[bsefotrade_temp]
(
    [TradeNumber] INT NULL,
    [TradeDateTime] DATETIME NULL,
    [TradeStatus] INT NULL,
    [SegmentIndicator] VARCHAR(5) NULL,
    [SettlementType] VARCHAR(5) NULL,
    [ProductType] VARCHAR(5) NULL,
    [ProductCode] VARCHAR(15) NULL,
    [AssetCode] VARCHAR(15) NULL,
    [ExpiryDate] DATETIME NULL,
    [StrikePrice] FLOAT NULL,
    [optiontype] VARCHAR(5) NULL,
    [CALevel] FLOAT NULL,
    [BuyBroker] FLOAT NULL,
    [SellBroker] FLOAT NULL,
    [TradePrice] FLOAT NULL,
    [TradeQuantity] INT NULL,
    [seriesid] INT NULL,
    [TradeBuyerlocation] VARCHAR(30) NULL,
    [buyCMCode] INT NULL,
    [SellCMCode] INT NULL,
    [tradeSellerLocation] VARCHAR(30) NULL,
    [buyCustodianParticipant] VARCHAR(50) NULL,
    [BuySideConfirmation] VARCHAR(10) NULL,
    [SellCustodialParticipant] VARCHAR(50) NULL,
    [SellSideConfirmation] VARCHAR(10) NULL,
    [BuyCoveredUncoveredFlag] CHAR(1) NULL,
    [SellCoveredUncoveredFlag] CHAR(1) NULL,
    [BuyOldCustodialParticipant] VARCHAR(50) NULL,
    [BuyOldCM] VARCHAR(50) NULL,
    [SellOldCustodialParticipant] VARCHAR(50) NULL,
    [SellOldCM] VARCHAR(50) NULL,
    [TradeBuyerTerminalID] INT NULL,
    [TradeSellerTerminalID] INT NULL,
    [buyOrder] VARCHAR(30) NULL,
    [sellOrder] VARCHAR(30) NULL,
    [buyClientCode] VARCHAR(50) NULL,
    [sellClientCode] VARCHAR(50) NULL,
    [buyRemark] VARCHAR(50) NULL,
    [sellRemark] VARCHAR(50) NULL,
    [buyPosition] VARCHAR(10) NULL,
    [sellPosition] VARCHAR(10) NULL,
    [BuyProprietorClientFlag] VARCHAR(10) NULL,
    [SellProprietorClientFlag] VARCHAR(10) NULL,
    [BuyOrderTimeStamp] DATETIME NULL,
    [SellOrderTimeStamp] DATETIME NULL,
    [BuyOrderActiveFlag] VARCHAR(10) NULL,
    [SellOrderActiveFlag] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BSX_BlockScript_Temp_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[BSX_BlockScript_Temp_upload]
(
    [Contracttokennumber] VARCHAR(50) NULL,
    [Assettokennumber] VARCHAR(50) NULL,
    [Instrument] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(50) NULL,
    [Filler] VARCHAR(50) NULL,
    [Expirydate] VARCHAR(50) NULL,
    [StrikePrice] VARCHAR(50) NULL,
    [OptionType] VARCHAR(50) NULL,
    [PRECISION_1] VARCHAR(50) NULL,
    [CALevel] VARCHAR(50) NULL,
    [Filler_1] VARCHAR(50) NULL,
    [Admissiontype] VARCHAR(50) NULL,
    [IssueRate] VARCHAR(50) NULL,
    [Tradingstatus_N] VARCHAR(50) NULL,
    [Eligibility_N] VARCHAR(50) NULL,
    [Filler_N] VARCHAR(50) NULL,
    [Tradingstatus] VARCHAR(50) NULL,
    [Eligibility] VARCHAR(50) NULL,
    [Filler_2] VARCHAR(50) NULL,
    [Tradingstatus_S] VARCHAR(50) NULL,
    [Eligibility_S] VARCHAR(50) NULL,
    [Filler_3] VARCHAR(50) NULL,
    [Tradingstatus_A] VARCHAR(50) NULL,
    [Eligibility_A] VARCHAR(50) NULL,
    [Filler_A] VARCHAR(50) NULL,
    [IssueStart] VARCHAR(50) NULL,
    [Settlement] VARCHAR(50) NULL,
    [ContractMaturity] VARCHAR(50) NULL,
    [MarginPercentage] VARCHAR(50) NULL,
    [MinimumLotSize] VARCHAR(50) NULL,
    [BoardLotQuantity] VARCHAR(50) NULL,
    [TickSize] VARCHAR(50) NULL,
    [IssuedCapital] VARCHAR(50) NULL,
    [VolumeFreezeQuantity] VARCHAR(50) NULL,
    [WarningQuantity] VARCHAR(50) NULL,
    [Admissiondate] VARCHAR(50) NULL,
    [Expulsiondate] VARCHAR(50) NULL,
    [Readmissiondate] VARCHAR(50) NULL,
    [Recorddate] VARCHAR(50) NULL,
    [Nodeliverystartdate] VARCHAR(50) NULL,
    [Nodeliveryenddate] VARCHAR(50) NULL,
    [OperatingRange_LOW] VARCHAR(50) NULL,
    [OperatingRage_HIGH] VARCHAR(50) NULL,
    [ExDate] VARCHAR(50) NULL,
    [BookClosureStartDate] VARCHAR(50) NULL,
    [BookClosureEndDate] VARCHAR(50) NULL,
    [UpdateDateandTime] VARCHAR(50) NULL,
    [ExerciseStartDate] VARCHAR(50) NULL,
    [ExerciseEndDate] VARCHAR(50) NULL,
    [TickerSelection] VARCHAR(50) NULL,
    [QuantityMultiplier] VARCHAR(50) NULL,
    [Creditrating] VARCHAR(50) NULL,
    [Stockname] VARCHAR(50) NULL,
    [Corporatepurpose_AGMEGM] VARCHAR(50) NULL,
    [Corporatepurpose_InterestDividend] VARCHAR(50) NULL,
    [Corporatepurpose_RightsBonus] VARCHAR(50) NULL,
    [SpecialTerms] VARCHAR(50) NULL,
    [Remarks] VARCHAR(50) NULL,
    [ExerciseStyle] VARCHAR(50) NULL,
    [ExerciseAllowed] VARCHAR(50) NULL,
    [ExerciseRejectionAllowed] VARCHAR(50) NULL,
    [PositionLiquidationAllowed] VARCHAR(50) NULL,
    [Checksum] VARCHAR(50) NULL,
    [CorporateActionadjusted] VARCHAR(50) NULL,
    [UnderlyingAssetSymbol] VARCHAR(50) NULL,
    [AssetInstrument] VARCHAR(50) NULL,
    [BasePrice] VARCHAR(50) NULL,
    [Deleteflag] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BSXBLOCKSCRIPT
-- --------------------------------------------------
CREATE TABLE [dbo].[BSXBLOCKSCRIPT]
(
    [Contracttokennumber] VARCHAR(50) NULL,
    [Assettokennumber] VARCHAR(50) NULL,
    [Instrument] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(50) NULL,
    [Filler] VARCHAR(50) NULL,
    [Expirydate] DATETIME NULL,
    [StrikePrice] VARCHAR(50) NULL,
    [OptionType] VARCHAR(50) NULL,
    [CALevel] VARCHAR(50) NULL,
    [Filler_1] VARCHAR(50) NULL,
    [Admissiontype] VARCHAR(50) NULL,
    [IssueRate] VARCHAR(50) NULL,
    [Tradingstatus_N] VARCHAR(50) NULL,
    [Eligibility_N] VARCHAR(50) NULL,
    [Filler_N] VARCHAR(50) NULL,
    [Tradingstatus] VARCHAR(50) NULL,
    [Eligibility] VARCHAR(50) NULL,
    [Filler_2] VARCHAR(50) NULL,
    [Tradingstatus_S] VARCHAR(50) NULL,
    [Eligibility_S] VARCHAR(50) NULL,
    [Filler_3] VARCHAR(50) NULL,
    [Tradingstatus_A] VARCHAR(50) NULL,
    [Eligibility_A] VARCHAR(50) NULL,
    [Filler_A] VARCHAR(50) NULL,
    [IssueStart] VARCHAR(50) NULL,
    [Settlement] VARCHAR(50) NULL,
    [ContractMaturity] VARCHAR(50) NULL,
    [MarginPercentage] VARCHAR(50) NULL,
    [MinimumLotSize] VARCHAR(50) NULL,
    [BoardLotQuantity] VARCHAR(50) NULL,
    [TickSize] VARCHAR(50) NULL,
    [IssuedCapital] VARCHAR(50) NULL,
    [VolumeFreezeQuantity] VARCHAR(50) NULL,
    [WarningQuantity] VARCHAR(50) NULL,
    [Admissiondate] VARCHAR(50) NULL,
    [Expulsiondate] VARCHAR(50) NULL,
    [Readmissiondate] VARCHAR(50) NULL,
    [Recorddate] VARCHAR(50) NULL,
    [Nodeliverystartdate] VARCHAR(50) NULL,
    [Nodeliveryenddate] VARCHAR(50) NULL,
    [OperatingRange_LOW] VARCHAR(50) NULL,
    [OperatingRage_HIGH] VARCHAR(50) NULL,
    [ExDate] VARCHAR(50) NULL,
    [BookClosureStartDate] VARCHAR(50) NULL,
    [BookClosureEndDate] VARCHAR(50) NULL,
    [UpdateDateandTime] VARCHAR(50) NULL,
    [ExerciseStartDate] VARCHAR(50) NULL,
    [ExerciseEndDate] VARCHAR(50) NULL,
    [TickerSelection] VARCHAR(50) NULL,
    [QuantityMultiplier] VARCHAR(50) NULL,
    [Creditrating] VARCHAR(50) NULL,
    [Stockname] VARCHAR(50) NULL,
    [Corporatepurpose_AGMEGM] VARCHAR(50) NULL,
    [Corporatepurpose_InterestDividend] VARCHAR(50) NULL,
    [Corporatepurpose_RightsBonus] VARCHAR(50) NULL,
    [SpecialTerms] VARCHAR(50) NULL,
    [Remarks] VARCHAR(50) NULL,
    [ExerciseStyle] VARCHAR(50) NULL,
    [ExerciseAllowed] VARCHAR(50) NULL,
    [ExerciseRejectionAllowed] VARCHAR(50) NULL,
    [PositionLiquidationAllowed] VARCHAR(50) NULL,
    [Checksum] VARCHAR(50) NULL,
    [CorporateActionadjusted] VARCHAR(50) NULL,
    [UnderlyingAssetSymbol] VARCHAR(50) NULL,
    [AssetInstrument] VARCHAR(50) NULL,
    [BasePrice] VARCHAR(50) NULL,
    [Deleteflag] VARCHAR(50) NULL,
    [UploadDateTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bulk_file
-- --------------------------------------------------
CREATE TABLE [dbo].[bulk_file]
(
    [party_code] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.call_trade_bulk_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[call_trade_bulk_temp]
(
    [party_code] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Category
-- --------------------------------------------------
CREATE TABLE [dbo].[Category]
(
    [CatID] VARCHAR(20) NOT NULL,
    [CatName] VARCHAR(60) NOT NULL,
    [CatDesc] VARCHAR(50) NULL,
    [CatCreationDate] DATETIME NOT NULL,
    [CatType] VARCHAR(15) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cibil_master
-- --------------------------------------------------
CREATE TABLE [dbo].[cibil_master]
(
    [SEGMENT] VARCHAR(50) NULL,
    [CNF1] VARCHAR(50) NULL,
    [CNF2] VARCHAR(50) NULL,
    [CNF3] VARCHAR(50) NULL,
    [CNF4] VARCHAR(50) NULL,
    [CNF5] VARCHAR(50) NULL,
    [DOB] VARCHAR(50) NULL,
    [GENDER] VARCHAR(50) NULL,
    [PAN] VARCHAR(50) NULL,
    [PASSPORT] VARCHAR(50) NULL,
    [VOTER] VARCHAR(50) NULL,
    [TELEPHONE] VARCHAR(50) NULL,
    [ADDID] VARCHAR(50) NULL,
    [SEG2] VARCHAR(50) NULL,
    [ADD1] VARCHAR(100) NULL,
    [ADD2] VARCHAR(100) NULL,
    [ADD3] VARCHAR(100) NULL,
    [ADD4] VARCHAR(100) NULL,
    [ADD5] VARCHAR(100) NULL,
    [STATE] VARCHAR(50) NULL,
    [PINCODE] VARCHAR(50) NULL,
    [SEG3] VARCHAR(50) NULL,
    [RMC] VARCHAR(50) NULL,
    [RMN] VARCHAR(50) NULL,
    [ACCNO] VARCHAR(50) NULL,
    [ACCTYPE] VARCHAR(50) NULL,
    [OWNER] VARCHAR(50) NULL,
    [DTOPN] VARCHAR(50) NULL,
    [DTPAY] VARCHAR(50) NULL,
    [DTCLS] VARCHAR(50) NULL,
    [DTRPT] VARCHAR(50) NULL,
    [SANCAMT] VARCHAR(50) NULL,
    [CURBAL] VARCHAR(50) NULL,
    [AMTOVER] VARCHAR(50) NULL,
    [NODPAYDUE] VARCHAR(50) NULL,
    [OLDRMC] VARCHAR(50) NULL,
    [OLDRMN] VARCHAR(50) NULL,
    [OLDACCNO] VARCHAR(50) NULL,
    [WOFF] VARCHAR(50) NULL,
    [ASSETCL] VARCHAR(50) NULL,
    [ENDSEG] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientcode_271109
-- --------------------------------------------------
CREATE TABLE [dbo].[clientcode_271109]
(
    [CODE] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientifofile_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[clientifofile_temp]
(
    [opcode] VARCHAR(5) NULL,
    [pcode] VARCHAR(45) NULL,
    [tag] VARCHAR(45) NULL,
    [pname] VARCHAR(200) NULL,
    [Password] VARCHAR(45) NULL,
    [bbb] VARCHAR(45) NULL,
    [Address1] VARCHAR(200) NULL,
    [Address2] VARCHAR(200) NULL,
    [City] VARCHAR(45) NULL,
    [pin] VARCHAR(25) NULL,
    [Telephone_No] VARCHAR(45) NULL,
    [Fax] VARCHAR(45) NULL,
    [Email] VARCHAR(100) NULL,
    [Status] VARCHAR(45) NULL,
    [Brokerage] VARCHAR(45) NULL,
    [SurvOn] VARCHAR(45) NULL,
    [SurvAuto] VARCHAR(45) NULL,
    [BankDPOnOff] VARCHAR(45) NULL,
    [ParticipantCode] VARCHAR(45) NULL,
    [Filler1] VARCHAR(45) NULL,
    [Filler2] VARCHAR(45) NULL,
    [Filler3] VARCHAR(45) NULL,
    [Filler4] VARCHAR(45) NULL,
    [Trading_Allowed] VARCHAR(45) NULL,
    [ClientValidationOnOff] VARCHAR(45) NULL,
    [SpanOnOff] VARCHAR(45) NULL,
    [DervPartCode] VARCHAR(45) NULL,
    [IP] VARCHAR(45) NULL,
    [MaxNoOfOrder] VARCHAR(45) NULL,
    [BCastScrips] VARCHAR(45) NULL,
    [Alias_DealerId] VARCHAR(45) NULL,
    [FamilyName] VARCHAR(45) NULL,
    [EqFlag] VARCHAR(45) NULL,
    [DervFlag] VARCHAR(100) NULL,
    [CombFlag] VARCHAR(25) NULL,
    [BSEEq] VARCHAR(45) NULL,
    [NEBEComb] VARCHAR(45) NULL,
    [NEBEEq] VARCHAR(45) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(100) NULL,
    [NSE_Cash_CTCLId] VARCHAR(45) NULL,
    [BranchName] VARCHAR(45) NULL,
    [Derv_CTCL_BranchId] VARCHAR(45) NULL,
    [Derv_CTCL_Id] VARCHAR(45) NULL,
    [ddd] VARCHAR(45) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(45) NULL,
    [BSE_Cash_CTCLId] VARCHAR(45) NULL,
    [Login_Allowed] VARCHAR(5) NULL,
    [Participant_Type] VARCHAR(20) NULL,
    [DIET] VARCHAR(5) NULL,
    [NetDotnet] VARCHAR(5) NULL,
    [iWin] VARCHAR(5) NULL,
    [NetNetLite] VARCHAR(5) NULL,
    [MCX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCX_CTCLId] VARCHAR(20) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(20) NULL,
    [NCDEX_CTCLId] VARCHAR(20) NULL,
    [Product_Type] VARCHAR(20) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(20) NULL,
    [NSEL_CTCLId] VARCHAR(20) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_CTCLId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(20) NULL,
    [NSCE_CTCL_BranchId] VARCHAR(20) NULL,
    [NSCE_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCLId] VARCHAR(20) NULL,
    [DSE_CTCL_BranchId] VARCHAR(20) NULL,
    [DSE_CTCLId] VARCHAR(20) NULL,
    [Market_Data_Allowed] VARCHAR(20) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_EQ_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(20) NULL,
    [DSE_Participant_Code] VARCHAR(20) NULL,
    [MCX_Participant_Code] VARCHAR(20) NULL,
    [NMCE_Participant_Code] VARCHAR(20) NULL,
    [PanCard] VARCHAR(10) NULL,
    [Remarks] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientifofile_temp_09062010
-- --------------------------------------------------
CREATE TABLE [dbo].[clientifofile_temp_09062010]
(
    [pcode] VARCHAR(25) NULL,
    [pname] VARCHAR(75) NULL,
    [aaa] VARCHAR(25) NULL,
    [ddd] VARCHAR(25) NULL,
    [bbb] VARCHAR(25) NULL,
    [ccc] VARCHAR(25) NULL,
    [tag] VARCHAR(45) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientifofile_temp_new
-- --------------------------------------------------
CREATE TABLE [dbo].[clientifofile_temp_new]
(
    [opcode] VARCHAR(5) NULL,
    [pcode] VARCHAR(45) NULL,
    [tag] VARCHAR(45) NULL,
    [pname] VARCHAR(200) NULL,
    [Password] VARCHAR(45) NULL,
    [bbb] VARCHAR(45) NULL,
    [Address1] VARCHAR(200) NULL,
    [Address2] VARCHAR(200) NULL,
    [City] VARCHAR(45) NULL,
    [pin] VARCHAR(25) NULL,
    [Telephone_No] VARCHAR(45) NULL,
    [Fax] VARCHAR(45) NULL,
    [Email] VARCHAR(100) NULL,
    [Status] VARCHAR(45) NULL,
    [Brokerage] VARCHAR(45) NULL,
    [SurvOn] VARCHAR(45) NULL,
    [SurvAuto] VARCHAR(45) NULL,
    [BankDPOnOff] VARCHAR(45) NULL,
    [ParticipantCode] VARCHAR(45) NULL,
    [Filler1] VARCHAR(45) NULL,
    [Filler2] VARCHAR(45) NULL,
    [Filler3] VARCHAR(45) NULL,
    [Filler4] VARCHAR(45) NULL,
    [Trading_Allowed] VARCHAR(45) NULL,
    [ClientValidationOnOff] VARCHAR(45) NULL,
    [SpanOnOff] VARCHAR(45) NULL,
    [DervPartCode] VARCHAR(45) NULL,
    [IP] VARCHAR(45) NULL,
    [MaxNoOfOrder] VARCHAR(45) NULL,
    [BCastScrips] VARCHAR(45) NULL,
    [Alias_DealerId] VARCHAR(45) NULL,
    [FamilyName] VARCHAR(45) NULL,
    [EqFlag] VARCHAR(45) NULL,
    [DervFlag] VARCHAR(100) NULL,
    [CombFlag] VARCHAR(25) NULL,
    [BSEEq] VARCHAR(45) NULL,
    [NEBEComb] VARCHAR(45) NULL,
    [NEBEEq] VARCHAR(45) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(100) NULL,
    [NSE_Cash_CTCLId] VARCHAR(45) NULL,
    [BranchName] VARCHAR(45) NULL,
    [Derv_CTCL_BranchId] VARCHAR(45) NULL,
    [Derv_CTCL_Id] VARCHAR(45) NULL,
    [ddd] VARCHAR(45) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(45) NULL,
    [BSE_Cash_CTCLId] VARCHAR(45) NULL,
    [Login_Allowed] VARCHAR(5) NULL,
    [Participant_Type] VARCHAR(20) NULL,
    [DIET] VARCHAR(5) NULL,
    [NetDotnet] VARCHAR(5) NULL,
    [iWin] VARCHAR(5) NULL,
    [NetNetLite] VARCHAR(5) NULL,
    [MCX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCX_CTCLId] VARCHAR(20) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(20) NULL,
    [NCDEX_CTCLId] VARCHAR(20) NULL,
    [Product_Type] VARCHAR(20) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(20) NULL,
    [NSEL_CTCLId] VARCHAR(20) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_CTCLId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(20) NULL,
    [NSCE_CTCL_BranchId] VARCHAR(20) NULL,
    [NSCE_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCLId] VARCHAR(20) NULL,
    [DSE_CTCL_BranchId] VARCHAR(20) NULL,
    [DSE_CTCLId] VARCHAR(20) NULL,
    [Market_Data_Allowed] VARCHAR(20) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_EQ_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(20) NULL,
    [DSE_Participant_Code] VARCHAR(20) NULL,
    [MCX_Participant_Code] VARCHAR(20) NULL,
    [NMCE_Participant_Code] VARCHAR(20) NULL,
    [PanCard] VARCHAR(10) NULL,
    [Remarks] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clientifofile_temp_old
-- --------------------------------------------------
CREATE TABLE [dbo].[clientifofile_temp_old]
(
    [pcode] VARCHAR(25) NULL,
    [pname] VARCHAR(75) NULL,
    [aaa] VARCHAR(25) NULL,
    [ddd] VARCHAR(25) NULL,
    [bbb] VARCHAR(25) NULL,
    [ccc] VARCHAR(25) NULL,
    [tag] VARCHAR(80) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLT_PREMIUMDATA_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[CLT_PREMIUMDATA_TEMP]
(
    [Ro Code] VARCHAR(40) NULL,
    [Branch Code] VARCHAR(20) NULL,
    [Family Code] VARCHAR(20) NULL,
    [Sub Group Code] VARCHAR(20) NULL,
    [Client Code] VARCHAR(20) NULL,
    [Client Name] VARCHAR(300) NULL,
    [Ledger Balance] VARCHAR(MAX) NULL,
    [Holding] VARCHAR(MAX) NULL,
    [POA] VARCHAR(MAX) NULL,
    [Today MTM] VARCHAR(MAX) NULL,
    [Logical MTM] VARCHAR(MAX) NULL,
    [Fut. MTM] VARCHAR(MAX) NULL,
    [Opt. MTM] VARCHAR(MAX) NULL,
    [MTM] VARCHAR(MAX) NULL,
    [Pure risk / net available] VARCHAR(MAX) NULL,
    [Projected Risk] VARCHAR(MAX) NULL,
    [Gross Exposure] VARCHAR(MAX) NULL,
    [Net Exposure] VARCHAR(MAX) NULL,
    [FO Margin ] VARCHAR(MAX) NULL,
    [Comm Margin] VARCHAR(MAX) NULL,
    [Curr margin] VARCHAR(MAX) NULL,
    [Total Margin] VARCHAR(MAX) NULL,
    [Prev. Margin] VARCHAR(MAX) NULL,
    [Diff. Margin] VARCHAR(MAX) NULL,
    [Today Premium] VARCHAR(MAX) NULL,
    [Cash Payin / Payout] VARCHAR(MAX) NULL,
    [Shortsell] VARCHAR(MAX) NULL,
    [FO Shortfall] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLT_PREMIUMDATA_TEMP_UAT
-- --------------------------------------------------
CREATE TABLE [dbo].[CLT_PREMIUMDATA_TEMP_UAT]
(
    [Ro Code] VARCHAR(40) NULL,
    [Branch Code] VARCHAR(20) NULL,
    [Family Code] VARCHAR(20) NULL,
    [Sub Group Code] VARCHAR(20) NULL,
    [Client Code] VARCHAR(20) NULL,
    [Client Name] VARCHAR(300) NULL,
    [Ledger Balance] VARCHAR(MAX) NULL,
    [Holding] VARCHAR(MAX) NULL,
    [POA] VARCHAR(MAX) NULL,
    [Today MTM] VARCHAR(MAX) NULL,
    [Logical MTM] VARCHAR(MAX) NULL,
    [Fut. MTM] VARCHAR(MAX) NULL,
    [Opt. MTM] VARCHAR(MAX) NULL,
    [MTM] VARCHAR(MAX) NULL,
    [Pure risk / net available] VARCHAR(MAX) NULL,
    [Projected Risk] VARCHAR(MAX) NULL,
    [Gross Exposure] VARCHAR(MAX) NULL,
    [Net Exposure] VARCHAR(MAX) NULL,
    [FO Margin ] VARCHAR(MAX) NULL,
    [Comm Margin] VARCHAR(MAX) NULL,
    [Curr margin] VARCHAR(MAX) NULL,
    [Total Margin] VARCHAR(MAX) NULL,
    [Prev. Margin] VARCHAR(MAX) NULL,
    [Diff. Margin] VARCHAR(MAX) NULL,
    [Today Premium] VARCHAR(MAX) NULL,
    [Cash Payin / Payout] VARCHAR(MAX) NULL,
    [Shortsell] VARCHAR(MAX) NULL,
    [FO Shortfall] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLT_PREMIUMDATA_tmp1
-- --------------------------------------------------
CREATE TABLE [dbo].[CLT_PREMIUMDATA_tmp1]
(
    [Ro Code] VARCHAR(40) NULL,
    [Branch Code] VARCHAR(20) NULL,
    [Family Code] VARCHAR(20) NULL,
    [Sub Group Code] VARCHAR(20) NULL,
    [Client Code] VARCHAR(20) NULL,
    [Client Name] VARCHAR(300) NULL,
    [Ledger Balance] MONEY NULL,
    [Holding] MONEY NULL,
    [POA] MONEY NULL,
    [Today MTM] MONEY NULL,
    [Logical MTM] MONEY NULL,
    [Fut. MTM] MONEY NULL,
    [Opt. MTM] MONEY NULL,
    [MTM] MONEY NULL,
    [Pure risk / net available] MONEY NULL,
    [Projected Risk] MONEY NULL,
    [Gross Exposure] MONEY NULL,
    [Net Exposure] MONEY NULL,
    [FO Margin ] MONEY NULL,
    [Comm Margin] MONEY NULL,
    [Curr margin] MONEY NULL,
    [Total Margin] MONEY NULL,
    [Prev. Margin] MONEY NULL,
    [Diff. Margin] MONEY NULL,
    [Today Premium] MONEY NULL,
    [Cash Payin / Payout] MONEY NULL,
    [Shortsell] MONEY NULL,
    [FO Shortfall] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cnt_failed_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[cnt_failed_upload]
(
    [Party_code] NCHAR(10) NULL,
    [Scheme] INT NULL,
    [generatedate] DATETIME NULL,
    [servermapped] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.comm_margin
-- --------------------------------------------------
CREATE TABLE [dbo].[comm_margin]
(
    [Sr_No] INT NULL,
    [Instrument_Type] CHAR(20) NULL,
    [Symbol] CHAR(20) NULL,
    [Expiry_Date] CHAR(12) NULL,
    [Exposure_Margin%] FLOAT NOT NULL,
    [Additional_Pre_expiry_margins] FLOAT NOT NULL,
    [Additional_Margin_Long%] FLOAT NOT NULL,
    [Additional_Margin_Short%] FLOAT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.comm_margin_text
-- --------------------------------------------------
CREATE TABLE [dbo].[comm_margin_text]
(
    [Sr_No] INT NULL,
    [Instrument_Type] CHAR(20) NULL,
    [Symbol] CHAR(20) NULL,
    [Expiry_Date] CHAR(12) NULL,
    [Initial_Margin] FLOAT NULL,
    [Exposure_Margin] FLOAT NULL,
    [Additional_Pre_expiry_margins] FLOAT NULL,
    [Total_Margin] FLOAT NULL,
    [Additional_Margin_Long] FLOAT NULL,
    [Additional_Margin_Short] FLOAT NULL,
    [Special_Ch_Margin_Long] FLOAT NULL,
    [Special_Ch_Margin_Short] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Comm_Txt
-- --------------------------------------------------
CREATE TABLE [dbo].[Comm_Txt]
(
    [margin] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Committee
-- --------------------------------------------------
CREATE TABLE [dbo].[Committee]
(
    [ComID] VARCHAR(10) NULL,
    [EmpNo1] VARCHAR(20) NULL,
    [EmpNo2] VARCHAR(20) NULL,
    [EmpNo3] VARCHAR(20) NULL,
    [EmpNo4] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Commo_dormant_insp_t
-- --------------------------------------------------
CREATE TABLE [dbo].[Commo_dormant_insp_t]
(
    [cltcode] VARCHAR(10) NULL,
    [MCX_billdate] VARCHAR(11) NULL,
    [NCDEX_Billdate] VARCHAR(11) NULL,
    [upd_date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Commo_dormant_insp_xx
-- --------------------------------------------------
CREATE TABLE [dbo].[Commo_dormant_insp_xx]
(
    [branch_cd] VARCHAR(10) NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [cltcode] VARCHAR(10) NULL,
    [MCX_billdate] VARCHAR(11) NULL,
    [NCDEX_Billdate] VARCHAR(11) NULL,
    [Contact_No] VARCHAR(40) NULL,
    [upd_date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Commo_dormant_t
-- --------------------------------------------------
CREATE TABLE [dbo].[Commo_dormant_t]
(
    [cltcode] VARCHAR(10) NULL,
    [MCX_billdate] VARCHAR(11) NULL,
    [NCDEX_Billdate] VARCHAR(11) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Commo_dormant_xx
-- --------------------------------------------------
CREATE TABLE [dbo].[Commo_dormant_xx]
(
    [branch_cd] VARCHAR(10) NULL,
    [sub_broker] VARCHAR(10) NOT NULL,
    [cltcode] VARCHAR(10) NULL,
    [MCX_billdate] VARCHAR(11) NULL,
    [NCDEX_Billdate] VARCHAR(11) NULL,
    [Contact_No] VARCHAR(40) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.connlog_anywhere_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[connlog_anywhere_temp]
(
    [ClientCode] VARCHAR(15) NULL,
    [LoginName] VARCHAR(15) NULL,
    [TransactionType] VARCHAR(15) NULL,
    [dateTime1] VARCHAR(25) NULL,
    [IPAddress] VARCHAR(25) NULL,
    [Source] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ContractFile_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[ContractFile_MCX]
(
    [C1] VARCHAR(50) NULL,
    [C2] VARCHAR(50) NULL,
    [C3] VARCHAR(50) NULL,
    [C4] VARCHAR(50) NULL,
    [C5] VARCHAR(50) NULL,
    [C6] VARCHAR(50) NULL,
    [C7] VARCHAR(50) NULL,
    [C8] VARCHAR(50) NULL,
    [C9] VARCHAR(50) NULL,
    [C10] VARCHAR(50) NULL,
    [C11] VARCHAR(50) NULL,
    [C12] VARCHAR(50) NULL,
    [C13] VARCHAR(50) NULL,
    [C14] VARCHAR(50) NULL,
    [C15] VARCHAR(50) NULL,
    [C16] VARCHAR(50) NULL,
    [C17] VARCHAR(50) NULL,
    [C18] VARCHAR(50) NULL,
    [C19] VARCHAR(50) NULL,
    [C20] VARCHAR(50) NULL,
    [C21] VARCHAR(50) NULL,
    [C22] VARCHAR(50) NULL,
    [C23] VARCHAR(50) NULL,
    [C24] VARCHAR(50) NULL,
    [C25] VARCHAR(50) NULL,
    [C26] VARCHAR(50) NULL,
    [C27] VARCHAR(50) NULL,
    [C28] VARCHAR(50) NULL,
    [C29] VARCHAR(50) NULL,
    [C30] VARCHAR(50) NULL,
    [C31] VARCHAR(50) NULL,
    [C32] VARCHAR(50) NULL,
    [C33] VARCHAR(50) NULL,
    [C34] VARCHAR(50) NULL,
    [C35] VARCHAR(50) NULL,
    [C36] VARCHAR(50) NULL,
    [C37] VARCHAR(50) NULL,
    [C38] VARCHAR(50) NULL,
    [C39] VARCHAR(50) NULL,
    [C40] VARCHAR(50) NULL,
    [C41] VARCHAR(50) NULL,
    [C42] VARCHAR(50) NULL,
    [C43] VARCHAR(50) NULL,
    [C44] VARCHAR(50) NULL,
    [C45] VARCHAR(50) NULL,
    [C46] VARCHAR(50) NULL,
    [C47] VARCHAR(50) NULL,
    [C48] VARCHAR(50) NULL,
    [C49] VARCHAR(50) NULL,
    [C50] VARCHAR(50) NULL,
    [C51] VARCHAR(50) NULL,
    [C52] VARCHAR(50) NULL,
    [C53] VARCHAR(50) NULL,
    [C54] VARCHAR(50) NULL,
    [C55] VARCHAR(50) NULL,
    [C56] VARCHAR(50) NULL,
    [C57] VARCHAR(50) NULL,
    [C58] VARCHAR(50) NULL,
    [C59] VARCHAR(50) NULL,
    [C60] VARCHAR(50) NULL,
    [C61] VARCHAR(50) NULL,
    [C62] VARCHAR(50) NULL,
    [C63] VARCHAR(50) NULL,
    [C64] VARCHAR(50) NULL,
    [C65] VARCHAR(50) NULL,
    [C66] VARCHAR(50) NULL,
    [C67] VARCHAR(50) NULL,
    [C68] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ContractFile_MCXSX
-- --------------------------------------------------
CREATE TABLE [dbo].[ContractFile_MCXSX]
(
    [C1] VARCHAR(50) NULL,
    [C2] VARCHAR(50) NULL,
    [C3] VARCHAR(50) NULL,
    [C4] VARCHAR(50) NULL,
    [C5] VARCHAR(50) NULL,
    [C6] VARCHAR(50) NULL,
    [C7] VARCHAR(50) NULL,
    [C8] VARCHAR(50) NULL,
    [C9] VARCHAR(50) NULL,
    [C10] VARCHAR(50) NULL,
    [C11] VARCHAR(50) NULL,
    [C12] VARCHAR(50) NULL,
    [C13] VARCHAR(50) NULL,
    [C14] VARCHAR(50) NULL,
    [C15] VARCHAR(50) NULL,
    [C16] VARCHAR(50) NULL,
    [C17] VARCHAR(50) NULL,
    [C18] VARCHAR(50) NULL,
    [C19] VARCHAR(50) NULL,
    [C20] VARCHAR(50) NULL,
    [C21] VARCHAR(50) NULL,
    [C22] VARCHAR(50) NULL,
    [C23] VARCHAR(50) NULL,
    [C24] VARCHAR(50) NULL,
    [C25] VARCHAR(50) NULL,
    [C26] VARCHAR(50) NULL,
    [C27] VARCHAR(50) NULL,
    [C28] VARCHAR(50) NULL,
    [C29] VARCHAR(50) NULL,
    [C30] VARCHAR(50) NULL,
    [C31] VARCHAR(50) NULL,
    [C32] VARCHAR(50) NULL,
    [C33] VARCHAR(50) NULL,
    [C34] VARCHAR(50) NULL,
    [C35] VARCHAR(50) NULL,
    [C36] VARCHAR(50) NULL,
    [C37] VARCHAR(50) NULL,
    [C38] VARCHAR(50) NULL,
    [C39] VARCHAR(50) NULL,
    [C40] VARCHAR(50) NULL,
    [C41] VARCHAR(50) NULL,
    [C42] VARCHAR(50) NULL,
    [C43] VARCHAR(50) NULL,
    [C44] VARCHAR(50) NULL,
    [C45] VARCHAR(50) NULL,
    [C46] VARCHAR(50) NULL,
    [C47] VARCHAR(50) NULL,
    [C48] VARCHAR(50) NULL,
    [C49] VARCHAR(50) NULL,
    [C50] VARCHAR(50) NULL,
    [C51] VARCHAR(50) NULL,
    [C52] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ContractFile_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[ContractFile_NCDEX]
(
    [C1] VARCHAR(50) NULL,
    [C2] VARCHAR(50) NULL,
    [C3] VARCHAR(50) NULL,
    [C4] VARCHAR(50) NULL,
    [C5] VARCHAR(50) NULL,
    [C6] VARCHAR(50) NULL,
    [C7] VARCHAR(50) NULL,
    [C8] VARCHAR(50) NULL,
    [C9] VARCHAR(50) NULL,
    [C10] VARCHAR(50) NULL,
    [C11] VARCHAR(50) NULL,
    [C12] VARCHAR(50) NULL,
    [C13] VARCHAR(50) NULL,
    [C14] VARCHAR(50) NULL,
    [C15] VARCHAR(50) NULL,
    [C16] VARCHAR(50) NULL,
    [C17] VARCHAR(50) NULL,
    [C18] VARCHAR(50) NULL,
    [C19] VARCHAR(50) NULL,
    [C20] VARCHAR(50) NULL,
    [C21] VARCHAR(50) NULL,
    [C22] VARCHAR(50) NULL,
    [C23] VARCHAR(50) NULL,
    [C24] VARCHAR(50) NULL,
    [C25] VARCHAR(50) NULL,
    [C26] VARCHAR(50) NULL,
    [C27] VARCHAR(50) NULL,
    [C28] VARCHAR(50) NULL,
    [C29] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.contractFile_new
-- --------------------------------------------------
CREATE TABLE [dbo].[contractFile_new]
(
    [InstrumentName] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [StrikePrice] VARCHAR(100) NULL,
    [OptionType] VARCHAR(100) NULL,
    [Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.contractfile1
-- --------------------------------------------------
CREATE TABLE [dbo].[contractfile1]
(
    [1] VARCHAR(100) NULL,
    [2] VARCHAR(100) NULL,
    [InstrumentName] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [5] VARCHAR(100) NULL,
    [6] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [StrikePrice] VARCHAR(100) NULL,
    [OptionType] VARCHAR(100) NULL,
    [10] VARCHAR(100) NULL,
    [11] VARCHAR(100) NULL,
    [12] VARCHAR(100) NULL,
    [13] VARCHAR(100) NULL,
    [14] VARCHAR(100) NULL,
    [15] VARCHAR(100) NULL,
    [16] VARCHAR(100) NULL,
    [17] VARCHAR(100) NULL,
    [18] VARCHAR(100) NULL,
    [19] VARCHAR(100) NULL,
    [20] VARCHAR(100) NULL,
    [21] VARCHAR(100) NULL,
    [22] VARCHAR(100) NULL,
    [23] VARCHAR(100) NULL,
    [24] VARCHAR(100) NULL,
    [25] VARCHAR(100) NULL,
    [26] VARCHAR(100) NULL,
    [27] VARCHAR(100) NULL,
    [28] VARCHAR(100) NULL,
    [29] VARCHAR(100) NULL,
    [30] VARCHAR(100) NULL,
    [31] VARCHAR(100) NULL,
    [32] VARCHAR(100) NULL,
    [33] VARCHAR(100) NULL,
    [34] VARCHAR(100) NULL,
    [35] VARCHAR(100) NULL,
    [36] VARCHAR(100) NULL,
    [37] VARCHAR(100) NULL,
    [38] VARCHAR(100) NULL,
    [39] VARCHAR(100) NULL,
    [40] VARCHAR(100) NULL,
    [41] VARCHAR(100) NULL,
    [42] VARCHAR(100) NULL,
    [43] VARCHAR(100) NULL,
    [44] VARCHAR(100) NULL,
    [45] VARCHAR(100) NULL,
    [46] VARCHAR(100) NULL,
    [47] VARCHAR(100) NULL,
    [48] VARCHAR(100) NULL,
    [49] VARCHAR(100) NULL,
    [50] VARCHAR(100) NULL,
    [51] VARCHAR(100) NULL,
    [52] VARCHAR(100) NULL,
    [53] VARCHAR(100) NULL,
    [54] VARCHAR(100) NULL,
    [55] VARCHAR(100) NULL,
    [56] VARCHAR(100) NULL,
    [57] VARCHAR(100) NULL,
    [58] VARCHAR(100) NULL,
    [59] VARCHAR(100) NULL,
    [60] VARCHAR(100) NULL,
    [61] VARCHAR(100) NULL,
    [62] VARCHAR(100) NULL,
    [63] VARCHAR(100) NULL,
    [64] VARCHAR(100) NULL,
    [65] VARCHAR(100) NULL,
    [66] VARCHAR(100) NULL,
    [67] VARCHAR(100) NULL,
    [68] VARCHAR(100) NULL,
    [69] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.crv_log
-- --------------------------------------------------
CREATE TABLE [dbo].[crv_log]
(
    [data] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.crv_log_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[crv_log_temp]
(
    [data] VARCHAR(500) NULL,
    [path] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_DTCx
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_DTCx]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_DTCY
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_DTCY]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_omnesys_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_omnesys_temp]
(
    [party_code] VARCHAR(20) NULL,
    [dealerid] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcldealerinfo_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcldealerinfo_temp]
(
    [OpCode] VARCHAR(10) NULL,
    [UserId] VARCHAR(25) NULL,
    [GroupId] VARCHAR(10) NULL,
    [UserName] VARCHAR(25) NULL,
    [Password] VARCHAR(25) NULL,
    [Category] VARCHAR(25) NULL,
    [Address1] VARCHAR(200) NULL,
    [Address2] VARCHAR(200) NULL,
    [City] VARCHAR(200) NULL,
    [Statepin] VARCHAR(25) NULL,
    [TelephoneNo] VARCHAR(25) NULL,
    [FaxNo] VARCHAR(25) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(10) NULL,
    [Brokerage] VARCHAR(1) NULL,
    [SurvOnOff] VARCHAR(1) NULL,
    [SurvAutoManual] VARCHAR(1) NULL,
    [BankDPOnOff] VARCHAR(1) NULL,
    [ParticipantCode] VARCHAR(10) NULL,
    [Filler0] VARCHAR(10) NULL,
    [Filler1] VARCHAR(10) NULL,
    [Filler2] VARCHAR(10) NULL,
    [Filler3] VARCHAR(10) NULL,
    [TradingAllowed] VARCHAR(10) NULL,
    [ClientValidationOnOff] VARCHAR(10) NULL,
    [SpanOnOff] VARCHAR(10) NULL,
    [DervPartCode] VARCHAR(10) NULL,
    [IPAddress] VARCHAR(25) NULL,
    [MaxNoOfOrder] VARCHAR(25) NULL,
    [MaxBCastScrips] VARCHAR(25) NULL,
    [AliasDealerId] VARCHAR(25) NULL,
    [FamilyName] VARCHAR(100) NULL,
    [EqFlag] VARCHAR(10) NULL,
    [DervFlag] VARCHAR(10) NULL,
    [CombFlag] VARCHAR(10) NULL,
    [BSEEq] VARCHAR(10) NULL,
    [NEBEComb] VARCHAR(10) NULL,
    [NEBEEq] VARCHAR(10) NULL,
    [NSECashCTCLBranchId] VARCHAR(10) NULL,
    [NSECashCTCLId] VARCHAR(10) NULL,
    [BranchName] VARCHAR(25) NULL,
    [DervCTCLBranchId] VARCHAR(10) NULL,
    [DervCTCLId] VARCHAR(25) NULL,
    [GroupAdmin] VARCHAR(25) NULL,
    [BSECashCTCLBranchId] VARCHAR(25) NULL,
    [BSECashCTCLId] VARCHAR(25) NULL,
    [LoginAllowed] VARCHAR(25) NULL,
    [ParticipantType] VARCHAR(25) NULL,
    [DIET] VARCHAR(25) NULL,
    [Netnet] VARCHAR(25) NULL,
    [iWin] VARCHAR(25) NULL,
    [NetNetLite] VARCHAR(25) NULL,
    [MCXCTCLBranchId] VARCHAR(25) NULL,
    [MCXCTCLId] VARCHAR(25) NULL,
    [NCDEXCTCLBranchId] VARCHAR(25) NULL,
    [NCDEXCTCLId] VARCHAR(25) NULL,
    [ProductType] VARCHAR(25) NULL,
    [Col058] VARCHAR(25) NULL,
    [server] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CtclLogTab
-- --------------------------------------------------
CREATE TABLE [dbo].[CtclLogTab]
(
    [Server] VARCHAR(25) NULL,
    [DealerId] VARCHAR(25) NULL,
    [GroupId] VARCHAR(25) NULL,
    [LogonTime] VARCHAR(50) NULL,
    [LogonAttempt] VARCHAR(25) NULL,
    [Reason] VARCHAR(500) NULL,
    [Dummy1] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.daily_feed
-- --------------------------------------------------
CREATE TABLE [dbo].[daily_feed]
(
    [Product Code] VARCHAR(255) NULL,
    [Fund] VARCHAR(255) NULL,
    [Folio Number] VARCHAR(255) NULL,
    [Sub-Broker Code] VARCHAR(255) NULL,
    [Scheme Code] VARCHAR(255) NULL,
    [Dividend Option] VARCHAR(255) NULL,
    [Fund Description] VARCHAR(255) NULL,
    [Transaction Head] VARCHAR(255) NULL,
    [Transaction Number] VARCHAR(255) NULL,
    [Switch_Ref# No#] VARCHAR(255) NULL,
    [Investor Name] VARCHAR(255) NULL,
    [Transaction Mode] VARCHAR(255) NULL,
    [Transaction Status] VARCHAR(255) NULL,
    [Branch Name] VARCHAR(255) NULL,
    [Branch Transaction No] VARCHAR(255) NULL,
    [Transaction Date] VARCHAR(255) NULL,
    [Process Date] VARCHAR(255) NULL,
    [Price] VARCHAR(255) NULL,
    [Units] VARCHAR(255) NULL,
    [Amount] VARCHAR(255) NULL,
    [Agent Code] VARCHAR(255) NULL,
    [Sub-Broker Code1] VARCHAR(255) NULL,
    [Brokerage Percentage] VARCHAR(255) NULL,
    [Commission] VARCHAR(255) NULL,
    [Investor ID] VARCHAR(255) NULL,
    [Report Date] VARCHAR(255) NULL,
    [Report Time] VARCHAR(255) NULL,
    [Transaction Sub] VARCHAR(255) NULL,
    [Application Number] VARCHAR(255) NULL,
    [Transaction ID] VARCHAR(255) NULL,
    [Transaction Description] VARCHAR(255) NULL,
    [Instrument Number] VARCHAR(255) NULL,
    [Transaction Type] VARCHAR(255) NULL,
    [Transaction Flag] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dealer_odin_CSO133
-- --------------------------------------------------
CREATE TABLE [dbo].[dealer_odin_CSO133]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_HDFC_BSECM
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_HDFC_BSECM]
(
    [rec_type] NVARCHAR(255) NULL,
    [int_dep_no] NVARCHAR(255) NULL,
    [dep_slp_no] NVARCHAR(255) NULL,
    [dep_remark] NVARCHAR(255) NULL,
    [rmk_1] NVARCHAR(255) NULL,
    [dep_date] NVARCHAR(255) NULL,
    [total_amt] FLOAT NULL,
    [total_inst] FLOAT NULL,
    [pkup_dt] NVARCHAR(255) NULL,
    [pkup_loc] NVARCHAR(255) NULL,
    [pkup_pnt] NVARCHAR(255) NULL,
    [arrng_cd] NVARCHAR(255) NULL,
    [instr_no] NVARCHAR(255) NULL,
    [instr_dt] NVARCHAR(255) NULL,
    [instr_amt] FLOAT NULL,
    [clr_loc] NVARCHAR(255) NULL,
    [drawer_nm] NVARCHAR(255) NULL,
    [drawee_bk] NVARCHAR(255) NULL,
    [drawee_br] NVARCHAR(255) NULL,
    [enr_1] NVARCHAR(255) NULL,
    [enr_2] NVARCHAR(255) NULL,
    [enr_3] NVARCHAR(255) NULL,
    [filler] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_HDFC_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_HDFC_MCX]
(
    [rec_type] NVARCHAR(255) NULL,
    [int_dep_no] NVARCHAR(255) NULL,
    [dep_slp_no] NVARCHAR(255) NULL,
    [dep_remark] NVARCHAR(255) NULL,
    [rmk_1] NVARCHAR(255) NULL,
    [dep_date] NVARCHAR(255) NULL,
    [total_amt] FLOAT NULL,
    [total_inst] FLOAT NULL,
    [pkup_dt] NVARCHAR(255) NULL,
    [pkup_loc] NVARCHAR(255) NULL,
    [pkup_pnt] NVARCHAR(255) NULL,
    [arrng_cd] NVARCHAR(255) NULL,
    [instr_no] NVARCHAR(255) NULL,
    [instr_dt] NVARCHAR(255) NULL,
    [instr_amt] FLOAT NULL,
    [clr_loc] NVARCHAR(255) NULL,
    [drawer_nm] NVARCHAR(255) NULL,
    [drawee_bk] NVARCHAR(255) NULL,
    [drawee_br] NVARCHAR(255) NULL,
    [enr_1] NVARCHAR(255) NULL,
    [enr_2] NVARCHAR(255) NULL,
    [enr_3] NVARCHAR(255) NULL,
    [filler] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_HDFC_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_HDFC_NCDEX]
(
    [rec_type] NVARCHAR(255) NULL,
    [int_dep_no] NVARCHAR(255) NULL,
    [dep_slp_no] NVARCHAR(255) NULL,
    [dep_remark] NVARCHAR(255) NULL,
    [rmk_1] NVARCHAR(255) NULL,
    [dep_date] NVARCHAR(255) NULL,
    [total_amt] FLOAT NULL,
    [total_inst] FLOAT NULL,
    [pkup_dt] NVARCHAR(255) NULL,
    [pkup_loc] NVARCHAR(255) NULL,
    [pkup_pnt] NVARCHAR(255) NULL,
    [arrng_cd] NVARCHAR(255) NULL,
    [instr_no] NVARCHAR(255) NULL,
    [instr_dt] NVARCHAR(255) NULL,
    [instr_amt] FLOAT NULL,
    [clr_loc] NVARCHAR(255) NULL,
    [drawer_nm] NVARCHAR(255) NULL,
    [drawee_bk] NVARCHAR(255) NULL,
    [drawee_br] NVARCHAR(255) NULL,
    [enr_1] NVARCHAR(255) NULL,
    [enr_2] NVARCHAR(255) NULL,
    [enr_3] NVARCHAR(255) NULL,
    [filler] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_HDFC_NSECM
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_HDFC_NSECM]
(
    [rec_type] NVARCHAR(255) NULL,
    [int_dep_no] NVARCHAR(255) NULL,
    [dep_slp_no] NVARCHAR(255) NULL,
    [dep_remark] NVARCHAR(255) NULL,
    [rmk_1] NVARCHAR(255) NULL,
    [dep_date] NVARCHAR(255) NULL,
    [total_amt] FLOAT NULL,
    [total_inst] FLOAT NULL,
    [pkup_dt] NVARCHAR(255) NULL,
    [pkup_loc] NVARCHAR(255) NULL,
    [pkup_pnt] NVARCHAR(255) NULL,
    [arrng_cd] NVARCHAR(255) NULL,
    [instr_no] NVARCHAR(255) NULL,
    [instr_dt] NVARCHAR(255) NULL,
    [instr_amt] FLOAT NULL,
    [clr_loc] NVARCHAR(255) NULL,
    [drawer_nm] NVARCHAR(255) NULL,
    [drawee_bk] NVARCHAR(255) NULL,
    [drawee_br] NVARCHAR(255) NULL,
    [enr_1] NVARCHAR(255) NULL,
    [enr_2] NVARCHAR(255) NULL,
    [enr_3] NVARCHAR(255) NULL,
    [filler] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_HDFC_NSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_HDFC_NSEFO]
(
    [rec_type] NVARCHAR(255) NULL,
    [int_dep_no] NVARCHAR(255) NULL,
    [dep_slp_no] NVARCHAR(255) NULL,
    [dep_remark] NVARCHAR(255) NULL,
    [rmk_1] NVARCHAR(255) NULL,
    [dep_date] NVARCHAR(255) NULL,
    [total_amt] FLOAT NULL,
    [total_inst] FLOAT NULL,
    [pkup_dt] NVARCHAR(255) NULL,
    [pkup_loc] NVARCHAR(255) NULL,
    [pkup_pnt] NVARCHAR(255) NULL,
    [arrng_cd] NVARCHAR(255) NULL,
    [instr_no] NVARCHAR(255) NULL,
    [instr_dt] NVARCHAR(255) NULL,
    [instr_amt] FLOAT NULL,
    [clr_loc] NVARCHAR(255) NULL,
    [drawer_nm] NVARCHAR(255) NULL,
    [drawee_bk] NVARCHAR(255) NULL,
    [drawee_br] NVARCHAR(255) NULL,
    [enr_1] NVARCHAR(255) NULL,
    [enr_2] NVARCHAR(255) NULL,
    [enr_3] NVARCHAR(255) NULL,
    [filler] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_ICICI_ALL
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_ICICI_ALL]
(
    [CUST_CODE] VARCHAR(10) NULL,
    [PRODUC] VARCHAR(10) NULL,
    [COLL_LOCATION] VARCHAR(100) NULL,
    [HIER] VARCHAR(10) NULL,
    [DIVN] VARCHAR(10) NULL,
    [CLG_ZN] VARCHAR(10) NULL,
    [ENTRY_DATE] VARCHAR(10) NULL,
    [RBI_SBI_CR] VARCHAR(10) NULL,
    [ARN_DATE] VARCHAR(10) NULL,
    [CR_DATE] VARCHAR(10) NULL,
    [SLIP_NO] INT NULL,
    [INS_NO] INT NULL,
    [INSTRUMENT_AMOUNT] MONEY NULL,
    [LOCTN] VARCHAR(10) NULL,
    [DRAWN_ON_LOCATION] VARCHAR(100) NULL,
    [REAL_DATE] VARCHAR(10) NULL,
    [RTN_DATE] VARCHAR(10) NULL,
    [REVL_DATE] VARCHAR(10) NULL,
    [DRAWER_NAME] VARCHAR(100) NULL,
    [DRN_BK] VARCHAR(100) NULL,
    [DRN_BR] VARCHAR(100) NULL,
    [ADDL_INFO1] VARCHAR(100) NULL,
    [ADDL_INFO2] VARCHAR(100) NULL,
    [ADDL_INFO3] VARCHAR(100) NULL,
    [ADDL_INFO4] VARCHAR(100) NULL,
    [ADDL_INFO5] VARCHAR(100) NULL,
    [DR_BK] VARCHAR(50) NULL,
    [DR_BR] VARCHAR(50) NULL,
    [DEP_AD_IF_CODE] VARCHAR(50) NULL,
    [RTN_RSN] INT NULL,
    [DY_SL] INT NULL,
    [IN_SL] INT NULL,
    [Dep_Addl_1] VARCHAR(100) NULL,
    [Dep_Addl_2] VARCHAR(100) NULL,
    [Dep_Addl_3] VARCHAR(100) NULL,
    [Dep_Addl_4] VARCHAR(100) NULL,
    [Dep_Addl_5] VARCHAR(100) NULL,
    [Entd_By] VARCHAR(10) NULL,
    [Auth_By] VARCHAR(10) NULL,
    [Dep_Br] VARCHAR(10) NULL,
    [Remarks] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_Kotak_BSECM
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_Kotak_BSECM]
(
    [DEPOSIT_NMBR] NVARCHAR(255) NULL,
    [CLIENT_CODE] NVARCHAR(255) NULL,
    [CLIENT_DESCRIPTION] NVARCHAR(255) NULL,
    [PRODUCT_CODE] NVARCHAR(255) NULL,
    [DEPOSIT_DATE] DATETIME NULL,
    [TOTAL_AMNT] FLOAT NULL,
    [TOTAL_INSTRUMENTS] FLOAT NULL,
    [PICKUP_DESC] NVARCHAR(255) NULL,
    [INPUT_DEPOSIT_NMBR] FLOAT NULL,
    [INSTRUMENT_NMBR] FLOAT NULL,
    [INSTRUMENT_DATE] DATETIME NULL,
    [INSTRUMENT_AMNT] FLOAT NULL,
    [DRAWEE_BANK_CODE] FLOAT NULL,
    [DRAWEE_BRANCH_CODE] FLOAT NULL,
    [CLG_LOC_DESC] NVARCHAR(255) NULL,
    [DRAWER_CODE] NVARCHAR(255) NULL,
    [DRAWER_DESCRIPTION] NVARCHAR(255) NULL,
    [ENRICHMENT_1] FLOAT NULL,
    [ENRICHMENT_2] NVARCHAR(255) NULL,
    [ENRICHMENT_3] NVARCHAR(255) NULL,
    [ENRICHMENT_4] NVARCHAR(255) NULL,
    [ENRICHMENT_5] NVARCHAR(255) NULL,
    [ENRICHMENT_6] NVARCHAR(255) NULL,
    [ENRICHMENT_7] NVARCHAR(255) NULL,
    [ENRICHMENT_8] NVARCHAR(255) NULL,
    [ENRICHMENT_9] NVARCHAR(255) NULL,
    [ENRICHMENT_10] NVARCHAR(255) NULL,
    [ENRICHMENT_11] NVARCHAR(255) NULL,
    [ENRICHMENT_12] NVARCHAR(255) NULL,
    [ENRICHMENT_13] NVARCHAR(255) NULL,
    [ENRICHMENT_14] NVARCHAR(255) NULL,
    [ENRICHMENT_15] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_Kotak_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_Kotak_MCX]
(
    [DEPOSIT_NMBR] NVARCHAR(255) NULL,
    [CLIENT_CODE] NVARCHAR(255) NULL,
    [CLIENT_DESCRIPTION] NVARCHAR(255) NULL,
    [PRODUCT_CODE] NVARCHAR(255) NULL,
    [DEPOSIT_DATE] DATETIME NULL,
    [TOTAL_AMNT] FLOAT NULL,
    [TOTAL_INSTRUMENTS] FLOAT NULL,
    [PICKUP_DESC] NVARCHAR(255) NULL,
    [INPUT_DEPOSIT_NMBR] FLOAT NULL,
    [INSTRUMENT_NMBR] FLOAT NULL,
    [INSTRUMENT_DATE] DATETIME NULL,
    [INSTRUMENT_AMNT] FLOAT NULL,
    [DRAWEE_BANK_CODE] FLOAT NULL,
    [DRAWEE_BRANCH_CODE] FLOAT NULL,
    [CLG_LOC_DESC] NVARCHAR(255) NULL,
    [DRAWER_CODE] NVARCHAR(255) NULL,
    [DRAWER_DESCRIPTION] NVARCHAR(255) NULL,
    [ENRICHMENT_1] FLOAT NULL,
    [ENRICHMENT_2] NVARCHAR(255) NULL,
    [ENRICHMENT_3] NVARCHAR(255) NULL,
    [ENRICHMENT_4] NVARCHAR(255) NULL,
    [ENRICHMENT_5] NVARCHAR(255) NULL,
    [ENRICHMENT_6] NVARCHAR(255) NULL,
    [ENRICHMENT_7] NVARCHAR(255) NULL,
    [ENRICHMENT_8] NVARCHAR(255) NULL,
    [ENRICHMENT_9] NVARCHAR(255) NULL,
    [ENRICHMENT_10] NVARCHAR(255) NULL,
    [ENRICHMENT_11] NVARCHAR(255) NULL,
    [ENRICHMENT_12] NVARCHAR(255) NULL,
    [ENRICHMENT_13] NVARCHAR(255) NULL,
    [ENRICHMENT_14] NVARCHAR(255) NULL,
    [ENRICHMENT_15] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_Kotak_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_Kotak_NCDEX]
(
    [DEPOSIT_NMBR] NVARCHAR(255) NULL,
    [CLIENT_CODE] NVARCHAR(255) NULL,
    [CLIENT_DESCRIPTION] NVARCHAR(255) NULL,
    [PRODUCT_CODE] NVARCHAR(255) NULL,
    [DEPOSIT_DATE] DATETIME NULL,
    [TOTAL_AMNT] FLOAT NULL,
    [TOTAL_INSTRUMENTS] FLOAT NULL,
    [PICKUP_DESC] NVARCHAR(255) NULL,
    [INPUT_DEPOSIT_NMBR] FLOAT NULL,
    [INSTRUMENT_NMBR] FLOAT NULL,
    [INSTRUMENT_DATE] DATETIME NULL,
    [INSTRUMENT_AMNT] FLOAT NULL,
    [DRAWEE_BANK_CODE] FLOAT NULL,
    [DRAWEE_BRANCH_CODE] FLOAT NULL,
    [CLG_LOC_DESC] NVARCHAR(255) NULL,
    [DRAWER_CODE] NVARCHAR(255) NULL,
    [DRAWER_DESCRIPTION] NVARCHAR(255) NULL,
    [ENRICHMENT_1] FLOAT NULL,
    [ENRICHMENT_2] NVARCHAR(255) NULL,
    [ENRICHMENT_3] NVARCHAR(255) NULL,
    [ENRICHMENT_4] NVARCHAR(255) NULL,
    [ENRICHMENT_5] NVARCHAR(255) NULL,
    [ENRICHMENT_6] NVARCHAR(255) NULL,
    [ENRICHMENT_7] NVARCHAR(255) NULL,
    [ENRICHMENT_8] NVARCHAR(255) NULL,
    [ENRICHMENT_9] NVARCHAR(255) NULL,
    [ENRICHMENT_10] NVARCHAR(255) NULL,
    [ENRICHMENT_11] NVARCHAR(255) NULL,
    [ENRICHMENT_12] NVARCHAR(255) NULL,
    [ENRICHMENT_13] NVARCHAR(255) NULL,
    [ENRICHMENT_14] NVARCHAR(255) NULL,
    [ENRICHMENT_15] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_Kotak_NSECM
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_Kotak_NSECM]
(
    [DEPOSIT_NMBR] NVARCHAR(255) NULL,
    [CLIENT_CODE] NVARCHAR(255) NULL,
    [CLIENT_DESCRIPTION] NVARCHAR(255) NULL,
    [PRODUCT_CODE] NVARCHAR(255) NULL,
    [DEPOSIT_DATE] DATETIME NULL,
    [TOTAL_AMNT] FLOAT NULL,
    [TOTAL_INSTRUMENTS] FLOAT NULL,
    [PICKUP_DESC] NVARCHAR(255) NULL,
    [INPUT_DEPOSIT_NMBR] FLOAT NULL,
    [INSTRUMENT_NMBR] FLOAT NULL,
    [INSTRUMENT_DATE] DATETIME NULL,
    [INSTRUMENT_AMNT] FLOAT NULL,
    [DRAWEE_BANK_CODE] FLOAT NULL,
    [DRAWEE_BRANCH_CODE] FLOAT NULL,
    [CLG_LOC_DESC] NVARCHAR(255) NULL,
    [DRAWER_CODE] NVARCHAR(255) NULL,
    [DRAWER_DESCRIPTION] NVARCHAR(255) NULL,
    [ENRICHMENT_1] FLOAT NULL,
    [ENRICHMENT_2] NVARCHAR(255) NULL,
    [ENRICHMENT_3] NVARCHAR(255) NULL,
    [ENRICHMENT_4] NVARCHAR(255) NULL,
    [ENRICHMENT_5] NVARCHAR(255) NULL,
    [ENRICHMENT_6] NVARCHAR(255) NULL,
    [ENRICHMENT_7] NVARCHAR(255) NULL,
    [ENRICHMENT_8] NVARCHAR(255) NULL,
    [ENRICHMENT_9] NVARCHAR(255) NULL,
    [ENRICHMENT_10] NVARCHAR(255) NULL,
    [ENRICHMENT_11] NVARCHAR(255) NULL,
    [ENRICHMENT_12] NVARCHAR(255) NULL,
    [ENRICHMENT_13] NVARCHAR(255) NULL,
    [ENRICHMENT_14] NVARCHAR(255) NULL,
    [ENRICHMENT_15] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_Kotak_NSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_Kotak_NSEFO]
(
    [DEPOSIT_NMBR] NVARCHAR(255) NULL,
    [CLIENT_CODE] NVARCHAR(255) NULL,
    [CLIENT_DESCRIPTION] NVARCHAR(255) NULL,
    [PRODUCT_CODE] NVARCHAR(255) NULL,
    [DEPOSIT_DATE] DATETIME NULL,
    [TOTAL_AMNT] FLOAT NULL,
    [TOTAL_INSTRUMENTS] FLOAT NULL,
    [PICKUP_DESC] NVARCHAR(255) NULL,
    [INPUT_DEPOSIT_NMBR] FLOAT NULL,
    [INSTRUMENT_NMBR] FLOAT NULL,
    [INSTRUMENT_DATE] DATETIME NULL,
    [INSTRUMENT_AMNT] FLOAT NULL,
    [DRAWEE_BANK_CODE] FLOAT NULL,
    [DRAWEE_BRANCH_CODE] FLOAT NULL,
    [CLG_LOC_DESC] NVARCHAR(255) NULL,
    [DRAWER_CODE] NVARCHAR(255) NULL,
    [DRAWER_DESCRIPTION] NVARCHAR(255) NULL,
    [ENRICHMENT_1] FLOAT NULL,
    [ENRICHMENT_2] NVARCHAR(255) NULL,
    [ENRICHMENT_3] NVARCHAR(255) NULL,
    [ENRICHMENT_4] NVARCHAR(255) NULL,
    [ENRICHMENT_5] NVARCHAR(255) NULL,
    [ENRICHMENT_6] NVARCHAR(255) NULL,
    [ENRICHMENT_7] NVARCHAR(255) NULL,
    [ENRICHMENT_8] NVARCHAR(255) NULL,
    [ENRICHMENT_9] NVARCHAR(255) NULL,
    [ENRICHMENT_10] NVARCHAR(255) NULL,
    [ENRICHMENT_11] NVARCHAR(255) NULL,
    [ENRICHMENT_12] NVARCHAR(255) NULL,
    [ENRICHMENT_13] NVARCHAR(255) NULL,
    [ENRICHMENT_14] NVARCHAR(255) NULL,
    [ENRICHMENT_15] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_SCB_BSECM
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_SCB_BSECM]
(
    [Customer Name] NVARCHAR(255) NULL,
    [Recon No] FLOAT NULL,
    [Deposit Dt] DATETIME NULL,
    [Recon Total] FLOAT NULL,
    [No of cheq] FLOAT NULL,
    [Pick Up Dt] DATETIME NULL,
    [Pick Up Loc] NVARCHAR(255) NULL,
    [Pick Up Point] NVARCHAR(255) NULL,
    [Arrangement Code] NVARCHAR(255) NULL,
    [Cheque No] FLOAT NULL,
    [Cheque Dt] DATETIME NULL,
    [Cheque Amt] FLOAT NULL,
    [Drawn On] NVARCHAR(255) NULL,
    [Drawer Name] NVARCHAR(255) NULL,
    [Drawn On Bank] NVARCHAR(255) NULL,
    [Customer Ref No] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Product Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_SCB_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_SCB_MCX]
(
    [Customer Name] NVARCHAR(255) NULL,
    [Recon No] FLOAT NULL,
    [Deposit Dt] DATETIME NULL,
    [Recon Total] FLOAT NULL,
    [No of cheq] FLOAT NULL,
    [Pick Up Dt] DATETIME NULL,
    [Pick Up Loc] NVARCHAR(255) NULL,
    [Pick Up Point] NVARCHAR(255) NULL,
    [Arrangement Code] NVARCHAR(255) NULL,
    [Cheque No] FLOAT NULL,
    [Cheque Dt] DATETIME NULL,
    [Cheque Amt] FLOAT NULL,
    [Drawn On] NVARCHAR(255) NULL,
    [Drawer Name] NVARCHAR(255) NULL,
    [Drawn On Bank] NVARCHAR(255) NULL,
    [Customer Ref No] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Product Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_SCB_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_SCB_NCDEX]
(
    [Customer Name] NVARCHAR(255) NULL,
    [Recon No] FLOAT NULL,
    [Deposit Dt] DATETIME NULL,
    [Recon Total] FLOAT NULL,
    [No of cheq] FLOAT NULL,
    [Pick Up Dt] DATETIME NULL,
    [Pick Up Loc] NVARCHAR(255) NULL,
    [Pick Up Point] NVARCHAR(255) NULL,
    [Arrangement Code] NVARCHAR(255) NULL,
    [Cheque No] FLOAT NULL,
    [Cheque Dt] DATETIME NULL,
    [Cheque Amt] FLOAT NULL,
    [Drawn On] NVARCHAR(255) NULL,
    [Drawer Name] NVARCHAR(255) NULL,
    [Drawn On Bank] NVARCHAR(255) NULL,
    [Customer Ref No] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Product Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_SCB_NSCEM
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_SCB_NSCEM]
(
    [Customer Name] NVARCHAR(255) NULL,
    [Recon No] FLOAT NULL,
    [Deposit Dt] DATETIME NULL,
    [Recon Total] FLOAT NULL,
    [No of cheq] FLOAT NULL,
    [Pick Up Dt] DATETIME NULL,
    [Pick Up Loc] NVARCHAR(255) NULL,
    [Pick Up Point] NVARCHAR(255) NULL,
    [Arrangement Code] NVARCHAR(255) NULL,
    [Cheque No] FLOAT NULL,
    [Cheque Dt] DATETIME NULL,
    [Cheque Amt] FLOAT NULL,
    [Drawn On] NVARCHAR(255) NULL,
    [Drawer Name] NVARCHAR(255) NULL,
    [Drawn On Bank] NVARCHAR(255) NULL,
    [Customer Ref No] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Product Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_SCB_NSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_SCB_NSEFO]
(
    [Customer Name] NVARCHAR(255) NULL,
    [Recon No] FLOAT NULL,
    [Deposit Dt] DATETIME NULL,
    [Recon Total] FLOAT NULL,
    [No of cheq] FLOAT NULL,
    [Pick Up Dt] DATETIME NULL,
    [Pick Up Loc] NVARCHAR(255) NULL,
    [Pick Up Point] NVARCHAR(255) NULL,
    [Arrangement Code] NVARCHAR(255) NULL,
    [Cheque No] FLOAT NULL,
    [Cheque Dt] DATETIME NULL,
    [Cheque Amt] FLOAT NULL,
    [Drawn On] NVARCHAR(255) NULL,
    [Drawer Name] NVARCHAR(255) NULL,
    [Drawn On Bank] NVARCHAR(255) NULL,
    [Customer Ref No] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Product Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DepReco_YES_ALL
-- --------------------------------------------------
CREATE TABLE [dbo].[DepReco_YES_ALL]
(
    [CORPORATION] NVARCHAR(255) NULL,
    [CLIENT] NVARCHAR(255) NULL,
    [PICKUP LOCATION] NVARCHAR(255) NULL,
    [PICKUP POINT] NVARCHAR(255) NULL,
    [PRODUCT_CODE] NVARCHAR(255) NULL,
    [PRODUCT_DESCRIPTION] NVARCHAR(255) NULL,
    [DEPOSIT_NUMBER] NVARCHAR(255) NULL,
    [DEPOSIT_DATE] NVARCHAR(255) NULL,
    [INSTRUMENT_NMBR] NVARCHAR(255) NULL,
    [INSTRUMENT_DATE] NVARCHAR(255) NULL,
    [INSTRUMENT_AMNT] FLOAT NULL,
    [DRAWEE_BANK_DESCRIPTION] NVARCHAR(255) NULL,
    [DRAWER_DESCRIPTION] NVARCHAR(255) NULL,
    [LOC_DESCRIPTION] NVARCHAR(255) NULL,
    [ENRICHMENT] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DP57_processtime
-- --------------------------------------------------
CREATE TABLE [dbo].[DP57_processtime]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [process_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DP57_processtime_15jul2019
-- --------------------------------------------------
CREATE TABLE [dbo].[DP57_processtime_15jul2019]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [process_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dpageing_errorlog
-- --------------------------------------------------
CREATE TABLE [dbo].[dpageing_errorlog]
(
    [ErrorNumber] VARCHAR(50) NULL,
    [ErrorMessage] VARCHAR(8000) NULL,
    [ErrorSeverity] VARCHAR(120) NULL,
    [ErrorState] VARCHAR(150) NULL,
    [ErrorDateTime] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DPAgeing_UploadTemp
-- --------------------------------------------------
CREATE TABLE [dbo].[DPAgeing_UploadTemp]
(
    [Accountcode] VARCHAR(50) NULL,
    [AccountDesc] VARCHAR(200) NULL,
    [0_30Days] MONEY NULL,
    [31_60Days] MONEY NULL,
    [61_90Days] MONEY NULL,
    [91_120Days] MONEY NULL,
    [121_180Days] MONEY NULL,
    [181_240Days] MONEY NULL,
    [240_360Days] MONEY NULL,
    [>360Days] MONEY NULL,
    [Total] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dpinitiatedclosure
-- --------------------------------------------------
CREATE TABLE [dbo].[dpinitiatedclosure]
(
    [ClientId] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dtc_upload_csv
-- --------------------------------------------------
CREATE TABLE [dbo].[dtc_upload_csv]
(
    [branch] VARCHAR(10) NOT NULL,
    [party_code] VARCHAR(9) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ebrok_connlog_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ebrok_connlog_temp]
(
    [client_code] VARCHAR(10) NULL,
    [client_name] VARCHAR(50) NULL,
    [branch] VARCHAR(11) NULL,
    [date1] VARCHAR(11) NULL,
    [time1] VARCHAR(15) NULL,
    [status] VARCHAR(20) NULL,
    [segment] VARCHAR(155) NULL,
    [retail] VARCHAR(75) NULL,
    [b] VARCHAR(100) NULL,
    [c] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EBROK_EMAIL
-- --------------------------------------------------
CREATE TABLE [dbo].[EBROK_EMAIL]
(
    [PARTY_CODE] VARCHAR(20) NULL,
    [EMAIL] VARCHAR(200) NULL,
    [server1] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ebrok_trade_file
-- --------------------------------------------------
CREATE TABLE [dbo].[ebrok_trade_file]
(
    [curr_date] DATETIME NULL,
    [Date] VARCHAR(50) NULL,
    [EUser] VARCHAR(50) NULL,
    [EGroup] VARCHAR(50) NULL,
    [Exchange_Code] VARCHAR(50) NULL,
    [MemberId] INT NULL,
    [TraderId] INT NULL,
    [Instrument_Type] VARCHAR(50) NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Scrip_code] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Spread_Symbol] VARCHAR(50) NULL,
    [Ser_Exp_Group] VARCHAR(50) NULL,
    [Strike_Price] VARCHAR(30) NULL,
    [Option_Type] VARCHAR(50) NULL,
    [Scrip_Name] VARCHAR(30) NULL,
    [Order_Type] VARCHAR(30) NULL,
    [B_S] CHAR(6) NULL,
    [Quantity] INT NULL,
    [Price] FLOAT NULL,
    [Spread_Price] FLOAT NULL,
    [Spread] VARCHAR(10) NULL,
    [Pro_Cli] CHAR(5) NULL,
    [Client] VARCHAR(30) NULL,
    [Client_Name] VARCHAR(50) NULL,
    [Exch_Order_No] VARCHAR(20) NULL,
    [Trade_No] INT NULL,
    [time] VARCHAR(30) NULL,
    [Settlor] INT NULL,
    [User_Remarks] VARCHAR(30) NULL,
    [New_Client] VARCHAR(30) NULL,
    [Part_Type] VARCHAR(30) NULL,
    [Product_Type] VARCHAR(30) NULL,
    [Order_Entry_Time] VARCHAR(30) NULL,
    [Client_Order_No] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EBrok_Trade_File_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[EBrok_Trade_File_temp]
(
    [Date] VARCHAR(50) NULL,
    [EUser] VARCHAR(50) NULL,
    [EGroup] VARCHAR(50) NULL,
    [Exchange_Code] VARCHAR(50) NULL,
    [MemberId] INT NULL,
    [TraderId] INT NULL,
    [Instrument_Type] VARCHAR(50) NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Scrip_code] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Spread_Symbol] VARCHAR(50) NULL,
    [Ser_Exp_Group] VARCHAR(50) NULL,
    [Strike_Price] VARCHAR(30) NULL,
    [Option_Type] VARCHAR(50) NULL,
    [Scrip_Name] VARCHAR(30) NULL,
    [Order_Type] VARCHAR(30) NULL,
    [B_S] CHAR(6) NULL,
    [Quantity] INT NULL,
    [Price] FLOAT NULL,
    [Spread_Price] FLOAT NULL,
    [Spread] VARCHAR(10) NULL,
    [Pro_Cli] CHAR(5) NULL,
    [Client] VARCHAR(30) NULL,
    [Client_Name] VARCHAR(50) NULL,
    [Exch_Order_No] VARCHAR(20) NULL,
    [Trade_No] INT NULL,
    [time] VARCHAR(30) NULL,
    [Settlor] INT NULL,
    [User_Remarks] VARCHAR(30) NULL,
    [New_Client] VARCHAR(30) NULL,
    [Part_Type] VARCHAR(30) NULL,
    [Product_Type] VARCHAR(30) NULL,
    [Order_Entry_Time] VARCHAR(30) NULL,
    [Client_Order_No] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ebrok_training_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ebrok_training_temp]
(
    [name] VARCHAR(200) NULL,
    [party_code] VARCHAR(25) NULL,
    [branch] VARCHAR(25) NULL,
    [location] VARCHAR(200) NULL,
    [product] VARCHAR(25) NULL,
    [status] VARCHAR(25) NULL,
    [comments] VARCHAR(200) NULL,
    [trainingdate] VARCHAR(25) NULL,
    [kycactivationdate] VARCHAR(25) NULL,
    [ebrokingdate] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ebrok_untrained_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ebrok_untrained_temp]
(
    [name] VARCHAR(200) NULL,
    [party_code] VARCHAR(25) NULL,
    [branch] VARCHAR(25) NULL,
    [mobile] VARCHAR(200) NULL,
    [status] VARCHAR(25) NULL,
    [comments] VARCHAR(200) NULL,
    [ebrokingdate] VARCHAR(25) NULL,
    [trainingdate] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECN_LOWBROK_delivered
-- --------------------------------------------------
CREATE TABLE [dbo].[ECN_LOWBROK_delivered]
(
    [client_code] VARCHAR(20) NULL,
    [delivered_dt] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECN_LOWBROK_DISPATCH
-- --------------------------------------------------
CREATE TABLE [dbo].[ECN_LOWBROK_DISPATCH]
(
    [POD_NO] VARCHAR(50) NULL,
    [dispatch_dt] VARCHAR(25) NULL,
    [desitination] VARCHAR(100) NULL,
    [client_name] VARCHAR(250) NULL,
    [pincode] VARCHAR(50) NULL,
    [party_code] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECN_LOWBROK_RETURNED
-- --------------------------------------------------
CREATE TABLE [dbo].[ECN_LOWBROK_RETURNED]
(
    [client_code] VARCHAR(20) NOT NULL,
    [delivered_dt] VARCHAR(25) NULL,
    [reason] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ecn_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ecn_temp]
(
    [party_code] VARCHAR(35) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ecn_unmatch_pcode
-- --------------------------------------------------
CREATE TABLE [dbo].[ecn_unmatch_pcode]
(
    [party_code] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ecn_yahoo_partycode
-- --------------------------------------------------
CREATE TABLE [dbo].[ecn_yahoo_partycode]
(
    [partycode] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Email
-- --------------------------------------------------
CREATE TABLE [dbo].[Email]
(
    [Branch] NVARCHAR(255) NULL,
    [Email] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Emp_info
-- --------------------------------------------------
CREATE TABLE [dbo].[Emp_info]
(
    [Emp_no] VARCHAR(10) NOT NULL,
    [Emp_name] VARCHAR(50) NOT NULL,
    [email] VARCHAR(50) NULL,
    [status] VARCHAR(10) NOT NULL,
    [Department] VARCHAR(50) NULL,
    [designation] VARCHAR(50) NULL,
    [Senior] VARCHAR(10) NULL,
    [Sr_name] VARCHAR(50) NULL,
    [password] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EquityTrdaes
-- --------------------------------------------------
CREATE TABLE [dbo].[EquityTrdaes]
(
    [ScripCode] VARCHAR(50) NULL,
    [ScripName] VARCHAR(50) NULL,
    [DealId] VARCHAR(50) NULL,
    [TradeNo] VARCHAR(50) NULL,
    [TradeDate] VARCHAR(50) NULL,
    [TradeTime] VARCHAR(50) NULL,
    [MemberCode] VARCHAR(50) NULL,
    [MemberName] VARCHAR(50) NULL,
    [ClientCode] VARCHAR(50) NULL,
    [ClientType] VARCHAR(50) NULL,
    [OldClient Code] VARCHAR(50) NULL,
    [OldClient Type] VARCHAR(50) NULL,
    [Quantity] VARCHAR(50) NULL,
    [Price] VARCHAR(50) NULL,
    [Value] VARCHAR(50) NULL,
    [TradeType] VARCHAR(50) NULL,
    [OrderNo] VARCHAR(50) NULL,
    [OrderTime] VARCHAR(50) NULL,
    [TerminalNo] VARCHAR(50) NULL,
    [CustodianId] VARCHAR(50) NULL,
    [Buy_Sell] VARCHAR(50) NULL,
    [LocationId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Err_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[Err_Log]
(
    [Err_url] VARCHAR(100) NULL,
    [Err_stkTrace] VARCHAR(8000) NULL,
    [Err_line] VARCHAR(20) NULL,
    [Err_date] VARCHAR(50) NULL,
    [Err_App] VARCHAR(50) NULL,
    [Dev_name] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EXCHANGE MCX-SX_Trd20111117
-- --------------------------------------------------
CREATE TABLE [dbo].[EXCHANGE MCX-SX_Trd20111117]
(
    [Column 0] VARCHAR(50) NULL,
    [Column 1] VARCHAR(50) NULL,
    [Column 2] VARCHAR(50) NULL,
    [Column 3] VARCHAR(50) NULL,
    [Column 4] VARCHAR(50) NULL,
    [Column 5] VARCHAR(50) NULL,
    [Column 6] VARCHAR(50) NULL,
    [Column 7] VARCHAR(50) NULL,
    [Column 8] VARCHAR(50) NULL,
    [Column 9] VARCHAR(50) NULL,
    [Column 10] VARCHAR(50) NULL,
    [Column 11] VARCHAR(50) NULL,
    [Column 12] VARCHAR(50) NULL,
    [Column 13] VARCHAR(50) NULL,
    [Column 14] VARCHAR(50) NULL,
    [Column 15] VARCHAR(50) NULL,
    [Column 16] VARCHAR(50) NULL,
    [Column 17] VARCHAR(50) NULL,
    [Column 18] VARCHAR(50) NULL,
    [Column 19] VARCHAR(50) NULL,
    [Column 20] VARCHAR(50) NULL,
    [Column 21] VARCHAR(50) NULL,
    [Column 22] VARCHAR(50) NULL,
    [Column 23] VARCHAR(50) NULL,
    [Column 24] VARCHAR(50) NULL,
    [Column 25] VARCHAR(50) NULL,
    [Column 26] VARCHAR(50) NULL,
    [Column 27] VARCHAR(50) NULL,
    [Column 28] VARCHAR(50) NULL,
    [Column 29] VARCHAR(50) NULL,
    [Column 30] VARCHAR(50) NULL,
    [Column 31] VARCHAR(50) NULL,
    [Column 32] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FDS_REJECT_DATA_temp1
-- --------------------------------------------------
CREATE TABLE [dbo].[FDS_REJECT_DATA_temp1]
(
    [sDealerCode] VARCHAR(20) NULL,
    [nMessageCode] VARCHAR(20) NULL,
    [nTimeStamp] VARCHAR(20) NULL,
    [nErrorCode] VARCHAR(20) NULL,
    [sAlphaChar] NVARCHAR(255) NULL,
    [sTimeStamp1] VARCHAR(15) NULL,
    [nMessageLength] VARCHAR(20) NULL,
    [nUserID] VARCHAR(20) NULL,
    [sSymbol] NVARCHAR(255) NULL,
    [sSeries] NVARCHAR(255) NULL,
    [nSettlementDays] VARCHAR(20) NULL,
    [nOrderType] VARCHAR(20) NULL,
    [nBuyOrSell] VARCHAR(20) NULL,
    [nTotalQuantity] VARCHAR(20) NULL,
    [nPrice] VARCHAR(20) NULL,
    [nTriggerPrice] VARCHAR(20) NULL,
    [nGoodTillDays] VARCHAR(20) NULL,
    [nDisclosedQuantity] VARCHAR(20) NULL,
    [nMinFillQuantity] VARCHAR(20) NULL,
    [nProOrClient] VARCHAR(20) NULL,
    [sAccountCode] NVARCHAR(255) NULL,
    [sParticipantCode] NVARCHAR(255) NULL,
    [sCPBrokerCode] NVARCHAR(255) NULL,
    [sRemarks] NVARCHAR(255) NULL,
    [nMF] VARCHAR(50) NULL,
    [nAON] VARCHAR(20) NULL,
    [nIOC] VARCHAR(20) NULL,
    [nGTC] VARCHAR(20) NULL,
    [nDay] VARCHAR(20) NULL,
    [nSL] VARCHAR(20) NULL,
    [nMarket] VARCHAR(20) NULL,
    [nATO] VARCHAR(20) NULL,
    [nFrozen] VARCHAR(20) NULL,
    [nModified] VARCHAR(20) NULL,
    [nTraded] VARCHAR(20) NULL,
    [nMatchedInd] VARCHAR(20) NULL,
    [nOrderNumber] VARCHAR(20) NULL,
    [nOrderTime] VARCHAR(20) NULL,
    [nEntryTime] VARCHAR(20) NULL,
    [nAuctionNumber] VARCHAR(20) NULL,
    [cParticipantType] NVARCHAR(255) NULL,
    [nCompetitorPeriod] VARCHAR(20) NULL,
    [nSolicitorPeriod] VARCHAR(20) NULL,
    [cModCancelBy] NVARCHAR(255) NULL,
    [nReasonCode] VARCHAR(20) NULL,
    [cSecuritySuspendIndicator] NVARCHAR(255) NULL,
    [nDisclosedQuantityRemaining] VARCHAR(100) NULL,
    [nTotalQuantityRemaining] VARCHAR(100) NULL,
    [nQuantityTradedToday] VARCHAR(20) NULL,
    [nBranchID] VARCHAR(20) NULL,
    [sBrokerID] NVARCHAR(255) NULL,
    [nSurvErrorCode] VARCHAR(20) NULL,
    [sSurvErrorString] NVARCHAR(255) NULL,
    [cActionCode] NVARCHAR(255) NULL,
    [nAcceptRejectStatus] NVARCHAR(255) NULL,
    [nTokenNumber] NVARCHAR(255) NULL,
    [cOpenClose] NVARCHAR(255) NULL,
    [cCoverUncover] NVARCHAR(255) NULL,
    [cGiveUpFlag] NVARCHAR(255) NULL,
    [sInstrumentName] VARCHAR(20) NULL,
    [nExpiryDate] VARCHAR(20) NULL,
    [nStrikePrice] NVARCHAR(255) NULL,
    [sOptionType] NVARCHAR(255) NULL,
    [nCALevel] NVARCHAR(255) NULL,
    [nBookType] NVARCHAR(255) NULL,
    [nMarketSegmentId] VARCHAR(20) NULL,
    [nTermId] VARCHAR(20) NULL,
    [sUserRemarks] NVARCHAR(255) NULL,
    [nClientOrderNumber] VARCHAR(50) NULL,
    [NSECTCLId] VARCHAR(100) NULL,
    [NSECTCLBranchId] VARCHAR(100) NULL,
    [PINCODE] VARCHAR(50) NULL,
    [sBSEServerOrderNo] NVARCHAR(255) NULL,
    [cRiskReducing] VARCHAR(100) NULL,
    [sClearingMemberId] VARCHAR(20) NULL,
    [sExchangeReplyText] VARCHAR(20) NULL,
    [nOMSId] VARCHAR(20) NULL,
    [nProductType] NVARCHAR(255) NULL,
    [sAmoID] NVARCHAR(255) NULL,
    [sGroupAdminCode] VARCHAR(20) NULL,
    [nLegIndicator] NVARCHAR(255) NULL,
    [nFirstLegPrice] VARCHAR(20) NULL,
    [nSecondLegPrice] VARCHAR(20) NULL,
    [nSequenceNumber] NVARCHAR(255) NULL,
    [sExchangeAccountCode] NVARCHAR(255) NULL,
    [sClientDealerCode] VARCHAR(20) NULL,
    [nEntrySequence] VARCHAR(20) NULL,
    [nPreMarket] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Fina_ Branch
-- --------------------------------------------------
CREATE TABLE [dbo].[Fina_ Branch]
(
    [Branch] VARCHAR(255) NULL,
    [Emails] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Fld_Code
-- --------------------------------------------------
CREATE TABLE [dbo].[Fld_Code]
(
    [Fld_Code] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FOFile_EXPOSURE
-- --------------------------------------------------
CREATE TABLE [dbo].[FOFile_EXPOSURE]
(
    [column0] VARCHAR(10) NULL,
    [column1] VARCHAR(30) NULL,
    [column2] VARCHAR(75) NULL,
    [column3] VARCHAR(20) NULL,
    [column4] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Global_Upload_SANNAS
-- --------------------------------------------------
CREATE TABLE [dbo].[Global_Upload_SANNAS]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [App_nm] NCHAR(10) NULL,
    [SAN_PATH] VARCHAR(50) NULL,
    [NAS_PATH] VARCHAR(50) NULL,
    [Entity_Type] VARCHAR(50) NULL,
    [NoPage] INT NULL,
    [FileType] VARCHAR(50) NULL,
    [Info] VARCHAR(100) NULL,
    [Entered_by] VARCHAR(50) NULL,
    [Entered_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.haircut
-- --------------------------------------------------
CREATE TABLE [dbo].[haircut]
(
    [Sr_No] VARCHAR(255) NULL,
    [BSE_CODE] VARCHAR(255) NULL,
    [NSE_SYMBOL] VARCHAR(255) NULL,
    [COMPANY_NAME] VARCHAR(255) NULL,
    [Haircut] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.hist_tbl_ctcl_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[hist_tbl_ctcl_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL,
    [Branch_id] VARCHAR(50) NULL,
    [EntryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.hist_tbl_ctcl_failed_new
-- --------------------------------------------------
CREATE TABLE [dbo].[hist_tbl_ctcl_failed_new]
(
    [User Id] VARCHAR(15) NULL,
    [Client] VARCHAR(15) NULL,
    [Reason] VARCHAR(5000) NULL,
    [Branch_id] VARCHAR(10) NULL,
    [EntryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.hist_tbl_ctcl_failed_new_442011
-- --------------------------------------------------
CREATE TABLE [dbo].[hist_tbl_ctcl_failed_new_442011]
(
    [User Id] VARCHAR(15) NULL,
    [Client] VARCHAR(15) NULL,
    [Reason] VARCHAR(5000) NULL,
    [Branch_id] VARCHAR(10) NULL,
    [EntryDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Histoy_bulkUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[Histoy_bulkUpload]
(
    [FCode] VARCHAR(50) NULL,
    [TCode] VARCHAR(50) NULL,
    [FSegment] VARCHAR(50) NULL,
    [TSegment] VARCHAR(50) NULL,
    [Amt] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Hod_Mapping
-- --------------------------------------------------
CREATE TABLE [dbo].[Hod_Mapping]
(
    [Hod_no] VARCHAR(25) NULL,
    [Hod_name] VARCHAR(80) NULL,
    [Department] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'icic$'
-- --------------------------------------------------
CREATE TABLE [dbo].['icic$']
(
    [CUS CODE] NVARCHAR(255) NULL,
    [PRODUC] NVARCHAR(255) NULL,
    [COLL LOCATION] NVARCHAR(255) NULL,
    [HIER] NVARCHAR(255) NULL,
    [DIVN] NVARCHAR(255) NULL,
    [CLG ZN] FLOAT NULL,
    [ENTRY DATE] DATETIME NULL,
    [RBI/SBI CR] DATETIME NULL,
    [ARN DATE] NVARCHAR(255) NULL,
    [CR DATE] NVARCHAR(255) NULL,
    [SLIP NO] FLOAT NULL,
    [INS NO] FLOAT NULL,
    [INSTRUMENT AMOUNT] FLOAT NULL,
    [LOCTN] NVARCHAR(255) NULL,
    [DRAWN ON LOCATION] NVARCHAR(255) NULL,
    [REAL DATE] NVARCHAR(255) NULL,
    [RTN DATE] NVARCHAR(255) NULL,
    [REVL DATE] NVARCHAR(255) NULL,
    [DRAWER NAME] NVARCHAR(255) NULL,
    [DRN BK] NVARCHAR(255) NULL,
    [DRN BR] NVARCHAR(255) NULL,
    [ADDL#INFO1] NVARCHAR(255) NULL,
    [ADDL#INFO2] NVARCHAR(255) NULL,
    [ADDL#INFO3] FLOAT NULL,
    [ADDL#INFO4] NVARCHAR(255) NULL,
    [ADDL#INFO5] NVARCHAR(255) NULL,
    [DR# BK] NVARCHAR(255) NULL,
    [DR# BR] NVARCHAR(255) NULL,
    [DEP AD#IF#CODE] NVARCHAR(255) NULL,
    [RTN#RSN] FLOAT NULL,
    [DY#SL] FLOAT NULL,
    [IN#SL] FLOAT NULL,
    [Dep Addl 1] NVARCHAR(255) NULL,
    [Dep Addl 2] NVARCHAR(255) NULL,
    [Dep Addl 3] NVARCHAR(255) NULL,
    [Dep Addl 4] NVARCHAR(255) NULL,
    [Dep Addl 5] NVARCHAR(255) NULL,
    [Entd#By] FLOAT NULL,
    [Auth#By] FLOAT NULL,
    [Dep#Br] FLOAT NULL,
    [Remarks] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.icici_statment
-- --------------------------------------------------
CREATE TABLE [dbo].[icici_statment]
(
    [Acc_number] VARCHAR(200) NULL,
    [Tran_date] VARCHAR(10) NULL,
    [Tran_Particular] VARCHAR(100) NULL,
    [Tran_Remarks] VARCHAR(50) NULL,
    [Inst_Num] VARCHAR(20) NULL,
    [Orig_Sol_Id] VARCHAR(20) NULL,
    [Currency_Code] VARCHAR(20) NULL,
    [Dr_Tran_Amt] VARCHAR(25) NULL,
    [Cr_Tran_Amt] VARCHAR(25) NULL,
    [Bal_Amt] VARCHAR(25) NULL,
    [Deposit_Branch] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IL_Scan_image
-- --------------------------------------------------
CREATE TABLE [dbo].[IL_Scan_image]
(
    [IL_UID] VARCHAR(50) NULL,
    [SCAN_IMG] IMAGE NULL,
    [ENTRY_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IL_SCAN_IMAGE_UPLOAD
-- --------------------------------------------------
CREATE TABLE [dbo].[IL_SCAN_IMAGE_UPLOAD]
(
    [Scan_IMG] IMAGE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.illScrip_Month_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[illScrip_Month_Temp]
(
    [Scrip_cd] VARCHAR(255) NULL,
    [ScriptName] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.illScrip_nse_10052011
-- --------------------------------------------------
CREATE TABLE [dbo].[illScrip_nse_10052011]
(
    [Scrip_cd] VARCHAR(255) NULL,
    [ScripName] VARCHAR(255) NULL,
    [UpdDate] VARCHAR(255) NULL,
    [Month] VARCHAR(10) NULL,
    [Year] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.illScrip_Nse_Month_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[illScrip_Nse_Month_Temp]
(
    [Scrip_cd] VARCHAR(255) NULL,
    [ScriptName] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IMAGE_TEST_WEST
-- --------------------------------------------------
CREATE TABLE [dbo].[IMAGE_TEST_WEST]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [IMAGE_NAME] VARCHAR(50) NULL,
    [CLIENT_ID] VARCHAR(50) NULL,
    [IMAGE_PATH] VARCHAR(100) NULL,
    [IMAGE_CONTENT] VARBINARY(MAX) NULL,
    [UPLOADED_BY] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.InventoryData
-- --------------------------------------------------
CREATE TABLE [dbo].[InventoryData]
(
    [ItemID] VARCHAR(20) NOT NULL,
    [CatID] VARCHAR(20) NOT NULL,
    [Quantity] INT NULL,
    [LastUpdateDate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.InventoryItem
-- --------------------------------------------------
CREATE TABLE [dbo].[InventoryItem]
(
    [ItemID] VARCHAR(20) NOT NULL,
    [ItemName] VARCHAR(60) NOT NULL,
    [ItemDesc] VARCHAR(50) NULL,
    [ItemCreationDate] DATETIME NULL,
    [CatID] VARCHAR(20) NOT NULL,
    [ItemType] VARCHAR(15) NOT NULL,
    [Rate] FLOAT NULL,
    [VAT] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ipo_tranpur
-- --------------------------------------------------
CREATE TABLE [dbo].[ipo_tranpur]
(
    [amc_code] NVARCHAR(255) NULL,
    [folio_no] NVARCHAR(255) NULL,
    [prodcode] NVARCHAR(255) NULL,
    [scheme] NVARCHAR(255) NULL,
    [inv_name] NVARCHAR(255) NULL,
    [trxntype] NVARCHAR(255) NULL,
    [trxnno] FLOAT NULL,
    [trxnmode] NVARCHAR(255) NULL,
    [trxnstat] NVARCHAR(255) NULL,
    [usercode] NVARCHAR(255) NULL,
    [usrtrxno] FLOAT NULL,
    [traddate] DATETIME NULL,
    [postdate] DATETIME NULL,
    [purprice] FLOAT NULL,
    [units] FLOAT NULL,
    [amount] FLOAT NULL,
    [brokcode] NVARCHAR(255) NULL,
    [subbrok] NVARCHAR(255) NULL,
    [brokperc] FLOAT NULL,
    [brokcomm] FLOAT NULL,
    [altfolio] NVARCHAR(255) NULL,
    [rep_date] DATETIME NULL,
    [time] NVARCHAR(255) NULL,
    [trxnsubtyp] NVARCHAR(255) NULL,
    [application_no] NVARCHAR(255) NULL,
    [trxn_nature] NVARCHAR(255) NULL,
    [tax] FLOAT NULL,
    [total_tax] FLOAT NULL,
    [compute_0029] NVARCHAR(255) NULL,
    [micr_no] NVARCHAR(255) NULL,
    [remarks] NVARCHAR(255) NULL,
    [swflag] NVARCHAR(255) NULL,
    [old_folio] NVARCHAR(255) NULL,
    [seq_no] FLOAT NULL,
    [reinvest_flag] NVARCHAR(255) NULL,
    [mult_brok] NVARCHAR(255) NULL,
    [stt] FLOAT NULL,
    [location] NVARCHAR(255) NULL,
    [scheme_type] NVARCHAR(255) NULL,
    [tax_status] NVARCHAR(255) NULL,
    [entry_load] FLOAT NULL,
    [scanrefno] NVARCHAR(255) NULL,
    [pan] NVARCHAR(255) NULL,
    [inv_iin] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IPOBankReceipt_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[IPOBankReceipt_temp]
(
    [SR_No] INT NULL,
    [Edate] VARCHAR(50) NULL,
    [Vdate] VARCHAR(50) NULL,
    [Cltcode] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL,
    [DRCR] VARCHAR(10) NULL,
    [Narration] VARCHAR(500) NULL,
    [BankCode] VARCHAR(50) NULL,
    [BankName] VARCHAR(100) NULL,
    [DDNo] VARCHAR(50) NULL,
    [Branchcode] VARCHAR(50) NULL,
    [BranchName] VARCHAR(100) NULL,
    [chqmode] VARCHAR(10) NULL,
    [chqdate] VARCHAR(50) NULL,
    [chqname] VARCHAR(50) NULL,
    [clmode] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IPOExchangeDetail_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[IPOExchangeDetail_temp]
(
    [ExchIPOCode] VARCHAR(50) NULL,
    [System_IPOCode] VARCHAR(50) NULL,
    [ApplicationNo] VARCHAR(50) NULL,
    [ApplicationLotQty] VARCHAR(50) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Pricepershare] VARCHAR(50) NULL,
    [AllottedQty] VARCHAR(50) NULL,
    [AllotmentAmt] VARCHAR(50) NULL,
    [RefundAmt] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IPOTransaction
-- --------------------------------------------------
CREATE TABLE [dbo].[IPOTransaction]
(
    [ApplicationNo] INT NOT NULL,
    [BidID] VARCHAR(50) NULL,
    [IPOCode] VARCHAR(50) NULL,
    [Quantity] INT NULL,
    [Price] MONEY NULL,
    [BestBidAmount] MONEY NULL,
    [MarginAmount] MONEY NULL,
    [ModeofPayment] VARCHAR(50) NULL,
    [ChequeNo] VARCHAR(25) NULL,
    [ConfirmationNo] VARCHAR(50) NULL,
    [BidStatus] VARCHAR(25) NULL,
    [RejectionCode] VARCHAR(50) NULL,
    [RejectionRemark] VARCHAR(500) NULL,
    [RevisionNo] INT NULL,
    [ClientID] VARCHAR(25) NULL,
    [ClientName] VARCHAR(75) NULL,
    [Status] VARCHAR(10) NULL,
    [BidDate] VARCHAR(15) NULL,
    [GroupID] VARCHAR(25) NULL,
    [BrokerCode] VARCHAR(50) NULL,
    [SBCode] VARCHAR(50) NULL,
    [EnteredBy] VARCHAR(50) NULL,
    [DPID] VARCHAR(25) NULL,
    [ClientBenificiaryID] VARCHAR(50) NULL,
    [RTA] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Events
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Events]
(
    [Fld_Date] VARCHAR(20) NULL,
    [Fld_Type] VARCHAR(50) NULL,
    [Fld_Server] VARCHAR(50) NULL,
    [Fld_Time_From] NVARCHAR(50) NULL,
    [Fld_Time_To] NVARCHAR(50) NULL,
    [Fld_Events] VARCHAR(8000) NULL,
    [Fld_Solution] VARCHAR(8000) NULL,
    [Fld_Problem] VARCHAR(100) NULL,
    [Fld_Downtime] VARCHAR(100) NULL,
    [Fld_Segment] VARCHAR(100) NULL,
    [Fld_Remark] VARCHAR(1000) NULL,
    [UPLOAD_DATETIME] DATETIME NULL,
    [UPLOAD_IPADDRESS] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Events_10012013
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Events_10012013]
(
    [Fld_Date] VARCHAR(20) NULL,
    [Fld_Type] VARCHAR(50) NULL,
    [Fld_Server] VARCHAR(50) NULL,
    [Fld_Time_From] NVARCHAR(50) NULL,
    [Fld_Time_To] NVARCHAR(50) NULL,
    [Fld_Events] VARCHAR(8000) NULL,
    [Fld_Solution] VARCHAR(8000) NULL,
    [Fld_Problem] VARCHAR(100) NULL,
    [Fld_Downtime] VARCHAR(100) NULL,
    [Fld_Segment] VARCHAR(100) NULL,
    [Fld_Remark] VARCHAR(1000) NULL,
    [UPLOAD_DATETIME] DATETIME NULL,
    [UPLOAD_IPADDRESS] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Events_20Jul2016
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Events_20Jul2016]
(
    [Fld_Date] VARCHAR(20) NULL,
    [Fld_Type] VARCHAR(50) NULL,
    [Fld_Server] VARCHAR(50) NULL,
    [Fld_Time_From] NVARCHAR(50) NULL,
    [Fld_Time_To] NVARCHAR(50) NULL,
    [Fld_Events] VARCHAR(8000) NULL,
    [Fld_Solution] VARCHAR(8000) NULL,
    [Fld_Problem] VARCHAR(100) NULL,
    [Fld_Downtime] VARCHAR(100) NULL,
    [Fld_Segment] VARCHAR(100) NULL,
    [Fld_Remark] VARCHAR(1000) NULL,
    [UPLOAD_DATETIME] DATETIME NULL,
    [UPLOAD_IPADDRESS] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Events_NEw
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Events_NEw]
(
    [Date] NVARCHAR(255) NULL,
    [Server] NVARCHAR(255) NULL,
    [Time From] NVARCHAR(255) NULL,
    [Time To] NVARCHAR(255) NULL,
    [Event Particulars] NVARCHAR(255) NULL,
    [SOLUTION] VARCHAR(3000) NULL,
    [Type of Problem] NVARCHAR(255) NULL,
    [Downtime in minutes] FLOAT NULL,
    [Impacted Segment] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_Events1
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_Events1]
(
    [Fld_Datevarchar] VARCHAR(20) NULL,
    [Fld_Server] VARCHAR(2000) NULL,
    [Fld_Time_From] VARCHAR(20) NULL,
    [Fld_Time_To] VARCHAR(2000) NULL,
    [Fld_Events] VARCHAR(2000) NULL,
    [Fld_Solution] VARCHAR(2000) NULL,
    [Fld_Problem] VARCHAR(2000) NULL,
    [Fld_Downtime] VARCHAR(20) NULL,
    [Fld_Segment] VARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IT_temp2
-- --------------------------------------------------
CREATE TABLE [dbo].[IT_temp2]
(
    [Tdate] NVARCHAR(255) NULL,
    [Server] NVARCHAR(255) NULL,
    [Time From] NVARCHAR(255) NULL,
    [Time To] NVARCHAR(255) NULL,
    [Event Particulars] NVARCHAR(255) NULL,
    [Solution] NCHAR(3000) NULL,
    [Type of Problem] NVARCHAR(255) NULL,
    [Downtime in minutes] FLOAT NULL,
    [Impacted Segment] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.itasset1
-- --------------------------------------------------
CREATE TABLE [dbo].[itasset1]
(
    [Column 0] NVARCHAR(50) NULL,
    [Column 1] NVARCHAR(50) NULL,
    [Column 2] NVARCHAR(50) NULL,
    [Column 3] NVARCHAR(50) NULL,
    [Column 4] NVARCHAR(50) NULL,
    [Column 5] NVARCHAR(50) NULL,
    [Column 6] NVARCHAR(50) NULL,
    [Column 7] NVARCHAR(50) NULL,
    [Column 8] NVARCHAR(50) NULL,
    [Column 9] NVARCHAR(50) NULL,
    [Column 10] NVARCHAR(50) NULL,
    [Column 11] NVARCHAR(50) NULL,
    [Column 12] NVARCHAR(50) NULL,
    [Column 13] NVARCHAR(50) NULL,
    [Column 14] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.kyc
-- --------------------------------------------------
CREATE TABLE [dbo].[kyc]
(
    [Srno] NVARCHAR(255) NULL,
    [Ddate] DATETIME NULL,
    [Destination_Name] NVARCHAR(255) NULL,
    [Client_ID] NVARCHAR(255) NULL,
    [Client_Name] NVARCHAR(255) NULL,
    [Pin_code] NVARCHAR(255) NULL,
    [F7] NVARCHAR(255) NULL,
    [F8] NVARCHAR(255) NULL,
    [F9] NVARCHAR(255) NULL,
    [F10] NVARCHAR(255) NULL,
    [F11] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LD_CLIENTDATA_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[LD_CLIENTDATA_TEMP]
(
    [Client Code] VARCHAR(20) NULL,
    [Client Name] VARCHAR(200) NULL,
    [Branch Code] VARCHAR(20) NULL,
    [Final Margin] VARCHAR(200) NULL,
    [Utilization] VARCHAR(200) NULL,
    [Adhoc Dr/Cr] VARCHAR(200) NULL,
    [Net Margin] VARCHAR(200) NULL,
    [BSE MTM] VARCHAR(200) NULL,
    [BSE Var] VARCHAR(200) NULL,
    [NSE MTM] VARCHAR(200) NULL,
    [NSE Var] VARCHAR(200) NULL,
    [NSEF Span] VARCHAR(200) NULL,
    [NSEF MVM] VARCHAR(200) NULL,
    [NSEF MTM] VARCHAR(200) NULL,
    [MCX Span] VARCHAR(200) NULL,
    [MCX MVM] VARCHAR(200) NULL,
    [MCX MTM] VARCHAR(200) NULL,
    [NCDX Span] VARCHAR(200) NULL,
    [NCDX MVM] VARCHAR(200) NULL,
    [NCDX MTM] VARCHAR(200) NULL,
    [NSEC Span] VARCHAR(200) NULL,
    [NSEC MVM] VARCHAR(200) NULL,
    [NSEC MTM] VARCHAR(200) NULL,
    [MCXC Span] VARCHAR(200) NULL,
    [MCXC MVM] VARCHAR(200) NULL,
    [MCXC MTM] VARCHAR(200) NULL,
    [Log Mtm] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LD_CLIENTDATA_TEMP_UAT
-- --------------------------------------------------
CREATE TABLE [dbo].[LD_CLIENTDATA_TEMP_UAT]
(
    [Client Code] VARCHAR(20) NULL,
    [Client Name] VARCHAR(200) NULL,
    [Branch Code] VARCHAR(20) NULL,
    [Final Margin] VARCHAR(200) NULL,
    [Utilization] VARCHAR(200) NULL,
    [Adhoc Dr/Cr] VARCHAR(200) NULL,
    [Net Margin] VARCHAR(200) NULL,
    [BSE MTM] VARCHAR(200) NULL,
    [BSE Var] VARCHAR(200) NULL,
    [NSE MTM] VARCHAR(200) NULL,
    [NSE Var] VARCHAR(200) NULL,
    [NSEF Span] VARCHAR(200) NULL,
    [NSEF MVM] VARCHAR(200) NULL,
    [NSEF MTM] VARCHAR(200) NULL,
    [MCX Span] VARCHAR(200) NULL,
    [MCX MVM] VARCHAR(200) NULL,
    [MCX MTM] VARCHAR(200) NULL,
    [NCDX Span] VARCHAR(200) NULL,
    [NCDX MVM] VARCHAR(200) NULL,
    [NCDX MTM] VARCHAR(200) NULL,
    [NSEC Span] VARCHAR(200) NULL,
    [NSEC MVM] VARCHAR(200) NULL,
    [NSEC MTM] VARCHAR(200) NULL,
    [MCXC Span] VARCHAR(200) NULL,
    [MCXC MVM] VARCHAR(200) NULL,
    [MCXC MTM] VARCHAR(200) NULL,
    [Log Mtm] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LD_CLIENTDATA_tmp2
-- --------------------------------------------------
CREATE TABLE [dbo].[LD_CLIENTDATA_tmp2]
(
    [Client Code] VARCHAR(20) NULL,
    [Client Name] VARCHAR(200) NULL,
    [Branch Code] VARCHAR(20) NULL,
    [Final Margin] MONEY NULL,
    [Utilization] MONEY NULL,
    [Adhoc Dr/Cr] MONEY NULL,
    [Net Margin] MONEY NULL,
    [BSE MTM] MONEY NULL,
    [BSE Var] MONEY NULL,
    [NSE MTM] MONEY NULL,
    [NSE Var] MONEY NULL,
    [NSEF Span] MONEY NULL,
    [NSEF Exposure] MONEY NULL,
    [NSEF MTM] MONEY NULL,
    [MCX Span] MONEY NULL,
    [MCX Exposure] MONEY NULL,
    [MCX MTM] MONEY NULL,
    [NCDX Span] MONEY NULL,
    [NCDX Exposure] MONEY NULL,
    [NCDX MTM] MONEY NULL,
    [NSEC Span] MONEY NULL,
    [NSEC MVM] MONEY NULL,
    [NSEC MTM] MONEY NULL,
    [MCXC Span] MONEY NULL,
    [MCXC MVM] MONEY NULL,
    [MCXC MTM] MONEY NULL,
    [Log Mtm] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LD_VARDATA_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[LD_VARDATA_TEMP]
(
    [CLTCODE] VARCHAR(20) NULL,
    [CLTNAME] VARCHAR(200) NULL,
    [BRANCH_CODE] VARCHAR(20) NULL,
    [FINAL_MARGIN] MONEY NULL,
    [UTILIZATION] MONEY NULL,
    [ADHOC_DRCR] MONEY NULL,
    [NET_MARGIN] MONEY NULL,
    [BSE_MTM] MONEY NULL,
    [BSE_VAR] MONEY NULL,
    [NSE_VAR] MONEY NULL,
    [NSE_MTM] MONEY NULL,
    [NSEF_SPAN] MONEY NULL,
    [NSEF_MVM] MONEY NULL,
    [NSEF_MTM] MONEY NULL,
    [MCX_SPAN] MONEY NULL,
    [MCX_MVM] MONEY NULL,
    [MCX_MTM] MONEY NULL,
    [NCDX_SPAN] MONEY NULL,
    [NCDX_MVM] MONEY NULL,
    [NCDX_MTM] MONEY NULL,
    [NSEC_SPAN] MONEY NULL,
    [NSEC_MVM] MONEY NULL,
    [NSEC_MTM] MONEY NULL,
    [MCXC_SPAN] MONEY NULL,
    [MCXC_MVM] MONEY NULL,
    [MCXC_MTM] MONEY NULL,
    [LOG_MTM] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ledger_txt
-- --------------------------------------------------
CREATE TABLE [dbo].[Ledger_txt]
(
    [txt] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.list_ebroking_segment
-- --------------------------------------------------
CREATE TABLE [dbo].[list_ebroking_segment]
(
    [opcode] VARCHAR(5) NULL,
    [pcode] VARCHAR(45) NULL,
    [tag] VARCHAR(45) NULL,
    [pname] VARCHAR(200) NULL,
    [Password] VARCHAR(45) NULL,
    [bbb] VARCHAR(45) NULL,
    [Address1] VARCHAR(200) NULL,
    [Address2] VARCHAR(200) NULL,
    [City] VARCHAR(45) NULL,
    [pin] VARCHAR(25) NULL,
    [Telephone_No] VARCHAR(45) NULL,
    [Fax] VARCHAR(45) NULL,
    [Email] VARCHAR(100) NULL,
    [Status] VARCHAR(45) NULL,
    [Brokerage] VARCHAR(45) NULL,
    [SurvOn] VARCHAR(45) NULL,
    [SurvAuto] VARCHAR(45) NULL,
    [BankDPOnOff] VARCHAR(45) NULL,
    [ParticipantCode] VARCHAR(45) NULL,
    [Filler1] VARCHAR(45) NULL,
    [Filler2] VARCHAR(45) NULL,
    [Filler3] VARCHAR(45) NULL,
    [Filler4] VARCHAR(45) NULL,
    [Trading_Allowed] VARCHAR(45) NULL,
    [ClientValidationOnOff] VARCHAR(45) NULL,
    [SpanOnOff] VARCHAR(45) NULL,
    [DervPartCode] VARCHAR(45) NULL,
    [IP] VARCHAR(45) NULL,
    [MaxNoOfOrder] VARCHAR(45) NULL,
    [BCastScrips] VARCHAR(45) NULL,
    [Alias_DealerId] VARCHAR(45) NULL,
    [FamilyName] VARCHAR(45) NULL,
    [EqFlag] VARCHAR(45) NULL,
    [DervFlag] VARCHAR(100) NULL,
    [CombFlag] VARCHAR(25) NULL,
    [BSEEq] VARCHAR(45) NULL,
    [NEBEComb] VARCHAR(45) NULL,
    [NEBEEq] VARCHAR(45) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(100) NULL,
    [NSE_Cash_CTCLId] VARCHAR(45) NULL,
    [BranchName] VARCHAR(45) NULL,
    [Derv_CTCL_BranchId] VARCHAR(45) NULL,
    [Derv_CTCL_Id] VARCHAR(45) NULL,
    [ddd] VARCHAR(45) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(45) NULL,
    [BSE_Cash_CTCLId] VARCHAR(45) NULL,
    [Login_Allowed] VARCHAR(10) NULL,
    [Participant_Type] VARCHAR(20) NULL,
    [DIET] VARCHAR(5) NULL,
    [NetDotnet] VARCHAR(5) NULL,
    [iWin] VARCHAR(5) NULL,
    [NetNetLite] VARCHAR(5) NULL,
    [MCX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCX_CTCLId] VARCHAR(20) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(20) NULL,
    [NCDEX_CTCLId] VARCHAR(20) NULL,
    [Product_Type] VARCHAR(20) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(20) NULL,
    [NSEL_CTCLId] VARCHAR(20) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_CTCLId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(20) NULL,
    [NSCE_CTCL_BranchId] VARCHAR(20) NULL,
    [NSCE_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCLId] VARCHAR(20) NULL,
    [DSE_CTCL_BranchId] VARCHAR(20) NULL,
    [DSE_CTCLId] VARCHAR(20) NULL,
    [Market_Data_Allowed] VARCHAR(20) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_EQ_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(20) NULL,
    [DSE_Participant_Code] VARCHAR(20) NULL,
    [MCX_Participant_Code] VARCHAR(20) NULL,
    [NMCE_Participant_Code] VARCHAR(20) NULL,
    [PanCard] VARCHAR(10) NULL,
    [Remarks] VARCHAR(200) NULL,
    [Inactive_segment] VARCHAR(10) NULL,
    [UniqueId] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.list_ebroking_segment_anywhere
-- --------------------------------------------------
CREATE TABLE [dbo].[list_ebroking_segment_anywhere]
(
    [User_Id] VARCHAR(45) NULL,
    [lockstatus] VARCHAR(45) NULL,
    [passwordlock] VARCHAR(50) NULL,
    [source] VARCHAR(45) NULL,
    [loginsource] VARCHAR(45) NULL,
    [loginid] VARCHAR(45) NULL,
    [branch] VARCHAR(45) NULL,
    [sstatus] VARCHAR(45) NULL,
    [pcode] VARCHAR(50) NULL,
    [clienttype] VARCHAR(45) NULL,
    [clientcat] VARCHAR(45) NULL,
    [pdealer] VARCHAR(45) NULL,
    [clientstatus] VARCHAR(45) NULL,
    [cliname] VARCHAR(75) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.list_ebroking_segment_old
-- --------------------------------------------------
CREATE TABLE [dbo].[list_ebroking_segment_old]
(
    [opcode] VARCHAR(5) NULL,
    [pcode] VARCHAR(45) NULL,
    [tag] VARCHAR(45) NULL,
    [pname] VARCHAR(200) NULL,
    [Password] VARCHAR(45) NULL,
    [bbb] VARCHAR(45) NULL,
    [Address1] VARCHAR(200) NULL,
    [Address2] VARCHAR(200) NULL,
    [City] VARCHAR(45) NULL,
    [pin] VARCHAR(25) NULL,
    [Telephone_No] VARCHAR(45) NULL,
    [Fax] VARCHAR(45) NULL,
    [Email] VARCHAR(100) NULL,
    [Status] VARCHAR(45) NULL,
    [Brokerage] VARCHAR(45) NULL,
    [SurvOn] VARCHAR(45) NULL,
    [SurvAuto] VARCHAR(45) NULL,
    [BankDPOnOff] VARCHAR(45) NULL,
    [ParticipantCode] VARCHAR(45) NULL,
    [Filler1] VARCHAR(45) NULL,
    [Filler2] VARCHAR(45) NULL,
    [Filler3] VARCHAR(45) NULL,
    [Filler4] VARCHAR(45) NULL,
    [Trading_Allowed] VARCHAR(45) NULL,
    [ClientValidationOnOff] VARCHAR(45) NULL,
    [SpanOnOff] VARCHAR(45) NULL,
    [DervPartCode] VARCHAR(45) NULL,
    [IP] VARCHAR(45) NULL,
    [MaxNoOfOrder] VARCHAR(45) NULL,
    [BCastScrips] VARCHAR(45) NULL,
    [Alias_DealerId] VARCHAR(45) NULL,
    [FamilyName] VARCHAR(45) NULL,
    [EqFlag] VARCHAR(45) NULL,
    [DervFlag] VARCHAR(100) NULL,
    [CombFlag] VARCHAR(25) NULL,
    [BSEEq] VARCHAR(45) NULL,
    [NEBEComb] VARCHAR(45) NULL,
    [NEBEEq] VARCHAR(45) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(100) NULL,
    [NSE_Cash_CTCLId] VARCHAR(45) NULL,
    [BranchName] VARCHAR(45) NULL,
    [Derv_CTCL_BranchId] VARCHAR(45) NULL,
    [Derv_CTCL_Id] VARCHAR(45) NULL,
    [ddd] VARCHAR(45) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(45) NULL,
    [BSE_Cash_CTCLId] VARCHAR(45) NULL,
    [Login_Allowed] VARCHAR(5) NULL,
    [Participant_Type] VARCHAR(20) NULL,
    [DIET] VARCHAR(5) NULL,
    [NetDotnet] VARCHAR(5) NULL,
    [iWin] VARCHAR(5) NULL,
    [NetNetLite] VARCHAR(5) NULL,
    [MCX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCX_CTCLId] VARCHAR(20) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(20) NULL,
    [NCDEX_CTCLId] VARCHAR(20) NULL,
    [Product_Type] VARCHAR(20) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(20) NULL,
    [NSEL_CTCLId] VARCHAR(20) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_CTCLId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(20) NULL,
    [NSCE_CTCL_BranchId] VARCHAR(20) NULL,
    [NSCE_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCLId] VARCHAR(20) NULL,
    [DSE_CTCL_BranchId] VARCHAR(20) NULL,
    [DSE_CTCLId] VARCHAR(20) NULL,
    [Market_Data_Allowed] VARCHAR(20) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_EQ_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(20) NULL,
    [DSE_Participant_Code] VARCHAR(20) NULL,
    [MCX_Participant_Code] VARCHAR(20) NULL,
    [NMCE_Participant_Code] VARCHAR(20) NULL,
    [PanCard] VARCHAR(10) NULL,
    [Remarks] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.list_ebroking_segment_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[list_ebroking_segment_temp]
(
    [opcode] VARCHAR(5) NULL,
    [pcode] VARCHAR(45) NULL,
    [tag] VARCHAR(45) NULL,
    [pname] VARCHAR(200) NULL,
    [Password] VARCHAR(45) NULL,
    [bbb] VARCHAR(45) NULL,
    [Address1] VARCHAR(200) NULL,
    [Address2] VARCHAR(200) NULL,
    [City] VARCHAR(45) NULL,
    [pin] VARCHAR(25) NULL,
    [Telephone_No] VARCHAR(45) NULL,
    [Fax] VARCHAR(45) NULL,
    [Email] VARCHAR(100) NULL,
    [Status] VARCHAR(45) NULL,
    [Brokerage] VARCHAR(45) NULL,
    [SurvOn] VARCHAR(45) NULL,
    [SurvAuto] VARCHAR(45) NULL,
    [BankDPOnOff] VARCHAR(45) NULL,
    [ParticipantCode] VARCHAR(45) NULL,
    [Filler1] VARCHAR(45) NULL,
    [Filler2] VARCHAR(45) NULL,
    [Filler3] VARCHAR(45) NULL,
    [Filler4] VARCHAR(45) NULL,
    [Trading_Allowed] VARCHAR(45) NULL,
    [ClientValidationOnOff] VARCHAR(45) NULL,
    [SpanOnOff] VARCHAR(45) NULL,
    [DervPartCode] VARCHAR(45) NULL,
    [IP] VARCHAR(45) NULL,
    [MaxNoOfOrder] VARCHAR(45) NULL,
    [BCastScrips] VARCHAR(45) NULL,
    [Alias_DealerId] VARCHAR(45) NULL,
    [FamilyName] VARCHAR(45) NULL,
    [EqFlag] VARCHAR(45) NULL,
    [DervFlag] VARCHAR(100) NULL,
    [CombFlag] VARCHAR(25) NULL,
    [BSEEq] VARCHAR(45) NULL,
    [NEBEComb] VARCHAR(45) NULL,
    [NEBEEq] VARCHAR(45) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(100) NULL,
    [NSE_Cash_CTCLId] VARCHAR(45) NULL,
    [BranchName] VARCHAR(45) NULL,
    [Derv_CTCL_BranchId] VARCHAR(45) NULL,
    [Derv_CTCL_Id] VARCHAR(45) NULL,
    [ddd] VARCHAR(45) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(45) NULL,
    [BSE_Cash_CTCLId] VARCHAR(45) NULL,
    [Login_Allowed] VARCHAR(5) NULL,
    [Participant_Type] VARCHAR(20) NULL,
    [DIET] VARCHAR(5) NULL,
    [NetDotnet] VARCHAR(5) NULL,
    [iWin] VARCHAR(5) NULL,
    [NetNetLite] VARCHAR(5) NULL,
    [MCX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCX_CTCLId] VARCHAR(20) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(20) NULL,
    [NCDEX_CTCLId] VARCHAR(20) NULL,
    [Product_Type] VARCHAR(20) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(20) NULL,
    [NSEL_CTCLId] VARCHAR(20) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_CTCLId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(20) NULL,
    [NSCE_CTCL_BranchId] VARCHAR(20) NULL,
    [NSCE_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Eq_CTCLId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(20) NULL,
    [MCXSX_Derv_CTCLId] VARCHAR(20) NULL,
    [DSE_CTCL_BranchId] VARCHAR(20) NULL,
    [DSE_CTCLId] VARCHAR(20) NULL,
    [Market_Data_Allowed] VARCHAR(20) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_EQ_Participant_Code] VARCHAR(20) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(20) NULL,
    [DSE_Participant_Code] VARCHAR(20) NULL,
    [MCX_Participant_Code] VARCHAR(20) NULL,
    [NMCE_Participant_Code] VARCHAR(20) NULL,
    [PanCard] VARCHAR(10) NULL,
    [Remarks] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.list_ebroking_segment15
-- --------------------------------------------------
CREATE TABLE [dbo].[list_ebroking_segment15]
(
    [User_Id] VARCHAR(45) NULL,
    [Group_Id] VARCHAR(45) NULL,
    [Name] VARCHAR(200) NULL,
    [Category] VARCHAR(45) NULL,
    [Status] VARCHAR(45) NULL,
    [Surv_On] VARCHAR(45) NULL,
    [Surv_Auto] VARCHAR(45) NULL,
    [PRIME_On] VARCHAR(45) NULL,
    [Trading_Allowed] VARCHAR(100) NULL,
    [IP] VARCHAR(45) NULL,
    [Max_BCast_Scrips] VARCHAR(45) NULL,
    [Order_No] VARCHAR(45) NULL,
    [Alias_DealerId] VARCHAR(45) NULL,
    [PinCode] VARCHAR(45) NULL,
    [Branch_Name] VARCHAR(45) NULL,
    [NSE_CTCL_BranchId] VARCHAR(45) NULL,
    [NSE_CTCL_Id] VARCHAR(45) NULL,
    [Derv_CTCL_BranchId] VARCHAR(45) NULL,
    [Derv_CTCL_Id] VARCHAR(45) NULL,
    [BSE_CTCL_BranchId] VARCHAR(45) NULL,
    [BSE_CTCL_Id] VARCHAR(45) NULL,
    [MCX_CTCL_BranchId] VARCHAR(45) NULL,
    [MCX_CTCL_Id] VARCHAR(45) NULL,
    [NCDEX_CTCL_BranchId] VARCHAR(45) NULL,
    [NCDEX_CTCL_Id] VARCHAR(45) NULL,
    [Group_Admin] VARCHAR(45) NULL,
    [Login_Allowed] VARCHAR(100) NULL,
    [User_Creation_Time] VARCHAR(25) NULL,
    [Participant_Type] VARCHAR(45) NULL,
    [Mode_Connection] VARCHAR(45) NULL,
    [Product_Type] VARCHAR(45) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.logs1
-- --------------------------------------------------
CREATE TABLE [dbo].[logs1]
(
    [Col1] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LOW_BROK_CLI_DISPATCHSTATUS_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[LOW_BROK_CLI_DISPATCHSTATUS_temp]
(
    [POD_no] VARCHAR(20) NULL,
    [Dispatch_dt] VARCHAR(25) NULL,
    [Desitination] VARCHAR(50) NULL,
    [Client_Name] VARCHAR(100) NULL,
    [Pincode] VARCHAR(50) NULL,
    [Party_code] VARCHAR(15) NULL,
    [Delivered_dt] VARCHAR(25) NULL,
    [Delivered_Status] VARCHAR(50) NULL,
    [reason_return] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Lump_Allotment_Master_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Lump_Allotment_Master_Temp]
(
    [REPORTDATE] VARCHAR(200) NULL,
    [ORDERNO] VARCHAR(200) NULL,
    [SETTTYPE] VARCHAR(200) NULL,
    [SETTNO] VARCHAR(200) NULL,
    [ORDERDATE] VARCHAR(200) NULL,
    [SCHEMECODE] VARCHAR(200) NULL,
    [ISIN] VARCHAR(200) NULL,
    [AMOUNT] VARCHAR(200) NULL,
    [QTY] VARCHAR(200) NULL,
    [MEMBERID] VARCHAR(200) NULL,
    [BRANCHCODE] VARCHAR(200) NULL,
    [USERID] VARCHAR(200) NULL,
    [FOLIONO] VARCHAR(200) NULL,
    [RTASCHEMECODE] VARCHAR(50) NULL,
    [RTATRANSNO] VARCHAR(200) NULL,
    [CLIENTCODE] VARCHAR(200) NULL,
    [CLIENTNAME] VARCHAR(200) NULL,
    [BENEFICIARYID] VARCHAR(200) NULL,
    [ALLOTTEDNAV] VARCHAR(200) NULL,
    [ALLOTTEDUNIT] VARCHAR(200) NULL,
    [ALLOTMENTAMT] VARCHAR(200) NULL,
    [VALIDFLAG] VARCHAR(200) NULL,
    [REMARKS] VARCHAR(200) NULL,
    [STT] VARCHAR(200) NULL,
    [INTERNALREFNO] VARCHAR(200) NULL,
    [OrderType] VARCHAR(200) NULL,
    [SIPREGNNO] VARCHAR(200) NULL,
    [SIPREGNDATE] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LUMP_ALLOTMENT_MASTER_UPLOAD
-- --------------------------------------------------
CREATE TABLE [dbo].[LUMP_ALLOTMENT_MASTER_UPLOAD]
(
    [REPORTDATE] VARCHAR(200) NULL,
    [ORDERNO] VARCHAR(200) NULL,
    [SETTTYPE] VARCHAR(200) NULL,
    [SETTNO] VARCHAR(200) NULL,
    [ORDERDATE] VARCHAR(200) NULL,
    [SCHEMECODE] VARCHAR(200) NULL,
    [ISIN] VARCHAR(200) NULL,
    [AMOUNT] VARCHAR(200) NULL,
    [QTY] VARCHAR(200) NULL,
    [MEMBERID] VARCHAR(200) NULL,
    [BRANCHCODE] VARCHAR(200) NULL,
    [USERID] VARCHAR(200) NULL,
    [FOLIONO] VARCHAR(200) NULL,
    [RTASCHEMECODE] VARCHAR(50) NULL,
    [RTATRANSNO] VARCHAR(200) NULL,
    [CLIENTCODE] VARCHAR(200) NULL,
    [CLIENTNAME] VARCHAR(200) NULL,
    [BENEFICIARYID] VARCHAR(200) NULL,
    [ALLOTTEDNAV] VARCHAR(200) NULL,
    [ALLOTTEDUNIT] VARCHAR(200) NULL,
    [ALLOTMENTAMT] VARCHAR(200) NULL,
    [VALIDFLAG] VARCHAR(200) NULL,
    [REMARKS] VARCHAR(200) NULL,
    [STT] VARCHAR(200) NULL,
    [INTERNALREFNO] VARCHAR(200) NULL,
    [OrderType] VARCHAR(200) NULL,
    [SIPREGNNO] VARCHAR(200) NULL,
    [SIPREGNDATE] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Lump_Redemption_Master_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Lump_Redemption_Master_Temp]
(
    [REPORTDATE] VARCHAR(50) NULL,
    [ORDERNO] VARCHAR(50) NULL,
    [SETTTYPE] VARCHAR(50) NULL,
    [SETTNO] VARCHAR(50) NULL,
    [ORDERDATE] VARCHAR(50) NULL,
    [SCHEMECODE] VARCHAR(50) NULL,
    [ISIN] VARCHAR(50) NULL,
    [AMOUNT] VARCHAR(50) NULL,
    [QTY] VARCHAR(50) NULL,
    [MEMBERID] VARCHAR(50) NULL,
    [BRANCHCODE] VARCHAR(50) NULL,
    [USERID] VARCHAR(50) NULL,
    [FOLIONO] VARCHAR(50) NULL,
    [RTASCHEMECODE] VARCHAR(100) NULL,
    [RTATRANSNO] VARCHAR(50) NULL,
    [CLIENTCODE] VARCHAR(50) NULL,
    [CLIENTNAME] VARCHAR(50) NULL,
    [BENEFICIARYID] VARCHAR(100) NULL,
    [NAV] VARCHAR(50) NULL,
    [UNIT] VARCHAR(50) NULL,
    [AMT] VARCHAR(50) NULL,
    [VALIDFLAG] CHAR(1) NULL,
    [REMARKS] VARCHAR(50) NULL,
    [STT] VARCHAR(50) NULL,
    [DPCFlag] CHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCDX_Bhav_copy
-- --------------------------------------------------
CREATE TABLE [dbo].[MCDX_Bhav_copy]
(
    [Date] DATETIME NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Commodity Symbol] NVARCHAR(255) NULL,
    [Contract/Expiry Month] DATETIME NULL,
    [Option Type] NVARCHAR(255) NULL,
    [Strike Price] FLOAT NULL,
    [Open(Rs#)] FLOAT NULL,
    [High(Rs#)] FLOAT NULL,
    [Low(Rs#)] FLOAT NULL,
    [Close(Rs#)] FLOAT NULL,
    [PCP(Rs#)] FLOAT NULL,
    [Volume(In Lots)] FLOAT NULL,
    [Volume(In 000's)] NVARCHAR(255) NULL,
    [Value(In Lakhs)] FLOAT NULL,
    [OI(In Lots)] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCDX_Bhav_Copy_23Oct2017
-- --------------------------------------------------
CREATE TABLE [dbo].[MCDX_Bhav_Copy_23Oct2017]
(
    [Date] DATETIME NULL,
    [Commodity Symbol] NVARCHAR(255) NULL,
    [Contract/Expiry Month] DATETIME NULL,
    [Open(Rs#)] FLOAT NULL,
    [High(Rs#)] FLOAT NULL,
    [Low(Rs#)] FLOAT NULL,
    [Close(Rs#)] FLOAT NULL,
    [PCP(Rs#)] FLOAT NULL,
    [Volume(In Lots)] FLOAT NULL,
    [Volume(In 000's)] NVARCHAR(255) NULL,
    [Value(In Lakhs)] FLOAT NULL,
    [OI(In Lots)] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCDX_Bhav_Copy_Hist
-- --------------------------------------------------
CREATE TABLE [dbo].[MCDX_Bhav_Copy_Hist]
(
    [Date] DATETIME NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Commodity Symbol] NVARCHAR(255) NULL,
    [Contract/Expiry Month] DATETIME NULL,
    [Option Type] NVARCHAR(255) NULL,
    [Strike Price] FLOAT NULL,
    [Open(Rs#)] FLOAT NULL,
    [High(Rs#)] FLOAT NULL,
    [Low(Rs#)] FLOAT NULL,
    [Close(Rs#)] FLOAT NULL,
    [PCP(Rs#)] FLOAT NULL,
    [Volume(In Lots)] FLOAT NULL,
    [Volume(In 000's)] NVARCHAR(255) NULL,
    [Value(In Lakhs)] FLOAT NULL,
    [OI(In Lots)] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mcx_admin
-- --------------------------------------------------
CREATE TABLE [dbo].[mcx_admin]
(
    [Trade Number] FLOAT NULL,
    [Trade Status] FLOAT NULL,
    [Instrument ID] FLOAT NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Symbol] NVARCHAR(255) NULL,
    [Expiry Date] DATETIME NULL,
    [Reserved] NVARCHAR(255) NULL,
    [Strike Price] NVARCHAR(255) NULL,
    [Options Type] NVARCHAR(255) NULL,
    [Product Description] NVARCHAR(255) NULL,
    [Book Type] FLOAT NULL,
    [Book Type Name] NVARCHAR(255) NULL,
    [Market Type] FLOAT NULL,
    [User ID] FLOAT NULL,
    [Branch No] FLOAT NULL,
    [Buy/Sell Indicator] FLOAT NULL,
    [Trade quantity] FLOAT NULL,
    [Price] FLOAT NULL,
    [Account Type] FLOAT NULL,
    [Account ID] NVARCHAR(255) NULL,
    [Participant Settler] FLOAT NULL,
    [Spread Price] NVARCHAR(255) NULL,
    [TM ID] FLOAT NULL,
    [Reserved1] NVARCHAR(255) NULL,
    [Trade time] DATETIME NULL,
    [Last Modified Time] DATETIME NULL,
    [Order Number] FLOAT NULL,
    [Reserved2] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Order User Last Update Time] DATETIME NULL,
    [Reserved3] DATETIME NULL,
    [Reference Number] NVARCHAR(255) NULL,
    [Reserved4] NVARCHAR(255) NULL,
    [Reserved5] NVARCHAR(255) NULL,
    [ISV Unique No#] NVARCHAR(255) NULL,
    [Product Month] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mcx_currency_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Mcx_currency_temp]
(
    [Trade_no] INT NULL,
    [Trade_Status] INT NULL,
    [Instrument_ID] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [expirydate] SMALLDATETIME NULL,
    [Reserved] VARCHAR(20) NULL,
    [Strike Price] MONEY NULL,
    [Reserved1] VARCHAR(20) NULL,
    [Options Type] VARCHAR(25) NULL,
    [Product Description] INT NULL,
    [Book Tpe Name] VARCHAR(20) NULL,
    [Book Type] INT NULL,
    [user id] INT NULL,
    [Branch No] INT NULL,
    [Buy Sell] INT NULL,
    [Trade quantity] INT NULL,
    [Price] MONEY NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(25) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] MONEY NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved3] VARCHAR(20) NULL,
    [Activity Time] SMALLDATETIME NULL,
    [Last Modified time] SMALLDATETIME NULL,
    [Order Number] VARCHAR(20) NULL,
    [Opposite Broker Id] VARCHAR(10) NULL,
    [Order User Last Update Time] VARCHAR(50) NULL,
    [Mod Date Time] DATETIME NULL,
    [Order Entered/Mod Date Time] DATETIME NULL,
    [RESERVED5] VARCHAR(50) NULL,
    [RESERVED6] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mcx_exchange
-- --------------------------------------------------
CREATE TABLE [dbo].[mcx_exchange]
(
    [Trade Number] FLOAT NULL,
    [Trade Status] FLOAT NULL,
    [Instrument ID] FLOAT NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Symbol] NVARCHAR(255) NULL,
    [Expiry Date] DATETIME NULL,
    [Reserved] NVARCHAR(255) NULL,
    [Strike Price] NVARCHAR(255) NULL,
    [Options Type] NVARCHAR(255) NULL,
    [Product Description] NVARCHAR(255) NULL,
    [Book Type] FLOAT NULL,
    [Book Type Name] NVARCHAR(255) NULL,
    [Market Type] FLOAT NULL,
    [User ID] FLOAT NULL,
    [Branch No] FLOAT NULL,
    [Buy/Sell Indicator] FLOAT NULL,
    [Trade quantity] FLOAT NULL,
    [Price] FLOAT NULL,
    [Account Type] FLOAT NULL,
    [Account ID] NVARCHAR(255) NULL,
    [Participant Settler] FLOAT NULL,
    [Spread Price] NVARCHAR(255) NULL,
    [TM ID] FLOAT NULL,
    [Reserved1] NVARCHAR(255) NULL,
    [Trade time] DATETIME NULL,
    [Last Modified Time] DATETIME NULL,
    [Order Number] FLOAT NULL,
    [Reserved2] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [Order User Last Update Time] DATETIME NULL,
    [Reserved3] DATETIME NULL,
    [Reference Number] NVARCHAR(255) NULL,
    [Reserved4] NVARCHAR(255) NULL,
    [Reserved5] NVARCHAR(255) NULL,
    [ISV Unique No#] NVARCHAR(255) NULL,
    [Product Month] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_Margin
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_Margin]
(
    [Symbol] VARCHAR(15) NULL,
    [ExpiryDate] DATETIME NULL,
    [Price] MONEY NULL,
    [Multiplier] INT NULL,
    [IM] MONEY NULL,
    [SBM] MONEY NULL,
    [SSM] MONEY NULL,
    [AML] MONEY NULL,
    [AMS] MONEY NULL,
    [TenderM] MONEY NULL,
    [TM] MONEY NULL,
    [ICV] MONEY NULL,
    [Margin] MONEY NULL,
    [filename] VARCHAR(50) NULL,
    [upd_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCX_MARGIN_TEST
-- --------------------------------------------------
CREATE TABLE [dbo].[MCX_MARGIN_TEST]
(
    [Symbol] VARCHAR(50) NULL,
    [ExpiryDate] VARCHAR(15) NULL,
    [Price] MONEY NULL,
    [Multiplier] MONEY NULL,
    [I_M] MONEY NULL,
    [S_B_M] MONEY NULL,
    [S_S_M] MONEY NULL,
    [A_M_L] MONEY NULL,
    [A_M_S] MONEY NULL,
    [Tender_M] MONEY NULL,
    [T_M] MONEY NULL,
    [I_C_V] MONEY NULL,
    [Margin] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXSX_cp
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXSX_cp]
(
    [Market Statistics Date] VARCHAR(255) NULL,
    [Market Type] VARCHAR(255) NULL,
    [Instrument Name] VARCHAR(255) NULL,
    [Symbol] VARCHAR(255) NULL,
    [Series/Expiry] VARCHAR(255) NULL,
    [Unit] VARCHAR(255) NULL,
    [Open] VARCHAR(255) NULL,
    [High] VARCHAR(255) NULL,
    [Low] VARCHAR(255) NULL,
    [Close] VARCHAR(255) NULL,
    [Prev. Close] VARCHAR(255) NULL,
    [Settlement Price] VARCHAR(255) NULL,
    [No.Of Trades] VARCHAR(255) NULL,
    [Open Interest] VARCHAR(255) NULL,
    [Value(in lacs)] VARCHAR(255) NULL,
    [Volume] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXSX_CP_F
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXSX_CP_F]
(
    [Market Statistics Date] VARCHAR(10) NULL,
    [Instrument] VARCHAR(10) NULL,
    [Product] VARCHAR(12) NULL,
    [Expiry] DATETIME NULL,
    [Strike Price] MONEY NULL,
    [Option Type] VARCHAR(10) NULL,
    [Open] MONEY NULL,
    [High] MONEY NULL,
    [Low] MONEY NULL,
    [Close] MONEY NULL,
    [Settlement Price] MONEY NULL,
    [Previous  Close] MONEY NULL,
    [Volume (Lots)] MONEY NULL,
    [No. of  Trades] MONEY NULL,
    [Value (in Lacs)] MONEY NULL,
    [Open Interest] MONEY NULL,
    [Premium Value (in Lacs)] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MCXSX_CP_F_HIST
-- --------------------------------------------------
CREATE TABLE [dbo].[MCXSX_CP_F_HIST]
(
    [Market Statistics Date] VARCHAR(10) NULL,
    [Instrument] VARCHAR(10) NULL,
    [Product] VARCHAR(12) NULL,
    [Expiry] DATETIME NULL,
    [Strike Price] MONEY NULL,
    [Option Type] VARCHAR(10) NULL,
    [Open] MONEY NULL,
    [High] MONEY NULL,
    [Low] MONEY NULL,
    [Close] MONEY NULL,
    [Settlement Price] MONEY NULL,
    [Previous  Close] MONEY NULL,
    [Volume (Lots)] MONEY NULL,
    [No. of  Trades] MONEY NULL,
    [Value (in Lacs)] MONEY NULL,
    [Open Interest] MONEY NULL,
    [Premium Value (in Lacs)] MONEY NULL,
    [UPD_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mcxsx_cp_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[mcxsx_cp_hist]
(
    [Market Statistics Date] VARCHAR(255) NULL,
    [Market Type] VARCHAR(255) NULL,
    [Instrument Name] VARCHAR(255) NULL,
    [Symbol] VARCHAR(255) NULL,
    [Series/Expiry] VARCHAR(255) NULL,
    [Unit] VARCHAR(255) NULL,
    [Open] VARCHAR(255) NULL,
    [High] VARCHAR(255) NULL,
    [Low] VARCHAR(255) NULL,
    [Close] VARCHAR(255) NULL,
    [Prev. Close] VARCHAR(255) NULL,
    [Settlement Price] VARCHAR(255) NULL,
    [No.Of Trades] VARCHAR(255) NULL,
    [Open Interest] VARCHAR(255) NULL,
    [Value(in lacs)] VARCHAR(255) NULL,
    [Volume] VARCHAR(255) NULL,
    [upd_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'MIS Head Count empwise15112008$'
-- --------------------------------------------------
CREATE TABLE [dbo].['MIS Head Count empwise15112008$']
(
    [Sr No#] FLOAT NULL,
    [Emp No] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [HOD No] NVARCHAR(255) NULL,
    [HOD Name] NVARCHAR(255) NULL,
    [DIV_NAME] NVARCHAR(255) NULL,
    [appperiod] NVARCHAR(255) NULL,
    [Potential] NVARCHAR(255) NULL,
    [Performance] NVARCHAR(255) NULL,
    [LEVEL] NVARCHAR(255) NULL,
    [Separation Date] NVARCHAR(255) NULL,
    [Join Date] SMALLDATETIME NULL,
    [Cost Center] NVARCHAR(255) NULL,
    [Separation Reason] NVARCHAR(255) NULL,
    [Department] NVARCHAR(255) NULL,
    [Designation] NVARCHAR(255) NULL,
    [Lob] NVARCHAR(255) NULL,
    [Zone] NVARCHAR(255) NULL,
    [Region] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL,
    [AttendanceLoc] NVARCHAR(255) NULL,
    [Location Address] NVARCHAR(255) NULL,
    [DOC] SMALLDATETIME NULL,
    [emailadd] NVARCHAR(255) NULL,
    [PL] FLOAT NULL,
    [PLEN] FLOAT NULL,
    [PL balance] FLOAT NULL,
    [sex] NVARCHAR(255) NULL,
    [BirthDate] SMALLDATETIME NULL,
    [Emp Sep Reason] NVARCHAR(255) NULL,
    [flgesic] BIT NOT NULL,
    [LOC_NO] FLOAT NULL,
    [categorydesc] NVARCHAR(255) NULL,
    [PHONE] FLOAT NULL,
    [JOINDATE] SMALLDATETIME NULL,
    [SBU] NVARCHAR(255) NULL,
    [Costcode] NVARCHAR(255) NULL,
    [TPD Cost Code] NVARCHAR(255) NULL,
    [Expr1] NVARCHAR(255) NULL,
    [cost_zone_code] NVARCHAR(255) NULL,
    [Cost_region_code] NVARCHAR(255) NULL,
    [Cost_Loc_Code] NVARCHAR(255) NULL,
    [cost_Attnloc_Code] NVARCHAR(255) NULL,
    [pid] FLOAT NULL,
    [LObCode] FLOAT NULL,
    [New Department - Broking] NVARCHAR(255) NULL,
    [New Sub Department - Broking] NVARCHAR(255) NULL,
    [Qualification] NVARCHAR(255) NULL,
    [Induction Result] NVARCHAR(255) NULL,
    [Percentage] FLOAT NULL,
    [Test Date] NVARCHAR(255) NULL,
    [Monthly CTC] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mis_dispatch
-- --------------------------------------------------
CREATE TABLE [dbo].[mis_dispatch]
(
    [Srno] INT NOT NULL,
    [Date] VARCHAR(25) NULL,
    [Type] VARCHAR(11) NULL,
    [Brtag] VARCHAR(11) NULL,
    [Sbtag] VARCHAR(11) NULL,
    [Cl_code] VARCHAR(11) NULL,
    [Sender_name] VARCHAR(80) NULL,
    [Department] VARCHAR(50) NULL,
    [Remark] VARCHAR(100) NULL,
    [Company] VARCHAR(40) NULL,
    [Mode] VARCHAR(55) NULL,
    [Pod] VARCHAR(100) NULL,
    [Weight] VARCHAR(50) NULL,
    [Rate] FLOAT NULL,
    [Status] VARCHAR(50) NULL,
    [ReturnedDate] VARCHAR(15) NULL,
    [Reason] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'MISHeadCount'
-- --------------------------------------------------
CREATE TABLE [dbo].['MISHeadCount']
(
    [Sr No#] FLOAT NULL,
    [Emp No] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [HOD No] NVARCHAR(255) NULL,
    [HOD Name] NVARCHAR(255) NULL,
    [DIV_NAME] NVARCHAR(255) NULL,
    [appperiod] NVARCHAR(255) NULL,
    [Potential] NVARCHAR(255) NULL,
    [Performance] NVARCHAR(255) NULL,
    [LEVEL] NVARCHAR(255) NULL,
    [Separation Date] NVARCHAR(255) NULL,
    [Join Date] SMALLDATETIME NULL,
    [Cost Center] NVARCHAR(255) NULL,
    [Separation Reason] NVARCHAR(255) NULL,
    [Department] NVARCHAR(255) NULL,
    [Designation] NVARCHAR(255) NULL,
    [Lob] NVARCHAR(255) NULL,
    [Zone] NVARCHAR(255) NULL,
    [Region] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL,
    [AttendanceLoc] NVARCHAR(255) NULL,
    [Location Address] NVARCHAR(255) NULL,
    [DOC] SMALLDATETIME NULL,
    [emailadd] NVARCHAR(255) NULL,
    [PL] FLOAT NULL,
    [PLEN] FLOAT NULL,
    [PL balance] FLOAT NULL,
    [sex] NVARCHAR(255) NULL,
    [BirthDate] SMALLDATETIME NULL,
    [Emp Sep Reason] NVARCHAR(255) NULL,
    [flgesic] BIT NOT NULL,
    [LOC_NO] FLOAT NULL,
    [categorydesc] NVARCHAR(255) NULL,
    [PHONE] FLOAT NULL,
    [JOINDATE] SMALLDATETIME NULL,
    [SBU] NVARCHAR(255) NULL,
    [Costcode] NVARCHAR(255) NULL,
    [TPD Cost Code] NVARCHAR(255) NULL,
    [Expr1] NVARCHAR(255) NULL,
    [cost_zone_code] NVARCHAR(255) NULL,
    [Cost_region_code] NVARCHAR(255) NULL,
    [Cost_Loc_Code] NVARCHAR(255) NULL,
    [cost_Attnloc_Code] NVARCHAR(255) NULL,
    [pid] FLOAT NULL,
    [LObCode] FLOAT NULL,
    [New Department - Broking] NVARCHAR(255) NULL,
    [New Sub Department - Broking] NVARCHAR(255) NULL,
    [Qualification] NVARCHAR(255) NULL,
    [Induction Result] NVARCHAR(255) NULL,
    [Percentage] FLOAT NULL,
    [Test Date] NVARCHAR(255) NULL,
    [Monthly CTC] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.MisMatchMapping_inhouse_log
-- --------------------------------------------------
CREATE TABLE [dbo].[MisMatchMapping_inhouse_log]
(
    [Deactive] INT NOT NULL,
    [Missing] INT NOT NULL,
    [Mismatch] INT NOT NULL,
    [surv_onoff] INT NOT NULL,
    [locacode] VARCHAR(64) NOT NULL,
    [updated_on] DATETIME NOT NULL,
    [updated_by] VARCHAR(32) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mod_dt
-- --------------------------------------------------
CREATE TABLE [dbo].[mod_dt]
(
    [mgr_code] VARCHAR(10) NULL,
    [mod_date] VARCHAR(20) NULL,
    [corr_date] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ModifiedRequest
-- --------------------------------------------------
CREATE TABLE [dbo].[ModifiedRequest]
(
    [ModID] VARCHAR(10) NOT NULL,
    [ReqID] VARCHAR(10) NOT NULL,
    [ItemID] VARCHAR(50) NULL,
    [ItemName] VARCHAR(50) NULL,
    [Qty] INT NULL,
    [Note] VARCHAR(80) NULL,
    [ModBy] VARCHAR(25) NOT NULL,
    [ModDate] DATETIME NOT NULL,
    [CompleteByDate] VARCHAR(25) NULL,
    [ReqStatusCode] VARCHAR(4) NOT NULL,
    [ModType] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ModifiedVIRequest
-- --------------------------------------------------
CREATE TABLE [dbo].[ModifiedVIRequest]
(
    [ModID] VARCHAR(10) NOT NULL,
    [ReqID] VARCHAR(10) NOT NULL,
    [ItemID] VARCHAR(50) NULL,
    [ItemName] VARCHAR(50) NULL,
    [Qty] INT NULL,
    [Note] VARCHAR(80) NULL,
    [ModBy] VARCHAR(25) NOT NULL,
    [ModDate] DATETIME NOT NULL,
    [CompleteByDate] VARCHAR(25) NULL,
    [ReqStatusCode] VARCHAR(4) NOT NULL,
    [ModType] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mudit_fin
-- --------------------------------------------------
CREATE TABLE [dbo].[mudit_fin]
(
    [monthno] INT NULL,
    [yearno] INT NULL,
    [Employee] INT NULL,
    [business] MONEY NULL,
    [commission] MONEY NULL,
    [attrition] MONEY NULL,
    [AvgVintage] MONEY NULL,
    [TotalSalary] MONEY NULL,
    [Productivity] MONEY NULL,
    [attrition_per] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mudit_fin1
-- --------------------------------------------------
CREATE TABLE [dbo].[mudit_fin1]
(
    [Mnth] VARCHAR(10) NULL,
    [Particulars] VARCHAR(25) NULL,
    [Apr2008] MONEY NULL,
    [May2008] MONEY NULL,
    [Jun2008] MONEY NULL,
    [Jul2008] MONEY NULL,
    [Aug2008] MONEY NULL,
    [Sep2008] MONEY NULL,
    [Oct2008] MONEY NULL,
    [Nov2008] MONEY NULL,
    [psrno] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mudit_income
-- --------------------------------------------------
CREATE TABLE [dbo].[mudit_income]
(
    [PolicyIssuedDate] VARCHAR(255) NULL,
    [YearlyPremium] VARCHAR(255) NULL,
    [CommORC] VARCHAR(255) NULL,
    [Employee] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Mudit1
-- --------------------------------------------------
CREATE TABLE [dbo].[Mudit1]
(
    [Month] SMALLDATETIME NULL,
    [Application no#] NVARCHAR(255) NULL,
    [Region] NVARCHAR(255) NULL,
    [Insurance Region] NVARCHAR(255) NULL,
    [State] NVARCHAR(255) NULL,
    [Branch Name] NVARCHAR(255) NULL,
    [Policy #] FLOAT NULL,
    [Policy Issued Date] SMALLDATETIME NULL,
    [Month1] NVARCHAR(255) NULL,
    [Policy Type] NVARCHAR(255) NULL,
    [Pay Term] FLOAT NULL,
    [Mode] NVARCHAR(255) NULL,
    [Client Name] NVARCHAR(255) NULL,
    [First Premium] FLOAT NULL,
    [Expct Comm# FP] FLOAT NULL,
    [Yearly Premium] FLOAT NULL,
    [Expct comm# YP] FLOAT NULL,
    [Initial Premium] FLOAT NULL,
    [Commission on Initial] FLOAT NULL,
    [Employee / TSR  Name] NVARCHAR(255) NULL,
    [Employee/TSRcode] NVARCHAR(255) NULL,
    [Introducers] NVARCHAR(255) NULL,
    [Referal/Lead name] NVARCHAR(255) NULL,
    [Referal/LeadId] NVARCHAR(255) NULL,
    [Business Source] NVARCHAR(255) NULL,
    [Business Source 2] NVARCHAR(255) NULL,
    [Status] NVARCHAR(255) NULL,
    [Remark] NVARCHAR(255) NULL,
    [ fgg] NVARCHAR(255) NULL,
    [Month2] NVARCHAR(255) NULL,
    [Retention] FLOAT NULL,
    [Retention + ORC] FLOAT NULL,
    [Region1] NVARCHAR(255) NULL,
    [BranchCode] NVARCHAR(255) NULL,
    [App Recvd Date] NVARCHAR(255) NULL,
    [Remarks] NVARCHAR(255) NULL,
    [N B Premium] FLOAT NULL,
    [New Business commission] FLOAT NULL,
    [T U Premium] FLOAT NULL,
    [Top Up commission] FLOAT NULL,
    [F Y Premium] FLOAT NULL,
    [First Year Commission] FLOAT NULL,
    [Total Premium] FLOAT NULL,
    [Total Commission] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mudit2
-- --------------------------------------------------
CREATE TABLE [dbo].[mudit2]
(
    [Sr No#] FLOAT NULL,
    [Emp No] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [HOD No] NVARCHAR(255) NULL,
    [HOD Name] NVARCHAR(255) NULL,
    [DIV_NAME] NVARCHAR(255) NULL,
    [appperiod] NVARCHAR(255) NULL,
    [Potential] NVARCHAR(255) NULL,
    [Performance] NVARCHAR(255) NULL,
    [LEVEL] NVARCHAR(255) NULL,
    [Separation Date] NVARCHAR(255) NULL,
    [Join Date] SMALLDATETIME NULL,
    [Cost Center] NVARCHAR(255) NULL,
    [Separation Reason] NVARCHAR(255) NULL,
    [Department] NVARCHAR(255) NULL,
    [Designation] NVARCHAR(255) NULL,
    [Lob] NVARCHAR(255) NULL,
    [Zone] NVARCHAR(255) NULL,
    [Region] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL,
    [AttendanceLoc] NVARCHAR(255) NULL,
    [Location Address] NVARCHAR(255) NULL,
    [DOC] SMALLDATETIME NULL,
    [emailadd] NVARCHAR(255) NULL,
    [PL] FLOAT NULL,
    [PLEN] FLOAT NULL,
    [PL balance] FLOAT NULL,
    [sex] NVARCHAR(255) NULL,
    [BirthDate] SMALLDATETIME NULL,
    [Emp Sep Reason] NVARCHAR(255) NULL,
    [flgesic] BIT NOT NULL,
    [LOC_NO] FLOAT NULL,
    [categorydesc] NVARCHAR(255) NULL,
    [PHONE] FLOAT NULL,
    [JOINDATE] SMALLDATETIME NULL,
    [SBU] NVARCHAR(255) NULL,
    [Costcode] NVARCHAR(255) NULL,
    [TPD Cost Code] NVARCHAR(255) NULL,
    [Expr1] NVARCHAR(255) NULL,
    [cost_zone_code] NVARCHAR(255) NULL,
    [Cost_region_code] NVARCHAR(255) NULL,
    [Cost_Loc_Code] NVARCHAR(255) NULL,
    [cost_Attnloc_Code] NVARCHAR(255) NULL,
    [pid] FLOAT NULL,
    [LObCode] FLOAT NULL,
    [New Department - Broking] NVARCHAR(255) NULL,
    [New Sub Department - Broking] NVARCHAR(255) NULL,
    [Qualification] NVARCHAR(255) NULL,
    [Induction Result] NVARCHAR(255) NULL,
    [Percentage] FLOAT NULL,
    [Test Date] NVARCHAR(255) NULL,
    [Monthly CTC] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'Mudit2'
-- --------------------------------------------------
CREATE TABLE [dbo].['Mudit2']
(
    [Sr No#] FLOAT NULL,
    [Emp No] NVARCHAR(255) NULL,
    [EMP_NAME] NVARCHAR(255) NULL,
    [HOD No] NVARCHAR(255) NULL,
    [HOD Name] NVARCHAR(255) NULL,
    [DIV_NAME] NVARCHAR(255) NULL,
    [appperiod] NVARCHAR(255) NULL,
    [Potential] NVARCHAR(255) NULL,
    [Performance] NVARCHAR(255) NULL,
    [LEVEL] NVARCHAR(255) NULL,
    [Separation Date] NVARCHAR(255) NULL,
    [Join Date] SMALLDATETIME NULL,
    [Cost Center] NVARCHAR(255) NULL,
    [Separation Reason] NVARCHAR(255) NULL,
    [Department] NVARCHAR(255) NULL,
    [Designation] NVARCHAR(255) NULL,
    [Lob] NVARCHAR(255) NULL,
    [Zone] NVARCHAR(255) NULL,
    [Region] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL,
    [AttendanceLoc] NVARCHAR(255) NULL,
    [Location Address] NVARCHAR(255) NULL,
    [DOC] SMALLDATETIME NULL,
    [emailadd] NVARCHAR(255) NULL,
    [PL] FLOAT NULL,
    [PLEN] FLOAT NULL,
    [PL balance] FLOAT NULL,
    [sex] NVARCHAR(255) NULL,
    [BirthDate] SMALLDATETIME NULL,
    [Emp Sep Reason] NVARCHAR(255) NULL,
    [flgesic] BIT NOT NULL,
    [LOC_NO] FLOAT NULL,
    [categorydesc] NVARCHAR(255) NULL,
    [PHONE] FLOAT NULL,
    [SBU] NVARCHAR(255) NULL,
    [Costcode] NVARCHAR(255) NULL,
    [TPD Cost Code] NVARCHAR(255) NULL,
    [Expr1] NVARCHAR(255) NULL,
    [cost_zone_code] NVARCHAR(255) NULL,
    [Cost_region_code] NVARCHAR(255) NULL,
    [Cost_Loc_Code] NVARCHAR(255) NULL,
    [cost_Attnloc_Code] NVARCHAR(255) NULL,
    [pid] FLOAT NULL,
    [LObCode] FLOAT NULL,
    [New Department - Broking] NVARCHAR(255) NULL,
    [New Sub Department - Broking] NVARCHAR(255) NULL,
    [Qualification] NVARCHAR(255) NULL,
    [Induction Result] NVARCHAR(255) NULL,
    [Percentage] FLOAT NULL,
    [Test Date] NVARCHAR(255) NULL,
    [Monthly CTC] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mudit3
-- --------------------------------------------------
CREATE TABLE [dbo].[mudit3]
(
    [empcode] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NBFC_Collateral_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[NBFC_Collateral_temp]
(
    [party_code] VARCHAR(12) NULL,
    [Scrip_code] VARCHAR(25) NULL,
    [tot_qty] INT NULL,
    [NCM_qty] INT NULL,
    [BF_qty] INT NULL,
    [Col_20th] MONEY NULL,
    [Col_21st] MONEY NULL,
    [cl_pr] MONEY NULL,
    [Csh_mrg] MONEY NULL,
    [HC] INT NULL,
    [NCM_Val] MONEY NULL,
    [NCM_Val_HC] MONEY NULL,
    [Bf_Val] MONEY NULL,
    [BF_Val_HC] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NBFC_Del_POSITION_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[NBFC_Del_POSITION_temp]
(
    [Party_Code] VARCHAR(10) NULL,
    [Scrip_CD] VARCHAR(25) NULL,
    [HC] INT NULL,
    [BuyQty] INT NULL,
    [SellQty] INT NULL,
    [NetQty] INT NULL,
    [BuyRate] MONEY NULL,
    [SellRate] MONEY NULL,
    [BuyVal] MONEY NULL,
    [BuyVal_Hc] MONEY NULL,
    [SellVal] MONEY NULL,
    [SellVal_Hc] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nbfc_intamt_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[nbfc_intamt_temp]
(
    [Client Code] VARCHAR(255) NULL,
    [Amount] VARCHAR(255) NULL,
    [Name of Customer] VARCHAR(255) NULL,
    [Address 1] VARCHAR(255) NULL,
    [Address 2] VARCHAR(255) NULL,
    [Address 3] VARCHAR(255) NULL,
    [City] VARCHAR(255) NULL,
    [PIN] VARCHAR(255) NULL,
    [State] VARCHAR(255) NULL,
    [Mobile No] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NBFC_Mails
-- --------------------------------------------------
CREATE TABLE [dbo].[NBFC_Mails]
(
    [Branch] VARCHAR(1255) NULL,
    [To_Mail] VARCHAR(1255) NULL,
    [cc_Mail] VARCHAR(1255) NULL,
    [Bcc_Mail] VARCHAR(1255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NBFC_Mails_test
-- --------------------------------------------------
CREATE TABLE [dbo].[NBFC_Mails_test]
(
    [Branch] VARCHAR(1255) NULL,
    [To_Mail] VARCHAR(1255) NULL,
    [cc_Mail] VARCHAR(1255) NULL,
    [Bcc_Mail] VARCHAR(1255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NCDEX_Bhav_Copy
-- --------------------------------------------------
CREATE TABLE [dbo].[NCDEX_Bhav_Copy]
(
    [Instrument_Type] VARCHAR(250) NULL,
    [Symbol] VARCHAR(250) NULL,
    [Expiry_Date] VARCHAR(250) NULL,
    [Commodity] VARCHAR(250) NULL,
    [Strike_Price] VARCHAR(250) NULL,
    [Option_Type] VARCHAR(250) NULL,
    [Delivery_Center] VARCHAR(250) NULL,
    [Price_Unit] VARCHAR(50) NULL,
    [Opening_price] VARCHAR(50) NULL,
    [High_Price] VARCHAR(50) NULL,
    [Low_Price] VARCHAR(50) NULL,
    [Closing_Price] VARCHAR(50) NULL,
    [Qty_Traded_Today] VARCHAR(50) NULL,
    [Measure] VARCHAR(50) NULL,
    [No_Of_Trades] VARCHAR(50) NULL,
    [Trade_Amt] VARCHAR(50) NULL,
    [Open_Interest] VARCHAR(200) NULL,
    [tdate] VARCHAR(11) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NCDEX_Bhav_Copy_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[NCDEX_Bhav_Copy_hist]
(
    [Instrument_Type] VARCHAR(250) NULL,
    [Symbol] VARCHAR(250) NULL,
    [Expiry_Date] VARCHAR(250) NULL,
    [Commodity] VARCHAR(250) NULL,
    [Strike_Price] VARCHAR(250) NULL,
    [Option_Type] VARCHAR(250) NULL,
    [Delivery_Center] VARCHAR(250) NULL,
    [Price_Unit] VARCHAR(50) NULL,
    [Opening_price] VARCHAR(50) NULL,
    [High_Price] VARCHAR(50) NULL,
    [Low_Price] VARCHAR(50) NULL,
    [Closing_Price] VARCHAR(50) NULL,
    [Qty_Traded_Today] VARCHAR(50) NULL,
    [Measure] VARCHAR(50) NULL,
    [No_Of_Trades] VARCHAR(50) NULL,
    [Trade_Amt] VARCHAR(50) NULL,
    [Open_Interest] VARCHAR(200) NULL,
    [tdate] VARCHAR(11) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NCDEX_Margin
-- --------------------------------------------------
CREATE TABLE [dbo].[NCDEX_Margin]
(
    [Symbol] VARCHAR(15) NULL,
    [ExpiryDate] DATETIME NULL,
    [Price] MONEY NULL,
    [Multiplier] INT NULL,
    [IM] MONEY NULL,
    [EM] MONEY NULL,
    [APEM] MONEY NULL,
    [TM] MONEY NULL,
    [AML] MONEY NULL,
    [AMS] MONEY NULL,
    [SCML] MONEY NULL,
    [SCMS] MONEY NULL,
    [ICV] MONEY NULL,
    [Margin] MONEY NULL,
    [filename] VARCHAR(50) NULL,
    [upd_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ncdex_ps03_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[ncdex_ps03_temp]
(
    [Position_Date] VARCHAR(255) NULL,
    [Segment_Indicator] VARCHAR(255) NULL,
    [Settlement_Type] VARCHAR(255) NULL,
    [CM_Code] VARCHAR(255) NULL,
    [Member_Type] VARCHAR(255) NULL,
    [Trading Member_Code] VARCHAR(255) NULL,
    [Account_Type] VARCHAR(255) NULL,
    [Client_Code] VARCHAR(255) NULL,
    [Instrument_Type] VARCHAR(255) NULL,
    [Symbol] VARCHAR(255) NULL,
    [Expiry_date] VARCHAR(255) NULL,
    [Strike_Price] VARCHAR(255) NULL,
    [Option_Type] VARCHAR(255) NULL,
    [CA_Level] VARCHAR(255) NULL,
    [BF_long_quantity] INT NULL,
    [BF_Long_Value] MONEY NULL,
    [BF_Short_quantity] INT NULL,
    [BF_Short_Value] MONEY NULL,
    [DayBuyOpenQuantity] INT NULL,
    [DayBuyOpenValue] MONEY NULL,
    [DaySellOpenQuantity] INT NULL,
    [DaySellOpenValue] MONEY NULL,
    [PreExerciseAssignmentLongQuantity] VARCHAR(255) NULL,
    [PreExerciseAssignmentLongValue] VARCHAR(255) NULL,
    [PreExerciseAssignmentShortQuantity] VARCHAR(255) NULL,
    [PreExerciseAssignmentShortValue] VARCHAR(255) NULL,
    [ExercisedQuantity] VARCHAR(255) NULL,
    [AssignedQuantity] VARCHAR(255) NULL,
    [PostExerciseAssignmentLongQuantity] VARCHAR(255) NULL,
    [PostExerciseAssignmentLongValue] VARCHAR(255) NULL,
    [PostExercise AssignmentShortQuantity] VARCHAR(255) NULL,
    [PostExerciseAssignmentShortValue] VARCHAR(255) NULL,
    [SettlementPrice] VARCHAR(255) NULL,
    [NetPremium] VARCHAR(255) NULL,
    [Daily_MTM_Settlement_Value] VARCHAR(255) NULL,
    [Futures_final_Sett_value] VARCHAR(255) NULL,
    [Exercised_Assigned_Value_Calculated] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NCDX_
-- --------------------------------------------------
CREATE TABLE [dbo].[NCDX_]
(
    [NSE] VARCHAR(255) NULL,
    [COMPANY] VARCHAR(255) NULL,
    [Haircut] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NDNC
-- --------------------------------------------------
CREATE TABLE [dbo].[NDNC]
(
    [Name] VARCHAR(255) NULL,
    [Office_Phone] VARCHAR(255) NULL,
    [Mobile_Phone] VARCHAR(255) NULL,
    [Res_Phone] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.new_table
-- --------------------------------------------------
CREATE TABLE [dbo].[new_table]
(
    [party_code] VARCHAR(20) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NewReqItems
-- --------------------------------------------------
CREATE TABLE [dbo].[NewReqItems]
(
    [ReqID] VARCHAR(15) NOT NULL,
    [ItemName] VARCHAR(50) NOT NULL,
    [CategoryName] VARCHAR(30) NULL,
    [newCatID] VARCHAR(20) NULL,
    [newItemID] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Notifications
-- --------------------------------------------------
CREATE TABLE [dbo].[Notifications]
(
    [NoteID] VARCHAR(50) NOT NULL,
    [ReqID] VARCHAR(20) NOT NULL,
    [Hod_No] VARCHAR(10) NOT NULL,
    [Emp_no] VARCHAR(10) NOT NULL,
    [Pi_No] VARCHAR(10) NULL,
    [Note] VARCHAR(200) NULL,
    [NoteDate] VARCHAR(20) NOT NULL,
    [Message] VARCHAR(100) NOT NULL,
    [Subject] VARCHAR(50) NOT NULL,
    [Is_Checked] INT NULL,
    [CatName] VARCHAR(60) NULL,
    [ItemName] VARCHAR(40) NULL,
    [ReqStatusCode] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NOW_UserInfo_Upload
-- --------------------------------------------------
CREATE TABLE [dbo].[NOW_UserInfo_Upload]
(
    [Type] VARCHAR(10) NULL,
    [BrokerId] INT NULL,
    [BranchId] VARCHAR(15) NULL,
    [DealerId] VARCHAR(10) NULL,
    [ClientGroup] VARCHAR(100) NULL,
    [ClientId] VARCHAR(10) NULL,
    [Privilege] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NOW_UserInfo_Upload_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[NOW_UserInfo_Upload_temp]
(
    [Type] VARCHAR(10) NULL,
    [BrokerId] VARCHAR(10) NULL,
    [BranchId] VARCHAR(25) NULL,
    [DealerId] VARCHAR(25) NULL,
    [ClientGroup] VARCHAR(100) NULL,
    [ClientId] VARCHAR(25) NULL,
    [Privilege] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSE_BlockScript_Temp_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[NSE_BlockScript_Temp_upload]
(
    [SecuritySymbol] VARCHAR(25) NULL,
    [SecuritySeries] VARCHAR(5) NULL,
    [SecurityDescription] VARCHAR(50) NULL,
    [SecurityCode] VARCHAR(15) NULL,
    [SecurityISIN] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Nse_Currency_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Nse_Currency_Temp]
(
    [Trade_no] INT NULL,
    [Trade_Status] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [expirydate] SMALLDATETIME NULL,
    [Reserved] VARCHAR(20) NULL,
    [Strike Price] VARCHAR(50) NULL,
    [Options Type] VARCHAR(25) NULL,
    [Product Description] INT NULL,
    [Book Tpe Name] VARCHAR(20) NULL,
    [Book Type] INT NULL,
    [user id] INT NULL,
    [Branch No] INT NULL,
    [Buy Sell] INT NULL,
    [Trade quantity] INT NULL,
    [Price] MONEY NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(25) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] VARCHAR(50) NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved3] VARCHAR(20) NULL,
    [Activity Time] SMALLDATETIME NULL,
    [Last Modified time] VARCHAR(50) NULL,
    [Order Number] VARCHAR(20) NULL,
    [Order User Last Update Time] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSEBlockScript
-- --------------------------------------------------
CREATE TABLE [dbo].[NSEBlockScript]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [SecuritySymbol] VARCHAR(25) NULL,
    [SecuritySeries] VARCHAR(5) NULL,
    [SecurityDescription] VARCHAR(50) NULL,
    [SecurityCode] VARCHAR(15) NULL,
    [SecurityISIN] VARCHAR(15) NULL,
    [Delete_Status] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nseps03
-- --------------------------------------------------
CREATE TABLE [dbo].[nseps03]
(
    [Position_Date] VARCHAR(50) NULL,
    [Segment_Indicator] VARCHAR(50) NULL,
    [Settlement_Type] VARCHAR(50) NULL,
    [Clearing_Member_Code] VARCHAR(50) NULL,
    [Member_Type] VARCHAR(50) NULL,
    [Trading_Member_Code] VARCHAR(50) NULL,
    [Account_Type] VARCHAR(50) NULL,
    [Client_Account_Code] VARCHAR(50) NULL,
    [Instrument_Type] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Expiry_date] VARCHAR(50) NULL,
    [Strike_Price] FLOAT NULL,
    [Option_Type] VARCHAR(255) NULL,
    [CA_Level] VARCHAR(255) NULL,
    [Brought_Forward_Long_Quantity] FLOAT NULL,
    [Brought_Forward_Long_Value] FLOAT NULL,
    [Brought_Forward_Short_Quantity] FLOAT NULL,
    [Brought_Forward_Short_Value] FLOAT NULL,
    [Day_Buy_Open_Quantity] FLOAT NULL,
    [Day_Buy_Open_Value] FLOAT NULL,
    [Day_Sell_Open_Quantity] FLOAT NULL,
    [Day_Sell_Open_Value] FLOAT NULL,
    [Pre_Ex_Asgmnt_Long_Quantity] FLOAT NULL,
    [Pre_Ex_Asgmnt_Long_Value] FLOAT NULL,
    [Pre_Ex_Asgmnt_Short_Quantity] FLOAT NULL,
    [Pre_Ex_Asgmnt_Short_Value] FLOAT NULL,
    [Exercised_Quantity] FLOAT NULL,
    [Assigned_Quantity] FLOAT NULL,
    [Post_Ex_Asgmnt_Long_Quantity] FLOAT NULL,
    [Post_Ex_Asgmnt_Long_Value] FLOAT NULL,
    [Post_Ex_Asgmnt_Short_Quantity] FLOAT NULL,
    [Post_Ex_Asgmnt_Short_Value] FLOAT NULL,
    [Settlement_Price] FLOAT NULL,
    [Net_Premium] FLOAT NULL,
    [Daily_MTM_Settlement_Value] FLOAT NULL,
    [Futures_Final_Settlement_Value] FLOAT NULL,
    [Exercised_Assigned_Value] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.nsx_19
-- --------------------------------------------------
CREATE TABLE [dbo].[nsx_19]
(
    [Column 0] VARCHAR(50) NULL,
    [Column 1] VARCHAR(50) NULL,
    [Column 2] VARCHAR(50) NULL,
    [Column 3] VARCHAR(50) NULL,
    [Column 4] VARCHAR(50) NULL,
    [Column 5] VARCHAR(50) NULL,
    [Column 6] VARCHAR(50) NULL,
    [Column 7] VARCHAR(50) NULL,
    [Column 8] VARCHAR(50) NULL,
    [Column 9] VARCHAR(50) NULL,
    [Column 10] VARCHAR(50) NULL,
    [Column 11] VARCHAR(50) NULL,
    [Column 12] VARCHAR(50) NULL,
    [Column 13] VARCHAR(50) NULL,
    [Column 14] VARCHAR(50) NULL,
    [Column 15] VARCHAR(50) NULL,
    [Column 16] VARCHAR(50) NULL,
    [Column 17] VARCHAR(50) NULL,
    [Column 18] VARCHAR(50) NULL,
    [Column 19] VARCHAR(50) NULL,
    [Column 20] VARCHAR(50) NULL,
    [Column 21] VARCHAR(50) NULL,
    [Column 22] VARCHAR(50) NULL,
    [Column 23] VARCHAR(50) NULL,
    [Column 24] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSX_BHAV_COPY
-- --------------------------------------------------
CREATE TABLE [dbo].[NSX_BHAV_COPY]
(
    [Market] VARCHAR(50) NULL,
    [Instrument] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [ExpiryDate] DATETIME NULL,
    [Strike] VARCHAR(50) NULL,
    [OptionType] VARCHAR(50) NULL,
    [PreviousClose] MONEY NULL,
    [Openr] MONEY NULL,
    [High] MONEY NULL,
    [Low] MONEY NULL,
    [Closer] MONEY NULL,
    [TotalVolume] MONEY NULL,
    [TotalValue] MONEY NULL,
    [OpenInterest] MONEY NULL,
    [ChangeInOpenInterest] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSX_BlockScript_Temp_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[NSX_BlockScript_Temp_upload]
(
    [Contracttokennumber] VARCHAR(50) NULL,
    [Assettokennumber] VARCHAR(50) NULL,
    [Instrument] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(50) NULL,
    [Filler] VARCHAR(50) NULL,
    [Expirydate] VARCHAR(50) NULL,
    [StrikePrice] VARCHAR(50) NULL,
    [OptionType] VARCHAR(50) NULL,
    [PRECISION_1] VARCHAR(50) NULL,
    [CALevel] VARCHAR(50) NULL,
    [Filler_1] VARCHAR(50) NULL,
    [Admissiontype] VARCHAR(50) NULL,
    [IssueRate] VARCHAR(50) NULL,
    [Tradingstatus_N] VARCHAR(50) NULL,
    [Eligibility_N] VARCHAR(50) NULL,
    [Filler_N] VARCHAR(50) NULL,
    [Tradingstatus] VARCHAR(50) NULL,
    [Eligibility] VARCHAR(50) NULL,
    [Filler_2] VARCHAR(50) NULL,
    [Tradingstatus_S] VARCHAR(50) NULL,
    [Eligibility_S] VARCHAR(50) NULL,
    [Filler_3] VARCHAR(50) NULL,
    [Tradingstatus_A] VARCHAR(50) NULL,
    [Eligibility_A] VARCHAR(50) NULL,
    [Filler_A] VARCHAR(50) NULL,
    [IssueStart] VARCHAR(50) NULL,
    [Settlement] VARCHAR(50) NULL,
    [ContractMaturity] VARCHAR(50) NULL,
    [MarginPercentage] VARCHAR(50) NULL,
    [MinimumLotSize] VARCHAR(50) NULL,
    [BoardLotQuantity] VARCHAR(50) NULL,
    [TickSize] VARCHAR(50) NULL,
    [IssuedCapital] VARCHAR(50) NULL,
    [VolumeFreezeQuantity] VARCHAR(50) NULL,
    [WarningQuantity] VARCHAR(50) NULL,
    [Admissiondate] VARCHAR(50) NULL,
    [Expulsiondate] VARCHAR(50) NULL,
    [Readmissiondate] VARCHAR(50) NULL,
    [Recorddate] VARCHAR(50) NULL,
    [Nodeliverystartdate] VARCHAR(50) NULL,
    [Nodeliveryenddate] VARCHAR(50) NULL,
    [OperatingRange_LOW] VARCHAR(50) NULL,
    [OperatingRage_HIGH] VARCHAR(50) NULL,
    [ExDate] VARCHAR(50) NULL,
    [BookClosureStartDate] VARCHAR(50) NULL,
    [BookClosureEndDate] VARCHAR(50) NULL,
    [UpdateDateandTime] VARCHAR(50) NULL,
    [ExerciseStartDate] VARCHAR(50) NULL,
    [ExerciseEndDate] VARCHAR(50) NULL,
    [TickerSelection] VARCHAR(50) NULL,
    [QuantityMultiplier] VARCHAR(50) NULL,
    [Creditrating] VARCHAR(50) NULL,
    [Stockname] VARCHAR(50) NULL,
    [Corporatepurpose_AGMEGM] VARCHAR(50) NULL,
    [Corporatepurpose_InterestDividend] VARCHAR(50) NULL,
    [Corporatepurpose_RightsBonus] VARCHAR(50) NULL,
    [SpecialTerms] VARCHAR(50) NULL,
    [Remarks] VARCHAR(50) NULL,
    [ExerciseStyle] VARCHAR(50) NULL,
    [ExerciseAllowed] VARCHAR(50) NULL,
    [ExerciseRejectionAllowed] VARCHAR(50) NULL,
    [PositionLiquidationAllowed] VARCHAR(50) NULL,
    [Checksum] VARCHAR(50) NULL,
    [CorporateActionadjusted] VARCHAR(50) NULL,
    [UnderlyingAssetSymbol] VARCHAR(50) NULL,
    [AssetInstrument] VARCHAR(50) NULL,
    [BasePrice] VARCHAR(50) NULL,
    [Deleteflag] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.NSXBlockScript
-- --------------------------------------------------
CREATE TABLE [dbo].[NSXBlockScript]
(
    [Contracttokennumber] VARCHAR(50) NULL,
    [Assettokennumber] VARCHAR(50) NULL,
    [Instrument] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(50) NULL,
    [Filler] VARCHAR(50) NULL,
    [Expirydate] DATETIME NULL,
    [StrikePrice] VARCHAR(50) NULL,
    [OptionType] VARCHAR(50) NULL,
    [CALevel] VARCHAR(50) NULL,
    [Filler_1] VARCHAR(50) NULL,
    [Admissiontype] VARCHAR(50) NULL,
    [IssueRate] VARCHAR(50) NULL,
    [Tradingstatus_N] VARCHAR(50) NULL,
    [Eligibility_N] VARCHAR(50) NULL,
    [Filler_N] VARCHAR(50) NULL,
    [Tradingstatus] VARCHAR(50) NULL,
    [Eligibility] VARCHAR(50) NULL,
    [Filler_2] VARCHAR(50) NULL,
    [Tradingstatus_S] VARCHAR(50) NULL,
    [Eligibility_S] VARCHAR(50) NULL,
    [Filler_3] VARCHAR(50) NULL,
    [Tradingstatus_A] VARCHAR(50) NULL,
    [Eligibility_A] VARCHAR(50) NULL,
    [Filler_A] VARCHAR(50) NULL,
    [IssueStart] VARCHAR(50) NULL,
    [Settlement] VARCHAR(50) NULL,
    [ContractMaturity] VARCHAR(50) NULL,
    [MarginPercentage] VARCHAR(50) NULL,
    [MinimumLotSize] VARCHAR(50) NULL,
    [BoardLotQuantity] VARCHAR(50) NULL,
    [TickSize] VARCHAR(50) NULL,
    [IssuedCapital] VARCHAR(50) NULL,
    [VolumeFreezeQuantity] VARCHAR(50) NULL,
    [WarningQuantity] VARCHAR(50) NULL,
    [Admissiondate] VARCHAR(50) NULL,
    [Expulsiondate] VARCHAR(50) NULL,
    [Readmissiondate] VARCHAR(50) NULL,
    [Recorddate] VARCHAR(50) NULL,
    [Nodeliverystartdate] VARCHAR(50) NULL,
    [Nodeliveryenddate] VARCHAR(50) NULL,
    [OperatingRange_LOW] VARCHAR(50) NULL,
    [OperatingRage_HIGH] VARCHAR(50) NULL,
    [ExDate] VARCHAR(50) NULL,
    [BookClosureStartDate] VARCHAR(50) NULL,
    [BookClosureEndDate] VARCHAR(50) NULL,
    [UpdateDateandTime] VARCHAR(50) NULL,
    [ExerciseStartDate] VARCHAR(50) NULL,
    [ExerciseEndDate] VARCHAR(50) NULL,
    [TickerSelection] VARCHAR(50) NULL,
    [QuantityMultiplier] VARCHAR(50) NULL,
    [Creditrating] VARCHAR(50) NULL,
    [Stockname] VARCHAR(50) NULL,
    [Corporatepurpose_AGMEGM] VARCHAR(50) NULL,
    [Corporatepurpose_InterestDividend] VARCHAR(50) NULL,
    [Corporatepurpose_RightsBonus] VARCHAR(50) NULL,
    [SpecialTerms] VARCHAR(50) NULL,
    [Remarks] VARCHAR(50) NULL,
    [ExerciseStyle] VARCHAR(50) NULL,
    [ExerciseAllowed] VARCHAR(50) NULL,
    [ExerciseRejectionAllowed] VARCHAR(50) NULL,
    [PositionLiquidationAllowed] VARCHAR(50) NULL,
    [Checksum] VARCHAR(50) NULL,
    [CorporateActionadjusted] VARCHAR(50) NULL,
    [UnderlyingAssetSymbol] VARCHAR(50) NULL,
    [AssetInstrument] VARCHAR(50) NULL,
    [BasePrice] VARCHAR(50) NULL,
    [Deleteflag] VARCHAR(50) NULL,
    [UploadDateTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odin_Clt_Deletion_OCNC
-- --------------------------------------------------
CREATE TABLE [dbo].[Odin_Clt_Deletion_OCNC]
(
    [Odin] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odin_Clt_Map
-- --------------------------------------------------
CREATE TABLE [dbo].[Odin_Clt_Map]
(
    [Odin] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Odin_Clt_Map_New
-- --------------------------------------------------
CREATE TABLE [dbo].[Odin_Clt_Map_New]
(
    [Odin] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS_TEMP]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Reserved] VARCHAR(100) NULL,
    [Reserved1] VARCHAR(100) NULL,
    [Retain Multiplier] VARCHAR(100) NULL,
    [Over Rule CRP] VARCHAR(100) NULL,
    [Limit Inclusion] VARCHAR(100) NULL,
    [Reserved2] VARCHAR(100) NULL,
    [Cash Deposit] VARCHAR(100) NULL,
    [Adhoc Deposit] VARCHAR(100) NULL,
    [Notional Depsoit] VARCHAR(100) NULL,
    [Miscellaneous Deposit] VARCHAR(100) NULL,
    [Manual Collateral] VARCHAR(100) NULL,
    [Max Option CFS] VARCHAR(100) NULL,
    [Max Collateral] VARCHAR(100) NULL,
    [Max CFS] VARCHAR(100) NULL,
    [Gross_Expo_Limit/Multi] VARCHAR(100) NULL,
    [Net_Purchase_Limit/Multi] VARCHAR(100) NULL,
    [Net_Sale_Limit/Multi] VARCHAR(100) NULL,
    [Net_Premium_Limit/Multi] VARCHAR(100) NULL,
    [Net_Write_Limit/Multi] VARCHAR(100) NULL,
    [Net_Pos_Limit/Multi] VARCHAR(100) NULL,
    [Turnover_Multi/Limt] VARCHAR(100) NULL,
    [MTM_Limit/Multi] VARCHAR(100) NULL,
    [Margin_Limit/Multi] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS_TEMP_30012014
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS_TEMP_30012014]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Deposit] VARCHAR(100) NULL,
    [Code] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [SGroup] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Instrument_Name] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [Strike_Price] VARCHAR(100) NULL,
    [Option_Type] VARCHAR(100) NULL,
    [Gross_Expo_Mult] VARCHAR(100) NULL,
    [GE_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Expo_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Premium_in_000s] VARCHAR(100) NULL,
    [Net_Sale_Expo_Multi] VARCHAR(100) NULL,
    [NSE_Write_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Pos_Multi] VARCHAR(100) NULL,
    [NP_Limit_in_000s] VARCHAR(100) NULL,
    [Turnover_Multi] VARCHAR(100) NULL,
    [TurnOver_Limit_in_000s] VARCHAR(100) NULL,
    [Pending_Order_Multi] VARCHAR(100) NULL,
    [Pending_Order_Limit_in_000s] VARCHAR(100) NULL,
    [MTM_Loss_Multi] VARCHAR(100) NULL,
    [MTM_Limit_in_000s] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_in_000s] VARCHAR(100) NULL,
    [NQ_Limit] VARCHAR(100) NULL,
    [Max_Order_Value] VARCHAR(100) NULL,
    [Max_Order_Qty] VARCHAR(100) NULL,
    [Retain_Multi] VARCHAR(100) NULL,
    [Inclu_MTM] VARCHAR(100) NULL,
    [Inclu_Net_Premium] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Omn_User_info_new
-- --------------------------------------------------
CREATE TABLE [dbo].[Omn_User_info_new]
(
    [Client_id] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.omnesys_user_info
-- --------------------------------------------------
CREATE TABLE [dbo].[omnesys_user_info]
(
    [type] VARCHAR(25) NOT NULL,
    [broker_id] VARCHAR(35) NOT NULL,
    [branch_id] VARCHAR(35) NOT NULL,
    [dealer_id] VARCHAR(45) NOT NULL,
    [client_grp] VARCHAR(20) NOT NULL,
    [client_id] VARCHAR(25) NOT NULL,
    [Privilege] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.omnesys_user_info_all
-- --------------------------------------------------
CREATE TABLE [dbo].[omnesys_user_info_all]
(
    [type] VARCHAR(25) NOT NULL,
    [broker_id] VARCHAR(35) NOT NULL,
    [branch_id] VARCHAR(35) NOT NULL,
    [dealer_id] VARCHAR(45) NOT NULL,
    [client_grp] VARCHAR(20) NOT NULL,
    [client_id] VARCHAR(25) NOT NULL,
    [Privilege] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OMNESYS_USER_INFO_ALL_11062012
-- --------------------------------------------------
CREATE TABLE [dbo].[OMNESYS_USER_INFO_ALL_11062012]
(
    [type] VARCHAR(25) NOT NULL,
    [broker_id] VARCHAR(35) NOT NULL,
    [branch_id] VARCHAR(35) NOT NULL,
    [dealer_id] VARCHAR(45) NOT NULL,
    [client_grp] VARCHAR(20) NOT NULL,
    [client_id] VARCHAR(25) NOT NULL,
    [Privilege] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.omnesys_user_info_testing
-- --------------------------------------------------
CREATE TABLE [dbo].[omnesys_user_info_testing]
(
    [type] VARCHAR(25) NOT NULL,
    [broker_id] VARCHAR(35) NOT NULL,
    [branch_id] VARCHAR(35) NOT NULL,
    [dealer_id] VARCHAR(45) NOT NULL,
    [client_grp] VARCHAR(20) NOT NULL,
    [client_id] VARCHAR(25) NOT NULL,
    [Privilege] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.onlinedrive_easi_reg
-- --------------------------------------------------
CREATE TABLE [dbo].[onlinedrive_easi_reg]
(
    [srno] VARCHAR(5) NULL,
    [BO_id] VARCHAR(30) NULL,
    [login_name] VARCHAR(75) NULL,
    [email] VARCHAR(75) NULL,
    [reg_date] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.oracle_upload_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[oracle_upload_temp]
(
    [INVOICE_NUM] NVARCHAR(255) NULL,
    [INVOICE_TYPE_LOOKUP_CODE] NVARCHAR(255) NULL,
    [INVOICE_DATE] NVARCHAR(255) NULL,
    [VENDOR_NUM] FLOAT NULL,
    [VENDOR_SITE_CODE] NVARCHAR(255) NULL,
    [INVOICE_AMOUNT] FLOAT NULL,
    [INVOICE_CURRENCY_CODE] NVARCHAR(255) NULL,
    [TERMS_NAME] NVARCHAR(255) NULL,
    [Description] NVARCHAR(255) NULL,
    [STATUS] NVARCHAR(255) NULL,
    [SOURCE] NVARCHAR(255) NULL,
    [DOC_CATEGORY_CODE] NVARCHAR(255) NULL,
    [PAYMENT_METHOD_LOOKUP_CODE] NVARCHAR(255) NULL,
    [GL_DATE] NVARCHAR(255) NULL,
    [ORG_ID] FLOAT NULL,
    [LINE_NUMBER] FLOAT NULL,
    [LINE_TYPE_LOOKUP_CODE] NVARCHAR(255) NULL,
    [LINE_AMOUNT] FLOAT NULL,
    [Line_DESCRIPTION] NVARCHAR(255) NULL,
    [DIST_LINE_NUMBER] NVARCHAR(255) NULL,
    [DIST_AMOUNT] NVARCHAR(255) NULL,
    [DIST_CODE_CONCATENATED] NVARCHAR(255) NULL,
    [ACCOUNTING_DATE] NVARCHAR(255) NULL,
    [DIST_DESCRIPTION] NVARCHAR(255) NULL,
    [PAY_GROUP_LOOKUP_CODE] NVARCHAR(255) NULL,
    [SEGMENT_1] NVARCHAR(255) NULL,
    [SEGMENT_2] NVARCHAR(255) NULL,
    [SEGMENT_3] NVARCHAR(255) NULL,
    [SEGMENT_4] NVARCHAR(255) NULL,
    [SEGMENT_5] NVARCHAR(255) NULL,
    [SEGMENT_6] NVARCHAR(255) NULL,
    [SEGMENT_7] NVARCHAR(255) NULL,
    [SEGMENT_8] NVARCHAR(255) NULL,
    [SEGMENT_9] NVARCHAR(255) NULL,
    [SEGMENT_10] NVARCHAR(255) NULL,
    [SEGMENT_11] NVARCHAR(255) NULL,
    [ASSETS_TRACKING_FLAG] NVARCHAR(255) NULL,
    [ATTRIBUTE_CATEGORY] NVARCHAR(255) NULL,
    [ATTRIBUTE1] NVARCHAR(255) NULL,
    [ATTRIBUTE2] NVARCHAR(255) NULL,
    [ATTRIBUTE3] NVARCHAR(255) NULL,
    [ATTRIBUTE4] NVARCHAR(255) NULL,
    [ATTRIBUTE5] NVARCHAR(255) NULL,
    [ATTRIBUTE6] NVARCHAR(255) NULL,
    [ATTRIBUTE7] NVARCHAR(255) NULL,
    [ATTRIBUTE8] NVARCHAR(255) NULL,
    [ATTRIBUTE9] NVARCHAR(255) NULL,
    [ATTRIBUTE10] NVARCHAR(255) NULL,
    [ATTRIBUTE11] NVARCHAR(255) NULL,
    [ATTRIBUTE12] NVARCHAR(255) NULL,
    [ATTRIBUTE13] NVARCHAR(255) NULL,
    [ATTRIBUTE14] NVARCHAR(255) NULL,
    [ATTRIBUTE15] NVARCHAR(255) NULL,
    [DIST_ATTRIBUTE_CATEGORY] NVARCHAR(255) NULL,
    [DIST_ATTRIBUTE1] NVARCHAR(255) NULL,
    [DIST_ATTRIBUTE2] NVARCHAR(255) NULL,
    [DIST_ATTRIBUTE3] NVARCHAR(255) NULL,
    [DIST_ATTRIBUTE4] NVARCHAR(255) NULL,
    [DIST_ATTRIBUTE5] NVARCHAR(255) NULL,
    [DIST_GLOBAL_ATT_CATEGORY] NVARCHAR(255) NULL,
    [GLOBAL_ATTRIBUTE1] NVARCHAR(255) NULL,
    [GLOBAL_ATTRIBUTE2] NVARCHAR(255) NULL,
    [GLOBAL_ATTRIBUTE3] NVARCHAR(255) NULL,
    [GLOBAL_ATTRIBUTE4] NVARCHAR(255) NULL,
    [GLOBAL_ATTRIBUTE5] NVARCHAR(255) NULL,
    [PREPAY_NUM] NVARCHAR(255) NULL,
    [PREPAY_DIST_NUM] NVARCHAR(255) NULL,
    [PREPAY_APPLY_AMOUNT] NVARCHAR(255) NULL,
    [PREPAY_GL_DATE] NVARCHAR(255) NULL,
    [INVOICE_INCLUDES_PREPAY_FLAG] NVARCHAR(255) NULL,
    [PREPAY_LINE_NUM] NVARCHAR(255) NULL,
    [CREATED_BY] NVARCHAR(255) NULL,
    [CREATION_DATE] NVARCHAR(255) NULL,
    [PROCESSED_STATUS] NVARCHAR(255) NULL,
    [ERROR_MESSAGE] NVARCHAR(255) NULL,
    [INVOICE_STATUS] NVARCHAR(255) NULL,
    [BATCH_NAME] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Order_Queue
-- --------------------------------------------------
CREATE TABLE [dbo].[Order_Queue]
(
    [orderID] VARCHAR(50) NOT NULL,
    [Hod_no] VARCHAR(25) NULL,
    [ItemID] VARCHAR(50) NULL,
    [TotalQty] FLOAT NULL,
    [Status] INT NULL,
    [StockQty] FLOAT NULL,
    [Rate] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Order_VQueue
-- --------------------------------------------------
CREATE TABLE [dbo].[Order_VQueue]
(
    [ReqID] VARCHAR(25) NOT NULL,
    [Pi_no] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OrderTmpQueue
-- --------------------------------------------------
CREATE TABLE [dbo].[OrderTmpQueue]
(
    [OrderID] VARCHAR(50) NOT NULL,
    [ItemID] VARCHAR(50) NULL,
    [Qty] FLOAT NULL,
    [Rate] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd020320
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd020320]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd030320
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd030320]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd040320
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd040320]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd050320
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd050320]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd190220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd190220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd200220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd200220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd240220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd240220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd250220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd250220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd260220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd260220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd270220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd270220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pd280220
-- --------------------------------------------------
CREATE TABLE [dbo].[Pd280220]
(
    [MKT] VARCHAR(50) NULL,
    [SERIES] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [SECURITY] VARCHAR(50) NULL,
    [PREV_CL_PR] VARCHAR(50) NULL,
    [OPEN_PRICE] VARCHAR(50) NULL,
    [HIGH_PRICE] VARCHAR(50) NULL,
    [LOW_PRICE] VARCHAR(50) NULL,
    [CLOSE_PRICE] VARCHAR(50) NULL,
    [NET_TRDVAL] VARCHAR(50) NULL,
    [NET_TRDQTY] VARCHAR(50) NULL,
    [IND_SEC] VARCHAR(50) NULL,
    [CORP_IND] VARCHAR(50) NULL,
    [TRADES] VARCHAR(50) NULL,
    [HI_52_WK] VARCHAR(50) NULL,
    [LO_52_WK] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.penalty
-- --------------------------------------------------
CREATE TABLE [dbo].[penalty]
(
    [ScripCode] VARCHAR(50) NULL,
    [ScripName] VARCHAR(50) NULL,
    [Bank] VARCHAR(50) NULL,
    [Qty] VARCHAR(50) NULL,
    [AucRate] VARCHAR(50) NULL,
    [StdRate] VARCHAR(50) NULL,
    [Debit] VARCHAR(50) NULL,
    [Credit] VARCHAR(50) NULL,
    [AucComm] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pindata
-- --------------------------------------------------
CREATE TABLE [dbo].[pindata]
(
    [State1] VARCHAR(255) NULL,
    [City] VARCHAR(255) NULL,
    [PinCode] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pledge_correction$
-- --------------------------------------------------
CREATE TABLE [dbo].[pledge_correction$]
(
    [PLEDGEORDER] FLOAT NULL,
    [Wrongbal] FLOAT NULL,
    [Correctbal] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_01022016
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_01022016]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_04Apr2018
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_04Apr2018]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_21Jan2019
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_21Jan2019]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_log
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_log]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL,
    [action_type] VARCHAR(50) NULL,
    [action_date] DATETIME NULL,
    [action_by] VARCHAR(30) NULL,
    [action_location] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_NEW_BKP_210119
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_NEW_BKP_210119]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_Temp]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge_Unpledge_Master_testing
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge_Unpledge_Master_testing]
(
    [Holdingdatetime] DATETIME NULL,
    [Clientid] VARCHAR(50) NULL,
    [Bankid] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [Sc_isinname] VARCHAR(150) NULL,
    [Pledgeorder] INT NULL,
    [Pledgedate] VARCHAR(50) NULL,
    [Pledgeqty] INT NULL,
    [Unpledgeqty] INT NULL,
    [Balance] INT NULL,
    [Oldpsn_corp] INT NULL,
    [Agreement_No] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Pledge2releaseentry_04Apr2018
-- --------------------------------------------------
CREATE TABLE [dbo].[Pledge2releaseentry_04Apr2018]
(
    [HoldingDateTime] DATETIME NULL,
    [ClientId] VARCHAR(50) NULL,
    [BankId] VARCHAR(50) NULL,
    [Isin] VARCHAR(50) NULL,
    [sc_isinname] VARCHAR(50) NULL,
    [PledgeOrder] VARCHAR(50) NULL,
    [PledgeDate] VARCHAR(50) NULL,
    [PledgeQty] MONEY NULL,
    [UnPledgeOrder] VARCHAR(50) NULL,
    [UnPledgeQty] MONEY NULL,
    [Balance] MONEY NULL,
    [Pledge2ReleaseMarked] MONEY NULL,
    [Pledge2Release] MONEY NULL,
    [Remarks] VARCHAR(500) NULL,
    [MkrId] VARCHAR(50) NULL,
    [MkrTime] VARCHAR(50) NULL,
    [MaxCounter] NVARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Policy_Upload
-- --------------------------------------------------
CREATE TABLE [dbo].[Policy_Upload]
(
    [PolicyType] VARCHAR(100) NULL,
    [Payterm] VARCHAR(100) NULL,
    [Sum] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PolicyTable
-- --------------------------------------------------
CREATE TABLE [dbo].[PolicyTable]
(
    [PolicyType] VARCHAR(100) NULL,
    [Payterm] VARCHAR(100) NULL,
    [Sum] VARCHAR(100) NULL,
    [Month] VARCHAR(50) NULL,
    [Year] VARCHAR(50) NULL,
    [UploadedOn] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ProcessIncharge
-- --------------------------------------------------
CREATE TABLE [dbo].[ProcessIncharge]
(
    [Emp_No] VARCHAR(30) NOT NULL,
    [Hod_No] VARCHAR(30) NULL,
    [ReqID] VARCHAR(25) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Projection
-- --------------------------------------------------
CREATE TABLE [dbo].[Projection]
(
    [Zone] NVARCHAR(255) NULL,
    [ Region] NVARCHAR(255) NULL,
    [ AREA] NVARCHAR(255) NULL,
    [ BranchCode] NVARCHAR(255) NULL,
    [ Age] FLOAT NULL,
    [RevPerDayB2B] FLOAT NULL,
    [RevPerDayB2C] FLOAT NULL,
    [Expense] FLOAT NULL,
    [MTDProd] FLOAT NULL,
    [AvgProdLast3Mnth] FLOAT NULL,
    [FutureProd12Mnth] FLOAT NULL,
    [FutureProd18Mnth] FLOAT NULL,
    [TotalFutureRev12Mnth] FLOAT NULL,
    [TotalFutureRev18Mnth] FLOAT NULL,
    [ExistingCliB2B_NoOFSB] FLOAT NULL,
    [ExistingCliB2B_NoOFClis] FLOAT NULL,
    [ExistingCliB2B_AvgNetRevPerCliPerday] FLOAT NULL,
    [ExistingCliB2B_PercentActivation] FLOAT NULL,
    [ExistingCliB2B_PercentRevPerDay] FLOAT NULL,
    [ExistingCliB2C_NoOFClis] FLOAT NULL,
    [ExistingCliB2C_AvgNetRevPerCliPerday] FLOAT NULL,
    [ExistingCliB2C_PercentActivation] FLOAT NULL,
    [ExistingCliB2C_PercentRevPerDay] FLOAT NULL,
    [NewCliAdd_B2BClis] FLOAT NULL,
    [NewCliAdd_B2CClis] FLOAT NULL,
    [NewCliAdd_NoOfSB] FLOAT NULL,
    [RevFromNewCliB2B_12Mnth] FLOAT NULL,
    [RevFromNewCliB2B_18Mnth] FLOAT NULL,
    [RevFromNewCliB2C_12Mnth] FLOAT NULL,
    [RevFromNewCliB2C_18Mnth] FLOAT NULL,
    [RevFromExistingCliB2B] FLOAT NULL,
    [RevFromExistingCliB2C] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PROJECTION_11122008
-- --------------------------------------------------
CREATE TABLE [dbo].[PROJECTION_11122008]
(
    [Zone] NVARCHAR(255) NULL,
    [ Region] NVARCHAR(255) NULL,
    [ AREA] NVARCHAR(255) NULL,
    [ BranchCode] NVARCHAR(255) NULL,
    [ Age] FLOAT NULL,
    [RevPerDayB2B] FLOAT NULL,
    [RevPerDayB2C] FLOAT NULL,
    [Expense] FLOAT NULL,
    [MTDProd] FLOAT NULL,
    [AvgProdLast3Mnth] FLOAT NULL,
    [FutureProd12Mnth] FLOAT NULL,
    [FutureProd18Mnth] FLOAT NULL,
    [TotalFutureRev12Mnth] FLOAT NULL,
    [TotalFutureRev18Mnth] FLOAT NULL,
    [ExistingCliB2B_NoOFSB] FLOAT NULL,
    [ExistingCliB2B_NoOFClis] FLOAT NULL,
    [ExistingCliB2B_AvgNetRevPerCliPerday] FLOAT NULL,
    [ExistingCliB2B_PercentActivation] FLOAT NULL,
    [ExistingCliB2B_PercentRevPerDay] FLOAT NULL,
    [ExistingCliB2C_NoOFClis] FLOAT NULL,
    [ExistingCliB2C_AvgNetRevPerCliPerday] FLOAT NULL,
    [ExistingCliB2C_PercentActivation] FLOAT NULL,
    [ExistingCliB2C_PercentRevPerDay] FLOAT NULL,
    [NewCliAdd_B2BClis] FLOAT NULL,
    [NewCliAdd_B2CClis] FLOAT NULL,
    [NewCliAdd_NoOfSB] FLOAT NULL,
    [RevFromNewCliB2B_12Mnth] FLOAT NULL,
    [RevFromNewCliB2B_18Mnth] FLOAT NULL,
    [RevFromNewCliB2C_12Mnth] FLOAT NULL,
    [RevFromNewCliB2C_18Mnth] FLOAT NULL,
    [RevFromExistingCliB2B] FLOAT NULL,
    [RevFromExistingCliB2C] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ProvisionalOrdertemp
-- --------------------------------------------------
CREATE TABLE [dbo].[ProvisionalOrdertemp]
(
    [MemberCode] VARCHAR(500) NULL,
    [Date] VARCHAR(500) NULL,
    [Time] VARCHAR(500) NULL,
    [OrderNo] VARCHAR(500) NULL,
    [SettNo] VARCHAR(500) NULL,
    [ClientCode] VARCHAR(500) NULL,
    [ClientName] VARCHAR(500) NULL,
    [SchemeCode] VARCHAR(500) NULL,
    [SchemeName] VARCHAR(500) NULL,
    [ISIN] VARCHAR(500) NULL,
    [Buy_Sell] VARCHAR(500) NULL,
    [Amount] VARCHAR(500) NULL,
    [Units] VARCHAR(500) NULL,
    [DPTrans] VARCHAR(500) NULL,
    [DPFolioNo] VARCHAR(500) NULL,
    [FolioNo] VARCHAR(500) NULL,
    [EntryBy] VARCHAR(500) NULL,
    [OrderStatus] VARCHAR(500) NULL,
    [OrderRemark] VARCHAR(500) NULL,
    [INTERNALREFNO] VARCHAR(500) NULL,
    [SETTLEMENTTYPE] VARCHAR(500) NULL,
    [OrderType] VARCHAR(500) NULL,
    [SIPREGNNO] VARCHAR(500) NULL,
    [SIPREGNDATE] VARCHAR(500) NULL,
    [SUBBRCODE] VARCHAR(500) NULL,
    [EUIN] VARCHAR(500) NULL,
    [EUINDECL] VARCHAR(500) NULL,
    [ALLUnitsFlag] VARCHAR(500) NULL,
    [DPCFlag] VARCHAR(500) NULL,
    [OrderSubType] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.purchase_order_queue
-- --------------------------------------------------
CREATE TABLE [dbo].[purchase_order_queue]
(
    [purchase_id] VARCHAR(20) NULL,
    [orderID] VARCHAR(20) NULL,
    [order_date] VARCHAR(50) NULL,
    [status] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.QE160221
-- --------------------------------------------------
CREATE TABLE [dbo].[QE160221]
(
    [SC_CODE] VARCHAR(50) NULL,
    [SC_NAME] VARCHAR(200) NULL,
    [SC_GROUP] VARCHAR(50) NULL,
    [SC_TYPE] VARCHAR(50) NULL,
    [QUOT_1] VARCHAR(50) NULL,
    [QUOT_2] VARCHAR(50) NULL,
    [QUOT_3] VARCHAR(50) NULL,
    [QUOT_4] VARCHAR(50) NULL,
    [TDCLOINDI] VARCHAR(50) NULL,
    [NO_TRADES] VARCHAR(50) NULL,
    [NO_OF_SHRS] VARCHAR(50) NULL,
    [NET_TURNOV] VARCHAR(50) NULL,
    [ROLLING] VARCHAR(50) NULL,
    [LAST_PRICE] VARCHAR(50) NULL,
    [PRCLORATE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Rej_update_log
-- --------------------------------------------------
CREATE TABLE [dbo].[Rej_update_log]
(
    [Cur_Date] DATETIME NULL,
    [Location] VARCHAR(10) NULL,
    [err_status] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Rej_update_log_Reprocess
-- --------------------------------------------------
CREATE TABLE [dbo].[Rej_update_log_Reprocess]
(
    [Cur_Date] DATETIME NULL,
    [Location] VARCHAR(10) NULL,
    [err_status] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RejectionOrderlumpsumTemp
-- --------------------------------------------------
CREATE TABLE [dbo].[RejectionOrderlumpsumTemp]
(
    [SCHEMECODE] VARCHAR(200) NULL,
    [Purchase_Redeem] VARCHAR(200) NULL,
    [BuySellType] VARCHAR(200) NULL,
    [ClientCode] VARCHAR(200) NULL,
    [Demat_Physical] VARCHAR(200) NULL,
    [OrderValAMOUNT] VARCHAR(200) NULL,
    [FolioNo] VARCHAR(200) NULL,
    [Remarks] VARCHAR(200) NULL,
    [KYCFlag] VARCHAR(200) NULL,
    [SubBrokerARNCode] VARCHAR(200) NULL,
    [EUINNumber] VARCHAR(200) NULL,
    [EUINDeclaration] VARCHAR(200) NULL,
    [MINredemptionflag] VARCHAR(200) NULL,
    [DPCFlag] VARCHAR(200) NULL,
    [AllUnits] VARCHAR(200) NULL,
    [RedemptionUnits] VARCHAR(200) NULL,
    [OrderRemark] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Reliance
-- --------------------------------------------------
CREATE TABLE [dbo].[Reliance]
(
    [City] VARCHAR(255) NULL,
    [TelecomCircle] VARCHAR(255) NULL,
    [BranchTag] VARCHAR(255) NULL,
    [Address] VARCHAR(255) NULL,
    [No] VARCHAR(255) NULL,
    [DN Range] VARCHAR(255) NULL,
    [DID Count] VARCHAR(255) NULL,
    [DNFrom] VARCHAR(25) NULL,
    [DNTo] VARCHAR(25) NULL,
    [STD] VARCHAR(25) NULL,
    [TEMP1] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Reliance PRI DID Number Range
-- --------------------------------------------------
CREATE TABLE [dbo].[Reliance PRI DID Number Range]
(
    [SrNo] VARCHAR(255) NULL,
    [WithSTDCode] VARCHAR(255) NULL,
    [WithoutSTDCode] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Reliance1
-- --------------------------------------------------
CREATE TABLE [dbo].[Reliance1]
(
    [City] VARCHAR(255) NULL,
    [Circle] VARCHAR(255) NULL,
    [Branch] VARCHAR(255) NULL,
    [STD] VARCHAR(255) NULL,
    [Tel] VARCHAR(255) NULL,
    [From] VARCHAR(255) NULL,
    [To] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RELNO
-- --------------------------------------------------
CREATE TABLE [dbo].[RELNO]
(
    [Circle] VARCHAR(50) NULL,
    [BRTAG] VARCHAR(10) NULL,
    [TEL] VARCHAR(50) NULL,
    [STD] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RelNo_bak
-- --------------------------------------------------
CREATE TABLE [dbo].[RelNo_bak]
(
    [Circle] VARCHAR(50) NULL,
    [BRTAG] VARCHAR(10) NULL,
    [TEL] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RelNo1
-- --------------------------------------------------
CREATE TABLE [dbo].[RelNo1]
(
    [SrNo] VARCHAR(255) NULL,
    [WithSTDCode] VARCHAR(255) NULL,
    [WithoutSTDCode] VARCHAR(255) NULL,
    [Circle] VARCHAR(25) NULL,
    [BrTag] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ReqModified
-- --------------------------------------------------
CREATE TABLE [dbo].[ReqModified]
(
    [ReqID] VARCHAR(20) NOT NULL,
    [ModID] VARCHAR(20) NOT NULL,
    [Hod_no] VARCHAR(15) NULL,
    [Comm_no] VARCHAR(15) NULL,
    [Hod_note] VARCHAR(60) NULL,
    [Comm_note] VARCHAR(60) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ReqReminder
-- --------------------------------------------------
CREATE TABLE [dbo].[ReqReminder]
(
    [ReqID] VARCHAR(20) NOT NULL,
    [Rem1] VARCHAR(4) NULL,
    [Rem1Date] DATETIME NULL,
    [Rem2] VARCHAR(4) NULL,
    [Rem2Date] DATETIME NULL,
    [Rem1Note] VARCHAR(50) NULL,
    [Rem2Note] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ReqStatus
-- --------------------------------------------------
CREATE TABLE [dbo].[ReqStatus]
(
    [ReqStatusCode] VARCHAR(20) NOT NULL,
    [ReqStatusName] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.restricted_scrip_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[restricted_scrip_upload]
(
    [Segment] VARCHAR(10) NULL,
    [ScripCode] VARCHAR(25) NULL,
    [SecurityName] VARCHAR(75) NULL,
    [TurnoverLimit] VARCHAR(20) NULL,
    [DeleteStatus] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.restricted_scrip_uploadTemp
-- --------------------------------------------------
CREATE TABLE [dbo].[restricted_scrip_uploadTemp]
(
    [OpCode] INT NULL,
    [User] VARCHAR(50) NULL,
    [Group_Id] VARCHAR(50) NULL,
    [Deposit] NVARCHAR(50) NULL,
    [Scrip_Code] NUMERIC(18, 0) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [Periodicity] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Expiry] VARCHAR(50) NULL,
    [Strike_Price] VARCHAR(50) NULL,
    [Option_Type] VARCHAR(50) NULL,
    [Gross_Exposure_Multiplier] NUMERIC(18, 0) NULL,
    [Gross_Exposure_Limit] NUMERIC(18, 0) NULL,
    [Net_Exposure_Multiplier] NUMERIC(18, 0) NULL,
    [Net_Exposure] NUMERIC(18, 0) NULL,
    [Net_Sale_Multiplier] NUMERIC(18, 0) NULL,
    [Net_Sale_Limit] NUMERIC(18, 0) NULL,
    [Net_Position_Multiplier] NUMERIC(18, 0) NULL,
    [Net_Position_Limit] NVARCHAR(50) NULL,
    [TurnOver_Multiplier] NUMERIC(18, 0) NULL,
    [TurnOver_Limit] NUMERIC(18, 0) NULL,
    [Pending_Order_Multiplier] NUMERIC(18, 0) NULL,
    [Pending_Order_Limit] NUMERIC(18, 0) NULL,
    [MTM_Multiplier] NUMERIC(18, 0) NULL,
    [MTM_Limit] NUMERIC(18, 0) NULL,
    [Ini_Margin_Multiplier] NUMERIC(18, 0) NULL,
    [Ini_Margin_Limit] NUMERIC(18, 0) NULL,
    [NQ_Limit] NVARCHAR(50) NULL,
    [Max_Single_Trans_Limit] NVARCHAR(50) NULL,
    [Max_Single_Trans_Quantity] NVARCHAR(50) NULL,
    [Min_Order_Value] NUMERIC(18, 0) NULL,
    [Min_Order_Quantity] NUMERIC(18, 0) NULL,
    [Retain_Multiplier] NUMERIC(18, 0) NULL,
    [Include_MTMP] NUMERIC(18, 0) NULL,
    [Include_Net_Premium] NUMERIC(18, 0) NULL,
    [GrossAndNet] NUMERIC(18, 0) NULL,
    [Include_Exp_Margin] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ReverseFile_Tracker
-- --------------------------------------------------
CREATE TABLE [dbo].[ReverseFile_Tracker]
(
    [ClientCode] VARCHAR(10) NULL,
    [DpId] VARCHAR(50) NULL,
    [ClientID] VARCHAR(50) NULL,
    [DpType] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RM Block CLT Dtd 190520221
-- --------------------------------------------------
CREATE TABLE [dbo].[RM Block CLT Dtd 190520221]
(
    [Client Code] VARCHAR(50) NULL,
    [Blocked] VARCHAR(50) NULL,
    [Reason] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RM Block CLT Dtd 28072023
-- --------------------------------------------------
CREATE TABLE [dbo].[RM Block CLT Dtd 28072023]
(
    [Client Code] VARCHAR(50) NULL,
    [Blocked] VARCHAR(50) NULL,
    [Reason] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'RM Block CLT Dtd 28072023$'
-- --------------------------------------------------
CREATE TABLE [dbo].['RM Block CLT Dtd 28072023$']
(
    [Client Code] NVARCHAR(255) NULL,
    [Blocked] NVARCHAR(255) NULL,
    [Reason] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RM Block CLT Dtd 29062024
-- --------------------------------------------------
CREATE TABLE [dbo].[RM Block CLT Dtd 29062024]
(
    [Client Code] VARCHAR(50) NULL,
    [Blocked] VARCHAR(50) NULL,
    [Reason] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RMBlock_1_290624
-- --------------------------------------------------
CREATE TABLE [dbo].[RMBlock_1_290624]
(
    [Client Code] VARCHAR(50) NULL,
    [Blocked] VARCHAR(50) NULL,
    [Reason] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.RTAOrdertemp
-- --------------------------------------------------
CREATE TABLE [dbo].[RTAOrdertemp]
(
    [MemberCode] VARCHAR(500) NULL,
    [Date] VARCHAR(500) NULL,
    [Time] VARCHAR(500) NULL,
    [OrderNo] VARCHAR(500) NULL,
    [SettNo] VARCHAR(500) NULL,
    [ClientCode] VARCHAR(500) NULL,
    [ClientName] VARCHAR(500) NULL,
    [SchemeCode] VARCHAR(500) NULL,
    [SchemeName] VARCHAR(500) NULL,
    [ISIN] VARCHAR(500) NULL,
    [Buy_Sell] VARCHAR(500) NULL,
    [Amount] VARCHAR(500) NULL,
    [Units] VARCHAR(500) NULL,
    [DPTrans] VARCHAR(500) NULL,
    [DPFolioNo] VARCHAR(500) NULL,
    [FolioNo] VARCHAR(500) NULL,
    [EntryBy] VARCHAR(500) NULL,
    [OrderStatus] VARCHAR(500) NULL,
    [OrderRemark] VARCHAR(500) NULL,
    [INTERNALREFNO] VARCHAR(500) NULL,
    [SETTLEMENTTYPE] VARCHAR(500) NULL,
    [OrderType] VARCHAR(500) NULL,
    [SIPREGNNO] VARCHAR(500) NULL,
    [SIPREGNDATE] VARCHAR(500) NULL,
    [SUBBRCODE] VARCHAR(500) NULL,
    [EUIN] VARCHAR(500) NULL,
    [EUINDECL] VARCHAR(500) NULL,
    [ALLUnitsFlag] VARCHAR(500) NULL,
    [DPCFlag] VARCHAR(500) NULL,
    [OrderSubType] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rtgs_rp
-- --------------------------------------------------
CREATE TABLE [dbo].[rtgs_rp]
(
    [Sr_No] INT NOT NULL,
    [Bank_Name] VARCHAR(255) NULL,
    [Branch_Name] VARCHAR(255) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Ifsc_Code] VARCHAR(255) NOT NULL,
    [Micr_Code] VARCHAR(255) NULL,
    [Bank_Accno_Length] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rths_master2303
-- --------------------------------------------------
CREATE TABLE [dbo].[rths_master2303]
(
    [Sr_No] INT NOT NULL,
    [Bank_Name] VARCHAR(255) NULL,
    [Branch_Name] VARCHAR(255) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Ifsc_Code] VARCHAR(255) NOT NULL,
    [Micr_Code] VARCHAR(255) NULL,
    [Bank_Accno_Length] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_comp
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_comp]
(
    [Region] NVARCHAR(50) NULL,
    [branch_cd] NVARCHAR(50) NULL,
    [sub_broker] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_jv
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_jv]
(
    [data] VARCHAR(199) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_service_tax
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_service_tax]
(
    [ledgercode] VARCHAR(50) NULL,
    [Sb_code] VARCHAR(50) NULL,
    [Sbname] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [Entry_date] DATETIME NULL,
    [Mon] VARCHAR(50) NULL,
    [Provision_amt] VARCHAR(50) NULL,
    [Gross_Service_tax] VARCHAR(50) NULL,
    [Service_tax] VARCHAR(50) NULL,
    [Cess_tax] VARCHAR(50) NULL,
    [Edu_Tax] VARCHAR(50) NULL,
    [PAN] VARCHAR(50) NULL,
    [Service_Tax_reg_No] VARCHAR(50) NULL,
    [JVmarking] CHAR(1) NULL,
    [branch_cd] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sb_training
-- --------------------------------------------------
CREATE TABLE [dbo].[sb_training]
(
    [Branch_Tag] VARCHAR(10) NULL,
    [Branch_Name] VARCHAR(80) NULL,
    [Branch] VARCHAR(80) NULL,
    [Region] VARCHAR(80) NULL,
    [Sub_Tag] VARCHAR(20) NULL,
    [Sub_Name] VARCHAR(75) NULL,
    [Training_Date] VARCHAR(12) NULL,
    [before_training] VARCHAR(25) NULL,
    [after_training] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SCCS_deletecontrolclients
-- --------------------------------------------------
CREATE TABLE [dbo].[SCCS_deletecontrolclients]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [enteredby] VARCHAR(20) NOT NULL,
    [enteredon] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SCCS_deletecontrolclients_log
-- --------------------------------------------------
CREATE TABLE [dbo].[SCCS_deletecontrolclients_log]
(
    [t_srno] INT IDENTITY(1,1) NOT NULL,
    [srno] INT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [enteredby] VARCHAR(20) NOT NULL,
    [enteredon] DATETIME NOT NULL,
    [actiontype] VARCHAR(15) NOT NULL,
    [actiondate] DATETIME NOT NULL,
    [host] VARCHAR(20) NULL,
    [ipAddress] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SCCS_deletecontrolclients_tempupload
-- --------------------------------------------------
CREATE TABLE [dbo].[SCCS_deletecontrolclients_tempupload]
(
    [party_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip_master
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip_master]
(
    [scri_code] VARCHAR(50) NOT NULL,
    [exchange] VARCHAR(50) NULL,
    [scrip_symbol] VARCHAR(50) NOT NULL,
    [scrip_name] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL,
    [ISIN] VARCHAR(50) NOT NULL,
    [type] VARCHAR(50) NULL,
    [added_by] VARCHAR(50) NULL,
    [added_on] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip_master_bse_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip_master_bse_temp]
(
    [scri_code] VARCHAR(50) NULL,
    [exchange] VARCHAR(50) NULL,
    [scrip_symbol] VARCHAR(50) NULL,
    [scrip_name] VARCHAR(50) NULL,
    [b1] VARBINARY(50) NULL,
    [b2] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL,
    [b3] VARCHAR(50) NULL,
    [b4] VARCHAR(50) NULL,
    [b5] VARCHAR(50) NULL,
    [b6] VARCHAR(50) NULL,
    [b7] VARCHAR(50) NULL,
    [b8] VARCHAR(50) NULL,
    [b9] VARCHAR(50) NULL,
    [b10] VARCHAR(50) NULL,
    [b11] VARCHAR(50) NULL,
    [b12] VARCHAR(50) NULL,
    [ISIN] VARCHAR(50) NULL,
    [b13] VARCHAR(50) NULL,
    [b14] VARCHAR(50) NULL,
    [b15] VARCHAR(50) NULL,
    [b16] VARCHAR(50) NULL,
    [b17] VARCHAR(50) NULL,
    [b18] VARCHAR(50) NULL,
    [b19] VARCHAR(50) NULL,
    [b20] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip_master_history
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip_master_history]
(
    [scri_code] VARCHAR(50) NULL,
    [exchange] VARCHAR(50) NULL,
    [scrip_symbol] VARCHAR(50) NULL,
    [scrip_name] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL,
    [ISIN] VARCHAR(50) NULL,
    [type] VARCHAR(50) NULL,
    [added_by] VARCHAR(50) NULL,
    [added_on] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip_master_nse_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip_master_nse_temp]
(
    [nse_code] VARCHAR(50) NULL,
    [symbol] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL,
    [n1] VARCHAR(50) NULL,
    [n2] VARCHAR(50) NULL,
    [n3] VARCHAR(50) NULL,
    [n4] VARCHAR(50) NULL,
    [n5] VARCHAR(50) NULL,
    [n6] VARCHAR(50) NULL,
    [n7] VARCHAR(50) NULL,
    [n8] VARCHAR(50) NULL,
    [n9] VARCHAR(50) NULL,
    [n10] VARCHAR(50) NULL,
    [n11] VARCHAR(50) NULL,
    [n12] VARCHAR(50) NULL,
    [n13] VARCHAR(50) NULL,
    [n14] VARCHAR(50) NULL,
    [scrip_name] VARCHAR(50) NULL,
    [n15] VARCHAR(50) NULL,
    [n16] VARCHAR(50) NULL,
    [n17] VARCHAR(50) NULL,
    [n18] VARCHAR(50) NULL,
    [n19] VARCHAR(50) NULL,
    [n20] VARCHAR(50) NULL,
    [n21] VARCHAR(50) NULL,
    [n22] VARCHAR(50) NULL,
    [n23] VARCHAR(50) NULL,
    [n24] VARCHAR(50) NULL,
    [n25] VARCHAR(50) NULL,
    [n26] VARCHAR(50) NULL,
    [n27] VARCHAR(50) NULL,
    [n28] VARCHAR(50) NULL,
    [n29] VARCHAR(50) NULL,
    [n30] VARCHAR(50) NULL,
    [n31] VARCHAR(50) NULL,
    [n32] VARCHAR(50) NULL,
    [n33] VARCHAR(50) NULL,
    [n34] VARCHAR(50) NULL,
    [n35] VARCHAR(50) NULL,
    [n36] VARCHAR(50) NULL,
    [n37] VARCHAR(50) NULL,
    [n38] VARCHAR(50) NULL,
    [n39] VARCHAR(50) NULL,
    [n40] VARCHAR(50) NULL,
    [n41] VARCHAR(50) NULL,
    [n42] VARCHAR(50) NULL,
    [ISIN] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segment_09Feb2017
-- --------------------------------------------------
CREATE TABLE [dbo].[segment_09Feb2017]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segment_29Mar2016
-- --------------------------------------------------
CREATE TABLE [dbo].[segment_29Mar2016]
(
    [BSE] NVARCHAR(255) NULL,
    [NSE] NVARCHAR(255) NULL,
    [NSEFO] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [BSEFO] NVARCHAR(255) NULL,
    [mcd] NVARCHAR(255) NULL,
    [nsx] NVARCHAR(255) NULL,
    [bsx] NVARCHAR(255) NULL,
    [No] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segment_new
-- --------------------------------------------------
CREATE TABLE [dbo].[segment_new]
(
    [BSE] NVARCHAR(255) NULL,
    [NSE] NVARCHAR(255) NULL,
    [NSEFO] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [BSEFO] NVARCHAR(255) NULL,
    [No] NVARCHAR(255) NULL,
    [mcd] NVARCHAR(255) NULL,
    [nsx] NVARCHAR(255) NULL,
    [bsx] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments
-- --------------------------------------------------
CREATE TABLE [dbo].[segments]
(
    [BSE] NVARCHAR(255) NULL,
    [NSE] NVARCHAR(255) NULL,
    [NSEFO] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [BSEFO] NVARCHAR(255) NULL,
    [No] NVARCHAR(255) NULL,
    [mcd] NVARCHAR(255) NULL,
    [nsx] NVARCHAR(255) NULL,
    [bsx] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments_01072016
-- --------------------------------------------------
CREATE TABLE [dbo].[segments_01072016]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SEGMENTS_03Feb2017
-- --------------------------------------------------
CREATE TABLE [dbo].[SEGMENTS_03Feb2017]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments_16May2017
-- --------------------------------------------------
CREATE TABLE [dbo].[segments_16May2017]
(
    [BSE] NVARCHAR(255) NULL,
    [NSE] NVARCHAR(255) NULL,
    [NSEFO] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [BSEFO] NVARCHAR(255) NULL,
    [No] NVARCHAR(255) NULL,
    [mcd] NVARCHAR(255) NULL,
    [nsx] NVARCHAR(255) NULL,
    [bsx] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments_17May2017
-- --------------------------------------------------
CREATE TABLE [dbo].[segments_17May2017]
(
    [BSE] NVARCHAR(255) NULL,
    [NSE] NVARCHAR(255) NULL,
    [NSEFO] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [BSEFO] NVARCHAR(255) NULL,
    [No] NVARCHAR(255) NULL,
    [mcd] NVARCHAR(255) NULL,
    [nsx] NVARCHAR(255) NULL,
    [bsx] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments_21032016
-- --------------------------------------------------
CREATE TABLE [dbo].[segments_21032016]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL,
    [bsx] VARCHAR(1) NULL DEFAULT 'N'
);

GO

-- --------------------------------------------------
-- TABLE dbo.SEGMENTS14122011
-- --------------------------------------------------
CREATE TABLE [dbo].[SEGMENTS14122011]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SEGMENTS16122011
-- --------------------------------------------------
CREATE TABLE [dbo].[SEGMENTS16122011]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments24012012
-- --------------------------------------------------
CREATE TABLE [dbo].[segments24012012]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments240122012deleted
-- --------------------------------------------------
CREATE TABLE [dbo].[segments240122012deleted]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL,
    [mcd] VARCHAR(1) NOT NULL,
    [nsx] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.segments24062011
-- --------------------------------------------------
CREATE TABLE [dbo].[segments24062011]
(
    [BSE] VARCHAR(1) NULL,
    [NSE] VARCHAR(1) NULL,
    [NSEFO] VARCHAR(1) NULL,
    [MCX] VARCHAR(1) NULL,
    [NCDX] VARCHAR(1) NULL,
    [BSEFO] VARCHAR(1) NULL,
    [No] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Self_Auction_duplicate
-- --------------------------------------------------
CREATE TABLE [dbo].[Self_Auction_duplicate]
(
    [SPCODE] VARCHAR(50) NULL,
    [SPNAME] VARCHAR(50) NULL,
    [SBCODE] VARCHAR(50) NULL,
    [SSBCODE] VARCHAR(50) NULL,
    [SSNAME] VARCHAR(50) NULL,
    [SSCODE] VARCHAR(50) NULL,
    [S1] VARCHAR(50) NULL,
    [S2] VARCHAR(50) NULL,
    [SAQTY] VARCHAR(50) NULL,
    [REMARKS] VARCHAR(50) NULL,
    [SETTNO] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sheet1$
-- --------------------------------------------------
CREATE TABLE [dbo].[Sheet1$]
(
    [Holdingdatetime] NVARCHAR(255) NULL,
    [Clientid] NVARCHAR(255) NULL,
    [Bankid] NVARCHAR(255) NULL,
    [Isin] NVARCHAR(255) NULL,
    [Sc_isinname] NVARCHAR(255) NULL,
    [Pledgeorder] FLOAT NULL,
    [Pledgedate] NVARCHAR(255) NULL,
    [Pledgeqty] FLOAT NULL,
    [Unpledgeqty] FLOAT NULL,
    [Balance] FLOAT NULL,
    [Oldpsn_corp] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sheet12909$
-- --------------------------------------------------
CREATE TABLE [dbo].[sheet12909$]
(
    [Ro Code] NVARCHAR(255) NULL,
    [Branch Code] NVARCHAR(255) NULL,
    [Family Code] NVARCHAR(255) NULL,
    [Client Code] NVARCHAR(255) NULL,
    [Client Name] NVARCHAR(255) NULL,
    [Ledger Balance] FLOAT NULL,
    [Collateral] FLOAT NULL,
    [Span Margin] FLOAT NULL,
    [Shortfall] FLOAT NULL,
    [% Of Penalty] FLOAT NULL,
    [Penalty Amount] FLOAT NULL,
    [Span Margin1] FLOAT NULL,
    [Shortfall1] FLOAT NULL,
    [% Of Penalty1] FLOAT NULL,
    [Penalty Amount1] FLOAT NULL,
    [Span Margin2] FLOAT NULL,
    [Shortfall2] FLOAT NULL,
    [% Of Penalty2] FLOAT NULL,
    [Penalty Amount2] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Shortage
-- --------------------------------------------------
CREATE TABLE [dbo].[Shortage]
(
    [PartyCode] VARCHAR(50) NULL,
    [Branch] VARCHAR(50) NULL,
    [Region] VARCHAR(50) NULL,
    [SBTag] VARCHAR(50) NULL,
    [NCM_Val] VARCHAR(50) NULL,
    [NCM_Val_HC] VARCHAR(50) NULL,
    [BF_Val] VARCHAR(50) NULL,
    [DayBuy_1] VARCHAR(50) NULL,
    [DaySell_1] VARCHAR(50) NULL,
    [DayBuy_2] VARCHAR(50) NULL,
    [DaySell_2] VARCHAR(50) NULL,
    [LedgerBalance] VARCHAR(50) NULL,
    [CallExcess] VARCHAR(50) NULL,
    [MarginShortage] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sify_Return_fin
-- --------------------------------------------------
CREATE TABLE [dbo].[Sify_Return_fin]
(
    [party_code] VARCHAR(15) NULL,
    [Udate] DATETIME NULL,
    [Status] VARCHAR(40) NULL,
    [UploadDt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sify_Return_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Sify_Return_temp]
(
    [party_code] VARCHAR(15) NULL,
    [Udate] VARCHAR(25) NULL,
    [Status] VARCHAR(40) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sify_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Sify_temp]
(
    [party_code] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sifyupload
-- --------------------------------------------------
CREATE TABLE [dbo].[sifyupload]
(
    [party_code] VARCHAR(30) NULL,
    [entry_date] DATETIME NULL,
    [entry_by] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sifyupload_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[sifyupload_temp]
(
    [party_code] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SIP_Error
-- --------------------------------------------------
CREATE TABLE [dbo].[SIP_Error]
(
    [ErrID] INT NOT NULL,
    [ErrTime] DATETIME NULL,
    [ErrObject] VARCHAR(8000) NULL,
    [ErrLine] INT NULL,
    [ErrMessage] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SIP_Mandate_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[SIP_Mandate_temp]
(
    [MANDATEID] VARCHAR(50) NULL,
    [CLIENTCODE] VARCHAR(255) NULL,
    [CLIENNAME] VARCHAR(255) NULL,
    [STARDATE] VARCHAR(255) NULL,
    [ENDDATE] VARCHAR(255) NULL,
    [AMOUNT] VARCHAR(50) NULL,
    [MODE] VARCHAR(255) NULL,
    [BANKNAME] VARCHAR(255) NULL,
    [BANKBRANCH] VARCHAR(255) NULL,
    [ACCOUNTNUMBER] VARCHAR(255) NULL,
    [ACCOUNTTYPE] VARCHAR(255) NULL,
    [MICRNUMBER] VARCHAR(255) NULL,
    [STATUS] VARCHAR(255) NULL,
    [AGENCYREMARKS] VARCHAR(255) NULL,
    [REGNDATE] VARCHAR(50) NULL,
    [MEMBERCODE] VARCHAR(50) NULL,
    [nodata] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SIP_Registration_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[SIP_Registration_temp]
(
    [Status] VARCHAR(50) NULL,
    [MemberCode] VARCHAR(50) NULL,
    [ClientCode] VARCHAR(50) NULL,
    [CliName] VARCHAR(MAX) NULL,
    [InternalRefNo] VARCHAR(50) NULL,
    [XSIPREGNNO] VARCHAR(50) NULL,
    [XSIPRegDate] VARCHAR(50) NULL,
    [AMCName] VARCHAR(MAX) NULL,
    [RTASchemeCode] VARCHAR(MAX) NULL,
    [SchemeName] VARCHAR(MAX) NULL,
    [FrequencyType] VARCHAR(20) NULL,
    [StartDate] VARCHAR(50) NULL,
    [EndDate] VARCHAR(50) NULL,
    [InstallmentAmt] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [EntryBy] VARCHAR(15) NULL,
    [BSEMandateId] VARCHAR(7) NULL,
    [SubbrCode] VARCHAR(15) NULL,
    [EUINNo] VARCHAR(10) NULL,
    [EUINDECL] VARCHAR(50) NULL,
    [FirstOrder] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SIP_Scheme_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[SIP_Scheme_temp]
(
    [AMCCode] VARCHAR(50) NULL,
    [AMCName] VARCHAR(50) NULL,
    [SchemeCode] VARCHAR(50) NULL,
    [SchemeName] VARCHAR(500) NULL,
    [SIPTransMode] VARCHAR(10) NULL,
    [SIPFrequency] VARCHAR(50) NULL,
    [SIPDates] VARCHAR(50) NULL,
    [SIPMinGap] VARCHAR(50) NULL,
    [SIPMaxGap] VARCHAR(50) NULL,
    [SIPInstallmentGap] VARCHAR(50) NULL,
    [SIPStatus] VARCHAR(50) NULL,
    [SIPMinInstallAmt] VARCHAR(50) NULL,
    [SIPMaxInstallAmt] VARCHAR(50) NULL,
    [SIPMultiplierAmt] VARCHAR(50) NULL,
    [SIPMinInstallNo] VARCHAR(50) NULL,
    [SIPMaxInstallNo] VARCHAR(50) NULL,
    [SchemeISIN] VARCHAR(50) NULL,
    [SchemeType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SQOF_ODIN_CLT_MAP
-- --------------------------------------------------
CREATE TABLE [dbo].[SQOF_ODIN_CLT_MAP]
(
    [Odin] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL,
    [statusofclient] VARCHAR(15) NULL,
    [segment] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SQOF_ODIN_CLT_MAP_ACTIVATION
-- --------------------------------------------------
CREATE TABLE [dbo].[SQOF_ODIN_CLT_MAP_ACTIVATION]
(
    [Odin] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL,
    [statusofclient] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SQOF_ODIN_CLT_MAP30122011
-- --------------------------------------------------
CREATE TABLE [dbo].[SQOF_ODIN_CLT_MAP30122011]
(
    [Odin] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL,
    [statusofclient] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.srv_log
-- --------------------------------------------------
CREATE TABLE [dbo].[srv_log]
(
    [pcode] VARCHAR(500) NULL,
    [IP1] VARCHAR(500) NULL,
    [IP2] VARCHAR(500) NULL,
    [path] VARCHAR(500) NULL,
    [server] VARCHAR(100) NULL,
    [upload_date] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.StockData
-- --------------------------------------------------
CREATE TABLE [dbo].[StockData]
(
    [ItemID] VARCHAR(50) NULL,
    [Qty] FLOAT NULL,
    [LastModified] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.symbolchange
-- --------------------------------------------------
CREATE TABLE [dbo].[symbolchange]
(
    [SYMB_COMPANY_NAME] NVARCHAR(50) NULL,
    [ SM_KEY_SYMBOL] NVARCHAR(50) NULL,
    [ SM_NEW_SYMBOL] NVARCHAR(50) NULL,
    [ SM_APPLICABLE_FROM] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.t
-- --------------------------------------------------
CREATE TABLE [dbo].[t]
(
    [Group Id] NVARCHAR(255) NULL,
    [User Id] NVARCHAR(255) NULL,
    [Client] NVARCHAR(255) NULL,
    [Exchange] NVARCHAR(255) NULL,
    [Instrument Type] NVARCHAR(255) NULL,
    [B/S] NVARCHAR(255) NULL,
    [Reason] NVARCHAR(255) NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Ser/Exp] NVARCHAR(255) NULL,
    [Symbol] NVARCHAR(255) NULL,
    [Quantity] FLOAT NULL,
    [Price] FLOAT NULL,
    [Option Type] NVARCHAR(255) NULL,
    [Scrip Name] NVARCHAR(255) NULL,
    [Code] FLOAT NULL,
    [Strike Price] NVARCHAR(255) NULL,
    [Request Type] NVARCHAR(255) NULL,
    [Trader Id] FLOAT NULL,
    [Pro/Cli] NVARCHAR(255) NULL,
    [Order Type] NVARCHAR(255) NULL,
    [O/C] NVARCHAR(255) NULL,
    [U/V] NVARCHAR(255) NULL,
    [User Remarks] NVARCHAR(255) NULL,
    [Status] NVARCHAR(255) NULL,
    [Order No] FLOAT NULL,
    [Product Type] NVARCHAR(255) NULL,
    [Date/Time] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tagstatus
-- --------------------------------------------------
CREATE TABLE [dbo].[tagstatus]
(
    [TAG] VARCHAR(255) NULL,
    [AppDate] VARCHAR(255) NULL,
    [Appstatus] VARCHAR(255) NULL,
    [statusdate] VARCHAR(255) NULL,
    [SEBIRegNo] VARCHAR(255) NULL,
    [constitution] VARCHAR(255) NULL,
    [CSoRemarks] VARCHAR(4000) NULL,
    [exchRemark] VARCHAR(4000) NULL,
    [APPAuthorised_person] VARCHAR(255) NULL,
    [EST] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_2FactorCli_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_2FactorCli_Temp]
(
    [UserID] VARCHAR(20) NULL,
    [Group_ID] VARCHAR(20) NULL,
    [Token] VARCHAR(20) NULL,
    [Vendor] INT NULL,
    [ApplicationAllowed] INT NULL,
    [LoginLevel] INT NULL,
    [TransactionLevel] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_add_new_client
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_add_new_client]
(
    [party_code] VARCHAR(15) NULL,
    [server] VARCHAR(25) NULL,
    [product] VARCHAR(45) NULL,
    [flag] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Ageing_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Ageing_temp]
(
    [Segment] VARCHAR(10) NULL,
    [Code] VARCHAR(10) NULL,
    [BALANCE] VARCHAR(10) NULL,
    [SECURITY] VARCHAR(10) NULL,
    [PROVISION] VARCHAR(10) NULL,
    [NetofProvision] VARCHAR(10) NULL,
    [SECURED] VARCHAR(10) NULL,
    [UNSECURED] VARCHAR(10) NULL,
    [DIFFERENCE] VARCHAR(10) NULL,
    [ClosingBalance] VARCHAR(10) NULL,
    [0-29Days] VARCHAR(10) NULL,
    [31-60Days] VARCHAR(10) NULL,
    [61-90Days] VARCHAR(10) NULL,
    [91-180Days] VARCHAR(10) NULL,
    [181-360Days] VARCHAR(10) NULL,
    [361daysPlus] VARCHAR(10) NULL,
    [MoreThan6Months] VARCHAR(10) NULL,
    [Debtors>6MonthsSecured] VARCHAR(10) NULL,
    [Debtors>6MonthUnsecured] VARCHAR(10) NULL,
    [BalanceSecurity] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Ariel
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Ariel]
(
    [Code] NVARCHAR(50) NULL,
    [City] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Ariel_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Ariel_1]
(
    [Client_Code] NVARCHAR(50) NULL,
    [Region] NVARCHAR(50) NULL,
    [branch_cd] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_AutomationFileUpload
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_AutomationFileUpload]
(
    [Upd_Srno] BIGINT NULL,
    [Upd_Title] VARCHAR(100) NULL,
    [Upd_TempTable] VARCHAR(100) NULL,
    [Upd_deli] VARCHAR(10) NULL,
    [Upd_FirstRow] INT NULL,
    [Upd_FinSP] VARCHAR(100) NULL,
    [FileN] VARCHAR(2000) NULL,
    [Upd_Extension] VARCHAR(100) NULL,
    [Upd_info] VARCHAR(200) NULL,
    [CreatedOn] DATETIME NOT NULL,
    [CreatedBy] VARCHAR(10) NULL,
    [ModifiedOn] DATETIME NULL,
    [ModifiedBy] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Axis_Bank
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Axis_Bank]
(
    [Fld_id] VARCHAR(5) NULL,
    [Fld_Party_Code] VARCHAR(25) NULL,
    [Fld_Date] VARCHAR(11) NULL,
    [Fld_Narration] VARCHAR(50) NULL,
    [Fld_DrCr] VARCHAR(5) NULL,
    [Fld_Amt] VARCHAR(25) NULL,
    [Fld_Bal] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BankAxis_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BankAxis_Temp]
(
    [AccounNO] NVARCHAR(50) NULL,
    [Balance] MONEY NULL,
    [Narration] NVARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_block
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_block]
(
    [chcode] VARCHAR(20) NULL,
    [Blocked] VARCHAR(1) NULL,
    [Reason] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_BLOCK_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_BLOCK_hist]
(
    [chcode] VARCHAR(20) NULL,
    [Blocked] VARCHAR(1) NULL,
    [Reason] VARCHAR(500) NULL,
    [updatedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Branch_Code
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Branch_Code]
(
    [Fld_Branch_Code] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Bse scrip
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Bse scrip]
(
    [CL_CODE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Bse_scrip_04052024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Bse_scrip_04052024]
(
    [100112] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_BseDPJV
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_BseDPJV]
(
    [BSE] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_BSEFO_MISMATCH
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_BSEFO_MISMATCH]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [ProductCode] VARCHAR(50) NULL,
    [AssetCode] VARCHAR(50) NULL,
    [termID] INT NULL,
    [ClientCode] VARCHAR(15) NULL,
    [branch_cd] VARCHAR(25) NULL,
    [RPT_TYPE] VARCHAR(50) NULL,
    [REMARKS] VARCHAR(500) NULL,
    [Updated_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_bulk_PayinPayout
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_bulk_PayinPayout]
(
    [Fld_AngelId] VARCHAR(20) NULL,
    [Fld_Exchange] VARCHAR(10) NULL,
    [Fld_Client_Code] VARCHAR(25) NULL,
    [Fld_Dp_ID] VARCHAR(16) NULL,
    [Fld_Date] VARCHAR(11) NULL,
    [Fld_ScripCode] VARCHAR(20) NULL,
    [Fld_ScripName] VARCHAR(50) NULL,
    [Fld_Qty] VARCHAR(20) NULL,
    [Fld_Narration] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_call_trade_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_call_trade_temp]
(
    [Sr_No] INT IDENTITY(1,1) NOT NULL,
    [Client_Id] VARCHAR(50) NULL,
    [Product_Id] INT NULL,
    [From_Date] DATETIME NULL,
    [To_Date] DATETIME NULL,
    [Flag] CHAR(1) NULL,
    [Entry_By] VARCHAR(50) NULL,
    [Amount] VARCHAR(50) NULL,
    [Remark] VARCHAR(200) NULL,
    [ReqDate] DATETIME NULL,
    [Type] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_clientbulkupload
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_clientbulkupload]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [ClientNo] VARCHAR(100) NULL,
    [DispatchDate] DATETIME NULL,
    [DistinationName] VARCHAR(200) NULL,
    [ClientID] VARCHAR(20) NULL,
    [ClientName] VARCHAR(150) NULL,
    [PinCode] NUMERIC(18, 0) NULL,
    [Date] DATETIME NOT NULL DEFAULT (getdate() - 30)
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_clientbulkupload_record
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_clientbulkupload_record]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [ClientNo] VARCHAR(100) NULL,
    [DispatchDate] DATETIME NULL,
    [DistinationName] VARCHAR(200) NULL,
    [ClientID] VARCHAR(20) NULL,
    [ClientName] VARCHAR(150) NULL,
    [PinCode] NUMERIC(18, 0) NULL,
    [Date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_clientdata
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_clientdata]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [Branch_cd] VARCHAR(25) NULL,
    [Sub_broker] VARCHAR(25) NULL,
    [ClientCode] VARCHAR(15) NULL,
    [ClientName] VARCHAR(150) NULL,
    [EmailID] VARCHAR(150) NULL,
    [Mobile1] NUMERIC(18, 0) NULL,
    [ResPhone1] VARCHAR(15) NULL,
    [TelCaller] VARCHAR(20) NULL,
    [Code1] VARCHAR(20) NULL,
    [Remark1] VARCHAR(500) NULL,
    [MinorChangeID] VARCHAR(150) NULL,
    [NewID] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_clientdata_record
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_clientdata_record]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [Branch_cd] VARCHAR(25) NULL,
    [Sub_broker] VARCHAR(25) NULL,
    [ClientCode] VARCHAR(15) NULL,
    [ClientName] VARCHAR(150) NULL,
    [EmailID] VARCHAR(150) NULL,
    [Mobile1] NUMERIC(18, 0) NULL,
    [ResPhone1] VARCHAR(15) NULL,
    [TelCaller] VARCHAR(20) NULL,
    [Code1] VARCHAR(20) NULL,
    [Remark1] VARCHAR(500) NULL,
    [MinorChangeID] VARCHAR(150) NULL,
    [NewID] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Closed
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Closed]
(
    [party_code] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CMSMails_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CMSMails_Log]
(
    [party_code] VARCHAR(10) NULL,
    [bse] MONEY NULL,
    [nse] MONEY NULL,
    [fo] MONEY NULL,
    [ncdx] MONEY NULL,
    [mcx] MONEY NULL,
    [bse1] MONEY NULL,
    [nse1] MONEY NULL,
    [fo1] MONEY NULL,
    [ncdx1] MONEY NULL,
    [mcx1] MONEY NULL,
    [Tot1] MONEY NULL,
    [Tot2] MONEY NULL,
    [email] VARCHAR(50) NULL,
    [long_name] VARCHAR(100) NULL,
    [updatedon] DATETIME NULL,
    [mobile_pager] VARCHAR(40) NULL,
    [Updated_Date] DATETIME NOT NULL,
    [EmpCode] VARCHAR(20) NULL,
    [mcd] MONEY NULL,
    [nsx] MONEY NULL,
    [mcd1] MONEY NULL,
    [nsx1] MONEY NULL,
    [PayType] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Col_data
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Col_data]
(
    [Fld_Party_Code] VARCHAR(15) NULL,
    [scrip_cd] VARCHAR(15) NULL,
    [Fld_Qty] INT NULL,
    [Fld_Cash_Margin] MONEY NULL,
    [Fld_Cl_Rate] MONEY NULL,
    [Fld_Hair_Cut] INT NULL,
    [Fld_open_Position] INT NULL,
    [Fld_BF_Qty] INT NULL,
    [Fld_Remark] VARCHAR(10) NULL,
    [Fld_NCM_Qty] INT NULL,
    [Fld_NCM_Value] MONEY NULL,
    [Fld_BF_Value] MONEY NULL,
    [Fld_NCM_Value_After_HairCut] MONEY NULL,
    [Fld_BF_Value_After_HairCut] MONEY NULL,
    [Fld_Net] INT NULL,
    [Fld_Buy_Sell] VARCHAR(2) NULL,
    [Fld_Day_Value] MONEY NULL,
    [Fld_Day_Value_After_Haircut] MONEY NULL,
    [Fld_Second_Net] INT NULL,
    [Fld_Second_Buy_Sell] VARCHAR(2) NULL,
    [Fld_Second_Day_Value] MONEY NULL,
    [Fld_Second_Day_Value_After_Haircut] MONEY NULL,
    [Fld_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_collateral_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_collateral_upload]
(
    [Fld_Party_Code] VARCHAR(15) NULL,
    [Fld_Scrip_Code] VARCHAR(20) NULL,
    [Fld_Qty] VARCHAR(20) NULL,
    [Fld_Cash_Margin] VARCHAR(50) NULL,
    [Fld_Hair_Cut] VARCHAR(50) NULL,
    [Fld_Isin] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Comm_HIST
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Comm_HIST]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [vdt] VARCHAR(20) NULL,
    [Segment] VARCHAR(4) NOT NULL,
    [Fld_Date] DATETIME NOT NULL,
    [Branch_cd] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Comm_insp__HIST
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Comm_insp__HIST]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [vdt] VARCHAR(20) NULL,
    [Segment] VARCHAR(4) NOT NULL,
    [Fld_Date] DATETIME NOT NULL,
    [Branch_cd] VARCHAR(15) NULL,
    [upd_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Comm_insp__Mails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Comm_insp__Mails]
(
    [Fld_Msg] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Comm_insp__Mails_Branch
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Comm_insp__Mails_Branch]
(
    [Fld_SrNo] INT IDENTITY(1,1) NOT NULL,
    [Fld_Br_Code] VARCHAR(15) NULL,
    [Fld_Email] VARCHAR(2000) NULL,
    [Status] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Comm_insp__Mails_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Comm_insp__Mails_hist]
(
    [Fld_Msg] VARCHAR(500) NULL,
    [upd_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Comm_Mails
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Comm_Mails]
(
    [Fld_Msg] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Comm_Mails_Branch
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Comm_Mails_Branch]
(
    [Fld_SrNo] INT IDENTITY(1,1) NOT NULL,
    [Fld_Br_Code] VARCHAR(15) NULL,
    [Fld_Email] VARCHAR(2000) NULL,
    [Status] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ControlFileClientLetter
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ControlFileClientLetter]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [Branch_cd] VARCHAR(25) NULL,
    [Sub_Broker] VARCHAR(25) NULL,
    [ClientCode] VARCHAR(15) NULL,
    [ClientName] VARCHAR(50) NULL,
    [ClientAddress] VARCHAR(400) NULL,
    [PinCode] VARCHAR(15) NULL,
    [Mobile] NUMERIC(18, 0) NULL,
    [ResPhone] NUMERIC(18, 0) NULL,
    [TCName] VARCHAR(50) NULL,
    [Code] VARCHAR(50) NULL,
    [Remark] VARCHAR(500) NULL,
    [MinorChangeAddress] VARCHAR(700) NULL,
    [ChangeAddress] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ControlFileClientLetter_record
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ControlFileClientLetter_record]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [Branch_cd] VARCHAR(25) NULL,
    [Sub_Broker] VARCHAR(25) NULL,
    [ClientCode] VARCHAR(15) NULL,
    [ClientName] VARCHAR(50) NULL,
    [ClientAddress] VARCHAR(400) NULL,
    [PinCode] VARCHAR(15) NULL,
    [Mobile] NUMERIC(18, 0) NULL,
    [ResPhone] NUMERIC(18, 0) NULL,
    [TCName] VARCHAR(50) NULL,
    [Code] VARCHAR(50) NULL,
    [Remark] VARCHAR(500) NULL,
    [MinorChangeAddress] VARCHAR(700) NULL,
    [ChangeAddress] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_BNG5_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_BNG5_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_BNG5_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_BNG5_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_BNGCOM_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_BNGCOM_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(1000) NULL,
    [Description] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_BNGCOM_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_BNGCOM_failed]
(
    [F1] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CTCL_BULKUPD
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CTCL_BULKUPD]
(
    [SRNO] INT NOT NULL,
    [SEGMENT] VARCHAR(100) NULL,
    [CTCL_SERVER] VARCHAR(100) NULL,
    [SBTAG] VARCHAR(10) NULL,
    [ODIN_ID] VARCHAR(10) NULL,
    [CTCLID] VARCHAR(20) NULL,
    [FIRST_NAME] VARCHAR(50) NULL,
    [Middle_Name] VARCHAR(50) NULL,
    [LAST_NAME] VARCHAR(50) NULL,
    [Nature_of_Office] VARCHAR(50) NULL,
    [Certificate_Base] VARCHAR(100) NULL,
    [VALIDUPTO] VARCHAR(50) NULL,
    [DOB] VARCHAR(50) NULL,
    [Nature_of_Payment] VARCHAR(20) NULL,
    [ResiAddress1] VARCHAR(100) NULL,
    [ResiAddress2] VARCHAR(100) NULL,
    [ResiAddress3] VARCHAR(100) NULL,
    [City] VARCHAR(50) NULL,
    [State] VARCHAR(50) NULL,
    [PinCode] NUMERIC(10, 0) NULL,
    [Pan_No] VARCHAR(15) NULL,
    [EmpCode] VARCHAR(10) NULL,
    [Mode_of_connectivity] VARCHAR(15) NULL,
    [Activation_Date] VARCHAR(20) NULL,
    [USER_RELATIONSHIP] VARCHAR(30) NULL,
    [Remarks] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_chatmsg1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_chatmsg1]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(15) NULL,
    [Description] VARCHAR(500) NULL,
    [EmpCode] VARCHAR(15) NULL,
    [Entrydate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CHEN12_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CHEN12_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CHEN12_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CHEN12_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CS019_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CS019_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO_15_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO_15_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO_15_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO_15_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(500) NULL,
    [Description] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO10_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO10_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO10_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO10_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO13_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO13_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO15_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO15_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(15) NULL,
    [Description] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO15_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO15_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO16_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO16_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO18_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO18_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO18_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO18_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO19_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO19_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO19_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO19_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO20_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO20_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO24_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO24_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO25_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO25_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO25_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO25_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO28_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO28_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO30_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO30_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(15) NULL,
    [Description] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO30_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO30_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO32_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO32_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO34_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO34_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO35_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO35_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO38_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO38_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO41_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO41_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO44_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO44_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO44_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO44_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO48_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO48_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO48_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO48_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO65_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO65_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO69_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO69_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO69_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO69_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO90_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO90_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO90_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO90_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO94_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO94_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO94_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO94_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO97_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO97_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO97_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO97_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO98_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO98_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSO98_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSO98_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSP97_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSP97_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(50) NULL,
    [Description] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_CSP97_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_CSP97_failed]
(
    [Group Id] NVARCHAR(255) NULL,
    [User Id] NVARCHAR(255) NULL,
    [Exchange] NVARCHAR(255) NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Ser/Exp] NVARCHAR(255) NULL,
    [Strike Price] NVARCHAR(255) NULL,
    [Option Type] NVARCHAR(255) NULL,
    [Symbol] NVARCHAR(255) NULL,
    [Client] NVARCHAR(255) NULL,
    [B/S] NVARCHAR(255) NULL,
    [Price] FLOAT NULL,
    [Quantity] FLOAT NULL,
    [Reason] NVARCHAR(255) NULL,
    [Scrip Name] NVARCHAR(255) NULL,
    [Request Type] NVARCHAR(255) NULL,
    [Order Type] NVARCHAR(255) NULL,
    [O/C] NVARCHAR(255) NULL,
    [U/V] NVARCHAR(255) NULL,
    [Order No] FLOAT NULL,
    [Status] NVARCHAR(255) NULL,
    [User Remarks] NVARCHAR(255) NULL,
    [Product Type] NVARCHAR(255) NULL,
    [Code] FLOAT NULL,
    [Trader Id] NVARCHAR(255) NULL,
    [Date/Time] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_DEL10_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_DEL10_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_DEL10_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_DEL10_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_DEL15_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_DEL15_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_failed]
(
    [User Id] NVARCHAR(2000) NULL,
    [Client] NVARCHAR(2000) NULL,
    [Pro/Cli] NVARCHAR(2000) NULL,
    [Order Type] NVARCHAR(2000) NULL,
    [B/S] NVARCHAR(2000) NULL,
    [Group Id] NVARCHAR(2000) NULL,
    [Exchange] NVARCHAR(2000) NULL,
    [Quantity] FLOAT NULL,
    [Price] FLOAT NULL,
    [Strike Price] NVARCHAR(2000) NULL,
    [Ser/Exp] NVARCHAR(2000) NULL,
    [Scrip Name] NVARCHAR(2000) NULL,
    [Status] NVARCHAR(2000) NULL,
    [Reason] NVARCHAR(2000) NULL,
    [Product Type] NVARCHAR(2000) NULL,
    [Date/Time] NVARCHAR(2000) NULL,
    [B/S1] NVARCHAR(2000) NULL,
    [O/C] NVARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_failed1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_failed1]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_HYD3_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_HYD3_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_HYD3_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_HYD3_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_INDO5_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_INDO5_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_INDO5_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_INDO5_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_JAIP15_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_JAIP15_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_JAIP15_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_JAIP15_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_KOLK5_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_KOLK5_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_KOLK5_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_KOLK5_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_luck_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_luck_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_LUCK10_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_LUCK10_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_LUCK10_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_LUCK10_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_NAGPR8_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_NAGPR8_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_NAGPR8_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_NAGPR8_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_RAJ1_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_RAJ1_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_RAJ1_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_RAJ1_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_RAJ11_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_RAJ11_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_RAJ15_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_RAJ15_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_RAJ15_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_RAJ15_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_REG_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_REG_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_TB186_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_TB186_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_TB186_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_TB186_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_VD5_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_VD5_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_VD5_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_VD5_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_VKPT5_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_VKPT5_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_VKPT5_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_VKPT5_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_XPU3_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_XPU3_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_XPU3_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_XPU3_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_XS155_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_XS155_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_XS155_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_XS155_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA10_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA10_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA10_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA10_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA21_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA21_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA21_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA21_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA8_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA8_chatmsg]
(
    [Col1] VARCHAR(500) NULL,
    [Col2] VARCHAR(500) NULL,
    [Col3] VARCHAR(500) NULL,
    [Col4] VARCHAR(5000) NULL,
    [Description] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA8_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA8_failed]
(
    [User Id] NVARCHAR(4000) NULL,
    [Client] NVARCHAR(4000) NULL,
    [Reason] NVARCHAR(4000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA8ANAND_chatmsg
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA8ANAND_chatmsg]
(
    [Col1] VARCHAR(15) NULL,
    [Col2] VARCHAR(50) NULL,
    [Col3] VARCHAR(50) NULL,
    [Col4] VARCHAR(15) NULL,
    [Description] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ctcl_YA8ANAND_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ctcl_YA8ANAND_failed]
(
    [User Id] NVARCHAR(255) NULL,
    [Client] NVARCHAR(255) NULL,
    [Reason] NVARCHAR(255) NULL,
    [Exchange] NVARCHAR(255) NULL,
    [Instrument Type] NVARCHAR(255) NULL,
    [B/S] NVARCHAR(255) NULL,
    [Quantity] FLOAT NULL,
    [Symbol] NVARCHAR(255) NULL,
    [Trader Id] FLOAT NULL,
    [Instrument Name] NVARCHAR(255) NULL,
    [Code] FLOAT NULL,
    [Ser/Exp] DATETIME NULL,
    [Group Id] NVARCHAR(255) NULL,
    [Scrip Name] NVARCHAR(255) NULL,
    [Strike Price] FLOAT NULL,
    [Option Type] NVARCHAR(255) NULL,
    [Request Type] NVARCHAR(255) NULL,
    [Pro/Cli] NVARCHAR(255) NULL,
    [Order Type] NVARCHAR(255) NULL,
    [O/C] NVARCHAR(255) NULL,
    [U/V] NVARCHAR(255) NULL,
    [Price] FLOAT NULL,
    [Order No] FLOAT NULL,
    [Status] NVARCHAR(255) NULL,
    [User Remarks] NVARCHAR(255) NULL,
    [Product Type] NVARCHAR(255) NULL,
    [Date/Time] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_deleteRepliCTCLid
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_deleteRepliCTCLid]
(
    [fld_RecordNo] INT NOT NULL,
    [fld_DisableReason] VARCHAR(100) NULL,
    [fld_server] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_deleteRepliCTCLid_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_deleteRepliCTCLid_BSE]
(
    [fld_RecordNo] INT NOT NULL,
    [fld_DisableReason] VARCHAR(100) NULL,
    [fld_server] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_DNC
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_DNC]
(
    [Fld_C_INDEX] VARCHAR(100) NULL,
    [Fld_LAN_LIN_1] VARCHAR(10) NULL,
    [Fld_LAN_LIN_2] VARCHAR(10) NULL,
    [Fld_MOB_NUM_1] VARCHAR(10) NULL,
    [Fld_MOB_NUM_2] VARCHAR(10) NULL,
    [Fld_CUS_CTY] VARCHAR(10) NULL,
    [Fld_LAN_STD_1] VARCHAR(10) NULL,
    [Fld_LAN_STD_2] VARCHAR(10) NULL,
    [Fld_EMAIL_1] VARCHAR(10) NULL,
    [Fld_EMAIL_2] VARCHAR(10) NULL,
    [Fld_PIN_COD] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_DNC_File
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_DNC_File]
(
    [Fld_Msg] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ECN
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ECN]
(
    [Fld_File] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ecn_dpid
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ecn_dpid]
(
    [Fld_File] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ecn_new
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ecn_new]
(
    [FLd_File] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_email_Bounce_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_email_Bounce_Log]
(
    [party_code] NVARCHAR(255) NULL,
    [email] NVARCHAR(255) NULL,
    [Director_name] NVARCHAR(255) NULL,
    [repatriat_bank_ac_no] NVARCHAR(255) NULL,
    [introducer_relation] NVARCHAR(255) NULL,
    [ecnflag] NVARCHAR(255) NULL,
    [party_code2] NVARCHAR(255) NULL,
    [Remark ] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_exchange_details_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_exchange_details_temp]
(
    [emp_name] VARCHAR(100) NULL,
    [emp_type] VARCHAR(50) NULL,
    [emp_designation] VARCHAR(100) NULL,
    [emp_alias] VARCHAR(100) NULL,
    [emp_emailid] VARCHAR(100) NULL,
    [emp_office] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_exchange_details_temp_bak
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_exchange_details_temp_bak]
(
    [emp_name] VARCHAR(50) NULL,
    [emp_type] VARCHAR(50) NULL,
    [emp_designation] VARCHAR(100) NULL,
    [emp_alias] VARCHAR(50) NULL,
    [emp_emailid] VARCHAR(50) NULL,
    [emp_office] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_FailedCodes
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_FailedCodes]
(
    [Client] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Fileprocess
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Fileprocess]
(
    [ProcessDate] DATETIME NULL,
    [FileId] INT NULL,
    [ProcessStartAt] DATETIME NULL,
    [FileName] VARCHAR(200) NULL,
    [FileRowCount] INT NULL,
    [ProcessEndAt] DATETIME NULL,
    [ProcessStatus] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_FileprocessHist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_FileprocessHist]
(
    [ProcessDate] DATETIME NULL,
    [FileId] INT NULL,
    [ProcessStartAt] DATETIME NULL,
    [FileName] VARCHAR(200) NULL,
    [FileRowCount] INT NULL,
    [ProcessEndAt] DATETIME NULL,
    [ProcessStatus] INT NULL,
    [HistDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_gen_odin_file
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_gen_odin_file]
(
    [Fld_gen] VARCHAR(100) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_gen_odin_file_New
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_gen_odin_file_New]
(
    [Fld_gen] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_GEN_ODIN_FILE_NEW_Archived
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_GEN_ODIN_FILE_NEW_Archived]
(
    [Fld_gen] VARCHAR(8000) NULL,
    [Fld_Date] DATETIME NULL,
    [Fld_Server] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Holding_Data
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Holding_Data]
(
    [Fld_Party_Code] VARCHAR(15) NULL,
    [Fld_Current_Holding] MONEY NULL,
    [Fld_Holding_After_Haircut] MONEY NULL,
    [Fld_Total_Amt] MONEY NULL,
    [Fld_Day_Value_AfterHaircut] MONEY NULL,
    [Fld_Logical_LedBal] MONEY NULL,
    [Fld_CallExcess_Shortage] MONEY NULL,
    [Fld_Margin_Maintain] MONEY NULL,
    [Fld_Net_BuySell] MONEY NULL,
    [Fld_Datetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_HoldingShifting_Codes
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_HoldingShifting_Codes]
(
    [Fld_SrNo] INT IDENTITY(1,1) NOT NULL,
    [Fld_FromCode] VARCHAR(11) NULL,
    [Fld_ToCode] VARCHAR(11) NULL,
    [Fld_Segment] VARCHAR(11) NULL,
    [Fld_Flag] VARCHAR(1) NULL,
    [Fld_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_hr_pnddoc
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_hr_pnddoc]
(
    [Fld_Emp_No] VARCHAR(50) NULL,
    [Fld_Emp_Name] VARCHAR(150) NULL,
    [Fld_Designation] VARCHAR(150) NULL,
    [Fld_Dept] VARCHAR(150) NULL,
    [Fld_Region] VARCHAR(50) NULL,
    [Fld_Attnlocation] VARCHAR(50) NULL,
    [Fld_Hod_No] VARCHAR(50) NULL,
    [Fld_Hod_Name] VARCHAR(100) NULL,
    [Fld_Hire_Date] DATETIME NULL,
    [Fld_Pending_Details] VARCHAR(200) NULL,
    [Fld_Ncfm_Status] VARCHAR(150) NULL,
    [Fld_Panno] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_hr_pnddoc_attach
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_hr_pnddoc_attach]
(
    [Fld_Emp_No] VARCHAR(50) NULL,
    [Fld_Emp_Name] VARCHAR(150) NULL,
    [Fld_Designation] VARCHAR(150) NULL,
    [Fld_Dept] VARCHAR(150) NULL,
    [Fld_Region] VARCHAR(50) NULL,
    [Fld_Attnlocation] VARCHAR(50) NULL,
    [Fld_Hod_No] VARCHAR(50) NULL,
    [Fld_Hod_Name] VARCHAR(100) NULL,
    [Fld_Hire_Date] VARCHAR(50) NULL,
    [Fld_Pending_Details] VARCHAR(200) NULL,
    [Fld_ncfm_status] VARCHAR(150) NULL,
    [Fld_panno] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_hrpen_msgcontent
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_hrpen_msgcontent]
(
    [Fld_message_Hod] VARCHAR(8000) NULL,
    [Fld_message_regional] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_import_ipo
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_import_ipo]
(
    [Fld_IPO] VARCHAR(411) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_IPDATA_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_IPDATA_TEMP]
(
    [ipfrom] FLOAT NOT NULL,
    [ipto] FLOAT NOT NULL,
    [countryshort] VARCHAR(4) NULL,
    [country] VARCHAR(128) NULL,
    [state] VARCHAR(256) NULL,
    [city] NVARCHAR(128) NULL,
    [isp] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IPO_Code
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IPO_Code]
(
    [Fld_Code] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_irfan
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_irfan]
(
    [Party_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_IT_IPaddress
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_IT_IPaddress]
(
    [Fld_Branch] VARCHAR(50) NULL,
    [Fld_IpFrom] VARCHAR(15) NULL,
    [Fld_IpTo] VARCHAR(15) NULL,
    [Fld_SB_mask] VARCHAR(15) NULL,
    [Fld_Def_GT] VARCHAR(15) NULL,
    [Fld_Remark] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_kycupdatedata
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_kycupdatedata]
(
    [ClientCode] VARCHAR(15) NULL,
    [NewRemarkBounce] VARCHAR(300) NULL,
    [NewRemarkSify] VARCHAR(300) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Mapping_Email
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Mapping_Email]
(
    [Fld_EmpCode] VARCHAR(50) NULL,
    [Fld_Branch] VARCHAR(50) NULL,
    [Fld_File] CHAR(1) NULL,
    [Fld_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_market_share
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_market_share]
(
    [Fld_TradeDate] VARCHAR(50) NULL,
    [Fld_BSEExchangeTo] VARCHAR(50) NULL,
    [Fld_BSEAngelTo] VARCHAR(50) NULL,
    [Fld_BSEShare] VARCHAR(50) NULL,
    [Fld_BSEGrossDel] VARCHAR(50) NULL,
    [Fld_BSEAngelInfin] VARCHAR(50) NULL,
    [Fld_NSEExchangeTo] VARCHAR(50) NULL,
    [Fld_NSEAngelTo] VARCHAR(50) NULL,
    [Fld_NSEShare] VARCHAR(50) NULL,
    [Fld_NSEGrossDel] VARCHAR(50) NULL,
    [Fld_NSEAngelInfin] VARCHAR(50) NULL,
    [Fld_FOExchangeTo] VARCHAR(50) NULL,
    [Fld_FOAngelTo] VARCHAR(50) NULL,
    [Fld_FOShare] VARCHAR(50) NULL,
    [Fld_FOAngelInfin] VARCHAR(50) NULL,
    [Fld_TotalExchangeTO] VARCHAR(50) NULL,
    [Fld_TotalAngelTO] VARCHAR(50) NULL,
    [Fld_TotalShare] VARCHAR(50) NULL,
    [Fld_TotalGrosssDel] VARCHAR(50) NULL,
    [Fld_TotalInfinDel] VARCHAR(50) NULL,
    [Fld_TotalPerShare] VARCHAR(50) NULL,
    [Fld_NcdexExchangeTo] VARCHAR(50) NULL,
    [Fld_NcdexAngelTo] VARCHAR(50) NULL,
    [Fld_NcdexShare] VARCHAR(50) NULL,
    [Fld_McxExchangeTo] VARCHAR(50) NULL,
    [Fld_McxAngelTo] VARCHAR(50) NULL,
    [Fld_McxShare] VARCHAR(50) NULL,
    [Fld_TotalCommAngelTO] VARCHAR(50) NULL,
    [Fld_TotalAngelGrosssDel] VARCHAR(50) NULL,
    [Fld_TotalCommShare] VARCHAR(50) NULL,
    [Fld_CurNSEExchangeTo] VARCHAR(50) NULL,
    [Fld_CurNSEAngelTo] VARCHAR(50) NULL,
    [Fld_CurNSEShare] VARCHAR(50) NULL,
    [Fld_CurMcxExchangeTo] VARCHAR(50) NULL,
    [Fld_CurMcxAngelTo] VARCHAR(50) NULL,
    [Fld_CurMcxShare] VARCHAR(50) NULL,
    [Fld_CurTotalExchangeTo] VARCHAR(50) NULL,
    [Fld_CurTotalAngelTo] VARCHAR(50) NULL,
    [Fld_CurTotalAngelPer] VARCHAR(50) NULL,
    [Fld_GrandExchangesTotal] VARCHAR(50) NULL,
    [Fld_GrandAngelTotal] VARCHAR(50) NULL,
    [Fld_GrandPer] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_master_daily_turnover
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_master_daily_turnover]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [enetred_by] VARCHAR(50) NULL,
    [entered_on] VARCHAR(50) NULL,
    [txtdate] VARCHAR(50) NULL,
    [txtsegment] VARCHAR(50) NULL,
    [date] VARCHAR(50) NULL,
    [exchange_volumes] VARCHAR(50) NULL,
    [delivery] VARCHAR(50) NULL,
    [trading] VARCHAR(50) NULL,
    [total] VARCHAR(50) NULL,
    [delievery_per_angel] VARCHAR(50) NULL,
    [total_margin] VARCHAR(50) NULL,
    [bank_guarantee] VARCHAR(50) NULL,
    [cash_deposite] VARCHAR(50) NULL,
    [FDR] VARCHAR(50) NULL,
    [shares] VARCHAR(50) NULL,
    [total_capital] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MCX_CURRENCY1
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MCX_CURRENCY1]
(
    [Trade_no] INT NULL,
    [Trade_Status] INT NULL,
    [Instrument_ID] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [expirydate] SMALLDATETIME NULL,
    [Reserved] VARCHAR(20) NULL,
    [Strike Price] MONEY NULL,
    [Reserved1] VARCHAR(20) NULL,
    [Options Type] VARCHAR(25) NULL,
    [Product Description] INT NULL,
    [Book Tpe Name] VARCHAR(20) NULL,
    [Book Type] INT NULL,
    [user id] INT NULL,
    [Branch No] INT NULL,
    [Buy Sell] INT NULL,
    [Trade quantity] INT NULL,
    [Price] MONEY NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(25) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] MONEY NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved3] VARCHAR(20) NULL,
    [Activity Time] SMALLDATETIME NULL,
    [Last Modified time] SMALLDATETIME NULL,
    [Order Number] VARCHAR(20) NULL,
    [Opposite Broker Id] VARCHAR(10) NULL,
    [Order User Last Update Time] VARCHAR(50) NULL,
    [Mod Date Time] DATETIME NULL,
    [Order Entered/Mod Date Time] DATETIME NULL,
    [RESERVED5] VARCHAR(50) NULL,
    [RESERVED6] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mcxadmin_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mcxadmin_temp]
(
    [Trade Number] INT NULL,
    [Trade Status] INT NULL,
    [Instrument ID] INT NULL,
    [Instrument Name] VARCHAR(100) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Expiry Date] DATETIME NULL,
    [Reserved] VARCHAR(10) NULL,
    [Strike Price ] VARCHAR(50) NULL,
    [Reserved1] VARCHAR(10) NULL,
    [Options Type] VARCHAR(50) NULL,
    [Product Description] INT NULL,
    [Book Type Name] VARCHAR(25) NULL,
    [Book Type] INT NULL,
    [User ID] INT NULL,
    [Branch No] VARCHAR(50) NULL,
    [B/S] INT NULL,
    [Trade quantity] INT NULL,
    [Price] VARCHAR(50) NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(50) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] VARCHAR(50) NULL,
    [TM ID] INT NULL,
    [Reserved2] VARCHAR(10) NULL,
    [Activity Time] DATETIME NULL,
    [Last Modified time] DATETIME NULL,
    [Order Number] VARCHAR(50) NULL,
    [Opposite Broker Id] VARCHAR(100) NULL,
    [Order User Last Update Time] VARCHAR(255) NULL,
    [Mod Date Time] DATETIME NULL,
    [Order Entered/Mod Date Time] DATETIME NULL,
    [Reserved9] VARCHAR(50) NULL,
    [Reserved10] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MCXBlockScrip
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MCXBlockScrip]
(
    [OperationCode] INT NULL,
    [DealerId] VARCHAR(15) NULL,
    [GroupCode] VARCHAR(10) NULL,
    [Deposit] MONEY NULL,
    [ScripCode] VARCHAR(10) NULL,
    [Symbol] VARCHAR(15) NULL,
    [Series] VARCHAR(15) NULL,
    [Group_val] VARCHAR(20) NULL,
    [Periodicity] VARCHAR(10) NULL,
    [InstrumentName] VARCHAR(20) NULL,
    [Expiry] DATETIME NULL,
    [StrikePrice] VARCHAR(10) NULL,
    [OptionType] VARCHAR(20) NULL,
    [GrossExposure] VARCHAR(20) NULL,
    [GrossExposureLimit] VARCHAR(20) NULL,
    [NetExposureMultiplier] VARCHAR(20) NULL,
    [NetExposure] VARCHAR(20) NULL,
    [NetSaleMultiplier] VARCHAR(20) NULL,
    [NetSaleLimit] VARCHAR(20) NULL,
    [NetPositionMultiplier] VARCHAR(20) NULL,
    [NetPositionLimit] VARCHAR(20) NULL,
    [TurnoverMultiplier] VARCHAR(20) NULL,
    [TurnoverLimit] VARCHAR(20) NULL,
    [PendingOrderMultiplier] VARCHAR(20) NULL,
    [PendingOrderLimit] VARCHAR(20) NULL,
    [MTMMultiplier] VARCHAR(20) NULL,
    [MTMLimit] VARCHAR(20) NULL,
    [InitialMarginMultiplier] VARCHAR(20) NULL,
    [InitialMarginLimit] VARCHAR(20) NULL,
    [NetQuantityLimit] VARCHAR(20) NULL,
    [MaximumSingleTransactionLimit] VARCHAR(20) NULL,
    [MaximumSingleTransactionQuantity] VARCHAR(20) NULL,
    [MinimumOrderValue] VARCHAR(20) NULL,
    [MinimumOrderQuantity] VARCHAR(20) NULL,
    [RetainMultiplier] VARCHAR(20) NULL,
    [Reserved1] VARCHAR(20) NULL,
    [Reserved2] VARCHAR(20) NULL,
    [GrossCheck] VARCHAR(20) NULL,
    [Filler] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mcxcurrency_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mcxcurrency_temp]
(
    [Trade Number] INT NULL,
    [Trade Status] INT NULL,
    [Instrument ID] INT NULL,
    [Instrument Name] VARCHAR(150) NULL,
    [Symbol] VARCHAR(150) NULL,
    [Expiry Date] DATETIME NULL,
    [Reserved] VARCHAR(100) NULL,
    [Strike Price] FLOAT NULL,
    [Options Type] VARCHAR(100) NULL,
    [Product Description] VARCHAR(150) NULL,
    [Book Type] INT NULL,
    [Book Type Name] VARCHAR(100) NULL,
    [Market Type] INT NULL,
    [User ID] VARCHAR(50) NULL,
    [Branch No] VARCHAR(150) NULL,
    [Buy/Sell Indicator] INT NULL,
    [Trade quantity] INT NULL,
    [Price] FLOAT NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(150) NULL,
    [Participant Settler] VARCHAR(25) NULL,
    [Spread Price] FLOAT NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved1] VARCHAR(50) NULL,
    [Trade time] DATETIME NULL,
    [Last Modified Time] DATETIME NULL,
    [Order Number] VARCHAR(100) NULL,
    [Reserved2] VARCHAR(25) NULL,
    [Remarks] VARCHAR(200) NULL,
    [Order User Last Update Time] DATETIME NULL,
    [Reserved3] DATETIME NULL,
    [Reference Number] VARCHAR(50) NULL,
    [Reserved4] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mf_ls_arn_euins_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mf_ls_arn_euins_Temp]
(
    [Sr No] VARCHAR(100) NULL,
    [SB Equity Tag] VARCHAR(100) NULL,
    [SB Name] VARCHAR(100) NULL,
    [ARN No] VARCHAR(100) NULL,
    [ARN Holder Name] VARCHAR(100) NULL,
    [Validity From] VARCHAR(100) NULL,
    [Validity To] VARCHAR(100) NULL,
    [EUIN No] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mf_ls_arn_euins_tEMP_new
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mf_ls_arn_euins_tEMP_new]
(
    [Sr No] VARCHAR(100) NULL,
    [SB Equity Tag] VARCHAR(100) NULL,
    [SB Name] VARCHAR(100) NULL,
    [ARN No] VARCHAR(100) NULL,
    [ARN Holder Name] VARCHAR(100) NULL,
    [Validity From] VARCHAR(100) NULL,
    [Validity To] VARCHAR(100) NULL,
    [EUIN No] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Mfss_Lumusm_Error
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Mfss_Lumusm_Error]
(
    [ErrID] INT IDENTITY(1,1) NOT NULL,
    [ErrTime] DATETIME NULL,
    [ErrObject] VARCHAR(8000) NULL,
    [ErrLine] INT NULL,
    [ErrMessage] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mfssRecommendedScheme_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mfssRecommendedScheme_Temp]
(
    [Header] VARCHAR(100) NULL,
    [SchemeName] VARCHAR(500) NULL,
    [AUM] VARCHAR(100) NULL,
    [GrowthISIN] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Mis_Marketshare
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Mis_Marketshare]
(
    [Fld_Date] VARCHAR(50) NULL,
    [Fld_Mktopen_int] MONEY NULL,
    [Fld_FONet] MONEY NULL,
    [Fld_Gross] MONEY NULL,
    [Fld_M888Net] MONEY NULL,
    [Fld_M888Gross] MONEY NULL,
    [Fld_NetDebit] MONEY NULL,
    [FLd_od_Bank] MONEY NULL,
    [FLd_Bse] MONEY NULL,
    [Fld_Nse_FO] MONEY NULL,
    [Fld_NSe] MONEY NULL,
    [Fld_Margins] MONEY NULL,
    [Fld_ActivityRatio] MONEY NULL,
    [Fld_Openpos_percli] MONEY NULL,
    [Fld_brokNet] MONEY NULL,
    [Fld_brokGross] MONEY NULL,
    [Fld_Pledged] MONEY NULL,
    [Fld_PledgablewithICICI] MONEY NULL,
    [Fld_Freeholding] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MISDaily_turnover_trade_details
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MISDaily_turnover_trade_details]
(
    [date] VARCHAR(50) NULL,
    [exchange_volumes] VARCHAR(50) NULL,
    [delivery] VARCHAR(50) NULL,
    [trading] VARCHAR(50) NULL,
    [total] VARCHAR(50) NULL,
    [delievery_per_angel] VARCHAR(50) NULL,
    [total_margin] VARCHAR(50) NULL,
    [bank_guarantee] VARCHAR(50) NULL,
    [cash_deposite] VARCHAR(50) NULL,
    [FDR] VARCHAR(50) NULL,
    [shares] VARCHAR(50) NULL,
    [total_capital] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NBFC_OpenPos
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NBFC_OpenPos]
(
    [PARTY_CODE] VARCHAR(50) NULL,
    [SCRIP_CD] VARCHAR(50) NULL,
    [B_F] MONEY NULL,
    [B_F_VALUE] MONEY NULL,
    [BUY] MONEY NULL,
    [SEL] MONEY NULL,
    [NET] MONEY NULL,
    [BUY_PRICE] MONEY NULL,
    [SEL_PRICE] MONEY NULL,
    [BUY_VALUE] MONEY NULL,
    [SEL_VALUE] MONEY NULL,
    [DAY_VALUE] MONEY NULL,
    [OPEN_POSITION] MONEY NULL,
    [CLOSING_PRICE] MONEY NULL,
    [PORTFOLIO_VALUE] MONEY NULL,
    [NET_VALUE] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_NDNC_File
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_NDNC_File]
(
    [Fld_Msg] VARCHAR(15) NULL,
    [Fld_Name] VARCHAR(100) NULL,
    [Fld_Office] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NonECN_Email
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NonECN_Email]
(
    [FLd_File] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NSE_04052024
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NSE_04052024]
(
    [symbol] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_nse_currency_exchange
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_nse_currency_exchange]
(
    [Trade_no] INT NULL,
    [Trade_Status] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [expirydate] SMALLDATETIME NULL,
    [Reserved] VARCHAR(20) NULL,
    [Strike Price] VARCHAR(50) NULL,
    [Options Type] VARCHAR(25) NULL,
    [Product Description] INT NULL,
    [Book Tpe Name] VARCHAR(20) NULL,
    [Book Type] INT NULL,
    [user id] INT NULL,
    [Branch No] INT NULL,
    [Buy Sell] INT NULL,
    [Trade quantity] INT NULL,
    [Price] MONEY NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(25) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] VARCHAR(50) NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved3] VARCHAR(20) NULL,
    [Activity Time] SMALLDATETIME NULL,
    [Last Modified time] VARCHAR(50) NULL,
    [Order Number] VARCHAR(20) NULL,
    [Order User Last Update Time] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_nse_currency_exchange1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_nse_currency_exchange1]
(
    [Trade_no] INT NULL,
    [Trade_Status] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [expirydate] SMALLDATETIME NULL,
    [Reserved] VARCHAR(20) NULL,
    [Strike Price] VARCHAR(50) NULL,
    [Options Type] VARCHAR(25) NULL,
    [Product Description] INT NULL,
    [Book Tpe Name] VARCHAR(20) NULL,
    [Book Type] INT NULL,
    [user id] VARCHAR(50) NULL,
    [Branch No] INT NULL,
    [Buy Sell] INT NULL,
    [Trade quantity] INT NULL,
    [Price] MONEY NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(25) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] VARCHAR(50) NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved3] VARCHAR(20) NULL,
    [Activity Time] SMALLDATETIME NULL,
    [Last Modified time] VARCHAR(50) NULL,
    [Order Number] VARCHAR(20) NULL,
    [Order User Last Update Time] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_nseadmin_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_nseadmin_temp]
(
    [Trade Number] INT NULL,
    [Trade Status] INT NULL,
    [Instrument Name] VARCHAR(100) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Expiry Date] DATETIME NULL,
    [Strike Price ] VARCHAR(255) NULL,
    [Option type] VARCHAR(50) NULL,
    [Security name ] VARCHAR(150) NULL,
    [Book Type] INT NULL,
    [Book Type Name] VARCHAR(50) NULL,
    [Market Type] INT NULL,
    [User Id] INT NULL,
    [Branch No] INT NULL,
    [Buy/Sell Ind] INT NULL,
    [Trade Qty] INT NULL,
    [Price] VARCHAR(50) NULL,
    [Pro/Client ] INT NULL,
    [Account] VARCHAR(100) NULL,
    [Participant] INT NULL,
    [Open/Close Flag] VARCHAR(15) NULL,
    [Cover/Uncover Flag] VARCHAR(15) NULL,
    [Activity Time] DATETIME NULL,
    [Last Modified time] DATETIME NULL,
    [Order No] VARCHAR(100) NULL,
    [Opposite Broker Id] VARCHAR(50) NULL,
    [Order Entered/Mod Date Time] DATETIME NULL,
    [ColTest] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_NSEADMIN_TEMP_BKP
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_NSEADMIN_TEMP_BKP]
(
    [Trade Number] INT NULL,
    [Trade Status] INT NULL,
    [Instrument Name] VARCHAR(100) NULL,
    [Symbol] VARCHAR(50) NULL,
    [Expiry Date] DATETIME NULL,
    [Strike Price ] VARCHAR(255) NULL,
    [Option type] VARCHAR(50) NULL,
    [Security name ] VARCHAR(150) NULL,
    [Book Type] INT NULL,
    [Book Type Name] VARCHAR(50) NULL,
    [Market Type] INT NULL,
    [User Id] INT NULL,
    [Branch No] INT NULL,
    [Buy/Sell Ind] INT NULL,
    [Trade Qty] INT NULL,
    [Price] VARCHAR(50) NULL,
    [Pro/Client ] INT NULL,
    [Account] VARCHAR(100) NULL,
    [Participant] INT NULL,
    [Open/Close Flag] VARCHAR(15) NULL,
    [Cover/Uncover Flag] VARCHAR(15) NULL,
    [Activity Time] DATETIME NULL,
    [Last Modified time] DATETIME NULL,
    [Order No] VARCHAR(100) NULL,
    [Opposite Broker Id] VARCHAR(50) NULL,
    [Order Entered/Mod Date Time] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_nsecurrency_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_nsecurrency_temp]
(
    [Trade ID] INT NULL,
    [Activity type] INT NULL,
    [Symbol] VARCHAR(50) NULL,
    [Instrument Type] VARCHAR(150) NULL,
    [Expiry Date] DATETIME NULL,
    [Strike Price] FLOAT NULL,
    [Option Type] VARCHAR(50) NULL,
    [Contract Name] VARCHAR(100) NULL,
    [Book Type] INT NULL,
    [Market Type] INT NULL,
    [User Id] VARCHAR(15) NULL,
    [Branch Id] INT NULL,
    [Buy/Sell] INT NULL,
    [Quantity] INT NULL,
    [Price] FLOAT NULL,
    [Pro/Cli Flag] INT NULL,
    [Account number] VARCHAR(50) NULL,
    [Participant] VARCHAR(50) NULL,
    [Settlement] INT NULL,
    [Trade Date/Time] DATETIME NULL,
    [Modified Date/Time] DATETIME NULL,
    [Order Number] VARCHAR(100) NULL,
    [CP ID] VARCHAR(100) NULL,
    [Entry Date/Time] DATETIME NULL,
    [CTCLID] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_NseDPJV
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_NseDPJV]
(
    [NSE] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ODin
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ODin]
(
    [Party_Code] VARCHAR(300) NULL,
    [Branch_cd] VARCHAR(500) NULL,
    [Client_Name] VARCHAR(100) NULL,
    [Segment] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_ACM
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_ACM]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_AHD_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_AHD_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_AP_2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_AP_2]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_AP_6
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_AP_6]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_AP_8
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_AP_8]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_ap_9
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_ap_9]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_BNG_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_BNG_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_BNG_2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_BNG_2]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_BNG_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_BNG_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_BNG5
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_BNG5]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_CHEN_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_CHEN_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_CHEN12
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_CHEN12]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_CMBTR10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_CMBTR10]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_COHIN2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_COHIN2]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_CSO
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_CSO]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [UserName] VARCHAR(15) NULL,
    [Flag] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO_15
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO_15]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO_15_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO_15_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO133
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO133]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO15
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO15]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO15_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO15_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO16
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO16]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO19
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO19]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO19_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO19_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO20
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO20]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO20_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO20_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO25
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO25]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO25_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO25_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO34
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO34]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO44
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO44]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO44_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO44_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO48
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO48]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO48_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO48_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO64
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO64]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO64_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO64_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO65
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO65]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO65_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO65_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO66
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO66]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO66_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO66_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO69
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO69]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO89
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO89]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO90
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO90]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO94
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO94]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO97
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO97]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_CSO98
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_CSO98]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_CSP97
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_CSP97]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_DEL10
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_DEL10]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_DEL10_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_DEL10_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_DEL15
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_DEL15]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_HO
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_HO]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_HYD_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_HYD_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_HYD3
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_HYD3]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_INDO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_INDO_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_INDO5
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_INDO5]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_INDO5_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_INDO5_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_JAIP_4
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_JAIP_4]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_JAIP15
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_JAIP15]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_JAIP15_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_JAIP15_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_KNPR
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_KNPR]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_KNPR10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_KNPR10]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_KOLK_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_KOLK_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_KOLK5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_KOLK5]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_LUCK10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_LUCK10]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_MP
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_MP]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_NAGPR
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_NAGPR]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_NAGPR8
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_NAGPR8]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ODin_new
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ODin_new]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_NRTH_7
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_NRTH_7]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_PATCH
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_PATCH]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_PATCH_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_PATCH_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_RAJ1
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_RAJ1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_RAJ1_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_RAJ1_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_RAJ15
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_RAJ15]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_RAJ15_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_RAJ15_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_SA_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_SA_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_SGUJ
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_SGUJ]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_SK
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_SK]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_TB186
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_TB186]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_TB186_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_TB186_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_UP_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_UP_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_UP_REG
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_UP_REG]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_VD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_VD]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_VD5
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_VD5]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_VKPT
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_VKPT]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_VKPT5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_VKPT5]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Odin_xpu_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Odin_xpu_1]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_XPU3
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_XPU3]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_XPU3_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_XPU3_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_XS155
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_XS155]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_XS155_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_XS155_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_YA10
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_YA10]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_YA10_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_YA10_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_YA21
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_YA21]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_YA21_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_YA21_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_YA8
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_YA8]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NSECDS_Cur_Part_Code] VARCHAR(50) NULL,
    [NSECDS_CTCL_BranchId] VARCHAR(50) NULL,
    [NSECDS_CTCL_Id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ODIN_YA8_23012012
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ODIN_YA8_23012012]
(
    [Opcode] VARCHAR(20) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(50) NULL,
    [Client_name] VARCHAR(50) NULL,
    [Passwrd] VARCHAR(50) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(50) NULL,
    [Address2] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL,
    [State_pin] VARCHAR(50) NULL,
    [Telephone_No] VARCHAR(50) NULL,
    [FaxNo] VARCHAR(50) NULL,
    [Email] VARCHAR(50) NULL,
    [Status] VARCHAR(50) NULL,
    [Brokerage] VARCHAR(50) NULL,
    [Surv_On_Off] VARCHAR(50) NULL,
    [Surv_Auto_Manual] VARCHAR(50) NULL,
    [BankDPOnOff] VARCHAR(50) NULL,
    [ParticipantCode] VARCHAR(50) NULL,
    [Filler1] VARCHAR(50) NULL,
    [Filler2] VARCHAR(50) NULL,
    [Filler3] VARCHAR(50) NULL,
    [Filler4] VARCHAR(50) NULL,
    [Trading_Allowed] VARCHAR(50) NULL,
    [ClientValidationOnOff] VARCHAR(50) NULL,
    [SpanOnOff] VARCHAR(50) NULL,
    [DervPartCode] VARCHAR(50) NULL,
    [IP_Address] VARCHAR(50) NULL,
    [MaxNoOfOrder] VARCHAR(50) NULL,
    [Max_BCast_Scrips] VARCHAR(50) NULL,
    [Alias_DealerId] VARCHAR(50) NULL,
    [Family_Name] VARCHAR(50) NULL,
    [EqFlag] VARCHAR(50) NULL,
    [DervFlag] VARCHAR(50) NULL,
    [CombFlag] VARCHAR(50) NULL,
    [BSEEq] VARCHAR(50) NULL,
    [NEBEComb] VARCHAR(50) NULL,
    [NEBEEq] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [NSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Branch_Name] VARCHAR(50) NULL,
    [Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [Derv_CTCL_Id] VARCHAR(50) NULL,
    [Group_Admin] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Cash_CTCL_Id] VARCHAR(50) NULL,
    [Segment] VARCHAR(50) NULL,
    [ParticipantType] VARCHAR(50) NULL,
    [DIET] VARCHAR(50) NULL,
    [Net] VARCHAR(50) NULL,
    [iWin] VARCHAR(50) NULL,
    [NetNetLite] VARCHAR(50) NULL,
    [MCX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCX_CTCLId] VARCHAR(50) NULL,
    [NCDEX_CTCLBranchId] VARCHAR(50) NULL,
    [NCDEXCTCL_Id] VARCHAR(50) NULL,
    [ProductType] VARCHAR(50) NULL,
    [NSEL_CTCL_BranchId] VARCHAR(50) NULL,
    [NSEL_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_CTCL_Id] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [BSE_Derv_CTCL_Id] VARCHAR(50) NULL,
    [NMCE_CTCL_BranchId] VARCHAR(50) NULL,
    [NMCE_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Eq_CTCL_Id] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_BranchId] VARCHAR(50) NULL,
    [MCXSX_Derv_CTCL_Id] VARCHAR(50) NULL,
    [DSE_CTCL_BranchId] VARCHAR(50) NULL,
    [DSE_CTCL_Id] VARCHAR(50) NULL,
    [Market_Data_Allowed] VARCHAR(50) NULL,
    [MCXSX_Cur_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Eq_Participant_Code] VARCHAR(50) NULL,
    [MCXSX_Derv_Participant_Code] VARCHAR(50) NULL,
    [DSE_Participant_Code] VARCHAR(50) NULL,
    [MCX_Participant_Code] VARCHAR(50) NULL,
    [NMCE_Participant_Code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OdinMail
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OdinMail]
(
    [Name] NVARCHAR(255) NULL,
    [EmpCode] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Email] VARCHAR(100) NULL,
    [BranchName] VARCHAR(100) NULL,
    [block_mail] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_OFFLINE_ONLINE_NSX
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_OFFLINE_ONLINE_NSX]
(
    [MARKET] VARCHAR(50) NULL,
    [INSTRUMENT] VARCHAR(50) NULL,
    [SYMBOL] VARCHAR(50) NULL,
    [EXPIRY DATE] DATETIME NULL,
    [STRIKE] VARCHAR(50) NULL,
    [OPTION TYPE] VARCHAR(50) NULL,
    [PREVIOUS CLOSE] VARCHAR(50) NULL,
    [OPENRATE] VARCHAR(50) NULL,
    [HIGH] VARCHAR(50) NULL,
    [LOW] VARCHAR(50) NULL,
    [CLOSERATE] VARCHAR(50) NULL,
    [TOTAL VOLUME] VARCHAR(50) NULL,
    [TOTAL VALUE] VARCHAR(50) NULL,
    [OPEN INTEREST] VARCHAR(50) NULL,
    [CHANGE IN OPEN INTEREST] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL,
    [BrokerId] VARCHAR(100) NULL,
    [ServerId] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo_07052022
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo_07052022]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL,
    [BrokerId] VARCHAR(100) NULL,
    [ServerId] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo_30102020
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo_30102020]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo_4sept2020
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo_4sept2020]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo_Hist
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo_Hist]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL,
    [Update_Date] DATETIME NULL,
    [BrokerId] VARCHAR(100) NULL,
    [ServerId] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo_Hist_30102020
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo_Hist_30102020]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL,
    [Update_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_OmnUserinfo_Hist_30102020_2
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_OmnUserinfo_Hist_30102020_2]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL,
    [Update_Date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_pincity_master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_pincity_master]
(
    [State] VARCHAR(100) NULL,
    [City] VARCHAR(100) NULL,
    [Pin_Code] VARCHAR(100) NULL,
    [Access_to] VARCHAR(50) NULL,
    [Access_code] VARCHAR(50) NULL,
    [UserName] VARCHAR(50) NULL,
    [localIP] VARCHAR(50) NULL,
    [GatDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_pincity_master$
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_pincity_master$]
(
    [State] NVARCHAR(255) NULL,
    [City] NVARCHAR(255) NULL,
    [Pin_Code] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_pincity_master_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_pincity_master_temp]
(
    [State] VARCHAR(100) NULL,
    [City] VARCHAR(100) NULL,
    [Pin_Code] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_ACM
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_ACM]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_AHD_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_AHD_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_AP_2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_AP_2]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_AP_6
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_AP_6]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_AP_8
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_AP_8]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_ap_9
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_ap_9]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_BNG_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_BNG_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_BNG_2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_BNG_2]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_BNG5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_BNG5]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CHEN_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CHEN_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CHEN12
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CHEN12]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CMBTR10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CMBTR10]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_COHIN2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_COHIN2]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO_15
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO_15]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RECO_CSO133
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RECO_CSO133]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO15
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO15]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RECO_CSO16
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RECO_CSO16]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO19
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO19]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RECO_CSO20
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RECO_CSO20]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO25
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO25]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RECO_CSO34
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RECO_CSO34]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO44
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO44]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO48
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO48]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RECO_CSO64
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RECO_CSO64]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO65
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO65]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO66
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO66]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO69
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO69]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO89
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO89]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO90
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO90]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO94
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO94]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO97
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO97]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSO98
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSO98]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_CSP97
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_CSP97]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_DEL10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_DEL10]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_DEL15
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_DEL15]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_HO
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_HO]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_HYD_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_HYD_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_HYD3
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_HYD3]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_INDO_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_INDO_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_INDO5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_INDO5]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_JAIP_4
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_JAIP_4]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_JAIP15
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_JAIP15]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_KNPR
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_KNPR]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_KNPR10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_KNPR10]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_KOLK_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_KOLK_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_KOLK5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_KOLK5]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_LUCK10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_LUCK10]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_MP
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_MP]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_NAGPR
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_NAGPR]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_NAGPR8
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_NAGPR8]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_NRTH_7
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_NRTH_7]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_RAJ1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_RAJ1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_RAJ15
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_RAJ15]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_SA_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_SA_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_SGUJ
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_SGUJ]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_SK
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_SK]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_RECO_TB186
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_RECO_TB186]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_UP_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_UP_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_UP_REG
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_UP_REG]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_VD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_VD]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_VD5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_VD5]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_VKPT
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_VKPT]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_VKPT5
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_VKPT5]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_xpu_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_xpu_1]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_XPU3
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_XPU3]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_XS155
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_XS155]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_YA10
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_YA10]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_YA21
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_YA21]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_reco_YA8
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_reco_YA8]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_restricted_scrips_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_restricted_scrips_TEMP]
(
    [sc_code] VARCHAR(20) NULL,
    [symbol] VARCHAR(100) NULL,
    [sc_group] VARCHAR(100) NULL,
    [isin_no] VARCHAR(50) NULL,
    [status] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_restricted_scrips_TEMP_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_restricted_scrips_TEMP_NSE]
(
    [symbol] VARCHAR(100) NULL,
    [sc_group] VARCHAR(100) NULL,
    [isin_no] VARCHAR(50) NULL,
    [status] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_reversefile
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_reversefile]
(
    [SR_NO] VARCHAR(10) NULL,
    [name] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_ReverseUCCfile
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_ReverseUCCfile]
(
    [Sr_No] VARCHAR(10) NULL,
    [Name] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_rpt_status
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_rpt_status]
(
    [Fld_EmpCode] VARCHAR(15) NULL,
    [Fld_Access_Code] VARCHAR(15) NULL,
    [Fld_Branch_Code] VARCHAR(15) NULL,
    [Fld_Report_Name] VARCHAR(2) NULL,
    [Fld_Report_Status] VARCHAR(2) NULL,
    [Fld_CodeCount] NUMERIC(18, 0) NULL,
    [Fld_UpdateDate] DATETIME NULL,
    [Fld_ModifiedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SB_Code
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SB_Code]
(
    [Fld_Branch_Code] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ScripFile_Equity
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ScripFile_Equity]
(
    [instrument_type] VARCHAR(50) NULL,
    [code] VARCHAR(50) NULL,
    [symbol] VARCHAR(50) NULL,
    [security_descrip] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SecondaryEmailBypass
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SecondaryEmailBypass]
(
    [CL_Code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Sent_mail
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Sent_mail]
(
    [Fld_Data] VARCHAR(100) NULL,
    [Fld_Mail_id] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Sify_Amit
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Sify_Amit]
(
    [clientCode] NVARCHAR(255) NULL,
    [Email Id] NVARCHAR(255) NULL,
    [AltEmailId] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Sql_Connections
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Sql_Connections]
(
    [Fld_SrNo] INT IDENTITY(1,1) NOT NULL,
    [Fld_ServerName] VARCHAR(25) NULL,
    [Fld_ServerIp] VARCHAR(15) NULL,
    [Fld_UserName] VARCHAR(10) NULL,
    [Fld_Password] VARCHAR(15) NULL,
    [Fld_Database] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Squareup_Clients
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Squareup_Clients]
(
    [Party_code] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Stt1
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Stt1]
(
    [VDate] DATETIME NULL,
    [Edate] DATETIME NULL,
    [cltcode] VARCHAR(50) NULL,
    [DRCR] VARCHAR(1) NOT NULL,
    [Amount] VARCHAR(50) NULL,
    [Narration] VARCHAR(50) NULL,
    [srno] VARCHAR(20) NULL,
    [branch_cd] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_t
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_t]
(
    [Fld_a] VARCHAR(50) NULL,
    [Fld_b] VARCHAR(50) NULL,
    [Fld_c] VARCHAR(50) NULL,
    [Fld_d] VARCHAR(50) NULL,
    [Fld_e] VARCHAR(50) NULL,
    [Fld_f] VARCHAR(50) NULL,
    [Fld_g] VARCHAR(50) NULL,
    [Fld_h] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_temp_branchdata
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_temp_branchdata]
(
    [clientcode] VARCHAR(500) NULL,
    [dispatchDate] DATETIME NULL,
    [Reason] VARCHAR(500) NULL,
    [POD] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_temp_branchdata_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_temp_branchdata_temp]
(
    [clientcode] VARCHAR(500) NULL,
    [dispatchDate] VARCHAR(50) NULL,
    [Reason] VARCHAR(500) NULL,
    [POD] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_temp_excel
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_temp_excel]
(
    [party_code] VARCHAR(11) NULL,
    [product] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_tempMCXBlockScrip
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_tempMCXBlockScrip]
(
    [OperationCode] INT NULL,
    [DealerId] VARCHAR(15) NULL,
    [GroupCode] VARCHAR(10) NULL,
    [Deposit] MONEY NULL,
    [ScripCode] VARCHAR(10) NULL,
    [Symbol] VARCHAR(15) NULL,
    [Series] VARCHAR(15) NULL,
    [Group_val] VARCHAR(20) NULL,
    [Periodicity] VARCHAR(10) NULL,
    [InstrumentName] VARCHAR(20) NULL,
    [Expiry] DATETIME NULL,
    [StrikePrice] VARCHAR(10) NULL,
    [OptionType] VARCHAR(20) NULL,
    [GrossExposure] VARCHAR(20) NULL,
    [GrossExposureLimit] VARCHAR(20) NULL,
    [NetExposureMultiplier] VARCHAR(20) NULL,
    [NetExposure] VARCHAR(20) NULL,
    [NetSaleMultiplier] VARCHAR(20) NULL,
    [NetSaleLimit] VARCHAR(20) NULL,
    [NetPositionMultiplier] VARCHAR(20) NULL,
    [NetPositionLimit] VARCHAR(20) NULL,
    [TurnoverMultiplier] VARCHAR(20) NULL,
    [TurnoverLimit] VARCHAR(20) NULL,
    [PendingOrderMultiplier] VARCHAR(20) NULL,
    [PendingOrderLimit] VARCHAR(20) NULL,
    [MTMMultiplier] VARCHAR(20) NULL,
    [MTMLimit] VARCHAR(20) NULL,
    [InitialMarginMultiplier] VARCHAR(20) NULL,
    [InitialMarginLimit] VARCHAR(20) NULL,
    [NetQuantityLimit] VARCHAR(20) NULL,
    [MaximumSingleTransactionLimit] VARCHAR(20) NULL,
    [MaximumSingleTransactionQuantity] VARCHAR(20) NULL,
    [MinimumOrderValue] VARCHAR(20) NULL,
    [MinimumOrderQuantity] VARCHAR(20) NULL,
    [RetainMultiplier] VARCHAR(20) NULL,
    [Reserved1] VARCHAR(20) NULL,
    [Reserved2] VARCHAR(20) NULL,
    [GrossCheck] VARCHAR(20) NULL,
    [Filler] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_tempPledgeRelease
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_tempPledgeRelease]
(
    [ID] CHAR(1) NULL,
    [Transaction_Type] NUMERIC(3, 0) NULL,
    [Bo_ID] VARCHAR(16) NULL,
    [ISIN] VARCHAR(12) NULL,
    [Transaction_Id] NUMERIC(9, 0) NULL,
    [Quantiy] NUMERIC(16, 3) NULL,
    [Transaction_Status] NUMERIC(6, 0) NULL,
    [Trans_Setup_date] VARCHAR(14) NULL,
    [business_Date] VARCHAR(14) NULL,
    [Free_Locking_Flag] CHAR(1) NULL,
    [Pledgee_Bo_Id] VARCHAR(16) NULL,
    [Field1] VARCHAR(8) NULL,
    [Field2] VARCHAR(13) NULL,
    [Field3] VARCHAR(13) NULL,
    [Parent_Psn] CHAR(8) NULL,
    [Field4] VARCHAR(14) NULL,
    [Field5] NUMERIC(6, 0) NULL,
    [Document_Number] VARCHAR(20) NULL,
    [Agreement_Number] VARCHAR(20) NULL,
    [PledgeDP_Int_Ref_NO] VARCHAR(30) NULL,
    [Field6] NUMERIC(8, 0) NULL,
    [Lockin_Code] NUMERIC(2, 0) NULL,
    [Lockin_Expiry_Date] VARCHAR(14) NULL,
    [Pledge_Expiry_Date] VARCHAR(14) NULL,
    [Maker_Checker_Flag] VARCHAR(1) NULL,
    [Field7] VARCHAR(1) NULL,
    [Field8] NUMERIC(2, 0) NULL,
    [Field9] VARCHAR(14) NULL,
    [Pledge_Value] NUMERIC(16, 3) NULL,
    [Field10] NUMERIC(16, 3) NULL,
    [Field11] NUMERIC(16, 3) NULL,
    [Field12] NUMERIC(16, 3) NULL,
    [Financial_Flag] NUMERIC(2, 0) NULL,
    [EFTS_Code] NUMERIC(2, 0) NULL,
    [Transaction_Code] NUMERIC(4, 0) NULL,
    [Modification_Flag] NUMERIC(2, 0) NULL,
    [Pledg_Or_DP_Int_RefNo] VARCHAR(16) NULL,
    [Pledg_Or_DP_Remarks] VARCHAR(100) NULL,
    [Pledgee_DP_Remarks] VARCHAR(100) NULL,
    [Operation_ID] VARCHAR(6) NULL,
    [Transaction_Source] NUMERIC(2, 0) NULL,
    [Last_Modification_Date] VARCHAR(14) NULL,
    [Lockin_Id] VARCHAR(16) NULL,
    [Field13] VARCHAR(9) NULL,
    [Filler1] VARCHAR(2) NULL,
    [Filler2] VARCHAR(16) NULL,
    [Filler3] VARCHAR(100) NULL,
    [Filler4] VARCHAR(14) NULL,
    [Filler5] VARCHAR(19) NULL,
    [FILLER6] VARCHAR(1) NULL,
    [FILLER7] VARCHAR(35) NULL,
    [FILLER8] VARCHAR(100) NULL,
    [FILLER9] VARCHAR(100) NULL,
    [FILLER10] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_tempPledgeRelease_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_tempPledgeRelease_hist]
(
    [ID] CHAR(1) NULL,
    [Transaction_Type] NUMERIC(3, 0) NULL,
    [Bo_ID] VARCHAR(16) NULL,
    [ISIN] VARCHAR(12) NULL,
    [Transaction_Id] NUMERIC(9, 0) NULL,
    [Quantiy] NUMERIC(16, 3) NULL,
    [Transaction_Status] NUMERIC(6, 0) NULL,
    [Trans_Setup_date] VARCHAR(14) NULL,
    [business_Date] VARCHAR(14) NULL,
    [Free_Locking_Flag] CHAR(1) NULL,
    [Pledgee_Bo_Id] VARCHAR(16) NULL,
    [Field1] VARCHAR(8) NULL,
    [Field2] VARCHAR(13) NULL,
    [Field3] VARCHAR(13) NULL,
    [Parent_Psn] CHAR(8) NULL,
    [Field4] VARCHAR(14) NULL,
    [Field5] NUMERIC(6, 0) NULL,
    [Document_Number] VARCHAR(20) NULL,
    [Agreement_Number] VARCHAR(20) NULL,
    [PledgeDP_Int_Ref_NO] VARCHAR(30) NULL,
    [Field6] NUMERIC(8, 0) NULL,
    [Lockin_Code] NUMERIC(2, 0) NULL,
    [Lockin_Expiry_Date] VARCHAR(14) NULL,
    [Pledge_Expiry_Date] VARCHAR(14) NULL,
    [Maker_Checker_Flag] VARCHAR(1) NULL,
    [Field7] VARCHAR(1) NULL,
    [Field8] NUMERIC(2, 0) NULL,
    [Field9] VARCHAR(14) NULL,
    [Pledge_Value] NUMERIC(16, 3) NULL,
    [Field10] NUMERIC(16, 3) NULL,
    [Field11] NUMERIC(16, 3) NULL,
    [Field12] NUMERIC(16, 3) NULL,
    [Financial_Flag] NUMERIC(2, 0) NULL,
    [EFTS_Code] NUMERIC(2, 0) NULL,
    [Transaction_Code] NUMERIC(4, 0) NULL,
    [Modification_Flag] NUMERIC(2, 0) NULL,
    [Pledg_Or_DP_Int_RefNo] VARCHAR(16) NULL,
    [Pledg_Or_DP_Remarks] VARCHAR(100) NULL,
    [Pledgee_DP_Remarks] VARCHAR(100) NULL,
    [Operation_ID] VARCHAR(6) NULL,
    [Transaction_Source] NUMERIC(2, 0) NULL,
    [Last_Modification_Date] VARCHAR(14) NULL,
    [Lockin_Id] VARCHAR(16) NULL,
    [Field13] VARCHAR(9) NULL,
    [Filler1] VARCHAR(2) NULL,
    [Filler2] VARCHAR(16) NULL,
    [Filler3] VARCHAR(100) NULL,
    [Filler4] VARCHAR(14) NULL,
    [Filler5] VARCHAR(19) NULL,
    [update_time] DATETIME NOT NULL,
    [UPDATE_by] VARCHAR(18) NOT NULL,
    [FILLER6] VARCHAR(1) NULL,
    [FILLER7] VARCHAR(35) NULL,
    [FILLER8] VARCHAR(100) NULL,
    [FILLER9] VARCHAR(100) NULL,
    [FILLER10] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_test
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_test]
(
    [Sr. No.] INT NOT NULL,
    [Client Code] VARCHAR(25) NULL,
    [DP Id] VARCHAR(8) NULL,
    [Client Id] VARCHAR(16) NULL,
    [ISIN] VARCHAR(12) NULL,
    [Scrip Name] VARCHAR(50) NULL,
    [Quantity] NUMERIC(16, 3) NULL,
    [Our Beneficiary A/c] VARCHAR(16) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_test_05jan2021
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_test_05jan2021]
(
    [Sr. No.] INT NOT NULL,
    [Client Code] VARCHAR(25) NULL,
    [DP Id] VARCHAR(8) NULL,
    [Client Id] VARCHAR(16) NULL,
    [ISIN] VARCHAR(12) NULL,
    [Scrip Name] VARCHAR(50) NULL,
    [Quantity] NUMERIC(16, 3) NULL,
    [Our Beneficiary A/c] VARCHAR(16) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_test_uni
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_test_uni]
(
    [data] VARCHAR(200) NULL,
    [today] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_tmp_accrual_charges
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_tmp_accrual_charges]
(
    [Demat] VARCHAR(20) NULL,
    [Trading_code] VARCHAR(15) NULL,
    [Amount] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_trade_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_trade_1]
(
    [BrokerID] VARCHAR(10) NULL,
    [TerminalID] VARCHAR(10) NULL,
    [ScriptCd] VARCHAR(10) NULL,
    [ScripName] VARCHAR(15) NULL,
    [Rate] VARCHAR(20) NULL,
    [Qty] VARCHAR(20) NULL,
    [A] VARCHAR(10) NULL,
    [B] VARCHAR(10) NULL,
    [TradeTime] VARCHAR(10) NULL,
    [TradeDate] VARCHAR(10) NULL,
    [ClientCode] VARCHAR(100) NULL,
    [OrderNo] VARCHAR(20) NULL,
    [C] VARCHAR(10) NULL,
    [BuySell] VARCHAR(10) NULL,
    [D] VARCHAR(10) NULL,
    [ClientType] VARCHAR(15) NULL,
    [ISIN] VARCHAR(25) NULL,
    [Group_name] VARCHAR(100) NULL,
    [OrderTime] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_trade_2
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_trade_2]
(
    [Heading] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_trade_3
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_trade_3]
(
    [BrokerID] VARCHAR(10) NULL,
    [TerminalID] VARCHAR(10) NULL,
    [ScriptCd] VARCHAR(10) NULL,
    [ScripName] VARCHAR(15) NULL,
    [Rate] VARCHAR(20) NULL,
    [Qty] VARCHAR(20) NULL,
    [A] VARCHAR(10) NULL,
    [B] VARCHAR(10) NULL,
    [TradeTime] VARCHAR(10) NULL,
    [TradeDate] VARCHAR(10) NULL,
    [ClientCode] VARCHAR(100) NULL,
    [OrderNo] VARCHAR(20) NULL,
    [C] VARCHAR(10) NULL,
    [BuySell] VARCHAR(10) NULL,
    [D] VARCHAR(10) NULL,
    [ClientType] VARCHAR(15) NULL,
    [ISIN] VARCHAR(25) NULL,
    [Group_name] VARCHAR(100) NULL,
    [Settle_no] VARCHAR(50) NULL,
    [OrderTime] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upld_DNC
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upld_DNC]
(
    [Fld_Upld] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload]
(
    [Upd_Srno] INT IDENTITY(1,1) NOT NULL,
    [Upd_Title] VARCHAR(100) NULL,
    [Upd_connection] VARCHAR(100) NULL,
    [Upd_TempTable] VARCHAR(100) NULL,
    [Upd_deli] VARCHAR(10) NULL,
    [upd_firstRow] INT NULL,
    [Upd_FinSP] VARCHAR(100) NULL,
    [Upd_Extension] VARCHAR(100) NULL,
    [Upd_info] VARCHAR(200) NULL,
    [Added_by] VARCHAR(100) NULL,
    [Added_on] DATETIME NULL,
    [Machine_IP] VARCHAR(100) NULL,
    [upload_format] VARCHAR(MAX) NULL,
    [parameter] VARCHAR(100) NULL,
    [GU_srno] VARCHAR(10) NULL,
    [ResultDisplay] VARCHAR(1) NULL,
    [ResultDisplayOpt] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload_03092009
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload_03092009]
(
    [Upd_Srno] INT IDENTITY(1,1) NOT NULL,
    [Upd_Title] VARCHAR(100) NULL,
    [Upd_connection] VARCHAR(100) NULL,
    [Upd_TempTable] VARCHAR(100) NULL,
    [Upd_deli] VARCHAR(10) NULL,
    [upd_firstRow] INT NULL,
    [Upd_FinSP] VARCHAR(100) NULL,
    [Upd_Extension] VARCHAR(100) NULL,
    [Upd_info] VARCHAR(200) NULL,
    [Added_by] VARCHAR(100) NULL,
    [Added_on] DATETIME NULL,
    [Machine_IP] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload_08092009
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload_08092009]
(
    [Upd_Srno] INT IDENTITY(1,1) NOT NULL,
    [Upd_Title] VARCHAR(100) NULL,
    [Upd_connection] VARCHAR(100) NULL,
    [Upd_TempTable] VARCHAR(100) NULL,
    [Upd_deli] VARCHAR(10) NULL,
    [upd_firstRow] INT NULL,
    [Upd_FinSP] VARCHAR(100) NULL,
    [Upd_Extension] VARCHAR(100) NULL,
    [Upd_info] VARCHAR(200) NULL,
    [Added_by] VARCHAR(100) NULL,
    [Added_on] DATETIME NULL,
    [Machine_IP] VARCHAR(100) NULL,
    [upload_format] VARCHAR(100) NULL,
    [parameter] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload_19122012
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload_19122012]
(
    [Upd_Srno] INT IDENTITY(1,1) NOT NULL,
    [Upd_Title] VARCHAR(100) NULL,
    [Upd_connection] VARCHAR(100) NULL,
    [Upd_TempTable] VARCHAR(100) NULL,
    [Upd_deli] VARCHAR(10) NULL,
    [upd_firstRow] INT NULL,
    [Upd_FinSP] VARCHAR(100) NULL,
    [Upd_Extension] VARCHAR(100) NULL,
    [Upd_info] VARCHAR(200) NULL,
    [Added_by] VARCHAR(100) NULL,
    [Added_on] DATETIME NULL,
    [Machine_IP] VARCHAR(100) NULL,
    [upload_format] VARCHAR(MAX) NULL,
    [parameter] VARCHAR(100) NULL,
    [GU_srno] VARCHAR(10) NULL,
    [ResultDisplay] VARCHAR(1) NULL,
    [ResultDisplayOpt] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload_axis
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload_axis]
(
    [Fld_Data] VARCHAR(220) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Upload_ClientID
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Upload_ClientID]
(
    [ClientId] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Upload_HDFC
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Upload_HDFC]
(
    [Fld_SrNo] VARCHAR(10) NULL,
    [Fld_Date] VARCHAR(100) NULL,
    [Fld_Desc] VARCHAR(50) NULL,
    [Fld_ChqNo] VARCHAR(50) NULL,
    [Fld_Cr_Dr] VARCHAR(50) NULL,
    [Fld_Trans_Amt] VARCHAR(50) NULL,
    [Fld_Bal] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Upload_ICICI
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Upload_ICICI]
(
    [Fld_id] VARCHAR(50) NULL,
    [Fld_Party_Code] VARCHAR(50) NULL,
    [Fld_Date] VARCHAR(50) NULL,
    [Fld_Narration] VARCHAR(100) NULL,
    [Fld_DrCr] VARCHAR(5) NULL,
    [Fld_Amt] VARCHAR(50) NULL,
    [Fld_Bal] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload_info
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload_info]
(
    [Updinfo_RptSrno] INT NULL,
    [Updinfo_filename] VARCHAR(200) NULL,
    [Updinfo_filesize] INT NULL,
    [Updinfo_fileType] VARCHAR(100) NULL,
    [Updinfo_datetime] DATETIME NULL,
    [Updinfo_by] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_upload_info_03092009
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_upload_info_03092009]
(
    [Updinfo_RptSrno] INT NULL,
    [Updinfo_filename] VARCHAR(200) NULL,
    [Updinfo_filesize] INT NULL,
    [Updinfo_fileType] VARCHAR(100) NULL,
    [Updinfo_datetime] DATETIME NULL,
    [Updinfo_by] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Upload_Kotak
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Upload_Kotak]
(
    [Fld_Date] VARCHAR(50) NULL,
    [Fld_Desc] VARCHAR(100) NULL,
    [Fld_ChqNo] VARCHAR(50) NULL,
    [Fld_Value_Date] VARCHAR(50) NULL,
    [Fld_Wit_Amt] VARCHAR(50) NULL,
    [Fld_Dep_amt] VARCHAR(50) NULL,
    [Fld_Bal] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_Upload_MCX_Margin
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_Upload_MCX_Margin]
(
    [Fld_Col1] VARCHAR(10) NULL,
    [Fld_Scrip_Cd] VARCHAR(25) NULL,
    [Fld_Series] VARCHAR(10) NULL,
    [Fld_Isin] VARCHAR(15) NULL,
    [Fld_Var] VARCHAR(20) NULL,
    [Fld_Col2] VARCHAR(20) NULL,
    [Fld_Col3] VARCHAR(15) NULL,
    [Fld_Col4] VARCHAR(15) NULL,
    [Fld_Col5] VARCHAR(15) NULL,
    [Fld_Col6] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_uploadnbfc_clientlist
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_uploadnbfc_clientlist]
(
    [party_code] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Uptime_report
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Uptime_report]
(
    [sr_no] INT IDENTITY(1,1) NOT NULL,
    [tdate] DATETIME NOT NULL,
    [Bse] VARCHAR(25) NULL,
    [Cm] VARCHAR(25) NULL,
    [Fo] VARCHAR(25) NULL,
    [Mcx] VARCHAR(25) NULL,
    [Ncdex] VARCHAR(25) NULL,
    [ACDLNSX] VARCHAR(25) NULL,
    [ACPLMCD] VARCHAR(25) NULL,
    [cnt] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Uptime_report1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Uptime_report1]
(
    [sr_no] INT IDENTITY(1,1) NOT NULL,
    [tdate] DATETIME NOT NULL,
    [Bse] VARCHAR(25) NULL,
    [Cm] VARCHAR(25) NULL,
    [Fo] VARCHAR(25) NULL,
    [Mcx] VARCHAR(25) NULL,
    [Ncdex] VARCHAR(25) NULL,
    [ACDLNSX] VARCHAR(25) NULL,
    [ACPLMCD] VARCHAR(25) NULL,
    [cnt] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_UserInfoLogTime
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_UserInfoLogTime]
(
    [ProcessName] VARCHAR(100) NULL,
    [StartTime] DATETIME NULL,
    [EndTime] DATETIME NULL,
    [UserCount] VARCHAR(10) NULL,
    [managerId] VARCHAR(20) NULL,
    [UserName] VARCHAR(100) NULL,
    [IPAddrss] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_VA_Ledger
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_VA_Ledger]
(
    [Fld_Stat] VARCHAR(140) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_VA_Ledger_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_VA_Ledger_1]
(
    [Fld_SRNo] INT IDENTITY(1,1) NOT NULL,
    [Fld_Stat] VARCHAR(140) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_XYZ
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_XYZ]
(
    [A] VARCHAR(50) NULL,
    [B] VARCHAR(50) NULL,
    [C] VARCHAR(50) NULL,
    [D] VARCHAR(50) NULL,
    [E] VARCHAR(50) NULL,
    [F] VARCHAR(50) NULL,
    [G] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblFileStatus
-- --------------------------------------------------
CREATE TABLE [dbo].[tblFileStatus]
(
    [FileExists] BIT NULL,
    [FileisDirectory] BIT NULL,
    [ParentDirectoryExists] BIT NULL,
    [FileDt] DATETIME NOT NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblNonPromotersHolding
-- --------------------------------------------------
CREATE TABLE [dbo].[tblNonPromotersHolding]
(
    [srno] INT NOT NULL,
    [symbol] VARCHAR(50) NULL,
    [volume] NUMERIC(18, 0) NULL,
    [date] VARCHAR(11) NULL,
    [fname] VARCHAR(50) NULL,
    [uploadDt] DATETIME NOT NULL,
    [uploded] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblNonPromotersHolding_Temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tblNonPromotersHolding_Temp]
(
    [srno] INT NOT NULL,
    [symbol] VARCHAR(50) NULL,
    [volume] NUMERIC(18, 0) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblNRIPISLimit_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tblNRIPISLimit_temp]
(
    [party_code] VARCHAR(20) NULL,
    [LmtAllowEquity] MONEY NULL,
    [LmtAllowCommodity] MONEY NULL,
    [PMSScheme] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblnseSpan
-- --------------------------------------------------
CREATE TABLE [dbo].[tblnseSpan]
(
    [Sec_Name] VARCHAR(50) NULL,
    [Extreme_Loss] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tblnseSpan1
-- --------------------------------------------------
CREATE TABLE [dbo].[tblnseSpan1]
(
    [Security_Name] VARCHAR(50) NULL,
    [Security_Series] VARCHAR(50) NULL,
    [Extreme_Loss] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp
-- --------------------------------------------------
CREATE TABLE [dbo].[temp]
(
    [ireq] CHAR(20) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_akruti65
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_akruti65]
(
    [OpCode] VARCHAR(50) NULL,
    [User Id] VARCHAR(255) NULL,
    [Group Id] VARCHAR(255) NULL,
    [UserName] VARCHAR(255) NULL,
    [Password] VARCHAR(255) NULL,
    [Category] VARCHAR(50) NULL,
    [Address1] VARCHAR(255) NULL,
    [Address2] VARCHAR(255) NULL,
    [City] VARCHAR(255) NULL,
    [State pin] VARCHAR(255) NULL,
    [Telephone No] VARCHAR(255) NULL,
    [Fax No] VARCHAR(255) NULL,
    [Email] VARCHAR(255) NULL,
    [Status] VARCHAR(255) NULL,
    [Brokerage] FLOAT NULL,
    [Surv On/Off] FLOAT NULL,
    [Surv Auto/Manual] FLOAT NULL,
    [BankDPOnOff] FLOAT NULL,
    [ParticipantCode] VARCHAR(255) NULL,
    [Filler] VARCHAR(255) NULL,
    [Filler1] VARCHAR(255) NULL,
    [Filler2] VARCHAR(255) NULL,
    [Filler3] VARCHAR(255) NULL,
    [Trading Allowed] FLOAT NULL,
    [ClientValidationOnOff] FLOAT NULL,
    [SpanOnOff] FLOAT NULL,
    [DervPartCode] VARCHAR(255) NULL,
    [IP Address] VARCHAR(255) NULL,
    [MaxNoOfOrder] VARCHAR(255) NULL,
    [Max# BCast Scrips] VARCHAR(255) NULL,
    [Alias DealerId] VARCHAR(255) NULL,
    [Family Name] VARCHAR(255) NULL,
    [EqFlag] FLOAT NULL,
    [DervFlag] FLOAT NULL,
    [CombFlag] FLOAT NULL,
    [BSEEq] FLOAT NULL,
    [NEBEComb] FLOAT NULL,
    [NEBEEq] FLOAT NULL,
    [NSE Cash CTCL BranchID] VARCHAR(255) NULL,
    [NSE Cash CTCLId] VARCHAR(255) NULL,
    [Branch Name] VARCHAR(255) NULL,
    [Derv CTCL Branch Id] VARCHAR(255) NULL,
    [Derv CTCL Id] VARCHAR(255) NULL,
    [Group Admin] VARCHAR(255) NULL,
    [BSE Cash CTCL Branch Id] VARCHAR(255) NULL,
    [BSE Cash CTCL Id] VARCHAR(255) NULL,
    [Login Allowed] INT NULL,
    [Participant Type] VARCHAR(255) NULL,
    [Diet] INT NULL,
    [net] INT NULL,
    [iwin] INT NULL,
    [Net Net Lite] INT NULL,
    [MCX CTCL BranchId] VARCHAR(255) NULL,
    [MCX CTCL Id] VARCHAR(255) NULL,
    [NCDEX CTCL BranchId] VARCHAR(255) NULL,
    [NCDEX CTCL Id] VARCHAR(255) NULL,
    [Product Type1] VARCHAR(100) NULL,
    [NSEL CTCL BranchId] VARCHAR(100) NULL,
    [NSEL CTCL Id] VARCHAR(100) NULL,
    [MCXSX CTCL BranchId] VARCHAR(100) NULL,
    [MCXSX CTCL Id] VARCHAR(100) NULL,
    [NSX CTCL BranchId] VARCHAR(100) NULL,
    [NSX CTCL Id] VARCHAR(100) NULL,
    [Market Data Allowed] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_BlockScrip_Bse
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_BlockScrip_Bse]
(
    [ScriptCode] VARCHAR(50) NULL,
    [BseScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_BlockScrip_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_BlockScrip_nse]
(
    [ScriptCode] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [ScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [CapitalOfCo] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_CNT2Bulk
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_CNT2Bulk]
(
    [Party_code] NCHAR(10) NULL,
    [Scheme] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_CNT2Bulk_log
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_CNT2Bulk_log]
(
    [party_code] VARCHAR(20) NULL,
    [scheme] INT NULL,
    [uploded_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_CNT2Bulk_new
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_CNT2Bulk_new]
(
    [Party_code] NCHAR(10) NULL,
    [Scheme] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_CNT2Bulk_r
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_CNT2Bulk_r]
(
    [Party_code] NCHAR(10) NULL,
    [Scheme] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_deleteRepliCTCLid
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_deleteRepliCTCLid]
(
    [fld_RecordNo] INT NOT NULL,
    [fld_DisableReason] VARCHAR(100) NULL,
    [fld_server] VARCHAR(100) NULL,
    [Cnt] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_deleteRepliCTCLid_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_deleteRepliCTCLid_BSE]
(
    [fld_RecordNo] INT NOT NULL,
    [fld_DisableReason] VARCHAR(100) NULL,
    [fld_server] VARCHAR(100) NULL,
    [Cnt] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_dtc
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_dtc]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_failed
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_failed]
(
    [Party_code] NCHAR(10) NULL,
    [Scheme] INT NULL,
    [generatedate] DATETIME NULL,
    [servermapped] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_failed_r
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_failed_r]
(
    [Party_code] NCHAR(10) NULL,
    [Scheme] INT NULL,
    [generatedate] DATETIME NULL,
    [servermapped] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_file
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_file]
(
    [heading] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TEMP_IP_LOC_IND_TBL1
-- --------------------------------------------------
CREATE TABLE [dbo].[TEMP_IP_LOC_IND_TBL1]
(
    [ipfrom] FLOAT NOT NULL,
    [ipto] FLOAT NOT NULL,
    [countryshort] VARCHAR(4) NULL,
    [country] VARCHAR(128) NULL,
    [state] VARCHAR(256) NULL,
    [city] VARCHAR(256) NULL,
    [isp] VARCHAR(510) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_marginshortfall
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_marginshortfall]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [RoCode] VARCHAR(20) NULL,
    [BranchCode] VARCHAR(20) NULL,
    [FamilyCode] VARCHAR(15) NULL,
    [ClientCode] VARCHAR(15) NULL,
    [ClientName] VARCHAR(75) NULL,
    [LedgeBalance] FLOAT NULL,
    [Collateral] FLOAT NULL,
    [FO_SpanMargin] FLOAT NULL,
    [FO_Shortfall] FLOAT NULL,
    [FO_PercOfPenalty] FLOAT NULL,
    [FO_PenaltyAmount] FLOAT NULL,
    [NSX_SpanMargin] FLOAT NULL,
    [NSX_Shortfall] FLOAT NULL,
    [NSX_PercOfPenalty] FLOAT NULL,
    [NSX_PenaltyAmount] FLOAT NULL,
    [MCDSpanMargin] FLOAT NULL,
    [MCDShortfall] FLOAT NULL,
    [MCDPercOfPenalty] FLOAT NULL,
    [MCDPenaltyAmount] FLOAT NULL,
    [UploadedDatetime] DATETIME NULL,
    [UploadedBy] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Temp_MCDX_Margin
-- --------------------------------------------------
CREATE TABLE [dbo].[Temp_MCDX_Margin]
(
    [Symbol] VARCHAR(15) NULL,
    [ExpiryDate] DATETIME NULL,
    [Price] MONEY NULL,
    [Multiplier] INT NULL,
    [IM] MONEY NULL,
    [SBM] MONEY NULL,
    [SSM] MONEY NULL,
    [AML] MONEY NULL,
    [AMS] MONEY NULL,
    [TenderM] MONEY NULL,
    [TM] MONEY NULL,
    [ICV] MONEY NULL,
    [Margin] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mcx
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mcx]
(
    [Symbol] VARCHAR(50) NULL,
    [ExpiryDate] VARCHAR(15) NULL,
    [Price] MONEY NULL,
    [Multiplier] MONEY NULL,
    [I_M] MONEY NULL,
    [S_B_M] MONEY NULL,
    [S_S_M] MONEY NULL,
    [A_M_L] MONEY NULL,
    [A_M_S] MONEY NULL,
    [Tender_M] MONEY NULL,
    [T_M] MONEY NULL,
    [I_C_V] MONEY NULL,
    [Margin] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_ncdex_bhav_copy
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_ncdex_bhav_copy]
(
    [Instrument_Type] VARCHAR(250) NULL,
    [Symbol] VARCHAR(250) NULL,
    [Expiry_Date] VARCHAR(250) NULL,
    [Commodity] VARCHAR(250) NULL,
    [Strike_Price] VARCHAR(250) NULL,
    [Option_Type] VARCHAR(250) NULL,
    [Delivery_Center] VARCHAR(250) NULL,
    [Price_Unit] VARCHAR(50) NULL,
    [Opening_price] VARCHAR(50) NULL,
    [High_Price] VARCHAR(50) NULL,
    [Low_Price] VARCHAR(50) NULL,
    [Closing_Price] VARCHAR(50) NULL,
    [Qty_Traded_Today] VARCHAR(50) NULL,
    [Measure] VARCHAR(50) NULL,
    [No_Of_Trades] VARCHAR(50) NULL,
    [Trade_Amt] VARCHAR(50) NULL,
    [Open_Interest] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_ncdex_ps03
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_ncdex_ps03]
(
    [Position_Date] VARCHAR(255) NULL,
    [Segment_Indicator] VARCHAR(255) NULL,
    [Settlement_Type] VARCHAR(255) NULL,
    [CM_Code] VARCHAR(255) NULL,
    [Member_Type] VARCHAR(255) NULL,
    [Trading Member_Code] VARCHAR(255) NULL,
    [Account_Type] VARCHAR(255) NULL,
    [Client_Code] VARCHAR(255) NULL,
    [Instrument_Type] VARCHAR(255) NULL,
    [Symbol] VARCHAR(255) NULL,
    [Expiry_date] VARCHAR(255) NULL,
    [Strike_Price] VARCHAR(255) NULL,
    [Option_Type] VARCHAR(255) NULL,
    [CA_Level] VARCHAR(255) NULL,
    [BF_long_quantity] INT NULL,
    [BF_Long_Value] MONEY NULL,
    [BF_Short_quantity] INT NULL,
    [BF_Short_Value] MONEY NULL,
    [DayBuyOpenQuantity] INT NULL,
    [DayBuyOpenValue] MONEY NULL,
    [DaySellOpenQuantity] INT NULL,
    [DaySellOpenValue] MONEY NULL,
    [PreExerciseAssignmentLongQuantity] VARCHAR(255) NULL,
    [PreExerciseAssignmentLongValue] VARCHAR(255) NULL,
    [PreExerciseAssignmentShortQuantity] VARCHAR(255) NULL,
    [PreExerciseAssignmentShortValue] VARCHAR(255) NULL,
    [ExercisedQuantity] VARCHAR(255) NULL,
    [AssignedQuantity] VARCHAR(255) NULL,
    [PostExerciseAssignmentLongQuantity] VARCHAR(255) NULL,
    [PostExerciseAssignmentLongValue] VARCHAR(255) NULL,
    [PostExercise AssignmentShortQuantity] VARCHAR(255) NULL,
    [PostExerciseAssignmentShortValue] VARCHAR(255) NULL,
    [SettlementPrice] VARCHAR(255) NULL,
    [NetPremium] VARCHAR(255) NULL,
    [Daily_MTM_Settlement_Value] VARCHAR(255) NULL,
    [Futures_final_Sett_value] VARCHAR(255) NULL,
    [Exercised_Assigned_Value_Calculated] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Temp_NCDX_Margin
-- --------------------------------------------------
CREATE TABLE [dbo].[Temp_NCDX_Margin]
(
    [Symbol] VARCHAR(15) NULL,
    [ExpiryDate] DATETIME NULL,
    [Price] MONEY NULL,
    [Multiplier] INT NULL,
    [IM] MONEY NULL,
    [EM] MONEY NULL,
    [APEM] MONEY NULL,
    [TM] MONEY NULL,
    [AML] MONEY NULL,
    [AMS] MONEY NULL,
    [SCML] MONEY NULL,
    [SCMS] MONEY NULL,
    [ICV] MONEY NULL,
    [Margin] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_Nse_currency
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_Nse_currency]
(
    [Trade_no] INT NULL,
    [Trade_Status] INT NULL,
    [Instrument_ID] INT NULL,
    [Instrument_Name] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [expirydate] SMALLDATETIME NULL,
    [Reserved] VARCHAR(20) NULL,
    [Strike Price] MONEY NULL,
    [Reserved1] VARCHAR(20) NULL,
    [Options Type] VARCHAR(25) NULL,
    [Product Description] INT NULL,
    [Book Tpe Name] VARCHAR(20) NULL,
    [Book Type] INT NULL,
    [user id] INT NULL,
    [Branch No] INT NULL,
    [Buy Sell] INT NULL,
    [Trade quantity] INT NULL,
    [Price] MONEY NULL,
    [Account Type] INT NULL,
    [Account ID] VARCHAR(25) NULL,
    [Participant Settler] INT NULL,
    [Spread Price] MONEY NULL,
    [TM ID] VARCHAR(50) NULL,
    [Reserved3] VARCHAR(20) NULL,
    [Activity Time] SMALLDATETIME NULL,
    [Last Modified time] SMALLDATETIME NULL,
    [Order Number] VARCHAR(20) NULL,
    [Opposite Broker Id] VARCHAR(10) NULL,
    [Order User Last Update Time] SMALLDATETIME NULL,
    [Mod Date Time] SMALLDATETIME NULL,
    [Order Entered/Mod Date Time] SMALLDATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_omnesys_userInfo
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_omnesys_userInfo]
(
    [userid] VARCHAR(200) NULL,
    [username] VARCHAR(200) NULL,
    [useraddress] VARCHAR(200) NULL,
    [userType] VARCHAR(200) NULL,
    [ExchUser] VARCHAR(200) NULL,
    [StatusIndicator] VARCHAR(200) NULL,
    [ExprDate] VARCHAR(200) NULL,
    [DaysToExpr] VARCHAR(200) NULL,
    [Product] VARCHAR(200) NULL,
    [ProdEnabled] VARCHAR(200) NULL,
    [Pswd] VARCHAR(15) NULL,
    [DispPriceDec] VARCHAR(10) NULL,
    [Branch] VARCHAR(200) NULL,
    [Brokr] VARCHAR(200) NULL,
    [userAccessType] VARCHAR(200) NULL,
    [userRole] VARCHAR(1200) NULL,
    [SpecPriceType] VARCHAR(150) NULL,
    [Email] VARCHAR(250) NULL,
    [PwdReset] VARCHAR(50) NULL,
    [UserStatus] VARCHAR(50) NULL,
    [ClientOverview] VARCHAR(50) NULL,
    [FirmOrdersEnabled] VARCHAR(50) NULL,
    [TransPwdReset] VARCHAR(50) NULL,
    [TransPwd] VARCHAR(50) NULL,
    [SourceUserId] VARCHAR(50) NULL,
    [Time_Stamp] VARCHAR(25) NULL,
    [PANNo] VARCHAR(25) NULL,
    [CreationDate] VARCHAR(25) NULL,
    [City] VARCHAR(50) NULL,
    [Stat] VARCHAR(50) NULL,
    [Zip] VARCHAR(50) NULL,
    [DOB] VARCHAR(25) NULL,
    [LastName] VARCHAR(50) NULL,
    [CellNo] VARCHAR(50) NULL,
    [FirmId] VARCHAR(50) NULL,
    [AlwaysOk] VARCHAR(50) NULL,
    [IPAddr] VARCHAR(50) NULL,
    [MACAddr] VARCHAR(50) NULL,
    [UserTag] VARCHAR(50) NULL,
    [MaxMWScripCount] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_PD
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_PD]
(
    [MKT] VARCHAR(10) NULL,
    [SERIES] VARCHAR(10) NULL,
    [SYMBOL] VARCHAR(25) NULL,
    [SECURITY] VARCHAR(100) NULL,
    [PREV_CL_PR] MONEY NULL,
    [OPEN_PRICE] MONEY NULL,
    [HIGH_PRICE] MONEY NULL,
    [LOW_PRICE] MONEY NULL,
    [CLOSE_PRICE] MONEY NULL,
    [NET_TRDVAL] MONEY NULL,
    [NET_TRDQTY] BIGINT NULL,
    [IND_SEC] VARCHAR(10) NULL,
    [CORP_IND] VARCHAR(10) NULL,
    [TRADES] INT NULL,
    [HI_52_WK] MONEY NULL,
    [LO_52_WK] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_QE
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_QE]
(
    [SC_CODE] VARCHAR(20) NULL,
    [SC_NAME] VARCHAR(20) NULL,
    [SC_GROUP] VARCHAR(20) NULL,
    [SC_TYPE] VARCHAR(20) NULL,
    [QUOT_1] MONEY NULL,
    [QUOT_2] MONEY NULL,
    [QUOT_3] MONEY NULL,
    [QUOT_4] MONEY NULL,
    [TDCLOINDI] VARCHAR(20) NULL,
    [NO_TRADES] VARCHAR(20) NULL,
    [NO_OF_SHRS] VARCHAR(20) NULL,
    [NET_TURNOV] VARCHAR(20) NULL,
    [ROLLING] VARCHAR(20) NULL,
    [LAST_PRICE] VARCHAR(20) NULL,
    [PRCLORATE] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_Rej_update_log
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_Rej_update_log]
(
    [Cur_Date] DATETIME NULL,
    [Location] VARCHAR(10) NULL,
    [err_status] VARCHAR(150) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_sebiforcefuldata
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_sebiforcefuldata]
(
    [party_code] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_srvall
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_srvall]
(
    [Party_Code] VARCHAR(100) NULL,
    [Segment_Allowed_code] INT NULL,
    [PWD] VARCHAR(50) NULL,
    [NRIFlg] CHAR(10) NULL,
    [Product_type] CHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_stockdata
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_stockdata]
(
    [itemid] VARCHAR(100) NULL,
    [itemname] VARCHAR(100) NULL,
    [total_qty] VARCHAR(100) NULL,
    [minlevel] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_tbl
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_tbl]
(
    [a] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_TempPenalExcludeClient
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_TempPenalExcludeClient]
(
    [Party_code] VARCHAR(10) NULL,
    [SBCode] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_test_uni
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_test_uni]
(
    [data] VARCHAR(200) NULL,
    [today] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_uploadRetroBulkData
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_uploadRetroBulkData]
(
    [Party_Code] VARCHAR(10) NULL,
    [Segment] VARCHAR(10) NULL,
    [VoucherNo] VARCHAR(50) NULL,
    [Consideration] VARCHAR(11) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp1
-- --------------------------------------------------
CREATE TABLE [dbo].[temp1]
(
    [purchase1] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp1_BlockScrip_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[temp1_BlockScrip_nse]
(
    [ScriptCode] VARCHAR(50) NULL,
    [Symbol] VARCHAR(50) NULL,
    [ScriptName] VARCHAR(50) NULL,
    [Group] VARCHAR(50) NULL,
    [CapitalOfCo] VARCHAR(50) NOT NULL,
    [delete_status] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp12
-- --------------------------------------------------
CREATE TABLE [dbo].[temp12]
(
    [abcde] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp1234
-- --------------------------------------------------
CREATE TABLE [dbo].[temp1234]
(
    [Transaction_report] VARCHAR(164) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempab
-- --------------------------------------------------
CREATE TABLE [dbo].[tempab]
(
    [abcd] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempabc
-- --------------------------------------------------
CREATE TABLE [dbo].[tempabc]
(
    [itemid] VARCHAR(20) NOT NULL,
    [sum] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempBankCms
-- --------------------------------------------------
CREATE TABLE [dbo].[tempBankCms]
(
    [row_type] VARCHAR(255) NULL,
    [entry_id] VARCHAR(255) NULL,
    [type_of_en] VARCHAR(255) NULL,
    [dr_cr] VARCHAR(255) NULL,
    [entry_amt] VARCHAR(255) NULL,
    [val_dt] VARCHAR(255) NULL,
    [post_dt] VARCHAR(255) NULL,
    [prod_code] VARCHAR(255) NULL,
    [pkup_loc] VARCHAR(255) NULL,
    [pkup_pt] VARCHAR(255) NULL,
    [pkup_dt] VARCHAR(255) NULL,
    [dept_slip] VARCHAR(255) NULL,
    [dept_dt] VARCHAR(255) NULL,
    [dept_amt] VARCHAR(255) NULL,
    [no_of_inst] VARCHAR(255) NULL,
    [dept_rmk] VARCHAR(255) NULL,
    [inst_no] VARCHAR(255) NULL,
    [drawee_bk] VARCHAR(255) NULL,
    [cl_loc] VARCHAR(255) NULL,
    [inst_amt] VARCHAR(255) NULL,
    [inst_dt] VARCHAR(255) NULL,
    [drawer_nam] VARCHAR(255) NULL,
    [enric_details] VARCHAR(255) NULL,
    [return reason] VARCHAR(255) NULL,
    [Col025] VARCHAR(7552) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TempMail
-- --------------------------------------------------
CREATE TABLE [dbo].[TempMail]
(
    [Empcode] VARCHAR(4) NOT NULL,
    [mail] VARCHAR(3) NOT NULL,
    [branch] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempSccsBlkIsin
-- --------------------------------------------------
CREATE TABLE [dbo].[tempSccsBlkIsin]
(
    [isin] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temptbl
-- --------------------------------------------------
CREATE TABLE [dbo].[temptbl]
(
    [PO_ID] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temptbl1
-- --------------------------------------------------
CREATE TABLE [dbo].[temptbl1]
(
    [sum_totalqty] FLOAT NULL,
    [itemid] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Test
-- --------------------------------------------------
CREATE TABLE [dbo].[Test]
(
    [T1] VARCHAR(11) NULL,
    [T2] VARCHAR(11) NULL,
    [T3] VARCHAR(11) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_admin
-- --------------------------------------------------
CREATE TABLE [dbo].[test_admin]
(
    [Column 0] VARCHAR(50) NULL,
    [Column 1] VARCHAR(50) NULL,
    [Column 2] VARCHAR(50) NULL,
    [Column 3] VARCHAR(50) NULL,
    [Column 4] VARCHAR(50) NULL,
    [Column 5] VARCHAR(50) NULL,
    [Column 6] VARCHAR(50) NULL,
    [Column 7] VARCHAR(50) NULL,
    [Column 8] VARCHAR(50) NULL,
    [Column 9] VARCHAR(50) NULL,
    [Column 10] VARCHAR(50) NULL,
    [Column 11] VARCHAR(50) NULL,
    [Column 12] VARCHAR(50) NULL,
    [Column 13] VARCHAR(50) NULL,
    [Column 14] VARCHAR(50) NULL,
    [Column 15] VARCHAR(50) NULL,
    [Column 16] VARCHAR(50) NULL,
    [Column 17] VARCHAR(50) NULL,
    [Column 18] VARCHAR(50) NULL,
    [Column 19] VARCHAR(50) NULL,
    [Column 20] VARCHAR(50) NULL,
    [Column 21] VARCHAR(50) NULL,
    [Column 22] VARCHAR(50) NULL,
    [Column 23] VARCHAR(50) NULL,
    [Column 24] VARCHAR(50) NULL,
    [Column 25] VARCHAR(50) NULL,
    [Column 26] VARCHAR(50) NULL,
    [Column 27] VARCHAR(50) NULL,
    [Column 28] VARCHAR(50) NULL,
    [Column 29] VARCHAR(50) NULL,
    [Column 30] VARCHAR(50) NULL,
    [Column 31] VARCHAR(50) NULL,
    [Column 32] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_et
-- --------------------------------------------------
CREATE TABLE [dbo].[test_et]
(
    [Sr_No] INT NOT NULL,
    [Bank_Name] VARCHAR(255) NULL,
    [Branch_Name] VARCHAR(255) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Ifsc_Code] VARCHAR(255) NOT NULL,
    [Micr_Code] VARCHAR(255) NULL,
    [Bank_Accno_Length] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_neft
-- --------------------------------------------------
CREATE TABLE [dbo].[test_neft]
(
    [Sr_No] INT IDENTITY(1,1) NOT NULL,
    [Bank_Name] VARCHAR(255) NULL,
    [Branch_Name] VARCHAR(255) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Ifsc_Code] VARCHAR(255) NULL,
    [Micr_Code] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_rtgs
-- --------------------------------------------------
CREATE TABLE [dbo].[test_rtgs]
(
    [Sr_No] INT IDENTITY(1,1) NOT NULL,
    [Bank_Name] VARCHAR(255) NULL,
    [Branch_Name] VARCHAR(255) NULL,
    [Branch_Address] VARCHAR(500) NULL,
    [Ifsc_Code] VARCHAR(255) NULL,
    [Micr_Code] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test1_rgts
-- --------------------------------------------------
CREATE TABLE [dbo].[test1_rgts]
(
    [Sr_No] INT IDENTITY(1,1) NOT NULL,
    [Bank_Name] VARCHAR(100) NULL,
    [Ifsc_Code] VARCHAR(100) NULL,
    [Branch_Address] VARCHAR(255) NULL,
    [Branch_Name] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.testing
-- --------------------------------------------------
CREATE TABLE [dbo].[testing]
(
    [Name] VARCHAR(15) NULL,
    [Year] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TICKER_IMG_UPLOAD1
-- --------------------------------------------------
CREATE TABLE [dbo].[TICKER_IMG_UPLOAD1]
(
    [ANGEL_TICKER_ID] INT NOT NULL,
    [TICKER_MESSAGE] VARCHAR(60) NULL,
    [DATE_FROM] DATETIME NULL,
    [TIME_FROM] VARCHAR(5) NULL,
    [DATE_TO] DATETIME NULL,
    [TIME_TO] VARCHAR(5) NULL,
    [IMAGE_NAME] VARCHAR(200) NULL,
    [IMAGE_CONTENT] VARBINARY(MAX) NULL,
    [CREATED_BY] VARCHAR(10) NULL,
    [CREATED_DATE] DATETIME NULL,
    [MODIFIED_BY] VARCHAR(10) NULL,
    [MODIFIED_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tlb_Bank_Statment
-- --------------------------------------------------
CREATE TABLE [dbo].[tlb_Bank_Statment]
(
    [Fld_Stat] VARCHAR(140) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tlb_Bank_Statment_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tlb_Bank_Statment_1]
(
    [Fld_Sr_No] INT IDENTITY(1,1) NOT NULL,
    [Fld_Stat] VARCHAR(140) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tlb_Gen_File
-- --------------------------------------------------
CREATE TABLE [dbo].[tlb_Gen_File]
(
    [Fld_stat] VARCHAR(140) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tlb_ICICIBank_Statment_1
-- --------------------------------------------------
CREATE TABLE [dbo].[tlb_ICICIBank_Statment_1]
(
    [Acc_number] VARCHAR(200) NULL,
    [Tran_date] VARCHAR(10) NULL,
    [Tran_Particular] VARCHAR(100) NULL,
    [Tran_Remarks] VARCHAR(50) NULL,
    [Inst_Num] VARCHAR(20) NULL,
    [Orig_Sol_Id] VARCHAR(20) NULL,
    [Currency_Code] VARCHAR(20) NULL,
    [Dr_Tran_Amt] VARCHAR(25) NULL,
    [Cr_Tran_Amt] VARCHAR(25) NULL,
    [Bal_Amt] VARCHAR(25) NULL,
    [Deposit_Branch] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tlb_ICICIGen_File
-- --------------------------------------------------
CREATE TABLE [dbo].[tlb_ICICIGen_File]
(
    [fld_stat] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tlb_ICICIReco_file
-- --------------------------------------------------
CREATE TABLE [dbo].[tlb_ICICIReco_file]
(
    [BookDate] VARCHAR(10) NULL,
    [Description] VARCHAR(100) NULL,
    [LedgerBalance] VARCHAR(25) NULL,
    [Credit] VARCHAR(25) NULL,
    [Debit] VARCHAR(25) NULL,
    [ValueDate] VARCHAR(11) NULL,
    [ReferenceNo] INT NOT NULL,
    [TransactionBranch] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TMP_CDSL_ISIN
-- --------------------------------------------------
CREATE TABLE [dbo].[TMP_CDSL_ISIN]
(
    [ISIN_Name] NVARCHAR(50) NULL,
    [ISIN] NVARCHAR(50) NULL,
    [ISIN_Status] NVARCHAR(50) NULL,
    [Freeze_Reason] NVARCHAR(50) NULL,
    [Column 4] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tmpbse1
-- --------------------------------------------------
CREATE TABLE [dbo].[tmpbse1]
(
    [COL1] VARCHAR(255) NULL,
    [COL2] VARCHAR(255) NULL,
    [COL3] VARCHAR(255) NULL,
    [COL4] VARCHAR(255) NULL,
    [COL5] VARCHAR(255) NULL,
    [COL6] VARCHAR(255) NULL,
    [COL7] VARCHAR(255) NULL,
    [COL8] VARCHAR(255) NULL,
    [COL9] VARCHAR(255) NULL,
    [COL10] VARCHAR(255) NULL,
    [COL11] VARCHAR(255) NULL,
    [COL12] VARCHAR(255) NULL,
    [COL13] VARCHAR(255) NULL,
    [COL14] VARCHAR(255) NULL,
    [COL15] VARCHAR(255) NULL,
    [COL16] VARCHAR(255) NULL,
    [COL17] VARCHAR(255) NULL,
    [COL18] VARCHAR(255) NULL,
    [COL19] VARCHAR(255) NULL,
    [COL20] VARCHAR(255) NULL,
    [COL21] VARCHAR(255) NULL,
    [COL22] VARCHAR(255) NULL,
    [COL23] VARCHAR(255) NULL,
    [COL24] VARCHAR(255) NULL,
    [COL25] VARCHAR(255) NULL,
    [COL26] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tmpnse
-- --------------------------------------------------
CREATE TABLE [dbo].[tmpnse]
(
    [NSeSymbol] VARCHAR(100) NULL,
    [NSESeries] VARCHAR(100) NULL,
    [Description] VARCHAR(100) NULL,
    [NSECode] VARCHAR(100) NULL,
    [ISIN] VARCHAR(100) NULL,
    [NSeStatus] VARCHAR(100) NULL,
    [TickPrice] VARCHAR(100) NULL,
    [FaceValue] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.totpcode
-- --------------------------------------------------
CREATE TABLE [dbo].[totpcode]
(
    [party_code] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tr_entry
-- --------------------------------------------------
CREATE TABLE [dbo].[tr_entry]
(
    [Region] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Product] NVARCHAR(255) NULL,
    [Fund] NVARCHAR(255) NULL,
    [Scheme] NVARCHAR(255) NULL,
    [E-CODE] VARCHAR(255) NULL,
    [Party] NVARCHAR(255) NULL,
    [Category] NVARCHAR(255) NULL,
    [Parent Code] NVARCHAR(255) NULL,
    [Group Leader] NVARCHAR(255) NULL,
    [Applicant] NVARCHAR(255) NULL,
    [Tran Date] VARCHAR(255) NULL,
    [NAV Date] VARCHAR(255) NULL,
    [Tran Type] VARCHAR(255) NULL,
    [AR No/No Of Instlments] VARCHAR(255) NULL,
    [Folio No] VARCHAR(255) NULL,
    [Bank Name] VARCHAR(255) NULL,
    [App No] VARCHAR(255) NULL,
    [Cheque No] VARCHAR(255) NULL,
    [Cheque Date] VARCHAR(255) NULL,
    [Amount] VARCHAR(255) NULL,
    [Rate IN] VARCHAR(255) NULL,
    [Amount IN] VARCHAR(255) NULL,
    [Incentive IN] VARCHAR(255) NULL,
    [Net Brok] VARCHAR(255) NULL,
    [STax] VARCHAR(255) NULL,
    [Rate OUT] VARCHAR(255) NULL,
    [Amount OUT] VARCHAR(255) NULL,
    [MSA] VARCHAR(255) NULL,
    [Retention] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TR_IMAGE_UPLOAD
-- --------------------------------------------------
CREATE TABLE [dbo].[TR_IMAGE_UPLOAD]
(
    [IMAGE_UPLOAD_ID] INT NOT NULL,
    [IMAGE_NAME] VARCHAR(50) NULL,
    [CLIENT_ID] VARCHAR(50) NULL,
    [IMAGE_CONTENT] VARBINARY(MAX) NULL,
    [APPLICATION_NAME] VARCHAR(50) NULL,
    [UPLOADED_BY] VARCHAR(50) NULL,
    [UPLOADED_DATE] DATETIME NULL,
    [MODIFIED_BY] VARCHAR(50) NULL,
    [MODIFIED_DATE] DATETIME NULL,
    [DDNO] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TR_IMAGE_UPLOAD_
-- --------------------------------------------------
CREATE TABLE [dbo].[TR_IMAGE_UPLOAD_]
(
    [IMAGE_UPLOAD_ID] INT NOT NULL,
    [IMAGE_NAME] VARCHAR(50) NULL,
    [CLIENT_ID] VARCHAR(50) NULL,
    [IMAGE_CONTENT] VARBINARY(MAX) NULL,
    [APPLICATION_NAME] VARCHAR(50) NULL,
    [UPLOADED_BY] VARCHAR(50) NULL,
    [UPLOADED_DATE] DATETIME NULL,
    [MODIFIED_BY] VARCHAR(50) NULL,
    [MODIFIED_DATE] DATETIME NULL,
    [DDNO] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TR_IMG_UPLOAD1
-- --------------------------------------------------
CREATE TABLE [dbo].[TR_IMG_UPLOAD1]
(
    [IMG_UPLOAD_ID] INT NOT NULL,
    [POPUP_NAME] VARCHAR(200) NOT NULL,
    [FOR_EMP] BIT NOT NULL,
    [FOR_SB_ADMIN] BIT NOT NULL,
    [FOR_SB_USER] BIT NOT NULL,
    [DATE_FROM] DATETIME NOT NULL,
    [TIME_FROM] VARCHAR(5) NOT NULL,
    [DATE_TO] DATETIME NOT NULL,
    [TIME_TO] VARCHAR(5) NOT NULL,
    [IMG_NAME] VARCHAR(200) NOT NULL,
    [IMG_CONTENT] VARBINARY(MAX) NOT NULL,
    [HLINK_REQD] BIT NOT NULL,
    [FILE_NAME] VARCHAR(200) NULL,
    [FILE_CONTENT] VARBINARY(MAX) NULL,
    [CREATED_BY] VARCHAR(100) NOT NULL,
    [CREATED_DATE] DATETIME NOT NULL,
    [MODIFIED_BY] VARCHAR(100) NULL,
    [MODIFIED_DATE] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tradeanywhere_master_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[Tradeanywhere_master_temp]
(
    [Client_code] VARCHAR(50) NULL,
    [Client_lock_st] VARCHAR(50) NULL,
    [Pwd_Lock_st] VARCHAR(50) NULL,
    [Source] VARCHAR(50) NULL,
    [Loggedin_Source] VARCHAR(50) NULL,
    [login_id] VARCHAR(50) NULL,
    [Branch] VARCHAR(50) NULL,
    [Suspended_st] VARCHAR(50) NULL,
    [Profile_code] VARCHAR(50) NULL,
    [ClientType] VARCHAR(50) NULL,
    [ClientCategory] VARCHAR(50) NULL,
    [PrimaryDealer] VARCHAR(50) NULL,
    [ClienTStatus] VARCHAR(50) NULL,
    [client_id] VARCHAR(250) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tradeanywhere_upload_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tradeanywhere_upload_temp]
(
    [instrument_type] VARCHAR(50) NULL,
    [code] VARCHAR(50) NULL,
    [symbol] VARCHAR(50) NULL,
    [security_descrip] VARCHAR(50) NULL,
    [series] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Upd_BSEequityTrades_TMP
-- --------------------------------------------------
CREATE TABLE [dbo].[Upd_BSEequityTrades_TMP]
(
    [Sr No.] INT NULL,
    [Scrip Code] VARCHAR(6) NULL,
    [Scrip Name] VARCHAR(100) NULL,
    [Deal Id] INT NULL,
    [Trade No.] INT NULL,
    [Trade Date] VARCHAR(10) NULL,
    [Trade Time] VARCHAR(20) NULL,
    [Member Code] VARCHAR(10) NULL,
    [Member Name] VARCHAR(100) NULL,
    [Client Code] VARCHAR(25) NULL,
    [Client Type] VARCHAR(10) NULL,
    [Old Client Code] VARCHAR(25) NULL,
    [Old Client Type] VARCHAR(10) NULL,
    [Quantity] INT NULL,
    [Price] MONEY NULL,
    [Value] MONEY NULL,
    [Trade Type] VARCHAR(10) NULL,
    [Order No.] VARCHAR(25) NULL,
    [Order Time] VARCHAR(20) NULL,
    [Terminal No.] VARCHAR(10) NULL,
    [Custodian Id] VARCHAR(50) NULL,
    [Buy/Sell] CHAR(1) NULL,
    [Location Id.] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UPLD_GLCODE
-- --------------------------------------------------
CREATE TABLE [dbo].[UPLD_GLCODE]
(
    [SBCODE] VARCHAR(20) NULL,
    [SEGMENT] VARCHAR(20) NULL,
    [OLDGLCODE] VARCHAR(15) NULL,
    [NEWGLCODE] VARCHAR(15) NULL,
    [STATUS] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UPLD_SBCLOSED
-- --------------------------------------------------
CREATE TABLE [dbo].[UPLD_SBCLOSED]
(
    [tag] NVARCHAR(15) NULL,
    [segment] NVARCHAR(15) NULL,
    [remarks] NVARCHAR(100) NULL,
    [fromdate] NVARCHAR(30) NOT NULL,
    [todate] NVARCHAR(30) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.upld_sbclosed_DEC232013
-- --------------------------------------------------
CREATE TABLE [dbo].[upld_sbclosed_DEC232013]
(
    [tag] NVARCHAR(15) NULL,
    [segment] NVARCHAR(15) NULL,
    [remarks] NVARCHAR(100) NULL,
    [fromdate] NVARCHAR(30) NOT NULL,
    [todate] NVARCHAR(30) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.upload_SAN_NAS
-- --------------------------------------------------
CREATE TABLE [dbo].[upload_SAN_NAS]
(
    [upload_id] INT IDENTITY(1,1) NOT NULL,
    [client_code] VARCHAR(50) NULL,
    [Uploaded_by] VARCHAR(50) NULL,
    [Uploaded_on] DATETIME NULL,
    [Filename1] VARCHAR(50) NULL,
    [Filename2] VARCHAR(50) NULL,
    [application_name] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.upload_unblock_290624
-- --------------------------------------------------
CREATE TABLE [dbo].[upload_unblock_290624]
(
    [Client Code] VARCHAR(50) NULL,
    [Blocked] VARCHAR(50) NULL,
    [Reason] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.uploadtempcsv
-- --------------------------------------------------
CREATE TABLE [dbo].[uploadtempcsv]
(
    [UserId] VARCHAR(30) NULL,
    [GroupId] VARCHAR(10) NULL,
    [Name] VARCHAR(150) NULL,
    [Category] VARCHAR(50) NULL,
    [Status] VARCHAR(30) NULL,
    [SurvStatus] VARCHAR(5) NULL,
    [SurvMode] VARCHAR(10) NULL,
    [PrimeStatus] VARCHAR(5) NULL,
    [Trading] VARCHAR(150) NULL,
    [IPAddress] VARCHAR(30) NULL,
    [BCast] VARCHAR(100) NULL,
    [OrderNo] VARCHAR(50) NULL,
    [DealerId] VARCHAR(50) NULL,
    [Pincode] NUMERIC(18, 0) NULL,
    [BranchName] NVARCHAR(50) NULL,
    [NseBranchId] VARCHAR(3) NULL,
    [NseTermId] VARCHAR(3) NULL,
    [DervBranchId] VARCHAR(3) NULL,
    [DervTermId] VARCHAR(3) NULL,
    [BseBranchId] VARCHAR(3) NULL,
    [BseTermId] VARCHAR(3) NULL,
    [McxBranchId] VARCHAR(3) NULL,
    [McxTermId] VARCHAR(3) NULL,
    [NcxBranchId] VARCHAR(3) NULL,
    [NcxTermId] VARCHAR(3) NULL,
    [GrAdmin] VARCHAR(8) NULL,
    [LoginAllowed] NVARCHAR(200) NULL,
    [Timedate] NVARCHAR(50) NULL,
    [Praticipent] NVARCHAR(50) NULL,
    [Mode] NVARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.uploadtempcsvnew
-- --------------------------------------------------
CREATE TABLE [dbo].[uploadtempcsvnew]
(
    [UserId] VARCHAR(30) NULL,
    [GroupId] VARCHAR(10) NULL,
    [Name] VARCHAR(150) NULL,
    [Category] VARCHAR(50) NULL,
    [Status] VARCHAR(30) NULL,
    [SurvStatus] VARCHAR(5) NULL,
    [SurvMode] VARCHAR(10) NULL,
    [PrimeStatus] VARCHAR(5) NULL,
    [Trading] VARCHAR(150) NULL,
    [IPAddress] VARCHAR(30) NULL,
    [BCast] VARCHAR(100) NULL,
    [OrderNo] VARCHAR(50) NULL,
    [DealerId] VARCHAR(50) NULL,
    [Pincode] NUMERIC(18, 0) NULL,
    [BranchName] NVARCHAR(50) NULL,
    [NseBranchId] VARCHAR(3) NULL,
    [NseTermId] VARCHAR(3) NULL,
    [DervBranchId] VARCHAR(3) NULL,
    [DervTermId] VARCHAR(3) NULL,
    [BseBranchId] VARCHAR(3) NULL,
    [BseTermId] VARCHAR(3) NULL,
    [McxBranchId] VARCHAR(3) NULL,
    [McxTermId] VARCHAR(3) NULL,
    [NcxBranchId] VARCHAR(3) NULL,
    [NcxTermId] VARCHAR(3) NULL,
    [McxsxBranchID] VARCHAR(3) NULL,
    [McxsxTermID] VARCHAR(3) NULL,
    [GrAdmin] VARCHAR(8) NULL,
    [LoginAllowed] NVARCHAR(200) NULL,
    [Timedate] NVARCHAR(50) NULL,
    [Praticipent] NVARCHAR(50) NULL,
    [Mode] NVARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.uploadtempemp
-- --------------------------------------------------
CREATE TABLE [dbo].[uploadtempemp]
(
    [fld_EmpNo] NVARCHAR(255) NULL,
    [fld_EmpName] NVARCHAR(255) NULL,
    [Fld_Designation] NVARCHAR(255) NULL,
    [Fld_Region] NVARCHAR(255) NULL,
    [Fld_Loc] NVARCHAR(255) NULL,
    [Fld_Tier] NVARCHAR(255) NULL,
    [Fld_Department] NVARCHAR(255) NULL,
    [Fld_JoinDate] DATETIME NULL,
    [Fld_Qualification] NVARCHAR(255) NULL,
    [Fld_NSECash] DATETIME NULL,
    [Fld_Derivatives] DATETIME NULL,
    [Fld_Commodities] DATETIME NULL,
    [Fld_BSECash] DATETIME NULL,
    [Fld_RegNo] NVARCHAR(255) NULL,
    [Fld_Location] NVARCHAR(255) NULL,
    [Fld_HODNO] NVARCHAR(255) NULL,
    [Fld_HODNAME] NVARCHAR(255) NULL,
    [Fld_Level] NVARCHAR(255) NULL,
    [Fld_SBU] NVARCHAR(255) NULL,
    [Fld_LOB] NVARCHAR(255) NULL,
    [Fld_EMPNO1] NVARCHAR(255) NULL,
    [Fld_NCFMStatus] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.USER INFO-11062012
-- --------------------------------------------------
CREATE TABLE [dbo].[USER INFO-11062012]
(
    [Type] VARCHAR(50) NULL,
    [Broker Id] VARCHAR(50) NULL,
    [Branch Id] VARCHAR(50) NULL,
    [Dealer Id] VARCHAR(50) NULL,
    [Client Group] VARCHAR(50) NULL,
    [Client Id] VARCHAR(50) NULL,
    [Privilege ] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserInfoFileDownload
-- --------------------------------------------------
CREATE TABLE [dbo].[UserInfoFileDownload]
(
    [ClientCode] VARCHAR(20) NULL,
    [GroupId] VARCHAR(50) NULL,
    [Brokerid] VARCHAR(100) NULL,
    [ServerId] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserInfoFileDownload_30102020
-- --------------------------------------------------
CREATE TABLE [dbo].[UserInfoFileDownload_30102020]
(
    [AccountId] VARCHAR(20) NOT NULL,
    [BranchId] VARCHAR(12) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserRequest
-- --------------------------------------------------
CREATE TABLE [dbo].[UserRequest]
(
    [ReqID] NVARCHAR(15) NOT NULL,
    [ItemID] VARCHAR(20) NOT NULL,
    [CatID] VARCHAR(20) NOT NULL,
    [ItemName] VARCHAR(50) NULL,
    [CategoryName] VARCHAR(60) NULL,
    [UserNote] VARCHAR(80) NULL,
    [HodNote] VARCHAR(80) NULL,
    [ReqStatusCode] VARCHAR(20) NOT NULL,
    [ReqDate] DATETIME NOT NULL,
    [CompleteByDate] VARCHAR(50) NULL,
    [ReqCompletedDate] VARCHAR(50) NOT NULL,
    [ReqCancelled] NVARCHAR(5) NULL,
    [Emp_no] VARCHAR(10) NOT NULL,
    [Hod_no] VARCHAR(10) NOT NULL,
    [Pi_no] VARCHAR(10) NULL,
    [Qty] INT NULL,
    [orderID] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UserVIRequest
-- --------------------------------------------------
CREATE TABLE [dbo].[UserVIRequest]
(
    [ReqID] NVARCHAR(15) NOT NULL,
    [ItemID] VARCHAR(20) NOT NULL,
    [CatID] VARCHAR(20) NOT NULL,
    [ItemName] VARCHAR(50) NULL,
    [CategoryName] VARCHAR(50) NULL,
    [UserNote] VARCHAR(80) NULL,
    [HodNote] VARCHAR(80) NULL,
    [ReqStatusCode] VARCHAR(20) NOT NULL,
    [ReqDate] VARCHAR(50) NOT NULL,
    [CompleteByDate] DATETIME NULL,
    [ReqCompletedDate] DATETIME NULL,
    [ReqCancelled] NVARCHAR(5) NULL,
    [Emp_no] VARCHAR(10) NOT NULL,
    [Hod_no] VARCHAR(10) NOT NULL,
    [Pi_no] VARCHAR(10) NULL,
    [CommNote] VARCHAR(80) NULL,
    [Qty] INT NULL,
    [orderID] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VAR_030309
-- --------------------------------------------------
CREATE TABLE [dbo].[VAR_030309]
(
    [Fld_Col1] VARCHAR(255) NULL,
    [Fld_Scrip_Cd] VARCHAR(255) NULL,
    [Fld_Series] VARCHAR(255) NULL,
    [Fld_Isin] VARCHAR(255) NULL,
    [Fld_Var] VARCHAR(255) NULL,
    [Fld_Col2] VARCHAR(255) NULL,
    [Fld_Col3] VARCHAR(255) NULL,
    [Fld_Col4] VARCHAR(255) NULL,
    [Fld_Col5] VARCHAR(255) NULL,
    [Fld_Col6] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VendorMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[VendorMaster]
(
    [clt_code] VARCHAR(53) NULL,
    [ac_name] NVARCHAR(255) NULL,
    [long_name] NVARCHAR(255) NULL,
    [branch_code] NVARCHAR(255) NULL,
    [segment] NVARCHAR(255) NULL,
    [Pan_No] NVARCHAR(255) NULL,
    [ST_No] NVARCHAR(255) NULL,
    [Address] NVARCHAR(255) NULL,
    [State] NVARCHAR(255) NULL,
    [Service] NVARCHAR(255) NULL,
    [Status] NVARCHAR(255) NULL,
    [Code] NVARCHAR(255) NULL,
    [To_Be_rectified] NVARCHAR(255) NULL,
    [Phone_No] NVARCHAR(255) NULL,
    [Fax] NVARCHAR(255) NULL,
    [email] NVARCHAR(255) NULL,
    [count] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VendorTemp
-- --------------------------------------------------
CREATE TABLE [dbo].[VendorTemp]
(
    [clt_code] VARCHAR(53) NULL,
    [ac_name] NVARCHAR(255) NULL,
    [long_name] NVARCHAR(255) NULL,
    [branch_code] NVARCHAR(255) NULL,
    [segment] NVARCHAR(255) NULL,
    [Pan_No] NVARCHAR(255) NULL,
    [ST_No] NVARCHAR(255) NULL,
    [Address] NVARCHAR(255) NULL,
    [State] NVARCHAR(255) NULL,
    [Service] NVARCHAR(255) NULL,
    [Status] NVARCHAR(255) NULL,
    [Code] NVARCHAR(255) NULL,
    [To_Be_rectified] NVARCHAR(255) NULL,
    [Phone_No] NVARCHAR(255) NULL,
    [Fax] NVARCHAR(255) NULL,
    [email] NVARCHAR(255) NULL,
    [count] INT NULL
);

GO

-- --------------------------------------------------
-- TRIGGER dbo.T_Pledge_Unpledge_Master
-- --------------------------------------------------
CREATE TRIGGER T_Pledge_Unpledge_Master     
ON  Pledge_Unpledge_Master       
for DELETE,UPDATE      
AS       
BEGIN      
 SET NOCOUNT ON      
 begin try    
 declare @srno int ,@actiontype varchar(8),@host varchar(20),@ipAddress varchar(20)          
           
 set @host = (select host_name())                
 set @ipAddress = (SELECT top 1 client_net_address FROM sys.dm_exec_connections             
 WHERE session_id = @@SPID)          
    
     
 if (select count(*) from inserted)>=1    
 begin     
 set @actiontype='updated'    
 end    
 else    
 begin       
   set @actiontype='deleted'    
 end      
  insert into Pledge_Unpledge_Master_log  
  select Holdingdatetime,Clientid,Bankid,Isin,Sc_isinname,Pledgeorder,
Pledgedate,Pledgeqty,Unpledgeqty,Balance,Oldpsn_corp,  
  @actiontype,getdate(),@host,@ipAddress     
  from deleted with (nolock)         
 end try    
 begin catch    
  DECLARE @ErrorMessage NVARCHAR(4000);    
 SELECT @ErrorMessage = ERROR_MESSAGE();    
 RAISERROR (@ErrorMessage, 16, 1);    
    
  rollback transaction    
  end catch    
     
END

GO

-- --------------------------------------------------
-- TRIGGER dbo.T_SCCS_deletecontrolclients
-- --------------------------------------------------
CREATE TRIGGER T_SCCS_deletecontrolclients
ON  SCCS_deletecontrolclients       
for DELETE,UPDATE      
AS       
BEGIN      
 SET NOCOUNT ON      
 begin try    
 declare @srno int ,@actiontype varchar(8),@host varchar(20),@ipAddress varchar(20)          
           
 set @host = (select host_name())                
 set @ipAddress = (SELECT top 1 client_net_address FROM sys.dm_exec_connections             
 WHERE session_id = @@SPID)          
    
     
 if (select count(*) from inserted)>=1    
 begin     
 set @actiontype='updated'    
 end    
 else    
 begin       
   set @actiontype='deleted'    
 end      
  insert into SCCS_deletecontrolclients_log  
  select srno,party_code,enteredby,enteredon,  
  @actiontype,getdate(),@host,@ipAddress     
  from deleted with (nolock)         
 end try    
 begin catch    
  DECLARE @ErrorMessage NVARCHAR(4000);    
 SELECT @ErrorMessage = ERROR_MESSAGE();    
 RAISERROR (@ErrorMessage, 16, 1);    
    
  rollback transaction    
  end catch    
     
END

GO

-- --------------------------------------------------
-- VIEW dbo.BRPRODUCTIVITY
-- --------------------------------------------------
CREATE VIEW BRPRODUCTIVITY      
AS      
    
select     
region,branch_cd,Age,    
ExistingCliB2B_NoOFClis,    
ExistingCliB2B_PercentActivation,    
RevPerDayB2B=case when ExistingCliB2B_PercentActivation<> 0 then RevPerDayB2B/(((ExistingCliB2B_NoOFClis*ExistingCliB2B_PercentActivation)/100)+1) else  RevPerDayB2B end,    
ExistingCliB2C_NoOFClis,    
ExistingCliB2c_PercentActivation,    
RevPerDayB2C=case when ExistingCliB2C_PercentActivation<> 0 then RevPerDayB2C/(((ExistingCliB2C_NoOFClis*ExistingCliB2C_PercentActivation)/100)+1) else RevPerDayB2C end,    
TotalRevenue,Expense,    
Productivity,    
NewCliAdd_B2BClis,    
NewCliAdd_B2CClis,    
B2B_client_base,    
B2C_client_base,    
f_Total_revenue,    
f_pRODUCTIVITY    
from    
(    
select region=[ region ],branch_cd=[ branchcode],Age=[ age],      
ExistingCliB2B_NoOFClis,    
ExistingCliB2B_PercentActivation=CONVERT(DECIMAL(10,2),ExistingCliB2B_PercentActivation),      
RevPerDayB2B,    
--RevPerDayB2B_a=(case when ExistingCliB2B_NoOFClis <> 0 then CONVERT(DECIMAL(10,2),RevPerDayB2B/ExistingCliB2B_NoOFClis) else 0 end),      
ExistingCliB2C_NoOFClis,ExistingCliB2c_PercentActivation=CONVERT(DECIMAL(10,2),ExistingCliB2c_PercentActivation),      
RevPerDayB2C,    
--RevPerDayB2C=(case when ExistingCliB2C_NoOFClis <> 0 then CONVERT(DECIMAL(10,2),RevPerDayB2C/ExistingCliB2C_NoOFClis) else 0 end),    
TotalRevenue=RevFromExistingCliB2B+RevFromExistingCliB2C,      
Expense=CONVERT(DECIMAL(10,2),EXPENSE),      
--Productivity=(case when expense <> 0 then (RevFromExistingCliB2B+RevFromExistingCliB2C)/Expense else 0 end),      
Productivity=(case when expense <> 0 then CONVERT(DECIMAL(10,2),(RevPerDayB2B+RevPerDayB2C)/Expense) else 0 end),      
NewCliAdd_B2BClis,NewCliAdd_B2CClis,      
B2B_client_base=(NewCliAdd_B2BClis*12)+ExistingCliB2B_NoOFClis,--ExistingCliB2B_NoOFClis+NewCliAdd_B2BClis,      
B2C_client_base=(NewCliAdd_B2CClis*12)+ExistingCliB2C_NoOFClis,--ExistingCliB2C_NoOFClis+NewCliAdd_B2CClis,      
f_Total_revenue=RevFromExistingCliB2B+RevFromExistingCliB2C+RevFromNewCliB2B_12Mnth+RevFromNewCliB2C_12Mnth,      
f_pRODUCTIVITY=(case when expense <> 0 then CONVERT(DECIMAL(10,2),(RevFromExistingCliB2B+RevFromExistingCliB2C+RevFromNewCliB2B_12Mnth+RevFromNewCliB2C_12Mnth)/expense) else 0 end)      
from projection (NOLOCK)      
) x

GO

-- --------------------------------------------------
-- VIEW dbo.mcxsx_bhav_copy
-- --------------------------------------------------
CREATE view mcxsx_bhav_copy     
as    
/*  
select * from mcxsx_cp with (nolock)     
where [market type]='FUTCUR'  
*/  
select [Market Statistics Date],Instrument as [Market Type],Instrument as [Instrument Name],Product as Symbol,  
Convert(varchar(11),Expiry) as [Series/Expiry],[Strike Price],[Option Type],[Open],High,Low,[Close],[Settlement Price],[Previous  Close],  
[Volume (Lots)] as Volume,[No. of  Trades],[Value (in Lacs)],[Open Interest],[Premium Value (in Lacs)]   
from mcxsx_cp_F with (nolock)
--where Instrument='FUTCUR'

GO

-- --------------------------------------------------
-- VIEW dbo.mcxsx_bhav_copy_17072013
-- --------------------------------------------------
CREATE view mcxsx_bhav_copy_17072013
as    
/*  
select * from mcxsx_cp with (nolock)     
where [market type]='FUTCUR'  
*/  
select [Market Statistics Date],Instrument as [Market Type],Instrument as [Instrument Name],Product as Symbol,  
Convert(varchar(11),Expiry) as [Series/Expiry],[Strike Price],[Option Type],[Open],High,Low,[Close],[Settlement Price],[Previous  Close],  
[Volume (Lots)] as Volume,[No. of  Trades],[Value (in Lacs)],[Open Interest],[Premium Value (in Lacs)]   
from mcxsx_cp_F with (nolock)     
where Instrument='FUTCUR'

GO

-- --------------------------------------------------
-- VIEW dbo.mcxsx_bhav_copy_28052013
-- --------------------------------------------------
create view mcxsx_bhav_copy_28052013
as  
select * from mcxsx_cp with (nolock)   
where [market type]='FUTCUR'

GO

-- --------------------------------------------------
-- VIEW dbo.restrictedscrip_BseNse
-- --------------------------------------------------
create view dbo.restrictedscrip_BseNse
as
select a.segment,a.scripcode,b.bsescriptname,b.[group],a.deletestatus 
from restricted_scrip_upload a (nolock) join BlockScrip_Bse b (nolock) on a.scripcode=b.scriptcode
union all
select a.segment,a.scripcode,b.scriptname,b.[group],a.deletestatus 
from restricted_scrip_upload a (nolock) join BlockScrip_nse b (nolock) on a.scripcode=b.symbol

GO

-- --------------------------------------------------
-- VIEW dbo.V_Axis_Bank_Rpt
-- --------------------------------------------------
CREATE View V_Axis_Bank_Rpt  
as  
select Fld_id,Fld_Party_Code,Fld_Date,Fld_Narration,  
case when Fld_DrCr = 'DR' then Fld_Amt end Debit_Amt,  
case when Fld_DrCr = 'CR' then Fld_Amt end Credit_Amt,Fld_Bal,'AXIS' as Bank    
from tbl_Axis_Bank (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.V_Bank_Statement_Rpt
-- --------------------------------------------------
CREATE View V_Bank_Statement_Rpt            
as            
  
select '' Fld_id,'' Fld_Party_Code,Fld_Date,datepart(MM,convert(datetime,right(Fld_Date,10),103))Month,        
datepart(YY,convert(datetime,right(Fld_Date,10),103))Year,        
Fld_Desc as Fld_Narration,                
Fld_wit_amt as Debit_Amt,                
Fld_Dep_amt as  Credit_Amt,            
Fld_Bal,'Kotak' as Bank                
from tbl_Upload_Kotak (nolock)             
union all            
select Fld_id,Fld_Party_Code,Fld_Date,datepart(MM,convert(datetime,right(Fld_Date,10),103))Month,        
datepart(YY,convert(datetime,right(Fld_Date,10),103))Year,Fld_Narration,        
case when Fld_DrCr = 'DR' then Fld_Amt end Debit_Amt,              
case when Fld_DrCr = 'CR' then Fld_Amt end Credit_Amt,Fld_Bal,'AXIS' as Bank                
from tbl_Axis_Bank (nolock)              
union all            
select Fld_id,Fld_Party_Code,  
convert(varchar(11),convert(datetime,Fld_Date),103) Fld_Date,  
datepart(mm,convert(datetime,Fld_Date)) Month,  
datepart(YY,convert(datetime,Fld_Date)) year,  
/*datepart(MM,convert(datetime,right(Fld_Date,103),3))Year,        
datepart(YY,convert(datetime,right(Fld_Date,103),3))Year,      */  
Fld_Narration,                
case when Fld_DrCr = 'DR' then Fld_Amt end Debit_Amt,                
case when Fld_DrCr = 'CR' then Fld_Amt end Credit_Amt,Fld_Bal,'ICICI' as Bank                    
from tbl_Upload_ICICI (nolock)   
union all
select Fld_SRNO,'',  
 convert(varchar(11),convert(datetime,Fld_Date,103),103) Fld_Date,  
datepart(mm,convert(datetime,Fld_Date,103)) Month,  
datepart(YY,convert(datetime,Fld_Date,103)) year,  
/*datepart(MM,convert(datetime,right(Fld_Date,103),3))Year,        
datepart(YY,convert(datetime,right(Fld_Date,103),3))Year,      */  
Fld_Desc,                
case when Fld_Cr_DR = 'DR' then Fld_Trans_Amt end Debit_Amt,                
case when Fld_Cr_DR = 'CR' then Fld_Trans_Amt end Credit_Amt,Fld_Bal,'HDFC' as Bank                    
from tbl_Upload_HDFC (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.v_clientbulkupload
-- --------------------------------------------------
CREATE view v_clientbulkupload  
as  
Select SrNo,ClientNo,DispatchDate,DistinationName,ClientID,ClientName,PinCode from tbl_clientbulkupload

GO

-- --------------------------------------------------
-- VIEW dbo.V_CMSMails_Log
-- --------------------------------------------------
Create View dbo.V_CMSMails_Log
as
Select MAX(Updated_Date)Updated_Date,COUNT(PARTY_CODE)PARTY_CODE,
EMAIL = (SELECT COUNT(*) FROM tbl_CMSMails_Log WHERE EMAIL <> ''),
MOBILE_PAGER = (SELECT COUNT(*) FROM tbl_CMSMails_Log WHERE MOBILE_PAGER <> '')
from tbl_CMSMails_Log

GO

-- --------------------------------------------------
-- VIEW dbo.V_GetScripClsRate
-- --------------------------------------------------

CREATE view V_GetScripClsRate    
as    
    
select isin,
case when max(nserate) <= 0 then  max(Bserate) else max(nserate) end cls
 from    
(    
select distinct isin,BSErate=rate,NSErate=0 from intranet.risk.dbo.scrip_master a join intranet.risk.dbo.cp b      
on a.bsecode=b.scode      
union all    
select distinct isin,BSErate=0,NSErate=cls from intranet.risk.dbo.scrip_master a join intranet.risk.dbo.md b    
on a.nsesymbol=b.scrip and a.nseseries=b.series    
) a group by isin

GO

-- --------------------------------------------------
-- VIEW dbo.V_HDFC_Bank_Rpt
-- --------------------------------------------------
CREATE View V_HDFC_Bank_Rpt    
as    
select '' Fld_id,'' Fld_Party_Code,Fld_Date,Fld_Desc as Fld_Narration,    
Fld_wit_amt as Debit_Amt,    
Fld_Dep_amt as  Credit_Amt,
Fld_Bal,'HDFC' as Bank    
from tbl_Upload_Kotak (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.V_ICICI_Bank_Rpt
-- --------------------------------------------------
CREATE View V_ICICI_Bank_Rpt    
as    
select Fld_id,Fld_Party_Code,Fld_Date,Fld_Narration,    
case when Fld_DrCr = 'DR' then Fld_Amt end Debit_Amt,    
case when Fld_DrCr = 'CR' then Fld_Amt end Credit_Amt,Fld_Bal,'ICICI' as Bank        
from tbl_Upload_ICICI (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.V_mis_diverse_dispatch
-- --------------------------------------------------
Create view V_mis_diverse_dispatch
as
Select Date,Type,Brtag,Sbtag,Cl_code,Sender_name,Department,Remark,Company,Mode,Pod,
Weight,Rate,Status,ReturnedDate,Reason
from intranet.nsecourier.dbo.mis_diverse_dispatch

GO

-- --------------------------------------------------
-- VIEW dbo.V_NBFC_HC
-- --------------------------------------------------
CREATE View V_NBFC_HC  
as  

select Scrip_cd,min(hair_cut) as hair_cut from
(
select scrip_cd,  
Case   
when  groupcode = 'A' then 25  
when  groupcode = 'B' then 35  
when  groupcode = 'C' then 40 end as hair_cut  
 from MARGINFIN.NBFC.DBO.TBLGROUPMARGIN_VIW 
) x group by Scrip_cd

GO

-- --------------------------------------------------
-- VIEW dbo.V_Sb_Status
-- --------------------------------------------------
Create View V_Sb_Status
as
Select isnull(a.regtag,isnull(b.regtag,isnull(c.regtag,isnull(d.regtag,isnull(e.regtag,f.regtag))))) Sbtag,
a.appstatus RemStatus,a.appdate RemDate,b.appstatus BseStatus,b.appdate BseDate,c.appstatus NseStatus,c.appdate NseDate,
d.appstatus NsefoStatus,d.appdate NsefoDate,e.appstatus McxStatus,e.appdate McxDate,f.appstatus NcxStatus,f.appdate NcxDate from
(Select * from sb_comp.dbo.V_App_Status where LEFT(EST,1)+RIGHT(EST,2) = 'BCR')a
full outer join
(Select * from sb_comp.dbo.V_App_Status where LEFT(EST,1)+RIGHT(EST,2) = 'BCS')b
on a.regtag = b.regtag
full outer join
(Select * from sb_comp.dbo.V_App_Status where LEFT(EST,1)+RIGHT(EST,2) = 'NCS')c
on a.regtag = c.regtag
full outer join
(Select * from sb_comp.dbo.V_App_Status where LEFT(EST,1)+RIGHT(EST,2) = 'NFA')d
on a.regtag = d.regtag
full outer join
(Select * from sb_comp.dbo.V_App_Status where LEFT(EST,1)+RIGHT(EST,2) = 'MCX')e
on a.regtag = e.regtag
full outer join
(Select * from sb_comp.dbo.V_App_Status where LEFT(EST,1)+RIGHT(EST,2) = 'NCX')f
on a.regtag = f.regtag

GO

-- --------------------------------------------------
-- VIEW dbo.V_scrip_master
-- --------------------------------------------------
CREATE View V_scrip_master  
as  
  
select scrip= NseSymbol,max(cls) as cls from  
(select * from V_GetScripClsRate)x  
left outer join  
(select isin,case when NseSymbol = 'UNKNOWN' THEN scripName else NseSymbol end NseSymbol from intranet.risk.dbo.scrip_master)y  
on x.isin = y.isin  
group by NseSymbol

GO

-- --------------------------------------------------
-- VIEW dbo.V_tbl_Col_data
-- --------------------------------------------------
CREATE View V_tbl_Col_data      
as      
      
select x.*,y.branch_cd,y.sub_broker,Email from      
(    
select     
Fld_Party_Code,scrip_cd,Fld_NCM_Qty,Fld_BF_Qty,Fld_Net,Fld_Second_Net,    
Fld_NCM_Qty+Fld_BF_Qty+Fld_Net+Fld_Second_Net as Total_Qty,    
Fld_Cl_Rate,    
Fld_Cl_Rate*(Fld_NCM_Qty+Fld_BF_Qty+Fld_Net+Fld_Second_Net) as PF_Value,    
Fld_Hair_Cut,    
(Fld_Cl_Rate*(Fld_NCM_Qty+Fld_BF_Qty+Fld_Net+Fld_Second_Net))*(100-Fld_Hair_Cut)/100 as PF_Value_After_HC    
 from tbl_Col_data (nolock)     
where Fld_date >= convert(varchar(11),getdate())    
)x      
left outer join      
(select * from MARGINFIN.nbfc.dbo.client1)y      
on x.Fld_Party_Code = y.cl_code

GO

-- --------------------------------------------------
-- VIEW dbo.V_tbl_Holding_Data
-- --------------------------------------------------
CREATE View V_tbl_Holding_Data                    
as                    
             
select x.*,y.*,z.Email as Sb_Mail from            
(                   
select x.*,y.branch_cd,y.sub_broker,Email from                    
(        
select         
x.Fld_Party_Code,y.PF_Value as Fld_Current_Holding,y.PF_Value_After_HC as Fld_Holding_After_Haircut,        
Fld_Total_Amt,Fld_Net_BuySell as Fld_Day_Value_AfterHaircut,Fld_Logical_LedBal,        
PF_Value_After_HC + Fld_Logical_LedBal as Fld_CallExcess_Shortage,    
isnull(case     
when y.PF_Value <= 0 then y.PF_Value else     
((Fld_Total_Amt+y.PF_Value)/y.PF_Value)*100 end,0) as Fld_Margin_Maintain,    
Fld_Datetime        
from        
(        
select * from tbl_Holding_Data (nolock) where Fld_datetime >= convert(varchar(11),getdate())         
)x        
left outer join        
(        
select Fld_Party_code,        
sum(PF_Value) as PF_Value,        
sum(PF_Value_After_HC)as PF_Value_After_HC from V_tbl_Col_data    
group by Fld_Party_code        
)y on x.Fld_Party_code = y.Fld_Party_code        
)x    --getdate() '2008-12-29 00:00:00.000'                
left outer join                    
(select * from anand1.msajag.dbo.client_details where cl_type = 'NBF')y                    
on x.Fld_Party_Code = y.cl_code               
)x            
left outer join                    
(select * from NBFC_Mails (nolock))y            
on x.branch_cd = y.Branch            
left outer join          
(  
select distinct Sub_Broker,replace(Email,'@angeltrad','@angeltrade.com') as Email  from intranet.risk.dbo.subbrokers where Email <> ''   
and (Email like '%.com%' or Email like '%.co.in%')  
 )z          
on x.sub_broker = z.Sub_Broker

GO

-- --------------------------------------------------
-- VIEW dbo.Vw_commo_dormant_mcdx
-- --------------------------------------------------

Create View Vw_commo_dormant_mcdx
as
select x.* from 
(
select a.cltcode from Commo_dormant_t a with (nolock) join Commo_dormant_xx b with (nolock)
on a.cltcode=b.cltcode 
where a.Mcx_billdate not in ('NO A/C') 
) x left outer join 
(select cltcode from tbl_Comm_HIST with (nolock) where Segment = 'MCDX') y
on x.cltcode=y.cltcode where y.cltcode is null

GO

-- --------------------------------------------------
-- VIEW dbo.Vw_commo_dormant_ncdx
-- --------------------------------------------------
Create View Vw_commo_dormant_ncdx
as
select x.* from 
(
select a.cltcode from Commo_dormant_t a with (nolock) join Commo_dormant_xx b with (nolock)
on a.cltcode=b.cltcode 
where a.Mcx_billdate not in ('NO A/C') 
) x left outer join 
(select cltcode from tbl_Comm_HIST with (nolock) where Segment = 'NCDX') y
on x.cltcode=y.cltcode where y.cltcode is null

GO

-- --------------------------------------------------
-- VIEW dbo.VW_MCXSX_Bhav_Copy
-- --------------------------------------------------
CREATE View VW_MCXSX_Bhav_Copy                  
as                  
select * from                   
(                  
select InstType=[instrument Name],symbol,expiry_date=convert(datetime,isnull([Series/Expiry],'Jan 01 1900')),Qty_traded_today=isnull(Volume,0),                
Tdate=convert(Datetime,[Market Statistics Date],101)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday'    then  convert(Datetime,Tdate) else convert(Datetime,Tdate)-1 end    */            
,[Strike Price] as Strike_Price,[Option Type] as Option_Type
from MCXSX_bhav_copy  (nolock)                  
/*union                   
select symbol,expiry_date=isnull(expiry_date,'Jan 01 1900'),Qty_traded_today=isnull(Qty_traded_today,0),                
Tdate=convert(Datetime,Tdate)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday' then convert(Datetime,Tdate)-2       else convert(Datetime,Tdate)-1 end    */            
from NCDEX_Bhav_Copy_hist  (nolock)  */          
) a

GO

-- --------------------------------------------------
-- VIEW dbo.VW_MCXSX_Bhav_Copy_22082012
-- --------------------------------------------------
create View VW_MCXSX_Bhav_Copy_22082012            
as            
select * from             
(            
select InstType=[instrument Name],symbol,expiry_date=convert(datetime,isnull([Series/Expiry],'Jan 01 1900')),Qty_traded_today=isnull(Volume,0),          
Tdate=convert(Datetime,[Market Statistics Date])/*case when datename(weekday,convert(Datetime,Tdate))='Saturday'    then  convert(Datetime,Tdate) else convert(Datetime,Tdate)-1 end    */      
from MCXSX_bhav_copy  (nolock)            
/*union             
select symbol,expiry_date=isnull(expiry_date,'Jan 01 1900'),Qty_traded_today=isnull(Qty_traded_today,0),          
Tdate=convert(Datetime,Tdate)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday' then convert(Datetime,Tdate)-2       else convert(Datetime,Tdate)-1 end    */      
from NCDEX_Bhav_Copy_hist  (nolock)  */    
) a

GO

-- --------------------------------------------------
-- VIEW dbo.VW_MCXSX_Bhav_Copy_26062013
-- --------------------------------------------------
CREATE View VW_MCXSX_Bhav_Copy_26062013                
as                
select * from                 
(                
select InstType=[instrument Name],symbol,expiry_date=convert(datetime,isnull([Series/Expiry],'Jan 01 1900')),Qty_traded_today=isnull(Volume,0),              
Tdate=convert(Datetime,[Market Statistics Date],105)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday'    then  convert(Datetime,Tdate) else convert(Datetime,Tdate)-1 end    */          
from MCXSX_bhav_copy  (nolock)                
/*union                 
select symbol,expiry_date=isnull(expiry_date,'Jan 01 1900'),Qty_traded_today=isnull(Qty_traded_today,0),              
Tdate=convert(Datetime,Tdate)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday' then convert(Datetime,Tdate)-2       else convert(Datetime,Tdate)-1 end    */          
from NCDEX_Bhav_Copy_hist  (nolock)  */        
) a

GO

-- --------------------------------------------------
-- VIEW dbo.VW_NCDEX_Bhav_Copy
-- --------------------------------------------------
CREATE View VW_NCDEX_Bhav_Copy      
as      
select * from       
(      
select symbol,expiry_date=isnull(expiry_date,'Jan 01 1900'),Qty_traded_today=isnull(Qty_traded_today,0),    
Tdate=convert(Datetime,Tdate)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday'    then  convert(Datetime,Tdate) else convert(Datetime,Tdate)-1 end    */
from NCDEX_Bhav_Copy  (nolock)      
union       
select symbol,expiry_date=isnull(expiry_date,'Jan 01 1900'),Qty_traded_today=isnull(Qty_traded_today,0),    
Tdate=convert(Datetime,Tdate)/*case when datename(weekday,convert(Datetime,Tdate))='Saturday' then convert(Datetime,Tdate)-2       else convert(Datetime,Tdate)-1 end    */
from NCDEX_Bhav_Copy_hist  (nolock)      
) a

GO

-- --------------------------------------------------
-- PROCEDURE E05913.restricted_scrip
-- --------------------------------------------------

create proc restricted_scrip (@filename as varchar(45),@segment as varchar(10))
as
set nocount on

truncate table restricted_scrip_upload

INSERT INTO restricted_scrip_upload
select segment=@segment,*,DeleteStatus='N' FROM restricted_scrip_uploadTemp


INSERT INTO intranet.risk.dbo.upload_restrict_file VALUES (@segment,GETDATE(),'Null')
set nocount off

GO

-- --------------------------------------------------
-- TABLE E05913.bulk_file
-- --------------------------------------------------
CREATE TABLE [E05913].[bulk_file]
(
    [party_code] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE E05913.restricted_scrip_upload
-- --------------------------------------------------
CREATE TABLE [E05913].[restricted_scrip_upload]
(
    [Segment] VARCHAR(10) NULL,
    [ScripCode] VARCHAR(25) NULL,
    [SecurityName] VARCHAR(75) NULL,
    [TurnoverLimit] VARCHAR(20) NULL,
    [DeleteStatus] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE E05913.restricted_scrip_uploadTemp
-- --------------------------------------------------
CREATE TABLE [E05913].[restricted_scrip_uploadTemp]
(
    [scripCode] VARCHAR(25) NULL,
    [SecurityName] VARCHAR(75) NULL,
    [TurnoverLimit] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- VIEW E05913.restrictedscrip_BseNse
-- --------------------------------------------------
create view restrictedscrip_BseNse
as
select a.segment,a.scripcode,b.bsescriptname,b.[group],a.deletestatus 
from restricted_scrip_upload a (nolock) join BlockScrip_Bse b (nolock) on a.scripcode=b.scriptcode
union all
select a.segment,a.scripcode,b.scriptname,b.[group],a.deletestatus 
from restricted_scrip_upload a (nolock) join BlockScrip_nse b (nolock) on a.scripcode=b.symbol

GO

-- --------------------------------------------------
-- PROCEDURE E07316.spCNT_Upload
-- --------------------------------------------------
CREATE proc spCNT_Upload(@filename as varchar(11)) 
as  
insert into mis.kyc.dbo.temp_tbl_call_trade  
select a.party_code,P =  
case when b.odin_server = 'Anywhere' then  '1'   
when b.odin_server = '172.31.15.34' then '1'  
when b.odin_server is null then ''  
else  '2' end ,getdate(),'2049-12-03 00:00:00.000' ,2,'temp',0 ,'',getdate()  
from  
(SELECT party_code from call_trade_bulk_Temp) a  
left outer join  
(select * from intranet.MIS.dbo.ebrok_client1) b  
on a.party_code=b.party_code

GO

-- --------------------------------------------------
-- PROCEDURE E07316.UpdCNT_Upload
-- --------------------------------------------------
CREATE proc UpdCNT_Upload(@filename as varchar(11))    
as    
--supriya    
insert into kyc.dbo.temp_tbl_call_trade
--(sr_no,client_id,product_id,from_date,to_date,flag,entry_by,amount,reqdate,type)
--values 
--(
select a.party_code, P = case when b.odin_server = 'Anywhere' then  '1'    
							  when b.odin_server = '172.31.15.34' then '1'    
							  when b.odin_server is null then ''    
							  else  '2' end ,  
getdate(), '2049-12-03 00:00:00.000',2,'temp',0 ,'',getdate(),type=case when c.party_code is null then 'Offline' else 'Online' end    
from    
(SELECT party_code from call_trade_bulk_Temp) a    
left outer join    
(select * from intranet.MIS.dbo.ebrok_client1) b    
on a.party_code=b.party_code  
left outer join  
(select party_code from intranet.ctcl.dbo.ebrok_client1)c  
on a.party_code = c.party_code    -- )

GO

-- --------------------------------------------------
-- PROCEDURE E07657.usp_genrate_ecn_dpid
-- --------------------------------------------------
create proc usp_genrate_ecn_dpid
as
truncate table tbl_ecn_dpid

insert into tbl_ecn_dpid
SELECT cm_cd+'|'+cm_email FROM DPBACKOFFICE.ACERCROSS.DBO.CLIENT_MASTER where cm_statements = 'E' and cm_schedule = '49843750'

Declare @s as varchar(1000)                                  
Declare @s1 as varchar(1000)                                  
Declare @file as varchar(50) 

set @file = (select 'ECN_DPID'+replace(convert(varchar(11),getdate(),3),'/','')+'.txt')            
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT Fld_File FROM upload.tbl_ecn_dpid(nolock)" queryout \\196.1.115.136\D$\upload1\'+@file+' -c'                                                                                                
set @s1= @s+''''                                                            
exec(@s1)

GO

-- --------------------------------------------------
-- TABLE E07657.tbl_ecn_dpid
-- --------------------------------------------------
CREATE TABLE [E07657].[tbl_ecn_dpid]
(
    [fld_file] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- PROCEDURE E15318.restricted_scrip
-- --------------------------------------------------
CREATE procedure restricted_scrip
(  
@filename as varchar(35)
)  
as

GO

-- --------------------------------------------------
-- PROCEDURE E15318.Upload_Illiquid_Master1
-- --------------------------------------------------
CREATE proc Upload_Illiquid_Master1  
(                                    
@filename as varchar(100),            
@server as varchar(20)  
--@flag as varchar(10)                                          
)                                      
as                        
declare @path as varchar(100)    
declare @sql as varchar(1000)    
                     
delete from intranet.misc.dbo.tbl_restricted_scrips    
    
create table #temp  
(    
sc_code varchar(50),    
--symbol varchar(50),    
sc_name varchar(50),    
sc_group varchar(50),
segment  varchar(50),
isin_no varchar(50),
status varchar(50),   
)                  
    
set @path='\\'+@server+'\d$\upload1\Survelliance\' + @filename    
SET @SQL = 'insert into #temp select * FROM OPENROWSET(''Microsoft.Jet.OLEDB.4.0'',''Excel 8.0;DATABASE='+@path+''',''Select * from [sheet1$]'' )'    
print @SQL                                    
exec (@sql)    
                                   
insert into intranet.misc.dbo.tbl_restricted_scrips    
Select * from #temp   
--  
--select sc_code,sc_name,sc_group,Status='Up to 5 Lacs' from intranet.misc.dbo.tbl_restricted_scrips    
    
select s1=count(*) from #temp

GO

-- --------------------------------------------------
-- PROCEDURE E15318.Upload_Illiquid_Master11_New
-- --------------------------------------------------
create proc Upload_Illiquid_Master11_New        
(                                          
@filename as varchar(100),                  
--@server as varchar(20)        
@segment as varchar(10)                                                
)                                            
as                              
--declare @path as varchar(100)          
--declare @sql as varchar(1000)   
   if(@segment='BSE')  
begin      
insert into intranet.misc.dbo.tbl_restricted_scrips(sc_code,symbol,sc_group,segment,isin_no,status)  
select sc_code,symbol,sc_group,@segment,isin_no,status from tbl_restricted_scrips_TEMP  
end

if(@segment='BSE')  
begin      
insert into intranet.misc.dbo.tbl_restricted_scrips(symbol,sc_group,segment,isin_no,status)  
select symbol,sc_group,@segment,isin_no,status from tbl_restricted_scrips_TEMP
end

GO

-- --------------------------------------------------
-- PROCEDURE E15318.UPLOADNSDEXTRADE
-- --------------------------------------------------
CREATE PROCEDURE UPLOADNSDEXTRADE
(
	@FILENAME AS VARCHAR(50),
	@Mgr AS VARCHAR(10)	
)
AS
BEGIN
 SET NOCOUNT ON
	DECLARE @PATH AS VARCHAR(100)
	DECLARE @SQL AS VARCHAR(MAX)
	
	TRUNCATE TABLE tblNSDEXTradeTemp
	
	SET @PATH='\\172.29.2.158\D$\UPLOAD1\TRADEFILE\'+@Mgr+'\' + @FILENAME 
	
	SET @SQL=''
	SET @SQL=@SQL+' BULK	INSERT tblNSDEXTradeTemp FROM '
	SET @SQL=@SQL+''''+ @PATH +''''
	SET @SQL=@SQL+' WITH '
	SET @SQL=@SQL+' ( '
	SET @SQL=@SQL+' FIELDTERMINATOR = '','','
	SET @SQL=@SQL+' ROWTERMINATOR = ''\n'''
	SET @SQL=@SQL+' ) '
	--PRINT (@SQL)
	EXEC(@SQL)
	
	DELETE FROM tblNSDEXTrade WHERE FNAME=@FILENAME AND MGR=@MGR
	
	INSERT INTO TBLNSDEXTrade
	SELECT TradeNo,Dummy1,InstType,Symbol,Expiry,Dummy2,Dummy3,ContractDescription,
			Dummy4,OrderType1,Dummy5,ClinetCode_DealerID,Dummy6,Buy_Sell,Qty,Rate,
			Dummy7,ClinetCode,MemberID,Dummy8,Dummy9,TradeDateTime,OrderDateTime,OrderNo,
			Dummy10,Segement,Dummy11,Dummy12,Dummy13,OrderType2,Dummy14,@Mgr,
			@FILENAME,CONVERT(VARCHAR,GETDATE(),103) FROM TBLNSDEXTradeTemp
	SET NOCOUNT OFF
	
END

GO

-- --------------------------------------------------
-- PROCEDURE E15318.USP_FIND_STMT_BYKEYWORD_IN_USP
-- --------------------------------------------------
CREATE PROCEDURE USP_FIND_STMT_BYKEYWORD_IN_USP   
(      
  @DBNAME VARCHAR(500),      
  @KEY_TO_SEARCH VARCHAR(500),  
  @KEY_SP_NAME VARCHAR(500) = NULL      
)      
      
AS      
BEGIN      
      
 SET NOCOUNT ON     
  
 /*****************************************************************      
 USE TO STORE PARTICULAR SP CONTAIN IN WHILE LOOP    
 ***************************************************************/    
 CREATE TABLE #TEMP  
 (   
 SP_CONTAIN VARCHAR(MAX)    
 )    
  
 /*****************************************************************      
 USE TO STORE FINAL RESULT TO DISPLAY      
 ***************************************************************/      
 CREATE TABLE #TEMP_RESULT      
 (      
 SRNO INT IDENTITY(1,1),      
 SP_NAME VARCHAR(MAX),      
 SQL_STATEMENT VARCHAR(MAX)      
 )      
  
 /*****************************************************************      
 USE TO STORE SP NAMES WHICH CONTAIN KEYWORD TO SEARCH      
 ***************************************************************/      
 CREATE TABLE #TEMP_SPNAME      
 (      
 SRNO INT IDENTITY(1,1),      
 SP_NAME VARCHAR(MAX)      
 )      
  
 /*****************************************************************      
 USE TO STORE SP CONTAIN ALONG WITH IT'S NAME      
 ***************************************************************/      
 CREATE TABLE #TEMP_SP_CONTAIN      
 (      
 SRNO INT IDENTITY(1,1),      
 SP_NAME VARCHAR(MAX),      
 SP_CONTAIN VARCHAR(MAX)      
 )      
  
 SET @KEY_TO_SEARCH  = '%' + @KEY_TO_SEARCH + '%'                
  
 DECLARE @STR AS VARCHAR(1000)              
 SET @STR=''              
  
 IF @DBNAME <>''              
 BEGIN              
  SET @DBNAME=@DBNAME+'.DBO.'              
 END              
 ELSE              
 BEGIN              
  SET @DBNAME=DB_NAME()+'.DBO.'              
 END              
  
 SET @STR = 'SELECT DISTINCT O.NAME FROM ' + @DBNAME + 'SYSCOMMENTS  C '               
 SET @STR = @STR + ' JOIN ' + @DBNAME +'SYSOBJECTS O ON O.ID = C.ID '  
 SET @STR = @STR + ' WHERE O.XTYPE IN (''P'')  AND C.TEXT LIKE ''' + @KEY_TO_SEARCH + ''''   
 IF ISNULL(@KEY_SP_NAME,'') <> ''              
 BEGIN  
  SET @STR = @STR + '  AND O.NAME LIKE ''' + @KEY_SP_NAME + ''''                
 END  
  
 INSERT INTO #TEMP_SPNAME EXEC(@STR)      
  
 DECLARE @SP_COUNT INT      
 DECLARE @SP_SEARCH_NAME VARCHAR(MAX)    
  
 DECLARE @COUNT INT     
 SET @COUNT = 1     
  
 SET @SP_COUNT = (SELECT COUNT(*) FROM #TEMP_SPNAME)      
  
 /*****************************************************************      
 USE TO GET PARTICULAR STATEMENT FROM EACH STORE PROCEDURE      
 ***************************************************************/      
 IF (@SP_COUNT > 0)      
 BEGIN      
  
 WHILE( @COUNT <= @SP_COUNT )      
 BEGIN      
  
  SET @SP_SEARCH_NAME = (SELECT SP_NAME FROM #TEMP_SPNAME A WHERE A.SRNO = @COUNT)  
  INSERT INTO #TEMP EXEC SP_HELPTEXT @SP_SEARCH_NAME  
  INSERT INTO #TEMP_SP_CONTAIN SELECT @SP_SEARCH_NAME,SP_CONTAIN FROM #TEMP  
  TRUNCATE TABLE #TEMP    
  
 SET @COUNT = @COUNT + 1    
  
 END      
  
 END      
  
 INSERT INTO #TEMP_RESULT   
  SELECT SP_NAME,SP_CONTAIN   
 FROM #TEMP_SP_CONTAIN   
 WHERE SP_CONTAIN LIKE @KEY_TO_SEARCH      
  
 SELECT * FROM #TEMP_RESULT      
  
 SET NOCOUNT OFF        
  
END

GO

-- --------------------------------------------------
-- PROCEDURE E15318.Usp_MISDaily_turnover_trade_details
-- --------------------------------------------------
create procedure Usp_MISDaily_turnover_trade_details(@filename as varchar(25))  
AS

GO

-- --------------------------------------------------
-- TABLE E15318.MCXSXTradeTemp
-- --------------------------------------------------
CREATE TABLE [E15318].[MCXSXTradeTemp]
(
    [TradeNo] VARCHAR(30) NULL,
    [Dummy1] VARCHAR(30) NULL,
    [Dummy2] VARCHAR(30) NULL,
    [InstType] VARCHAR(30) NULL,
    [Symbol] VARCHAR(30) NULL,
    [Expiry] DATETIME NULL,
    [Dummy3] VARCHAR(30) NULL,
    [Dummy4] VARCHAR(30) NULL,
    [Dummy5] VARCHAR(30) NULL,
    [Symbol1] VARCHAR(50) NULL,
    [Dummy6] VARCHAR(30) NULL,
    [OrderType1] VARCHAR(30) NULL,
    [Dummy7] VARCHAR(30) NULL,
    [DealerID] VARCHAR(30) NULL,
    [Dummy8] VARCHAR(30) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy9] VARCHAR(30) NULL,
    [party_code] VARCHAR(30) NULL,
    [MemberID1] VARCHAR(30) NULL,
    [Dummy10] VARCHAR(30) NULL,
    [MemberID2] VARCHAR(30) NULL,
    [Dummy11] VARCHAR(30) NULL,
    [sauda_date] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNo] VARCHAR(30) NULL,
    [Dummy12] VARCHAR(30) NULL,
    [Dummy13] VARCHAR(50) NULL,
    [sauda_date1] DATETIME NULL,
    [Dummy14] VARCHAR(30) NULL,
    [Dummy15] VARCHAR(30) NULL,
    [Dummy16] VARCHAR(30) NULL,
    [OrderType2] VARCHAR(30) NULL,
    [Dummy17] VARCHAR(30) NULL,
    [Dummy18] VARCHAR(30) NULL,
    [Dummy19] VARCHAR(30) NULL,
    [Dummy20] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.NSDEXTradeTemp
-- --------------------------------------------------
CREATE TABLE [E15318].[NSDEXTradeTemp]
(
    [TradeNo] VARCHAR(30) NULL,
    [Dummy1] VARCHAR(30) NULL,
    [InstType] VARCHAR(30) NULL,
    [Symbol] VARCHAR(30) NULL,
    [Expiry] DATETIME NULL,
    [Dummy2] VARCHAR(30) NULL,
    [Dummy3] VARCHAR(30) NULL,
    [ContractDescription] VARCHAR(30) NULL,
    [Dummy4] VARCHAR(30) NULL,
    [OrderType1] VARCHAR(50) NULL,
    [Dummy5] VARCHAR(30) NULL,
    [DealerID] VARCHAR(20) NULL,
    [Dummy6] VARCHAR(30) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy7] VARCHAR(30) NULL,
    [party_code] VARCHAR(30) NULL,
    [MemberID] VARCHAR(30) NULL,
    [Dummy8] VARCHAR(30) NULL,
    [Dummy9] VARCHAR(30) NULL,
    [sauda_date] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNo] VARCHAR(30) NULL,
    [Dummy10] VARCHAR(30) NULL,
    [Segement] VARCHAR(20) NULL,
    [Dummy11] VARCHAR(30) NULL,
    [Dummy12] VARCHAR(30) NULL,
    [Dummy13] VARCHAR(30) NULL,
    [OrderType2] VARCHAR(50) NULL,
    [Dummy14] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tbl_restricted_scrips_24082010
-- --------------------------------------------------
CREATE TABLE [E15318].[tbl_restricted_scrips_24082010]
(
    [sc_code] VARCHAR(10) NULL,
    [symbol] VARCHAR(100) NULL,
    [sc_name] VARCHAR(30) NULL,
    [sc_group] VARCHAR(100) NULL,
    [segment] VARCHAR(50) NULL,
    [isin_no] VARCHAR(50) NULL,
    [status] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tbl_restricted_scrips_TEMP_NSE
-- --------------------------------------------------
CREATE TABLE [E15318].[tbl_restricted_scrips_TEMP_NSE]
(
    [symbol] VARCHAR(100) NULL,
    [sc_group] VARCHAR(100) NULL,
    [isin_no] VARCHAR(50) NULL,
    [status] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tbl_turnoverlist_23082010
-- --------------------------------------------------
CREATE TABLE [E15318].[tbl_turnoverlist_23082010]
(
    [sc_code] VARCHAR(10) NULL,
    [symbol] VARCHAR(100) NULL,
    [sc_name] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tblMCXSXTrade
-- --------------------------------------------------
CREATE TABLE [E15318].[tblMCXSXTrade]
(
    [TradeNo] VARCHAR(30) NULL,
    [Dummy1] VARCHAR(30) NULL,
    [Dummy2] VARCHAR(30) NULL,
    [InstType] VARCHAR(30) NULL,
    [Symbol1] VARCHAR(30) NULL,
    [Expiry] DATETIME NULL,
    [Dummy3] VARCHAR(30) NULL,
    [Dummy4] VARCHAR(30) NULL,
    [Dummy5] VARCHAR(30) NULL,
    [Symbol2] VARCHAR(50) NULL,
    [Dummy6] VARCHAR(30) NULL,
    [OrderType1] VARCHAR(30) NULL,
    [Dummy7] VARCHAR(30) NULL,
    [ClinetCode_DealerID] VARCHAR(30) NULL,
    [Dummy8] VARCHAR(30) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy9] VARCHAR(30) NULL,
    [ClinetCode] VARCHAR(30) NULL,
    [MemberID1] VARCHAR(30) NULL,
    [Dummy10] VARCHAR(30) NULL,
    [MemberID2] VARCHAR(30) NULL,
    [Dummy11] VARCHAR(30) NULL,
    [TradeDateTime1] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNo] VARCHAR(30) NULL,
    [Dummy12] VARCHAR(30) NULL,
    [Dummy13] VARCHAR(50) NULL,
    [TradeDateTime2] DATETIME NULL,
    [Dummy14] VARCHAR(30) NULL,
    [Dummy15] VARCHAR(30) NULL,
    [Dummy16] VARCHAR(30) NULL,
    [OrderType2] VARCHAR(30) NULL,
    [Dummy17] VARCHAR(30) NULL,
    [Dummy18] VARCHAR(30) NULL,
    [Dummy19] VARCHAR(30) NULL,
    [Dummy20] VARCHAR(30) NULL,
    [Mgr] VARCHAR(20) NULL,
    [FName] VARCHAR(50) NULL,
    [UploadDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tblMCXSXTradeTemp
-- --------------------------------------------------
CREATE TABLE [E15318].[tblMCXSXTradeTemp]
(
    [TradeNo] VARCHAR(30) NULL,
    [Dummy1] VARCHAR(30) NULL,
    [Dummy2] VARCHAR(30) NULL,
    [InstType] VARCHAR(30) NULL,
    [Symbol1] VARCHAR(30) NULL,
    [Expiry] DATETIME NULL,
    [Dummy3] VARCHAR(30) NULL,
    [Dummy4] VARCHAR(30) NULL,
    [Dummy5] VARCHAR(30) NULL,
    [Symbol2] VARCHAR(50) NULL,
    [Dummy6] VARCHAR(30) NULL,
    [OrderType1] VARCHAR(30) NULL,
    [Dummy7] VARCHAR(30) NULL,
    [ClinetCode_DealerID] VARCHAR(30) NULL,
    [Dummy8] VARCHAR(30) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy9] VARCHAR(30) NULL,
    [ClinetCode] VARCHAR(30) NULL,
    [MemberID1] VARCHAR(30) NULL,
    [Dummy10] VARCHAR(30) NULL,
    [MemberID2] VARCHAR(30) NULL,
    [Dummy11] VARCHAR(30) NULL,
    [TradeDateTime1] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNo] VARCHAR(30) NULL,
    [Dummy12] VARCHAR(30) NULL,
    [Dummy13] VARCHAR(50) NULL,
    [TradeDateTime2] DATETIME NULL,
    [Dummy14] VARCHAR(30) NULL,
    [Dummy15] VARCHAR(30) NULL,
    [Dummy16] VARCHAR(30) NULL,
    [OrderType2] VARCHAR(30) NULL,
    [Dummy17] VARCHAR(30) NULL,
    [Dummy18] VARCHAR(30) NULL,
    [Dummy19] VARCHAR(30) NULL,
    [Dummy20] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tblNSDEXTrade
-- --------------------------------------------------
CREATE TABLE [E15318].[tblNSDEXTrade]
(
    [TradeNo] VARCHAR(30) NULL,
    [Dummy1] VARCHAR(30) NULL,
    [InstType] VARCHAR(30) NULL,
    [Symbol] VARCHAR(30) NULL,
    [Expiry] DATETIME NULL,
    [Dummy2] VARCHAR(30) NULL,
    [Dummy3] VARCHAR(30) NULL,
    [ContractDescription] VARCHAR(30) NULL,
    [Dummy4] VARCHAR(30) NULL,
    [OrderType1] VARCHAR(50) NULL,
    [Dummy5] VARCHAR(30) NULL,
    [ClinetCode_DealerID] VARCHAR(20) NULL,
    [Dummy6] VARCHAR(30) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy7] VARCHAR(30) NULL,
    [ClinetCode] VARCHAR(30) NULL,
    [MemberID] VARCHAR(30) NULL,
    [Dummy8] VARCHAR(30) NULL,
    [Dummy9] VARCHAR(30) NULL,
    [TradeDateTime] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNo] VARCHAR(30) NULL,
    [Dummy10] VARCHAR(30) NULL,
    [Segement] VARCHAR(20) NULL,
    [Dummy11] VARCHAR(30) NULL,
    [Dummy12] VARCHAR(30) NULL,
    [Dummy13] VARCHAR(30) NULL,
    [OrderType2] VARCHAR(50) NULL,
    [Dummy14] VARCHAR(30) NULL,
    [Mgr] VARCHAR(20) NULL,
    [FName] VARCHAR(50) NULL,
    [UploadDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tblNSDEXTradeTemp
-- --------------------------------------------------
CREATE TABLE [E15318].[tblNSDEXTradeTemp]
(
    [TradeNo] VARCHAR(30) NULL,
    [Dummy1] VARCHAR(30) NULL,
    [InstType] VARCHAR(30) NULL,
    [Symbol] VARCHAR(30) NULL,
    [Expiry] DATETIME NULL,
    [Dummy2] VARCHAR(30) NULL,
    [Dummy3] VARCHAR(30) NULL,
    [ContractDescription] VARCHAR(30) NULL,
    [Dummy4] VARCHAR(30) NULL,
    [OrderType1] VARCHAR(50) NULL,
    [Dummy5] VARCHAR(30) NULL,
    [ClinetCode_DealerID] VARCHAR(20) NULL,
    [Dummy6] VARCHAR(30) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy7] VARCHAR(30) NULL,
    [ClinetCode] VARCHAR(30) NULL,
    [MemberID] VARCHAR(30) NULL,
    [Dummy8] VARCHAR(30) NULL,
    [Dummy9] VARCHAR(30) NULL,
    [TradeDateTime] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNo] VARCHAR(30) NULL,
    [Dummy10] VARCHAR(30) NULL,
    [Segement] VARCHAR(20) NULL,
    [Dummy11] VARCHAR(30) NULL,
    [Dummy12] VARCHAR(30) NULL,
    [Dummy13] VARCHAR(30) NULL,
    [OrderType2] VARCHAR(50) NULL,
    [Dummy14] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tblNSETrade
-- --------------------------------------------------
CREATE TABLE [E15318].[tblNSETrade]
(
    [TradeNo] VARCHAR(20) NULL,
    [Dummy1] VARCHAR(20) NULL,
    [Symbol] VARCHAR(20) NULL,
    [Series] VARCHAR(20) NULL,
    [ScripName] VARCHAR(50) NULL,
    [Dummy2] VARCHAR(20) NULL,
    [Dummy3] VARCHAR(20) NULL,
    [Dummy5] VARCHAR(20) NULL,
    [ClinetCode_DealerID] VARCHAR(20) NULL,
    [Dummy6] VARCHAR(20) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy7] VARCHAR(20) NULL,
    [ClinetCode1] VARCHAR(20) NULL,
    [MemberID] VARCHAR(20) NULL,
    [MarketType] VARCHAR(20) NULL,
    [Dummy8] VARCHAR(20) NULL,
    [Dummy9] VARCHAR(20) NULL,
    [TradeDateTime] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNumber] VARCHAR(20) NULL,
    [Dummy10] VARCHAR(20) NULL,
    [Segement] VARCHAR(20) NULL,
    [ClinetCode2] VARCHAR(20) NULL,
    [ClinetCode3] VARCHAR(20) NULL,
    [Dummy11] VARCHAR(20) NULL,
    [ProductType] VARCHAR(20) NULL,
    [TradeTime] DATETIME NULL,
    [OrderTime] DATETIME NULL,
    [Mgr] VARCHAR(20) NULL,
    [FName] VARCHAR(50) NULL,
    [UploadDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.tblNSETradeTemp
-- --------------------------------------------------
CREATE TABLE [E15318].[tblNSETradeTemp]
(
    [TradeNo] VARCHAR(20) NULL,
    [Dummy1] VARCHAR(20) NULL,
    [Symbol] VARCHAR(20) NULL,
    [Series] VARCHAR(20) NULL,
    [ScripName] VARCHAR(50) NULL,
    [Dummy2] VARCHAR(20) NULL,
    [Dummy3] VARCHAR(20) NULL,
    [Dummy5] VARCHAR(20) NULL,
    [ClinetCode_DealerID] VARCHAR(20) NULL,
    [Dummy6] VARCHAR(20) NULL,
    [Buy_Sell] CHAR(1) NULL,
    [Qty] INT NULL,
    [Rate] MONEY NULL,
    [Dummy7] VARCHAR(20) NULL,
    [ClinetCode1] VARCHAR(20) NULL,
    [MemberID] VARCHAR(20) NULL,
    [MarketType] VARCHAR(20) NULL,
    [Dummy8] VARCHAR(20) NULL,
    [Dummy9] VARCHAR(20) NULL,
    [TradeDateTime] DATETIME NULL,
    [OrderDateTime] DATETIME NULL,
    [OrderNumber] VARCHAR(20) NULL,
    [Dummy10] VARCHAR(20) NULL,
    [Segement] VARCHAR(20) NULL,
    [ClinetCode2] VARCHAR(20) NULL,
    [ClinetCode3] VARCHAR(20) NULL,
    [Dummy11] VARCHAR(20) NULL,
    [ProductType] VARCHAR(20) NULL,
    [TradeTime] DATETIME NULL,
    [OrderTime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE E15318.TEMP_BULK_INSERT
-- --------------------------------------------------
CREATE TABLE [E15318].[TEMP_BULK_INSERT]
(
    [Sr] VARCHAR(800) NULL,
    [Name] VARCHAR(800) NULL,
    [Address] VARCHAR(800) NULL,
    [Pan_no] VARCHAR(800) NULL,
    [Dt_SEBI_Order] VARCHAR(800) NULL,
    [Order_NO] VARCHAR(100) NULL,
    [Brief_particulars] VARCHAR(800) NULL,
    [Start_Date] VARCHAR(800) NULL,
    [End_date] VARCHAR(500) NULL
);

GO


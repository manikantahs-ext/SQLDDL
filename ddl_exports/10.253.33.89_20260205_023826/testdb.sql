-- DDL Export
-- Server: 10.253.33.89
-- Database: testdb
-- Exported: 2026-02-05T02:39:30.636837

USE testdb;
GO

-- --------------------------------------------------
-- FUNCTION dbo.ADDSPACE
-- --------------------------------------------------
CREATE FUNCTION ADDSPACE(@MWORD VARCHAR(100))
RETURNs VARCHAR(100)
AS
BEGIN
DECLARE @CTR AS INT, @NWORD AS VARCHAR(100), @LCTR AS INT
SET @CTR = 2
SET @LCTR = 0
SET @NWORD=@MWORD

WHILE @CTR <= LEN(@MWORD)
BEGIN
	IF ASCII(SUBSTRING(@MWORD,@CTR,1)) BETWEEN 65 AND 90
	BEGIN
		SET @NWORD =SUBSTRING(@NWORD,1,@CTR-1+@LCTR)+' '+SUBSTRING(@NWORD,@CTR+@LCTR,100)
		--PRINT @LCTR
		SET @LCTR=@LCTR +1
	END
	SET @CTR=@CTR +1
END
RETURN(@NWORD)
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.fn_gspGlobalVariablessis
-- --------------------------------------------------
CREATE FUNCTION [dbo].[fn_gspGlobalVariablessis]
	(	@process_id int--,
--		@server varchar(255),
--		@database_name varchar(50),
--		@db_user_id varchar(255),		-- Server Login Id
--		@db_password varchar(255),		-- Server Password if using SQL Security to load Package (UID is SUSER_NAME())
--		@package_name varchar(255), 	-- Package Name (Defaults to most recent version)
--		@package_password varchar(255)	-- Package Password
	)
RETURNS varchar(5000)
AS
BEGIN
	/*	set @server ='KS2KBOMNIR07'
		set @database_name ='EAINSE'
		SET	@db_user_id ='qss'
		set	@db_password ='qss'
		set @package_name ='testRonil'
		set	@package_password ='ronil'
	*/
		Declare @dts_id AS varchar(10)					--	DTS_id if the DTS which needs to be called for the process
		Declare @global_variable_name as varchar(5000) 	-- 	Attribute Name of the Global Variable
		Declare @global_variable_values as varchar(5000)
		DECLARE @pkg_path as varchar(500) ------Get Package Path from tbl_tbl_mst_dtsname table

		select  @global_variable_name = global_variable_name , 
				@global_variable_values = global_variable_values 
		from tbl_tbl_mst_dtsname A , tbl_dtsprocess B
		where a.dts_id = b.dts_id 
				and b.process_id = @process_id

		Declare @parameter as VARCHAR(3000) 
		DECLARE @MLen INT, @MPos1 INT , @MFlag1 INT , @MStr VARCHAR(520) , @MStartPos INT
		DECLARE @MRowid INT , @parameterid INT

		DECLARE @GlobalVariableTAB TABLE ( VCount int Identity,
											HeaderName varchar(255),
											Value varchar(255) )	

		--Insert into @GlobalVariableTAB(HeaderName, Value) values ('server_name' , @Server)
		--Insert into @GlobalVariableTAB (HeaderName, Value ) values ('database_name' , @Database_name)
		--Insert into @GlobalVariableTAB (HeaderName, Value ) values ('db_user_id' , @db_user_id)
		--Insert into @GlobalVariableTAB (HeaderName, Value ) values ('db_password' , @db_password)
		--Insert into @GlobalVariableTAB (HeaderName, Value ) values ('package_name' , @package_name)
		--Insert into @GlobalVariableTAB (HeaderName, Value ) values ('pkg_password' , @package_password)
		------------- UPDATE HEADER ----------------------
		set @parameter = @global_variable_name
		set @MLen = 0
		set @MPos1 = 0
		set @MFlag1 = 0
		set @MStartPos = 1
		set @parameterid =1
			
		set @parameter = @parameter + '#$|'
		set @MLen = charindex('#$|', @parameter, @MStartPos)
	
		WHILE @MFlag1 = 0
		BEGIN -- while
			set @MPos1 = charindex(',',@parameter,@MStartPos)
			IF @MPos1 = 0
				BEGIN
				SET @MStr = substring(@parameter,@MStartPos , @MLen -@MStartPos)
				SET @MFlag1 = 1	
				END
			ELSE
				SET @MStr = substring(@parameter,@MStartPos,@MPos1-@MStartPos)
			SET @MStartPos = @MPos1 + 1
			INSERT INTO @GlobalVariableTAB (HeaderName) VALUES(@MStr)
			SET @parameterid = 1
		END	-- while
		-------------------------------------------------------------------------
		------------- UPDATE DATA ----------------------
		DECLARE @Counter INT			
		set @parameter = @global_variable_values
		set @MLen = 0
		set @MPos1 = 0
		set @MFlag1 = 0
		set @MStartPos = 1
		set @parameterid =1
		set @Counter = 1 --- Change when Parameter changes
		set @parameter = @parameter + '#$|'
		set @MLen = charindex('#$|', @parameter, @MStartPos)
	
		WHILE @MFlag1 = 0
		BEGIN -- while
			set @MPos1 = charindex(',',@parameter,@MStartPos)
			IF @MPos1 = 0
				BEGIN
				SET @MStr = substring(@parameter,@MStartPos , @MLen -@MStartPos)
				SET @MFlag1 = 1	
				END
			ELSE
				SET @MStr = substring(@parameter,@MStartPos,@MPos1-@MStartPos)
			SET @MStartPos = @MPos1 + 1
			UPDATE @GlobalVariableTAB set Value = @MStr where vCount = @Counter
			set @Counter = 	@Counter + 1
			SET @parameterid = 1
		END	-- while
	-------------------------------------------------------------------------
	DECLARE @GlobalVariable varchar(5000) --Variable to store the Global Variable
	--Initialize @EmailId to avoid NULL concatenation
	SET @GlobalVariable = ''
	SELECT @GlobalVariable = @GlobalVariable  +  isnull(HeaderName,'') + '=' + isnull(value,'') + '|$|' 
	FROM @GlobalVariableTAB
	set @GlobalVariable = ltrim(rtrim(@GlobalVariable)) 
	set @GlobalVariable =	(select left(@GlobalVariable , len(@GlobalVariable) - 3)) 
--	Select HeaderName  from @GlobalVariable
	--DROP TABLE @GlobalVariable

	Select  @pkg_path = package_path
	from tbl_tbl_mst_dtsname A , tbl_dtsprocess B
	where a.dts_id = b.dts_id 
		and b.process_id = @process_id

	Set @GlobalVariable = @GlobalVariable + '@' + @pkg_path

	RETURN @GlobalVariable

END

GO

-- --------------------------------------------------
-- FUNCTION dbo.GetListParameter
-- --------------------------------------------------
create function GetListParameter(@Proceduere as varchar(100)) 
returns varchar(500)
as begin
declare @cnt as bigint
declare @temp as table (id int,parameter_name varchar(50))
insert into @temp 
select * from 
(select ROW_NUMBER() over(order by parameter_name) as ID ,parameter_name from INFORMATION_SCHEMA.PARAMETERS where SPECIFIC_NAME=@Proceduere)ab

select @cnt=count(1) from @temp

declare @i as int
set @i =1

declare @paramList as varchar(max)
set @paramList=''
while(@i<=@cnt)
begin

		declare @str as varchar(50)

		select @str=parameter_name from @temp where id=@i

		set @paramList =@paramList+','+ @str 

		set @i=@i+1
end

declare @FinalStr as varchar(max) 

set @FinalStr =REPLACE (@paramList,'@','')
set @FinalStr= SUBSTRING (@FinalStr,2,LEN (@FinalStr))



return @FinalStr


end

GO

-- --------------------------------------------------
-- FUNCTION dbo.GetRequestStatus
-- --------------------------------------------------
CREATE FUNCTION GetRequestStatus(@RequestId int)
RETURNS @tbl_Request_status TABLE (
    [RequestId] [int]  NOT NULL,
	[Request] [varchar](200) NULL,
	[RaisedBy] [varchar](50) NULL,
	[RaisedDate] [datetime] NULL,
	[LevelId] [int] NULL,
	[Levels] [varchar] NULL,
	[IsApproved] [int] NULL,
	[ApprovedBy] [varchar](50) NULL,
	[ApprovedDate] [datetime] NULL,
	[Staus][varchar](50) NULL
) 
AS
BEGIN
   INSERT INTO @tbl_Request_status (RequestId,Request,RaisedBy,RaisedDate ,ApprovedBy,ApprovedDate,LevelId,Levels,Staus)
   select s.RequestId,s.Request,s.RaisedBy,s.RaisedDate,ApprovedBy,ApprovedDate, l.LevelId,l.Levels ,case when (s.RequestId IS NULL or s.IsApproved =0) then 'Pending' else case when (s.IsApproved =9) then 'Rejected' else 'Approved' end end as status 
   from (select RequestId,Request,RaisedBy,RaisedDate, IsApproved,ApprovedBy,ApprovedDate,LevelId from tbl_Request_status where RequestId=@RequestId)s right join tbl_Level l
   on s.LevelId=l.LevelId
   
  
   RETURN;
END;

GO

-- --------------------------------------------------
-- FUNCTION dbo.MNY2DEC
-- --------------------------------------------------

CREATE FUNCTION MNY2DEC(@VAL MONEY)
RETURNS MONEY 
AS 
BEGIN
declare @dec as int,@DEC2 AS MONEY
set @dec = charindex('.',convert(varchar(20),@VAL))
select @DEC2=CONVERT(MONEY,substring(convert(varchar(20),@VAL),1,@dec-1)+substring(convert(varchar(20),@VAL),@DEC,3))
RETURN @DEC2
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.parseJSON
-- --------------------------------------------------
CREATE FUNCTION [dbo].[parseJSON]( @JSON NVARCHAR(MAX))
	RETURNS @hierarchy TABLE
	  (
	   element_id INT IDENTITY(1, 1) NOT NULL, /* internal surrogate primary key gives the order of parsing and the list order */
	   sequenceNo [INT] NULL, /* the place in the sequence for the element */
	   parent_ID INT,/* if the element has a parent then it is in this column. The document is the ultimate parent, so you can get the structure from recursing from the document */
	   Object_ID INT,/* each list or object has an object id. This ties all elements to a parent. Lists are treated as objects here */
	   NAME NVARCHAR(2000),/* the name of the object */
	   StringValue NVARCHAR(MAX) NOT NULL,/*the string representation of the value of the element. */
	   ValueType VARCHAR(10) NOT NULL /* the declared type of the value represented as a string in StringValue*/
	  )
	AS
	BEGIN
	  DECLARE
	    @FirstObject INT, --the index of the first open bracket found in the JSON string
	    @OpenDelimiter INT,--the index of the next open bracket found in the JSON string
	    @NextOpenDelimiter INT,--the index of subsequent open bracket found in the JSON string
	    @NextCloseDelimiter INT,--the index of subsequent close bracket found in the JSON string
	    @Type NVARCHAR(10),--whether it denotes an object or an array
	    @NextCloseDelimiterChar CHAR(1),--either a '}' or a ']'
	    @Contents NVARCHAR(MAX), --the unparsed contents of the bracketed expression
	    @Start INT, --index of the start of the token that you are parsing
	    @end INT,--index of the end of the token that you are parsing
	    @param INT,--the parameter at the end of the next Object/Array token
	    @EndOfName INT,--the index of the start of the parameter at end of Object/Array token
	    @token NVARCHAR(200),--either a string or object
	    @value NVARCHAR(MAX), -- the value as a string
	    @SequenceNo int, -- the sequence number within a list
	    @name NVARCHAR(200), --the name as a string
	    @parent_ID INT,--the next parent ID to allocate
	    @lenJSON INT,--the current length of the JSON String
	    @characters NCHAR(36),--used to convert hex to decimal
	    @result BIGINT,--the value of the hex symbol being parsed
	    @index SMALLINT,--used for parsing the hex value
	    @Escape INT --the index of the next escape character
	    
	  DECLARE @Strings TABLE /* in this temporary table we keep all strings, even the names of the elements, since they are 'escaped' in a different way, and may contain, unescaped, brackets denoting objects or lists. These are replaced in the JSON string by tokens representing the string */
	    (
	     String_ID INT IDENTITY(1, 1),
	     StringValue NVARCHAR(MAX)
	    )
	  SELECT--initialise the characters to convert hex to ascii
	    @characters='0123456789abcdefghijklmnopqrstuvwxyz',
	    @SequenceNo=0, --set the sequence no. to something sensible.
	  /* firstly we process all strings. This is done because [{} and ] aren't escaped in strings, which complicates an iterative parse. */
	    @parent_ID=0;
	  WHILE 1=1 --forever until there is nothing more to do
	    BEGIN
	      SELECT
	        @start=PATINDEX('%[^a-zA-Z]["]%', @json collate SQL_Latin1_General_CP850_Bin);--next delimited string
	      IF @start=0 BREAK --no more so drop through the WHILE loop
	      IF SUBSTRING(@json, @start+1, 1)='"' 
	        BEGIN --Delimited Name
	          SET @start=@Start+1;
	          SET @end=PATINDEX('%[^\]["]%', RIGHT(@json, LEN(@json+'|')-@start) collate SQL_Latin1_General_CP850_Bin);
	        END
	      IF @end=0 --no end delimiter to last string
	        BREAK --no more
	      SELECT @token=SUBSTRING(@json, @start+1, @end-1)
	      --now put in the escaped control characters
	      SELECT @token=REPLACE(@token, FROMString, TOString)
	      FROM
	        (SELECT
	          '\"' AS FromString, '"' AS ToString
	         UNION ALL SELECT '\\', '\'
	         UNION ALL SELECT '\/', '/'
	         UNION ALL SELECT '\b', CHAR(08)
	         UNION ALL SELECT '\f', CHAR(12)
	         UNION ALL SELECT '\n', CHAR(10)
	         UNION ALL SELECT '\r', CHAR(13)
	         UNION ALL SELECT '\t', CHAR(09)
	        ) substitutions
	      SELECT @result=0, @escape=1
	  --Begin to take out any hex escape codes
	      WHILE @escape>0
	        BEGIN
	          SELECT @index=0,
	          --find the next hex escape sequence
	          @escape=PATINDEX('%\x[0-9a-f][0-9a-f][0-9a-f][0-9a-f]%', @token collate SQL_Latin1_General_CP850_Bin)
	          IF @escape>0 --if there is one
	            BEGIN
	              WHILE @index<4 --there are always four digits to a \x sequence   
	                BEGIN
	                  SELECT --determine its value
	                    @result=@result+POWER(16, @index)
	                    *(CHARINDEX(SUBSTRING(@token, @escape+2+3-@index, 1),
	                                @characters)-1), @index=@index+1 ;
	         
	                END
	                -- and replace the hex sequence by its unicode value
	              SELECT @token=STUFF(@token, @escape, 6, NCHAR(@result))
	            END
	        END
	      --now store the string away 
	      INSERT INTO @Strings (StringValue) SELECT @token
	      -- and replace the string with a token
	      SELECT @JSON=STUFF(@json, @start, @end+1,
	                    '@string'+CONVERT(NVARCHAR(5), @@identity))
	    END
	  -- all strings are now removed. Now we find the first leaf.  
	  WHILE 1=1  --forever until there is nothing more to do
	  BEGIN
	 
	  SELECT @parent_ID=@parent_ID+1
	  --find the first object or list by looking for the open bracket
	  SELECT @FirstObject=PATINDEX('%[{[[]%', @json collate SQL_Latin1_General_CP850_Bin)--object or array
	  IF @FirstObject = 0 BREAK
	  IF (SUBSTRING(@json, @FirstObject, 1)='{') 
	    SELECT @NextCloseDelimiterChar='}', @type='object'
	  ELSE 
	    SELECT @NextCloseDelimiterChar=']', @type='array'
	  SELECT @OpenDelimiter=@firstObject
	  WHILE 1=1 --find the innermost object or list...
	    BEGIN
	      SELECT
	        @lenJSON=LEN(@JSON+'|')-1
	  --find the matching close-delimiter proceeding after the open-delimiter
	      SELECT
	        @NextCloseDelimiter=CHARINDEX(@NextCloseDelimiterChar, @json,
	                                      @OpenDelimiter+1)
	  --is there an intervening open-delimiter of either type
	      SELECT @NextOpenDelimiter=PATINDEX('%[{[[]%',
	             RIGHT(@json, @lenJSON-@OpenDelimiter)collate SQL_Latin1_General_CP850_Bin)--object
	      IF @NextOpenDelimiter=0 
	        BREAK
	      SELECT @NextOpenDelimiter=@NextOpenDelimiter+@OpenDelimiter
	      IF @NextCloseDelimiter<@NextOpenDelimiter 
	        BREAK
	      IF SUBSTRING(@json, @NextOpenDelimiter, 1)='{' 
	        SELECT @NextCloseDelimiterChar='}', @type='object'
	      ELSE 
	        SELECT @NextCloseDelimiterChar=']', @type='array'
	      SELECT @OpenDelimiter=@NextOpenDelimiter
	    END
	  ---and parse out the list or name/value pairs
	  SELECT
	    @contents=SUBSTRING(@json, @OpenDelimiter+1,
	                        @NextCloseDelimiter-@OpenDelimiter-1)
	  SELECT
	    @JSON=STUFF(@json, @OpenDelimiter,
	                @NextCloseDelimiter-@OpenDelimiter+1,
	                '@'+@type+CONVERT(NVARCHAR(5), @parent_ID))
	  WHILE (PATINDEX('%[A-Za-z0-9@+.e]%', @contents COLLATE SQL_Latin1_General_CP850_Bin))<>0 
	    BEGIN
	      IF @Type='Object' --it will be a 0-n list containing a string followed by a string, number,boolean, or null
	        BEGIN
	          SELECT
	            @SequenceNo=0,@end=CHARINDEX(':', ' '+@contents)--if there is anything, it will be a string-based name.
	          SELECT  @start=PATINDEX('%[^A-Za-z@][@]%', ' '+@contents collate SQL_Latin1_General_CP850_Bin)--AAAAAAAA
	          SELECT @token=SUBSTRING(' '+@contents, @start+1, @End-@Start-1),
	            @endofname=PATINDEX('%[0-9]%', @token collate SQL_Latin1_General_CP850_Bin),
	            @param=RIGHT(@token, LEN(@token)-@endofname+1)
	          SELECT
	            @token=LEFT(@token, @endofname-1),
	            @Contents=RIGHT(' '+@contents, LEN(' '+@contents+'|')-@end-1)
	          SELECT  @name=stringvalue FROM @strings
	            WHERE string_id=@param --fetch the name
	        END
	      ELSE 
	        SELECT @Name=NULL,@SequenceNo=@SequenceNo+1 
	      SELECT
	        @end=CHARINDEX(',', @contents)-- a string-token, object-token, list-token, number,boolean, or null
	      IF @end=0 
	        SELECT  @end=PATINDEX('%[A-Za-z0-9@+.e][^A-Za-z0-9@+.e]%', @Contents+' ' collate SQL_Latin1_General_CP850_Bin)
	          +1
	       SELECT
	        @start=PATINDEX('%[^A-Za-z0-9@+.e][A-Za-z0-9@+.e]%', ' '+@contents collate SQL_Latin1_General_CP850_Bin)
	      --select @start,@end, LEN(@contents+'|'), @contents  
	      SELECT
	        @Value=RTRIM(SUBSTRING(@contents, @start, @End-@Start)),
	        @Contents=RIGHT(@contents+' ', LEN(@contents+'|')-@end)
	      IF SUBSTRING(@value, 1, 7)='@object' 
	        INSERT INTO @hierarchy
	          (NAME, SequenceNo, parent_ID, StringValue, Object_ID, ValueType)
	          SELECT @name, @SequenceNo, @parent_ID, SUBSTRING(@value, 8, 5),
	            SUBSTRING(@value, 8, 5), 'object' 
	      ELSE 
	        IF SUBSTRING(@value, 1, 6)='@array' 
	          INSERT INTO @hierarchy
	            (NAME, SequenceNo, parent_ID, StringValue, Object_ID, ValueType)
	            SELECT @name, @SequenceNo, @parent_ID, SUBSTRING(@value, 7, 5),
	              SUBSTRING(@value, 7, 5), 'array' 
	        ELSE 
	          IF SUBSTRING(@value, 1, 7)='@string' 
	            INSERT INTO @hierarchy
	              (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	              SELECT @name, @SequenceNo, @parent_ID, stringvalue, 'string'
	              FROM @strings
	              WHERE string_id=SUBSTRING(@value, 8, 5)
	          ELSE 
	            IF @value IN ('true', 'false') 
	              INSERT INTO @hierarchy
	                (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                SELECT @name, @SequenceNo, @parent_ID, @value, 'boolean'
	            ELSE
	              IF @value='null' 
	                INSERT INTO @hierarchy
	                  (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                  SELECT @name, @SequenceNo, @parent_ID, @value, 'null'
	              ELSE
	                IF PATINDEX('%[^0-9]%', @value COLLATE SQL_Latin1_General_CP850_Bin)>0 
	                  INSERT INTO @hierarchy
	                    (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                    SELECT @name, @SequenceNo, @parent_ID, @value, 'real'
	                ELSE
	                  INSERT INTO @hierarchy
	                    (NAME, SequenceNo, parent_ID, StringValue, ValueType)
	                    SELECT @name, @SequenceNo, @parent_ID, @value, 'int'
	      IF @Contents=' ' SELECT @SequenceNo=0
	    END
	  END
	INSERT INTO @hierarchy (NAME, SequenceNo, parent_ID, StringValue, Object_ID, ValueType)
	  SELECT '-',1, NULL, '', @parent_id-1, @type
	--
	   RETURN
	END

GO

-- --------------------------------------------------
-- FUNCTION dbo.SplitString
-- --------------------------------------------------
CREATE FUNCTION SplitString
(    
      @Input NVARCHAR(MAX),
      @Character CHAR(1)
)
RETURNS @Output TABLE (
      Item NVARCHAR(1000)
)
AS
BEGIN
      DECLARE @StartIndex INT, @EndIndex INT
 
      SET @StartIndex = 1
      IF SUBSTRING(@Input, LEN(@Input) - 1, LEN(@Input)) <> @Character
      BEGIN
            SET @Input = @Input + @Character
      END
 
      WHILE CHARINDEX(@Character, @Input) > 0
      BEGIN
            SET @EndIndex = CHARINDEX(@Character, @Input)
           
            INSERT INTO @Output(Item)
            SELECT SUBSTRING(@Input, @StartIndex, @EndIndex - 1)
           
            SET @Input = SUBSTRING(@Input, @EndIndex + 1, LEN(@Input))
      END
 
      RETURN
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.UDP_B2BMAILBODY
-- --------------------------------------------------

CREATE FUNCTION [dbo].[UDP_B2BMAILBODY](@MEETINGID AS INT,@PURPOSEID AS INT,@TABLENAME AS VARCHAR(50)) RETURNS VARCHAR(MAX)
BEGIN  
		DECLARE @MAILTABLE VARCHAR(max)='';  
		DECLARE @MAILHEADER VARCHAR(max)='';  
		DECLARE @MAILBOTTOM VARCHAR(max)=''; 
		DECLARE @COMPLIANCE  VARCHAR(15)=''; 
		DECLARE @MEETINGSTATUS   VARCHAR(15)=''; 
		DECLARE @SBTAG  VARCHAR(20)='';
		DECLARE @VISITDATE  VARCHAR(50)='';
		DECLARE @REMARK  VARCHAR(500)=''
		DECLARE @LASTMEETING  VARCHAR(50)=''
		DECLARE @SESSIONID  VARCHAR(100)=''
		DECLARE @BMUSERID  VARCHAR(100)=''

		DECLARE @PURPOSE AS VARCHAR(20)=''
		DECLARE @REQUIREMENT AS VARCHAR(20)=''
		DECLARE @BMACTION AS VARCHAR(20)=''
		DECLARE @EXPECTEDOUTCOME AS VARCHAR(200)=''
		DECLARE @PARAMETER AS VARCHAR(500)=''
		DECLARE @TARGETDATE AS VARCHAR(50)=''
		DECLARE @FORMTITLE AS VARCHAR(50)
		------DEVELOPED HEADEAR ---START
		SELECT @BMUSERID=BMUSERID,@COMPLIANCE=CASE WHEN COMPLIANCE =1 THEN 'YES' ELSE 'NO' END,
		@MEETINGSTATUS=CASE WHEN MEETINGSTATUS =1 THEN 'YES' ELSE 'NO' END,@SBTAG=SBTAG ,@VISITDATE=VISITDATE,
		@LASTMEETING=LASTMEETING FROM TBL_B2BMAINTRANSACTION WHERE ID=@MEETINGID

		SELECT @PURPOSE=P.Purpose ,@REQUIREMENT=R.Requirement,@BMACTION=A.BMAction,@EXPECTEDOUTCOME=E.ExpectedOut,@PARAMETER= UPPER (PARAMETER ),@TARGETDATE=TARGETDATE  
		FROM (SELECT MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE FROM  TBL_B2BPURPOSETRANSACTION WHERE ID =@PURPOSEID ) T 
		LEFT JOIN tbl_B2BPurposeMaster P
		ON P.PID =T.PURPOSE 
		LEFT JOIN tbl_B2BReqMaster R
		ON T.REQUIREMENT =R.RID
		LEFT JOIN tbl_B2BMActionMaster A
		ON A.BID =T.BMACTION
		LEFT JOIN tbl_B2BExPectedOutMaster E
		ON E.EID=T.EXPECTEDOUTCOME

		

		IF @TABLENAME='EVENT'
		BEGIN
			DECLARE @ISNEWCLIENT AS VARCHAR(10)='',
			@SEGMENTIMPROVEMENT AS VARCHAR(100)='',
			@ISSBACQUISITION AS VARCHAR(10)='',
			@ISMUTUALFUND AS VARCHAR(10)='',
			@DATE AS VARCHAR(25)='',
			@TIME AS VARCHAR(25)='',
			@VENUE AS VARCHAR(50)='',
			@ISEVENTEXPERIENCE AS VARCHAR(10)='',
			@EVENTORGANIZEDDATE AS VARCHAR(50)='',
			@PURPOSEOFEVENT AS VARCHAR(300)='',
			@PARTICIPANTSSIZE AS VARCHAR(30)='',
			@LEADSGENERATED AS VARCHAR(50)='',
			@SBCONVERTED AS VARCHAR(50)='',
			@ANTICIPATEDPARTICIPANTS AS VARCHAR(50)='',
			@PROSPECTIVELEADSFORINVITATION AS VARCHAR(50)='',
			@KYCEXPECTED AS VARCHAR(50)='',
			@AVERAGEMARGINPERKYC AS VARCHAR(50)='',
			@CLIENTSOPENINGNEWSEGMENTS AS VARCHAR(50)='',
			@SBEXPECTED AS VARCHAR(50)='',
			@AVERAGEDEPOSITPERSB AS VARCHAR(50)='',
			@SUGGESTION AS VARCHAR(300)=''

			SET @FORMTITLE='EVENT ASSESSMENT QUESTIONNAIRE'

			SELECT @ISNEWCLIENT= CASE WHEN ISNEWCLIENT =1 THEN 'YES' ELSE 'NO' END,
			@SEGMENTIMPROVEMENT=SEGMENTIMPROVEMENT,
			@ISSBACQUISITION= CASE WHEN ISSBACQUISITION =1 THEN 'YES' ELSE 'NO' END,
			@ISMUTUALFUND= CASE WHEN ISMUTUALFUND =1 THEN 'YES' ELSE 'NO' END,
			@DATE=DATE,@TIME=TIME,@VENUE=VENUE,
			@ISEVENTEXPERIENCE= CASE WHEN ISEVENTEXPERIENCE =1 THEN 'YES' ELSE 'NO' END,
			@EVENTORGANIZEDDATE=EVENTORGANIZEDDATE,
			@PURPOSEOFEVENT=PURPOSEOFEVENT,@PARTICIPANTSSIZE=PARTICIPANTSSIZE,@LEADSGENERATED=LEADSGENERATED,
			@SBCONVERTED=SBCONVERTED,@ANTICIPATEDPARTICIPANTS=ANTICIPATEDPARTICIPANTS,@PROSPECTIVELEADSFORINVITATION=PROSPECTIVELEADSFORINVITATION,
			@KYCEXPECTED=KYCEXPECTED,@AVERAGEMARGINPERKYC=AVERAGEMARGINPERKYC,@CLIENTSOPENINGNEWSEGMENTS=CLIENTSOPENINGNEWSEGMENTS,@SBEXPECTED=SBEXPECTED,
			@AVERAGEDEPOSITPERSB=AVERAGEDEPOSITPERSB,@SUGGESTION=SUGGESTION
			 FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID= @PURPOSEID


			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                      <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>What is the Agenda of this event?</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New client acquisition</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblNewclientAcq''''>'+@isNewclient+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Segment Improvement</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSegmentImprovement''''>'+@SegmentImprovement+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>SB Acquisition</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSbAcquisition''''>'+@ISSBACQUISITION+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mutual Fund?</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''Label1''''>'+@ISMUTUALFUND+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Please fill in the Event details</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Date</b></td>
                                                            <td align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''''lblDate''''>'+@Date+'</label></td>
                                                              <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Time</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblTime''''>'+@Time+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Venue</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblVenue''''>'+@Venue+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left"  style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Do We have experience to organize such events in the past?</b></td>                                                            
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''''lblPastExperience''''>'+@ISEVENTEXPERIENCE+'</label></td>
                                                        </tr>
                                                         <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Which was the last event organised?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventOrg''''>'+@EVENTORGANIZEDDATE+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What was the purpose of event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventpurpose''''>'+@PURPOSEOFEVENT+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What was the participant size of the event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblParticipantSize''''>'+@PARTICIPANTSSIZE+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How many lead got generated?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblLeadGenerated''''>'+@LEADSGENERATED+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How many SB converted?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSBConverted''''>'+@SBCONVERTED+'</label></td>
                                                        </tr>
                                                          <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How are we generating the perspective leads for the invitation?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblLeadInvitation''''>'+@PROSPECTIVELEADSFORINVITATION+'</label></td>
                                                        </tr>
                                                          <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What is the participation anticipated in this event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''Label2''''>'+@ANTICIPATEDPARTICIPANTS+'</label></td>
                                                        </tr>
                                                          <tr style="display:none;">
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What is the expected outcome of the event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventOutcome''''>EventOutcome</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New client acquisition(in 1m Timeframe)</b></td>                                                            
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No of KYC Expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblKycExpected''''>'+@KYCEXPECTED+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Average margin per kyc Expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblAvgKycExpected''''>'+@AVERAGEMARGINPERKYC+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Segment Improvement</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No. of client opening new segments</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblNewSegment''''>'+@CLIENTSOPENINGNEWSEGMENTS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New SB acquisition(in 1m Timeframe)</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No. of SB expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSBExpected''''>'+@SBEXPECTED+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Average Deposit per SB</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblAvgDeposit''''>'+@AVERAGEDEPOSITPERSB+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Your Suggestion, if any.</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSuggesstion''''>'+@SUGGESTION+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'



		END

		IF @TABLENAME='HIRING'
		BEGIN
			DECLARE @NAME AS VARCHAR(20)='',
			@BUSINESSPARTNERTAG AS VARCHAR(20)='',
			@ADDRESS AS VARCHAR(500)='',
			@CONTACTPERSON AS VARCHAR(50)='',
			@CONTACTEMAILID AS VARCHAR(50)='',
			@DESIGNATION AS VARCHAR(50)='',
			@SALARYMIN AS VARCHAR(50)='',
			@SALARYMAX AS VARCHAR(50)='',
			@EDUQUALIFICATION AS VARCHAR(50)='',
			@EXPERIENCEYEAR AS VARCHAR(50)='',
			@EXPERIENCEMONTHS AS VARCHAR(50)='',
			@RESOURCES AS VARCHAR(300)=''

			SET @FORMTITLE='HIRING FORM'

			SELECT @NAME=NAME,@BUSINESSPARTNERTAG=BUSINESSPARTNERTAG,@ADDRESS=ADDRESS,@CONTACTPERSON=CONTACTPERSON,@CONTACTEMAILID=CONTACTEMAILID,
			@DESIGNATION=DESIGNATION,@SALARYMIN=SALARYMIN,@SALARYMAX=SALARYMAX,@EDUQUALIFICATION=EDUQUALIFICATION,
			@EXPERIENCEYEAR=EXPERIENCEYEAR,@EXPERIENCEMONTHS=EXPERIENCEMONTHS,@RESOURCES=RESOURCES
			FROM TBL_B2BHIRING 
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Name</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblName''>'+@NAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusiness''>'+@BUSINESSPARTNERTAG+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblAdd''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblContact''>'+@CONTACTPERSON+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblContactEmail''>'+@CONTACTEMAILID+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Designation</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDesignation''>'+@DESIGNATION+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Salary Per Month</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMin''>Min : '+@SALARYMIN+'</label></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMax''>Max : '+@SALARYMAX+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Edu. Qualification</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEducation''>'+@EDUQUALIFICATION+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Experience</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblYear''>'+@EXPERIENCEYEAR+' Years</label></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMonth''>'+@EXPERIENCEMONTHS+' Months</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Resource</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblResource''>'+@RESOURCES+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'

		END

		IF @TABLENAME='COLLATE'
		BEGIN
			DECLARE @Zone AS VARCHAR(20)='',
			@Region AS VARCHAR(20)='',
			@BRANCHTAG AS VARCHAR(500)='',
			@PARTNERNAME AS VARCHAR(200)='',
			@MATERIALTYPE AS VARCHAR(200)='',
			@MATERIALSIZE AS VARCHAR(50)='',
			@DISPATCHLOCATION AS VARCHAR(500)='',
			@CONTACTPERSONNAME AS VARCHAR(200)='',
			@PARTNERADDRESS AS VARCHAR(500)='',
			@CITY AS VARCHAR(50)='',
			@STATE AS VARCHAR(300)='',
			@CONTACTNUMBER AS VARCHAR(50)=''

			SET @FORMTITLE='MARKETING COLLATERAL SCHEME ORDER FORMAT'

			SELECT @Zone=Zone,@Region=Region,@BRANCHTAG=BRANCHTAG,@BUSINESSPARTNERTAG=BUSINESSPARTNERTAG,@PARTNERNAME=PARTNERNAME,
			@MATERIALTYPE=MATERIALTYPE,@MATERIALSIZE=MATERIALSIZE,@DISPATCHLOCATION=DISPATCHLOCATION,@CONTACTPERSONNAME=CONTACTPERSONNAME,
			@PARTNERADDRESS=PARTNERADDRESS,@CITY=CITY,@STATE=STATE,@CONTACTNUMBER=CONTACTNUMBER
			 FROM tbl_B2BMktCollateral
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Zone</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblZone''>'+@ZONE+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Region</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblRegion''>'+@REGION+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Branch Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBranchTag''>'+@BRANCHTAG+'</label> </td>

                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@BUSINESSPARTNERTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Registered Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblRBusinessPartName''>'+@PARTNERNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Material Type</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMaterial''>'+@MATERIALTYPE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Size of material</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMaterialSize''>'+@MATERIALSIZE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Dispatch Location</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDispatchLoc''>'+@DISPATCHLOCATION+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Name of Contact(if Business partner address selected)</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblNameOfContact''>'+@CONTACTPERSONNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Complete Address of Business partner</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessAddPartner''>'+@PARTNERADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>City</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblCity''>'+@CITY+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>State</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblState''>'+@STATE+'</label></td>
                                                        </tr>

                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No. of Business Partner</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessPartnerContact''>'+@CONTACTNUMBER+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='VCARD'
		BEGIN
			DECLARE @SRNUM AS VARCHAR(20)='',
			@PARTNARNAME AS VARCHAR(200)='',
			@PARTNERTAG AS VARCHAR(50)='',
			@DEPARTMENT AS VARCHAR(50)='',
			@QTY AS VARCHAR(50)='',
			@LINEOFBUSINESS AS VARCHAR(500)='',
			@FIRSTNAME AS VARCHAR(100)='',
			@PINCODE AS VARCHAR(50)='',
			@LANDLINENUM AS VARCHAR(50)='',
			@EXTNUM AS VARCHAR(50)='',
			@FAXNUM AS VARCHAR(50)='',
			@MOBILENUM AS VARCHAR(50)='',
			@EMAIL AS VARCHAR(50)='',
			@REQUESTEDBY AS VARCHAR(50)='',
			@APPROVEDBY AS VARCHAR(50)=''

			SET @FORMTITLE='VISITING CARD REQUIRMENT'
			
			
			SELECT @SRNUM=SRNUM,@PARTNARNAME=PARTNARNAME,@PARTNERTAG=PARTNERTAG,@DESIGNATION=DESIGNATION,@DEPARTMENT=DEPARTMENT,
			@QTY=QTY,@LINEOFBUSINESS=LINEOFBUSINESS,@FIRSTNAME=FIRSTNAME,@BRANCHTAG=BRANCHTAG,@ADDRESS=ADDRESS,@PINCODE=PINCODE,
			@LANDLINENUM=LANDLINENUM,@EXTNUM=EXTNUM,@FAXNUM=FAXNUM,@MOBILENUM=MOBILENUM,@EMAIL=EMAIL,@REQUESTEDBY=REQUESTEDBY,
			@APPROVEDBY=APPROVEDBY
			 FROM TBL_B2BVCARD 
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>SR.No</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblSrNo''>'+@SRNUM+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessName''>'+@PARTNARNAME+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessTag''>'+@PARTNERTAG+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Designation</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblDesignation''>'+@DESIGNATION+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Department</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDepartment''>'+@DEPARTMENT+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Quantity</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblQuantity''>'+@QTY+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Line of Business</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lbllineofbusiness''>'+@LINEOFBUSINESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>First Name</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblFName''>'+@FIRSTNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Branch Tag</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBranch''>'+@BRANCHTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblAddress''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Pincode</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblPincode''>'+@PINCODE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblStd''>'+@LANDLINENUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Extn No</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblExtn''>'+@EXTNUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Fax No</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblFStd''>'+@FAXNUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mobile</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMobile''>'+@MOBILENUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEmail''>'+@EMAIL+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBPartnerTag''>'+@PARTNERTAG+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Requested by</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblRequestedBy''>'+@REQUESTEDBY+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Approved by</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblApproved''>'+@APPROVEDBY+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='LEAFLET'
		BEGIN
			DECLARE 
			@LEAFLET AS VARCHAR(500)='',
			@PARTICULARS AS VARCHAR(500)=''

			SET @FORMTITLE='LEEFLET PRINTING REQUIREMENT'

			SELECT @PARTNERTAG=PARTNERTAG,@PARTNARNAME=PARTNARNAME,@LANDLINENUM=LANDLINENUM,@MOBILENUM=MOBILENUM ,@EMAIL=EMAIL,
			@ADDRESS=ADDRESS,@LEAFLET=LEAFLET,@PARTICULARS=PARTICULARS
			
			FROM TBL_LEAFLET
			WHERE PURPOSEID= @PURPOSEID 

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@PARTNERTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessName''>'+@PARTNARNAME+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Landline No.</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lbllandlineNo''>'+@LANDLINENUM+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mobile No.</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblMobile''>'+@MOBILENUM+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEmail''>'+@EMAIL+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business partner Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessAdd''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Leaflet</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblLeaflet''>'+@LEAFLET+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Particulars</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblparticular''>'+@PARTICULARS+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='MICROSITE'
		BEGIN
			DECLARE @QUESTIONS AS VARCHAR(MAX)='',
			@BUSINESSOFFERING AS varchar(200)='',
			@FIRMESTABLISHEDYEAR AS VARCHAR(50)='',
			@WEBSITENAME AS VARCHAR(500)='',
			@DESCRIBEFIRM AS VARCHAR(500)='',
			@WHYUSOTHER AS VARCHAR(500)='',
			@COMPANY AS VARCHAR(500)='',
			@ADDRESS2 AS VARCHAR(500)='',
			@POSTALCODE AS VARCHAR(500)='',
			@EMAILID AS VARCHAR(500)='',
			@PHONE AS VARCHAR(500)='',
			@FACEBOOKLINK AS VARCHAR(500)='',
			@TWITTERLINK AS VARCHAR(500)='',
			@THEME AS VARCHAR(500)='',
			@COMPANYLOGO AS VARCHAR(500)=''
			SET @FORMTITLE='MICROSITE FORM'
			SELECT @QUESTIONS=QUESTIONS,@BUSINESSOFFERING=BUSINESSOFFERING,@SBTAG=SBTAG,@FIRMESTABLISHEDYEAR=FIRMESTABLISHEDYEAR,
			@WEBSITENAME=WEBSITENAME,@DESCRIBEFIRM=ISNULL(LEAFLET,''),@WHYUSOTHER=WHYUSOTHER,@NAME=NAME,@COMPANY=COMPANY,@ADDRESS=ADDRESS,@ADDRESS2=ADDRESS2,
			@CITY=CITY,@STATE=STATE,@POSTALCODE=POSTALCODE,@EMAILID=EMAILID,@PHONE=PHONE,@COMPANYLOGO=COMPANYLOGO,@THEME=THEME,@FACEBOOKLINK=FACEBOOKLINK,@TWITTERLINK=TWITTERLINK
			FROM TBL_B2BMICROSITE 
			WHERE PURPOSEID= @PURPOSEID 

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub Broker (SB) Tag?</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@SBTAG+' </label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Established date</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label1''lblBusinessName''>'+@FIRMESTABLISHEDYEAR+' </label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Website name?</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label2''lbllandlineNo''>'+@WEBSITENAME +'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Description obout firm</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''Label3''lblMobile''>'+@DESCRIBEFIRM +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Why choose us?</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label4''lblEmail''>'+@WHYUSOTHER+' </label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Current contact no, email id & registered address</b></td>                                                            
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Name</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label5''lblBusinessAdd''>'+@NAME +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Company</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label6''lblLeaflet''>'+@COMPANY+' </label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label7''lblparticular''>'+@ADDRESS +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address 2</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label8''lblparticular''>'+@ADDRESS2 +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>City/Town</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label9''lblparticular''>'+@CITY +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>State/Province</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label10''lblparticular''>'+@STATE +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>ZIP/Postal Code</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label11''lblparticular''>'+@POSTALCODE +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label12''lblparticular''>'+@EMAILID +'</label></td>
                                                              </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Phone Number</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label13''lblparticular''>'+@PHONE +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business offerings</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label14''lblparticular''>'+@BUSINESSOFFERING +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Facebook Link</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label15''lblparticular''>'+@FACEBOOKLINK +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Twitter Link</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label16''lblparticular''>'+@TWITTERLINK +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Theme </b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label17''lblparticular''>'+@THEME +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Company logo</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label18''lblparticular''>'+@COMPANYLOGO +'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		



		IF @TABLENAME='NONE'
		BEGIN
		SET @FORMTITLE=''
	 
		 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>'
		END


		 SET @MAILHEADER='<html xmlns="http://www.w3.org/1999/xhtml">
								<head id="Head1" runat="server">
									<title></title>
								</head>
								<body>
									<div id=":148" class="ii gt adP adO">
										<div id=":147" class="a3s aXjCH m15548d1330dd5acb">
											<div class="adM">
											</div>
											<div>
												<div class="adM">
												</div>
												<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width: 620px" width="620">
													<tbody>
														<tr>
															<td align="center" bgcolor="#0071bb" style="vertical-align: top; padding: 0px 0px 0px 0px; border-left: 1px solid #d1d1d1; border-top: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1; background-color: #0071bb">
																<table border="0" cellpadding="0" cellspacing="0" style="min-width: 620px" width="620">
																	<tbody>
																		<tr>
																			<td align="left" style="padding: 10px 0px 10px 5px" valign="bottom" width="325"><a href="http://lt.angelbroking.in/ltrack?id=cR0FAFVUCQQADh0IAwYGClUGW00=AQECVgEAVx4RRwJZVgUbWgQAUVFGdwBWVFNaWhFYCVheVBgBWVs=&amp;client=12239&amp;c=0000" target="_blank">
																				<img alt="Angel Broking" border="0" height="60" src="https://ci6.googleusercontent.com/proxy/VvPPCVxUkQNs55bhiHGuTICX4OAObGjHeq1vamj6tXPd0kLLKpGIlCC2lLfNIqfMtluGT3czxEZMnsgSjwA1sVNXTPLBSDvnOcXS-Oha8gjojtF1XLAiFsS8qr6bBcX7BZILKP-0AmtVWPMNmLoQTl8sucSJtsMl1i_PLAvNG4A=s0-d-e1-ft#http://web.angelbackoffice.com/angelbroking/econnect/Budget-special-webinar-26022016/images/Angel-logo.gif" style="display: block; color: #fff; background-color: #0071bb" width="189" class="CToWUd"></td>
																			<td align="right" valign="middle" width="325">
																				<table border="0" cellpadding="0" cellspacing="0" width="140">
																					<tbody>
																						<tr>
																							<td align="center" height="47" valign="middle">
																								<h6 style="font-family: ''''Open Sans'''',sans-serif; font-size: 16px; color: #ffffff; line-height: auto; padding: 0; margin: 0">DATE :<b>'+@VISITDATE+'</b></h6>
																							</td>
																						</tr>
																					</tbody>
																				</table>
																			</td>
																		</tr>
																	</tbody>
																</table>
															</td>
														</tr>
													</tbody>
												</table>
												<table align="center" bgcolor="#ededed" cellpadding="0" cellspacing="0" width="620">
													<tbody>
														<tr>
															<td align="center" bgcolor="#454545" style="vertical-align: top; font-family: ''''Open Sans'''',arial,sans-serif; font-size: 20px; font-weight: 400; color: #ffffff; line-height: 30px; text-align: left; padding: 0 0 0 0; text-align: center" valign="middle">
																'+@FORMTITLE+'</td>
														</tr>
														<tr>
															<td height="20px" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">&nbsp;</td>
														</tr>
														<tr>
														<td align="center" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">
														<table border="0" cellpadding="0" cellspacing="0" width="602">
														<tbody>
														<tr>
														<td style="padding: 0px 0px 0px 0px; background-color: #27a4a2; color: #ffffff">     
														</tr>
														<tr>
														<td align="center" bgcolor="#fff" style="padding: 0px 0 0px 0; background-color: #159ee8" valign="top">'

		------DEVELOPED HEADEAR ---END


			------DEVELOPED BOTTOM ---STRAT
										SET @MAILBOTTOM='</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td height="10px" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">&nbsp;</td>
													</tr>
													<tr>
														<td bgcolor="#384c63" style="padding: 10px 10px 10px 10px; background-color: #384c63">
															<table align="left" border="0" cellpadding="0" cellspacing="0" width="28%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px"><a href="http://www.angelbroking.com" target="_blank">www.angelbroking.com</a></td>
																	</tr>
																</tbody>
															</table>
															<table align="left" border="0" cellpadding="0" cellspacing="0" style="border-right: 1px solid #d1d1d1; border-left: 1px solid #d1d1d1" width="35%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px">1860 200 2006 / 1860 500 5006</td>
																	</tr>
																</tbody>
															</table>
															<table align="left" border="0" cellpadding="0" cellspacing="0" width="31%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px"><a href="mailto:inhouse.support@angelbroking.com" style="color: #ffffff" target="_blank">inhouse.support@angelbroking.<wbr>com</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td align="left" style="vertical-align: top">
															<table border="0" cellpadding="0" cellspacing="0" width="100%">
																<tbody>
																	<tr>
																		<td bgcolor="#DBDBDB" style="font-size: 50%; color: #ffffff; font-family: Arial,sans-serif; padding: 10px 5px 5px 10px; text-align: center; background-color: #384c63">Angel Broking Private Limited, Registered Office: G-1, Ackruti Trade Centre, Road No. 7, MIDC, Andheri (E), Mumbai  400 093. Tel: (022) 3083 7700. Fax: (022) 2835 8811, website: <a href="http://www.angelbroking.com" target="_blank">www.angelbroking.com</a>, CIN: U67120MH1996PTC101709, BSE Cash/F&amp;O: INB010996539 /INF010996539, NSE Cash/F&amp;O/CD: INB231279838/INF231279838/ INE231279838, MSEI: INE261279838, CDSL Regn. No.: IN - DP - CDSL - 234  2004, PMS Regn. Code:
							                                             PM/INP000001546</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
												</tbody>
											</table>
											<br>
											<div>
											</div>
											<img border="0" src="https://ci4.googleusercontent.com/proxy/kGU__8bP6TS7qtR9P_LldeRV_idn2XEUzyv8LrVaJBvcZw7U8jxeYdyH8VhbznmIA4zV_18zzRabfq4OfFXYNt35XZgbZnukqZiUUaCwbgylXGBK24ceiKmcWFt3_AtJB-t6J2oSA_V8CVc4bHqcrGt-W0o=s0-d-e1-ft#http://lt.angelbroking.in/ltrack?m=2619&amp;u=46933881566fc4e7116fffd6b9a591a7&amp;client=12239&amp;c=0000" class="CToWUd">
										</div>
										<div class="yj6qo"></div>
										<div class="adL">
										</div>
									</div>
								</div>
							</body>
							</html>'
				------DEVELOPED BOTTOM ---END
    
    RETURN @MAILHEADER +' '+ isnull( @MAILTABLE,'')+' '+@MAILBOTTOM;  
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.UDP_B2BMAILBODY_bk
-- --------------------------------------------------

CREATE FUNCTION [dbo].[UDP_B2BMAILBODY_bk](@MEETINGID AS INT,@PURPOSEID AS INT,@TABLENAME AS VARCHAR(50)) RETURNS VARCHAR(MAX)
BEGIN  
		DECLARE @MAILTABLE VARCHAR(max)='';  
		DECLARE @MAILHEADER VARCHAR(max)='';  
		DECLARE @MAILBOTTOM VARCHAR(max)=''; 
		DECLARE @COMPLIANCE  VARCHAR(15)=''; 
		DECLARE @MEETINGSTATUS   VARCHAR(15)=''; 
		DECLARE @SBTAG  VARCHAR(20)='';
		DECLARE @VISITDATE  VARCHAR(50)='';
		DECLARE @REMARK  VARCHAR(500)=''
		DECLARE @LASTMEETING  VARCHAR(50)=''
		DECLARE @SESSIONID  VARCHAR(100)=''
		DECLARE @BMUSERID  VARCHAR(100)=''

		DECLARE @PURPOSE AS VARCHAR(20)=''
		DECLARE @REQUIREMENT AS VARCHAR(20)=''
		DECLARE @BMACTION AS VARCHAR(20)=''
		DECLARE @EXPECTEDOUTCOME AS VARCHAR(200)=''
		DECLARE @PARAMETER AS VARCHAR(500)=''
		DECLARE @TARGETDATE AS VARCHAR(50)=''
		DECLARE @FORMTITLE AS VARCHAR(50)
		------DEVELOPED HEADEAR ---START
		SELECT @BMUSERID=BMUSERID,@COMPLIANCE=CASE WHEN COMPLIANCE =1 THEN 'YES' ELSE 'NO' END,
		@MEETINGSTATUS=CASE WHEN MEETINGSTATUS =1 THEN 'YES' ELSE 'NO' END,@SBTAG=SBTAG ,@VISITDATE=VISITDATE,
		@LASTMEETING=LASTMEETING FROM TBL_B2BMAINTRANSACTION WHERE ID=@MEETINGID

		SELECT @PURPOSE=P.Purpose ,@REQUIREMENT=R.Requirement,@BMACTION=A.BMAction,@EXPECTEDOUTCOME=E.ExpectedOut,@PARAMETER= UPPER (PARAMETER ),@TARGETDATE=TARGETDATE  
		FROM (SELECT MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE FROM  TBL_B2BPURPOSETRANSACTION WHERE ID =@PURPOSEID ) T 
		LEFT JOIN tbl_B2BPurposeMaster P
		ON P.PID =T.PURPOSE 
		LEFT JOIN tbl_B2BReqMaster R
		ON T.REQUIREMENT =R.RID
		LEFT JOIN tbl_B2BMActionMaster A
		ON A.BID =T.BMACTION
		LEFT JOIN tbl_B2BExPectedOutMaster E
		ON E.EID=T.EXPECTEDOUTCOME

		

		IF @TABLENAME='EVENT'
		BEGIN
			DECLARE @ISNEWCLIENT AS VARCHAR(10)='',
			@SEGMENTIMPROVEMENT AS VARCHAR(100)='',
			@ISSBACQUISITION AS VARCHAR(10)='',
			@ISMUTUALFUND AS VARCHAR(10)='',
			@DATE AS VARCHAR(25)='',
			@TIME AS VARCHAR(25)='',
			@VENUE AS VARCHAR(50)='',
			@ISEVENTEXPERIENCE AS VARCHAR(10)='',
			@EVENTORGANIZEDDATE AS VARCHAR(50)='',
			@PURPOSEOFEVENT AS VARCHAR(300)='',
			@PARTICIPANTSSIZE AS VARCHAR(30)='',
			@LEADSGENERATED AS VARCHAR(50)='',
			@SBCONVERTED AS VARCHAR(50)='',
			@ANTICIPATEDPARTICIPANTS AS VARCHAR(50)='',
			@PROSPECTIVELEADSFORINVITATION AS VARCHAR(50)='',
			@KYCEXPECTED AS VARCHAR(50)='',
			@AVERAGEMARGINPERKYC AS VARCHAR(50)='',
			@CLIENTSOPENINGNEWSEGMENTS AS VARCHAR(50)='',
			@SBEXPECTED AS VARCHAR(50)='',
			@AVERAGEDEPOSITPERSB AS VARCHAR(50)='',
			@SUGGESTION AS VARCHAR(300)=''

			SET @FORMTITLE='EVENT ASSESSMENT QUESTIONNAIRE'

			SELECT @ISNEWCLIENT= CASE WHEN ISNEWCLIENT =1 THEN 'YES' ELSE 'NO' END,
			@SEGMENTIMPROVEMENT=SEGMENTIMPROVEMENT,
			@ISSBACQUISITION= CASE WHEN ISSBACQUISITION =1 THEN 'YES' ELSE 'NO' END,
			@ISMUTUALFUND= CASE WHEN ISMUTUALFUND =1 THEN 'YES' ELSE 'NO' END,
			@DATE=DATE,@TIME=TIME,@VENUE=VENUE,
			@ISEVENTEXPERIENCE= CASE WHEN ISEVENTEXPERIENCE =1 THEN 'YES' ELSE 'NO' END,
			@EVENTORGANIZEDDATE=EVENTORGANIZEDDATE,
			@PURPOSEOFEVENT=PURPOSEOFEVENT,@PARTICIPANTSSIZE=PARTICIPANTSSIZE,@LEADSGENERATED=LEADSGENERATED,
			@SBCONVERTED=SBCONVERTED,@ANTICIPATEDPARTICIPANTS=ANTICIPATEDPARTICIPANTS,@PROSPECTIVELEADSFORINVITATION=PROSPECTIVELEADSFORINVITATION,
			@KYCEXPECTED=KYCEXPECTED,@AVERAGEMARGINPERKYC=AVERAGEMARGINPERKYC,@CLIENTSOPENINGNEWSEGMENTS=CLIENTSOPENINGNEWSEGMENTS,@SBEXPECTED=SBEXPECTED,
			@AVERAGEDEPOSITPERSB=AVERAGEDEPOSITPERSB,@SUGGESTION=SUGGESTION
			 FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID= @PURPOSEID


			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
                                                      <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>What is the Agenda of this event?</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New client acquisition</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblNewclientAcq''''>'+@isNewclient+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Segment Improvement</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSegmentImprovement''''>'+@SegmentImprovement+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>SB Acquisition</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSbAcquisition''''>'+@ISSBACQUISITION+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mutual Fund?</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''Label1''''>'+@ISMUTUALFUND+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Please fill in the Event details</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Date</b></td>
                                                            <td align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''''lblDate''''>'+@Date+'</label></td>
                                                              <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Time</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblTime''''>'+@Time+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Venue</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblVenue''''>'+@Venue+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left"  style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Do We have experience to organize such events in the past?</b></td>                                                            
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''''lblPastExperience''''>'+@ISEVENTEXPERIENCE+'</label></td>
                                                        </tr>
                                                         <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Which was the last event organised?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventOrg''''>'+@EVENTORGANIZEDDATE+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What was the purpose of event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventpurpose''''>'+@PURPOSEOFEVENT+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What was the participant size of the event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblParticipantSize''''>'+@PARTICIPANTSSIZE+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How many lead got generated?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblLeadGenerated''''>'+@LEADSGENERATED+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How many SB converted?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSBConverted''''>'+@SBCONVERTED+'</label></td>
                                                        </tr>
                                                          <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How are we generating the perspective leads for the invitation?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblLeadInvitation''''>'+@PROSPECTIVELEADSFORINVITATION+'</label></td>
                                                        </tr>
                                                          <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What is the participation anticipated in this event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''Label2''''>'+@ANTICIPATEDPARTICIPANTS+'</label></td>
                                                        </tr>
                                                          <tr style="display:none;">
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What is the expected outcome of the event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventOutcome''''>EventOutcome</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New client acquisition(in 1m Timeframe)</b></td>                                                            
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No of KYC Expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblKycExpected''''>'+@KYCEXPECTED+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Average margin per kyc Expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblAvgKycExpected''''>'+@AVERAGEMARGINPERKYC+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Segment Improvement</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No. of client opening new segments</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblNewSegment''''>'+@CLIENTSOPENINGNEWSEGMENTS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New SB acquisition(in 1m Timeframe)</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No. of SB expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSBExpected''''>'+@SBEXPECTED+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Average Deposit per SB</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblAvgDeposit''''>'+@AVERAGEDEPOSITPERSB+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Your Suggestion, if any.</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSuggesstion''''>'+@SUGGESTION+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'



		END

		IF @TABLENAME='HIRING'
		BEGIN
			DECLARE @NAME AS VARCHAR(20)='',
			@BUSINESSPARTNERTAG AS VARCHAR(20)='',
			@ADDRESS AS VARCHAR(500)='',
			@CONTACTPERSON AS VARCHAR(50)='',
			@CONTACTEMAILID AS VARCHAR(50)='',
			@DESIGNATION AS VARCHAR(50)='',
			@SALARYMIN AS VARCHAR(50)='',
			@SALARYMAX AS VARCHAR(50)='',
			@EDUQUALIFICATION AS VARCHAR(50)='',
			@EXPERIENCEYEAR AS VARCHAR(50)='',
			@EXPERIENCEMONTHS AS VARCHAR(50)='',
			@RESOURCES AS VARCHAR(300)=''

			SET @FORMTITLE='HIRING FORM'

			SELECT @NAME=NAME,@BUSINESSPARTNERTAG=BUSINESSPARTNERTAG,@ADDRESS=ADDRESS,@CONTACTPERSON=CONTACTPERSON,@CONTACTEMAILID=CONTACTEMAILID,
			@DESIGNATION=DESIGNATION,@SALARYMIN=SALARYMIN,@SALARYMAX=SALARYMAX,@EDUQUALIFICATION=EDUQUALIFICATION,
			@EXPERIENCEYEAR=EXPERIENCEYEAR,@EXPERIENCEMONTHS=EXPERIENCEMONTHS,@RESOURCES=RESOURCES
			FROM TBL_B2BHIRING 
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Name</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblName''>'+@NAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusiness''>'+@BUSINESSPARTNERTAG+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblAdd''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblContact''>'+@CONTACTPERSON+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblContactEmail''>'+@CONTACTEMAILID+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Designation</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDesignation''>'+@DESIGNATION+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Salary Per Month</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMin''>Min : '+@SALARYMIN+'</label></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMax''>Max : '+@SALARYMAX+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Edu. Qualification</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEducation''>'+@EDUQUALIFICATION+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Experience</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblYear''>'+@EXPERIENCEYEAR+' Years</label></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMonth''>'+@EXPERIENCEMONTHS+' Months</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Resource</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblResource''>'+@RESOURCES+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'

		END

		IF @TABLENAME='COLLATE'
		BEGIN
			DECLARE @Zone AS VARCHAR(20)='',
			@Region AS VARCHAR(20)='',
			@BRANCHTAG AS VARCHAR(500)='',
			@PARTNERNAME AS VARCHAR(200)='',
			@MATERIALTYPE AS VARCHAR(200)='',
			@MATERIALSIZE AS VARCHAR(50)='',
			@DISPATCHLOCATION AS VARCHAR(500)='',
			@CONTACTPERSONNAME AS VARCHAR(200)='',
			@PARTNERADDRESS AS VARCHAR(500)='',
			@CITY AS VARCHAR(50)='',
			@STATE AS VARCHAR(300)='',
			@CONTACTNUMBER AS VARCHAR(50)=''

			SET @FORMTITLE='MARKETING COLLATERAL SCHEME ORDER FORMAT'

			SELECT @Zone=Zone,@Region=Region,@BRANCHTAG=BRANCHTAG,@BUSINESSPARTNERTAG=BUSINESSPARTNERTAG,@PARTNERNAME=PARTNERNAME,
			@MATERIALTYPE=MATERIALTYPE,@MATERIALSIZE=MATERIALSIZE,@DISPATCHLOCATION=DISPATCHLOCATION,@CONTACTPERSONNAME=CONTACTPERSONNAME,
			@PARTNERADDRESS=PARTNERADDRESS,@CITY=CITY,@STATE=STATE,@CONTACTNUMBER=CONTACTNUMBER
			 FROM tbl_B2BMktCollateral
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Zone</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblZone''>'+@ZONE+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Region</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblRegion''>'+@REGION+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Branch Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBranchTag''>'+@BRANCHTAG+'</label> </td>

                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@BUSINESSPARTNERTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Registered Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblRBusinessPartName''>'+@PARTNERNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Material Type</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMaterial''>'+@MATERIALTYPE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Size of material</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMaterialSize''>'+@MATERIALSIZE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Dispatch Location</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDispatchLoc''>'+@DISPATCHLOCATION+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Name of Contact(if Business partner address selected)</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblNameOfContact''>'+@CONTACTPERSONNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Complete Address of Business partner</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessAddPartner''>'+@PARTNERADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>City</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblCity''>'+@CITY+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>State</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblState''>'+@STATE+'</label></td>
                                                        </tr>

                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No. of Business Partner</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessPartnerContact''>'+@CONTACTNUMBER+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='VCARD'
		BEGIN
			DECLARE @SRNUM AS VARCHAR(20)='',
			@PARTNARNAME AS VARCHAR(200)='',
			@PARTNERTAG AS VARCHAR(50)='',
			@DEPARTMENT AS VARCHAR(50)='',
			@QTY AS VARCHAR(50)='',
			@LINEOFBUSINESS AS VARCHAR(500)='',
			@FIRSTNAME AS VARCHAR(100)='',
			@PINCODE AS VARCHAR(50)='',
			@LANDLINENUM AS VARCHAR(50)='',
			@EXTNUM AS VARCHAR(50)='',
			@FAXNUM AS VARCHAR(50)='',
			@MOBILENUM AS VARCHAR(50)='',
			@EMAIL AS VARCHAR(50)='',
			@REQUESTEDBY AS VARCHAR(50)='',
			@APPROVEDBY AS VARCHAR(50)=''

			SET @FORMTITLE='VISITING CARD REQUIRMENT'
			
			
			SELECT @SRNUM=SRNUM,@PARTNARNAME=PARTNARNAME,@PARTNERTAG=PARTNERTAG,@DESIGNATION=DESIGNATION,@DEPARTMENT=DEPARTMENT,
			@QTY=QTY,@LINEOFBUSINESS=LINEOFBUSINESS,@FIRSTNAME=FIRSTNAME,@BRANCHTAG=BRANCHTAG,@ADDRESS=ADDRESS,@PINCODE=PINCODE,
			@LANDLINENUM=LANDLINENUM,@EXTNUM=EXTNUM,@FAXNUM=FAXNUM,@MOBILENUM=MOBILENUM,@EMAIL=EMAIL,@REQUESTEDBY=REQUESTEDBY,
			@APPROVEDBY=APPROVEDBY
			 FROM TBL_B2BVCARD 
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>SR.No</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblSrNo''>'+@SRNUM+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessName''>'+@PARTNARNAME+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessTag''>'+@PARTNERTAG+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Designation</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblDesignation''>'+@DESIGNATION+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Department</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDepartment''>'+@DEPARTMENT+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Quantity</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblQuantity''>'+@QTY+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Line of Business</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lbllineofbusiness''>'+@LINEOFBUSINESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>First Name</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblFName''>'+@FIRSTNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Branch Tag</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBranch''>'+@BRANCHTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblAddress''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Pincode</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblPincode''>'+@PINCODE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblStd''>'+@LANDLINENUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Extn No</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblExtn''>'+@EXTNUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Fax No</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblFStd''>'+@FAXNUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mobile</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMobile''>'+@MOBILENUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEmail''>'+@EMAIL+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBPartnerTag''>'+@PARTNERTAG+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Requested by</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblRequestedBy''>'+@REQUESTEDBY+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Approved by</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblApproved''>'+@APPROVEDBY+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='LEAFLET'
		BEGIN
			DECLARE 
			@LEAFLET AS VARCHAR(500)='',
			@PARTICULARS AS VARCHAR(500)=''

			SET @FORMTITLE='LEEFLET PRINTING REQUIREMENT'

			SELECT @PARTNERTAG=PARTNERTAG,@PARTNARNAME=PARTNARNAME,@LANDLINENUM=LANDLINENUM,@MOBILENUM=MOBILENUM ,@EMAIL=EMAIL,
			@ADDRESS=ADDRESS,@LEAFLET=LEAFLET,@PARTICULARS=PARTICULARS
			
			FROM TBL_LEAFLET
			WHERE PURPOSEID= @PURPOSEID 

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@PARTNERTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessName''>'+@PARTNARNAME+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Landline No.</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lbllandlineNo''>'+@LANDLINENUM+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mobile No.</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblMobile''>'+@MOBILENUM+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEmail''>'+@EMAIL+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business partner Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessAdd''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Leaflet</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblLeaflet''>'+@LEAFLET+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Particulars</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblparticular''>'+@PARTICULARS+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='MICROSITE'
		BEGIN
			DECLARE @QUESTIONS AS VARCHAR(MAX)='',
			@BUSINESSOFFERING AS varchar(200)='',
			@FIRMESTABLISHEDYEAR AS VARCHAR(50)='',
			@WEBSITENAME AS VARCHAR(500)='',
			@DESCRIBEFIRM AS VARCHAR(500)='',
			@WHYUSOTHER AS VARCHAR(500)='',
			@COMPANY AS VARCHAR(500)='',
			@ADDRESS2 AS VARCHAR(500)='',
			@POSTALCODE AS VARCHAR(500)='',
			@EMAILID AS VARCHAR(500)='',
			@PHONE AS VARCHAR(500)='',
			@FACEBOOKLINK AS VARCHAR(500)='',
			@TWITTERLINK AS VARCHAR(500)='',
			@THEME AS VARCHAR(500)='',
			@COMPANYLOGO AS VARCHAR(500)=''
			SET @FORMTITLE='MICROSITE FORM'
			SELECT @QUESTIONS=QUESTIONS,@BUSINESSOFFERING=BUSINESSOFFERING,@SBTAG=SBTAG,@FIRMESTABLISHEDYEAR=FIRMESTABLISHEDYEAR,
			@WEBSITENAME=WEBSITENAME,@DESCRIBEFIRM=ISNULL(LEAFLET,''),@WHYUSOTHER=WHYUSOTHER,@NAME=NAME,@COMPANY=COMPANY,@ADDRESS=ADDRESS,@ADDRESS2=ADDRESS2,
			@CITY=CITY,@STATE=STATE,@POSTALCODE=POSTALCODE,@EMAILID=EMAILID,@PHONE=PHONE,@COMPANYLOGO=COMPANYLOGO,@THEME=THEME,@FACEBOOKLINK=FACEBOOKLINK,@TWITTERLINK=TWITTERLINK
			FROM TBL_B2BMICROSITE 
			WHERE PURPOSEID= @PURPOSEID 

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub Broker (SB) Tag?</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@SBTAG+' </label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Established date</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label1''lblBusinessName''>'+@FIRMESTABLISHEDYEAR+' </label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Website name?</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label2''lbllandlineNo''>'+@WEBSITENAME +'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Description obout firm</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''Label3''lblMobile''>'+@DESCRIBEFIRM +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Why choose us?</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label4''lblEmail''>'+@WHYUSOTHER+' </label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Current contact no, email id & registered address</b></td>                                                            
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Name</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label5''lblBusinessAdd''>'+@NAME +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Company</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label6''lblLeaflet''>'+@COMPANY+' </label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label7''lblparticular''>'+@ADDRESS +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address 2</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label8''lblparticular''>'+@ADDRESS2 +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>City/Town</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label9''lblparticular''>'+@CITY +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>State/Province</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label10''lblparticular''>'+@STATE +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>ZIP/Postal Code</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label11''lblparticular''>'+@POSTALCODE +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label12''lblparticular''>'+@EMAILID +'</label></td>
                                                              </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Phone Number</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label13''lblparticular''>'+@PHONE +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business offerings</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label14''lblparticular''>'+@BUSINESSOFFERING +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Facebook Link</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label15''lblparticular''>'+@FACEBOOKLINK +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Twitter Link</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label16''lblparticular''>'+@TWITTERLINK +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Theme </b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label17''lblparticular''>'+@THEME +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Company logo</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label18''lblparticular''>'+@COMPANYLOGO +'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		



		IF @TABLENAME='NONE'
		BEGIN
		SET @FORMTITLE=''
	    SET @MAILTABLE=@MAILTABLE+''
		END


		 SET @MAILHEADER='<html xmlns="http://www.w3.org/1999/xhtml">
								<head id="Head1" runat="server">
									<title></title>
								</head>
								<body>
									<div id=":148" class="ii gt adP adO">
										<div id=":147" class="a3s aXjCH m15548d1330dd5acb">
											<div class="adM">
											</div>
											<div>
												<div class="adM">
												</div>
												<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width: 620px" width="620">
													<tbody>
														<tr>
															<td align="center" bgcolor="#0071bb" style="vertical-align: top; padding: 0px 0px 0px 0px; border-left: 1px solid #d1d1d1; border-top: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1; background-color: #0071bb">
																<table border="0" cellpadding="0" cellspacing="0" style="min-width: 620px" width="620">
																	<tbody>
																		<tr>
																			<td align="left" style="padding: 10px 0px 10px 5px" valign="bottom" width="325"><a href="http://lt.angelbroking.in/ltrack?id=cR0FAFVUCQQADh0IAwYGClUGW00=AQECVgEAVx4RRwJZVgUbWgQAUVFGdwBWVFNaWhFYCVheVBgBWVs=&amp;client=12239&amp;c=0000" target="_blank">
																				<img alt="Angel Broking" border="0" height="60" src="https://ci6.googleusercontent.com/proxy/VvPPCVxUkQNs55bhiHGuTICX4OAObGjHeq1vamj6tXPd0kLLKpGIlCC2lLfNIqfMtluGT3czxEZMnsgSjwA1sVNXTPLBSDvnOcXS-Oha8gjojtF1XLAiFsS8qr6bBcX7BZILKP-0AmtVWPMNmLoQTl8sucSJtsMl1i_PLAvNG4A=s0-d-e1-ft#http://web.angelbackoffice.com/angelbroking/econnect/Budget-special-webinar-26022016/images/Angel-logo.gif" style="display: block; color: #fff; background-color: #0071bb" width="189" class="CToWUd"></td>
																			<td align="right" valign="middle" width="325">
																				<table border="0" cellpadding="0" cellspacing="0" width="140">
																					<tbody>
																						<tr>
																							<td align="center" height="47" valign="middle">
																								<h6 style="font-family: ''''Open Sans'''',sans-serif; font-size: 16px; color: #ffffff; line-height: auto; padding: 0; margin: 0">DATE :<b>'+@VISITDATE+'</b></h6>
																							</td>
																						</tr>
																					</tbody>
																				</table>
																			</td>
																		</tr>
																	</tbody>
																</table>
															</td>
														</tr>
													</tbody>
												</table>
												<table align="center" bgcolor="#ededed" cellpadding="0" cellspacing="0" width="620">
													<tbody>
														<tr>
															<td align="center" bgcolor="#454545" style="vertical-align: top; font-family: ''''Open Sans'''',arial,sans-serif; font-size: 20px; font-weight: 400; color: #ffffff; line-height: 30px; text-align: left; padding: 0 0 0 0; text-align: center" valign="middle">
																'+@FORMTITLE+'</td>
														</tr>
														<tr>
															<td height="20px" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">&nbsp;</td>
														</tr>
														<tr>
														<td align="center" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">
														<table border="0" cellpadding="0" cellspacing="0" width="602">
														<tbody>
														<tr>
														<td style="padding: 0px 0px 0px 0px; background-color: #27a4a2; color: #ffffff">     
														</tr>
														<tr>
														<td align="center" bgcolor="#fff" style="padding: 0px 0 0px 0; background-color: #159ee8" valign="top">'

		------DEVELOPED HEADEAR ---END


			------DEVELOPED BOTTOM ---STRAT
										SET @MAILBOTTOM='</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td height="10px" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">&nbsp;</td>
													</tr>
													<tr>
														<td bgcolor="#384c63" style="padding: 10px 10px 10px 10px; background-color: #384c63">
															<table align="left" border="0" cellpadding="0" cellspacing="0" width="28%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px"><a href="http://www.angelbroking.com" target="_blank">www.angelbroking.com</a></td>
																	</tr>
																</tbody>
															</table>
															<table align="left" border="0" cellpadding="0" cellspacing="0" style="border-right: 1px solid #d1d1d1; border-left: 1px solid #d1d1d1" width="35%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px">1860 200 2006 / 1860 500 5006</td>
																	</tr>
																</tbody>
															</table>
															<table align="left" border="0" cellpadding="0" cellspacing="0" width="31%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px"><a href="mailto:feedback@angelbroking.com" style="color: #ffffff" target="_blank">wealthmanagement@angelbroking.<wbr>com</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td align="left" style="vertical-align: top">
															<table border="0" cellpadding="0" cellspacing="0" width="100%">
																<tbody>
																	<tr>
																		<td bgcolor="#DBDBDB" style="font-size: 50%; color: #ffffff; font-family: Arial,sans-serif; padding: 10px 5px 5px 10px; text-align: center; background-color: #384c63">Angel Broking Private Limited, Registered Office: G-1, Ackruti Trade Centre, Road No. 7, MIDC, Andheri (E), Mumbai  400 093. Tel: (022) 3083 7700. Fax: (022) 2835 8811, website: <a href="http://www.angelbroking.com" target="_blank">www.angelbroking.com</a>, CIN: U67120MH1996PTC101709, BSE Cash/F&amp;O: INB010996539 /INF010996539, NSE Cash/F&amp;O/CD: INB231279838/INF231279838/ INE231279838, MSEI: INE261279838, CDSL Regn. No.: IN - DP - CDSL - 234  2004, PMS Regn. Code:
							                                             PM/INP000001546, Compliance officer: Mr. Anoop Goyal, Tel: (022) 39413940, Email: <a href="mailto:compliance@angelbroking.com" target="_blank">compliance@angelbroking.com</a>. Angel Commodities Broking Private Ltd.: CIN: U67120MH1996PTC100872, Compliance Officer: Mr. Nirav Shah, MCX Member ID: 12685 / FMC Regn. No.: MCX / TCM / CORP / 0037 NCDEX: Member ID 00220 / FMC Regn. No.: NCDEX / TCM / CORP / 0302.</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
												</tbody>
											</table>
											<br>
											<div>
											</div>
											<img border="0" src="https://ci4.googleusercontent.com/proxy/kGU__8bP6TS7qtR9P_LldeRV_idn2XEUzyv8LrVaJBvcZw7U8jxeYdyH8VhbznmIA4zV_18zzRabfq4OfFXYNt35XZgbZnukqZiUUaCwbgylXGBK24ceiKmcWFt3_AtJB-t6J2oSA_V8CVc4bHqcrGt-W0o=s0-d-e1-ft#http://lt.angelbroking.in/ltrack?m=2619&amp;u=46933881566fc4e7116fffd6b9a591a7&amp;client=12239&amp;c=0000" class="CToWUd">
										</div>
										<div class="yj6qo"></div>
										<div class="adL">
										</div>
									</div>
								</div>
							</body>
							</html>'
				------DEVELOPED BOTTOM ---END
    
    RETURN @MAILHEADER +' '+ isnull( @MAILTABLE,'')+' '+@MAILBOTTOM;  
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.UDP_B2BMAILBODY_Final
-- --------------------------------------------------

CREATE  FUNCTION [dbo].[UDP_B2BMAILBODY_Final](@MEETINGID AS INT,@PURPOSEID AS INT,@TABLENAME AS VARCHAR(50)) RETURNS VARCHAR(MAX)
BEGIN  
		DECLARE @MAILTABLE VARCHAR(max)='';  
		DECLARE @MAILHEADER VARCHAR(max)='';  
		DECLARE @MAILBOTTOM VARCHAR(max)=''; 
		DECLARE @COMPLIANCE  VARCHAR(15)=''; 
		DECLARE @MEETINGSTATUS   VARCHAR(15)=''; 
		DECLARE @SBTAG  VARCHAR(20)='';
		DECLARE @VISITDATE  VARCHAR(50)='';
		DECLARE @REMARK  VARCHAR(500)=''
		DECLARE @LASTMEETING  VARCHAR(50)=''
		DECLARE @SESSIONID  VARCHAR(100)=''
		DECLARE @BMUSERID  VARCHAR(100)=''

		DECLARE @PURPOSE AS VARCHAR(20)=''
		DECLARE @REQUIREMENT AS VARCHAR(20)=''
		DECLARE @BMACTION AS VARCHAR(20)=''
		DECLARE @EXPECTEDOUTCOME AS VARCHAR(200)=''
		DECLARE @PARAMETER AS VARCHAR(500)=''
		DECLARE @TARGETDATE AS VARCHAR(50)=''
		DECLARE @FORMTITLE AS VARCHAR(50)
		------DEVELOPED HEADEAR ---START
		SELECT @BMUSERID=BMUSERID,@COMPLIANCE=CASE WHEN COMPLIANCE =1 THEN 'YES' ELSE 'NO' END,
		@MEETINGSTATUS=CASE WHEN MEETINGSTATUS =1 THEN 'YES' ELSE 'NO' END,@SBTAG=SBTAG ,@VISITDATE=VISITDATE,
		@LASTMEETING=LASTMEETING FROM TBL_B2BMAINTRANSACTION WHERE ID=@MEETINGID

		SELECT @PURPOSE=P.Purpose ,@REQUIREMENT=R.Requirement,@BMACTION=A.BMAction,@EXPECTEDOUTCOME=E.ExpectedOut,@PARAMETER= UPPER (PARAMETER ),@TARGETDATE=TARGETDATE  
		FROM (SELECT MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE FROM  TBL_B2BPURPOSETRANSACTION WHERE ID =@PURPOSEID ) T 
		LEFT JOIN tbl_B2BPurposeMaster P
		ON P.PID =T.PURPOSE 
		LEFT JOIN tbl_B2BReqMaster R
		ON T.REQUIREMENT =R.RID
		LEFT JOIN tbl_B2BMActionMaster A
		ON A.BID =T.BMACTION
		LEFT JOIN tbl_B2BExPectedOutMaster E
		ON E.EID=T.EXPECTEDOUTCOME

		

		IF @TABLENAME='EVENT'
		BEGIN
			DECLARE @ISNEWCLIENT AS VARCHAR(10)='',
			@SEGMENTIMPROVEMENT AS VARCHAR(100)='',
			@ISSBACQUISITION AS VARCHAR(10)='',
			@ISMUTUALFUND AS VARCHAR(10)='',
			@DATE AS VARCHAR(25)='',
			@TIME AS VARCHAR(25)='',
			@VENUE AS VARCHAR(50)='',
			@ISEVENTEXPERIENCE AS VARCHAR(10)='',
			@EVENTORGANIZEDDATE AS VARCHAR(50)='',
			@PURPOSEOFEVENT AS VARCHAR(300)='',
			@PARTICIPANTSSIZE AS VARCHAR(30)='',
			@LEADSGENERATED AS VARCHAR(50)='',
			@SBCONVERTED AS VARCHAR(50)='',
			@ANTICIPATEDPARTICIPANTS AS VARCHAR(50)='',
			@PROSPECTIVELEADSFORINVITATION AS VARCHAR(50)='',
			@KYCEXPECTED AS VARCHAR(50)='',
			@AVERAGEMARGINPERKYC AS VARCHAR(50)='',
			@CLIENTSOPENINGNEWSEGMENTS AS VARCHAR(50)='',
			@SBEXPECTED AS VARCHAR(50)='',
			@AVERAGEDEPOSITPERSB AS VARCHAR(50)='',
			@SUGGESTION AS VARCHAR(300)=''

			SET @FORMTITLE='EVENT ASSESSMENT QUESTIONNAIRE'

			SELECT @ISNEWCLIENT= CASE WHEN ISNEWCLIENT =1 THEN 'YES' ELSE 'NO' END,
			@SEGMENTIMPROVEMENT=SEGMENTIMPROVEMENT,
			@ISSBACQUISITION= CASE WHEN ISSBACQUISITION =1 THEN 'YES' ELSE 'NO' END,
			@ISMUTUALFUND= CASE WHEN ISMUTUALFUND =1 THEN 'YES' ELSE 'NO' END,
			@DATE=DATE,@TIME=TIME,@VENUE=VENUE,
			@ISEVENTEXPERIENCE= CASE WHEN ISEVENTEXPERIENCE =1 THEN 'YES' ELSE 'NO' END,
			@EVENTORGANIZEDDATE=EVENTORGANIZEDDATE,
			@PURPOSEOFEVENT=PURPOSEOFEVENT,@PARTICIPANTSSIZE=PARTICIPANTSSIZE,@LEADSGENERATED=LEADSGENERATED,
			@SBCONVERTED=SBCONVERTED,@ANTICIPATEDPARTICIPANTS=ANTICIPATEDPARTICIPANTS,@PROSPECTIVELEADSFORINVITATION=PROSPECTIVELEADSFORINVITATION,
			@KYCEXPECTED=KYCEXPECTED,@AVERAGEMARGINPERKYC=AVERAGEMARGINPERKYC,@CLIENTSOPENINGNEWSEGMENTS=CLIENTSOPENINGNEWSEGMENTS,@SBEXPECTED=SBEXPECTED,
			@AVERAGEDEPOSITPERSB=AVERAGEDEPOSITPERSB,@SUGGESTION=SUGGESTION
			 FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID= @PURPOSEID


			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                      <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>What is the Agenda of this event?</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New client acquisition</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblNewclientAcq''''>'+@isNewclient+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Segment Improvement</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSegmentImprovement''''>'+@SegmentImprovement+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>SB Acquisition</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSbAcquisition''''>'+@ISSBACQUISITION+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mutual Fund?</b></td>
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''''Label1''''>'+@ISMUTUALFUND+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Please fill in the Event details</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Date</b></td>
                                                            <td align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''''lblDate''''>'+@Date+'</label></td>
                                                              <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Time</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblTime''''>'+@Time+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Venue</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblVenue''''>'+@Venue+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left"  style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Do We have experience to organize such events in the past?</b></td>                                                            
                                                            <td align="left" colspan="4" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''''lblPastExperience''''>'+@ISEVENTEXPERIENCE+'</label></td>
                                                        </tr>
                                                         <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Which was the last event organised?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventOrg''''>'+@EVENTORGANIZEDDATE+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What was the purpose of event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventpurpose''''>'+@PURPOSEOFEVENT+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What was the participant size of the event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblParticipantSize''''>'+@PARTICIPANTSSIZE+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How many lead got generated?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblLeadGenerated''''>'+@LEADSGENERATED+'</label></td>
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How many SB converted?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSBConverted''''>'+@SBCONVERTED+'</label></td>
                                                        </tr>
                                                          <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>How are we generating the perspective leads for the invitation?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblLeadInvitation''''>'+@PROSPECTIVELEADSFORINVITATION+'</label></td>
                                                        </tr>
                                                          <tr >
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What is the participation anticipated in this event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''Label2''''>'+@ANTICIPATEDPARTICIPANTS+'</label></td>
                                                        </tr>
                                                          <tr style="display:none;">
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>What is the expected outcome of the event?</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblEventOutcome''''>EventOutcome</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New client acquisition(in 1m Timeframe)</b></td>                                                            
                                                        </tr>
                                                          <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No of KYC Expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblKycExpected''''>'+@KYCEXPECTED+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Average margin per kyc Expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblAvgKycExpected''''>'+@AVERAGEMARGINPERKYC+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Segment Improvement</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No. of client opening new segments</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblNewSegment''''>'+@CLIENTSOPENINGNEWSEGMENTS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>New SB acquisition(in 1m Timeframe)</b></td>                                                            
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>No. of SB expected</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSBExpected''''>'+@SBEXPECTED+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Average Deposit per SB</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblAvgDeposit''''>'+@AVERAGEDEPOSITPERSB+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Your Suggestion, if any.</b></td>
                                                            <td align="left" colspan="4" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''''lblSuggesstion''''>'+@SUGGESTION+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'



		END

		IF @TABLENAME='HIRING'
		BEGIN
			DECLARE @NAME AS VARCHAR(20)='',
			@BUSINESSPARTNERTAG AS VARCHAR(20)='',
			@ADDRESS AS VARCHAR(500)='',
			@CONTACTPERSON AS VARCHAR(50)='',
			@CONTACTEMAILID AS VARCHAR(50)='',
			@DESIGNATION AS VARCHAR(50)='',
			@SALARYMIN AS VARCHAR(50)='',
			@SALARYMAX AS VARCHAR(50)='',
			@EDUQUALIFICATION AS VARCHAR(50)='',
			@EXPERIENCEYEAR AS VARCHAR(50)='',
			@EXPERIENCEMONTHS AS VARCHAR(50)='',
			@RESOURCES AS VARCHAR(300)=''

			SET @FORMTITLE='HIRING FORM'

			SELECT @NAME=NAME,@BUSINESSPARTNERTAG=BUSINESSPARTNERTAG,@ADDRESS=ADDRESS,@CONTACTPERSON=CONTACTPERSON,@CONTACTEMAILID=CONTACTEMAILID,
			@DESIGNATION=DESIGNATION,@SALARYMIN=SALARYMIN,@SALARYMAX=SALARYMAX,@EDUQUALIFICATION=EDUQUALIFICATION,
			@EXPERIENCEYEAR=EXPERIENCEYEAR,@EXPERIENCEMONTHS=EXPERIENCEMONTHS,@RESOURCES=RESOURCES
			FROM TBL_B2BHIRING 
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Name</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblName''>'+@NAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusiness''>'+@BUSINESSPARTNERTAG+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblAdd''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblContact''>'+@CONTACTPERSON+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblContactEmail''>'+@CONTACTEMAILID+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Designation</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDesignation''>'+@DESIGNATION+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Salary Per Month</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMin''>Min : '+@SALARYMIN+'</label></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMax''>Max : '+@SALARYMAX+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Edu. Qualification</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEducation''>'+@EDUQUALIFICATION+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Experience</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblYear''>'+@EXPERIENCEYEAR+' Years</label></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMonth''>'+@EXPERIENCEMONTHS+' Months</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Resource</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblResource''>'+@RESOURCES+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'

		END

		IF @TABLENAME='COLLATE'
		BEGIN
			DECLARE @Zone AS VARCHAR(20)='',
			@Region AS VARCHAR(20)='',
			@BRANCHTAG AS VARCHAR(500)='',
			@PARTNERNAME AS VARCHAR(200)='',
			@MATERIALTYPE AS VARCHAR(200)='',
			@MATERIALSIZE AS VARCHAR(50)='',
			@DISPATCHLOCATION AS VARCHAR(500)='',
			@CONTACTPERSONNAME AS VARCHAR(200)='',
			@PARTNERADDRESS AS VARCHAR(500)='',
			@CITY AS VARCHAR(50)='',
			@STATE AS VARCHAR(300)='',
			@CONTACTNUMBER AS VARCHAR(50)=''

			SET @FORMTITLE='MARKETING COLLATERAL SCHEME ORDER FORMAT'

			SELECT @Zone=Zone,@Region=Region,@BRANCHTAG=BRANCHTAG,@BUSINESSPARTNERTAG=BUSINESSPARTNERTAG,@PARTNERNAME=PARTNERNAME,
			@MATERIALTYPE=MATERIALTYPE,@MATERIALSIZE=MATERIALSIZE,@DISPATCHLOCATION=DISPATCHLOCATION,@CONTACTPERSONNAME=CONTACTPERSONNAME,
			@PARTNERADDRESS=PARTNERADDRESS,@CITY=CITY,@STATE=STATE,@CONTACTNUMBER=CONTACTNUMBER
			 FROM tbl_B2BMktCollateral
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Zone</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblZone''>'+@ZONE+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Region</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblRegion''>'+@REGION+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Branch Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBranchTag''>'+@BRANCHTAG+'</label> </td>

                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@BUSINESSPARTNERTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Registered Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblRBusinessPartName''>'+@PARTNERNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Material Type</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMaterial''>'+@MATERIALTYPE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Size of material</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMaterialSize''>'+@MATERIALSIZE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Dispatch Location</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDispatchLoc''>'+@DISPATCHLOCATION+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Name of Contact(if Business partner address selected)</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblNameOfContact''>'+@CONTACTPERSONNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Complete Address of Business partner</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessAddPartner''>'+@PARTNERADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>City</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblCity''>'+@CITY+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>State</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblState''>'+@STATE+'</label></td>
                                                        </tr>

                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No. of Business Partner</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessPartnerContact''>'+@CONTACTNUMBER+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='VCARD'
		BEGIN
			DECLARE @SRNUM AS VARCHAR(20)='',
			@PARTNARNAME AS VARCHAR(200)='',
			@PARTNERTAG AS VARCHAR(50)='',
			@DEPARTMENT AS VARCHAR(50)='',
			@QTY AS VARCHAR(50)='',
			@LINEOFBUSINESS AS VARCHAR(500)='',
			@FIRSTNAME AS VARCHAR(100)='',
			@PINCODE AS VARCHAR(50)='',
			@LANDLINENUM AS VARCHAR(50)='',
			@EXTNUM AS VARCHAR(50)='',
			@FAXNUM AS VARCHAR(50)='',
			@MOBILENUM AS VARCHAR(50)='',
			@EMAIL AS VARCHAR(50)='',
			@REQUESTEDBY AS VARCHAR(50)='',
			@APPROVEDBY AS VARCHAR(50)=''

			SET @FORMTITLE='VISITING CARD REQUIRMENT'
			
			
			SELECT @SRNUM=SRNUM,@PARTNARNAME=PARTNARNAME,@PARTNERTAG=PARTNERTAG,@DESIGNATION=DESIGNATION,@DEPARTMENT=DEPARTMENT,
			@QTY=QTY,@LINEOFBUSINESS=LINEOFBUSINESS,@FIRSTNAME=FIRSTNAME,@BRANCHTAG=BRANCHTAG,@ADDRESS=ADDRESS,@PINCODE=PINCODE,
			@LANDLINENUM=LANDLINENUM,@EXTNUM=EXTNUM,@FAXNUM=FAXNUM,@MOBILENUM=MOBILENUM,@EMAIL=EMAIL,@REQUESTEDBY=REQUESTEDBY,
			@APPROVEDBY=APPROVEDBY
			 FROM TBL_B2BVCARD 
			WHERE PURPOSEID= @PURPOSEID

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>SR.No</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblSrNo''>'+@SRNUM+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessName''>'+@PARTNARNAME+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessTag''>'+@PARTNERTAG+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Designation</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblDesignation''>'+@DESIGNATION+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Department</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblDepartment''>'+@DEPARTMENT+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Quantity</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblQuantity''>'+@QTY+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Line of Business</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lbllineofbusiness''>'+@LINEOFBUSINESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>First Name</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblFName''>'+@FIRSTNAME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Branch Tag</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBranch''>'+@BRANCHTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblAddress''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Pincode</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblPincode''>'+@PINCODE+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Contact No</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblStd''>'+@LANDLINENUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Extn No</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblExtn''>'+@EXTNUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Fax No</b></td>
                                                            <td align="left" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblFStd''>'+@FAXNUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mobile</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblMobile''>'+@MOBILENUM+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEmail''>'+@EMAIL+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business partner Tag</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBPartnerTag''>'+@PARTNERTAG+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Requested by</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblRequestedBy''>'+@REQUESTEDBY+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Approved by</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblApproved''>'+@APPROVEDBY+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='LEAFLET'
		BEGIN
			DECLARE 
			@LEAFLET AS VARCHAR(500)='',
			@PARTICULARS AS VARCHAR(500)=''

			SET @FORMTITLE='LEEFLET PRINTING REQUIREMENT'

			SELECT @PARTNERTAG=PARTNERTAG,@PARTNARNAME=PARTNARNAME,@LANDLINENUM=LANDLINENUM,@MOBILENUM=MOBILENUM ,@EMAIL=EMAIL,
			@ADDRESS=ADDRESS,@LEAFLET=LEAFLET,@PARTICULARS=PARTICULARS
			
			FROM TBL_LEAFLET
			WHERE PURPOSEID= @PURPOSEID 

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Business Partner Tag</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@PARTNERTAG+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Business Partner Name</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessName''>'+@PARTNARNAME+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Landline No.</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''lbllandlineNo''>'+@LANDLINENUM+'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Mobile No.</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''lblMobile''>'+@MOBILENUM+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email ID</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblEmail''>'+@EMAIL+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business partner Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblBusinessAdd''>'+@ADDRESS+'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Leaflet</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblLeaflet''>'+@LEAFLET+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Particulars</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''lblparticular''>'+@PARTICULARS+'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		IF @TABLENAME='MICROSITE'
		BEGIN
			DECLARE @QUESTIONS AS VARCHAR(MAX)='',
			@BUSINESSOFFERING AS varchar(200)='',
			@FIRMESTABLISHEDYEAR AS VARCHAR(50)='',
			@WEBSITENAME AS VARCHAR(500)='',
			@DESCRIBEFIRM AS VARCHAR(500)='',
			@WHYUSOTHER AS VARCHAR(500)='',
			@COMPANY AS VARCHAR(500)='',
			@ADDRESS2 AS VARCHAR(500)='',
			@POSTALCODE AS VARCHAR(500)='',
			@EMAILID AS VARCHAR(500)='',
			@PHONE AS VARCHAR(500)='',
			@FACEBOOKLINK AS VARCHAR(500)='',
			@TWITTERLINK AS VARCHAR(500)='',
			@THEME AS VARCHAR(500)='',
			@COMPANYLOGO AS VARCHAR(500)=''
			SET @FORMTITLE='MICROSITE FORM'
			SELECT @QUESTIONS=QUESTIONS,@BUSINESSOFFERING=BUSINESSOFFERING,@SBTAG=SBTAG,@FIRMESTABLISHEDYEAR=FIRMESTABLISHEDYEAR,
			@WEBSITENAME=WEBSITENAME,@DESCRIBEFIRM=ISNULL(LEAFLET,''),@WHYUSOTHER=WHYUSOTHER,@NAME=NAME,@COMPANY=COMPANY,@ADDRESS=ADDRESS,@ADDRESS2=ADDRESS2,
			@CITY=CITY,@STATE=STATE,@POSTALCODE=POSTALCODE,@EMAILID=EMAILID,@PHONE=PHONE,@COMPANYLOGO=COMPANYLOGO,@THEME=THEME,@FACEBOOKLINK=FACEBOOKLINK,@TWITTERLINK=TWITTERLINK
			FROM TBL_B2BMICROSITE 
			WHERE PURPOSEID= @PURPOSEID 

			 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub Broker (SB) Tag?</b></td>
                                                            <td align="left"  colspan="2" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''lblBusinessPartTag''>'+@SBTAG+' </label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Established date</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label1''lblBusinessName''>'+@FIRMESTABLISHEDYEAR+' </label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-top: 1px solid #cce4e4; border-bottom: 1px solid #cce4e4" valign="middle" width="35%"><b>Website name?</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #e3eeee; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label2''lbllandlineNo''>'+@WEBSITENAME +'</label> </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Description obout firm</b></td>
                                                            <td align="left"  colspan="2" style="padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle"><label id=''Label3''lblMobile''>'+@DESCRIBEFIRM +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Why choose us?</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label4''lblEmail''>'+@WHYUSOTHER+' </label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" colspan="5" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Current contact no, email id & registered address</b></td>                                                            
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Name</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label5''lblBusinessAdd''>'+@NAME +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Company</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label6''lblLeaflet''>'+@COMPANY+' </label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label7''lblparticular''>'+@ADDRESS +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Address 2</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label8''lblparticular''>'+@ADDRESS2 +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>City/Town</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label9''lblparticular''>'+@CITY +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>State/Province</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label10''lblparticular''>'+@STATE +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>ZIP/Postal Code</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label11''lblparticular''>'+@POSTALCODE +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Email Address</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label12''lblparticular''>'+@EMAILID +'</label></td>
                                                              </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Phone Number</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label13''lblparticular''>'+@PHONE +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Business offerings</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label14''lblparticular''>'+@BUSINESSOFFERING +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Facebook Link</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label15''lblparticular''>'+@FACEBOOKLINK +'</label></td>
                                                        </tr>
                                                        <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Twitter Link</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label16''lblparticular''>'+@TWITTERLINK +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Theme </b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label17''lblparticular''>'+@THEME +'</label></td>
                                                        </tr>
                                                         <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px; border-bottom: 1px solid #cce4e4" valign="middle" width="28%"><b>Company logo</b></td>
                                                            <td align="left"  colspan="2" style="border-right: #cce4e4 solid 1px; padding: 5px; color: #2d2d2d; font-family: ''Open Sans'',Sans serif,''Arial''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px; border-top: 1px solid #e3eeee" valign="middle"><label id=''Label18''lblparticular''>'+@COMPANYLOGO +'</label></td>
                                                        </tr>
                                                    </tbody>
                                                </table>'
		END

		



		IF @TABLENAME='NONE'
		BEGIN
		SET @FORMTITLE=''
	 
		 SET @MAILTABLE=@MAILTABLE+ '<table border="0" cellpadding="0" cellspacing="0" width="100%">
                                                    <tbody>
													 <tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Sub-Broker Tag</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG''''>'+@SBTAG+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Compliance</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG1''''>'+@COMPLIANCE+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Purpose</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG2''''>'+@Purpose+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Requirment</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG3''''>'+@REQUIREMENT+'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>BM Action</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG4''''>'+@BMACTION +'</label></td>
                                                        </tr>

														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Parameter</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG5''''>'+@Parameter+'</label></td>
                                                        </tr>
														<tr>
                                                            <td align="left" style="padding: 5px 0 5px 10px; color: #4e4e4e; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #b6d9d8; font-size: 13px" valign="middle" width="28%"><b>Expected Outcome</b></td>
                                                            <td align="left" colspan="4" align="left" style="padding: 5px; color: #2d2d2d; font-family: ''''Open Sans'''',Sans serif,''''Arial''''; font-weight: 400; margin: 0; background-color: #cfe2e2; font-size: 13px" valign="middle" width="72%"><label id=''''lblSBTAG6''''>'+@EXPECTEDOUTCOME+'</label></td>
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>'
		END


		 SET @MAILHEADER='<html xmlns="http://www.w3.org/1999/xhtml">
								<head id="Head1" runat="server">
									<title></title>
								</head>
								<body>
									<div id=":148" class="ii gt adP adO">
										<div id=":147" class="a3s aXjCH m15548d1330dd5acb">
											<div class="adM">
											</div>
											<div>
												<div class="adM">
												</div>
												<table align="center" border="0" cellpadding="0" cellspacing="0" style="min-width: 620px" width="620">
													<tbody>
														<tr>
															<td align="center" bgcolor="#0071bb" style="vertical-align: top; padding: 0px 0px 0px 0px; border-left: 1px solid #d1d1d1; border-top: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1; background-color: #0071bb">
																<table border="0" cellpadding="0" cellspacing="0" style="min-width: 620px" width="620">
																	<tbody>
																		<tr>
																			<td align="left" style="padding: 10px 0px 10px 5px" valign="bottom" width="325"><a href="http://lt.angelbroking.in/ltrack?id=cR0FAFVUCQQADh0IAwYGClUGW00=AQECVgEAVx4RRwJZVgUbWgQAUVFGdwBWVFNaWhFYCVheVBgBWVs=&amp;client=12239&amp;c=0000" target="_blank">
																				<img alt="Angel Broking" border="0" height="60" src="https://ci6.googleusercontent.com/proxy/VvPPCVxUkQNs55bhiHGuTICX4OAObGjHeq1vamj6tXPd0kLLKpGIlCC2lLfNIqfMtluGT3czxEZMnsgSjwA1sVNXTPLBSDvnOcXS-Oha8gjojtF1XLAiFsS8qr6bBcX7BZILKP-0AmtVWPMNmLoQTl8sucSJtsMl1i_PLAvNG4A=s0-d-e1-ft#http://web.angelbackoffice.com/angelbroking/econnect/Budget-special-webinar-26022016/images/Angel-logo.gif" style="display: block; color: #fff; background-color: #0071bb" width="189" class="CToWUd"></td>
																			<td align="right" valign="middle" width="325">
																				<table border="0" cellpadding="0" cellspacing="0" width="140">
																					<tbody>
																						<tr>
																							<td align="center" height="47" valign="middle">
																								<h6 style="font-family: ''''Open Sans'''',sans-serif; font-size: 16px; color: #ffffff; line-height: auto; padding: 0; margin: 0">DATE :<b>'+@VISITDATE+'</b></h6>
																							</td>
																						</tr>
																					</tbody>
																				</table>
																			</td>
																		</tr>
																	</tbody>
																</table>
															</td>
														</tr>
													</tbody>
												</table>
												<table align="center" bgcolor="#ededed" cellpadding="0" cellspacing="0" width="620">
													<tbody>
														<tr>
															<td align="center" bgcolor="#454545" style="vertical-align: top; font-family: ''''Open Sans'''',arial,sans-serif; font-size: 20px; font-weight: 400; color: #ffffff; line-height: 30px; text-align: left; padding: 0 0 0 0; text-align: center" valign="middle">
																'+@FORMTITLE+'</td>
														</tr>
														<tr>
															<td height="20px" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">&nbsp;</td>
														</tr>
														<tr>
														<td align="center" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">
														<table border="0" cellpadding="0" cellspacing="0" width="602">
														<tbody>
														<tr>
														<td style="padding: 0px 0px 0px 0px; background-color: #27a4a2; color: #ffffff">     
														</tr>
														<tr>
														<td align="center" bgcolor="#fff" style="padding: 0px 0 0px 0; background-color: #159ee8" valign="top">'

		------DEVELOPED HEADEAR ---END


			------DEVELOPED BOTTOM ---STRAT
										SET @MAILBOTTOM='</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td height="10px" style="border-left: 1px solid #d1d1d1; border-right: 1px solid #d1d1d1">&nbsp;</td>
													</tr>
													<tr>
														<td bgcolor="#384c63" style="padding: 10px 10px 10px 10px; background-color: #384c63">
															<table align="left" border="0" cellpadding="0" cellspacing="0" width="28%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px"><a href="http://www.angelbroking.com" target="_blank">www.angelbroking.com</a></td>
																	</tr>
																</tbody>
															</table>
															<table align="left" border="0" cellpadding="0" cellspacing="0" style="border-right: 1px solid #d1d1d1; border-left: 1px solid #d1d1d1" width="35%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px">1860 200 2006 / 1860 500 5006</td>
																	</tr>
																</tbody>
															</table>
															<table align="left" border="0" cellpadding="0" cellspacing="0" width="31%">
																<tbody>
																	<tr>
																		<td align="center" style="font-size: 11px; color: #ffffff; font-family: Arial,sans-serif; padding: 5px 5px 5px 5px"><a href="mailto:inhouse.support@angelbroking.com" style="color: #ffffff" target="_blank">inhouse.support@angelbroking.<wbr>com</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td align="left" style="vertical-align: top">
															<table border="0" cellpadding="0" cellspacing="0" width="100%">
																<tbody>
																	<tr>
																		<td bgcolor="#DBDBDB" style="font-size: 50%; color: #ffffff; font-family: Arial,sans-serif; padding: 10px 5px 5px 10px; text-align: center; background-color: #384c63">Angel Broking Private Limited, Registered Office: G-1, Ackruti Trade Centre, Road No. 7, MIDC, Andheri (E), Mumbai  400 093. Tel: (022) 3083 7700. Fax: (022) 2835 8811, website: <a href="http://www.angelbroking.com" target="_blank">www.angelbroking.com</a>, CIN: U67120MH1996PTC101709, BSE Cash/F&amp;O: INB010996539 /INF010996539, NSE Cash/F&amp;O/CD: INB231279838/INF231279838/ INE231279838, MSEI: INE261279838, CDSL Regn. No.: IN - DP - CDSL - 234  2004, PMS Regn. Code:
							                                             PM/INP000001546</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
												</tbody>
											</table>
											<br>
											<div>
											</div>
											<img border="0" src="https://ci4.googleusercontent.com/proxy/kGU__8bP6TS7qtR9P_LldeRV_idn2XEUzyv8LrVaJBvcZw7U8jxeYdyH8VhbznmIA4zV_18zzRabfq4OfFXYNt35XZgbZnukqZiUUaCwbgylXGBK24ceiKmcWFt3_AtJB-t6J2oSA_V8CVc4bHqcrGt-W0o=s0-d-e1-ft#http://lt.angelbroking.in/ltrack?m=2619&amp;u=46933881566fc4e7116fffd6b9a591a7&amp;client=12239&amp;c=0000" class="CToWUd">
										</div>
										<div class="yj6qo"></div>
										<div class="adL">
										</div>
									</div>
								</div>
							</body>
							</html>'
				------DEVELOPED BOTTOM ---END
    
    RETURN @MAILHEADER +' '+ isnull( @MAILTABLE,'')+' '+@MAILBOTTOM;  
END

GO

-- --------------------------------------------------
-- FUNCTION dbo.UDP_SENDMOB_NOTIFICATION
-- --------------------------------------------------

CREATE FUNCTION [dbo].[UDP_SENDMOB_NOTIFICATION](@ID AS VARCHAR(MAX),@TITLE AS VARCHAR(200),@BODYMSG AS VARCHAR(500))
 RETURNS INT
 AS BEGIN
 DECLARE @Object AS INT;
DECLARE @ResponseText AS VARCHAR(8000);
DECLARE @Body AS VARCHAR(8000) = 
'{
  "to" : "'+@ID+'",
   "data" : {
     "object" : {
     	"notificationType":"1",          
        "title" : "Angel Inhouse",                
        "message":"'+@BODYMSG+'", 
        "imageUrl":""
		 }
   } 
}'  

EXEC sp_OACreate 'MSXML2.ServerXMLHTTP', @Object OUT;
EXEC sp_OAMethod @Object, 'open', NULL, 'post','https://fcm.googleapis.com/fcm/send', 'false'

EXEC sp_OAMethod @Object, 'setRequestHeader', null, 'Content-Type', 'application/json'
EXEC sp_OAMethod @Object, 'setRequestHeader', null, 'Authorization', 'key=AAAAGh6QAmE:APA91bFCsBGjImmfrTQ0Vb_oeO99sAev1qVW7rEJGXIScEAN8vIlYroWNfQrX44-CndZmeR2WKcX8IyY6YFef6eDi0OPVdbq1dnP5kQyhhTUpy9JVc9UVlbTyU1J5mMquCjdqwY5RkBJ'
EXEC sp_OAMethod @Object, 'send', null, @body

EXEC sp_OAMethod @Object, 'responseText', @ResponseText OUTPUT


EXEC sp_OADestroy @Object

 RETURN 0
 END

GO

-- --------------------------------------------------
-- INDEX dbo.abl
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_CODE] ON [dbo].[abl] ([CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.acbpl
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Code] ON [dbo].[acbpl] ([Code])

GO

-- --------------------------------------------------
-- INDEX dbo.AGEING_bsecm_FINAL
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AGE_BALANCE] ON [dbo].[AGEING_bsecm_FINAL] ([AGE_BALANCE])

GO

-- --------------------------------------------------
-- INDEX dbo.AGEING_MCX_FINAL
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AGE_BALANCE] ON [dbo].[AGEING_MCX_FINAL] ([AGE_BALANCE])

GO

-- --------------------------------------------------
-- INDEX dbo.AGEING_NCDEX_FINAL
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AGE_BALANCE] ON [dbo].[AGEING_NCDEX_FINAL] ([AGE_BALANCE])

GO

-- --------------------------------------------------
-- INDEX dbo.AGEING_nsecm_FINAL
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AGE_BALANCE] ON [dbo].[AGEING_nsecm_FINAL] ([AGE_BALANCE])

GO

-- --------------------------------------------------
-- INDEX dbo.AGEing_NSEFO_FINAL
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AGE_BALANCE] ON [dbo].[AGEing_NSEFO_FINAL] ([AGE_BALANCE])

GO

-- --------------------------------------------------
-- INDEX dbo.ahd
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BbCli] ON [dbo].[ahd] ([BbCli])

GO

-- --------------------------------------------------
-- INDEX dbo.Block_SBE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_party_code] ON [dbo].[Block_SBE] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.bm_master
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bm_branchcd] ON [dbo].[bm_master] ([bm_branchcd])

GO

-- --------------------------------------------------
-- INDEX dbo.bolt_alert
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_GBLIMIT] ON [dbo].[bolt_alert] ([GBLIMIT])

GO

-- --------------------------------------------------
-- INDEX dbo.bolt_category
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_category1] ON [dbo].[bolt_category] ([category1])

GO

-- --------------------------------------------------
-- INDEX dbo.BOLT_ID
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_F1] ON [dbo].[BOLT_ID] ([F1])

GO

-- --------------------------------------------------
-- INDEX dbo.boltfile
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_6A7A] ON [dbo].[boltfile] ([6A7A])

GO

-- --------------------------------------------------
-- INDEX dbo.boltfile_info
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_nor] ON [dbo].[boltfile_info] ([nor])

GO

-- --------------------------------------------------
-- INDEX dbo.boltfile_temp
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_6A7A] ON [dbo].[boltfile_temp] ([6A7A])

GO

-- --------------------------------------------------
-- INDEX dbo.Branch
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ctclBranch_address1] ON [dbo].[Branch] ([ctclBranch_address1])

GO

-- --------------------------------------------------
-- INDEX dbo.bse_table
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Lower_Lim] ON [dbo].[bse_table] ([Lower_Lim])

GO

-- --------------------------------------------------
-- INDEX dbo.cl_BSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_LowerLim] ON [dbo].[cl_BSE] ([Lower Lim])

GO

-- --------------------------------------------------
-- INDEX dbo.cl_bse1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_cl_code] ON [dbo].[cl_bse1] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.cl_nse
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_cl_code] ON [dbo].[cl_nse] ([cl_code])

GO

-- --------------------------------------------------
-- INDEX dbo.client_performance
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bse_br] ON [dbo].[client_performance] ([bse_br])

GO

-- --------------------------------------------------
-- INDEX dbo.client_performance_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bse_br] ON [dbo].[client_performance_hist] ([bse_br])

GO

-- --------------------------------------------------
-- INDEX dbo.client_performance_hist_sum
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bse_br] ON [dbo].[client_performance_hist_sum] ([bse_br])

GO

-- --------------------------------------------------
-- INDEX dbo.client_performance_hist1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bse_br] ON [dbo].[client_performance_hist1] ([bse_br])

GO

-- --------------------------------------------------
-- INDEX dbo.CLIENT_PERFORMANCE_sUMMARY
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Active_day] ON [dbo].[CLIENT_PERFORMANCE_sUMMARY] ([Active_day])

GO

-- --------------------------------------------------
-- INDEX dbo.client_performance_summary1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Active_days_bse_cm] ON [dbo].[client_performance_summary1] ([Active_days_bse_cm])

GO

-- --------------------------------------------------
-- INDEX dbo.client_performance1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bse_br] ON [dbo].[client_performance1] ([bse_br])

GO

-- --------------------------------------------------
-- INDEX dbo.ClientBannedFormat123
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address] ON [dbo].[ClientBannedFormat123] ([Address])

GO

-- --------------------------------------------------
-- INDEX dbo.'Contactinfo'
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Activenactive] ON [dbo].['Contactinfo'] ([Active or Inactive])

GO

-- --------------------------------------------------
-- INDEX dbo.Contactinfo_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ActiveInactive] ON [dbo].[Contactinfo_RENAMEDAS_PII] ([Active or Inactive])

GO

-- --------------------------------------------------
-- INDEX dbo.cslogin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_category] ON [dbo].[cslogin] ([category])

GO

-- --------------------------------------------------
-- INDEX dbo.CSO15_ctclDtc
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Dealer] ON [dbo].[CSO15_ctclDtc] ([Dealer])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Created_By] ON [dbo].[CTCL_] ([Created_By])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_bolt1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch] ON [dbo].[ctcl_bolt1] ([Branch])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_boltno
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch] ON [dbo].[ctcl_boltno] ([Branch])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_DTC
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Dealer] ON [dbo].[CTCL_DTC] ([Dealer])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_DTCx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Dealer] ON [dbo].[CTCL_DTCx] ([Dealer])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCL_INFO
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address] ON [dbo].[CTCL_INFO] ([Address])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_Loc_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [saudadate_segment] ON [dbo].[ctcl_Loc_hist] ([sauda_DAte], [segment], [SHORT_NAME], [party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_loc_summ
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_subgroup] ON [dbo].[ctcl_loc_summ] ([subgroup])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_loc_summ_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Location] ON [dbo].[ctcl_loc_summ_hist] ([Location])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_locsb_mast
-- --------------------------------------------------
CREATE CLUSTERED INDEX [h3] ON [dbo].[ctcl_locsb_mast] ([SHORT_NAME])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_manager_ColModHist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ModifiedBy] ON [dbo].[ctcl_manager_ColModHist] ([ModifiedBy])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_manager_Info
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Ctcl_Manager] ON [dbo].[ctcl_manager_Info] ([Ctcl_Manager])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_sb_mast
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_loginid] ON [dbo].[ctcl_sb_mast] ([loginid])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_sb_mast_1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_location] ON [dbo].[ctcl_sb_mast_1] ([location])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_sb_mast1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_location] ON [dbo].[ctcl_sb_mast1] ([location])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_trade_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bs] ON [dbo].[ctcl_trade_hist] ([bs])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_trade_hist_1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bs] ON [dbo].[ctcl_trade_hist_1] ([bs])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_trade_hist1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bs] ON [dbo].[ctcl_trade_hist1] ([bs])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_trade_summ
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_loginid] ON [dbo].[ctcl_trade_summ] ([loginid])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_trade_summ_1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_location] ON [dbo].[ctcl_trade_summ_1] ([location])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_trade_summ1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_location] ON [dbo].[ctcl_trade_summ1] ([location])

GO

-- --------------------------------------------------
-- INDEX dbo.ctcl_volume
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_a10] ON [dbo].[ctcl_volume] ([a10])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCLBSEBranch
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch] ON [dbo].[CTCLBSEBranch] ([Branch])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCLDealerBlocked
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_activestatus] ON [dbo].[CTCLDealerBlocked] ([activestatus])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCLDealerBlocked
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_segment] ON [dbo].[CTCLDealerBlocked] ([segment])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCLDealerBlocked
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_Server] ON [dbo].[CTCLDealerBlocked] ([Server])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCLDealerBlocked_history
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_activestatus] ON [dbo].[CTCLDealerBlocked_history] ([activestatus])

GO

-- --------------------------------------------------
-- INDEX dbo.CTCLDealerBlocked_new
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_activestatus] ON [dbo].[CTCLDealerBlocked_new] ([activestatus])

GO

-- --------------------------------------------------
-- INDEX dbo.CtclMgrLocation_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch_cd] ON [dbo].[CtclMgrLocation_hist] ([Branch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.CtclMgrLocation_log
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch_cd] ON [dbo].[CtclMgrLocation_log] ([Branch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.dailyhit
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_hitdate] ON [dbo].[dailyhit] ([hitdate])

GO

-- --------------------------------------------------
-- INDEX dbo.DC
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Col001] ON [dbo].[DC] ([Col001])

GO

-- --------------------------------------------------
-- INDEX dbo.diet_dtc
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idxpcode] ON [dbo].[diet_dtc] ([Party_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.diet_dtc
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_location] ON [dbo].[diet_dtc] ([Location])

GO

-- --------------------------------------------------
-- INDEX dbo.dietmgrlocation
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch_cd] ON [dbo].[dietmgrlocation] ([Branch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.entry_payin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[entry_payin] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.error_codes
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_code] ON [dbo].[error_codes] ([code])

GO

-- --------------------------------------------------
-- INDEX dbo.ff_ABCDeposit_details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bc] ON [dbo].[ff_ABCDeposit_details] ([bc])

GO

-- --------------------------------------------------
-- INDEX dbo.ff_ABCUtilized_Details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_IMVAR] ON [dbo].[ff_ABCUtilized_Details] ([IMVAR])

GO

-- --------------------------------------------------
-- INDEX dbo.ff_acc_details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ASLFO] ON [dbo].[ff_acc_details] ([ASLFO])

GO

-- --------------------------------------------------
-- INDEX dbo.ff_other_values
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_dateModified] ON [dbo].[ff_other_values] ([dateModified])

GO

-- --------------------------------------------------
-- INDEX dbo.ff_tmmrsfund_details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_qty] ON [dbo].[ff_tmmrsfund_details] ([qty])

GO

-- --------------------------------------------------
-- INDEX dbo.ff_transactions_details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_qty] ON [dbo].[ff_transactions_details] ([qty])

GO

-- --------------------------------------------------
-- INDEX dbo.FileUploads
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_date] ON [dbo].[FileUploads] ([date])

GO

-- --------------------------------------------------
-- INDEX dbo.FO_sebi
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[FO_sebi] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.gb0506_fin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_branch_Cd] ON [dbo].[gb0506_fin] ([branch_Cd])

GO

-- --------------------------------------------------
-- INDEX dbo.gb0607_fin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_branch_Cd] ON [dbo].[gb0607_fin] ([branch_Cd])

GO

-- --------------------------------------------------
-- INDEX dbo.gb0700_fin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_branch_Cd] ON [dbo].[gb0700_fin] ([branch_Cd])

GO

-- --------------------------------------------------
-- INDEX dbo.IML_ID
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_F1] ON [dbo].[IML_ID] ([F1])

GO

-- --------------------------------------------------
-- INDEX dbo.inbox
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_mailfrom] ON [dbo].[inbox] ([mailfrom])

GO

-- --------------------------------------------------
-- INDEX dbo.INSP_SB_INFO
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRCode] ON [dbo].[INSP_SB_INFO] ([BRCode])

GO

-- --------------------------------------------------
-- INDEX dbo.insp_sb_pending
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRCode] ON [dbo].[insp_sb_pending] ([BRCode])

GO

-- --------------------------------------------------
-- INDEX dbo.ip_addr
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_id] ON [dbo].[ip_addr] ([id])

GO

-- --------------------------------------------------
-- INDEX dbo.'LAWRENC RD'
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Name] ON [dbo].['LAWRENC RD'] ([ Name])

GO

-- --------------------------------------------------
-- INDEX dbo.LAWRENCRD
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Name] ON [dbo].[LAWRENCRD] ([ Name])

GO

-- --------------------------------------------------
-- INDEX dbo.location
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_category] ON [dbo].[location] ([category])

GO

-- --------------------------------------------------
-- INDEX dbo.location_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_category] ON [dbo].[location_hist] ([category])

GO

-- --------------------------------------------------
-- INDEX dbo.LogShift
-- --------------------------------------------------
CREATE CLUSTERED INDEX [idx_new] ON [dbo].[LogShift] ([NEW_KYC_CODE])

GO

-- --------------------------------------------------
-- INDEX dbo.LogShift
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_OLD_KYC_CODE] ON [dbo].[LogShift] ([OLD_KYC_CODE]) INCLUDE ([EntryDate])

GO

-- --------------------------------------------------
-- INDEX dbo.LogShift
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_SUB_BROKER] ON [dbo].[LogShift] ([SUB_BROKER]) INCLUDE ([OLD_KYC_CODE], [BRANCH], [NEW_KYC_CODE], [EntryDate])

GO

-- --------------------------------------------------
-- INDEX dbo.mail_table
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_message] ON [dbo].[mail_table] ([message])

GO

-- --------------------------------------------------
-- INDEX dbo.menu_item
-- --------------------------------------------------
CREATE CLUSTERED INDEX [MenuIX] ON [dbo].[menu_item] ([menu_code])

GO

-- --------------------------------------------------
-- INDEX dbo.multiplier
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_commodity] ON [dbo].[multiplier] ([commodity])

GO

-- --------------------------------------------------
-- INDEX dbo.odin_dealer_mumbai
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BSE] ON [dbo].[odin_dealer_mumbai] ([BSE])

GO

-- --------------------------------------------------
-- INDEX dbo.odin_det
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AliasDealerId] ON [dbo].[odin_det] ([AliasDealerId])

GO

-- --------------------------------------------------
-- INDEX dbo.odin_det_all
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AliasDealerId] ON [dbo].[odin_det_all] ([AliasDealerId])

GO

-- --------------------------------------------------
-- INDEX dbo.OPFM_Trade
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_buyMktValue] ON [dbo].[OPFM_Trade] ([buyMktValue])

GO

-- --------------------------------------------------
-- INDEX dbo.option
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_toMarketGross] ON [dbo].[option] ([%toMarketGross])

GO

-- --------------------------------------------------
-- INDEX dbo.ORD_BSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[ORD_BSE] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.ord_bse_hist
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[ord_bse_hist] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.ORD_MCX
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[ORD_MCX] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.ORD_NCDEX
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[ORD_NCDEX] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.ORD_NSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[ORD_NSE] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.ORD_NSEFO
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[ORD_NSEFO] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.overall_mrg
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BrokerCode] ON [dbo].[overall_mrg] ([BrokerCode])

GO

-- --------------------------------------------------
-- INDEX dbo.pams_trade
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Backofficecode] ON [dbo].[pams_trade] ([Backofficecode])

GO

-- --------------------------------------------------
-- INDEX dbo.payin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_AccountNo] ON [dbo].[payin] ([AccountNo])

GO

-- --------------------------------------------------
-- INDEX dbo.payin
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_cltcode] ON [dbo].[payin] ([Cltcode]) INCLUDE ([posted_status], [segment])

GO

-- --------------------------------------------------
-- INDEX dbo.payin_arch
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_accountNo] ON [dbo].[payin_arch] ([accountNo])

GO

-- --------------------------------------------------
-- INDEX dbo.periodicity
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_cge_limit] ON [dbo].[periodicity] ([cge_limit])

GO

-- --------------------------------------------------
-- INDEX dbo.periodicity_all
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_mode] ON [dbo].[periodicity_all] ([mode])

GO

-- --------------------------------------------------
-- INDEX dbo.PMS_info
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_party_code] ON [dbo].[PMS_info] ([party_code])

GO

-- --------------------------------------------------
-- INDEX dbo.pms_trade_table
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Backofficecode] ON [dbo].[pms_trade_table] ([Backofficecode])

GO

-- --------------------------------------------------
-- INDEX dbo.Portfolioholding
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_dummy1] ON [dbo].[Portfolioholding] ([dummy1])

GO

-- --------------------------------------------------
-- INDEX dbo.'PREET VIHAR'
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ABL] ON [dbo].['PREET VIHAR'] ([ABL])

GO

-- --------------------------------------------------
-- INDEX dbo.PREETVIHAR_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ABL] ON [dbo].[PREETVIHAR_RENAMEDAS_PII] ([ABL])

GO

-- --------------------------------------------------
-- INDEX dbo.PTM
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Name] ON [dbo].[PTM] ([ Name])

GO

-- --------------------------------------------------
-- INDEX dbo.Registration
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ABL] ON [dbo].[Registration] ([ABL])

GO

-- --------------------------------------------------
-- INDEX dbo.Registration'
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ABL] ON [dbo].[Registration'] ([ABL])

GO

-- --------------------------------------------------
-- INDEX dbo.rejected_file
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_buy_value] ON [dbo].[rejected_file] ([buy_value])

GO

-- --------------------------------------------------
-- INDEX dbo.Remisiers
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_ABL] ON [dbo].[Remisiers] ([ABL])

GO

-- --------------------------------------------------
-- INDEX dbo.research
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_description] ON [dbo].[research] ([description])

GO

-- --------------------------------------------------
-- INDEX dbo.research_table
-- --------------------------------------------------
CREATE CLUSTERED INDEX [loaded_date] ON [dbo].[research_table] ([loaded_date])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_INSP_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRCode] ON [dbo].[SB_INSP_RENAMEDAS_PII] ([BRCode])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_with_PAN
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRCode] ON [dbo].[SB_with_PAN] ([BRCode])

GO

-- --------------------------------------------------
-- INDEX dbo.SB_WITHOUT_PAN
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Brcode] ON [dbo].[SB_WITHOUT_PAN] ([Brcode])

GO

-- --------------------------------------------------
-- INDEX dbo.sbmcx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[sbmcx] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.sbncdx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_buysell] ON [dbo].[sbncdx] ([buysell])

GO

-- --------------------------------------------------
-- INDEX dbo.scrip_alert
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_qty_limit] ON [dbo].[scrip_alert] ([qty_limit])

GO

-- --------------------------------------------------
-- INDEX dbo.SEBI_banned
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address] ON [dbo].[SEBI_banned] ([Address])

GO

-- --------------------------------------------------
-- INDEX dbo.SEBI_banned
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_name] ON [dbo].[SEBI_banned] ([Name])

GO

-- --------------------------------------------------
-- INDEX dbo.SEBI_banned
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_PanNo] ON [dbo].[SEBI_banned] ([Pan_no])

GO

-- --------------------------------------------------
-- INDEX dbo.sebi_banned_upd_date
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_updated_on] ON [dbo].[sebi_banned_upd_date] ([updated_on])

GO

-- --------------------------------------------------
-- INDEX dbo.sebi_temp_banned_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address] ON [dbo].[sebi_temp_banned_RENAMEDAS_PII] ([Address])

GO

-- --------------------------------------------------
-- INDEX dbo.security
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_cagegory] ON [dbo].[security] ([cagegory])

GO

-- --------------------------------------------------
-- INDEX dbo.security_prev
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_cagegory] ON [dbo].[security_prev] ([cagegory])

GO

-- --------------------------------------------------
-- INDEX dbo.Sheet1$
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_IDname] ON [dbo].[Sheet1$] ([ID name])

GO

-- --------------------------------------------------
-- INDEX dbo.Sheet2$
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address] ON [dbo].[Sheet2$] ([Address])

GO

-- --------------------------------------------------
-- INDEX dbo.Sheet3$
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_F1] ON [dbo].[Sheet3$] ([F1])

GO

-- --------------------------------------------------
-- INDEX dbo.Shift
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_entrydate] ON [dbo].[Shift] ([EntryDate])

GO

-- --------------------------------------------------
-- INDEX dbo.Shift1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRANCH] ON [dbo].[Shift1] ([BRANCH])

GO

-- --------------------------------------------------
-- INDEX dbo.t_ctcl_vsat
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Active] ON [dbo].[t_ctcl_vsat] ([Active])

GO

-- --------------------------------------------------
-- INDEX dbo.tablestatus
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_NoOfRecords] ON [dbo].[tablestatus] ([NoOfRecords])

GO

-- --------------------------------------------------
-- INDEX dbo.tb_FeedBack_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Cl_Code] ON [dbo].[tb_FeedBack_RENAMEDAS_PII] ([Cl_Code])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_benchmark_cal
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_branch_cd] ON [dbo].[tbl_benchmark_cal] ([branch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.tbl_New_Registration_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address1] ON [dbo].[tbl_New_Registration_RENAMEDAS_PII] ([Address1])

GO

-- --------------------------------------------------
-- INDEX dbo.temp
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_nAmount] ON [dbo].[temp] ([nAmount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_aaa
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_EXCHSEG] ON [dbo].[temp_aaa] ([EXCHSEG])

GO

-- --------------------------------------------------
-- INDEX dbo.Temp_Banned
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_xname] ON [dbo].[Temp_Banned] ([xname])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_BP
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_bp_add1] ON [dbo].[temp_BP] ([bp_add1])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_CTCL_DTC
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Dealer] ON [dbo].[temp_CTCL_DTC] ([Dealer])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_DPMAPPING
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Data] ON [dbo].[temp_DPMAPPING] ([Data])

GO

-- --------------------------------------------------
-- INDEX dbo.Temp_duplicateentry
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_nAmount] ON [dbo].[Temp_duplicateentry] ([nAmount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_fo_to
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_foto] ON [dbo].[temp_fo_to] ([foto])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_itmcx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[temp_itmcx] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_itmcx_new
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_NC_Coll_bse] ON [dbo].[temp_itmcx_new] ([NC_Coll_bse])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_itncx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BSE_LED] ON [dbo].[temp_itncx] ([BSE_LED])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_itncx_new
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_NC_Coll_bse] ON [dbo].[temp_itncx_new] ([NC_Coll_bse])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_location
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_category] ON [dbo].[temp_location] ([category])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mcx_sb
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[temp_mcx_sb] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mcx_sbCr
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[temp_mcx_sbCr] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_file1_RENAMEDAS_PII
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_NTXNREFNO] ON [dbo].[temp_mis_file1_RENAMEDAS_PII] ([nTxnRefNo])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_file1_RENAMEDAS_PII
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_sLoginId] ON [dbo].[temp_mis_file1_RENAMEDAS_PII] ([sDateTime], [sLoginId])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_file1_RENAMEDAS_PII
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NC_temp_mis_file1] ON [dbo].[temp_mis_file1_RENAMEDAS_PII] ([sLoginId], [sDateTime]) INCLUDE ([nMarketSegmentId], [sUserDefinedExchangeName], [nAmount], [nServiceCharge], [nTxnRefNo], [sGroupId], [nProcessFlag], [sBankId], [sAgencyId], [sBankRefNo], [sFromAccNo], [sToAccNo], [product])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_file1_RENAMEDAS_PII
-- --------------------------------------------------
CREATE CLUSTERED INDEX [NTXNREFNO_SBankRefNo] ON [dbo].[temp_mis_file1_RENAMEDAS_PII] ([nTxnRefNo], [sBankRefNo])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_file1a_RENAMEDAS_PII
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [ix_missing_temp_mis_file1a] ON [dbo].[temp_mis_file1a_RENAMEDAS_PII] ([sDateTime]) INCLUDE ([nTxnRefNo])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_file1a_RENAMEDAS_PII
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [NC_temp_mis_file1a] ON [dbo].[temp_mis_file1a_RENAMEDAS_PII] ([sLoginId], [sDateTime]) INCLUDE ([nMarketSegmentId], [sUserDefinedExchangeName], [nAmount], [nServiceCharge], [nTxnRefNo], [sGroupId], [nProcessFlag], [sBankId], [sAgencyId], [sBankRefNo], [sFromAccNo], [sToAccNo], [product])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_mis_filexxx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_EXCHSEG] ON [dbo].[temp_mis_filexxx] ([EXCHSEG])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_ncx_sb_new
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BSE_LED] ON [dbo].[temp_ncx_sb_new] ([BSE_LED])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_ncx_sbCr
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BSE_LED] ON [dbo].[temp_ncx_sbCr] ([BSE_LED])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_onlinepayin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_nAmount] ON [dbo].[temp_onlinepayin] ([nAmount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_payin
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[temp_payin] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_pmstrade
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Backofficecode] ON [dbo].[temp_pmstrade] ([Backofficecode])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_sebipano
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Address] ON [dbo].[temp_sebipano] ([Address])

GO

-- --------------------------------------------------
-- INDEX dbo.temp_shift
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRANCH] ON [dbo].[temp_shift] ([BRANCH])

GO

-- --------------------------------------------------
-- INDEX dbo.tempCtclMgrLocation
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Branch_cd] ON [dbo].[tempCtclMgrLocation] ([Branch_cd])

GO

-- --------------------------------------------------
-- INDEX dbo.tempDumpSEBIData
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_text1] ON [dbo].[tempDumpSEBIData] ([text1])

GO

-- --------------------------------------------------
-- INDEX dbo.tempDumpSEBIData1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_srno] ON [dbo].[tempDumpSEBIData1] ([srno])

GO

-- --------------------------------------------------
-- INDEX dbo.tempDumpSEBIdata2
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Entity] ON [dbo].[tempDumpSEBIdata2] ([Entity])

GO

-- --------------------------------------------------
-- INDEX dbo.tempo
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Amount] ON [dbo].[tempo] ([Amount])

GO

-- --------------------------------------------------
-- INDEX dbo.temptable
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_age] ON [dbo].[temptable] ([age])

GO

-- --------------------------------------------------
-- INDEX dbo.test
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_id] ON [dbo].[test] ([id])

GO

-- --------------------------------------------------
-- INDEX dbo.test_table
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_name] ON [dbo].[test_table] ([name])

GO

-- --------------------------------------------------
-- INDEX dbo.test111
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_name] ON [dbo].[test111] ([name])

GO

-- --------------------------------------------------
-- INDEX dbo.test12
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BRANCH] ON [dbo].[test12] ([BRANCH])

GO

-- --------------------------------------------------
-- INDEX dbo.tmp_overall_mrg
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_BrokerCode] ON [dbo].[tmp_overall_mrg] ([BrokerCode])

GO

-- --------------------------------------------------
-- INDEX dbo.TRD_BSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TRD_BSE] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TRD_MCX
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TRD_MCX] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TRD_NCDEX
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TRD_NCDEX] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TRD_NSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TRD_NSE] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TRD_NSEFO
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TRD_NSEFO] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TROR_BSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TROR_BSE] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TROR_BSE
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_T2] ON [dbo].[TROR_BSE] ([T2], [T4], [T5], [T6], [T10], [T11], [T14])

GO

-- --------------------------------------------------
-- INDEX dbo.tror_mcx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[tror_mcx] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.trOR_NCDEX
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[trOR_NCDEX] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TROR_NSE
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[TROR_NSE] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.TROR_NSE
-- --------------------------------------------------
CREATE NONCLUSTERED INDEX [IX_T3] ON [dbo].[TROR_NSE] ([T3], [T4], [T5], [T9], [T11], [T12], [T13], [T15], [T20])

GO

-- --------------------------------------------------
-- INDEX dbo.tror_nsefo
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_T1] ON [dbo].[tror_nsefo] ([T1])

GO

-- --------------------------------------------------
-- INDEX dbo.upload_research
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_company_name] ON [dbo].[upload_research] ([company_name])

GO

-- --------------------------------------------------
-- INDEX dbo.upload_research_files
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_company_name] ON [dbo].[upload_research_files] ([company_name])

GO

-- --------------------------------------------------
-- INDEX dbo.userid_details
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_IDname] ON [dbo].[userid_details] ([ID name])

GO

-- --------------------------------------------------
-- INDEX dbo.vanda_mcx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_brokapplied] ON [dbo].[vanda_mcx] ([brokapplied])

GO

-- --------------------------------------------------
-- INDEX dbo.vanda_ncx
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_brokapplied] ON [dbo].[vanda_ncx] ([brokapplied])

GO

-- --------------------------------------------------
-- INDEX dbo.Ver7.8
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Col001] ON [dbo].[Ver7.8] ([Col001])

GO

-- --------------------------------------------------
-- INDEX dbo.Ver7.9S1
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Col001] ON [dbo].[Ver7.9S1] ([Col001])

GO

-- --------------------------------------------------
-- INDEX dbo.Ver7.9S2
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Col001] ON [dbo].[Ver7.9S2] ([Col001])

GO

-- --------------------------------------------------
-- INDEX dbo.Ver7.9S3
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_Col001] ON [dbo].[Ver7.9S3] ([Col001])

GO

-- --------------------------------------------------
-- INDEX dbo.VSAT_IDS
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_aaa] ON [dbo].[VSAT_IDS] ([aaa])

GO

-- --------------------------------------------------
-- INDEX dbo.vsat_login_id
-- --------------------------------------------------
CREATE CLUSTERED INDEX [IX_loginid] ON [dbo].[vsat_login_id] ([loginid])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.anjana_tbBooks
-- --------------------------------------------------
ALTER TABLE [dbo].[anjana_tbBooks] ADD CONSTRAINT [PK_anjana_tbBooks] PRIMARY KEY ([BookId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.chq_entry
-- --------------------------------------------------
ALTER TABLE [dbo].[chq_entry] ADD CONSTRAINT [PK_chq_entry] PRIMARY KEY ([AppNo])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.client_master
-- --------------------------------------------------
ALTER TABLE [dbo].[client_master] ADD CONSTRAINT [PK__client_m__3214EC2716D94F8E] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.client_master_integrated_RENAMEDAS_PII
-- --------------------------------------------------
ALTER TABLE [dbo].[client_master_integrated_RENAMEDAS_PII] ADD CONSTRAINT [PK__client_m__3214EC2723DE44F1] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.client_master_Prosupport
-- --------------------------------------------------
ALTER TABLE [dbo].[client_master_Prosupport] ADD CONSTRAINT [PK__client_m__3214EC2727AED5D5] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ctcl_vsat
-- --------------------------------------------------
ALTER TABLE [dbo].[ctcl_vsat] ADD CONSTRAINT [PK_ctcl_vsat] PRIMARY KEY ([vsat_name])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.CtclMgrLocation
-- --------------------------------------------------
ALTER TABLE [dbo].[CtclMgrLocation] ADD CONSTRAINT [PK_CtclMgrLocation] PRIMARY KEY ([LocaCode])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ECS_Priority
-- --------------------------------------------------
ALTER TABLE [dbo].[ECS_Priority] ADD CONSTRAINT [PK_ECS_Priority] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ECS_Role
-- --------------------------------------------------
ALTER TABLE [dbo].[ECS_Role] ADD CONSTRAINT [PK_ECS_Role] PRIMARY KEY ([RoleId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ECS_User_Role
-- --------------------------------------------------
ALTER TABLE [dbo].[ECS_User_Role] ADD CONSTRAINT [PK_ECS_User_Role] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.ECS_Users
-- --------------------------------------------------
ALTER TABLE [dbo].[ECS_Users] ADD CONSTRAINT [PK__ECS_User__3214EC077C055DC1] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.EmpDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[EmpDetails] ADD CONSTRAINT [PK_EmpDetails] PRIMARY KEY ([empid])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.pda_fileinfo_details
-- --------------------------------------------------
ALTER TABLE [dbo].[pda_fileinfo_details] ADD CONSTRAINT [PK__pda_file__3213E83F1308BEAA] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Shift
-- --------------------------------------------------
ALTER TABLE [dbo].[Shift] ADD CONSTRAINT [PK_Shift] PRIMARY KEY ([OLD_KYC_CODE])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Access_denied
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Access_denied] ADD CONSTRAINT [PK__tbl_Acce__3213E83F0D4FE554] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_AccessControl
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_AccessControl] ADD CONSTRAINT [PK__tbl_Acce__3214EC2763C3BFDC] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2B_trlBMAction
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2B_trlBMAction] ADD CONSTRAINT [PK__tbl_B2B___FFE3F4D9155B1B70] PRIMARY KEY ([ActionId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2B_trlTransaction
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2B_trlTransaction] ADD CONSTRAINT [PK__tbl_B2B___F57BD2F7118A8A8C] PRIMARY KEY ([EntryId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BBranchManager
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BBranchManager] ADD CONSTRAINT [PK__tbl_B2BB__C6DE0CC131F75A1E] PRIMARY KEY ([BId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_B2BEVENTASSESSMENT
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_B2BEVENTASSESSMENT] ADD CONSTRAINT [PK__TBL_B2BE__3214EC27507BE13E] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BExPectedOutMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BExPectedOutMaster] ADD CONSTRAINT [PK__tbl_B2BE__C190170B05E3CDB6] PRIMARY KEY ([EID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_B2BHIRING
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_B2BHIRING] ADD CONSTRAINT [PK__TBL_B2BH__3214EC275634BA94] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BLoginDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BLoginDetails] ADD CONSTRAINT [PK__tbl_B2BL__3214EC2775E27017] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BMActionMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BMActionMaster] ADD CONSTRAINT [PK__tbl_B2BM__C6DE0D213F51553C] PRIMARY KEY ([BID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BMailMatrix
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BMailMatrix] ADD CONSTRAINT [PK_tbl_B2BMailMatrix] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_B2BMAINTRANSACTION
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_B2BMAINTRANSACTION] ADD CONSTRAINT [PK__TBL_B2BM__3214EC27450A2E92] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BMapping
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BMapping] ADD CONSTRAINT [PK__tbl_BMMa__3214EC077D8391DF] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BMicrosite
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BMicrosite] ADD CONSTRAINT [PK_TBL_B2BMICROSITE] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_B2BMKTCOLLATERAL
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_B2BMKTCOLLATERAL] ADD CONSTRAINT [PK__TBL_B2BM__3214EC275FBE24CE] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BPrinting
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BPrinting] ADD CONSTRAINT [PK__tbl_B2BP__3214EC27286DEFE4] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BPurposeMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BPurposeMaster] ADD CONSTRAINT [PK_tbl_B2B_MstPurpose] PRIMARY KEY ([PID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_B2BPURPOSETRANSACTION
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_B2BPURPOSETRANSACTION] ADD CONSTRAINT [PK__TBL_B2BP__3214EC2749CEE3AF] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_B2BReqMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_B2BReqMaster] ADD CONSTRAINT [PK__tbl_B2BR__CAFF41323B80C458] PRIMARY KEY ([RID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_B2BVCARD_RENAMEDAS_PII
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_B2BVCARD_RENAMEDAS_PII] ADD CONSTRAINT [PK__TBL_B2BV__3214EC276D181FEC] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Connection
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Connection] ADD CONSTRAINT [tbl_Connection_pk] PRIMARY KEY ([ConnectionId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_dtsprocess
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_dtsprocess] ADD CONSTRAINT [PK_tbl_dtsprocess] PRIMARY KEY ([process_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_EmailMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_EmailMaster] ADD CONSTRAINT [PK_tbl_EmailMaster] PRIMARY KEY ([Sno])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_EmailPurpose
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_EmailPurpose] ADD CONSTRAINT [PK__tbl_Emai__F57BD2F751A50FA1] PRIMARY KEY ([EntryId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_emp_app
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_emp_app] ADD CONSTRAINT [PK_tbl_emp_app] PRIMARY KEY ([EmpId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_FOS_CONTACT_LOG
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_FOS_CONTACT_LOG] ADD CONSTRAINT [PK__TBL_FOS___3214EC2732B6742D] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_FOS_CONTACTS
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_FOS_CONTACTS] ADD CONSTRAINT [PK__TBL_FOS___3214EC2736870511] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_FOS_EMP_DATA
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_FOS_EMP_DATA] ADD CONSTRAINT [PK__TBL_FOS___3214EC272EE5E349] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_FOS_TEMPLATE
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_FOS_TEMPLATE] ADD CONSTRAINT [PK__TBL_FOS___3214EC273B4BBA2E] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_GlobalParameter
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_GlobalParameter] ADD CONSTRAINT [PK_tbl_GlobalParameter] PRIMARY KEY ([ParamId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_HolidayMaster
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_HolidayMaster] ADD CONSTRAINT [PK_tbl_HolidayMaster] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Inhouse_Exception
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Inhouse_Exception] ADD CONSTRAINT [PK_tbl_Inhouse_Exception] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_LeadDetails_RENAMEDAS_PII
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_LeadDetails_RENAMEDAS_PII] ADD CONSTRAINT [PK_tbl_LeadDetails] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_LeadStatus
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_LeadStatus] ADD CONSTRAINT [PK_tbl_LeadStatus] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_LeadTransaction
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_LeadTransaction] ADD CONSTRAINT [PK_tbl_LeadTransaction] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_LEAFLET
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_LEAFLET] ADD CONSTRAINT [PK__TBL_LEAF__3214EC2773C51D7B] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Level
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Level] ADD CONSTRAINT [PK_tbl_Level] PRIMARY KEY ([LevelId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_MOB_NOTIFICATION
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_MOB_NOTIFICATION] ADD CONSTRAINT [PK_TBL_MOB_NOTIFICATION] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.TBL_MOB_NOTIFICATION_LOG
-- --------------------------------------------------
ALTER TABLE [dbo].[TBL_MOB_NOTIFICATION_LOG] ADD CONSTRAINT [PK_TBL_MOB_NOTIFICATION_LOG] PRIMARY KEY ([Id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_MobActivityLog
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_MobActivityLog] ADD CONSTRAINT [PK_tbl_MobActivityLog] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_mobLoginDetails
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_mobLoginDetails] ADD CONSTRAINT [PK__tbl_mobL__3214EC276C5905DD] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Mobmodule_master
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Mobmodule_master] ADD CONSTRAINT [PK__tbl_Mobm__C5775520679450C0] PRIMARY KEY ([PID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Module_Mapping
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Module_Mapping] ADD CONSTRAINT [tbl_Module_Mapping_pk] PRIMARY KEY ([ModuleId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_mst_dtsname
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_mst_dtsname] ADD CONSTRAINT [PK_tbl_mst_dtsname] PRIMARY KEY ([dts_id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_mst_Globalreport
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_mst_Globalreport] ADD CONSTRAINT [PK_tbl_mst_Globalreport] PRIMARY KEY ([Rpt_srno])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_OFS_Lock
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_OFS_Lock] ADD CONSTRAINT [PK__tbl_OFS___3214EC2751DA19CB] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_OFS_ORDER
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_OFS_ORDER] ADD CONSTRAINT [PK__tbl_OFS___71D2766C4D1564AE] PRIMARY KEY ([REQUEST_ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_PDALogin
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_PDALogin] ADD CONSTRAINT [PK_tbl_PDALogin] PRIMARY KEY ([EntryId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_perfmon
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_perfmon] ADD CONSTRAINT [PK__tbl_perf__3213E83F4D6A6A69] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_ProfilePic
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_ProfilePic] ADD CONSTRAINT [PK_tbl_ProfilePic] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Request
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Request] ADD CONSTRAINT [PK_tbl_Request] PRIMARY KEY ([RequestId])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.tbl_Schedular_data
-- --------------------------------------------------
ALTER TABLE [dbo].[tbl_Schedular_data] ADD CONSTRAINT [PK_tbl_Schedular_data] PRIMARY KEY ([SNo])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_WebinarAngelClientRegistration
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_WebinarAngelClientRegistration] ADD CONSTRAINT [PK_Tbl_WebinarAngelClientRegistration] PRIMARY KEY ([id])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Tbl_WebinarNewClientRegistration_RENAMEDAS_PII
-- --------------------------------------------------
ALTER TABLE [dbo].[Tbl_WebinarNewClientRegistration_RENAMEDAS_PII] ADD CONSTRAINT [PK_Tbl_WebinarNewClientRegistration] PRIMARY KEY ([ID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Users
-- --------------------------------------------------
ALTER TABLE [dbo].[Users] ADD CONSTRAINT [PK_dbo.Users] PRIMARY KEY ([UserID])

GO

-- --------------------------------------------------
-- PK_UNIQUE dbo.Voucher_Entry_Acc_Details
-- --------------------------------------------------
ALTER TABLE [dbo].[Voucher_Entry_Acc_Details] ADD CONSTRAINT [PK_Voucher_Entry_Acc_Details] PRIMARY KEY ([Segment], [BankCode])

GO

-- --------------------------------------------------
-- PROCEDURE dbo.account_rpt
-- --------------------------------------------------
CREATE procedure account_rpt
as    
set nocount on    
  
set transaction isolation level read uncommitted    
  
select * from CLIENT_PERFORMANCE_SUMMARY order by AVERAGE DESC

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.account_rpt_old
-- --------------------------------------------------
CREATE procedure account_rpt_old
as  
set nocount on  
  
select top 50 PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,  
Active_day=datediff(day,  
(  
(case when(case when(case when  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
> min(mcdx_sdt) then  
(case when(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
else min(mcdx_sdt) end)  
> max(ncdx_sdt) then  
(case when(case when  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
> min(mcdx_sdt) then  
(case when(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
else min(mcdx_sdt) end)  
else min(ncdx_sdt) end)),  
(  
(case when(case when(case when  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
> max(mcdx_ldt) then  
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
else max(mcdx_ldt) end)  
> max(ncdx_ldt) then  
(case when(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
> max(mcdx_ldt) then  
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
else max(mcdx_ldt) end)  
else max(ncdx_ldt) end))),  
revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),  
Average=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/  
(datediff(day,  
(  
(case when(case when(case when  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
> min(mcdx_sdt) then  
(case when(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
else min(mcdx_sdt) end)  
> max(ncdx_sdt) then  
(case when(case when  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when max(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
> min(mcdx_sdt) then  
(case when(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when max(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
else min(mcdx_sdt) end)  
else min(ncdx_sdt) end)),  
(  
(case when(case when(case when  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
> max(mcdx_ldt) then  
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
else max(mcdx_ldt) end)  
> max(ncdx_ldt) then  
(case when(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
> max(mcdx_ldt) then  
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
else max(mcdx_ldt) end)  
else max(ncdx_ldt) end)))  
),2))  
from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b   
where a.party_code collate Latin1_General_CI_AS=b.party_code   
--and a.party_code='a890'  
group by a.party_code,b.party_name,Branch,Subgroup  
order by a.party_code  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.account_rpt_OLD1
-- --------------------------------------------------
CREATE procedure account_rpt_OLD1
as    
set nocount on    
  
set transaction isolation level read uncommitted    
  
select PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,  
Active_day=datediff(day,sdt,ldt)+1,  
revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),  
Average=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2))  
from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b     
where a.party_code collate Latin1_General_CI_AS=b.party_code   
group by Party_Name,a.party_code,Branch,Subgroup,ldt,sdt    
order by a.party_code   
  
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.account_rpt_sum
-- --------------------------------------------------

CREATE procedure account_rpt_sum
as    
set nocount on    
  
set transaction isolation level read uncommitted    
  
select * from CLIENT_PERFORMANCE_SUMMARY1 order by AVERAGE_bse,Average_nse,Average_fo,Average_ncdx,Average_mcdx DESC

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.account_rpt1
-- --------------------------------------------------

CREATE procedure account_rpt1
as    
set nocount on    
  
set transaction isolation level read uncommitted    
  
select * from CLIENT_PERFORMANCE_SUMMARY1 order by AVERAGE_BSE,Average_nse,Average_fo,Average_ncdx,Average_mcdx DESC

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Bolt_no_file
-- --------------------------------------------------
CREATE procedure Bolt_no_file    
as    
set nocount on    
declare @boltno as varchar(2000),@exestr as varchar(2000)    
select @boltno='('''+replace(category1+','+category2+','+category3+','+category4+','+category5,',',''',''')+''')' from bolt_category    
--print @boltno
set @exestr='select trdr from boltfile where trdr not in '+@boltno    
exec(@exestr)    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.BRANCHWISE_TURNOVER
-- --------------------------------------------------
CREATE PROCEDURE BRANCHWISE_TURNOVER
@REGION VARCHAR(20),
@ACCESS_TO VARCHAR(20),
@ACCESS_CODE VARCHAR(20)
AS
BEGIN
SET NOCOUNT ON
SELECT BRANCH_CD, TURNOVER = SUM(TURNOVER), BROKERAGE = SUM(BROKERAGE)
FROM EXM_CLIENTTO
WHERE SAUDA_DATE BETWEEN '2012-04-01' AND '2012-04-30' AND REGION = @REGION
GROUP BY BRANCH_CD
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.buy_value_update
-- --------------------------------------------------
CREATE  proc buy_value_update   
as  
set nocount on  
/* update a buy_value column as per a specific formulla*/
update ctcl_volume  
set buy_value=m.multiplier*c.rate*c.qty   
from ctcl_volume c,multiplier m  
where c.ins_symbol=m.symbol and  buy_sell='1' and buy_value is null  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.check_payin_client
-- --------------------------------------------------
CREATE procedure check_payin_client (        
@segment as varchar(10),        
@bankcode as varchar(10),        
@pcode as varchar(10),        
@access_to as varchar(10),        
@access_Code as varchar(10),        
@chqno as varchar(10))        
as        
        
set nocount on        
        
declare @nor as int,@mess as varchar(50),@bor as int        
set @nor=0        
set @bor=0  
if @access_to='BROKER'        
BEGIN        
 select @nor=count(party_code) from risk.dbo.client_details (nolock)         
 where party_code=@pcode         
END        
        
if @access_to='BRANCH'        
BEGIN        
 select @nor=count(party_code) from risk.dbo.client_details (nolock)         
 where party_code=@pcode and branch_cd=@access_code        
END        
        
if @access_to='BRMAST'        
BEGIN        
 select @nor=count(party_code) from risk.dbo.client_details (nolock)         
 where party_code=@pcode and  branch_cd in ( select branch_cd from risk.dbo.branch_master (nolock) where BrMast_cd=@access_Code)        
END        
        
if @access_to='REGION'        
BEGIN        
 select @nor=count(party_code) from risk.dbo.client_details (nolock)         
 where party_code=@pcode and  branch_cd in ( select code from risk.dbo.region (nolock) where reg_code=@access_Code)        
END        
        
set @mess=''        
if @nor=0         
begin        
 set @mess='Invalid Party Code'        
end        
        
Select @bor=count(cltcode) from V_BANKMASTER where segment=@segment and cltcode=@bankcode        
        
if @bor=0         
begin        
 if len(@mess) > 0         
 begin        
  set @mess=@mess+' and '        
 end         
 set @mess=@mess+' Invalid Bank Code.'        
end        
      
      
declare @cor as int      
set @cor=0      
select @cor=count(*) from payin (nolock) where cltcode=@pcode and ddno=@chqno       
if @cor=1      
begin      
 set @mess='Chq.No. already exist'      
end      
      
select nor=@nor+@bor+@cor,mess=@mess        
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.check_sebi_banned_entities
-- --------------------------------------------------
CREATE procedure [dbo].[check_sebi_banned_entities]    
as    
set nocount on    
    
Set transaction isolation level read uncommitted
select a.*,status=0,b.branch_Cd,b.sub_BRoker,b.party_code,b.long_name into #File_a1    
from dbo.SEBI_banned a (NOLOCK), AngelNseCM.msajag.dbo.client_Details b    
where ltrim(rtrim(pan_gir_no))=ltrim(rtrim(pan_no))     
and pan_no <> ''    
    
Select pan_no into #file from dbo.sebi_banned (NOLOCK) where pan_no not in (select pan_no from #File_a1) and pan_no<>''

    
SELECT name,xname=replace(testdb.dbo.ADDSPACE(name),'  ',' ') into #filex FROM dbo.SEBI_BANNED (NOLOCK)  where pan_no
not in (select pan_no from #file)   

    
---------------- Perfect Matching     
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)     
into #file_1    
from    
(    
SELECT *,    
SFname=substring(xname,1,charindex(' ',xname,1)),    
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')    
FROM #filex    
) a ,    
(    
select branch_cd,sub_BRoker,party_Code,long_name,    
CFname=substring(long_name,1,charindex(' ',long_name,1)),    
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')    
FROM AngelNseCM.msajag.dbo.client_details     
) b    
where  a.sfname=b.cfname and a.slname=b.clname and a.slname <> ''    
and (case when xname=long_name then 0 else 1 end) = 0    
    
---------------- Matching with initial of middlename of SEBI Banned with full name of Party Master    
    
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)     
into #file_2    
from    
(    
select xname,    
SFname=substring(xname,1,charindex(' ',xname,1)),    
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),    
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')    
--substring(xname,charindex(' ',xname)+1,100),charindex(' ',substring(xname,charindex(' ',xname)+1,100)),    
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)),len(xname),    
--case when     
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)) < len(xname) then 1 else 0 end    
FROM #filex    
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0    
) a,    
(    
select     
branch_cd,sub_BRoker,party_Code,long_name,    
CFname=substring(long_name,1,charindex(' ',long_name,1)),    
CMname=ltrim(rtrim(substring(long_name,charindex(' ',long_name),charindex(' ',substring(long_name,charindex(' ',long_name)+1,100))))),    
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')    
FROM AngelNseCM.msajag.dbo.client_details     
) b    
where  a.sfname=b.cfname and a.slname=b.clname     
and a.smname=substring(cmname,1,1) and len(smname)=1 and len(cmname) > 1    
    
    
---------------- Matching with initial of middlename of Party Master with full name of SEBI Banned     
    
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)     
into #file_3    
from    
(    
select xname,    
SFname=substring(xname,1,charindex(' ',xname,1)),    
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),    
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')    
--substring(xname,charindex(' ',xname)+1,100),charindex(' ',substring(xname,charindex(' ',xname)+1,100)),    
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)),len(xname),    
--case when     
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)) < len(xname) then 1 else 0 end    
FROM #filex    
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0    
) a,    
(    
select     
branch_cd,sub_BRoker,party_Code,long_name,    
CFname=substring(long_name,1,charindex(' ',long_name,1)),    
CMname=ltrim(rtrim(substring(long_name,charindex(' ',long_name),charindex(' ',substring(long_name,charindex(' ',long_name)+1,100))))),    
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')    
FROM AngelNseCM.msajag.dbo.client_details     
) b    
where  a.sfname=b.cfname and a.slname=b.clname     
and b.cmname=substring(smname,1,1) and len(cmname)=1 and len(smname) > 1    
    
  
    
select *,block=(case when party_code in (select party_code from block_sbe) then 'Blocked' else 'UnBlocked'end) from    
(    
select * from #File_a1    
union all    
select z.*,y.status,y.branch_Cd,y.sub_BRoker,y.party_code,y.long_name    
from #filex x, dbo.SEBI_banned z (nolock),    
(    
select * from #file_1    
union    
select * from #file_2    
union    
select * from #file_3    
) y where x.xname=y.xname and z.name=x.name    
) a    
order by status,party_code    
    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.check_sebi_banned_entities1
-- --------------------------------------------------
CREATE procedure [dbo].[check_sebi_banned_entities1]    
as    
set nocount on    

Set transaction isolation level read uncommitted
select a.*,status=0,b.branch_Cd,b.sub_BRoker,b.party_code,b.long_name into #File_a1    
from dbo.SEBI_banned a (NOLOCK), AngelNseCM.msajag.dbo.client_Details b    
where ltrim(rtrim(pan_gir_no))=ltrim(rtrim(pan_no))     
and pan_no <> ''    
    
Select pan_no into #file from dbo.sebi_banned (NOLOCK) where pan_no not in (select pan_no from #File_a1) and pan_no<>''

    
SELECT name,xname=replace(testdb.dbo.ADDSPACE(name),'  ',' ') into #filex FROM dbo.SEBI_BANNED (NOLOCK)  where pan_no
not in (select pan_no from #file)   
    
---------------- Perfect Matching     
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)     
into #file_1    
from    
(    
SELECT *,    
SFname=substring(xname,1,charindex(' ',xname,1)),    
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')    
FROM #filex    
) a ,    
(    
select branch_cd,sub_BRoker,party_Code,long_name,    
CFname=substring(long_name,1,charindex(' ',long_name,1)),    
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')    
FROM AngelNseCM.msajag.dbo.client_details     
) b    
where  a.sfname=b.cfname and a.slname=b.clname and a.slname <> ''    
and (case when xname=long_name then 0 else 1 end) = 0    
    
---------------- Matching with initial of middlename of SEBI Banned with full name of Party Master    
    
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)     
into #file_2    
from    
(    
select xname,    
SFname=substring(xname,1,charindex(' ',xname,1)),    
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),    
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')    
--substring(xname,charindex(' ',xname)+1,100),charindex(' ',substring(xname,charindex(' ',xname)+1,100)),    
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)),len(xname),    
--case when     
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)) < len(xname) then 1 else 0 end    
FROM #filex    
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0    
) a,    
(    
select     
branch_cd,sub_BRoker,party_Code,long_name,    
CFname=substring(long_name,1,charindex(' ',long_name,1)),    
CMname=ltrim(rtrim(substring(long_name,charindex(' ',long_name),charindex(' ',substring(long_name,charindex(' ',long_name)+1,100))))),    
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')    
FROM AngelNseCM.msajag.dbo.client_details     
) b    
where  a.sfname=b.cfname and a.slname=b.clname     
and a.smname=substring(cmname,1,1) and len(smname)=1 and len(cmname) > 1    
    
    
---------------- Matching with initial of middlename of Party Master with full name of SEBI Banned     
    
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)     
into #file_3    
from    
(    
select xname,    
SFname=substring(xname,1,charindex(' ',xname,1)),    
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),    
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')    
--substring(xname,charindex(' ',xname)+1,100),charindex(' ',substring(xname,charindex(' ',xname)+1,100)),    
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)),len(xname),    
--case when     
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)) < len(xname) then 1 else 0 end    
FROM #filex    
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0    
) a,    
(    
select     
branch_cd,sub_BRoker,party_Code,long_name,    
CFname=substring(long_name,1,charindex(' ',long_name,1)),    
CMname=ltrim(rtrim(substring(long_name,charindex(' ',long_name),charindex(' ',substring(long_name,charindex(' ',long_name)+1,100))))),    
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')    
FROM AngelNseCM.msajag.dbo.client_details     
) b    
where  a.sfname=b.cfname and a.slname=b.clname     
and b.cmname=substring(smname,1,1) and len(cmname)=1 and len(smname) > 1    
    
    

select * from    
(    
select * from #File_a1    
union all    
select z.*,y.status,y.branch_Cd,y.sub_BRoker,y.party_code,y.long_name    
from #filex x, dbo.SEBI_banned z (NOLOCK),    
(    
select * from #file_1    
union    
select * from #file_2    
union    
select * from #file_3    
) y where x.xname=y.xname and z.name=x.name    
) a  where party_code not in (select party_code from dbo.Block_sbe (NOLOCK) )  
order by status,party_code    
    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Check_SebiBanned_Name
-- --------------------------------------------------
CREATE procedure Check_SebiBanned_Name(@Name Varchar(100))           
as          
set nocount on        
          
SELECT Bname=name,xname=replace(testdb.dbo.ADDSPACE(name),'  ',' ') into #filex FROM dbo.SEBI_BANNED (NOLOCK)    
          
---------------- Perfect Matching           
select Bname,xname,@Name Name,status=(case when xname=@Name then 0 else 1 end) into #file_1          
from          
(          
SELECT *,          
SFname=substring(xname,1,charindex(' ',xname,1)),          
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')          
FROM #filex (nolock)         
) a ,          
(          
select          
CFname=substring(@Name,1,charindex(' ',@Name,1)),          
CLname=replace(rtrim(ltrim(reverse(substring(reverse(@Name),1,charindex(' ',reverse(@Name),1))))),')','')              
) b          
where a.sfname=b.cfname and a.slname=b.clname and a.slname <> ''          
and (case when xname=@Name then 0 else 1 end) = 0       
  
---------------- Matching with first name and last name of SEBI Banned and Party Master          
          
select Bname,xname,@Name Name,status=(case when xname=@Name then 0 else 1 end) into #file_2          
from          
(          
select xname,Bname,          
SFname=substring(xname,1,charindex(' ',xname,1)),          
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),          
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')            
FROM #filex  (nolock)        
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0          
) a,          
(          
select                
CFname=substring(@Name,1,charindex(' ',@Name,1)),          
CMname=ltrim(rtrim(substring(@Name,charindex(' ',@Name),charindex(' ',substring(@Name,charindex(' ',@Name)+1,100))))),          
CLname=replace(rtrim(ltrim(reverse(substring(reverse(@Name),1,charindex(' ',reverse(@Name),1))))),')','')          
) b          
where  a.sfname=b.cfname and a.slname=b.clname and a.slname <> ''        
        
/*  
---------------- Matching with initial of middlename of SEBI Banned with full name of Party Master          
          
select Bname,xname,@Name Name,status=(case when xname=@Name then 0 else 1 end) into #file_2          
from          
(          
select xname,Bname,          
SFname=substring(xname,1,charindex(' ',xname,1)),          
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),          
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')            
FROM #filex          
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0          
) a,          
(          
select                
CFname=substring(@Name,1,charindex(' ',@Name,1)),          
CMname=ltrim(rtrim(substring(@Name,charindex(' ',@Name),charindex(' ',substring(@Name,charindex(' ',@Name)+1,100))))),          
CLname=replace(rtrim(ltrim(reverse(substring(reverse(@Name),1,charindex(' ',reverse(@Name),1))))),')','')          
) b          
where  a.sfname=b.cfname and a.slname=b.clname           
and a.smname=substring(cmname,1,1) and len(smname)=1 and len(cmname) > 1          
          
          
---------------- Matching with initial of middlename of Party Master with full name of SEBI Banned           
          
select Bname,xname,@Name Name,status=(case when xname=@Name then 0 else 1 end) into #file_3              
from          
(          
select xname,Bname,          
SFname=substring(xname,1,charindex(' ',xname,1)),          
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),          
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')             
FROM #filex          
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0          
) a,          
(          select                
CFname=substring(@Name,1,charindex(' ',@Name,1)),          
CMname=ltrim(rtrim(substring(@Name,charindex(' ',@Name),charindex(' ',substring(@Name,charindex(' ',@Name)+1,100))))),          
CLname=replace(rtrim(ltrim(reverse(substring(reverse(@Name),1,charindex(' ',reverse(@Name),1))))),')','')            
) b          
where  a.sfname=b.cfname and a.slname=b.clname           
and b.cmname=substring(smname,1,1) and len(cmname)=1 and len(smname) > 1          
*/           
  
Select * into #t from #file_1 (nolock)         
union          
Select * from #file_2 (nolock)    
      
    
Select * from #t (nolock),Sebi_Banned b where #t.Bname = b.Name order by #t.status          
          
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.check_shifting
-- --------------------------------------------------
CREATE procedure [dbo].[check_shifting]  
as  
  
set transaction isolation level read uncommitted  
set nocount on  

declare @maxdate as varchar(11)
set @maxdate = (select max(entrydate) from shift)
  
select * into #shift from shift where entrydate >= @maxdate

------------------------------ BSE CHECK  
  
select Segment='BSECM',ocli=count(old_kyc_code)   
into #bsea  
from #shift where old_kyc_code in (select party_code from risk.dbo.bse_client2)  
  
select Segment='BSECM',ncli=count(new_kyc_code)   
into #bseb  
from #shift where new_kyc_code in (select party_code from risk.dbo.bse_client2)    
  
Select distinct branch into #bse1  
from #shift where old_kyc_code in (select party_code from risk.dbo.bse_client2) and   
branch not in (select branch_cd from AngelBSECM.bsedb_ab.dbo.branches)   
  
--select segment='BSECM',br_miss=count(*) from #bse1  
  
Select distinct sub_broker into #bse2  
from #shift where old_kyc_code in (select party_code from risk.dbo.bse_client2) and   
sub_broker not in (select sub_BRoker from AngelBSECM.bsedb_ab.dbo.subbrokers)   
  
--select segment='BSECM',sb_miss=count(*) from #bse2  
  
select a.*,d.ncli,b.br_miss,c.sb_miss   
into #bse_chk  
from #bsea a, #bseb d,   
(select segment='BSECM',br_miss=count(*) from #bse1)b,   
(select segment='BSECM',sb_miss=count(*) from #bse2) c   
where a.segment=b.segment and a.segment=c.segment and c.segment=d.segment  
  
  
  
------------------------------ NSE CHECK  
  
select Segment='NSECM',ocli=count(old_kyc_code)   
into #nsea  
from #shift where old_kyc_code in (select party_code from risk.dbo.nse_client2)  
  
select Segment='NSECM',ncli=count(new_kyc_code)   
into #nseb  
from #shift where new_kyc_code in (select party_code from risk.dbo.nse_client2)  
  
Select distinct branch into #nse1  
from #shift where old_kyc_code in (select party_code from risk.dbo.nse_client2) and  
branch not in (select branch_cd from AngelNseCM.msajag.dbo.branches)   
  
--select segment='NSECM',br_miss=count(*) from #nse1  
  
Select distinct sub_broker into #nse2  
from #shift where old_kyc_code in (select party_code from risk.dbo.nse_client2) and   
sub_broker not in (select sub_BRoker from AngelNseCM.msajag.dbo.subbrokers)   
  
--select segment='NSECM',sb_miss=count(*) from #nse2  
  
select a.*,d.ncli,b.br_miss,c.sb_miss   
into #nse_chk  
from #nsea a, #nseb d,  
(select segment='NSECM',br_miss=count(*) from #nse1)b,   
(select segment='NSECM',sb_miss=count(*) from #nse2) c   
where a.segment=b.segment and a.segment=c.segment and a.segment=d.segment  
  
  
  
---------------------------- FO CHECK  
  
select Segment='NSEFO',ocli=count(old_kyc_code)   
into #foa  
from #shift where old_kyc_code in (select party_code from risk.dbo.fo_client2)  
  
select Segment='NSEFO',ncli=count(new_kyc_code)   
into #fob  
from #shift where new_kyc_code in (select party_code from risk.dbo.fo_client2)  
  
  
Select distinct branch into #fo1  
from #shift where old_kyc_code in (select party_code from risk.dbo.fo_client2) and  
branch not in (select branch_cd from angelfo.nsefo.dbo.branches)   
  
--select segment='NSEFO',br_miss=count(*) from #fo1  
  
Select distinct sub_broker into #fo2  
from #shift where old_kyc_code in (select party_code from risk.dbo.fo_client2) and  
sub_broker not in (select sub_BRoker from angelfo.nsefo.dbo.subbrokers)   
  
--select segment='NSEFO',sb_miss=count(*) from #fo2  
  
select a.*,d.ncli,b.br_miss,c.sb_miss   
into #fo_chk  
from #foa a, #fob d,   
(select segment='NSEFO',br_miss=count(*) from #fo1)b,   
(select segment='NSEFO',sb_miss=count(*) from #fo2) c   
where a.segment=b.segment and a.segment=c.segment and a.segment=d.segment  
  
  
  
------------------------------ MCX CHECK  
  
select Segment='MCX',ocli=count(old_kyc_code)   
into #mcdxa  
from #shift where old_kyc_code in (select party_code from risk.dbo.mcdx_client2)  
  
select Segment='MCX',ncli=count(new_kyc_code)   
into #mcdxb  
from #shift where new_kyc_code in (select party_code from risk.dbo.mcdx_client2)  
  
  
Select distinct branch into #mcdx1  
from #shift where old_kyc_code in (select party_code from risk.dbo.mcdx_client2) and  
branch not in (select branch_cd from angelcommodity.mcdx.dbo.branches)   
  
--select segment='NSEFO',br_miss=count(*) from #fo1  
  
Select distinct sub_broker into #mcdx2  
from #shift where old_kyc_code in (select party_code from risk.dbo.mcdx_client2) and   
sub_broker not in (select sub_BRoker from angelcommodity.mcdx.dbo.subbrokers)   
  
--select segment='NSEFO',sb_miss=count(*) from #fo2  
  
select a.*,d.ncli, b.br_miss,c.sb_miss   
into #mcdx_chk  
from #mcdxa a, #mcdxb d,   
(select segment='MCX',br_miss=count(*) from #mcdx1)b,   
(select segment='MCX',sb_miss=count(*) from #mcdx2) c   
where a.segment=b.segment and a.segment=c.segment and a.segment=d.segment  
  
------------------------------ NCDEX CHECK  
  
select Segment='NCDEX',ocli=count(old_kyc_code)   
into #ncdxa  
from #shift where old_kyc_code in (select party_code from risk.dbo.ncdx_client2)  
  
select Segment='NCDEX',ncli=count(new_kyc_code)   
into #ncdxb  
from #shift where new_kyc_code in (select party_code from risk.dbo.ncdx_client2)  
  
  
Select distinct branch into #ncdx1  
from #shift where old_kyc_code in (select party_code from risk.dbo.ncdx_client2)   
and branch not in (select branch_cd from angelcommodity.ncdx.dbo.branches)   
  
--select segment='NSEFO',br_miss=count(*) from #fo1  
  
Select distinct sub_broker into #ncdx2  
from #shift where old_kyc_code in (select party_code from risk.dbo.ncdx_client2) and   
sub_broker not in (select sub_BRoker from angelcommodity.ncdx.dbo.subbrokers)   
  
--select segment='NSEFO',sb_miss=count(*) from #fo2  
  
select a.*,d.ncli,b.br_miss,c.sb_miss   
into #ncdx_chk  
from #ncdxa a, #ncdxb d,   
(select segment='NCDEX',br_miss=count(*) from #ncdx1)b,   
(select segment='NCDEX',sb_miss=count(*) from #ncdx2) c   
where a.segment=b.segment and a.segment=c.segment and a.segment=d.segment  
  
  
  
  
select * from #bse_chk  
union  
select * from #nse_chk  
union  
select * from #fo_chk  
union  
select * from #mcdx_chk  
union  
select * from #ncdx_chk  
  
set nocount on

GO

-- --------------------------------------------------
-- PROCEDURE dbo.check_upload
-- --------------------------------------------------
CREATE procedure check_upload  
as  
  
set transaction isolation level read uncommitted  
set nocount on  
  
select segment,ord_dt=max(ord_dt),trd_dt=max(trd_dt)  
into #file1 from  
(  
select segment='BSECM',ord_dt=min(convert(datetime,substring(t30,4,3)+' '+substring(t30,1,2)+' 20'+substring(t30,8,2))),trd_dt=convert(datetime,'Jan  1 1900') from ord_bse  
union  
select segment='BSECM',ord_dt=convert(datetime,'Jan  1 1900'),trd_dt=max(convert(datetime,substring(t9,6,3)+substring(t9,9,2)+'/'+substring(t9,1,4))) from trd_bse  
union  
select segment='NSECM',ord_dt=min(convert(datetime,substring(t30,4,3)+' '+substring(t30,1,2)+' 20'+substring(t30,8,2))),trd_dt=convert(datetime,'Jan  1 1900') from ord_nse  
union  
select segment='NSECM',ord_dt=convert(datetime,'Jan  1 1900'),trd_dt=min(convert(datetime,substring(t20,4,3)+' '+substring(t20,1,2)+' '+substring(t20,8,4))) from trd_nse  
union  
select segment='NSEFO',ord_dt=convert(datetime,'Jan  1 1900'),trd_dt=min(convert(datetime,substring(t22,4,3)+' '+substring(t22,1,2)+' '+substring(t22,8,4))) from trd_nsefo  
union  
select segment='MCX',ord_dt=convert(datetime,'Jan  1 1900'),trd_dt=min(convert(datetime,substring(t24,4,3)+' '+substring(t24,1,2)+' '+substring(t24,8,4))) from trd_mcx  
union  
select segment='NCDEX',ord_dt=convert(datetime,'Jan  1 1900'),trd_dt=min(convert(datetime,substring(t22,4,3)+' '+substring(t22,1,2)+' '+substring(t22,8,4))) from trd_ncdex  
) a  
group by segment  
  
select * from #file1  
declare @nor as int, @pnor as int,@stat as int  
set @pnor=0  
set @nor=0  
  
select @nor=count(*) from (select distinct trd_dt from #file1) a  
  
select @stat=SUM(CASE WHEN ORD_DT <> TRD_DT THEN 1 ELSE 0 END)  
from #file1 where segment in ('BSECM','NSECM')  
  
if @stat=0   
begin   
   if @nor=1   
   begin  
	select @pnor=count(*) from  
  	(select distinct trd_Dt from #file1 where trd_dt not in (select distinct sauda_date from ctcl_trade_summ)) a  
   
	if @pnor <> 0  
	begin  
	   select rem='Last Uploaded Data not processed.'  
	end  
	if @pnor = 0  
	begin  
	   select rem='Data Uploading process Complete.'  
	end  
   end  
   else  
   begin  
	select rem='Updation Pending'  
   end  
end  
else  

begin  
 select rem='ORDER FILE DATE and TRADE FILE DATE Mismatch'  
end  
  
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.client_performance_check
-- --------------------------------------------------
CREATE procedure client_performance_check(@lastnod as int)
as
set nocount on

select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ' into #bse from intranet.risk.dbo.abl_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180
select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ' into #nse from intranet.risk.dbo.nse_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ' into #fo from intranet.risk.dbo.fo_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ' into #ncdx from intranet.risk.dbo.ncdx_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt) into #mcdx from intranet.risk.dbo.mcdx_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180


select cltcode,bse_ldt=max(bse_ldt),nse_ldt=max(nse_ldt),fo_ldt=max(fo_ldt),ncdx_ldt=max(ncdx_ldt),mcdx_ldt=max(mcdx_ldt)
into #dt_file from
(select * from #bse
union
select * from #nse
union 
select * from #fo
union 
select * from #ncdx
union 
select * from #mcdx
)a group by cltcode
order by cltcode



select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage) 
into #bse_to
from #bse a, (select * from bsedb_ab.dbo.mis_to where company='ABLCM') b 
where b.sauda_Date >= a.bse_ldt-@lastnod and b.sauda_Date <= a.bse_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code
group by b.party_Code

select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage) 
into #nse_to
from #nse a, (select * from bsedb_ab.dbo.mis_to where company='ACDLCM') b 
where b.sauda_Date >= a.nse_ldt-@lastnod and b.sauda_Date <= a.nse_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code
group by b.party_Code

select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage) 
into #fo_to
from #fo a, (select * from bsedb_ab.dbo.mis_to where company='ACDLFO') b 
where b.sauda_Date >= a.fo_ldt-@lastnod and b.sauda_Date <= a.fo_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code
group by b.party_Code


select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage) 
into #ncdx_to
from #NCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLNCDEX') b 
where b.sauda_Date >= a.ncdx_ldt-@lastnod and b.sauda_Date <= a.ncdx_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code
group by b.party_Code


select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage) 
into #mcdx_to
from #mCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLMCX') b 
where b.sauda_Date >= a.mcdx_ldt-@lastnod and b.sauda_Date <= a.mcdx_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code
group by b.party_Code


select party_Code,bse_to=max(bse_To),bse_br=max(bse_br),nse_to=max(nse_To),nse_br=max(nse_br),
fo_to=max(fo_To),fo_br=max(fo_br),ncdx_to=max(ncdx_To),ncdx_br=max(ncdx_br),
mcdx_to=max(mcdx_To),mcdx_br=max(mcdx_br)
into #TO_BR 
from 
(
select party_Code,bse_TO=turnover,BSE_BR=brokerage,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #bse_to
union
select party_Code,BSE_TO=0,BSE_BR=0,Nse_TO=turnover,NSE_BR=brokerage,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #Nse_to
union
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=turnover,FO_BR=brokerage,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #FO_to
union
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,NCDX_TO=turnover,FO_TO=0,FO_BR=0,NCDX_BR=brokerage,MCDX_TO=0,MCDX_BR=0 from #ncdx_to
union
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=turnover,MCDX_BR=brokerage from #mcdx_to
) a 
group by party_Code

insert into client_performance_hist select * from client_performance 

truncate table client_performance 
insert into client_performance 
select Tdate=getdate(),* from #dt_file a, #to_br b where a.cltcode collate Latin1_General_CI_AS =b.party_Code

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.client_performance_check_dt
-- --------------------------------------------------
CREATE procedure client_performance_check_dt(@lastnod as int)  
as  
set nocount on  
  
select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',
bse_sdt=max(activefrom),nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '
into #bse from intranet.risk.dbo.abl_ledger a,INTRANET.RISK.DBO.bse_client5 b 
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180  

select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',
bse_sdt=' ',nse_sdt=max(activefrom),fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' ' 
into #nse from intranet.risk.dbo.nse_ledger a,INTRANET.RISK.DBO.nse_client5 b 
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180  

select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ',
bse_sdt=' ',nse_sdt=' ',fo_sdt=max(activefrom),ncdx_sdt=' ',mcdx_sdt=' '  
into #fo from intranet.risk.dbo.fo_ledger a,INTRANET.RISK.DBO.fo_client5 b 
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180  

select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ',
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=max(activefrom),mcdx_sdt=' '  
into #ncdx from intranet.risk.dbo.ncdx_ledger a,INTRANET.RISK.DBO.ncdx_client5 b 
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180  

select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt),
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=max(activefrom)   
into #mcdx from intranet.risk.dbo.mcdx_ledger a,INTRANET.RISK.DBO.mcdx_client5 b 
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180  
  
  
select cltcode,bse_ldt=max(bse_ldt),nse_ldt=max(nse_ldt),fo_ldt=max(fo_ldt),ncdx_ldt=max(ncdx_ldt),mcdx_ldt=max(mcdx_ldt),
bse_sdt=max(bse_sdt),nse_sdt=max(nse_sdt),fo_sdt=max(fo_sdt),ncdx_sdt=max(ncdx_sdt),mcdx_sdt=max(mcdx_sdt)    
into #dt_file from  
(select * from #bse  
union  
select * from #nse  
union   
select * from #fo  
union   
select * from #ncdx  
union   
select * from #mcdx  
)a group by cltcode  
order by cltcode  
  
  
  
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)   
into #bse_to  
from #bse a, (select * from bsedb_ab.dbo.mis_to where company='ABLCM') b   
where b.sauda_Date >= a.bse_ldt-@lastnod and b.sauda_Date >= a.bse_sdt  
and b.sauda_Date <= a.bse_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code  
group by b.party_Code  
  
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)   
into #nse_to  
from #nse a, (select * from bsedb_ab.dbo.mis_to where company='ACDLCM') b   
where b.sauda_Date >= a.nse_ldt-@lastnod and b.sauda_Date >= a.nse_sdt  
and b.sauda_Date <= a.nse_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code  
group by b.party_Code  
  
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)   
into #fo_to  
from #fo a, (select * from bsedb_ab.dbo.mis_to where company='ACDLFO') b   
where b.sauda_Date >= a.fo_ldt-@lastnod and b.sauda_Date >= a.fo_sdt  
and b.sauda_Date <= a.fo_ldt  
and a.cltcode collate Latin1_General_CI_AS =b.party_Code  
group by b.party_Code  
  
  
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)   
into #ncdx_to  
from #NCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLNCDEX') b   
where b.sauda_Date >= a.ncdx_ldt-@lastnod and b.sauda_Date >= a.ncdx_sdt  
and b.sauda_Date <= a.ncdx_ldt  
and a.cltcode collate Latin1_General_CI_AS =b.party_Code  
group by b.party_Code  
  
  
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)   
into #mcdx_to  
from #mCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLMCX') b   
where b.sauda_Date >= a.mcdx_ldt-@lastnod and b.sauda_Date >= a.mcdx_sdt  
and b.sauda_Date <= a.mcdx_ldt
and a.cltcode collate Latin1_General_CI_AS =b.party_Code  
group by b.party_Code  
  
  
select party_Code,bse_to=max(bse_To),bse_br=max(bse_br),nse_to=max(nse_To),nse_br=max(nse_br),  
fo_to=max(fo_To),fo_br=max(fo_br),ncdx_to=max(ncdx_To),ncdx_br=max(ncdx_br),  
mcdx_to=max(mcdx_To),mcdx_br=max(mcdx_br)  
into #TO_BR   
from   
(  
select party_Code,bse_TO=turnover,BSE_BR=brokerage,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #bse_to  
union  
select party_Code,BSE_TO=0,BSE_BR=0,Nse_TO=turnover,NSE_BR=brokerage,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #Nse_to  
union  
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=turnover,FO_BR=brokerage,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #FO_to  
union  
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,NCDX_TO=turnover,FO_TO=0,FO_BR=0,NCDX_BR=brokerage,MCDX_TO=0,MCDX_BR=0 from #ncdx_to  
union  
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=turnover,MCDX_BR=brokerage from #mcdx_to  
) a   
group by party_Code  
  
insert into client_performance_hist1 select * from client_performance   
  
truncate table client_performance   
insert into client_performance   
select Tdate=getdate(),* from #dt_file a, #to_br b where a.cltcode collate Latin1_General_CI_AS =b.party_Code  
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.client_performance_check_new
-- --------------------------------------------------
CREATE procedure client_performance_check_new  
as    
set nocount on    
    
select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ' into #bse from intranet.risk.dbo.abl_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180    
select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ' into #nse from intranet.risk.dbo.nse_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180    
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ' into #fo from intranet.risk.dbo.fo_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180    
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ' into #ncdx from intranet.risk.dbo.ncdx_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180    
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt) into #mcdx from intranet.risk.dbo.mcdx_ledger where vtyp=15 group by cltcode --having max(vdt) < getdate()-180    
    
    
select cltcode,bse_ldt=max(bse_ldt),nse_ldt=max(nse_ldt),fo_ldt=max(fo_ldt),ncdx_ldt=max(ncdx_ldt),mcdx_ldt=max(mcdx_ldt)    
into #dt_file from    
(select * from #bse    
union    
select * from #nse    
union     
select * from #fo    
union     
select * from #ncdx    
union     
select * from #mcdx    
)a group by cltcode    
order by cltcode    
    
    
    
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)     
into #bse_to    
from #bse a, (select * from bsedb_ab.dbo.mis_to where company='ABLCM') b     
where b.sauda_Date >= a.bse_ldt and b.sauda_Date <= a.bse_ldt    
and a.cltcode collate Latin1_General_CI_AS =b.party_Code    
group by b.party_Code    
    
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)     
into #nse_to    
from #nse a, (select * from bsedb_ab.dbo.mis_to where company='ACDLCM') b     
where b.sauda_Date >= a.nse_ldt and b.sauda_Date <= a.nse_ldt    
and a.cltcode collate Latin1_General_CI_AS =b.party_Code    
group by b.party_Code    
    
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)     
into #fo_to    
from #fo a, (select * from bsedb_ab.dbo.mis_to where company='ACDLFO') b     
where b.sauda_Date >= a.fo_ldt and b.sauda_Date <= a.fo_ldt    
and a.cltcode collate Latin1_General_CI_AS =b.party_Code    
group by b.party_Code    
    
    
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)     
into #ncdx_to    
from #NCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLNCDEX') b     
where b.sauda_Date >= a.ncdx_ldt and b.sauda_Date <= a.ncdx_ldt    
and a.cltcode collate Latin1_General_CI_AS =b.party_Code    
group by b.party_Code    
    
    
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)     
into #mcdx_to    
from #mCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLMCX') b     
where b.sauda_Date >= a.mcdx_ldt and b.sauda_Date <= a.mcdx_ldt    
and a.cltcode collate Latin1_General_CI_AS =b.party_Code    
group by b.party_Code    
    
    
select party_Code,bse_to=max(bse_To),bse_br=max(bse_br),nse_to=max(nse_To),nse_br=max(nse_br),    
fo_to=max(fo_To),fo_br=max(fo_br),ncdx_to=max(ncdx_To),ncdx_br=max(ncdx_br),    
mcdx_to=max(mcdx_To),mcdx_br=max(mcdx_br)    
into #TO_BR     
from     
(    
select party_Code,bse_TO=turnover,BSE_BR=brokerage,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #bse_to    
union    
select party_Code,BSE_TO=0,BSE_BR=0,Nse_TO=turnover,NSE_BR=brokerage,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #Nse_to    
union    
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=turnover,FO_BR=brokerage,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #FO_to    
union    
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,NCDX_TO=turnover,FO_TO=0,FO_BR=0,NCDX_BR=brokerage,MCDX_TO=0,MCDX_BR=0 from #ncdx_to    
union    
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=turnover,MCDX_BR=brokerage from #mcdx_to    
) a     
group by party_Code    
    
--insert into client_performance_hist1 select * from client_performance     
    
truncate table client_performance     
insert into client_performance     
select Tdate=getdate(),* from #dt_file a, #to_br b where a.cltcode collate Latin1_General_CI_AS =b.party_Code    
    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.client_performance_check_new_sum
-- --------------------------------------------------



CREATE procedure client_performance_check_new_sum    
as        
set nocount on        
set transaction isolation level read uncommitted    

/*
--- GEt BSE Last Transaction Date        
select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=max(activefrom),nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '      
into #bse from intranet.risk.dbo.abl_ledger a,INTRANET.RISK.DBO.bse_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt NSE Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=max(activefrom),fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '       
into #nse from intranet.risk.dbo.nse_ledger a,INTRANET.RISK.DBO.nse_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt FO Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=max(activefrom),ncdx_sdt=' ',mcdx_sdt=' '        
into #fo from intranet.risk.dbo.fo_ledger a,INTRANET.RISK.DBO.fo_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        
      
--- GEt NCDEX Last Transaction Date
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=max(activefrom),mcdx_sdt=' '        
into #ncdx from intranet.risk.dbo.ncdx_ledger a,INTRANET.RISK.DBO.ncdx_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt MCX Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt),      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=max(activefrom)         
into #mcdx from intranet.risk.dbo.mcdx_ledger a,INTRANET.RISK.DBO.mcdx_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        
*/        


select company,cl_code=party_code,activefrom=min(sauda_date) into #misto 
from bsedb_Ab.dbo.mis_To  group by company,party_code


--- GEt BSE Last Transaction Date        
select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=min(activefrom),nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '      
into #bse from intranet.risk.dbo.abl_ledger a, (select * from #misto where company='ABLCM') b       
where a.cltcode collate Latin1_General_CI_AS =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt NSE Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=max(activefrom),fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '       
into #nse from intranet.risk.dbo.nse_ledger a, (select * from #misto where company='ACDLCM') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt FO Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=max(activefrom),ncdx_sdt=' ',mcdx_sdt=' '        
into #fo from intranet.risk.dbo.fo_ledger a,(select * from #misto where company='ACDLFO') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        
      
--- GEt NCDEX Last Transaction Date
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=max(activefrom),mcdx_sdt=' '        
into #ncdx from intranet.risk.dbo.ncdx_ledger a, (select * from #misto where company='ACPLNCDEX') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt MCX Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt),      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=max(activefrom)         
into #mcdx from intranet.risk.dbo.mcdx_ledger a,(select * from #misto where company='ACPLMCX') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        


---------- Delete Officially Closed Account    

-- Delete BSE Officially Closed Account    

delete from #bse where cltcode in    
(select c2.party_code from intranet.risk.dbo.bse_client5 c5, intranet.risk.dbo.bse_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    
    
-- Delete NSE Officially Closed Account    
    
delete from #nse where cltcode in    
(select c2.party_code from intranet.risk.dbo.nse_client5 c5, intranet.risk.dbo.nse_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    
    
-- Delete FO Officially Closed Account    

delete from #fo where cltcode in    
(select c2.party_code from intranet.risk.dbo.fo_client5 c5, intranet.risk.dbo.fo_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    

-- Delete MCX Officially Closed Account    
    
delete from #mcdx where cltcode in    
(select c2.party_code from intranet.risk.dbo.mcdx_client5 c5, intranet.risk.dbo.mcdx_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    

-- Delete NCDEX Officially Closed Account    
    
delete from #ncdx where cltcode in    
(select c2.party_code from intranet.risk.dbo.ncdx_client5 c5, intranet.risk.dbo.ncdx_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    
    
-------------------------------------------    
        
select cltcode,bse_ldt=max(bse_ldt),nse_ldt=max(nse_ldt),fo_ldt=max(fo_ldt),ncdx_ldt=max(ncdx_ldt),mcdx_ldt=max(mcdx_ldt),      
bse_sdt=max(bse_sdt),nse_sdt=max(nse_sdt),fo_sdt=max(fo_sdt),ncdx_sdt=max(ncdx_sdt),mcdx_sdt=max(mcdx_sdt)          
into #dt_file from        
(select * from #bse        
union        
select * from #nse        
union         
select * from #fo        
union         
select * from #ncdx        
union         
select * from #mcdx        
)a group by cltcode        
order by cltcode        
        
        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #bse_to        
from #bse a, (select * from bsedb_ab.dbo.mis_to where company='ABLCM') b         
where     
--b.sauda_Date >= a.bse_ldt-@lastnod and b.sauda_Date >= a.bse_sdt and       
b.sauda_Date <= a.bse_ldt      
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #nse_to        
from #nse a, (select * from bsedb_ab.dbo.mis_to where company='ACDLCM') b         
where     
--b.sauda_Date >= a.nse_ldt-@lastnod and b.sauda_Date >= a.nse_sdt    and    
b.sauda_Date <= a.nse_ldt      
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #fo_to        
from #fo a, (select * from bsedb_ab.dbo.mis_to where company='ACDLFO') b         
where     
--b.sauda_Date >= a.fo_ldt-@lastnod and b.sauda_Date >= a.fo_sdt   and     
 b.sauda_Date <= a.fo_ldt        
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #ncdx_to        
from #NCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLNCDEX') b         
where     
---b.sauda_Date >= a.ncdx_ldt-@lastnod and b.sauda_Date >= a.ncdx_sdt    and    
 b.sauda_Date <= a.ncdx_ldt        
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #mcdx_to        
from #mCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLMCX') b         
where     
---b.sauda_Date >= a.mcdx_ldt-@lastnod and b.sauda_Date >= a.mcdx_sdt    and    
 b.sauda_Date <= a.mcdx_ldt      
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
        
select party_Code,bse_to=max(bse_To),bse_br=max(bse_br),nse_to=max(nse_To),nse_br=max(nse_br),        
fo_to=max(fo_To),fo_br=max(fo_br),ncdx_to=max(ncdx_To),ncdx_br=max(ncdx_br),        
mcdx_to=max(mcdx_To),mcdx_br=max(mcdx_br)        
into #TO_BR         
from         
(        
select party_Code,bse_TO=turnover,BSE_BR=brokerage,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #bse_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,Nse_TO=turnover,NSE_BR=brokerage,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #Nse_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=turnover,FO_BR=brokerage,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #FO_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,NCDX_TO=turnover,FO_TO=0,FO_BR=0,NCDX_BR=brokerage,MCDX_TO=0,MCDX_BR=0 from #ncdx_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=turnover,MCDX_BR=brokerage from #mcdx_to        
) a         
group by party_Code        
        
insert into client_performance_hist_sum select * from client_performance1         
 --select * into client_performance_hist_sum from client_performance1       
truncate table client_performance1         
insert into client_performance1         
select Tdate=getdate(),*,getdate(),getdate() from #dt_file a, #to_br b where a.cltcode collate Latin1_General_CI_AS =b.party_Code        
    
--exec sp_get_ldt_sdt    
  
EXEC GENERATE_SUMMARY1    
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.client_performance_check_new1
-- --------------------------------------------------
CREATE procedure client_performance_check_new1    
as        
set nocount on        
set transaction isolation level read uncommitted    

/*
--- GEt BSE Last Transaction Date        
select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=max(activefrom),nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '      
into #bse from intranet.risk.dbo.abl_ledger a,INTRANET.RISK.DBO.bse_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt NSE Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=max(activefrom),fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '       
into #nse from intranet.risk.dbo.nse_ledger a,INTRANET.RISK.DBO.nse_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt FO Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=max(activefrom),ncdx_sdt=' ',mcdx_sdt=' '        
into #fo from intranet.risk.dbo.fo_ledger a,INTRANET.RISK.DBO.fo_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        
      
--- GEt NCDEX Last Transaction Date
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=max(activefrom),mcdx_sdt=' '        
into #ncdx from intranet.risk.dbo.ncdx_ledger a,INTRANET.RISK.DBO.ncdx_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt MCX Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt),      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=max(activefrom)         
into #mcdx from intranet.risk.dbo.mcdx_ledger a,INTRANET.RISK.DBO.mcdx_client5 b       
where a.cltcode=b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        
*/        


select company,cl_code=party_code,activefrom=min(sauda_date) into #misto 
from bsedb_Ab.dbo.mis_To  group by company,party_code


--- GEt BSE Last Transaction Date        
select cltcode,bse_ldt=max(vdt),nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=min(activefrom),nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '      
into #bse from intranet.risk.dbo.abl_ledger a, (select * from #misto where company='ABLCM') b       
where a.cltcode collate Latin1_General_CI_AS =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt NSE Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=max(vdt),fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=max(activefrom),fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=' '       
into #nse from intranet.risk.dbo.nse_ledger a, (select * from #misto where company='ACDLCM') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt FO Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=max(vdt),ncdx_ldt=' ',mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=max(activefrom),ncdx_sdt=' ',mcdx_sdt=' '        
into #fo from intranet.risk.dbo.fo_ledger a,(select * from #misto where company='ACDLFO') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        
      
--- GEt NCDEX Last Transaction Date
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=max(vdt),mcdx_ldt=' ',      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=max(activefrom),mcdx_sdt=' '        
into #ncdx from intranet.risk.dbo.ncdx_ledger a, (select * from #misto where company='ACPLNCDEX') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        

--- GEt MCX Last Transaction Date      
select cltcode,bse_ldt=' ',nse_ldt=' ',fo_ldt=' ',ncdx_ldt=' ',mcdx_ldt=max(vdt),      
bse_sdt=' ',nse_sdt=' ',fo_sdt=' ',ncdx_sdt=' ',mcdx_sdt=max(activefrom)         
into #mcdx from intranet.risk.dbo.mcdx_ledger a,(select * from #misto where company='ACPLMCX') b       
where a.cltcode collate Latin1_General_CI_AS  =b.cl_code AND vtyp=15 group by cltcode --having max(vdt) < getdate()-180        


---------- Delete Officially Closed Account    

-- Delete BSE Officially Closed Account    

delete from #bse where cltcode in    
(select c2.party_code from intranet.risk.dbo.bse_client5 c5, intranet.risk.dbo.bse_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    
    
-- Delete NSE Officially Closed Account    
    
delete from #nse where cltcode in    
(select c2.party_code from intranet.risk.dbo.nse_client5 c5, intranet.risk.dbo.nse_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    
    
-- Delete FO Officially Closed Account    

delete from #fo where cltcode in    
(select c2.party_code from intranet.risk.dbo.fo_client5 c5, intranet.risk.dbo.fo_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    

-- Delete MCX Officially Closed Account    
    
delete from #mcdx where cltcode in    
(select c2.party_code from intranet.risk.dbo.mcdx_client5 c5, intranet.risk.dbo.mcdx_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    

-- Delete NCDEX Officially Closed Account    
    
delete from #ncdx where cltcode in    
(select c2.party_code from intranet.risk.dbo.ncdx_client5 c5, intranet.risk.dbo.ncdx_client2 c2     
where c2.cl_code=c5.cl_code and inactivefrom < getdate())    
    
-------------------------------------------    
        
select cltcode,bse_ldt=max(bse_ldt),nse_ldt=max(nse_ldt),fo_ldt=max(fo_ldt),ncdx_ldt=max(ncdx_ldt),mcdx_ldt=max(mcdx_ldt),      
bse_sdt=max(bse_sdt),nse_sdt=max(nse_sdt),fo_sdt=max(fo_sdt),ncdx_sdt=max(ncdx_sdt),mcdx_sdt=max(mcdx_sdt)          
into #dt_file from        
(select * from #bse        
union        
select * from #nse        
union         
select * from #fo        
union         
select * from #ncdx        
union         
select * from #mcdx        
)a group by cltcode        
order by cltcode        
        
        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #bse_to        
from #bse a, (select * from bsedb_ab.dbo.mis_to where company='ABLCM') b         
where     
--b.sauda_Date >= a.bse_ldt-@lastnod and b.sauda_Date >= a.bse_sdt and       
b.sauda_Date <= a.bse_ldt      
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #nse_to        
from #nse a, (select * from bsedb_ab.dbo.mis_to where company='ACDLCM') b         
where     
--b.sauda_Date >= a.nse_ldt-@lastnod and b.sauda_Date >= a.nse_sdt    and    
b.sauda_Date <= a.nse_ldt      
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #fo_to        
from #fo a, (select * from bsedb_ab.dbo.mis_to where company='ACDLFO') b         
where     
--b.sauda_Date >= a.fo_ldt-@lastnod and b.sauda_Date >= a.fo_sdt   and     
 b.sauda_Date <= a.fo_ldt        
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #ncdx_to        
from #NCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLNCDEX') b         
where     
---b.sauda_Date >= a.ncdx_ldt-@lastnod and b.sauda_Date >= a.ncdx_sdt    and    
 b.sauda_Date <= a.ncdx_ldt        
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
        
select b.party_code,turnover=sum(turnover),brokerage=sum(brokerage)         
into #mcdx_to        
from #mCDX a, (select * from bsedb_ab.dbo.mis_to where company='ACPLMCX') b         
where     
---b.sauda_Date >= a.mcdx_ldt-@lastnod and b.sauda_Date >= a.mcdx_sdt    and    
 b.sauda_Date <= a.mcdx_ldt      
and a.cltcode collate Latin1_General_CI_AS =b.party_Code        
group by b.party_Code        
        
        
select party_Code,bse_to=max(bse_To),bse_br=max(bse_br),nse_to=max(nse_To),nse_br=max(nse_br),        
fo_to=max(fo_To),fo_br=max(fo_br),ncdx_to=max(ncdx_To),ncdx_br=max(ncdx_br),        
mcdx_to=max(mcdx_To),mcdx_br=max(mcdx_br)        
into #TO_BR         
from         
(        
select party_Code,bse_TO=turnover,BSE_BR=brokerage,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #bse_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,Nse_TO=turnover,NSE_BR=brokerage,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #Nse_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=turnover,FO_BR=brokerage,NCDX_TO=0,NCDX_BR=0,MCDX_TO=0,MCDX_BR=0 from #FO_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,NCDX_TO=turnover,FO_TO=0,FO_BR=0,NCDX_BR=brokerage,MCDX_TO=0,MCDX_BR=0 from #ncdx_to        
union        
select party_Code,BSE_TO=0,BSE_BR=0,NSE_TO=0,NSE_BR=0,FO_TO=0,FO_BR=0,NCDX_TO=0,NCDX_BR=0,MCDX_TO=turnover,MCDX_BR=brokerage from #mcdx_to        
) a         
group by party_Code        
        
insert into client_performance_hist1 select * from client_performance         
        
truncate table client_performance         
insert into client_performance         
select Tdate=getdate(),*,getdate(),getdate() from #dt_file a, #to_br b where a.cltcode collate Latin1_General_CI_AS =b.party_Code        
    
exec sp_get_ldt_sdt    
  
EXEC GENERATE_SUMMARY    
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.copy_get_CliCharges
-- --------------------------------------------------

CREATE procedure copy_get_CliCharges(@tdate as varchar(11),@accesscode as varchar(10),@ExNOD as int,@reptype as varchar(1),@sbtype as varchar(3) )            
as            
set nocount on            
set transaction isolation level read uncommitted            
select Branch_cd,Sub_Broker,party_Code,Long_name,First_Active_date,Last_inactive_date,comb_last_date ,           
BSECM=convert(money,0),            
NSECM=convert(money,0),            
BSEFO=convert(money,0),            
NSEFO=convert(money,0),            
MCX=convert(money,0),            
NCDEX=convert(money,0),            
BSECM_YN='N',            
NSECM_YN='N',            
BSEFO_YN='N',            
NSEFO_YN='N',            
MCX_YN='N',            
NCDEX_YN='N',            
B2C='N'  
into #file1            
from risk.dbo.client_Details where First_Active_date>=@tdate+' 00:00' and First_Active_date< getdate()-@ExNOD        
and Branch_cd like @accesscode          
            
            
update #file1 set bsecm=b.balance from            
(            
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)            
from risk.dbo.abl_ledger (nolock)             
where             
--cltcode not in (select cltcode from abl_ledger where vtyp=15) and             
cltcode in (select party_Code from #file1)            
group by cltcode            
) b where #file1.party_Code=b.cltcode            
            
            
update #file1 set bsecm_YN='Y' where party_Code in     
--(select cltcode from risk.dbo.abl_ledger (nolock)  where vtyp=15)            
(    
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)    
where BSECM_FirstTradeDate > 'Jan  1 1900'    
)    
    
            
update #file1 set nsecm=b.balance from            
(            
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)            
from risk.dbo.nse_ledger (nolock)             
where cltcode in (select party_Code from #file1)            
group by cltcode            
) b where #file1.party_Code=b.cltcode            
            
update #file1 set Nsecm_YN='Y' where party_Code in     
--(select cltcode from risk.dbo.NSE_ledger (nolock) where vtyp=15)            
(    
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)    
where NSECM_FirstTradeDate > 'Jan  1 1900'    
)    
    
            
update #file1 set nsefo=b.balance from            
(            
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)            
from risk.dbo.fo_ledger (nolock)             
where cltcode in (select party_Code from #file1)            
group by cltcode            
) b where #file1.party_Code=b.cltcode            
            
update #file1 set Nsefo_YN='Y' where party_Code in     
--(select cltcode from risk.dbo.fo_ledger (nolock) where vtyp=15)            
(select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)    
where NSEFO_FirstTradeDate > 'Jan  1 1900'    
)    
    
            
update #file1 set mcx=b.balance from            
(            
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)            
from risk.dbo.mcdx_ledger (nolock)             
where cltcode in (select party_Code from #file1)            
group by cltcode            
) b where #file1.party_Code=b.cltcode            
            
update #file1 set mcx_YN='Y' where party_Code in     
--(select cltcode from risk.dbo.mcdx_ledger (nolock) where vtyp=15)            
(    
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)    
where MCX_FirstTradeDate > 'Jan  1 1900'    
)    
    
            
update #file1 set ncdex=b.balance from            
(            
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)            
from risk.dbo.ncdx_ledger (nolock)             
where cltcode in (select party_Code from #file1)            
group by cltcode            
) b where #file1.party_Code=b.cltcode            
            
update #file1 set ncdex_YN='Y' where party_Code in     
--(select cltcode from risk.dbo.ncdx_ledger (nolock) where vtyp=15)            
(    
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)    
where NCDEX_FirstTradeDate > 'Jan  1 1900'    
)    
  
  
update #file1 set B2C='Y' where sub_broker in (select b2c_Sb from mis.remisior.dbo.b2c_sb)    
  
           
if @sbtype='B2B'     
Begin            
 delete from #file1 where B2C='Y'  
end    
    
if @sbtype='B2C'     
Begin            
 delete from #file1 where B2C='N'  
-- delete from #file1 where sub_broker not in (select b2c_Sb from mis.remisior.dbo.b2c_sb)    
end    
       
    
if @reptype='A'     
Begin            
 select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1            
 where             
 (            
 (bsecm_yn ='N' and bsecm > 0) or            
 (nsecm_yn ='N' and nsecm > 0) or            
 (bsefo_yn ='N' and bsefo > 0) or            
 (nsefo_yn ='N' and nsefo > 0) or            
 (mcx_yn ='N' and mcx > 0) or            
 (ncdex_yn ='N' and ncdex > 0)             
 )            
END    
    
if @reptype='T'     
Begin            
 select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1            
 where             
 (            
 (bsecm_yn ='N' and bsecm > 0) or            
 (nsecm_yn ='N' and nsecm > 0) or            
 (bsefo_yn ='N' and bsefo > 0) or            
 (nsefo_yn ='N' and nsefo > 0) or            
 (mcx_yn ='N' and mcx > 0) or            
 (ncdex_yn ='N' and ncdex > 0)             
 )        
 and (bsecm_yn='Y' or nsecm_yn ='Y' or bsefo_yn ='Y' or nsefo_yn ='Y' or mcx_yn ='Y' or ncdex_yn ='Y')         
END    
    
if @reptype='N'     
Begin            
 select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1            
 where             
 (            
 (bsecm_yn ='N' and bsecm > 0) or            
 (nsecm_yn ='N' and nsecm > 0) or            
 (bsefo_yn ='N' and bsefo > 0) or            
 (nsefo_yn ='N' and nsefo > 0) or            
 (mcx_yn ='N' and mcx > 0) or            
 (ncdex_yn ='N' and ncdex > 0)             
 )        
 and (bsecm_yn='N' and nsecm_yn ='N' and bsefo_yn ='N' and nsefo_yn ='N' and mcx_yn ='N' and ncdex_yn ='N')         
END    
    
--and BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX > 0            
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CTCLBranch1
-- --------------------------------------------------
CREATE procedure CTCLBranch1( @Branch varchar(50) )           
AS          
set nocount on          
declare @separator_position int         
declare @array_value varchar(1000)        
DECLARE @separator char(1)      
DECLARE @Array VARCHAR(1000)      
--DECLARE @USER VARCHAR(8)      
SET @separator =','      
--SET @USER='USER'      
-- SELECT @ARRAY=UM_BRCODE FROM DPBackOffice.AcerCross.dbo.USER_MASTER WHERE UM_USER_ID=@USER      
Select @ARRAY=BSECM from ctcl_boltno where Branch = @Branch  
  
set @array = @array + @separator          
   delete from CTCLBSEBranch where  Branch=@Branch          
while patindex('%' + @separator + '%' , @array) <> 0           
begin          
  select @separator_position =  patindex('%' + @separator + '%' , @array)          
  select @array_value = left(@array, @separator_position - 1)          
   if len(@array_value)=3          
     insert into CTCLBSEBranch values (@Branch,@array_value)          
     select @array = stuff(@array, 1, @separator_position, '')          
end          
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.ctclLocation_newFolder
-- --------------------------------------------------
CREATE procedure [dbo].[ctclLocation_newFolder] (@locacode as varchar(10))
as   
   
	declare @strF as varchar(200),@strT as varchar(200),@strK as varchar(200)  
	set @strF='exec xp_cmdshell ''MD  \\INHOUSEALLAPP-FS.angelone.in\D$\upload\limit\'+@locacode+''', NO_OUTPUT'       
	exec (@strF)       
	set @strT='exec xp_cmdshell ''MD  \\196.1.115.173\D$\upload\limit\'+@locacode+''', NO_OUTPUT'
	exec (@strT)
	set @strK='exec xp_cmdshell ''MD  \\INHOUSELIVEAPP2-FS.angelone.in\D$\upload\limit\'+@locacode+''', NO_OUTPUT'
	exec (@strK)

	Declare @cmd varchar(300), @cmd83 varchar(500), @cmd36 varchar(500), @cmd73 varchar(500)
	/*Set @cmd = '"del d:\upload\limit\'+@locacode+'\*.txt"'
	set @cmd=@cmd + '"ren d:\upload\limit\'+@locacode+'\*.zip *.bak"'
	*/
	Set @cmd = '"del I:\upload\limit\'+@locacode+'\*.txt"'
	set @cmd=@cmd + '"ren I:\upload\limit\'+@locacode+'\*.zip *.bak"'

	Select @cmd83 = 'echo ' + @cmd + ' > \\INHOUSELIVEAPP2-FS.angelone.in\D$\upload\limit\'+@locacode+'\del.bat'
	EXEC master..xp_cmdshell @cmd83,'No_output'

	Select @cmd36 = 'echo ' + @cmd + ' > \\INHOUSEALLAPP-FS.angelone.in\D$\upload\limit\'+@locacode+'\del.bat'
	EXEC master..xp_cmdshell @cmd36,'No_output'

	Select @cmd73 = 'echo ' + @cmd + ' > \\196.1.115.173\D$\upload\limit\'+@locacode+'\del.bat'
	EXEC master..xp_cmdshell @cmd73,'No_output'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CTCLSurveillanceinfo
-- --------------------------------------------------
CREATE procedure CTCLSurveillanceinfo(@days as int, @fromdate as varchar(10),@ToDate as varchar(10))      
as      
      
set nocount on      
      
select b.location,No_of_Inactive_Clients=count(a.party_code),last_updated=convert(varchar(11),max(last_updated))       
into #file1      
from       
(select party_Code from risk.dbo.client_details  (nolock) where comb_last_date < GETDATE()-@days) a,      
(select distinct location,party_Code,last_updated from CTCL_DTC (nolock)) b      
where a.party_code=b.party_Code      
group by b.location      
      
select * into #filea from testdb.dbo.ctcl_manager_Info where date=@Fromdate      
alter table #filea alter column ctcl_manager varchar(100)      
      
update #filea set ctcl_manager=ctcl_manager+'-'+b.locaName      
from dbo.CtclMgrLocation b (nolock)      
where #filea.ctcl_manager=b.locacode       
      
--select * from #Filea      
      
/*      
select b.locaName,a.*       
into #file2      
from testdb.dbo.ctcl_manager_Info a (nolock),       
dbo.CtclMgrLocation b (nolock)      
where a.ctcl_manager=b.locacode       
--and ModfiedOn >='12/21/2007'+' 00:00:00' and ModfiedOn<='12/21/2007'+' 23:59:59'      
--and convert(datetime,[date]) >=@Fromdate+' 00:00:00' and convert(datetime,[date])<=@toDate+' 23:59:59'      
and date=@Fromdate      
*/      
select a.*,No_of_Inactive_Clients=isnull(b.No_of_Inactive_Clients,0),DTC_last_updated=last_updated from #Filea a left outer join #file1 b       
on b.location=substring(a.ctcl_manager,1,charindex('-',a.ctcl_manager)-1)      
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.CTCLSurveillanceinfo_client
-- --------------------------------------------------
CREATE procedure CTCLSurveillanceinfo_client(@days as int, @fromdate as varchar(10),@loc as varchar(12))  
as  
  
set nocount on  
  
select b.location,branch_cd,sub_broker,a.party_code
--into #file1  
from   
(select branch_cd,sub_broker,party_Code from risk.dbo.client_details  (nolock) where comb_last_date < GETDATE()-@days) a,  
(select distinct location,party_Code from CTCL_DTC (nolock) where location=@loc) b  
where a.party_code=b.party_Code  

-------------------------------Nov 29 2008  
/*select * into #filea from testdb.dbo.ctcl_manager_Info where date=@Fromdate  
alter table #filea alter column ctcl_manager varchar(100)  
  
update #filea set ctcl_manager=ctcl_manager+'-'+b.locaName  
from dbo.CtclMgrLocation b (nolock)  
where #filea.ctcl_manager=b.locacode   
  */  
--select * from #Filea  
-------------------------------before Nov 29 2008  no use of it
/*  
select b.locaName,a.*   
into #file2  
from testdb.dbo.ctcl_manager_Info a (nolock),   
dbo.CtclMgrLocation b (nolock)  
where a.ctcl_manager=b.locacode   
--and ModfiedOn >='12/21/2007'+' 00:00:00' and ModfiedOn<='12/21/2007'+' 23:59:59'  
--and convert(datetime,[date]) >=@Fromdate+' 00:00:00' and convert(datetime,[date])<=@toDate+' 23:59:59'  
and date=@Fromdate  
*/
-------------------------------Nov 29 2008  
/*
select a.*,branch_cd,sub_broker,party_code from #Filea a left outer join #file1 b   
on b.location=substring(a.ctcl_manager,1,charindex('-',a.ctcl_manager)-1)  
*/  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_fo_generate
-- --------------------------------------------------
CREATE procedure dealer_fo_generate(@loca as varchar(25),@tdate as varchar(25))
as

set nocount on
set transaction isolation level read uncommitted

select distinct usercode,group_id into #file1 from testdb.dbo.ODIN_LIMITS where location=@loca
select clientid,dealerid=min(dealerid) into #file2 from mis.dbo.dealer_client where location=@loca group by clientid

select a.*,b.dealerid into #filex
from #file1 a, #file2 b where a.usercode=b.clientid

select party_Code,data=' ,2,A,'+ltrim(rtrim(party_code))+','+ltrim(rtrim(group_id))+','+ltrim(rtrim(dealerid))+','+ltrim(rtrim(Inst_type))+','+Symbol+',XX,'
+REPLACE(convert(varchar(11),Expirydate,113),' ','-')+','+
rtrim(ltrim(str(Strike_price,10,2)))+','+Option_type+','+ case when sum(pqty-sqty) > 0 and upper(substring(inst_type,1,2))='FUT' 
then LTRIM(RTRIM(str(sum(pqty-sqty),10))) +','+LTRIM(RTRIM(str(sum((cmclosing*pqty)-(cmclosing*sqty)),18,2)))+',0,0.00,,' 
when sum(pqty-sqty) <= 0 and upper(substring(inst_type,1,2))='FUT' then '0,0.00,'+LTRIM(RTRIM(str(abs(sum(pqty-sqty)),10))) +','+
LTRIM(RTRIM(str(abs(sum((cmclosing*pqty)-(cmclosing*sqty))),18,2))+',,') when sum(pqty-sqty) > 0 
and upper(substring(inst_type,1,2))<>'FUT' then LTRIM(RTRIM(str(sum(pqty-sqty),10))) +','+LTRIM(RTRIM(str(sum((prate*pqty)-(srate*sqty)),
18,2)))+',0,0.00,,' when sum(pqty-sqty) <= 0 and upper(substring(inst_type,1,2))<>'FUT' then '0,0.00,'+
LTRIM(RTRIM(str(abs(sum(pqty-sqty)),10))) +','+LTRIM(RTRIM(str(abs(sum((prate*pqty)-(srate*sqty))),18,2))+',,') end from 
ANGELFO.NSEFO.DBO.fobillvalan A, #filex c 
WHERE A.PARTY_cODE=c.usercode and sauda_date =@tdate+' 23:59:00' 
group by party_code,group_id,dealerid,inst_type,symbol,expirydate,Strike_price,Option_type
having sum(pqty-sqty) <> 0

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit
-- --------------------------------------------------
CREATE procedure dealer_limit
as      
      
set nocount on      
    
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED    
      
select party_Code INTO #PCODE from risk.dbo.party_label_all    
    
select usercode INTO #UCODE from odin_limits where LOCATION IN ('FORT_AKRUTI','FORT') AND  upper(right(ltrim(rtrim(usercode)),2))='ZZ'       
and isnumeric(substring(replace(upper(ltrim(rtrim(usercode))),'ZZ',''),      
len(replace(upper(ltrim(rtrim(usercode))),'ZZ','')),1)) = 1      
    
select distinct usercode into #code from odin_limits where usercode not in      
(select distinct usercode from odin_limits where group_id is null and usercode <> '-')      
and usercode not in (select party_Code from #PCODE)      
and usercode <> '-'      
and usercode not in  (select usercode from #UCODE )      
    
    
select period=b.perioducity,b.value,a.location,a.usercode,group_id,udatetime,periodicity,max_order_value, max_order_qty,       
GE_limit_in_000s,Net_Purchase_Premium_in_000s,NSE_Write_Limit_in_000s      
INTO #FILE1    
from odin_limits a, periodicity b       
where a.usercode in (select usercode from #code) and a.periodicity=b.Value       
and code is null and symbol is null and sgroup is null       
AND LOCATION IN ('FORT_AKRUTI','FORT')     
    
      
select x.*,y.* from (      
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit       
from location a,       
(      
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit       
from periodicity where dmode = 'checked') c       
) x left outer join #FILE1 y on x.location1=y.location and x.perioducity=y.period   
where LOCATION IN ('FORT_AKRUTI','FORT')    
order by location1,Usercode       
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit_other
-- --------------------------------------------------
CREATE PROCEDURE Dealer_limit_other  
AS  
    SET nocount ON  
    SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED  
  
    SELECT party_Code  
    INTO   #PCODE  
    FROM   risk.dbo.party_label_all  
  
    SELECT usercode  
    INTO   #UCODE  
    FROM   ODIN_LIMITS_NewFormat  
    WHERE  LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )  
           AND Upper(RIGHT(Ltrim(Rtrim(usercode)), 2)) = 'ZZ'  
           AND Isnumeric(Substring(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', ''), Len(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', '')), 1)) = 1  
  
    SELECT DISTINCT usercode  
    INTO   #code  
    FROM   ODIN_LIMITS_NewFormat  
    WHERE  usercode NOT IN (SELECT DISTINCT usercode  
                            FROM   ODIN_LIMITS_NewFormat  
                            WHERE  group_id IS NULL  
                                   AND usercode <> '-')  
           AND usercode NOT IN (SELECT party_Code  
                                FROM   #PCODE)  
           AND usercode <> '-'  
           AND usercode NOT IN (SELECT usercode  
                                FROM   #UCODE)  
  
    SELECT period=b.perioducity,  
           b.value,  
           a.location,  
           a.usercode,  
           group_id,  
           udatetime,  
           periodicity,  
           Gross_Expo_Limit_Multi,  
           Net_Purchase_Limit_Multi  
    --max_order_value,  
    --max_order_qty,  
    --GE_limit_in_000s,  
    --Net_Purchase_Premium_in_000s,  
    --NSE_Write_Limit_in_000s  
    INTO   #FILE1  
    FROM   ODIN_LIMITS_NewFormat a,  
           periodicity b  
    WHERE  a.usercode IN (SELECT usercode  
                          FROM   #code)  
           AND a.periodicity = convert(varchar,b.Value)  
           --AND code IS NULL  
           --AND symbol IS NULL  
           --AND sgroup IS NULL  
           AND LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )  
  
    SELECT x.*,  
           y.*  
    FROM   (SELECT location1=a.location,  
                   c.perioducity,  
                   dge_limit,  
                   dqty_limit,  
                   dvalue_limit,  
                   dwrite_limit,  
                   dpremium_limit  
            FROM   location a,  
                   (SELECT perioducity,  
                           value,  
                           dge_limit,  
                           dqty_limit,  
                           dvalue_limit,  
                           dwrite_limit,  
                           dpremium_limit  
                    FROM   periodicity  
                    WHERE  dmode = 'checked') c) x  
           LEFT OUTER JOIN #FILE1 y  
             ON x.location1 = y.location  
                AND x.perioducity = y.period  
    ORDER  BY location1,  
              Usercode  
  
    SET nocount OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Dealer_limit_other_12022014
-- --------------------------------------------------
CREATE PROCEDURE Dealer_limit_other_12022014
AS
    SET nocount ON
    SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

    SELECT party_Code
    INTO   #PCODE
    FROM   risk.dbo.party_label_all

    SELECT usercode
    INTO   #UCODE
    FROM   odin_limits
    WHERE  LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )
           AND Upper(RIGHT(Ltrim(Rtrim(usercode)), 2)) = 'ZZ'
           AND Isnumeric(Substring(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', ''), Len(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', '')), 1)) = 1

    SELECT DISTINCT usercode
    INTO   #code
    FROM   odin_limits
    WHERE  usercode NOT IN (SELECT DISTINCT usercode
                            FROM   odin_limits
                            WHERE  group_id IS NULL
                                   AND usercode <> '-')
           AND usercode NOT IN (SELECT party_Code
                                FROM   #PCODE)
           AND usercode <> '-'
           AND usercode NOT IN (SELECT usercode
                                FROM   #UCODE)

    SELECT period=b.perioducity,
           b.value,
           a.location,
           a.usercode,
           group_id,
           udatetime,
           periodicity,
           max_order_value,
           max_order_qty,
           GE_limit_in_000s,
           Net_Purchase_Premium_in_000s,
           NSE_Write_Limit_in_000s
    INTO   #FILE1
    FROM   odin_limits a,
           periodicity b
    WHERE  a.usercode IN (SELECT usercode
                          FROM   #code)
           AND a.periodicity = b.Value
           AND code IS NULL
           AND symbol IS NULL
           AND sgroup IS NULL
           AND LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )

    SELECT x.*,
           y.*
    FROM   (SELECT location1=a.location,
                   c.perioducity,
                   dge_limit,
                   dqty_limit,
                   dvalue_limit,
                   dwrite_limit,
                   dpremium_limit
            FROM   location a,
                   (SELECT perioducity,
                           value,
                           dge_limit,
                           dqty_limit,
                           dvalue_limit,
                           dwrite_limit,
                           dpremium_limit
                    FROM   periodicity
                    WHERE  dmode = 'checked') c) x
           LEFT OUTER JOIN #FILE1 y
             ON x.location1 = y.location
                AND x.perioducity = y.period
    ORDER  BY location1,
              Usercode

    SET nocount OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit_other1
-- --------------------------------------------------
CREATE PROCEDURE Dealer_limit_other1  
AS  
    SET nocount ON  
    SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED  
  
    SELECT party_Code  
    INTO   #PCODE  
    FROM   risk.dbo.client_Details (nolock)  
  
    SELECT usercode  
    INTO   #UCODE  
    FROM   ODIN_LIMITS_NewFormat_old (nolock)  
    WHERE  LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )  
           AND Upper(RIGHT(Ltrim(Rtrim(usercode)), 2)) = 'ZZ'  
           AND Isnumeric(Substring(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', ''), Len(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', '')), 1)) = 1  
  
    SELECT DISTINCT usercode  
    INTO   #code  
    FROM   ODIN_LIMITS_NewFormat_old (nolock)  
    WHERE  usercode NOT IN (SELECT DISTINCT usercode  
                            FROM   ODIN_LIMITS_NewFormat_old (nolock)  
                            WHERE  group_id IS NULL  
                                   AND usercode <> '-')  
           AND usercode NOT IN (SELECT party_Code  
                                FROM   #PCODE)  
           AND usercode <> '-'  
           AND usercode NOT IN (SELECT usercode  
                                FROM   #UCODE)  
  
    SELECT period=b.perioducity,  
           b.value,  
           a.location,  
           a.usercode,  
           group_id,  
           udatetime,  
           periodicity,  
           --max_order_value, max_order_qty,  
           Gross_Expo_Limit_Multi,  
           Net_Purchase_Limit_Multi,  
           Net_Premium_Limit_Multi  
    --,NSE_Write_Limit_in_000s                    
    INTO   #FILE1  
    FROM   ODIN_LIMITS_NewFormat_old a (nolock),  
           periodicity b (nolock)  
    WHERE  a.usercode IN (SELECT usercode  
                          FROM   #code)  
           AND a.periodicity = CONVERT(VARCHAR, b.Value)  
           --and code is null and symbol is null and sgroup is null                     
           AND LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )  
  
    SELECT *  
    INTO   #DealerWise_TO  
    FROM   DealerWise_TO WITH (nolock)  
  
    /*        
    Create table #DealerWise_TO        
    (        
    dealer_id varchar(50),        
    weekto money,        
    monthto money        
    )        
            
    insert into #DealerWise_TO        
    select  m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T)) --into #t        
    from         
    mis.dbo.BSE_ord_client_info m with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    insert into #DealerWise_TO        
    select m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T))        
    from         
    mis.dbo.NSE_ord_client_info m with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    insert into #DealerWise_TO        
    select m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T))        
    from         
    mis.dbo.FO_ord_client_info m with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    insert into #DealerWise_TO        
    select m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T))        
    from         
    mis.dbo.MCDX_ord_client_info m with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    insert into #DealerWise_TO        
    select m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T))        
    from         
    mis.dbo.NCDX_ord_client_info m with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    insert into #DealerWise_TO        
    select m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T))        
    from         
    mis.dbo.MCXSX_ord_client_info m with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    insert into #DealerWise_TO        
    select m.dealer_id,        
    weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),        
    monthTO=sum(convert(float,T))        
    from         
    mis.dbo.NSX_ord_client_info m     with (nolock)        
    where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())         
    and m.dealer_id in (select usercode from #FILE1 group by usercode)        
    group by m.dealer_id         
            
    */  
    SELECT X.*,  
           Y.WeekTO / 100000  AS WeekTO,  
           Y.MonthTO / 100000 AS MonthTO  
    INTO   #FILE2  
    FROM   (SELECT *  
            FROM   #FILE1)X  
           INNER JOIN (SELECT dealer_id,  
                              WeekTO=Sum(weekTO),  
                              MonthTO=Sum(monthTO)  
                       FROM   #DealerWise_TO WITH (nolock)  
                       GROUP  BY dealer_id)Y  
             ON X.usercode = Y.dealer_id  
  
    SELECT x.*,  
           y.*  
    FROM   (SELECT location1=a.location,  
                   c.perioducity,  
                   dge_limit,  
                   dqty_limit,  
                   dvalue_limit,  
                   dwrite_limit,  
                   dpremium_limit,  
                   dne_limit  
            FROM   location a (nolock),  
                   (SELECT perioducity,  
                           value,  
                           dge_limit,  
                           dqty_limit,  
                           dvalue_limit,  
                           dwrite_limit,  
                           dpremium_limit,  
                           dne_limit  
                    FROM   periodicity (nolock)  
                    WHERE  dmode = 'checked') c) x  
           LEFT OUTER JOIN #FILE2 y  
             ON x.location1 = y.location  
                AND x.perioducity = y.period  
    WHERE  dge_limit > 0  
           AND dge_limit < CONVERT(MONEY, Replace(Gross_Expo_Limit_Multi, -1, 99999999999))  
    ORDER  BY location1,  
              Usercode  
  
    SET nocount OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit_other1_12022014
-- --------------------------------------------------
CREATE procedure dealer_limit_other1_12022014           
as                  
                  
set nocount on                  
                
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED                
                  
select party_Code INTO #PCODE from risk.dbo.client_Details (nolock)                
                
select usercode INTO #UCODE         
from odin_limits (nolock) where LOCATION NOT IN ('FORT_AKRUTI','FORT') AND  upper(right(ltrim(rtrim(usercode)),2))='ZZ'                   
and isnumeric(substring(replace(upper(ltrim(rtrim(usercode))),'ZZ',''),                  
len(replace(upper(ltrim(rtrim(usercode))),'ZZ','')),1)) = 1                  
                
select distinct usercode into #code from odin_limits (nolock) where usercode not in                  
(select distinct usercode from odin_limits (nolock) where group_id is null and usercode <> '-')                  
and usercode not in (select party_Code from #PCODE)                  
and usercode <> '-'                  
and usercode not in  (select usercode from #UCODE )                  
                
                
select period=b.perioducity,b.value,a.location,a.usercode,group_id,udatetime,periodicity,max_order_value, max_order_qty,                   
NP_limit_in_000s,GE_limit_in_000s,Net_Purchase_Premium_in_000s,NSE_Write_Limit_in_000s                  
INTO #FILE1                
from odin_limits a (nolock) , periodicity b (nolock)                   
where a.usercode in (select usercode from #code) and a.periodicity=b.Value                   
and code is null and symbol is null and sgroup is null                   
AND LOCATION NOT IN ('FORT_AKRUTI','FORT')           
      
select * into #DealerWise_TO  from DealerWise_TO with (nolock)      
      
/*      
Create table #DealerWise_TO      
(      
dealer_id varchar(50),      
weekto money,      
monthto money      
)      
      
insert into #DealerWise_TO      
select  m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T)) --into #t      
from       
mis.dbo.BSE_ord_client_info m with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
insert into #DealerWise_TO      
select m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T))      
from       
mis.dbo.NSE_ord_client_info m with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
insert into #DealerWise_TO      
select m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T))      
from       
mis.dbo.FO_ord_client_info m with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
insert into #DealerWise_TO      
select m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T))      
from       
mis.dbo.MCDX_ord_client_info m with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
insert into #DealerWise_TO      
select m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T))      
from       
mis.dbo.NCDX_ord_client_info m with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
insert into #DealerWise_TO      
select m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T))      
from       
mis.dbo.MCXSX_ord_client_info m with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
insert into #DealerWise_TO      
select m.dealer_id,      
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),      
monthTO=sum(convert(float,T))      
from       
mis.dbo.NSX_ord_client_info m     with (nolock)      
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())       
and m.dealer_id in (select usercode from #FILE1 group by usercode)      
group by m.dealer_id       
      
*/      
      
select X.*,Y.WeekTO/100000 AS WeekTO,Y.MonthTO/100000 AS MonthTO into #FILE2 from       
(select * from #FILE1 )X      
inner join      
(select dealer_id,WeekTO=SUM(weekTO),MonthTO=SUM(monthTO)  from #DealerWise_TO with (nolock)      
group by dealer_id)Y      
on X.usercode=Y.dealer_id      
            
      
select x.*,y.* from (                  
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit,dne_limit                   
from location a (nolock),                   
(                  
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit,dne_limit                   
from periodicity (nolock) where dmode = 'checked') c                   
) x left outer join #FILE2 y on x.location1=y.location and x.perioducity=y.period                   
where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))              
order by location1,Usercode                   
                  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit_other1_15102013
-- --------------------------------------------------
CREATE procedure dealer_limit_other1_15102013         
as                
                
set nocount on                
              
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED              
                
select party_Code INTO #PCODE from risk.dbo.client_Details (nolock)              
              
select usercode INTO #UCODE       
from odin_limits (nolock) where LOCATION NOT IN ('FORT_AKRUTI','FORT') AND  upper(right(ltrim(rtrim(usercode)),2))='ZZ'                 
and isnumeric(substring(replace(upper(ltrim(rtrim(usercode))),'ZZ',''),                
len(replace(upper(ltrim(rtrim(usercode))),'ZZ','')),1)) = 1                
              
select distinct usercode into #code from odin_limits (nolock) where usercode not in                
(select distinct usercode from odin_limits (nolock) where group_id is null and usercode <> '-')                
and usercode not in (select party_Code from #PCODE)                
and usercode <> '-'                
and usercode not in  (select usercode from #UCODE )                
              
              
select period=b.perioducity,b.value,a.location,a.usercode,group_id,udatetime,periodicity,max_order_value, max_order_qty,                 
NP_limit_in_000s,GE_limit_in_000s,Net_Purchase_Premium_in_000s,NSE_Write_Limit_in_000s                
INTO #FILE1              
from odin_limits a (nolock) , periodicity b (nolock)                 
where a.usercode in (select usercode from #code) and a.periodicity=b.Value                 
and code is null and symbol is null and sgroup is null                 
AND LOCATION NOT IN ('FORT_AKRUTI','FORT')         
    
select * into #DealerWise_TO  from DealerWise_TO with (nolock)    
    
/*    
Create table #DealerWise_TO    
(    
dealer_id varchar(50),    
weekto money,    
monthto money    
)    
    
insert into #DealerWise_TO    
select  m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T)) --into #t    
from     
mis.dbo.BSE_ord_client_info m with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
insert into #DealerWise_TO    
select m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T))    
from     
mis.dbo.NSE_ord_client_info m with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
insert into #DealerWise_TO    
select m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T))    
from     
mis.dbo.FO_ord_client_info m with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
insert into #DealerWise_TO    
select m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T))    
from     
mis.dbo.MCDX_ord_client_info m with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
insert into #DealerWise_TO    
select m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T))    
from     
mis.dbo.NCDX_ord_client_info m with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
insert into #DealerWise_TO    
select m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T))    
from     
mis.dbo.MCXSX_ord_client_info m with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
insert into #DealerWise_TO    
select m.dealer_id,    
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),    
monthTO=sum(convert(float,T))    
from     
mis.dbo.NSX_ord_client_info m     with (nolock)    
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())     
and m.dealer_id in (select usercode from #FILE1 group by usercode)    
group by m.dealer_id     
    
*/    
    
select X.*,Y.WeekTO,Y.MonthTO into #FILE2 from     
(select * from #FILE1 )X    
inner join    
(select dealer_id,WeekTO=SUM(weekTO),MonthTO=SUM(monthTO)  from #DealerWise_TO with (nolock)    
group by dealer_id)Y    
on X.usercode=Y.dealer_id    
          
    
select x.*,y.* from (                
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit,dne_limit                 
from location a (nolock),                 
(                
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit,dne_limit                 
from periodicity (nolock) where dmode = 'checked') c                 
) x left outer join #FILE2 y on x.location1=y.location and x.perioducity=y.period                 
where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))            
order by location1,Usercode                 
                
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit1
-- --------------------------------------------------
CREATE procedure dealer_limit1      
as      
      
set nocount on      
    
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED    
      
select party_Code INTO #PCODE from risk.dbo.party_label_all    

select usercode INTO #UCODE from odin_limits where LOCATION IN ('FORT_AKRUTI','FORT') AND upper(right(ltrim(rtrim(usercode)),2))='ZZ'       
and isnumeric(substring(replace(upper(ltrim(rtrim(usercode))),'ZZ',''),      
len(replace(upper(ltrim(rtrim(usercode))),'ZZ','')),1)) = 1      
    
select distinct usercode into #code from odin_limits where usercode not in      
(select distinct usercode from odin_limits where group_id is null and usercode <> '-')      
and usercode not in (select party_Code from #PCODE)      
and usercode <> '-'      
and usercode not in  (select usercode from #UCODE )      
    
    
select period=b.perioducity,b.value,a.location,a.usercode,group_id,udatetime,periodicity,max_order_value, max_order_qty,       
GE_limit_in_000s,Net_Purchase_Premium_in_000s,NSE_Write_Limit_in_000s      
INTO #FILE1    
from odin_limits a, periodicity b       
where a.usercode in (select usercode from #code) and a.periodicity=b.Value       
and code is null and symbol is null and sgroup is null       
AND LOCATION IN ('FORT_AKRUTI','FORT')     
    
      
select x.*,y.* from (      
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit       
from location a,       
(      
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit       
from periodicity where dmode = 'checked') c       
) x left outer join #FILE1 y on x.location1=y.location and x.perioducity=y.period  
where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))  
--and location in ('FORT','FORT_AKRUTI')
order by location1,Usercode       
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit2
-- --------------------------------------------------
CREATE procedure dealer_limit2    
as            
            
set nocount on            
          
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED          
            
select party_Code INTO #PCODE from risk.dbo.party_label_all          
      
select usercode INTO #UCODE from odin_limits where LOCATION IN ('FORT_AKRUTI','FORT') AND upper(right(ltrim(rtrim(usercode)),2))='ZZ'             
and isnumeric(substring(replace(upper(ltrim(rtrim(usercode))),'ZZ',''),            
len(replace(upper(ltrim(rtrim(usercode))),'ZZ','')),1)) = 1            
          
select distinct usercode into #code from odin_limits where usercode not in            
(select distinct usercode from odin_limits where group_id is null and usercode <> '-')            
and usercode not in (select party_Code from #PCODE)            
and usercode <> '-'            
and usercode not in  (select usercode from #UCODE )            
          
          
select period=b.perioducity,b.value,a.location,a.usercode,group_id,udatetime,periodicity,max_order_value, max_order_qty,             
GE_limit_in_000s,Net_Purchase_Premium_in_000s,NSE_Write_Limit_in_000s            
INTO #FILE1a    
from odin_limits a, periodicity b             
where a.usercode in (select usercode from #code) and a.periodicity=b.Value             
and code is null and symbol is null and sgroup is null             
AND LOCATION IN ('FORT_AKRUTI','FORT')           
          
  
  
select *     
into #file1    
from     
(    
  
select a.*,Seg='BSECM' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.bse='Y' and     
a.value in ('80','70','7','60','6','8','170','17') and a.usercode=b.user_id    
  
union    
select a.*,Seg='NSECM' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.nse='Y' and     
a.value in ('10','1','5','50','70','7','80','8','170','17') and a.usercode=b.user_id    
union    
select a.*,Seg='NSEFO' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.nsefo='Y' and     
a.value in ('20','2','30','3','40','4','50','5','80','8','170','17') and a.usercode=b.user_id    
union    
select a.*,seg='MCX' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.mcx='Y' and     
a.value in ('170','17','16','160','90','9') and a.usercode=b.user_id    
union    
select a.*,seg='NCDEX' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.ncdex='Y' and     
a.value in ('170','17','16','160','150','15') and a.usercode=b.user_id    
) a    
    
  
select location,usercode,seg into #file2 from (            
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from location a,             
(            
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from periodicity /*where dmode = 'checked'*/  
) c where a.location in ('FORT','FORT_AKRUTI')         
) x left outer join #FILE1 y on x.location1=y.location and x.perioducity=y.period        
--where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))        
where usercode is not null and convert(money,replace(GE_limit_in_000s,-1,99999999999)) <= dge_limit  
  
  
select x.*,y.* into #file3 from (            
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from location a,             
(            
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from periodicity /*where dmode = 'checked'*/  
) c where a.location in ('FORT','FORT_AKRUTI')         
) x left outer join #FILE1 y on x.location1=y.location and x.perioducity=y.period        
--where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))        
where usercode is not null and convert(money,replace(GE_limit_in_000s,-1,99999999999)) > dge_limit  
  
select a.* from #file3 a left outer join #file2 b on a.location=b.location and a.usercode=b.usercode and a.seg=b.seg  
where b.usercode is null  
order by location1,a.Usercode,a.seg
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.dealer_limit2_all
-- --------------------------------------------------
CREATE procedure dealer_limit2_all    
as            
            
set nocount on            
          
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED          
            
select party_Code INTO #PCODE from risk.dbo.party_label_all          
      
select usercode INTO #UCODE from odin_limits where LOCATION IN ('FORT_AKRUTI','FORT') AND upper(right(ltrim(rtrim(usercode)),2))='ZZ'             
and isnumeric(substring(replace(upper(ltrim(rtrim(usercode))),'ZZ',''),            
len(replace(upper(ltrim(rtrim(usercode))),'ZZ','')),1)) = 1            
          
select distinct usercode into #code from odin_limits where usercode not in            
(select distinct usercode from odin_limits where group_id is null and usercode <> '-')            
and usercode not in (select party_Code from #PCODE)            
and usercode <> '-'            
and usercode not in  (select usercode from #UCODE )            
          
          
select period=b.perioducity,b.value,a.location,a.usercode,group_id,udatetime,periodicity,max_order_value, max_order_qty,             
GE_limit_in_000s,Net_Purchase_Premium_in_000s,NSE_Write_Limit_in_000s            
INTO #FILE1a    
from odin_limits a, periodicity b             
where a.usercode in (select usercode from #code) and a.periodicity=b.Value             
and code is null and symbol is null and sgroup is null             
AND LOCATION IN ('FORT_AKRUTI','FORT')           
          
  
  
select *     
into #file1    
from     
(    
  
select a.*,Seg='BSECM' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.bse='Y' and     
a.value in ('80','70','7','60','6','8','170','17') and a.usercode=b.user_id    
  
union    
select a.*,Seg='NSECM' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.nse='Y' and     
a.value in ('10','1','5','50','70','7','80','8','170','17') and a.usercode=b.user_id    
union    
select a.*,Seg='NSEFO' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.nsefo='Y' and     
a.value in ('20','2','30','3','40','4','50','5','80','8','170','17') and a.usercode=b.user_id    
union    
select a.*,seg='MCX' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.mcx='Y' and     
a.value in ('170','17','16','160','90','9') and a.usercode=b.user_id    
union    
select a.*,seg='NCDEX' from #FILE1a a,   odin_dealer_mumbai  b where a.location=b.location and b.ncdex='Y' and     
a.value in ('170','17','16','160','150','15') and a.usercode=b.user_id    
) a    
    
  
select location,usercode,seg into #file2 from (            
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from location a,             
(            
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from periodicity /*where dmode = 'checked'*/  
) c where a.location in ('FORT','FORT_AKRUTI')         
) x left outer join #FILE1 y on x.location1=y.location and x.perioducity=y.period        
--where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))        
where usercode is not null --and convert(money,replace(GE_limit_in_000s,-1,99999999999)) <= dge_limit  
  
  
select x.*,y.* into #file3 from (            
select location1=a.location,c.perioducity,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from location a,             
(            
select perioducity,value,dge_limit,dqty_limit,dvalue_limit,dwrite_limit,dpremium_limit             
from periodicity /*where dmode = 'checked'*/  
) c where a.location in ('FORT','FORT_AKRUTI')         
) x left outer join #FILE1 y on x.location1=y.location and x.perioducity=y.period        
--where dge_limit>0 and dge_limit< convert(money,replace(GE_limit_in_000s,-1,99999999999))        
where usercode is not null --and convert(money,replace(GE_limit_in_000s,-1,99999999999)) > dge_limit  
  
select distinct a.* from #file3 a left outer join #file2 b on a.location=b.location and a.usercode=b.usercode and a.seg=b.seg  
--where b.usercode is null  
order by location1,a.Usercode,a.seg            
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Diet_limit_audit_upload
-- --------------------------------------------------
CREATE  procedure Diet_limit_audit_upload(@filename as varchar(25),@location as varchar(11),@serIp as varchar(18))                          
as                
set nocount on                
declare @sql3 as varchar(500),@sql4 as varchar(3000)                 
                
--declare @filename as varchar(25),@location as varchar(11),@serIp as varchar(18)                
--set @filename='limitaudit.txt'                
--set @location='CSO98'                
--set @serIp='196.1.115.142'                
                
--set @extract_file=replace(@filename,'.zip','.txt')                
set @sql4 = 'select top 0 * into #ODIN_LIMITS_TEMP from ODIN_LIMITS_TEMP'                 
set @sql4 = @sql4+' BULK INSERT #ODIN_LIMITS_TEMP FROM ''\\'+@serIp+'\D$\DietServerSurveillance\'+@location+'\'+convert(varchar(10),getdate(),112)+'\RM\IN\'++''+@filename+''' WITH ( FIELDTERMINATOR=''|'',FIRSTROW=2,KEEPNULLS)'                
--exec(@sql3)          
set @location=replace(@location,'Diet-','CSO')                
        
                
set @sql4 = @sql4+' UPDATE #ODIN_LIMITS_TEMP SET mAX_ORDER_VALUE = ''99999999999999.00'' WHERE mAX_ORDER_VALUE=''999999999999999.00''                
UPDATE #ODIN_LIMITS_TEMP SET GE_limit_in_000s = ''9999999999.99'' WHERE GE_limit_in_000s =''10000000000000000000.00''                
update #ODIN_LIMITS_TEMP set Net_Purchase_Premium_in_000s=''10000000000000.00'' where Net_Purchase_Premium_in_000s=''100000000000000000.00''                
update #ODIN_LIMITS_TEMP set ge_limit_in_000s=''9999999999.99'' where ltrim(rtrim(ge_limit_in_000s)) like ''9999%'' and len(ltrim(rtrim(ge_limit_in_000s)))> 8                
update #ODIN_LIMITS_TEMP set max_order_value=''9999999999.99'' where ltrim(rtrim(max_order_value)) like ''9999%'' and len(ltrim(rtrim(max_order_value)))> 8                
delete from ODIN_LIMITS where location='''+@location+'''                
insert into ODIN_LIMITS select *,location='''+@location+''',udatetime=getdate() from #ODIN_LIMITS_TEMP (nolock) '                
      
declare @l as varchar(10)      
select @l=count(location) from location where location=@location      
if @l<>0      
begin      
set @sql4 = @sql4+'update location set last_uploaded=getdate() where location ='''+@location+''''      
end      
else      
begin      
declare @lName as varchar(10)      
select @lName=LocaName from ctclmgrlocation where locaCode=@location      
set @sql4 =@sql4+ 'insert into location (location,last_uploaded,pswd,username,category,locaname) values ('''+@location+''',getdate(),'''+@location+''','''+@location+''',''USER'','''+@lName+''')'      
end      
exec (@sql4)        
       
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.disp_values
-- --------------------------------------------------

CREATE proc [dbo].[disp_values]
(
@rdate datetime
)
as

--declare @rdate as varchar(25)
--set @rdate = '2007-11-30'


declare @BB as numeric(25,2)
declare @TP as numeric(25,2)
declare @FD as numeric(25,2)
declare @MR as numeric(25,2)
declare @LAS as numeric(25,2)
declare @HV as numeric(25,2)

select @BB = qty from testdb.dbo.ff_tmmrsfund_details where rdate=@rdate and type='Bank balance'
select @TP = qty from testdb.dbo.ff_tmmrsfund_details where rdate=@rdate and type='Tomorrow''s Pay-In/Ou'
select @FD = qty from testdb.dbo.ff_tmmrsfund_details where rdate=@rdate and type='FD'
select @HV = qty from testdb.dbo.ff_tmmrsfund_details where rdate=@rdate and type='H-V Cheq.'
select @MR = qty from testdb.dbo.ff_tmmrsfund_details where rdate=@rdate and type='Margin Release'
select @LAS = qty from testdb.dbo.ff_tmmrsfund_details where rdate=@rdate and type='LAS OD Limit'


declare @CI as numeric(25,2)
declare @MCX as numeric(25,2)
declare @ASL as numeric(25,2)
declare @BSE as numeric(25,2)
declare @NSE as numeric(25,2)
declare @FO as numeric(25,2)

select @CI = qty from testdb.dbo.ff_transactions_details where rdate=@rdate and type='Cheque Issued'
select @MCX = qty from testdb.dbo.ff_transactions_details where rdate=@rdate and type='ABC-MCX'
select @ASL = qty from testdb.dbo.ff_transactions_details where rdate=@rdate and type='ABC-ASL'
select @BSE = qty from testdb.dbo.ff_transactions_details where rdate=@rdate and type='ABC-BSE'
select @NSE = qty from testdb.dbo.ff_transactions_details where rdate=@rdate and type='ABC-NSE'
select @FO = qty from testdb.dbo.ff_transactions_details where rdate=@rdate and type='ABC-FO'






-- Acc_Details
select type,isnull(convert(varchar(40),NCDEX),0) as 'NCDEX',isnull(convert(varchar(40),MCX),0) as 'MCX',
isnull(convert(varchar(40),ASLFO),0) as 'ASLFO',isnull(convert(varchar(40),BSE),0) as 'ABL',isnull(convert(varchar(40),NSE),0) as 'ACDL',
isnull(convert(varchar(40),NSEFO),0) as 'ACDL FO', Total= isnull(convert(varchar(40), NCDEX+MCX+ASLFO+BSE+NSE+NSEFO),0)
 from testdb.dbo.ff_acc_details where rdate=@rdate
-- Sum Total
union all
select 'Total(C)', isnull(convert(varchar(40),sum(NCDEX)),0),isnull(convert(varchar(40),sum(MCX)),0),
isnull(convert(varchar(40),sum(ASLFO)),0),isnull(convert(varchar(40),sum(BSE)),0),isnull(convert(varchar(40),sum(NSE)),0),
isnull(convert(varchar(40),sum(NSEFO)),0), Total=isnull(convert(varchar(40),(sum(NCDEX)+sum(MCX)+sum(ASLFO)+sum(BSE)+sum(NSE)+sum(NSEFO))),0)
 from testdb.dbo.ff_acc_details where rdate = @rdate
-- add rows 
union all
select '','','','A','B','C','','(A+B+C)'
union all
select 'Net Total','','','','','','',''
union all
select '','','','','','','',''
-- Todays Transactions
union all
select 'Today''s Transactions','Cheque Issued','ABC-MCX','ABC-ASL','ABC-BSE','ABC-NSE','ABC-FO','Total'
union all
select '',BB = isnull(convert(varchar(40),@CI),0),TP = isnull(convert(varchar(40),@MCX),0),FD = isnull(convert(varchar(40),@ASL),0),
HV = isnull(convert(varchar(40),@BSE),0),MR = isnull(convert(varchar(40),@NSE),0),LAS = isnull(convert(varchar(40),@FO),0),
NET = isnull(convert(varchar(40),(@CI + @MCX + @ASL + @BSE + @NSE + @FO)),0)
-- add blank row
union all
select '','','','','','','',''
union all
select 'Tomorrow''s Fund Position','','','','','','',''
-- Tomorrows Fund Balance
union all
select 'Bank Balance','Tomorrow Pay-In/Out','FD','','H-V Cheq.','Margin Release','LAS OD Limit','Net Balance'
union all
select BB = isnull(convert(varchar(40),@BB),0),TP = isnull(convert(varchar(40),@TP),0),FD = isnull(convert(varchar(40),@FD),0),
 empty='',HV = isnull(convert(varchar(40),@HV),0),MR = isnull(convert(varchar(40),@MR),0),LAS = isnull(convert(varchar(40),@LAS),0),
NET = isnull(convert(varchar(40),(@BB + @TP + @FD + @HV + @MR + @LAS)),0)

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DTC_CtclMgrLocation
-- --------------------------------------------------
CREATE PROCEDURE DTC_CtclMgrLocation(@ACCESS_TO AS VARCHAR(12),@ACCESS_CODE AS VARCHAR(12))
 AS

SET NOCOUNT ON

IF @ACCESS_TO='BROKER'
BEGIN
select locaCode,LocaName from CtclMgrLocation (nolock) where branch_cd like '%'
END


IF @ACCESS_TO='BRANCH'
BEGIN
select locaCode,LocaName from CtclMgrLocation (nolock) where branch_cd=@ACCESS_CODE
END

IF @ACCESS_TO='REGION'
BEGIN
select locaCode,LocaName from CtclMgrLocation (nolock) where branch_cd in (select code from risk.dbo.region (nolock) where reg_Code=@ACCESS_CODE)
END

IF @ACCESS_TO='BRMAST'
BEGIN
select locaCode,LocaName from CtclMgrLocation (nolock) where branch_cd in (select branch_cd from risk.dbo.branch_master (nolock) where brmast_Cd =@ACCESS_CODE)
END




SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.DTCUpload_opt
-- --------------------------------------------------
create Proc DTCUpload_opt (@location AS VARCHAR(15))
AS

delete from dbo.CTCL_DTC where location=@location        
insert into dbo.CTCL_DTC select * from mis.upload.dbo.CTCL_DTCx where location=@location

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Emer_DTV_Uload_ALL
-- --------------------------------------------------
              
--use testdb              
CREATE Procedure Emer_DTV_Uload_ALL                
As                 
Begin                
   --Exec Emer_DTV_Upload 'DTC_20.TXT','CSO20'                
	                
	Exec Emer_DTV_Upload 'DTC_34.TXT','CSO34'                
	                
	Exec Emer_DTV_Upload 'DTC_43.TXT','CSO43'                
	                
	Exec Emer_DTV_Upload 'DTC_44.TXT','CSO44'                
	                
	Exec Emer_DTV_Upload 'DTC_48.TXT','CSO48'                
	                
	Exec Emer_DTV_Upload 'DTC_59.TXT','CSO59'                
	                
	Exec Emer_DTV_Upload 'DTC_65.TXT','CSO65'                
	                
	Exec Emer_DTV_Upload 'DTC_66.TXT','CSO66'           
	          
	Exec Emer_DTV_Upload 'DTC_190.TXT','CSO190'          
	        
	Exec Emer_DTV_Upload 'DTC_94.TXT','CSO94'                 
              
--select 'hi'                 
                
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Emer_DTV_Uload_ALL_06052019
-- --------------------------------------------------


      
--use testdb      
CREATE Procedure Emer_DTV_Uload_ALL_06052019       
As         
Begin        
Exec Emer_DTV_Upload 'DTC_20.TXT','CSO20'        
        
Exec Emer_DTV_Upload 'DTC_34.TXT','CSO34'        
        
Exec Emer_DTV_Upload 'DTC_43.TXT','CSO43'        
        
Exec Emer_DTV_Upload 'DTC_44.TXT','CSO44'        
        
Exec Emer_DTV_Upload 'DTC_48.TXT','CSO48'        
        
Exec Emer_DTV_Upload 'DTC_59.TXT','CSO59'        
        
Exec Emer_DTV_Upload 'DTC_65.TXT','CSO65'        
        
Exec Emer_DTV_Upload 'DTC_66.TXT','CSO66'   
  
Exec Emer_DTV_Upload 'DTC_190.TXT','CSO190'      
      
--select 'hi'         
        
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Emer_DTV_Upload
-- --------------------------------------------------


--Emer_DTV_Upload 'DTC_43.TXT','CSO43'



--exec Emer_DTV_Upload 'DTC_34.TXT','CSO34'

CREATE procedure [dbo].[Emer_DTV_Upload](@filename as varchar(25),@locacode as varchar(25))      

as      

  

--exec [196.1.115.245].test.dbo.DTC_CSV_Unzip @filename  

     

      

SELECT top 0 Dealer,Party_Code into #file1 from CTCL_DTCx (nolock)      

/* BULK INSERT #file1 FROM '\\196.1.115.183\d$\Upload1\ft\'+@filename WITH ( FIELDTERMINATOR=',',FIRSTROW=1,KEEPNULLS)*/      

declare @str as varchar(1000)      

  

set @filename=REPLACE(@filename,'.ZIP','.TXT')  

      

--set @str='BULK INSERT #file1 FROM ''\\172.29.19.16\public\tushar\DTCTODAY\'+@filename+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'      

set @str='BULK INSERT #file1 FROM ''\\INHOUSELIVEAPP1-FS.angelone.in\upload1\OmnesysFileFormat\DTCTODAY\'+@filename+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'        



exec(@str)      

      

      

update #file1 set party_code=replace(ltrim(rtrim(party_code)),char(32),'')      

update #file1 set dealer=replace(ltrim(rtrim(dealer)),char(32),'')      

delete from #file1 where party_code='' or party_Code ='------'      

    

      

--delete from CTCL_DTCx where location=@locacode   

     

--insert into CTCL_DTCx select *,location=@locacode,getdate() from #file1      

    

    

delete from CTCL_DTC where location=@locacode      

--insert into CTCL_DTC select * from mis.upload.dbo.CTCL_DTCx where location=@locacode      

insert into CTCL_DTC(Dealer,Party_Code,Location,Last_updated) select *,location=@locacode,getdate() from #file1  

  

drop table #file1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Emer_DTV_Upload_17022021
-- --------------------------------------------------
--Emer_DTV_Upload 'DTC_43.TXT','CSO43'
Create procedure [dbo].[Emer_DTV_Upload_17022021](@filename as varchar(25),@locacode as varchar(25))      
as      
  
--exec [196.1.115.245].test.dbo.DTC_CSV_Unzip @filename  
     
      
SELECT top 0 Dealer,Party_Code into #file1 from CTCL_DTCx (nolock)      
/* BULK INSERT #file1 FROM '\\196.1.115.183\d$\Upload1\ft\'+@filename WITH ( FIELDTERMINATOR=',',FIRSTROW=1,KEEPNULLS)*/      
declare @str as varchar(1000)      
  
set @filename=REPLACE(@filename,'.ZIP','.TXT')  
      
set @str='BULK INSERT #file1 FROM ''\\172.29.19.16\public\tushar\DTCTODAY\'+@filename+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'      
exec(@str)      
      
      
update #file1 set party_code=replace(ltrim(rtrim(party_code)),char(32),'')      
update #file1 set dealer=replace(ltrim(rtrim(dealer)),char(32),'')      
delete from #file1 where party_code='' or party_Code ='------'      
    
      
--delete from CTCL_DTCx where location=@locacode   
     
--insert into CTCL_DTCx select *,location=@locacode,getdate() from #file1      
    
    
delete from CTCL_DTC where location=@locacode      
--insert into CTCL_DTC select * from mis.upload.dbo.CTCL_DTCx where location=@locacode      
insert into CTCL_DTC(Dealer,Party_Code,Location,Last_updated) select *,location=@locacode,getdate() from #file1  
  
drop table #file1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Find_Regionwise_rpt
-- --------------------------------------------------
CREATE PROCEDURE Find_Regionwise_rpt
@ACCESS_TO VARCHAR(20),
@ACCESS_CODE VARCHAR(20),
@REGION varchar(30)
AS     
BEGIN 
IF @REGION = null 
SELECT 
Region = '<a href="/global3/report.aspx?reportno=611&region='+region+'">'+Region+'</a>',
SUM(Turnover) Turnover,SUM(Brokerage) Brokerage, COUNT(DISTINCT party_code) AS [No of Unique Clients],
'<a href="#" OnClick="openmodalpopup("Regionwise Turnover and Brokerage","",450,200);return false">
View</a>' as Action from exm_clientto
WHERE sauda_date >= 'Apr 1 2012' AND sauda_date <= 'Apr 30 2012'
GROUP BY Region
ELSE
SELECT branch_cd,SUM(Turnover) Turnover,SUM(brokerage) Brokerage,COUNT(DISTINCT party_code) as [No of Unique Clients]
FROM exm_clientto where region =  @REGION
group by branch_cd
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.frwsp_amdexecutessisprocess
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[frwsp_amdexecutessisprocess]
	@process_id int ,				--	Process Id for which The DTS need to be Run
	@server varchar(255),			--  DTS Server Name
	@db_user_id varchar(255),		-- 	Server Login Id
	@db_password varchar(255),		-- 	Server Password if using SQL Security to load Package (UID is SUSER_NAME())
	@package_name varchar(255), 	-- 	Package Name (Defaults to most recent version)
	@package_password varchar(255),	-- 	Package Password
	@amd_user_id	int				--  ICS User Id 
AS
Set nocount on

 Begin try
	
	Declare @dts_id AS int			--	DTS_id if the DTS which needs to be called for the process
	Declare @global_variable as varchar(6000)-- Attribute Name of the Global Variable
	Declare @int_security bit 		-- 0 = SQL Server Security, 1 = Integrated Security
	set @int_security = 1	
	Declare @error_code as int

	set @error_code =0
	---- GET GLOBAL VARIABLE CONCATENATED 
--	set @global_variable = EAILOG.dbo.efn_gspGlobalVariabledts (@process_id)
	set @global_variable = dbo.fn_gspGlobalVariablessis (@process_id)
	---- CALL DTS 

	
	  select @dts_id = dts_id from dbo.tbl_dtsprocess where process_id =@process_id	

		exec @error_code = dbo.sp_amdexecutessis @process_id , @server , @package_name, @db_user_id , @db_password , @int_security , @package_password  , @global_variable , @amd_user_id



	Select @Error_code as Error_code

SET QUOTED_IDENTIFIER OFF 
 
SET ANSI_NULLS ON

 End try

 Begin Catch 
 
 End catch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.frwsp_amdssisprocess
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[frwsp_amdssisprocess]
	@amd_type int ,
	@process_id int ,
	@dts_id int ,				-- Id of DTS to be Executed for the Process
	@global_variable_values varchar(3000),	-- List of Global Variable values with CSV format
	@process_status char(1),
	@amd_user_id int ,			-- ICS User Id
	@amd_session_id bigint ,		-- ICS AMD Session Id
	@original_file_name varchar(500) = '',		-- File Name of Original File Uploaded
	@process_id1 int output
AS
Set NoCount ON
  
  Begin try

	Declare @haserror as int
	Set @haserror = 0
	IF @amd_type = 1 
	BEGIN
		INSERT INTO dbo.tbl_dtsprocess(dts_id , global_variable_values , process_status , original_file_name , amd_user_id , amd_date, amd_session_id ) 
		SELECT @dts_id , @global_variable_values , @process_status , @original_file_name , @amd_user_id , getdate(), @amd_session_id;set @process_id1 = @@identity

		Set @haserror = @@Error
	END
	ELSE IF @amd_type = 2
	BEGIN
		UPDATE tbl_dtsprocess 
		SET process_status = @process_status ,
			amd_user_id = @amd_user_id ,
			amd_date = getdate()
		WHERE process_id = @process_id 
	END
	--------------------------------
	Set @haserror = @@Error

 End try

 Begin catch 
 --Select @haserror as error_code , @process_id1 as process_id
     
 End Catch

 

--*Created By:   
--*Brief description:-    
--*------------------------------------------------------------------------------------------------    
--*  To Call SSIS from Process Id
--*------------------------------------------------------------------------------------------------    
--*Sub Module Ids:-	
--*Tables Accessed: 
--*Table Name      
--*Parameters:-    
--* Input:   
--* Output:   
--*Change History:-    

--*************************************************************************************************

GO

-- --------------------------------------------------
-- PROCEDURE dbo.frwsp_dspssisdetails
-- --------------------------------------------------

--*************************************************************************************************    
--*Created By:   
--*Brief description:-    
--*------------------------------------------------------------------------------------------------    
--*  Procedure for Geting DTS Details as per the Entry in tbl_tbl_mst_dtsnames
--*------------------------------------------------------------------------------------------------    
--*Sub Module Ids:-	
--*Tables Accessed: 	tbl_mst_dtsname
--*Table Name      
--*Parameters:-    
--* Input:   
--* Output:   
--*Change History:-    
--*Change#	Changed By		    Changed on	Reason

--*************************************************************************************************
CREATE Procedure [dbo].[frwsp_dspssisdetails]
	@dts_id int
	
AS
Begin Try
SET NOCOUNT ON
BEGIN
		SELECT server_name , db_user , db_pwd , dts_name , dts_password 
		from dbo.tbl_mst_dtsname
		where dts_id =@dts_id
END
End try
Begin catch

End catch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.FundPayinTimeGap
-- --------------------------------------------------

CREATE procedure [dbo].[FundPayinTimeGap](
@fromdate varchar(11),
@fromTime as varchar(8),
@todate varchar(11),
@toTime as varchar(8),
@partyCode as varchar(10)
)
as

set nocount on
/* exec FundPayinTimeGap 'Feb 13 2012','00:00:00','Feb 13 2012','23:59:59','%' */
/* exec FundPayinTimeGap 'Feb 13 2012','00:00:00','Feb 13 2012','23:59:59','A73862' */
/* Fetch Funds Payin Data */

select * 
into #file1
from temp_mis_file1 with (nolock) where sdatetime >=@fromdate+' '+@fromTime
and sdatetime <=@todate+' '+@toTime
/* and sUserDefinedExchangeName like @segment */
and sloginid like @partyCode

select cltcode,vamt,pdt
into #BSE_Data
from AngelBSECM.account_Ab.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('BSE','BSE EQUITIES'))

select cltcode,vamt,pdt 
into #NSE_Data
from AngelNseCM.account.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('NSE','NSE EQUITIES'))


select cltcode,vamt,pdt
into #FO_Data
from angelfo.accountfo.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('NSEFO','NSE DERIVATIVES'))

select cltcode,vamt,pdt
into #NSX_Data
from angelfo.accountcurfo.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('NSX','NSECD'))

select cltcode,vamt,pdt
into #MCX_Data
from angelcommodity.accountmcdx.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('MCX','MCX FUTURES'))


select cltcode,vamt,pdt
into #MCXSX_Data
from angelcommodity.accountmcdxcds.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('MCXSX','MCXSX CURRENCY FUTURES'))

select cltcode,vamt,pdt
into #NCDEX_Data
from angelcommodity.accountncdx.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime
and vtyp=2
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName
in ('NCDEX','NCDEX FUTURES'))



select a.sloginid as [Party Code],'BSECM' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
into #final 
from 
(select * from #file1 where sUserDefinedExchangeName in ('BSE','BSE EQUITIES'))
a left outer join #BSE_data b on a.sloginid=b.cltcode and nAmount=vamt


insert into #final 
select a.sloginid as [Party Code],'NSECM' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
from 
(select * from #file1 where sUserDefinedExchangeName in ('NSE','NSE EQUITIES'))
a left outer join #NSE_data b on a.sloginid=b.cltcode and nAmount=vamt


insert into #final 
select a.sloginid as [Party Code],'NSEFO' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
from 
(select * from #file1 where sUserDefinedExchangeName in ('NSEFO','NSE DERIVATIVES'))
a left outer join #FO_data b on a.sloginid=b.cltcode and nAmount=vamt



insert into #final 
select a.sloginid as [Party Code],'MCX' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
from 
(select * from #file1 where sUserDefinedExchangeName in ('MCX','MCX FUTURES'))
a left outer join #MCX_data b on a.sloginid=b.cltcode and nAmount=vamt


insert into #final 
select a.sloginid as [Party Code],'NSX' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
from 
(select * from #file1 where sUserDefinedExchangeName in ('NSX','NSECD'))
a left outer join #NSX_data b on a.sloginid=b.cltcode and nAmount=vamt


insert into #final 
select a.sloginid as [Party Code],'MCXSX' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
from 
(select * from #file1 where sUserDefinedExchangeName in ('MCXSX','MCXSX CURRENCY FUTURES'))
a left outer join #MCXSX_data b on a.sloginid=b.cltcode and nAmount=vamt


insert into #final 
select a.sloginid as [Party Code],'NCDEX' as Segment,nAmount as Amount,
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],
[Time Gap]=case when pdt is null then 'Not Updated in BO' else
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)
end,
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product
from 
(select * from #file1 where sUserDefinedExchangeName in ('NCDEX','NCDEX FUTURES'))
a left outer join #NCDEX_data b on a.sloginid=b.cltcode and nAmount=vamt


select y.Branch_cd as [Br.Code],y.Sub_broker as [SB.Code],x.[Party Code],y.short_name as [Party Name],
x.segment,x.Amount,x.[PI DateTime],x.[BO DateTime],x.[Time Gap],x.Bank,x.[Bank Ref.No.],
x.[Txn.Ref.No.],x.product
from #final x left outer join risk.dbo.client_Details y with (nolock) on x.[Party Code]=y.party_code
order by segment,[PI DateTime]
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.FundPayinTimeGap_Global
-- --------------------------------------------------
CREATE procedure [dbo].[FundPayinTimeGap_Global](          
@fromdate varchar(11),          
@fromTime as varchar(8),          
@todate varchar(11),          
@toTime as varchar(8),          
@partyCode as varchar(10),        
@access_to varchar(10)  ,        
@access_code varchar(10)        
)          
as          
          
set nocount on        
set   @fromdate=convert(varchar(11),Convert(datetime,@fromdate,103),100)        
set   @todate=convert(varchar(11),Convert(datetime,@todate,103),100)        
/* exec FundPayinTimeGap_global 'Feb 13 2012','00:00:00','Feb 13 2012','23:59:59','%','Broker','Broker' */          
/* exec FundPayinTimeGap 'Feb 13 2012','00:00:00','Feb 13 2012','23:59:59','A73862' */          
/* Fetch Funds Payin Data */          
          
select *           
into #file1          
from (select * from temp_mis_file1 a with (nolock) union 
select * from temp_mis_file1a b with(nolock) )a where sdatetime >=@fromdate+' '+@fromTime          
and sdatetime <=@todate+' '+@toTime          
/* and sUserDefinedExchangeName like @segment */          
and sloginid like @partyCode          
          
select cltcode,vamt,pdt          
into #BSE_Data          
from AngelBSECM.account_Ab.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('BSE','BSE EQUITIES'))          
          
select cltcode,vamt,pdt           
into #NSE_Data          
from AngelNseCM.account.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('NSE','NSE EQUITIES'))          
          
          
select cltcode,vamt,pdt          
into #FO_Data          
from angelfo.accountfo.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('NSEFO','NSE DERIVATIVES'))          
          
select cltcode,vamt,pdt          
into #NSX_Data          
from angelfo.accountcurfo.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('NSX','NSECD','NSECDS'))          
          
select cltcode,vamt,pdt          
into #MCX_Data          
from angelcommodity.accountmcdx.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('MCX','MCX FUTURES'))          
          
          
select cltcode,vamt,pdt          
into #MCXSX_Data          
from angelcommodity.accountmcdxcds.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('MCXSX','MCXSX CURRENCY FUTURES'))          
          
select cltcode,vamt,pdt          
into #NCDEX_Data          
from angelcommodity.accountncdx.dbo.ledger with (nolock) where vdt>=@fromdate+' '+@fromTime          
and vtyp=2          
and cltcode in (select sloginid from #file1 where sUserDefinedExchangeName          
in ('NCDEX','NCDEX FUTURES'))          
          
          
          
select a.sloginid as [Party Code],'BSECM' as Segment,convert(money,nAmount) as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
into #final           
from           
(select * from #file1 where sUserDefinedExchangeName in ('BSE','BSE EQUITIES'))          
a left outer join #BSE_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
insert into #final           
select a.sloginid as [Party Code],'NSECM' as Segment,nAmount as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
from           
(select * from #file1 where sUserDefinedExchangeName in ('NSE','NSE EQUITIES'))          
a left outer join #NSE_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
insert into #final           
select a.sloginid as [Party Code],'NSEFO' as Segment,nAmount as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
from           
(select * from #file1 where sUserDefinedExchangeName in ('NSEFO','NSE DERIVATIVES'))          
a left outer join #FO_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
          
insert into #final           
select a.sloginid as [Party Code],'MCX' as Segment,nAmount as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
from           
(select * from #file1 where sUserDefinedExchangeName in ('MCX','MCX FUTURES'))          
a left outer join #MCX_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
insert into #final           
select a.sloginid as [Party Code],'NSX' as Segment,nAmount as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
from           
(select * from #file1 where sUserDefinedExchangeName in ('NSX','NSECD','NSECDS'))          
a left outer join #NSX_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
insert into #final           
select a.sloginid as [Party Code],'MCXSX' as Segment,nAmount as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
from           
(select * from #file1 where sUserDefinedExchangeName in ('MCXSX','MCXSX CURRENCY FUTURES'))          
a left outer join #MCXSX_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
insert into #final           
select a.sloginid as [Party Code],'NCDEX' as Segment,nAmount as Amount,          
convert(varchar(25),sDatetime) as [PI DateTime],isnull(convert(varchar(25),pdt),'-') as [BO DateTime],          
[Time Gap]=case when pdt is null then 'Not Updated in BO' else          
CAST(datediff(mi,sDatetime,pdt)/1440 AS VARCHAR(12)) + ' day(s) ' + CONVERT(CHAR(8), DATEADD(MINUTE, datediff(mi,sDatetime,pdt) % 1440, '00:00'), 108)          
end,          
sBankid as Bank,sBankRefNo as [Bank Ref.No.],nTxnRefNo as [Txn.Ref.No.],product as Product          
from           
(select * from #file1 where sUserDefinedExchangeName in ('NCDEX','NCDEX FUTURES'))          
a left outer join #NCDEX_data b on a.sloginid=b.cltcode and nAmount=vamt          
          
          
select y.Branch_cd as [Br Code],y.Sub_broker as [SB Code],x.[Party Code],y.short_name as [Party Name],          
x.[segment],amount=Convert(decimal(15,2),x.[Amount]),      
x.[PI DateTime] AS [PI Date Time],x.[BO DateTime] AS [BO Date Time],x.[Time Gap],x.Bank,x.[Bank Ref.No.] AS [Bank Ref No.],          
x.[Txn.Ref.No.] AS [Txn Ref No.],x.Product          
from #final x left outer join risk.dbo.client_Details y with (nolock) on x.[Party Code]=y.party_code          
order by segment,[PI DateTime]          
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GENERATE_SUMMARY
-- --------------------------------------------------
CREATE procedure GENERATE_SUMMARY
as    
set nocount on    
  
set transaction isolation level read uncommitted    
     
---TRUNCATE TABLE CLIENT_PERFORMANCE_sUMMARY  

---INSERT INTO CLIENT_PERFORMANCE_sUMMARY  
---select PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,  
---Active_day=datediff(day,sdt,ldt)+1,  
---revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),  
---Average=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2))  
---from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b     
---where a.party_code collate Latin1_General_CI_AS=b.party_code   
---group by Party_Name,a.party_code,Branch,Subgroup,ldt,sdt    
---order by a.party_code   
--  drop table CLIENT_PERFORMANCE_sUMMARY  
TRUNCATE TABLE CLIENT_PERFORMANCE_sUMMARY  

INSERT INTO CLIENT_PERFORMANCE_sUMMARY  
select tdate,PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,      
bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt,   
Active_day=datediff(day,sdt,ldt)+1,  
--revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),  
--Average=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2)),      
revenue=round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2),  
Average=round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2),      
--revenuePERDAY=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2))  ,        
inactive_date=ldt    
--into CLIENT_PERFORMANCE_sUMMARY  
from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b         
where a.party_code collate Latin1_General_CI_AS=b.party_code         
group by tdate,a.party_code,b.party_name,Branch,Subgroup, ldt,sdt,    
bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt       

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GENERATE_SUMMARY1
-- --------------------------------------------------

CREATE procedure GENERATE_SUMMARY1
as    
set transaction isolation level read uncommitted    
     
---TRUNCATE TABLE CLIENT_PERFORMANCE_sUMMARY1  

---INSERT INTO CLIENT_PERFORMANCE_sUMMARY1  
---select PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,  
---Active_day=datediff(day,sdt,ldt)+1,  
---revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),  
---Average=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2))  
---from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b     
---where a.party_code collate Latin1_General_CI_AS=b.party_code   
---group by Party_Name,a.party_code,Branch,Subgroup,ldt,sdt    
---order by a.party_code   
--  drop table CLIENT_PERFORMANCE_sUMMARY  
TRUNCATE TABLE CLIENT_PERFORMANCE_sUMMARY1 

--Added for blank dates

update  client_performance1
set  bse_ldt=getdate()
where bse_ldt=''


update  client_performance1
set  nse_ldt=getdate()
where nse_ldt='' 


update  client_performance1
set  fo_ldt=getdate()
where fo_ldt=''


update  client_performance1
set  mcdx_ldt=getdate()
where mcdx_ldt=''


update  client_performance1
set  ncdx_ldt=getdate()
where ncdx_ldt=''

INSERT INTO CLIENT_PERFORMANCE_sUMMARY1  
select tdate,PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,      
bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt,   
Active_day_nse_cm=datediff(day,nse_sdt,nse_ldt)+1,
 Active_day_nse_fo=datediff(day,fo_sdt,fo_ldt)+1,
 Active_day_bse_cm=datediff(day,bse_sdt,bse_ldt)+1,
Active_day_mcdx=datediff(day,mcdx_sdt,mcdx_ldt)+1,
Active_day_ncdx=datediff(day,ncdx_sdt,ncdx_ldt)+1,
traded_days_nse = 0,
traded_days_bse = 0,
traded_days_fo = 0,
traded_days_mcdx = 0,
traded_days_ncdx = 0, 
--revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),  
--Average=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2)),      
revenue_bse=round(sum(bse_br),2),
revenue_nse=round(sum(nse_br),2),
revenue_fo=round(sum(fo_br),2),
revenue_ncdx=round(sum(ncdx_br),2),
revenue_mcdx=round(sum(mcdx_br),2),
Average_bse=round(sum(bse_br)/(datediff(day,bse_sdt,bse_ldt)+1),2),
 Average_nse=round(sum(nse_br)/(datediff(day,nse_sdt,nse_ldt)+1),2),
 Average_fo=round(sum(fo_br)/(datediff(day,fo_sdt,fo_ldt)+1),2),
 Average_ncdx=round(sum(ncdx_br)/(datediff(day,ncdx_sdt,ncdx_ldt)+1),2),
Average_mcdx=round(sum(mcdx_br)/(datediff(day,mcdx_sdt,mcdx_ldt)+1),2)

--Average=round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2),      
--revenuePERDAY=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2))  ,        
--inactive_date=ldt    
--into CLIENT_PERFORMANCE_sUMMARY1  
from CLIENT_PERFORMANCE1 a,intranet.risk.dbo.finmast b         
where a.party_code collate Latin1_General_CI_AS=b.party_code         
group by tdate,a.party_code,b.party_name,Branch,Subgroup, ldt,sdt,    
bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt

GO

-- --------------------------------------------------
-- PROCEDURE dbo.get_Chq_payin
-- --------------------------------------------------
CREATE procedure [dbo].[get_Chq_payin](@segment as varchar(10))        
as        
set nocount on        
  
select srno,Edate,Vdate,Cltcode,Amount,DRCR,Narration,BankCode,  
BankName='',DDNo,Branchcode,BranchName,chqmode,chqdate,chqname=replace(chqname,',',''),clmode,entered_on,entered_by,entered_fromIP,posted_on,posted_status,segment         
into #file1 from payin (nolock) where posted_status='N'  and segment=@segment       
  
update #file1 set chqname =substring((case when chqname not like '%ltd%' then ltrim(rtrim(substring(chqname,1,30)))+' BKLTD' else chqname end),1,25)  
  
if upper(@segment)='ACDLCM'  
begin  
 update #file1 set cltcode='5100000002' where cltcode not in (select cltcode from AngelNseCM.account.dbo.acmast)   
end  
  
if upper(@segment)='ABLCM'  
begin  
 update #file1 set cltcode='5100000001' where cltcode not in (select cltcode from AngelBSECM.account_ab.dbo.acmast)   
end  
  
if upper(@segment)='ACDLFO'  
begin  
 update #file1 set cltcode='5100000001' where cltcode not in (select cltcode from angelfo.accountfo.dbo.acmast)   
end  
  
if upper(@segment)='MCX'  
begin  
 update #file1 set cltcode='5100000001' where cltcode not in (select cltcode from angelcommodity.accountmcdx.dbo.acmast)   
end  
  
if upper(@segment)='NCDEX'  
begin  
 update #file1 set cltcode='5100000001' where cltcode not in (select cltcode from angelcommodity.accountncdx.dbo.acmast)   
end  
  
  
truncate table temp_payin        
insert into temp_payin select * from #file1  
/*  
select srno,Edate,Vdate,Cltcode,Amount,DRCR,Narration,BankCode,  
BankName=(case when bankname not like '%ltd%' then ltrim(rtrim(substring(bankname,1,30)))+' BKLTD' else bankname end),  
,DDNo,Branchcode,BranchName,chqmode,chqdate,chqname=replace(chqname,',',''),clmode,entered_on,entered_by,entered_fromIP,posted_on,posted_status,segment         
from payin (nolock) where posted_status='N'  and segment=@segment       
*/  

UPDATE temp_payin SET VDATE=CONVERT(VARCHAR(11),GETDATE()),
EDATE=CONVERT(VARCHAR(11),GETDATE()),CHQDATE=CONVERT(VARCHAR(11),GETDATE())

select * from temp_payin (nolock) order by cltcode        

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.get_CliCharges
-- --------------------------------------------------
CREATE procedure get_CliCharges(@tdate as varchar(11))
as
set nocount on
set transaction isolation level read uncommitted
select Branch_cd,Sub_Broker,party_Code,Long_name,First_Active_date,Last_inactive_date,
BSECM=convert(money,0),
NSECM=convert(money,0),
BSEFO=convert(money,0),
NSEFO=convert(money,0),
MCX=convert(money,0),
NCDEX=convert(money,0),
BSECM_YN='N',
NSECM_YN='N',
BSEFO_YN='N',
NSEFO_YN='N',
MCX_YN='N',
NCDEX_YN='N'
into #file1
from risk.dbo.client_Details where First_Active_date>=@tdate+' 00:00'


update #file1 set bsecm=b.balance from
(
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)
from risk.dbo.abl_ledger (nolock) 
where 
--cltcode not in (select cltcode from abl_ledger where vtyp=15) and 
cltcode in (select party_Code from #file1)
group by cltcode
) b where #file1.party_Code=b.cltcode


update #file1 set bsecm_YN='Y' where party_Code in (select cltcode from risk.dbo.abl_ledger (nolock)  where vtyp=15)


update #file1 set nsecm=b.balance from
(
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)
from risk.dbo.nse_ledger (nolock) 
where cltcode in (select party_Code from #file1)
group by cltcode
) b where #file1.party_Code=b.cltcode

update #file1 set Nsecm_YN='Y' where party_Code in (select cltcode from risk.dbo.NSE_ledger (nolock) where vtyp=15)

update #file1 set nsefo=b.balance from
(
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)
from risk.dbo.fo_ledger (nolock) 
where cltcode in (select party_Code from #file1)
group by cltcode
) b where #file1.party_Code=b.cltcode

update #file1 set Nsefo_YN='Y' where party_Code in (select cltcode from risk.dbo.fo_ledger (nolock) where vtyp=15)

update #file1 set mcx=b.balance from
(
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)
from risk.dbo.mcdx_ledger (nolock) 
where cltcode in (select party_Code from #file1)
group by cltcode
) b where #file1.party_Code=b.cltcode

update #file1 set mcx_YN='Y' where party_Code in (select cltcode from risk.dbo.mcdx_ledger (nolock) where vtyp=15)

update #file1 set ncdex=b.balance from
(
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)
from risk.dbo.ncdx_ledger (nolock) 
where cltcode in (select party_Code from #file1)
group by cltcode
) b where #file1.party_Code=b.cltcode

update #file1 set ncdex_YN='Y' where party_Code in (select cltcode from risk.dbo.ncdx_ledger (nolock) where vtyp=15)


select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1
where 
(
(bsecm_yn ='N' and bsecm > 0) or
(nsecm_yn ='N' and nsecm > 0) or
(bsefo_yn ='N' and bsefo > 0) or
(nsefo_yn ='N' and nsefo > 0) or
(mcx_yn ='N' and mcx > 0) or
(ncdex_yn ='N' and ncdex > 0) 
)
--and BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX > 0

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.get_filename
-- --------------------------------------------------
create proc get_filename  
as  
 set nocount on  
select 'BR'+ convert(varchar,datepart(dd,getdate()-1))   
    + convert(varchar,datepart(mm,getdate()-1))  
           +convert(varchar,right(datepart(yy,getdate()-1),2))+'.DAT'  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Get_NOD_NOC
-- --------------------------------------------------
CREATE procedure Get_NOD_NOC(@ctclman as varchar(25))
as

set nocount on

declare @nod as int, @noc as int

select @nod=count(*) from
(
select distinct dealer from CTCL_DTC(nolock) where location=@ctclman and isnull(party_code,'')<>'' --170806
) a

select @noc=count(*) from
(
select distinct party_code from CTCL_DTC(nolock) where location=@ctclman and isnull(party_code,'')<>'' --170806
) a

select nod=@nod, noc=@noc

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.GetLedgerBalance
-- --------------------------------------------------
CREATE procedure [dbo].[GetLedgerBalance](@index tinyint)
as 
--declare @sSql varchar(1000)
--set @sSql='Select l.CltCode,NewCode=s.New_KYC_Code,Balance=Sum(case when L.DrCr=''C'' then -l.Vamt else l.Vamt End) From ' + @DataBase + '.ledger l join Intranet.testdb.dbo.shift s on l.cltcode=s.Old_KYC_Code Where l.vdt >=(Select sdtcur From '+ @DataBase +'.parameter Where sdtcur<=getdate() and ldtcur>=getdate()) and l.vdt <=convert(varchar(11),getdate())+'' 23:59:59'' group by l.CltCode ,s.New_KYC_Code having Sum(case when L.DrCr=''C'' then -l.Vamt else l.Vamt End)<>0'
--exec(@sSql)
set nocount on    
set transaction isolation level read uncommitted

if @index=1 
	Select l.CltCode,NewCode=s.New_KYC_Code,Balance=Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End) From AngelBSECM.Account_ab.dbo.ledger l join Intranet.testdb.dbo.shift s on l.cltcode=s.Old_KYC_Code Where l.vdt >=(Select sdtcur From AngelBSECM.Account_ab.dbo.parameter Where sdtcur<=getdate() and ldtcur>=getdate()) and l.vdt <=convert(varchar(11),getdate())+' 23:59:59' group by l.CltCode ,s.New_KYC_Code having Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End)<>0
if @index=2 
	Select l.CltCode,NewCode=s.New_KYC_Code,Balance=Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End) From AngelNseCM.Account.dbo.ledger l join Intranet.testdb.dbo.shift s on l.cltcode=s.Old_KYC_Code Where l.vdt >=(Select sdtcur From AngelNseCM.Account.dbo.parameter Where sdtcur<=getdate() and ldtcur>=getdate()) and l.vdt <=convert(varchar(11),getdate())+' 23:59:59' group by l.CltCode ,s.New_KYC_Code having Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End)<>0
if @index=3 
	Select l.CltCode,NewCode=s.New_KYC_Code,Balance=Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End) From AngelFo.AccountFO.dbo.ledger l join Intranet.testdb.dbo.shift s on l.cltcode=s.Old_KYC_Code Where l.vdt >=(Select sdtcur From AngelFo.AccountFO.dbo.parameter Where sdtcur<=getdate() and ldtcur>=getdate()) and l.vdt <=convert(varchar(11),getdate())+' 23:59:59' group by l.CltCode ,s.New_KYC_Code having Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End)<>0
if @index=4 
	Select l.CltCode,NewCode=s.New_KYC_Code,Balance=Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End) From AngelCommodity.AccountNCDX.dbo.ledger l join Intranet.testdb.dbo.shift s on l.cltcode=s.Old_KYC_Code Where l.vdt >=(Select sdtcur From AngelCommodity.AccountNCDX.dbo.parameter Where sdtcur<=getdate() and ldtcur>=getdate()) and l.vdt <=convert(varchar(11),getdate())+' 23:59:59' group by l.CltCode ,s.New_KYC_Code having Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End)<>0
if @index=5 
	Select l.CltCode,NewCode=s.New_KYC_Code,Balance=Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End) From AngelCommodity.AccountMCDX.dbo.ledger l join Intranet.testdb.dbo.shift s on l.cltcode=s.Old_KYC_Code Where l.vdt >=(Select sdtcur From AngelCommodity.AccountMCDX.dbo.parameter Where sdtcur<=getdate() and ldtcur>=getdate()) and l.vdt <=convert(varchar(11),getdate())+' 23:59:59' group by l.CltCode ,s.New_KYC_Code having Sum(case when L.DrCr='C' then -l.Vamt else l.Vamt End)<>0
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.hit_date_rep1
-- --------------------------------------------------
CREATE procedure hit_date_rep1(@fdate as varchar(11),@tdate as varchar(11))  
as  
  
--declare @fdate as varchar(11),@tdate as varchar(11)  
--set @fdate = 'Feb  1 2006'  
--set @tdate = 'Mar 31 2006'  
  
set transaction isolation level read uncommitted  
set nocount on  
  
select chitdate=convert(varchar(11),hitdate),hitdate,hitcount=count(*) from  
(  
SELECT distinct hitdate=convert(datetime,convert(varchar(11),hitdate)),hitip FROM dailyhit where hitdate >=@fdate+' 00:00:00' and hitdate <= @tdate+' 23:59:59'  
) a  
group by hitdate  
order by hitdate  
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.hit_date_rep2
-- --------------------------------------------------
create procedure hit_date_rep2(@hdate as varchar(11))
as

--declare @hdate as varchar(11)
--set @hdate = 'Mar  1 2006'

set transaction isolation level read uncommitted
set nocount on

SELECT hitdate=convert(datetime,convert(varchar(11),hitdate)),hitip,no_of_hits=count(*) 
FROM dailyhit where hitdate like @hdate+'%'
group by convert(datetime,convert(varchar(11),hitdate)),hitip
order by count(*) desc

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.letter_new
-- --------------------------------------------------
CREATE procedure letter_new(@fdate as varchar(11), @tdate as varchar(11),@fbr as varchar(25),@tbr as varchar(25))            
as          
set nocount on          
/*
declare @fdate as varchar(25)            
declare @tdate as varchar(25)            
declare @fbr as varchar(25)            
declare @tbr as varchar(25)            
--set @fdate = 'Feb  1 2005'            
set @fdate ='01/07/2006'  
set @tdate = '02/07/2006'   
set @fbr = 15000'            
set @tbr = '1000'            
*/
  --  drop table #aa        
      
set transaction isolation level read uncommitted      
  
select  substring(convert(varchar(11),tdate),1,6)+','+          
substring(convert(varchar(11),tdate),7,5) as tdate,PartyCode,PartyName,Branch,Subgroup,  
bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt,  
substring(convert(varchar(11),inactive_date),1,6)+','+          
substring(convert(varchar(11),inactive_date),7,5) as dt1,Average          
from CLIENT_PERFORMANCE_sUMMARY where 
inactive_date >=@fdate+' 00:00:00' and inactive_date <=@tdate+' 23:59:59' and     
CONVERT(MONEY,Average)>=CONVERT(MONEY,@fbr) and CONVERT(MONEY,Average)<=CONVERT(MONEY,@tbr)          
--Average>=@fbr and Average<=@tbr          

order by CONVERT(MONEY,Average) desc      
--Average>=@fbr and Average<=@tbr          
--order by Average desc      
  
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.letter_new_old
-- --------------------------------------------------
create procedure letter_new_old(@fdate as varchar(11), @tdate as varchar(11),@fbr as varchar(25),@tbr as varchar(25))        
as      
set nocount on      
/*
declare @fdate as varchar(25)        
--declare @tdate as varchar(25)        
--declare @fbr as varchar(25)        
--declare @tbr as varchar(25)        
--set @fdate = 'Feb  1 2005'        
set @fdate ='Jan  1 2000'
--set @tdate = 'Jan 27 2006'        
--set @fbr = '10000'        
--set @tbr = '90000'        
*/  
  --  drop table #aa    
  
set transaction isolation level read uncommitted  
---  DROP TABLE #AA
select tdate,PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,    
bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt,      
revenuePERDAY=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br)/(datediff(day,sdt,ldt)+1),2))  ,      
inactive_date=ldt  
into #aa      
from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b       
where a.party_code collate Latin1_General_CI_AS=b.party_code       
group by tdate,a.party_code,b.party_name,Branch,Subgroup, ldt,sdt,  
bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt       
--order by a.party_code      
      
---SELECT * FROM CLIENT_PERFORMANCE WHERE CLTCODE='A0005'
---SELECT * FROM #AA WHERE PARTYCODE='A0005'

select  substring(convert(varchar(11),tdate),1,6)+','+      
substring(convert(varchar(11),tdate),7,5) as tdate,PartyCode,PartyName,Branch,Subgroup,bse_ldt,nse_ldt,
fo_ldt,ncdx_ldt,mcdx_ldt,    
bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt,substring(convert(varchar(11),inactive_date),1,6)+','+      
substring(convert(varchar(11),inactive_date),7,5) as dt1,revenuePERDAY      
--INTO #BB
from #aa where inactive_date >=@fdate+' 00:00:00' and inactive_date <=@tdate+' 23:59:59' and 
---revenue>=@fbr and revenue<=@tbr      
CONVERT(MONEY,revenuePERDAY)>=CONVERT(MONEY,@fbr) and CONVERT(MONEY,revenuePERDAY)<=CONVERT(MONEY,@tbr)      
order by CONVERT(MONEY,revenuePERDAY) desc  
--  DROP TABLE #BB
--SELECT * FROM #BB WHERE PARTYCODE='A0005'
--SELECT * FROM #AA WHERE PARTYCODE='A0005'
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.letter_new1
-- --------------------------------------------------
CREATE procedure letter_new1(@fdate as varchar(11), @tdate as varchar(11),@fbr as varchar(25),@tbr as varchar(25))      
as    
set nocount on    
 /*    
declare @fdate as varchar(25)      
declare @tdate as varchar(25)      
declare @fbr as varchar(25)      
declare @tbr as varchar(25)      
--set @fdate = 'Feb  1 2005'      
set @fdate =19/04/2005    
set @tdate = 'Jan 27 2006'      
set @fbr = '10000'      
set @tbr = '90000'      
*/    
  --  drop table #aa  
select tdate,PartyCode=a.party_Code,PartyName=b.party_name,Branch,Subgroup,bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,  
bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt,    
revenue=convert(varchar,round(sum(bse_br+nse_br+fo_br+ncdx_br+mcdx_br),2)),    
inactive_date=(case when(case when(case when    
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then    
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)    
> max(mcdx_ldt) then    
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then    
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)    
else max(mcdx_ldt) end)    
> max(ncdx_ldt) then    
(case when(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then    
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)    
> max(mcdx_ldt) then    
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then    
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)    
else max(mcdx_ldt) end)    
else max(ncdx_ldt) end)    
into #aa    
from CLIENT_PERFORMANCE a,intranet.risk.dbo.finmast b     
where a.party_code collate Latin1_General_CI_AS=b.party_code     
group by tdate,a.party_code,b.party_name,Branch,Subgroup, bse_ldt,nse_ldt,fo_ldt,ncdx_ldt,mcdx_ldt,  
bse_sdt,nse_sdt,fo_sdt,ncdx_sdt,mcdx_sdt     
order by a.party_code    
    
    
select  substring(convert(varchar(11),tdate),1,6)+','+substring(convert(varchar(11),tdate),7,5) as tdate,
PartyCode,PartyName,Branch,Subgroup,
substring(convert(varchar(11),bse_ldt),1,6)+','+substring(convert(varchar(11),bse_ldt),7,5),
substring(convert(varchar(11),nse_ldt),1,6)+','+substring(convert(varchar(11),nse_ldt),7,5),
substring(convert(varchar(11),fo_ldt),1,6)+','+substring(convert(varchar(11),fo_ldt),7,5),
substring(convert(varchar(11),ncdx_ldt),1,6)+','+substring(convert(varchar(11),ncdx_ldt),7,5),
substring(convert(varchar(11),mcdx_ldt),1,6)+','+substring(convert(varchar(11),mcdx_ldt),7,5),
substring(convert(varchar(11),bse_sdt),1,6)+','+substring(convert(varchar(11),bse_sdt),7,5), 
substring(convert(varchar(11),nse_sdt),1,6)+','+substring(convert(varchar(11),nse_sdt),7,5), 
substring(convert(varchar(11),fo_sdt),1,6)+','+substring(convert(varchar(11),fo_sdt),7,5), 
substring(convert(varchar(11),ncdx_sdt),1,6)+','+substring(convert(varchar(11),ncdx_sdt),7,5), 
substring(convert(varchar(11),mcdx_sdt),1,6)+','+substring(convert(varchar(11),mcdx_sdt),7,5),
substring(convert(varchar(11),inactive_date),1,6)+','+substring(convert(varchar(11),inactive_date),7,5) as dt1,revenue    
from #aa where inactive_date >=@fdate+' 00:00:00' and inactive_date <=@tdate+' 23:59:59' and revenue>=@fbr and revenue<=@tbr    
    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.limit_audit_upload
-- --------------------------------------------------
CREATE  procedure limit_audit_upload(@filename as varchar(25),@location as varchar(11),@serIp as varchar(18))                    
as          
set nocount on          
declare @sql3 as varchar(500),@sql4 as varchar(3000)           
          
--declare @filename as varchar(25),@location as varchar(11),@serIp as varchar(18)          
--set @filename='limitaudit.txt'          
--set @location='CSO98'          
--set @serIp='196.1.115.142'          
          
--set @extract_file=replace(@filename,'.zip','.txt')          
          
set @sql4 = 'select top 0 * into #ODIN_LIMITS_TEMP from ODIN_LIMITS_TEMP'           
set @sql4 = @sql4+' BULK INSERT #ODIN_LIMITS_TEMP FROM ''\\'+@serIp+'\D$\ServerSurveillance\'+@location+'\'+convert(varchar(10),getdate(),112)+'\RM\IN\'++'\'+@filename+''' WITH ( FIELDTERMINATOR=''|'',FIRSTROW=2,KEEPNULLS)'          
--exec(@sql3)          
          
set @sql4 = @sql4+' UPDATE #ODIN_LIMITS_TEMP SET mAX_ORDER_VALUE = ''99999999999999.00'' WHERE mAX_ORDER_VALUE=''999999999999999.00''          
UPDATE #ODIN_LIMITS_TEMP SET GE_limit_in_000s = ''9999999999.99'' WHERE GE_limit_in_000s =''10000000000000000000.00''          
update #ODIN_LIMITS_TEMP set Net_Purchase_Premium_in_000s=''10000000000000.00'' where Net_Purchase_Premium_in_000s=''100000000000000000.00''          
update #ODIN_LIMITS_TEMP set ge_limit_in_000s=''9999999999.99'' where ltrim(rtrim(ge_limit_in_000s)) like ''9999%'' and len(ltrim(rtrim(ge_limit_in_000s)))> 8          
update #ODIN_LIMITS_TEMP set max_order_value=''9999999999.99'' where ltrim(rtrim(max_order_value)) like ''9999%'' and len(ltrim(rtrim(max_order_value)))> 8          
delete from ODIN_LIMITS where location='''+@location+'''          
insert into ODIN_LIMITS select *,location='''+@location+''',udatetime=getdate() from #ODIN_LIMITS_TEMP (nolock) '          

declare @l as varchar(10)
select @l=count(location) from location where location=@location
if @l<>0
begin
set @sql4 = @sql4+'update location set last_uploaded=getdate() where location ='''+@location+''''
end
else
begin
declare @lName as varchar(10)
select @lName=LocaName from ctclmgrlocation where locaCode=@location
set @sql4 =@sql4+ 'insert into location (location,last_uploaded,pswd,username,category,locaname) values ('''+@location+''',getdate(),'''+@location+''','''+@location+''',''USER'','''+@lName+''')'
end
exec (@sql4)  
 
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Limit_violation_automailer
-- --------------------------------------------------
CREATE PROCEDURE Limit_violation_automailer  
-- Add the parameters for the stored procedure here      
AS  
  BEGIN  
      -- SET NOCOUNT ON added to prevent extra result sets from      
      -- interfering with SELECT statements.      
      SET NOCOUNT ON;  
  
      -- Insert statements for procedure here    
          
      /*----- Member Wise Details -----*/  
      SELECT DISTINCT x.location1,  
                      x.perioducity,  
                      x.value_limit,  
                      x.qty_limit,  
                      x.premium_limit,  
                      x.write_limit,  
                      x.GE_limit,  
                      x.NE_limit,  
                      y.udatetime,  
                      y.NP_limit_in_000s,  
                      y.Max_Order_Qty,  
                      y.Max_Order_value,  
                      y.Net_Purchase_Premium_in_000s,  
                      y.NSE_Write_Limit_in_000s  
      INTO #MemberwiseDet  
      FROM   (SELECT location1=a.location,  
                     c.perioducity,  
                     value_limit,  
                     qty_limit,  
                     premium_limit,  
                     write_limit,  
                     ge_limit,  
                     ne_limit  
              FROM   location a WITH (NOLOCK),  
                     (SELECT perioducity,  
                             value,  
                             value_limit,  
                             qty_limit,  
                             premium_limit,  
                             write_limit,  
                             ge_limit,  
                             ne_limit  
                      FROM   periodicity WITH (NOLOCK)) c) x  
             LEFT OUTER JOIN (SELECT period=b.perioducity,  
                                     b.value,  
                                     a.location,  
                                     a.Max_Order_Qty,  
                                     a.Max_Order_Value,  
                                     a.Net_Purchase_Premium_in_000s,  
                                     a.NSE_Write_Limit_in_000s,  
                                     a.GE_Limit_in_000s,  
                                     a.NP_Limit_in_000s,  
                                     a.udatetime  
                              FROM   odin_limits_member a WITH (NOLOCK),  
                                     periodicity b WITH (NOLOCK)  
                              WHERE  a.periodicity = b.Value  
                                     AND usercode = '-'  
                                     AND code IS NULL  
                                     AND symbol IS NULL  
                                     AND sgroup IS NULL) y  
               ON x.location1 = y.location  
                  AND x.perioducity = y.period  
      WHERE  ( qty_limit > 0  
               AND qty_limit < Max_Order_Qty )  
              /*max order Value*/  
              OR ( value_limit > 0  
                   AND value_limit < Max_Order_Value )  
              /*Premium Limit*/  
              OR ( premium_limit > 0  
                   AND premium_limit < Net_Purchase_Premium_in_000s )  
              /*write limit*/  
              OR ( write_limit > 0  
                   AND write_limit < NSE_Write_Limit_in_000s )  
              /*Gross Expo Limit*/  
              OR ( GE_limit > 0  
                   AND ( GE_limit < GE_Limit_in_000s  
                          OR GE_Limit_in_000s = '-1' ) )  
              /*Net Expo Limit*/  
              OR ( NE_limit > 0  
                   AND NE_limit < NP_Limit_in_000s )  
      ORDER  BY location1,  
                udatetime DESC,  
                x.perioducity  
  
  /*------ Groupwise Deatils --------*/  
      --SELECT x.location1,      
      --       x.perioducity,      
      --       x.cge_limit,      
      --       x.cNE_limit,      
      --       x.cqty_limit,      
      --       x.cvalue_limit,      
      --       y.period,      
      --       y.Value,      
      --       y.location,      
      --       y.UserCode,      
      --       y.Group_Id,      
      --       y.udatetime,      
      --       y.Periodicity,      
      --       y.max_order_qty,      
      --       y.max_order_value,      
      --       y.NP_limit_in_000s,      
      --       y.GE_Limit_in_000s      
      --INTO   #GroupwiseDet      
      --FROM   (SELECT location1=a.location,      
      --               c.perioducity,      
      --               cge_limit,      
      --               cne_limit,      
      --               cqty_limit,      
      --               cvalue_limit      
      --        FROM   location a WITH (NOLOCK),      
      --               (SELECT perioducity,      
      --                       cge_limit,      
      --                       cne_limit,      
      --                       cqty_limit,      
      --                       cvalue_limit      
      --                FROM   periodicity WITH (NOLOCK)      
      --                WHERE  cmode = 'checked') c) x      
      --       LEFT OUTER JOIN (SELECT period=b.perioducity,      
      --                               b.value,      
      --                               a.location,      
      --                               a.usercode,      
      --                               group_id,      
      --                               udatetime,      
      --                               periodicity,      
      --                               max_order_qty    AS max_order_qty,      
      --                               max_order_value  AS max_order_value,      
      --                               NP_limit_in_000s AS NP_limit_in_000s,      
      --                               GE_limit_in_000s      
      --                        FROM   odin_limits a WITH (NOLOCK),      
      --                               periodicity b WITH (NOLOCK)      
      --                        WHERE  a.periodicity = b.Value      
      --                               AND group_id IS NULL      
      --                               AND usercode <> '-'      
      --                               AND code IS NULL      
      --                               AND symbol IS NULL      
      --                               AND sgroup IS NULL) y      
      --         ON x.location1 = y.location      
      --            AND x.perioducity = y.period      
      --WHERE      
      --  /*max order Qty*/      
      --  ( cqty_limit > 0      
      --    AND cqty_limit < Max_Order_Qty )      
      --   /*max order Value*/      
      --   OR ( cvalue_limit > 0      
      --        AND cvalue_limit < Max_Order_Value )      
      --   /*Net Expo */      
      --   OR ( cNE_limit > 0      
      --        AND ( cNE_limit < NP_Limit_in_000s      
      --               OR NP_Limit_in_000s = '-1' ))      
      --ORDER  BY location1,      
      --          Usercode      
      --/*----- Dealer Wise Report -----*/      
      --SELECT party_Code      
      --INTO   #PCODE      
      --FROM   risk.dbo.party_label_all WITH (NOLOCK)      
      --SELECT usercode      
      --INTO   #UCODE      
      --FROM   odin_limits WITH (NOLOCK)      
      --WHERE  LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )      
      --       AND Upper(RIGHT(Ltrim(Rtrim(usercode)), 2)) = 'ZZ'      
      --       AND Isnumeric(Substring(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', ''), Len(Replace(Upper(Ltrim(Rtrim(usercode))), 'ZZ', '')), 1)) = 1      
      --CREATE CLUSTERED INDEX Pcode      
      --  ON #Pcode (party_Code ASC)      
      --CREATE NONCLUSTERED INDEX Ucode      
      --  ON #UCODE (usercode ASC)      
      --SELECT DISTINCT usercode      
      --INTO   #code      
      --FROM   odin_limits o WITH (NOLOCK)      
      --WHERE  NOT EXISTS (SELECT DISTINCT usercode      
      --                   FROM   odin_limits b WITH (NOLOCK)      
      --                   WHERE  b.Group_Id IS NULL      
      --                          AND b.UserCode <> '-'      
      --                          AND o.UserCode = b.usercode)      
      --       AND NOT EXISTS (SELECT party_Code      
      --                       FROM   #PCODE C WITH(INDEX(Pcode))      
      --                       WHERE  o.UserCode = C.party_code)      
      --       AND usercode <> '-'      
      --       AND NOT EXISTS(SELECT usercode      
      --                      FROM   #UCODE u      
      --                      WHERE  o.UserCode = u.UserCode)      
      --SELECT period=b.perioducity,      
      --       b.value,      
      --       a.location,      
      --       a.usercode,      
      --       group_id,      
      --       udatetime,      
      --       periodicity,      
      --       max_order_value,      
      --       max_order_qty,      
      --       GE_limit_in_000s,      
      --       Net_Purchase_Premium_in_000s,      
      --       NSE_Write_Limit_in_000s      
      --INTO   #FILE1      
      --FROM   odin_limits a WITH (NOLOCK),      
      --       periodicity b WITH (NOLOCK)      
      --WHERE  /*a.usercode IN (SELECT usercode      
      --                                            FROM   #code)*/      
      --  EXISTS (SELECT usercode      
      --          FROM   #code c      
      --          WHERE  a.usercode = c.UserCode)      
      --  AND a.periodicity = b.Value      
      --  AND code IS NULL      
      --  AND symbol IS NULL      
      --  AND sgroup IS NULL      
      --  AND LOCATION NOT IN ( 'FORT_AKRUTI', 'FORT' )      
      --CREATE NONCLUSTERED INDEX Idx_Location      
      --  ON #FILE1 (location, period)      
      --SELECT x.location1,      
      --       x.perioducity,      
      --       x.dge_limit,      
      --       x.dqty_limit,      
      --       x.dvalue_limit,      
      --       x.dwrite_limit,      
      --       x.dpremium_limit,      
      --       y.period,      
      --       y.Value,      
      --       y.location,      
      --       y.UserCode,      
      --       y.Group_Id,      
      --       y.udatetime,      
      --       y.Periodicity,      
      --       y.Max_Order_Value,      
      --       y.Max_Order_Qty,      
      --       y.GE_Limit_in_000s,      
      --       y.Net_Purchase_Premium_in_000s,      
      --       y.NSE_Write_Limit_in_000s      
      --INTO   #DealerWiseDet      
      --FROM   (SELECT location1=a.location,      
      --               c.perioducity,      
      --               dge_limit,      
      --               dqty_limit,      
      --               dvalue_limit,      
      --               dwrite_limit,      
      --               dpremium_limit      
      --        FROM   location a WITH (NOLOCK),      
      --               (SELECT perioducity,      
      --                       value,      
      --                       dge_limit,      
      --                       dqty_limit,      
      --                       dvalue_limit,      
      --                       dwrite_limit,      
      --                       dpremium_limit      
      --                FROM   periodicity WITH (NOLOCK)      
      --                WHERE  dmode = 'checked') c) x      
      --       LEFT OUTER JOIN #FILE1 y      
      --         ON x.location1 = y.location      
      --            AND x.perioducity = y.period      
      --WHERE  ( dge_limit > 0      
      --         AND dge_limit < Replace(GE_Limit_in_000s, '-1', '99999999999') )      
      --        /*max order Qty*/      
      --        OR ( dqty_limit > 0      
      --             AND dqty_limit < Replace(Max_Order_qty, '-1', '999999999') )      
      --        /*max order Value*/      
      --        OR ( dvalue_limit > 0      
      --             AND dvalue_limit < Replace(Max_Order_value, '-1', '99999999999') )      
      --        /*Premium Limit*/      
      --        OR ( dpremium_limit > 0      
      --             AND dpremium_limit < Replace(net_purchase_premium_in_000s, '-1', '99999999999') )      
      --        /*Write Limit*/      
      --        OR ( dwrite_limit > 0      
      --             AND dwrite_limit < Replace(NSE_write_limit_in_000s, '-1', '99999999999') )            --ORDER  BY location1,      
      --          Usercode      
      /*Binding Temp Table For Automail Sending Email Userwise in html*/  
      DECLARE @XML          NVARCHAR(MAX),  
              @XML1         NVARCHAR(MAX),  
              @XML2         NVARCHAR(MAX),  
              @MAIL_BODY    VARCHAR(MAX),  
              @Email1       VARCHAR(max),  
              @Email2       VARCHAR(max),  
              @CCEmail      VARCHAR(MAX),  
              @TOEmail      VARCHAR(MAX),  
              @EmailSubject VARCHAR(MAX)  
  
      SET @XML = Cast((SELECT location1   AS 'TD',  
                              '',  
                              perioducity AS 'TD',  
                              '',  
                              CASE  
                                WHEN ( ne_limit > 0  
                                       AND ne_limit < NP_limit_in_000s ) THEN '#FCFC95'  
                                ELSE 'White'  
                              END         AS 'TD/@bgcolor',  
                              CASE  
                                WHEN perioducity = 'NSE Option Daily' THEN '-'  
                                ELSE  
                                  CASE  
                                    WHEN NP_limit_in_000s = '-1' THEN '-1.00'  
                                    ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), NP_limit_in_000s) / 10000000 )))  
                                  END  
                              END,  
                              CASE  
                                WHEN ( qty_limit > 0  
                                       AND qty_limit < Max_Order_Qty ) THEN 'LightBlue'  
                                ELSE 'White'  
                              END         AS 'TD/@bgcolor',  
                              CASE  
                                WHEN Max_Order_Qty = '-1' THEN '-1.00'  
                                ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), Max_Order_Qty) / 1000 ))  
                              END,  
                              CASE  
                                WHEN ( value_limit > 0  
                                       AND value_limit < Max_Order_value ) THEN '#9FD184'  
                                ELSE 'White'  
                              END         AS 'TD/@bgcolor',  
                              CASE  
                                WHEN Max_Order_value = '-1' THEN '-1.00'  
                                ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), Max_Order_value) / 10000000 ))  
                              END,  
                              CASE  
                                WHEN ( premium_limit > 0  
                                       AND premium_limit < Net_Purchase_Premium_in_000s ) THEN '#8D6CC3'  
                                ELSE 'White'  
                              END         AS 'TD/@bgcolor',  
                              CASE  
                                WHEN perioducity != 'NSE Option Daily' THEN '-'  
                                ELSE  
                                  CASE  
                                    WHEN net_purchase_premium_in_000s = '-1' THEN '-1.00'  
                                    ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), net_purchase_premium_in_000s) / 10000000 )))  
                                  END  
                              END,  
                              CASE  
                                WHEN ( write_limit > 0  
                                       AND write_limit < NSE_Write_Limit_in_000s ) THEN '#8D6CC3'  
                                ELSE 'White'  
                              END         AS 'TD/@bgcolor',  
                              CASE  
                                WHEN perioducity != 'NSE Option Daily' THEN '-'  
                                ELSE  
                                  CASE  
                                    WHEN NSE_write_limit_in_000s = '-1' THEN '-1.00'  
                ELSE CONVERT(VARCHAR, CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), NSE_write_limit_in_000s) / 10000000 )))  
                                  END  
                              END  
                       FROM   #MemberwiseDet  
                       ORDER  BY location1  
                       FOR XML PATH('TR'), ELEMENTS) AS NVARCHAR(MAX))  
      --SET @XML1 = Cast((SELECT location1   AS 'TD',      
      --                         '',      
      --                         UserCode    AS 'TD',      
      --                         '',      
      --                         perioducity AS 'TD',      
      --                         '',      
      --                         CASE      
      --                           WHEN ( cqty_limit > 0      
      --                                  AND cqty_limit < Max_Order_qty ) THEN 'LightBlue'      
      --                           ELSE 'White'      
      --                         END         AS 'TD/@bgcolor',      
      --                         CASE      
      --                           WHEN Max_Order_qty = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), Max_Order_qty) / 1000 ))      
      --                         END,      
      --                         CASE      
      --                           WHEN ( cvalue_limit > 0      
      --                                  AND cvalue_limit < Max_Order_value ) THEN '#9FD184'      
      --                           ELSE 'White'      
      --                         END         AS 'TD/@bgcolor',      
      --                         CASE      
      --                           WHEN Max_Order_value = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), Max_Order_value) / 10000000 ))      
      --                         END,      
      --                         CASE      
      --                           WHEN ( cne_limit > 0      
      --                                  AND ( cne_limit < NP_limit_in_000s      
      --                                         OR NP_limit_in_000s = '-1' ) ) THEN '#FCFC95'      
      --                           ELSE 'White'      
      --                         END         AS 'TD/@bgcolor',      
      --                         CASE      
      --                           WHEN NP_limit_in_000s = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), NP_limit_in_000s) / 1000000 ))      
      --                         END      
      --                  FROM   #GroupwiseDet      
      --                  ORDER  BY location1      
      --                  FOR XML PATH('TR'), ELEMENTS) AS NVARCHAR(MAX))      
      --SET @XML2 = Cast((SELECT location1 + '- ' + CONVERT(VARCHAR(20), udatetime, 113) AS 'TD',      
      --                         '',      
      --                         UserCode                                                AS 'TD',      
      --                         '',      
      --                         perioducity                                             AS 'TD',      
      --                         '',      
      --                         CASE      
      --                           WHEN ( dge_limit > 0      
      --                                  AND dge_limit < Replace(GE_limit_in_000s, '-1', '99999999999') ) THEN '#FCFC95'      
      --                           ELSE 'White'      
      --                         END                                                     AS 'TD/@bgcolor',      
      --                         CASE      
      --                           WHEN GE_limit_in_000s = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), GE_limit_in_000s) / 100000 ))      
      --                         END,      
      --                         CASE      
      --                           WHEN ( dqty_limit > 0      
      --                                  AND dqty_limit < Replace(max_order_qty, '-1', '999999999') ) THEN 'LightBlue'      
      --              ELSE 'White'      
      --                         END                                                     AS 'TD/@bgcolor',      
      --                         CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL, max_order_qty) )),      
      --                         CASE      
      --                           WHEN ( dvalue_limit > 0      
      --                                  AND dvalue_limit < Replace(Max_Order_Value, '-1', '99999999999') ) THEN '#9FD184'      
      --                           ELSE 'White'      
      --                         END                                                     AS 'TD/@bgcolor',      
      --                         CASE      
      --                           WHEN Max_Order_Value = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), Max_Order_Value) / 100000 ))      
      --                         END,      
      --                         CASE      
      --                           WHEN ( dpremium_limit > 0      
      --                                  AND dpremium_limit < Replace(Net_Purchase_Premium_in_000s, '-1', '99999999999') ) THEN '#8D6CC3'      
      --                           ELSE 'White'      
      --                         END                                                     AS 'TD/@bgcolor',      
      --                       CASE      
      --                           WHEN Net_Purchase_Premium_in_000s = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), Net_Purchase_Premium_in_000s) / 100000 ))      
      --                         END,      
      --                         CASE      
      --                           WHEN ( dwrite_limit > 0      
      --                                  AND dwrite_limit < Replace(NSE_write_limit_in_000s, '-1', '99999999999') ) THEN '#8D6CC3'      
      --                           ELSE 'White'      
      --                         END                                                     AS 'TD/@bgcolor',      
      --                         CASE      
      --                           WHEN NSE_write_limit_in_000s = '-1' THEN '-1.00'      
      --                           ELSE CONVERT(DECIMAL(14, 2), ( CONVERT(DECIMAL(15, 2), NSE_write_limit_in_000s) / 100000 ))      
      --                         END      
      --                  FROM   #DealerWiseDet      
      --                  ORDER  BY location1      
      --                  FOR XML PATH('TR'), ELEMENTS) AS NVARCHAR(MAX))      
      SET @MAIL_BODY ='<html><head>                
<style type="text/css">table{border-collapse:collapse;}table, td, th{border:1px solid black;}</style>                
</head><body><font face="Calibri"> Dear Team,<br \><br \>Kindly rectify the below rejections at Periodicity for Member level.      
<br/><br/><br/> 
<table border = 1 style="text-align:center;font-family:Calibri" >     
<!--<tr> <th colspan="8"><b> Memberwise Limit Report </b></th></tr>-->  
 <tr  style="background-color:#878787; font-family:Calibri;font-weight:bold;"align="center" >                
 <th> Location </th> <th> Perioducity </th><th>Net Exposure<br/>Limit (in Lakh)</th>      
<th> Max Order Qty<br/>Limit (in 000s) </th> <th> Max Order Val<br/>Limit (in Crs)</th><th> Premium Limit<br/>(In Crores) </th>      
<th> Write Limit<br/>(In Crores) </th> </tr> ' + @XML + '</tr></table><br/><br/>Thanking you,<br/>                
</body></html>'  
      -- <br/><br/>      
      --<TABLE border = 1 width="1000px">      
      --<tr> <th colspan="6"><b> Groupwise Limit Report </b></th></tr>       
      --<tr style="background-color:#F7AB5A">      
      --<th> Location </th> <th> Terminal </th> <th> Perioducity </th>       
      --<th> Max Order Qty Limit (in 000s) </th> <th> Max Order Val.Limit (in Crs) </th><th>Net Expo.Val.Limit(in 000Crs)</th></tr> ' + @XML1 + '</tr></TABLE>      
      --<br/><br/><br/><br/>       
      --<TABLE border = 1 width="1000px">      
      --<tr> <th colspan="8"><b> Dealerwise Limit Report </b></th></tr>       
      -- <tr style="background-color:#F7AB5A">      
      --<th> Location-Update date </th> <th> Terminal </th> <th> Perioducity </th> <th> Gross Exp.Limit (in Lakh)</th>       
      -- <th> Max Order Quantity Limit </th> <th> Max Order Value Limit</th>      
      --<th> Premium Limit </th> <th> Write Limit </th> </tr> ' + @XML2 + '</tr></TABLE>      
  /*Getting Email Data from function*/  
      SET @Email1=(SELECT MISC.dbo.Fn_getglobalemail('Limit_Violation_Automailer', 'CC'))      
      SET @CCEmail = (SELECT CASE      
                               WHEN LEFT(@Email1, 1) = ';' THEN Stuff(@Email1, 1, 1, '')      
                             END)      
      SET @EMAIL2=(SELECT MISC.dbo.Fn_getglobalemail('Limit_Violation_Automailer', 'TO'))      
      SET @TOEmail=(SELECT CASE      
                             WHEN LEFT(@EMAIL2, 1) = ';' THEN Stuff(@EMAIL2, 1, 1, '')      
                           END)    
      SET @EmailSubject='Member Level Limit Violation ('+ CONVERT(VARCHAR(11), Getdate(), 103) +')'  
  
      /*sending Mail userwise*/  
      EXEC MSDB.DBO.Sp_send_dbmail  
        @PROFILE_NAME='INTRANET',  
        @RECIPIENTS=@TOEmail,
        @COPY_RECIPIENTS=@CCEmail,      
        @SUBJECT =@EmailSubject,  
        @BODY =@MAIL_BODY,  
        @BODY_FORMAT = 'HTML'  
  END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.m1
-- --------------------------------------------------
create proc m1
as
Declare @tbl table (RowId int identity(1,1), Branch varchar(100))
Insert @tbl
SELECT Branch FROM ctcl_boltno order by Branch 
DECLARE  @i int
DECLARE  @countdata int
SET @i = 1 
DECLARE @Contact VARCHAR(100) 
select @countdata=count(Branch) from ctcl_boltno
WHILE (@i <=@countdata)
BEGIN
SELECT @Contact=Branch FROM @tbl  
WHERE RowId = @i 
Exec CTCLBranch1 @Contact   
set @i=@i+1
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.m2
-- --------------------------------------------------

CREATE procedure m2
as        

       
 
declare @sdate as datetime                    
select @sdate = (select max(trade_Date) from
(
select b.short_name,a.* --into #file2 
from (select distinct segment='BSECM',    
party_Code=a.t11,scrip_Cd=a.t4,scrip_name=a.t2,bs=a.t14,mktrate=a.t5,tradeqty=a.t6,    
trade_Date=a.t10,tradetime=a.t10,location=b.branch     
--into #bsecm
from tror_bse A,CTCLBSEBranch B 
where convert(int,A.t2) = convert(int,B.bsecm) 

union
select distinct segment='NSECM',    
party_Code=a.t15,scrip_Cd=rtrim(ltrim(a.t3))+'-'+a.t4,scrip_name=a.t5,bs=a.t11,mktrate=a.t13,tradeqty=a.t12,    
trade_Date=a.t20,tradetime=a.t20,location=b.branch     
--into #nsecm
from tror_nse A,ctcl_boltno B 
where convert(int,A.t9) = convert(int,B.nsecm) 

union
select distinct segment='NSEFO',    
party_Code=a.t17,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(a.t5,'-','')+'-'+a.t6+'-'+a.t7,    
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,    
trade_Date=a.t20,tradetime=a.t20,location=b.branch     
--into #nsefo
from tror_nsefo A,ctcl_boltno B where              
convert(int,A.t11) = convert(int,B.nsefo)
 
union
select distinct segment='MCX',    
party_Code=a.t19,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t4))+'-'+a.t5+'-'+a.t6+'-'+a.t7+'-'+a.t8,    
bs=a.t15,mktrate=a.t17,tradeqty=a.t16,    
trade_Date=a.t24,tradetime=a.t24,location=b.branch     
--into #mcx
 from tror_mcx A,ctcl_boltno B where convert(int,A.t14) = convert(int,B.mcx) 

union
select distinct segment='NCDEX',    
party_Code=a.t17,scrip_Cd=a.t1,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(t5,' ','')+'-'+a.t6+'-'+a.t7,    
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,    
trade_Date=a.t20,tradetime=a.t20,location=b.branch     
--into #ncdx
from tror_NCDEX A,ctcl_boltno B where convert(int,A.t11) = convert(int,B.NCDEX)
) a, risk.dbo.client_details b
where a.party_Code=b.party_Code
) as k1 )

delete from ctcl_Loc_hist where sauda_DAte = @sdate

GO

-- --------------------------------------------------
-- PROCEDURE dbo.m3
-- --------------------------------------------------
CREATE procedure m3
as        

insert into ctcl_Loc_hist                    
select sauda_DAte=convert(datetime,trade_Date),* from
(

select b.short_name,a.* --into #file2 
from (select distinct segment='BSECM',    
party_Code=a.t11,scrip_Cd=a.t4,scrip_name=a.t2,bs=a.t14,mktrate=a.t5,tradeqty=a.t6,    
trade_Date=a.t10,tradetime=a.t10,location=b.branch     
--into #bsecm
from tror_bse A,CTCLBSEBranch B 
where convert(int,A.t2) = convert(int,B.bsecm) 

union
select distinct segment='NSECM',    
party_Code=a.t15,scrip_Cd=rtrim(ltrim(a.t3))+'-'+a.t4,scrip_name=a.t5,bs=a.t11,mktrate=a.t13,tradeqty=a.t12,    
trade_Date=a.t20,tradetime=a.t20,location=b.branch     
--into #nsecm
from tror_nse A,ctcl_boltno B 
where convert(int,A.t9) = convert(int,B.nsecm) 

union
select distinct segment='NSEFO',    
party_Code=a.t17,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(a.t5,'-','')+'-'+a.t6+'-'+a.t7,    
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,    
trade_Date=a.t20,tradetime=a.t20,location=b.branch     
--into #nsefo
from tror_nsefo A,ctcl_boltno B where              
convert(int,A.t11) = convert(int,B.nsefo)
 
union
select distinct segment='MCX',    
party_Code=a.t19,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t4))+'-'+a.t5+'-'+a.t6+'-'+a.t7+'-'+a.t8,    
bs=a.t15,mktrate=a.t17,tradeqty=a.t16,    
trade_Date=a.t24,tradetime=a.t24,location=b.branch     
--into #mcx
 from tror_mcx A,ctcl_boltno B where convert(int,A.t14) = convert(int,B.mcx) 

union
select distinct segment='NCDEX',    
party_Code=a.t17,scrip_Cd=a.t1,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(t5,' ','')+'-'+a.t6+'-'+a.t7,    
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,    
trade_Date=a.t20,tradetime=a.t20,location=b.branch     
--into #ncdx
from tror_NCDEX A,ctcl_boltno B where convert(int,A.t11) = convert(int,B.NCDEX)
) a, risk.dbo.client_details b
where a.party_Code=b.party_Code
) as k2

GO

-- --------------------------------------------------
-- PROCEDURE dbo.m5
-- --------------------------------------------------
create proc m5
as
select party_code,sbtag,subgroup,b.sbname                     
into #aa     
from risk.dbo.finmast a,                    
risk.dbo.subgroup b where a.subgroup=b.sub_Broker  

create clustered index h1 on #aa(party_code) 


select sauda_Date,segment,Location,SHORT_NAME,party_code,turnover=sum((convert(money,mktrate)/100)*convert(int,tradeqty))
into #summ_a from ctcl_loc_hist 
group by sauda_Date,segment,location,SHORT_NAME,party_code  

create clustered index h2 on #summ_a(party_code) 

truncate table ctcl_LOC_summ   

insert into ctcl_loc_summ
select sauda_Date,segment,B.PARTY_CODE,b.sbtag,b.subgroup,b.sbname,    
turnover,Location,SHORT_NAME                     
--into #summ                    
from #summ_a a,#aa b where a.party_Code=b.party_code

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Member_limit
-- --------------------------------------------------
CREATE procedure Member_limit(@flag as varchar(1))
as

set nocount on

select x.*,y.* 
into #aa
from 
(
select location1=a.location,c.perioducity,value_limit,qty_limit,premium_limit,write_limit 
from location a , 
(
select perioducity,value,value_limit,qty_limit,premium_limit,write_limit 
from periodicity (nolock)
where value in (150,90,60,10,20,30)) c) x 
left outer join ( 
select period=b.perioducity,b.value,a.* 
from odin_limits_member a (nolock), periodicity b (nolock)
where a.periodicity=b.Value and usercode='-' and code is null and symbol is null and sgroup is null 
) y 
on x.location1=y.location and x.perioducity=y.period 

/*
if @flag='V' 
begin
	select * from
	(select * from #aa where location is null
	union
	select * from #aa where  (qty_limit > 0 and qty_limit < Max_Order_qty) or	(value_limit > 0 and value_limit < Max_Order_value)
	) a
	order by location1,perioducity 
end
else
begin
*/
	select * from #aa order by location1,perioducity 
--end
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MGS_ODIN_DP_BP
-- --------------------------------------------------
CREATE proc [dbo].[MGS_ODIN_DP_BP]              
as              
Select '120'+bp_id as 'bp_id',bp_role,bp_add1,bp_add2,bp_add3,bp_add4,            
bp_pin,bp_phone,bp_fax,bp_assd_cc_id,bp_assd_dp_id,            
bp_assd_cc_cmid,bp_category,bp_name,bp_stat             
into #ff            
from DpBackOffice.AcerCross.dbo.BPMaster             
where bp_name  like 'angel%' and bp_id = '33200'            
            
select replace(locacode,' ','') as locacode into #loca from testdb.dbo.ctclmgrlocation                   
          
truncate table temp_BP               
insert into temp_BP(bp_id,bp_role,bp_add1,bp_add2,bp_add3,bp_add4,bp_pin,bp_phone,bp_fax,bp_assd_cc_id,bp_assd_dp_id,bp_assd_cc_cmid,bp_category,bp_name,bp_stat)                  
select  * from #ff            
                
DECLARE @loca varchar(50),@s varchar(500),@path as varchar(50),@serverip     as varchar(20)         
  
select @path=data,@serverip=ip from  mis.dbo.MGS_Secured_Survillenace_Global(nolock)                      
                  
DECLARE Fgen_cursor CURSOR FOR                    
select locacode from #loca                 
                  
OPEN Fgen_cursor                                                            
                                                            
FETCH NEXT FROM Fgen_cursor                                                             
INTO @loca                                             
                                                           
WHILE @@FETCH_STATUS = 0                                                            
BEGIN                                                            
                
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'MD '+@path+'\'+@loca+'\'+convert(varchar(11),getdate(),112)+'\RM\Out'''                    
exec(@s)                  
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT data FROM testdb.dbo.Get_BP order by ord " queryout '+@path+'\'+@loca+'\'+convert(varchar(11),getdate(),112)+'\RM\Out\BP.txt -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'          
       
set @s= @s+''''                                                          
exec(@s)           
      
set @s = 'exec ['+@serverip+'].ServerSurvilliance.dbo.SP_RM_To_ODIN_Upload 5,'''+@loca+''''                
exec(@s)   
            
  FETCH NEXT FROM Fgen_cursor                                                             
  INTO @loca                                       
                                           
END                                   
                                              
CLOSE Fgen_cursor                                                
DEALLOCATE Fgen_cursor

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MGS_ODIN_DPMAP
-- --------------------------------------------------
CREATE proc [dbo].[MGS_ODIN_DPMAP]            
as                                                      
set nocount on                                                        
                                            
                                                
set transaction isolation level read uncommitted                                      
                        
                      
begin                          
            
 Select party_code as PCODE,PartyName as PName,aaa='',ddd='',bbb=4,ccc='',GroupID as tag,prd='',win='',server             
 into #odin_master                          
 from MIS.DBO.ctcl_vsat_79 (nolock)             
end                                              
            
Select --Top 10                                                       
PCode,1 as 'OPCode',Replace(Replace(Replace(Replace(tag,'Diet',''),'Net.net',''),'iWin',''),'NRI','') as 'Group Id',                                                      
PCode as 'Dealer ID', PName as  'Dealer Name'                                                      
,bbb as 'Dealer Category','NSDL' as 'Depository' ,server                                                     
into #odin_file                                                
from #odin_master                                                      
where                                                       
Replace(Replace(Replace(tag,'Diet',''),'Net.net',''),'iWin','') is not null                                                       
and (tag <> 'Diet'   or tag <> 'Net.net'   or tag <> 'iWin')                                                       
and tag <> ''                                                 
                                                
                                      
Select Left(cm_cd,8) as 'DPID','ANGEL BROKING LIMITED'  as 'DP Name',                                                      
Convert(BigInt,Right(cm_cd,8)) as 'BID',Convert(Int,LTrim(RTrim(cm_acctype))) as 'BID Type',LTrim(RTrim('  ')) as 'BId SubType'                                                      
,Convert(Int,cm_active) as 'BId Status',                                                      
Left(cm_name,16) as 'BId Short Name',                                                      
Left(cm_name,135) as 'BId FHolder Name',                         
'1' as Priority,cm_blsavingcd                                                      
into #dpfile                                                
from [196.1.115.199].synergy.dbo.client_master where cm_schedule= '49843750'                                                       
                                                
                                                      
Select *                                                       
into #DPMapping7101                                           
from  #odin_file  a  Left Outer Join  #dpfile x on  x.cm_blsavingcd = a.PCode                                                      
where                                                       
DPId is not null                                                      
                                                
update #DPMapping7101  set priority=0                                                
                                                
update #DPMapping7101  set priority=1 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
                                                
update #DPMapping7101  set priority=2 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  where priority <> 1 group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
                                                
update #DPMapping7101  set priority=3 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  where priority not between 1  and  2  group by pcode) b             
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid          
                                                
update #DPMapping7101  set priority=4 from                      
(select pcode, bid=max(bid) from #DPMapping7101  where priority not between 1  and  3  group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
                                                
update #DPMapping7101  set priority=5 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  where priority not between 1  and  4  group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
              
truncate table  temp_DPMAPPING                                           
insert into temp_DPMAPPING            
Select Data=','+max([Group Id])+','+[Dealer ID]+','+convert(varchar(30),BID)+','+convert(varchar(30),DPID)+','+Depository+','+Priority,server            
--into temp_DPMAPPING            
from #DPMapping7101                  
group by                 
[Dealer ID],Depository,DPID,BID,Priority,server                 
order by Priority            
            
DECLARE                                                         
@loca varchar(50),@s varchar(500)  ,@path as varchar(50),@serverip     as varchar(20)           
    
select @path=data,@serverip=ip from  mis.dbo.MGS_Secured_Survillenace_Global(nolock)            
              
DECLARE Fgen_cursor CURSOR FOR                
/*select distinct   location from #final where location like 'KOLK%'*/              
select replace(locacode,' ','') from testdb.dbo.ctclmgrlocation               
              
OPEN Fgen_cursor                                                        
                                                        
FETCH NEXT FROM Fgen_cursor                                                         
INTO @loca                                         
                                                       
WHILE @@FETCH_STATUS = 0                                                        
BEGIN                                                        
               
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'MD '+@path+'\'+@loca+'\'+convert(varchar(11),getdate(),112)+'\RM\Out'''                
exec(@s)              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT data FROM testdb.dbo.temp_DPMAPPING where server='''''+@loca+'''''" queryout '+@path+'\'+@loca+'\'+convert(varchar(11),getdate(),112)+'\RM\Out\DPMAPPING.txt -c -Sintranet -Uaolinhouse -Pe$$gnfDTVs2455GZAcc'      
  
                                                
set @s= @s+''''                                                      
exec(@s)          
set @s = 'exec ['+@serverip+'].ServerSurvilliance.dbo.SP_RM_To_ODIN_Upload 8,'''+@loca+''''                  
exec(@s)        
  FETCH NEXT FROM Fgen_cursor                                                         
  INTO @loca                                   
                                       
END                               
                                          
CLOSE Fgen_cursor                                            
DEALLOCATE Fgen_cursor              
          
set nocount oFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.MGS_ODIN_DPMAP31122012
-- --------------------------------------------------
CREATE proc MGS_ODIN_DPMAP31122012            
as                                                      
set nocount on                                                        
                                            
                                                
set transaction isolation level read uncommitted                                      
                        
                      
begin                          
            
 Select party_code as PCODE,PartyName as PName,aaa='',ddd='',bbb=4,ccc='',GroupID as tag,prd='',win='',server             
 into #odin_master                          
 from MIS.DBO.ctcl_vsat_79 (nolock)             
end                                              
            
Select --Top 10                                                       
PCode,1 as 'OPCode',Replace(Replace(Replace(Replace(tag,'Diet',''),'Net.net',''),'iWin',''),'NRI','') as 'Group Id',                                                      
PCode as 'Dealer ID', PName as  'Dealer Name'                                                      
,bbb as 'Dealer Category','NSDL' as 'Depository' ,server                                                     
into #odin_file                                                
from #odin_master                                                      
where                                                       
Replace(Replace(Replace(tag,'Diet',''),'Net.net',''),'iWin','') is not null                                                       
and (tag <> 'Diet'   or tag <> 'Net.net'   or tag <> 'iWin')                                                       
and tag <> ''                                                 
                                                
                                      
Select Left(cm_cd,8) as 'DPID','ANGEL BROKING LIMITED'  as 'DP Name',                                                      
Convert(BigInt,Right(cm_cd,8)) as 'BID',Convert(Int,LTrim(RTrim(cm_acctype))) as 'BID Type',LTrim(RTrim('  ')) as 'BId SubType'                                                      
,Convert(Int,cm_active) as 'BId Status',                                                      
Left(cm_name,16) as 'BId Short Name',                                                      
Left(cm_name,135) as 'BId FHolder Name',                         
'1' as Priority,cm_blsavingcd                                                      
into #dpfile                                                
from DpBackOffice.AcerCross.dbo.Client_Master where cm_schedule= '49843750'                                                       
                                                
                                                      
Select *                                                       
into #DPMapping7101                                           
from  #odin_file  a  Left Outer Join  #dpfile x on  x.cm_blsavingcd = a.PCode                                                      
where                                                       
DPId is not null                                                      
                                                
update #DPMapping7101  set priority=0                                                
                                                
update #DPMapping7101  set priority=1 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
                                                
update #DPMapping7101  set priority=2 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  where priority <> 1 group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
                                                
update #DPMapping7101  set priority=3 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  where priority not between 1  and  2  group by pcode) b             
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid          
                                                
update #DPMapping7101  set priority=4 from                      
(select pcode, bid=max(bid) from #DPMapping7101  where priority not between 1  and  3  group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
                                                
update #DPMapping7101  set priority=5 from                                                
(select pcode, bid=max(bid) from #DPMapping7101  where priority not between 1  and  4  group by pcode) b                                                 
where #DPMapping7101.pcode=b.pcode and #DPMapping7101.bid=b.bid                                                
              
truncate table  temp_DPMAPPING                                           
insert into temp_DPMAPPING            
Select Data=','+max([Group Id])+','+[Dealer ID]+','+convert(varchar(30),BID)+','+convert(varchar(30),DPID)+','+Depository+','+Priority,server            
--into temp_DPMAPPING            
from #DPMapping7101                  
group by                 
[Dealer ID],Depository,DPID,BID,Priority,server                 
order by Priority            
            
DECLARE                                                         
@loca varchar(50),@s varchar(500)  ,@path as varchar(50),@serverip     as varchar(20)           
    
select @path=data,@serverip=ip from  mis.dbo.MGS_Secured_Survillenace_Global(nolock)            
              
DECLARE Fgen_cursor CURSOR FOR                
/*select distinct   location from #final where location like 'KOLK%'*/              
select replace(locacode,' ','') from testdb.dbo.ctclmgrlocation               
              
OPEN Fgen_cursor                                                        
                                                        
FETCH NEXT FROM Fgen_cursor                                                         
INTO @loca                                         
                                                       
WHILE @@FETCH_STATUS = 0                                                        
BEGIN                                                        
               
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'MD '+@path+'\'+@loca+'\'+convert(varchar(11),getdate(),112)+'\RM\Out'''                
exec(@s)              
set @s = 'exec MASTER.dbo.xp_cmdshell '+ '''' +'bcp  "SELECT data FROM testdb.dbo.temp_DPMAPPING where server='''''+@loca+'''''" queryout '+@path+'\'+@loca+'\'+convert(varchar(11),getdate(),112)+'\RM\Out\DPMAPPING.txt -c -Sintranet -Usa -Pnirwan612'      
  
                                                
set @s= @s+''''                                                      
exec(@s)          
set @s = 'exec ['+@serverip+'].ServerSurvilliance.dbo.SP_RM_To_ODIN_Upload 8,'''+@loca+''''                  
exec(@s)        
  FETCH NEXT FROM Fgen_cursor                                                         
  INTO @loca                                   
                                       
END                               
                                          
CLOSE Fgen_cursor                                            
DEALLOCATE Fgen_cursor              
          
set nocount oFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Online_payin
-- --------------------------------------------------
create PROCEDURE Online_payin(@tdate as varchar(11),@TYPE AS VARCHAR(10),@CODE AS VARCHAR(10))
AS

IF @TYPE='BROKER'
BEGIN
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	select branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code], 
	long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date], 
	SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] 
	from temp_mis_file1 a, risk.dbo.client_details b (nolock)  
	where a.sLoginId =b.party_code 
	and a.sDateTime >= @tdate+' 00:00:00' and a.sDateTime <= @tdate+' 23:59:59'
	order by SloginId, sDateTime desc 
END
IF @TYPE='BRANCH'
BEGIN
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	select branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code], 
	long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date], 
	SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] 
	from temp_mis_file1 a, risk.dbo.client_details b (nolock)  
	where a.sLoginId =b.party_code 
	and b.branch_cd like @code
	and a.sDateTime >= @tdate+' 00:00:00' and a.sDateTime <= @tdate+' 23:59:59'
	order by SloginId, sDateTime desc 
END

IF @TYPE='REGION'
BEGIN
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	select branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code], 
	long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date], 
	SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] 
	from temp_mis_file1 a, risk.dbo.client_details b (nolock)  
	where a.sLoginId =b.party_code 
	and b.branch_cd IN ( SELECT CODE FROM REGION (NOLOCK) WHERE REG_cODE = @CODE )
	and a.sDateTime >= @tdate+' 00:00:00' and a.sDateTime <= @tdate+' 23:59:59'
	order by SloginId, sDateTime desc 

END

IF @TYPE='SB'
BEGIN
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	select branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code], 
	long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date], 
	SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] 
	from temp_mis_file1 a, risk.dbo.client_details b (nolock)  
	where a.sLoginId =b.party_code 
	and b.sub_Broker =@code
	and a.sDateTime >= @tdate+' 00:00:00' and a.sDateTime <= @tdate+' 23:59:59'
	order by SloginId, sDateTime desc 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf
-- --------------------------------------------------
 --exec OnlineFundsTrf_03Aug2018 '01/08/2018 00:00:00','01/08/2018 23:59:59','I9015','ALSE','SB','%%'              
CREATE procedure [dbo].[OnlineFundsTrf] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [196.1.115.227].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from AngelBSECM.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 into #bb1 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc     
 
  select  TransactionReferenceNo,VerificationDate,a.party_code into #qq1   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog a, risk.dbo.client_details b (nolock)                      
 where a.party_code =b.party_code                     
 and b.sub_Broker = @user  and TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  a.party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,a.party_code into #ww1   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog a, risk.dbo.client_details b (nolock)                      
 where a.party_code =b.party_code                     
 and b.sub_Broker = @user   and TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  a.party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o11
   from [196.1.115.227].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code  and b.sub_Broker = @user   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI1
 from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain1 from #UPI1 a, risk.dbo.client_details b                        
 where a.ClientCode =b.party_code   and b.sub_Broker = @user 

insert into #UPIMain1([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from AngelBSECM.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b                        
 where a.CltCode =b.party_code  and a.RETURN_FLD5='MSIL'   and b.sub_Broker = @user and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #qq1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #ww1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o11  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain1
                 
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_03Aug2018
-- --------------------------------------------------
 --exec OnlineFundsTrf_03Aug2018 '01/08/2018 00:00:00','01/08/2018 23:59:59','I9015','ALSE','SB','%%'              
CREATE procedure [dbo].[OnlineFundsTrf_03Aug2018] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 into #bb1 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc     
 
  select  TransactionReferenceNo,VerificationDate,a.party_code into #qq1   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog a, risk.dbo.client_details b (nolock)                      
 where a.party_code =b.party_code                     
 and b.sub_Broker = @user  and TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  a.party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,a.party_code into #ww1   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog a, risk.dbo.client_details b (nolock)                      
 where a.party_code =b.party_code                     
 and b.sub_Broker = @user   and TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  a.party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o11
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code  and b.sub_Broker = @user   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI1
 from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain1 from #UPI1 a, risk.dbo.client_details b                        
 where a.ClientCode =b.party_code   and b.sub_Broker = @user 

insert into #UPIMain1([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b                        
 where a.CltCode =b.party_code  and a.RETURN_FLD5='MSIL'   and b.sub_Broker = @user and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #qq1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #ww1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o11  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain1
                 
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_06Aug2018
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'  
 --exec OnlineFundsTrf '06/01/2018 00:00:00','07/21/2018 23:59:59','%','PANL','SB','%%'            
create procedure [dbo].[OnlineFundsTrf_06Aug2018] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type) in( 'BROKER')
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc   
 
                   
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_08Dec2017
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'              
CREATE procedure [dbo].[OnlineFundsTrf_08Dec2017] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_11072018
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'              
Create procedure [dbo].[OnlineFundsTrf_11072018] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_12072018
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'              
Create procedure [dbo].[OnlineFundsTrf_12072018] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type) = ('BROKER')
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc   
 
                   
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_13042018
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'              
CREATE procedure [dbo].[OnlineFundsTrf_13042018] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 into #bb1 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc     
 
  select  TransactionReferenceNo,VerificationDate,party_code into #qq1   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww1   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o11
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI1
 from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain1 from #UPI1 a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain1([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #qq1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #ww1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o11  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain1
                 
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_14Jul2017
-- --------------------------------------------------
      
CREATE procedure [dbo].[OnlineFundsTrf_14Jul2017] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
     
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   
  
                 
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_24Jul2015
-- --------------------------------------------------
      
CREATE procedure OnlineFundsTrf_24Jul2015(@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc      
                 
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                            
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_30072021
-- --------------------------------------------------
 --exec OnlineFundsTrf_03Aug2018 '01/08/2018 00:00:00','01/08/2018 23:59:59','I9015','ALSE','SB','%%'              
Create procedure [dbo].[OnlineFundsTrf_30072021] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 into #bb1 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc     
 
  select  TransactionReferenceNo,VerificationDate,a.party_code into #qq1   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog a, risk.dbo.client_details b (nolock)                      
 where a.party_code =b.party_code                     
 and b.sub_Broker = @user  and TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  a.party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,a.party_code into #ww1   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog a, risk.dbo.client_details b (nolock)                      
 where a.party_code =b.party_code                     
 and b.sub_Broker = @user   and TransactionReferenceNo in (select [Txn.Ref.No.] from #bb1)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  a.party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o11
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code  and b.sub_Broker = @user   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI1
 from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain1 from #UPI1 a, risk.dbo.client_details b                        
 where a.ClientCode =b.party_code   and b.sub_Broker = @user 

insert into #UPIMain1([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b                        
 where a.CltCode =b.party_code  and a.RETURN_FLD5='MSIL'   and b.sub_Broker = @user and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #qq1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb1 a inner join #ww1 b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o11  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain1
                 
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_Ipanter
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'                
CREATE procedure [dbo].[OnlineFundsTrf_Ipanter] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                      
as                      
set nocount on                      
if upper(@type)='BROKER'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                       
 into #bb    
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                   
 order by sDateTime desc     
     
 select  TransactionReferenceNo,VerificationDate,party_code into #qq     
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)    
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode    
    
 select  TransactionReferenceNo,VerificationDate,party_code into #ww     
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)    
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode    
  
  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],  
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1  
   from [196.1.115.227].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                          
 where a.client_code =b.party_code     
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and  
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */  
 and a.TransReq_dtm>=@fdate and  
  a.TransReq_dtm <=@tdate and a.status='Success'    
 and a.client_code like @clcode and segmentcode like @segment              
 order by TransReq_dtm desc       
  
select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join   
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode  
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode    
and b.entity like @segment   
  
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]  
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate  
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                          
 where a.ClientCode =b.party_code     
  
insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)  
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],  
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate  
 from AngelBSECM.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                          
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and  
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode    
and a.exchange like @segment   
      
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],    
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo    
    
union all     
     
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],    
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo     
  
union all  
  
select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],  
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]       
from #o1    
  
union all   
  
select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],  
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]  
 from #UPIMain  
                  
END                      
if upper(@type)='REGION'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                           
 order by sDateTime desc                       
END                      
                      
if upper(@type)='BRMAST'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                      
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                       
END                      
                      
if upper(@type)='BRANCH'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.branch_cd = @user                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                     
 order by sDateTime desc                       
END                      
if upper(@type)='SBMAST'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                    
 order by sDateTime desc                       
END                  
                      
if upper(@type)='SB'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                           
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.sub_Broker = @user                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                    
 order by sDateTime desc                       
END                      
                      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_Ipanter_30072021
-- --------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'                
Create procedure [dbo].[OnlineFundsTrf_Ipanter_30072021] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                      
as                      
set nocount on                      
if upper(@type)='BROKER'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                       
 into #bb    
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                   
 order by sDateTime desc     
     
 select  TransactionReferenceNo,VerificationDate,party_code into #qq     
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)    
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode    
    
 select  TransactionReferenceNo,VerificationDate,party_code into #ww     
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)    
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode    
  
  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],  
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1  
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                          
 where a.client_code =b.party_code     
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and  
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */  
 and a.TransReq_dtm>=@fdate and  
  a.TransReq_dtm <=@tdate and a.status='Success'    
 and a.client_code like @clcode and segmentcode like @segment              
 order by TransReq_dtm desc       
  
select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join   
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode  
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode    
and b.entity like @segment   
  
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]  
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate  
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                          
 where a.ClientCode =b.party_code     
  
insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)  
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],  
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate  
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                          
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and  
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode    
and a.exchange like @segment   
      
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],    
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo    
    
union all     
     
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],    
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo     
  
union all  
  
select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],  
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]       
from #o1    
  
union all   
  
select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],  
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]  
 from #UPIMain  
                  
END                      
if upper(@type)='REGION'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                           
 order by sDateTime desc                       
END                      
                      
if upper(@type)='BRMAST'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                      
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                       
END                      
                      
if upper(@type)='BRANCH'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.branch_cd = @user                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                     
 order by sDateTime desc                       
END                      
if upper(@type)='SBMAST'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                            
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                    
 order by sDateTime desc                       
END                  
                      
if upper(@type)='SB'                      
BEGIN                      
 set transaction isolation level read uncommitted                       
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                       
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                       
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                           
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                        
 where a.sLoginId =b.party_code                       
 and b.sub_Broker = @user                      
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                      
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                    
 order by sDateTime desc                       
END                      
                      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_Ipartner
-- --------------------------------------------------
----132   testdb


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'              
CREATE procedure [dbo].[OnlineFundsTrf_Ipartner] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [196.1.115.227].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from AngelBSECM.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_Ipartner_Bkp30July2021
-- --------------------------------------------------
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 --exec OnlineFundsTrf_14Jul2017 '07/18/2017 00:00:00','07/18/2017 23:59:59','%','CSO','BROKER','%%'              
Create procedure [dbo].[OnlineFundsTrf_Ipartner_Bkp30July2021] (@fdate as varchar(15),@tdate as varchar(15),@clcode as varchar(20), @user as varchar(20),@type as varchar(10),@segment as varchar(15))                    
as                    
set nocount on                    
if upper(@type)='BROKER'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                     
 into #bb  
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code and a.sDateTime >= @fdate and a.sDateTime <= @tdate                  
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                 
 order by sDateTime desc   
   
 select  TransactionReferenceNo,VerificationDate,party_code into #qq   
 from Accounts.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  
  
 select  TransactionReferenceNo,VerificationDate,party_code into #ww   
 from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog where TransactionReferenceNo in (select [Txn.Ref.No.] from #bb)  
 and VerificationDate >= @fdate and VerificationDate <= @tdate and  party_code like @clcode  

  select  b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.Client_Code,b.long_name as [Party Name],
  a.SegmentCode,a.Amount,a.TransReq_dtm,space(500) as bankname,a.MerchantTxnId,'AngelTrade' as product,a.TransResp_dtm into #o1
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a, risk.dbo.client_details b (nolock)                        
 where a.client_code =b.party_code   
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */
 and a.TransReq_dtm>=@fdate and
  a.TransReq_dtm <=@tdate and a.status='Success'  
 and a.client_code like @clcode and segmentcode like @segment            
 order by TransReq_dtm desc     

select a.BankRefNo,a.ClientCode,a.AMount,a.PostStatus,a.InsertedOn,b.InsertedOn as ddate,b.entity into #UPI from Risk.dbo.tbl_BoPostUPITransaction a join 
Risk.dbo.MSIL_MKTAPIBOPOSTDATA  b on a.BankRefNo=b.ftbankrefno and a.ClientCode=b.ClientCode
where a.poststatus='SUCCESS'  and a.insertedOn >= @fdate and a.insertedOn <= @tdate and  a.ClientCode like @clcode  
and b.entity like @segment 

select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.ClientCode,b.long_name as [Party Name]
,a.entity,a.AMount,a.insertedOn,space(500) as bankname,a.BankRefNo,'UPI' as product,a.ddate
into #UPIMain from #UPI a, risk.dbo.client_details b (nolock)                        
 where a.ClientCode =b.party_code   

insert into #UPIMain([Br.Code],[SB.Code],ClientCode,[Party Name],entity,AMount,insertedOn,bankname,BankRefNo,product,ddate)
select b.branch_cd as [Br.Code],b.Sub_Broker as [SB.Code],a.CltCode,b.long_name as [Party Name],
a.exchange,a.CREDITAMT,a.vdate,a.Bankname,a.ddno,'UPI' as product,a.vdate
 from anand.MKTAPI.dbo.tbl_post_data a , risk.dbo.client_details b (nolock)                        
 where a.CltCode =b.party_code   and a.RETURN_FLD5='MSIL' and
a.vdate >= @fdate and a.vdate <= @tdate and  a.CltCode like @clcode  
and a.exchange like @segment 
    
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #qq b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo  
  
union all   
   
select  a.[Br.Code],a.[SB.Code],a.[Party Code],a.[Party Name],a.[Segment],a.[Amount],a.[Txn.Date],a.[Bank],a.[Bank Ref.No.],a.[Txn.Ref.No.],  
a.[Product],b.VerificationDate as [verification date] from #bb a inner join #ww b on a.[Party Code]=b.party_code and a.[Txn.Ref.No.]=b.TransactionReferenceNo   

union all

select [Br.Code],[SB.Code],Client_Code as [Party Code],[Party Name],SegmentCode as [Segment],[Amount],TransReq_dtm as [Txn.Date],
bankname as [bank],MerchantTxnId as [Bank Ref.No.],space(500) as [Txn.Ref.No.],[Product],TransResp_dtm as [verification date]     
from #o1  

union all 

select [Br.Code],[SB.Code],ClientCode as [Party Code],[Party Name],entity as [Segment],[AMount],insertedOn  as [Txn.Date],
bankname as [bank],space(500) as  [Bank Ref.No.],BankRefNo  as [Txn.Ref.No.],[product],ddate  as [verification date]
 from #UPIMain
                
END                    
if upper(@type)='REGION'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select code from risk.dbo.region (nolock) where reg_Code = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                         
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd in (Select branch_cd from risk.dbo.branch_master (nolock) where brMast_cd = @user)                    
 and a.sDateTime >= @fdate /*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode  and sUserDefinedExchangeName like @segment                                 
 order by sDateTime desc                     
END                    
                    
if upper(@type)='BRANCH'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.branch_cd = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                   
 order by sDateTime desc                     
END                    
if upper(@type)='SBMAST'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.],Product                          
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_BRoker in (Select Sub_BRoker from risk.dbo.sb_master (nolock) where SbMast_cd = @user)                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                
                    
if upper(@type)='SB'                    
BEGIN                    
 set transaction isolation level read uncommitted                     
 select distinct branch_cd as [Br.Code],Sub_Broker as [SB.Code],SloginId as [Party Code],                     
 long_name as [Party Name],sUserDefinedExchangeName as [Segment],nAmount as [Amount],sDateTime as [Txn.Date],                     
 SBankId as [Bank],sBankRefNo as [Bank Ref.No.],NTxnRefNo as [Txn.Ref.No.] ,Product                         
 from V_temp_mis_file1 a, risk.dbo.client_details b (nolock)                      
 where a.sLoginId =b.party_code                     
 and b.sub_Broker = @user                    
 and a.sDateTime >= @fdate/*' 00:00:00'*/ and a.sDateTime <= @tdate/*' 23:59:59'*/                    
 and a.sloginid like @clcode and sUserDefinedExchangeName like @segment                                  
 order by sDateTime desc                     
END                    
                    
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_TransactionRpt
-- --------------------------------------------------
-- =============================================
-- Author:		<Neha Naiwar>
-- Create date: <06 July 2021>
-- Description:	<For Payin>
-- exec OnlineFundsTrf_TransactionRpt '07/07/2021 00:00:00','07/07/2021 23:59:59','K281393','Borker','CSO'                
-- =============================================
CREATE PROCEDURE [dbo].[OnlineFundsTrf_TransactionRpt] 
(
@fdate as varchar(15),
@tdate as varchar(15),
@clcode as varchar(20),
@access_to AS VARCHAR(10)=null,          
@access_code AS VARCHAR(12)=null          
)                      
AS
BEGIN
select distinct * into #tbl_ErrorCode_Master from tbl_ErrorCode_Master

	select a.Client_Code,a.Amount,InternalRef_No,bankref_no,/*Status*/VerificationStatus as Status,a.MerchantTxnId,TransReq_dtm,a.TransResp_dtm,segmentcode,
	'xxxxx'+right(a.RespAccountNo,4) as RespAccountNo,RespBankname,Errorcode,isnull(b.errorcode_name,'') as ErrorName
	 into #o1  
   from /*[172.31.16.75]*/ [196.1.115.227].Angel_Admin.dbo.PG_Transaction a with(nolock) left join #tbl_ErrorCode_Master b (nolock)                          
 on a.Errorcode =b.errorcode_id     
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and  
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */  
  --a.TransReq_dtm>='06/07/2021 00:00:00' and  
  --a.TransReq_dtm <='06/07/2021 23:59:59'  
 where a.TransReq_dtm  BETWEEN CONVERT(DATETIME,@FDATE,103)                                 
    AND CONVERT(DATETIME,@TDATE,103)+' 23:59:59:0'   
 and  rtrim(ltrim(a.client_code)) = rtrim(ltrim(@clcode))
 order by a.TransReq_dtm desc
 
 select * from #o1  
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.OnlineFundsTrf_TransactionRpt_30072021
-- --------------------------------------------------
-- =============================================
-- Author:		<Neha Naiwar>
-- Create date: <06 July 2021>
-- Description:	<For Payin>
-- exec OnlineFundsTrf_TransactionRpt '07/07/2021 00:00:00','07/07/2021 23:59:59','K281393','Borker','CSO'                
-- =============================================
Create PROCEDURE [dbo].[OnlineFundsTrf_TransactionRpt_30072021] 
(
@fdate as varchar(15),
@tdate as varchar(15),
@clcode as varchar(20),
@access_to AS VARCHAR(10)=null,          
@access_code AS VARCHAR(12)=null          
)                      
AS
BEGIN
select distinct * into #tbl_ErrorCode_Master from tbl_ErrorCode_Master

	select a.Client_Code,a.Amount,InternalRef_No,bankref_no,Status,a.MerchantTxnId,TransReq_dtm,a.TransResp_dtm,segmentcode,
	RespAccountNo,RespBankname,Errorcode,isnull(b.errorcode_name,'') as ErrorName
	 into #o1  
   from [172.31.16.75].Angel_Admin.dbo.PG_Transaction a with(nolock) left join #tbl_ErrorCode_Master b (nolock)                          
 on a.Errorcode =b.errorcode_id     
 /*and a.TransReq_dtm>=replace(CONVERT(VARCHAR(12),convert(datetime,@fdate,103),106), '/', ' ')+' 00:00:00' and  
  a.TransReq_dtm <=replace(CONVERT(VARCHAR(12),convert(datetime,@tdate,103),106), '/', ' ')+' 23:59:59'  and a.status='Success'                       */  
  --a.TransReq_dtm>='06/07/2021 00:00:00' and  
  --a.TransReq_dtm <='06/07/2021 23:59:59'  
 where a.TransReq_dtm  BETWEEN CONVERT(DATETIME,@FDATE,103)                                 
    AND CONVERT(DATETIME,@TDATE,103)+' 23:59:59:0'   
 and  rtrim(ltrim(a.client_code)) = rtrim(ltrim(@clcode))
 order by a.TransReq_dtm desc
 
 select * from #o1  
 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PMS_trade_data
-- --------------------------------------------------
CREATE  procedure [dbo].[PMS_trade_data](@pcode as varchar(10),@fcode as varchar(10),@tdate as varchar(11))      
as      
--------------------------------------- BSE Query      
      
set nocount on     
      
set transaction isolation level read uncommitted      
      
select * into #bse_party from      
(      
select party_Code from AngelBSECM.bsedb_ab.dbo.client2 where cl_code in       
(select cl_Code from AngelBSECM.bsedb_ab.dbo.client1 where family=@fcode)      
union      
select party_code=@pcode      
) a      
      
select  SEBI_NO='INB010996539',ContractNo,Exchange='B',TradeDate=convert(varchar(11),Sauda_Date,103),      
segment1=(Case when sett_type='D' then 'Rolling' else 'T2T' end),      
settlement_number=substring(sett_no,5,3),      
settlement_year=substring(sett_no,1,4),      
Backofficecode=party_code,      
bse_code=scrip_Cd,      
nse_symbol=space(25),      
nse_group='EQ',      
isin=space(20),      
scrip_name=space(25),      
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),      
traded_quantity=tradeqty,      
marketrate,      
N_netrate,      
--N_netrate=
--(CASE 
--when sell_buy=1 then ((N_NETRATE*tradeqty)+(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty
--when sell_buy=2 then ((N_NETRATE*tradeqty)-(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty
--else 0 end),      
NserTax=NserTax,      
Trans_chgs=Ins_chrg,  
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,      
--other_chrg=0,      
stock_payin=space(25),      
stock_payout=space(25),      
cash_payin=space(25),      
cash_payout=space(25)      
into #bse_file1      
from AngelBSECM.bsedb_ab.dbo.settlement 
where party_code IN (SELECT  * FROM #bse_party)      
and sauda_date>=@tdate+' 00:00:00'       
and sauda_date<=@tdate+' 23:59:59'       
and sett_type in ('D','C')      
and status <> 'N'
      
update #bse_file1 set isin=b.isin from       
(select * from angeldemat.bsedb.dbo.multiisin where valid =1 ) b where       
#bse_file1.bse_code=b.scrip_cd      
      
      
update #bse_file1 set scrip_name=b.long_name from       
(select b.bsecode,a.long_name from AngelBSECM.bsedb_Ab.dbo.scrip1 a, AngelBSECM.bsedb_Ab.dbo.scrip2 b where a.co_code=b.co_code) b      
where #bse_file1.bse_code=b.bsecode      
      
      
update #bse_file1 set       
stock_payin=convert(varchar(11),sec_payin,103)      
,stock_payout=convert(varchar(11),sec_payout,103)      
,cash_payin=convert(varchar(11),b.funds_payin,103)      
,cash_payout=convert(varchar(11),b.funds_payout,103)      
from AngelBSECM.bsedb_ab.dbo.sett_mst b      
where b.sett_type=(Case when #bse_file1.segment1='Rolling' then 'D' else 'C' end)      
and b.sett_no=settlement_year+''+settlement_number      
      
--------------------------------------------------- NSE      
/*      
select * into #nse_party from      
(      
select party_Code from AngelNseCM.msajag.dbo.client2 where cl_code in       
(select cl_Code from AngelNseCM.msajag.dbo.client1 where family=@fcode)      
union      
select party_code=@pcode      
) a      
      
      
select  SEBI_NO='INB230600236',ContractNo,Exchange='N',TradeDate=convert(varchar(11),Sauda_Date,103),      
segment1=(Case when sett_type='N' then 'Normal' else 'T2T' end),      
settlement_number=substring(sett_no,5,3),      
settlement_year=substring(sett_no,1,4),      
Backofficecode=party_code,      
bse_code=space(10),      
nse_symbol=scrip_cd,      
nse_group=series,      
isin=space(20),      
scrip_name=space(25),      
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),      
traded_quantity=tradeqty,      
marketrate,      
N_netrate,      
NserTax,      
Trans_chgs=Ins_chrg,      
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,      
stock_payin=space(25),      
stock_payout=space(25),      
cash_payin=space(25),      
cash_payout=space(25)      
into #nse_file1      
from AngelNseCM.msajag.dbo.settlement       
where party_code IN (SELECT party_code FROM #nse_party)   
and sauda_date>=@tdate+' 00:00:00'       
and sauda_date<=@tdate+' 23:59:59'       
and sett_type in ('N','W')      
      
      
update #nse_file1 set isin=b.isin from       
(select * from angeldemat.msajag.dbo.multiisin where valid =1) b where       
#nse_file1.nse_symbol=b.scrip_cd      
      
update #nse_file1 set scrip_name=b.long_name from       
(      
select a.long_name,b.scrip_Cd,b.series      
from AngelNseCM.msajag.dbo.scrip1 a, AngelNseCM.msajag.dbo.scrip2 b    
where a.co_code=b.co_code      
) b      
where #nse_file1.nse_symbol=b.scrip_Cd      
and #nse_file1.nse_group=b.series      
      
      
update #nse_file1 set       
stock_payin=convert(varchar(11),sec_payin,103)      
,stock_payout=convert(varchar(11),sec_payout,103)      
,cash_payin=convert(varchar(11),b.funds_payin,103)      
,cash_payout=convert(varchar(11),b.funds_payout,103)      
from AngelNseCM.msajag.dbo.sett_mst b      
where b.sett_type=(Case when #nse_file1.segment1='Normal' then 'N' else 'W' end)      
and b.sett_no=settlement_year+''+settlement_number      
*/      
    
select * from      
(      
select * from #bse_file1      
--union all      
--select * from #nse_file1      
) a       
order by exchange,scrip_name,bought_sold      
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PMS_trade_data_history
-- --------------------------------------------------
CREATE procedure [dbo].[PMS_trade_data_history](@pcode as varchar(10),@fcode as varchar(10),@tdate as varchar(11))      
as      
--------------------------------------- BSE Query      
      
set nocount on     
      
set transaction isolation level read uncommitted      
      
select * into #bse_party from      
(      
select party_Code from AngelBSECM.bsedb_ab.dbo.client2 where cl_code in       
(select cl_Code from AngelBSECM.bsedb_ab.dbo.client1 where family=@fcode)      
union      
select party_code=@pcode      
) a      
      
select  SEBI_NO='INB010996539',ContractNo,Exchange='B',TradeDate=convert(varchar(11),Sauda_Date,103),      
segment1=(Case when sett_type='D' then 'Rolling' else 'T2T' end),      
settlement_number=substring(sett_no,5,3),      
settlement_year=substring(sett_no,1,4),      
Backofficecode=party_code,      
bse_code=scrip_Cd,      
nse_symbol=space(25),      
nse_group='EQ',      
isin=space(20),      
scrip_name=space(25),      
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),      
traded_quantity=tradeqty,      
marketrate,      
N_netrate,      
--N_netrate=
--(CASE 
--when sell_buy=1 then ((N_NETRATE*tradeqty)+(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty
--when sell_buy=2 then ((N_NETRATE*tradeqty)-(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty
--else 0 end),      
NserTax=NserTax,      
Trans_chgs=Ins_chrg,  
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,      
--other_chrg=0,      
stock_payin=space(25),      
stock_payout=space(25),      
cash_payin=space(25),      
cash_payout=space(25)      
into #bse_file1      
from AngelBSECM.bsedb_ab.dbo.history
where party_code IN (SELECT  * FROM #bse_party)      
and sauda_date>=@tdate+' 00:00:00'       
and sauda_date<=@tdate+' 23:59:59'       
and sett_type in ('D','C')      
and status <> 'N'
      
update #bse_file1 set isin=b.isin from       
(select * from angeldemat.bsedb.dbo.multiisin where valid =1 ) b where       
#bse_file1.bse_code=b.scrip_cd      
      
      
update #bse_file1 set scrip_name=b.long_name from       
(select b.bsecode,a.long_name from AngelBSECM.bsedb_Ab.dbo.scrip1 a, AngelBSECM.bsedb_Ab.dbo.scrip2 b where a.co_code=b.co_code) b      
where #bse_file1.bse_code=b.bsecode      
      
      
update #bse_file1 set       
stock_payin=convert(varchar(11),sec_payin,103)      
,stock_payout=convert(varchar(11),sec_payout,103)      
,cash_payin=convert(varchar(11),b.funds_payin,103)      
,cash_payout=convert(varchar(11),b.funds_payout,103)      
from AngelBSECM.bsedb_ab.dbo.sett_mst b      
where b.sett_type=(Case when #bse_file1.segment1='Rolling' then 'D' else 'C' end)      
and b.sett_no=settlement_year+''+settlement_number      
      
--------------------------------------------------- NSE      
/*      
select * into #nse_party from      
(      
select party_Code from AngelNseCM.msajag.dbo.client2 where cl_code in       
(select cl_Code from AngelNseCM.msajag.dbo.client1 where family=@fcode)      
union      
select party_code=@pcode      
) a      
      
      
select  SEBI_NO='INB230600236',ContractNo,Exchange='N',TradeDate=convert(varchar(11),Sauda_Date,103),      
segment1=(Case when sett_type='N' then 'Normal' else 'T2T' end),      
settlement_number=substring(sett_no,5,3),      
settlement_year=substring(sett_no,1,4),      
Backofficecode=party_code,      
bse_code=space(10),      
nse_symbol=scrip_cd,      
nse_group=series,      
isin=space(20),      
scrip_name=space(25),      
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),      
traded_quantity=tradeqty,      
marketrate,      
N_netrate,      
NserTax,      
Trans_chgs=Ins_chrg,      
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,      
stock_payin=space(25),      
stock_payout=space(25),      
cash_payin=space(25),      
cash_payout=space(25)      
into #nse_file1      
from AngelNseCM.msajag.dbo.settlement       
where party_code IN (SELECT party_code FROM #nse_party)   
and sauda_date>=@tdate+' 00:00:00'       
and sauda_date<=@tdate+' 23:59:59'       
and sett_type in ('N','W')      
      
      
update #nse_file1 set isin=b.isin from       
(select * from angeldemat.msajag.dbo.multiisin where valid =1) b where       
#nse_file1.nse_symbol=b.scrip_cd      
      
update #nse_file1 set scrip_name=b.long_name from       
(      
select a.long_name,b.scrip_Cd,b.series      
from AngelNseCM.msajag.dbo.scrip1 a, AngelNseCM.msajag.dbo.scrip2 b    
where a.co_code=b.co_code      
) b      
where #nse_file1.nse_symbol=b.scrip_Cd      
and #nse_file1.nse_group=b.series      
      
      
update #nse_file1 set       
stock_payin=convert(varchar(11),sec_payin,103)      
,stock_payout=convert(varchar(11),sec_payout,103)      
,cash_payin=convert(varchar(11),b.funds_payin,103)      
,cash_payout=convert(varchar(11),b.funds_payout,103)      
from AngelNseCM.msajag.dbo.sett_mst b      
where b.sett_type=(Case when #nse_file1.segment1='Normal' then 'N' else 'W' end)      
and b.sett_no=settlement_year+''+settlement_number      
*/      
    
select * from      
(      
select * from #bse_file1      
--union all      
--select * from #nse_file1      
) a       
order by exchange,scrip_name,bought_sold      
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PMS_trade_data_temp
-- --------------------------------------------------
CREATE  procedure [dbo].[PMS_trade_data_temp](@pcode as varchar(10),@fcode as varchar(10),@tdate as varchar(11))        
as        
--------------------------------------- BSE Query        
        
set nocount on       
        
set transaction isolation level read uncommitted        
        
select * into #bse_party from        
(        
--select party_Code from AngelBSECM.bsedb_ab.dbo.client2 where cl_code in         
--(select cl_Code from AngelBSECM.bsedb_ab.dbo.client1 where family=@fcode)        
select party_Code from AngelNseCM.msajag.dbo.client_Details where family=@fcode
union        
select party_code=@pcode        
) a        
        
select  SEBI_NO='INB010996539',ContractNo,Exchange='B',TradeDate=convert(varchar(11),Sauda_Date,103),        
segment1=(Case when sett_type='D' then 'Rolling' else 'T2T' end),        
settlement_number=substring(sett_no,5,3),        
settlement_year=substring(sett_no,1,4),        
Backofficecode=party_code,        
bse_code=scrip_Cd,        
nse_symbol=space(25),        
nse_group='EQ',        
isin=space(20),        
scrip_name=space(25),        
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),        
traded_quantity=tradeqty,        
marketrate,        
N_netrate,        
--N_netrate=  
--(CASE   
--when sell_buy=1 then ((N_NETRATE*tradeqty)+(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty  
--when sell_buy=2 then ((N_NETRATE*tradeqty)-(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty  
--else 0 end),        
NserTax=NserTax,        
Trans_chgs=Ins_chrg,    
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,        
--other_chrg=0,        
stock_payin=space(25),        
stock_payout=space(25),        
cash_payin=space(25),        
cash_payout=space(25)        
into #bse_file1        
--from AngelBSECM.bsedb_ab.dbo.settlement   
from mis.remisior.dbo.bsedata_monthend
where party_code IN (SELECT  * FROM #bse_party)        
and sauda_date>=@tdate+' 00:00:00'         
and sauda_date<=@tdate+' 23:59:59'         
and sett_type in ('D','C')        
and status <> 'N'  
        
update #bse_file1 set isin=b.isin from         
(select * from angeldemat.bsedb.dbo.multiisin where valid =1 ) b where         
#bse_file1.bse_code=b.scrip_cd        
        
        
update #bse_file1 set scrip_name=b.long_name from         
(select b.bsecode,a.long_name from AngelBSECM.bsedb_Ab.dbo.scrip1 a, AngelBSECM.bsedb_Ab.dbo.scrip2 b where a.co_code=b.co_code) b        
where #bse_file1.bse_code=b.bsecode        
        
        
update #bse_file1 set         
stock_payin=convert(varchar(11),sec_payin,103)        
,stock_payout=convert(varchar(11),sec_payout,103)        
,cash_payin=convert(varchar(11),b.funds_payin,103)        
,cash_payout=convert(varchar(11),b.funds_payout,103)        
--from AngelBSECM.bsedb_ab.dbo.sett_mst b        
from risk.dbo.bse_Sett_mst b
where b.sett_type=(Case when #bse_file1.segment1='Rolling' then 'D' else 'C' end)        
and b.sett_no=settlement_year+''+settlement_number        
        
--------------------------------------------------- NSE        
/*        
select * into #nse_party from        
(        
select party_Code from AngelNseCM.msajag.dbo.client2 where cl_code in         
(select cl_Code from AngelNseCM.msajag.dbo.client1 where family=@fcode)        
union        
select party_code=@pcode        
) a        
        
        
select  SEBI_NO='INB230600236',ContractNo,Exchange='N',TradeDate=convert(varchar(11),Sauda_Date,103),        
segment1=(Case when sett_type='N' then 'Normal' else 'T2T' end),        
settlement_number=substring(sett_no,5,3),        
settlement_year=substring(sett_no,1,4),        
Backofficecode=party_code,        
bse_code=space(10),        
nse_symbol=scrip_cd,        
nse_group=series,        
isin=space(20),        
scrip_name=space(25),        
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),        
traded_quantity=tradeqty,        
marketrate,        
N_netrate,        
NserTax,        
Trans_chgs=Ins_chrg,        
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,        
stock_payin=space(25),        
stock_payout=space(25),        
cash_payin=space(25),        
cash_payout=space(25)        
into #nse_file1        
from AngelNseCM.msajag.dbo.settlement         
where party_code IN (SELECT party_code FROM #nse_party)     
and sauda_date>=@tdate+' 00:00:00'         
and sauda_date<=@tdate+' 23:59:59'         
and sett_type in ('N','W')        
        
        
update #nse_file1 set isin=b.isin from         
(select * from angeldemat.msajag.dbo.multiisin where valid =1) b where         
#nse_file1.nse_symbol=b.scrip_cd        
        
update #nse_file1 set scrip_name=b.long_name from         
(        
select a.long_name,b.scrip_Cd,b.series        
from AngelNseCM.msajag.dbo.scrip1 a, AngelNseCM.msajag.dbo.scrip2 b      
where a.co_code=b.co_code        
) b        
where #nse_file1.nse_symbol=b.scrip_Cd        
and #nse_file1.nse_group=b.series        
        
        
update #nse_file1 set         
stock_payin=convert(varchar(11),sec_payin,103)        
,stock_payout=convert(varchar(11),sec_payout,103)        
,cash_payin=convert(varchar(11),b.funds_payin,103)        
,cash_payout=convert(varchar(11),b.funds_payout,103)        
from AngelNseCM.msajag.dbo.sett_mst b        
where b.sett_type=(Case when #nse_file1.segment1='Normal' then 'N' else 'W' end)        
and b.sett_no=settlement_year+''+settlement_number        
*/        
      
select * from        
(        
select * from #bse_file1        
--union all        
--select * from #nse_file1        
) a         
order by exchange,scrip_name,bought_sold        
        
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.PMS_trade_data1
-- --------------------------------------------------
CREATE  procedure [dbo].[PMS_trade_data1](@pcode as varchar(10),@fcode as varchar(10),@tdate as varchar(11))            
as            
--------------------------------------- BSE Query            
            
set nocount on           
            
set transaction isolation level read uncommitted            
            
select * into #bse_party from            
(            
select party_Code from AngelBSECM.bsedb_ab.dbo.client2 where cl_code in             
(select cl_Code from AngelBSECM.bsedb_ab.dbo.client1 where family=@fcode)            
union            
select party_code=@pcode            
) a            
            
select  SEBI_NO='INB010996539',ContractNo,Exchange='B',TradeDate=convert(varchar(11),Sauda_Date,103),            
segment1=(Case when sett_type='D' then 'Rolling' else 'T2T' end),            
settlement_number=substring(sett_no,5,3),            
settlement_year=substring(sett_no,1,4),            
Backofficecode=party_code,            
bse_code=scrip_Cd,            
nse_symbol=space(25),            
nse_group='EQ',            
isin=space(20),            
scrip_name=space(25),            
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),            
traded_quantity=tradeqty,            
marketrate,            
N_netrate,            
--N_netrate=      
--(CASE       
--when sell_buy=1 then ((N_NETRATE*tradeqty)+(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty      
--when sell_buy=2 then ((N_NETRATE*tradeqty)-(NserTax+other_chrg+turn_tax+sebi_tax+Broker_chrg))/tradeqty      
--else 0 end),            
NserTax=NserTax,            
Trans_chgs=Ins_chrg,        
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,            
--other_chrg=0,            
stock_payin=space(25),            
stock_payout=space(25),            
cash_payin=space(25),            
cash_payout=space(25)            
into #bse_file1            
from AngelBSECM.bsedb_ab.dbo.settlement       
where party_code IN (SELECT  * FROM #bse_party)            
and sauda_date>=@tdate+' 00:00:00'             
and sauda_date<=@tdate+' 23:59:59'             
and sett_type in ('D','C')            
and status <> 'N'      
            
update #bse_file1 set isin=b.isin from             
(select * from angeldemat.bsedb.dbo.multiisin where valid =1 ) b where             
#bse_file1.bse_code=b.scrip_cd            
            
            
update #bse_file1 set scrip_name=b.long_name from             
(select b.bsecode,a.long_name from AngelBSECM.bsedb_Ab.dbo.scrip1 a, AngelBSECM.bsedb_Ab.dbo.scrip2 b where a.co_code=b.co_code) b            
where #bse_file1.bse_code=b.bsecode            
            
            
update #bse_file1 set             
stock_payin=convert(varchar(11),sec_payin,103)            
,stock_payout=convert(varchar(11),sec_payout,103)            
,cash_payin=convert(varchar(11),b.funds_payin,103)            
,cash_payout=convert(varchar(11),b.funds_payout,103)            
from AngelBSECM.bsedb_ab.dbo.sett_mst b            
where b.sett_type=(Case when #bse_file1.segment1='Rolling' then 'D' else 'C' end)            
and b.sett_no=settlement_year+''+settlement_number            
            
--------------------------------------------------- NSE            
/*            
select * into #nse_party from            
(            
select party_Code from AngelNseCM.msajag.dbo.client2 where cl_code in             
(select cl_Code from AngelNseCM.msajag.dbo.client1 where family=@fcode)            
union            
select party_code=@pcode            
) a            
            
            
select  SEBI_NO='INB230600236',ContractNo,Exchange='N',TradeDate=convert(varchar(11),Sauda_Date,103),            
segment1=(Case when sett_type='N' then 'Normal' else 'T2T' end),            
settlement_number=substring(sett_no,5,3),            
settlement_year=substring(sett_no,1,4),            
Backofficecode=party_code,            
bse_code=space(10),            
nse_symbol=scrip_cd,            
nse_group=series,            
isin=space(20),            
scrip_name=space(25),            
bought_sold=(case when sell_buy='1' then 'B' else 'S' end),            
traded_quantity=tradeqty,            
marketrate,            
N_netrate,            
NserTax,            
Trans_chgs=Ins_chrg,            
other_chrg=other_chrg+turn_tax+sebi_tax+Broker_chrg,            
stock_payin=space(25),            
stock_payout=space(25),            
cash_payin=space(25),            
cash_payout=space(25)            
into #nse_file1            
from AngelNseCM.msajag.dbo.settlement             
where party_code IN (SELECT party_code FROM #nse_party)         
and sauda_date>=@tdate+' 00:00:00'             
and sauda_date<=@tdate+' 23:59:59'             
and sett_type in ('N','W')            
            
            
update #nse_file1 set isin=b.isin from             
(select * from angeldemat.msajag.dbo.multiisin where valid =1) b where             
#nse_file1.nse_symbol=b.scrip_cd            
            
update #nse_file1 set scrip_name=b.long_name from             
(            
select a.long_name,b.scrip_Cd,b.series            
from AngelNseCM.msajag.dbo.scrip1 a, AngelNseCM.msajag.dbo.scrip2 b          
where a.co_code=b.co_code            
) b            
where #nse_file1.nse_symbol=b.scrip_Cd            
and #nse_file1.nse_group=b.series            
            
            
update #nse_file1 set             
stock_payin=convert(varchar(11),sec_payin,103)            
,stock_payout=convert(varchar(11),sec_payout,103)            
,cash_payin=convert(varchar(11),b.funds_payin,103)            
,cash_payout=convert(varchar(11),b.funds_payout,103)            
from AngelNseCM.msajag.dbo.sett_mst b            
where b.sett_type=(Case when #nse_file1.segment1='Normal' then 'N' else 'W' end)            
and b.sett_no=settlement_year+''+settlement_number            
*/            
          
select *  into pams_trade from            
(            
select * from #bse_file1            
--union all            
--select * from #nse_file1            
) a             
order by exchange,scrip_name,bought_sold            
    
    
--select * from #f1    
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.prc_GetOldCodeFromNewCode
-- --------------------------------------------------
create proc prc_GetOldCodeFromNewCode
@partycode as varchar(10)
as
begin
	select old_kyc_code from  testdb.dbo.V_KYC_OLDNEW_SHIFTING with(nolock) where new_kyc_code=@partycode
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rebuild_index
-- --------------------------------------------------
CREATE procedure [dbo].[rebuild_index]  
@database varchar(100)  
as  
begin  
  
declare @db_id int  
Select @db_id = db_id(@database)  
  
if @db_id is Null  
return  
  
SET NOCOUNT ON;  
DECLARE @objectid int;  
DECLARE @indexid int;  
DECLARE @partitioncount bigint;  
DECLARE @schemaname nvarchar(130);  
DECLARE @objectname nvarchar(130);  
DECLARE @indexname nvarchar(130);  
DECLARE @partitionnum bigint;  
DECLARE @partitions bigint;  
DECLARE @frag float;  
DECLARE @command nvarchar(4000);  
-- Conditionally select tables and indexes from the sys.dm_db_index_physical_stats function  
-- and convert object and index IDs to names.  
  
SELECT  
object_id AS objectid,  
index_id AS indexid,  
partition_number AS partitionnum,  
avg_fragmentation_in_percent AS frag  
INTO #work_to_do  
FROM sys.dm_db_index_physical_stats (@db_id, NULL, NULL , NULL, 'LIMITED')  
WHERE avg_fragmentation_in_percent > 10.0 AND index_id > 0;  
  
-- Declare the cursor for the list of partitions to be processed.  
DECLARE partitions CURSOR FOR SELECT objectid,indexid,partitionnum,frag FROM #work_to_do;  
  
-- Open the cursor.  
OPEN partitions;  
  
-- Loop through the partitions.  
WHILE (1=1)  
BEGIN;  
FETCH NEXT  
FROM partitions  
INTO @objectid, @indexid, @partitionnum, @frag;  
IF @@FETCH_STATUS < 0 BREAK;  
SELECT @objectname = QUOTENAME(o.name), @schemaname = QUOTENAME(s.name)  
FROM sys.objects AS o  
JOIN sys.schemas as s ON s.schema_id = o.schema_id  
WHERE o.object_id = @objectid;  
SELECT @indexname = QUOTENAME(name)  
FROM sys.indexes  
WHERE object_id = @objectid AND index_id = @indexid;  
SELECT @partitioncount = count (*)  
FROM sys.partitions  
WHERE object_id = @objectid AND index_id = @indexid;  
  
-- 30 is an arbitrary decision point at which to switch between reorganizing and rebuilding.  
IF @frag < 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REORGANIZE';  
IF @frag >= 30.0  
      SET @command = N'ALTER INDEX ' + @indexname + N' ON ' + @schemaname + N'.' + @objectname + N' REBUILD';  
IF @partitioncount > 1  
      SET @command = @command + N' PARTITION=' + CAST(@partitionnum AS nvarchar(10));  
IF @frag >= 30.0  
      set @command = @command +N' WITH (SORT_IN_TEMPDB = ON)' 
 
EXEC (@command);  
PRINT N'Executed: ' + @command;  
END;  
  
-- Close and deallocate the cursor.  
CLOSE partitions;  
DEALLOCATE partitions;  
  
-- Drop the temporary table.  
DROP TABLE #work_to_do;  
  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.regionwise_rpt_786
-- --------------------------------------------------
 CREATE procedure regionwise_rpt_786
(@access_to varchar(25),    
@access_code varchar(25),    
@region   varchar(25),
@FLAG VARCHAR(2)    
)    
 as  

IF @FLAG='' 
 
BEGIN 

select REGION = '<A HREF = "/global3/report.aspx?reportno=613&region='+REGION+'&flag=H&REGION'+REGION+'&ACCESS_TO='+@ACCESS_TO+'&ACCESS_CODE='+@ACCESS_CODE+'">'+ REGION +'</A>',       
TURNOVER=sum(turnover),BROKERAGE=sum(brokerage),[No of Unique Client] = count(distinct party_code)
-- into #reg     
from Exm_ClientTO    
where sauda_date >= '2012-04-01 00:00:00.000'    
and sauda_date<='2012-04-30 00:00:00.000'    
group by region  

END	

IF @FLAG='H' 

BEGIN
SELECT BRANCH_CD,TURNOVER = SUM(TURNOVER),BROKERAGE = SUM(BROKERAGE)  
FROM EXM_CLIENTTO  
WHERE SAUDA_DATE BETWEEN '2012-04-01' AND '2012-04-30' AND REGION = @REGION  
GROUP BY BRANCH_CD
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.REGIONWISE_TURNOVER
-- --------------------------------------------------
CREATE PROCEDURE REGIONWISE_TURNOVER     
@ACCESS_TO VARCHAR(20),    
@ACCESS_CODE VARCHAR(20)    
AS    
BEGIN    
SET NOCOUNT ON    
/*  
SELECT     
REGION = '<A HREF = "/global3/report.aspx?reportno=614&region='+REGION+'">' + REGION + '</A>',     
TURNOVER = SUM(TURNOVER),     
BROKERAGE = case when SUM(BROKERAGE)< 100000 then '<font color = "darkpink"> <align = "right">'+convert(varchar,SUM(BROKERAGE))+'</font>'else    
convert(varchar,SUM(BROKERAGE)) end,    
[No of Unique Client] = count(party_code),    
ACTION =  '<a href=# onclick=window.open("/global3/modalpopup.aspx?reportno=614",100,200)>View</a>'    
FROM EXM_CLIENTTO    
WHERE SAUDA_DATE BETWEEN '2012-04-01' AND '2012-04-30'    
GROUP BY REGION    
*/  
  
  
SELECT     
REGION = '<A HREF = "/global3/report.aspx?reportno=614&region='+REGION+'">' + REGION + '</A>',     
TURNOVER = SUM(TURNOVER),     
BROKERAGE = SUM(BROKERAGE),    
[No of Unique Client] = count(distinct party_code),    
ACTION =  '<a href=# onClick="openmodalpopup(''UserDefined Window Title'',''/rmnew/searchinfo1.asp'',500,200); return false")>View</a>' ,   
colbg=case when SUM(BROKERAGE)< 100000 then 'darkpink' else '' end    
FROM EXM_CLIENTTO    
WHERE SAUDA_DATE BETWEEN '2012-04-01' AND '2012-04-30'    
GROUP BY REGION    
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rpt_GetViewCodeDetails
-- --------------------------------------------------
   
CREATE procedure [dbo].[rpt_GetViewCodeDetails]              
as              
              
set nocount on              
              
declare @maxdate as varchar(11)          
set @maxdate = (select max(EntryDate) from Shift)          
          
select * into #file From INTRANET.TESTDB.dbo.Shift where EntryDate >= @maxdate          
          
set transaction isolation level read uncommitted              
          
select               
OldCode=a.Old_KYC_Code,              
BrCode=a.Branch,              
SbCode=a.Sub_Broker,              
NewCode=a.NEW_KYC_Code,              
b.Long_Name,        
b.branch_cd,        
b.sub_broker,             
ShiftDate=a.EntryDate              
into #file1              
From #file as a left outer join               
INTRANET.risk.dbo.BSE_CLIENT1 as b on a.OLD_KYC_Code = b.cl_code                   
              
set transaction isolation level read uncommitted              
select a.*,AngelDP=isnull(right(b.cltDpNo,8),''),              
POA=case when def=1 then 'Yes' else 'No' end               
into #file2              
from #file1 a left outer join               
--INTRANET.risk.dbo.BSE_CLIENT4 b on a.newcode=b.party_code              
--(select * from AngelBSECM.bsedb_Ab.dbo.CLIENT4 where BankId = '12033200') b               
(select * from angeldemat.bsedb.dbo.multicltid where DPid = '12033200') b              
on a.NewCode=b.party_code                  
              
set transaction isolation level read uncommitted              
select cm_blsavingcd,cm_cd INTO #FILE3 from [ABCSOORACLEMDLW].synergy.dbo.client_master WHERE cm_blsavingcd <> ''               
and cm_Cd in (select '12033200'+angeldp from #file2)              
              
set transaction isolation level read uncommitted              
select a.*,CrossTrdCode=isnull(b.cm_blsavingcd,''),CrossTrdDP=isnull(cm_Cd,'')               
from #file2 a left outer join #file3 b on '12033200'+a.angeldp =b.cm_cd              
order by NewCode              
              
set nocount on

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rpt_GetViewCodeDetails_Deepak
-- --------------------------------------------------
CREATE procedure [dbo].[rpt_GetViewCodeDetails_Deepak]  
as  
  
set nocount on  
  
set transaction isolation level read uncommitted  
select   
OldCode=a.Old_KYC_Code,  
BrCode=a.Branch,  
SbCode=a.Sub_Broker,  
NewCode=a.NEW_KYC_Code,  
b.Long_Name,  
ShiftDate=a.EntryDate  
into #file1  /* Drop Table #file1   */
From INTRANET.TESTDB.dbo.Shift as a left outer join   
INTRANET.risk.dbo.BSE_CLIENT1 as b on a.OLD_KYC_Code = b.cl_code   
  
  
Select f1.*,
BSECash = (Case when BSE.Party_Code is null then 'N' else 'Y' end),
NSECash = (Case when NSE.Party_Code is null then 'N' else 'Y' end),
BSEDemat = (Case when BSEDemat.Party_Code is null then 'N' else 'Y' end),
NSEDemat = (Case when NSEDemat.Party_Code is null then 'N' else 'Y' end),
DP_Master = (Case when DP_Master.Party_Code is null then 'N' else 'Y' end),
DP_Docs = (Case when DP_Docs.Party_Code is null then 'N' else 'Y' end) 
from #file1  f1
left outer join
(Select * from MIS.Demat.dbo.POAComposit where Exchange = 'BSE') BSE
on f1.NewCode = BSE.Party_Code
left outer join
(Select * from MIS.Demat.dbo.POAComposit where Exchange = 'NSE') NSE
on f1.NewCode = NSE.Party_Code
left outer join
(Select * from MIS.Demat.dbo.POAComposit where Exchange = 'BSEDemat') BSEDemat
on f1.NewCode = BSEDemat.Party_Code
left outer join
(Select * from MIS.Demat.dbo.POAComposit where Exchange = 'NSEDemat') NSEDemat
on f1.NewCode = NSEDemat.Party_Code
left outer join
(Select * from MIS.Demat.dbo.POAComposit where Exchange = 'DP-Master') DP_Master
on f1.NewCode = DP_Master.Party_Code
left outer join
(Select * from MIS.Demat.dbo.POAComposit where Exchange = 'DP-Docs') DP_Docs
on f1.NewCode = DP_Docs.Party_Code

-- 
-- set transaction isolation level read uncommitted  
-- select a.*,AngelDP=isnull(right(b.cltDpNo,8),''),  
-- POA=case when def=1 then 'Yes' else 'No' end   
-- into #file2  
-- from #file1 a left outer join   
-- --INTRANET.risk.dbo.BSE_CLIENT4 b on a.newcode=b.party_code  
-- --(select * from AngelBSECM.bsedb_Ab.dbo.CLIENT4 where BankId = '12033200') b   
-- (select * from angeldemat.bsedb.dbo.multicltid where DPid = '12033200') b  
-- on a.newcode=b.party_code  
--   
--   
-- set transaction isolation level read uncommitted  
-- select cm_blsavingcd,cm_cd INTO #FILE3 from DPBACKOFFICE.ACERCROSS.DBO.Client_master WHERE cm_blsavingcd <> ''   
-- and cm_Cd in (select '12033200'+angeldp from #file2)  
--   
-- set transaction isolation level read uncommitted  
-- select a.*,CrossTrdCode=isnull(b.cm_blsavingcd,''),CrossTrdDP=isnull(cm_Cd,'')   
-- from #file2 a left outer join #file3 b on '12033200'+a.angeldp =b.cm_cd  
-- order by NewCode  
--   
-- set nocount on  
--   
-- 
-- 
-- 
-- Select OldCode=a.Old_KYC_Code,BrCode=a.Branch,SbCode=a.Sub_Broker,NewCode=a.NEW_KYC_Code,
-- b.Long_Name,ShiftDate=a.EntryDate, AngelDP=isnull(right(c.cltDpID,8),''),
-- POA=case exchange when 'DP' then 'Y' else '' end 
-- From INTRANET.TESTDB.dbo.Shift as a 
-- left outer join 
-- INTRANET.risk.dbo.BSE_CLIENT1 as b 
-- on a.OLD_KYC_Code = b.cl_code 
-- left outer join 
-- INTRANET.risk.dbo.BSE_CLIENT4 as c 
-- on a.OLD_KYC_Code = c.Party_Code 
-- and BankId = '12033200' 
-- left outer join MIS.Demat.dbo.POACl as D on a.OLD_KYC_Code = d.Party_Code 
-- and Exchange = 'DP'
-- order by a.branch,a.sub_broker,a.EntryDate
-- 
-- 
-- Select OldCode=a.Old_KYC_Code,BrCode=a.Branch,SbCode=a.Sub_Broker,NewCode=a.NEW_KYC_Code,b.Long_Name,ShiftDate=a.EntryDate, AngelDP=isnull(right(c.cltDpID,8),''),POA=case exchange when 'DP' then 'Y' else '' end From INTRANET.TESTDB.dbo.Shift as a left outer join INTRANET.risk.dbo.BSE_CLIENT1 as b on a.OLD_KYC_Code = b.cl_code left outer join INTRANET.risk.dbo.BSE_CLIENT4 as c on a.OLD_KYC_Code = c.Party_Code and BankId = '12033200'left outer join MIS.Demat.dbo.POACl as D on a.OLD_KYC_Code = d.Party_Code and Exchange = 'DP'order by a.branch,a.sub_broker,a.EntryDate

GO

-- --------------------------------------------------
-- PROCEDURE dbo.rpt_GetViewCodeDetails31122012
-- --------------------------------------------------
    
CREATE procedure rpt_GetViewCodeDetails31122012            
as            
            
set nocount on            
            
declare @maxdate as varchar(11)        
set @maxdate = (select max(EntryDate) from Shift)        
        
select * into #file From INTRANET.TESTDB.dbo.Shift where EntryDate >= @maxdate        
        
set transaction isolation level read uncommitted            
        
select             
OldCode=a.Old_KYC_Code,            
BrCode=a.Branch,            
SbCode=a.Sub_Broker,            
NewCode=a.NEW_KYC_Code,            
b.Long_Name,      
b.branch_cd,      
b.sub_broker,           
ShiftDate=a.EntryDate            
into #file1            
From #file as a left outer join             
INTRANET.risk.dbo.BSE_CLIENT1 as b on a.OLD_KYC_Code = b.cl_code                 
            
set transaction isolation level read uncommitted            
select a.*,AngelDP=isnull(right(b.cltDpNo,8),''),            
POA=case when def=1 then 'Yes' else 'No' end             
into #file2            
from #file1 a left outer join             
--INTRANET.risk.dbo.BSE_CLIENT4 b on a.newcode=b.party_code            
--(select * from anand.bsedb_Ab.dbo.CLIENT4 where BankId = '12033200') b             
(select * from angeldemat.bsedb.dbo.multicltid where DPid = '12033200') b            
on a.NewCode=b.party_code                
            
set transaction isolation level read uncommitted            
select cm_blsavingcd,cm_cd INTO #FILE3 from DPBACKOFFICE.ACERCROSS.DBO.Client_master WHERE cm_blsavingcd <> ''             
and cm_Cd in (select '12033200'+angeldp from #file2)            
            
set transaction isolation level read uncommitted            
select a.*,CrossTrdCode=isnull(b.cm_blsavingcd,''),CrossTrdDP=isnull(cm_Cd,'')             
from #file2 a left outer join #file3 b on '12033200'+a.angeldp =b.cm_cd            
order by NewCode            
            
set nocount on

GO

-- --------------------------------------------------
-- PROCEDURE dbo.save_ABC_details
-- --------------------------------------------------
CREATE proc save_ABC_details
(
@rdate datetime,
@type varchar(30),
@flag integer,
@bc numeric(25,2),
@bg numeric(25,2),
@fd numeric(25,2),
@shares numeric(25,2),
@cash numeric(25,2)
)
as
declare @cnt as integer
if @flag=1 ------------------------DEPOSIT DETAILS----------------------------------
begin

	
	set @cnt = (select count(rdate) from testdb.dbo.ff_ABCDeposit_details
		where rdate = @rdate+' 00:00:00.000' and type = @type)
	print @cnt

	if @cnt > 0 
	begin
		update testdb.dbo.ff_ABCDeposit_details set
		type=@type, bc=@bc, bg=@bg, fd=@fd, shares=@shares, cash=@cash
		where rdate = @rdate+' 00:00:00.000' and type = @type	
	end 
	if @cnt <= 0
	begin
		insert into testdb.dbo.ff_ABCDeposit_details values
		(@rdate,@type,@bc,@bg,@fd,@shares,@cash)
	end
end
else  ------------------------UTILIZED DETAILS----------------------------------
begin
	declare @IMVAR as numeric(25,2)
	declare @MTOM as numeric(25,2)

	set @IMVAR = @BC  ------------------------- IMVAR is mapped to @BC and MTOM is mapped to @BG
	set @MTOM = @BG   ------------------------- IMVAR is mapped to @BC and MTOM is mapped to @BG
	set @cnt = (select count(rdate) from testdb.dbo.ff_ABCUtilized_Details
		where rdate = @rdate+' 00:00:00.000' and type = @type)
	print @cnt

	if @cnt > 0 
	begin
		update testdb.dbo.ff_ABCUtilized_Details set
		type=@type, IMVAR=@MTOM, MTOM=@MTOM
		where rdate = @rdate+' 00:00:00.000' and type = @type	
	end 
	if @cnt <= 0
	begin
		insert into testdb.dbo.ff_ABCUtilized_Details values
		(@rdate,@type,@IMVAR,@MTOM)
	end
	

end

return

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sell_value_update
-- --------------------------------------------------
CREATE  proc sell_value_update  
as  
set nocount on  
/*updates sell_value column as per a specific formulla*/
update ctcl_volume  
set sell_value=m.multiplier*c.rate*c.qty   
from ctcl_volume c,multiplier m  
where c.ins_symbol=m.symbol and  buy_sell='2' and sell_value is null  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Sp_AddReportData
-- --------------------------------------------------

CREATE proc Sp_AddReportData  
  
    @Rpt_srno  as int =0 ,  
 @Rpt_ServerName as varchar(100) ='',  
 @Rpt_Username as varchar(100) ='',  
 @Rpt_Pswd as varchar(100) ='',  
 @Rpt_DatabaseName as varchar(100) ='',  
 @Rpt_QueryName as varchar(100) ='',  
 @Rpt_Parameter varchar(150)='' ,  
 @Rpt_Title as varchar(200)='' ,  
 @Rpt_ComputeColNo as varchar(100) ='',  
 @Rpt_Paging as int=0 ,  
 @Rpt_WithSrno as int=0 ,  
 @FooterNote  as varchar(250)='' ,  
 @AddedBy as varchar(100) ='',  
 @AddedOn as datetime=null ,  
 @MachineIP as varchar(100) ='',  
 @ColHide as varchar(25)='' ,  
 @RowColor as varchar(25) ='',  
 @TableHead as varchar(8000)='' ,  
 @FooterNote1 as varchar(1000)='' ,  
 @ReportHead as varchar(500)='' ,  
 @Rpt_ExportOnly as varchar(1)='' ,  
 @ColFreeze as int=0 ,  
 @ColBold as int=0,  
 @TitleFromQuery as varchar(1)='' ,  
 @RecordToDisplay as varchar(1000)='' ,  
 @Rpt_opt as varchar(9)='' ,  
 @helppage as varchar(100) ='',  
 @RptInfo as varchar(100) ='',  
 @ColColour as varchar(20)='' ,  
 @Delimiter as varchar(10)='' ,  
 @forExcel as bit=0 ,  
 @forCSV as bit=0 ,  
 @forPDF as bit =0  
 as begin  
   
INSERT INTO [tbl_report_SCS] ([Rpt_ServerName],[Rpt_Username],[Rpt_Pswd],[Rpt_DatabaseName],[Rpt_QueryName],[Rpt_Parameter],[Rpt_Title],[Rpt_ComputeColNo],[Rpt_Paging],[Rpt_WithSrno],[FooterNote],[AddedBy],[AddedOn],[MachineIP],[ColHide],[RowColor],[TableHead],[FooterNote1],[ReportHead],[Rpt_ExportOnly],[ColFreeze],[ColBold],[TitleFromQuery],[RecordToDisplay],[Rpt_opt],[helppage],[RptInfo],[ColColour],[Delimiter],[forExcel],[forCSV],[forPDF])  
values (@Rpt_ServerName,@Rpt_Username,@Rpt_Pswd,@Rpt_DatabaseName,@Rpt_QueryName,@Rpt_Parameter,@Rpt_Title,@Rpt_ComputeColNo,@Rpt_Paging,@Rpt_WithSrno,@FooterNote,@AddedBy,@AddedOn,@MachineIP,@ColHide,@RowColor,@TableHead,@FooterNote1,@ReportHead,@Rpt_ExportOnly,@ColFreeze,@ColBold,@TitleFromQuery,@RecordToDisplay,@Rpt_opt,@helppage,@RptInfo,@ColColour,@Delimiter,@forExcel,@forCSV,@forPDF)  
    
 end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_amdexecutessis
-- --------------------------------------------------
--*************************************************************************************************    
--*Created By:
--*Brief description:-
--*------------------------------------------------------------------------------------------------    
--*  To Call SSIS 
--*------------------------------------------------------------------------------------------------    
--*Sub Module Ids:-
--*Tables Accessed: 
--*Table Name      
--*Parameters:-
--* Input:   Processid,  , Package name, Package Pwd, Package path , Global variable ,User Id
--* Output:  Error Code :	0 when Success  Other than 0 - SSIS Pakage Fails
--*Change History:-    
--*Change#	Changed By		    Changed on		Reason

--*************************************************************************************************

CREATE PROCEDURE [dbo].[sp_amdexecutessis]
--Declare
	@process_id int,				-- Process Id
	@Server varchar(255),			-- Server Name
	@PkgName varchar(255), 			-- Package Name (Defaults to most recent version)
	@user_id varchar(255),			-- Server Login Id
	@ServerPWD varchar(255),		-- Server Password if using SQL Security to load Package (UID is SUSER_NAME())
	@IntSecurity bit ,				-- 0 = SQL Server Security, 1 = Integrated Security
	@PkgPWD varchar(255) ,			-- Package Password
	@GlobalVariable varchar(6000),	-- Optional Global Variables	
	@amd_user_id	int			-- ICS User Id for Gloabal Variable
	--@ExeRes int output---
	with execute as self
AS
	SET NOCOUNT ON
Begin try

			DECLARE @cmd VARCHAR(1000)
			DECLARE @Wait INT
			DECLARE @result INT, @OLEResult INT
			DECLARE @ShellID INT
			DECLARE @ExeRes INT
			Declare @pkg_path as varchar(500)
			Declare @error_code as int



			Declare @amd_session_id as bigint
			Select @amd_session_id = amd_session_id from tbl_dtsprocess WHERE process_id = @process_id

			INSERT INTO dbo.tbl_SSISProcessDtls(process_id,amd_user_id,amd_session_id,start_time,end_time)
			SELECT @process_id , @amd_user_id , @amd_session_id , GetDate() , Null
	

			--Set @GlobalVariable = 'amd_user_id=2649|$|amd_session_id=2029116696|$|source_file=\\ksntbombkh59\VSS\EAI\SHYAM\1_BSE_JVFileUpload.csv|$|exchange_code=BSE'
			--Set @GlobalVariable = ''
			--Set @pkg_path = 'D:\EAI\SSIS\EAI\EAIKMIL\EAI_KMIL_JVUpload_CSV.dtsx'
			--Set @amd_user_id = 420

			Set @pkg_path = substring(@GlobalVariable,charindex('@',@GlobalVariable)+1,len(@GlobalVariable))
			Set @GlobalVariable = substring(@GlobalVariable ,0,charindex('@',@GlobalVariable))	

			DECLARE @GVName varchar(255), @GVValue varchar(255)
			DECLARE @StartTime as int
			Declare	@ProcDesc as varchar(255)
			----===================================================================================
			set @Cmd =''
			Set @Wait = 1

		--================Gobal Variable ==================================================
			IF ltrim(rtrim(@GlobalVariable)) <> '' 
			BEGIN -- Global Variable
	
				Declare @parameter as VARCHAR(3000) 
				DECLARE @MLen INT, @MPos1 INT , @MFlag1 INT , @MStr VARCHAR(520) , @MStartPos INT
				DECLARE @MRowid INT , @parameterid INT

				set @MLen = 0
				set @MPos1 = 0
				set @MFlag1 = 0
				set @MStartPos = 1
				set @parameterid =1
		
				set @parameter = @GlobalVariable 			
				set @parameter = @parameter + '#$|'
				set @MLen = charindex('#$|', @parameter, @MStartPos)
	
				WHILE @MFlag1 = 0
				BEGIN -- while
					set @MPos1 = charindex('|$|',@parameter,@MStartPos)
					IF @MPos1 = 0
					BEGIN
						SET @MStr = substring(@parameter,@MStartPos , @MLen -@MStartPos)
						SET @MFlag1 = 1	
					END
					ELSE
						SET @MStr = substring(@parameter,@MStartPos,@MPos1-@MStartPos)
						SET @MStartPos = @MPos1 + 3
					--PRINT @MStr
					BEGIN
						SET @GVName = LEFT(@MStr, CHARINDEX('=', @MStr)-1)
						SET @GVValue = RIGHT(@MStr, LEN(@MStr) - CHARINDEX('=', @MStr))
						
						--SET @Cmd = 'GlobalVariables("' + @GVName + '").Value'
						SET @Cmd = @Cmd +  ' /set \package.variables[' + ltrim(rtrim(@GVName)) + '].Value;"' +   @GVValue +'"' --#002
					END
						SET @parameterid = 1
				END	-- while
			END --Global variable
			--===================================================================================
		-- 	declare @dtexecPath varchar(100)----
		-- 	SET @dtexecPath = 'dtexec32' -- for 64 bit machine with 32 bit excel drivers.
		--     SET @cmd = 'cmd /C '+ @dtexecPath + ' /f "' + @pkg_path + '"'  + @Cmd
		-- --	SET @cmd = 'cmd /C dtexec /f "' + @pkg_path + '"'  + @Cmd
		-- 	print @cmd

		---------------------------------------------------------------------------------------------
			DECLARE @dts_type int, @dtexecPath varchar(100)
			SET @dts_type=( SELECT a.dts_type from dbo.tbl_mst_dtsname a inner join dbo.tbl_dtsprocess b
							on  a.dts_id=b.dts_id where process_id=@process_id )
			IF @dts_type=2
			BEGIN
				SET @dtexecPath = 'dtexec32' -- for 64 bit machine with 32 bit excel drivers.
			END
			ELSE
			BEGIN
			SET @dtexecPath = 'dtexec' --for  64 bit or 32 bit machine with coorresponding excel drivers. Currently no driver for 64 bit in excel.
			END	

			SET @cmd = 'cmd /C '+ @dtexecPath + ' /f "' + @pkg_path + '"'  + @Cmd+'  /De temp'
			print @cmd

		---------------------------------------------------------------------------------------------

			--create instance of OLE object
			EXECUTE @OLEResult = sp_OACreate 'WScript.Shell', @ShellID OUT
			IF @OLEResult <> 0 SELECT @result = @OLEResult
			IF @OLEResult <> 0 RAISERROR ('CreateObject %0X', 14, 1, @OLEResult)
			--select @ShellID as shellid, 'Run', @ExeRes as exeRes , @cmd as cmd , 0, @Wait as wait
			-- run package
			set @Wait=1
			EXECUTE @OLEResult = sp_OAMethod @ShellID, 'Run', @ExeRes OUT , @cmd, 0, @Wait
			--select @OLEResult
			IF @OLEResult <> 0 SELECT @result = @OLEResult
			IF @OLEResult <> 0 RAISERROR ('Run %0X', 14, 1, @OLEResult)
			If @OLEResult <> 0 EXEC sp_OAGetErrorInfo @ShellID, @OLEResult

			IF @ExeRes <> 0
			BEGIN
				--PRINT '***  Execute failed'
				set @StartTime =(select replace(convert(varchar(10),getdate(),108),':',''))
				EXEC sp_amdprocesslog @process_id , 'Execute failed' , @StartTime ,'N', 'SSIS execution failed' , @amd_user_id 
			END
			ELSE
			BEGIN
				--PRINT '***  Execute Success'
				Set @StartTime =(select replace(convert(varchar(10),getdate(),108),':',''))
				EXEC sp_amdprocesslog @process_id , 'Execute success' , @StartTime ,'Y', 'SSIS execution success', @amd_user_id
			END
			--====================================================================================
			-- drop object
			EXECUTE @OLEResult = sp_OADestroy @ShellID
	
		--	if @ExeRes <> 0
		--	BEGIN
		--		Set @ExeRes = 1
		--	END
		--	ELSE
		--	BEGIN
		--		Set @ExeRes = 0
		--	END-
		--	return @ExeRes

			----*#004 Added Code by Ronil
			UPDATE dbo.tbl_SSISProcessDtls SET end_time = getdate() where process_id = @process_id
			----*#004 Added Code by Ronil
	

			if @ExeRes <> 0
			BEGIN
				--Select 1 as Error_code
				return 1
			END
			ELSE
			BEGIN
				--Select 0 as Error_code
				return 0
			END

 End try

 Begin Catch
  
 End Catch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_branchwise
-- --------------------------------------------------
CREATE PROCEDURE sp_branchwise 
@REGION VARCHAR(20),  
@ACCESS_TO VARCHAR(20),  
@ACCESS_CODE VARCHAR(20)  
AS  
BEGIN  
SET NOCOUNT ON  
SELECT BRANCH_CD, TURNOVER = SUM(TURNOVER), BROKERAGE = SUM(BROKERAGE)  
FROM EXM_CLIENTTO  
WHERE SAUDA_DATE BETWEEN '2012-04-01' AND '2012-04-30' AND REGION = @REGION  
GROUP BY BRANCH_CD  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_CTCLBranch
-- --------------------------------------------------
CREATE procedure sp_CTCLBranch( @Branch varchar(50) )         
AS        
set nocount on        
declare @separator_position int       
declare @array_value varchar(1000)      
DECLARE @separator char(1)    
DECLARE @Array VARCHAR(1000)    
--DECLARE @USER VARCHAR(8)    
SET @separator =','    
--SET @USER='USER'    
-- SELECT @ARRAY=UM_BRCODE FROM DPBackOffice.AcerCross.dbo.USER_MASTER WHERE UM_USER_ID=@USER    
Select @ARRAY=BSECM from ctcl_boltno where Branch = @Branch

set @array = @array + @separator        
   delete from CTCLBSEBranch where  Branch=@Branch        
while patindex('%' + @separator + '%' , @array) <> 0         
begin        
  select @separator_position =  patindex('%' + @separator + '%' , @array)        
  select @array_value = left(@array, @separator_position - 1)        
	  if len(@array_value)=3        
		   insert into CTCLBSEBranch values (@Branch,@array_value)        
		   select @array = stuff(@array, 1, @separator_position, '')        
end        
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_executessis
-- --------------------------------------------------

CREATE procedure [dbo].[sp_executessis]
   @module_id int,
   @submodule_id int,
   @session_id bigint,
   @amd_user_id int,
   @source_file varchar(max)
As
set nocount on
  Declare @dts_id int,@process_id bigint
  Declare @dts_name varchar(100)
  Declare @server varchar(100)
  Declare @db_user varchar(50)
  Declare @db_pwd varchar(50)
  Declare @global_variable_values varchar(500)
  declare @error_code int
  	Begin Try

	     select @dts_id=a.dts_id ,@dts_name=dts_name ,@server =server_name,@db_user= db_user,@db_pwd =db_pwd  
		 from tbl_tbl_mst_dtsname a
		 join mst_upload_file b
		 on a.dts_id=b.dts_id 
		 where b.module_id=@module_id
		       and b.sub_module_id=@submodule_id  

		 --select @dts_id,@dts_name,@server,@db_user,@db_pwd
         if isnull(@dts_id,0)=0 or @dts_name is null or @server is null 
		     Begin
			      select 1 as error,'Dts details not found'as result
			      return		   
			  End 
	     else
		   Begin 
				   set @global_variable_values=convert(varchar(20),@amd_user_id)+','+convert(varchar,@session_id)+','+@source_file
				 --  select @global_variable_values
				  exec frwsp_amdssisprocess  1,0,@dts_id,@global_variable_values,'',@amd_user_id,@session_id,'',@process_id output

				 --  select @process_id
				   if @process_id is null 
				   Begin 
						   select 1 as error,'process id is not found'as result
						   return
				   End
				       Else
				      Begin	
                              exec @error_code= frwsp_amdexecutessisprocess @process_id,@server ,@db_user  ,@db_pwd ,@dts_name  ,'',@amd_user_id  
						  End

		 End
		
			 

	End Try

	Begin Catch 
	 --select 1 as error,'Msg '+convert(varchar(15),ERROR_NUMBER())+', '+'Level '+
		--				 convert(varchar(10),ERROR_SEVERITY())+', '+'State '+convert(varchar(10),ERROR_STATE())+', '+'Line '+
		--				 convert(varchar(10),ERROR_LINE())+', '+ ERROR_MESSAGE() as result
		
	End Catch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_findstring
-- --------------------------------------------------
create procedure [dbo].[sp_findstring]    

@string varchar(max)    

as    

begin    

select distinct A.name  from sys.objects A    

inner join sys .syscomments B    

on A.object_id=B.id    

where CHARINDEX (@string,B.text)>0    

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_generate_inserts
-- --------------------------------------------------


create PROC [dbo].[sp_generate_inserts]
(
	@table_name varchar(776),  		-- The table/view for which the INSERT statements will be generated using the existing data
	@target_table varchar(776) = NULL, 	-- Use this parameter to specify a different table name into which the data will be inserted
	@include_column_list bit = 1,		-- Use this parameter to include/ommit column list in the generated INSERT statement
	@from varchar(800) = NULL, 		-- Use this parameter to filter the rows based on a filter condition (using WHERE)
	@include_timestamp bit = 0, 		-- Specify 1 for this parameter, if you want to include the TIMESTAMP/ROWVERSION column's data in the INSERT statement
	@debug_mode bit = 0,			-- If @debug_mode is set to 1, the SQL statements constructed by this procedure will be printed for later examination
	@owner varchar(64) = NULL,		-- Use this parameter if you are not the owner of the table
	@ommit_images bit = 0,			-- Use this parameter to generate INSERT statements by omitting the 'image' columns
	@ommit_identity bit = 0,		-- Use this parameter to ommit the identity columns
	@top int = NULL,			-- Use this parameter to generate INSERT statements only for the TOP n rows
	@cols_to_include varchar(8000) = NULL,	-- List of columns to be included in the INSERT statement
	@cols_to_exclude varchar(8000) = NULL,	-- List of columns to be excluded from the INSERT statement
	@disable_constraints bit = 0,		-- When 1, disables foreign key constraints and enables them after the INSERT statements
	@ommit_computed_cols bit = 0		-- When 1, computed columns will not be included in the INSERT statement
	
)
AS
BEGIN

/***********************************************************************************************************
Procedure:	sp_generate_inserts  (Build 22) 
		(Copyright  2002 Narayana Vyas Kondreddi. All rights reserved.)
                                          
Purpose:	To generate INSERT statements from existing data. 
		These INSERTS can be executed to regenerate the data at some other location.
		This procedure is also useful to create a database setup, where in you can 
		script your data along with your table definitions.

Written by:	Narayana Vyas Kondreddi
	        http://vyaskn.tripod.com

Acknowledgements:
		Divya Kalra	-- For beta testing
		Mark Charsley	-- For reporting a problem with scripting uniqueidentifier columns with NULL values
		Artur Zeygman	-- For helping me simplify a bit of code for handling non-dbo owned tables
		Joris Laperre   -- For reporting a regression bug in handling text/ntext columns

Tested on: 	SQL Server 7.0 and SQL Server 2000

Date created:	January 17th 2001 21:52 GMT

Date modified:	May 1st 2002 19:50 GMT

Email: 		vyaskn@hotmail.com

NOTE:		This procedure may not work with tables with too many columns.
		Results can be unpredictable with huge text columns or SQL Server 2000's sql_variant data types
		Whenever possible, Use @include_column_list parameter to ommit column list in the INSERT statement, for better results
		IMPORTANT: This procedure is not tested with internation data (Extended characters or Unicode). If needed
		you might want to convert the datatypes of character variables in this procedure to their respective unicode counterparts
		like nchar and nvarchar
		

Example 1:	To generate INSERT statements for table 'titles':
		
		EXEC sp_generate_inserts 'titles'

Example 2: 	To ommit the column list in the INSERT statement: (Column list is included by default)
		IMPORTANT: If you have too many columns, you are advised to ommit column list, as shown below,
		to avoid erroneous results
		
		EXEC sp_generate_inserts 'titles', @include_column_list = 0

Example 3:	To generate INSERT statements for 'titlesCopy' table from 'titles' table:

		EXEC sp_generate_inserts 'titles', 'titlesCopy'

Example 4:	To generate INSERT statements for 'titles' table for only those titles 
		which contain the word 'Computer' in them:
		NOTE: Do not complicate the FROM or WHERE clause here. It's assumed that you are good with T-SQL if you are using this parameter

		EXEC sp_generate_inserts 'titles', @from = "from titles where title like '%Computer%'"

Example 5: 	To specify that you want to include TIMESTAMP column's data as well in the INSERT statement:
		(By default TIMESTAMP column's data is not scripted)

		EXEC sp_generate_inserts 'titles', @include_timestamp = 1

Example 6:	To print the debug information:
  
		EXEC sp_generate_inserts 'titles', @debug_mode = 1

Example 7: 	If you are not the owner of the table, use @owner parameter to specify the owner name
		To use this option, you must have SELECT permissions on that table

		EXEC sp_generate_inserts Nickstable, @owner = 'Nick'

Example 8: 	To generate INSERT statements for the rest of the columns excluding images
		When using this otion, DO NOT set @include_column_list parameter to 0.

		EXEC sp_generate_inserts imgtable, @ommit_images = 1

Example 9: 	To generate INSERT statements excluding (ommiting) IDENTITY columns:
		(By default IDENTITY columns are included in the INSERT statement)

		EXEC sp_generate_inserts mytable, @ommit_identity = 1

Example 10: 	To generate INSERT statements for the TOP 10 rows in the table:
		
		EXEC sp_generate_inserts mytable, @top = 10

Example 11: 	To generate INSERT statements with only those columns you want:
		
		EXEC sp_generate_inserts titles, @cols_to_include = "'title','title_id','au_id'"

Example 12: 	To generate INSERT statements by omitting certain columns:
		
		EXEC sp_generate_inserts titles, @cols_to_exclude = "'title','title_id','au_id'"

Example 13:	To avoid checking the foreign key constraints while loading data with INSERT statements:
		
		EXEC sp_generate_inserts titles, @disable_constraints = 1

Example 14: 	To exclude computed columns from the INSERT statement:
		EXEC sp_generate_inserts MyTable, @ommit_computed_cols = 1
***********************************************************************************************************/

SET NOCOUNT ON

--Making sure user only uses either @cols_to_include or @cols_to_exclude
IF ((@cols_to_include IS NOT NULL) AND (@cols_to_exclude IS NOT NULL))
	BEGIN
		RAISERROR('Use either @cols_to_include or @cols_to_exclude. Do not use both the parameters at once',16,1)
		RETURN -1 --Failure. Reason: Both @cols_to_include and @cols_to_exclude parameters are specified
	END

--Making sure the @cols_to_include and @cols_to_exclude parameters are receiving values in proper format
IF ((@cols_to_include IS NOT NULL) AND (PATINDEX('''%''',@cols_to_include) = 0))
	BEGIN
		RAISERROR('Invalid use of @cols_to_include property',16,1)
		PRINT 'Specify column names surrounded by single quotes and separated by commas'
		PRINT 'Eg: EXEC sp_generate_inserts titles, @cols_to_include = "''title_id'',''title''"'
		RETURN -1 --Failure. Reason: Invalid use of @cols_to_include property
	END

IF ((@cols_to_exclude IS NOT NULL) AND (PATINDEX('''%''',@cols_to_exclude) = 0))
	BEGIN
		RAISERROR('Invalid use of @cols_to_exclude property',16,1)
		PRINT 'Specify column names surrounded by single quotes and separated by commas'
		PRINT 'Eg: EXEC sp_generate_inserts titles, @cols_to_exclude = "''title_id'',''title''"'
		RETURN -1 --Failure. Reason: Invalid use of @cols_to_exclude property
	END


--Checking to see if the database name is specified along wih the table name
--Your database context should be local to the table for which you want to generate INSERT statements
--specifying the database name is not allowed
IF (PARSENAME(@table_name,3)) IS NOT NULL
	BEGIN
		RAISERROR('Do not specify the database name. Be in the required database and just specify the table name.',16,1)
		RETURN -1 --Failure. Reason: Database name is specified along with the table name, which is not allowed
	END

--Checking for the existence of 'user table' or 'view'
--This procedure is not written to work on system tables
--To script the data in system tables, just create a view on the system tables and script the view instead

IF @owner IS NULL
	BEGIN
		IF ((OBJECT_ID(@table_name,'U') IS NULL) AND (OBJECT_ID(@table_name,'V') IS NULL)) 
			BEGIN
				RAISERROR('User table or view not found.',16,1)
				PRINT 'You may see this error, if you are not the owner of this table or view. In that case use @owner parameter to specify the owner name.'
				PRINT 'Make sure you have SELECT permission on that table or view.'
				RETURN -1 --Failure. Reason: There is no user table or view with this name
			END
	END
ELSE
	BEGIN
		IF NOT EXISTS (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @table_name AND (TABLE_TYPE = 'BASE TABLE' OR TABLE_TYPE = 'VIEW') AND TABLE_SCHEMA = @owner)
			BEGIN
				RAISERROR('User table or view not found.',16,1)
				PRINT 'You may see this error, if you are not the owner of this table. In that case use @owner parameter to specify the owner name.'
				PRINT 'Make sure you have SELECT permission on that table or view.'
				RETURN -1 --Failure. Reason: There is no user table or view with this name		
			END
	END

--Variable declarations
DECLARE		@Column_ID int, 		
		@Column_List varchar(8000), 
		@Column_Name varchar(128), 
		@Start_Insert varchar(786), 
		@Data_Type varchar(128), 
		@Actual_Values varchar(8000),	--This is the string that will be finally executed to generate INSERT statements
		@IDN varchar(128)		--Will contain the IDENTITY column's name in the table

--Variable Initialization
SET @IDN = ''
SET @Column_ID = 0
SET @Column_Name = ''
SET @Column_List = ''
SET @Actual_Values = ''

IF @owner IS NULL 
	BEGIN
		SET @Start_Insert = 'INSERT INTO ' + '[' + RTRIM(COALESCE(@target_table,@table_name)) + ']' 
	END
ELSE
	BEGIN
		SET @Start_Insert = 'INSERT ' + '[' + LTRIM(RTRIM(@owner)) + '].' + '[' + RTRIM(COALESCE(@target_table,@table_name)) + ']' 		
	END


--To get the first column's ID

SELECT	@Column_ID = MIN(ORDINAL_POSITION) 	
FROM	INFORMATION_SCHEMA.COLUMNS (NOLOCK) 
WHERE 	TABLE_NAME = @table_name AND
(@owner IS NULL OR TABLE_SCHEMA = @owner)



--Loop through all the columns of the table, to get the column names and their data types
WHILE @Column_ID IS NOT NULL
	BEGIN
		SELECT 	@Column_Name = QUOTENAME(COLUMN_NAME), 
		@Data_Type = DATA_TYPE 
		FROM 	INFORMATION_SCHEMA.COLUMNS (NOLOCK) 
		WHERE 	ORDINAL_POSITION = @Column_ID AND 
		TABLE_NAME = @table_name AND
		(@owner IS NULL OR TABLE_SCHEMA = @owner)



		IF @cols_to_include IS NOT NULL --Selecting only user specified columns
		BEGIN
			IF CHARINDEX( '''' + SUBSTRING(@Column_Name,2,LEN(@Column_Name)-2) + '''',@cols_to_include) = 0 
			BEGIN
				GOTO SKIP_LOOP
			END
		END

		IF @cols_to_exclude IS NOT NULL --Selecting only user specified columns
		BEGIN
			IF CHARINDEX( '''' + SUBSTRING(@Column_Name,2,LEN(@Column_Name)-2) + '''',@cols_to_exclude) <> 0 
			BEGIN
				GOTO SKIP_LOOP
			END
		END

		--Making sure to output SET IDENTITY_INSERT ON/OFF in case the table has an IDENTITY column
		IF (SELECT COLUMNPROPERTY( OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '.' + @table_name),SUBSTRING(@Column_Name,2,LEN(@Column_Name) - 2),'IsIdentity')) = 1 
		BEGIN
			IF @ommit_identity = 0 --Determing whether to include or exclude the IDENTITY column
				SET @IDN = @Column_Name
			ELSE
				GOTO SKIP_LOOP			
		END
		
		--Making sure whether to output computed columns or not
		IF @ommit_computed_cols = 1
		BEGIN
			IF (SELECT COLUMNPROPERTY( OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '.' + @table_name),SUBSTRING(@Column_Name,2,LEN(@Column_Name) - 2),'IsComputed')) = 1 
			BEGIN
				GOTO SKIP_LOOP					
			END
		END
		
		--Tables with columns of IMAGE data type are not supported for obvious reasons
		IF(@Data_Type in ('image'))
			BEGIN
				IF (@ommit_images = 0)
					BEGIN
						RAISERROR('Tables with image columns are not supported.',16,1)
						PRINT 'Use @ommit_images = 1 parameter to generate INSERTs for the rest of the columns.'
						PRINT 'DO NOT ommit Column List in the INSERT statements. If you ommit column list using @include_column_list=0, the generated INSERTs will fail.'
						RETURN -1 --Failure. Reason: There is a column with image data type
					END
				ELSE
					BEGIN
					GOTO SKIP_LOOP
					END
			END

		--Determining the data type of the column and depending on the data type, the VALUES part of
		--the INSERT statement is generated. Care is taken to handle columns with NULL values. Also
		--making sure, not to lose any data from flot, real, money, smallmomey, datetime columns
		SET @Actual_Values = @Actual_Values  +
		CASE 
			WHEN @Data_Type IN ('char','varchar','nchar','nvarchar') 
				THEN 
					'COALESCE('''''''' + REPLACE(RTRIM(' + @Column_Name + '),'''''''','''''''''''')+'''''''',''NULL'')'
			WHEN @Data_Type IN ('datetime','smalldatetime') 
				THEN 
					'COALESCE('''''''' + RTRIM(CONVERT(char,' + @Column_Name + ',109))+'''''''',''NULL'')'
			WHEN @Data_Type IN ('uniqueidentifier') 
				THEN  
					'COALESCE('''''''' + REPLACE(CONVERT(char(255),RTRIM(' + @Column_Name + ')),'''''''','''''''''''')+'''''''',''NULL'')'
			WHEN @Data_Type IN ('text','ntext') 
				THEN  
					'COALESCE('''''''' + REPLACE(CONVERT(char(8000),' + @Column_Name + '),'''''''','''''''''''')+'''''''',''NULL'')'					
			WHEN @Data_Type IN ('binary','varbinary') 
				THEN  
					'COALESCE(RTRIM(CONVERT(char,' + 'CONVERT(int,' + @Column_Name + '))),''NULL'')'  
			WHEN @Data_Type IN ('timestamp','rowversion') 
				THEN  
					CASE 
						WHEN @include_timestamp = 0 
							THEN 
								'''DEFAULT''' 
							ELSE 
								'COALESCE(RTRIM(CONVERT(char,' + 'CONVERT(int,' + @Column_Name + '))),''NULL'')'  
					END
			WHEN @Data_Type IN ('float','real','money','smallmoney')
				THEN
					'COALESCE(LTRIM(RTRIM(' + 'CONVERT(char, ' +  @Column_Name  + ',2)' + ')),''NULL'')' 
			ELSE 
				'COALESCE(LTRIM(RTRIM(' + 'CONVERT(char, ' +  @Column_Name  + ')' + ')),''NULL'')' 
		END   + '+' +  ''',''' + ' + '
		
		--Generating the column list for the INSERT statement
		SET @Column_List = @Column_List +  @Column_Name + ','	

		SKIP_LOOP: --The label used in GOTO

		SELECT 	@Column_ID = MIN(ORDINAL_POSITION) 
		FROM 	INFORMATION_SCHEMA.COLUMNS (NOLOCK) 
		WHERE 	TABLE_NAME = @table_name AND 
		ORDINAL_POSITION > @Column_ID AND
		(@owner IS NULL OR TABLE_SCHEMA = @owner)


	--Loop ends here!
	END

--To get rid of the extra characters that got concatenated during the last run through the loop
SET @Column_List = LEFT(@Column_List,len(@Column_List) - 1)
SET @Actual_Values = LEFT(@Actual_Values,len(@Actual_Values) - 6)

IF LTRIM(@Column_List) = '' 
	BEGIN
		RAISERROR('No columns to select. There should at least be one column to generate the output',16,1)
		RETURN -1 --Failure. Reason: Looks like all the columns are ommitted using the @cols_to_exclude parameter
	END

--Forming the final string that will be executed, to output the INSERT statements
IF (@include_column_list <> 0)
	BEGIN
		SET @Actual_Values = 
			'SELECT ' +  
			CASE WHEN @top IS NULL OR @top < 0 THEN '' ELSE ' TOP ' + LTRIM(STR(@top)) + ' ' END + 
			'''' + RTRIM(@Start_Insert) + 
			' ''+' + '''(' + RTRIM(@Column_List) +  '''+' + ''')''' + 
			' +''VALUES(''+ ' +  @Actual_Values  + '+'')''' + ' ' + 
			COALESCE(@from,' FROM ' + CASE WHEN @owner IS NULL THEN '' ELSE '[' + LTRIM(RTRIM(@owner)) + '].' END + '[' + rtrim(@table_name) + ']' + '(NOLOCK)')
	END
ELSE IF (@include_column_list = 0)
	BEGIN
		SET @Actual_Values = 
			'SELECT ' + 
			CASE WHEN @top IS NULL OR @top < 0 THEN '' ELSE ' TOP ' + LTRIM(STR(@top)) + ' ' END + 
			'''' + RTRIM(@Start_Insert) + 
			' '' +''VALUES(''+ ' +  @Actual_Values + '+'')''' + ' ' + 
			COALESCE(@from,' FROM ' + CASE WHEN @owner IS NULL THEN '' ELSE '[' + LTRIM(RTRIM(@owner)) + '].' END + '[' + rtrim(@table_name) + ']' + '(NOLOCK)')
	END	

--Determining whether to ouput any debug information
IF @debug_mode =1
	BEGIN
		PRINT '/*****START OF DEBUG INFORMATION*****'
		PRINT 'Beginning of the INSERT statement:'
		PRINT @Start_Insert
		PRINT ''
		PRINT 'The column list:'
		PRINT @Column_List
		PRINT ''
		PRINT 'The SELECT statement executed to generate the INSERTs'
		PRINT @Actual_Values
		PRINT ''
		PRINT '*****END OF DEBUG INFORMATION*****/'
		PRINT ''
	END
		
PRINT '--INSERTs generated by ''sp_generate_inserts'' stored procedure written by Vyas'
PRINT '--Build number: 22'
PRINT '--Problems/Suggestions? Contact Vyas @ vyaskn@hotmail.com'
PRINT '--http://vyaskn.tripod.com'
PRINT ''
PRINT 'SET NOCOUNT ON'
PRINT ''


--Determining whether to print IDENTITY_INSERT or not
IF (@IDN <> '')
	BEGIN
		PRINT 'SET IDENTITY_INSERT ' + QUOTENAME(COALESCE(@owner,USER_NAME())) + '.' + QUOTENAME(@table_name) + ' ON'
		PRINT 'GO'
		PRINT ''
	END


IF @disable_constraints = 1 AND (OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '.' + @table_name, 'U') IS NOT NULL)
	BEGIN
		IF @owner IS NULL
			BEGIN
				SELECT 	'ALTER TABLE ' + QUOTENAME(COALESCE(@target_table, @table_name)) + ' NOCHECK CONSTRAINT ALL' AS '--Code to disable constraints temporarily'
			END
		ELSE
			BEGIN
				SELECT 	'ALTER TABLE ' + QUOTENAME(@owner) + '.' + QUOTENAME(COALESCE(@target_table, @table_name)) + ' NOCHECK CONSTRAINT ALL' AS '--Code to disable constraints temporarily'
			END

		PRINT 'GO'
	END

PRINT ''
PRINT 'PRINT ''Inserting values into ' + '[' + RTRIM(COALESCE(@target_table,@table_name)) + ']' + ''''


--All the hard work pays off here!!! You'll get your INSERT statements, when the next line executes!
EXEC (@Actual_Values)

PRINT 'PRINT ''Done'''
PRINT ''


IF @disable_constraints = 1 AND (OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '.' + @table_name, 'U') IS NOT NULL)
	BEGIN
		IF @owner IS NULL
			BEGIN
				SELECT 	'ALTER TABLE ' + QUOTENAME(COALESCE(@target_table, @table_name)) + ' CHECK CONSTRAINT ALL'  AS '--Code to enable the previously disabled constraints'
			END
		ELSE
			BEGIN
				SELECT 	'ALTER TABLE ' + QUOTENAME(@owner) + '.' + QUOTENAME(COALESCE(@target_table, @table_name)) + ' CHECK CONSTRAINT ALL' AS '--Code to enable the previously disabled constraints'
			END

		PRINT 'GO'
	END

PRINT ''
IF (@IDN <> '')
	BEGIN
		PRINT 'SET IDENTITY_INSERT ' + QUOTENAME(COALESCE(@owner,USER_NAME())) + '.' + QUOTENAME(@table_name) + ' OFF'
		PRINT 'GO'
	END

PRINT 'SET NOCOUNT OFF'


SET NOCOUNT OFF
RETURN 0 --Success. We are done!
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_generate_restrictedScrip
-- --------------------------------------------------
CREATE
 procedure dbo.sp_generate_restrictedScrip(@segment as varchar(20))                                                                          
as                                                                          
                                                                        
set nocount on                                                                        
                                                          
----------------------------------------------------------------------------- CASE 1                                                          
                                                           
declare @Diff_Rate as money,@Strike_price_limit as money --,@segment as varchar(20)                                                                       
set @Diff_Rate = 15                                                                        
set @Strike_price_limit = 2500000         
/*                                                  
set @segment = 'All'                                                 
*/                                              
                                                            
set @Diff_Rate = @Diff_Rate/100                                                                          
set transaction isolation level read uncommitted                                                     
                                                    
if @segment ='Equity' or @segment ='All'   or @segment ='Equity_Commo'                                                               
begin            
      
--------------------NSE EQ                                                      
select TemplateName ='2,,0',[Addition/Deletion] ='1',* ,STAT = '1,2,2,2,1,2'                   
into #NSE1                      
--select * from   #NSE1                                                
 from                                                       
(select InstrumentType= 'NSE EQ',InstrumentName = '',scripcode,BSEScriptName,Series = [group]  ,ExpiryDate = '',StrikePrice = '',OptionType = ''                                                      
 from mis.Upload.dbo.restrictedscrip_BseNse where segment='NSE' AND deletestatus<>'Y' and [group] is not null       
union select instrumentName as InstrumentType,InstrumentName = '','',symbol,Series=isnull(SecuritySeries,''),ExpiryDate = '',StrikePrice = '',OptionType = ''                     
                   
 from risk.dbo.restricted_Block_Scrips where instrumentName = 'NSE EQ'  and delete_status<>'Y') a                                                      
                                         
                                                
-------------------BSE EQ                                                      
select TemplateName ='2,,0',[Addition/Deletion] ='1',* ,STAT = '2,1,2,1,2,1' into #BSE1                                                      
 from                                                       
(select InstrumentType= 'BSE EQ',InstrumentName = '',scripcode,BSEScriptName,[Group] as Series,ExpiryDate = '',StrikePrice = '',OptionType = ''                                                      
 from mis.Upload.dbo.restrictedscrip_BseNse where segment='BSE' AND  deletestatus<>'Y'       
union select instrumentName as InstrumentType,InstrumentName = '','',symbol,SecurityGroup,ExpiryDate = '',StrikePrice = '',OptionType = ''                                                      
 from risk.dbo.restricted_Block_Scrips where instrumentName = 'BSE EQ' and delete_status<>'Y') a                                                  
                                                    
SELECT '2|||0',BSEScriptName,Series,'60|||||-1|-1|-1|-1|-1|-1|-1|500000|-1|-1|0|-1|-1|-1|-1|-1|-1|999999999|9999999|0.01|1|0|0|-1|0|1|$'    
FROM                       
(        
Select * from #NSE1                                                      
Union All                                                      
Select * From #Bse1         
) A                             
                       
end   

/*select data= convert(varchar(2),opcode) +'|'+User+'|'+isnull(Group_Id,' ')+'|'+Deposit+'|'+convert(varchar(15),scrip_code)  
+'|'+Symbol+'|'+Series+'|'+isnull([Group],'')+'|'  
+isnull(Instrument_Name,' ')+'|'+isnull(Expiry,'')+'|'+isnull(Strike_Price,' ')+'|'+isnull(Option_Type,' ')+'|'  
+convert(varchar(2),Periodicity)+'|'+convert(varchar(2),Gross_Exposure_Multiplier)+'|'  
+convert(varchar(2),Gross_Exposure_Limit)+'|'+convert(varchar(2),Net_Exposure_Multiplier)+'|'  
+convert(varchar(2),Net_Exposure)+'|'+convert(varchar(2),Net_Sale_Multiplier)+'|'+convert(varchar(2),Net_Sale_Limit)+'|'  
+ convert(varchar(2),Net_Position_Multiplier)+'|'+convert(varchar(6),Net_Position_Limit)+'|'+convert(varchar(6),TurnOver_Multiplier)+'|'  
+ convert(varchar(2),TurnOver_Limit)+'|'+convert(varchar(2),Pending_Order_Multiplier)+'|'+convert(varchar(2),Pending_Order_Limit)+'|'  
+ convert(varchar(2),MTM_Multiplier)+'|'+convert(varchar(2),MTM_Limit)+'|'+convert(varchar(2),Ini_Margin_Multiplier)+'|'  
+ convert(varchar(6),Ini_Margin_Limit)+'|'+convert(varchar(6),NQ_Limit)+'|'+convert(varchar(10),Max_Single_Trans_Limit)+'|'  
+ convert(varchar(10),Max_Single_Trans_Quantity)+'|'+ convert(varchar(10),Min_Order_Value)+'|'+convert(varchar(10),Min_Order_Quantity)+'|'  
+ convert(varchar(10),Retain_Multiplier)+'|'+convert(varchar(10),Include_MTMP)+'|'+ convert(varchar(10),Include_Net_Premium)+'|'  
+ convert(varchar(10),GrossAndNet)+'|'+ convert(varchar(10),Include_Exp_Margin)+'|' into #temp  
from mis.upload.dbo.restricted_scrip_uploadTemp  
  
Select * from #temp where data is not null  */

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_generate_restrictedScrip1
-- --------------------------------------------------
CREATE procedure dbo.sp_generate_restrictedScrip1
(
   @segment as varchar(20)
)                                                                        
as 
if @segment ='Equity' or @segment ='All'   or @segment ='Equity_Commo'                                                               
     
begin
                                                                                                                                
select data= convert(varchar(2),opcode) +'|'+isnull([User],'-')+'|'+isnull(Group_Id,' ')+'|'+Deposit+'|'+convert(varchar(15),scrip_code)
+'|'+Symbol+'|'+Series+'|'+isnull([Group],'')+'|'
+isnull(Instrument_Name,' ')+'|'+isnull(Expiry,'')+'|'+isnull(Strike_Price,' ')+'|'+isnull(Option_Type,' ')+'|'
+convert(varchar(2),Periodicity)+'|'+convert(varchar(2),Gross_Exposure_Multiplier)+'|'
+convert(varchar(2),Gross_Exposure_Limit)+'|'+convert(varchar(2),Net_Exposure_Multiplier)+'|'
+convert(varchar(2),Net_Exposure)+'|'+convert(varchar(2),Net_Sale_Multiplier)+'|'+convert(varchar(2),Net_Sale_Limit)+'|'
+ convert(varchar(2),Net_Position_Multiplier)+'|'+convert(varchar(6),Net_Position_Limit)+'|'+convert(varchar(6),TurnOver_Multiplier)+'|'
+ convert(varchar(2),TurnOver_Limit)+'|'+convert(varchar(2),Pending_Order_Multiplier)+'|'+convert(varchar(2),Pending_Order_Limit)+'|'
+ convert(varchar(2),MTM_Multiplier)+'|'+convert(varchar(2),MTM_Limit)+'|'+convert(varchar(2),Ini_Margin_Multiplier)+'|'
+ convert(varchar(6),Ini_Margin_Limit)+'|'+convert(varchar(6),NQ_Limit)+'|'+convert(varchar(10),Max_Single_Trans_Limit)+'|'
+ convert(varchar(10),Max_Single_Trans_Quantity)+'|'+ convert(varchar(10),Min_Order_Value)+'|'+convert(varchar(10),Min_Order_Quantity)+'|'
+ convert(varchar(10),Retain_Multiplier)+'|'+convert(varchar(10),Include_MTMP)+'|'+ convert(varchar(10),Include_Net_Premium)+'|'
+ convert(varchar(10),GrossAndNet)+'|'+ convert(varchar(10),Include_Exp_Margin)+'|'
from mis.upload.dbo.restricted_scrip_uploadTemp 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_get_ldt_sdt
-- --------------------------------------------------
CREATE procedure sp_get_ldt_sdt  
as  
set nocount on  
  
Set Transaction isolation level read uncommitted   
  
update client_performance set bse_sdt=getdate()+100 where bse_sdt='Jan  1 1900'  
update client_performance set nse_sdt=getdate()+100 where nse_sdt='Jan  1 1900'  
update client_performance set fo_sdt=getdate()+100 where fo_sdt='Jan  1 1900'  
update client_performance set mcdx_sdt=getdate()+100 where mcdx_sdt='Jan  1 1900'  
update client_performance set ncdx_sdt=getdate()+100 where ncdx_sdt='Jan  1 1900'  
  
  
select party_Code,  
activedate=(case when(case when(case when  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
< min(mcdx_sdt) then  
(case when(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
else min(mcdx_sdt) end)  
< max(ncdx_sdt) then  
(case when(case when  
(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when max(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
< min(mcdx_sdt) then  
(case when(case when min(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) < min(fo_sdt) then  
(case when max(bse_sdt)<min(nse_sdt) then min(bse_sdt) else min(nse_sdt) end) else min(fo_sdt) end)  
else min(mcdx_sdt) end)  
else min(ncdx_sdt) end)  
into #sdt  
from client_performance  
group by party_code  
  
update client_performance set bse_sdt='Jan  1 1900' where bse_sdt>getdate()+1  
update client_performance set nse_sdt='Jan  1 1900' where nse_sdt > getdate()+1  
update client_performance set fo_sdt='Jan  1 1900' where fo_sdt > getdate()+1  
update client_performance set mcdx_sdt='Jan  1 1900' where mcdx_sdt  > getdate()+1  
update client_performance set ncdx_sdt='Jan  1 1900' where ncdx_sdt > getdate()+1  
  
update client_performance set sdt= b.activedate   
from #sdt b where b.party_code=client_performance.party_Code  
  
select party_Code,  
inactive_date=(case when(case when(case when  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
> max(mcdx_ldt) then  
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
else max(mcdx_ldt) end)  
> max(ncdx_ldt) then  
(case when(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
> max(mcdx_ldt) then  
(case when(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) > max(fo_ldt) then  
(case when max(bse_ldt)>max(nse_ldt) then max(bse_ldt) else max(nse_ldt) end) else max(fo_ldt) end)  
else max(mcdx_ldt) end)  
else max(ncdx_ldt) end)  
into #ldt  
from CLIENT_PERFORMANCE   
group by party_code  
  
update client_performance set ldt= b.inactive_date   
from #ldt b where b.party_code=client_performance.party_Code  

update client_performance set sdt=b.sdt from
(select party_code,sdt=min(sauda_Date) from bsedb_Ab.dbo.mis_to 
where party_Code collate SQL_Latin1_General_CP1_CI_AS in
(select cltcode from client_performance  where sdt > ldt) group by party_Code
) b where b.party_code=client_performance.party_code

set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_SystemInfo
-- --------------------------------------------------
CREATE proc [dbo].[sp_SystemInfo]
@Process varchar (50),
@Processor varchar(100)='',
@UserName varchar(100)='',
@UserDomainName varchar(100)='',
@Ram varchar(50)='',
@MACAddress varchar(50)='',
@IPAddress varchar(50)='',
@OSInfo varchar(50)='',
@Version varchar(50)='',
@Platform varchar(50)='',
@HDDMediaType varchar(50)='',
@HDDSerialNumber varchar(50)='',
@HDDModel varchar(50)='',
@HDDInterfaceType varchar (50)='',
@HDDSize varchar(50)='',
@ScreenDeviceName varchar(50)='',
@ScreenBounds varchar(50)='',
@ScreenType varchar(50)='',
@ScreenWorkingArea varchar(50)='',
@ScreenPrimary varchar(50)='',
@Software varchar(max)='',
@EntryDate varchar(50)=''

 as begin
 declare @cnt as int
		if (@process='Add')
		begin
         select @cnt =COUNT(1) from tbl_SystemInfo
         where UserName=@UserName and UserDomainName=@UserDomainName and  EntryDate =CAST ( GETDATE() as date)
       
         if (@cnt=0)
         begin
         insert into tbl_SystemInfo(
         Processor,
         UserName,
         UserDomainName,
         Ram,
         MACAddress,
         IPAddress,
         OSInfo,
         Version,
         Platform,
         HDDMediaType,
         HDDSerialNumber,
         HDDModel,
         HDDInterfaceType,
         HDDSize,
         ScreenDeviceName,
         ScreenBounds,
         ScreenType,
         ScreenWorkingArea,
         ScreenPrimary,
         Software,
         EntryDate
         )
         values
         (
         @Processor,
         @UserName,
         @UserDomainName,
         @Ram,
         @MACAddress,
         @IPAddress,
         @OSInfo,
         @Version,
         @Platform,
         @HDDMediaType,
         @HDDSerialNumber,
         @HDDModel,
         @HDDInterfaceType,
         @HDDSize,
         @ScreenDeviceName,
         @ScreenBounds,
         @ScreenType,
         @ScreenWorkingArea,
         @ScreenPrimary,
         @Software,
         GETDATE() 
         )
         end
		end
		
		if(@process='GetData')
		begin
		select * from tbl_SystemInfo where EntryDate =@EntryDate 
		end
 end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sp_UpdateTopSelection
-- --------------------------------------------------
create proc sp_UpdateTopSelection
@TopVal int
AS
begin
update TempCKYCVal
set TopVal=@TopVal
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.spAuditUsersPermissions
-- --------------------------------------------------
-- Srored Procedure to generate Security Audit report in HTML format:

CREATE PROC spAuditUsersPermissions
AS
SET NOCOUNT ON

DECLARE @sql VARCHAR(MAX)
DECLARE @strHTML VARCHAR(MAX)
DECLARE @i INT
DECLARE @rc INT
DECLARE @dbname VARCHAR(400)

-----------------Print header of the report--------------------

SELECT @strHTML = '<HTML><HEAD><TITLE> Security list for the auditor </TITLE><STYLE>TD.Sub{FONT-WEIGHT:bold;BORDER-BOTTOM: 0pt solid #000000;BORDER-LEFT: 1pt solid #000000;BORDER-RIGHT: 0pt solid #000000;BORDER-TOP: 0pt solid #000000; FONT-FAMILY: Tahoma;FONT-SIZE: 8pt} BODY{FONT-FAMILY: Tahoma;FONT-SIZE: 8pt} TABLE{BORDER-BOTTOM: 1pt solid #000000;BORDER-LEFT: 0pt solid #000000;BORDER-RIGHT: 1pt solid #000000;BORDER-TOP: 0pt solid #000000; FONT-FAMILY: Tahoma;FONT-SIZE: 8pt} TD{BORDER-BOTTOM: 0pt solid #000000;BORDER-LEFT: 1pt solid #000000;BORDER-RIGHT: 0pt solid #000000;BORDER-TOP: 1pt solid #000000; FONT-FAMILY: Tahoma;FONT-SIZE: 8pt} TD.Title{FONT-WEIGHT:bold;BORDER-BOTTOM: 0pt solid #000000;BORDER-LEFT: 1pt solid #000000;BORDER-RIGHT: 0pt solid #000000;BORDER-TOP: 1pt solid #000000; FONT-FAMILY: Tahoma;FONT-SIZE: 12pt} A.Index{FONT-WEIGHT:bold;FONT-SIZE:8pt;COLOR:#000099;FONT-FAMILY:Tahoma;TEXT-DECORATION:none} A.Index:HOVER{FONT-WEIGHT:bold;FONT-SIZE:8pt;COLOR:#990000;FONT-FAMILY:Tahoma;TEXT-DECORATION:none}</STYLE></HEAD><BODY><A NAME="_top"></A><BR>'
PRINT @strHTML

-----------------Login information-------------------------------------------------------------

SELECT ROW_NUMBER () OVER (ORDER BY name) AS RowNumber,
name, dbname,language, 
CONVERT(CHAR(10),CASE denylogin WHEN 1 THEN 'X' ELSE '--' END) AS IsDenied,
CONVERT(CHAR(10),CASE isntname WHEN 1 THEN 'X' ELSE '--' END) AS IsWinAuTHENtication,
CONVERT(CHAR(10),CASE isntgroup WHEN 1 THEN 'X' ELSE '--' END) AS IsWinGroup,
createdate,UPDATEdate,
CONVERT(VARCHAR(2000),
CASE sysadmin WHEN 1 THEN 'sysadmin,' ELSE '' END +
CASE securityadmin WHEN 1 THEN 'securityadmin,' ELSE '' END +
CASE serveradmin WHEN 1 THEN 'serveradmin,' ELSE '' END +
CASE setupadmin WHEN 1 THEN 'setupadmin,' ELSE '' END +
CASE processadmin WHEN 1 THEN 'processadmin,' ELSE '' END +
CASE diskadmin WHEN 1 THEN 'diskadmin,' ELSE '' END +
CASE dbcreator WHEN 1 THEN 'dbcreator,' ELSE '' END +
CASE bulkadmin WHEN 1 THEN 'bulkadmin' ELSE '' END ) AS ServerRoles
INTO #syslogins
FROM master..syslogins WITH (nolock)
ORDER BY name

SET @rc = @@rowcount

SELECT @strHTML = '<BR><CENTER><FONT SIZE="5"><B> Server ' + @@servername + '</B></FONT></CENTER><BR>'
PRINT @strHTML
PRINT '<DIV ALIGN="center"><TABLE BORDER="0" CELLPADDING="2" CELLSPACING="0" BORDERCOLOUR="003366" WIDTH="100%">'

-- Query the data only if there are rows:
IF @rc = 0
BEGIN
   PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="1" ALIGN="center"><B><A NAME="_LoginInfomration">Logins information</A></B> </TD></TR>'
   PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>There are no logins on this server</B> </TD></TR>'
END
ELSE
BEGIN
   UPDATE #syslogins
   SET ServerRoles = SUBSTRING(ServerRoles,1,LEN(ServerRoles)-1)
   WHERE SUBSTRING(ServerRoles,LEN(ServerRoles),1) = ','

   UPDATE #syslogins SET ServerRoles = '--'
   WHERE LTRIM(RTRIM(ServerRoles)) = ''

   PRINT '<DIV ALIGN="center"><TABLE BORDER="0" CELLPADDING="2" CELLSPACING="0" BORDERCOLOUR="003366" WIDTH="100%">'
   PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="9" ALIGN="center"><B><A NAME="_LoginInfomration">Logins information</A></B> </TD></TR>'
   PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="50%"><B>Login Name</B> </TD><TD ALIGN="left" WIDTH="50%"><B>Default DB</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Language</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Denied acess?</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Windows Auth?</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Window group?</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Date created</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Date UPDATEd</B> </TD><TD AALIGN="left" WIDTH="770%"><B>Server roles</B> </TD></TR>'

   SET @i = 1
   WHILE @i <= @rc
   BEGIN
       SELECT @strHTML = 
       '<TR><TD><B>' + CONVERT(VARCHAR(50),name) + '</B> </TD>' + 
       '<TD>' + CONVERT(VARCHAR(50),CASE ISNULL(dbname,'--') WHEN '' THEN '--' ELSE ISNULL(dbname,'--') END) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(50),ISNULL(language,'--')) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(10),ISNULL(IsDenied,'--')) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(10),ISNULL(IsWinAuTHENtication,'--')) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(10),ISNULL(IsWinGroup,'--')) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(30),ISNULL(createdate,'--')) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(30),ISNULL(UPDATEdate,'--')) + ' </TD>' +
       '<TD>' + CONVERT(VARCHAR(100),ISNULL(ServerRoles,'--')) + ' </TD>' +
       '</TR>'
       FROM #syslogins
       WHERE RowNumber = @i

       PRINT @strHTML

       SET @i = @i + 1
   END

   PRINT '</TABLE></DIV><BR><A CLASS="Index" HREF="#_top">Back To Top ^</A><BR><BR>'
   PRINT'<BR><CENTER></CENTER><BR>'
END

DROP TABLE #syslogins

---------------Fetch data per database-------------------------------------------------

CREATE TABLE #LoginMap (LoginName VARCHAR(200), UserName VARCHAR(200) NULL)

CREATE TABLE #RoleUser (RoLEName VARCHAR(200), UserName VARCHAR(200) NULL)

CREATE TABLE #ObjectPerms (RowNumber INT IDENTITY, UserName VARCHAR(50), PerType VARCHAR(10),PermName VARCHAR(30), SchemaName VARCHAR(50), 
ObjectName VARCHAR(100), ObjectType VARCHAR(20), ColName VARCHAR(50), IsGrantOption VARCHAR(10))

CREATE TABLE #DatabasePerms (RowNumber INT IDENTITY,UserName VARCHAR(50),PermType VARCHAR(20),PermName VARCHAR(50),IsGrantOption VARCHAR(5))

DECLARE dbs CURSOR FOR SELECT name FROM master..sysdatabases ORDER BY name

OPEN dbs
FETCH NEXT FROM dbs INTO @dbname
WHILE @@FETCH_STATUS = 0
BEGIN
   TRUNCATE TABLE #LoginMap
   TRUNCATE TABLE #RoleUser
   TRUNCATE TABLE #ObjectPerms 
   TRUNCATE TABLE #DatabasePerms
   SELECT @strHTML = '<BR><CENTER><FONT SIZE="5"><B> Database ' + @dbname + '</B></FONT></CENTER><BR>'
   PRINT @strHTML

-----------------Mapping of logins to users------------------
   EXEC('
INSERT INTO #LoginMap
SELECT login.loginname,users.name 
FROM ['+ @dbname+'].dbo.sysusers users 
INNER JOIN [master].[dbo].[syslogins] login 
ON users.[sid] = login.[sid]
WHERE users.uid < 16382 
and users.name not in (''public'',''dbo'',''guest'')
')

   SET @strHTML = ''

   PRINT '<DIV ALIGN="center"><TABLE BORDER="0" CELLPADDING="2" CELLSPACING="0" BORDERCOLOUR="003366" WIDTH="60%">'

   --Query the data only if there are rows
   IF NOT EXISTS (SELECT 1 FROM #LoginMap)
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="1" ALIGN="center"><B><A NAME="_LoginMapping">Mapping of logins to users</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>There are no mappings in this database</B> </TD></TR>'
   END 
   ELSE
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="2" ALIGN="center"><B><A NAME="_LoginMapping">Mapping of logins to users</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>Login Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>User Name</B> </TD></TR>'

       SELECT @strHTML = @strHTML + 
       '<TR><TD><B>' + CONVERT(VARCHAR(50),LoginName) + '</B> </TD><TD>' + CONVERT(VARCHAR(50),ISNULL(UserName,'')) + ' </TD></TR>' + CHAR(10)
       FROM #LoginMap
       ORDER BY LoginName

       PRINT @strHTML
   END

   PRINT '</TABLE></DIV><BR><A CLASS="Index" HREF="#_top">Back To Top ^</A><BR><BR>'

   ----------------SQL roles per user------------------
   EXEC ('INSERT INTO #RoleUser
SELECT b.name AS Role_name, a.name AS User_name ' + 
   'FROM ['+ @dbname+']..sysusers a ' +
   'INNER JOIN ['+ @dbname+ ']..sysmembers c on a.uid = c.memberuid ' +
   'INNER JOIN ['+ @dbname+ ']..sysusers b ON c.groupuid = b.uid ' + 
   'WHERE a.name <> ''dbo'''
   ) 

   SET @strHTML = ''

   PRINT '<DIV ALIGN="center"><TABLE BORDER="0" CELLPADDING="2" CELLSPACING="0" BORDERCOLOUR="003366" WIDTH="60%">'

   -- Query the data only if there are rows:

   IF NOT EXISTS(SELECT 1 FROM #RoleUser)
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="1" ALIGN="center"><B><A NAME="_DBRoleMapping">Roles per user</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>There are no users mapped to roles in this database</B> </TD></TR>'
   END 
   ELSE
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="2" ALIGN="center"><B><A NAME="_DBRoleMapping">Roles per user</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>Role Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>User Name</B> </TD></TR>'

       SELECT @strHTML = @strHTML + 
       '<TR><TD><B>' + CONVERT(VARCHAR(50),RoLEName) + '</B> </TD><TD>' + CONVERT(VARCHAR(50),ISNULL(UserName,'')) + ' </TD></TR>' + CHAR(10)
       FROM #RoleUser
       ORDER BY RoLEName

       PRINT @strHTML
   END
   
   PRINT '</TABLE></DIV><BR><A CLASS="Index" HREF="#_top">Back To Top ^</A><BR><BR>'

----------------Database level Permissions-------------------------

   EXEC ('INSERT INTO #DatabasePerms
(UserName,PermType,PermName,IsGrantOption)
SELECT usr.name,
CASE WHEN perm.state <> ''W'' THEN perm.state_desc ELSE ''GRANT'' END,
perm.permission_name, 
CASE WHEN perm.state != ''W'' THEN ''--'' ELSE ''X'' END AS IsGrantOption
FROM ['+@dbname+'].sys.database_permissions AS perm
INNER JOIN
['+@dbname+'].sys.database_principals AS usr
ON perm.grantee_principal_id = usr.principal_id
WHERE perm.major_id = 0
ORDER BY usr.name, perm.permission_name ASC, perm.state_desc ASC'
   )

   SET @rc = @@rowcount

   PRINT '<DIV ALIGN="center"><TABLE BORDER="0" CELLPADDING="2" CELLSPACING="0" BORDERCOLOUR="003366" WIDTH="60%">'

   -- Query the data only if there are rows:
   
   IF NOT EXISTS(SELECT 1 FROM #DatabasePerms)
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="1" ALIGN="center"><B><A NAME="_DBLvlPerms">Database level permissions</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>There are no specific permissions on the database level</B> </TD></TR>'
   END 
   ELSE
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN=" 4" ALIGN="center"><B><A NAME="_DBPObjPerms">Database level permissions</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>User Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Permission type</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Permission Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Grant option?</B> </TD></TR>'
       
       SET @i = 1
       WHILE @i <= @rc
       BEGIN
           SELECT @strHTML = 
           '<TR><TD><B>' + CONVERT(VARCHAR(50),UserName) + '</B> </TD>' + 
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(PermType,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(PermName,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(5),ISNULL(IsGrantOption,'--')) + ' </TD>'+
           '</TR>'
           FROM #DatabasePerms
           WHERE Rownumber = @i

           PRINT @strHTML
       
           SET @i = @i + 1
       END
   END

   PRINT '</TABLE></DIV><BR><A CLASS="Index" HREF="#_top">Back To Top ^</A><BR><BR>'

----------------Database object Permissions-------------------------
   EXEC ('INSERT INTO #ObjectPerms
(UserName,PerType,PermName,SchemaName,ObjectName,ObjectType,ColName,IsGrantOption)
SELECT usr.name AS UserName,
CASE WHEN perm.state <> ''W'' THEN perm.state_desc ELSE ''GRANT'' END AS PerType,
perm.permission_name,USER_NAME(obj.schema_id) AS SchemaName, obj.name AS ObjectName,
CASE obj.Type 
WHEN ''U'' THEN ''Table''
WHEN ''V'' THEN ''View''
WHEN ''P'' THEN ''Stored Proc''
WHEN ''FN'' THEN ''Function''
ELSE obj.Type END AS ObjectType,
CASE WHEN cl.column_id IS NULL THEN ''--'' ELSE cl.name END AS ColName,
CASE WHEN perm.state = ''W'' THEN ''X'' ELSE ''--'' END AS IsGrantOption
FROM ['+@dbname+'].sys.database_permissions AS perm
INNER JOIN
['+@dbname+'].sys.objects AS obj
ON perm.major_id = obj.[object_id]
INNER JOIN
['+@dbname+'].sys.database_principals AS usr
ON perm.grantee_principal_id = usr.principal_id
LEFT JOIN
['+@dbname+'].sys.columns AS cl
ON cl.column_id = perm.minor_id AND cl.[object_id] = perm.major_id
WHERE obj.Type <> ''S'' 
ORDER BY usr.name, perm.state_desc ASC, perm.permission_name ASC'
   )

   SET @rc = @@rowcount

   PRINT '<DIV ALIGN="center"><TABLE BORDER="0" CELLPADDING="2" CELLSPACING="0" BORDERCOLOUR="003366" WIDTH="60%">'
   
   -- Query the data only if there are rows:
   IF NOT EXISTS(SELECT 1 FROM #ObjectPerms)
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="1" ALIGN="center"><B><A NAME="_DBPObjPerms">Object permissions</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>There are no specific permissions to objects in this database</B> </TD></TR>'
   END 
   ELSE
   BEGIN
       PRINT '<TR BGCOLOR="EEEEEE"><TD CLASS="Title" COLSPAN="8" ALIGN="center"><B><A NAME="_DBPObjPerms">Object permissions</A></B> </TD></TR>'
       PRINT '<TR BGCOLOR="EEEEEE"><TD ALIGN="left" WIDTH="70%"><B>User Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Permission type</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Permission Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Schema Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Object Name</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Object type type</B> </TD><TD ALIGN="left" WIDTH="70%"><B>Column Name</B> </TD><TD ALIGN=" left" WIDTH="70%"><B>Grant option?</B> </TD></TR>'
   
       SET @i = 1
       WHILE @i <= @rc
       BEGIN
           SELECT @strHTML = 
           '<TR><TD><B>' + CONVERT(VARCHAR(50),UserName) + '</B> </TD>' + 
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(PerType,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(PermName,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(SchemaName,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(ObjectName,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(30),ISNULL(ObjectType,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(50),ISNULL(ColName,'--')) + ' </TD>' +
           '<TD>' + CONVERT(VARCHAR(5),ISNULL(IsGrantOption,'--')) + ' </TD></TR>'
           FROM #ObjectPerms
           WHERE Rownumber = @i

           PRINT @strHTML

           SET @i = @i + 1
       END
   END

   PRINT '</TABLE></DIV><BR><A CLASS="Index" HREF="#_top">Back To Top ^</A><BR><BR>'

   FETCH NEXT FROM dbs INTO @dbname

END

---------------Close cursor and drop all temporary objects-------------

CLOSE dbs
DEALLOCATE dbs

DROP TABLE #LoginMap
DROP TABLE #RoleUser
DROP TABLE #ObjectPerms
DROP TABLE #DatabasePerms

PRINT '</BODY></HTML>'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.sps_insertdata
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[sps_insertdata]
@manager_code varchar(30) ,
@update_time int,
@update_status int


AS
BEGIN


insert into Schedular_data values (@manager_code,@update_time,@update_status)



	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Spx_get_CliCharges_New
-- --------------------------------------------------


--exec  Spx_get_CliCharges_New '10/07/2012','All',2,'A','All'
CREATE procedure Spx_get_CliCharges_New
(

@tdate as varchar(12),
@accesscode as varchar(10),
@ExNOD as int,
@reptype as varchar(1),
@sbtype as varchar(3)

)              
as              
set nocount on              
set transaction isolation level read uncommitted  



If @tdate<>''
  begin
  --Set @tdate=CONVERT(datetime,@tdate,103)+'00:00'
  --Set @tdate=CONVERT(varchar(12),@tdate,103)
    set @tdate=RIGHT(@tdate,4)+'-'+ left(RIGHT(@tdate,7),2) + '-' + LEFT(@tdate,2) 

  end
  
  print @tdate


   If @accesscode='All'
    begin
    Set @accesscode='%'
    end         
select Branch_cd,Sub_Broker,party_Code,Long_name,First_Active_date,Last_inactive_date,comb_last_date ,             
BSECM=convert(money,0),              
NSECM=convert(money,0),              
BSEFO=convert(money,0),              
NSEFO=convert(money,0),              
MCX=convert(money,0),              
NCDEX=convert(money,0),              
BSECM_YN='N',              
NSECM_YN='N',              
BSEFO_YN='N',              
NSEFO_YN='N',              
MCX_YN='N',              
NCDEX_YN='N',              
B2C='N'    
into #file1              
from risk.dbo.client_Details where First_Active_date>=@tdate+' 00:00' and First_Active_date< getdate()-@ExNOD          
and Branch_cd like @accesscode            
  
        
              
update #file1 set bsecm=b.balance from              
(              
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)              
from risk.dbo.abl_ledger (nolock)               
where               
--cltcode not in (select cltcode from abl_ledger where vtyp=15) and               
cltcode in (select party_Code from #file1)              
group by cltcode              
) b where #file1.party_Code=b.cltcode              
              
              
update #file1 set bsecm_YN='Y' where party_Code in       
--(select cltcode from risk.dbo.abl_ledger (nolock)  where vtyp=15)              
(      
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)      
where BSECM_FirstTradeDate > 'Jan  1 1900'      
)      
      
              
update #file1 set nsecm=b.balance from              
(              
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)              
from risk.dbo.nse_ledger (nolock)               
where cltcode in (select party_Code from #file1)              
group by cltcode              
) b where #file1.party_Code=b.cltcode              
              
update #file1 set Nsecm_YN='Y' where party_Code in       
--(select cltcode from risk.dbo.NSE_ledger (nolock) where vtyp=15)              
(      
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)      
where NSECM_FirstTradeDate > 'Jan  1 1900'      
)      
      
              
update #file1 set nsefo=b.balance from              
(              
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)              
from risk.dbo.fo_ledger (nolock)               
where cltcode in (select party_Code from #file1)              
group by cltcode              
) b where #file1.party_Code=b.cltcode              
              
update #file1 set Nsefo_YN='Y' where party_Code in       
--(select cltcode from risk.dbo.fo_ledger (nolock) where vtyp=15)              
(select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)      
where NSEFO_FirstTradeDate > 'Jan  1 1900'      
)      
      
              
update #file1 set mcx=b.balance from              
(              
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)              
from risk.dbo.mcdx_ledger (nolock)               
where cltcode in (select party_Code from #file1)              
group by cltcode              
) b where #file1.party_Code=b.cltcode              
              
update #file1 set mcx_YN='Y' where party_Code in       
--(select cltcode from risk.dbo.mcdx_ledger (nolock) where vtyp=15)              
(      
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)      
where MCX_FirstTradeDate > 'Jan  1 1900'      
)      
      
              
update #file1 set ncdex=b.balance from              
(              
select cltcode,balance=sum(case when drcr='D' then vamt else -vamt end)              
from risk.dbo.ncdx_ledger (nolock)               
where cltcode in (select party_Code from #file1)              
group by cltcode              
) b where #file1.party_Code=b.cltcode              
              
update #file1 set ncdex_YN='Y' where party_Code in       
--(select cltcode from risk.dbo.ncdx_ledger (nolock) where vtyp=15)              
(      
select party_Code from bsedb_ab.dbo.tbl_client_first_date (nolock)      
where NCDEX_FirstTradeDate > 'Jan  1 1900'      
)      
    
    
update #file1 set B2C='Y' where sub_broker in (select b2c_Sb from mis.remisior.dbo.b2c_sb)      
    
             
if @sbtype='B2B'       
Begin              
 delete from #file1 where B2C='Y'    
end      
      
if @sbtype='B2C'       
Begin              
 delete from #file1 where B2C='N'    
-- delete from #file1 where sub_broker not in (select b2c_Sb from mis.remisior.dbo.b2c_sb)      
end      
         
      
if @reptype='A'       
Begin              
 select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1              
 where               
 (              
 (bsecm_yn ='N' and bsecm > 0) or              
 (nsecm_yn ='N' and nsecm > 0) or              
 (bsefo_yn ='N' and bsefo > 0) or              
 (nsefo_yn ='N' and nsefo > 0) or              
 (mcx_yn ='N' and mcx > 0) or              
 (ncdex_yn ='N' and ncdex > 0)               
 )              
END      
      
if @reptype='T'       
Begin              
 select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1              
 where               
 (              
 (bsecm_yn ='N' and bsecm > 0) or              
 (nsecm_yn ='N' and nsecm > 0) or              
 (bsefo_yn ='N' and bsefo > 0) or              
 (nsefo_yn ='N' and nsefo > 0) or              
 (mcx_yn ='N' and mcx > 0) or              
 (ncdex_yn ='N' and ncdex > 0)               
 )          
 and (bsecm_yn='Y' or nsecm_yn ='Y' or bsefo_yn ='Y' or nsefo_yn ='Y' or mcx_yn ='Y' or ncdex_yn ='Y')           
END      
      
if @reptype='N'       
Begin              
 select *,Total=BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX from #file1              
 where               
 (              
 (bsecm_yn ='N' and bsecm > 0) or              
 (nsecm_yn ='N' and nsecm > 0) or              
 (bsefo_yn ='N' and bsefo > 0) or              
 (nsefo_yn ='N' and nsefo > 0) or              
 (mcx_yn ='N' and mcx > 0) or              
 (ncdex_yn ='N' and ncdex > 0)               
 )          
 and (bsecm_yn='N' and nsecm_yn ='N' and bsefo_yn ='N' and nsefo_yn ='N' and mcx_yn ='N' and ncdex_yn ='N')           
END      
      
--and BSECM+NSECM+BSEFO+NSEFO+MCX+NCDEX > 0              
              
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Spx_GetHistoryStatus_OldCode
-- --------------------------------------------------
-- exec [Spx_GetHistoryStatus_OldCode] 'A508597'  
CREATE PROCEDURE [dbo].[Spx_GetHistoryStatus_OldCode] (@NewKycCode VARCHAR(20))
AS
SET NOCOUNT ON

CREATE TABLE #tempTbl (
	RowNum INT identity(1, 1)
	,oldc VARCHAR(25)
	,newc VARCHAR(25)
	,dt DATETIME
	,old_branchcode VARCHAR(25)
	,old_subbrokercode VARCHAR(25)
	,New_BranchCode VARCHAR(25)
	,New_Subbrokercode VARCHAR(25)
	)

INSERT INTO #tempTbl (
	oldc
	,newc
	,dt
	,old_branchcode
	,old_subbrokercode
	,New_BranchCode
	,New_Subbrokercode
	)
SELECT old_kyc_code
	,new_kyc_code
	,EntryDate
	,old_branchcode
	,old_subbrokercode
	,New_BranchCode
	,New_Subbrokercode
FROM dbo.V_KYC_OLDNEW_SHIFTING WITH (NOLOCK)
ORDER BY EntryDate

CREATE TABLE #mainData (
	groupID INT
	,rownum INT
	,rnk INT
	,oldC VARCHAR(10)
	,newC VARCHAR(10)
	,old_branchcode VARCHAR(50)
	,old_subbrokercode VARCHAR(50)
	,New_BranchCode VARCHAR(50)
	,New_Subbrokercode VARCHAR(50)
	,EntryDate DATETIME
	)

DECLARE @ind INT

SELECT @ind = rownum
FROM #tempTbl
WHERE newc = @NewKycCode;

WITH cte
AS (
	SELECT 1 rnk
		,rownum
		,oldc
		,newc
		,dt
		,old_branchcode
		,old_subbrokercode
		,New_BranchCode
		,New_Subbrokercode
	FROM #tempTbl t
	WHERE rownum = @ind
	
	UNION ALL
	
	SELECT (e.rnk + 1) rnk
		,t.rownum
		,t.oldc
		,t.newc
		,t.dt
		,t.old_branchcode
		,t.old_subbrokercode
		,t.New_BranchCode
		,t.New_Subbrokercode
	FROM #tempTbl t
		,cte e
	WHERE t.Newc = e.Oldc
		AND t.oldc <> e.newc
		--AND rnk < 15
	)
SELECT old_branchcode AS Old_Branch_Code
	,oldc AS Old_Kyc_Code
	,old_subbrokercode AS Old_Sb_Code
	,newc AS New_Kyc_Code
	,New_BranchCode AS New_Branch_Code
	,New_Subbrokercode AS New_Sb_Code
	,dt AS Entry_Date
FROM cte 
OPTION (MAXRECURSION 15)

DROP TABLE #tempTbl

DROP TABLE #mainData

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Store_proc_margin
-- --------------------------------------------------
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE Store_proc_margin
	-- Add the parameters for the stored procedure here
	
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
		
	select * into TableMargin from 	uploadtemp
    -- Insert statements for procedure here
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin
-- --------------------------------------------------
CREATE procedure temp_margin
as  
  

select * 
,tdate=convert(datetime,substring(tradedtime,1,10)),
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)
into temp_itmcx
from sbmcx


DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime   
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itmcx
OPEN New_CMS_Branch   
  
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
  
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.  
WHILE @@FETCH_STATUS = 0  
BEGIN  
 print 'Old Code :'+@oldcode+' New Code:'+@newcode
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate

 update temp_itmcx set oc_mcx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountmcdx.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b
 where temp_itmcx.srno=@srno

 update temp_itmcx set nc_mcx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountmcdx.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt < convert(varchar(11),@sdate)+' 23:59:59'
 group by cltcode
 ) b
 where temp_itmcx.srno=@srno 

 update temp_itmcx set oc_ncx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountncdx.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt < convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b
 where temp_itmcx.srno=@srno

 update temp_itmcx set nc_ncx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountncdx.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt < convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b
 where temp_itmcx.srno=@srno

 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
END  
CLOSE New_CMS_Branch   
DEALLOCATE New_CMS_Branch   

select * from temp_itmcx

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_coll
-- --------------------------------------------------
create procedure temp_margin_coll
as  
  
/*
select * 
,tdate=convert(datetime,substring(tradedtime,1,10)),
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)
into temp_itmcx
from sbmcx
*/

DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime   
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itmcx
OPEN New_CMS_Branch   
  
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
  
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.  
WHILE @@FETCH_STATUS = 0  
BEGIN  
 print 'Old Code :'+@oldcode+' New Code:'+@newcode
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate

 update temp_itmcx set oc_cmcx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.mcdx.dbo.tbl_clientmargin  
 where party_Code=@oldcode and margindate=@sdate
 ) b    
 where temp_itmcx.srno=@srno


 update temp_itmcx set oc_cncx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.ncdx.dbo.tbl_clientmargin  
 where party_Code=@oldcode and margindate=@sdate
 ) b    
 where temp_itmcx.srno=@srno


 update temp_itmcx set nc_cmcx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.mcdx.dbo.tbl_clientmargin  
 where party_Code=@newcode and margindate=@sdate
 ) b    
 where temp_itmcx.srno=@srno

 update temp_itmcx set nc_cncx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.ncdx.dbo.tbl_clientmargin  
 where party_Code=@newcode and margindate=@sdate
 ) b    
 where temp_itmcx.srno=@srno

 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
END  
CLOSE New_CMS_Branch   
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_coll_mcx
-- --------------------------------------------------
CREATE procedure temp_margin_coll_mcx    
as      
      
/*    
select *     
,tdate=convert(datetime,substring(tradedtime,1,10)),    
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)    
into temp_itmcx    
from sbmcx    
*/    
    
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime       
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itmcx    
OPEN New_CMS_Branch       
      
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
      
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.      
WHILE @@FETCH_STATUS = 0      
BEGIN      
 print 'Old Code :'+@oldcode+' New Code:'+@newcode    
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate    
    


 update temp_itmcx_old   
 set  oc_coll_fo=b.balance, oc_margin_fo=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelfo.nsefo.dbo.tbl_clientmargin      
 where party_Code=@oldcode and margindate=@sdate    
 ) b        
 where temp_itmcx_old.srno=@srno 

  
 update temp_itmcx_new 
 set  nc_coll_fo=b.balance, nc_margin_fo=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelfo.nsefo.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itmcx_new.srno=@srno    


 update temp_itmcx_old   
 set  oc_coll_mcx=b.balance, oc_margin_mcx=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.mcdx.dbo.tbl_clientmargin      
 where party_Code=@oldcode and margindate=@sdate    
 ) b        
 where temp_itmcx_old.srno=@srno    
    
    
 update temp_itmcx_old set oc_coll_ncdex=b.balance,oc_margin_ncdex=b.initialmargin  from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.ncdx.dbo.tbl_clientmargin      
 where party_Code=@oldcode and margindate=@sdate    
 ) b        
 where temp_itmcx_old.srno=@srno    


 update temp_itmcx_new   
 set  nc_coll_mcx=b.balance, nc_margin_mcx=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.mcdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itmcx_new.srno=@srno    
    
    
 update temp_itmcx_new set nc_coll_ncdex=b.balance,nc_margin_ncdex=b.initialmargin  from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.ncdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itmcx_new.srno=@srno    

  
 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
END      
CLOSE New_CMS_Branch       
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_coll_ncdx
-- --------------------------------------------------
create procedure temp_margin_coll_ncdx
as  
  
/*
select * 
,tdate=convert(datetime,substring(tradedtime,1,10)),
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)
into temp_itncx
from sbmcx
*/

DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime   
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itncx
OPEN New_CMS_Branch   
  
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
  
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.  
WHILE @@FETCH_STATUS = 0  
BEGIN  
 print 'Old Code :'+@oldcode+' New Code:'+@newcode
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate

 update temp_itncx set oc_cmcx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.mcdx.dbo.tbl_clientmargin  
 where party_Code=@oldcode and margindate=@sdate
 ) b    
 where temp_itncx.srno=@srno


 update temp_itncx set oc_cncx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.ncdx.dbo.tbl_clientmargin  
 where party_Code=@oldcode and margindate=@sdate
 ) b    
 where temp_itncx.srno=@srno


 update temp_itncx set nc_cmcx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.mcdx.dbo.tbl_clientmargin  
 where party_Code=@newcode and margindate=@sdate
 ) b    
 where temp_itncx.srno=@srno

 update temp_itncx set nc_cncx=b.balance from
 (
 select cltcode=party_Code,balance=cash_coll+noncash_coll 
 from angelcommodity.ncdx.dbo.tbl_clientmargin  
 where party_Code=@newcode and margindate=@sdate
 ) b    
 where temp_itncx.srno=@srno

 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
END  
CLOSE New_CMS_Branch   
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_coll_ncx
-- --------------------------------------------------
create procedure temp_margin_coll_ncx    
as      
      
/*    
select *     
,tdate=convert(datetime,substring(tradedtime,1,10)),    
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)    
into temp_itmcx    
from sbmcx    
*/    
    
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime       
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itncx    
OPEN New_CMS_Branch       
      
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
      
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.      
WHILE @@FETCH_STATUS = 0      
BEGIN      
 print 'Old Code :'+@oldcode+' New Code:'+@newcode    
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate    
    

 update temp_itncx_old   
 set  oc_coll_fo=b.balance, oc_margin_fo=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelfo.nsefo.dbo.tbl_clientmargin      
 where party_Code=@oldcode and margindate=@sdate    
 ) b        
 where temp_itncx_old.srno=@srno 

  
 update temp_itncx_new 
 set  nc_coll_fo=b.balance, nc_margin_fo=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelfo.nsefo.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx_new.srno=@srno    


 update temp_itncx_old   
 set  oc_coll_mcx=b.balance, oc_margin_mcx=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.mcdx.dbo.tbl_clientmargin      
 where party_Code=@oldcode and margindate=@sdate    
 ) b        
 where temp_itncx_old.srno=@srno    
    
    
 update temp_itncx_old set oc_coll_ncdex=b.balance,oc_margin_ncdex=b.initialmargin  from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.ncdx.dbo.tbl_clientmargin      
 where party_Code=@oldcode and margindate=@sdate    
 ) b        
 where temp_itncx_old.srno=@srno    


 update temp_itncx_new   
 set  nc_coll_mcx=b.balance, nc_margin_mcx=b.initialmargin from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.mcdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx_new.srno=@srno    
    
    
 update temp_itncx_new set nc_coll_ncdex=b.balance,nc_margin_ncdex=b.initialmargin  from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll,initialmargin     
 from angelcommodity.ncdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx_new.srno=@srno    

  
 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
END      
CLOSE New_CMS_Branch       
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_imargin
-- --------------------------------------------------
create procedure temp_margin_imargin 
as    
    
/*  
select *   
,tdate=convert(datetime,substring(tradedtime,1,10)),  
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)  
into temp_itmcx  
from sbmcx  
*/  
  
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime     
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itmcx  
OPEN New_CMS_Branch     
    
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate    
    
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.    
WHILE @@FETCH_STATUS = 0    
BEGIN    
 print 'Old Code :'+@oldcode+' New Code:'+@newcode  
-- select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate  
  
 update temp_itmcx set N_MCX_Imargin=b.balance from  
 (  
 select cltcode=party_Code,
 --balance=cash_coll+noncash_coll   
 balance=initialmargin
 from angelcommodity.mcdx.dbo.tbl_clientmargin
 where party_Code=@newcode and margindate=@sdate  
 ) b      
 where temp_itmcx.srno=@srno  
  
  
 update temp_itmcx set N_NCDEX_Imargin=b.balance from  
 (  
 select cltcode=party_Code,
 --balance=cash_coll+noncash_coll   
 balance=initialmargin
 from angelcommodity.ncdx.dbo.tbl_clientmargin    
 where party_Code=@newcode and margindate=@sdate  
 ) b      
 where temp_itmcx.srno=@srno  
  
 /* 
 update temp_itmcx set nc_cmcx=b.balance from  
 (  
 select cltcode=party_Code,balance=cash_coll+noncash_coll   
 from angelcommodity.mcdx.dbo.tbl_clientmargin    
 where party_Code=@newcode and margindate=@sdate  
 ) b      
 where temp_itmcx.srno=@srno  

  
 update temp_itmcx set nc_cncx=b.balance from  
 (  
 select cltcode=party_Code,balance=cash_coll+noncash_coll   
 from angelcommodity.ncdx.dbo.tbl_clientmargin    
 where party_Code=@newcode and margindate=@sdate  
 ) b      
 where temp_itmcx.srno=@srno  
 */
 
 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate    
END    
CLOSE New_CMS_Branch     
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_imargin_ncdex
-- --------------------------------------------------
create procedure temp_margin_imargin_ncdex   
as      
      
/*    
select *     
,tdate=convert(datetime,substring(tradedtime,1,10)),    
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)    
into temp_itncx    
from sbmcx    
*/    
    
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime       
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itncx    
OPEN New_CMS_Branch       
      
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
      
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.      
WHILE @@FETCH_STATUS = 0      
BEGIN      
 print 'Old Code :'+@oldcode+' New Code:'+@newcode    
-- select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate    
    
 update temp_itncx set N_MCX_Imargin=b.balance from    
 (    
 select cltcode=party_Code,  
 --balance=cash_coll+noncash_coll     
 balance=initialmargin  
 from angelcommodity.mcdx.dbo.tbl_clientmargin  
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx.srno=@srno    
    
    
 update temp_itncx set N_NCDEX_Imargin=b.balance from    
 (    
 select cltcode=party_Code,  
 --balance=cash_coll+noncash_coll     
 balance=initialmargin  
 from angelcommodity.ncdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx.srno=@srno    
    
 /*   
 update temp_itncx set nc_cmcx=b.balance from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll     
 from angelcommodity.mcdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx.srno=@srno    
  
    
 update temp_itncx set nc_cncx=b.balance from    
 (    
 select cltcode=party_Code,balance=cash_coll+noncash_coll     
 from angelcommodity.ncdx.dbo.tbl_clientmargin      
 where party_Code=@newcode and margindate=@sdate    
 ) b        
 where temp_itncx.srno=@srno    
 */  
   
 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
END      
CLOSE New_CMS_Branch       
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ledbal
-- --------------------------------------------------
CREATE procedure [dbo].[temp_margin_ledbal]  
as      
      
/*    
select *     
,tdate=convert(datetime,substring(tradedtime,1,10)),    
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)    
into temp_itmcx    
from sbmcx    
*/    
    
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime       
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itmcx    
OPEN New_CMS_Branch       
      
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
      
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.      
WHILE @@FETCH_STATUS = 0      
BEGIN      
 print 'Old Code :'+@oldcode+' New Code:'+@newcode    
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate    
    
 update temp_itmcx_new set nc_ledger_bse=b.balance from    
 (select cltcode,balance=sum(    
 case     
 when vdt < @sdate and drcr='D' then vamt     
 when vdt < @sdate and drcr='C' then -vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt     
 else 0     
 end    
 )    
 from AngelBSECM.account_ab.dbo.ledger 
 where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b    
 where temp_itmcx_new.srno=@srno    
  


 update temp_itmcx_new set nc_ledger_nse=b.balance from    
 (select cltcode,balance=sum(    
 case     
 when vdt < @sdate and drcr='D' then vamt     
 when vdt < @sdate and drcr='C' then -vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt     
 else 0     
 end    
 )    
 from AngelNseCM.account.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b    
 where temp_itmcx_new.srno=@srno    
  
  
  
 update temp_itmcx_new set nc_ledger_fo=b.balance from    
 (select cltcode,balance=sum(    
 case     
 when vdt < @sdate and drcr='D' then vamt     
 when vdt < @sdate and drcr='C' then -vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt     
 else 0     
 end    
 )    
 from angelfo.accountfo.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b    
 where temp_itmcx_new.srno=@srno    
  
---------------------------- OLD Client

 update temp_itmcx_old set oc_ledger_bse=b.balance from    
 (select cltcode,balance=sum(    
 case     
 when vdt < @sdate and drcr='D' then vamt     
 when vdt < @sdate and drcr='C' then -vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt     
 else 0     
 end    
 )    
 from AngelBSECM.account_ab.dbo.ledger 
 where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b    
 where temp_itmcx_old.srno=@srno    
  


 update temp_itmcx_old set oc_ledger_nse=b.balance from    
 (select cltcode,balance=sum(    
 case     
 when vdt < @sdate and drcr='D' then vamt     
 when vdt < @sdate and drcr='C' then -vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt     
 else 0     
 end    
 )    
 from AngelNseCM.account.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b    
 where temp_itmcx_old.srno=@srno    
  
  
  
 update temp_itmcx_old set oc_ledger_fo=b.balance from    
 (select cltcode,balance=sum(    
 case     
 when vdt < @sdate and drcr='D' then vamt     
 when vdt < @sdate and drcr='C' then -vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt     
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt     
 else 0     
 end    
 )    
 from angelfo.accountfo.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b    
 where temp_itmcx_old.srno=@srno    
  

    
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate      
END      
CLOSE New_CMS_Branch       
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ledbal_ncdex
-- --------------------------------------------------
CREATE procedure [dbo].[temp_margin_ledbal_ncdex]    
as        
        
/*      
select *       
,tdate=convert(datetime,substring(tradedtime,1,10)),      
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)      
into temp_itmcx      
from sbmcx      
*/      
      
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime         
DECLARE New_CMS_Branch CURSOR FOR  select srno=convert(int,srno),oldclient,newclientid,tdate from temp_itncx      
OPEN New_CMS_Branch         
        
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate        
        
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.        
WHILE @@FETCH_STATUS = 0        
BEGIN        
 print 'Old Code :'+@oldcode+' New Code:'+@newcode      
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate      
      

 update temp_itncx_new set nc_ledger_bse=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from AngelBSECM.account_ab.dbo.ledger   
 where cltcode=@newcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_new.srno=@srno      
  
  
 update temp_itncx_new set nc_ledger_nse=b.balance from      
 (

select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from AngelNseCM.account.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_new.srno=@srno      


 update temp_itncx_new set nc_ledger_fo=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from angelfo.accountfo.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_new.srno=@srno      


 update temp_itncx_new set nc_ledger_mcx=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from angelcommodity.accountmcdx.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_new.srno=@srno      
    

 update temp_itncx_new set nc_ledger_ncdex=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from angelcommodity.accountncdx.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_new.srno=@srno      

---------------------------- OLD Client  
  
 update temp_itncx_old set oc_ledger_bse=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from AngelBSECM.account_ab.dbo.ledger   
 where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_old.srno=@srno      
    
  
 update temp_itncx_old set oc_ledger_nse=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from AngelNseCM.account.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_old.srno=@srno      
    
    
 update temp_itncx_old set oc_ledger_fo=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from angelfo.accountfo.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_old.srno=@srno      


 update temp_itncx_old set oc_ledger_mcx=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from angelcommodity.accountmcdx.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_old.srno=@srno      


 update temp_itncx_old set oc_ledger_ncdex=b.balance from      
 (select cltcode,balance=sum(      
 case       
 when vdt < @sdate and drcr='D' then vamt       
 when vdt < @sdate and drcr='C' then -vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt       
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt       
 else 0       
 end      
 )      
 from angelcommodity.accountncdx.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itncx_old.srno=@srno      
     
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate        
END        
CLOSE New_CMS_Branch         
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ledbal_SBCr
-- --------------------------------------------------
CREATE procedure [dbo].[temp_margin_ledbal_SBCr]
as        
        
/*      
select *       
,tdate=convert(datetime,substring(tradedtime,1,10)),      
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)      
into temp_itmcx      
from sbmcx      
*/      
      
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime,@new_Sb as varchar(10)         
--DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb='05'+new_sb from temp_mcx_sb
--DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb from temp_mcx_sbCr
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb from temp_mcx_sbCr


OPEN New_CMS_Branch         
        
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb        
        
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.        
WHILE @@FETCH_STATUS = 0        
BEGIN        
 print 'Old Code :'+@oldcode+' New Code:'+@newcode      
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate      
/*
 update temp_itmcx_new set nc_sbcr_bse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelBSECM.account_ab.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
    
  
 update temp_itmcx_new set nc_sbcr_nse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelNseCM.account.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      

    
  
 update temp_itmcx_new set nc_sbcr_fo=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelfo.accountfo.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
    



 update temp_itmcx_new set nc_sbcr_mcx=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountmcdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
    

 update temp_itmcx_new set nc_sbcr_ncdex=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountncdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
*/
------------------------------------------- OLD Code


 update temp_itmcx_old set oc_sbcr_bse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelBSECM.account_ab.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    
  
 update temp_itmcx_old set oc_sbcr_nse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelNseCM.account.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      

    
  
 update temp_itmcx_old set oc_sbcr_fo=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelfo.accountfo.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    



 update temp_itmcx_old set oc_sbcr_mcx=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountmcdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    

 update temp_itmcx_old set oc_sbcr_ncdex=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountncdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      


  
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb        
END        
CLOSE New_CMS_Branch         
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ledbal_SBCr_ncdex
-- --------------------------------------------------
CREATE procedure [dbo].[temp_margin_ledbal_SBCr_ncdex]  
as          
          
/*        
select *         
,tdate=convert(datetime,substring(tradedtime,1,10)),        
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)        
into temp_itmcx        
from sbmcx        
*/        
        
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime,@new_Sb as varchar(10)           
--DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb='05'+new_sb from temp_mcx_sb  
--DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb from temp_mcx_sbCr  
DECLARE New_CMS_Branch CURSOR FOR  select srno=convert(int,srno),oldclient,newclientid,tdate,new_Sb from temp_ncx_sbCr
  
  
OPEN New_CMS_Branch           
          
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb          
          
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.          
WHILE @@FETCH_STATUS = 0          
BEGIN          
 print 'Old Code :'+@oldcode+' New Code:'+@newcode        
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate        

 update temp_itncx_new set nc_sbcr_bse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelBSECM.account_ab.dbo.ledger     
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
    
 update temp_itncx_new set nc_sbcr_nse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelNseCM.account.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
    
 update temp_itncx_new set nc_sbcr_fo=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelfo.accountfo.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
  
  
  
 update temp_itncx_new set nc_sbcr_mcx=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountmcdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
  
 update temp_itncx_new set nc_sbcr_ncdex=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountncdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        

------------------------------------------- OLD Code  
/*  
  
 update temp_itncx_old set oc_sbcr_bse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelBSECM.account_ab.dbo.ledger     
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
      
    
 update temp_itncx_old set oc_sbcr_nse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelNseCM.account.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
  
      
    
 update temp_itncx_old set oc_sbcr_fo=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )      
 from angelfo.accountfo.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
      
  
  
  
 update temp_itncx_old set oc_sbcr_mcx=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountmcdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
      
  
 update temp_itncx_old set oc_sbcr_ncdex=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountncdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
*/  
  
    
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb          
END          
CLOSE New_CMS_Branch           
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ledbal_SBDep
-- --------------------------------------------------


CREATE procedure [dbo].[temp_margin_ledbal_SBDep]    
as        
        
/*      
select *       
,tdate=convert(datetime,substring(tradedtime,1,10)),      
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)      
into temp_itmcx      
from sbmcx      
*/      
      
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime,@new_Sb as varchar(10)         
--DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb='05'+new_sb from temp_mcx_sb
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb='05'+old_sb from temp_mcx_sb_old
OPEN New_CMS_Branch         
        
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb        
        
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.        
WHILE @@FETCH_STATUS = 0        
BEGIN        
 print 'Old Code :'+@oldcode+' New Code:'+@newcode      
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate      
/*      
 update temp_itmcx_new set nc_sbdep_bse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelBSECM.account_ab.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
    
  
 update temp_itmcx_new set nc_sbdep_nse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelNseCM.account.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      

    
  
 update temp_itmcx_new set nc_sbdep_fo=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelfo.accountfo.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
    



 update temp_itmcx_new set nc_sbdep_mcx=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountmcdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
    

 update temp_itmcx_new set nc_sbdep_ncdex=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountncdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_new.srno=@srno      
*/    
------------------------------------------- OLD Code

 update temp_itmcx_old set oc_sbdep_bse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelBSECM.account_ab.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    
  
 update temp_itmcx_old set oc_sbdep_nse=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from AngelNseCM.account.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      

    
  
 update temp_itmcx_old set oc_sbdep_fo=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelfo.accountfo.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    



 update temp_itmcx_old set oc_sbdep_mcx=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountmcdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    

 update temp_itmcx_old set oc_sbdep_ncdex=b.balance from      
 (select cltcode,balance=sum(      
 case when drcr='D' then vamt else -vamt end      
 )      
 from angelcommodity.accountncdx.dbo.ledger 
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b      
 where temp_itmcx_old.srno=@srno      
    
  
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb        
END        
CLOSE New_CMS_Branch         
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ledbal_SBDep_ncdex
-- --------------------------------------------------
CREATE procedure [dbo].[temp_margin_ledbal_SBDep_ncdex]      
as          
          
/*        
select *         
,tdate=convert(datetime,substring(tradedtime,1,10)),        
OC_MCX=convert(money,0),OC_NCX=convert(money,0),NC_MCX=convert(money,0),NC_NCX=convert(money,0)        
into temp_itncx        
from sbmcx        
*/        
        
DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime,@new_Sb as varchar(10)           
--DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate,new_Sb='05'+new_sb from temp_mcx_sb  
DECLARE New_CMS_Branch CURSOR FOR  select srno=convert(int,srno),oldclient,newclientid,tdate,new_Sb='05'+new_sb from temp_ncx_sb_new
OPEN New_CMS_Branch           
          
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb          
          
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.          
WHILE @@FETCH_STATUS = 0          
BEGIN          
 print 'Old Code :'+@oldcode+' New Code:'+@newcode        
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate        

 update temp_itncx_new set nc_sbdep_bse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelBSECM.account_ab.dbo.ledger     
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
    
 update temp_itncx_new set nc_sbdep_nse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelNseCM.account.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
  
      
    
 update temp_itncx_new set nc_sbdep_fo=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelfo.accountfo.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
  
  
  
 update temp_itncx_new set nc_sbdep_mcx=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountmcdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        
      
  
 update temp_itncx_new set nc_sbdep_ncdex=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountncdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_new.srno=@srno        

------------------------------------------- OLD Code  
/*  
 update temp_itncx_old set oc_sbdep_bse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelBSECM.account_ab.dbo.ledger     
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
      
    
 update temp_itncx_old set oc_sbdep_nse=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from AngelNseCM.account.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
  
      
    
 update temp_itncx_old set oc_sbdep_fo=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelfo.accountfo.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
      
  
  
  
 update temp_itncx_old set oc_sbdep_mcx=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountmcdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
      
  
 update temp_itncx_old set oc_sbdep_ncdex=b.balance from        
 (select cltcode,balance=sum(        
 case when drcr='D' then vamt else -vamt end        
 )        
 from angelcommodity.accountncdx.dbo.ledger   
 where cltcode=@new_sb and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b        
 where temp_itncx_old.srno=@srno        
*/      
    
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate,@new_sb          
END          
CLOSE New_CMS_Branch           
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.temp_margin_ncdx
-- --------------------------------------------------

create procedure temp_margin_ncdx
as  
  

DECLARE @srno int,@oldcode varchar(10),@newcode varchar(10),@sdate datetime,@nor int,@fdate datetime,@tdate datetime   
DECLARE New_CMS_Branch CURSOR FOR  select srno,oldclient,newclientid,tdate from temp_itncx
OPEN New_CMS_Branch   
  
FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
  
-- Check @@FETCH_STATUS to see if there are any more rows to fetch.  
WHILE @@FETCH_STATUS = 0  
BEGIN  
 print 'Old Code :'+@oldcode+' New Code:'+@newcode
 select @fdate=sdtcur,@tdate=ldtcur from risk.dbo.parameter where sdtcur <= @sdate and ldtcur >= @sdate

 update temp_itncx set oc_mcx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountmcdx.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt <= convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b
 where temp_itncx.srno=@srno

 update temp_itncx set nc_mcx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountmcdx.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt < convert(varchar(11),@sdate)+' 23:59:59'
 group by cltcode
 ) b
 where temp_itncx.srno=@srno 

 update temp_itncx set oc_ncx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountncdx.dbo.ledger where cltcode=@oldcode and vdt>=@fdate and vdt < convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b
 where temp_itncx.srno=@srno

 update temp_itncx set nc_ncx=b.balance from
 (select cltcode,balance=sum(
 case 
 when vdt < @sdate and drcr='D' then vamt 
 when vdt < @sdate and drcr='C' then -vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='D' then vamt 
 when vdt > @sdate and vtyp <> '15' and drcr='C' then -vamt 
 else 0 
 end
 )
 from angelcommodity.accountncdx.dbo.ledger where cltcode=@newcode and vdt>=@fdate and vdt < convert(varchar(11),@sdate)+' 23:59:59'  group by cltcode) b
 where temp_itncx.srno=@srno

 FETCH NEXT FROM New_CMS_Branch INTO @srno,@oldcode,@newcode,@sdate  
END  
CLOSE New_CMS_Branch   
DEALLOCATE New_CMS_Branch

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test234
-- --------------------------------------------------
 
create procedure test234
 as 
 select top 10 * from #reg

GO

-- --------------------------------------------------
-- PROCEDURE dbo.test786
-- --------------------------------------------------
 CREATE procedure test786
 
 (@access_to varchar(25),
 @access_code varchar(25),
 @region   varchar(25)
 )
 as
select region,sum(turnover),sum(brokerage),branch_cd
-- into #reg 
from Exm_ClientTO
where sauda_date >= '2012-04-01 00:00:00.000'
and sauda_date<='2012-04-30 00:00:00.000'
and region=@region
group by branch_cd,region

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UDP_Bank_FundsPayout22
-- --------------------------------------------------
CREATE proc UDP_Bank_FundsPayout22      
as
/* created- jay khare
*/
select * into #tbl_FundsAllocation from [172.31.15.22].PG.dbo.tbl_FundsAllocation
select * into #tbl_BankResponse from [172.31.15.22].PG.dbo.tbl_BankResponse where nResponseCode=0 
select * into #tbl_BankRequest from [172.31.15.22].PG.dbo.tbl_BankRequest 
select * into #tbl_ProductMaster from [10.30.30.16].PG.dbo.tbl_ProductMaster    
            
select               
a.sLoginId,            
--a.nMarketSegmentId,            
nMarketSegmentId=a.sproductId,            
--d.sUserDefinedExchangeName,            
sUserDefinedExchangeName=d.sproductname,            
a.nAmount,a.nServiceCharge,a.sDateTime,a.nTxnRefNo,a.sGroupId,a.nProcessFlag,              
c.sBankId,            
--c.sAgencyId,            
sAgencyId='',            
b.sBankRefNo,c.sFromAccNo,c.sToAccNo,            
product=(Case when sProductType='diet' then 'AngelDiet' else 'AngelTrade' end)            
from               
#tbl_FundsAllocation a,               
(select * from #tbl_BankResponse) b,               
#tbl_BankRequest c,        
#tbl_ProductMaster d        
--,PG.dbo.tbl_ExchangeDetails d              
where a.nTxnRefNo=b.nTxnRefNo and a.nTxnRefNo=c.nTxnRefNo and a.sproductId=d.sproductId               
--AND a.nMarketSegmentId=d.nExchangeid              
AND b.sBankRefNo <> 0

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_BO_Clientdetails_MobileNo
-- --------------------------------------------------
CREATE procedure [dbo].[upd_BO_Clientdetails_MobileNo]    
as    
--begin transaction    
/*    
select updt=getdate(),a.party_code,BO_Mobile_No=a.mobile_pager,Verified_Mobile_No=b.mobile_pager     
into #BO_Mobile_no_Backup     
from risk.dbo.client_details a (nolock),     
risk.dbo.V_Verified_ClientMobile b where a.party_code=b.party_code and a.mobile_pager <> b.mobile_pager    
    
insert into BO_Mobile_no_Backup select * from #BO_Mobile_no_Backup     
    
select * into #temp1 from AngelNseCM.msajag.dbo.client_details where cl_Code in (select party_code from #BO_Mobile_no_Backup )                                
    
update #temp1 set status='U', imp_status=0, modifidedon=getdate()                                
    
update #temp1 set mobile_pager=b.Verified_Mobile_No from #BO_Mobile_no_Backup b   
where #temp1.party_Code=b.party_Code    
    
--update client_Details set mobile_pager =b.Verified_Mobile_No from #BO_Mobile_no_Backup b where client_Details.party_Code=b.party_Code    
/*    
delete from AngelNseCM.msajag.dbo.client_brok_details where cl_Code in (select party_code from #temp1)                                
insert into AngelNseCM.msajag.dbo.client_brok_details select * from #temp1                                
*/    
--commit transaction 
*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_bolt
-- --------------------------------------------------
CREATE proc upd_bolt
as
Set Nocount On
declare @nor as int

truncate table boltfile_temp
insert into boltfile_temp select * from mis.testdb.dbo.boltfile_temp
update boltfile_temp set maxval = replace(maxval,'|','')
truncate table boltfile
insert into boltfile select * from boltfile_temp (nolock)
select @nor=count(*) from boltfile (nolock)
update boltfile_info set nor=@nor, tdate=getdate()

select nor=@nor

Set Nocount Off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_Chq_payin
-- --------------------------------------------------
create procedure upd_Chq_payin
as
update temp_payin set posted_status='Y',posted_on=getdate()
update payin set posted_status='Y',posted_on=getdate() where srno in (Select srno from temp_payin)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ctcl_LOC
-- --------------------------------------------------
CREATE procedure upd_ctcl_LOC  
as      
      
      
set transaction isolation level read uncommitted      
set nocount on      
  
DECLARE @Branch char(50)            
            
DECLARE c1 CURSOR FOR            
SELECT Branch        
FROM ctcl_boltno order by Branch            
            
OPEN c1            
            
FETCH NEXT FROM c1            
INTO @Branch            
            
WHILE @@FETCH_STATUS = 0            
BEGIN            
            
--PRINT @Branch            
Exec sp_CTCLBranch @Branch            
            
FETCH NEXT FROM c1            
INTO @Branch             
END            
            
CLOSE c1            
DEALLOCATE c1            
  
  
SELECT distinct d.SHORT_NAME,c.*  
into #bsecm    
FROM (select distinct segment='BSECM',  
party_Code=a.t11,scrip_Cd=a.t4,scrip_name=a.t2,bs=a.t14,mktrate=a.t5,tradeqty=a.t6,  
trade_Date=a.t10,tradetime=a.t10,location=b.branch   
from tror_bse A,CTCLBSEBranch B where            
convert(int,A.t2) = convert(int,B.bsecm) ) C,            
intranet.risk.dbo.bse_client1 D WHERE C.party_Code=D.cl_code    
  
SELECT distinct d.SHORT_NAME,c.*  
into #nsecm    
FROM (select distinct segment='NSECM',  
party_Code=a.t15,scrip_Cd=rtrim(ltrim(a.t3))+'-'+a.t4,scrip_name=a.t5,bs=a.t11,mktrate=a.t13,tradeqty=a.t12,  
trade_Date=a.t20,tradetime=a.t20,location=b.branch   
from tror_nse A,ctcl_boltno B where            
convert(int,A.t9) = convert(int,B.nsecm) ) C,            
intranet.risk.dbo.nse_client1 D WHERE C.party_Code=D.cl_code   
  
SELECT distinct d.SHORT_NAME,c.*  
into #nsefo  
FROM (select distinct segment='NSEFO',  
party_Code=a.t17,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(a.t5,'-','')+'-'+a.t6+'-'+a.t7,  
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,  
trade_Date=a.t20,tradetime=a.t20,location=b.branch   
from tror_nsefo A,ctcl_boltno B where            
convert(int,A.t11) = convert(int,B.nsefo) ) C,            
intranet.risk.dbo.nse_client1 D WHERE C.party_Code=D.cl_code   
  
SELECT distinct d.SHORT_NAME,c.*  
into #mcx  
FROM (select distinct segment='MCX',  
party_Code=a.t19,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t4))+'-'+a.t5+'-'+a.t6+'-'+a.t7+'-'+a.t8,  
bs=a.t15,mktrate=a.t17,tradeqty=a.t16,  
trade_Date=a.t24,tradetime=a.t24,location=b.branch   
from tror_mcx A,ctcl_boltno B where            
convert(int,A.t14) = convert(int,B.mcx) ) C,            
intranet.risk.dbo.nse_client1 D WHERE C.party_Code=D.cl_code   
  
SELECT distinct d.SHORT_NAME,c.*  
into #NCDX  
FROM (select distinct segment='NCDEX',  
party_Code=a.t17,scrip_Cd=a.t1,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(t5,' ','')+'-'+a.t6+'-'+a.t7,  
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,  
trade_Date=a.t20,tradetime=a.t20,location=b.branch   
from tror_NCDEX A,ctcl_boltno B where            
convert(int,A.t11) = convert(int,B.NCDEX) ) C,            
intranet.risk.dbo.ncdx_client1 D WHERE C.party_Code=D.cl_code  
  
------------ update Trade details                 
delete from ctcl_Loc_hist    
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #bsecm) and segment='BSECM'    
  
insert into ctcl_Loc_hist                  
select sauda_DAte=convert(datetime,trade_Date),*          
from #bsecm   
  
delete from ctcl_Loc_hist       
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #nsecm) and segment='NSECM'      
      
insert into ctcl_Loc_hist      
select sauda_DAte=convert(datetime,trade_Date),*  from #nsecm      
      
delete from ctcl_Loc_hist       
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #nsefo) and segment='NSEFO'      
      
insert into ctcl_Loc_hist      
select sauda_DAte=convert(datetime,trade_Date),*  from #nsefo      
      
delete from ctcl_Loc_hist       
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #mcx) and segment='MCX'      
      
insert into ctcl_Loc_hist      
select sauda_DAte=convert(datetime,trade_Date),*  from #mcx      
      
delete from ctcl_Loc_hist       
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #ncdx) and segment='NCDEX'      
      
insert into ctcl_Loc_hist      
select sauda_DAte=convert(datetime,trade_Date),*  from #ncdx      
  
---------- Generate Summary File    
   
select party_code,sbtag,subgroup,b.sbname                   
into #aa    
from risk.dbo.finmast a,                  
risk.dbo.subgroup b where a.subgroup=b.sub_Broker                  
  
declare @sdate as datetime                  
select @sdate = (select max(sauda_Date) from ctcl_loc_hist)                  
  
select sauda_Date,segment,B.PARTY_CODE,b.sbtag,b.subgroup,b.sbname,  
turnover=sum((convert(money,mktrate)/100)*convert(int,tradeqty))              
,Location,SHORT_NAME                   
into #summ                  
from ctcl_loc_hist a,#aa b where a.party_Code=b.party_code   
--and sauda_date = @sdate                  
group by sauda_Date,segment,b.sbtag,b.subgroup,b.sbname,location,B.PARTY_CODE,SHORT_NAME                  
  
---select sauda_Date,segment,B.PARTY_CODE,b.sbtag,b.subgroup,b.sbname,SHORT_NAME,Location,  
----turnover=sum((convert(money,mktrate)/100)*convert(int,tradeqty))  from ctcl_loc_hist a,#aa b where a.party_Code=b.party_code   
----and segment='bsecm' and a.party_code='S4324'  
----group by sauda_Date,segment,B.PARTY_CODE,b.sbtag,b.subgroup,b.sbname,SHORT_NAME,Location  
  
----------insert into ctcl_loc_summ                
truncate table ctcl_LOC_summ        
  
insert into ctcl_loc_summ select * from #summ              
------------------  
  
truncate table ctcl_locsb_mast                   
  
insert into ctcl_locsb_mast   
select sbtag,subgroup,sbname,location,SHORT_NAME               
from ctcl_loc_summ where subgroup <> ''      
group by sbtag,sbname,short_name,subgroup,location                
                  
update ctcl_loc_summ set sbtag=b.sbtag, subgroup=b.subgroup, sbname=b.sbname from                  
ctcl_locsb_mast b where ctcl_loc_summ.short_name=b.short_name                  
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ctcl_LOC1
-- --------------------------------------------------
create proc upd_ctcl_LOC1
as

set transaction isolation level read uncommitted        

set nocount on  


Declare @tbl table (RowId int identity(1,1), Branch varchar(100))
Insert @tbl
SELECT Branch FROM ctcl_boltno order by Branch 
DECLARE  @i int
DECLARE  @countdata int
SET @i = 1 
DECLARE @Contact VARCHAR(100) 
select @countdata=count(Branch) from ctcl_boltno
WHILE (@i <=@countdata)
BEGIN
SELECT @Contact=Branch FROM @tbl  
WHERE RowId = @i 
Exec CTCLBranch1 @Contact   
set @i=@i+1
end


 

  
declare @sdate as datetime                      
select @sdate = (select max(trade_Date) from  
(  
select b.short_name,a.* --into #file2   
from (select distinct segment='BSECM',      
party_Code=a.t11,scrip_Cd=a.t4,scrip_name=a.t2,bs=a.t14,mktrate=a.t5,tradeqty=a.t6,      
trade_Date=a.t10,tradetime=a.t10,location=b.branch       
--into #bsecm  
from tror_bse A,CTCLBSEBranch B   
where convert(int,A.t2) = convert(int,B.bsecm)   
  
union  
select distinct segment='NSECM',      
party_Code=a.t15,scrip_Cd=rtrim(ltrim(a.t3))+'-'+a.t4,scrip_name=a.t5,bs=a.t11,mktrate=a.t13,tradeqty=a.t12,      
trade_Date=a.t20,tradetime=a.t20,location=b.branch       
--into #nsecm  
from tror_nse A,ctcl_boltno B   
where convert(int,A.t9) = convert(int,B.nsecm)   
  
union  
select distinct segment='NSEFO',      
party_Code=a.t17,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(a.t5,'-','')+'-'+a.t6+'-'+a.t7,      
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,      
trade_Date=a.t20,tradetime=a.t20,location=b.branch       
--into #nsefo  
from tror_nsefo A,ctcl_boltno B where                
convert(int,A.t11) = convert(int,B.nsefo)  
   
union  
select distinct segment='MCX',      
party_Code=a.t19,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t4))+'-'+a.t5+'-'+a.t6+'-'+a.t7+'-'+a.t8,      
bs=a.t15,mktrate=a.t17,tradeqty=a.t16,      
trade_Date=a.t24,tradetime=a.t24,location=b.branch       
--into #mcx  
 from tror_mcx A,ctcl_boltno B where convert(int,A.t14) = convert(int,B.mcx)   
  
union  
select distinct segment='NCDEX',      
party_Code=a.t17,scrip_Cd=a.t1,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(t5,' ','')+'-'+a.t6+'-'+a.t7,      
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,      
trade_Date=a.t20,tradetime=a.t20,location=b.branch       
--into #ncdx  
from tror_NCDEX A,ctcl_boltno B where convert(int,A.t11) = convert(int,B.NCDEX)  
) a, risk.dbo.client_details b  
where a.party_Code=b.party_Code  
) as k1 )  
  
delete from ctcl_Loc_hist where sauda_DAte = @sdate  
 




insert into ctcl_Loc_hist                      
select sauda_DAte=convert(datetime,trade_Date),* from  
(  
  
select b.short_name,a.* --into #file2   
from (select distinct segment='BSECM',      
party_Code=a.t11,scrip_Cd=a.t4,scrip_name=a.t2,bs=a.t14,mktrate=a.t5,tradeqty=a.t6,      
trade_Date=a.t10,tradetime=a.t10,location=b.branch       
--into #bsecm  
from tror_bse A,CTCLBSEBranch B   
where convert(int,A.t2) = convert(int,B.bsecm)   
  
union  
select distinct segment='NSECM',      
party_Code=a.t15,scrip_Cd=rtrim(ltrim(a.t3))+'-'+a.t4,scrip_name=a.t5,bs=a.t11,mktrate=a.t13,tradeqty=a.t12,      
trade_Date=a.t20,tradetime=a.t20,location=b.branch       
--into #nsecm  
from tror_nse A,ctcl_boltno B   
where convert(int,A.t9) = convert(int,B.nsecm)   
  
union  
select distinct segment='NSEFO',      
party_Code=a.t17,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(a.t5,'-','')+'-'+a.t6+'-'+a.t7,      
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,      
trade_Date=a.t20,tradetime=a.t20,location=b.branch       
--into #nsefo  
from tror_nsefo A,ctcl_boltno B where                
convert(int,A.t11) = convert(int,B.nsefo)  
   
union  
select distinct segment='MCX',      
party_Code=a.t19,scrip_Cd=a.t3,scrip_name=rtrim(ltrim(a.t4))+'-'+a.t5+'-'+a.t6+'-'+a.t7+'-'+a.t8,      
bs=a.t15,mktrate=a.t17,tradeqty=a.t16,      
trade_Date=a.t24,tradetime=a.t24,location=b.branch       
--into #mcx  
 from tror_mcx A,ctcl_boltno B where convert(int,A.t14) = convert(int,B.mcx)   
  
union  
select distinct segment='NCDEX',      
party_Code=a.t17,scrip_Cd=a.t1,scrip_name=rtrim(ltrim(a.t3))+'-'+a.t4+'-'+replace(t5,' ','')+'-'+a.t6+'-'+a.t7,      
bs=a.t13,mktrate=a.t15,tradeqty=a.t14,      
trade_Date=a.t20,tradetime=a.t20,location=b.branch       
--into #ncdx  
from tror_NCDEX A,ctcl_boltno B where convert(int,A.t11) = convert(int,B.NCDEX)  
) a, risk.dbo.client_details b  
where a.party_Code=b.party_Code  
) as k2  
  


---------- Generate Summary File      


select party_code,sbtag,subgroup,b.sbname                       
into #aa       
from risk.dbo.finmast a,                      
risk.dbo.subgroup b where a.subgroup=b.sub_Broker    
  
  
  
  
select sauda_Date,segment,Location,SHORT_NAME,party_code,turnover=sum((convert(money,mktrate)/100)*convert(int,tradeqty))  
into #summ_a from ctcl_loc_hist   
group by sauda_Date,segment,location,SHORT_NAME,party_code    
  

  
truncate table ctcl_LOC_summ     
  
insert into ctcl_loc_summ  
select sauda_Date,segment,B.PARTY_CODE,b.sbtag,b.subgroup,b.sbname,      
turnover,Location,SHORT_NAME                       
--into #summ                      
from #summ_a a,#aa b where a.party_Code=b.party_code    
       
   



truncate table ctcl_locsb_mast                       

insert into ctcl_locsb_mast     
select sbtag,subgroup,sbname,location,SHORT_NAME                 
from ctcl_loc_summ where subgroup <> ''        
group by sbtag,sbname,short_name,subgroup,location                  

                    

update ctcl_loc_summ set sbtag=b.sbtag, subgroup=b.subgroup, sbname=b.sbname from                    
ctcl_locsb_mast b where ctcl_loc_summ.short_name=b.short_name  


set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ctcl_Trade
-- --------------------------------------------------
CREATE procedure upd_ctcl_Trade  
as  
  
  
set transaction isolation level read uncommitted  
set nocount on  
  
select segment='BSECM',ctcl_id=ltrim(rtrim(a.t32)),party_Code=t10,scrip_Cd=b.t1,  
scrip_name=b.t2,bs=b.t11,mktrate=t4/100,tradeqty=t5,trade_Date=t9,tradetime=t8  
into #bsecm  
from (select distinct t32=ltrim(rtrim(t32)),t25=ltrim(rtrim(t25)) from ord_bse) a, trd_bse b where a.t25=b.t10 --and ltrim(rtrim(a.t1))=b.t13  
  
select segment='NSECM',ctcl_id=ltrim(rtrim(a.t32)),  
party_code=b.t15,scrip_Cd=rtrim(ltrim(b.t3))+'-'+t4,scrip_name=b.t5,  
bs=replace(replace(b.t11,'1','B'),'2','S'),  
mktrate=b.t13,  
tradeqty=b.t12,  
trade_date=substring(t20,1,11),  
tradetime=substring(t20,13,8)  
into #nsecm  
from (select distinct t32,t25 from ord_nse) a, trd_nse b where a.t25=b.t15  
  
  
select segment='NSEFO',  
ctcl_id=ltrim(rtrim(t12)),  
party_code=ltrim(rtrim(t18)),  
scrip_Cd=t3+' '+ltrim(rtrim(t4))+' '+t5+' '+t7,  
scrip_name=t8,  
bs=replace(replace(t14,'1','B'),'2','S'),  
mktrate=t16,  
tradeqty=t15,  
trade_date=substring(t22,1,11),  
tradetime=substring(t22,13,8)  
into #nsefo  
from trd_nsefo   
  
  
select segment='MCX',  
ctcl_id=ltrim(rtrim(t13)),  
party_code=ltrim(rtrim(t19)),  
scrip_Cd=t4+' '+ltrim(rtrim(t5))+' '+t6+' '+t7,  
scrip_name=t9,  
bs=replace(replace(t15,'1','B'),'2','S'),  
mktrate=t17,  
tradeqty=t16,  
trade_date=substring(t24,1,11),  
tradetime=substring(t24,13,8)  
into #mcx  
from trd_mcx  
  
  
  
select segment='NCDEX',  
ctcl_id=ltrim(rtrim(t12)),  
party_code=ltrim(rtrim(t18)),  
scrip_Cd=t3+' '+ltrim(rtrim(t4))+' '+t5+' '+t6,  
scrip_name=t8,  
bs=replace(replace(t14,'1','B'),'2','S'),  
mktrate=t16,  
tradeqty=t15,  
trade_date=substring(t22,1,11),  
tradetime=substring(t22,13,8)  
into #ncdx  
from trd_ncdex  
  
  
-------- update Trade details  
  
delete from ctcl_trade_hist   
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #bsecm) and segment='BSECM'  
  
insert into ctcl_trade_hist  
select sauda_DAte=convert(datetime,trade_Date),*  from #bsecm  
  
delete from ctcl_trade_hist   
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #nsecm) and segment='NSECM'  
  
insert into ctcl_trade_hist  
select sauda_DAte=convert(datetime,trade_Date),*  from #nsecm  
  
delete from ctcl_trade_hist   
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #nsefo) and segment='NSEFO'  
  
insert into ctcl_trade_hist  
select sauda_DAte=convert(datetime,trade_Date),*  from #nsefo  
  
delete from ctcl_trade_hist   
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #mcx) and segment='MCX'  
  
insert into ctcl_trade_hist  
select sauda_DAte=convert(datetime,trade_Date),*  from #mcx  
  
delete from ctcl_trade_hist   
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #ncdx) and segment='NCDEX'  
  
insert into ctcl_trade_hist  
select sauda_DAte=convert(datetime,trade_Date),*  from #ncdx  
  
  
  
---------- Generate Summary File  
  
  
declare @sdate as datetime  
select @sdate = (select max(sauda_Date) from ctcl_trade_hist)  

select sauda_Date,segment,ctcl_id,b.sbtag,b.subgroup,b.sbname,turnover=sum(convert(money,mktrate)*convert(int,tradeqty))   
into #summ  
from ctcl_trade_hist a,   
(  
select party_code,sbtag,subgroup,b.sbname   
from risk.dbo.finmast a,  
risk.dbo.subgroup b where a.subgroup=b.sub_Broker  
)  
b where a.party_Code=b.party_code --and sauda_date = @sdate  
group by sauda_Date,segment,ctcl_id,b.sbtag,b.subgroup,b.sbname  
  
  
--delete from ctcl_trade_summ where sauda_Date=@sdate  
truncate table ctcl_trade_summ   

insert into ctcl_trade_summ  
select a.*,sbtag=isnull(b.sbtag,''),subgroup=isnull(b.subgroup,''),sbname=isnull(b.sbname,''),  
--sauda_date=isnull(sauda_DAte,@sdate),
sauda_date,
segment=isnull(segment,''),  
turnover=isnull(turnover,0),0  
from vsat_login_id a left outer join #summ b on b.ctcl_id=a.loginid   
where b.sauda_date is not null 


------------------------

insert into ctcl_trade_summ  
select a.sitecode,a.loginid,sbtag=isnull(b.sbtag,''),subgroup=isnull(b.subgroup,''),sbname=isnull(b.sbname,''),  
--sauda_date=isnull(sauda_DAte,@sdate),
a.sauda_date,
segment=isnull(segment,''),  
turnover=isnull(turnover,0),0  
from (select * from vsat_login_id x, (select distinct sauda_date from #summ) y )a 
left outer join #summ b on b.ctcl_id=a.loginid and a.sauda_date=b.sauda_Date
where b.sauda_date is null and loginid <> ''


------------------------
  
truncate table ctcl_sb_mast   
  
insert into ctcl_sb_mast   
select loginid,sbtag,subgroup,sbname from ctcl_trade_summ where subgroup <> ''  
  
update ctcl_trade_summ set sbtag=b.sbtag, subgroup=b.subgroup, sbname=b.sbname from  
ctcl_sb_mast b where ctcl_trade_summ.loginid=b.loginid  
  
  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_ctcl_Trade1
-- --------------------------------------------------
CREATE procedure upd_ctcl_Trade1              
as              
              
               
set transaction isolation level read uncommitted              
set nocount on             
        
--select segment='BSECM',ctcl_id=ltrim(rtrim(a.t32)),party_Code=t10,scrip_Cd=b.t1,            
--scrip_name=b.t2,bs=b.t11,mktrate=t4/100,tradeqty=t5,trade_Date=t9,tradetime=t8            
--into #bsecm            
--from (select distinct t32=ltrim(rtrim(t32)),t25=ltrim(rtrim(t25)) from ord_bse) a, trd_bse b where a.t25=b.t10 --and ltrim(rtrim(a.t1))=b.t13            
        
        
DECLARE @Branch char(50)        
        
DECLARE c1 CURSOR FOR        
SELECT Branch    
FROM ctcl_boltno order by Branch        
        
OPEN c1        
        
FETCH NEXT FROM c1        
INTO @Branch        
        
WHILE @@FETCH_STATUS = 0        
BEGIN        
        
--PRINT @Branch        
Exec sp_CTCLBranch @Branch        
        
FETCH NEXT FROM c1        
INTO @Branch         
END        
        
CLOSE c1        
DEALLOCATE c1        
        
    
select distinct t32=ltrim(rtrim(t32)),t25=ltrim(rtrim(t25)),LOCATION=B.BRANCH     
into #file1 from ord_bse A,CTCLBSEBranch B where        
convert(int,A.t9) = convert(int,B.bsecm)     
    
SELECT  short_name,C.* into #bse_file FROM        
(select * from #file1 ) C,        
intranet.risk.dbo.bse_client1 D WHERE C.t25=D.cl_code    
    
select E.SHORT_NAME,segment='BSECM',ctcl_id=ltrim(rtrim(E.t32)),party_Code=t10,scrip_Cd=F.t1,              
scrip_name=F.t2,bs=F.t11,mktrate=t4/100,tradeqty=t5,trade_Date=t9,tradetime=t8,location=E.location                
Into #bsecm              
FROM (SELECT * from #bse_file) E,trd_bse F         
where E.t25=F.t10          
    
select distinct t32,t25,t9,location=B.branch into #file2    
from ord_nse A, ctcl_boltno B where A.t9=B.nsecm    
    
select short_name,C.* into #nse_file from           
(select * from #file2) C   ,          
intranet.risk.dbo.nse_client1 D WHERE C.t25=D.cl_code    
          
select E.SHORT_NAME,segment='NSECM',ctcl_id=ltrim(rtrim(E.t32)),              
party_code=F.t15,scrip_Cd=rtrim(ltrim(F.t3))+'-'+t4,scrip_name=F.t5,              
bs=replace(replace(F.t11,'1','B'),'2','S'),              
mktrate=ltrim(rtrim(F.t13)),              
tradeqty=F.t12,              
trade_date=substring(t20,1,11),              
tradetime=substring(t20,13,8),          
location=E.location          
into #nsecm              
from (select * from #nse_file) E,trd_nse F          
WHERE E.T25=F.T15          
      
select A.*,location=B.branch into #file3 from          
 ord_nsefo A, ctcl_boltno B where A.t12=B.nsefo    
    
SELECT short_name,C.* into #nsefo_file FROM          
(select * from #file3) C,          
intranet.risk.dbo.fo_client1 D WHERE C.t28=D.cl_code    
    
SELECT E.SHORT_NAME,segment='NSEFO',              
ctcl_id=ltrim(rtrim(E.t12)),              
party_code=ltrim(rtrim(F.t18)),              
scrip_Cd=F.t3+' '+ltrim(rtrim(F.t4))+' '+F.t5+' '+F.t7,              
scrip_name=F.t8,              
bs=replace(replace(F.t14,'1','B'),'2','S'),              
mktrate=F.t16,              
tradeqty=F.t15,              
trade_date=substring(F.t22,1,11),              
tradetime=substring(F.t22,13,8)  ,           
location=E.LOCATION           
into #nsefo           
FROM          
(SELECT * from #nsefo_file) E,trd_nsefo F          
WHERE E.T28=F.T18          
      
select A.*,location=B.branch into #file4 from          
 Ord_MCX A, ctcl_boltno B where A.t13=B.mcx    
    
SELECT short_name,C.* into #mcx_file FROM          
(select * from #file4) C,          
intranet.risk.dbo.mcdx_client1 D WHERE C.t29=D.cl_code    
    
SELECT E.SHORT_NAME,segment='MCX',ctcl_id=ltrim(rtrim(E.t13)),              
party_code=ltrim(rtrim(F.t19)),scrip_Cd=F.t4+' '+ltrim(rtrim(F.t5))+' '+F.t6+' '+F.t7,              
scrip_name=F.t9,bs=replace(replace(F.t15,'1','B'),'2','S'),              
mktrate=F.t17,tradeqty=F.t16,trade_date=substring(F.t24,1,11),              
tradetime=substring(F.t24,13,8),location=E.LOCATION           
into #mcx FROM          
(SELECT * from #mcx_file) E,trd_MCX F          
WHERE E.T29=F.T19          
          
select A.*,location=B.branch into #file5 from          
 ord_ncdex A, ctcl_boltno B where A.t12=B.ncdex    
    
SELECT short_name,C.* into #ncdx_file FROM          
(select * from #file5) C,          
intranet.risk.dbo.ncdx_client1 D WHERE C.t28=D.cl_code    
    
SELECT E.SHORT_NAME,segment='NCDEX',ctcl_id=ltrim(rtrim(E.t12)),              
party_code=ltrim(rtrim(F.t18)),scrip_Cd=F.t3+' '+ltrim(rtrim(F.t4))+' '+F.t5+' '+F.t6,              
scrip_name=F.t8,bs=replace(replace(F.t14,'1','B'),'2','S'),              
mktrate=F.t16,tradeqty=F.t15,trade_date=substring(F.t22,1,11),              
tradetime=substring(F.t22,13,8),location=E.LOCATION           
into #ncdx FROM          
(SELECT * from #ncdx_file) E,trd_NCDEX F          
WHERE E.T28=F.T18        
      
        
-------- update Trade details             
          
delete from ctcl_trade_hist1               
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #bsecm) and segment='BSECM'              
          
insert into ctcl_trade_hist1              
select sauda_DAte=convert(datetime,trade_Date),*      
from #bsecm              
          
delete from ctcl_trade_hist1               
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #nsecm) and segment='NSECM'              
              
insert into ctcl_trade_hist1              
select sauda_DAte=convert(datetime,trade_Date),*             
--into ctcl_trade_hist1           
from #nsecm              
              
delete from ctcl_trade_hist1               
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #nsefo) and segment='NSEFO'            
--select * from #nsefo        
              
insert into ctcl_trade_hist1              
select sauda_DAte=convert(datetime,trade_Date),*  from #nsefo              
              
delete from ctcl_trade_hist1               
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #mcx) and segment='MCX'              
              
insert into ctcl_trade_hist1              
select sauda_DAte=convert(datetime,trade_Date),*  from #mcx              
              
delete from ctcl_trade_hist1               
where sauda_DAte = (select sauda_DAte=max(convert(datetime,trade_Date))  from #ncdx) and segment='NCDEX'              
              
insert into ctcl_trade_hist1              
select sauda_DAte=convert(datetime,trade_Date),*  from #ncdx              
              
            
             
---------- Generate Summary File            
  --        drop table #file_2
--delete  ctcl_trade_summ1 where sauda_date>='may 12 2006' and sauda_date<='may 12 2006'
declare @sdate as datetime              
select @sdate = (select max(sauda_Date) from ctcl_trade_hist1)              
select party_code,sbtag,subgroup,b.sbname               
into #aa
from risk.dbo.finmast a,              
risk.dbo.subgroup b where a.subgroup=b.sub_Broker              


select sauda_Date,segment,ctcl_id,B.PARTY_CODE,b.sbtag,b.subgroup,b.sbname,turnover=sum(convert(money,mktrate)*convert(int,tradeqty))          
,Location,SHORT_NAME               
into #summ              
from ctcl_trade_hist1 a,#aa b where a.party_Code=b.party_code --and sauda_date = @sdate              
group by sauda_Date,segment,ctcl_id,b.sbtag,b.subgroup,b.sbname,location,B.PARTY_CODE,SHORT_NAME              
            
          
--insert into ctcl_trade_summ1            
select a.*,B.PARTY_CODE,sbtag=isnull(b.sbtag,''),subgroup=isnull(b.subgroup,''),sbname=isnull(b.sbname,''),              
sauda_date=isnull(b.sauda_DAte,@sdate),           
segment=isnull(segment,''),              
turnover=isnull(turnover,0),veriation='0',location,SHORT_NAME              
into #file_1 from 
 vsat_login_id a left outer join #summ b on b.ctcl_id=a.loginid               
where b.sauda_date is not null             
            
insert into ctcl_trade_summ1 select * from #file_1          
------------------------            
--insert into ctcl_trade_summ1  
           
select a.sitecode,a.loginid,B.PARTY_CODE,sbtag=isnull(b.sbtag,''),subgroup=isnull(b.subgroup,''),sbname=isnull(b.sbname,''),            
sauda_date=isnull(b.sauda_DAte,@sdate),            
--a.sauda_date,            
segment=isnull(segment,''),              
turnover=isnull(turnover,0),veriation='0',location,SHORT_NAME
into #file_2              
from (select * from vsat_login_id x, (select distinct sauda_date from #summ) y )a             
left outer join #summ b on b.ctcl_id=a.loginid and a.sauda_date=b.sauda_Date            
where b.sauda_date is null and loginid <> ''            

insert into ctcl_trade_summ1 select * from #file_2            
------------------------            
          
truncate table ctcl_sb_mast1               
          
insert into ctcl_sb_mast1               
select loginid,sbtag,subgroup,sbname,location,SHORT_NAME           
from ctcl_trade_summ1 where subgroup <> ''  
group by sbtag,loginid,sbname,short_name,subgroup,location            
              
update ctcl_trade_summ1 set sbtag=b.sbtag, subgroup=b.subgroup, sbname=b.sbname from              
ctcl_sb_mast1 b where ctcl_trade_summ1.loginid=b.loginid              
              
              
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_diet_dtc
-- --------------------------------------------------
CREATE procedure upd_diet_dtc(@vsat as varchar(30))                        
as                        
                
update mis.dbo.odinclientinfo set tag=replace(tag,',','')    
delete from diet_dtc where location=@vsat or isnull(location,'')=''          
                      
exec mis.dbo.upd_diet_postfix                      
                      
----------- From Diet Dealer Master                      
                    
insert into diet_dtc                         
select dealercd=--ltrim(rtrim(tag))+                    
replace(max(b.postfix),'NVASHI2','VASHI2'),a.pcode,a.servermapped,getdate() from mis.dbo.odinclientinfo a with (nolock),                        
(                        
select pcode,servermapped,postfix=(dealerpostfix)                         
from mis.dbo.diet_postfix (nolock) where servermapped=@vsat                         
) b where a.tag=b.pcode            
group by a.pcode,a.servermapped                   
/*Commented by shweta on 31/03/2008 */                  
--and a.pcode not in (select party_Code from diet_dtc (nolock))                        
                      
                      
select servermapped,postfix=max(dealerpostfix)                         
into #file              
from mis.remisior.dbo.ebrok_terminal_master                         
where to_date > getdate() AND PRODUCT='ODINDIET'                        
group by servermapped                
              
                     
insert into diet_dtc                         
select dealercd=replace(ltrim(rtrim(tag))+b.postfix,'NVASHI2','VASHI2'),pcode,a.servermapped,getdate() from mis.dbo.odinclientinfo a with (nolock),                        
#file b where a.servermapped=b.servermapped                        
/*Commented by shweta on 31/03/2008 */                  
and a.pcode not in (select party_Code from diet_dtc (nolock) where location=@vsat)                     
                        
select dealer,party_Code,location,last_updated=max(last_updated) into #filex from testdb.dbo.diet_dtc with (nolock) group by dealer,party_Code,location            
truncate table diet_dtc             
insert into diet_dtc select * from #filex            
                 
            
--select party_code from mis.dbo.odinclientinfo_new       
  
/*  
CREATE procedure upd_diet_dtc(@vsat as varchar(30))                        
as                        
                
update mis.dbo.odinclientinfo set tag=replace(tag,',','')    
delete from diet_dtc where location=@vsat or isnull(location,'')=''          
                      
exec mis.dbo.upd_diet_postfix                      
                      
----------- From Diet Dealer Master                      
                    
insert into diet_dtc                         
select dealercd=--ltrim(rtrim(tag))+                    
replace(max(b.postfix),'NVASHI2','VASHI2'),a.pcode,a.servermapped,getdate() from mis.dbo.odinClientInfo a,                        
(                        
select pcode,servermapped,postfix=(dealerpostfix)                         
from mis.dbo.diet_postfix (nolock) where servermapped=@vsat                         
) b where a.tag=b.pcode            
group by a.pcode,a.servermapped                   
/*Commented by shweta on 31/03/2008 */                  
--and a.pcode not in (select party_Code from diet_dtc (nolock))                        
                      
                      
select servermapped,postfix=max(dealerpostfix)                         
into #file              
from mis.remisior.dbo.ebrok_terminal_master                         
where to_date > getdate() AND PRODUCT='ODINDIET'                        
group by servermapped                
              
                     
insert into diet_dtc                         
select dealercd=replace(ltrim(rtrim(tag))+b.postfix,'NVASHI2','VASHI2'),pcode,a.servermapped,getdate() from mis.dbo.odinClientInfo a,                        
#file b where a.servermapped=b.servermapped                        
/*Commented by shweta on 31/03/2008 */                  
and a.pcode not in (select party_Code from diet_dtc (nolock) where location=@vsat)                     
                        
select dealer,party_Code,location,last_updated=max(last_updated) into #filex from testdb.dbo.diet_dtc group by dealer,party_Code,location            
truncate table diet_dtc             
insert into diet_dtc select * from #filex            
                 
            
--select party_code from mis.dbo.odinClientInfo   
*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_diet_dtc_temp
-- --------------------------------------------------
CREATE procedure upd_diet_dtc_temp(@vsat as varchar(30))                      
as                      
              
update mis.dbo.odinclientinfo_new set tag=replace(tag,',','')  
delete from diet_dtc where location=@vsat or isnull(location,'')=''        
                    
exec mis.dbo.upd_diet_postfix_temp                    
                    
----------- From Diet Dealer Master                    
                  
insert into diet_dtc                       
select dealercd=--ltrim(rtrim(tag))+                  
replace(max(b.postfix),'NVASHI2','VASHI2'),a.pcode,a.servermapped,getdate() from mis.dbo.odinclientinfo_new a,                      
(                      
select pcode,servermapped,postfix=(dealerpostfix)                       
from mis.dbo.diet_postfix (nolock) where servermapped=@vsat                       
) b where a.tag=b.pcode          
group by a.pcode,a.servermapped                 
/*Commented by shweta on 31/03/2008 */                
--and a.pcode not in (select party_Code from diet_dtc (nolock))                      
                    
                    
select servermapped,postfix=max(dealerpostfix)                       
into #file            
from mis.remisior.dbo.ebrok_terminal_master                       
where to_date > getdate() AND PRODUCT='ODINDIET'                      
group by servermapped              
            
                   
insert into diet_dtc                       
select dealercd=replace(ltrim(rtrim(tag))+b.postfix,'NVASHI2','VASHI2'),pcode,a.servermapped,getdate() from mis.dbo.odinclientinfo_new a,                      
#file b where a.servermapped=b.servermapped                      
/*Commented by shweta on 31/03/2008 */                
and a.pcode not in (select party_Code from diet_dtc (nolock) where location=@vsat)                   
                      
select dealer,party_Code,location,last_updated=max(last_updated) into #filex from testdb.dbo.diet_dtc group by dealer,party_Code,location          
truncate table diet_dtc           
insert into diet_dtc select * from #filex          
               
          
--select party_code from mis.dbo.odinclientinfo_new

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_odinlimit
-- --------------------------------------------------
CREATE procedure upd_odinlimit    
as    
--truncate table ODIN_LIMITS_TEMP    
--insert into ODIN_LIMITS_TEMP    
--select * from mis.upload.dbo.ODIN_LIMITS_TEMP 
truncate table ODIN_LIMITS_TEMP_NewFormat    
insert into ODIN_LIMITS_TEMP_NewFormat    
select * from mis.upload.dbo.ODIN_LIMITS_TEMP

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPD_OVERALL_MRG
-- --------------------------------------------------
CREATE PROC UPD_OVERALL_MRG
AS
DELETE FROM overall_mrg WHERE FUNDING_DATE IN (SELECT DISTINCT FUNDING_DATE FROM tmp_overall_mrg)
INSERT INTO overall_mrg
select *, 
FDATE=CONVERT(DATETIME,SUBSTRING(FUNDING_DATE,3,2)+'/'+SUBSTRING(FUNDING_DATE,1,2)+'/'+SUBSTRING(FUNDING_DATE,5,4))
from tmp_overall_mrg

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upd_SEBI_BANNED_ENTITIES
-- --------------------------------------------------
CREATE procedure [dbo].[upd_SEBI_BANNED_ENTITIES]

as

truncate table tempDumpSEBIData 
truncate table tempDumpSEBIData1
 

/*BULK INSERT tempDumpSEBIData FROM 'D:\upload1\sebi\sebidata.txt' */
BULK INSERT tempDumpSEBIData FROM 'I:\upload1\sebi\sebidata.txt' 
insert into tempDumpSEBIData1 (text1) select * from tempDumpSEBIData 

--select * from tempDumpSEBIData1  where ltrim(rtrim(text1))='</thead>'
delete from tempDumpSEBIData1  where srno <= (select srno from tempDumpSEBIData1  where ltrim(rtrim(text1))='</thead>')

update  tempDumpSEBIData1 set text1 = '<tr>' where ltrim(rtrim(text1))='<tr style=''mso-yfti-irow:1''>'
update  tempDumpSEBIData1 set text1 = '<td>' where 
ltrim(rtrim(text1))='<td width=107 valign=top style=''width:79.95pt;border:solid windowtext 1.0pt;'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))=
'mso-border-alt:solid windowtext .5pt;background:#FFEAC1;padding:1.5pt 1.5pt 1.5pt 1.5pt''>'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))=
'<p class=MsoNormal style=''text-align:justify;mso-layout-grid-align:none;'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))=
'text-autospace:none''><span style=''font-size:8.0pt;font-family:Verdana;'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-bidi-font-weight:bold''>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'(<st1:country-region','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'w:st="on"><st1:place w:st="on">','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:place></st1:country-region>)','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<o:p></o:p></span></p>','')

update  tempDumpSEBIData1 set text1 = '<td>' where 
ltrim(rtrim(text1))='<td width=44 valign=top style=''width:32.8pt;border:solid windowtext 1.0pt;'

delete from tempDumpSEBIData1  where ltrim(rtrim(text1))=
'<p class=MsoNormal style=''text-align:justify''><span style=''font-size:8.0pt;'

update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'font-family:Verdana;mso-bidi-font-family:Arial''>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<o:p>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</o:p>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<span>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</span>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<b>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</b>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'style=''','')

update  tempDumpSEBIData1 set text1 = '<td>' where 
ltrim(rtrim(text1))='<td width=170 valign=top width:127.3pt;border:solid windowtext 1.0pt;'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<span','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</p>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'&nbsp;',' ')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'&amp;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-bidi-font-family:Arial;',' ')

update  tempDumpSEBIData1 set text1 = '<td>' where 
ltrim(rtrim(text1))='<td width=107 valign=top width:80.3pt;border:solid windowtext 1.0pt;'

update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:place>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:country-region>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:country-region','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:place','')

update  tempDumpSEBIData1 set text1 = '<td>' where 
ltrim(rtrim(text1))='<td width=142 valign=top width:106.25pt;border:solid windowtext 1.0pt;'

delete from tempDumpSEBIData1  where ltrim(rtrim(text1))=
'<p class=MsoNormal margin-right:1.5pt;text-align:justify;line-height:'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))=
'12.0pt;mso-layout-grid-align:none;text-autospace:none''>'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='font-size:8.0pt;font-family:Verdana;'


update  tempDumpSEBIData1 set text1='<tr>' where ltrim(rtrim(text1)) like '<tr mso-yfti-irow:%'

update  tempDumpSEBIData1 set text1 = '<td>' where 
ltrim(rtrim(text1))='<td width=47 valign=top width:35.45pt;border:solid windowtext 1.0pt;'

delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='font-family:Verdana; color:black;mso-bidi-font-weight:'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'bold''>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'w:st="on">','')

delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal>font-size:8.0pt;font-family:Verdana;'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-bidi-font-family:Arial''>','')

update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'font-family:','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'font-size:8.0pt;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'lang=EN-GB','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'Verdana;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'Verdana','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-ansi-language:EN-GB;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-bidi-font-weight:','')

delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='none;text-autospace:none''>'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal margin-right:1.5pt;line-height:12.0pt;mso-layout-grid-align:'

delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal margin-top:0in;margin-right:1.5pt;margin-bottom:'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='0in;margin-left:1.5pt;margin-bottom:.0001pt;line-height:12.0pt;mso-layout-grid-align:'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'color:black;','')

delete from tempDumpSEBIData1  where ltrim(rtrim(text1)) is null
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal>'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<p class=MsoNormal>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:City','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:City>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'''>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:date','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:date>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'&quot;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:address','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:address>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:Street','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:Street>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'font-size:','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'.0pt;','')
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='0in;margin-left:1.5pt;margin-bottom:.0001pt;text-align:justify;line-height:'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='12mso-layout-grid-align:none;text-autospace:none'
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-bidi-','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'Arial;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-ansi-language:EN-GB','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<st1:stockticker','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'</st1:stockticker>','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-spacerun:yes','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'',' ')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'mso-ansi-language:DE;','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'lang=DE','')
update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'st="on"','')
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<br mso-special-character:line-break'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal margin-left:8.35pt;text-indent:0in;mso-list:l0 level1 lfo2;'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<![if !supportLineBreakNewLine]><br mso-special-character:line-break'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='tab-stops:list 8.35pt .5in<![if !supportLists]>'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='mso-list:Ignore2.font:7.0pt "Times New Roman"'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='mso-fareast-'update  tempDumpSEBIData1 set text1=replace(ltrim(rtrim(text1)),'<![endif]>','')
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal margin-left:18.65pt;text-indent:-18.65pt;'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='mso-list:l0 level1 lfo2;tab-stops:list 8.35pt .5in<![if !supportLists]>'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='mso-list:Ignore1.'
delete from tempDumpSEBIData1  where ltrim(rtrim(text1))='<p class=MsoNormal margin-bottom:12.0pt'

GO

-- --------------------------------------------------
-- PROCEDURE dbo.UPD_USERLIST_DIET_DTC
-- --------------------------------------------------
/*INTRANET/TESTDB*/
CREATE PROCEDURE UPD_USERLIST_DIET_DTC(@BATCHID AS INT)
AS
SET NOCOUNT ON
BEGIN
    
    SELECT MANAGERIP
        INTO #SERVERLIST
    FROM MIS.DBO.USERLIST_BATCHES_MANAGER_LOG WITH(NOLOCK)
    WHERE BATCHID = @BATCHID AND NOOFRECORDS > 0

    --DELETE FROM DIET_DTC WHERE LOCATION=@VSAT OR ISNULL(LOCATION,'')=''            
    
    EXEC MIS.DBO.UPD_DIET_POSTFIX
    
    SELECT TOP 0 * 
        INTO #DTC_FILE_DATA
    FROM DIET_DTC WITH(NOLOCK)
                        
    ----------- From Diet Dealer Master                        
    --INSERT INTO DIET_DTC
    INSERT INTO #DTC_FILE_DATA
    SELECT DEALERCD=/*LTRIM(RTRIM(TAG))+*/
           REPLACE(MAX(B.POSTFIX), 'NVASHI2', 'VASHI2'),
           A.PCODE,
           A.SERVERMAPPED,
           GETDATE()
    FROM   MIS.DBO.ODINCLIENTINFO A WITH (NOLOCK),
           (SELECT PCODE,
                   SERVERMAPPED,
                   POSTFIX=( DEALERPOSTFIX )
            FROM   MIS.DBO.DIET_POSTFIX A WITH(NOLOCK)
                INNER JOIN #SERVERLIST B WITH(NOLOCK)
                    ON A.SERVERMAPPED = B.MANAGERIP ) B
    WHERE  A.TAG = B.PCODE AND A.SERVERMAPPED = B.SERVERMAPPED
    GROUP  BY A.PCODE,
              A.SERVERMAPPED 
    /*Commented by shweta on 31/03/2008 */                    
    --and a.pcode not in (select party_Code from diet_dtc (nolock))                          
                            
                            
    SELECT SERVERMAPPED,POSTFIX=MAX(DEALERPOSTFIX)
        INTO #FILE                
    FROM MIS.REMISIOR.DBO.EBROK_TERMINAL_MASTER WITH(NOLOCK)
    WHERE TO_DATE > GETDATE() AND PRODUCT='ODINDIET'
    GROUP BY SERVERMAPPED
    
    INSERT INTO #DTC_FILE_DATA
    SELECT DEALERCD=Replace(Ltrim(Rtrim(TAG)) + B.POSTFIX, 'NVASHI2', 'VASHI2'),
           PCODE,
           A.SERVERMAPPED,
           Getdate()
    FROM   MIS.DBO.ODINCLIENTINFO A WITH (NOLOCK) 
            INNER JOIN #FILE B
                ON A.SERVERMAPPED = B.SERVERMAPPED	
            LEFT OUTER JOIN #DTC_FILE_DATA C
                ON A.PCODE = C.PARTY_CODE
                    AND A.SERVERMAPPED = C.LOCATION
    WHERE  C.PARTY_CODE IS NULL
    
    DELETE A
    FROM DIET_DTC A  WITH(NOLOCK)
            INNER JOIN #SERVERLIST B WITH(NOLOCK)
                ON A.LOCATION = B.MANAGERIP
    
    INSERT INTO DIET_DTC
    SELECT * FROM #DTC_FILE_DATA
    
    SELECT DEALER,
           PARTY_CODE,
           LOCATION,
           LAST_UPDATED=Max(LAST_UPDATED)
    INTO   #FILEX
    FROM   DBO.DIET_DTC WITH (NOLOCK)
    GROUP  BY DEALER,
              PARTY_CODE,
              LOCATION 
    
    TRUNCATE TABLE DIET_DTC
    
    INSERT INTO DIET_DTC
    SELECT * FROM #FILEX

END
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Update_CliFundsTrf
-- --------------------------------------------------
    
CREATE procedure [dbo].[Update_CliFundsTrf]                
as                                                                                
set nocount on                                          
set TRANSACTION ISOLATION LEVEL READ UNCOMMITTED                                                                           
    
select Sloginid,Exchseg,S__Amount,R__Response_time,R__Payment_reference_number,R__BAnk_name,S__SubMerchant_id,SFromAccNo,product,LimitUpdationAPIStatus    
into #mtemp1 from vw_tran_pg_combine where R__Response_time>= GETDATE()-7    
/*    
truncate table mtemp2

Declare @Query varchar(MAX)

Set @Query = '
insert into [196.1.115.132].testdb.dbo.mtemp2
select party_Code as Sloginid,Segment as Exchseg,Amount as S__Amount,
LogDate as R__Response_time,      
VerificationReferenceNo as R__Payment_reference_number,        
BankName as R__BAnk_name,      
Vendor as S__SubMerchant_id,      
BankAccountNo as SFromAccNo,      
AppName as product,       
VerificationStatus as LimitUpdationAPIStatus       from (select A.RequestID,A.AppName,A.Party_Code,A.Segment,A.BankName,A.BankAccountNo,A.Amount,A.LogDate,A.Vendor,
A.VendorMerchantID,VerificationReferenceNo=B.TransactionReferenceNo,B.VerificationStatus,B.Requesttime,TrnRank=Row_number() over(partition by A.RequestID order by Requesttime desc) 
from General.dbo.tbl_AngelPGIMBOTransactionLog A with(nolock) inner join General.dbo.tbl_AngelPGIMVerificationProcess B with(nolock) ON (A.RequestID=B.RequestID)
Where LogDate >=''JUN 1 2013'' and Requesttime >=''JAN 1 1900'' and AppName not in (''NBFC'',''SCB-VIRTUAL'',''SCB -VIRTUAL1'',''SCB -VIRTUAL2'',''KYC'')
and LogDate>= GETDATE()-7    
) A
where TrnRank=1 
'

EXEC(@Query) at [196.1.115.207]

select * into #mtemp2  from testdb.dbo.mtemp2
 */   
select Sloginid,Exchseg,S__Amount,R__Response_time,R__Payment_reference_number,R__BAnk_name,S__SubMerchant_id,SFromAccNo,product,LimitUpdationAPIStatus    
into #mtemp2 from Mimansa_PostVeriData where R__Response_time>= GETDATE()-7  
 
    
update #mtemp1 set #mtemp1.LimitUpdationAPIStatus=b.LimitUpdationAPIStatus from #mtemp2 b     
where #mtemp1.R__Payment_reference_number=b.R__Payment_reference_number    
    
insert into #mtemp1     
select a.* from #mtemp2 a left outer join #mtemp1 b on a.R__Payment_reference_number=b.R__Payment_reference_number    
where b.R__Payment_reference_number is null    
                                                                            
select Sloginid,Exchseg,S__Amount,R__Response_time,R__Payment_reference_number,R__BAnk_name,S__SubMerchant_id,SFromAccNo,product,LimitUpdationAPIStatus                
/* into #tempfileBO1 from vw_tran_pg_combine where */    
into #tempfileBO1 from #mtemp1 where     
                 
/* LimitUpdationAPIStatus='Success' */              
LimitUpdationAPIStatus in('Ok','Success')    
          
/*                
select sLoginId,nMarketSegmentId,sUserDefinedExchangeName,nAmount,nServiceCharge,sDateTime,nTxnRefNo,sGroupId,nProcessFlag,sBankId,sAgencyId,sBankRefNo,sFromAccNo,sToAccNo,product                
into #fin1                
from Bank_FundsPayout22 a                                                          
where not exists                   
(SELECT NTXNREFNO+'|'+SBankRefNo                   
FROM temp_mis_file1a b                   
where a.NTXNREFNO+'|'+a.SBankRefNo=b.NTXNREFNO+'|'+b.SBankRefNo collate SQL_Latin1_General_CP1_CI_AS)                                                  
                
              
insert into temp_mis_file1a                                                                             
select sLoginId,nMarketSegmentId,sUserDefinedExchangeName,nAmount,nServiceCharge,sDateTime,nTxnRefNo,sGroupId,nProcessFlag,sBankId,sAgencyId,sBankRefNo,sFromAccNo,sToAccNo,product                
from #fin1                
*/                
          
SELECT ltrim(rtrim(NTXNREFNO))+'|'+ltrim(rtrim(isnull(SBankRefNo,''))) as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                                  
into #temp_mis_filefin FROM temp_mis_file1a  b (nolock)                                                      
                
select top 0 * into #fin2 from temp_mis_file1a                                  
insert into #fin2(sLoginId,sUserDefinedExchangeName,nAmount,sDateTime,nTxnRefNo,sBankId,sAgencyId,sFromAccNo,product)                 
select Sloginid,Exchseg,S__Amount,R__Response_time,R__Payment_reference_number,R__BAnk_name,S__SubMerchant_id,SFromAccNo,product           
from   #tempfileBO1                                   
              
/*                
insert into temp_mis_file1a                                  
select distinct *  from #fin2 a                                                        
where not exists                                                       
(SELECT NTXNREFNO_SBankRefNo                                                      
FROM #temp_mis_filefin  b (nolock) where ltrim(rtrim(a.NTXNREFNO))+'|'+ltrim(rtrim(isnull(a.SBankRefNo,'')))=ltrim(rtrim(NTXNREFNO_SBankRefNo))                
collate SQL_Latin1_General_CP1_CI_AS                                      
)                                        
*/              
              
insert into temp_mis_file1a                                  
select distinct a.*  from #fin2 a left outer join  #temp_mis_filefin b               
on ltrim(rtrim(a.NTXNREFNO))+'|'+ltrim(rtrim(isnull(a.SBankRefNo,'')))=ltrim(rtrim(NTXNREFNO_SBankRefNo)) collate SQL_Latin1_General_CP1_CI_AS                                      
where b.NTXNREFNO_SBankRefNo is null              
              
            
insert into temp_mis_file1a              
select                 
PArty_Code,                
(Case                 
When segment='BSE EQUITIES' then '2'                
When segment='MCX FUTURES' then '5'                
When segment='MCXSX CURRENCY FUTURES' then '9'                
When segment='NCDEX FUTURES' then '6'                
When segment='NSE DERIVATIVES' then '3'                
When segment='NSE EQUITIES' then '1'                
When segment='NSECDS' then '10'  
when segment='MUTUAL FUND' then '1' 
when segment='NBFC' then '1'              
when segment='IPO' then '1' 
              
else '' end) as nMarketSegmentId,            
(Case                 
When segment='BSE EQUITIES' then 'BSECM'                
When segment='MCX FUTURES' then 'MCX'                
When segment='MCXSX CURRENCY FUTURES' then 'MCXSX'                
When segment='NCDEX FUTURES' then 'NCDEX'                
When segment='NSE DERIVATIVES' then 'NSEFO'           
When segment='NSE EQUITIES' then 'NSECM'                
When segment='NSECDS' then 'NSECD' 
when segment='MUTUAL FUND' then 'BSEMFSS' 
when segment='NBFC' then 'NBFC'              
when segment='IPO' then 'IPO' 
else '' end) as segment,Amount,0,Logdate,DDNO,NULL,0,BankName,Vendor,TransactionReferenceNo,BankAccountNo,'',AppName                
from          
(          
select *,           
--DDNO=(case when vendor='PAYNETZ' then ExtraField2 else transactionMerchantID end)   
DDNO=(CASE WHEN vendor='PAYNETZ' THEN ExtraField2 ELSE CASE WHEN TransactionReferenceNo IS NULL THEN NULL ELSE TransactionReferenceNo END END)          
from Accounts.dbo.tbl_AngelPGIMBOTransactionLog  with (nolock) where logdate>=convert(varchar(11),getdate()-2) and verificationRemark='Success'           
and TransactionVerified='Y'          
)           
 a left outer join testdb.dbo.Vw_temp_mis_file1a b with (nolock)             
on a.DDNO =b.nTxnRefno            
where b.nTxnRefno is null            
   
---------------------------------SMS To Clients---                                                  
/*              
insert into #fin2                 
select                 
sLoginId collate SQL_Latin1_General_CP1_CI_AS,                
nMarketSegmentId collate SQL_Latin1_General_CP1_CI_AS ,                
sUserDefinedExchangeName collate SQL_Latin1_General_CP1_CI_AS ,                
nAmount ,nServiceCharge ,sDateTime ,                
nTxnRefNo collate SQL_Latin1_General_CP1_CI_AS ,                
sGroupId collate SQL_Latin1_General_CP1_CI_AS ,                
nProcessFlag ,sBankId collate SQL_Latin1_General_CP1_CI_AS ,sAgencyId collate SQL_Latin1_General_CP1_CI_AS ,sBankRefNo collate SQL_Latin1_General_CP1_CI_AS ,sFromAccNo collate SQL_Latin1_General_CP1_CI_AS ,sToAccNo collate SQL_Latin1_General_CP1_CI_AS,   
  
   
       
        
          
           
product                
from #fin1                
                
select cl_code,mobile_pager into #MobileData from intranet.risk.dbo.client_details where cl_code in                                                 
(                                                
select distinct sLoginId  from #fin2 a                                                                                         
where not exists                                                       
(SELECT NTXNREFNO_SBankRefNo                                                      
FROM #temp_mis_filefin  b (nolock) where ltrim(rtrim(a.NTXNREFNO))+'|'+ltrim(rtrim(isnull(a.SBankRefNo,'')))=NTXNREFNO_SBankRefNo                                       
)                                                        
)                                                 
                
if @@error=0                                          
                                           
begin                          
                
insert into intranet.sms.dbo.sms                                                  
               
select distinct mobile_pager,                               
'Received Online Fund Transfer For Client Code - '+x.sLoginId+' Ref.No. - '+nTxnRefNo+' Segment - '+x.sUserDefinedExchangeName               
collate SQL_Latin1_General_CP1_CI_AS+' Time - '+convert(varchar,sDateTime)+' Amt. - '+convert(varchar,nAmount),                             
convert(varchar(11),getdate(),103),'','P','','Online Fund Transfer'                                 
from                                                  
(                                                  
select distinct *  from #fin1 a                                                        
where not exists                                       
(                
SELECT NTXNREFNO_SBankRefNo FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO  collate SQL_Latin1_General_CP1_CI_AS +'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                                       
)                  
)x                                                   
inner join                               
(select  cl_code,mobile_pager from #MobileData) y on x.sLoginId  collate SQL_Latin1_General_CP1_CI_AS=  y.cl_code                                                        
                
end                       
*/

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Update_CliFundsTrf_01032011
-- --------------------------------------------------
CREATE procedure Update_CliFundsTrf_01032011                                        
as                                              
set nocount on        
set TRANSACTION ISOLATION LEVEL READ UNCOMMITTED                                         
------- FT Old Direct System                                              
/*                                
select * into #tempfile1 from Bank_FundsPayout                                              
                                
select nTxnRefNo into #tempfile2 from temp_mis_file1                                              
--delete from mis.testdb.dbo.temp_mis_file1                                               
insert into temp_mis_file1                                               
select *,product='AngelDiet'  from #tempfile1 where nTxnRefNo not in (select nTxnRefNo from #tempfile2 )                                              
*/                                              
                                            
------- TechProcess : Backoffice                                            
                                          
INSERT INTO temp_mis_file1                                               
SELECT                                             
SLOGINID=substring(s__submerchant_item_code,1,charindex('_',s__submerchant_item_code)-1),                                            
NMARKETSEGMENTID=(cASE WHEN EXCHSEG='BSE' THEN 1                                             
WHEN EXCHSEG='NSE' THEN 2                                            
ELSE 0 END                                             
),                                            
EXCHSEG,                                            
S__AMOUNT,NSERVICECHARGE=0,R__RESPONSE_TIME,R__PAYMENT_REFERENCE_NUMBER,SGROUPID=SPACE(10),                                            
NPROCESSFLAG=0,                                          
R__BANK_NAME=replace(r__bank_name,'ANGLE ',''),S__SUBMERCHANT_ID,R__SUBMERCHANT_TRANSACTION_ID,                                            
SFROMACCNO=' ',STOACCNO=' ',product='BackOffice'                                             
from middleware.mimansa.dbo.tbl_tran_pg                                             
WHERE R__PAID='Y' AND R__PAYMENT_REFERENCE_NUMBER NOT IN (SELECT NTXNREFNO FROM temp_mis_file1 )                                                
                                            
------- TechProcess : FT   (AngelDiet)                              
                                            
                                    
                      
select * into #tempfile16 from Bank_FundsPayout16                                              
                        
/*insert into temp_mis_file1                                               
select *  from #tempfile16 a                        
--where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                              
where not exists (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 b where a.NTXNREFNO+'|'+a.SBankRefNo=b.NTXNREFNO+'|'+b.SBankRefNo )                                                              
*/                    
                    
SELECT NTXNREFNO+'|'+SBankRefNo as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                     
into #temp_mis_file11 FROM temp_mis_file1  b (nolock)                    
                    
insert into temp_mis_file1                                               
select *  from #tempfile16 a                        
--where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                              
where not exists (SELECT NTXNREFNO_SBankRefNo                     
FROM #temp_mis_file11 b where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo )                                                              
                                            
------- TechProcess : Mangesh                                            
--select * into #tempfile7 from Bank_FundsPayout7    /* as suggested by George on 26/06/2009*/                      
select * into #tempfile7 from Bank_FundsPayout22                      
                              
/*insert into temp_mis_file1                                           
select *  from #tempfile7 a                        
--where nTxnRefNo not in (SELECT NTXNREFNO FROM temp_mis_file1 )                                                              
--where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                              
where not exists (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 b where a.NTXNREFNO+'|'+a.SBankRefNo=b.NTXNREFNO+'|'+b.SBankRefNo )                
*/                    
SELECT NTXNREFNO+'|'+SBankRefNo as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                     
into #temp_mis_file12 FROM temp_mis_file1  b (nolock)                    
                    
insert into temp_mis_file1                                               
select *  from #tempfile7 a                      
--where nTxnRefNo not in (SELECT NTXNREFNO FROM temp_mis_file1 )                                                              
--where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                              
where not exists                     
(SELECT NTXNREFNO_SBankRefNo                    
FROM #temp_mis_file12  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo     
collate SQL_Latin1_General_CP1_CI_AS    
)                
                
                
                
                
---------------------------------SMS To Clients---                
              
select * into #MobileData from intranet.risk.dbo.client_details where cl_code in               
(              
select sLoginId collate Latin1_General_BIN from #tempfile7 a                                                           
where not exists                     
(SELECT NTXNREFNO_SBankRefNo                    
FROM #temp_mis_file12  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo     
collate SQL_Latin1_General_CP1_CI_AS    
)                      
)               
      
 if @@error=0        
         
  begin        
             
 insert into intranet.sms.dbo.sms                
 select distinct mobile_pager,                
 'Received Online Fund Transfer For Client Code - '+x.sLoginId+' Ref.No. - '+nTxnRefNo+' Segment - '+x.sUserDefinedExchangeName collate SQL_Latin1_General_CP1_CI_AS+' Time - '+convert(varchar,sDateTime)+' Amt. - '+convert(varchar,nAmount),                
 
 convert(varchar(11),getdate(),103),'','P','','Online Fund Transfer'                
 from                
 (                
 select *  from #tempfile7 a                                                           
 where not exists                     
 (SELECT NTXNREFNO_SBankRefNo                    
 FROM #temp_mis_file12  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo collate SQL_Latin1_General_CP1_CI_AS )                      
 )x                 
 inner join                
 (select  cl_code,mobile_pager from #MobileData) y on x.sLoginId collate Latin1_General_BIN=  y.cl_code                      
      
      
  end               
                      
              
              
                   
                          
/*                            
INSERT INTO temp_mis_file1                                             
select fld_clientcode,0,                                            
segment=(                                            
Case                                             
when fld_merchantCode='ANGEL CASH' then 'NSE CASH'                                            
when fld_merchantCode='ANGEL COMM' then 'MCX'                                            
when fld_merchantCode='ANGEL FUND' then 'NSE FO'                                            
when fld_merchantCode='ANGEL NCDEX' then 'NCDEX'                                            
when fld_merchantCode='ANGEL TRADE' then 'BSE CASH'                                            
else ' ' end),                                            
fld_TxnAmount,Fld_TxnScAmount,             
Fld_date=convert(datetime,CONVERT(VARCHAR(11),FLD_SYS_DATE)+' '+SUBSTRING(CONVERT(VARCHAR(25),FLD_SYS_DATE),13,10)),                                             
fld_bankRefNo,' ',' ','HDFC BANK',Fld_MerchantRefNo,fld_bankRefNo,'','','HDFCBANK'                                            
--select distinct fld_merchantCode                                             
FROM [10.30.30.7].Angel_TP.dbo.tbl_AuditBankResponse_HDFC                                
where fld_bankRefNo <> 0 and fld_bankRefNo not in                                             
(SELECT NTXNREFNO FROM temp_mis_file1)                                              
*/                              
------- TechProcess : Asiancerc                                            
            
            
----As per discussion with george sir this process has been stopped            
----product has been closed.            
            
/*INSERT INTO temp_mis_file1                                             
select *,product='AngelAnyWhere'  from Angel_GetPayDetails where PaymentReferenceNumber                                             
NOT IN (SELECT NTXNREFNO FROM temp_mis_file1 ) */

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Update_CliFundsTrf_a
-- --------------------------------------------------
CREATE procedure Update_CliFundsTrf_a                                                          
as                                                                
set nocount on                          
set TRANSACTION ISOLATION LEVEL READ UNCOMMITTED                                                           
                                                            
select Sloginid,Exchseg,S__Amount,R__Response_time,R__Payment_reference_number,R__BAnk_name,S__SubMerchant_id,SFromAccNo,product,LimitUpdationAPIStatus
into #tempfileBO1 from vw_tran_pg_combine where LimitUpdationAPIStatus='Success'
   

insert into temp_mis_file1a                                                             
select *  from Bank_FundsPayout22 a                                          
where not exists   
(SELECT NTXNREFNO+'|'+SBankRefNo   
FROM temp_mis_file1a b   
where a.NTXNREFNO+'|'+a.SBankRefNo=b.NTXNREFNO+'|'+b.SBankRefNo collate SQL_Latin1_General_CP1_CI_AS)                                  
                    

SELECT NTXNREFNO+'|'+SBankRefNo as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                  
into #temp_mis_filefin FROM temp_mis_file1a  b (nolock)                                      

select top 0 * into #fin1 from temp_mis_file1a                  
insert into #fin1(sLoginId,sUserDefinedExchangeName,nAmount,sDateTime,nTxnRefNo,sBankId,sAgencyId,sFromAccNo,product) 
select Sloginid,Exchseg,S__Amount,R__Response_time,R__Payment_reference_number,R__BAnk_name,S__SubMerchant_id,SFromAccNo,product from   #tempfileBO1                   
  
insert into #fin1 select *  from   Bank_FundsPayout22                    

insert into temp_mis_file1a                  
select distinct *  from #fin1 a                                        
where not exists                                       
(SELECT NTXNREFNO_SBankRefNo                                      
FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                       
collate SQL_Latin1_General_CP1_CI_AS                      
)                        

select * from temp_mis_file1a                                      
---------------------------------SMS To Clients---                                  
                                
select cl_code,mobile_pager into #MobileData from intranet.risk.dbo.client_details where cl_code in                                 
(                                
select distinct sLoginId  from #fin1 a                                                                         
where not exists                                       
(SELECT NTXNREFNO_SBankRefNo                                      
FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                       
)                                        
)                                 
                        
if @@error=0                          
                           
begin                          
	insert into intranet.sms.dbo.sms                                  
	select distinct mobile_pager,                                  
	'Received Online Fund Transfer For Client Code - '+x.sLoginId+' Ref.No. - '+nTxnRefNo+' Segment - '+x.sUserDefinedExchangeName collate SQL_Latin1_General_CP1_CI_AS+' Time - '+convert(varchar,sDateTime)+' Amt. - '+convert(varchar,nAmount),              	convert(varchar(11),getdate(),103),'','P','','Online Fund Transfer'                                  
	from                                  
	(                                  
	select distinct *  from #fin1 a                                        
	where not exists                       
	(SELECT NTXNREFNO_SBankRefNo                                      
	FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                       
	)                                            
	)x                                   
	inner join                                  
	(select  cl_code,mobile_pager from #MobileData) y on x.sLoginId=  y.cl_code                                        
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Update_CliFundsTrf_old
-- --------------------------------------------------

CREATE procedure Update_CliFundsTrf_old                                                          
as                                                                
set nocount on                          
set TRANSACTION ISOLATION LEVEL READ UNCOMMITTED                                                           
------- FT Old Direct System                                                                
/*                                                  
select * into #tempfile1 from Bank_FundsPayout                                                                
                                                  
select nTxnRefNo into #tempfile2 from temp_mis_file1                                                                
--delete from mis.testdb.dbo.temp_mis_file1                                                                 
insert into temp_mis_file1                                                                 
select *,product='AngelDiet'  from #tempfile1 where nTxnRefNo not in (select nTxnRefNo from #tempfile2 )                                                                
*/                                                                
                                                              
------- TechProcess : Backoffice                                                              
                                                            
--INSERT INTO temp_mis_file1                                                                 
SELECT                                                               
SLOGINID=substring(s__submerchant_item_code,1,charindex('_',s__submerchant_item_code)-1),                                                              
NMARKETSEGMENTID=(cASE WHEN EXCHSEG='BSE' THEN 1                                                               
WHEN EXCHSEG='NSE' THEN 2                                                              
ELSE 0 END                                                               
),                                                              
EXCHSEG,                                                              
S__AMOUNT,NSERVICECHARGE=0,R__RESPONSE_TIME,R__PAYMENT_REFERENCE_NUMBER,SGROUPID=SPACE(10),                                                              
NPROCESSFLAG=0,                                                            
R__BANK_NAME=replace(r__bank_name,'ANGLE ',''),S__SUBMERCHANT_ID,R__SUBMERCHANT_TRANSACTION_ID,                                                              
SFROMACCNO=space(40),STOACCNO=' ',product='BackOffice'                                        
into #tempfileBO                                         
/* from middleware.mimansa.dbo.tbl_tran_pg  with (nolock) */          
from middleware.mimansa.dbo.tbl_tran_pg_new with (nolock)           
WHERE R__PAID='Y' AND R__PAYMENT_REFERENCE_NUMBER NOT IN (SELECT NTXNREFNO FROM temp_mis_file1 nolock          
 where product='BackOffice'          
)                                                                  
          
          
          
/* PAYNETZ */               
insert into #tempfileBO            
          
SELECT                                                               
SLOGINID=s__PartyCode,          
NMARKETSEGMENTID=(cASE WHEN s__submerchant_productcode='BSE' THEN 1                                                               
WHEN s__submerchant_productcode='NSE' THEN 2                                                              
ELSE 0 END                                                               
),                                                              
s__submerchant_productcode as EXCHSEG,                                                              
S__AMOUNT,NSERVICECHARGE=0,          
(case when ltrim(rtrim(len(R__RESPONSE_TIME))) > 20 then           
convert(datetime,substring(R__RESPONSE_TIME,5,6)+          
substring(R__RESPONSE_TIME,24,5)+' '+          
substring(R__RESPONSE_TIME,11,9))          
else          
convert(Datetime,R__RESPONSE_TIME) end )          
as R__RESPONSE_TIME,          
R__PAYMENT_bank_transactionID as R__PAYMENT_REFERENCE_NUMBER,SGROUPID=SPACE(10),                                               
NPROCESSFLAG=0,R__BANK_NAME=replace(r__bank_name,'ANGLE ',''),          
S__SUBMERCHANT_ID,R__SUBMERCHANT_TRANSACTION_ID,          
s__Account_no as SFROMACCNO,STOACCNO=' ',product='BO-Paynetz'                                
from middleware.mimansa.dbo.tbl_tran_pg_paynetz with (nolock)           
WHERE r__f_Code='OK' /*AND r__submerchant_prodid <> ''*/ AND R__PAYMENT_bank_transactionID NOT IN           
(SELECT NTXNREFNO FROM temp_mis_file1 nolock where product='BO-Paynetz')                                                                  
          
------- TechProcess : FT   (AngelDiet)                                                
                                        
/* == Disabled on Apr 04 2011 , from Mail of vikram gosar              
              
select * into #tempfile16 from Bank_FundsPayout16                                                                
              
*/              
                                          
/*insert into temp_mis_file1                                                                 
select *  from #tempfile16 a                                          
--where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                                                
where not exists (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 b where a.NTXNREFNO+'|'+a.SBankRefNo=b.NTXNREFNO+'|'+b.SBankRefNo )                                                                                
*/                                      
                                      
/*                  
 SELECT NTXNREFNO+'|'+SBankRefNo as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                                       
 into #temp_mis_file11 FROM temp_mis_file1  b (nolock)                                      
                                       
 --insert into temp_mis_file1                                                                 
 select *  into #finfile16 from #tempfile16 a                                  
 --where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                                        
 where not exists (SELECT NTXNREFNO_SBankRefNo                                       
 FROM #temp_mis_file11 b where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo )                    
*/                                                              
------- TechProcess : Mangesh                                                              
--select * into #tempfile7 from Bank_FundsPayout7    /* as suggested by George on 26/06/2009*/     
    
    
    
/*Commented as there was no response from server-- now opened on Mar 22 2012*/                                       
   
select * into #tempfile7 from Bank_FundsPayout22   with (nolock)                                     
   
                                                
insert into temp_mis_file1                                                             
select *  from #tempfile7 a                                          
--where nTxnRefNo not in (SELECT NTXNREFNO FROM temp_mis_file1 )                                                                                
--where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )                                                                                
where not exists   
(SELECT NTXNREFNO+'|'+SBankRefNo   
FROM temp_mis_file1 b   
where a.NTXNREFNO+'|'+a.SBankRefNo=b.NTXNREFNO+'|'+b.SBankRefNo collate SQL_Latin1_General_CP1_CI_AS)                                  
                    
/*         
 SELECT NTXNREFNO+'|'+SBankRefNo as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                                       
 into #temp_mis_file12 FROM temp_mis_file1  b (nolock)               
                                       
 --insert into temp_mis_file1                                                                 
 select * into #finfile7 from #tempfile7 a                                        
 --where nTxnRefNo not in (SELECT NTXNREFNO FROM temp_mis_file1 )                                                                                
 --where NTXNREFNO+'|'+SBankRefNo not in  (SELECT NTXNREFNO+'|'+SBankRefNo FROM temp_mis_file1 )        
 where not exists                                       
 (SELECT NTXNREFNO_SBankRefNo                                      
 FROM #temp_mis_file12  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                    
 collate SQL_Latin1_General_CP1_CI_AS                      
 )                                  
*/                  
                      
    SELECT NTXNREFNO+'|'+SBankRefNo as NTXNREFNO_SBankRefNo ,SBankRefNo ,NTXNREFNO                  
    into #temp_mis_filefin FROM temp_mis_file1  b (nolock)                                      
                      
    select top 0 * into #fin1 from temp_mis_file1                  
    insert into #fin1                  
    select *  from   #tempfileBO                   
  
    insert into #fin1                      
    select *  from   #tempfile7                    
  
 /*              
 insert into #fin1                  
 select * from   #tempfile16                        
 */              
                   
 insert into temp_mis_file1                  
 select distinct *  from #fin1 a                                        
 where not exists                                       
 (SELECT NTXNREFNO_SBankRefNo                                      
 FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                       
 collate SQL_Latin1_General_CP1_CI_AS                      
 )                        
                    
---------------------------------SMS To Clients---                                  
                                
select cl_code,mobile_pager into #MobileData from intranet.risk.dbo.client_details where cl_code in                                 
(                                
select distinct sLoginId  from #fin1 a                                                                         
where not exists                                       
 (SELECT NTXNREFNO_SBankRefNo                                      
 FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                       
                        
 )                                        
)                                 
                        
 if @@error=0                          
                           
  begin                          
                               
  insert into intranet.sms.dbo.sms                                  
  select distinct mobile_pager,                                  
  'Received Online Fund Transfer For Client Code - '+x.sLoginId+' Ref.No. - '+nTxnRefNo+' Segment - '+x.sUserDefinedExchangeName collate SQL_Latin1_General_CP1_CI_AS+' Time - '+convert(varchar,sDateTime)+' Amt. - '+convert(varchar,nAmount),              



  
    
      
        
          
            
               
               
                    
                    
  convert(varchar(11),getdate(),103),'','P','','Online Fund Transfer'                                  
  from                                  
  (                                  
  select distinct *  from #fin1 a                                        
  where not exists                       
  (SELECT NTXNREFNO_SBankRefNo                                      
  FROM #temp_mis_filefin  b (nolock) where a.NTXNREFNO+'|'+a.SBankRefNo=NTXNREFNO_SBankRefNo                       
                 
  )                                            
  )x                                   
  inner join                                  
  (select  cl_code,mobile_pager from #MobileData) y on x.sLoginId=  y.cl_code                                        
                         
                         
  end                                 
                                        
                           
                                
                                     
                                            
/*                                              
INSERT INTO temp_mis_file1                                                              
select fld_clientcode,0,                                                              
segment=(                                                              
Case                                                               
when fld_merchantCode='ANGEL CASH' then 'NSE CASH'                
when fld_merchantCode='ANGEL COMM' then 'MCX'                                                              
when fld_merchantCode='ANGEL FUND' then 'NSE FO'                                                              
when fld_merchantCode='ANGEL NCDEX' then 'NCDEX'                                                              
when fld_merchantCode='ANGEL TRADE' then 'BSE CASH'                                                              
else ' ' end),                                                              
fld_TxnAmount,Fld_TxnScAmount,                               
Fld_date=convert(datetime,CONVERT(VARCHAR(11),FLD_SYS_DATE)+' '+SUBSTRING(CONVERT(VARCHAR(25),FLD_SYS_DATE),13,10)),                                                               
fld_bankRefNo,' ',' ','HDFC BANK',Fld_MerchantRefNo,fld_bankRefNo,'','','HDFCBANK'                                                              
--select distinct fld_merchantCode                                                               
FROM [10.30.30.7].Angel_TP.dbo.tbl_AuditBankResponse_HDFC                                                  
where fld_bankRefNo <> 0 and fld_bankRefNo not in                                                               
(SELECT NTXNREFNO FROM temp_mis_file1)                                                                
*/                                                
------- TechProcess : Asiancerc                                                              
                              
                              
----As per discussion with george sir this process has been stopped                              
----product has been closed.                              
                              
/*INSERT INTO temp_mis_file1                                                               
select *,product='AngelAnyWhere'  from Angel_GetPayDetails where PaymentReferenceNumber                                                               
NOT IN (SELECT NTXNREFNO FROM temp_mis_file1 ) */

GO

-- --------------------------------------------------
-- PROCEDURE dbo.upld_ctcl_userinfo
-- --------------------------------------------------
CREATE procedure upld_ctcl_userinfo(@fname as varchar(50))      
as      
set nocount off      
      
delete from ctcl_findata where fname=replace(upper(@fname),'.CSV','')      
    
declare @gdate as datetime    
set @gdate = getdate()    
--print @gdate    
      
insert into odin_det_all  
select fname=replace(upper(@fname),'.CSV',''),*,updt_date=getdate() from odin_det   


---------------

select top 0 * into #odin_dealer_mumbai from odin_dealer_mumbai

insert into #odin_dealer_mumbai (location,user_id,group_id,name,category,status,markets_allowed)
select fname,userid,groupid,name,survOnOff,SurvAutoManual,Status from odin_det_all

update #odin_dealer_mumbai set bse='Y' where markets_allowed like '%BSE EQ%'
update #odin_dealer_mumbai set nse='Y' where markets_allowed like '%NSE EQ%'
update #odin_dealer_mumbai set nsefo='Y' where markets_allowed like '%NSE FO%'
update #odin_dealer_mumbai set mcx='Y' where markets_allowed like '%MCX%'
update #odin_dealer_mumbai set ncdex='Y' where markets_allowed like '%NDX%'

update #odin_dealer_mumbai set bse='' where bse is null
update #odin_dealer_mumbai set nse='' where nse is null
update #odin_dealer_mumbai set nsefo='' where nsefo is null
update #odin_dealer_mumbai set mcx='' where mcx is null
update #odin_dealer_mumbai set ncdex='' where ncdex is null

truncate table odin_dealer_mumbai
insert into odin_dealer_mumbai select * from #odin_dealer_mumbai

      
set nocount on

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_AutoMail_SebiBanned
-- --------------------------------------------------
CREATE Proc Usp_AutoMail_SebiBanned(@Name varchar(100),@Address varchar(100),@PanNo varchar(15),@SebiOrd varchar(11)
,@OrdNo Varchar(50),@Brief Varchar(500),@Startdate varchar(11),@EndDate varchar(11))
As

Insert into sebi_banned values ('',@Name,@Address,@PanNo,@SebiOrd,@OrdNo,@Brief,@Startdate,@EndDate)

Exec Mis.Upload.dbo.Usp_Sebi_Mail @Panno

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_dashboard
-- --------------------------------------------------

-- =============================================
-- Author:		Suraj PAtil
-- Create date: 10-06-2016
-- Description:	Dashboard data
-- =============================================
CREATE PROCEDURE [dbo].[USP_B2B_dashboard]
	@userid as varchar(50)
AS
BEGIN
select * from tbl_B2B_MTD
select * from tbl_B2B_YTD


select a.*,isnull(b.SBCAT,'') as 'SBCAT' from( select * from  tbl_B2BMapping where BID = @userid) a 
left join (select SBCAT,sbtag from VW_B2B_BROKER ) b
on a.SBCode=b.sbtag
--SELECT [Id],[BID],[SBCode],[IsDelete] FROM [testdb].[dbo].[tbl_B2BMapping] where 
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_ESCALATIONMAIL
-- --------------------------------------------------




CREATE PROC [dbo].[USP_B2B_ESCALATIONMAIL]

 @MAINID as int=0,
 @ESCID as int=0

AS BEGIN

 SET NOCOUNT ON
DECLARE @BMUSERID  VARCHAR(50)=''
DECLARE @COMPLIANCE  BIT=0
DECLARE @MEETINGSTATUS  BIT=0
DECLARE @SBTAG  VARCHAR(20)=''
DECLARE @VISITDATE  VARCHAR(50)=''
DECLARE @REMARK  VARCHAR(500)=''
DECLARE @LASTMEETING  VARCHAR(50)=''
DECLARE @SESSIONID  VARCHAR(100)=''
DECLARE @ID  INT =0 
DECLARE @ISMAIL  INT =0 

 DECLARE TRANTACTION  CURSOR
STATIC FOR 
SELECT ID,BMUSERID,COMPLIANCE,MEETINGSTATUS,SBTAG,VISITDATE,REMARK,LASTMEETING,SESSIONID,ISMAIL  FROM TBL_B2BMAINTRANSACTION WHERE  ISARCHIVE=0 and ID= @MAINID
OPEN TRANTACTION
IF @@CURSOR_ROWS > 0
 BEGIN 
 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 WHILE @@FETCH_STATUS = 0
 BEGIN


			------------------------------

			DECLARE @MEETINGID AS INT=0
			DECLARE @PURPOSE AS VARCHAR(20)=''
			DECLARE @REQUIREMENT AS VARCHAR(20)=''
			DECLARE @BMACTION AS VARCHAR(20)=''
			DECLARE @EXPECTEDOUTCOME AS VARCHAR(50)=''
			DECLARE @PARAMETER AS VARCHAR(500)=''
			DECLARE @TARGETDATE AS VARCHAR(50)=''
			DECLARE @BMSTATUS AS INT =0
			DECLARE @ID1 AS INT =0 

			DECLARE TRANTACTION_PURPOSE  CURSOR
			STATIC FOR 
			SELECT ID,MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE  FROM TBL_B2BPURPOSETRANSACTION WHERE MEETINGID=@ID and Id=@ESCID
			OPEN TRANTACTION_PURPOSE
			IF @@CURSOR_ROWS > 0
			BEGIN 
			FETCH NEXT FROM TRANTACTION_PURPOSE INTO @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			WHILE @@FETCH_STATUS = 0
			BEGIN

			DECLARE @EVENT AS INT=0
			DECLARE @HIRING AS INT =0
			DECLARE @COLLATE AS INT =0
			DECLARE @VCARD AS INT=0
			DECLARE @MICROSITE AS INT=0
			DECLARE @LEAFLET AS INT=0
			DECLARE @FLAG AS INT=0
			DECLARE @MAILBODY AS VARCHAR(MAX)


			SELECT @EVENT=COUNT(1) FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID=@ID1

			IF(@EVENT>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'EVENT')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @HIRING=COUNT(1) FROM [DBO].[TBL_B2BHIRING] WHERE PURPOSEID=@ID1

			IF(@HIRING>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'HIRING')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @COLLATE=COUNT(1) FROM [DBO].[TBL_B2BMKTCOLLATERAL] WHERE PURPOSEID=@ID1

			IF(@COLLATE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'COLLATE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @VCARD=COUNT(1) FROM [DBO].[TBL_B2BVCARD] WHERE PURPOSEID=@ID1

			IF(@VCARD>0)
			BEGIN
			---SEND MAIL
				SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'VCARD')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @LEAFLET=COUNT(1) FROM TBL_LEAFLET WHERE PURPOSEID=@ID1

			IF(@LEAFLET>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'LEAFLET')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @MICROSITE=COUNT(1) FROM [DBO].[TBL_B2BMICROSITE] WHERE PURPOSEID=@ID1

			IF(@MICROSITE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'MICROSITE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END
            
			IF( @FLAG=0)
			BEGIN
			----SEND MAIL WITHOUT BODY TABLE
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'NONE')
			exec USP_B2BSendmail @id ,@MAILBODY
			END



			FETCH NEXT FROM TRANTACTION_PURPOSE INTO  @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			END
			END
			CLOSE TRANTACTION_PURPOSE
			DEALLOCATE TRANTACTION_PURPOSE


			-----------------------------




 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 END
END
CLOSE TRANTACTION
DEALLOCATE TRANTACTION
SET NOCOUNT OFF 




END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_ESCALATIONMAIL1
-- --------------------------------------------------




create  PROC [dbo].[USP_B2B_ESCALATIONMAIL1]

 @MAINID as int=0,
 @ESCID as int=0

AS BEGIN

 SET NOCOUNT ON
DECLARE @BMUSERID  VARCHAR(50)=''
DECLARE @COMPLIANCE  BIT=0
DECLARE @MEETINGSTATUS  BIT=0
DECLARE @SBTAG  VARCHAR(20)=''
DECLARE @VISITDATE  VARCHAR(50)=''
DECLARE @REMARK  VARCHAR(500)=''
DECLARE @LASTMEETING  VARCHAR(50)=''
DECLARE @SESSIONID  VARCHAR(100)=''
DECLARE @ID  INT =0 
DECLARE @ISMAIL  INT =0


DECLARE @MEETINGID AS INT=0
DECLARE @PURPOSE AS VARCHAR(20)=''
DECLARE @REQUIREMENT AS VARCHAR(20)=''
DECLARE @BMACTION AS VARCHAR(20)=''
DECLARE @EXPECTEDOUTCOME AS VARCHAR(50)=''
DECLARE @PARAMETER AS VARCHAR(500)=''
DECLARE @TARGETDATE AS VARCHAR(50)=''
DECLARE @BMSTATUS AS INT =0
DECLARE @ID1 AS INT =0  


SELECT @BMUSERID=BMUSERID,@COMPLIANCE=COMPLIANCE,@MEETINGSTATUS=MEETINGSTATUS,@SBTAG=SBTAG,@VISITDATE=VISITDATE,@REMARK=REMARK,@LASTMEETING=LASTMEETING,@SESSIONID=SESSIONID,@ISMAIL=ISMAIL  FROM TBL_B2BMAINTRANSACTION WHERE  ISARCHIVE=0 and ID= @MAINID
 
SELECT @ID1=ID,@MEETINGID=MEETINGID,@PURPOSE=PURPOSE,@REQUIREMENT=REQUIREMENT,@BMACTION=BMACTION,@EXPECTEDOUTCOME=EXPECTEDOUTCOME,@PARAMETER=PARAMETER,@TARGETDATE=TARGETDATE  FROM TBL_B2BPURPOSETRANSACTION WHERE MEETINGID=@MAINID and Id=@ESCID
			

			DECLARE @EVENT AS INT=0
			DECLARE @HIRING AS INT =0
			DECLARE @COLLATE AS INT =0
			DECLARE @VCARD AS INT=0
			DECLARE @MICROSITE AS INT=0
			DECLARE @LEAFLET AS INT=0
			DECLARE @FLAG AS INT=0
			DECLARE @MAILBODY AS VARCHAR(MAX)


			SELECT @EVENT=COUNT(1) FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID=@ESCID

			IF(@EVENT>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'EVENT')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @HIRING=COUNT(1) FROM [DBO].[TBL_B2BHIRING] WHERE PURPOSEID=@ESCID

			IF(@HIRING>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'HIRING')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @COLLATE=COUNT(1) FROM [DBO].[TBL_B2BMKTCOLLATERAL] WHERE PURPOSEID=@ESCID

			IF(@COLLATE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'COLLATE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @VCARD=COUNT(1) FROM [DBO].[TBL_B2BVCARD] WHERE PURPOSEID=@ESCID

			IF(@VCARD>0)
			BEGIN
			---SEND MAIL
				SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'VCARD')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @LEAFLET=COUNT(1) FROM TBL_LEAFLET WHERE PURPOSEID=@ESCID

			IF(@LEAFLET>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'LEAFLET')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @MICROSITE=COUNT(1) FROM [DBO].[TBL_B2BMICROSITE] WHERE PURPOSEID=@ESCID

			IF(@MICROSITE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'MICROSITE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END
            
			IF( @FLAG=0)
			BEGIN
			----SEND MAIL WITHOUT BODY TABLE
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MAINID,@ESCID,'NONE')
			exec USP_B2BSendmail @id ,@MAILBODY
			END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_LOGIN
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_B2B_LOGIN]
	@userid as varchar(50),
	@deviceId as varchar(100)
AS
BEGIN

--Get Dash Borad details 
        select Category ,Target , ISNULL( p.COUNTS,0) as Achieved,(case when ((Target- ISNULL( p.COUNTS,0))<0) then 0 else Target-ISNULL( p.COUNTS,0) end) as 'Pending' 
        from tbl_B2B_MTD  m left join
        (select SUM( COUNTS) as COUNTS ,UPPER ( SBCAT) as 'SBCAT'  from (select COUNT(1) as COUNTS,SBTAG  from TBL_B2BMAINTRANSACTION   where BMUSERID =@userid 
        and MONTH ( CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105))=MONTH ( CAST( CAST(getdate() as varchar(50)) as date ))
        group by SBTAG) a
        left join  (select isnull (SBCAT ,'NEW') as SBCAT ,sbtag from VW_B2B_BROKER) b
        on a.SBTAG =b.SBTAG 
        group by SBCAT ) p
        on p.sbcat =m.Category 


        select Category ,Target , ISNULL( p.COUNTS,0) as Achieved,(case when ((Target- ISNULL( p.COUNTS,0))<0) then 0 else Target-ISNULL( p.COUNTS,0) end) as 'Pending' 
        from tbl_B2B_YTD  m left join
        (select SUM( COUNTS) as COUNTS ,UPPER ( SBCAT) as 'SBCAT'  from (select COUNT(1) as COUNTS,SBTAG  from TBL_B2BMAINTRANSACTION   where BMUSERID =@userid  
        and year ( CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105))=year ( CAST( CAST(getdate() as varchar(50)) as date ))
        group by SBTAG) a
        left join  (select isnull (SBCAT ,'NEW') as SBCAT ,sbtag from VW_B2B_BROKER) b
        on a.SBTAG =b.SBTAG 
        group by SBCAT ) p
        on p.sbcat =m.Category 


        --select a.*,isnull(b.SBCAT,'') as 'SBCAT' from( select * from  tbl_B2BMapping where BID = @userid) a 
        --left join (select SBCAT,sbtag from VW_B2B_BROKER ) b
        --on a.SBCode=b.sbtag

		select m.BID ,m.SBCode ,m.Region,upper(isnull(n.SBCAT,'New')) as 'SBCAT',m.LastVisit from (select BID ,SBCode ,Region,LastVisit from (select BID ,SBCode ,Region  from  tbl_B2BMapping where BID = @userid and IsDelete =0) a
		left join
	    (select SBTAG,max(CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105)) as LastVisit 
		from TBL_B2BMAINTRANSACTION where  CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105) <=CAST( CAST(getdate() as varchar(50)) as date ) 
		group by SBTAG )b
		on a.SBCode =b.SBTAG )m
		left join
		(select SBCAT,sbtag from VW_B2B_BROKER )n
		on m.SBCode =n.SBTAG

        --SELECT [Id],[BID],[SBCode],[IsDelete] FROM [testdb].[dbo].[tbl_B2BMapping] where 
        
  --      select SBTAG ,c.BMAction,VISITDATE,TARGETDATE as 'TARGET DATE', b.Status,a.id as ID  from
  --      (select ID , SBTAG ,VISITDATE,'Process' status  from TBL_B2BMAINTRANSACTION where BMUSERID =@userid)a
  --      join (select BMACTION ,MEETINGID,TARGETDATE, case when ( BMSTATUS=0 )then 'InProcess' else 
		--case when ( BMSTATUS=1 ) then 'Done' else
		--case when ( BMSTATUS=2 ) then 'Delay' else
		--case when ( BMSTATUS=3 ) then 'Rejected' 
		--end end end end as Status,id  from TBL_B2BPURPOSETRANSACTION  )b
  --      on b.MEETINGID =a.ID 
  --      join (select BID ,BMAction  from tbl_B2BMActionMaster)c
  --      on c.BID =b.BMACTION
        
        select '1.0' as 'version','downloadPath' as 'downloadPath'
        
        insert into tbl_B2BLoginDetails(UserId,LastLogin,Location)
        values(@userid,GETDATE(),@deviceId)
        	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_LOGIN18062016
-- --------------------------------------------------

CREATE PROCEDURE [dbo].[USP_B2B_LOGIN18062016]
	@userid as varchar(50),
	@deviceId as varchar(100)
AS
BEGIN

--Get Dash Borad details 
        select Category ,Target , ISNULL( p.COUNTS,0) as Achieved,(case when ((Target- ISNULL( p.COUNTS,0))<0) then 0 else Target-ISNULL( p.COUNTS,0) end) as 'Pending' 
        from tbl_B2B_MTD  m left join
        (select SUM( COUNTS) as COUNTS ,UPPER ( SBCAT) as 'SBCAT'  from (select COUNT(1) as COUNTS,SBTAG  from TBL_B2BMAINTRANSACTION   where BMUSERID =@userid 
        and MONTH ( CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105))=MONTH ( CAST( CAST(getdate() as varchar(50)) as date ))
        group by SBTAG) a
        left join  (select SBCAT,sbtag from VW_B2B_BROKER) b
        on a.SBTAG =b.SBTAG 
        group by SBCAT ) p
        on p.sbcat =m.Category 


        select Category ,Target , ISNULL( p.COUNTS,0) as Achieved,(case when ((Target- ISNULL( p.COUNTS,0))<0) then 0 else Target-ISNULL( p.COUNTS,0) end) as 'Pending' 
        from tbl_B2B_YTD  m left join
        (select SUM( COUNTS) as COUNTS ,UPPER ( SBCAT) as 'SBCAT'  from (select COUNT(1) as COUNTS,SBTAG  from TBL_B2BMAINTRANSACTION   where BMUSERID =@userid  
        and year ( CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105))=year ( CAST( CAST(getdate() as varchar(50)) as date ))
        group by SBTAG) a
        left join  (select SBCAT,sbtag from VW_B2B_BROKER) b
        on a.SBTAG =b.SBTAG 
        group by SBCAT ) p
        on p.sbcat =m.Category 


        --select a.*,isnull(b.SBCAT,'') as 'SBCAT' from( select * from  tbl_B2BMapping where BID = @userid) a 
        --left join (select SBCAT,sbtag from VW_B2B_BROKER ) b
        --on a.SBCode=b.sbtag

		select BID ,SBCode ,Region,LastVisit from (select BID ,SBCode ,Region  from  tbl_B2BMapping where BID = @userid and IsDelete =0) a
		left join
	    (select SBTAG,max(CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105)) as LastVisit 
		from TBL_B2BMAINTRANSACTION where  CONVERT(date, REPLACE ( VISITDATE,'/','-'), 105) <=CAST( CAST(getdate() as varchar(50)) as date ) 
		group by SBTAG )b
		on a.SBCode =b.SBTAG 

        --SELECT [Id],[BID],[SBCode],[IsDelete] FROM [testdb].[dbo].[tbl_B2BMapping] where 
        
        select SBTAG ,c.BMAction,VISITDATE,TARGETDATE as 'TARGET DATE', b.Status  from
        (select ID , SBTAG ,VISITDATE,'Process' status  from TBL_B2BMAINTRANSACTION where BMUSERID =@userid)a
        join (select BMACTION ,MEETINGID,TARGETDATE, case when ( BMSTATUS=0 )then 'InProcess' else 
		case when ( BMSTATUS=1 ) then 'Done' else
		case when ( BMSTATUS=2 ) then 'Delay' else
		case when ( BMSTATUS=3 ) then 'Rejected' 
		end end end end as Status  from TBL_B2BPURPOSETRANSACTION  )b
        on b.MEETINGID =a.ID 
        join (select BID ,BMAction  from tbl_B2BMActionMaster)c
        on c.BID =b.BMACTION
        
        insert into tbl_B2BLoginDetails(UserId,LastLogin,Location)
        values(@userid,GETDATE(),@deviceId)
        	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_MAILER
-- --------------------------------------------------



CREATE PROC [dbo].[USP_B2B_MAILER]

 @MAINID as int=0

AS BEGIN

 SET NOCOUNT ON
DECLARE @BMUSERID  VARCHAR(50)=''
DECLARE @COMPLIANCE  BIT=0
DECLARE @MEETINGSTATUS  BIT=0
DECLARE @SBTAG  VARCHAR(20)=''
DECLARE @VISITDATE  VARCHAR(50)=''
DECLARE @REMARK  VARCHAR(500)=''
DECLARE @LASTMEETING  VARCHAR(50)=''
DECLARE @SESSIONID  VARCHAR(100)=''
DECLARE @ID  INT =0 
DECLARE @ISMAIL  INT =0 

 DECLARE TRANTACTION  CURSOR
STATIC FOR 
SELECT ID,BMUSERID,COMPLIANCE,MEETINGSTATUS,SBTAG,VISITDATE,REMARK,LASTMEETING,SESSIONID,ISMAIL  FROM TBL_B2BMAINTRANSACTION WHERE ISMAIL =0 AND ISARCHIVE=0 and ID= @MAINID
OPEN TRANTACTION
IF @@CURSOR_ROWS > 0
 BEGIN 
 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 WHILE @@FETCH_STATUS = 0
 BEGIN


			------------------------------

			DECLARE @MEETINGID AS INT=0
			DECLARE @PURPOSE AS VARCHAR(20)=''
			DECLARE @REQUIREMENT AS VARCHAR(20)=''
			DECLARE @BMACTION AS VARCHAR(20)=''
			DECLARE @EXPECTEDOUTCOME AS VARCHAR(50)=''
			DECLARE @PARAMETER AS VARCHAR(500)=''
			DECLARE @TARGETDATE AS VARCHAR(50)=''
			DECLARE @BMSTATUS AS INT =0
			DECLARE @ID1 AS INT =0 

			DECLARE TRANTACTION_PURPOSE  CURSOR
			STATIC FOR 
			SELECT ID,MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE  FROM TBL_B2BPURPOSETRANSACTION WHERE MEETINGID=@ID
			OPEN TRANTACTION_PURPOSE
			IF @@CURSOR_ROWS > 0
			BEGIN 
			FETCH NEXT FROM TRANTACTION_PURPOSE INTO @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			WHILE @@FETCH_STATUS = 0
			BEGIN

			DECLARE @EVENT AS INT=0
			DECLARE @HIRING AS INT =0
			DECLARE @COLLATE AS INT =0
			DECLARE @VCARD AS INT=0
			DECLARE @MICROSITE AS INT=0
			DECLARE @LEAFLET AS INT=0
			DECLARE @FLAG AS INT=0
			DECLARE @MAILBODY AS VARCHAR(MAX)


			SELECT @EVENT=COUNT(1) FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID=@ID1

			IF(@EVENT>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'EVENT')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @HIRING=COUNT(1) FROM [DBO].[TBL_B2BHIRING] WHERE PURPOSEID=@ID1

			IF(@HIRING>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'HIRING')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @COLLATE=COUNT(1) FROM [DBO].[TBL_B2BMKTCOLLATERAL] WHERE PURPOSEID=@ID1

			IF(@COLLATE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'COLLATE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @VCARD=COUNT(1) FROM [DBO].[TBL_B2BVCARD] WHERE PURPOSEID=@ID1

			IF(@VCARD>0)
			BEGIN
			---SEND MAIL
				SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'VCARD')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @LEAFLET=COUNT(1) FROM TBL_LEAFLET WHERE PURPOSEID=@ID1

			IF(@LEAFLET>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'LEAFLET')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @MICROSITE=COUNT(1) FROM [DBO].[TBL_B2BMICROSITE] WHERE PURPOSEID=@ID1

			IF(@MICROSITE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'MICROSITE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END
            
			IF( @FLAG=0)
			BEGIN
			----SEND MAIL WITHOUT BODY TABLE
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'NONE')
			exec USP_B2BSendmail @id ,@MAILBODY
			END



			FETCH NEXT FROM TRANTACTION_PURPOSE INTO  @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			END
			END
			CLOSE TRANTACTION_PURPOSE
			DEALLOCATE TRANTACTION_PURPOSE


			-----------------------------

----UPDATE ISMAIL FLAG
       
	   update TBL_B2BMAINTRANSACTION
	   set ISMAIL=1
	   where id =@ID


 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 END
END
CLOSE TRANTACTION
DEALLOCATE TRANTACTION
SET NOCOUNT OFF 




END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_MASSMAILER
-- --------------------------------------------------

CREATE PROC [dbo].[USP_B2B_MASSMAILER]
AS BEGIN

 SET NOCOUNT ON
DECLARE @BMUSERID  VARCHAR(50)=''
DECLARE @COMPLIANCE  BIT=0
DECLARE @MEETINGSTATUS  BIT=0
DECLARE @SBTAG  VARCHAR(20)=''
DECLARE @VISITDATE  VARCHAR(50)=''
DECLARE @REMARK  VARCHAR(500)=''
DECLARE @LASTMEETING  VARCHAR(50)=''
DECLARE @SESSIONID  VARCHAR(100)=''
DECLARE @ID  INT =0 
DECLARE @ISMAIL  INT =0 

 DECLARE TRANTACTION  CURSOR
STATIC FOR 
SELECT ID,BMUSERID,COMPLIANCE,MEETINGSTATUS,SBTAG,VISITDATE,REMARK,LASTMEETING,SESSIONID,ISMAIL  FROM TBL_B2BMAINTRANSACTION WHERE ISMAIL =0 AND ISARCHIVE=0
OPEN TRANTACTION
IF @@CURSOR_ROWS > 0
 BEGIN 
 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 WHILE @@FETCH_STATUS = 0
 BEGIN


			------------------------------

			DECLARE @MEETINGID AS INT=0
			DECLARE @PURPOSE AS VARCHAR(20)=''
			DECLARE @REQUIREMENT AS VARCHAR(20)=''
			DECLARE @BMACTION AS VARCHAR(20)=''
			DECLARE @EXPECTEDOUTCOME AS VARCHAR(50)=''
			DECLARE @PARAMETER AS VARCHAR(500)=''
			DECLARE @TARGETDATE AS VARCHAR(50)=''
			DECLARE @BMSTATUS AS INT =0
			DECLARE @ID1 AS INT =0 

			DECLARE TRANTACTION_PURPOSE  CURSOR
			STATIC FOR 
			SELECT ID,MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE  FROM TBL_B2BPURPOSETRANSACTION WHERE MEETINGID=@ID
			OPEN TRANTACTION_PURPOSE
			IF @@CURSOR_ROWS > 0
			BEGIN 
			FETCH NEXT FROM TRANTACTION_PURPOSE INTO @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			WHILE @@FETCH_STATUS = 0
			BEGIN

			DECLARE @EVENT AS INT=0
			DECLARE @HIRING AS INT =0
			DECLARE @COLLATE AS INT =0
			DECLARE @VCARD AS INT=0
			DECLARE @MICROSITE AS INT=0
			DECLARE @LEAFLET AS INT=0
			DECLARE @FLAG AS INT=0
			DECLARE @MAILBODY AS VARCHAR(MAX)


			SELECT @EVENT=COUNT(1) FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID=@ID1

			IF(@EVENT>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'EVENT')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @HIRING=COUNT(1) FROM [DBO].[TBL_B2BHIRING] WHERE PURPOSEID=@ID1

			IF(@HIRING>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'HIRING')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @COLLATE=COUNT(1) FROM [DBO].[TBL_B2BMKTCOLLATERAL] WHERE PURPOSEID=@ID1

			IF(@COLLATE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'COLLATE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @VCARD=COUNT(1) FROM [DBO].[TBL_B2BVCARD] WHERE PURPOSEID=@ID1

			IF(@VCARD>0)
			BEGIN
			---SEND MAIL
				SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'VCARD')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @LEAFLET=COUNT(1) FROM TBL_LEAFLET WHERE PURPOSEID=@ID1

			IF(@LEAFLET>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'LEAFLET')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END

			SELECT @MICROSITE=COUNT(1) FROM [DBO].[TBL_B2BMICROSITE] WHERE PURPOSEID=@ID1

			IF(@MICROSITE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'MICROSITE')
			exec USP_B2BSendmail @id ,@MAILBODY
			SET @FLAG=1
			END
            
			IF( @FLAG=0)
			BEGIN
			----SEND MAIL WITHOUT BODY TABLE
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'NONE')
			exec USP_B2BSendmail @id ,@MAILBODY
			END



			FETCH NEXT FROM TRANTACTION_PURPOSE INTO  @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			END
			END
			CLOSE TRANTACTION_PURPOSE
			DEALLOCATE TRANTACTION_PURPOSE


			-----------------------------

----UPDATE ISMAIL FLAG
       
	   update TBL_B2BMAINTRANSACTION
	   set ISMAIL=1
	   where id =@ID


 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 END
END
CLOSE TRANTACTION
DEALLOCATE TRANTACTION
SET NOCOUNT OFF 




END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2B_MASSMAILER_bk
-- --------------------------------------------------

CREATE PROC [dbo].[USP_B2B_MASSMAILER_bk]
AS BEGIN

 SET NOCOUNT ON
DECLARE @BMUSERID  VARCHAR(50)=''
DECLARE @COMPLIANCE  BIT=0
DECLARE @MEETINGSTATUS  BIT=0
DECLARE @SBTAG  VARCHAR(20)=''
DECLARE @VISITDATE  VARCHAR(50)=''
DECLARE @REMARK  VARCHAR(500)=''
DECLARE @LASTMEETING  VARCHAR(50)=''
DECLARE @SESSIONID  VARCHAR(100)=''
DECLARE @ID  INT =0 
DECLARE @ISMAIL  INT =0 

 DECLARE TRANTACTION  CURSOR
STATIC FOR 
SELECT ID,BMUSERID,COMPLIANCE,MEETINGSTATUS,SBTAG,VISITDATE,REMARK,LASTMEETING,SESSIONID,ISMAIL  FROM TBL_B2BMAINTRANSACTION WHERE ISMAIL =0 AND ISARCHIVE=0
OPEN TRANTACTION
IF @@CURSOR_ROWS > 0
 BEGIN 
 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 WHILE @@FETCH_STATUS = 0
 BEGIN


			------------------------------

			DECLARE @MEETINGID AS INT=0
			DECLARE @PURPOSE AS VARCHAR(20)=''
			DECLARE @REQUIREMENT AS VARCHAR(20)=''
			DECLARE @BMACTION AS VARCHAR(20)=''
			DECLARE @EXPECTEDOUTCOME AS VARCHAR(50)=''
			DECLARE @PARAMETER AS VARCHAR(500)=''
			DECLARE @TARGETDATE AS VARCHAR(50)=''
			DECLARE @BMSTATUS AS INT =0
			DECLARE @ID1 AS INT =0 

			DECLARE TRANTACTION_PURPOSE  CURSOR
			STATIC FOR 
			SELECT ID,MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE  FROM TBL_B2BPURPOSETRANSACTION WHERE MEETINGID=@ID
			OPEN TRANTACTION_PURPOSE
			IF @@CURSOR_ROWS > 0
			BEGIN 
			FETCH NEXT FROM TRANTACTION_PURPOSE INTO @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			WHILE @@FETCH_STATUS = 0
			BEGIN

			DECLARE @EVENT AS INT=0
			DECLARE @HIRING AS INT =0
			DECLARE @COLLATE AS INT =0
			DECLARE @VCARD AS INT=0
			DECLARE @MICROSITE AS INT=0
			DECLARE @LEAFLET AS INT=0
			DECLARE @FLAG AS INT=0
			DECLARE @MAILBODY AS VARCHAR(MAX)


			SELECT @EVENT=COUNT(1) FROM TBL_B2BEVENTASSESSMENT WHERE PURPOSEID=@ID1

			IF(@EVENT>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'EVENT')
			SELECT 1
			SET @FLAG=1
			END

			SELECT @HIRING=COUNT(1) FROM [DBO].[TBL_B2BHIRING] WHERE PURPOSEID=@ID1

			IF(@HIRING>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'HIRING')
			SELECT 1
			SET @FLAG=1
			END

			SELECT @COLLATE=COUNT(1) FROM [DBO].[TBL_B2BMKTCOLLATERAL] WHERE PURPOSEID=@ID1

			IF(@COLLATE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'COLLATE')
			SELECT 1
			SET @FLAG=1
			END

			SELECT @VCARD=COUNT(1) FROM [DBO].[TBL_B2BVCARD] WHERE PURPOSEID=@ID1

			IF(@VCARD>0)
			BEGIN
			---SEND MAIL
				SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'VCARD')
			SELECT 1
			SET @FLAG=1
			END

			SELECT @LEAFLET=COUNT(1) FROM TBL_LEAFLET WHERE PURPOSEID=@ID1

			IF(@LEAFLET>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'LEAFLET')
			SELECT 1
			SET @FLAG=1
			END

			SELECT @MICROSITE=COUNT(1) FROM [DBO].[TBL_B2BMICROSITE] WHERE PURPOSEID=@ID1

			IF(@MICROSITE>0)
			BEGIN
			---SEND MAIL
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'MICROSITE')
			SELECT 1
			SET @FLAG=1
			END
            
			IF( @FLAG=0)
			BEGIN
			----SEND MAIL WITHOUT BODY TABLE
			SELECT @MAILBODY=DBO.UDP_B2BMAILBODY(@MEETINGID,@ID1,'NONE')
			SELECT 1
			END



			FETCH NEXT FROM TRANTACTION_PURPOSE INTO  @ID1,@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE 
			END
			END
			CLOSE TRANTACTION_PURPOSE
			DEALLOCATE TRANTACTION_PURPOSE


			-----------------------------

----UPDATE ISMAIL FLAG
       


 FETCH NEXT FROM TRANTACTION INTO @ID,@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,@ISMAIL
 END
END
CLOSE TRANTACTION
DEALLOCATE TRANTACTION
SET NOCOUNT OFF 




END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2Bescalation
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj PATil
-- Create date: 18-jun-2016
-- Description:	Esclation

--USP_B2Bescalation 'a,s,d,f,g,h,j','aa,ss,dd,ff,gg,hh,jj'
-- =============================================
CREATE PROCEDURE [dbo].[USP_B2BESCALATION]
@ID AS VARCHAR(200)='',
@BMID AS VARCHAR(200)=''

AS
BEGIN


			IF OBJECT_ID('tempdb..#ids') IS NOT NULL
			DROP TABLE #ids

			IF OBJECT_ID('tempdb..#temp') IS NOT NULL
			DROP TABLE #temp

			select * into #ids from dbo.SplitString(@ID, ',')


			select id,meetingid as mainId,ROW_NUMBER() over (order by id) as cnt  into #temp from #ids a join (select id ,meetingid from TBL_B2BPURPOSETRANSACTION) b
			on a.item=b.ID 


			declare @max as int =0
			select @max=max(cnt ) from #temp

			declare @i as int=1
			while @i<=@max 
			begin
			declare @mainid as int
			declare @purId as int

			select @mainid =mainid,@purId=id from #temp where cnt =@i 


			exec USP_B2B_ESCALATIONMAIL @mainid,@purId
			select @mainid,@purId
			set @i =@i +1
			end 



END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_B2BSendmail
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj Patil
-- Create date: 19-06-2016
-- Description:	<Description,,>

--USP_B2BSendmail 1,'test'
-- =============================================
CREATE PROCEDURE USP_B2BSendmail
	@PURPOSEID as int,
	@MAILBODY as varchar(max)
	
AS
BEGIN
DECLARE @Subject VARCHAR(max) 
set @Subject =''

select @Subject= case when Purpose='OTHERS' then'B2B Visit' else Purpose end from tbl_B2BPurposeMaster where PID=@PURPOSEID

set @Subject= 'B2B '+ @Subject


DECLARE @tomail VARCHAR(max) 
SELECT @tomail = COALESCE(@tomail + '; ', '') + ResponsibleID1
FROM (select distinct ResponsibleID1 from  tbl_B2BMailMatrix_text WHERE ResponsibleID1 IS NOT NULL and PID =@PURPOSEID)a

DECLARE @CCmail VARCHAR(max) 
SELECT @CCmail = COALESCE(@CCmail + '; ', '') + ResponsibleID2
FROM (select distinct ResponsibleID2 from  tbl_B2BMailMatrix_text WHERE ResponsibleID2 IS NOT NULL and PID =@PURPOSEID)a


	
 EXEC MSDB.DBO.Sp_send_dbmail                  
 @PROFILE_NAME = 'Intranet',                                 
 @RECIPIENTS = @tomail,         
 @COPY_RECIPIENTS = @CCmail,                 
 @SUBJECT = @Subject,                  
 @BODY = @MAILBODY,                  
 @BODY_FORMAT = 'HTML'    
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_benchmark
-- --------------------------------------------------
    
CREATE procedure [dbo].[Usp_benchmark]            
as            
        
/*Created by : Rozina Raje    
Created on : 28th Jan 2010    
Esteem execution time : 2:35 min*/        
    
/*Declaration of variables*/            
declare @proc_from_date as varchar(21),@proc_to_date as varchar(21)            
declare @now as float,@noipm as float,@noipd as float,@actual_kyc as float,@FTE_kyc as float,@staff_cnt as float            
set @staff_cnt=0.0            
declare @bse_payin as int,@nse_payin as int,@fo_payin as int,@mcx_payin as int,@ncdx_payin as int,@mcd_payin as int,            
@nsx_payin as int,            
@bse_payout as int,@nse_payout as int,@fo_payout as int,@mcx_payout as int,@ncdx_payout as int,@mcd_payout as int,            
@nsx_payout as int,            
@bse_reco as int,@nse_reco as int,@fo_reco as int,@mcx_reco as int,@ncdx_reco as int,@mcd_reco as int,            
@nsx_reco as int            
declare @avg_tran_per_day as int,@payin_bank as int,@payout_bank as int,@reco as int,@banking_fte_req as float            
     
/*Delete existing records of curr date*/    
delete from tbl_benchmark_cal where curr_date=convert(varchar(11),getdate(),103)       
         
/*Process Date*/            
SELECT @proc_from_date= convert(varchar(11),DATEADD(mm, DATEDIFF(m,0,getdate())-1,0))              
SELECT @proc_to_date=convert(varchar(11),DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)))        
/*SELECT CONVERT(VARCHAR(8), convert(datetime,@proc_from_date), 112) */      
            
/* Calculate No of working days*/            
SELECT     @now=COUNT(DISTINCT Sauda_Date)            
FROM         MIS.remisior.dbo.comb_co            
WHERE     (Sauda_Date >= @proc_from_date+' 00:00:00') AND (Sauda_Date <= @proc_to_date+' 23:23:59')             
            
            
/*FOR KYC calculation */            
            
SELECT     noipm=COUNT(*), branch_cd            
INTO            [#k]            
FROM         ABVSKYCMIS.kyc.dbo.client_inwardregister AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.party_code = b.cl_code            
WHERE     (a.updatedon >= @proc_from_date+' 00:00:00') AND (a.updatedon <= @proc_to_date+' 23:23:59') AND (ISNULL(a.party_code, '') <> '')            
GROUP BY branch_cd            
    
      
SELECT     COUNT(emp_code) AS staff_cnt, branch_cd          
INTO            [#k1]          
FROM         MIS.remisior.dbo.tbl_benchmark_io          
WHERE     (todate > GETDATE()) AND (department = 'KYC')          
GROUP BY branch_cd            
    
insert into tbl_benchmark_cal              
SELECT     convert(varchar(11),getdate(),103),@proc_from_date,@proc_to_date,'KYC' AS department, a.branch_cd,  CONVERT(decimal(15, 2), noipm / @now) / 15.00 AS FTE_KYC,             
                      ISNULL(CONVERT(decimal(15, 2), noipm / @now) / b.staff_cnt, 0) AS actual_kyc            
FROM         [#k] AS a FULL OUTER JOIN            
                      [#k1] AS b ON a.branch_cd = b.branch_cd            
            
             
/*            
FOR Banking            
 Payin for diff segments            
*/            
DECLARE @Table1 TABLE (payin int,branch_cd   varchar(15) )            
INSERT INTO @Table1            
            
SELECT     COUNT(*) AS bse_payin, b.branch_cd            
FROM         risk.dbo.abl_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59') AND (b.Last_inactive_date >= GETDATE()) AND             
                      (isnumeric(a.cltcode) = 0)            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS nse_payin, b.branch_cd            
FROM         risk.dbo.nse_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS fo_payin, b.branch_cd            
FROM         risk.dbo.fo_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS mcx_payin, b.branch_cd            
FROM         risk.dbo.mcdx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS ncdx_payin, b.branch_cd            
FROM         risk.dbo.ncdx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS mcd_payin, b.branch_cd            
FROM         risk.dbo.mcd_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code            
WHERE     (a.Vtyp = 2) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS nsx_payin, b.branch_cd            
FROM         risk.dbo.nsx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code            
WHERE     (a.Vtyp = 2) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
select payin=sum(payin),branch_cd into #b from @Table1 group by branch_cd            
            
             
/*Payout calculation for diff segments*/            
DECLARE @Table2 TABLE (payout int,branch_cd   varchar(15) )            
INSERT INTO @Table2            
            
SELECT     COUNT(*) AS bse_payin, b.branch_cd            
FROM         risk.dbo.abl_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59') AND (b.Last_inactive_date >= GETDATE()) AND             
                      (isnumeric(a.cltcode) = 0)            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS nse_payin, b.branch_cd            
FROM         risk.dbo.nse_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS fo_payin, b.branch_cd            
FROM         risk.dbo.fo_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS mcx_payin, b.branch_cd            
FROM         risk.dbo.mcdx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS ncdx_payin, b.branch_cd            
FROM         risk.dbo.ncdx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS mcd_payin, b.branch_cd            
FROM         risk.dbo.mcd_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code            
WHERE     (a.Vtyp = 3) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS nsx_payin, b.branch_cd            
FROM         risk.dbo.nsx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code            
WHERE     (a.Vtyp = 3) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
select payout=isnull((sum(payout)*115)/100,0),branch_cd into #b1 from @Table2 group by branch_cd--drop table #b1            
             
/*Reco calculation for diff segments*/            
            
DECLARE @Table3 TABLE (reco int,branch_cd   varchar(15) )            
INSERT INTO @Table3            
            
SELECT     COUNT(*) AS bse_payin, b.branch_cd            
FROM         risk.dbo.abl_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59') AND (b.Last_inactive_date >= GETDATE()) AND             
                      (isnumeric(a.cltcode) = 0)            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS nse_payin, b.branch_cd    FROM         risk.dbo.nse_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS fo_payin, b.branch_cd            
FROM         risk.dbo.fo_ledger AS a INNER JOIN            
          risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS mcx_payin, b.branch_cd            
FROM         risk.dbo.mcdx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS ncdx_payin, b.branch_cd            
FROM         risk.dbo.ncdx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code            
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS mcd_payin, b.branch_cd            
FROM         risk.dbo.mcd_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code            
WHERE     (a.Vtyp = 80) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
union all            
            
SELECT     COUNT(*) AS nsx_payin, b.branch_cd            
FROM         risk.dbo.nsx_ledger AS a INNER JOIN            
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code            
WHERE     (a.Vtyp = 80) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')            
GROUP BY b.branch_cd            
            
select reco=isnull((sum(reco)*20)/100,0),branch_cd into #b2 from  @Table3 group by branch_cd            
            
select * into #b3            
from #b             
union all            
select * from #b1            
union all            
select * from #b2            
            
select tran_per_day=sum(payin)/@now,branch_cd into #b4 from #b3 group by branch_cd            
            
SELECT     COUNT(emp_code) AS staff_cnt, branch_cd            
INTO            [#staff_cnt2]            
FROM         mis.remisior.dbo.tbl_benchmark_io            
WHERE     (todate > GETDATE()) AND (department = 'Banking')            
GROUP BY branch_cd            
            
insert into tbl_benchmark_cal     
SELECT     convert(varchar(11),getdate(),103),@proc_from_date,@proc_to_date,'Banking' AS department, a.branch_cd, CONVERT(decimal(15, 2), a.tran_per_day) / 196.27 AS FTE_BANKING, ISNULL(CONVERT(decimal(15, 2),             
                      a.tran_per_day) / b.staff_cnt, 0) AS actual_banking            
FROM         [#b4] AS a FULL OUTER JOIN            
                      [#staff_cnt2] AS b ON a.branch_cd = b.branch_cd            
GROUP BY a.branch_cd, a.tran_per_day, b.staff_cnt             
            
            
            
/*FOR D. P. Calculation            
Count dis punch */            
SELECT DISTINCT b.cm_blsavingcd            
INTO            [#dp_t]            
FROM         [ABCSOORACLEMDLW].synergy.dbo.trxn_details AS a INNER JOIN            
                      [ABCSOORACLEMDLW].synergy.dbo.client_master AS b ON a.td_ac_code = b.cm_cd            
WHERE     (a.td_ac_code LIKE '12%') AND (a.td_curdate >= CONVERT(VARCHAR(8), convert(datetime,@proc_from_date), 112)) AND (a.td_curdate <= CONVERT(VARCHAR(8), convert(datetime,@proc_to_date), 112)) AND (a.td_internal_refno <> '00000') AND             
(a.td_narration = '044') AND (b.cm_blsavingcd <> '')            
            
            
SELECT     COUNT(*) AS dis_cnt, branch_cd            
INTO            [#dp6]            
FROM         [#dp_t] AS a INNER JOIN            
                     risk.dbo.client_details AS b ON a.cm_blsavingcd = b.cl_code            
GROUP BY branch_cd            
            
            
/*count DRF forms*/            
SELECT     COUNT(*) AS drf_cnt, branch_cd            
INTO            [#dp1]            
FROM         MIS.demat.dbo.tbl_drf_inward_register AS a INNER JOIN            
                       risk.dbo.client_details AS b ON a.Maker_accesscode = b.branch_cd            
WHERE     (a.Maker_Datetime >= @proc_from_date+' 00:00:00') AND (a.Maker_Datetime <= @proc_to_date+' 23:23:59')            
GROUP BY a.Maker_accesscode, branch_cd            
            
            
/*count Payout Marking*/            
SELECT     COUNT(*) AS POM_cnt, branch_cd            
INTO            [#dp2]            
FROM         MIS.demat.dbo.Hist_tbl_Client_Wise_marking AS a INNER JOIN            
                       risk.dbo.client_details AS b ON a.Party_Code = b.party_code            
WHERE     (a.Fld_Date >= @proc_from_date+' 00:00:00') AND (a.Fld_Date <= @proc_to_date+' 23:23:59')            
GROUP BY branch_cd            
            
            
/*count Auction Bill             
 NSE */            
SELECT     COUNT(*) AS AucBillNSe_cnt, branch_cd            
INTO            [#d]            
FROM         anand1.msajag.dbo.history AS a INNER JOIN            
                       risk.dbo.client_details AS b ON a.Party_Code = b.party_code            
WHERE     (a.Sauda_date >= @proc_from_date+' 00:00:00') AND (a.Sauda_date <= @proc_to_date+' 23:23:59')            
GROUP BY branch_cd            
            
/*BSE*/            
SELECT     COUNT(*) AS AucBillBSE_cnt, branch_cd            
INTO            [#d1]            
FROM         anand.bsedb_ab.dbo.history AS a INNER JOIN            
                       risk.dbo.client_details AS b ON a.Party_Code = b.party_code            
WHERE     (a.Sauda_date >= @proc_from_date+' 00:00:00') AND (a.Sauda_date <= @proc_to_date+' 23:23:59')            
GROUP BY branch_cd            
            
            
select * into #d2            
from #d            
union all            
select * from #d1            
            
select AucBill_cnt=count(AucBillNSE_cnt),branch_cd into #dp5 from #d2 group by branch_cd            
            
/*Count Payin Shortage            
BSE & NSE*/          
            
SELECT     COUNT(a.party_code) AS payin_bse, branch_cd            
INTO            [#dp3]            
FROM         risk.dbo.tbl_benchmark_cnt_payin AS a INNER JOIN            
                       risk.dbo.client_details AS b ON a.party_code = b.party_code            
WHERE     (segment IN ('BSE', 'NSE')) AND (upd_date >= @proc_from_date+' 00:00:00') AND (upd_date <= @proc_to_date+' 23:23:59')            
GROUP BY branch_cd            
            
          
select * into #dp            
from #dp1             
union all            
select * from #dp5            
union all            
select * from #dp2            
union all            
select * from #dp3            
union all            
select * from #dp6            
            
SELECT     SUM(drf_cnt) / @now AS tran_per_day, branch_cd            
INTO            [#dp4]            
FROM         [#dp]            
GROUP BY branch_cd            
            
SELECT     COUNT(emp_code) AS staff_cnt, branch_cd            
INTO            [#staff_cnt3]            
FROM         MIS.remisior.dbo.tbl_benchmark_io            
WHERE     (todate > GETDATE()) AND (department = 'D.P.')            
GROUP BY branch_cd            
            
insert into tbl_benchmark_cal          
SELECT     convert(varchar(11),getdate(),103),@proc_from_date,@proc_to_date,'D.P.' AS department, a.branch_cd, CONVERT(decimal(15, 2), a.tran_per_day) / 86.6 AS FTE_DP, ISNULL(CONVERT(decimal(15, 2), a.tran_per_day)             
                      / b.staff_cnt, 0) AS actual_DP            
FROM         [#dp4] AS a FULL OUTER JOIN            
                      [#staff_cnt3] AS b ON a.branch_cd = b.branch_cd            
GROUP BY a.branch_cd, a.tran_per_day, b.staff_cnt

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_benchmark_report
-- --------------------------------------------------
CREATE procedure usp_benchmark_report            
(@month as char(2),      
@year as char(4),      
@EntityCode as varchar(25),                                                                                                                    
@EntityType as varchar(10),                                                                                                                  
@FltrEntity as varchar(10),                                               
@department as varchar(15)  ,                               
@access_to as varchar(10),                                                                                                                    
@access_code as varchar(25)                                              
)                                                  
AS            
        
    /*                                          
declare                                                   
@EntityCode as varchar(25),                                                                                  
@EntityType as varchar(10),                                                                                
@FltrEntity as varchar(10),                               
@department as varchar(15)  ,                               
@access_to as varchar(10),                                                                                  
@access_code as varchar(25)        
declare @month as char(2),      
@year as char(4)      
                                               
                            
                                             
set @EntityCode='west'                                                                          
set @EntityType='zone'                                 
set @FltrEntity='zone'                               
set @department='banking'                                
set @access_to ='broker'                                           
set @access_code='cso'                                          
set @month=1      
set @year=2009      
     */
      
set nocount on       
   declare @last_day_of_month as varchar(21)       
set @last_day_of_month = dateadd(d, -1, dateadd(m, 1,  convert(datetime, convert(varchar,@month) +       
       '/01/' +       
      convert(varchar,@year )      
     )))      
--print @last_day_of_month      
                           
declare @filename as varchar(50)                                                                                                            
set @filename = 'vw_benchmark_cal'                                                                   
                  
------------------------------------------------------------------------- Datasource Filtering                                                                                                  
declare @Source as varchar(5000),@DataFltr as varchar(500),@DataFltr1 as varchar(500)                                    
set @Source =''                                                                                                  
set @DataFltr = ''                                                                                      
set @DataFltr1 = ''                                         
                                                    
set @DataFltr = ' department like '''+@department+''''                                                                                      
                                                   
if @access_to='SB'                                              
begin                                              
set @Source = '(select * from '+@filename+' where '+@DataFltr+'  and '+@FltrEntity+' like '''+@EntityCode+''' and '+@access_to+' like '''+@access_code+''')'                                                                                           
end                                                                
if @access_to='BROKER'                                                                                    
begin                
 set @Source = '(select * from '+@filename+' where '+@DataFltr+'and '+@FltrEntity+' like '''+@EntityCode+''')'                                                                                    
end                     
if(@access_to='BRANCH')                                           
begin                                                    
select  @Source = '(select * from '+@filename+' where '+@DataFltr+'  and '+@FltrEntity+' like '''+@EntityCode+''' and '+@access_to+' like '''+@access_code+''')'                                                    
end                                                    
if(@access_to='BRMAST')                                            
begin                                                    
select  @Source = '(select * from '+@filename+' where '+@DataFltr+' and '+@FltrEntity+' like '''+@EntityCode+''' and  '+@EntityType+' in (select branch from intranet.risk.dbo.branch_master where brmast_cd= '''+@access_code+'''))'              
end                                                  
if(@access_to='REGION')                                                    
begin                                                    
select  @Source = '(select * from '+@filename+' where '+@DataFltr+'  and  '+@EntityType+' in (select CODE from intranet.risk.dbo.REGION where REG_CODE= '''+@access_code+'''))'                                                    
end                                  
if(@access_to='SBMAST')                                                    
begin                                                    
select  @Source = '(select * from '+@filename+' where '+@DataFltr+'  and '+@EntityType+' in (select sub_broker from intranet.risk.dbo.sb_master where sbmast_cd= '''+@access_code+'''))'                                                           
end                                                 
                                              
 --print @source                                                             
--------------------------------------------------------------------------------                                                  
declare @QryPreFix varchar(500),@QryPostFix varchar(500),@FtQryPreFix varchar(500),@FtQryPostFix varchar(500),@lupd varchar(500)                                                                                   
set @QryPreFix =''                                                                                    
set @QryPostFix =''                                                                                    
set @FtQryPreFix =''                                                                                    
set @FtQryPostFix =''                                                                
set @lupd =''                                                     
           
/*if @access_to='SB' or @access_to='SBMAST'                      
begin                      
set @FinSumm =  @FinSumm + 'BANKING=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_req) else 0 end) ,          
   KYC=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end),          
 DP=sum(case when department =''D.P.'' then convert(decimal(15,2),FTE_req) else 0 end) into #t                                                                                                                                   
from '+@Source +' a'                                                                        
                      
end                      
else                      
begin                                                                                 
set @FinSumm =  @FinSumm + 'BANKING=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_req) else 0 end) ,          
   KYC=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end),          
 DP=sum(case when department =''D.P.'' then convert(decimal(15,2),FTE_req) else 0 end),proc_to_date=max(proc_to_date) into #t             
 from '+@Source +' a '                                                                        
     end  */           
               
          
DECLARE @grpname as varchar(15),@FinSumm as varchar(5000),@Seq as int     
if @EntityType='ZONE'                                                                                    
begin                                                                                    
 set @QryPreFix ='set nocount on Select Zone,[Zone Name]=''<a href=''''report.aspx?reportno=280'                                                                                  
 set @QryPreFix =@QryPreFix+' &month='+@month+'&year='+@year+''        
 set @QryPreFix =@QryPreFix+'&EntityCode=''+zone+''&EntityType=REGION'                                                                                  
 set @QryPreFix =@QryPreFix+'&FltrEntity='+@EntityType+'&department='+@department+'''''>''+zone+''</a>'','  

set @FinSumm = ' ' 
set @FinSumm =  @FinSumm + 'BANKING=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_req) else 0 end) ,          
   KYC=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end),          
 DP=sum(case when department =''D.P.'' then convert(decimal(15,2),FTE_req) else 0 end),proc_to_date into #t             
 from '+@Source +' a  where datepart(mm,convert(datetime,proc_to_date,103))='+@month+' and datepart(yy,convert(datetime,proc_to_date,103))='+@year+'  '                                                                        
                 
 set @QryPostFix = ' group by zone,proc_to_date '              
                     
  set @FinSumm = @QryPreFix+@FinSumm+@QryPostFix +'
select Zone,[Zone Name],BANKING,KYC,DP,TOTAL=BANKING+KYC+DP from #t'                                                          
                                             
end                                                  
                                                  
if @EntityType='REGION'                                                                                    
begin                                                                            
 set @QryPreFix = 'set nocount on Select REGION, '                                                                                    
 set @QryPreFix =@QryPreFix+' Regionname=''<a href=''''report.aspx?reportno=280'       
 set @QryPreFix =@QryPreFix+' &month='+@month+'&year='+@year+''                                                                    
 set @QryPreFix =@QryPreFix+'&EntityCode=''+region+''&EntityType=branch'                                                              
 set @QryPreFix =@QryPreFix+'&FltrEntity='+@EntityType+'&department='+@department+'''''>''+Regionname+''</a>'','                                                                                  
                                                                             
 set @QryPostFix = ' group by Region,Regionname,proc_to_date '              
                                                                                    
set @FinSumm = ' '  
set @FinSumm =  @FinSumm + 'BANKING=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_req) else 0 end) ,          
   KYC=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end),          
 DP=sum(case when department =''D.P.'' then convert(decimal(15,2),FTE_req) else 0 end),proc_to_date into #t             
 from '+@Source +' a  where datepart(mm,convert(datetime,proc_to_date,103))='+@month+' and datepart(yy,convert(datetime,proc_to_date,103))='+@year+'  '                                                                        
                    
                   
set @FinSumm = @QryPreFix+@FinSumm+@QryPostFix +'select REGION,Regionname,BANKING,KYC,DP,TOTAL=BANKING+KYC+DP from #t  ' 
   
   
                                                      
                           
end                                                  
                                                  
/* in future will require to provide report at client level          
if @EntityType='BRANCH'                                                           
begin                                                                              
 set @QryPreFix = 'set nocount on Select Region,branch, '                                     
 set @QryPreFix =@QryPreFix+' BranchName=''<a href=''''report.aspx?reportno=166'             
 set @QryPreFix =@QryPreFix+'&EntityCode=''+branch+''&EntityType=SB'                                                                          
 set @QryPreFix =@QryPreFix+'&FltrEntity='+@EntityType+'&department='+@department+'''''>''+BranchName+''</a>'','                                                    
                  
 set @QryPostFix = ' group by Region,branch,BranchName '                                                                                 
end                                            
  */          
  if @EntityType='BRANCH'                                                           
begin                                                                              
 set @QryPreFix = 'set nocount on Select Region,branch,BranchName, '                                     
 set @QryPostFix = ' group by Region,branch,BranchName '               
--   declare @proc_from_date as varchar(21),@proc_to_date as varchar(21)                    
--SELECT @proc_from_date= convert(varchar(11),DATEADD(mm, DATEDIFF(m,0,getdate())-1,0))                      
--SELECT @proc_to_date=convert(varchar(11),DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)))                
                                                                                 
set @FinSumm = ' '                      
if @access_to='SB' or @access_to='SBMAST'                      
begin                      
set @FinSumm =  @FinSumm + '[Forms per FTE Actual Productivity],[KYC FTE Required],[Actual KYC FTE]=isnull(y.KYC_cnt,0),          
[Excess/Deficit KYC Staff]=isnull(y.KYC_cnt,0)-[KYC FTE Required],          
[Banking (Transactions/ FTE) Actual Productivity],[Banking FTE Required],[Actual Banking FTE]=isnull(y.banking_cnt,0),          
[Excess/ Deficit Banking Staff]=isnull(y.banking_cnt,0)-[Banking FTE Required],          
[DP (Transactions per active client) Actual Productivity],[DP FTE required],[Actual DP FTE]=isnull(y.dp_cnt,0),          
[Excess/ Deficit DP Staff]=isnull(y.dp_cnt,0)-[DP FTE required],[Total Required*]=[KYC FTE Required]+[Banking FTE Required]+[DP FTE required],          
[Actual Staff**]=isnull(y.KYC_cnt,0)+isnull(y.banking_cnt,0)+isnull(y.dp_cnt,0)          
 from (Select Region,branch,BranchName,          
[Forms per FTE Actual Productivity]=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_actual) else 0 end),          
[KYC FTE Required]= sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end),           
[Banking (Transactions/ FTE) Actual Productivity]=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_actual) else 0 end),          
[Banking FTE Required]=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_req) else 0 end) ,          
[DP (Transactions per active client) Actual Productivity]=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_actual) else 0 end),          
[DP FTE required]=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end)          
from '+@Source +' a           
 group by Region,branch,BranchName )x           
full outer join          
(          
select KYC_cnt=sum(case when department =''KYC'' then 1 else 0 end),          
banking_cnt=sum(case when department =''BANKING'' then 1 else 0 end),          
dp_cnt=sum(case when department =''D.P.'' then 1 else 0 end),branch_cd           
from mis.remisior.dbo.tbl_benchmark_io          
where           
todate>='''+@last_day_of_month+'''           
  group by branch_cd) y          
on x.branch=y.branch_cd where x.branch is not null'                                                                        
                     
end                      
else                      
begin                                                                                 
set @FinSumm =  @FinSumm + '[Forms per FTE Actual Productivity],[KYC FTE Required],[Actual KYC FTE]=isnull(y.KYC_cnt,0),          
[Excess/Deficit KYC Staff]=isnull(y.KYC_cnt,0)-[KYC FTE Required],          
[Banking (Transactions/ FTE) Actual Productivity],[Banking FTE Required],[Actual Banking FTE]=isnull(y.banking_cnt,0),          
[Excess/ Deficit Banking Staff]=isnull(y.banking_cnt,0)-[Banking FTE Required],          
[DP (Transactions per active client) Actual Productivity],[DP FTE required],[Actual DP FTE]=isnull(y.dp_cnt,0),          
[Excess/ Deficit DP Staff]=isnull(y.dp_cnt,0)-[DP FTE required],[Total Required*]=[KYC FTE Required]+[Banking FTE Required]+[DP FTE required],          
[Actual Staff**]=isnull(y.KYC_cnt,0)+isnull(y.banking_cnt,0)+isnull(y.dp_cnt,0)          
 from (Select Region,branch,BranchName,          
[Forms per FTE Actual Productivity]=sum(case when department =''KYC'' then convert(decimal(15,2),FTE_actual) else 0 end),          
[KYC FTE Required]= sum(case when department =''KYC'' then convert(decimal(15,2),FTE_req) else 0 end),           
[Banking (Transactions/ FTE) Actual Productivity]=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_actual) else 0 end),          
[Banking FTE Required]=sum(case when department =''BANKING'' then convert(decimal(15,2),FTE_req) else 0 end) ,          
[DP (Transactions per active client) Actual Productivity]=sum(case when department =''D.P.'' then convert(decimal(15,2),FTE_actual) else 0 end),          
[DP FTE required]=sum(case when department =''D.P.'' then convert(decimal(15,2),FTE_req) else 0 end)          
from '+@Source +' a           
 group by Region,branch,BranchName )x           
full outer join          
(          
select KYC_cnt=sum(case when department =''KYC'' then 1 else 0 end),          
banking_cnt=sum(case when department =''BANKING'' then 1 else 0 end),          
dp_cnt=sum(case when department =''D.P.'' then 1 else 0 end),branch_cd           
from mis.remisior.dbo.tbl_benchmark_io          
where           
todate>='''+@last_day_of_month+'''            
  group by branch_cd) y          
on x.branch=y.branch_cd where x.branch is not null'                                                                         
     end                                                                  
              
set @FinSumm = @QryPreFix+@FinSumm                                               
                                                                        
end           
          
                                              
if @EntityType='SB'                                                                                     
begin                                                                                    
 set @QryPreFix = 'set nocount on Select Region,branch, '                                                                                    
 set @QryPreFix =@QryPreFix+' SB=''<a href=''''report.aspx?reportno=280'                                                                                  
 set @QryPreFix =@QryPreFix+'&EntityCode=''+SB+''&EntityType=CLIENT'                                                                    
 set @QryPreFix =@QryPreFix+'&FltrEntity='+@EntityType+'&department='+@department+'''''>''+SB+''</a>'','                                                                                  
                                                                                  
 set @QryPostFix = ' group by Region,branch,SB '                                                              
  end                            
                                                  
if @EntityType='CLIENT'                                                                                     
begin                                                                                    
 set @QryPreFix = 'set nocount on Select Region,branch,client, '                                                                                    
 set @QryPostFix = ' group by Region,branch,sb,client '                              
end                              
                                               
-------------------------------------------------------                                                  
--print @QryPreFix                                                                      
--print @QryPostFix                                                                           
                                                            
exec(@FinSumm)                               
                       
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_benchmark31122012
-- --------------------------------------------------
  
CREATE procedure Usp_benchmark31122012          
as          
      
/*Created by : Rozina Raje  
Created on : 28th Jan 2010  
Esteem execution time : 2:35 min*/      
  
/*Declaration of variables*/          
declare @proc_from_date as varchar(21),@proc_to_date as varchar(21)          
declare @now as float,@noipm as float,@noipd as float,@actual_kyc as float,@FTE_kyc as float,@staff_cnt as float          
set @staff_cnt=0.0          
declare @bse_payin as int,@nse_payin as int,@fo_payin as int,@mcx_payin as int,@ncdx_payin as int,@mcd_payin as int,          
@nsx_payin as int,          
@bse_payout as int,@nse_payout as int,@fo_payout as int,@mcx_payout as int,@ncdx_payout as int,@mcd_payout as int,          
@nsx_payout as int,          
@bse_reco as int,@nse_reco as int,@fo_reco as int,@mcx_reco as int,@ncdx_reco as int,@mcd_reco as int,          
@nsx_reco as int          
declare @avg_tran_per_day as int,@payin_bank as int,@payout_bank as int,@reco as int,@banking_fte_req as float          
   
/*Delete existing records of curr date*/  
delete from tbl_benchmark_cal where curr_date=convert(varchar(11),getdate(),103)     
       
/*Process Date*/          
SELECT @proc_from_date= convert(varchar(11),DATEADD(mm, DATEDIFF(m,0,getdate())-1,0))            
SELECT @proc_to_date=convert(varchar(11),DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,GETDATE()),0)))      
/*SELECT CONVERT(VARCHAR(8), convert(datetime,@proc_from_date), 112) */    
          
/* Calculate No of working days*/          
SELECT     @now=COUNT(DISTINCT Sauda_Date)          
FROM         MIS.remisior.dbo.comb_co          
WHERE     (Sauda_Date >= @proc_from_date+' 00:00:00') AND (Sauda_Date <= @proc_to_date+' 23:23:59')           
          
          
/*FOR KYC calculation */          
          
SELECT     noipm=COUNT(*), branch_cd          
INTO            [#k]          
FROM         MIS.kyc.dbo.client_inwardregister AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.party_code = b.cl_code          
WHERE     (a.updatedon >= @proc_from_date+' 00:00:00') AND (a.updatedon <= @proc_to_date+' 23:23:59') AND (ISNULL(a.party_code, '') <> '')          
GROUP BY branch_cd          
  
    
SELECT     COUNT(emp_code) AS staff_cnt, branch_cd        
INTO            [#k1]        
FROM         MIS.remisior.dbo.tbl_benchmark_io        
WHERE     (todate > GETDATE()) AND (department = 'KYC')        
GROUP BY branch_cd          
  
insert into tbl_benchmark_cal            
SELECT     convert(varchar(11),getdate(),103),@proc_from_date,@proc_to_date,'KYC' AS department, a.branch_cd,  CONVERT(decimal(15, 2), noipm / @now) / 15.00 AS FTE_KYC,           
                      ISNULL(CONVERT(decimal(15, 2), noipm / @now) / b.staff_cnt, 0) AS actual_kyc          
FROM         [#k] AS a FULL OUTER JOIN          
                      [#k1] AS b ON a.branch_cd = b.branch_cd          
          
           
/*          
FOR Banking          
 Payin for diff segments          
*/          
DECLARE @Table1 TABLE (payin int,branch_cd   varchar(15) )          
INSERT INTO @Table1          
          
SELECT     COUNT(*) AS bse_payin, b.branch_cd          
FROM         risk.dbo.abl_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59') AND (b.Last_inactive_date >= GETDATE()) AND           
                      (isnumeric(a.cltcode) = 0)          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS nse_payin, b.branch_cd          
FROM         risk.dbo.nse_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS fo_payin, b.branch_cd          
FROM         risk.dbo.fo_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS mcx_payin, b.branch_cd          
FROM         risk.dbo.mcdx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS ncdx_payin, b.branch_cd          
FROM         risk.dbo.ncdx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 2) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS mcd_payin, b.branch_cd          
FROM         risk.dbo.mcd_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code          
WHERE     (a.Vtyp = 2) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS nsx_payin, b.branch_cd          
FROM         risk.dbo.nsx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code          
WHERE     (a.Vtyp = 2) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
select payin=sum(payin),branch_cd into #b from @Table1 group by branch_cd          
          
           
/*Payout calculation for diff segments*/          
DECLARE @Table2 TABLE (payout int,branch_cd   varchar(15) )          
INSERT INTO @Table2          
          
SELECT     COUNT(*) AS bse_payin, b.branch_cd          
FROM         risk.dbo.abl_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59') AND (b.Last_inactive_date >= GETDATE()) AND           
                      (isnumeric(a.cltcode) = 0)          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS nse_payin, b.branch_cd          
FROM         risk.dbo.nse_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS fo_payin, b.branch_cd          
FROM         risk.dbo.fo_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS mcx_payin, b.branch_cd          
FROM         risk.dbo.mcdx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS ncdx_payin, b.branch_cd          
FROM         risk.dbo.ncdx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 3) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS mcd_payin, b.branch_cd          
FROM         risk.dbo.mcd_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code          
WHERE     (a.Vtyp = 3) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS nsx_payin, b.branch_cd          
FROM         risk.dbo.nsx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code          
WHERE     (a.Vtyp = 3) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
select payout=isnull((sum(payout)*115)/100,0),branch_cd into #b1 from @Table2 group by branch_cd--drop table #b1          
           
/*Reco calculation for diff segments*/          
          
DECLARE @Table3 TABLE (reco int,branch_cd   varchar(15) )          
INSERT INTO @Table3          
          
SELECT     COUNT(*) AS bse_payin, b.branch_cd          
FROM         risk.dbo.abl_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59') AND (b.Last_inactive_date >= GETDATE()) AND           
                      (isnumeric(a.cltcode) = 0)          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS nse_payin, b.branch_cd    FROM         risk.dbo.nse_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS fo_payin, b.branch_cd          
FROM         risk.dbo.fo_ledger AS a INNER JOIN          
          risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS mcx_payin, b.branch_cd          
FROM         risk.dbo.mcdx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS ncdx_payin, b.branch_cd          
FROM         risk.dbo.ncdx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.cltcode = b.cl_code          
WHERE     (a.vtyp = 80) AND (a.vdt >= @proc_from_date+' 00:00:00') AND (a.vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS mcd_payin, b.branch_cd          
FROM         risk.dbo.mcd_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code          
WHERE     (a.Vtyp = 80) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
union all          
          
SELECT     COUNT(*) AS nsx_payin, b.branch_cd          
FROM         risk.dbo.nsx_ledger AS a INNER JOIN          
                      risk.dbo.client_details AS b ON a.Cltcode = b.cl_code          
WHERE     (a.Vtyp = 80) AND (a.Vdt >= @proc_from_date+' 00:00:00') AND (a.Vdt <= @proc_to_date+' 23:23:59')          
GROUP BY b.branch_cd          
          
select reco=isnull((sum(reco)*20)/100,0),branch_cd into #b2 from  @Table3 group by branch_cd          
          
select * into #b3          
from #b           
union all          
select * from #b1          
union all          
select * from #b2          
          
select tran_per_day=sum(payin)/@now,branch_cd into #b4 from #b3 group by branch_cd          
          
SELECT     COUNT(emp_code) AS staff_cnt, branch_cd          
INTO            [#staff_cnt2]          
FROM         mis.remisior.dbo.tbl_benchmark_io          
WHERE     (todate > GETDATE()) AND (department = 'Banking')          
GROUP BY branch_cd          
          
insert into tbl_benchmark_cal   
SELECT     convert(varchar(11),getdate(),103),@proc_from_date,@proc_to_date,'Banking' AS department, a.branch_cd, CONVERT(decimal(15, 2), a.tran_per_day) / 196.27 AS FTE_BANKING, ISNULL(CONVERT(decimal(15, 2),           
                      a.tran_per_day) / b.staff_cnt, 0) AS actual_banking          
FROM         [#b4] AS a FULL OUTER JOIN          
                      [#staff_cnt2] AS b ON a.branch_cd = b.branch_cd          
GROUP BY a.branch_cd, a.tran_per_day, b.staff_cnt           
          
          
          
/*FOR D. P. Calculation          
Count dis punch */          
SELECT DISTINCT b.cm_blsavingcd          
INTO            [#dp_t]          
FROM         dpbackoffice.acercross.dbo.trxdetail AS a INNER JOIN          
                      dpbackoffice.acercross.dbo.client_master AS b ON a.td_ac_code = b.cm_cd          
WHERE     (a.td_ac_code LIKE '12%') AND (a.td_curdate >= CONVERT(VARCHAR(8), convert(datetime,@proc_from_date), 112)) AND (a.td_curdate <= CONVERT(VARCHAR(8), convert(datetime,@proc_to_date), 112)) AND (a.td_internal_refno <> '00000') AND           
(a.td_narration = '044') AND (b.cm_blsavingcd <> '')          
          
          
SELECT     COUNT(*) AS dis_cnt, branch_cd          
INTO            [#dp6]          
FROM         [#dp_t] AS a INNER JOIN          
                     risk.dbo.client_details AS b ON a.cm_blsavingcd = b.cl_code          
GROUP BY branch_cd          
          
          
/*count DRF forms*/          
SELECT     COUNT(*) AS drf_cnt, branch_cd          
INTO            [#dp1]          
FROM         MIS.demat.dbo.tbl_drf_inward_register AS a INNER JOIN          
                       risk.dbo.client_details AS b ON a.Maker_accesscode = b.branch_cd          
WHERE     (a.Maker_Datetime >= @proc_from_date+' 00:00:00') AND (a.Maker_Datetime <= @proc_to_date+' 23:23:59')          
GROUP BY a.Maker_accesscode, branch_cd          
          
          
/*count Payout Marking*/          
SELECT     COUNT(*) AS POM_cnt, branch_cd          
INTO            [#dp2]          
FROM         MIS.demat.dbo.Hist_tbl_Client_Wise_marking AS a INNER JOIN          
                       risk.dbo.client_details AS b ON a.Party_Code = b.party_code          
WHERE     (a.Fld_Date >= @proc_from_date+' 00:00:00') AND (a.Fld_Date <= @proc_to_date+' 23:23:59')          
GROUP BY branch_cd          
          
          
/*count Auction Bill           
 NSE */          
SELECT     COUNT(*) AS AucBillNSe_cnt, branch_cd          
INTO            [#d]          
FROM         anand1.msajag.dbo.history AS a INNER JOIN          
                       risk.dbo.client_details AS b ON a.Party_Code = b.party_code          
WHERE     (a.Sauda_date >= @proc_from_date+' 00:00:00') AND (a.Sauda_date <= @proc_to_date+' 23:23:59')          
GROUP BY branch_cd          
          
/*BSE*/          
SELECT     COUNT(*) AS AucBillBSE_cnt, branch_cd          
INTO            [#d1]          
FROM         anand.bsedb_ab.dbo.history AS a INNER JOIN          
                       risk.dbo.client_details AS b ON a.Party_Code = b.party_code          
WHERE     (a.Sauda_date >= @proc_from_date+' 00:00:00') AND (a.Sauda_date <= @proc_to_date+' 23:23:59')          
GROUP BY branch_cd          
          
          
select * into #d2          
from #d          
union all          
select * from #d1          
          
select AucBill_cnt=count(AucBillNSE_cnt),branch_cd into #dp5 from #d2 group by branch_cd          
          
/*Count Payin Shortage          
BSE & NSE*/        
          
SELECT     COUNT(a.party_code) AS payin_bse, branch_cd          
INTO            [#dp3]          
FROM         risk.dbo.tbl_benchmark_cnt_payin AS a INNER JOIN          
                       risk.dbo.client_details AS b ON a.party_code = b.party_code          
WHERE     (segment IN ('BSE', 'NSE')) AND (upd_date >= @proc_from_date+' 00:00:00') AND (upd_date <= @proc_to_date+' 23:23:59')          
GROUP BY branch_cd          
          
        
select * into #dp          
from #dp1           
union all          
select * from #dp5          
union all          
select * from #dp2          
union all          
select * from #dp3          
union all          
select * from #dp6          
          
SELECT     SUM(drf_cnt) / @now AS tran_per_day, branch_cd          
INTO            [#dp4]          
FROM         [#dp]          
GROUP BY branch_cd          
          
SELECT     COUNT(emp_code) AS staff_cnt, branch_cd          
INTO            [#staff_cnt3]          
FROM         MIS.remisior.dbo.tbl_benchmark_io          
WHERE     (todate > GETDATE()) AND (department = 'D.P.')          
GROUP BY branch_cd          
          
insert into tbl_benchmark_cal        
SELECT     convert(varchar(11),getdate(),103),@proc_from_date,@proc_to_date,'D.P.' AS department, a.branch_cd, CONVERT(decimal(15, 2), a.tran_per_day) / 86.6 AS FTE_DP, ISNULL(CONVERT(decimal(15, 2), a.tran_per_day)           
                      / b.staff_cnt, 0) AS actual_DP          
FROM         [#dp4] AS a FULL OUTER JOIN          
                      [#staff_cnt3] AS b ON a.branch_cd = b.branch_cd          
GROUP BY a.branch_cd, a.tran_per_day, b.staff_cnt

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_BM_payin_cnt_BSE
-- --------------------------------------------------
CREATE procedure usp_BM_payin_cnt_BSE       
as      
/* declare @StatusId   VARCHAR(15)        
     declare @Statusname VARCHAR(25)        
     declare @Sett_No VARCHAR(7)         
     declare @Sett_Type  VARCHAR(2)         
     declare @BranchCd   VARCHAR(10)         
     declare @ClType  VARCHAR(10)          
     declare @Opt  INT        
        
  set @StatusId = 'broker'        
     set @Statusname = 'broker'        
     set @Sett_No = '2009186'        
     set @Sett_Type ='C'        
     set @BranchCd  ='ALL'        
     set @ClType ='%%'        
     set @Opt = 2        
 */      
      
 select distinct sett_no,sett_type,sec_payin      
 into #sett_type   --drop table #sett_type    
from risk.dbo.bse_sett_mst        
 where sett_type in('C','D') and SEC_PAYIN >= CONVERT(VARCHAR(11),GETDATE())+' 00:00:00'         
AND START_DATE <= CONVERT(VARCHAR(11),GETDATE())+' 00:00:00'        
 --Drop table #sett_type      


      
  SELECT *       
  INTO   #DELIVERYCLT       
  FROM   angeldemat.bsedb.dbo.DELIVERYCLT       
  WHERE  SETT_NO in(select distinct sett_no from #sett_type)          
 AND SETT_TYPE in(select distinct SETT_TYPE from #sett_type)       
   AND INOUT = 'I'       
             
  SELECT *       
  INTO   #DELTRANS       
  FROM   angeldemat.bsedb.dbo.DELTRANS        
  WHERE  SETT_NO in(select distinct sett_no from #sett_type)          
 AND SETT_TYPE in(select distinct SETT_TYPE from #sett_type)       
   AND PARTY_CODE <> 'BROKER'       
   AND DRCR = 'C'       
   AND FILLER2 = 1       
   AND SHARETYPE <> 'Auction'       
   AND TRTYPE <> 906       
         
      
  SELECT   D.SETT_NO,       
     D.SETT_TYPE,       
     D.PARTY_CODE,       
     CERTNO = ISIN,       
     DELQTY = D.QTY,       
     RECQTY = SUM(ISNULL(C.QTY,0)),       
     ISETTQTYPRINT = 0,       
     IBENQTYPRINT = 0,       
     ISETTQTYMARK = 0,       
     IBENQTYMARK = 0,         
  SCRIP_CD = CONVERT(VARCHAR(50),'')         
  INTO  #DELPAYINMATCH       
  FROM        
     angeldemat.bsedb.dbo.MULTIISIN M (nolock),       
     #DELIVERYCLT D (nolock)       
     LEFT OUTER JOIN #DELTRANS C (nolock)       
    ON (D.SETT_NO = C.SETT_NO       
     AND D.SETT_TYPE = C.SETT_TYPE       
     AND D.SCRIP_CD = C.SCRIP_CD       
     AND D.SERIES = C.SERIES       
     AND D.PARTY_CODE = C.PARTY_CODE       
     AND DRCR = 'C'       
     AND FILLER2 = 1       
     AND SHARETYPE <> 'Auction')       
  WHERE INOUT = 'I'       
     AND M.SCRIP_CD = D.SCRIP_CD       
     AND M.SERIES = D.SERIES       
     AND VALID = 1       
     and d.SETT_NO in(select distinct sett_no from #sett_type)          
AND d.SETT_TYPE in(select distinct SETT_TYPE from #sett_type)         
  GROUP BY D.SETT_NO,D.SETT_TYPE,D.PARTY_CODE,D.QTY,ISIN          
  HAVING   D.QTY > 0       
      
 DELETE FROM #DELPAYINMATCH WHERE DELQTY <= RECQTY       
      
  INSERT INTO #DELPAYINMATCH       
  SELECT   ISETT_NO,       
     ISETT_TYPE,       
     D.PARTY_CODE,       
     CERTNO,       
     QTY = 0,       
     RECQTY = 0,       
     ISETTQTYPRINT = SUM(CASE        
         WHEN DELIVERED = 'G'       
           AND TRTYPE <> 1000 THEN QTY       
         ELSE 0       
          END),       
     IBENQTYPRINT = SUM(CASE        
        WHEN DELIVERED = 'G'       
          AND TRTYPE = 1000 THEN QTY       
        ELSE 0       
         END),       
     ISETTQTYMARK = SUM(CASE        
        WHEN DELIVERED = '0'       
          AND TRTYPE <> 1000 THEN QTY       
        ELSE 0       
         END),       
     IBENQTYMARK = SUM(CASE        
          WHEN DELIVERED = '0'       
         AND TRTYPE = 1000 THEN QTY       
          ELSE 0       
      END)   ,      
 SCRIP_CD = CONVERT(VARCHAR(50),'')      
  FROM  angeldemat.MSAJAG.DBO.DELTRANS D        
  WHERE FILLER2 = 1       
     AND DRCR = 'D'       
     AND DELIVERED <> 'D'       
     AND TRTYPE IN (907,908,1000)       
     AND iSETT_NO in(select distinct sett_no from #sett_type)          
   AND iSETT_TYPE in(select distinct SETT_TYPE from #sett_type)       
  GROUP BY ISETT_NO,ISETT_TYPE,D.PARTY_CODE,CERTNO       
      
      
  INSERT INTO #DELPAYINMATCH       
  SELECT   ISETT_NO,       
     ISETT_TYPE,       
     D.PARTY_CODE,       
     CERTNO,       
     QTY = 0,       
     RECQTY = 0,       
     ISETTQTYPRINT = SUM(CASE        
         WHEN DELIVERED = 'G'       
           AND TRTYPE <> 1000 THEN QTY       
         ELSE 0       
          END),       
  IBENQTYPRINT = SUM(CASE        
        WHEN DELIVERED = 'G'       
          AND TRTYPE = 1000 THEN QTY       
        ELSE 0       
         END),       
     ISETTQTYMARK = SUM(CASE        
        WHEN DELIVERED = '0'       
          AND TRTYPE <> 1000 THEN QTY       
        ELSE 0       
  END),       
     IBENQTYMARK = SUM(CASE        
          WHEN DELIVERED = '0'       
         AND TRTYPE = 1000 THEN QTY       
          ELSE 0       
        END) ,      
      
 SCRIP_CD = CONVERT(VARCHAR(50),'')      
  FROM  angeldemat.bsedb.dbo.DELTRANS D (nolock)        
  WHERE FILLER2 = 1       
     AND DRCR = 'D'       
     AND DELIVERED <> 'D'       
     AND TRTYPE IN (907,908,1000)       
     AND iSETT_NO in(select distinct sett_no from #sett_type)          
   AND iSETT_TYPE in(select distinct SETT_TYPE from #sett_type)        
   GROUP BY ISETT_NO,ISETT_TYPE,D.PARTY_CODE,CERTNO       
      
      
  UPDATE #DELPAYINMATCH          
  SET    SCRIP_CD = S2.SCRIP_CD + ' ( ' + M.SCRIP_CD + ' )'          
  FROM   angeldemat.bsedb.dbo.SCRIP2 S2,          
         angeldemat.bsedb.dbo.MULTIISIN M          
  WHERE  S2.BSECODE = M.SCRIP_CD          
         AND M.ISIN = CERTNO          
      
      
  SELECT   seg='BSE',SETT_NO,         
      SETT_TYPE,         
      R.PARTY_CODE,         
      DELQTY = SUM(DELQTY),         
      RECQTY = SUM(RECQTY),          
      ISETTQTYPRINT = SUM(ISETTQTYPRINT),         
      ISETTQTYMARK = SUM(ISETTQTYMARK),         
      IBENQTYPRINT = SUM(IBENQTYPRINT),         
      IBENQTYMARK = SUM(IBENQTYMARK)        
into #t      
   FROM  #DELPAYINMATCH R (nolock)       
   WHERE SETT_NO in(select distinct sett_no from #sett_type)          
   AND  SETT_TYPE in(select distinct SETT_TYPE from #sett_type)      
   GROUP BY SETT_NO,SETT_TYPE,R.PARTY_CODE ,SCRIP_CD          
            
   HAVING   SUM(DELQTY) > (SUM(RECQTY) + SUM(ISETTQTYPRINT) + SUM(IBENQTYPRINT))       
   ORDER BY       
      R.PARTY_CODE ,SCRIP_CD      
          
      
declare @t as datetime      
select @t=sec_payin from #sett_type      
--print @t      
      
 insert into risk.dbo.tbl_benchmark_cnt_payin      
select @t,seg,SETT_NO,SETT_TYPE,PARTY_CODE,DELQTY,RECQTY       
 from #t

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_BM_payin_cnt_NSE
-- --------------------------------------------------
CREATE procedure usp_BM_payin_cnt_NSE       
as       
    /* declare @StatusId   VARCHAR(15)              
           declare @Statusname VARCHAR(25)              
           declare @Sett_No    VARCHAR(7)                  
           declare @Sett_Type  VARCHAR(2)                  
           declare @BranchCd   VARCHAR(10)                  
           declare @ClType     VARCHAR(10)                   
           declare @Opt        INT              
              
     set @StatusId = 'broker'              
           set @Statusname = 'broker'              
           set @Sett_No = '2009243'              
           set @Sett_Type ='W'              
           set @BranchCd  ='ALL'              
           set @ClType ='%%'              
           set @Opt = 2              
*/      
       
  select distinct sett_no,sett_type,sec_payin      
 into #sett_type       
from risk.dbo.sett_mst        
 where sett_type in('N','W') and SEC_PAYIN >= CONVERT(VARCHAR(11),GETDATE())+' 00:00:00'         
AND START_DATE <= CONVERT(VARCHAR(11),GETDATE())+' 00:00:00'       --Drop table #sett_type      
         
  SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED             
            
  SELECT * INTO #DELCLT FROM angeldemat.msajag.dbo.DELIVERYCLT             
  WHERE SETT_NO in(select distinct sett_no from #sett_type)             
  AND SETT_TYPE in(select distinct SETT_TYPE from #sett_type)         
  AND INOUT = 'I'            
            
  SELECT * INTO #DEL_TRANS FROM angeldemat.msajag.dbo.DELTRANS        
  WHERE SETT_NO in(select distinct sett_no from #sett_type)             
  AND SETT_TYPE in(select distinct SETT_TYPE from #sett_type)            
  AND DRCR = 'C' AND TRTYPE <> 906 AND FILLER2 = 1            
      
--select * from #DELPAYINMATCH       
   SELECT  D.SETT_NO,                  
           D.SETT_TYPE,                  
           D.PARTY_CODE,        
     CERTNO = ISIN,                  
           DELQTY = D.QTY,                  
           RECQTY = SUM(ISNULL(C.QTY,0)),                   
           ISETTQTYPRINT = 0,                  
           IBENQTYPRINT = 0,                  
           ISETTQTYMARK = 0,                  
           IBENQTYMARK = 0                  
 INTO     #DELPAYINMATCH    --drop table #DELPAYINMATCH              
  FROM    angeldemat.msajag.dbo.MULTIISIN M (nolock),      
          #DELCLT D (nolock)         
           LEFT OUTER JOIN #DEL_TRANS C (nolock)                  
             ON (D.SETT_NO = C.SETT_NO                  
                 AND D.SETT_TYPE = C.SETT_TYPE                  
                 AND D.SCRIP_CD = C.SCRIP_CD                  
                 AND D.SERIES = C.SERIES                  
                 AND D.PARTY_CODE = C.PARTY_CODE                  
                 AND DRCR = 'C'                  
                 AND FILLER2 = 1                  
                 AND SHARETYPE <> 'Auction')                  
  WHERE    INOUT = 'I'                  
           AND M.SCRIP_CD = D.SCRIP_CD                  
           AND M.SERIES = D.SERIES                  
           AND VALID = 1   and d.SETT_NO in(select distinct sett_no from #sett_type)             
     AND d.SETT_TYPE in(select distinct SETT_TYPE from #sett_type)                        
  GROUP BY D.SETT_NO,D.SETT_TYPE,D.PARTY_CODE,D.QTY,ISIN                   
  HAVING   D.QTY > 0         
      
DELETE FROM #DELPAYINMATCH WHERE DELQTY <= RECQTY                  
                
SET TRANSACTION ISOLATION  LEVEL  READ  UNCOMMITTED                  
            
  INSERT INTO #DELPAYINMATCH                  
  SELECT         
     ISETT_NO,                  
           ISETT_TYPE,                  
           D.PARTY_CODE,                  
           CERTNO,                         
           QTY = 0,                  
           RECQTY = 0,                   
           ISETTQTYPRINT = SUM(CASE                   
                                 WHEN DELIVERED = 'G'                  
                                      AND TRTYPE <> 1000 THEN QTY                  
                                 ELSE 0                  
                               END),                  
           IBENQTYPRINT = SUM(CASE                   
                                WHEN DELIVERED = 'G'                  
AND TRTYPE = 1000 THEN QTY                  
                                ELSE 0                  
                              END),                  
           ISETTQTYMARK = SUM(CASE                 
                                WHEN DELIVERED = '0'                  
                                     AND TRTYPE <> 1000 THEN QTY                  
                                ELSE 0                  
                              END),                  
  IBENQTYMARK = SUM(CASE                   
                               WHEN DELIVERED = '0'                  
                                    AND TRTYPE = 1000 THEN QTY                  
                               ELSE 0                  
                             END)                   
  FROM     angeldemat.MSAJAG.DBO.DELTRANS D                
  WHERE    FILLER2 = 1                  
           AND DRCR = 'D'                  
           AND DELIVERED <> 'D'                  
           AND TRTYPE IN (907,908,1000)                  
           AND    iSETT_NO in(select distinct sett_no from #sett_type)             
  AND iSETT_TYPE in(select distinct SETT_TYPE from #sett_type)               
  GROUP BY ISETT_NO,ISETT_TYPE,D.PARTY_CODE,CERTNO                 
                                  
  SET TRANSACTION ISOLATION  LEVEL  READ  UNCOMMITTED                  
                    
  INSERT INTO #DELPAYINMATCH                  
  SELECT         
     ISETT_NO,                  
           ISETT_TYPE,                  
           D.PARTY_CODE,              
          CERTNO,            
           QTY = 0,                  
           RECQTY = 0,                  
           ISETTQTYPRINT = SUM(CASE                   
                                 WHEN DELIVERED = 'G'                  
                                      AND TRTYPE <> 1000 THEN QTY                  
                                 ELSE 0                  
                               END),                  
           IBENQTYPRINT = SUM(CASE                   
                                WHEN DELIVERED = 'G'                  
                                     AND TRTYPE = 1000 THEN QTY                  
                                ELSE 0                  
                              END),                  
           ISETTQTYMARK = SUM(CASE                   
                                WHEN DELIVERED = '0'                  
                                     AND TRTYPE <> 1000 THEN QTY                  
                                ELSE 0                  
                              END),                  
           IBENQTYMARK = SUM(CASE                   
                               WHEN DELIVERED = '0'                  
                                    AND TRTYPE = 1000 THEN QTY                  
                               ELSE 0                  
                             END)                
                          
  FROM     angeldemat.BSEDB.DBO.DELTRANS D       
  WHERE    FILLER2 = 1                  
           AND DRCR = 'D'                  
           AND DELIVERED <> 'D'                  
           AND TRTYPE IN (907,908,1000)                  
           AND iSETT_NO in(select distinct sett_no from #sett_type)             
  AND iSETT_TYPE in(select distinct SETT_TYPE from #sett_type)                
  GROUP BY ISETT_NO,ISETT_TYPE,D.PARTY_CODE,CERTNO       
                        
  SET TRANSACTION ISOLATION  LEVEL  READ  UNCOMMITTED                  
       
      SET TRANSACTION ISOLATION  LEVEL  READ  UNCOMMITTED                  
                        
      SELECT   seg='NSE',      
      SETT_NO,                  
               SETT_TYPE,                  
               R.PARTY_CODE,                  
               DELQTY = SUM(DELQTY),                  
               RECQTY = SUM(RECQTY),                   
               ISETTQTYPRINT = SUM(ISETTQTYPRINT),                  
               ISETTQTYMARK = SUM(ISETTQTYMARK),                  
               IBENQTYPRINT = SUM(IBENQTYPRINT),                  
               IBENQTYMARK = SUM(IBENQTYMARK)        
   into #t                  
      FROM     #DELPAYINMATCH R (nolock),          
               angeldemat.msajag.dbo.MULTIISIN M (nolock)      
              
      WHERE      M.ISIN = R.CERTNO  and      
    SETT_NO in(select distinct sett_no from #sett_type)             
      AND  SETT_TYPE in(select distinct SETT_TYPE from #sett_type)       
      GROUP BY SETT_NO,SETT_TYPE,R.PARTY_CODE,                 
M.SCRIP_CD                  
      HAVING   SUM(DELQTY) > (SUM(RECQTY) + SUM(ISETTQTYPRINT) + SUM(IBENQTYPRINT))                  
      ORDER BY                
               R.PARTY_CODE,                  
               M.SCRIP_CD                  
         
declare @t as datetime      
select @t=sec_payin from #sett_type      
--print @t      
      
insert into risk.dbo.tbl_benchmark_cnt_payin      
select @t,seg,SETT_NO,SETT_TYPE,PARTY_CODE,DELQTY,RECQTY       
 from #t

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_CKYC
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj B Patil
-- Create date: 25-11-2016
-- Description:	CKYC
/*
USP_CKYC 'REPORT'
*/
-- =============================================
CREATE PROCEDURE [dbo].[USP_CKYC]
	@process as varchar(200),
	@data1 as varchar(max)='',
	@data2 as varchar(max)='',
	@data3 as varchar(max)='',
	@data4 as varchar(max)='',
	@data5 as varchar(max)='',
	@data6 as varchar(max)='',
	@data7 as varchar(max)='',
	@data8 as varchar(max)='',
	@data9 as varchar(max)='',
	@data10 as varchar(max)=''
	
	
	
AS
BEGIN
		if @process = 'GETRECORDS'
		begin
			select  * into #temp1 from [MIS].kyc_ci.dbo.Vi_GetKYCdataForCkycStatus
			where accountactivationdate >'Dec 05 2016 23:59:59:000'
			and accountactivationdate <GETDATE()
			/*and segment ='equity'*/ 
			and typeofsign <> 'ekyc'
			and isholder ='no'------6249-57(2nd holder)
			and kra_verified ='n'
			--and Pan_gir_no <> 'BBTPA9302E'
			order by accountactivationdate desc----4235
			
			
			truncate table tbl_Ckyc_sign
			insert into tbl_Ckyc_sign
			--select top (select TopVal From TempCKYCVal) Party_Code  from #temp1
			select Party_Code  from #temp1
			
			create table #temp2
			(
			PARTYCODE varchar(50),ACCD_BINARY_IMAGE varbinary(max)
			)
			
			--drop table #temp2
			insert into #temp2
			exec [AngelDP4].dmat.citrus_usr.ckyc_sig

			
			select Party_Code,Pan_Gir_no,Application_No,Segment,Kra_Verified,AadharCompliance,TypeofSign,
			AccountActivationDate,CKYCStatus,IsHolder,ACCD_BINARY_IMAGE
			into #Temp3 
			 from #temp1,#temp2
			 where Party_Code = PARTYCODE
			 and Pan_Gir_no not in(select CLSPAN from tbl_CKYC_Log)
			 
			select  t1.*,isnull(t2.POA,'POA') as POA from 
			#Temp3 t1
			INNER JOIN  
			(select distinct a.party_code,a.pan_gir_no,a.application_no,
				CASE b.document_proof_name
				  WHEN 'AADHAAR CARD' THEN 'AadharCard'
				  WHEN 'DRIVING LICENSE' THEN 'DrivingLicense'
				  WHEN 'ELECTRICITY BILL' THEN 'Utilitybill2M'
				  WHEN 'WATER BILL' THEN 'Utilitybill2M'
				  WHEN 'LATEST BANK ACCOUNT STATEMENT' THEN 'BankStatement'
				  WHEN 'LATEST BANK PASSBOOK' THEN 'OthersCKYCDocInd'
				  WHEN 'PASSPORT' THEN 'Passport'
				  WHEN 'TELEPHONE BILL' THEN 'Utilitybill2M'
				  WHEN 'VOTER ID' THEN 'VoterID'
				  ElSE 'OthersCKYCDocInd'
				END POA
				from 
				[MIS].KYC_CI.dbo.Vi_GetKYCdataForCkycStatus a, 
				[MIS].KYC_CI.dbo.Vi_GetDoucmentDetails_Ckyc b
				where a.accountactivationdate >'jul 31 2016 23:59:59:000'
				/*and a.segment ='equity'*/ 
				and 
				typeofsign <> 'ekyc'
				and a.isholder ='no'------6249-57(2nd holder)
				and a.kra_verified ='n'
				and a.application_no=b.appno
				and b.document_type ='CKYC_CADD' and b.imagepath is not null 				
				)t2 on t1.Party_Code=t2.Party_Code
				/*where t1.Pan_Gir_no='CTJPS9372R'*/
				
								 
				--order by a.party_code,a.pan_gir_no,a.application_no
			
			drop table #Temp1
			drop table #Temp2
			drop table #Temp3
			
		end
		if @process = 'LOG'
		begin
			IF(@data2='1' AND @data3='1' AND @data4='1' AND @data5='1')
			BEGIN
			print 'hi'
				insert into tbl_CKYC_Log values(@data1,@data2,@data3,@data4,@data5,'1',GETDATE())
			END
			ELSE
			BEGIN
			print 'bye'
				insert into tbl_CKYC_Log values(@data1,@data2,@data3,@data4,@data5,'0',GETDATE())
			END
		end
		IF @process='REPORT'
		begin
			WITH CTE AS(
			   SELECT [CLSPAN], [Status_PHOTO] , [Status_Sign] , [Status_POI] , [Status_POA] , [Status_Folder] ,
				   RN = ROW_NUMBER()OVER(PARTITION BY [CLSPAN] ORDER BY SRNO)
			   FROM dbo.tbl_CKYC_Log  
			)
			delete FROM CTE WHERE RN > 1
			
			SELECT ROW_NUMBER()over(order by UPDATEDATE) SRNO, CLSPAN,(CASE WHEN STATUS_PHOTO =1 THEN 'Y' ELSE 'N' END)[PHOTO STATUS] , 
			(CASE WHEN STATUS_SIGN =1 THEN 'Y' ELSE 'N' END)[SIGN STATUS],
			(CASE WHEN STATUS_POI =1 THEN 'Y' ELSE 'N' END)[POI STATUS] ,
			(CASE WHEN STATUS_POA =1 THEN 'Y' ELSE 'N' END)[POA STATUS],
			(CASE WHEN STATUS_FOLDER =1 THEN 'Y' ELSE 'N' END)[FOLDER STATUS],
			UPDATEDATE as [UPDATED DATE] 
			FROM TBL_CKYC_LOG 
			
		end			
		
END



 
 
 
 
 --select COUNT(*) from tbl_CKYC_Log --where clspan='CGIPS4482G' order by UpdateDate
 
 --truncate table tbl_CKYC_Log

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_CKYCErrorLog
-- --------------------------------------------------
    
CREATE Procedure [dbo].[usp_CKYCErrorLog]      
@FunctionName varchar(100)='',      
@ErrDesc varchar(max)=''      
As      
Begin      
insert into tbl_CKYCErrLog      
values      
(@FunctionName,@ErrDesc,'System',Getdate())      
    
  /*   
/* Email Sending Part */    
DECLARE @MESS varchar(max)=''    
    
SET @MESS ='Dear Rohit,<br />'+    
     'There is an error occurred in <b> Hash Tag </b> Process, Please check the following details <br />'+    
     '<b>TAG NAME :</b> '+@FunctionName + '<br/>'+    
     '<b> Error Occurred On : </b>'+convert(varchar(20), GetDate()) + '<br/>'+    
     '<b> Error Discription : </b>'+ @ErrDesc     
         
     DECLARE @TO varchar(100)                                           
      --SET @file ='\\196.1.115.136\global_upload\HashTag\'+@Param+'.pdf'    
      SET @TO = 'rohit.patil@angelbroking.com'                                       
                                            
      EXEC MSDB.DBO.SP_SEND_DBMAIL                                          
      @RECIPIENTS = @TO,                                          
      @COPY_RECIPIENTS = '',                                          
      --@BLIND_COPY_RECIPIENTS = @BCC,                            
      @PROFILE_NAME = 'Angelbroking',                                          
      @BODY_FORMAT ='HTML',                                          
      @SUBJECT = 'Hash Tag Error Popup!!' ,    
      @file_attachments   = '',                                           
      @BODY =@MESS    
      */     
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_cms_PoValue
-- --------------------------------------------------
CREATE proc usp_cms_PoValue(@segment as varchar(10))        
as        
        
if @segment='NSECM'        
BEGIN        
 --------------------- NSE Ledger Balance   T-2 Balance                                                      
 select cltcode,ACDL_Balancea=sum(case when upper(drcr)='D' then vamt else -vamt end)                                                                    
 into #nse_led_a                                                                  
 from risk.dbo.nse_ledger where edt <= convert(varchar(11),getdate())+' 23:59:59'         
 and vdt >= (select convert(varchar(11),min(vdt)) from abl_ledger (nolock))                                                                    
 and cltcode >='A0001' and cltcode <='ZZZZZ'                                                                    
 group by cltcode                                                                     
 --------------------- NSe Ledger Balance 2   Current Balance                                                               
 select cltcode,ACDL_Balanceb=sum(case when upper(drcr)='D' then vamt else -vamt end)                                                                    
 into #nse_led_b                                                                    
 from risk.dbo.nse_ledger         
 where vdt <= convert(varchar(11),getdate())+' 23:59:59' and vdt >=(select convert(varchar(11),min(vdt)) from abl_ledger (nolock))                      
 and cltcode >='A0001' and cltcode <='ZZZZZZ'                                                                    
 group by cltcode                                                                     
       
 select cltcode,cr_amt=sum(vamt) into #nse_cramt from nse_ledger (nolock)        
 where vdt <=convert(varchar(11),getdate())+' 23:59:59'  and  edt >= convert(varchar(11),getdate())+' 23:59:59'  and drcr='C'                                                      
 group by cltcode                                                      
                                               
 update #nse_led_b set acdl_balanceb = acdl_balanceb + cr_Amt from #nse_cramt b where #nse_led_b.cltcode=b.cltcode                                                      
                                               
 --------------------- unreco value deduction        
 update #nse_led_b set acdl_balanceb = acdl_balanceb-b.ACDL_Balancec                                                        
 from (select cltcode,ACDL_Balancec=sum(cramt)*-1 from NSECM_reco (nolock) group by cltcode) b       
 where #nse_led_b.cltcode=b.cltcode                                                      
                                                      
 --------------------- NSE NBFC Balance                
 select a.*,b.ACDL_Balanceb from  #nse_led_a a left outer join #nse_led_b b on a.cltcode=b.cltcode --where a.acdl_balancea <> 0                                                                    
      
END        
      
      
if @segment='BSECM'        
BEGIN        
 --------------------- Ledger Balance   T-2 Balance                                                      
 select cltcode,ABL_Balancea=sum(case when upper(drcr)='D' then vamt else -vamt end)                                                                    
 into #led_a                                                                  
 from risk.dbo.abl_ledger where edt <= convert(varchar(11),getdate())+' 23:59:59'         
 and vdt >= (select convert(varchar(11),min(vdt)) from abl_ledger (nolock))                                                                    
 and cltcode >='A0001' and cltcode <='ZZZZZ'                                                                    
 group by cltcode                                                                     
 --------------------- Ledger Balance 2   Current Balance         
 select cltcode,abl_Balanceb=sum(case when upper(drcr)='D' then vamt else -vamt end)                                                                    
 into #led_b                                            
 from risk.dbo.abl_ledger         
 where vdt <= convert(varchar(11),getdate())+' 23:59:59' and vdt >=(select convert(varchar(11),min(vdt)) from abl_ledger (nolock))                      
 and cltcode >='A0001' and cltcode <='ZZZZZZ'                                                                    
 group by cltcode                                                                     
       
 select cltcode,cr_amt=sum(vamt) into #cramt from risk.dbo.abl_ledger (nolock)        
 where vdt <=convert(varchar(11),getdate())+' 23:59:59'  and  edt >= convert(varchar(11),getdate())+' 23:59:59'  and drcr='C'                                                      
 group by cltcode                                                      
                                               
 update #led_b set abl_balanceb = abl_balanceb + cr_Amt from #cramt b where #led_b.cltcode=b.cltcode                                                      
                                               
 --------------------- unreco value deduction        
 update #led_b set aBl_balanceb = aBl_balanceb-b.ABL_Balancec                                                        
 from (select cltcode,ABL_Balancec=sum(cramt)*-1 from BSECM_reco (nolock) group by cltcode) b       
 where #led_b.cltcode=b.cltcode                                                      
       
 ---------- Deduct surplus amount of the Active Angel Gold client. as instructed by Prakash Gagdani.                                       
 update #led_b set abl_balanceb=abl_balanceb+b.surplus from                                   
 (select party_code,surplus=limit+open_position from middleware.mimansa.dbo.tbl_pms_temp_summary_party                                    
 where eff_to >= getdate() and limit+open_position  > 0 and pms_code='LALIT') b                                   
 where #led_b.cltcode=b.party_Code                                  
       
 --------------------- Result       
 select a.*,b.ABL_Balanceb from  #led_a a left outer join #led_b b on a.cltcode=b.cltcode --where a.acdl_balancea <> 0                                                                    
      
END        
      
if @segment='NSEFO'        
BEGIN      
      
 declare @fodt as datetime,@fodt_1 as datetime                                       
 select top 2 * into #fodt from (select distinct sauda_date from fomarh (nolock) ) a order by sauda_date desc                                                                
 select @fodt=min(sauda_date) from #fodt                                                                
 select @fodt_1=max(sauda_date) from #fodt                                                
      
      
 select cltcode=clcode,fo_balancea=                                                          
 case                                                            
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  >0 then  (net-(cash_coll+non_Cash) )*-1                                                           
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  <0 then  0                                                          
 else  (case                                                          
 when (c*-1) >= ledgeramount and ledgeramount > 0 then ledgeramount*-1                                                         
 when (c*-1) >= ledgeramount and ledgeramount < 0 then ledgeramount*-1                                                           
 when (c*-1) < ledgeramount and ledgeramount > 0 then c                                                          
 when (c*-1) < ledgeramount and ledgeramount < 0 then ledgeramount*-1                                 
 else 0 end ) end                                                     
 into #fo_a                                                          
 from                                                          
 (select sbtag,subgroup,clcode,imargin,shortage,net,ledgeramount,cash_coll,non_cash,             
 c=(case when (imargin/2)-non_cash < 0 then 0 else (imargin/2)-non_cash end)+((imargin/2)-cash_coll-ledgeramount)                                                     
 from risk.dbo.fomarh (nolock) where sauda_date = @fodt_1                         
 ) a                                                          
                                                         
 select cltcode=clcode,fo_balanceb=                                                          
 case                                                          
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  >0 then  (net-(cash_coll+non_Cash) )*-1                                                           
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  <0 then  0                                                          
 else  (case                                                          
 when (c*-1) >= ledgeramount and ledgeramount > 0 then ledgeramount*-1                                                           
 when (c*-1) >= ledgeramount and ledgeramount < 0 then ledgeramount*-1                 
 when (c*-1) < ledgeramount and ledgeramount > 0 then c                                                          
 when (c*-1) < ledgeramount and ledgeramount < 0 then  ledgeramount*-1                                                           
 else 0 end ) end into #fo_b                                                          
 from                                                          
 (select sbtag,subgroup,clcode,imargin,shortage,net,ledgeramount,cash_coll,non_cash,                                                          
 c=(case when (imargin/2)-non_cash < 0 then 0 else (imargin/2)-non_cash end)+((imargin/2)-cash_coll-ledgeramount)                                                     
 from risk.dbo.fomarh (nolock) where sauda_date = (select  max(sauda_date) from fomarh (nolock) )                                                                
 ) a                                                          
                                                
 --------------------- FO Cash deposit entry                                                    
 update #fo_b set fo_balanceb = fo_balanceb-b.fo_Balancec                                                
 from (select cltcode,FO_Balancec=sum(cramt)*-1 from NSEFO_reco (nolock) group by cltcode) b where #fo_b.cltcode=b.cltcode                                                    
                                                
 -----------------------------------------------------------------------------------                                                
                                                             
 select a.*,b.fo_Balanceb into #focal from #fo_a a left outer join #fo_b b on a.cltcode=b.cltcode where fo_balancea <> 0                                                                  
                                                     
 declare @mrgdate as datetime                                                        
 select @mrgdate=max(margindate) from angelfo.nsefo.dbo.tbl_clientmargin                                                         
      
 select party_code into #fo_block from angelfo.nsefo.dbo.tbl_clientmargin                                                         
 where margindate = @mrgdate                                                             
 and cash_coll+noncash_coll > 0 and initialmargin > 0 and  (ledgeramount+cash_coll) < initialmargin/2                                                   
                                                            
 update #focal set fo_balancea=0 where cltcode in (select party_code from #fo_block)                                                            
                                                            
 select * from #focal      
END      
      
if @segment='NCDEX'        
BEGIN      
      
 declare @ncdx_dt as datetime                                                            
 select @ncdx_dt=max(sauda_date) from ncdx_marh (nolock)                        
                                                          
 select cltcode=clcode,fo_balancea=                                                              
 case                                                            
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  >0 then  (net-(cash_coll+non_Cash) )*-1                                                           
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  <0 then  0                                                          
 else  (case               
 when (c*-1) >= ledgeramount and ledgeramount > 0 then ledgeramount*-1                                                     
 when (c*-1) >= ledgeramount and ledgeramount < 0 then ledgeramount*-1                                                           
 when (c*-1) < ledgeramount and ledgeramount > 0 then c                                                          
 when (c*-1) < ledgeramount and ledgeramount < 0 then ledgeramount*-1                                           
 else 0 end ) end into #ncdx_a                                                          
 from                                                          
 (select sbtag,subgroup,clcode,imargin,shortage,net,ledgeramount,cash_coll,non_cash,                                                          
 c=(case when (imargin/2)-non_cash < 0 then 0 else (imargin/2)-non_cash end)+((imargin/2)-cash_coll-ledgeramount)                                                     
 from ncdx_marh (nolock) where sauda_date = @ncdx_dt                                                           
 ) a                                                          
                                                          
                                                          
 select cltcode=clcode,fo_balanceb=                                                          
 case                                                          
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  >0 then  (net-(cash_coll+non_Cash) )*-1                                                           
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  <0 then  0                                                          
 else  (case                                        
 when (c*-1) >= ledgeramount and ledgeramount > 0 then ledgeramount*-1                                                           
 when (c*-1) >= ledgeramount and ledgeramount < 0 then ledgeramount*-1                                                           
 when (c*-1) < ledgeramount and ledgeramount > 0 then c                                                          
 when (c*-1) < ledgeramount and ledgeramount < 0 then  ledgeramount*-1                                                           
 else 0 end ) end into #ncdx_b                                                          
 from                                                          
 (select sbtag,subgroup,clcode,imargin,shortage,net,ledgeramount,cash_coll,non_cash,                                                          
 c=(case when (imargin/2)-non_cash < 0 then 0 else (imargin/2)-non_cash end)+((imargin/2)-cash_coll-ledgeramount)                                                     
 from ncdx_marh (nolock) where sauda_date = (select  max(sauda_date) from ncdx_marh)                                                                
 ) a                                                          
                       
                                                    
 update #ncdx_b set fo_balanceb = fo_balanceb-b.fo_Balancec                                                
 from (select cltcode,FO_Balancec=sum(cramt)*-1 from NCDX_reco (nolock) group by cltcode) b       
 where #ncdx_b.cltcode=b.cltcode                                                    
                                                
 --------------------------------------------------------------------------------------                                                
 select a.*,b.fo_Balanceb into #ncdxcal from #ncdx_a a left outer join #ncdx_b b on a.cltcode=b.cltcode where fo_balancea <> 0                                                                  
                                                        
 declare @nmrgdate as datetime                                                        
 select @nmrgdate=max(margindate) from angelcommodity.ncdx.dbo.tbl_clientmargin                                                         
                                                        
 select party_code into #ncdx_block from angelcommodity.ncdx.dbo.tbl_clientmargin                                                         
 where margindate = @nmrgdate                                
 and cash_coll+noncash_coll > 0 and initialmargin > 0 and  (ledgeramount+cash_coll) < initialmargin/2                                   
                                                            
 update #ncdxcal set fo_balancea=0 where cltcode in (select party_code from #ncdx_block)                                                            
      
 select * from #ncdxcal      
      
END      
      
if @segment='MCX'        
BEGIN      
                                                          
 declare @mcdx_dt as datetime                                                                
 select @mcdx_dt=max(sauda_date) from mcdx_marh (nolock)                        
                                                        
                                                          
 select cltcode=clcode,fo_balancea=                                                              
 case                       
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  >0 then  (net-(cash_coll+non_Cash) )*-1                                                           
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  <0 then  0                                else  (case                                                          
 when (c*-1) >= ledgeramount and ledgeramount > 0 then ledgeramount*-1                                                           
 when (c*-1) >= ledgeramount and ledgeramount < 0 then ledgeramount*-1                                                           
 when (c*-1) < ledgeramount and ledgeramount > 0 then c                                                          
 when (c*-1) < ledgeramount and ledgeramount < 0 then ledgeramount*-1                                                           
 else 0 end ) end into #mcdx_a                             
 from                                                          
 (select sbtag,subgroup,clcode,imargin,shortage,net,ledgeramount,cash_coll,non_cash,                                                          
 c=(case when (imargin/2)-non_cash < 0 then 0 else (imargin/2)-non_cash end)+((imargin/2)-cash_coll-ledgeramount)                                                     
 from mcdx_marh (nolock) where sauda_date = @mcdx_dt                                                           
 ) a                                                          
                                                          
                                                          
 select cltcode=clcode,fo_balanceb=                                                          
 case                                                          
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  >0 then  (net-(cash_coll+non_Cash) )*-1                                                
 when shortage > 0 and  (net-(cash_coll+non_Cash) )*-1  <0 then  0                                                          
 else  (case                                               
 when (c*-1) >= ledgeramount and ledgeramount > 0 then ledgeramount*-1                                                           
 when (c*-1) >= ledgeramount and ledgeramount < 0 then ledgeramount*-1                                                           
 when (c*-1) < ledgeramount and ledgeramount > 0 then c          
 when (c*-1) < ledgeramount and ledgeramount < 0 then  ledgeramount*-1                                                           
 else 0 end ) end into #mcdx_b                                                          
 from                                                    
 (select sbtag,subgroup,clcode,imargin,shortage,net,ledgeramount,cash_coll,non_cash,                                                          
 c=(case when (imargin/2)-non_cash < 0 then 0 else (imargin/2)-non_cash end)+((imargin/2)-cash_coll-ledgeramount)                                                     
 from mcdx_marh (nolock) where sauda_date = (select  max(sauda_date) from mcdx_marh)                                                                
 ) a                                                          
                                                
 --------------------- MCX Cash deposit entry                                                    
 update #mcdx_b set fo_balanceb = fo_balanceb-b.fo_Balancec                                                
 from (select cltcode,FO_Balancec=sum(cramt)*-1 from MCDX_reco (nolock) group by cltcode) b where #mcdx_b.cltcode=b.cltcode                                                    
                                                
 ---------------------------------------------------------------------------                                                
 select a.*,b.fo_Balanceb into #mcdxcal from #mcdx_a a left outer join #mcdx_b b on a.cltcode=b.cltcode where fo_balancea <> 0                                                                  
                                                            
                                                        
 declare @mdate as datetime                                                        
 select @mdate=max(margindate) from angelcommodity.mcdx.dbo.tbl_clientmargin                                                         
                                                        
 select party_code into #mcdx_block from angelcommodity.mcdx.dbo.tbl_clientmargin                                                         
 where margindate = @mdate                                                             
 and cash_coll+noncash_coll > 0 and initialmargin > 0 and  (ledgeramount+cash_coll) < initialmargin/2                                                      
                                                            
 update #mcdxcal set fo_balancea=0 where cltcode in (select party_code from #mcdx_block)                                                            
      
 select  * from #MCDXcal      
      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Connection
-- --------------------------------------------------
CREATE proc [dbo].[USP_Connection]  
(  
@Process varchar(50)='',  
@ConnectionId int =0,  
@DatabaseName varchar(100)='',  
@ConnectionString varchar(300)='',  
@ServerName varchar(100)='',  
@UID varchar(100)='',  
@PWD varchar(100)='',  
@ConName varchar(100)='',  
@CreatedDate varchar(50)='',  
@CreatedBy varchar(50)='',  
@ModifiedDate varchar(50)='',  
@ModifiedBy varchar(50)='',  
@ApprovedDate varchar(50)='',  
@ApprovedBy varchar(50)='',  
@cnt int=0 output,  
@Isapproved int =0  
)  
as begin 
set @cnt=0 
 if (@Process ='Add Connection')  
 begin 
  
 BEGIN TRY
     select @cnt= COUNT (1)from tbl_Connection where (ConnectionString=@ConnectionString or ConName =@ConName )  and Isapproved in (1,0) 
     
    if (@cnt=0)  
    begin  
      INSERT INTO [tbl_Connection] ([ConnectionString],[DatabaseName],[ServerName],[UID],[PWD],[ConName],[CreatedDate],[CreatedBy],[ModifiedDate],[ModifiedBy],[ApprovedDate],[ApprovedBy],[Isapproved])  
       VALUES(@ConnectionString,@DatabaseName,@ServerName,@UID,@PWD,@ConName,getdate(),@CreatedBy,@ModifiedDate,@ModifiedBy,@ApprovedDate,@ApprovedBy,0)  
    end 
    END TRY
    
    BEGIN CATCH
    set @cnt=-1
    END CATCH  
    
 end  
 
  if (@Process ='Update Connection')  
 begin 
  
 BEGIN TRY
     select @cnt= COUNT (1)from tbl_Connection where (ConnectionString=@ConnectionString or ConName =@ConName )  and Isapproved in (1,0) and ConnectionId <> @ConnectionId  
     
    if (@cnt=0)  
    begin
    update tbl_Connection
    set  ConnectionString=@ConnectionString ,
     [DatabaseName]=@DatabaseName ,
     [ServerName]=@ServerName ,
     [UID]=@UID ,
     [PWD]=@PWD ,
     [ConName]=@ConName ,
     [ModifiedDate]=GETDATE() ,
     [ModifiedBy]=@ModifiedBy 
     where ConnectionId =@ConnectionId 
    end 
    END TRY
    
    BEGIN CATCH
    set @cnt=-1
    END CATCH  
    
 end  
 
   if (@Process ='Delete Connection')  
 begin 
  
 BEGIN TRY
     select @cnt= COUNT (1)from tbl_Connection con join tbl_Module_Mapping map
     on map.ConnectionId =con .ConnectionId 
      where  map.Isapproved in (1,0) and con.ConnectionId = @ConnectionId  
     
    if (@cnt=0)  
    begin
    update tbl_Connection
    set  Isapproved =9,
     [ModifiedDate]=GETDATE() ,
     [ModifiedBy]=@ModifiedBy 
     where ConnectionId =@ConnectionId 
    end 
    END TRY
    
    BEGIN CATCH
    set @cnt=-1
    END CATCH  
    
 end  
 
 
  if (@Process ='Get Applications')  
 begin  
     select distinct ConName,ConnectionId   from tbl_Connection where Isapproved in (1,0)   
 end  
 
 if (@Process ='Get Connection')  
 begin  
     select ConnectionId,[ConnectionString],[DatabaseName],[ServerName],[UID],[PWD],[ConName],[CreatedDate],[CreatedBy],[ModifiedDate],[ModifiedBy],[ApprovedDate],[ApprovedBy],[Isapproved]   from tbl_Connection where Isapproved in (1,0)   
 end  
 
  if (@Process ='Get Connection By id')  
 begin  
     select ConnectionId,[ConnectionString],[DatabaseName],[ServerName],[UID],[PWD],[ConName],[CreatedDate],[CreatedBy],[ModifiedDate],[ModifiedBy],[ApprovedDate],[ApprovedBy],[Isapproved]   from tbl_Connection where Isapproved in (1,0) and ConnectionId =@ConnectionId    
 end  
 

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_CtclMgrLocation_level
-- --------------------------------------------------
CREATE proc dbo.usp_CtclMgrLocation_level (@access_to as varchar(10),@ACCESS_CODE AS VARCHAR(12))  
as  
set nocount on  
  
if @access_to='BROKER'  
begin  
select vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)   
order by vsat_name
end  
if @access_to='BRANCH'  
begin  
select vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)   
WHERE branch_cd=@ACCESS_CODE  order by vsat_name
end  
if @access_to='BRMAST'  
begin  
select vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)   
 where branch_cd  IN (select branch_cd from  risk.dbo.branch_master (nolock) where brmast_cd=@ACCESS_CODE)  
  order by vsat_name
end  
if @access_to='REGION'  
begin  
select vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)   
 where branch_cd  IN (select code from  risk.dbo.region (nolock) where reg_code=@ACCESS_CODE)  order by vsat_name
end  
if @access_to='RGMAST'  
begin  
select vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)   
 where branch_cd  IN (select A.code from  risk.dbo.region A  (nolock) JOIN risk.dbo.region_master B (nolock)   
 ON A.reg_code=B.region_cd where B.rgmast_cd=@ACCESS_CODE)  
  order by vsat_name
end  
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_CtclMgrLocation_level_Commodity
-- --------------------------------------------------
CREATE proc dbo.usp_CtclMgrLocation_level_Commodity (@access_to as varchar(10),@ACCESS_CODE AS VARCHAR(12))            
as            
set nocount on            
            
if @access_to='BROKER'            
begin            
select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)   
where  SegmentAllowed like 'Commodities' or  SegmentAllowed like 'Equity_Commo' or SegmentAllowed like 'all'          
order by vsat_name          
end            
if @access_to='BRANCH'            
begin            
select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)            
WHERE branch_cd=@access_code   
and (SegmentAllowed like 'Commodities' or  SegmentAllowed like 'Equity_Commo' or SegmentAllowed like 'all'  )  
order by vsat_name          
end            
if @access_to='BRMAST'            
begin            
select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)             
 where branch_cd  IN (select branch_cd from  risk.dbo.branch_master (nolock) where brmast_cd=@access_code)   
 and (SegmentAllowed like 'Commodities' or  SegmentAllowed like 'Equity_Commo' or SegmentAllowed like 'all' ) 
  order by vsat_name          
end            
if @access_to='REGION'            
begin            
select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)             
 where branch_cd  IN (select code from  risk.dbo.region (nolock) where reg_code=@ACCESS_CODE)  
 and (SegmentAllowed like 'Commodities' or  SegmentAllowed like 'Equity_Commo' or SegmentAllowed like 'all'  )
  
 order by vsat_name          
end            
if @access_to='RGMAST'            
begin            
select SegmentAllowed, vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)             
 where branch_cd  IN (select A.code from  risk.dbo.region A  (nolock) JOIN risk.dbo.region_master B (nolock)            
 ON A.reg_code=B.region_cd where B.rgmast_cd=@ACCESS_CODE)   
 and (SegmentAllowed like 'Commodities' or  SegmentAllowed like 'Equity_Commo' or SegmentAllowed like 'all' ) 
 order by vsat_name          
end            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_CtclMgrLocation_level_Equity
-- --------------------------------------------------
CREATE proc dbo.usp_CtclMgrLocation_level_Equity (@access_to as varchar(10),@ACCESS_CODE AS VARCHAR(12))
as
set nocount on

if @access_to='BROKER'
begin
    select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)
    where (SegmentAllowed like 'Equity%' or SegmentAllowed like 'ALL')
    order by vsat_name
end
if @access_to='BRANCH'
begin
    select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)
    WHERE branch_cd=@ACCESS_CODE And (SegmentAllowed like 'Equity%' or SegmentAllowed like 'ALL')
    order by vsat_name
end
if @access_to='BRMAST'
begin
    select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)
    where branch_cd IN (select branch_cd from risk.dbo.branch_master (nolock) where brmast_cd=@ACCESS_CODE)
    And (SegmentAllowed like 'Equity%' or SegmentAllowed like 'ALL')
    order by vsat_name
end
if @access_to='REGION'
begin
    select SegmentAllowed,vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)
    where branch_cd IN (select code from risk.dbo.region (nolock) where reg_code=@ACCESS_CODE)
    And (SegmentAllowed like 'Equity%' or SegmentAllowed like 'ALL')
    order by vsat_name
end
if @access_to='RGMAST'
begin
    select SegmentAllowed, vsat_code=locaCode,vsat_name=LocaName,branch_cd from CtclMgrLocation (nolock)
    where branch_cd IN (select A.code from risk.dbo.region A (nolock) JOIN risk.dbo.region_master B (nolock)
    ON A.reg_code=B.region_cd where B.rgmast_cd=@ACCESS_CODE) And
    (SegmentAllowed like 'Equity%' or SegmentAllowed like 'ALL')
    order by vsat_name
end
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_CtclMgrLocation_level_Equity_Commo
-- --------------------------------------------------
CREATE PROC dbo.usp_CtclMgrLocation_level_Equity_Commo   
(@access_to AS VARCHAR(10), @ACCESS_CODE AS VARCHAR(12))                
AS                
SET NOCOUNT ON                
                
IF @access_to = 'BROKER'  
BEGIN  
    SELECT SegmentAllowed,  
           vsat_code = locaCode,  
           vsat_name = LocaName,  
           branch_cd  
    FROM   CtclMgrLocation(NOLOCK)
    ORDER BY  
           vsat_name  
END  
                
IF @access_to = 'BRANCH'  
BEGIN  
    SELECT SegmentAllowed,  
           vsat_code = locaCode,  
           vsat_name = LocaName,  
           branch_cd  
    FROM   CtclMgrLocation(NOLOCK)  
    WHERE  branch_cd = @access_code 
    ORDER BY  
           vsat_name  
END  
                
IF @access_to = 'BRMAST'  
BEGIN  
    SELECT SegmentAllowed,  
           vsat_code = locaCode,  
           vsat_name = LocaName,  
           branch_cd  
    FROM   CtclMgrLocation(NOLOCK)  
    WHERE  branch_cd  IN (SELECT branch_cd  
                          FROM   risk.dbo.branch_master (NOLOCK)  
                          WHERE  brmast_cd = @access_code) 
    ORDER BY  
           vsat_name  
END  
                
IF @access_to = 'REGION'  
BEGIN  
    SELECT SegmentAllowed,  
           vsat_code = locaCode,  
           vsat_name = LocaName,  
           branch_cd  
    FROM   CtclMgrLocation(NOLOCK)  
    WHERE  branch_cd  IN (SELECT code  
                          FROM   risk.dbo.region (NOLOCK)  
                          WHERE  reg_code = @ACCESS_CODE) 
    ORDER BY  
           vsat_name  
END  
                
IF @access_to = 'RGMAST'  
BEGIN  
    SELECT SegmentAllowed,  
           vsat_code = locaCode,  
           vsat_name = LocaName,  
           branch_cd  
    FROM   CtclMgrLocation(NOLOCK)  
    WHERE  branch_cd  IN (SELECT A.code  
                          FROM   risk.dbo.region A(NOLOCK)  
                                 JOIN risk.dbo.region_master B(NOLOCK)  
                                      ON  A.reg_code = B.region_cd  
                          WHERE  B.rgmast_cd = @ACCESS_CODE) 
    ORDER BY  
           vsat_name  
END  
                
SET NOCOUNT OFF

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_DTC_CSVUNZIP
-- --------------------------------------------------


CREATE PROCEDURE [dbo].[USP_DTC_CSVUNZIP](@FILENAME AS VARCHAR(25))



AS

DECLARE @STR AS VARCHAR(1000)



/* SET @FILENAME = 'DTC_15.ZIP' */



SET @STR='EXEC MASTER..XP_CMDSHELL ''\\INHOUSELIVEAPP2-FS.angelone.in\D$\UPLOAD\LIMIT\PKUNZIP.EXE -O \\INHOUSELIVEAPP2-FS.angelone.in\D$\UPLOAD1\FT\'+@FILENAME+'\\INHOUSELIVEAPP2-FS.angelone.in\D$\UPLOAD1\FT'''



--PRINT @STR



EXEC(@STR)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ECNMIS
-- --------------------------------------------------

-- =============================================
-- Author:		SURAJ pATIL
-- Create date: 20082016
-- Description:	FOR ECN AUTOMATION 
--usp_ecnmis 'getecndata'
--usp_ecnmis 'inserdata','8/20/2016','02:38 PM','02:38 PM','1'

--@filter1 date,
--@filter2 startdate,
--@filter3 enddate
--@filter4 quantity
--@filter5 as varchar(100)='',
--@filter6 as varchar(100)=''
-- =============================================
CREATE PROCEDURE USP_ECNMIS

@process as varchar(100),
@filter1 as varchar(100)='',
@filter2 as varchar(100)='',
@filter3 as varchar(100)='',
@filter4 as varchar(100)='',
@filter5 as varchar(100)='',
@filter6 as varchar(100)=''
AS
BEGIN
	
	
	if @process = 'getecndata'
	begin
	    select DATE as Date,START_TIME as Strat_Time,END_TIME as End_Time,QUANTITY as Quantity from TBL_ECNMIS where CAST(DATE as date) > DATEADD(DAY, -7, GETDATE())
	end
	
	if @process ='inserdata'
	begin
	    declare @cnt as int
	    set @cnt = 0
	    select @cnt= COUNT(1) from tbl_ecnmis where CAST(date as datetime) = CAST(@filter1 as datetime) 
	    print(@cnt)
	    if @cnt = 0
	    begin
	        insert into tbl_ecnmis values(@filter1,@filter2,@filter3,@filter4)
	        select 1	        
	    end
	    else
	    begin
	    update tbl_ecnmis
	    set START_TIME =@filter2,END_TIME = @filter3, QUANTITY = @filter4
	    where DATE =@filter1
	       select 0
	    end   
	end 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ECS_Role
-- --------------------------------------------------


CREATE proc [dbo].[USP_ECS_Role]
    
    @Process varchar(20)='',
    @RoleId   int=0  ,
	@Role varchar(50) ='',
	@priority int =0,
	@Description varchar(100) ='',
	@CreatedBy varchar(50) ='',
	@CreatedOn varchar(50) ='',
	@ModifyBy varchar(50) ='',
	@ModifyOn varchar(50) ='',
	@IsDelete bit =0,
	@cnt int =0 output
	
	as begin
	if @Process ='Add'
	
				begin
				select @cnt =COUNT (1) from ECS_Role where [Role] =@Role and IsDelete=0
				
				if @cnt =0
						begin
						INSERT INTO [ECS_Role] ([Role],[priority],[Description],[CreatedBy],[CreatedOn],[IsDelete])
                        VALUES(@Role,@priority ,@Description ,@CreatedBy,GETDATE(),0)
		
						end
				
				end 
	 if @Process ='Get'
	 begin
	 SELECT  [RoleId]
      ,[Role]
      ,p.Priority as 'priorityName'
      ,r.priority
      ,[Description]
      ,[CreatedBy]
      ,[CreatedOn]
      ,[ModifyBy]
      ,[ModifyOn]
      ,[IsDelete]
       FROM [ECS_Role] r join ECS_Priority p
       on p.Id=r.priority
       where  r.IsDelete=0
	 end
	 
	if @Process ='GetPriority'
	 begin
	 SELECT  *
       FROM [ECS_Priority]
    
	 end		
	 
	 --GetPriority		
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ECS_User_Role
-- --------------------------------------------------


create proc [dbo].[USP_ECS_User_Role]
    
    @Process varchar(20)='',
    @RoleId   int=0  ,
	@UserID varchar(50) ='',
	@CreatedBy varchar(50) ='',
	@CreatedOn varchar(50) ='',
	@ModifyBy varchar(50) ='',
	@ModifyOn varchar(50) ='',
	@cnt int =0 output
	
	as begin
	if @Process ='Add'
	
				begin
				select @cnt =COUNT (1) from ECS_User_Role where [UserId] =@UserId and RoleId=@RoleId
				
				if @cnt =0
						begin
						INSERT INTO [ECS_User_Role] ([UserId],[RoleId],[CreatedBy],[CreatedOn])
                        VALUES(@UserID ,@RoleId   ,@CreatedBy,GETDATE())
		
						end
				
				end 
	
	 
	 --GetPriority		
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_ECS_Users
-- --------------------------------------------------


CREATE proc [dbo].[USP_ECS_Users]
    
    @Process varchar(20)='',
    @Id   int=0 output ,
	@Username varchar(50) ='',
	@Password varchar(max) ='',
	@EmailId varchar(50) ='',
	@CreatedBy varchar(50) ='',
	@CreatedOn varchar(50) ='',
	@ModifyBy varchar(50) ='',
	@ModifyOn varchar(50) ='',
	@IsDelete bit =0,
	@cnt int =0 output
	
	as begin
	if @Process ='Add'
	
				begin
				select @cnt =COUNT (1) from ECS_Users where Username =@Username and IsDelete=0
				
				if @cnt =0
						begin
						insert into ECS_Users (
						   [Username]
						  ,[Password]
						  ,[EmailId]
						  ,[CreatedBy]
						  ,[CreatedOn]
						  ,[ModifyBy]
						  ,[ModifyOn]
						  ,[IsDelete]) 
						values ( 
						   @Username
						  ,@Password
						  ,@EmailId
						  ,@CreatedBy
						  ,GETDATE()
						  ,@ModifyBy
						  ,@ModifyOn
						  ,@IsDelete
						) 
						
						Select @Id= @@IDENTITY
						end
				
				end 
	 if @Process ='Get'
	 begin
	 SELECT
	 Id,  
      [Username]
      ,[EmailId]
      ,case when ([IsDelete]=0) then 'Active' else 'Deleted' end as 'Status'
      ,[CreatedBy]
      ,[CreatedOn]
      ,[ModifyBy]
      ,[ModifyOn]
       FROM [ECS_Users]
	 end			
	end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EmailMaster
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj Patil
-- Create date: 23/09/2015
-- Description:	Store procedure to perform operations on Email Master Table

-- =============================================
CREATE PROCEDURE [dbo].[USP_EmailMaster]
@Purpose varchar(50)='',
@EmailTO varchar(MAX)='',
@EmailCC varchar(MAX)='',
@EmailBCC varchar(MAX)='',
@SNo int = 0,
@Added_by varchar(50)='',
@Added_on varchar(50)='',
@Modified_by varchar(50)='',
@Modified_on varchar(50)='',
@Approved_by varchar(50)='',
@Approved_on varchar(50)='',
@IsApproved int=0,
@Process varchar(50)

AS
BEGIN

if(@Process = 'select')
begin
	select * from tbl_EmailMaster where isApproved in (1,0)
end

if(@Process = 'GetPurpose')
begin
	select * from tbl_EmailPurpose where isApproved in (1,0)
end

if(@Process = 'Add')
begin

	declare @cnt as int
	select @cnt =COUNT(1) from tbl_EmailMaster where Purpose =@Purpose and IsApproved in (1,0) and EmailTo=@EmailTO and EmailCC = @EmailCC and EmailBCC = @EmailBCC

	if (@cnt=0)
	begin 
		INSERT INTO tbl_EmailMaster ([Purpose],[EmailTO],[EmailCC],[EmailBCC],[Added_by],[Added_on],[IsApproved])
		VALUES(@Purpose ,@EmailTO,@EmailCC,@EmailBCC ,@Added_by ,GETDATE(),0)
	end

	select @cnt

end

if(@Process = 'Update')
begin

		select @cnt =COUNT(1) from tbl_EmailMaster where Purpose =@Purpose and IsApproved in (1,0) 

		if (@cnt=1)
		begin 

				update tbl_EmailMaster
				set Purpose=@Purpose ,
				EmailTO=@EmailTO ,
				EmailCC=@EmailCC ,
				EmailBCC=@EmailBCC ,
				Modified_by=@Modified_by ,
				Modified_on=GETDATE ()
				where SNo=@sno 

		end

		         select @cnt 

		end

if(@Process = 'select_by_sno')
begin
			select * from tbl_EmailMaster where sno = @sno and IsApproved in (1,0)
end

if(@Process ='Delete')
begin
		update tbl_EmailMaster
		set IsApproved=9,
		Modified_by=@Modified_by ,
		Modified_on=GETDATE()
		where SNo=@sno 
end


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EVENTASSESSMENTMANAGE
-- --------------------------------------------------
CREATE PROC [dbo].[USP_EVENTASSESSMENTMANAGE]
@PROCESS    AS VARCHAR(50)='',
@PURPOSEID AS INT=0,
@BMID AS VARCHAR(20)='',
@SBID AS VARCHAR(20)='',
@ISNEWCLIENT AS BIT=0,
@SEGMENTIMPROVEMENT AS VARCHAR(100)='',
@ISSBACQUISITION AS BIT=0,
@ISMUTUALFUND AS BIT=0,
@DATE AS VARCHAR(25)='',
@TIME AS VARCHAR(25)='',
@VENUE AS VARCHAR(50)='',
@ISEVENTEXPERIENCE AS BIT=0,
@EVENTORGANIZEDDATE AS VARCHAR(50)='',
@PURPOSEOFEVENT AS VARCHAR(300)='',
@PARTICIPANTSSIZE AS VARCHAR(30)='',
@LEADSGENERATED AS VARCHAR(50)='',
@SBCONVERTED AS VARCHAR(50)='',
@ANTICIPATEDPARTICIPANTS AS VARCHAR(50)='',
@PROSPECTIVELEADSFORINVITATION AS VARCHAR(50)='',
@KYCEXPECTED AS VARCHAR(50)='',
@AVERAGEMARGINPERKYC AS VARCHAR(50)='',
@CLIENTSOPENINGNEWSEGMENTS AS VARCHAR(50)='',
@SBEXPECTED AS VARCHAR(50)='',
@AVERAGEDEPOSITPERSB AS VARCHAR(50)='',
@SUGGESTION AS VARCHAR(300)='',
@ID AS INT =0  

AS BEGIN

 
 IF @PROCESS ='ADD'
 BEGIN 
 

      INSERT INTO TBL_B2BEVENTASSESSMENT(PURPOSEID,BMID,SBID, ISNEWCLIENT, SEGMENTIMPROVEMENT, ISSBACQUISITION ,DATE,TIME,VENUE,ISEVENTEXPERIENCE, EVENTORGANIZEDDATE, PURPOSEOFEVENT, PARTICIPANTSSIZE, LEADSGENERATED, SBCONVERTED,ANTICIPATEDPARTICIPANTS,PROSPECTIVELEADSFORINVITATION,KYCEXPECTED,AVERAGEMARGINPERKYC,CLIENTSOPENINGNEWSEGMENTS,SBEXPECTED, AVERAGEDEPOSITPERSB,SUGGESTION,ISMUTUALFUND)
      VALUES(@PURPOSEID,@BMID,@SBID,@ISNEWCLIENT,@SEGMENTIMPROVEMENT,@ISSBACQUISITION ,@DATE,@TIME,@VENUE,@ISEVENTEXPERIENCE,@EVENTORGANIZEDDATE,@PURPOSEOFEVENT,@PARTICIPANTSSIZE,@LEADSGENERATED,@SBCONVERTED,@ANTICIPATEDPARTICIPANTS,@PROSPECTIVELEADSFORINVITATION,@KYCEXPECTED,@AVERAGEMARGINPERKYC,@CLIENTSOPENINGNEWSEGMENTS,@SBEXPECTED,@AVERAGEDEPOSITPERSB,@SUGGESTION,@ISMUTUALFUND)
     
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_EVENTASSESSMENTMANAGE_20_Nov_2021
-- --------------------------------------------------
CREATE PROC [dbo].[USP_EVENTASSESSMENTMANAGE_20_Nov_2021]  
@PROCESS    AS VARCHAR(50)='',  
@PURPOSEID AS INT=0,  
@BMID AS VARCHAR(20)='',  
@SBID AS VARCHAR(20)='',  
@ISNEWCLIENT AS BIT=0,  
@SEGMENTIMPROVEMENT AS VARCHAR(100)='',  
@ISSBACQUISITION AS BIT=0,  
@ISMUTUALFUND AS BIT=0,  
@DATE AS VARCHAR(25)='',  
@TIME AS VARCHAR(25)='',  
@VENUE AS VARCHAR(50)='',  
@ISEVENTEXPERIENCE AS BIT=0,  
@EVENTORGANIZEDDATE AS VARCHAR(50)='',  
@PURPOSEOFEVENT AS VARCHAR(300)='',  
@PARTICIPANTSSIZE AS VARCHAR(30)='',  
@LEADSGENERATED AS VARCHAR(50)='',  
@SBCONVERTED AS VARCHAR(50)='',  
@ANTICIPATEDPARTICIPANTS AS VARCHAR(50)='',  
@PROSPECTIVELEADSFORINVITATION AS VARCHAR(50)='',  
@KYCEXPECTED AS VARCHAR(50)='',  
@AVERAGEMARGINPERKYC AS VARCHAR(50)='',  
@CLIENTSOPENINGNEWSEGMENTS AS VARCHAR(50)='',  
@SBEXPECTED AS VARCHAR(50)='',  
@AVERAGEDEPOSITPERSB AS VARCHAR(50)='',  
@SUGGESTION AS VARCHAR(300)='',  
@ID AS INT =0    
  
AS BEGIN  
  
   
 IF @PROCESS ='ADD'  
 BEGIN   
   
  
      INSERT INTO TBL_B2BEVENTASSESSMENT(PURPOSEID,BMID,SBID, ISNEWCLIENT, SEGMENTIMPROVEMENT, ISSBACQUISITION ,DATE,TIME,VENUE,ISEVENTEXPERIENCE, EVENTORGANIZEDDATE, PURPOSEOFEVENT, PARTICIPANTSSIZE, LEADSGENERATED, SBCONVERTED,ANTICIPATEDPARTICIPANTS,PROSPECTIVELEADSFORINVITATION,KYCEXPECTED,AVERAGEMARGINPERKYC,CLIENTSOPENINGNEWSEGMENTS,SBEXPECTED, AVERAGEDEPOSITPERSB,SUGGESTION,ISMUTUALFUND)  
      VALUES(@PURPOSEID,@BMID,@SBID,@ISNEWCLIENT,@SEGMENTIMPROVEMENT,@ISSBACQUISITION ,@DATE,@TIME,@VENUE,@ISEVENTEXPERIENCE,@EVENTORGANIZEDDATE,@PURPOSEOFEVENT,@PARTICIPANTSSIZE,@LEADSGENERATED,@SBCONVERTED,@ANTICIPATEDPARTICIPANTS,@PROSPECTIVELEADSFORINVITATION,@KYCEXPECTED,@AVERAGEMARGINPERKYC,@CLIENTSOPENINGNEWSEGMENTS,@SBEXPECTED,@AVERAGEDEPOSITPERSB,@SUGGESTION,@ISMUTUALFUND)  
       
 END  
   
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_FetchCircular
-- --------------------------------------------------
CREATE proc usp_FetchCircular          
@CNO varchar(50)          
as          
select appno,scan1,scan2 from chq_entry           
where           
appno = @CNO

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FINALUPLOAD_DTC
-- --------------------------------------------------
CREATE PROC [dbo].[USP_FINALUPLOAD_DTC]
AS
BEGIN

TRUNCATE TABLE CTCL_DTC

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO20]

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO34]

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO44]

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO48]

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO65]

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO66]

INSERT INTO CTCL_DTC
SELECT * FROM [dbo].[TBL_CSO186]


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Usp_find_regionwise_rpt
-- --------------------------------------------------
CREATE PROC Usp_find_regionwise_rpt @REGION      VARCHAR(20) = '',
                                   @ACCESS_TO   VARCHAR(20),
                                   @ACCESS_CODE VARCHAR(20)
AS
    IF ( @REGION = '' )
      BEGIN
          SELECT REGION = '<A HREF="/GLOBAL3/REPORT.ASPX?REPORTNO=611&REGION=' + REGION + '">' + REGION + '</A>',
                 Sum(TURNOVER)                                                                                                                        AS TURNOVER,
                 Sum(BROKERAGE)                                                                                                                       BROKERAGE,
                 Count(DISTINCT PARTY_CODE)                                                                                                           AS [NO OF UNIQUE CLIENTS],
                 '<A HREF=# onClick="openmodalpopup(''REGIONWISE TURNOVER AND BROKERAGE'',''/rmnew/searchinfo1.asp'',450,200);return false">VIEW</A>' AS ACTION,
                 colbg=CASE
                         WHEN Sum(BROKERAGE) < 100000 THEN 'yellow'
                         ELSE ''
                       END
          FROM   EXM_CLIENTTO
          WHERE  SAUDA_DATE BETWEEN 'APR 1 2012' AND 'APR 30 2012'
          GROUP  BY REGION
      END
    ELSE
      SELECT BRANCH_CD                  AS BRANCH,
             Sum(TURNOVER)              AS TURNOVER,
             Sum(BROKERAGE)             BROKERAGE,
             Count(DISTINCT PARTY_CODE) AS [NO OF UNIQUE CLIENTS],
             Region,
             colbg=CASE
                     WHEN Sum(BROKERAGE) < 100000 THEN 'pink'
                     ELSE ''
                   END
      FROM   EXM_CLIENTTO
      WHERE  Replace(REGION, ' ', '-') = Replace(@REGION,' ', '-')
             AND SAUDA_DATE BETWEEN 'APR 1 2012' AND 'APR 30 2012'
      GROUP  BY BRANCH_CD,
                Region 


--select
-- BRANCH_CD                  AS BRANCH,
--             Sum(TURNOVER)              AS TURNOVER,
--             Sum(BROKERAGE)             BROKERAGE,
--             Count(DISTINCT PARTY_CODE) AS [NO OF UNIQUE CLIENTS],
--             Region 

--from Exm_ClientTO

--where SAUDA_DATE BETWEEN 'APR 1 2012' AND 'APR 30 2012'
--and Region = 'Delhi Region'
--GROUP  BY BRANCH_CD,
--                Region

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_findinJobs
-- --------------------------------------------------
Create Procedure usp_findinJobs(@Str as varchar(500))
as
select b.name,
Case when b.enabled=1 then 'Active' else 'Deactive' end as Status,
date_created,date_modified,a.step_id,a.step_name,a.command
from msdb.dbo.sysjobsteps a, msdb.dbo.sysjobs b
where command like '%'+@Str+'%'
and a.job_id=b.job_id

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_findInUSP
-- --------------------------------------------------
CREATE PROCEDURE usp_findInUSP          
@dbname varchar(500),        
@srcstr varchar(500)          
AS          
          
 set nocount on        
 set @srcstr  = '%' + @srcstr + '%'          
        
 declare @str as varchar(1000)        
 set @str=''        
 if @dbname <>''        
 Begin        
 set @dbname=@dbname+'.dbo.'        
 End        
 else        
 begin        
 set @dbname=db_name()+'.dbo.'        
 End        
 print @dbname        
        
 set @str='select distinct O.name,O.xtype from '+@dbname+'sysComments  C '         
 set @str=@str+' join '+@dbname+'sysObjects O on O.id = C.id '         
 set @str=@str+' where O.xtype in (''P'',''V'') and C.text like '''+@srcstr+''''          
 print @str        
  exec(@str)        
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FOS_EXCEPTION
-- --------------------------------------------------
CREATE PROC [DBO].[USP_FOS_EXCEPTION]  
@PROCESS VARCHAR(20)='',  
@ID INT=0,  
@SOURCE VARCHAR(30)='',  
@MESSAGE VARCHAR(300)='',  
@STACKTRACE VARCHAR(1000) ='',  
@USERID VARCHAR(50)='',  
@OCCUREDON DATETIME=NULL,  
@ISRESOLVED BIT=0,  
@RESOLVEDBY VARCHAR(50)='',  
@RESOLVEDON DATETIME=NULL  
AS BEGIN  
      
 IF (@PROCESS='ADD ERROR')  
 BEGIN  
 INSERT INTO TBL_FOS_EXCEPTION_LOG ([SOURCE],[MESSAGE],[STACKTRACE],[USERID],[OCCUREDON],[ISRESOLVED],[RESOLVEDBY],[RESOLVEDON])  
 VALUES(@SOURCE,@MESSAGE,@STACKTRACE,@USERID,GETDATE(),0,NULL,NULL)  
 END  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FOS_GETDATA
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj PAtil
-- Create date: 01082016
-- Description:	FOS_ADMIN LOGIN PROCEDURE
-- =============================================
                        --USP_FOS_GETDATA 'GETEMPLOYEECONTACTLOG',4
CREATE PROCEDURE [dbo].[USP_FOS_GETDATA]
	@PROCESS AS VARCHAR(100),
	@FILTERDATA1 AS VARCHAR(100)='',
	@FILTERDATA2 AS VARCHAR(100)='',
	@FILTERDATA3 AS VARCHAR(100)='',
	@FILTERDATA4 AS VARCHAR(100)='',
	@FILTERDATA5 AS VARCHAR(100)='',
	@FILTERDATA6 AS VARCHAR(100)='',
	@FILTERDATA7 AS VARCHAR(100)='',
	@FILTERDATA8 AS VARCHAR(100)='',
	@FILTERDATA9 AS VARCHAR(100)='',
	@FILTERDATA10 AS VARCHAR(100)=''
	
AS
BEGIN
  DECLARE @CNT AS INT
	IF @PROCESS = 'GETTEMPLATE'
	BEGIN
	    SELECT ID as Id,TYPE as Type,TEXT as Text,HEADER as Header FROM TBL_FOS_TEMPLATE WHERE ISDELETE = 0  order by type
	END
	
	IF @PROCESS = 'GETTEMPLATETYPE'
	BEGIN
	    SELECT distinct TYPE FROM TBL_FOS_TEMPLATE
	END
	
	IF @PROCESS = 'GETTEMPLATEBYID'
	BEGIN
	    SELECT ID,TYPE,TEXT,HEADER FROM TBL_FOS_TEMPLATE WHERE ISDELETE = 0 and ID = CAST(@FILTERDATA2 as int)  order by type
	END
	
	
    IF @PROCESS = 'EDITTEMPLATE'
    BEGIN

        SET @CNT = 0
        SELECT @CNT = COUNT(1) FROM TBL_FOS_TEMPLATE WHERE ISDELETE = 0 and ID = CAST(@FILTERDATA2 as int) 

        IF(@CNT= 1)
        BEGIN 
            --TAKE OLD BACKUP
            SELECT TOP 1 * INTO #TEMP FROM  TBL_FOS_TEMPLATE WHERE ISDELETE = 0 and ID = CAST(@FILTERDATA2 as int) 
            
            --UPDATE OLD ENTRY
            UPDATE TBL_FOS_TEMPLATE
            SET MODIFIED_BY = @FILTERDATA1,
            MODIFIED_ON = GETDATE(),
            ISDELETE = 9
            WHERE ISDELETE = 0 and ID = CAST(@FILTERDATA2 as int) 

            --ADD NEW ENTRY

            DECLARE @ADDED_BY AS VARCHAR(100),@ADDED_ON AS VARCHAR(100)

            SELECT @ADDED_BY = ADDED_BY,@ADDED_ON = ADDED_ON FROM #TEMP

            INSERT INTO TBL_FOS_TEMPLATE(TYPE,TEXT,HEADER,ADDED_BY,ADDED_ON,MODIFIED_BY,MODIFIED_ON,ISDELETE)
            VALUES(@FILTERDATA3,@FILTERDATA4,@FILTERDATA5,@ADDED_BY,@ADDED_ON,@FILTERDATA1,GETDATE(),0) 
            SELECT 1	               

        END
        ELSE
        BEGIN 
            SELECT 0
        END


    END
	
	IF @PROCESS = 'ADDTEMPLATE'
    BEGIN
        SET @CNT = 0
        SELECT @CNT = COUNT(1) FROM TBL_FOS_TEMPLATE WHERE ISDELETE = 0 and ID = CAST(@FILTERDATA2 as int) 

        IF(@CNT> 0)
        BEGIN 
            select -1         
        END
        ELSE
        BEGIN 
            insert into TBL_FOS_TEMPLATE(TYPE,TEXT,HEADER,ADDED_BY,ADDED_ON,MODIFIED_ON,MODIFIED_BY,ISDELETE)
            values(@FILTERDATA3,@FILTERDATA4,@FILTERDATA5,@FILTERDATA1,GETDATE(),'','',0)
            SELECT 1
        END
    END
    IF @PROCESS = 'GETEMPLOYEE'
	BEGIN
	   -- SELECT ID,FIRST_NAME,LAST_NAME,EMAIL,ECODE from TBL_FOS_EMP_DATA where senior = @FILTERDATA1
	      SELECT A.ID,E.* FROM (SELECT ID,ECODE from TBL_FOS_EMP_DATA where senior = @FILTERDATA1) A JOIN 
          (select emp_no , Emp_name ,email  , CASE WHEN  SeparationDate IS NULL THEN 'ACTIVE' ELSE 'DEACTIVE' END AS STATUS  from intranet.risk.dbo.emp_info) E
          ON A.ECODE=E.emp_no order by STATUS
	END
	
	 IF @PROCESS = 'GETEMPLOYEECONTACTS'
	BEGIN
        SELECT A.* FROM ((SELECT ID,ECODE,FIRST_NAME,LAST_NAME,MOBILE1,MOBILE2,EMAIL,EMP_MOBILE1,EMP_MOBILE2,EMP_EMAIL,EMP_ADDR FROM TBL_FOS_CONTACTS )A
        JOIN
        (SELECT ID,ECODE FROM TBL_FOS_EMP_DATA WHERE ID=cast(@FILTERDATA1 as int)) B
        ON A.ECODE = B.ECODE)

	END
	IF @PROCESS = 'GETEMPLOYEECONTACTLOG'
	BEGIN
        SELECT A.* FROM ((SELECT ECODE,CONTACT_NO,TEMPLATE,CONTACT_TIME,MEDIUM,OUTCOME FROM TBL_FOS_CONTACT_LOG)A
        JOIN
        (SELECT ECODE,MOBILE1,MOBILE2 FROM TBL_FOS_CONTACTS WHERE ID= CAST(@FILTERDATA1 as int))B
        ON 
        A.CONTACT_NO = B.MOBILE1 OR A.CONTACT_NO = B.MOBILE2 
        )
	END
	 IF @PROCESS = 'GETEMPLOYEECONTACTLOGBYEMPLOYEE'
	BEGIN
        SELECT A.* FROM ((SELECT ECODE,CONTACT_NO,TEMPLATE,CONTACT_TIME,MEDIUM,OUTCOME FROM TBL_FOS_CONTACT_LOG)A
        JOIN
        (SELECT ECODE FROM TBL_FOS_EMP_DATA WHERE ID= CAST(@FILTERDATA1 as int))B
        ON 
        A.ECODE = B.ECODE 
        )
        
	END
	
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_FOS_LOGIN
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj PAtil
-- Create date: 01082016
-- Description:	FOS_ADMIN LOGIN PROCEDURE
-- =============================================

CREATE PROCEDURE USP_FOS_LOGIN
	@ECODE AS VARCHAR(30)
	
AS
BEGIN
	SELECT * FROM TBL_FOS_EMP_DATA WHERE ECODE =@ECODE 
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_functions_findInUSP
-- --------------------------------------------------
create PROCEDURE usp_functions_findInUSP  
@str varchar(500)  
AS  
  
 set @str = '%' + @str + '%'  
   
 select O.name from sysComments  C  
 join sysObjects O on O.id = C.id  
 where O.xtype = 'P' and C.text like @str

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Generate_OTP_BackOffice
-- --------------------------------------------------
  
Create Procedure [dbo].[USP_Generate_OTP_BackOffice]        
(     
--@Process varchar(50) ='',  
--@Srno int=0,      
@SBTAg varchar(50)='',        
@MobileNo   bigint,        
@OTPPin varchar(20)=''       
--@MinBidRate money=0,		--@MaxBidRate money=0,				--@PercentAlert int=0,			--@RI_AmtLimit money=0,        
--@MinMarginPercent int=0,    --@Checkon_NetA_NetL char(2)='',    --@EnteredBy varchar(10)='' ,  --@IsDelete int =0,  --@cnt int=0 output       
)        
As        
Begin
  
  --select @cnt= COUNT (1)from tbl_OFS_ScripMaster where (ScripName=@ScripName  )  and (IsDelete =0 or IsDelete is null) 
		-- and ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'    
  
  --if (@cnt=0)    
   begin    
   insert into Generate_OTP_BackOffice(SBTAg,MobileNo,OTPPin,GeneratedDate)        
   values        
   (@SBTAg,@MobileNo,@OTPPin,REPLACE(CONVERT(VARCHAR(20), CURRENT_TIMESTAMP),'.',''))        
   End   

   
--if(@Process='Update Script')    
--Begin 
--  select @cnt= COUNT (1)from tbl_OFS_ScripMaster where (ScripName=@ScripName  )  and (IsDelete =0 or IsDelete is null)and  ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'  and Srno <>@Srno   
  
--		if (@cnt=0)    
--		begin    
--			update tbl_OFS_ScripMaster    
--			set ScripName=@ScripName,    
--			BSECode=@BSECode,NSESymbol=@NSESymbol,ValidForDate=cast (@ValidForDate as DATE),MinBidRate=@MinBidRate,MaxBidRate=@MaxBidRate    
--			,PercentAlert=@PercentAlert,RI_AmtLimit=@RI_AmtLimit,MinMarginPercent=@MinMarginPercent,Checkon_NetA_NetL=@Checkon_NetA_NetL,UpdatedBy=@EnteredBy ,  UpdatedOn =GETDATE() 
--			where Srno=@Srno 
--		end   
--End   

--if(@Process='Delete Script')    
--Begin 
--  select @cnt= COUNT (1)from tbl_OFS_ORDER where  SCRIPCODE =@Srno   
  
--		if (@cnt=0)    
--		begin    
--			update tbl_OFS_ScripMaster    
--			set IsDelete =1,
--                UpdatedBy=@EnteredBy , 
--                UpdatedOn =GETDATE() 
--			where Srno=@Srno 
--		end   
--End  
  
--if(@Process='Get Scripts')    
--Begin    
--select Srno,ScripName,BSECode,NSESymbol,convert(varchar(12),ValidForDate,106) as ValidForDate,cast (convert(decimal(18,2),MinBidRate) as varchar(100)) as MinBidRate,cast (convert(decimal(18,2),MaxBidRate) as varchar(100)) as MaxBidRate,PercentAlert,cast (
--convert(decimal(18,2),RI_AmtLimit) as varchar(100)) as RI_AmtLimit,MinMarginPercent,case when Checkon_NetA_NetL='NA' then 'Net Available' else 'Net Ledger' end as Checkon_NetA_NetL,        
--EnteredBy,EnteredOn,UpdatedBy,UpdatedOn        
--from  tbl_OFS_ScripMaster with(nolock) where  ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'    
--  and IsDelete =0    
 
--End   
    
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GenerateJV
-- --------------------------------------------------
--select * from update payin set accountno=branchname,branchname=''     
--where  accountno is null and branchname<>'' and isnumeric(branchname)='1'    
CREATE PROCEDURE [dbo].[usp_GenerateJV]                     
(                      
 @Segment  varchar(20)                      
)                      
AS                      
-------------------------------------------------------------------------------------------------------------                      
-- Execution Part          
-- select * from payin where posted_status='N'         
-- EXEC usp_GenerateJV 'ACDLCM'                       
-- UPDATE Payin SET posted_status='N'                      
-------------------------------------------------------------------------------------------------------------                      
BEGIN                    
SELECT * INTO #JV FROM (                      
SELECT DISTINCT row_number() over (order by SrNo) [SERIAL NO.],CONVERT(VARCHAR,EDate,103) [EDATE],    
CONVERT(VARCHAR,Vdate,103) [VOUCHER DATE],    
CltCode [PARTY CODE],SUM(Amount) AMOUNT,DRCR,NARRATION,BankCode [BANK CODE],A.BankName [BANK NAME],    
[REF NO.]=DDNo,Branch_cd [BRANCH CODE],replace(BranchName,',',' ')  [BRANCH NAME] ,chqmode [CHQ MODE],    
CONVERT(VARCHAR,chqdate,103) [CHQ DATE],replace(chqname,',',' ') [CHQ NAME],    
replace(clmode,',',' ') [CL MODE],[ACCOUNTNO.]=AccountNo                       
FROM Payin A (NOLOCK)      
INNER JOIN risk.dbo.Client_details B (NOLOCK) ON A.cltCode=B.Party_code    
--INNER JOIN AngelNseCM.msajag.dbo.party_bank_Details C (NOLOCK) ON A.cltCode=C.Party_code                       
WHERE A.posted_status='N' AND A.App_status='A' AND A.Segment=@Segment            
GROUP BY A.SrNo,A.CltCode,Branch_cd,Segment,EDate,DRCR,Narration,Vdate,BankCode,A.BankName,BranchName,    
chqmode,chqdate,chqname,clmode ,AccountNo,DDNo                
-------------------------------------------------------------------------------------------------------------                      
UNION                     
-------------------------------------------------------------------------------------------------------------                      
SELECT DISTINCT row_number() over (order by SrNo) [SERIAL NO],CONVERT(VARCHAR,EDate,103) [EDATE],    
CONVERT(VARCHAR,Vdate,103) [VOUCHER DATE],    
CltCode [PARTY CODE],SUM(Amount) AMOUNT,DRCR,NARRATION,BankCode [BANK CODE],A.BankName [BANK NAME],    
[REF NO.]=DDNo,Branch_cd [BRANCH CODE],replace(BranchName,',',' ')  [BRANCH NAME] ,chqmode [CHQ MODE],    
CONVERT(VARCHAR,chqdate,103) [CHQ DATE],replace(chqname,',',' ') [CHQ NAME],    
replace(clmode,',',' ') [CL MODE],[ACCOUNTNO.]=AccountNo                       
FROM Payin A (NOLOCK)      
INNER JOIN risk.dbo.Client_details B (NOLOCK) ON A.cltCode=B.Party_code    
--INNER JOIN AngelNseCM.msajag.dbo.party_bank_Details C (NOLOCK) ON A.cltCode=C.Party_code                         
WHERE A.posted_status='N' AND A.App_status='A'  AND A.Segment=@Segment            
GROUP BY A.SrNo,A.CltCode,Branch_cd,Segment,EDate,DRCR,Narration,Vdate,BankCode,A.BankName,BranchName,    
chqmode,chqdate,chqname,clmode,AccountNo ,DDNo        
) a                      
-------------------------------------------------------------------------------------------------------------                      
SELECT * FROM #JV Order by [SERIAL NO.], drcr desc,edate      
UPDATE Payin SET posted_status='Y' WHERE Segment=@Segment and  App_status='A'  AND posted_status='N'     
-------------------------------------------------------------------------------------------------------------      
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GenerateSebiBannedPMLA
-- --------------------------------------------------


CREATE PROCEDURE usp_GenerateSebiBannedPMLA(
@PanNo varchar(40)
)
AS

BEGIN 

SELECT 
	Name=replace(testdb.dbo.ADDSPACE(name),'  ',' ')
	,[address], pan_no=isnull(pan_no,'')
	,dt_sebi_order
	,order_no
	,Brief_particulars
	,[start_date]
	,end_date
FROM sebi_banned
WHERE 
	pan_no =  @PanNo

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GET_POOR_BSE_NSE
-- --------------------------------------------------
CREATE Proc [dbo].[USP_GET_POOR_BSE_NSE] (@BSEServerFile AS VARCHAR(100),@NSEServerFile AS VARCHAR(100),@HarmonyServerFile AS VARCHAR(100),          
@access_to as varchar(50),@access_code as varchar(50),@username varchar(50)=null)             
AS            
BEGIN           
Declare @strnse as varchar(100),@strbse as varchar(100),@strharmony as varchar(100),@path as varchar(100),@Delimiter as varchar(10),@newline as varchar(10)        
set @path= '\\196.1.115.152\Public\BSE NSE POOR CAT\';set @strbse = (@path+@BSEServerFile);set @strnse = (@path+@NSEServerFile)        
set @strharmony = (@path+@HarmonyServerFile);set @Delimiter = ',';set @newline = '\n'        
        
truncate table Hold_BSE         
truncate table Hold_NSE         
truncate table Angel_Script_Harmony_Poor        
truncate table Hold_NSE_BSE_Poor          
print @strnse        
print @strbse        
print @strharmony        
CREATE TABLE #Temp_NSE_BSE_Poor (Party_Code varchar(50),Party_Name varchar(100),Scrip_Cd varchar(50),Series  varchar(50),DPId  varchar(50),          
ClientId varchar(100),Isin  varchar(100),Sett_No varchar(50),Sett_Type varchar(25),HoldQty varchar(50),PledgeQty varchar(50),Qty varchar(50),          
Segment varchar(10),[Angel scrip category] varchar(50),EnteredDate datetime,harmony_isin varchar(100))          
Truncate Table #Temp_NSE_BSE_Poor    
begin        
exec('BULK INSERT Hold_NSE FROM ''' +@strnse+''' WITH (FIRSTROW = 2,FIELDTERMINATOR = '''+@Delimiter+''', ROWTERMINATOR = '''+@newline+''')')        
end        
        
begin        
exec('BULK INSERT Hold_BSE FROM '''+@strbse+''' WITH (FIRSTROW = 2,FIELDTERMINATOR = '''+@Delimiter+''', ROWTERMINATOR ='''+@newline+''')')        
end          
        
begin        
exec('BULK INSERT Angel_Script_Harmony_Poor FROM '''+@strharmony+''' WITH (FIRSTROW = 2,FIELDTERMINATOR = '''+@Delimiter+''', ROWTERMINATOR ='''+@newline+''')')        
end          
        
 begin        
 INSERT INTO Hold_NSE_BSE_Poor (Party_Code,Party_Name,Scrip_Cd,Series,DPId,ClientId,a.Isin,Sett_No,Sett_Type,HoldQty,PledgeQty,Qty,Segment,          
 [Angel scrip category],a.entereddate,b.harmony_isin)          
 Select a.Party_Code,a.Party_Name,a.Scrip_Cd,a.Series,a.DPId,a.ClientId,a.Isin,a.Sett_No,a.Sett_Type,a.HoldQty,a.PledgeQty,a.Qty,'BSE',      
 b.[Angel scrip category], REPLACE(CONVERT(VARCHAR(20), CURRENT_TIMESTAMP),'.',''),b.[isin no]        
 from Hold_BSE a inner join Angel_Script_Harmony_Poor b on CONVERT(VARCHAR(100),a.isin) =CONVERT(VARCHAR(100),b.[ISIN No])         
  where a.ClientId in('1203320000026363','1203320004025849','16921197','1203320004574264')  and b.[Angel scrip category]='Poor'          
end               
begin        
    INSERT INTO Hold_NSE_BSE_Poor (Party_Code,Party_Name,Scrip_Cd,Series,DPId,ClientId,a.Isin,Sett_No,Sett_Type,HoldQty,PledgeQty,Qty,Segment,          
 [Angel scrip category],a.entereddate,b.harmony_isin)          
 Select a.Party_Code,a.Party_Name,a.Scrip_Cd,a.Series,a.DPId,a.ClientId,a.Isin,a.Sett_No,a.Sett_Type,a.HoldQty,a.PledgeQty,a.Qty,'NSE',      
  b.[Angel scrip category],REPLACE(CONVERT(VARCHAR(20), CURRENT_TIMESTAMP),'.',''),b.[isin no]        
 from Hold_NSE a inner join Angel_Script_Harmony_Poor b on  CONVERT(VARCHAR(100),a.isin) =CONVERT(VARCHAR(100),b.[ISIN No])         
 where a.ClientId in('1203320000026363','1203320004025849','16921197','1203320004574264') and b.[Angel scrip category]='Poor'        
END        
          
  begin        
INSErt INTO #Temp_NSE_BSE_Poor select * from Hold_NSE_BSE_Poor order by party_code        
end        
        
select * from #Temp_NSE_BSE_Poor        
        
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Get_RequestData
-- --------------------------------------------------
CREATE proc USP_Get_RequestData

@Process  varchar(25)='',
@FilterData1  varchar(25)='',
@FilterData2  varchar(25)='',
@FilterData3  varchar(25)='',
@FilterData4  varchar(25)='',
@FilterData5  varchar(25)='',
@FilterData6  varchar(25)=''

AS
BEGIN

if (@Process ='Get RequestStatus')
begin 
   select s.RequestId,s.Request,s.RaisedBy,s.RaisedDate,ApprovedBy,ApprovedDate, l.LevelId,l.Levels ,case when (s.RequestId IS NULL or s.IsApproved =0) then 'Pending' else case when (s.IsApproved =9) then 'Rejected' else 'Approved' end end as status 
   from (select RequestId,Request,RaisedBy,RaisedDate, IsApproved,ApprovedBy,ApprovedDate,LevelId from tbl_Request_status where RequestId=cast (@FilterData1 as int) )s right join tbl_Level l
   on s.LevelId=l.LevelId
end

if (@Process ='Get RequestByEmpId')
begin 
   select * from tbl_Request l join tbl_emp_app e
   on e.LevelId=l.LevelId
   where EmpId =cast(@FilterData1 as int)
end

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_GetAllDetails
-- --------------------------------------------------
CREATE PROC [dbo].[usp_GetAllDetails]                              
(                              
 @flag VARCHAR(15),                              
 @segment VARCHAR(20),                              
 @sb VARCHAR(20),                              
 @partyCode VARCHAR(20),                            
 @CreatedBy VARCHAR(20),                      
 @access_to VARCHAR(20)                              
)                              
AS                  
Set Nocount On                            
---------------------------------------------------------------------------------------------------------                              
-- usp_GetAllDetails '5','ABLCM','CSO','A16795','test12','BROKER'     select * from Voucher_Entry_Acc_Details      
-- usp_GetAllDetails '1','ABLCM','FOI','A16795','chhaya','SB'                        
-- select * from payin  where posted_status='N' AND (App_status <> 'A' OR App_status is null)                          
-- select * from payin  where App_status <> 'A' or (posted_status='N' and App_Status='')                          
---------------------------------------------------------------------------------------------------------                              
IF @flag='1'                              
BEGIN                              
 SELECT segment,srno,CONVERT(VARCHAR(11),EDate,103) Edate,CltCode,CONVERT(DECIMAL(17,2),Amount) Amount,                              
 DDNo,BankCode,chqName,BranchName,Narration,Accountno FROM payin A (NOLOCK)    
 LEFT outer join risk.dbo.client_details B  on A.cltcode=B.party_code                               
 WHERE posted_status='N' AND (App_status <> 'A' OR App_status is null) AND segment=@segment                           
 AND entered_by=@CreatedBy and sub_broker=@sb       
 ORDER BY  EDate desc                            
END                              
---------------------------------------------------------------------------------------------------------                              
ELSE IF @flag='2'                              
BEGIN                              
 SELECT COUNT(1) cnt FROM risk..client_details (NOLOCK) WHERE sub_broker=@sb                              
END                              
---------------------------------------------------------------------------------------------------------                              
ELSE IF @flag='3'                              
BEGIN                              
 SELECT BankCode+'-'+BankName+'-'+CMSCode BankName,SrNo             
 FROM Voucher_Entry_Acc_Details (NOLOCK) WHERE Segment=@segment                              
END                              
---------------------------------------------------------------------------------------------------------                              
ELSE IF @flag='4'                              
BEGIN                       
                  
 select short_name                     
 from  risk.dbo.client_details b(nolock) where b.party_code=@partyCode and sub_broker=@sb                  
                         
 SELECT DISTINCT bankname=bankname+'['+branch+']',Acnum                   
 FROM AngelNseCM.msajag.dbo.party_bank_Details with(NOLOCK)                     
 WHERE bankname NOT LIKE 'UNKNOWN%'                               
 AND exchange LIKE ''+@segment+'%' and party_code=@partyCode ORDER BY 1                       
                
                    
END                              
---------------------------------------------------------------------------------------------------------                              
ELSE IF @flag='5'                              
BEGIN                              
declare @str nvarchar(1000)                      
set @str=''                      
                      
                    --AND entered_by='''+@CreatedBy+'''     
 set @str='SELECT a.srno,branch_cd,sub_broker,CONVERT(VARCHAR(11),EDate,103) Date,''  ''+CltCode CltCode,Amount,DDNo,a.BankCode,                              
    c.BankName,a.BranchName FROM payin a (NOLOCK)                              
 left outer JOIN risk.dbo.client_Details b (NOLOCK) ON a.cltcode=b.party_code                              
 left outer JOIN Voucher_Entry_Acc_Details c (NOLOCK) ON a.bankcode=c.bankcode and a.segment=c.segment                               
 WHERE isnull(App_status,'''')=''''                                
 AND a.segment='''+@segment+'''    
 AND posted_status=''N'' ' +risk.dbo.GetFilterString_final(@access_to,@sb,'and','branch_cd','sub_broker')       
 +' ORDER BY  EDate desc'                    
print @str                          
EXECUTE sp_executesql @str                      
                             
END                              
---------------------------------------------------------------------------------------------------------                              
ELSE IF @flag='6'                              
BEGIN                           
 SELECT Segment,COUNT(1) Cnt FROM payin (nolock)    
 WHERE posted_status='N' AND App_status='A'     
    GROUP BY Segment                                
END                              
---------------------------------------------------------------------------------------------------------                              
ELSE                               
BEGIN                              
 SELECT col='Invalid input'                  
END                           
Set Nocount Off                   
---------------------------------------------------------------------------------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetConnection
-- --------------------------------------------------
create proc USP_GetConnection
(
@ModuleId int =0
)
as begin

Select * from tbl_Connection con join tbl_Module_Mapping module
on con.ConnectionId =module.ConnectionId 
and module .ModuleId =@ModuleId 

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GetEmp
-- --------------------------------------------------
CREATE proc USP_GetEmp
@emp_no varchar(20)
as begin
select * from risk.dbo.emp_info  where emp_no =@emp_no 
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GETREPORTDATA
-- --------------------------------------------------
    
CREATE proc [dbo].[USP_GETREPORTDATA]      
(      
@Filterdata1 varchar(max)='',      
@Filterdata2 varchar(max)='',      
@Filterdata3 varchar(max)='',      
@Filterdata4 varchar(max)='',      
@Filterdata5 varchar(max)='',      
@Filterdata6 varchar(max)='',      
@Filterdata7 varchar(max)='',      
@Filterdata8 varchar(max)='',      
@Filterdata9 varchar(max)='',      
@Filterdata10 varchar(max)='',      
@Process varchar(100)=''      
)as begin      
print @process      
if @Process='getdata'      
begin      
 select top 1 * from pdfdemo
end      
      
      

  
      
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GlobalParameter
-- --------------------------------------------------
  
CREATE proc [dbo].[USP_GlobalParameter]      
(      
@Process varchar(50)='',        
@ParamId int =0,      
@Key varchar(50)='',      
@Value varchar(50)='',    
@CreatedDate varchar(50)='',        
@CreatedBy varchar(50)='',        
@ModifiedDate varchar(50)='',        
@ModifiedBy varchar(50)='',        
@Isapproved int =0,        
@cnt int=0 output       
       
)      
as begin      
set @cnt=0       
if (@Process ='Add Parameter')        
 begin       
        begin try      
        select @cnt= COUNT (1)from tbl_GlobalParameter where [KEY] =@Key  and (Isapproved =1 or Isapproved =0)      
      
  if (@cnt=0)        
  begin              
  INSERT INTO [tbl_GlobalParameter] ([KEY],[Value],[CreatedDate],[CreatedBy],[Isapproved])      
  VALUES(@key,@Value ,GETDATE(),@CreatedBy,0)      
  end      
        end try      
              
        begin catch      
        set @cnt=-1      
        end catch      
              
 end   
   
   
 if (@Process ='Edit Parameter')        
 begin       
        begin try      
        select @cnt= COUNT (1)from tbl_GlobalParameter where [KEY] =@Key and ParamId <>@ParamId  and (Isapproved =1 or Isapproved =0)      
      
  if (@cnt=0)        
  begin              
   update tbl_GlobalParameter      
   set   
   [KEY] =@KEY ,  
   Value =@Value ,    
   ModifyBy  =@ModifiedBy ,      
   ModifiedDate =GETDATE ()      
   where ParamId  =@ParamId    
  end      
        end try      
              
        begin catch      
        set @cnt=-1      
        end catch      
              
 end      
       
 if (@Process ='Delete Parameter')        
 begin        
     update tbl_GlobalParameter      
     set Isapproved =9,      
     ModifyBy  =@ModifiedBy ,      
     ModifiedDate =GETDATE ()      
      where ParamId  =@ParamId        
 end       
     
  if (@Process ='GET PARAM')      
 begin      
  select * from   tbl_GlobalParameter     
   where Isapproved =0 or Isapproved =1    
 end   
 
 if (@Process ='GetParamByKey')      
 begin      
   select *
   from   tbl_GlobalParameter     
   where Isapproved =0 or Isapproved =1 and [key]=@Key    
 end   
     
  
   
     
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_GlobalReport
-- --------------------------------------------------

CREATE proc [dbo].[USP_GlobalReport]  
 @Process as varchar(100)='',
 @Rpt_srno  as int =0 ,  
 @Rpt_ServerName as varchar(100) ='',  
 @Rpt_Username as varchar(100) ='',  
 @Rpt_Pswd as varchar(100) ='',  
 @Rpt_DatabaseName as varchar(100) ='',  
 @Rpt_QueryName as varchar(100) ='',  
 @Rpt_Parameter varchar(150)='' ,  
 @Rpt_Title as varchar(200)='' ,  
 @Rpt_ComputeColNo as varchar(100) ='',  
 @Rpt_Paging as int=0 ,  
 @Rpt_WithSrno as int=0 ,  
 @FooterNote  as varchar(250)='' ,  
 @AddedBy as varchar(100) ='',  
 @AddedOn as datetime=null ,  
 @MachineIP as varchar(100) ='',  
 @ColHide as varchar(25)='' ,  
 @RowColor as varchar(25) ='',  
 @TableHead as varchar(8000)='' ,  
 @FooterNote1 as varchar(1000)='' ,  
 @ReportHead as varchar(500)='' ,  
 @Rpt_ExportOnly as varchar(1)='' ,  
 @ColFreeze as int=0 ,  
 @ColBold as int=0,  
 @TitleFromQuery as varchar(1)='' ,  
 @RecordToDisplay as varchar(1000)='' ,  
 @Rpt_opt as varchar(9)='' ,  
 @helppage as varchar(100) ='',  
 @RptInfo as varchar(100) ='',  
 @ColColour as varchar(20)='' ,  
 @Delimiter as varchar(10)='' ,  
 @forExcel as bit=0 ,  
 @forCSV as bit=0 ,  
 @forPDF as bit =0,
 @IsApproved int =0,  
 @cnt int=0 output    
 as begin  

IF @Process ='ADD GLOBAL MST'
BEGIN
INSERT INTO [tbl_mst_Globalreport] ([Rpt_ServerName],[Rpt_Username],[Rpt_Pswd],[Rpt_DatabaseName],[Rpt_QueryName],[Rpt_Parameter],[Rpt_Title],[Rpt_ComputeColNo],[Rpt_Paging],[Rpt_WithSrno],[FooterNote],[AddedBy],[AddedOn],[MachineIP],[ColHide],[RowColor],[TableHead],[FooterNote1],[ReportHead],[Rpt_ExportOnly],[ColFreeze],[ColBold],[TitleFromQuery],[RecordToDisplay],[Rpt_opt],[helppage],[RptInfo],[ColColour],[Delimiter],[forExcel],[forCSV],[forPDF])  
values (@Rpt_ServerName,@Rpt_Username,@Rpt_Pswd,@Rpt_DatabaseName,@Rpt_QueryName,@Rpt_Parameter,@Rpt_Title,@Rpt_ComputeColNo,@Rpt_Paging,@Rpt_WithSrno,@FooterNote,@AddedBy,@AddedOn,@MachineIP,@ColHide,@RowColor,@TableHead,@FooterNote1,@ReportHead,@Rpt_ExportOnly,@ColFreeze,@ColBold,@TitleFromQuery,@RecordToDisplay,@Rpt_opt,@helppage,@RptInfo,@ColColour,@Delimiter,@forExcel,@forCSV,@forPDF)  
END 

IF @Process ='GET_ALL_REPORT_MASTER'
BEGIN
select 
			[Rpt_srno]
			,[Rpt_ServerName]
			,[Rpt_Username]
			,[Rpt_Pswd]
			,[Rpt_DatabaseName]
			,[Rpt_QueryName]
			,[Rpt_Parameter]
			,[Rpt_Title]
			,[Rpt_ComputeColNo]
			,[Rpt_Paging]
			,[Rpt_WithSrno]
			,[FooterNote]
			,[AddedBy]
			,[AddedOn]
			,[MachineIP]
			,[ColHide]
			,[RowColor]
			,[TableHead]
			,[FooterNote1]
			,[ReportHead]
			,[Rpt_ExportOnly]
			,[ColFreeze]
			,[ColBold]
			,[TitleFromQuery]
			,[RecordToDisplay]
			,[Rpt_opt]
			,[helppage]
			,[RptInfo]
			,[ColColour]
			,[Delimiter]
			,[forExcel]
			,[forCSV]
			,[forPDF]
			,[IsApproved]
			from tbl_mst_Globalreport
END 


IF @Process ='GET_REPORT_MASTERDETAILS_BYID'
BEGIN
select 
[Rpt_srno]
			,[Rpt_ServerName]
			,[Rpt_Username]
			,[Rpt_Pswd]
			,[Rpt_DatabaseName]
			,[Rpt_QueryName]
			,[Rpt_Parameter]
			,[Rpt_Title]
			,[Rpt_ComputeColNo]
			,isnull([Rpt_Paging],0) as Rpt_Paging
			,isnull([Rpt_WithSrno],0) as Rpt_WithSrno
			,[FooterNote]
			,[AddedBy]
			,[AddedOn]
			,[MachineIP]
			,[ColHide]
			,[RowColor]
			,[TableHead]
			,[FooterNote1]
			,[ReportHead]
			,isnull([Rpt_ExportOnly],0) as Rpt_ExportOnly
			,isnull([ColFreeze],0) as ColFreeze
			,isnull([ColBold],0) as ColBold
			,[TitleFromQuery]
			,[RecordToDisplay]
			,[Rpt_opt]
			,[helppage]
			,[RptInfo]
			,[ColColour]
			,[Delimiter]
			,isnull([forExcel],0) as forExcel
			,isnull([forCSV],0) as forCSV
			,isnull([forPDF],0) as forPDF
			,[IsApproved] from tbl_mst_Globalreport where Rpt_srno=@Rpt_srno 
END 
 

    
 end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_HIRINGMANAGE
-- --------------------------------------------------

CREATE PROC [dbo].[USP_HIRINGMANAGE]
@PROCESS    AS VARCHAR(50)='',
@PURPOSEID AS INT=0,
@BMID AS VARCHAR(20)='',
@SBID AS VARCHAR(20)='',
@NAME AS VARCHAR(20)='',
@BUSINESSPARTNERTAG AS VARCHAR(20)='',
@ADDRESS AS VARCHAR(500)='',
@CONTACTPERSON AS VARCHAR(50)='',
@CONTACTEMAILID AS VARCHAR(50)='',
@DESIGNATION AS VARCHAR(50)='',
@SALARYMIN AS VARCHAR(50)='',
@SALARYMAX AS VARCHAR(50)='',
@EDUQUALIFICATION AS VARCHAR(50)='',
@EXPERIENCEYEAR AS VARCHAR(50)='',
@EXPERIENCEMONTHS AS VARCHAR(50)='',
@RESOURCES AS VARCHAR(300)='',

@ID AS INT =0  

AS BEGIN

 
 IF @PROCESS ='ADD'
 BEGIN 
 

      INSERT INTO TBL_B2BHIRING(PURPOSEID,BMID ,SBID,NAME, BUSINESSPARTNERTAG , ADDRESS ,CONTACTPERSON ,CONTACTEMAILID ,DESIGNATION , SALARYMIN,SALARYMAX ,EDUQUALIFICATION ,EXPERIENCEYEAR,EXPERIENCEMONTHS, RESOURCES)
      VALUES(@PURPOSEID ,@BMID  ,@SBID ,@NAME , @BUSINESSPARTNERTAG  , @ADDRESS  ,@CONTACTPERSON  ,@CONTACTEMAILID  ,@DESIGNATION  , @SALARYMIN ,@SALARYMAX  ,@EDUQUALIFICATION  ,@EXPERIENCEYEAR ,@EXPERIENCEMONTHS , @RESOURCES)
     
 
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_HolidayMaster
-- --------------------------------------------------
CREATE proc USP_HolidayMaster
@Process varchar(50)='',
@ID int =0,
@HoliDate varchar(50)='',
@Discription varchar(50)='',
@FromHr varchar(50)='',
@FromMin varchar(50)='',
@ToHr varchar(50)='',
@ToMin varchar(50)='',
@CreatedBy varchar(50)='',
@CreatedOn varchar(50)='',
@ModifyBy varchar(50)='',
@ModifyOn varchar(50)='',
@IsDelete int=0
 as begin 
 
 if @Process ='Add'
 begin
 insert into tbl_HolidayMaster (HoliDate,Discription,FromHr,FromMin,ToHr,ToMin,CreatedBy,CreatedOn,ModifyBy,ModifyOn,IsDelete)
 values (@HoliDate,@Discription,@FromHr,@FromMin,@ToHr,@ToMin,@CreatedBy,@CreatedOn,@ModifyBy,@ModifyOn,@IsDelete) 
 end

 
 end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Inhouse_Exception
-- --------------------------------------------------
create proc USP_Inhouse_Exception
@process varchar(20)='',
@Id int=0,
@Source varchar(30)='',
@Message varchar(300)='',
@StackTrace varchar(1000) ='',
@UserId varchar(50)='',
@OccuredOn datetime=null,
@Isresolved bit=0,
@ResolvedBy varchar(50)='',
@ResolvedOn datetime=null
as begin
    
	If (@process='Add Error')
	begin
	INSERT INTO [tbl_Inhouse_Exception] ([Source],[Message],[StackTrace],[UserId],[OccuredOn],[Isresolved],[ResolvedBy],[ResolvedOn])
	VALUES(@Source,@Message,@StackTrace,@UserId,getdate(),0,NULL,NULL)
	end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_LEAFLETMANAGE
-- --------------------------------------------------

CREATE PROC [dbo].[USP_LEAFLETMANAGE]
@PROCESS    AS VARCHAR(50)='',
@PURPOSEID AS INT=0,
@BMID AS VARCHAR(20)='',
@SBID AS VARCHAR(20)='',
@PARTNERTAG AS VARCHAR(50)='',
@PARTNARNAME AS VARCHAR(200)='',
@LANDLINENUM AS VARCHAR(50)='',
@MOBILENUM AS VARCHAR(50)='',
@EMAIL AS VARCHAR(50)='',
@ADDRESS AS VARCHAR(500)='',
@LEAFLET AS VARCHAR(500)='',
@PARTICULARS AS VARCHAR(500)='',
@ID AS INT =0  

AS BEGIN

 
 IF @PROCESS ='ADD'
 BEGIN 
 

      INSERT INTO TBL_LEAFLET(PURPOSEID,   BMID, SBID, PARTNERTAG, PARTNARNAME,LANDLINENUM, MOBILENUM ,  EMAIL,   ADDRESS,   LEAFLET,   PARTICULARS)
      VALUES( @PURPOSEID,@BMID,@SBID,@PARTNERTAG,@PARTNARNAME,@LANDLINENUM,@MOBILENUM ,@EMAIL,@ADDRESS,@LEAFLET,@PARTICULARS)
     
     
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MARKETINGCOLMANAGE
-- --------------------------------------------------

CREATE PROC [dbo].[USP_MARKETINGCOLMANAGE]
@PROCESS    AS VARCHAR(50)='',
@PURPOSEID AS INT=0,
@BMID AS VARCHAR(20)='',
@SBID AS VARCHAR(20)='',
@Zone AS VARCHAR(20)='',
@Region AS VARCHAR(20)='',
@BRANCHTAG AS VARCHAR(500)='',
@BUSINESSPARTNERTAG AS VARCHAR(50)='',
@PARTNERNAME AS VARCHAR(200)='',
@MATERIALTYPE AS VARCHAR(200)='',
@MATERIALSIZE AS VARCHAR(50)='',
@DISPATCHLOCATION AS VARCHAR(500)='',
@CONTACTPERSONNAME AS VARCHAR(200)='',
@PARTNERADDRESS AS VARCHAR(500)='',
@CITY AS VARCHAR(50)='',
@STATE AS VARCHAR(300)='',
@CONTACTNUMBER AS VARCHAR(50)='',


@ID AS INT =0  

AS BEGIN

 
 IF @PROCESS ='ADD'
 BEGIN 
 

      INSERT INTO tbl_B2BMktCollateral( PURPOSEID,   BMID,SBID ,ZONE ,REGION,   BRANCHTAG,BUSINESSPARTNERTAG, PARTNERNAME,MATERIALTYPE, MATERIALSIZE, DISPATCHLOCATION, CONTACTPERSONNAME,PARTNERADDRESS  , CITY, STATE,CONTACTNUMBER)
      VALUES( @PURPOSEID ,  @BMID ,@SBID  ,@ZONE  ,@REGION ,  @BRANCHTAG ,@BUSINESSPARTNERTAG , @PARTNERNAME ,@MATERIALTYPE , @MATERIALSIZE , @DISPATCHLOCATION , @CONTACTPERSONNAME ,@PARTNERADDRESS   , @CITY , @STATE ,@CONTACTNUMBER)
     
     
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MEETINGMANAGE
-- --------------------------------------------------
CREATE PROC [dbo].[USP_MEETINGMANAGE]
@PROCESS    AS VARCHAR(50)='',
@BMUSERID AS VARCHAR(50)='',
@COMPLIANCE AS BIT=0,
@MEETINGSTATUS AS BIT=0,
@SBTAG AS VARCHAR(20)='',
@VISITDATE AS VARCHAR(50)='',
@REMARK AS VARCHAR(500)='',
@LASTMEETING AS VARCHAR(50)='',
@SESSIONID AS VARCHAR(100)='',
@ID AS INT =0  

AS BEGIN
 SET NOCOUNT ON;
 
 IF @PROCESS ='ADD MEETING'
 BEGIN 
 DECLARE @CHK AS INT
 SET @CHK =0
 
 SELECT @CHK=COUNT(1) FROM TBL_B2BMAINTRANSACTION WHERE SESSIONID=@SESSIONID AND BMUSERID =@BMUSERID 
 
 IF @CHK=0
 BEGIN
      INSERT INTO TBL_B2BMAINTRANSACTION(BMUSERID,COMPLIANCE,MEETINGSTATUS,SBTAG,VISITDATE,REMARK,LASTMEETING,SESSIONID,ISARCHIVE)
      VALUES(@BMUSERID,@COMPLIANCE,@MEETINGSTATUS,@SBTAG,@VISITDATE,@REMARK,@LASTMEETING,@SESSIONID,0)
     
     SELECT  SCOPE_IDENTITY() AS ID; 
 END
 
 END

  IF @PROCESS ='GET LOG'
  BEGIN
  --   select SBTAG ,c.BMAction,VISITDATE,TARGETDATE as 'TARGET DATE', b.Status  from
  --      (select ID , SBTAG ,VISITDATE,'Process' status  from TBL_B2BMAINTRANSACTION where BMUSERID =@BMUSERID)a
  --      join (select BMACTION ,MEETINGID,TARGETDATE, case when ( BMSTATUS=0 )then 'InProcess' else 
		--case when ( BMSTATUS=1 ) then 'Done' else
		--case when ( BMSTATUS=2 ) then 'Delay' else
		--case when ( BMSTATUS=3 ) then 'Rejected' 
		--end end end end as Status  from TBL_B2BPURPOSETRANSACTION  )b
  --      on b.MEETINGID =a.ID 
  --      join (select BID ,BMAction  from tbl_B2BMActionMaster)c
  --      on c.BID =b.BMACTION

   select SBTAG ,c.BMAction,VISITDATE,TARGETDATE as 'TARGET DATE', b.Status,b.ID   from
        (select ID , SBTAG ,VISITDATE,'Process' status  from TBL_B2BMAINTRANSACTION where BMUSERID =@BMUSERID)a
        join (select BMACTION ,MEETINGID,TARGETDATE, case when ( BMSTATUS=0 )then 'InProcess' else 
		case when ( BMSTATUS=1 ) then 'Done' else
		case when ( BMSTATUS=2 ) then 'Delay' else
		case when ( BMSTATUS=3 ) then 'Rejected' 
		end end end end as Status,ID  from TBL_B2BPURPOSETRANSACTION  )b
        on b.MEETINGID =a.ID 
        join (select BID ,BMAction  from tbl_B2BMActionMaster)c
        on c.BID =b.BMACTION

  END


    IF @PROCESS ='SENDMAIL'
  BEGIN
 
   EXEC USP_B2B_MAILER @ID

  END
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MICROSITEMANAGE
-- --------------------------------------------------

CREATE PROC [dbo].[USP_MICROSITEMANAGE]
@PROCESS    AS VARCHAR(50)='',
@ID AS INT=0,
@BMID AS VARCHAR(20)='',
@SBID AS VARCHAR(20)='',
@PURPOSEID AS VARCHAR(50)='',
@QUESTIONS AS VARCHAR(MAX),
@BUSINESSOFFERING AS varchar(200)='',
@SBTAG AS VARCHAR(50)='',
@FIRMESTABLISHEDYEAR AS VARCHAR(50)='',
@WEBSITENAME AS VARCHAR(500)='',
@DESCRIBEFIRM AS VARCHAR(500)='',
@WHYUSOTHER AS VARCHAR(500)='',
@NAME AS VARCHAR(500)='',
@COMPANY AS VARCHAR(500)='',
@ADDRESS AS VARCHAR(500)='',
@ADDRESS2 AS VARCHAR(500)='',
@CITY AS VARCHAR(500)='',
@STATE AS VARCHAR(500)='',
@POSTALCODE AS VARCHAR(500)='',
@EMAILID AS VARCHAR(500)='',
@PHONE AS VARCHAR(500)='',
@FACEBOOKLINK AS VARCHAR(500)='',
@TWITTERLINK AS VARCHAR(500)='',
@THEME AS VARCHAR(500)='',
@COMPANYLOGO AS VARCHAR(500)=''


AS BEGIN

 
 IF @PROCESS ='ADD'
 BEGIN 
 

      INSERT INTO TBL_B2BMICROSITE(BMID,SBID,PURPOSEID,QUESTIONS,BUSINESSOFFERING,SBTAG,FIRMESTABLISHEDYEAR,WEBSITENAME,WHYUSOTHER,NAME,COMPANY,ADDRESS,ADDRESS2,CITY,STATE,POSTALCODE,EMAILID,PHONE,FACEBOOKLINK,TWITTERLINK,THEME,COMPANYLOGO,LEAFLET)
      VALUES(  @BMID, @SBID, @PURPOSEID, @QUESTIONS, @BUSINESSOFFERING, @SBTAG, @FIRMESTABLISHEDYEAR, @WEBSITENAME,  @WHYUSOTHER, @NAME, @COMPANY, @ADDRESS, @ADDRESS2, @CITY, @STATE, @POSTALCODE, @EMAILID, @PHONE, @FACEBOOKLINK, @TWITTERLINK, @THEME, @COMPANYLOGO,@DESCRIBEFIRM)
     
     
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MOB_Client_Details
-- --------------------------------------------------
CREATE Proc [dbo].[USP_MOB_Client_Details]  
@FilterData1 as varchar(50)  
  
as begin   
  
  
  
  
IF OBJECT_ID('tempdb..#nrmsclient') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #nrmsclient  
     
   IF OBJECT_ID('tempdb..#tbl_client_master') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #tbl_client_master  
     
     
   IF OBJECT_ID('tempdb..#dpclient') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #dpclient  
     
      IF OBJECT_ID('tempdb..#POSTATUS') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #POSTATUS  
     
     
     IF OBJECT_ID('tempdb..#BankDetails') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #BankDetails  
     
     
   declare @seg as varchar(500)=' '  
  
SELECT  short_name AS 'ClientName',cl_code as 'ClientCode',mobile_pager as 'Mobile',branch_cd as 'Branch',  
 email as 'Emailid',l_address1 +','+l_address2+','+l_address3+','+l_city +','+l_state as 'Address',  
 DpId1 as 'Demat Number',AC_Num as 'Bank Account Number' ,@seg as Segment,case when last_inactive_date >=getdate() then 'Active' else 'Inactive' end 'Active/Deactive',bsecm,nsecm,nsefo,mcdx,ncdx,bsefo,mcd into #nrmsclient FROM INTRANET.RISK.DBO.client_Details with (nolock)  
 where cl_code=@FilterData1  
   
 --select bsecm from  INTRANET.RISK.DBO.client_Details  where cl_code=@FilterData1  
  
   
   
 update #nrmsclient  
 set Segment=cast (Segment as varchar(5000))+case when bsecm='Y' then 'BSECM'   end   
 from  
#nrmsclient  
   
   
   
  
   
 update #nrmsclient  
 set Segment=Segment+ case when nsecm='Y' then  ','+'NSECM' else '' end   
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when nsefo='Y' then ','+'NSEFO' else '' end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when mcdx='Y' then ','+'MCX' else '' end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when ncdx='Y' then ','+'NCDEX' else ''  end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when bsefo='Y' then ','+'BSEFO' else ''  end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when mcd='Y' then ','+ 'MCD' else ''  end  
 from  
#nrmsclient  
   
   
 select nise_party_code,poa_ver into #POSTATUS from [AngelDP4].Inhouse.DBO.tbl_client_master c with(nolock)    
  where nise_party_code=@FilterData1 and status='ACTIVE'  
  
select  top 1 * into #BankDetails from risk.dbo.clientbankdetails where cltcode=@FilterData1  
   
   
 select top 1  T.client_code,T.sub_type,T.bank_name,T.bank_accno,T.micr_code, [IFSC]=T.DIVIDEND_BRANCH_NO  ,  
 T.BANK_ADD1,T.BANK_ADD2,T.BANK_ADD3,T.BANK_ZIP, T.RGESS_FLAG,T.BSDA_FLAG,T.ELECTRONIC_DIVIDEND ,  
 case when rtrim(ltrim(T.NOMI_GUARD_NAME))='' or T.NOMI_GUARD_NAME is null then 'N'  else 'Y' end as Nominee_Flag ,  
 case when rtrim(ltrim(T.MINOR_BIRTH_DATE))='' or T.MINOR_BIRTH_DATE is null then 'N'  else 'Y' end as Minor_Flag,   
 NOMI_GUard_name,T.NISE_PARTY_CODE,template_code into #tbl_client_master from [AngelDP4].inhouse.dbo.tbl_client_master T WITH (NOLOCK) where NISE_PARTY_CODE =@FilterData1 and status='Active'  
   
 declare @client_code as varchar(500)  
 select @client_code=client_code from #tbl_client_master  
   
 SELECT A.CLIENT_ID, A.CLIENT_CODE, A.ACCTYPE, A.NAME, A.FATHER_HUSBAND_NAME,   
A.DOB, A.ACC_STATUS, A.OPEN_DATE,  A.CLOSE_DATE, A.CADD1, A.CADD2, A.CADD3, A.CCITY, A.CSTATE,   
A.CCOUNTRY, A.CPIN, A.CPHONE, A.CFAX,  A.CMOBILE, A.SH_NAME,A.SH_PAN, A.TH_NAME, A.TH_PAN,  
 A.EMAIL, A.ECN, A.FHPAN, A.SMARTFLAG,  A.FOREIGN_ADDR1,A.FOREIGN_ADDR2,A.FOREIGN_ADDR3,  
 A.FOREIGN_CITY,A.FOREIGN_STATE  ,A.FOREIGN_CNTRY,A.FOREIGN_ZIP,A.FOREIGN_PHONE,A.FOREIGN_FAX  ,  
 T.sub_type,b.bank_name,b.bank_accno,T.template_code as 'AMC', t.[IFSC],  
 T.BANK_ADD1,T.BANK_ADD2,T.BANK_ADD3,T.BANK_ZIP, T.RGESS_FLAG,T.BSDA_FLAG,T.ELECTRONIC_DIVIDEND ,  
 Nominee_Flag , Minor_Flag,   
 NOMI_GUard_name,T.NISE_PARTY_CODE  into #dpclient FROM( select top 1 * from  [mis].demat.dbo.DP_ACCESS_CLIPROFILE WITH (NOLOCK) where CLIENT_CODE=@client_code ) A    
 inner join (select * from #tbl_client_master T WITH (NOLOCK)) T  
   
  on T.client_code = A.CLIENT_CODE ,  
  (select cltcode,bank_name as 'bank_name',acno as 'bank_accno' from #BankDetails  with(nolock))b  
    
    
   select x.ClientName,x.ClientCode,x.Mobile + '&nbsp;&nbsp;&nbsp;&nbsp;<a href=tel:'+x.Mobile+' ><span class=''glyphicon glyphicon-earphone''> </span> </a>' as 'Mobile',x.Branch,x.Emailid + '&nbsp;&nbsp;&nbsp;&nbsp;<a href=mailto:'+x.Emailid+' ><span cla
ss=''glyphicon glyphicon-envelope''> </span> </a>' as Email,x.Address,y.CLIENT_CODE as 'Demat Number',y.bank_name as 'Bank Name',y.bank_accno as'Bank Account Number',case when y.Ecn='Y' then 'ECN' else '-' end as Contract,  
  case when  z.poa_ver IS NULL then 'POA NOT OPTED' else 'POA OPTED' end as 'POA STATUS' ,  
   x.Segment,y.AMC,x.[Active/Deactive]  
   --, '<a href=''/Main/BrokerDetails?ClientCode='+@FilterData1+'  ''>Click here</a> ' as 'Brokerage Scheme'    
    from   
 (select * from #nrmsclient)x  
left outer join   
(select * from #dpclient)y  
 on x.ClientCode=y.NISE_PARTY_CODE  
 left outer join  
 (select nise_party_code,poa_ver from #POSTATUS)z  
 on x.clientcode=z.nise_party_code  
   
   
   
  
   DROP TABLE #nrmsclient  
     
  
   DROP TABLE #tbl_client_master  
     
  
   DROP TABLE #dpclient  
     
   drop table #POSTATUS  
   end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MOB_Client_Details_25jan2022
-- --------------------------------------------------
  
  
  
CREATE Proc [dbo].[USP_MOB_Client_Details_25jan2022]  
@FilterData1 as varchar(50)  
  
as begin   
  
  
  
  
IF OBJECT_ID('tempdb..#nrmsclient') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #nrmsclient  
     
   IF OBJECT_ID('tempdb..#tbl_client_master') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #tbl_client_master  
     
     
   IF OBJECT_ID('tempdb..#dpclient') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #dpclient  
     
      IF OBJECT_ID('tempdb..#POSTATUS') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #POSTATUS  
     
     
     IF OBJECT_ID('tempdb..#BankDetails') IS NOT NULL  
/*Then it exists*/  
   DROP TABLE #BankDetails  
     
     
   declare @seg as varchar(500)=' '  
  
SELECT  short_name AS 'ClientName',cl_code as 'ClientCode',mobile_pager as 'Mobile',branch_cd as 'Branch',  
 email as 'Emailid',l_address1 +','+l_address2+','+l_address3+','+l_city +','+l_state as 'Address',  
 DpId1 as 'Demat Number',AC_Num as 'Bank Account Number' ,@seg as Segment,case when last_inactive_date >=getdate() then 'Active' else 'Inactive' end 'Active/Deactive',bsecm,nsecm,nsefo,mcdx,ncdx,bsefo,mcd into #nrmsclient FROM INTRANET.RISK.DBO.client_Details with (nolock)  
 where cl_code=@FilterData1  
   
 --select bsecm from  INTRANET.RISK.DBO.client_Details  where cl_code=@FilterData1  
  
   
   
 update #nrmsclient  
 set Segment=cast (Segment as varchar(5000))+case when bsecm='Y' then 'BSECM'   end   
 from  
#nrmsclient  
   
   
   
  
   
 update #nrmsclient  
 set Segment=Segment+ case when nsecm='Y' then  ','+'NSECM' else '' end   
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when nsefo='Y' then ','+'NSEFO' else '' end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when mcdx='Y' then ','+'MCX' else '' end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when ncdx='Y' then ','+'NCDEX' else ''  end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when bsefo='Y' then ','+'BSEFO' else ''  end  
 from  
#nrmsclient  
   
 update #nrmsclient  
 set Segment=Segment+ case when mcd='Y' then ','+ 'MCD' else ''  end  
 from  
#nrmsclient  
   
   
 select nise_party_code,poa_ver into #POSTATUS from [172.31.16.94].Inhouse.DBO.tbl_client_master c with(nolock)    
  where nise_party_code=@FilterData1 and status='ACTIVE'  
  
select  top 1 * into #BankDetails from risk.dbo.clientbankdetails where cltcode=@FilterData1  
   
   
 select top 1  T.client_code,T.sub_type,T.bank_name,T.bank_accno,T.micr_code, [IFSC]=T.DIVIDEND_BRANCH_NO  ,  
 T.BANK_ADD1,T.BANK_ADD2,T.BANK_ADD3,T.BANK_ZIP, T.RGESS_FLAG,T.BSDA_FLAG,T.ELECTRONIC_DIVIDEND ,  
 case when rtrim(ltrim(T.NOMI_GUARD_NAME))='' or T.NOMI_GUARD_NAME is null then 'N'  else 'Y' end as Nominee_Flag ,  
 case when rtrim(ltrim(T.MINOR_BIRTH_DATE))='' or T.MINOR_BIRTH_DATE is null then 'N'  else 'Y' end as Minor_Flag,   
 NOMI_GUard_name,T.NISE_PARTY_CODE,template_code into #tbl_client_master from [172.31.16.94].inhouse.dbo.tbl_client_master T WITH (NOLOCK) where NISE_PARTY_CODE =@FilterData1 and status='Active'  
   
 declare @client_code as varchar(500)  
 select @client_code=client_code from #tbl_client_master  
   
 SELECT A.CLIENT_ID, A.CLIENT_CODE, A.ACCTYPE, A.NAME, A.FATHER_HUSBAND_NAME,   
A.DOB, A.ACC_STATUS, A.OPEN_DATE,  A.CLOSE_DATE, A.CADD1, A.CADD2, A.CADD3, A.CCITY, A.CSTATE,   
A.CCOUNTRY, A.CPIN, A.CPHONE, A.CFAX,  A.CMOBILE, A.SH_NAME,A.SH_PAN, A.TH_NAME, A.TH_PAN,  
 A.EMAIL, A.ECN, A.FHPAN, A.SMARTFLAG,  A.FOREIGN_ADDR1,A.FOREIGN_ADDR2,A.FOREIGN_ADDR3,  
 A.FOREIGN_CITY,A.FOREIGN_STATE  ,A.FOREIGN_CNTRY,A.FOREIGN_ZIP,A.FOREIGN_PHONE,A.FOREIGN_FAX  ,  
 T.sub_type,b.bank_name,b.bank_accno,T.template_code as 'AMC', t.[IFSC],  
 T.BANK_ADD1,T.BANK_ADD2,T.BANK_ADD3,T.BANK_ZIP, T.RGESS_FLAG,T.BSDA_FLAG,T.ELECTRONIC_DIVIDEND ,  
 Nominee_Flag , Minor_Flag,   
 NOMI_GUard_name,T.NISE_PARTY_CODE  into #dpclient FROM( select top 1 * from  [mis].demat.dbo.DP_ACCESS_CLIPROFILE WITH (NOLOCK) where CLIENT_CODE=@client_code ) A    
 inner join (select * from #tbl_client_master T WITH (NOLOCK)) T  
   
  on T.client_code = A.CLIENT_CODE ,  
  (select cltcode,bank_name as 'bank_name',acno as 'bank_accno' from #BankDetails  with(nolock))b  
    
    
   select x.ClientName,x.ClientCode,x.Mobile + '&nbsp;&nbsp;&nbsp;&nbsp;<a href=tel:'+x.Mobile+' ><span class=''glyphicon glyphicon-earphone''> </span> </a>' as 'Mobile',x.Branch,x.Emailid + '&nbsp;&nbsp;&nbsp;&nbsp;<a href=mailto:'+x.Emailid+' ><span cla
ss=''glyphicon glyphicon-envelope''> </span> </a>' as Email,x.Address,y.CLIENT_CODE as 'Demat Number',y.bank_name as 'Bank Name',y.bank_accno as'Bank Account Number',case when y.Ecn='Y' then 'ECN' else '-' end as Contract,  
  case when  z.poa_ver IS NULL then 'POA NOT OPTED' else 'POA OPTED' end as 'POA STATUS' ,  
   x.Segment,y.AMC,x.[Active/Deactive]  
   --, '<a href=''/Main/BrokerDetails?ClientCode='+@FilterData1+'  ''>Click here</a> ' as 'Brokerage Scheme'    
    from   
 (select * from #nrmsclient)x  
left outer join   
(select * from #dpclient)y  
 on x.ClientCode=y.NISE_PARTY_CODE  
 left outer join  
 (select nise_party_code,poa_ver from #POSTATUS)z  
 on x.clientcode=z.nise_party_code  
   
   
   
  
   DROP TABLE #nrmsclient  
     
  
   DROP TABLE #tbl_client_master  
     
  
   DROP TABLE #dpclient  
     
   drop table #POSTATUS  
   end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_MobInhouseLogin
-- --------------------------------------------------



CREATE proc [dbo].[USP_MobInhouseLogin]  
(  
@Process as varchar(30)='',  
@FilterData1 as varchar(100)='',  
@FilterData2 as varchar(100)='',  
@FilterData3 as varchar(500)='',  
@FilterData4 as varchar(100)='',  
@FilterData5 as varchar(100)='',  
@FilterData6 as varchar(100)='',  
@FilterData7 as varchar(100)='',  
@FilterData8 as varchar(100)='',  
@FilterData9 as varchar(100)=''  
)  
as begin   
  if @Process ='CheckUserStatus'  
  begin  
  declare @status as varchar(50)  
  select @status= status from Emp_info where emp_no=@FilterData1   
  if @status ='S'  
  begin  
  print @status  
  insert into ROLEMGM.dbo.login_logs values('Login Deactivated (HR)',0,@FilterData1,@FilterData3 ,GETDATE() )  
  end  
  else if @status ='0'  
  begin   
  print @status  
  insert into ROLEMGM.dbo.login_logs values('Login Deactivated (Admin)',0,@FilterData1,@FilterData3 ,GETDATE() )  
  end  
  select @status as 'status'  
  end  
    
 
  ---Added by pramod 2016
    if @Process ='UserLoginData'  
  begin  
  --WAITFOR DELAY '00:00:05'
     --select a.*,b.cat_name,logindt=(case when login_inactive_date > getdate() then 1 else 0 end),daydiff=datediff(day,getdate(),login_inactive_date),b.applicable_to,b.active as m_active,'../Images/ico1.png' as URL,isnull(l.LastLogin,)  
     --from ROLEMGM.dbo.user_login a (nolock) join ROLEMGM.dbo.menu_cat b (nolock) on a.cat_code=b.cat_code and username=@FilterData1   and access_to ='sb' and username is not null --and usertype ='admin'
     --left join (select UserId,max(LastLogin) as LastLogin from tbl_mobLoginDetails group by UserId)l
     --on username=l.UserId 
     
     --select z.*,isnull (l.LastLogin,'1900-01-01 00:00:00.000') as last_login from (select a.*,b.cat_name,logindt=(case when login_inactive_date > getdate() then 1 else 0 end),daydiff=datediff(day,getdate(),login_inactive_date),b.applicable_to,b.active as m_active,'../Images/ico1.png' as URL
     --from ROLEMGM.dbo.user_login a (nolock) join ROLEMGM.dbo.menu_cat b (nolock) on a.cat_code=b.cat_code and username=@FilterData1   and access_to ='sb' and username is not null)z --and usertype ='admin'
     --left join (select UserId,max(LastLogin) as LastLogin from tbl_mobLoginDetails group by UserId)l
     --on z.username=l.UserId 

	 declare @access_code as varchar(50)=''
	 declare @cnt as int =0

	 select @access_code=access_code from ROLEMGM.dbo.user_login where username=@FilterData1

	 select @cnt=count(1) from [CSOKYC-6].Franchisee.dbo.Franchisee_Mast with(nolock) where todate>=getdate() and Ftag=@access_code

     
     select CAST(isnull (l.LastLogin,'1900-01-01 00:00:00.000')as varchar(50)) as last_login, z.* from (select a.*,b.cat_name,logindt=(case when login_inactive_date > getdate() then 1 else 0 end),daydiff=datediff(day,getdate(),login_inactive_date),b.applicable_to,b.active as m_active,'../Images/ico1.png' as URL
     from(SELECT [userid],[person_name],[username],LOWER([userpassword]) AS userpassword, case when @cnt<>0 then 'FRANCHISEE' else [usertype] end as usertype ,[access_to],
     [access_code],[cat_code],[status],[last_login],[NoOfTry],[NoOfLogin],[login_Activated],
     [login_inactive_date],[active],[email],[IP],[IP_active],[Gateway],[Gateway_active],[session_id],
     [CreatedBy],[CreatedOn],[LastModifiedBy],[LastModifiedOn] FROM ROLEMGM.dbo.user_login (nolock)  WHERE username=@FilterData1 and username is not null) a join ROLEMGM.dbo.menu_cat b (nolock) on a.cat_code=b.cat_code    and access_to =case when @cnt=0 then 'sb' else 'branch' end )z --and usertype ='admin'
     left join (select UserId,max(LastLogin) as LastLogin from tbl_mobLoginDetails group by UserId)l
     on z.username=l.UserId 
      
  end 
    
  if @Process ='GetUserData'  
  begin  
     select department from emp_info where emp_no =@FilterData1   
  end  
  
  If @Process='ClientValidation'
  begin
  SELECT PARTY_CODE,LONG_NAME FROM INTRANET.RISK.DBO.VWMFSS_CLIENTDETAILS WITH (NOLOCK) WHERE PARTY_CODE=rtrim(ltrim(@FilterData1)) AND (SUB_BROKER=@FilterData2 or branch_cd=@FilterData2)
  end  
  
    
  if @Process ='AddSessionLog'  
  begin  
     insert into  ROLEMGM.dbo.session_log   
     select GETDATE(),@FilterData1 ,'Username',@FilterData2   
  end  
    
  if @Process ='NoOfTry'  
  begin  
      
     update ROLEMGM.dbo.user_login set NoOfTry=0 where username=@FilterData1   
  end  
    
  if @Process ='AddLoginLogs'  
  begin  
      
     insert into ROLEMGM.dbo.login_logs values(@FilterData1 ,@FilterData2,@FilterData3 ,@FilterData4,getdate())  
  end  
    
  if @Process ='GetUserDetails'  
  begin  
      
     select COUNT (1) as cnt from ROLEMGM.dbo.user_login where username=@FilterData1 and login_inactive_date<=convert(varchar(11),getdate())  
       
     select COUNT (1) as cnt from ROLEMGM.dbo.user_login where username=@FilterData1 and access_to='SB'   
       
     select COUNT (1) as cnt from ROLEMGM.dbo.user_login where username=@FilterData1   
       
     select userpassword from ROLEMGM.dbo.user_login where username=@FilterData1  
      
       
  end  
    
  if @Process ='AddNoOfTry'  
  begin  
      
     update ROLEMGM.dbo.user_login set NoOfTry=NoOfTry+1 where username=@FilterData1   
  end  
    
  if @Process ='GetNoOfTry'  
  begin  
      
     select NoOfTry from ROLEMGM.dbo.user_login  where username=@FilterData1   
  end  
    
  if @Process ='GetUserDataPWD'  
  begin  
      
     select * from ROLEMGM.dbo.user_login  where username=@FilterData1   
  end  
    
  if @Process ='AddPWDLogs'  
  begin  
     insert into forget_pwd_log values( getdate(), @FilterData1  , @FilterData2 , @FilterData3 , @FilterData3)  
  end  
  
	if @Process = 'GetMenu'  
	Begin  

	--select * from tbl_Mobmodule_master where  active =1  order by ParentId ,seq_no 
	
		--declare @usertype as varchar(20)
		--select @usertype= usertype from ROLEMGM.dbo.user_login  where  userid =@FilterData1

		--select * from (select * from tbl_Mobmodule_master where  active =1  )a
		--join
		--(select modid from tbl_AccessControl where Utype=@usertype)b
		--on a.PID =b.modid
		--order by ParentId ,seq_no

		declare @usertype as varchar(20)
		declare @accesscode as varchar(20)
		select @usertype= usertype,@accesscode=access_code from ROLEMGM.dbo.user_login  where  userid =@FilterData1

		select * from (select * from tbl_Mobmodule_master where  active =1  )a
		join
		(select modid from tbl_AccessControl where Utype=@usertype)b
		on a.PID =b.modid
		left join (select * from tbl_Access_denied where userid=@accesscode) c
		on a.PID=c.modid
		where c.modid is null
		order by ParentId ,seq_no


	End
	
if @Process = 'UpdateUserStatus'  
 Begin  
  
  insert into tbl_mobLoginDetails(UserId,SessionId,LastLogin,Location)
  values(@FilterData1,@FilterData2,GETDATE(),@FilterData3)
  
  --insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
  --values(@FilterData1,'Log in system from "'+@FilterData4+'"',GETDATE())
   
 End 
 
 if @Process = 'NRMSDATA'  
 Begin  
  
  --select 1326859.75 'Ledger' ,0.0 as 'Holding',30056890 as 'Margin',56238 as 'NetCollection',98.55 as 'PureRisk',0.00 as 'ProjectRisk','04/02/2016'as 'SquareOffDate',
  --1326859.75 'CLedger' ,0.0 as 'CHolding',30056890 as 'CMargin',56238 as 'CNetCollection',-98.55 as 'CPureRisk',0.00 as 'CProjectRisk','04/02/2016'as 'CSquareOffDate'
   Exec [CSOKYC-6].general.dbo.nrms_mob_client_detail @FilterData2,@FilterData1
   --select * from mob_ABPL_Ledger as ABPL
   --select * from mob_ABCPL_Ledger as ABCPL  
   
	declare @mob as varchar(20)
	select @mob=mobile_pager  FROM INTRANET.RISK.DBO.client_Details with (nolock)
	where cl_code=@FilterData1
 
   select Party_name as Client_name,Category,Cli_Type as [type],client as Client_code,Region,Branch,@mob as 'Contact' from [CSOKYC-6].general.dbo.vw_rms_client_vertical where client=@FilterData1




   
   
   
 End 
 
if @Process = 'Remiser'  
 Begin  
  
--select [Exchange],Segment ,CONVERT(varchar(100),CAST(GrossBrokerage as money),1) as [Gross Brokerage],CONVERT(varchar(100),CAST(Remiser as money),1) as Remiser from mob_remiser
---sp_remi_mob_SbDetails
exec [MIS].remisior.dbo.usp_remi_mob_SbDetails_datewise @FilterData1,@FilterData4,@FilterData5

   
 End 
if @Process = 'GetMobileAppUrl'  
 Begin  
    select 'http://sb.angelbackoffice.com' as XInhouseURL,'1.3' as XVersion 

   
 End 
 
 
 if @Process = 'GetFundDetails'  
 Begin  
  
 
  exec cms.dbo.NCMS_Mob_Marking1 @FilterData1

   
 End 
 
 if @Process = 'SharePayoutScript'  
 Begin  

 
  --select * from tbl_mob_ShareScripts where Client_code=@FilterData1
  
  --Exec [196.1.115.167].Demat.dbo.USP_SharesPayOut_UnderUAT_11FEB2016_MOB 'bk08', '', '0', 'F', '' 
  

 
  Exec [MIS].Demat.dbo.USP_SharesPayOut_Multy_MOB @FilterData1, '', 0, 'F', '' 

   
 End 
 
  if @Process = 'FundsPayout'  
 Begin  
 
 
  begin try

        Exec CMS.dbo.NCMS_MOB_UPD_Request @FilterData1,@FilterData2,@FilterData3,@FilterData4,@FilterData5,@FilterData6,@FilterData7,@FilterData8

		insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
		values(@FilterData3,'Funds payout for "'+@FilterData1 +'". Payout details: Segment-"'+@FilterData8+'", Bank Account-"'+@FilterData5+'", Amount-"'+@FilterData4+'", Device-"'+@FilterData7+'"',GETDATE())
		
		
 select 1 as 'output'
 end try
 
 begin catch 
 select 0 as 'output'
 end catch
 
  

   
 End 
 
 If @Process = 'GetFundsPayout'  
 Begin  
 
--WAITFOR DELAY '00:00:05'
 Exec CMS.dbo.NCMS_MOB_GetPODetail @FilterData1
 

 
 End 
 
  If @Process = 'CancelFundsPayout'  
 Begin  
 
--WAITFOR DELAY '00:00:20'
 Exec CMS.dbo.NCMS_MOB_Cancel @FilterData1,@FilterData2,@FilterData3
 
 select @FilterData4=Party_code ,@FilterData5=Req_RefNo  from  CMS.dbo.NCMS_Mob_Request where POrequestID=@FilterData1
 
       insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
		values(@FilterData2,'Funds payout cancelled for "'+@FilterData4 +'". Payout details: Reference No-"'+@FilterData5+'", Device-"'+@FilterData7+'"',GETDATE())
 

 
 End 
 
 
   If @Process = 'AddSharePayout'  
 Begin  
 

--Select @FilterData1,@FilterData2,@FilterData3
   --WAITFOR DELAY '00:00:05'
--Exec [196.1.115.167].demat.dbo.USP_SharesPayOut_UnderUAT_11FEB2016_MOB @FilterData1,@FilterData3,'0','U',@FilterData2                              

Exec [MIS].demat.dbo.USP_SharesPayOut_Multy_MOB  @FilterData1,@FilterData3,'0','U',@FilterData2 
 
  insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
  values(@FilterData2,'Share payout for "'+@FilterData1 +'". Payout details:'+replace (@FilterData3,',','-')+'. Device:"'+@FilterData4+'"',GETDATE())

 
 End 
 
 
 If @Process ='GetLog'
 begin
 
 select CONVERT(VARCHAR(5),logDate,108) as Time ,ActivityLog as Log from tbl_MobActivityLog where UserID=@FilterData1 and CAST( CAST(logDate as varchar(25)) as date)=CAST( CAST(GETDATE() as varchar(25)) as date) 
 order by ID desc
 
 end
 
 
 if @Process = 'Client_Details'  
 Begin  
  

exec USP_MOB_Client_Details @filterdata1
 

   
 End 
 
  if @Process = 'PerformanceMoniter'  
 Begin  
  
 
--select 'RP-80%;CA-30%;RPC-145;CA-10' as Result

exec INTRANET.RISK.DBO.sp_sbperformance_ind @filterdata2,@filterdata3,@filterdata2,'ADMIN','Select'


   
 End 
 
 
  if @Process = 'HoldingReport'  
 Begin  
  

exec [CSOKYC-6].general.dbo.MOB_RPT_HOLDING_SEC 'CLIENT',@FilterData1,'%',@FilterData2,'Broker','cso'  
--select * from [196.1.115.182].general.dbo.rms_holding
--where party_code  =@FilterData1 


   
 End
 
  If @Process='GETCLIENTNAME'
  begin
  SELECT PARTY_CODE,LONG_NAME as 'Client_Name' FROM INTRANET.RISK.DBO.VWMFSS_CLIENTDETAILS WITH (NOLOCK) WHERE PARTY_CODE=@FilterData1
  end  
    
    
      If @Process='GETSBPAYOUT'
  begin
  
  
  declare @branch as varchar(50)=''
  select @branch= Branch from [MIS].sb_comp.dbo.sb_broker where sbtag=@FilterData2
   
       exec [MIS].remisior.dbo.USP_SBPayoutMarking_MV_Mob @branch,@FilterData2
  end  
  
	If @Process='GETSBPAYOUTSUMMERY'
	begin
	exec [MIS].remisior.dbo.USP_SbRiskPayoutMarking_Mob @FilterData1
	end 
	
	If @Process='SBPayoutLock'
	begin
	
	select @branch= Branch from [MIS].sb_comp.dbo.sb_broker where sbtag=@FilterData2
	exec [MIS].remisior.dbo.chkSBPayoutAccess @FilterData2,@branch
	
	--select '0' as BLOCKED,'0' as SBBLOCKED
	
	end 
	
	
	If @Process='AddSBPayout'
	begin
	--WAITFOR DELAY '00:00:10'
	if @FilterData2='NaN'
	begin
	set @FilterData2 =null
	end
	
	if @FilterData3='NaN'
	begin
	set @FilterData3 =null
	end
	declare @maker as varchar(300)
	declare @dates as varchar(60)
	set @dates =CAST( MONTH (GETDATE()) as varchar(10))+'/'+cast (DAY (GETDATE()) as varchar(10))+'/'+cast(YEAR (getdate())as varchar(10))+' ' +  LTRIM(RIGHT(CONVERT(CHAR(20), CURRENT_TIMESTAMP, 22), 11))
	
	set @maker =@FilterData8+ ' | '+ @dates + ' | '+@FilterData4
	   exec [MIS].remisior.dbo.SP_UPDMARKEDAMT_MOB @FilterData1,@FilterData2,@FilterData3,@maker,@FilterData4,'N',@FilterData5
	   
	    declare @mark as varchar(60)='0.00'
	    if @FilterData6='ABL'
	    begin
	     set @mark=@FilterData2
	    end
	    else
	    begin
	     set @mark=@FilterData3
	    end
	    
	   insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
		values(@FilterData4,'Remiser payout Payout details: Compny-"'+@FilterData6+'", Marked Amount-"'+@mark+'", Device-"'+@FilterData8+'"',GETDATE())
		
	   select 'Success' as 'Status'
	end  
	
	
	If @Process='SENDPNL'
	begin
	
	
	exec INTRANET.RISK.DBO.usp_Advoc_ClientStatements_ForBO @filterdata1,@filterdata6,'PnLStatement',@filterdata4,@filterdata5,'BO',@filterdata7,@filterdata2,@filterdata1,@filterdata1,'SB' 
	
	 insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
		values(@filterdata1,'Profit & loss statement for-"'+@FilterData6+'", Date-"'+@filterdata4+'-'+@filterdata5+'", Location-"'+@filterdata7+'"',GETDATE())
		
		select 'Success' as status
	
	end 


		-----Limit Enhancer --start(12092016)

	if(@Process='GetSegment')    
		Begin    
		if exists(select * from [CSOKYC-6].general.dbo.client_details with(nolock) where cl_type in ('NBF','TMF') and party_code=@FilterData1)  
		 begin  
				 SELECT  'NBFC' as Segment,'NBFC' as SegmentVal  
		 end  
		 else  
		 Begin  
			 SELECT  'Equity+FNO+Curr' as Segment,'Equity+FNO+Curr' as SegmentVal    
		 union all  
			 SELECT  'Commodity' as Segment,'Commodity' as SegmentVal   
		 end  
		End 


if(@Process='CheckClientforLimit')    
Begin  
set @FilterData4=(select purerisk from [CSOKYC-6].general.dbo.tbl_rms_collection  with(nolock) where party_code=@FilterData3)
set @FilterData5=(select Intraday_type from [CSOKYC-6].general.dbo.alg_exp_mast with(nolock) where entity_code=@FilterData3 and isnull(Intraday_type,'0')<>'0' and isnull(Intraday_type,'')<>'' and isnull(Intraday_type,'')<>'Client2C')
if( CAST( @FilterData4 AS DECIMAL(38,2)) <-1000)
Begin
	 select 'CLient is in Pure Risk(Please call RMS team for taking limits)' as ErrMsg
End
if(@FilterData5<>'')
Begin
	select 'Intraday Code(Please call RMS team for taking limits)' as ErrMsg
End
 if exists (select * from intranet.mis.dbo.odinclientinfo with(nolock) where pcode=@FilterData3)
 Begin
 if exists (select * from intranet.risk.dbo.client_details c with(nolock) inner join intranet.mis.dbo.odinclientinfo  o with(nolock) on c.party_code=o.pcode where c.party_code=@FilterData3 and (c.sub_broker=@FilterData1 or c.branch_cd=@FilterData1) )
	 Begin
	 select pcode,pname,case when bbb in (4,134) then 'ONLINE' else 'OFFLINE' end as Status,Tag as tag,o.servermapped,case when @FilterData5<>'' then 'Intraday Code(Please call RMS team for taking limits)' else 'Not an Intraday code' end as IntradayCode,'' as ErrMsg from intranet.risk.dbo.client_details c with(nolock) inner join intranet.mis.dbo.odinclientinfo  o with(nolock) on c.party_code=o.pcode 
	 WHERE c.party_code=@FilterData3 and (c.sub_broker=@FilterData1 or c.branch_cd=@FilterData1)
	 End
	 Else
	 Begin
	 select 'Unmapped Client(Please Call RMS Team for Mapping)' as ErrMsg
	 End
 End
 else
 Begin
 select  'Unmapped Client(Please Call RMS Team for Mapping)' as ErrMsg
 End
End 


if(@Process='GetLimit')    
Begin  
if exists (select * from [CSOKYC-6].Franchisee.dbo.Franchisee_Mast with(nolock) where todate>=getdate() and Ftag=@FilterData1)
		Begin 
		Exec [INTRANET].LimitEnhancement.dbo.Prc_GetLimitAvailable_Franchise @FilterData1,@FilterData4 out
		print 'SBCredit'
		print @FilterData4
		end
		else
		Begin
		Exec [INTRANET].LimitEnhancement.dbo.Prc_GetLimitAvailable  @FilterData1,@FilterData4 out
		 print 'SBCredit'
		 print @FilterData4
		End 
if(@FilterData4='SB is in pure risk Additional Limit Cannot be Granted' or @FilterData4='Subbroker does not exists')
 Begin 
 select @FilterData4 as ErrMsg
 End
 else
 Begin
 select round(@FilterData4,0) as SBCredit,case when isnull((select Sum(EnterLimit)  from [INTRANET].LimitEnhancement.dbo.tbl_SBLimitAllocation where sbcode=@FilterData1 ),0) =0 then 0 
when  convert(money,round(@FilterData4,0))-isnull((select Sum(EnterLimit)  from [INTRANET].LimitEnhancement.dbo.tbl_SBLimitAllocation where sbcode=@FilterData1),0)=0 then round(@FilterData4,0) else  convert(money,round(@FilterData4,0))-isnull((select Sum(EnterLimit)  from [INTRANET].LimitEnhancement.dbo.tbl_SBLimitAllocation where sbcode=@FilterData1 ),0) end as LimitGivenD,'' as ErrMsg 

-- select @FilterData4 as SBCredit,case when isnull((select Sum(EnterLimit)  from tbl_SBLimitAllocation where sbcode=@FilterData1),0) =0 then 0 else  convert(money,round(@FilterData4,0))-isnull((select Sum(EnterLimit)  from tbl_SBLimitAllocation where sbcode=@FilterData1),0)   end as LimitGivenD,'' as ErrMsg 
 End
End 

if(@Process='TotalLimit')
Begin
select isnull(sum(EnterLimit),0) as TotalLimit from [INTRANET].LimitEnhancement.dbo.tbl_SBLimitAllocation with(nolock) where SBCode=@FilterData1 and Clientcode=@FilterData2 and Segment=@FilterData3
END


if(@Process='GETSBLIMIT')    
Begin
select ClientCode,ClientName,convert(decimal(18,2),EnterLimit) as EnterLimit,Segment,convert(varchar,CreatedDT,103)+' ' +convert(char , CreatedDT, 108) as CreatedDT,case when limitResponse=1 then 'Success' when(limitResponse=0 and isnull(LimitResponseMesaage,'')='' and isnull(ServerMapped,'')<>'') then 'Limit Updated on Odin Response Awaited' else 'Failed' end as LimitUpdation
from [INTRANET].LimitEnhancement.dbo.tbl_SBLimitAllocation with(nolock) where SBCode=@FilterData1 --and limitResponse=1
End

if(@Process='LIMITLOG')    
Begin
        insert into tbl_MobActivityLog(UserID,ActivityLog,LogDate)
		values(@FilterData1,'Limit Enhancement details: Segment-"'+@FilterData2+'", Marked limit-"'+@FilterData3+'", Device-"'+@FilterData4+'"',GETDATE())	
End	
	
  ---Added by pramod 2016
    if @Process ='ValidateClient'  
  begin  

	 declare @cntr as int =0

	 select @access_code=access_code from ROLEMGM.dbo.user_login where username=@FilterData1

	 select @cnt=count(1) from [CSOKYC-6].Franchisee.dbo.Franchisee_Mast with(nolock) where todate>=getdate() and Ftag=@access_code

     
     select  z.* into #templogin from (select a.*,b.cat_name,logindt=(case when login_inactive_date > getdate() then 1 else 0 end),daydiff=datediff(day,getdate(),login_inactive_date),b.applicable_to,b.active as m_active,'../Images/ico1.png' as URL
     from(SELECT [userid],[person_name],[username],LOWER([userpassword]) AS userpassword, case when @cnt<>0 then 'FRANCHISEE' else [usertype] end as usertype ,[access_to],
     [access_code],[cat_code],[status],[last_login],[NoOfTry],[NoOfLogin],[login_Activated],
     [login_inactive_date],[active],[email],[IP],[IP_active],[Gateway],[Gateway_active],[session_id],
     [CreatedBy],[CreatedOn],[LastModifiedBy],[LastModifiedOn] FROM ROLEMGM.dbo.user_login (nolock)  WHERE username=@FilterData1 and username is not null and LOWER(userpassword)= LOWER(@FilterData2)) a join ROLEMGM.dbo.menu_cat b (nolock) on a.cat_code=b.cat_code    and access_to =case when @cnt=0 then 'sb' else 'branch' end )z --and usertype ='admin'

	 select @cntr= count(1) from #templogin
	 if(@cntr>0)
	 begin

	 if exists(select 1 from TBL_MOB_NOTIFICATION where USERID<>@FilterData1 and NOTIFICATIONID=@FilterData3)
	 begin
	 delete from TBL_MOB_NOTIFICATION where NOTIFICATIONID=@FilterData3

	 insert into TBL_MOB_NOTIFICATION(USERID,NOTIFICATIONID)
	 values(@FilterData1,@FilterData3)

	 select * from #templogin
	 end
	 else  if exists(select 1 from TBL_MOB_NOTIFICATION where USERID=@FilterData1 and NOTIFICATIONID=@FilterData3)
	 begin
	 select * from #templogin
	 end

	 else
	 begin

	  insert into TBL_MOB_NOTIFICATION(USERID,NOTIFICATIONID)
	  values(@FilterData1,@FilterData3)

	  select * from #templogin
	 end

	 end

	 else
	 begin
	 select *  from #templogin
	 end

	 
     
      
  end 	


   If @Process='GETAUTOCLIENT'
  begin
  SELECT PARTY_CODE as client_code,LONG_NAME +':'+ PARTY_CODE as Name FROM INTRANET.RISK.DBO.VWMFSS_CLIENTDETAILS WITH (NOLOCK) WHERE (LONG_NAME like @FilterData1 +'%' or party_code like @FilterData1+'%')  AND  (SUB_BROKER=@FilterData2 or branch_cd=@FilterData2)
  end 
  
  
 if(@Process='Get Notification')    
Begin

select * from TBL_MOB_NOTIFICATION_LOG where UserId=@FilterData2

End 


if(@Process='Get Square Off')
begin

declare @date as varchar(25)=getdate()

exec [CSOKYC-6].general.dbo.nrms_all_square_off_report 'sb',@FilterData2,@date,'broker','cso','all'

end
	
  
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Module_Mapping
-- --------------------------------------------------
CREATE proc [dbo].[USP_Module_Mapping]    
(    
@Process varchar(50)='',      
@ConnectionId int =0,    
@ModuleId int =0,    
@Prameters varchar(500)='',    
@SubModuleId varchar(50)='',    
@ProcedureName varchar(50)='',    
@CreatedDate varchar(50)='',      
@CreatedBy varchar(50)='',      
@ModifiedDate varchar(50)='',      
@ModifiedBy varchar(50)='',      
@ApprovedDate varchar(50)='',      
@ApprovedBy varchar(50)='',    
@Isapproved int =0,      
@cnt int=0 output     
     
)    
as begin    
set @cnt=0     
if (@Process ='Add Module')      
 begin     
        begin try    
        select @cnt= COUNT (1)from tbl_Module_Mapping where (ProcedureName =@ProcedureName or SubModuleId =@SubModuleId ) and ConnectionId =@ConnectionId and (Isapproved =1 or Isapproved =0)    
    
  if (@cnt=0)      
  begin            
  INSERT INTO [tbl_Module_Mapping] ([SubModuleId],[ProcedureName],[Prameters],[ConnectionId],[CreatedDate],[CreatedBy],[Isapproved])    
  VALUES(@SubModuleId,@ProcedureName,@Prameters,@ConnectionId,GETDATE(),@CreatedBy,0)    
  end    
        end try    
            
        begin catch    
        set @cnt=-1    
        end catch    
            
 end 
 
 
 if (@Process ='Edit Module')      
 begin     
        begin try    
        select @cnt= COUNT (1)from tbl_Module_Mapping where (ProcedureName =@ProcedureName or SubModuleId =@SubModuleId ) and ConnectionId =@ConnectionId and ModuleId <>@ModuleId  and (Isapproved =1 or Isapproved =0)    
    
  if (@cnt=0)      
  begin            
			update tbl_Module_Mapping    
			set 
			SubModuleId =@SubModuleId ,
			ProcedureName =@ProcedureName ,
			ConnectionId =@ConnectionId ,  
			ModifyBy  =@ModifiedBy ,    
			ModifiedDate =GETDATE ()    
			where ModuleId  =@ModuleId   
  end    
        end try    
            
        begin catch    
        set @cnt=-1    
        end catch    
            
 end    
     
 if (@Process ='Delete Module')      
 begin      
     update tbl_Module_Mapping    
     set Isapproved =9,    
     ModifyBy  =@ModifiedBy ,    
     ModifiedDate =GETDATE ()    
      where ModuleId  =@ModuleId       
 end     
   
  if (@Process ='Get Modules')    
 begin    
  select   a.[ModuleId]
      ,a.[SubModuleId]
      ,a.[ProcedureName]
      ,a.[Prameters]
      ,a.[ConnectionId]
      ,a.[CreatedDate]
      ,a.[CreatedBy]
      ,a.[ModifiedDate]
      ,a.[ModifyBy] as ModifiedBy
      ,a.[ApprovedDate]
      ,a.[ApprovedBy]
      ,a.[Isapproved]
      ,c.ConName 
      ,c.ConnectionId 
       from   tbl_Module_Mapping a join tbl_Connection  c  
   on a.ConnectionId =c.ConnectionId   
   where a.Isapproved =0 or c.Isapproved =1  
 end   
   
   if (@Process ='Get Module By id')    
 begin    
  select * from   tbl_Module_Mapping c join tbl_Connection  m  
   on m.ConnectionId =c.ConnectionId   
   where c.Isapproved =0 or c.Isapproved =1 and c.ModuleId =@ModuleId  and c.Isapproved=0 and  m.Isapproved =0 
 end   
 
  if (@Process ='Get Connection By Submodule')  
 begin  
     Select ProcedureName,ConnectionString  from tbl_Connection con join tbl_Module_Mapping module
on con.ConnectionId =module.ConnectionId 
and module .SubModuleId  =@SubModuleId and con.Isapproved=0 and  module.Isapproved =0
 end  
 
   
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFFLINE_OFS
-- --------------------------------------------------
CREATE PROC USP_OFFLINE_OFS
@FILTERDATA1 VARCHAR(500)='',
@FILTERDATA2 VARCHAR(500)='',
@FILTERDATA3 VARCHAR(500)='',
@FILTERDATA4 VARCHAR(500)='',
@FILTERDATA5 VARCHAR(500)='',
@FILTERDATA6 VARCHAR(500)='',
@FILTERDATA7 VARCHAR(500)='',
@FILTERDATA8 VARCHAR(500)='',
@FILTERDATA9 VARCHAR(500)='',
@FILTERDATA10 VARCHAR(500)='',
@PROCESS VARCHAR(500)=''
AS BEGIN

IF @PROCESS ='GETLEAD'
BEGIN

--SELECT ID,Emp_Code ,Contact_Number ,LeadName  FROM dbo.tbl_LeadDetails WHERE IsDelete=0 and Emp_Code=@FILTERDATA1 

select a.*, ISNULL( b.status,0) as status from (SELECT ID,Emp_Code ,Contact_Number ,LeadName  FROM dbo.tbl_LeadDetails where IsDelete =0 and Emp_Code=@FILTERDATA1) a
left join (select status,ContactNo from tbl_LeadTransaction where isdelete =0)b
on a.Contact_Number =b.ContactNo

END

IF @PROCESS ='GETSTATUS'
BEGIN

SELECT ID,status from tbl_LeadStatus

END

IF @PROCESS ='MAKECALL'
BEGIN

--declare @FILTERDATA1 VARCHAR(500)='E001',
--@FILTERDATA2 VARCHAR(500)='9029159063',
--@FILTERDATA3 VARCHAR(500)='Rohit p',


		declare @ID as int 
		declare @ref as int

		SELECT @ID=ISNULL(ID,0),@ref = isnull(ReferenceNo,0)  from tbl_LeadTransaction where isdelete=0 and contactNo=@FILTERDATA2  

		set @ID= ISNULL( @ID,0)

		set @ref=ISNULL(@ref,0)

		if(@ID =0)
			begin 
			INSERT INTO [tbl_LeadTransaction] ([Emp_code],[ContactNo],[LeadName],[Status],[LogDate],[Isdelete],[ReferenceNo])
			VALUES(@FILTERDATA1 ,@FILTERDATA2 ,@FILTERDATA3 ,-1,GETDATE(),0,0)
			end
		else
		begin

			update tbl_LeadTransaction
			set isdelete =9
			where ID =@ID 

			INSERT INTO [tbl_LeadTransaction] ([Emp_code],[ContactNo],[LeadName],[Status],[LogDate],[Isdelete],[ReferenceNo])
			select [Emp_code],[ContactNo],[LeadName],-1,GETDATE(),0,@ID 
			from tbl_LeadTransaction where ID =@ID

		end

END

IF @PROCESS ='PENDINGSTATUS'
BEGIN

SELECT * from tbl_LeadTransaction where Status=-1 and isdelete =0 and Emp_code=@FILTERDATA1 

END

IF @PROCESS ='UPDATESTATUS'
BEGIN

            update tbl_LeadTransaction
			set isdelete =@FILTERDATA2
			where ID =@FILTERDATA1  


END

IF @PROCESS ='NEWNUMBER'
BEGIN

        INSERT INTO [tbl_LeadDetails] ([Emp_Code],[Contact_Number],[LeadName],[IsDelete],[EmailID],[City])
         VALUES(@FILTERDATA1 ,@FILTERDATA2 ,@FILTERDATA3,0,@FILTERDATA4 ,@FILTERDATA4)


END

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_batch
-- --------------------------------------------------
         
CREATE proc [dbo].[USP_OFS_batch](@segment as varchar(10))                
as                       
                      
set nocount on                      
          
/* declare @segment as varchar(10)= 'BSE'*/          
DECLARE @BatchCount AS INT = 0,@RecCount  as int =0,@ctr as int = 1,@cctr as varchar(3) = ''                
          
if (SELECT COUNT(1) FROM dbo.tbl_OFS_ORDER with (NOLOCK) where generation_flag in (1,-5)  and FileName not like '%MOD%'    and FileName not like '%DEL%'     
and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59'                
and SEGMENT=@segment) > 0          
Begin          
 SELECT @ctr=MAX(convert(int,Batch_No))+1 FROM dbo.tbl_OFS_ORDER with (NOLOCK) where generation_flag in (1,-5)    and FileName not like '%MOD%' and FileName not like '%DEL%'       
 and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59'                
 and SEGMENT=@segment                
end          
          
print @ctr          
          
                      
SELECT @RecCount=COUNT(1) FROM dbo.tbl_OFS_ORDER with (NOLOCK) where generation_flag=0  and ISNULL(BID_NO,'')=''                
and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59'                
and SEGMENT=@segment                
                
SET @BatchCount=99                
                    
WHILE @RecCount >0                      
BEGIN                      
 BEGIN TRAN                     
                
  select @cctr=                
  case                 
  when len(convert(varchar(3),@ctr)) =1 then '00'+convert(varchar(3),@ctr)                
  when len(convert(varchar(3),@ctr)) =2 then '0'+convert(varchar(3),@ctr)                
  else convert(varchar(3),@ctr)                
  end                
                
                   
  update tbl_OFS_ORDER set Batch_No=@cctr,                
  filename='OFS'+@segment+'_'+replace(convert(varchar(10),GETDATE(),103),'/','') where                 
  tbl_OFS_ORDER.REQUEST_ID in (                     
   select TOP (@BatchCount) REQUEST_ID FROM dbo.tbl_OFS_ORDER  where generation_flag=0 and ISNULL(BID_NO,'')=''                 
   and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59'                
   and isnull(Batch_No,'')='' and SEGMENT=@segment                
   )                
  COMMIT TRAN                      
                         
  SET @RecCount=@RecCount - @BatchCount                       
  set @ctr = @ctr + 1                       
  set nocount off                      
END                 
if(@segment='BSE')              
Begin                
select (select BSECode from tbl_OFS_ScripMaster where Srno=SCRIPCODE) as SCRIPCODE,CLIENT_TYPE,'' as Blank1,CLIENT_CODE,'' as Blank,QUANTITY,cast (convert(decimal(18,2),[BID_RATE]) as varchar(100)) as BID_RATE,'2' As [Static Val],'0' as BID_NO,'N' as [Static Val1],FileName,Batch_No as File_Num from tbl_OFS_ORDER with (nolock) where isnull(Batch_No,'')<>'' and GENERATION_FLAG=0 and SEGMENT=@segment                
and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59' 
End              
else              
Begin              
select 'WALKIN' as CLIENT_TYPE,(select NSESymbol from tbl_OFS_ScripMaster where Srno=SCRIPCODE) as SCRIPCODE,case when CLIENT_TYPE='RI' then 'RS' else 'IS' end as Series,QUANTITY,cast (convert(decimal(18,2),[BID_RATE]) as varchar(100)) as BID_RATE,'CLI' As [CLI/PRO],'WALKIN' as [Account Id],'12798' as [Participant Code],'YES' as [Block Collateral],CLIENT_CODE as [Walkin Client Code],'NEW' as [Walkin Client Name]              
,FileName,Batch_No as File_Num              
from tbl_OFS_ORDER with (nolock) where isnull(Batch_No,'')<>'' and GENERATION_FLAG=0 and SEGMENT=@segment   
and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59'              
End              
                
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_Client_NL_NA
-- --------------------------------------------------

  
CREATE procedure [dbo].[USP_OFS_Client_NL_NA](@pcode as varchar(10))      
as      
/*      
exec OFS_Client_NL_NA 'IKW16'      
NOTE: -ve value is Credit and +ve value is Debit      
*/      
    
set nocount on      
/*    
declare @pcode as varchar(10)    
set @pcode ='BP11'    
*/      
declare @AcYrFrom as datetime,@BSECM as money = 0,@NSECM as money = 0,@NSEFO as money = 0,@NSX as money = 0,@MCD as money = 0,@hold as money = 0,@nbfc as money = 0      
select @AcYrFrom=sdtcur from risk.dbo.parameter with (nolock)       
where sdtcur <= GETDATE() and ldtcur >= GETDATE()      
      
select @BSECM=sum(Case when Drcr='C' then -vamt else vamt end) from AngelBSECM.account_ab.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode      
select @NSECM=sum(Case when Drcr='C' then -vamt else vamt end) from AngelNseCM.account.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode      
select @NSEFO=sum(Case when Drcr='C' then -vamt else vamt end) from angelfo.accountfo.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode      
select @NSX=sum(Case when Drcr='C' then -vamt else vamt end) from angelfo.inhouse_curfo.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode      
select @MCD=sum(Case when Drcr='C' then -vamt else vamt end) from ANGELCOMMODITY.inhouse_mcdcs.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode      
/* select @hold=isnull(sum(total),0) from [CSOKYC-6].general.dbo.rms_holding where isnull(source,'XX') not in ('DP','XX') and party_Code=@pcode    */  
select @NBFC=sum(Case when Drcr='C' then -vamt else vamt end) from [172.31.16.57].accountnbfc.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode      
select @hold=@hold+isnull(sum(Hold_Total),0) from [CSOKYC-6].general.dbo.tbl_rms_collection_cli where party_Code=@pcode      
SELECT @hold=@hold+isnull(SUM(CASE WHEN CASH_NCASH = 'N' THEN AMOUNT ELSE FINALAMOUNT END),0)      
 FROM [CSOKYC-6].general.dbo.CLIENT_COLLATERALS where Party_Code=@pcode and co_Code not in ('MCX','NCDEX')       
 GROUP BY co_code,Party_Code       
      
select ISNULL(isnull(@BSECM,0)+isnull(@NSECM,0)+isnull(@NSEFO,0)+isnull(@MCD,0)+isnull(@NSX,0)+isnull(@NBFC,0),0)*-1 as NL,      
ISNULL(isnull(@BSECM,0)+isnull(@NSECM,0)+isnull(@NSEFO,0)+isnull(@MCD,0)+isnull(@NSX,0)+isnull(@NBFC,0)-isnull(@hold,0),0)*-1as NA      
      
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_GetRECORDS
-- --------------------------------------------------

create PROCEDURE [dbo].[USP_OFS_GetRECORDS]            
(@USER AS VARCHAR(10),@REQUEST_ID as int=0)            
AS            
BEGIN            
--declare @USER AS VARCHAR(10),@REQUEST_ID as int            
--set @USER='E02812'            
--set @REQUEST_ID=177            
            
IF @REQUEST_ID <> 0            
 BEGIN            
  select ORD.CLIENT_CODE,ORD.SEGMENT,SCR.ScripName,ORD.SCRIPCODE, cast(CONVERT(decimal(18,2),BID_RATE) as varchar(100)) as  BID_RATE,QUANTITY,      
  (case when ORD.GENERATION_FLAG = 1 then 'Generated' when ORD.GENERATION_FLAG = -1 then 'Mod Bfr Generation' when ORD.GENERATION_FLAG = 0 then 'Last Modified'       
  else '0' END) as GENERATION_FLAG,       
  ORD.Batch_No,ORD.REQUEST_ID,ORD.BID_NO             
  from tbl_OFS_ORDER ORD Inner Join            
  tbl_OFS_ScripMaster SCR on SCR.Srno=ORD.SCRIPCODE             
  WHERE CONVERT(VARCHAR(12), ORD.REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)             
  AND ord.ENTEREDBY=@USER             
  AND ord.REQUEST_ID = convert(int,@REQUEST_ID)            
 END             
ELSE            
 BEGIN            
  select ORD.CLIENT_CODE,ORD.SEGMENT,SCR.ScripName,ORD.SCRIPCODE,cast(CONVERT(decimal(18,2),BID_RATE) as varchar(100)) as BID_RATE,QUANTITY,      
  (case when ORD.GENERATION_FLAG = 1 then 'Generated' when ORD.GENERATION_FLAG = -1 then 'Mod Bfr Generation' when ORD.GENERATION_FLAG = 0 then 'Last Modified'       
  else '0' END) as GENERATION_FLAG,       
  ORD.Batch_No,ORD.REQUEST_ID,ORD.BID_NO             
  from tbl_OFS_ORDER ORD Inner Join            
  tbl_OFS_ScripMaster SCR on SCR.Srno=ORD.SCRIPCODE             
  WHERE CONVERT(VARCHAR(12), ORD.REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)             
  AND ord.ENTEREDBY=@USER 
  AND ORD.GENERATION_FLAG in(1,0)  
  Order by ORD.REQUEST_DATE  DESC             
 END             
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_GetScripData
-- --------------------------------------------------

--Created BY:- Sandeep      
--Date:-05 Feb 2015      
--Reason :-to get script entered by the particular user      
--OFS_GetScripData '1','e01089'      
create procedure [dbo].[USP_OFS_GetScripData]    
@Srno int=null,      
@UserName varchar(50)      
As      
Begin      
if(ISNULL(@Srno,'')='')    
Begin    
select Srno,ScripName,BSECode,NSESymbol,convert(varchar(12),ValidForDate,106) as ValidForDate,cast (convert(decimal(18,2),MinBidRate) as varchar(100)) as MinBidRate,cast (convert(decimal(18,2),MaxBidRate) as varchar(100)) as MaxBidRate,PercentAlert,cast (convert(decimal(18,2),RI_AmtLimit) as varchar(100)) as RI_AmtLimit,MinMarginPercent,case when Checkon_NetA_NetL='NA' then 'Net Available' else 'Net Ledger' end as Checkon_NetA_NetL,      
EnteredBy      
from  OFS_ScripMaster with(nolock) where CONVERT(varchar(12),EnteredOn,106)=CONVERT(varchar(12),GETDATE(),106)      
   
End    
else    
Begin    
select Srno,ScripName,BSECode,NSESymbol,convert(varchar(12),ValidForDate,106) as ValidForDate,cast (convert(decimal(18,2),MinBidRate) as varchar(100)) as MinBidRate,cast (convert(decimal(18,2),MaxBidRate) as varchar(100)) as MaxBidRate,convert(int,PercentAlert) as PercentAlert,cast (convert(decimal(18,2),RI_AmtLimit) as varchar(100)) as RI_AmtLimit,convert(int,MinMarginPercent) as MinMarginPercent,Checkon_NetA_NetL,      
EnteredBy      
from  OFS_ScripMaster with(nolock) where CONVERT(varchar(12),EnteredOn,106)=CONVERT(varchar(12),GETDATE(),106) and Srno=@Srno    
End    
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_ORDER_INSERT
-- --------------------------------------------------
          
--use MISC          
          
CREATE PROC [dbo].[USP_OFS_ORDER_INSERT]          
(@CLIENT_CODE as varchar(10),@SCRIPCODE as int,@SEGMENT as varchar(5),@QUANTITY int,@BID_RATE as money,@ENTERED_BY  as varchar(10),@CLIENT_TYPE as varchar(5),@Bid_No as varchar(25)=NUll)          
AS          
          
declare @MIN_BID_RATE as money,@MinMarginPercent int,@Checkon_NetA_NetL char          
          
select  @MIN_BID_RATE = MinBidRate,@MinMarginPercent= MinMarginPercent,@Checkon_NetA_NetL = Checkon_NetA_NetL from  OFS_Scripmaster           
where Srno= @SCRIPCODE          
          
declare @NL money ,@NA money       
DECLARE @RecCount as int          
          
Create table #t          
(          
NL decimal(20,2),          
NA decimal(20,2)          
)          
          
truncate table #t          
insert into #t(NL,NA)           
exec OFS_Client_NL_NA @CLIENT_CODE          
          
select @NL=NL,@NA =NA from #t        
       
          
if(ISNULL(@Bid_No,'')<>'')        
 BEGIN          
       
 SELECT @RecCount=COUNT(*)FROM tbl_OFS_ORDER WHERE CLIENT_CODE=@CLIENT_CODE AND BID_NO=@Bid_No AND        
    REQUEST_DATE >= convert(varchar(11),GETDATE())+' 00:00:00' and REQUEST_DATE <= convert(varchar(11),GETDATE())+' 23:59:59'        
print   @RecCount  
print   @Bid_No  
print   @CLIENT_CODE  
 IF (@RecCount > 1)      
  BEGIN      
  /*When entry already exist then it update first and then inserted the record with gerenation flag 0. */      
   UPDATE tbl_OFS_ORDER      
   SET GENERATION_FLAG = -1,      
   BID_NO=BID_NO,      
   REQUEST_DATE=REQUEST_DATE         
   FROM tbl_OFS_ORDER WHERE CLIENT_CODE=@CLIENT_CODE AND GENERATION_FLAG=0 AND BID_NO=@Bid_No      
         
   INSERT INTO tbl_OFS_ORDER(          
   REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,          
   NET_LEDGER,MARGIN_AVAILABLE,ENTERED_BY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)          
   VALUES(          
   GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,          
   (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),          
   @ENTERED_BY,'',0,'Added',@Bid_No,'',''          
   )        
  END       
 ELSE       
  BEGIN      
   INSERT INTO tbl_OFS_ORDER(          
   REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,          
   NET_LEDGER,MARGIN_AVAILABLE,ENTERED_BY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)          
   VALUES(          
   GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,          
   (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),          
   @ENTERED_BY,'',0,'Added',@Bid_No,'',''          
   )      
  END       
 END        
ELSE        
 BEGIN        
 INSERT INTO tbl_OFS_ORDER(          
 REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,          
 NET_LEDGER,MARGIN_AVAILABLE,ENTERED_BY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)          
 VALUES(          
 GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,          
 (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),          
 @ENTERED_BY,'',0,'Added','','',''          
 )          
 End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_ORDER_RECORDS
-- --------------------------------------------------
  
  
  
CREATE PROCEDURE [dbo].[USP_OFS_ORDER_RECORDS]              
(  
@Process as varchar(20)='',  
@REQUEST_ID as int=0,  
@REQUEST_DATE as varchar(30)='',  
@CLIENT_CODE as varchar(10)='',  
@SEGMENT as varchar(5)='',  
@SCRIPCODE as int=0,  
@QUANTITY int=0,  
@BID_RATE as money=0,  
@MIN_BID_RATE as money =0,  
@CLIENT_TYPE as varchar(5)='',  
@MinMarginPercent as int =0,  
@Checkon_NetA_NetL as char(2)='',  
@NET_AVAILABLE as money =0,  
@NET_LEDGER as money=0,  
@MARGIN_AVAILABLE as money=0,  
@REMARKS as varchar(500)='',  
@GENERATION_FLAG as int=0,  
@GEN_STATUS as varchar(100)='',  
@Bid_No as varchar(25)='',  
@FileName varchar(25)='',  
@Batch_No varchar(3)='',  
@ENTEREDBY  as varchar(10)='',  
@EnteredOn varchar(30)='',  
@IsDelete as int =0,  
@UpdatedBy as varchar(10)='',  
@UpdatedOn as varchar(30)=''  
)              
AS              
BEGIN              
   
 IF @Process ='GET RECORDS'  
 BEGIN  
  IF @REQUEST_ID <> 0              
  BEGIN   
          
   select ORD.CLIENT_CODE,ORD.SEGMENT,SCR.ScripName,ORD.SCRIPCODE, cast(CONVERT(decimal(18,2),BID_RATE) as varchar(100)) as  BID_RATE,QUANTITY,        
   (case when ORD.GENERATION_FLAG = 1 then 'Generated' when ORD.GENERATION_FLAG = -1 then 'Mod Bfr Generation' when ORD.GENERATION_FLAG = 0 then 'Last Modified'         
   else '0' END) as GENERATIONFLAG,ORD.GENERATION_FLAG,         
   ORD.Batch_No,ORD.REQUEST_ID,ORD.BID_NO ,ORD.REQUEST_DATE,MIN_BID_RATE,CLIENT_TYPE,ord.Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,REMARKS,GEN_STATUS,[FileName]    ,          
   ord.EnteredBy,ord.EnteredOn,isnull(ord.IsDelete,0) as IsDelete,ord.UpdatedBy,ord.UpdatedOn,ord.MinMarginPercent              
   from tbl_OFS_ORDER ORD Inner Join              
   tbl_OFS_ScripMaster SCR on SCR.Srno=ORD.SCRIPCODE               
   WHERE CONVERT(VARCHAR(12), ORD.REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)               
   AND ord.ENTEREDBY=@ENTEREDBY               
   AND ord.REQUEST_ID = convert(int,@REQUEST_ID)              
  END               
  ELSE              
  BEGIN 
               
   select ORD.CLIENT_CODE,ORD.SEGMENT,SCR.ScripName,ORD.SCRIPCODE,cast(CONVERT(decimal(18,2),BID_RATE) as varchar(100)) as BID_RATE,QUANTITY,        
   (case when ORD.GENERATION_FLAG = 1 then 'Generated' when ORD.GENERATION_FLAG = -1 then 'Mod Bfr Generation' when ORD.GENERATION_FLAG = 0 then 'Last Modified'         
   else '0' END) as GENERATIONFLAG,ORD.GENERATION_FLAG,         
   ORD.Batch_No,ORD.REQUEST_ID,ORD.BID_NO ,ORD.REQUEST_DATE,MIN_BID_RATE,CLIENT_TYPE,ord.Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,REMARKS,GEN_STATUS,[FileName]    ,          
   ord.EnteredBy,ord.EnteredOn,isnull(ord.IsDelete,0) as IsDelete ,ord.UpdatedBy,ord.UpdatedOn,ord.MinMarginPercent               
   from tbl_OFS_ORDER ORD Inner Join              
   tbl_OFS_ScripMaster SCR on SCR.Srno=ORD.SCRIPCODE               
   WHERE CONVERT(VARCHAR(12), ORD.REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)               
   AND ord.ENTEREDBY=@ENTEREDBY   
   AND ORD.GENERATION_FLAG in(1,0)    
   Order by ORD.REQUEST_DATE  DESC               
  END   
 END         
  
 IF @Process ='ADD RECORDS'  
 BEGIN       
           
 select  @MIN_BID_RATE = MinBidRate,@MinMarginPercent= MinMarginPercent,@Checkon_NetA_NetL = Checkon_NetA_NetL from  tbl_OFS_ScripMaster             
 where Srno= @SCRIPCODE            
  
 declare @NL money ,@NA money         
 DECLARE @RecCount as int            
  
 Create table #t            
 (            
 NL decimal(20,2),            
 NA decimal(20,2)            
 )            
  
 truncate table #t            
 insert into #t(NL,NA)             
 exec USP_OFS_Client_NL_NA @CLIENT_CODE            
  

 select @NL=NL,@NA =NA from #t
           
  
  
 if(ISNULL(@Bid_No,'')<>'')          
 BEGIN            
  
  SELECT @RecCount=COUNT(*)FROM tbl_OFS_ORDER WHERE CLIENT_CODE=@CLIENT_CODE AND BID_NO=@Bid_No AND          
  REQUEST_DATE >= convert(varchar(11),GETDATE())+' 00:00:00' and REQUEST_DATE <= convert(varchar(11),GETDATE())+' 23:59:59'          
  print   @RecCount    
  print   @Bid_No    
  print   @CLIENT_CODE    
 IF (@RecCount > 1)        
 BEGIN        
  /*When entry already exist then it update first and then inserted the record with gerenation flag 0. */        
  UPDATE tbl_OFS_ORDER        
  SET GENERATION_FLAG = -1,        
  BID_NO=BID_NO,        
  REQUEST_DATE=REQUEST_DATE           
  FROM tbl_OFS_ORDER WHERE CLIENT_CODE=@CLIENT_CODE AND GENERATION_FLAG=0 AND BID_NO=@Bid_No        
  
  INSERT INTO tbl_OFS_ORDER(            
  REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,            
  NET_LEDGER,MARGIN_AVAILABLE,ENTEREDBY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)            
  VALUES(            
  GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,            
  (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),            
  @ENTEREDBY,'',0,'Added',@Bid_No,'',''            
  )          
 END         
 ELSE         
  BEGIN        
  INSERT INTO tbl_OFS_ORDER(            
  REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,            
  NET_LEDGER,MARGIN_AVAILABLE,ENTEREDBY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)            
  VALUES(            
  GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,            
  (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),            
  @ENTEREDBY,'',0,'Added',@Bid_No,'',''            
  )        
  END         
 END          
 ELSE          
 BEGIN 
 --select  @BID_RATE,@MIN_BID_RATE,@NET_AVAILABLE,@NET_LEDGER,@MARGIN_AVAILABLE ,@MinMarginPercent,@NA,@NL  
 
---Check With sir MARGIN_AVAILABLE
       
  INSERT INTO tbl_OFS_ORDER(            
  REQUEST_DATE,
  CLIENT_CODE,
  SEGMENT,
  SCRIPCODE,
  QUANTITY,
  BID_RATE,
  MIN_BID_RATE,
  CLIENT_TYPE,
  MinMarginPercent,
  Checkon_NetA_NetL,
  NET_AVAILABLE,            
  NET_LEDGER,
  MARGIN_AVAILABLE,
  ENTEREDBY,
  REMARKS,
  GENERATION_FLAG,
  GEN_STATUS,
  BID_NO,
  [FileName],
  Batch_No)            
  VALUES(            
  GETDATE(),
  @CLIENT_CODE,
  @SEGMENT,
  @SCRIPCODE,
  @QUANTITY,
  @BID_RATE,
  @MIN_BID_RATE,
  @CLIENT_TYPE,
  @MinMarginPercent,
  @Checkon_NetA_NetL,
  @NA,
  @NL,            
  0,            
  @ENTEREDBY,
  '',
  0,
  'Added',
  '',
  '',
  ''            
  )            
 END       
  
 END 
 
 IF @Process ='VALID ORDER'
BEGIN
     EXEC USP_OFS_ValidORder @CLIENT_CODE,@SCRIPCODE,@BID_RATE ,@QUANTITY ,@Bid_No 
END 

If @Process ='SOFTDELETE'
BEGIN
                    
IF @REQUEST_ID <> 0                    
 BEGIN                    
  --Generation flag -3 means Record sent for soft delete..      
UPDATE TBL_OFS_ORDER      
set GENERATION_FLAG = -5  
--[FileName]='',Batch_No=''  
WHERE  REQUEST_ID=@REQUEST_ID                     
AND CONVERT(VARCHAR(12),REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)                                    
AND REQUEST_ID = convert(int,@REQUEST_ID)                    


insert into TBL_OFS_ORDER(REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,EnteredBy,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,FileName,Batch_No)
(select REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,EnteredBy,REMARKS,-3,GEN_STATUS,BID_NO,'','' from tbl_OFS_ORDER where REQUEST_ID=@REQUEST_ID)


  
 END  
END

IF @Process ='DELETEORDER'
BEGIN 
IF @REQUEST_ID <> 0              
 BEGIN              
  DELETE FROM TBL_OFS_ORDER  WHERE  REQUEST_ID=@REQUEST_ID               
  AND CONVERT(VARCHAR(12),REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)                              
  AND REQUEST_ID = convert(int,@REQUEST_ID)              
 END  
END

if @Process ='OFS_batch'
begin
exec USP_OFS_batch @SEGMENT
end

if @Process ='UpdGenFlag'
begin
	update tbl_OFS_ORDER  
	set GENERATION_FLAG=1 
	where SEGMENT=@segment and Batch_No=@batch_no and GENERATION_FLAG=0 and FileName=@filename
end

if @Process ='UploadReverseNSEFile'
begin
		update p
		set p.BID_NO=c.[App No] ,p.REMARKS=c.[Order Status] +', '+ ISNULL ( c.Remarks ,'') 
		from  (select * from tbl_OFS_Temp_Reversal_NSE a join tbl_OFS_ScripMaster b
		on SUBSTRING (a.Symbol ,0,CHARINDEX ('-',a.Symbol))  =b.ScripName) c 
		join tbl_OFS_ORDER p
		on p.CLIENT_CODE=c.[Client Code]  and p.SCRIPCODE =c.Srno 
		
		truncate table tbl_OFS_Temp_Reversal_NSE
end

if @Process ='UploadReverseBSEFile'
begin
		  IF EXISTS(select * from tbl_OFS_Temp_Reversal_BSE where Static_val1='D')  
			BEGIN       
			update p      
			set p.BID_NO=c.Bid_No , p.REMARKS= c.Static_val1      
			from  (  
			select * from tbl_OFS_Temp_Reversal_BSE a   
			join OFS_ScripMaster b      
			on a.SCRIPCODE =b.ScripName) c       
			join tbl_ofs_order p      
			on p.CLIENT_CODE=c.Client_Code   
			and p.SCRIPCODE =c.Srno  
			and RTRIM(LTRIM(p.BID_RATE)) = RTRIM(LTRIM(c.BID_RATE))  
			and RTRIM(LTRIM(p.QUANTITY)) = RTRIM(LTRIM(c.Qty))   
			and GENERATION_FLAG = -4    
			END   
			ELSE  if exists(select * from tbl_OFS_Temp_Reversal_BSE where Static_val1='M')
			BEGIN    
			update p      
			set p.BID_NO=c.Bid_No , p.REMARKS= c.Static_val1  

			from  (  
			select * from tbl_OFS_Temp_Reversal_BSE a   
			join tbl_OFS_ScripMaster b      
			on a.SCRIPCODE =b.ScripName) c       
			join tbl_ofs_order p      
			on p.CLIENT_CODE=c.Client_Code   
			and p.SCRIPCODE =c.Srno  
			and RTRIM(LTRIM(p.BID_RATE)) = RTRIM(LTRIM(c.BID_RATE))  
			and RTRIM(LTRIM(p.QUANTITY)) = RTRIM(LTRIM(c.Qty))     
			and p.filename like '%MOD%'
			End
			else
			begin       
			update p      
			set p.BID_NO=c.Bid_No , p.REMARKS= c.Static_val1  

			from  (  
			select * from tbl_OFS_Temp_Reversal_BSE a   
			join tbl_OFS_ScripMaster b      
			on a.SCRIPCODE =b.ScripName) c       
			join tbl_ofs_order p      
			on p.CLIENT_CODE=c.Client_Code   
			and p.SCRIPCODE =c.Srno  
			and RTRIM(LTRIM(p.BID_RATE)) = RTRIM(LTRIM(c.BID_RATE))  
			and RTRIM(LTRIM(p.QUANTITY)) = RTRIM(LTRIM(c.Qty))     
			END 
			
			truncate table tbl_OFS_Temp_Reversal_BSE
end

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_ORDER_RECORDS_26052015
-- --------------------------------------------------
  
  
  
create PROCEDURE [dbo].[USP_OFS_ORDER_RECORDS_26052015]              
(  
@Process as varchar(20)='',  
@REQUEST_ID as int=0,  
@REQUEST_DATE as datetime =null,  
@CLIENT_CODE as varchar(10)='',  
@SEGMENT as varchar(5)='',  
@SCRIPCODE as int=0,  
@QUANTITY int=0,  
@BID_RATE as money=0,  
@MIN_BID_RATE as money =0,  
@CLIENT_TYPE as varchar(5)='',  
@MinMarginPercent as int =0,  
@Checkon_NetA_NetL as char(2)='',  
@NET_AVAILABLE as money =0,  
@NET_LEDGER as money=0,  
@MARGIN_AVAILABLE as money=0,  
@REMARKS as varchar(500)='',  
@GENERATION_FLAG as int=0,  
@GEN_STATUS as varchar(100)='',  
@Bid_No as varchar(25)='',  
@FileName varchar(25)='',  
@Batch_No varchar(3)='',  
@ENTEREDBY  as varchar(10)='',  
@EnteredOn datetime =null,  
@IsDelete as int =0,  
@UpdatedBy as varchar(10)='',  
@UpdatedOn as datetime =null  
)              
AS              
BEGIN              
   
 IF @Process ='GET RECORDS'  
 BEGIN  
  IF @REQUEST_ID <> 0              
  BEGIN   
          
   select ORD.CLIENT_CODE,ORD.SEGMENT,SCR.ScripName,ORD.SCRIPCODE, cast(CONVERT(decimal(18,2),BID_RATE) as varchar(100)) as  BID_RATE,QUANTITY,        
   (case when ORD.GENERATION_FLAG = 1 then 'Generated' when ORD.GENERATION_FLAG = -1 then 'Mod Bfr Generation' when ORD.GENERATION_FLAG = 0 then 'Last Modified'         
   else '0' END) as GENERATIONFLAG,ORD.GENERATION_FLAG,         
   ORD.Batch_No,ORD.REQUEST_ID,ORD.BID_NO ,ORD.REQUEST_DATE,MIN_BID_RATE,CLIENT_TYPE,ord.Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,REMARKS,GEN_STATUS,[FileName]    ,          
   ord.EnteredBy,ord.EnteredOn,isnull(ord.IsDelete,0) as IsDelete,ord.UpdatedBy,ord.UpdatedOn,ord.MinMarginPercent              
   from tbl_OFS_ORDER ORD Inner Join              
   tbl_OFS_ScripMaster SCR on SCR.Srno=ORD.SCRIPCODE               
   WHERE CONVERT(VARCHAR(12), ORD.REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)               
   AND ord.ENTEREDBY=@ENTEREDBY               
   AND ord.REQUEST_ID = convert(int,@REQUEST_ID)              
  END               
  ELSE              
  BEGIN 
               
   select ORD.CLIENT_CODE,ORD.SEGMENT,SCR.ScripName,ORD.SCRIPCODE,cast(CONVERT(decimal(18,2),BID_RATE) as varchar(100)) as BID_RATE,QUANTITY,        
   (case when ORD.GENERATION_FLAG = 1 then 'Generated' when ORD.GENERATION_FLAG = -1 then 'Mod Bfr Generation' when ORD.GENERATION_FLAG = 0 then 'Last Modified'         
   else '0' END) as GENERATIONFLAG,ORD.GENERATION_FLAG,         
   ORD.Batch_No,ORD.REQUEST_ID,ORD.BID_NO ,ORD.REQUEST_DATE,MIN_BID_RATE,CLIENT_TYPE,ord.Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,REMARKS,GEN_STATUS,[FileName]    ,          
   ord.EnteredBy,ord.EnteredOn,isnull(ord.IsDelete,0) as IsDelete ,ord.UpdatedBy,ord.UpdatedOn,ord.MinMarginPercent               
   from tbl_OFS_ORDER ORD Inner Join              
   tbl_OFS_ScripMaster SCR on SCR.Srno=ORD.SCRIPCODE               
   WHERE CONVERT(VARCHAR(12), ORD.REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)               
   AND ord.ENTEREDBY=@ENTEREDBY   
   AND ORD.GENERATION_FLAG in(1,0)    
   Order by ORD.REQUEST_DATE  DESC               
  END   
 END         
  
 IF @Process ='ADD RECORDS'  
 BEGIN       
           
 select  @MIN_BID_RATE = MinBidRate,@MinMarginPercent= MinMarginPercent,@Checkon_NetA_NetL = Checkon_NetA_NetL from  tbl_OFS_ScripMaster             
 where Srno= @SCRIPCODE            
  
 declare @NL money ,@NA money         
 DECLARE @RecCount as int            
  
 Create table #t            
 (            
 NL decimal(20,2),            
 NA decimal(20,2)            
 )            
  
 truncate table #t            
 insert into #t(NL,NA)             
 exec USP_OFS_Client_NL_NA @CLIENT_CODE            
  

 select @NL=NL,@NA =NA from #t
           
  
  
 if(ISNULL(@Bid_No,'')<>'')          
 BEGIN            
  
  SELECT @RecCount=COUNT(*)FROM tbl_OFS_ORDER WHERE CLIENT_CODE=@CLIENT_CODE AND BID_NO=@Bid_No AND          
  REQUEST_DATE >= convert(varchar(11),GETDATE())+' 00:00:00' and REQUEST_DATE <= convert(varchar(11),GETDATE())+' 23:59:59'          
  print   @RecCount    
  print   @Bid_No    
  print   @CLIENT_CODE    
 IF (@RecCount > 1)        
 BEGIN        
  /*When entry already exist then it update first and then inserted the record with gerenation flag 0. */        
  UPDATE tbl_OFS_ORDER        
  SET GENERATION_FLAG = -1,        
  BID_NO=BID_NO,        
  REQUEST_DATE=REQUEST_DATE           
  FROM tbl_OFS_ORDER WHERE CLIENT_CODE=@CLIENT_CODE AND GENERATION_FLAG=0 AND BID_NO=@Bid_No        
  
  INSERT INTO tbl_OFS_ORDER(            
  REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,            
  NET_LEDGER,MARGIN_AVAILABLE,ENTEREDBY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)            
  VALUES(            
  GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,            
  (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),            
  @ENTEREDBY,'',0,'Added',@Bid_No,'',''            
  )          
 END         
 ELSE         
  BEGIN        
  INSERT INTO tbl_OFS_ORDER(            
  REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,            
  NET_LEDGER,MARGIN_AVAILABLE,ENTEREDBY,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,[FileName],Batch_No)            
  VALUES(            
  GETDATE(),@CLIENT_CODE,@SEGMENT,@SCRIPCODE,@QUANTITY,@BID_RATE,@MIN_BID_RATE,@CLIENT_TYPE,@MinMarginPercent,@Checkon_NetA_NetL,@NA,@NL,            
  (CASE WHEN @Checkon_NetA_NetL = 'NA' THEN 'V' WHEN @Checkon_NetA_NetL = 'NL' THEN 'W' ELSE '' END),            
  @ENTEREDBY,'',0,'Added',@Bid_No,'',''            
  )        
  END         
 END          
 ELSE          
 BEGIN 
 --select  @BID_RATE,@MIN_BID_RATE,@NET_AVAILABLE,@NET_LEDGER,@MARGIN_AVAILABLE ,@MinMarginPercent,@NA,@NL  
 
---Check With sir MARGIN_AVAILABLE
       
  INSERT INTO tbl_OFS_ORDER(            
  REQUEST_DATE,
  CLIENT_CODE,
  SEGMENT,
  SCRIPCODE,
  QUANTITY,
  BID_RATE,
  MIN_BID_RATE,
  CLIENT_TYPE,
  MinMarginPercent,
  Checkon_NetA_NetL,
  NET_AVAILABLE,            
  NET_LEDGER,
  MARGIN_AVAILABLE,
  ENTEREDBY,
  REMARKS,
  GENERATION_FLAG,
  GEN_STATUS,
  BID_NO,
  [FileName],
  Batch_No)            
  VALUES(            
  GETDATE(),
  @CLIENT_CODE,
  @SEGMENT,
  @SCRIPCODE,
  @QUANTITY,
  @BID_RATE,
  @MIN_BID_RATE,
  @CLIENT_TYPE,
  @MinMarginPercent,
  @Checkon_NetA_NetL,
  @NA,
  @NL,            
  0,            
  @ENTEREDBY,
  '',
  0,
  'Added',
  '',
  '',
  ''            
  )            
 END       
  
 END 
 
 IF @Process ='VALID ORDER'
BEGIN
     EXEC USP_OFS_ValidORder @CLIENT_CODE,@SCRIPCODE,@BID_RATE ,@QUANTITY ,@Bid_No 
END 

If @Process ='SOFTDELETE'
BEGIN
                    
IF @REQUEST_ID <> 0                    
 BEGIN                    
  --Generation flag -3 means Record sent for soft delete..      
UPDATE TBL_OFS_ORDER      
set GENERATION_FLAG = -5  
--[FileName]='',Batch_No=''  
WHERE  REQUEST_ID=@REQUEST_ID                     
AND CONVERT(VARCHAR(12),REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)                                    
AND REQUEST_ID = convert(int,@REQUEST_ID)                    


insert into TBL_OFS_ORDER(REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,EnteredBy,REMARKS,GENERATION_FLAG,GEN_STATUS,BID_NO,FileName,Batch_No)
(select REQUEST_DATE,CLIENT_CODE,SEGMENT,SCRIPCODE,QUANTITY,BID_RATE,MIN_BID_RATE,CLIENT_TYPE,MinMarginPercent,Checkon_NetA_NetL,NET_AVAILABLE,NET_LEDGER,MARGIN_AVAILABLE,EnteredBy,REMARKS,-3,GEN_STATUS,BID_NO,'','' from tbl_OFS_ORDER where REQUEST_ID=@REQUEST_ID)


  
 END  
END

IF @Process ='DELETEORDER'
BEGIN 
IF @REQUEST_ID <> 0              
 BEGIN              
  DELETE FROM TBL_OFS_ORDER  WHERE  REQUEST_ID=@REQUEST_ID               
  AND CONVERT(VARCHAR(12),REQUEST_DATE,106) >= CONVERT(VARCHAR(12),GETDATE(),106)                              
  AND REQUEST_ID = convert(int,@REQUEST_ID)              
 END  
END

if @Process ='OFS_batch'
begin
exec USP_OFS_batch @SEGMENT
end

if @Process ='UpdGenFlag'
begin
	update tbl_OFS_ORDER  
	set GENERATION_FLAG=1 
	where SEGMENT=@segment and Batch_No=@batch_no and GENERATION_FLAG=0 and FileName=@filename
end

if @Process ='UploadReverseNSEFile'
begin
		update p
		set p.BID_NO=c.[App No] ,p.REMARKS=c.[Order Status] +', '+ ISNULL ( c.Remarks ,'') 
		from  (select * from tbl_OFS_Temp_Reversal_NSE a join tbl_OFS_ScripMaster b
		on SUBSTRING (a.Symbol ,0,CHARINDEX ('-',a.Symbol))  =b.ScripName) c 
		join tbl_OFS_ORDER p
		on p.CLIENT_CODE=c.[Client Code]  and p.SCRIPCODE =c.Srno 
		
		truncate table tbl_OFS_Temp_Reversal_NSE
end

if @Process ='UploadReverseBSEFile'
begin
		  IF EXISTS(select * from tbl_OFS_Temp_Reversal_BSE where Static_val1='D')  
			BEGIN       
			update p      
			set p.BID_NO=c.Bid_No , p.REMARKS= c.Static_val1      
			from  (  
			select * from tbl_OFS_Temp_Reversal_BSE a   
			join OFS_ScripMaster b      
			on a.SCRIPCODE =b.ScripName) c       
			join tbl_ofs_order p      
			on p.CLIENT_CODE=c.Client_Code   
			and p.SCRIPCODE =c.Srno  
			and RTRIM(LTRIM(p.BID_RATE)) = RTRIM(LTRIM(c.BID_RATE))  
			and RTRIM(LTRIM(p.QUANTITY)) = RTRIM(LTRIM(c.Qty))   
			and GENERATION_FLAG = -4    
			END   
			ELSE  if exists(select * from tbl_OFS_Temp_Reversal_BSE where Static_val1='M')
			BEGIN    
			update p      
			set p.BID_NO=c.Bid_No , p.REMARKS= c.Static_val1  

			from  (  
			select * from tbl_OFS_Temp_Reversal_BSE a   
			join tbl_OFS_ScripMaster b      
			on a.SCRIPCODE =b.ScripName) c       
			join tbl_ofs_order p      
			on p.CLIENT_CODE=c.Client_Code   
			and p.SCRIPCODE =c.Srno  
			and RTRIM(LTRIM(p.BID_RATE)) = RTRIM(LTRIM(c.BID_RATE))  
			and RTRIM(LTRIM(p.QUANTITY)) = RTRIM(LTRIM(c.Qty))     
			and p.filename like '%MOD%'
			End
			else
			begin       
			update p      
			set p.BID_NO=c.Bid_No , p.REMARKS= c.Static_val1  

			from  (  
			select * from tbl_OFS_Temp_Reversal_BSE a   
			join tbl_OFS_ScripMaster b      
			on a.SCRIPCODE =b.ScripName) c       
			join tbl_ofs_order p      
			on p.CLIENT_CODE=c.Client_Code   
			and p.SCRIPCODE =c.Srno  
			and RTRIM(LTRIM(p.BID_RATE)) = RTRIM(LTRIM(c.BID_RATE))  
			and RTRIM(LTRIM(p.QUANTITY)) = RTRIM(LTRIM(c.Qty))     
			END 
			
			truncate table tbl_OFS_Temp_Reversal_BSE
end

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_Report_Back
-- --------------------------------------------------

--SP_OFS_Report_Back '','','BSE','Zone','ALL','Broker','CSO'            
Create proc [dbo].[USP_OFS_Report_Back]                    
(@FDate varchar(25),@TDate varchar(25),@Segment varchar(3),@flttyp varchar(50),                      
@fltval varchar(50),@access_to varchar(10),@access_code varchar(10))                    
AS                    
BEGIN                    
--SELECT CONVERT(VARCHAR(11),GETDATE(),121)+' 59:59:59.999'                    
                
               
 Create table #OFS_ReportDate            
 (             
 [Client_Code] varchar(50),            
 Zone         Varchar(20),                  
 Region       Varchar(20),                  
 Branch       Varchar(20),                  
 Sb           Varchar(20),                  
 Client       Varchar(100),                          
 [B2B/B2C]    varchar(10),                 
 [Scrip Code] varchar(25),            
 Segment      varchar(5),            
 [Type]       varchar(3),            
 [Quantity]   int,             
 [Bid Rate] money,            
 Value money,            
 [Bid No] varchar(25),            
 Remarks varchar(500),            
 [Entered by] varchar(10),            
 batch_no varchar(50),            
 [Date]       datetime,                 
 )              
                
                
 If @FltVal = 'ALL'                    
 Begin                    
  Set @FltVal='%'                    
 End                  
                    
 if @FDate =''                    
 BEGIN                     
 SET @FDate=CONVERT(VARCHAR(11),convert(datetime,GETDATE(),103),106)                  
 END                      
 else                  
 Begin                  
  SET @FDate=CONVERT(VARCHAR(12),convert(datetime,@FDate,103),106)                   
 End                  
 if @TDate =''                    
 BEGIN                    
 SET @TDate=CONVERT(VARCHAR(12),convert(datetime,GETDATE(),103),106)                  
 END                   
 else                  
 Begin                  
  SET @TDate=CONVERT(VARCHAR(12),convert(datetime,@TDate,103),106)                   
 End                     
                     
   DECLARE @StrSql varchar(max)            
  Set @StrSql =''                  
  Set @StrSql =@StrSql + 'insert into #OFS_ReportDate '                      
  set @StrSql= @StrSql+'                     
  SELECT  CLIENT_CODE AS [Client Code],c.Zone,c.Region,c.Branch,c.SB,c.Party_name,space(20) as [B2B/B2C],(select ScripName from tbl_OFS_ScripMaster where SCRIPCODE=Srno) as [Scrip Code],Segment,                    
  CLIENT_TYPE as [Type],QUANTITY as [Quantity],convert(decimal(18,2),BID_RATE) as [Bid Rate],convert(decimal(18,2),(QUANTITY * BID_RATE)) as Value,                    
  BID_NO as [Bid No],Remarks,Entered_by as [Entered by],      
  case when isnull(FileName,'''') like ''%MOd%'' then ''Modified ''+Batch_No when (isnull(FileName,'''')  not like ''%Mod%'' and ISNULL(Batch_No,'''')<>'''' and  isnull(FileName,'''')  not like ''%Del%'') then ''Generated ''+ Batch_No when isnull(FileName
,'''') like ''%Del%'' then ''Deleted ''+Batch_No else '''' end as Batch_NO,  
  CONVERT(DATETIME,REQUEST_DATE,103)AS [Date] from  tbl_OFS_ORDER o with(nolock) inner merge join  risk.dbo.Vw_RMS_Client_Vertical c with(nolock) '                    
                  
  set @StrSql=@StrSql + ' on o.CLIENT_CODE=c.Client COLLATE Latin1_General_CI_AS '                
  Set @StrSql=@StrSql+ ' and c.' + @flttyp+ ' like ''' + @fltval + ''''                        
  set @StrSql=@StrSql+' where 1=1 and SEGMENT='''+@Segment+''' and GENERATION_FLAG not in (-1,-2,-5)'                
              
 IF @access_to ='RGMAST'                    
 BEGIN                 
  set @StrSql = @StrSql + ' AND c.REGION IN (SELECT REGION_CD FROM risk.dbo.region_master with(nolock) WHERE RGMAST_cd='''+@access_code+''') '                
 END                
 ELSE IF @access_to ='BRMAST'                    
 BEGIN                 
  set @StrSql = @StrSql + ' and c.BRANCH IN (SELECT BRANCH_CD FROM risk.dbo.branch_master with(nolock) WHERE BrMast_cd='''+@access_code+''')  '                
 END                
 ELSE IF @access_to ='SBMAST'                    
 BEGIN                
  set @StrSql = @StrSql + 'and c.SB IN (SELECT SUB_BROKER FROM risk.dbo.SB_master with(nolock) WHERE SBMAST_CD='''+@access_code+''')  '                
 END                
 ELSE IF @access_to ='BROKER'                    
 BEGIN                
  set @StrSql = @StrSql + ' '                
 END                
 ELSE                
 BEGIN                
  set @StrSql = @StrSql + ' and '+@access_to+'='''+@access_code+'''  '                    
 END              
              
                      
  if(@FDate<>'')                    
  Begin                    
   set @StrSql=@StrSql+' and CONVERT(varchar(12),Request_date,106)>='''+@FDate+''''                    
  End                    
  if(@TDate<>'')                    
  Begin                    
  set @StrSql=@StrSql+' and CONVERT(varchar(12),Request_date,106)<='''+@TDate+''''                    
  End                      
  set @StrSql=@StrSql+' order by Request_date'                  
  --select ScripName from OFS_ScripMaster where SCRIPCODE=Srno                  
              
PRINT (@StrSql)                    
Exec   (@StrSql)             
            
 UPDATE #OFS_ReportDate                                                  
 SET [B2B/B2C]  =CASE d.b2c                                  
        WHEN 'y' THEN 'b2c'             
                 ELSE 'b2b'                                  
                 END                                                         
 FROM #OFS_ReportDate  u inner merge join risk.dbo.client_details d                
 on u.Client_Code=d.party_code               
            
select [Client_Code], Zone,Region,Branch,Sb,Client,[B2B/B2C],[Scrip Code],Segment,[Type],[Quantity],             
cast (convert(decimal(18,2),[Bid Rate]) as varchar(100)) as  [Bid Rate],cast(convert(decimal(18,2),Value) as varchar(100)) as  Value,[Bid No] ,Remarks ,[Entered by] ,batch_no ,[Date]       from #OFS_ReportDate                      
eND

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_ValidClient
-- --------------------------------------------------

CREATE procedure [dbo].[USP_OFS_ValidClient](@Pcode as varchar(10),@access_to as varchar(10),@access_Code as varchar(10))        
as        
        
declare @str as varchar(2000) = ''        
SEt nocount on        
        
set @str=''        
set @str = @str + ' select a.party_code,a.long_name,BSECM,NSECM, '        
set @str = @str + ' (Case when BSECM=''N'' and NSECM=''N'' then ''Client is not Active in BSE & NSE Cash Segment'''         
set @str = @str + ' else '''' end) as Remarks into #file1 '        
set @str = @str + ' from risk.dbo.client_details a with (nolock) join '        
set @str = @str + ' (select * from risk.dbo.Vw_RMS_Vertical with (nolock) where '      
IF @access_to ='RGMAST'      
BEGIN   
 set @str = @str + 'REGION IN (SELECT REGION_CD FROM risk.dbo.region_master WHERE RGMAST_cd='''+@access_code+''') AND '  
END  
ELSE IF @access_to ='BRMAST'      
BEGIN   
 set @str = @str + 'BRANCH IN (SELECT BRANCH_CD FROM risk.dbo.branch_master WHERE BrMast_cd='''+@access_code+''') AND '  
END  
ELSE IF @access_to ='SBMAST'      
BEGIN  
 set @str = @str + 'SB IN (SELECT SUB_BROKER FROM risk.dbo.SB_master WHERE SBMAST_CD='''+@access_code+''') AND '  
END  
ELSE IF @access_to ='BROKER'      
BEGIN  
 set @str = @str + ' '  
END  
ELSE  
BEGIN  
 set @str = @str + @access_to+'='''+@access_code+''' and '      
END  
  
set @str = @str + ' Client='''+@Pcode+''')'        
set @str = @str + ' b on a.party_code=b.client ' 
set @str =@str +'declare @table as table
(
list  varchar(800)
)

if exists (select 1 from #file1 where BSECM=''Y'')
begin 
insert into @table values (''BSE'') 
end

if exists (select 1 from #file1 where NSECM=''Y'')
begin 
insert into @table values (''NSE'') 
end

if (select COUNT (1) from @table)=0
begin
insert into @table 
select Remarks from #file1
end

if exists (select 1 from @table  )
begin
select * from @table  
end
else
begin
select ''Client is not valid !'' as list
end


' 
       

exec (@str)   

    
      
SEt nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_ValidORder
-- --------------------------------------------------
 
CREATE procedure [dbo].[USP_OFS_ValidORder](@pcode as varchar(10)='',@srno as int=0,@bidrate as money=0,@qty as int=0,@Bid_No as varchar(25)=NULL)          
as          
          
Set nocount on          
          
/*          
exec OFS_Client_NL_NA 'M709'          
          
declare @pcode as varchar(10),@srno as int,@bidrate as money,@qty as int          
set @pcode='M709'          
set @srno=2          
set @bidrate=359          
set @qty=25000          
*/          
          
/* Get NA_NL */          
    declare @chkDupClientcode bit           
 declare @AcYrFrom as datetime,@BSECM as money = 0,@NSECM as money = 0,@NSEFO as money = 0,@NSX as money = 0,@MCD as money = 0,@hold as money = 0,@nbfc as money = 0          
 select @AcYrFrom=sdtcur from risk.dbo.parameter with (nolock)           
 where sdtcur <= GETDATE() and ldtcur >= GETDATE()          
          
 select @BSECM=sum(Case when Drcr='C' then -vamt else vamt end) from AngelBSECM.account_ab.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode          
 select @NSECM=sum(Case when Drcr='C' then -vamt else vamt end) from AngelNseCM.account.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode          
 select @NSEFO=sum(Case when Drcr='C' then -vamt else vamt end) from angelfo.accountfo.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode          
 select @NSX=sum(Case when Drcr='C' then -vamt else vamt end) from angelfo.inhouse_curfo.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode          
 select @MCD=sum(Case when Drcr='C' then -vamt else vamt end) from ANGELCOMMODITY.inhouse_mcdcs.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode          
 --commented by sandeep suggested by Bhavin      
 --select @hold=isnull(sum(total),0) from [196.1.115.182].general.dbo.rms_holding where isnull(source,'XX') not in ('DP','XX') and party_Code=@pcode          
 --commented by sandeep suggested by Bhavin       
 select @NBFC=sum(Case when Drcr='C' then -vamt else vamt end) from [172.31.16.57].accountnbfc.dbo.ledger where vdt >= @AcYrFrom and cltcode=@pcode          
 select @hold=@hold+isnull(sum(Hold_Total),0) from [CSOKYC-6].general.dbo.tbl_rms_collection_cli where party_Code=@pcode          
 SELECT @hold=@hold+isnull(SUM(CASE WHEN CASH_NCASH = 'N' THEN AMOUNT ELSE FINALAMOUNT END),0)          
 FROM [CSOKYC-6].general.dbo.CLIENT_COLLATERALS where Party_Code=@pcode and co_Code not in ('MCX','NCDEX')           
 GROUP BY co_code,Party_Code           
           
 select @chkDupClientcode=COUNT(1) from tbl_OFS_ORDER with(nolock) where CLIENT_CODE=@pcode and SCRIPCODE=@srno           
 and REQUEST_DATE >= CONVERT(varchar(11),getdate())+' 00:00:00' and REQUEST_DATE <= CONVERT(varchar(11),getdate())+' 23:59:59'          
           
           
 declare @NA as money = 0,@NL as money = 0,@minBidRate as money = 0,@maxBidRate as money = 0,@PerAlert as int =0,@RILimit as money =0,@MinMargin as int =0          
 declare @NANL as char(2) = ''          
 declare @CliRIStat as varchar(3) = 'RI',@ConfFlag as char(1) = 'N',@succflag as int = 0          
          
 select @NL=ISNULL(isnull(@BSECM,0)+isnull(@NSECM,0)+isnull(@NSEFO,0)+isnull(@MCD,0)+isnull(@NSX,0)+isnull(@NBFC,0),0)*-1,          
 @NA=ISNULL(isnull(@BSECM,0)+isnull(@NSECM,0)+isnull(@NSEFO,0)+isnull(@MCD,0)+isnull(@NSX,0)+isnull(@NBFC,0)-isnull(@hold,0),0)*-1          
          
/* GEt Scrip dEtails */          
          
 select           
 @minBidRate=MinBidRate,        
 @maxBidRate=MaxBidRate,        
 @PerAlert=PercentAlert,          
 @RILimit=RI_AmtLimit,          
 @MinMargin=MinMarginPercent,          
 @NANL=Checkon_NetA_NetL          
 from tbl_OFS_ScripMaster with (nolock) where ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'          
 and ValidForDate <= CONVERT(varchar(11),getdate())+' 23:59:59' and srno=@Srno          
        
/* Calculation */          
          
          
          
if (@qty*@bidrate) >= @RILimit          
BEGIN          
 set @CliRIStat = 'NII'          
END          
          
if (@bidrate > (@minBidRate+(@minBidRate*(@PerAlert/100.00))))          
Begin          
 set @ConfFlag='Y'          
End          
          
if @bidrate < @minBidRate          
Begin           
 set @succflag = 0          
 Select 'Warning : Bid Rate is less than Floor Price (Rs.'+convert(varchar(10),@minBidRate)+').' as Status,Flag=@succflag,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
End          
ELSE IF @bidrate > @maxBidRate          
Begin          
 set @succflag = 0          
 Select 'Warning : Bid Rate exceeds Celing Price (Rs.'+convert(varchar(10),@maxBidRate)+').' as Status,Flag=@succflag,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
END          
ELSE IF (@NANL='NA' and ((@qty*@bidrate)*(@MinMargin/100.00)) > @NA)          
Begin          
  Select 'Warning : Insufficient required Margin. Net Available is Rs.'+convert(varchar(25),convert(decimal(15,2),@NA))+'.' as Status,Flag=0,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
END          
ELSE IF (@NANL='NL' and (((@qty*@bidrate)*(@MinMargin/100.00)) > @NL))          
Begin          
  Select 'Warning : Insufficient required Margin. Net Ledger is Rs.'+convert(varchar(25),convert(decimal(15,2),@NL))+'.' as Status,Flag=0,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
END          
ELSE IF (@chkDupClientcode>=1 AND ISNULL(@Bid_No,'')='')          
BEGIN          
  Select 'Warning : Client Code '+@pcode+' already exist. Duplicate Entry Restricted' as Status,Flag=0,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
END          
ELSE IF (@ConfFlag ='Y')          
BEGIN          
  Select 'Warning : Bid Rate is Higher than '+convert(varchar(5),@PerAlert)+' of Floor Price.' as Status,Flag=1,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
END          
          
ELSE           
BEGIN          
  Select 'Success' as Status,Flag=1,@CliRIStat as RIStat,@ConfFlag as ConfFlag          
END          
      
      
print @NANL      
  print cast((@qty*@bidrate)*(@MinMargin/100.00) as varchar(100))      
  print 'NA '+cast(@NA as varchar(100))      
  print 'BSE '+cast(isnull(@BSECM,'') as varchar(100))      
  print 'NSe '+cast(isnull(@NSECM,'') as varchar(100))      
  print 'NSEFO '+cast(isnull(@NSEFO,'') as varchar(100))      
  print 'NSX '+cast(isnull(@NSX,'') as varchar(100))      
  print 'MCD '+cast(isnull(@MCD,'') as varchar(100))      
  print 'HOLD '+cast(isnull(@hold,'') as varchar(100))      
  print 'NBFC '+cast(isnull(@NBFC,'') as varchar(100))      
  print 'Hold '+cast(isnull(@hold,'') as varchar(100))             
          
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFS_ValidScrip_Onload
-- --------------------------------------------------
--USP_OFS_ValidScrip_Onload


CREATE procedure [dbo].[USP_OFS_ValidScrip_Onload]    
as    
  
SEt nocount on  
  
 declare @reccnt as int = 0
 declare @LockStatus as varchar(10) = '' 

 select @reccnt=count(1) from tbl_OFS_Lock with (nolock)   

 if @reccnt  = 0  
 Begin  
  insert into tbl_OFS_Lock select 'System',GETDATE(),'Unlock'  
 End  
  
 select @LockStatus=LockStatus from tbl_OFS_Lock a with (nolock) join  
 (select max(Id) as ID from tbl_OFS_Lock   
 
 )b on a.id=b.id  
  
 if @LockStatus='Lock'  
 Begin  
  Select 0 as TdayCnt,'OFS Order Entry window closed for the day.' as Remarks  
 End  
 Else  
 Begin  
  select COUNT(1) as TdayCnt,'Scrip does not exists for Sale for Today' as Remarks    
  from tbl_OFS_ScripMaster with (nolock) where ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'    
  and ValidForDate <= CONVERT(varchar(11),getdate())+' 23:59:59' and IsDelete =0   
 End  
   
SEt nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFSInsScriptMst
-- --------------------------------------------------

create Procedure [dbo].[USP_OFSInsScriptMst]      
(    
@Srno int=null,    
@ScripName varchar(50),      
@BSECode   varchar(20),      
@NSESymbol varchar(20),      
@ValidForDate varchar(12),      
@MinBidRate money,      
@MaxBidRate money,      
@PercentAlert int,      
@RI_AmtLimit money,      
@MinMarginPercent int,      
@Checkon_NetA_NetL char(2),      
@EnteredBy varchar(10)      
)      
As      
Begin      
  
if(isnull(@Srno,'')='')  
Begin  
  
insert into OFS_ScripMaster(ScripName,BSECode,NSESymbol,ValidForDate,MinBidRate,MaxBidRate,PercentAlert,RI_AmtLimit,MinMarginPercent,Checkon_NetA_NetL,EnteredBy,EnteredOn)      
values      
(@ScripName,@BSECode,@NSESymbol,convert(datetime,@ValidForDate,103),@MinBidRate,@MaxBidRate,@PercentAlert,@RI_AmtLimit,@MinMarginPercent,@Checkon_NetA_NetL,@EnteredBy,GETDATE())      
End  
Else  
Begin  
update OFS_ScripMaster  
set ScripName=@ScripName,  
BSECode=@BSECode,NSESymbol=@NSESymbol,ValidForDate=convert(datetime,@ValidForDate,103),MinBidRate=@MinBidRate,MaxBidRate=@MaxBidRate  
,PercentAlert=@PercentAlert,RI_AmtLimit=@RI_AmtLimit,MinMarginPercent=@MinMarginPercent,Checkon_NetA_NetL=@Checkon_NetA_NetL,EnteredBy=@EnteredBy  
where Srno=@Srno  
End  
  
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFSLockMaintence
-- --------------------------------------------------
CREATE proc [dbo].[USP_OFSLockMaintence]
@Process varchar(20)='',
@ID int=0,
@EnteredBy varchar(10)='',
@EnteredOn datetime =null,
@LockStatus varchar(10)=''

As begin

if(@Process='AddLock')
begin 
declare @Status varchar(10)=''

 select @Status=LockStatus from tbl_OFS_Lock a with (nolock) join  
 (select max(Id) as ID from tbl_OFS_Lock   
 )b on a.id=b.id 
 
 if(@Status='Lock')
 begin
 set @LockStatus='Unlock'
 end
 else
 begin
  set @LockStatus='Lock'
 end
 
 
insert into tbl_OFS_Lock (EnteredBy,EnteredOn,LockStatus)
values(@EnteredBy,GETDATE(),@LockStatus)
end

if(@Process='GetLock')
begin 
 select * from tbl_OFS_Lock a with (nolock) join  
 (select max(Id) as ID from tbl_OFS_Lock   
 )b on a.id=b.id 
end

end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_OFSScriptMaster
-- --------------------------------------------------
  
CREATE Procedure [dbo].[USP_OFSScriptMaster]        
(     
@Process varchar(50) ='',  
@Srno int=0,      
@ScripName varchar(50)='',        
@BSECode   varchar(20)='',        
@NSESymbol varchar(20)='',        
@ValidForDate varchar(30)='',        
@MinBidRate money=0,        
@MaxBidRate money=0,        
@PercentAlert int=0,        
@RI_AmtLimit money=0,        
@MinMarginPercent int=0,        
@Checkon_NetA_NetL char(2)='',        
@EnteredBy varchar(10)='' ,  
@IsDelete int =0,  
@cnt int=0 output       
)        
As        
Begin        
    
if(@Process='Add Script')    
Begin   
  
  select @cnt= COUNT (1)from tbl_OFS_ScripMaster where (ScripName=@ScripName  )  and (IsDelete =0 or IsDelete is null) and ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'    
  
  
  if (@cnt=0)    
   begin    
   insert into tbl_OFS_ScripMaster(ScripName,BSECode,NSESymbol,ValidForDate,MinBidRate,MaxBidRate,PercentAlert,RI_AmtLimit,MinMarginPercent,Checkon_NetA_NetL,EnteredBy,EnteredOn,IsDelete)        
   values        
   (@ScripName,@BSECode,@NSESymbol,cast (@ValidForDate as DATE),@MinBidRate,@MaxBidRate,@PercentAlert,@RI_AmtLimit,@MinMarginPercent,@Checkon_NetA_NetL,@EnteredBy,GETDATE(),0)        
   End   
  
end  
   
if(@Process='Update Script')    
Begin 
  select @cnt= COUNT (1)from tbl_OFS_ScripMaster where (ScripName=@ScripName  )  and (IsDelete =0 or IsDelete is null)and  ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'  and Srno <>@Srno   
  
		if (@cnt=0)    
		begin    
			update tbl_OFS_ScripMaster    
			set ScripName=@ScripName,    
			BSECode=@BSECode,NSESymbol=@NSESymbol,ValidForDate=cast (@ValidForDate as DATE),MinBidRate=@MinBidRate,MaxBidRate=@MaxBidRate    
			,PercentAlert=@PercentAlert,RI_AmtLimit=@RI_AmtLimit,MinMarginPercent=@MinMarginPercent,Checkon_NetA_NetL=@Checkon_NetA_NetL,UpdatedBy=@EnteredBy ,  UpdatedOn =GETDATE() 
			where Srno=@Srno 
		end   
End   

if(@Process='Delete Script')    
Begin 
  select @cnt= COUNT (1)from tbl_OFS_ORDER where  SCRIPCODE =@Srno   
  
		if (@cnt=0)    
		begin    
			update tbl_OFS_ScripMaster    
			set IsDelete =1,
                UpdatedBy=@EnteredBy , 
                UpdatedOn =GETDATE() 
			where Srno=@Srno 
		end   
End  


  
if(@Process='Get Scripts')    
Begin    
select Srno,ScripName,BSECode,NSESymbol,convert(varchar(12),ValidForDate,106) as ValidForDate,cast (convert(decimal(18,2),MinBidRate) as varchar(100)) as MinBidRate,cast (convert(decimal(18,2),MaxBidRate) as varchar(100)) as MaxBidRate,PercentAlert,cast (
convert(decimal(18,2),RI_AmtLimit) as varchar(100)) as RI_AmtLimit,MinMarginPercent,case when Checkon_NetA_NetL='NA' then 'Net Available' else 'Net Ledger' end as Checkon_NetA_NetL,        
EnteredBy,EnteredOn,UpdatedBy,UpdatedOn        
from  tbl_OFS_ScripMaster with(nolock) where  ValidForDate >= CONVERT(varchar(11),getdate())+' 00:00:00'    
  and IsDelete =0    
 
End   
    
End

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PDAUserLogin
-- --------------------------------------------------
CREATE proc [dbo].[USP_PDAUserLogin]
(
@Process varchar(50),
@EntryId int=0,
@UserName varchar(50)='',
@Password varchar(50)='',
@CreatedOn varchar(10)='',
@ModifyOn varchar(50)='',
@ModifyBy varchar(50)='',
@Isdeleted int=0


)

as begin
if @Process ='Add'
begin
insert into tbl_PDALogin (UserName,Password) values (@UserName,@Password)
end
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_Perfmon
-- --------------------------------------------------
-- =============================================
-- AUTHOR:		SURAJ PATIL
-- CREATE DATE: 28-07-2016
-- DESCRIPTION:	SERVER PERFORMANCE MONITORING
-- =============================================
CREATE PROCEDURE USP_PERFMON
	@SERVER_NAME AS VARCHAR(100),
	@IP_ADDRESS AS VARCHAR(100),
	@NOOFCORES AS VARCHAR(100),
	@PROCESSOR AS VARCHAR(100),
	@CPU_UTILIZATION AS VARCHAR(100),
	@TOTAL_RAM AS VARCHAR(100),
	@AVAILABLE_RAM AS VARCHAR(100),
	@FREERAM AS VARCHAR(100),
	@DRIVES AS VARCHAR(100),
	@Totalspace AS VARCHAR(100),
	@FREESPACE AS VARCHAR(100),
	@USEDSPACE AS VARCHAR(100)
	
	
AS
BEGIN
	INSERT INTO TBL_PERFMON(SERVER_NAME,IP_ADDRESS,NOOFCORES,PROCESSOR,CPU_UTILIZATION,TOTAL_RAM,AVAILABLE_RAM,USEDRAM,DRIVES,TotalDriveSpace,FREESPACE,USEDSPACE)
    VALUES(@SERVER_NAME,@IP_ADDRESS,@NOOFCORES,@PROCESSOR,@CPU_UTILIZATION,@TOTAL_RAM,@AVAILABLE_RAM,@FREERAM,@DRIVES,@Totalspace,@FREESPACE,@USEDSPACE)
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_pms_addclient
-- --------------------------------------------------
CREATE proc [dbo].[usp_pms_addclient]      
(      
@party_code as varchar(50),      
@scheme_name as varchar(50),  
@Discret_Flag as char(1)      
--@access_to as varchar(50),      
--@access_code as varchar(50)      
)      
as      
declare @cnt as int      
declare @scheme as varchar(15)      
select @cnt= count(*) from PMS_info where party_code=@party_code      
      
--print @cnt      
      
if @scheme_name='Equity'      
begin      
if @cnt = 0       
begin      
set @scheme='1'      
insert into PMS_info values(@party_code,@scheme,@scheme_name,@Discret_Flag)      
end      
end      
      
if @scheme_name='Derivative'      
begin      
if @cnt = 0       
begin      
set @scheme='2'      
insert into PMS_info values(@party_code,@scheme,@scheme_name,@Discret_Flag)      
end      
end

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PMS_TRADE_DATAHISTORY_NEW
-- --------------------------------------------------
CREATE PROC [dbo].[USP_PMS_TRADE_DATAHISTORY_NEW]              
(                              
    @TRADE_DATE AS VARCHAR(11),                 
    @TRADE_TYPE AS VARCHAR(2),                              
    @CLIENT_CODE AS VARCHAR(15),                              
    @SEGMENT AS VARCHAR(10),                              
    @LOCATION AS VARCHAR(2),                
    @SCHEME_CODE AS VARCHAR(2),                
                      
    @ACCESS_TO AS VARCHAR(15),                    
    @ACCESS_CODE AS VARCHAR(15)                              
)                              
AS                   
                
BEGIN                
                
    SET NOCOUNT ON                 
                    
    DECLARE @DB VARCHAR(100)                
    SET @DB=''                
                    
    DECLARE @TABLE VARCHAR(100)                
    SET @TABLE=''                
                    
    DECLARE @SEG VARCHAR(100)                
    SET @SEG=''                
                    
    DECLARE @USERIDCND VARCHAR(500)                
    SET @USERIDCND=''                 
                    
    DECLARE @SETTYPECND VARCHAR(50)                
    SET @SETTYPECND=''                          
                    
    DECLARE @STR VARCHAR(MAX)                
    SET @STR=''                 
                
    IF @SEGMENT='BSECM'                
    BEGIN                
        SET @DB='AngelBSECM.BSEDB_AB.DBO.'                
        --SET @DB='[angeldemat].BSEDB.DBO.'                
        SET @SEG='BSE'                
        SET @USERIDCND='(USER_ID IN (SELECT BRANCHD_CTCLUSERID                  
                        FROM INTRANET.RISK.DBO.V_CTCL_SB_DETAILS                 
                        --WHERE CTCL_ODINID=''ACME1'' AND CTCL_STATUS=''ACTIVE'' AND BRANCHD_LINEID <> ''IML'' AND CTCLBRANCH_SEGMENT=''BSE'')                      
                        WHERE CTCL_STATUS=''ACTIVE'' AND CTCLBRANCH_SEGMENT=''BSE-CASH'')                      
                        OR USER_ID IN (184,518,369)) '                
        SET @SETTYPECND='SETT_TYPE IN (''D'',''C'')  '                
                        
                             
        IF @LOCATION='C'                
        BEGIN                
            SET @TABLE = @DB+'SETTLEMENT'                
        END                
        ELSE                
        BEGIN                
            SET @TABLE = @DB+'HISTORY'                
        END                
    END                
                
    IF @SEGMENT='NSECM'                
    BEGIN                
        SET @DB='AngelNseCM.MSAJAG.DBO.'                
        SET @SEG='NSE'                
        SET @USERIDCND='USER_ID IN                   
                        (SELECT BRANCHD_CTCLUSERID                  
                        FROM INTRANET.RISK.DBO.V_CTCL_SB_DETAILS                 
                        --WHERE CTCL_ODINID=''ACME1'' AND CTCL_STATUS=''ACTIVE'' AND BRANCHD_LINEID <> ''IML'' AND CTCLBRANCH_SEGMENT=''NSE'')         
                        WHERE CTCL_STATUS=''ACTIVE'' AND CTCLBRANCH_SEGMENT=''NSE-CASH'') '        
        SET @SETTYPECND='SETT_TYPE IN (''N'',''W'')  '                                          
                        
                                
        IF @LOCATION='C'                
        BEGIN                
            SET @TABLE = @DB+'SETTLEMENT'                
        END                
        ELSE                
        BEGIN                
            SET @TABLE = @DB+'HISTORY'                
        END                 
    END                
                
    SET @STR=                
    '                
    DECLARE  @PARTY TABLE                          
    (                          
        PARTY_CODE VARCHAR(15)                
    )                
    '                
                    
                
                    
    --IF @CLIENT_CODE ='%'                
    --BEGIN                
        SET @STR=@STR+'                  
        INSERT INTO @PARTY                
        --SELECT PARTY_CODE FROM INTRANET.TESTDB.DBO.PMS_INFO WHERE DISCRET_FLAG LIKE '''+@TRADE_TYPE+'''                 
        SELECT PARTY_CODE FROM DBO.V_PMS_INFO WHERE DISCRET_FLAG LIKE '''+@TRADE_TYPE+'''            
        AND PARTY_CODE LIKE '''+@CLIENT_CODE+''' OR PARTY_CODE LIKE ''98''+'''+@CLIENT_CODE+'''                
        '                 
    --END                
                    
    --ELSE                
    --BEGIN                
    -- DECLARE  @FCODE VARCHAR(10)                
    --    SET @FCODE='NRIPMS'                
                        
    --    SET @STR=@STR+'                
    --    INSERT INTO @PARTY                
    --    SELECT PARTY_CODE FROM '+@DB+'CLIENT2 WITH(NOLOCK)                 
    --    WHERE CL_CODE IN (                                    
    --                        (SELECT CL_CODE FROM '+@DB+'CLIENT1 WITH(NOLOCK) WHERE FAMILY='''+@FCODE+''' )                                    
    --                        UNION                                    
    --                        SELECT PARTY_CODE='''+@CLIENT_CODE+'''                
    --                     )                 
  --    '                
    --END                
                  
    --NSEFO START---              
                  
    IF @SEGMENT='NSEFO'                
    BEGIN               
        SET @STR=@STR+'               
        SELECT * FROM ANGELFO.NSEFO.DBO.ANGEL_PMS_NSETRADE               
        WHERE PARTY_CODE IN (SELECT * FROM @PARTY)                
        AND SAUDA_DATE>=CONVERT(DATETIME,'''+@TRADE_DATE+''',103)+'' 00:00:00''                
        AND SAUDA_DATE<=CONVERT(DATETIME,'''+@TRADE_DATE+''',103)+'' 23:59:59''               
        '                       
    END               
                  
    --NSEFO END---                
                  
    --BSECM & NSECM START---              
                  
    ELSE              
                  
    BEGIN               
                    
        IF @SCHEME_CODE='1'                
                        
        BEGIN                
            SET @STR = @STR + '                
                            
            SELECT  SEBI_NO=''INB010996539'',CONTRACTNO,                
            EXCHANGE = CASE WHEN '''+@SEG+'''=''BSE'' THEN ''B'' WHEN '''+@SEG+'''=''NSE'' THEN ''N'' END,                
            TRADEDATE=CONVERT(VARCHAR(11),SAUDA_DATE,103),                                    
            SEGMENT1=(CASE WHEN SETT_TYPE=''D'' THEN ''ROLLING'' ELSE ''T2T'' END),                                    
            SETTLEMENT_NUMBER=SUBSTRING(SETT_NO,5,3),                                    
            SETTLEMENT_YEAR=SUBSTRING(SETT_NO,1,4),                                    
            --BACKOFFICECODE=(CASE when '+@TRADE_TYPE+'=''N'' then substring(PARTY_CODE,3,10) else PARTY_CODE END),                                    
            BACKOFFICECODE=PARTY_CODE,
            BSE_CODE=CASE WHEN '''+@SEG+'''=''BSE'' THEN LTRIM(RTRIM(SCRIP_CD)) WHEN '''+@SEG+'''=''NSE'' THEN SPACE(6) END,                
            NSE_SYMBOL=CASE WHEN '''+@SEG+'''=''BSE'' THEN SPACE(25) WHEN '''+@SEG+'''=''NSE'' THEN LTRIM(RTRIM(SCRIP_CD)) END,                                   
            NSE_GROUP=CASE WHEN '''+@SEG+'''=''BSE'' THEN ''EQ'' WHEN '''+@SEG+'''=''NSE'' THEN SERIES END,              
            ISIN=SPACE(20),                                    
            SCRIP_NAME=SPACE(60),                                    
            BOUGHT_SOLD=(CASE WHEN SELL_BUY=''1'' THEN ''B'' ELSE ''S'' END),                                    
            TRADED_QUANTITY=TRADEQTY,                                    
            MARKETRATE,                                    
            N_NETRATE,                                    
            NSERTAX=NSERTAX,                                    
            TRANS_CHGS=INS_CHRG,                                
            OTHER_CHRG=OTHER_CHRG+TURN_TAX+SEBI_TAX+BROKER_CHRG,                                    
            STOCK_PAYIN=SPACE(25),                                    
            STOCK_PAYOUT=SPACE(25),                                    
            CASH_PAYIN=SPACE(25),                               
            CASH_PAYOUT=SPACE(25)                                    
            INTO #FILE1                                    
            FROM '+@TABLE+'                            
            WHERE PARTY_CODE IN (SELECT * FROM @PARTY)                
            AND SAUDA_DATE>=CONVERT(DATETIME,'''+@TRADE_DATE+''',103)+'' 00:00:00''                                     
            AND SAUDA_DATE<=CONVERT(DATETIME,'''+@TRADE_DATE+''',103)+'' 23:59:59''                                     
            AND '+@SETTYPECND+'                              
            AND STATUS <> ''N''                              
            /*AND    '+@USERIDCND +'    '+@DB+'*/                
                                                
            UPDATE #FILE1 SET ISIN=B.ISIN FROM                                     
            (SELECT * FROM [angeldemat].bsedb.dbo.MULTIISIN WHERE VALID =1 ) B WHERE                                     
            #FILE1.BSE_CODE=B.SCRIP_CD    '                
                            
            IF @SEGMENT='BSECM'                
  BEGIN                 
                            
            SET @STR = @STR + '                   
                            
                UPDATE #FILE1 SET SCRIP_NAME=B.LONG_NAME FROM                
                (SELECT B.BSECODE,A.LONG_NAME FROM '+@DB+'SCRIP1 A WITH(NOLOCK),                 
                                                   '+@DB+'SCRIP2 B WITH(NOLOCK) WHERE A.CO_CODE=B.CO_CODE) B                
                WHERE #FILE1.BSE_CODE=B.BSECODE                   
            '                
            END                 
                            
            IF @SEGMENT='NSECM'                
            BEGIN                 
                            
            SET @STR = @STR + '                    
                            
                UPDATE #FILE1 SET SCRIP_NAME=B.LONG_NAME FROM                                     
                (SELECT B.SCRIP_CD,B.SERIES,A.LONG_NAME FROM '+@DB+'SCRIP1 A (NOLOCK),                 
                                                             '+@DB+'SCRIP2 B (NOLOCK) WHERE A.CO_CODE=B.CO_CODE) B                                    
                WHERE #FILE1.NSE_SYMBOL=B.SCRIP_CD AND #FILE1.NSE_GROUP=B.SERIES '             
                            
            END                 
                            
            DECLARE @ROLLCND AS VARCHAR(100)                
                            
            IF @SEGMENT='BSECM'                
            BEGIN                 
                SET @ROLLCND=' ''D'' ELSE ''C'' END)  '                
            END                
                            
            IF @SEGMENT='NSECM'                
            BEGIN                 
                SET @ROLLCND=' ''N'' ELSE ''W'' END)  '                
            END                  

			  if @TRADE_TYPE='N'
			  BEGIN
					SET @STR = @STR + ' UPDATE #file1 set BACKOFFICECODE=SUBSTRING(BACKOFFICECODE,3,10) '
			  END

                            
            SET @STR = @STR + '                
                            
            UPDATE #FILE1 SET                                     
                            STOCK_PAYIN  = CONVERT(VARCHAR(11),SEC_PAYIN,103),              
                            STOCK_PAYOUT = CONVERT(VARCHAR(11),SEC_PAYOUT,103),                                    
                            CASH_PAYIN  = CONVERT(VARCHAR(11),B.FUNDS_PAYIN,103),                                    
                            CASH_PAYOUT  = CONVERT(VARCHAR(11),B.FUNDS_PAYOUT,103)              
            FROM '+@DB+'SETT_MST B WITH(NOLOCK)                                   
            WHERE B.SETT_TYPE=(CASE WHEN #FILE1.SEGMENT1=''ROLLING'' THEN  '+@ROLLCND +'                               
            AND B.SETT_NO=SETTLEMENT_YEAR+''''+SETTLEMENT_NUMBER                                    

                                                
            SELECT * FROM                                    
            (                                    
            SELECT * FROM #FILE1                                    
            ) A                           
            ORDER BY EXCHANGE,SCRIP_NAME,BOUGHT_SOLD                 
                                
            '                
                            
        END                
                      
                      
        IF @SCHEME_CODE='2'                
                        
        BEGIN                
            SET @STR = @STR + '                
                          
                    SELECT SCRIP_CD=CASE WHEN '''+@SEG+'''=''BSE'' THEN LTRIM(RTRIM(SCRIP_CD)) WHEN '''+@SEG+'''=''NSE'' THEN SPACE(6) END,               
                           NSE_SYMBOL=CASE WHEN '''+@SEG+'''=''BSE'' THEN SPACE(25) WHEN '''+@SEG+'''=''NSE'' THEN LTRIM(RTRIM(SCRIP_CD)) END,                                   
                           NSE_GROUP=CASE WHEN '''+@SEG+'''=''BSE'' THEN ''EQ'' WHEN '''+@SEG+'''=''NSE'' THEN SERIES END,              
                           SCRIP_NAME=SPACE(25),                      
      TRADE_NO,MARKETRATE=MARKETRATE*100,TRADEQTY,USER_ID,                      
                    CBRK=0,                      
                    CUSR=0,                      
                    TTIME=CONVERT(VARCHAR(8),SAUDA_DATE,108),                      
                    TDATE=CONVERT(VARCHAR(10),SAUDA_DATE,103),                      
                    PARTY_CODE,                      
                    SELL_BUY=CASE WHEN SELL_BUY=1 THEN ''B'' ELSE ''S'' END,                      
                    L=''L'',               
                    ORDER_NO,                      
                    PRO_CLI=CASE WHEN PRO_CLI=''1'' THEN ''CLIENT'' ELSE PRO_CLI END,                      
                    ISIN=SPACE(25)                      
                    INTO #FILE2                      
                    FROM '+@TABLE+'              
                    WHERE PARTY_CODE='''+@CLIENT_CODE+'''              
                    AND SAUDA_DATE>=CONVERT(DATETIME,'''+@TRADE_DATE+''',103)+'' 00:00:00''                                     
                    AND SAUDA_DATE<=CONVERT(DATETIME,'''+@TRADE_DATE+''',103)+'' 23:59:59''                
                    AND  '+@USERIDCND +'                       
                          
            '                
                          
        IF @SEGMENT='BSECM'                
            BEGIN                 
              
            SET @STR = @STR + '                   
              
                UPDATE #FILE2 SET SCRIP_NAME=B.SHORT_NAME FROM                      
                (SELECT B.BSECODE,SHORT_NAME FROM '+@DB+'SCRIP1 A (NOLOCK), '+@DB+'SCRIP2 B (NOLOCK) WHERE A.CO_CODE=B.CO_CODE) B                      
                WHERE #FILE2.SCRIP_CD=B.BSECODE              
                              
                '                
            END                 
              
            IF @SEGMENT='NSECM'                
            BEGIN                 
              
            SET @STR = @STR + '                    
              
                UPDATE #FILE2 SET SCRIP_NAME=B.SHORT_NAME FROM                                   
(SELECT B.SCRIP_CD,B.SERIES,A.SHORT_NAME FROM '+@DB+'SCRIP1 A (NOLOCK), '+@DB+'SCRIP2 B (NOLOCK) WHERE A.CO_CODE=B.CO_CODE) B                                  
                WHERE #FILE2.NSE_SYMBOL=B.SCRIP_CD AND #FILE2.NSE_GROUP=B.SERIES   '                
              
            END               
                          
            SET @STR = @STR + '                    
                          
                UPDATE #FILE2 SET ISIN=B.ISIN FROM '+@DB+'MULTIISIN B                      
                WHERE #FILE2.SCRIP_CD=B.SCRIP_CD AND B.VALID=1'                
  
			  if @TRADE_TYPE='N'
			  BEGIN
					SET @STR = @STR + ' UPDATE #file2 set BACKOFFICECODE=SUBSTRING(BACKOFFICECODE,3,10) '
			  END
			  
			SET @STR = @STR + ' SELECT * FROM #FILE2 '              
        END              
                      
                  
    END              
  
                  
    --BSECM & NSECM END---              
                  
    --PRINT (@STR)                
    EXEC (@STR)                
                    
                
    SET NOCOUNT OFF                        
                
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_pmsreport
-- --------------------------------------------------
CREATE proc usp_pmsreport    
    
(    
@access_code as varchar(20), 
@access_to as varchar(20)  
     
)     
as    
select * from PMS_info with (nolock)

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_PURPOSEMANAGE
-- --------------------------------------------------
CREATE PROC [dbo].[USP_PURPOSEMANAGE]
@PROCESS    AS VARCHAR(50)='',
@MEETINGID AS INT=0,
@PURPOSE AS VARCHAR(20)='',
@REQUIREMENT AS VARCHAR(20)='',
@BMACTION AS VARCHAR(20)='',
@EXPECTEDOUTCOME AS VARCHAR(50)='',
@PARAMETER AS VARCHAR(500)='',
@TARGETDATE AS VARCHAR(50)='',
@BMSTATUS AS INT =0,
@ID AS INT =0  

AS BEGIN
 SET NOCOUNT ON;
 
 IF @PROCESS ='ADD PURPOSE'
 BEGIN 
 

      INSERT INTO TBL_B2BPURPOSETRANSACTION(MEETINGID,PURPOSE,REQUIREMENT,BMACTION,EXPECTEDOUTCOME,PARAMETER,TARGETDATE,BMSTATUS)
      VALUES(@MEETINGID,@PURPOSE,@REQUIREMENT,@BMACTION,@EXPECTEDOUTCOME,@PARAMETER,@TARGETDATE ,0)
     
     SELECT  SCOPE_IDENTITY() AS ID; 
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_RISKDISCLOSURE_GETDATA
-- --------------------------------------------------

  
CREATE PROC [DBO].[USP_RISKDISCLOSURE_GETDATA] 
 
@PROCESS AS VARCHAR(100)='',  
@FILTER1 AS VARCHAR(50)='',  
@FILTER2 AS VARCHAR(50)='',  
@FILTER3 AS VARCHAR(50)='',  
@FILTER4 AS VARCHAR(50)='',  
@FILTER5 AS VARCHAR(50)=''  
  
AS BEGIN   
  
  IF (@PROCESS='VALIDATE CLIENT')  
  BEGIN  
  
  --WAITFOR DELAY '00:00:08';  
  SELECT PARTY_CODE,LONG_NAME FROM [CSOKYC-6].GENERAL.DBO.CLIENT_DETAILS WITH (NOLOCK) WHERE PARTY_CODE=@FILTER1  
  
  END  
  
  
  
  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_sebi_banned
-- --------------------------------------------------

CREATE proc usp_sebi_banned (@panno as varchar(50))
as 
select * from intranet.testdb.dbo.SEBI_BANNED where pan_no = @panno or name like @panno

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_sebi_banned_active_party_code
-- --------------------------------------------------
CREATE procedure [dbo].[usp_sebi_banned_active_party_code]
as      
set nocount on      
  
Set transaction isolation level read uncommitted  


select a.*,status=0,b.branch_Cd,b.sub_BRoker,b.party_code,b.long_name into #File_a1      
from dbo.SEBI_banned a (NOLOCK), AngelNseCM.msajag.dbo.client_Details b      
where ltrim(rtrim(pan_gir_no))=ltrim(rtrim(pan_no))       
and pan_no <> ''      
      
Select pan_no 
into #file 
from dbo.sebi_banned (NOLOCK) 
where pan_no not  in (select pan_no from #File_a1) and pan_no<>''  


  
      
SELECT name,xname=replace(testdb.dbo.ADDSPACE(name),'  ',' ') 
into #filex 
FROM dbo.SEBI_BANNED (NOLOCK)  where pan_no  
not in (select pan_no from #file)     
      
---------------- Perfect Matching       
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name
,status=(case when xname=long_name then 0 else 1 end)       
into #file_1      
from      
(      
SELECT *,      
SFname=substring(xname,1,charindex(' ',xname,1)),      
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')      
FROM #filex      
) a ,      
(      
select branch_cd,sub_BRoker,party_Code,long_name,      
CFname=substring(long_name,1,charindex(' ',long_name,1)),      
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')      
FROM AngelNseCM.msajag.dbo.client_details       
) b      
where  a.sfname=b.cfname and a.slname=b.clname and a.slname <> ''      
and (case when xname=long_name then 0 else 1 end) = 0      
      
---------------- Matching with initial of middlename of SEBI Banned with full name of Party Master      
      
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)       
into #file_2      
from      
(      
select xname,      
SFname=substring(xname,1,charindex(' ',xname,1)),      
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),      
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')      
--substring(xname,charindex(' ',xname)+1,100),charindex(' ',substring(xname,charindex(' ',xname)+1,100)),      
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)),len(xname),      
--case when       
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)) < len(xname) then 1 else 0 end      
FROM #filex      
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0      
) a,      
(      
select       
branch_cd,sub_BRoker,party_Code,long_name,      
CFname=substring(long_name,1,charindex(' ',long_name,1)),      
CMname=ltrim(rtrim(substring(long_name,charindex(' ',long_name),charindex(' ',substring(long_name,charindex(' ',long_name)+1,100))))),      
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')      
FROM AngelNseCM.msajag.dbo.client_details       
) b      
where  a.sfname=b.cfname and a.slname=b.clname       
and a.smname=substring(cmname,1,1) and len(smname)=1 and len(cmname) > 1      
      
      
---------------- Matching with initial of middlename of Party Master with full name of SEBI Banned       
      
select a.xname,branch_Cd,Sub_BRoker,party_Code,b.long_name,status=(case when xname=long_name then 0 else 1 end)       
into #file_3      
from      
(      
select xname,      
SFname=substring(xname,1,charindex(' ',xname,1)),      
SMname=ltrim(rtrim(substring(xname,charindex(' ',xname),charindex(' ',substring(xname,charindex(' ',xname)+1,100))))),      
SLname=replace(rtrim(ltrim(reverse(substring(reverse(xname),1,charindex(' ',reverse(xname),1))))),')','')      
--substring(xname,charindex(' ',xname)+1,100),charindex(' ',substring(xname,charindex(' ',xname)+1,100)),      
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)),len(xname),      
--case when       
--charindex(' ',xname)+charindex(' ',substring(xname,charindex(' ',xname)+1,100)) < len(xname) then 1 else 0 end      
FROM #filex      
where charindex(' ',substring(xname,charindex(' ',xname)+1,100)) > 0      
) a,      
(      
select       
branch_cd,sub_BRoker,party_Code,long_name,      
CFname=substring(long_name,1,charindex(' ',long_name,1)),      
CMname=ltrim(rtrim(substring(long_name,charindex(' ',long_name),charindex(' ',substring(long_name,charindex(' ',long_name)+1,100))))),      
CLname=replace(rtrim(ltrim(reverse(substring(reverse(long_name),1,charindex(' ',reverse(long_name),1))))),')','')      
FROM AngelNseCM.msajag.dbo.client_details       
) b      
where  a.sfname=b.cfname and a.slname=b.clname       
and b.cmname=substring(smname,1,1) and len(cmname)=1 and len(smname) > 1      
      
      
  
select * into #Banned  from      
(      
select * from #File_a1      
union all      
select z.*,y.status,y.branch_Cd,y.sub_BRoker,y.party_code,y.long_name      
from #filex x, dbo.SEBI_banned z (NOLOCK),      
(      
select * from #file_1      
union      
select * from #file_2      
union      
select * from #file_3      
) y where x.xname=y.xname and z.name=x.name      
) a  where party_code not in (select party_code from dbo.Block_sbe (NOLOCK) )    
order by status,party_code   



select a.*,b.cltstatus,b.last_inactive_date from
(select * from #Banned)a
left outer join
(select party_code,case when last_inactive_date >=getdate() then 'active' else 'Inactive'end as cltstatus,last_inactive_date  from  risk.dbo.client_Details)b
 on a.party_code =b.party_code and last_inactive_date >=getdate() where b.cltstatus = 'active'
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_SPSSchedular
-- --------------------------------------------------
-- =============================================
-- Author:		Suraj Patil
-- Create date: 18/09/2015
-- Description:	<used to select, insert, update, delete records in tbl_Schedular_data table>
-- =============================================


CREATE PROCEDURE [dbo].[USP_SPSSchedular]
@Process varchar(20)='',
@manager_code varchar(30)='',
@update_time int = 0,
@update_status int = 0,
@sno int = 0,
@Added_by varchar(50)='',
@Added_on varchar(50)='',
@Modified_by varchar(50)='',
@Modified_on varchar(50)='',
@Approved_by varchar(50)='',
@Approved_on varchar(50)='',
@IsApproved int=0

AS
BEGIN



if(@Process = 'select')
begin
	select * from tbl_Schedular_data where isApproved in (1,0)
end


if(@Process = 'Add')
begin

	declare @cnt as int
	select @cnt =COUNT(1) from tbl_Schedular_data where update_time =@update_time and isApproved in (1,0) and Manager_code=@Manager_code

	if (@cnt=0)
	begin 
		INSERT INTO [tbl_Schedular_data] ([Manager_code],[Update_time],[update_status],[Added_by],[Added_on],[IsApproved])
		VALUES(@manager_code ,@update_time ,@update_status ,@Added_by ,GETDATE(),0)
	end

	select @cnt

end

if(@Process = 'Upadate')
begin

		select @cnt =COUNT(1) from tbl_Schedular_data where update_time =@update_time and isApproved in (1,0) and Manager_code=@manager_code and SNo<>@sno 

		if (@cnt=0)
		begin 

				update tbl_Schedular_data
				set Update_time=@update_time ,
				update_status=@update_status ,
				Manager_code=@manager_code,
				Modified_by=@Modified_by ,
				Modified_on=GETDATE ()
				where SNo=@sno 

		end

		         select @cnt 

		end

if(@Process = 'select_by_sno')
begin
			select * from tbl_Schedular_data where sno = @sno and IsApproved in (1,0)
end

if(@Process ='Delete')
begin
		update tbl_Schedular_data
		set IsApproved=9,
		Modified_by=@Modified_by ,
		Modified_on=GETDATE()
		where SNo=@sno 
end


END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_DTC
-- --------------------------------------------------
CREATE PROCEDURE [dbo].[USP_UPLOAD_DTC]
(@FILENAME AS VARCHAR(25))    
AS    

DECLARE @LOCACODE AS VARCHAR(25)=@FILENAME

DECLARE @SQL AS VARCHAR(MAX)=''

DECLARE @TABLE AS VARCHAR(50)=''

SET @LOCACODE=REPLACE(REPLACE(@FILENAME,'.ZIP',''),'DTC_','CSO')

SET @TABLE='TBL_'+@LOCACODE

EXEC USP_DTC_CSVUNZIP @FILENAME
   
    
SELECT TOP 0 DEALER,PARTY_CODE INTO #FILE1 FROM CTCL_DTCX (NOLOCK)    
/* BULK INSERT #FILE1 FROM '\\196.1.115.183\D$\UPLOAD1\FT\'+@FILENAME WITH ( FIELDTERMINATOR=',',FIRSTROW=1,KEEPNULLS)*/    
DECLARE @STR AS VARCHAR(1000)    

SET @FILENAME=REPLACE(@FILENAME,'.ZIP','.TXT')
    
SET @STR='BULK INSERT #FILE1 FROM ''\\INHOUSELIVEAPP2-FS.angelone.in\D$\UPLOAD1\FT\'+@FILENAME+''' WITH ( FIELDTERMINATOR='','',FIRSTROW=1,KEEPNULLS)'    
EXEC(@STR)    
    
    
UPDATE #FILE1 SET PARTY_CODE=REPLACE(LTRIM(RTRIM(PARTY_CODE)),CHAR(32),'')    
UPDATE #FILE1 SET DEALER=REPLACE(LTRIM(RTRIM(DEALER)),CHAR(32),'')    
DELETE FROM #FILE1 WHERE PARTY_CODE='' OR PARTY_CODE ='------'    
  
   
SET @SQL='TRUNCATE TABLE '+@TABLE
EXEC(@SQL)


 SET  @SQL='INSERT INTO '+@TABLE +'(DEALER,PARTY_CODE,LOCATION,LAST_UPDATED) SELECT *,LOCATION='''+@LOCACODE+''',GETDATE() FROM #FILE1' 
  EXEC(@SQL)  


DROP TABLE #FILE1

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_UPLOAD_MCX_MARGIN
-- --------------------------------------------------
CREATE PROCEDURE USP_UPLOAD_MCX_MARGIN  
@FILE_NAME VARCHAR(20)  
  
AS  
BEGIN  
SELECT * INTO MCX_MARGIN_TEST FROM TEMP_MCX  
END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.USP_VISITINGCARDMANAGE
-- --------------------------------------------------

CREATE PROC [dbo].[USP_VISITINGCARDMANAGE]
@PROCESS    AS VARCHAR(50)='',
@PURPOSEID AS INT=0,
@BMID AS VARCHAR(20)='',
@SBID AS VARCHAR(20)='',
@SRNUM AS VARCHAR(20)='',
@PARTNARNAME AS VARCHAR(200)='',
@PARTNERTAG AS VARCHAR(50)='',
@DESIGNATION AS VARCHAR(50)='',
@DEPARTMENT AS VARCHAR(50)='',
@QTY AS VARCHAR(50)='',
@LINEOFBUSINESS AS VARCHAR(500)='',
@FIRSTNAME AS VARCHAR(100)='',
@BRANCHTAG AS VARCHAR(50)='',
@ADDRESS AS VARCHAR(500)='',
@PINCODE AS VARCHAR(50)='',
@LANDLINENUM AS VARCHAR(50)='',
@EXTNUM AS VARCHAR(50)='',
@FAXNUM AS VARCHAR(50)='',
@MOBILENUM AS VARCHAR(50)='',
@EMAIL AS VARCHAR(50)='',
@REQUESTEDBY AS VARCHAR(50)='',
@APPROVEDBY AS VARCHAR(50)='',
@ID AS INT =0  

AS BEGIN

 
 IF @PROCESS ='ADD'
 BEGIN 
 

      INSERT INTO TBL_B2BVCARD( PURPOSEID, BMID , SBID ,SRNUM, PARTNARNAME,PARTNERTAG , DESIGNATION, DEPARTMENT,QTY , LINEOFBUSINESS ,FIRSTNAME , BRANCHTAG , ADDRESS, PINCODE,LANDLINENUM, EXTNUM, FAXNUM, MOBILENUM,EMAIL, REQUESTEDBY,APPROVEDBY)
      VALUES( @PURPOSEID , @BMID  , @SBID  ,@SRNUM , @PARTNARNAME ,@PARTNERTAG  , @DESIGNATION , @DEPARTMENT ,@QTY  , @LINEOFBUSINESS  ,@FIRSTNAME  , @BRANCHTAG  , @ADDRESS , @PINCODE ,@LANDLINENUM , @EXTNUM , @FAXNUM , @MOBILENUM ,@EMAIL , @REQUESTEDBY ,@APPROVEDBY)
     
     
 END
 

END

GO

-- --------------------------------------------------
-- PROCEDURE dbo.usp_VoucherEntry
-- --------------------------------------------------

CREATE PROC [dbo].[usp_VoucherEntry]        
(        
 @flag VARCHAR(10),        
 @EDate VARCHAR(11),        
 @CltCode VARCHAR(15),        
 @Amount MONEY,        
 @Narration VARCHAR(50),        
 @BankCode VARCHAR(25),        
 @BankName VARCHAR(50),        
 @DDNo VARCHAR(25),        
 @BranchName VARCHAR(50),        
 @CreatedBy VARCHAR(20),        
 @IP VARCHAR(20),        
 @segment VARCHAR(20),        
 @srno BIGINT,    
 @AccountNo varchar(30)        
)        
AS        
-------------------------------------------------------------------------------------------------------------        
-- select * from payin where segment='ABLCM' and cltcode='A12530'posted_status='N' and srno='34479'        
-- select * from payin_arch        
-------------------------------------------------------------------------------------------------------------        
if @BranchName <>''    
begin    
set @BranchName=substring(@BranchName,CHARINDEX('[',@BranchName)+1,(LEN(@BranchName)-CHARINDEX('[',@BranchName))-1)    
end    
IF @flag='INSERT'        
BEGIN        
 INSERT INTO payin(Edate,Vdate,Cltcode,Amount,DRCR,Narration,BankCode,BankName,DDNo,Branchcode,BranchName,        
 chqmode,chqdate,chqname,clmode,entered_on,entered_by,entered_fromIP,posted_status,segment,Accountno)          
 VALUES (CONVERT(DATETIME,@EDate,103),CONVERT(DATETIME,@EDate,103),@CltCode,@Amount,'C',@Narration,        
    @BankCode,@BankName,@DDNo,'ALL',@BranchName,'C',CONVERT(DATETIME,@EDate,103),@BankName,'L',GETDATE(),        
    @CreatedBy,@IP,'N',@segment,@AccountNo)        
END        
--------------------------------------------------------------------------------------------------------------        
ELSE IF @flag='UPDATE'        
BEGIN        
  --Insert into arch table before updation        
  INSERT INTO payin_arch (srnoPayin,Edate,Vdate,Cltcode,Amount,DRCR,Narration,BankCode,BankName,DDNo,Branchcode,BranchName,chqmode,chqdate,  
chqname,clmode,entered_on,entered_by,entered_fromIP,posted_on,posted_status,segment,App_status,accountNo)        
  SELECT srno,Edate,Vdate,Cltcode,Amount,DRCR,Narration,BankCode,BankName,DDNo,Branchcode,BranchName,chqmode,chqdate,  
   chqname,clmode,entered_on,entered_by,entered_fromIP,posted_on,posted_status,segment,App_status,AccountNo   
   FROM payin WHERE srno=@srno AND  Cltcode=@CltCode and segment=@segment      
  /*(Edate<>@EDate OR Vdate<>@EDate OR Cltcode<>@CltCode OR Amount<>@Amount OR Narration<>@Narration OR        
  BankCode<>@BankCode OR DDNo<>@DDNo OR BranchName<>@BranchName OR chqdate<>@EDate OR chqname<>@BankName OR        
     entered_by<>@CreatedBy OR entered_fromIP<>@IP OR segment<>@segment)   */      
        
  --update data          
  UPDATE payin SET Edate=CONVERT(DATETIME,@EDate,103),Vdate=CONVERT(DATETIME,@EDate,103),Cltcode=@CltCode,        
     Amount=@Amount,Narration=@Narration,BankCode=@BankCode,DDNo=@DDNo,BranchName=@BranchName,        
     chqdate=CONVERT(DATETIME,@EDate,103),chqname=@BankName,entered_by=@CreatedBy,entered_fromIP=@IP,        
     segment=@segment,accountno=@AccountNo WHERE srno=@srno AND  Cltcode=@CltCode and segment=@segment        
  /*(Edate<>@EDate OR Vdate<>@EDate OR Cltcode<>@CltCode OR Amount<>@Amount OR Narration<>@Narration OR        
  BankCode<>@BankCode OR DDNo<>@DDNo OR BranchName<>@BranchName OR chqdate<>@EDate OR chqname<>@BankName OR        
     entered_by<>@CreatedBy OR entered_fromIP<>@IP OR segment<>@segment)   */      
END        
--------------------------------------------------------------------------------------------------------------        
ELSE IF @flag='DELETE'        
BEGIN        
 DELETE FROM payin WHERE srno=@srno        
END        
--------------------------------------------------------------------------------------------------------------        
ELSE IF @flag='Approve'        
BEGIN        
 UPDATE Payin SET App_status='A' WHERE srno=@srno        
END        
--------------------------------------------------------------------------------------------------------------        
ELSE IF @flag='Reject'        
BEGIN        
 UPDATE payin SET App_status='R' WHERE srno=@srno        
END        
----------------------------------

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Voucher_payin_validate
-- --------------------------------------------------
CREATE procedure [dbo].[Voucher_payin_validate](              
@segment as varchar(10),              
@bankcode as varchar(10),              
@pcode as varchar(10),              
@access_to as varchar(10),              
@access_Code as varchar(10),              
@chqno as varchar(10))              
as              
              
set nocount on              
              
declare @nor as int,@mess as varchar(50),@bor as int              
set @nor=0              
set @bor=0        
if @access_to='BROKER'              
BEGIN              
 select @nor=count(party_code) from risk.dbo.client_details (nolock)               
 where party_code=@pcode               
END              
              
if @access_to='BRANCH'              
BEGIN              
 select @nor=count(party_code) from risk.dbo.client_details (nolock)               
 where party_code=@pcode and branch_cd=@access_code              
END          
if @access_to='SB'              
BEGIN              
 select @nor=count(party_code) from risk.dbo.client_details (nolock)               
 where party_code=@pcode and sub_broker=@access_code              
END     
if @access_to='SBMAST'              
BEGIN              
 select @nor=count(party_code) from risk.dbo.client_details (nolock)               
 where party_code=@pcode and sub_broker in (select sub_broker from risk.dbo.sb_master where sbmast_cd=@access_code )             
END         
              
if @access_to='BRMAST'              
BEGIN              
 select @nor=count(party_code) from risk.dbo.client_details (nolock)               
 where party_code=@pcode and  branch_cd in ( select branch_cd from risk.dbo.branch_master (nolock) where BrMast_cd=@access_Code)              
END              
              
if @access_to='REGION'              
BEGIN              
 select @nor=count(party_code) from risk.dbo.client_details (nolock)               
 where party_code=@pcode and  branch_cd in ( select code from risk.dbo.region (nolock) where reg_code=@access_Code)              
END              
              
set @mess=''              
if @nor=0               
begin              
 set @mess='Invalid Party Code'              
end              
              
/*Select @bor=count(cltcode) from V_BANKMASTER where segment=@segment and cltcode=@bankcode              
              
if @bor=0               
begin              
 if len(@mess) > 0               
 begin              
  set @mess=@mess+' and '              
 end               
 set @mess=@mess+' Invalid Bank Code.'              
end              
*/            
            
declare @cor as int            
set @cor=0            
select @cor=count(*) from payin (nolock) where cltcode=@pcode and ddno=@chqno             
if @cor=1            
begin            
 set @mess='Chq.No. already exist'            
end            
            
select nor=@nor,mess=@mess,cor=@bor+@cor              
            
set nocount off

GO

-- --------------------------------------------------
-- PROCEDURE dbo.Voucher_payin_validate_update
-- --------------------------------------------------
create procedure [dbo].[Voucher_payin_validate_update](            
@segment as varchar(10),            
@bankcode as varchar(10),            
@pcode as varchar(10),            
@access_to as varchar(10),            
@access_Code as varchar(10),            
@chqno as varchar(10))            
as            
            
set nocount on            
            
declare @nor as int,@mess as varchar(50),@bor as int            
set @nor=0            
set @bor=0      
if @access_to='BROKER'            
BEGIN            
 select @nor=count(party_code) from risk.dbo.client_details (nolock)             
 where party_code=@pcode             
END            
            
if @access_to='BRANCH'            
BEGIN            
 select @nor=count(party_code) from risk.dbo.client_details (nolock)             
 where party_code=@pcode and branch_cd=@access_code            
END        
if @access_to='SB'            
BEGIN            
 select @nor=count(party_code) from risk.dbo.client_details (nolock)             
 where party_code=@pcode and sub_broker=@access_code            
END   
if @access_to='SBMAST'            
BEGIN            
 select @nor=count(party_code) from risk.dbo.client_details (nolock)             
 where party_code=@pcode and sub_broker in (select sub_broker from risk.dbo.sb_master where sbmast_cd=@access_code )           
END       
            
if @access_to='BRMAST'            
BEGIN            
 select @nor=count(party_code) from risk.dbo.client_details (nolock)             
 where party_code=@pcode and  branch_cd in ( select branch_cd from risk.dbo.branch_master (nolock) where BrMast_cd=@access_Code)            
END            
            
if @access_to='REGION'            
BEGIN            
 select @nor=count(party_code) from risk.dbo.client_details (nolock)             
 where party_code=@pcode and  branch_cd in ( select code from risk.dbo.region (nolock) where reg_code=@access_Code)            
END            
            
set @mess=''            
if @nor=0             
begin            
 set @mess='Invalid Party Code'            
end            
            
/*Select @bor=count(cltcode) from V_BANKMASTER where segment=@segment and cltcode=@bankcode            
            
if @bor=0             
begin            
 if len(@mess) > 0             
 begin            
  set @mess=@mess+' and '            
 end             
 set @mess=@mess+' Invalid Bank Code.'            
end            
*/          
          
declare @cor as int          
set @cor=0          
select @cor=count(1) from payin (nolock) where cltcode=@pcode and ddno=@chqno           
if @cor=1          
begin          
 set @mess='Chq.No. already exist'          
end          
          
select nor=@nor,mess=@mess,cor=@bor+@cor            
          
set nocount off  

select * from payin

GO

-- --------------------------------------------------
-- TABLE dbo.abl
-- --------------------------------------------------
CREATE TABLE [dbo].[abl]
(
    [Srno] VARCHAR(255) NULL,
    [CODE] VARCHAR(255) NULL,
    [Debtors] VARCHAR(255) NULL,
    [SB_Tag] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.acbpl
-- --------------------------------------------------
CREATE TABLE [dbo].[acbpl]
(
    [srno] VARCHAR(255) NULL,
    [Code] VARCHAR(255) NULL,
    [SB_Tag] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AGEING_bsecm_FINAL
-- --------------------------------------------------
CREATE TABLE [dbo].[AGEING_bsecm_FINAL]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [closing_balance] MONEY NULL,
    [AGE_BALANCE] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AGEING_MCX_FINAL
-- --------------------------------------------------
CREATE TABLE [dbo].[AGEING_MCX_FINAL]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [closing_balance] MONEY NULL,
    [AGE_BALANCE] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AGEING_NCDEX_FINAL
-- --------------------------------------------------
CREATE TABLE [dbo].[AGEING_NCDEX_FINAL]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [closing_balance] MONEY NULL,
    [AGE_BALANCE] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AGEING_nsecm_FINAL
-- --------------------------------------------------
CREATE TABLE [dbo].[AGEING_nsecm_FINAL]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [closing_balance] MONEY NULL,
    [AGE_BALANCE] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.AGEing_NSEFO_FINAL
-- --------------------------------------------------
CREATE TABLE [dbo].[AGEing_NSEFO_FINAL]
(
    [cltcode] VARCHAR(10) NOT NULL,
    [closing_balance] MONEY NULL,
    [AGE_BALANCE] MONEY NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ahd
-- --------------------------------------------------
CREATE TABLE [dbo].[ahd]
(
    [BbCli] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Angel_Script_Harmony_Poor
-- --------------------------------------------------
CREATE TABLE [dbo].[Angel_Script_Harmony_Poor]
(
    [BSE code] VARCHAR(50) NULL,
    [NSE symbol] VARCHAR(50) NULL,
    [Series] VARCHAR(50) NULL,
    [ISIN No] VARCHAR(50) NULL,
    [Co name] VARCHAR(50) NULL,
    [NBFC Funding] VARCHAR(50) NULL,
    [FO collateral Approved] VARCHAR(50) NULL,
    [Angel scrip category] VARCHAR(50) NULL,
    [Restricted Scrips] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.anjana_tbBooks
-- --------------------------------------------------
CREATE TABLE [dbo].[anjana_tbBooks]
(
    [BookId] BIGINT IDENTITY(1,1) NOT NULL,
    [BookName] VARCHAR(100) NULL,
    [Author] VARCHAR(100) NULL,
    [Publisher] VARCHAR(150) NULL,
    [Price] DECIMAL(10, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.b2b_master
-- --------------------------------------------------
CREATE TABLE [dbo].[b2b_master]
(
    [SBCode] VARCHAR(50) NULL,
    [Region] VARCHAR(50) NULL,
    [BM_CM_Name] VARCHAR(50) NULL,
    [BMEmpCode] VARCHAR(50) NULL,
    [BM_Mobile_No] VARCHAR(50) NULL,
    [BM_Email_ID] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Block_SBE
-- --------------------------------------------------
CREATE TABLE [dbo].[Block_SBE]
(
    [party_code] VARCHAR(12) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bm_master
-- --------------------------------------------------
CREATE TABLE [dbo].[bm_master]
(
    [bm_server] VARCHAR(30) NULL,
    [bm_branchcd] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bolt_alert
-- --------------------------------------------------
CREATE TABLE [dbo].[bolt_alert]
(
    [qty_limit] MONEY NULL,
    [value_limit] MONEY NULL,
    [GBLIMIT] MONEY NULL,
    [GSLIMIT] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bolt_category
-- --------------------------------------------------
CREATE TABLE [dbo].[bolt_category]
(
    [category1] VARCHAR(500) NULL,
    [category2] VARCHAR(500) NULL,
    [category3] VARCHAR(500) NULL,
    [category4] VARCHAR(500) NULL,
    [category5] VARCHAR(500) NULL,
    [category6] VARCHAR(500) NULL,
    [category7] VARCHAR(500) NULL,
    [category8] VARCHAR(500) NULL,
    [category9] VARCHAR(500) NULL,
    [category10] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.BOLT_ID
-- --------------------------------------------------
CREATE TABLE [dbo].[BOLT_ID]
(
    [F1] FLOAT NULL,
    [F2] NVARCHAR(255) NULL,
    [ANGEL BROKING LTD#(CLG#NO#612)] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.boltfile
-- --------------------------------------------------
CREATE TABLE [dbo].[boltfile]
(
    [Trdr] VARCHAR(25) NULL,
    [Alias] VARCHAR(50) NULL,
    [UT] VARCHAR(10) NULL,
    [CD] VARCHAR(10) NULL,
    [CR] VARCHAR(10) NULL,
    [Active] VARCHAR(10) NULL,
    [OL] VARCHAR(10) NULL,
    [BT] VARCHAR(10) NULL,
    [AVM] VARCHAR(10) NULL,
    [SL] VARCHAR(10) NULL,
    [6A7A] VARCHAR(10) NULL,
    [MQ] VARCHAR(10) NULL,
    [CREG] VARCHAR(10) NULL,
    [Auc] VARCHAR(10) NULL,
    [ClRec] VARCHAR(10) NULL,
    [Quote] VARCHAR(10) NULL,
    [BlockDeal] VARCHAR(10) NULL,
    [SetGBL] VARCHAR(10) NULL,
    [SetSBL] VARCHAR(10) NULL,
    [GLBuy] VARCHAR(15) NULL,
    [GLSell] VARCHAR(15) NULL,
    [NetVal] VARCHAR(15) NULL,
    [DefBuy] VARCHAR(15) NULL,
    [DefSell] VARCHAR(15) NULL,
    [MaxQty] INT NULL,
    [MaxVal] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.boltfile_info
-- --------------------------------------------------
CREATE TABLE [dbo].[boltfile_info]
(
    [nor] INT NULL,
    [tdate] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.boltfile_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[boltfile_temp]
(
    [Trdr] VARCHAR(25) NULL,
    [Alias] VARCHAR(50) NULL,
    [UT] VARCHAR(10) NULL,
    [CD] VARCHAR(10) NULL,
    [CR] VARCHAR(10) NULL,
    [Active] VARCHAR(10) NULL,
    [OL] VARCHAR(10) NULL,
    [BT] VARCHAR(10) NULL,
    [AVM] VARCHAR(10) NULL,
    [SL] VARCHAR(10) NULL,
    [6A7A] VARCHAR(10) NULL,
    [MQ] VARCHAR(10) NULL,
    [CREG] VARCHAR(10) NULL,
    [Auc] VARCHAR(10) NULL,
    [ClRec] VARCHAR(10) NULL,
    [Quote] VARCHAR(10) NULL,
    [BlockDeal] VARCHAR(10) NULL,
    [SetGBL] VARCHAR(10) NULL,
    [SetSBL] VARCHAR(10) NULL,
    [GLBuy] VARCHAR(15) NULL,
    [GLSell] VARCHAR(15) NULL,
    [NetVal] VARCHAR(15) NULL,
    [DefBuy] VARCHAR(15) NULL,
    [DefSell] VARCHAR(15) NULL,
    [MaxQty] VARCHAR(15) NULL,
    [MaxVal] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Branch
-- --------------------------------------------------
CREATE TABLE [dbo].[Branch]
(
    [ctclBranch_id] VARCHAR(255) NULL,
    [ctclBranch_BranchCode] VARCHAR(255) NULL,
    [ctclBranch_Segment] VARCHAR(255) NULL,
    [ctclBranch_address1] VARCHAR(255) NULL,
    [ctclBranch_address2] VARCHAR(255) NULL,
    [ctclBranch_address3] VARCHAR(255) NULL,
    [ctclBranch_city] VARCHAR(255) NULL,
    [ctclBranch_pincode] VARCHAR(255) NULL,
    [ctclBranch_state] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.bse_table
-- --------------------------------------------------
CREATE TABLE [dbo].[bse_table]
(
    [type] VARCHAR(50) NULL,
    [table_no] VARCHAR(50) NULL,
    [Lower_Lim] VARCHAR(50) NULL,
    [Upper_Lim] VARCHAR(50) NULL,
    [Minimum] VARCHAR(50) NULL,
    [val_perc] CHAR(10) NULL,
    [trd_type] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.chq_entry
-- --------------------------------------------------
CREATE TABLE [dbo].[chq_entry]
(
    [AppNo] NUMERIC(18, 0) IDENTITY(1,1) NOT NULL,
    [Branch_Cd] VARCHAR(15) NOT NULL,
    [Exchange] VARCHAR(10) NOT NULL,
    [BankName] VARCHAR(60) NULL,
    [New_Bank] VARCHAR(1) NULL,
    [New_BankName] VARCHAR(60) NULL,
    [Client_Code] VARCHAR(15) NOT NULL,
    [Client_Name] VARCHAR(60) NOT NULL,
    [Mode] VARCHAR(15) NOT NULL,
    [Mode_No] VARCHAR(15) NOT NULL,
    [MICR] VARCHAR(33) NULL,
    [Account_No] VARCHAR(33) NULL,
    [Amount] VARCHAR(15) NOT NULL,
    [Scan1] IMAGE NOT NULL,
    [Scan2] IMAGE NULL,
    [Status] VARCHAR(15) NOT NULL,
    [Remarks] VARCHAR(150) NULL,
    [Narrations] VARCHAR(60) NULL,
    [mkrdt] VARCHAR(8) NULL,
    [mkrid] VARCHAR(15) NULL,
    [Client_Bank] VARCHAR(60) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cl_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[cl_BSE]
(
    [Type] NVARCHAR(255) NULL,
    [Table_No] INT NULL,
    [Lower Lim] FLOAT NULL,
    [Upper Lim] FLOAT NULL,
    [Minimum] FLOAT NULL,
    [Val/Perc] NVARCHAR(255) NULL,
    [Trd#Type] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cl_bse1
-- --------------------------------------------------
CREATE TABLE [dbo].[cl_bse1]
(
    [cl_code] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cl_nse
-- --------------------------------------------------
CREATE TABLE [dbo].[cl_nse]
(
    [cl_code] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_master
-- --------------------------------------------------
CREATE TABLE [dbo].[client_master]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Client_Code] CHAR(25) NOT NULL,
    [Short_Name] VARCHAR(150) NULL,
    [Long_Name] VARCHAR(250) NULL,
    [Branch_Code] CHAR(25) NULL,
    [Subbroker_Code] CHAR(25) NULL,
    [Primary_Product] CHAR(25) NULL,
    [Manager_Code] CHAR(25) NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL,
    [Account_Status] BIT NULL,
    [PAN_Number] CHAR(30) NULL,
    [UserCreationDateTime] NVARCHAR(50) NULL,
    [Email] VARCHAR(250) NULL,
    [Contact_Number] CHAR(30) NULL,
    [BBB] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_master_integrated_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[client_master_integrated_RENAMEDAS_PII]
(
    [ID] INT NOT NULL,
    [Client_Code] CHAR(25) NOT NULL,
    [Short_Name] VARCHAR(150) NULL,
    [Long_Name] VARCHAR(250) NULL,
    [Branch_Code] CHAR(25) NULL,
    [Subbroker_Code] CHAR(25) NULL,
    [Primary_Product] CHAR(25) NULL,
    [Manager_Code] CHAR(25) NULL,
    [BSE] BIT NULL,
    [NSE] BIT NULL,
    [NSEFO] BIT NULL,
    [MCX] BIT NULL,
    [NCDEX] BIT NULL,
    [Account_Status] BIT NULL,
    [PAN_Number] CHAR(30) NULL,
    [UserCreationDateTime] NVARCHAR(50) NULL,
    [Email] VARCHAR(250) NULL,
    [Contact_Number] CHAR(30) NULL,
    [BBB] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_master_Prosupport
-- --------------------------------------------------
CREATE TABLE [dbo].[client_master_Prosupport]
(
    [ID] INT NOT NULL,
    [Client_Code] CHAR(25) NOT NULL,
    [Short_Name] VARCHAR(150) NULL,
    [Long_Name] VARCHAR(250) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_performance
-- --------------------------------------------------
CREATE TABLE [dbo].[client_performance]
(
    [Tdate] DATETIME NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [bse_sdt] DATETIME NULL,
    [nse_sdt] DATETIME NULL,
    [fo_sdt] DATETIME NULL,
    [ncdx_sdt] DATETIME NULL,
    [mcdx_sdt] DATETIME NULL,
    [party_Code] VARCHAR(10) NULL,
    [bse_to] MONEY NULL,
    [bse_br] MONEY NULL,
    [nse_to] MONEY NULL,
    [nse_br] MONEY NULL,
    [fo_to] MONEY NULL,
    [fo_br] MONEY NULL,
    [ncdx_to] MONEY NULL,
    [ncdx_br] MONEY NULL,
    [mcdx_to] MONEY NULL,
    [mcdx_br] MONEY NULL,
    [ldt] DATETIME NULL,
    [sdt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_performance_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[client_performance_hist]
(
    [Tdate] DATETIME NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [party_Code] VARCHAR(10) NULL,
    [bse_to] MONEY NULL,
    [bse_br] MONEY NULL,
    [nse_to] MONEY NULL,
    [nse_br] MONEY NULL,
    [fo_to] MONEY NULL,
    [fo_br] MONEY NULL,
    [ncdx_to] INT NULL,
    [ncdx_br] MONEY NULL,
    [mcdx_to] MONEY NULL,
    [mcdx_br] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_performance_hist_sum
-- --------------------------------------------------
CREATE TABLE [dbo].[client_performance_hist_sum]
(
    [Tdate] DATETIME NULL,
    [cltcode] VARCHAR(10) NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [bse_sdt] DATETIME NULL,
    [nse_sdt] DATETIME NULL,
    [fo_sdt] DATETIME NULL,
    [ncdx_sdt] DATETIME NULL,
    [mcdx_sdt] DATETIME NULL,
    [party_Code] VARCHAR(10) NULL,
    [bse_to] MONEY NULL,
    [bse_br] MONEY NULL,
    [nse_to] MONEY NULL,
    [nse_br] MONEY NULL,
    [fo_to] MONEY NULL,
    [fo_br] MONEY NULL,
    [ncdx_to] MONEY NULL,
    [ncdx_br] MONEY NULL,
    [mcdx_to] MONEY NULL,
    [mcdx_br] MONEY NULL,
    [ldt] DATETIME NULL,
    [sdt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_performance_hist1
-- --------------------------------------------------
CREATE TABLE [dbo].[client_performance_hist1]
(
    [Tdate] DATETIME NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [bse_sdt] DATETIME NULL,
    [nse_sdt] DATETIME NULL,
    [fo_sdt] DATETIME NULL,
    [ncdx_sdt] DATETIME NULL,
    [mcdx_sdt] DATETIME NULL,
    [party_Code] VARCHAR(10) NULL,
    [bse_to] MONEY NULL,
    [bse_br] MONEY NULL,
    [nse_to] MONEY NULL,
    [nse_br] MONEY NULL,
    [fo_to] MONEY NULL,
    [fo_br] MONEY NULL,
    [ncdx_to] MONEY NULL,
    [ncdx_br] MONEY NULL,
    [mcdx_to] MONEY NULL,
    [mcdx_br] MONEY NULL,
    [ldt] DATETIME NULL,
    [sdt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CLIENT_PERFORMANCE_sUMMARY
-- --------------------------------------------------
CREATE TABLE [dbo].[CLIENT_PERFORMANCE_sUMMARY]
(
    [tdate] DATETIME NOT NULL,
    [PartyCode] VARCHAR(10) NULL,
    [PartyName] VARCHAR(100) NULL,
    [Branch] VARCHAR(10) NULL,
    [Subgroup] VARCHAR(10) NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [bse_sdt] DATETIME NULL,
    [nse_sdt] DATETIME NULL,
    [fo_sdt] DATETIME NULL,
    [ncdx_sdt] DATETIME NULL,
    [mcdx_sdt] DATETIME NULL,
    [Active_day] INT NULL,
    [revenue] MONEY NULL,
    [Average] MONEY NULL,
    [inactive_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_performance_summary1
-- --------------------------------------------------
CREATE TABLE [dbo].[client_performance_summary1]
(
    [tdate] DATETIME NULL,
    [PartyCode] VARCHAR(10) NULL,
    [PartyName] VARCHAR(100) NULL,
    [Branch] VARCHAR(10) NULL,
    [Subgroup] VARCHAR(10) NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [bse_sdt] DATETIME NULL,
    [nse_sdt] DATETIME NULL,
    [fo_sdt] DATETIME NULL,
    [ncdx_sdt] DATETIME NULL,
    [mcdx_sdt] DATETIME NULL,
    [Active_days_nse_cm] INT NULL,
    [Active_days_nse_fo] INT NULL,
    [Active_days_bse_cm] INT NULL,
    [Active_days_mcdx] INT NULL,
    [Active_days_ncdx] INT NULL,
    [traded_days_nse] INT NULL,
    [traded_days_fo] INT NULL,
    [traded_days_bse] INT NULL,
    [traded_days_mcdx] INT NULL,
    [traded_days_ncdx] INT NULL,
    [revenue_bse] MONEY NULL,
    [revenue_nse] MONEY NULL,
    [revenue_fo] MONEY NULL,
    [revenue_ncdx] MONEY NULL,
    [revenue_mcdx] MONEY NULL,
    [Average_bse] MONEY NULL,
    [Average_nse] MONEY NULL,
    [Average_fo] MONEY NULL,
    [Average_ncdx] MONEY NULL,
    [Average_mcdx] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.client_performance1
-- --------------------------------------------------
CREATE TABLE [dbo].[client_performance1]
(
    [Tdate] DATETIME NOT NULL,
    [cltcode] VARCHAR(10) NOT NULL,
    [bse_ldt] DATETIME NULL,
    [nse_ldt] DATETIME NULL,
    [fo_ldt] DATETIME NULL,
    [ncdx_ldt] DATETIME NULL,
    [mcdx_ldt] DATETIME NULL,
    [bse_sdt] DATETIME NULL,
    [nse_sdt] DATETIME NULL,
    [fo_sdt] DATETIME NULL,
    [ncdx_sdt] DATETIME NULL,
    [mcdx_sdt] DATETIME NULL,
    [party_Code] VARCHAR(10) NULL,
    [bse_to] MONEY NULL,
    [bse_br] MONEY NULL,
    [nse_to] MONEY NULL,
    [nse_br] MONEY NULL,
    [fo_to] MONEY NULL,
    [fo_br] MONEY NULL,
    [ncdx_to] MONEY NULL,
    [ncdx_br] MONEY NULL,
    [mcdx_to] MONEY NULL,
    [mcdx_br] MONEY NULL,
    [ldt] DATETIME NULL,
    [sdt] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ClientBannedFormat123
-- --------------------------------------------------
CREATE TABLE [dbo].[ClientBannedFormat123]
(
    [Name] VARCHAR(2000) NULL,
    [Address] VARCHAR(2000) NULL,
    [Pan_no] VARCHAR(2000) NULL,
    [Dt_SEBI_Order] VARCHAR(2000) NULL,
    [Order_NO] VARCHAR(2000) NULL,
    [Brief_particulars] VARCHAR(2000) NULL,
    [Start_Date] VARCHAR(2000) NULL,
    [period] VARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.clients_product
-- --------------------------------------------------
CREATE TABLE [dbo].[clients_product]
(
    [Client_Code] CHAR(25) NOT NULL,
    [Product_Code] CHAR(25) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'Contactinfo'
-- --------------------------------------------------
CREATE TABLE [dbo].['Contactinfo']
(
    [S#No#] FLOAT NULL,
    [Tag Generation Date] NVARCHAR(255) NULL,
    [Active or Inactive] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Constitution] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Phone No#] NVARCHAR(255) NULL,
    [Fax No#] NVARCHAR(255) NULL,
    [Mobile No# (if any)] FLOAT NULL,
    [State] NVARCHAR(255) NULL,
    [Email address] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [F14] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Contactinfo_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[Contactinfo_RENAMEDAS_PII]
(
    [S#No#] FLOAT NULL,
    [Tag Generation Date] NVARCHAR(255) NULL,
    [Active or Inactive] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [Name] NVARCHAR(255) NULL,
    [Constitution] NVARCHAR(255) NULL,
    [Branch] NVARCHAR(255) NULL,
    [Phone No#] NVARCHAR(255) NULL,
    [Fax No#] NVARCHAR(255) NULL,
    [Mobile No# (if any)] FLOAT NULL,
    [State] NVARCHAR(255) NULL,
    [Email address] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [F14] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.cslogin
-- --------------------------------------------------
CREATE TABLE [dbo].[cslogin]
(
    [login] VARCHAR(40) NULL,
    [passwd] VARCHAR(40) NULL,
    [category] VARCHAR(40) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CSO15_ctclDtc
-- --------------------------------------------------
CREATE TABLE [dbo].[CSO15_ctclDtc]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(10) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_]
(
    [Ctcl_Id] VARCHAR(255) NULL,
    [Ctcl_CtclBranchId] VARCHAR(255) NULL,
    [Ctcl_BranchId] VARCHAR(255) NULL,
    [Ctcl_OdinID] VARCHAR(255) NULL,
    [Ctcl_OffNature] VARCHAR(255) NULL,
    [Ctcl_PanNo] VARCHAR(255) NULL,
    [Ctcl_Lineid] VARCHAR(255) NULL,
    [Ctcl_LineMode] VARCHAR(255) NULL,
    [Ctcl_ApprovedPerson] VARCHAR(255) NULL,
    [Ctcl_FatherName] VARCHAR(255) NULL,
    [Ctcl_DOB] VARCHAR(255) NULL,
    [Ctcl_ContactPerson] VARCHAR(255) NULL,
    [Ctcl_Designation] VARCHAR(255) NULL,
    [Ctcl_Phoneno] VARCHAR(255) NULL,
    [Ctcl_Fax] VARCHAR(255) NULL,
    [Ctcl_Mailid] VARCHAR(255) NULL,
    [Ctcl_SEBINO] VARCHAR(255) NULL,
    [Ctcl_SubBrokerName] VARCHAR(255) NULL,
    [Ctcl_AuthPerson] VARCHAR(255) NULL,
    [Ctcl_MapinNo] VARCHAR(255) NULL,
    [Ctcl_Address1] VARCHAR(255) NULL,
    [Ctcl_Address2] VARCHAR(255) NULL,
    [Ctcl_Address3] VARCHAR(255) NULL,
    [Ctcl_ResAddress1] VARCHAR(255) NULL,
    [Ctcl_ResAddress2] VARCHAR(255) NULL,
    [Ctcl_ResAddress3] VARCHAR(255) NULL,
    [Ctcl_ResAddress4] VARCHAR(255) NULL,
    [Ctcl_ResAddress5] VARCHAR(255) NULL,
    [Ctcl_PerAddress1] VARCHAR(255) NULL,
    [Ctcl_PerAddress2] VARCHAR(255) NULL,
    [Ctcl_PerAddress3] VARCHAR(255) NULL,
    [Ctcl_PerAddress4] VARCHAR(255) NULL,
    [Ctcl_PerAddress5] VARCHAR(255) NULL,
    [Ctcl_Relation] VARCHAR(255) NULL,
    [Ctcl_TerminalID] VARCHAR(255) NULL,
    [Ctcl_AllotDate] VARCHAR(255) NULL,
    [Ctcl_DisablingDate] VARCHAR(255) NULL,
    [Ctcl_PayNature] VARCHAR(255) NULL,
    [Ctcl_Regno] VARCHAR(255) NULL,
    [Ctcl_RegValidDate] VARCHAR(255) NULL,
    [Ctcl_Purpose] VARCHAR(255) NULL,
    [Ctcl_Status] VARCHAR(255) NULL,
    [Ctcl_ChangedId] VARCHAR(255) NULL,
    [Ctcl_MFileId] VARCHAR(255) NULL,
    [Ctcl_TFileId] VARCHAR(255) NULL,
    [Ctcl_MemAccept] VARCHAR(255) NULL,
    [Ctcl_TermAccept] VARCHAR(255) NULL,
    [Ctcl_NcfmRemarks] VARCHAR(255) NULL,
    [Created_By] VARCHAR(255) NULL,
    [Created_Date] VARCHAR(255) NULL,
    [Modified_By] VARCHAR(255) NULL,
    [Modified_Date] VARCHAR(255) NULL,
    [Ctcl_IBranch_type] VARCHAR(255) NULL,
    [Ctcl_IAdd1] VARCHAR(255) NULL,
    [Ctcl_IAdd2] VARCHAR(255) NULL,
    [Ctcl_IAdd3] VARCHAR(255) NULL,
    [Ctcl_IPin] VARCHAR(255) NULL,
    [Ctcl_ICity] VARCHAR(255) NULL,
    [Ctcl_IState] VARCHAR(255) NULL,
    [Ctcl_ISBType] VARCHAR(255) NULL,
    [Ctcl_ISBName] VARCHAR(255) NULL,
    [Ctcl_ISBRegNo] VARCHAR(255) NULL,
    [Ctcl_ISBRegdt] VARCHAR(255) NULL,
    [Ctcl_IAUType] VARCHAR(255) NULL,
    [Ctcl_IAUName] VARCHAR(255) NULL,
    [Ctcl_IAUdt] VARCHAR(255) NULL,
    [Ctcl_IRelation] VARCHAR(255) NULL,
    [Ctcl_ISBTag] VARCHAR(255) NULL,
    [Ctcl_Iverified] VARCHAR(255) NULL,
    [Ctcl_Approval_Status] VARCHAR(255) NULL,
    [Ctcl_SBRegister] VARCHAR(255) NULL,
    [Ctcl_APRegister] VARCHAR(255) NULL,
    [CTCL_Disablereason] VARCHAR(255) NULL,
    [CTCL_Angelpremises] VARCHAR(255) NULL,
    [CTCL_IBranch_cd] VARCHAR(255) NULL,
    [CTCL_AngEmpCode] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_bolt1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_bolt1]
(
    [Branch] VARCHAR(100) NULL,
    [NSECM] VARCHAR(100) NULL,
    [NSEFO] VARCHAR(100) NULL,
    [MCX] VARCHAR(100) NULL,
    [NCDEX] VARCHAR(100) NULL,
    [BSE] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_boltno
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_boltno]
(
    [Branch] VARCHAR(200) NULL,
    [NSECM] VARCHAR(200) NULL,
    [NSEFO] VARCHAR(200) NULL,
    [MCX] VARCHAR(200) NULL,
    [NCDEX] VARCHAR(200) NULL,
    [BSECM] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_DTC
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_DTC]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_DTC_Hist
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_DTC_Hist]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_DTCx
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_DTCx]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCL_INFO
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCL_INFO]
(
    [SrNo] INT NULL,
    [SiteCode] VARCHAR(255) NULL,
    [Relations] VARCHAR(255) NULL,
    [Site] VARCHAR(255) NULL,
    [Address] VARCHAR(500) NULL,
    [PhNo] VARCHAR(255) NULL,
    [ContactPerson] VARCHAR(255) NULL,
    [IPaddress] VARCHAR(255) NULL,
    [F9] VARCHAR(255) NULL,
    [F10] VARCHAR(255) NULL,
    [LoginID] VARCHAR(255) NULL,
    [F12] VARCHAR(255) NULL,
    [F13] VARCHAR(255) NULL,
    [F14] VARCHAR(255) NULL,
    [F15] VARCHAR(255) NULL,
    [F16] NVARCHAR(255) NULL,
    [F17] NVARCHAR(255) NULL,
    [F18] NVARCHAR(255) NULL,
    [F19] NVARCHAR(255) NULL,
    [F20] NVARCHAR(255) NULL,
    [F21] NVARCHAR(255) NULL,
    [F22] NVARCHAR(255) NULL,
    [F23] NVARCHAR(255) NULL,
    [F24] NVARCHAR(255) NULL,
    [F25] NVARCHAR(255) NULL,
    [F26] NVARCHAR(255) NULL,
    [F27] NVARCHAR(255) NULL,
    [F28] NVARCHAR(255) NULL,
    [F29] NVARCHAR(255) NULL,
    [F30] NVARCHAR(255) NULL,
    [F31] NVARCHAR(255) NULL,
    [F32] NVARCHAR(255) NULL,
    [F33] NVARCHAR(255) NULL,
    [F34] NVARCHAR(255) NULL,
    [F35] NVARCHAR(255) NULL,
    [F36] NVARCHAR(255) NULL,
    [F37] NVARCHAR(255) NULL,
    [F38] NVARCHAR(255) NULL,
    [F39] NVARCHAR(255) NULL,
    [F40] NVARCHAR(255) NULL,
    [F41] NVARCHAR(255) NULL,
    [F42] NVARCHAR(255) NULL,
    [F43] NVARCHAR(255) NULL,
    [F44] NVARCHAR(255) NULL,
    [F45] NVARCHAR(255) NULL,
    [F46] NVARCHAR(255) NULL,
    [F47] NVARCHAR(255) NULL,
    [F48] NVARCHAR(255) NULL,
    [F49] NVARCHAR(255) NULL,
    [F50] NVARCHAR(255) NULL,
    [F51] NVARCHAR(255) NULL,
    [F52] NVARCHAR(255) NULL,
    [F53] NVARCHAR(255) NULL,
    [F54] NVARCHAR(255) NULL,
    [F55] NVARCHAR(255) NULL,
    [F56] NVARCHAR(255) NULL,
    [F57] NVARCHAR(255) NULL,
    [F58] NVARCHAR(255) NULL,
    [F59] NVARCHAR(255) NULL,
    [F60] NVARCHAR(255) NULL,
    [F61] NVARCHAR(255) NULL,
    [F62] NVARCHAR(255) NULL,
    [F63] NVARCHAR(255) NULL,
    [F64] NVARCHAR(255) NULL,
    [F65] NVARCHAR(255) NULL,
    [F66] NVARCHAR(255) NULL,
    [F67] NVARCHAR(255) NULL,
    [F68] NVARCHAR(255) NULL,
    [F69] NVARCHAR(255) NULL,
    [F70] NVARCHAR(255) NULL,
    [F71] NVARCHAR(255) NULL,
    [F72] NVARCHAR(255) NULL,
    [F73] NVARCHAR(255) NULL,
    [F74] NVARCHAR(255) NULL,
    [F75] NVARCHAR(255) NULL,
    [F76] NVARCHAR(255) NULL,
    [F77] NVARCHAR(255) NULL,
    [F78] NVARCHAR(255) NULL,
    [F79] NVARCHAR(255) NULL,
    [F80] NVARCHAR(255) NULL,
    [F81] NVARCHAR(255) NULL,
    [F82] NVARCHAR(255) NULL,
    [F83] NVARCHAR(255) NULL,
    [F84] NVARCHAR(255) NULL,
    [F85] NVARCHAR(255) NULL,
    [F86] NVARCHAR(255) NULL,
    [F87] NVARCHAR(255) NULL,
    [F88] NVARCHAR(255) NULL,
    [F89] NVARCHAR(255) NULL,
    [F90] NVARCHAR(255) NULL,
    [F91] NVARCHAR(255) NULL,
    [F92] NVARCHAR(255) NULL,
    [F93] NVARCHAR(255) NULL,
    [F94] NVARCHAR(255) NULL,
    [F95] NVARCHAR(255) NULL,
    [F96] NVARCHAR(255) NULL,
    [F97] NVARCHAR(255) NULL,
    [F98] NVARCHAR(255) NULL,
    [F99] NVARCHAR(255) NULL,
    [F100] NVARCHAR(255) NULL,
    [F101] NVARCHAR(255) NULL,
    [F102] NVARCHAR(255) NULL,
    [F103] NVARCHAR(255) NULL,
    [F104] NVARCHAR(255) NULL,
    [F105] NVARCHAR(255) NULL,
    [F106] NVARCHAR(255) NULL,
    [F107] NVARCHAR(255) NULL,
    [F108] NVARCHAR(255) NULL,
    [F109] NVARCHAR(255) NULL,
    [F110] NVARCHAR(255) NULL,
    [F111] NVARCHAR(255) NULL,
    [F112] NVARCHAR(255) NULL,
    [F113] NVARCHAR(255) NULL,
    [F114] NVARCHAR(255) NULL,
    [F115] NVARCHAR(255) NULL,
    [F116] NVARCHAR(255) NULL,
    [F117] NVARCHAR(255) NULL,
    [F118] NVARCHAR(255) NULL,
    [F119] NVARCHAR(255) NULL,
    [F120] NVARCHAR(255) NULL,
    [F121] NVARCHAR(255) NULL,
    [F122] NVARCHAR(255) NULL,
    [F123] NVARCHAR(255) NULL,
    [F124] NVARCHAR(255) NULL,
    [F125] NVARCHAR(255) NULL,
    [F126] NVARCHAR(255) NULL,
    [F127] NVARCHAR(255) NULL,
    [F128] NVARCHAR(255) NULL,
    [F129] NVARCHAR(255) NULL,
    [F130] NVARCHAR(255) NULL,
    [F131] NVARCHAR(255) NULL,
    [F132] NVARCHAR(255) NULL,
    [F133] NVARCHAR(255) NULL,
    [F134] NVARCHAR(255) NULL,
    [F135] NVARCHAR(255) NULL,
    [F136] NVARCHAR(255) NULL,
    [F137] NVARCHAR(255) NULL,
    [F138] NVARCHAR(255) NULL,
    [F139] NVARCHAR(255) NULL,
    [F140] NVARCHAR(255) NULL,
    [F141] NVARCHAR(255) NULL,
    [F142] NVARCHAR(255) NULL,
    [F143] NVARCHAR(255) NULL,
    [F144] NVARCHAR(255) NULL,
    [F145] NVARCHAR(255) NULL,
    [F146] NVARCHAR(255) NULL,
    [F147] NVARCHAR(255) NULL,
    [F148] NVARCHAR(255) NULL,
    [F149] NVARCHAR(255) NULL,
    [F150] NVARCHAR(255) NULL,
    [F151] NVARCHAR(255) NULL,
    [F152] NVARCHAR(255) NULL,
    [F153] NVARCHAR(255) NULL,
    [F154] NVARCHAR(255) NULL,
    [F155] NVARCHAR(255) NULL,
    [F156] NVARCHAR(255) NULL,
    [F157] NVARCHAR(255) NULL,
    [F158] NVARCHAR(255) NULL,
    [F159] NVARCHAR(255) NULL,
    [F160] NVARCHAR(255) NULL,
    [F161] NVARCHAR(255) NULL,
    [F162] NVARCHAR(255) NULL,
    [F163] NVARCHAR(255) NULL,
    [F164] NVARCHAR(255) NULL,
    [F165] NVARCHAR(255) NULL,
    [F166] NVARCHAR(255) NULL,
    [F167] NVARCHAR(255) NULL,
    [F168] NVARCHAR(255) NULL,
    [F169] NVARCHAR(255) NULL,
    [F170] NVARCHAR(255) NULL,
    [F171] NVARCHAR(255) NULL,
    [F172] NVARCHAR(255) NULL,
    [F173] NVARCHAR(255) NULL,
    [F174] NVARCHAR(255) NULL,
    [F175] NVARCHAR(255) NULL,
    [F176] NVARCHAR(255) NULL,
    [F177] NVARCHAR(255) NULL,
    [F178] NVARCHAR(255) NULL,
    [F179] NVARCHAR(255) NULL,
    [F180] NVARCHAR(255) NULL,
    [F181] NVARCHAR(255) NULL,
    [F182] NVARCHAR(255) NULL,
    [F183] NVARCHAR(255) NULL,
    [F184] NVARCHAR(255) NULL,
    [F185] NVARCHAR(255) NULL,
    [F186] NVARCHAR(255) NULL,
    [F187] NVARCHAR(255) NULL,
    [F188] NVARCHAR(255) NULL,
    [F189] NVARCHAR(255) NULL,
    [F190] NVARCHAR(255) NULL,
    [F191] NVARCHAR(255) NULL,
    [F192] NVARCHAR(255) NULL,
    [F193] NVARCHAR(255) NULL,
    [F194] NVARCHAR(255) NULL,
    [F195] NVARCHAR(255) NULL,
    [F196] NVARCHAR(255) NULL,
    [F197] NVARCHAR(255) NULL,
    [F198] NVARCHAR(255) NULL,
    [F199] NVARCHAR(255) NULL,
    [F200] NVARCHAR(255) NULL,
    [F201] NVARCHAR(255) NULL,
    [F202] NVARCHAR(255) NULL,
    [F203] NVARCHAR(255) NULL,
    [F204] NVARCHAR(255) NULL,
    [F205] NVARCHAR(255) NULL,
    [F206] NVARCHAR(255) NULL,
    [F207] NVARCHAR(255) NULL,
    [F208] NVARCHAR(255) NULL,
    [F209] NVARCHAR(255) NULL,
    [F210] NVARCHAR(255) NULL,
    [F211] NVARCHAR(255) NULL,
    [F212] NVARCHAR(255) NULL,
    [F213] NVARCHAR(255) NULL,
    [F214] NVARCHAR(255) NULL,
    [F215] NVARCHAR(255) NULL,
    [F216] NVARCHAR(255) NULL,
    [F217] NVARCHAR(255) NULL,
    [F218] NVARCHAR(255) NULL,
    [F219] NVARCHAR(255) NULL,
    [F220] NVARCHAR(255) NULL,
    [F221] NVARCHAR(255) NULL,
    [F222] NVARCHAR(255) NULL,
    [F223] NVARCHAR(255) NULL,
    [F224] NVARCHAR(255) NULL,
    [F225] NVARCHAR(255) NULL,
    [F226] NVARCHAR(255) NULL,
    [F227] NVARCHAR(255) NULL,
    [F228] NVARCHAR(255) NULL,
    [F229] NVARCHAR(255) NULL,
    [F230] NVARCHAR(255) NULL,
    [F231] NVARCHAR(255) NULL,
    [F232] NVARCHAR(255) NULL,
    [F233] NVARCHAR(255) NULL,
    [F234] NVARCHAR(255) NULL,
    [F235] NVARCHAR(255) NULL,
    [F236] NVARCHAR(255) NULL,
    [F237] NVARCHAR(255) NULL,
    [F238] NVARCHAR(255) NULL,
    [F239] NVARCHAR(255) NULL,
    [F240] NVARCHAR(255) NULL,
    [F241] NVARCHAR(255) NULL,
    [F242] NVARCHAR(255) NULL,
    [F243] NVARCHAR(255) NULL,
    [F244] NVARCHAR(255) NULL,
    [F245] NVARCHAR(255) NULL,
    [F246] NVARCHAR(255) NULL,
    [F247] NVARCHAR(255) NULL,
    [F248] NVARCHAR(255) NULL,
    [F249] NVARCHAR(255) NULL,
    [F250] NVARCHAR(255) NULL,
    [F251] NVARCHAR(255) NULL,
    [F252] NVARCHAR(255) NULL,
    [F253] NVARCHAR(255) NULL,
    [F254] NVARCHAR(255) NULL,
    [F255] NVARCHAR(255) NULL,
    [F256] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_Loc_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_Loc_hist]
(
    [sauda_DAte] DATETIME NULL,
    [SHORT_NAME] VARCHAR(21) NOT NULL,
    [segment] VARCHAR(5) NOT NULL,
    [party_Code] VARCHAR(50) NULL,
    [scrip_Cd] VARCHAR(50) NULL,
    [scrip_name] VARCHAR(50) NULL,
    [bs] VARCHAR(50) NULL,
    [mktrate] VARCHAR(50) NULL,
    [tradeqty] VARCHAR(50) NULL,
    [trade_Date] VARCHAR(50) NULL,
    [tradetime] VARCHAR(50) NULL,
    [location] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_loc_summ
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_loc_summ]
(
    [sauda_Date] DATETIME NULL,
    [segment] VARCHAR(5) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [sbtag] VARCHAR(10) NULL,
    [subgroup] VARCHAR(10) NULL,
    [sbname] VARCHAR(250) NULL,
    [turnover] MONEY NULL,
    [Location] VARCHAR(200) NULL,
    [SHORT_NAME] VARCHAR(250) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_loc_summ_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_loc_summ_hist]
(
    [sauda_Date] DATETIME NULL,
    [segment] VARCHAR(5) NOT NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [sbtag] VARCHAR(10) NULL,
    [subgroup] VARCHAR(10) NULL,
    [sbname] VARCHAR(250) NULL,
    [turnover] MONEY NULL,
    [Location] VARCHAR(200) NULL,
    [SHORT_NAME] VARCHAR(250) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_locsb_mast
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_locsb_mast]
(
    [sbtag] VARCHAR(10) NULL,
    [subgroup] VARCHAR(10) NULL,
    [sbname] VARCHAR(250) NULL,
    [location] VARCHAR(200) NULL,
    [SHORT_NAME] VARCHAR(21) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_manager_ColModHist
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_manager_ColModHist]
(
    [ModifiedBy] VARCHAR(10) NULL,
    [ModifiedOn] DATETIME NULL,
    [OldColumn] VARCHAR(15) NULL,
    [NewColumn] VARCHAR(15) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_manager_Info
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_manager_Info]
(
    [UpdatedBy] VARCHAR(10) NULL,
    [ModifiedOn] DATETIME NULL,
    [Ctcl_Manager] VARCHAR(20) NULL,
    [TCP_Count] VARCHAR(20) NULL,
    [No_Of_Order] VARCHAR(20) NULL,
    [Surveillance_Count] VARCHAR(20) NULL,
    [No_Of_Dealer] VARCHAR(20) NULL,
    [No_Of_DTC] VARCHAR(20) NULL,
    [Date] VARCHAR(20) NULL,
    [Time] VARCHAR(20) NULL,
    [S] VARCHAR(20) NULL,
    [Test] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_sb_mast
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_sb_mast]
(
    [loginid] VARCHAR(255) NULL,
    [sbtag] VARCHAR(10) NOT NULL,
    [subgroup] VARCHAR(10) NOT NULL,
    [sbname] VARCHAR(25) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_sb_mast_1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_sb_mast_1]
(
    [sbtag] VARCHAR(10) NULL,
    [subgroup] VARCHAR(10) NULL,
    [sbname] VARCHAR(25) NULL,
    [location] VARCHAR(200) NULL,
    [SHORT_NAME] VARCHAR(21) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_sb_mast1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_sb_mast1]
(
    [loginid] VARCHAR(255) NULL,
    [sbtag] VARCHAR(10) NOT NULL,
    [subgroup] VARCHAR(10) NOT NULL,
    [sbname] VARCHAR(25) NOT NULL,
    [location] VARCHAR(200) NULL,
    [SHORT_NAME] VARCHAR(21) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_trade_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_trade_hist]
(
    [sauda_DAte] DATETIME NULL,
    [segment] VARCHAR(5) NOT NULL,
    [ctcl_id] VARCHAR(50) NULL,
    [party_Code] VARCHAR(50) NULL,
    [scrip_Cd] VARCHAR(50) NULL,
    [scrip_name] VARCHAR(50) NULL,
    [bs] VARCHAR(50) NULL,
    [mktrate] VARCHAR(50) NULL,
    [tradeqty] VARCHAR(200) NULL,
    [trade_Date] VARCHAR(50) NULL,
    [tradetime] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_trade_hist_1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_trade_hist_1]
(
    [sauda_DAte] DATETIME NULL,
    [SHORT_NAME] VARCHAR(21) NOT NULL,
    [segment] VARCHAR(5) NOT NULL,
    [ctcl_id] VARCHAR(50) NULL,
    [party_Code] VARCHAR(50) NULL,
    [scrip_Cd] VARCHAR(101) NULL,
    [scrip_name] VARCHAR(500) NULL,
    [bs] VARCHAR(2) NULL,
    [mktrate] VARCHAR(50) NULL,
    [tradeqty] VARCHAR(50) NULL,
    [trade_Date] VARCHAR(11) NULL,
    [tradetime] VARCHAR(8) NULL,
    [location] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_trade_hist1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_trade_hist1]
(
    [sauda_DAte] DATETIME NULL,
    [SHORT_NAME] VARCHAR(21) NOT NULL,
    [segment] VARCHAR(5) NOT NULL,
    [ctcl_id] VARCHAR(50) NULL,
    [party_code] VARCHAR(50) NULL,
    [scrip_Cd] VARCHAR(101) NULL,
    [scrip_name] VARCHAR(200) NULL,
    [bs] VARCHAR(8000) NULL,
    [mktrate] VARCHAR(50) NULL,
    [tradeqty] VARCHAR(50) NULL,
    [trade_date] VARCHAR(11) NULL,
    [tradetime] VARCHAR(8) NULL,
    [location] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_trade_summ
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_trade_summ]
(
    [sitecode] VARCHAR(255) NULL,
    [loginid] VARCHAR(255) NULL,
    [sbtag] VARCHAR(10) NOT NULL,
    [subgroup] VARCHAR(10) NOT NULL,
    [sbname] VARCHAR(25) NOT NULL,
    [sauda_date] DATETIME NULL,
    [segment] VARCHAR(5) NOT NULL,
    [turnover] MONEY NOT NULL,
    [VERIATION] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_trade_summ_1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_trade_summ_1]
(
    [sitecode] VARCHAR(255) NULL,
    [loginid] VARCHAR(255) NULL,
    [sbtag] VARCHAR(10) NOT NULL,
    [subgroup] VARCHAR(10) NOT NULL,
    [sbname] VARCHAR(25) NOT NULL,
    [sauda_date] DATETIME NULL,
    [segment] VARCHAR(5) NOT NULL,
    [turnover] MONEY NOT NULL,
    [veriation] VARCHAR(1) NOT NULL,
    [location] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_trade_summ1
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_trade_summ1]
(
    [sitecode] VARCHAR(255) NULL,
    [loginid] VARCHAR(255) NULL,
    [PARTY_CODE] VARCHAR(10) NULL,
    [sbtag] VARCHAR(10) NOT NULL,
    [subgroup] VARCHAR(10) NOT NULL,
    [sbname] VARCHAR(25) NOT NULL,
    [sauda_date] DATETIME NULL,
    [segment] VARCHAR(5) NOT NULL,
    [turnover] MONEY NOT NULL,
    [veriation] VARCHAR(1) NOT NULL,
    [location] VARCHAR(200) NULL,
    [SHORT_NAME] VARCHAR(21) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_volume
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_volume]
(
    [user_id1] VARCHAR(30) NULL,
    [trade_no] VARCHAR(10) NULL,
    [a2] VARCHAR(3) NULL,
    [instrument] VARCHAR(25) NULL,
    [ins_symbol] VARCHAR(50) NULL,
    [expiry_date] SMALLDATETIME NULL,
    [a6] VARCHAR(25) NULL,
    [a7] VARCHAR(25) NULL,
    [commodity_name] VARCHAR(100) NULL,
    [a9] VARCHAR(4) NULL,
    [a10] VARCHAR(4) NULL,
    [a11] VARCHAR(4) NULL,
    [ctcl_id] VARCHAR(15) NULL,
    [a13] VARCHAR(4) NULL,
    [buy_sell] VARCHAR(4) NULL,
    [qty] INT NULL,
    [rate] MONEY NULL,
    [a17] VARCHAR(5) NULL,
    [client_code] VARCHAR(25) NULL,
    [member_id] VARCHAR(15) NULL,
    [a20] VARCHAR(25) NULL,
    [a21] VARCHAR(25) NULL,
    [trade_date] SMALLDATETIME NULL,
    [order_date] SMALLDATETIME NULL,
    [order_no] VARCHAR(40) NULL,
    [a25] VARCHAR(10) NULL,
    [a26] DATETIME NULL,
    [buy_value] MONEY NULL,
    [sell_value] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ctcl_vsat
-- --------------------------------------------------
CREATE TABLE [dbo].[ctcl_vsat]
(
    [vsat_name] VARCHAR(15) NOT NULL,
    [IP] VARCHAR(15) NULL,
    [Active] VARCHAR(1) NULL,
    [Branch_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCLBSEBranch
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCLBSEBranch]
(
    [Branch] VARCHAR(200) NULL,
    [BSECM] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCLDealerBlocked
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCLDealerBlocked]
(
    [Server] VARCHAR(25) NULL,
    [Dealerid] VARCHAR(25) NULL,
    [activestatus] VARCHAR(1) NULL,
    [segment] VARCHAR(35) NULL,
    [updatedby] VARCHAR(10) NULL,
    [updatedon] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCLDealerBlocked_history
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCLDealerBlocked_history]
(
    [clclmancode] VARCHAR(40) NULL,
    [code] VARCHAR(25) NULL,
    [dealerid] VARCHAR(25) NULL,
    [activestatus] VARCHAR(1) NULL,
    [segment] VARCHAR(35) NULL,
    [enteredby] VARCHAR(10) NULL,
    [enteredon] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CTCLDealerBlocked_new
-- --------------------------------------------------
CREATE TABLE [dbo].[CTCLDealerBlocked_new]
(
    [Server] VARCHAR(25) NULL,
    [Dealerid] VARCHAR(25) NULL,
    [activestatus] VARCHAR(1) NULL,
    [segment] VARCHAR(35) NULL,
    [updatedby] VARCHAR(10) NULL,
    [updatedon] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CtclMgrLocation
-- --------------------------------------------------
CREATE TABLE [dbo].[CtclMgrLocation]
(
    [LocaCode] VARCHAR(10) NOT NULL,
    [LocaName] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [SegmentAllowed] VARCHAR(50) NULL,
    [Updated_on] DATETIME NULL,
    [Connectivity_type] VARCHAR(10) NULL,
    [fld_serverid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CtclMgrLocation_10052019
-- --------------------------------------------------
CREATE TABLE [dbo].[CtclMgrLocation_10052019]
(
    [LocaCode] VARCHAR(10) NOT NULL,
    [LocaName] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [SegmentAllowed] VARCHAR(50) NULL,
    [Updated_on] DATETIME NULL,
    [Connectivity_type] VARCHAR(10) NULL,
    [fld_serverid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CtclMgrLocation_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[CtclMgrLocation_hist]
(
    [LocaCode] VARCHAR(10) NOT NULL,
    [LocaName] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [Updated_on] DATETIME NULL,
    [Connectivity_type] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.CtclMgrLocation_log
-- --------------------------------------------------
CREATE TABLE [dbo].[CtclMgrLocation_log]
(
    [LocaCode] VARCHAR(10) NULL,
    [LocaName] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [SegmentAllowed] VARCHAR(50) NULL,
    [deleted_on] DATETIME NULL,
    [deleted_by] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dailyhit
-- --------------------------------------------------
CREATE TABLE [dbo].[dailyhit]
(
    [hitdate] DATETIME NULL,
    [hitip] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.data$
-- --------------------------------------------------
CREATE TABLE [dbo].[data$]
(
    [F1] FLOAT NULL,
    [F2] NVARCHAR(255) NULL,
    [F3] NVARCHAR(255) NULL,
    [F4] NVARCHAR(255) NULL,
    [F5] DATETIME NULL,
    [F6] NVARCHAR(255) NULL,
    [F7] NVARCHAR(MAX) NULL,
    [F8] DATETIME NULL,
    [F9] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.DC
-- --------------------------------------------------
CREATE TABLE [dbo].[DC]
(
    [Col001] VARCHAR(255) NULL,
    [Col002] VARCHAR(255) NULL,
    [Col003] VARCHAR(255) NULL,
    [Col004] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.delete
-- --------------------------------------------------
CREATE TABLE [dbo].[delete]
(
    [name] NVARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.diet_dtc
-- --------------------------------------------------
CREATE TABLE [dbo].[diet_dtc]
(
    [Dealer] VARCHAR(50) NULL,
    [Party_Code] VARCHAR(50) NULL,
    [Location] VARCHAR(100) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.dietmgrlocation
-- --------------------------------------------------
CREATE TABLE [dbo].[dietmgrlocation]
(
    [LocaCode] VARCHAR(10) NOT NULL,
    [LocaName] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [Updated_on] DATETIME NULL,
    [Connectivity_type] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECS_Priority
-- --------------------------------------------------
CREATE TABLE [dbo].[ECS_Priority]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Priority] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECS_Role
-- --------------------------------------------------
CREATE TABLE [dbo].[ECS_Role]
(
    [RoleId] INT IDENTITY(1,1) NOT NULL,
    [Role] VARCHAR(50) NULL,
    [priority] INT NULL,
    [Description] VARCHAR(100) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] VARCHAR(50) NULL,
    [ModifyBy] VARCHAR(50) NULL,
    [ModifyOn] VARCHAR(50) NULL,
    [IsDelete] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECS_User_Role
-- --------------------------------------------------
CREATE TABLE [dbo].[ECS_User_Role]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [UserId] INT NULL,
    [RoleId] INT NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] VARCHAR(50) NULL,
    [ModifyBy] VARCHAR(50) NULL,
    [ModifyOn] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ECS_Users
-- --------------------------------------------------
CREATE TABLE [dbo].[ECS_Users]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Username] VARCHAR(50) NOT NULL,
    [Password] VARCHAR(MAX) NOT NULL,
    [EmailId] VARCHAR(50) NOT NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] VARCHAR(50) NULL,
    [ModifyBy] VARCHAR(50) NULL,
    [ModifyOn] VARCHAR(50) NULL,
    [IsDelete] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.EmpDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[EmpDetails]
(
    [empid] INT IDENTITY(1,1) NOT NULL,
    [empname] VARCHAR(20) NULL,
    [empimg] IMAGE NULL,
    [empimg1] IMAGE NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.entry_payin
-- --------------------------------------------------
CREATE TABLE [dbo].[entry_payin]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [Edate] DATETIME NULL,
    [Vdate] DATETIME NULL,
    [Cltcode] VARCHAR(10) NULL,
    [Amount] MONEY NULL,
    [DRCR] VARCHAR(1) NULL,
    [Narration] VARCHAR(50) NULL,
    [BankCode] VARCHAR(25) NULL,
    [BankName] VARCHAR(50) NULL,
    [DDNo] VARCHAR(25) NULL,
    [Branchcode] VARCHAR(10) NULL,
    [BranchName] VARCHAR(50) NULL,
    [chqmode] VARCHAR(50) NULL,
    [chqdate] DATETIME NULL,
    [chqname] VARCHAR(50) NULL,
    [clmode] VARCHAR(10) NULL,
    [entered_on] DATETIME NULL,
    [entered_by] VARCHAR(25) NULL,
    [entered_fromIP] VARCHAR(25) NULL,
    [posted_on] DATETIME NULL,
    [posted_status] VARCHAR(10) NULL,
    [sessionid] INT NULL,
    [segment] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.error_codes
-- --------------------------------------------------
CREATE TABLE [dbo].[error_codes]
(
    [code] VARCHAR(10) NULL,
    [reason] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.exclude_cat_mapping
-- --------------------------------------------------
CREATE TABLE [dbo].[exclude_cat_mapping]
(
    [EMP_NO] VARCHAR(10) NOT NULL,
    [MENU_CODE] INT NOT NULL,
    [MAPPED_BY] VARCHAR(10) NULL,
    [MAPPED_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.exmcltto
-- --------------------------------------------------
CREATE TABLE [dbo].[exmcltto]
(
    [party_code] VARCHAR(20) NULL,
    [company] VARCHAR(10) NULL,
    [ARPC] INT NULL,
    [brokerage] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.extra_cat_mapping
-- --------------------------------------------------
CREATE TABLE [dbo].[extra_cat_mapping]
(
    [EMP_NO] VARCHAR(20) NULL,
    [MENU_CODE] INT NOT NULL,
    [MAPPED_BY] VARCHAR(10) NULL,
    [MAPPED_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.extra_cat_mappingdel
-- --------------------------------------------------
CREATE TABLE [dbo].[extra_cat_mappingdel]
(
    [EMP_NO] VARCHAR(20) NULL,
    [MENU_CODE] INT NOT NULL,
    [MAPPED_BY] VARCHAR(10) NULL,
    [MAPPED_ON] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ff_ABCDeposit_details
-- --------------------------------------------------
CREATE TABLE [dbo].[ff_ABCDeposit_details]
(
    [rdate] DATETIME NULL,
    [type] VARCHAR(30) NULL,
    [bc] NUMERIC(25, 2) NULL,
    [bg] NUMERIC(25, 2) NULL,
    [fd] NUMERIC(25, 2) NULL,
    [shares] NUMERIC(25, 2) NULL,
    [cash] NUMERIC(25, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ff_ABCUtilized_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[ff_ABCUtilized_Details]
(
    [rdate] DATETIME NULL,
    [type] VARCHAR(30) NULL,
    [IMVAR] NUMERIC(25, 2) NULL,
    [MTOM] NUMERIC(25, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ff_acc_details
-- --------------------------------------------------
CREATE TABLE [dbo].[ff_acc_details]
(
    [rdate] DATETIME NULL,
    [type] VARCHAR(50) NULL,
    [NCDEX] NUMERIC(25, 2) NULL,
    [MCX] NUMERIC(25, 2) NULL,
    [ASLFO] NUMERIC(25, 2) NULL,
    [BSE] NUMERIC(25, 2) NULL,
    [NSE] NUMERIC(25, 2) NULL,
    [NSEFO] NUMERIC(25, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ff_other_values
-- --------------------------------------------------
CREATE TABLE [dbo].[ff_other_values]
(
    [type] VARCHAR(100) NULL,
    [value] NUMERIC(25, 2) NULL,
    [dateModified] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ff_tmmrsfund_details
-- --------------------------------------------------
CREATE TABLE [dbo].[ff_tmmrsfund_details]
(
    [rdate] DATETIME NULL,
    [type] VARCHAR(100) NOT NULL,
    [qty] NUMERIC(20, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ff_transactions_details
-- --------------------------------------------------
CREATE TABLE [dbo].[ff_transactions_details]
(
    [rdate] DATETIME NULL,
    [type] VARCHAR(50) NULL,
    [qty] NUMERIC(25, 2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FileUploads
-- --------------------------------------------------
CREATE TABLE [dbo].[FileUploads]
(
    [data] VARCHAR(MAX) NULL,
    [date] DATETIME NULL,
    [fname] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.final
-- --------------------------------------------------
CREATE TABLE [dbo].[final]
(
    [partyc1] VARCHAR(20) NULL,
    [brok] MONEY NULL,
    [mindate] DATETIME NULL,
    [partyc2] VARCHAR(20) NULL,
    [sm] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.FO_sebi
-- --------------------------------------------------
CREATE TABLE [dbo].[FO_sebi]
(
    [branch_cd] VARCHAR(10) NULL,
    [sub_Broker] VARCHAR(10) NOT NULL,
    [long_name] VARCHAR(100) NULL,
    [ContractNo] VARCHAR(14) NOT NULL,
    [BillNo] NUMERIC(18, 4) NULL,
    [Trade_no] VARCHAR(10) NOT NULL,
    [Party_Code] VARCHAR(10) NOT NULL,
    [Inst_type] VARCHAR(6) NULL,
    [Symbol] VARCHAR(12) NULL,
    [Sec_name] VARCHAR(25) NOT NULL,
    [Expirydate] DATETIME NULL,
    [Strike_price] MONEY NULL,
    [Option_type] VARCHAR(2) NULL,
    [User_id] INT NOT NULL,
    [Pro_cli] INT NULL,
    [O_C_Flag] VARCHAR(5) NULL,
    [C_U_Flag] VARCHAR(7) NULL,
    [Tradeqty] INT NULL,
    [AuctionPart] VARCHAR(2) NULL,
    [MarketType] VARCHAR(2) NULL,
    [Series] CHAR(2) NOT NULL,
    [Order_no] VARCHAR(15) NOT NULL,
    [Price] MONEY NULL,
    [Sauda_date] DATETIME NOT NULL,
    [Table_No] VARCHAR(4) NOT NULL,
    [Line_No] NUMERIC(3, 0) NOT NULL,
    [Val_perc] CHAR(1) NULL,
    [Normal] MONEY NULL,
    [Day_puc] MONEY NULL,
    [day_sales] MONEY NULL,
    [Sett_purch] MONEY NULL,
    [Sett_sales] MONEY NULL,
    [Sell_buy] INT NOT NULL,
    [Settflag] INT NULL,
    [Brokapplied] MONEY NULL,
    [NetRate] NUMERIC(15, 7) NULL,
    [Amount] MONEY NULL,
    [Ins_chrg] MONEY NULL,
    [turn_tax] MONEY NULL,
    [other_chrg] MONEY NULL,
    [sebi_tax] MONEY NULL,
    [Broker_chrg] MONEY NULL,
    [Service_tax] MONEY NULL,
    [Trade_amount] MONEY NULL,
    [Billflag] INT NULL,
    [sett_no] VARCHAR(12) NULL,
    [NBrokApp] MONEY NULL,
    [NSerTax] MONEY NULL,
    [N_NetRate] NUMERIC(15, 7) NULL,
    [sett_type] VARCHAR(3) NULL,
    [Cl_Rate] MONEY NULL,
    [ParticipantCode] VARCHAR(15) NULL,
    [Status] VARCHAR(2) NULL,
    [CpId] VARCHAR(20) NULL,
    [Instrument] INT NULL,
    [BookType] INT NULL,
    [Branch_Id] VARCHAR(15) NULL,
    [TMark] INT NULL,
    [Scheme] INT NULL,
    [Dummy1] INT NULL,
    [Dummy2] INT NULL,
    [Reserved1] INT NULL,
    [Reserved2] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.gb0506_fin
-- --------------------------------------------------
CREATE TABLE [dbo].[gb0506_fin]
(
    [branch_Cd] VARCHAR(255) NULL,
    [sub_BRoker] VARCHAR(255) NULL,
    [long_name] VARCHAR(255) NULL,
    [party_Code] VARCHAR(255) NULL,
    [BSECM_TRD_TO] MONEY NULL,
    [BSECM_DEL_TO] MONEY NULL,
    [BSECM_Trd_Gross] MONEY NULL,
    [BSECM_DEL_Gross] MONEY NULL,
    [BSECM_Trd_Net] MONEY NULL,
    [BSECM_DEL_Net] MONEY NULL,
    [NSECM_TRD_TO] MONEY NULL,
    [NSECM_DEL_TO] MONEY NULL,
    [NSECM_Trd_Gross] MONEY NULL,
    [NSECM_DEL_Gross] MONEY NULL,
    [NSECM_Trd_Net] MONEY NULL,
    [NSECM_DEL_Net] MONEY NULL,
    [NSEFO_TO] MONEY NULL,
    [NSEFO_Gross] MONEY NULL,
    [NSEFO_Net] MONEY NULL,
    [MCX_TO] MONEY NULL,
    [MCX_Gross] MONEY NULL,
    [MCX_Net] MONEY NULL,
    [NCDEX_TO] MONEY NULL,
    [NCDEX_Gross] MONEY NULL,
    [NCDEX_Net] MONEY NULL,
    [Cli_status] VARCHAR(3) NOT NULL,
    [SB_status] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.gb0607_fin
-- --------------------------------------------------
CREATE TABLE [dbo].[gb0607_fin]
(
    [branch_Cd] VARCHAR(255) NULL,
    [sub_BRoker] VARCHAR(255) NULL,
    [long_name] VARCHAR(255) NULL,
    [party_Code] VARCHAR(255) NULL,
    [BSECM_TRD_TO] MONEY NULL,
    [BSECM_DEL_TO] MONEY NULL,
    [BSECM_Trd_Gross] MONEY NULL,
    [BSECM_DEL_Gross] MONEY NULL,
    [BSECM_Trd_Net] MONEY NULL,
    [BSECM_DEL_Net] MONEY NULL,
    [NSECM_TRD_TO] MONEY NULL,
    [NSECM_DEL_TO] MONEY NULL,
    [NSECM_Trd_Gross] MONEY NULL,
    [NSECM_DEL_Gross] MONEY NULL,
    [NSECM_Trd_Net] MONEY NULL,
    [NSECM_DEL_Net] MONEY NULL,
    [NSEFO_TO] MONEY NULL,
    [NSEFO_Gross] MONEY NULL,
    [NSEFO_Net] MONEY NULL,
    [MCX_TO] MONEY NULL,
    [MCX_Gross] MONEY NULL,
    [MCX_Net] MONEY NULL,
    [NCDEX_TO] MONEY NULL,
    [NCDEX_Gross] MONEY NULL,
    [NCDEX_Net] MONEY NULL,
    [Cli_status] VARCHAR(3) NOT NULL,
    [SB_status] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.gb0700_fin
-- --------------------------------------------------
CREATE TABLE [dbo].[gb0700_fin]
(
    [branch_Cd] VARCHAR(255) NULL,
    [sub_BRoker] VARCHAR(255) NULL,
    [long_name] VARCHAR(255) NULL,
    [party_Code] VARCHAR(255) NULL,
    [BSECM_TRD_TO] MONEY NULL,
    [BSECM_DEL_TO] MONEY NULL,
    [BSECM_Trd_Gross] MONEY NULL,
    [BSECM_DEL_Gross] MONEY NULL,
    [BSECM_Trd_Net] MONEY NULL,
    [BSECM_DEL_Net] MONEY NULL,
    [NSECM_TRD_TO] MONEY NULL,
    [NSECM_DEL_TO] MONEY NULL,
    [NSECM_Trd_Gross] MONEY NULL,
    [NSECM_DEL_Gross] MONEY NULL,
    [NSECM_Trd_Net] MONEY NULL,
    [NSECM_DEL_Net] MONEY NULL,
    [NSEFO_TO] MONEY NULL,
    [NSEFO_Gross] MONEY NULL,
    [NSEFO_Net] MONEY NULL,
    [MCX_TO] MONEY NULL,
    [MCX_Gross] MONEY NULL,
    [MCX_Net] MONEY NULL,
    [NCDEX_TO] MONEY NULL,
    [NCDEX_Gross] MONEY NULL,
    [NCDEX_Net] MONEY NULL,
    [Cli_status] VARCHAR(3) NOT NULL,
    [SB_status] VARCHAR(3) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Generate_OTP_BackOffice
-- --------------------------------------------------
CREATE TABLE [dbo].[Generate_OTP_BackOffice]
(
    [OTP_Id] BIGINT IDENTITY(1,1) NOT NULL,
    [SBTAg] VARCHAR(50) NULL,
    [MobileNo] BIGINT NULL,
    [OTPPin] VARCHAR(100) NULL,
    [GeneratedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.get_menu_option
-- --------------------------------------------------
CREATE TABLE [dbo].[get_menu_option]
(
    [menu_code] INT NOT NULL,
    [Head] VARCHAR(100) NULL,
    [Sub_Head] VARCHAR(100) NULL,
    [menu_name] VARCHAR(100) NULL,
    [menu_url] VARCHAR(250) NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [cat_name] VARCHAR(40) NULL,
    [cat_code] INT NULL,
    [access_Code] VARCHAR(50) NULL,
    [userid] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.get_menu_option_extra
-- --------------------------------------------------
CREATE TABLE [dbo].[get_menu_option_extra]
(
    [menu_code] INT NOT NULL,
    [Head] VARCHAR(100) NULL,
    [Sub_Head] VARCHAR(100) NULL,
    [menu_name] VARCHAR(100) NULL,
    [menu_url] VARCHAR(250) NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [cat_name] VARCHAR(1) NOT NULL,
    [cat_code] INT NOT NULL,
    [access_Code] VARCHAR(50) NULL,
    [userid] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.get_menu_option_extradel
-- --------------------------------------------------
CREATE TABLE [dbo].[get_menu_option_extradel]
(
    [menu_code] INT NOT NULL,
    [Head] VARCHAR(100) NULL,
    [Sub_Head] VARCHAR(100) NULL,
    [menu_name] VARCHAR(100) NULL,
    [menu_url] VARCHAR(250) NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [cat_name] VARCHAR(1) NOT NULL,
    [cat_code] INT NOT NULL,
    [access_Code] VARCHAR(50) NULL,
    [userid] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.get_menu_optiondel
-- --------------------------------------------------
CREATE TABLE [dbo].[get_menu_optiondel]
(
    [menu_code] INT NOT NULL,
    [Head] VARCHAR(100) NULL,
    [Sub_Head] VARCHAR(100) NULL,
    [menu_name] VARCHAR(100) NULL,
    [menu_url] VARCHAR(250) NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [cat_name] VARCHAR(40) NULL,
    [cat_code] INT NULL,
    [access_Code] VARCHAR(50) NULL,
    [userid] INT NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Hold_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[Hold_BSE]
(
    [Party_Code] VARCHAR(100) NULL,
    [Party_Name] VARCHAR(100) NULL,
    [Scrip_Cd] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [DPId] VARCHAR(100) NULL,
    [ClientId] VARCHAR(100) NULL,
    [Isin] VARCHAR(100) NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Sett_Type] VARCHAR(100) NULL,
    [HoldQty] VARCHAR(50) NULL,
    [PledgeQty] VARCHAR(50) NULL,
    [Qty] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Hold_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[Hold_NSE]
(
    [Party_Code] VARCHAR(100) NULL,
    [Party_Name] VARCHAR(100) NULL,
    [Scrip_Cd] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [DPId] VARCHAR(100) NULL,
    [ClientId] VARCHAR(100) NULL,
    [Isin] VARCHAR(100) NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Sett_Type] VARCHAR(100) NULL,
    [HoldQty] VARCHAR(50) NULL,
    [PledgeQty] VARCHAR(50) NULL,
    [Qty] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Hold_NSE_BSE_Poor
-- --------------------------------------------------
CREATE TABLE [dbo].[Hold_NSE_BSE_Poor]
(
    [Party_Code] VARCHAR(100) NULL,
    [Party_Name] VARCHAR(100) NULL,
    [Scrip_Cd] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [DPId] VARCHAR(100) NULL,
    [ClientId] VARCHAR(100) NULL,
    [Isin] VARCHAR(100) NULL,
    [Sett_No] VARCHAR(100) NULL,
    [Sett_Type] VARCHAR(100) NULL,
    [HoldQty] BIGINT NULL,
    [PledgeQty] BIGINT NULL,
    [Qty] BIGINT NULL,
    [Segment] VARCHAR(10) NULL,
    [Angel scrip category] VARCHAR(50) NULL,
    [entereddate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.IML_ID
-- --------------------------------------------------
CREATE TABLE [dbo].[IML_ID]
(
    [F1] FLOAT NULL,
    [F2] NVARCHAR(255) NULL,
    [IML ID] NVARCHAR(255) NULL,
    [F4] NVARCHAR(255) NULL,
    [F5] NVARCHAR(255) NULL,
    [F6] NVARCHAR(255) NULL,
    [F7] NVARCHAR(255) NULL,
    [F8] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.inbox
-- --------------------------------------------------
CREATE TABLE [dbo].[inbox]
(
    [mailfrom] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.INSP_SB_INFO
-- --------------------------------------------------
CREATE TABLE [dbo].[INSP_SB_INFO]
(
    [BRCode] VARCHAR(255) NULL,
    [SBCode] VARCHAR(255) NULL,
    [SBName] VARCHAR(255) NULL,
    [PANNO] NVARCHAR(255) NULL,
    [Constitution] NVARCHAR(255) NULL,
    [REGNNo] NVARCHAR(255) NULL,
    [OWN_CLICODE] VARCHAR(255) NULL,
    [SB_Turnover] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.insp_sb_pending
-- --------------------------------------------------
CREATE TABLE [dbo].[insp_sb_pending]
(
    [BRCode] NVARCHAR(255) NULL,
    [SBCode] NVARCHAR(255) NULL,
    [SBName] NVARCHAR(255) NULL,
    [Constitution] NVARCHAR(255) NULL,
    [REGNNo] NVARCHAR(255) NULL,
    [OWN_CLICODE] VARCHAR(255) NULL,
    [Turnover] MONEY NULL,
    [F8] NVARCHAR(255) NULL,
    [F9] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Invalid_ISIN
-- --------------------------------------------------
CREATE TABLE [dbo].[Invalid_ISIN]
(
    [INvalid_Isin] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ip_addr
-- --------------------------------------------------
CREATE TABLE [dbo].[ip_addr]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [ip] VARCHAR(16) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'LAWRENC RD'
-- --------------------------------------------------
CREATE TABLE [dbo].['LAWRENC RD']
(
    [Branch] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [ Name] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [Contact no] FLOAT NULL,
    [Remisier] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LAWRENCRD
-- --------------------------------------------------
CREATE TABLE [dbo].[LAWRENCRD]
(
    [Branch] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [ Name] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [Contact no] FLOAT NULL,
    [Remisier] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.location
-- --------------------------------------------------
CREATE TABLE [dbo].[location]
(
    [location] VARCHAR(50) NULL,
    [last_uploaded] DATETIME NULL,
    [pswd] VARCHAR(25) NULL,
    [username] VARCHAR(25) NULL,
    [category] VARCHAR(10) NULL,
    [locaname] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.location_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[location_hist]
(
    [location] VARCHAR(50) NULL,
    [last_uploaded] DATETIME NULL,
    [pswd] VARCHAR(25) NULL,
    [username] VARCHAR(25) NULL,
    [category] VARCHAR(10) NULL,
    [locaname] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.login
-- --------------------------------------------------
CREATE TABLE [dbo].[login]
(
    [username] VARCHAR(50) NOT NULL,
    [pass] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.LogShift
-- --------------------------------------------------
CREATE TABLE [dbo].[LogShift]
(
    [OLD_KYC_CODE] VARCHAR(10) NULL,
    [BRANCH] VARCHAR(10) NULL,
    [SUB_BROKER] VARCHAR(10) NULL,
    [NEW_KYC_CODE] VARCHAR(10) NULL,
    [EntryDate] DATETIME NULL DEFAULT (getdate())
);

GO

-- --------------------------------------------------
-- TABLE dbo.mail_table
-- --------------------------------------------------
CREATE TABLE [dbo].[mail_table]
(
    [subject] VARCHAR(500) NULL,
    [sender] VARCHAR(200) NULL,
    [received] VARCHAR(200) NULL,
    [read_unread] VARCHAR(15) NULL,
    [message] VARCHAR(8000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.manesh_x
-- --------------------------------------------------
CREATE TABLE [dbo].[manesh_x]
(
    [Br.Code] VARCHAR(10) NULL,
    [SB.Code] VARCHAR(10) NULL,
    [Party Code] VARCHAR(10) NULL,
    [Party Name] VARCHAR(21) NULL,
    [segment] VARCHAR(5) NOT NULL,
    [Amount] MONEY NULL,
    [PI DateTime] VARCHAR(25) NULL,
    [BO DateTime] VARCHAR(25) NOT NULL,
    [Time Gap] VARCHAR(28) NULL,
    [Bank] VARCHAR(50) NULL,
    [Bank Ref.No.] VARCHAR(20) NULL,
    [Txn.Ref.No.] VARCHAR(25) NULL,
    [product] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.menu_item
-- --------------------------------------------------
CREATE TABLE [dbo].[menu_item]
(
    [menu_code] INT IDENTITY(1,1) NOT NULL,
    [Head] VARCHAR(100) NULL,
    [Sub_Head] VARCHAR(100) NULL,
    [menu_name] VARCHAR(100) NULL,
    [menu_url] VARCHAR(250) NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [Owner_name] VARCHAR(50) NULL,
    [developer_name] VARCHAR(50) NULL,
    [applicable_to] VARCHAR(400) NULL,
    [update_by] VARCHAR(50) NULL,
    [update_on] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.menu_itemdel
-- --------------------------------------------------
CREATE TABLE [dbo].[menu_itemdel]
(
    [menu_code] INT IDENTITY(1,1) NOT NULL,
    [Head] VARCHAR(100) NULL,
    [Sub_Head] VARCHAR(100) NULL,
    [menu_name] VARCHAR(100) NULL,
    [menu_url] VARCHAR(250) NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [Owner_name] VARCHAR(50) NULL,
    [developer_name] VARCHAR(50) NULL,
    [applicable_to] VARCHAR(400) NULL,
    [update_by] VARCHAR(50) NULL,
    [update_on] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.mtemp2
-- --------------------------------------------------
CREATE TABLE [dbo].[mtemp2]
(
    [Sloginid] VARCHAR(20) NULL,
    [Exchseg] VARCHAR(50) NULL,
    [S__Amount] MONEY NULL,
    [R__Response_time] DATETIME NULL,
    [R__Payment_reference_number] VARCHAR(50) NULL,
    [R__BAnk_name] VARCHAR(100) NULL,
    [S__SubMerchant_id] VARCHAR(20) NULL,
    [SFromAccNo] VARCHAR(50) NULL,
    [product] VARCHAR(100) NULL,
    [LimitUpdationAPIStatus] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.multiplier
-- --------------------------------------------------
CREATE TABLE [dbo].[multiplier]
(
    [symbol] VARCHAR(50) NULL,
    [expiry_date] VARCHAR(50) NULL,
    [commodity] VARCHAR(100) NULL,
    [multiplier] INT NULL,
    [price_unit] VARCHAR(50) NULL,
    [delivery_lot] MONEY NULL,
    [delivery_unit] VARCHAR(50) NULL,
    [regular_lot] VARCHAR(50) NULL,
    [trading_lot] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.myytable_sebi_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[myytable_sebi_RENAMEDAS_PII]
(
    [Sr] INT NULL,
    [Name] VARCHAR(800) NULL,
    [Address] NVARCHAR(255) NULL,
    [Pan_no] NVARCHAR(255) NULL,
    [Dt_SEBI_Order] DATETIME NULL,
    [Order_NO] VARCHAR(MAX) NULL,
    [Brief_particulars] NTEXT NULL,
    [Start_Date] SMALLDATETIME NULL,
    [End_date] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.odin_dealer_mumbai
-- --------------------------------------------------
CREATE TABLE [dbo].[odin_dealer_mumbai]
(
    [LOCATION] VARCHAR(50) NULL,
    [User_Id] VARCHAR(50) NULL,
    [Group_Id] VARCHAR(50) NULL,
    [Name] VARCHAR(200) NULL,
    [Category] VARCHAR(100) NULL,
    [Status] VARCHAR(100) NULL,
    [Markets_Allowed] VARCHAR(500) NULL,
    [BSE] VARCHAR(10) NULL,
    [NSE] VARCHAR(10) NULL,
    [NSEFO] VARCHAR(10) NULL,
    [MCX] VARCHAR(10) NULL,
    [NCDEX] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.odin_det
-- --------------------------------------------------
CREATE TABLE [dbo].[odin_det]
(
    [UserId] VARCHAR(255) NULL,
    [GroupId] VARCHAR(255) NULL,
    [Name] VARCHAR(255) NULL,
    [SurvOnOff] VARCHAR(255) NULL,
    [SurvAutoManual] VARCHAR(255) NULL,
    [PRIMEOnOff] VARCHAR(255) NULL,
    [MaxBCastScrips] VARCHAR(255) NULL,
    [OrderNoSec] VARCHAR(255) NULL,
    [Status] VARCHAR(255) NULL,
    [MarketsAllowed] VARCHAR(255) NULL,
    [IPAddress] VARCHAR(255) NULL,
    [Category] VARCHAR(255) NULL,
    [AliasDealerId] VARCHAR(255) NULL,
    [PinCode] VARCHAR(255) NULL,
    [CashCTCLBranchId] VARCHAR(255) NULL,
    [CashCTCLId] VARCHAR(255) NULL,
    [BranchName] VARCHAR(255) NULL,
    [DervCTCLBranchId] VARCHAR(255) NULL,
    [DervCTCLId] VARCHAR(255) NULL,
    [UCCCreationTime] VARCHAR(255) NULL,
    [UCCModificationTime] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.odin_det_all
-- --------------------------------------------------
CREATE TABLE [dbo].[odin_det_all]
(
    [fname] VARCHAR(50) NULL,
    [UserId] VARCHAR(255) NULL,
    [GroupId] VARCHAR(255) NULL,
    [Name] VARCHAR(255) NULL,
    [SurvOnOff] VARCHAR(255) NULL,
    [SurvAutoManual] VARCHAR(255) NULL,
    [PRIMEOnOff] VARCHAR(255) NULL,
    [MaxBCastScrips] VARCHAR(255) NULL,
    [OrderNoSec] VARCHAR(255) NULL,
    [Status] VARCHAR(255) NULL,
    [MarketsAllowed] VARCHAR(255) NULL,
    [IPAddress] VARCHAR(255) NULL,
    [Category] VARCHAR(255) NULL,
    [AliasDealerId] VARCHAR(255) NULL,
    [PinCode] VARCHAR(255) NULL,
    [CashCTCLBranchId] VARCHAR(255) NULL,
    [CashCTCLId] VARCHAR(255) NULL,
    [BranchName] VARCHAR(255) NULL,
    [DervCTCLBranchId] VARCHAR(255) NULL,
    [DervCTCLId] VARCHAR(255) NULL,
    [UCCCreationTime] VARCHAR(255) NULL,
    [UCCModificationTime] VARCHAR(255) NULL,
    [updt_date] DATETIME NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Deposit] VARCHAR(100) NULL,
    [Code] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [SGroup] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Instrument_Name] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [Strike_Price] VARCHAR(100) NULL,
    [Option_Type] VARCHAR(100) NULL,
    [Gross_Expo_Mult] VARCHAR(100) NULL,
    [GE_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Expo_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Premium_in_000s] VARCHAR(100) NULL,
    [Net_Sale_Expo_Multi] VARCHAR(100) NULL,
    [NSE_Write_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Pos_Multi] VARCHAR(100) NULL,
    [NP_Limit_in_000s] VARCHAR(100) NULL,
    [Turnover_Multi] VARCHAR(100) NULL,
    [TurnOver_Limit_in_000s] VARCHAR(100) NULL,
    [Pending_Order_Multi] VARCHAR(100) NULL,
    [Pending_Order_Limit_in_000s] VARCHAR(100) NULL,
    [MTM_Loss_Multi] VARCHAR(100) NULL,
    [MTM_Limit_in_000s] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_in_000s] VARCHAR(100) NULL,
    [NQ_Limit] VARCHAR(100) NULL,
    [Max_Order_Value] VARCHAR(100) NULL,
    [Max_Order_Qty] VARCHAR(100) NULL,
    [Retain_Multi] VARCHAR(100) NULL,
    [Inclu_MTM] VARCHAR(100) NULL,
    [Inclu_Net_Premium] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL,
    [location] VARCHAR(100) NULL,
    [udatetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.odin_limits_member
-- --------------------------------------------------
CREATE TABLE [dbo].[odin_limits_member]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Deposit] VARCHAR(100) NULL,
    [Code] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [SGroup] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Instrument_Name] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [Strike_Price] VARCHAR(100) NULL,
    [Option_Type] VARCHAR(100) NULL,
    [Gross_Expo_Mult] VARCHAR(100) NULL,
    [GE_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Expo_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Premium_in_000s] VARCHAR(100) NULL,
    [Net_Sale_Expo_Multi] VARCHAR(100) NULL,
    [NSE_Write_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Pos_Multi] VARCHAR(100) NULL,
    [NP_Limit_in_000s] VARCHAR(100) NULL,
    [Turnover_Multi] VARCHAR(100) NULL,
    [TurnOver_Limit_in_000s] VARCHAR(100) NULL,
    [Pending_Order_Multi] VARCHAR(100) NULL,
    [Pending_Order_Limit_in_000s] VARCHAR(100) NULL,
    [MTM_Loss_Multi] VARCHAR(100) NULL,
    [MTM_Limit_in_000s] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_in_000s] VARCHAR(100) NULL,
    [NQ_Limit] VARCHAR(100) NULL,
    [Max_Order_Value] VARCHAR(100) NULL,
    [Max_Order_Qty] VARCHAR(100) NULL,
    [Retain_Multi] VARCHAR(100) NULL,
    [Inclu_MTM] VARCHAR(100) NULL,
    [Inclu_Net_Premium] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL,
    [location] VARCHAR(100) NULL,
    [udatetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.odin_limits_member_NewFormat
-- --------------------------------------------------
CREATE TABLE [dbo].[odin_limits_member_NewFormat]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(50) NULL,
    [Reserved] VARCHAR(100) NULL,
    [Reserved1] VARCHAR(100) NULL,
    [Retain Multiplier] VARCHAR(100) NULL,
    [Over Rule CRP] VARCHAR(100) NULL,
    [Limit Inclusion] VARCHAR(100) NULL,
    [Reserved2] VARCHAR(100) NULL,
    [Cash Deposit] VARCHAR(100) NULL,
    [Adhoc Deposit] VARCHAR(100) NULL,
    [Notional Depsoit] VARCHAR(100) NULL,
    [Miscellaneous Deposit] VARCHAR(100) NULL,
    [Manual Collateral] VARCHAR(100) NULL,
    [Max Option CFS] VARCHAR(100) NULL,
    [Max Collateral] VARCHAR(100) NULL,
    [Max CFS] VARCHAR(100) NULL,
    [Gross_Expo_Limit_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Limit_Multi] VARCHAR(100) NULL,
    [Net_Sale_Limit_Multi] VARCHAR(100) NULL,
    [Net_Premium_Limit_Multi] VARCHAR(100) NULL,
    [Net_Write_Limit_Multi] VARCHAR(100) NULL,
    [Net_Pos_Limit_Multi] VARCHAR(100) NULL,
    [Turnover_Multi_Limt] VARCHAR(100) NULL,
    [MTM_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL,
    [location] VARCHAR(100) NULL,
    [udatetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS_NewFormat
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS_NewFormat]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Reserved] VARCHAR(100) NULL,
    [Reserved1] VARCHAR(100) NULL,
    [Retain Multiplier] VARCHAR(100) NULL,
    [Over Rule CRP] VARCHAR(100) NULL,
    [Limit Inclusion] VARCHAR(100) NULL,
    [Reserved2] VARCHAR(100) NULL,
    [Cash Deposit] VARCHAR(100) NULL,
    [Adhoc Deposit] VARCHAR(100) NULL,
    [Notional Depsoit] VARCHAR(100) NULL,
    [Miscellaneous Deposit] VARCHAR(100) NULL,
    [Manual Collateral] VARCHAR(100) NULL,
    [Max Option CFS] VARCHAR(100) NULL,
    [Max Collateral] VARCHAR(100) NULL,
    [Max CFS] VARCHAR(100) NULL,
    [Gross_Expo_Limit_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Limit_Multi] VARCHAR(100) NULL,
    [Net_Sale_Limit_Multi] VARCHAR(100) NULL,
    [Net_Premium_Limit_Multi] VARCHAR(100) NULL,
    [Net_Write_Limit_Multi] VARCHAR(100) NULL,
    [Net_Pos_Limit_Multi] VARCHAR(100) NULL,
    [Turnover_Multi_Limt] VARCHAR(100) NULL,
    [MTM_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL,
    [location] VARCHAR(100) NULL,
    [udatetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS_TEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS_TEMP]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Deposit] VARCHAR(100) NULL,
    [Code] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [SGroup] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Instrument_Name] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [Strike_Price] VARCHAR(100) NULL,
    [Option_Type] VARCHAR(100) NULL,
    [Gross_Expo_Mult] VARCHAR(100) NULL,
    [GE_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Expo_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Premium_in_000s] VARCHAR(100) NULL,
    [Net_Sale_Expo_Multi] VARCHAR(100) NULL,
    [NSE_Write_Limit_in_000s] VARCHAR(100) NULL,
    [Net_Pos_Multi] VARCHAR(100) NULL,
    [NP_Limit_in_000s] VARCHAR(100) NULL,
    [Turnover_Multi] VARCHAR(100) NULL,
    [TurnOver_Limit_in_000s] VARCHAR(100) NULL,
    [Pending_Order_Multi] VARCHAR(100) NULL,
    [Pending_Order_Limit_in_000s] VARCHAR(100) NULL,
    [MTM_Loss_Multi] VARCHAR(100) NULL,
    [MTM_Limit_in_000s] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_in_000s] VARCHAR(100) NULL,
    [NQ_Limit] VARCHAR(100) NULL,
    [Max_Order_Value] VARCHAR(100) NULL,
    [Max_Order_Qty] VARCHAR(100) NULL,
    [Retain_Multi] VARCHAR(100) NULL,
    [Inclu_MTM] VARCHAR(100) NULL,
    [Inclu_Net_Premium] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS_TEMP_NewFormat
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS_TEMP_NewFormat]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Reserved] VARCHAR(100) NULL,
    [Reserved1] VARCHAR(100) NULL,
    [Retain Multiplier] VARCHAR(100) NULL,
    [Over Rule CRP] VARCHAR(100) NULL,
    [Limit Inclusion] VARCHAR(100) NULL,
    [Reserved2] VARCHAR(100) NULL,
    [Cash Deposit] VARCHAR(100) NULL,
    [Adhoc Deposit] VARCHAR(100) NULL,
    [Notional Depsoit] VARCHAR(100) NULL,
    [Miscellaneous Deposit] VARCHAR(100) NULL,
    [Manual Collateral] VARCHAR(100) NULL,
    [Max Option CFS] VARCHAR(100) NULL,
    [Max Collateral] VARCHAR(100) NULL,
    [Max CFS] VARCHAR(100) NULL,
    [Gross_Expo_Limit_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Limit_Multi] VARCHAR(100) NULL,
    [Net_Sale_Limit_Multi] VARCHAR(100) NULL,
    [Net_Premium_Limit_Multi] VARCHAR(100) NULL,
    [Net_Write_Limit_Multi] VARCHAR(100) NULL,
    [Net_Pos_Limit_Multi] VARCHAR(100) NULL,
    [Turnover_Multi_Limt] VARCHAR(100) NULL,
    [MTM_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ODIN_LIMITS_TEMP_OldFormat
-- --------------------------------------------------
CREATE TABLE [dbo].[ODIN_LIMITS_TEMP_OldFormat]
(
    [OpCode] VARCHAR(100) NULL,
    [UserCode] VARCHAR(100) NULL,
    [Group_Id] VARCHAR(100) NULL,
    [Periodicity] VARCHAR(100) NULL,
    [Reserved] VARCHAR(100) NULL,
    [Reserved1] VARCHAR(100) NULL,
    [Scrip Code] VARCHAR(100) NULL,
    [Symbol] VARCHAR(100) NULL,
    [Series] VARCHAR(100) NULL,
    [Instrument Name] VARCHAR(100) NULL,
    [Expiry] VARCHAR(100) NULL,
    [Strike Price] VARCHAR(100) NULL,
    [Option Type] VARCHAR(100) NULL,
    [Retain Multiplier] VARCHAR(100) NULL,
    [Over Rule CRP] VARCHAR(100) NULL,
    [MTM Limit Inclusion] VARCHAR(100) NULL,
    [Exposure Limit Inclusion] VARCHAR(100) NULL,
    [Option Limit Inclusion] VARCHAR(100) NULL,
    [Reserved2] VARCHAR(100) NULL,
    [Cash Deposit] VARCHAR(100) NULL,
    [Adhoc Deposit] VARCHAR(100) NULL,
    [Notional Depsoit] VARCHAR(100) NULL,
    [Miscellaneous Deposit] VARCHAR(100) NULL,
    [Manual Collateral] VARCHAR(100) NULL,
    [Max Option CFS] VARCHAR(100) NULL,
    [Max Collateral] VARCHAR(100) NULL,
    [Max CFS] VARCHAR(100) NULL,
    [Gross_Expo_Limit_Multi] VARCHAR(100) NULL,
    [Net_Purchase_Limit_Multi] VARCHAR(100) NULL,
    [Net_Sale_Limit_Multi] VARCHAR(100) NULL,
    [Net_Premium_Limit_Multi] VARCHAR(100) NULL,
    [Net_Write_Limit_Multi] VARCHAR(100) NULL,
    [Net_Pos_Limit_Multi] VARCHAR(100) NULL,
    [Turnover_Multi_Limt] VARCHAR(100) NULL,
    [MTM_Limit_Multi] VARCHAR(100) NULL,
    [Margin_Limit_Multi] VARCHAR(100) NULL,
    [NetQuantity] VARCHAR(100) NULL,
    [Pending_Order_Value] VARCHAR(100) NULL,
    [Max_Single_Tran_Value] VARCHAR(100) NULL,
    [Max_Single_Tran_Qty] VARCHAR(100) NULL,
    [Gross_Net] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OFS_ScripMaster_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[OFS_ScripMaster_Log]
(
    [Srno] INT NOT NULL,
    [ScripName] VARCHAR(50) NULL,
    [BSECode] VARCHAR(20) NULL,
    [NSESymbol] VARCHAR(20) NULL,
    [ValidForDate] DATETIME NULL,
    [MinBidRate] MONEY NULL,
    [MaxBidRate] MONEY NULL,
    [PercentAlert] INT NULL,
    [RI_AmtLimit] MONEY NULL,
    [MinMarginPercent] INT NULL,
    [Checkon_NetA_NetL] CHAR(2) NULL,
    [EnteredBy] VARCHAR(10) NULL,
    [EnteredOn] DATETIME NULL,
    [DBactionOn] DATETIME NULL,
    [DBaction] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.OPFM_Trade
-- --------------------------------------------------
CREATE TABLE [dbo].[OPFM_Trade]
(
    [fm_fndcode] VARCHAR(10) NULL,
    [fm_emp_code] VARCHAR(10) NULL,
    [sauda_date] DATETIME NULL,
    [party_code] VARCHAR(10) NULL,
    [Scrip_cd] VARCHAR(10) NOT NULL,
    [OpenQty] INT NOT NULL,
    [Open_value] NUMERIC(38, 4) NOT NULL,
    [BuyQty] INT NULL,
    [buyMktValue] MONEY NULL,
    [buyNEtValue] NUMERIC(38, 4) NULL,
    [SellQty] INT NULL,
    [SellMktValue] MONEY NULL,
    [SellNEtValue] NUMERIC(38, 4) NULL,
    [Flag] VARCHAR(1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.option
-- --------------------------------------------------
CREATE TABLE [dbo].[option]
(
    [TradeDate] SMALLDATETIME NULL,
    [Underlying] NVARCHAR(255) NULL,
    [ExpiryDate] SMALLDATETIME NULL,
    [OptionType] NVARCHAR(255) NULL,
    [TradeQuantity] FLOAT NULL,
    [%toMarketGross] FLOAT NULL,
    [COD] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORD_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[ORD_BSE]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL,
    [T29] VARCHAR(50) NULL,
    [T30] VARCHAR(50) NULL,
    [T31] VARCHAR(50) NULL,
    [T32] VARCHAR(50) NULL,
    [T33] VARCHAR(50) NULL,
    [T34] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ord_bse_hist
-- --------------------------------------------------
CREATE TABLE [dbo].[ord_bse_hist]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL,
    [T29] VARCHAR(50) NULL,
    [T30] VARCHAR(50) NULL,
    [T31] VARCHAR(50) NULL,
    [T32] VARCHAR(50) NULL,
    [T33] VARCHAR(50) NULL,
    [T34] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORD_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[ORD_MCX]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL,
    [T29] VARCHAR(50) NULL,
    [T30] VARCHAR(50) NULL,
    [T31] VARCHAR(50) NULL,
    [T32] VARCHAR(50) NULL,
    [T33] VARCHAR(50) NULL,
    [T34] VARCHAR(50) NULL,
    [T35] VARCHAR(50) NULL,
    [T36] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORD_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[ORD_NCDEX]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL,
    [T29] VARCHAR(50) NULL,
    [T30] VARCHAR(50) NULL,
    [T31] VARCHAR(50) NULL,
    [T32] VARCHAR(50) NULL,
    [T33] VARCHAR(50) NULL,
    [T34] VARCHAR(50) NULL,
    [T35] VARCHAR(50) NULL,
    [T36] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORD_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[ORD_NSE]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL,
    [T29] VARCHAR(50) NULL,
    [T30] VARCHAR(50) NULL,
    [T31] VARCHAR(50) NULL,
    [T32] VARCHAR(50) NULL,
    [T33] VARCHAR(50) NULL,
    [T34] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.ORD_NSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[ORD_NSEFO]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL,
    [T29] VARCHAR(50) NULL,
    [T30] VARCHAR(50) NULL,
    [T31] VARCHAR(50) NULL,
    [T32] VARCHAR(50) NULL,
    [T33] VARCHAR(50) NULL,
    [T34] VARCHAR(50) NULL,
    [T35] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.overall_mrg
-- --------------------------------------------------
CREATE TABLE [dbo].[overall_mrg]
(
    [BrokerCode] VARCHAR(10) NULL,
    [Party_code] VARCHAR(10) NULL,
    [PArty_name] VARCHAR(50) NULL,
    [dummy1] VARCHAR(15) NULL,
    [Scrip_cd] VARCHAR(10) NULL,
    [Qty] INT NULL,
    [Funding_amt] MONEY NULL,
    [Funding_date] VARCHAR(10) NULL,
    [Fdate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pams_trade
-- --------------------------------------------------
CREATE TABLE [dbo].[pams_trade]
(
    [SEBI_NO] VARCHAR(12) NOT NULL,
    [ContractNo] VARCHAR(14) NOT NULL,
    [Exchange] VARCHAR(1) NOT NULL,
    [TradeDate] VARCHAR(11) NULL,
    [segment1] VARCHAR(7) NOT NULL,
    [settlement_number] VARCHAR(3) NULL,
    [settlement_year] VARCHAR(4) NULL,
    [Backofficecode] VARCHAR(10) NULL,
    [bse_code] VARCHAR(10) NOT NULL,
    [nse_symbol] VARCHAR(25) NULL,
    [nse_group] VARCHAR(2) NOT NULL,
    [isin] VARCHAR(20) NULL,
    [scrip_name] VARCHAR(25) NULL,
    [bought_sold] VARCHAR(1) NOT NULL,
    [traded_quantity] INT NULL,
    [marketrate] MONEY NULL,
    [N_netrate] NUMERIC(18, 4) NULL,
    [NserTax] MONEY NULL,
    [Trans_chgs] MONEY NULL,
    [other_chrg] MONEY NULL,
    [stock_payin] VARCHAR(25) NULL,
    [stock_payout] VARCHAR(25) NULL,
    [cash_payin] VARCHAR(25) NULL,
    [cash_payout] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.payin
-- --------------------------------------------------
CREATE TABLE [dbo].[payin]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [Edate] DATETIME NULL,
    [Vdate] DATETIME NULL,
    [Cltcode] VARCHAR(10) NULL,
    [Amount] MONEY NULL,
    [DRCR] VARCHAR(1) NULL,
    [Narration] VARCHAR(50) NULL,
    [BankCode] VARCHAR(25) NULL,
    [BankName] VARCHAR(50) NULL,
    [DDNo] VARCHAR(25) NULL,
    [Branchcode] VARCHAR(10) NULL,
    [BranchName] VARCHAR(50) NULL,
    [chqmode] VARCHAR(50) NULL,
    [chqdate] DATETIME NULL,
    [chqname] VARCHAR(50) NULL,
    [clmode] VARCHAR(10) NULL,
    [entered_on] DATETIME NULL,
    [entered_by] VARCHAR(25) NULL,
    [entered_fromIP] VARCHAR(25) NULL,
    [posted_on] DATETIME NULL,
    [posted_status] VARCHAR(10) NULL,
    [segment] VARCHAR(10) NULL,
    [App_status] VARCHAR(1) NULL,
    [AccountNo] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.payin_arch
-- --------------------------------------------------
CREATE TABLE [dbo].[payin_arch]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [srnoPayin] BIGINT NULL,
    [Edate] DATETIME NULL,
    [Vdate] DATETIME NULL,
    [Cltcode] VARCHAR(10) NULL,
    [Amount] MONEY NULL,
    [DRCR] VARCHAR(1) NULL,
    [Narration] VARCHAR(50) NULL,
    [BankCode] VARCHAR(25) NULL,
    [BankName] VARCHAR(50) NULL,
    [DDNo] VARCHAR(25) NULL,
    [Branchcode] VARCHAR(10) NULL,
    [BranchName] VARCHAR(50) NULL,
    [chqmode] VARCHAR(50) NULL,
    [chqdate] DATETIME NULL,
    [chqname] VARCHAR(50) NULL,
    [clmode] VARCHAR(10) NULL,
    [entered_on] DATETIME NULL,
    [entered_by] VARCHAR(25) NULL,
    [entered_fromIP] VARCHAR(25) NULL,
    [posted_on] DATETIME NULL,
    [posted_status] VARCHAR(10) NULL,
    [segment] VARCHAR(10) NULL,
    [App_status] VARCHAR(1) NULL,
    [accountNo] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pda_fileinfo_details
-- --------------------------------------------------
CREATE TABLE [dbo].[pda_fileinfo_details]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [Manager_code] VARCHAR(25) NULL,
    [Client_Code] VARCHAR(25) NULL,
    [Zone] VARCHAR(25) NULL,
    [Region_Code] VARCHAR(25) NULL,
    [Branch_Code] VARCHAR(25) NULL,
    [SB_Code] VARCHAR(25) NULL,
    [UpdationType] VARCHAR(25) NULL,
    [PDAUpdationFlag] BIT NULL,
    [UpdationFlag] BIT NULL,
    [Online_Mobile_Flag] BIT NULL,
    [PDAVersion] VARCHAR(15) NULL,
    [Product_Version] VARCHAR(15) NULL,
    [BBB] INT NULL,
    [ExtUpdationFlag] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pdfdemo
-- --------------------------------------------------
CREATE TABLE [dbo].[pdfdemo]
(
    [id] INT NULL,
    [img_path] VARCHAR(100) NULL,
    [name] VARCHAR(100) NULL,
    [addr] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.periodicity
-- --------------------------------------------------
CREATE TABLE [dbo].[periodicity]
(
    [perioducity] VARCHAR(100) NULL,
    [Value] INT NULL,
    [mode] VARCHAR(25) NULL,
    [value_limit] MONEY NULL,
    [qty_limit] MONEY NULL,
    [premium_limit] MONEY NULL,
    [write_limit] MONEY NULL,
    [cvalue_limit] MONEY NULL,
    [cqty_limit] MONEY NULL,
    [cpremium_limit] MONEY NULL,
    [cwrite_limit] MONEY NULL,
    [cge_limit] MONEY NULL,
    [cmode] VARCHAR(25) NULL,
    [dvalue_limit] MONEY NULL,
    [dqty_limit] MONEY NULL,
    [dpremium_limit] MONEY NULL,
    [dwrite_limit] MONEY NULL,
    [dge_limit] MONEY NULL,
    [dmode] VARCHAR(25) NULL,
    [GE_limit] MONEY NULL,
    [NE_limit] MONEY NULL,
    [cNE_limit] MONEY NULL,
    [DNE_limit] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.periodicity_all
-- --------------------------------------------------
CREATE TABLE [dbo].[periodicity_all]
(
    [perioducity] VARCHAR(100) NULL,
    [Value] INT NULL,
    [mode] VARCHAR(25) NULL,
    [value_limit] MONEY NULL,
    [qty_limit] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Periodicity_Update_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[Periodicity_Update_Log]
(
    [Perioducity] VARCHAR(100) NULL,
    [Updatedate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PMS_info
-- --------------------------------------------------
CREATE TABLE [dbo].[PMS_info]
(
    [party_code] VARCHAR(50) NULL,
    [scheme] VARCHAR(50) NULL,
    [scheme_name] VARCHAR(100) NULL,
    [Discret_Flag] CHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.pms_trade_table
-- --------------------------------------------------
CREATE TABLE [dbo].[pms_trade_table]
(
    [SEBI_NO] VARCHAR(50) NULL,
    [ContractNo] VARCHAR(50) NULL,
    [Exchange] CHAR(5) NULL,
    [TradeDate] VARCHAR(20) NULL,
    [segment1] VARCHAR(20) NULL,
    [settlement_number] VARCHAR(50) NULL,
    [settlement_year] VARCHAR(50) NULL,
    [Backofficecode] VARCHAR(50) NULL,
    [bse_code] VARCHAR(50) NULL,
    [nse_symbol] VARCHAR(50) NULL,
    [nse_group] VARCHAR(50) NULL,
    [isin] VARCHAR(50) NULL,
    [scrip_name] VARCHAR(50) NULL,
    [bought_sold] VARCHAR(50) NULL,
    [traded_quantity] VARCHAR(50) NULL,
    [marketrate] VARCHAR(50) NULL,
    [N_netrate] VARCHAR(50) NULL,
    [NserTax] VARCHAR(50) NULL,
    [Trans_chgs] VARCHAR(50) NULL,
    [other_chrg] VARCHAR(50) NULL,
    [stock_payin] VARCHAR(50) NULL,
    [stock_payout] VARCHAR(50) NULL,
    [cash_payin] VARCHAR(50) NULL,
    [cash_payout] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Portfolioholding
-- --------------------------------------------------
CREATE TABLE [dbo].[Portfolioholding]
(
    [Scrip Name] VARCHAR(255) NULL,
    [ISIN] VARCHAR(255) NULL,
    [QTY] INT NULL,
    [RATE] MONEY NULL,
    [Value] MONEY NULL,
    [Setl no] VARCHAR(255) NULL,
    [TYPE] VARCHAR(255) NULL,
    [dummy1] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.'PREET VIHAR'
-- --------------------------------------------------
CREATE TABLE [dbo].['PREET VIHAR']
(
    [Branch] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [NAME] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [Contact no] NVARCHAR(255) NULL,
    [Remisier] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PREETVIHAR_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[PREETVIHAR_RENAMEDAS_PII]
(
    [Branch] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [NAME] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [Contact no] NVARCHAR(255) NULL,
    [Remisier] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.PTM
-- --------------------------------------------------
CREATE TABLE [dbo].[PTM]
(
    [Branch] NVARCHAR(255) NULL,
    [Tag] NVARCHAR(255) NULL,
    [ Name] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [Contact no] FLOAT NULL,
    [Remisier] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Registration
-- --------------------------------------------------
CREATE TABLE [dbo].[Registration]
(
    [S#NO#] FLOAT NULL,
    [NAME] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [CONSTITUTION] NVARCHAR(255) NULL,
    [REMISIER] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [TAG Y/N] NVARCHAR(255) NULL,
    [TERMINAL ID] NVARCHAR(255) NULL,
    [B/O TAG Y/N] NVARCHAR(255) NULL,
    [MARKETING MATERIAL] NVARCHAR(255) NULL,
    [WEEKLY] FLOAT NULL,
    [F16] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Registration'
-- --------------------------------------------------
CREATE TABLE [dbo].[Registration']
(
    [S#NO#] FLOAT NULL,
    [NAME] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [CONSTITUTION] NVARCHAR(255) NULL,
    [REMISIER] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [TAG Y/N] NVARCHAR(255) NULL,
    [TERMINAL ID] NVARCHAR(255) NULL,
    [B/O TAG Y/N] NVARCHAR(255) NULL,
    [MARKETING MATERIAL] NVARCHAR(255) NULL,
    [WEEKLY] FLOAT NULL,
    [F16] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.rejected_file
-- --------------------------------------------------
CREATE TABLE [dbo].[rejected_file]
(
    [record_type] VARCHAR(2) NULL,
    [userid] VARCHAR(10) NULL,
    [ctcl_terminal_id] VARCHAR(15) NULL,
    [client_type] VARCHAR(1) NULL,
    [client_id] VARCHAR(10) NULL,
    [symbol] VARCHAR(10) NULL,
    [buy_value] VARCHAR(15) NULL,
    [sell_value] VARCHAR(15) NULL,
    [error_code] VARCHAR(4) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Remisiers
-- --------------------------------------------------
CREATE TABLE [dbo].[Remisiers]
(
    [S#NO#] FLOAT NULL,
    [NAME] NVARCHAR(255) NULL,
    [LOCATION] NVARCHAR(255) NULL,
    [CONSTITUTION] NVARCHAR(255) NULL,
    [REMISIER] NVARCHAR(255) NULL,
    [ABL] NVARCHAR(255) NULL,
    [ACDL] NVARCHAR(255) NULL,
    [F&O] NVARCHAR(255) NULL,
    [MCX] NVARCHAR(255) NULL,
    [NCDX] NVARCHAR(255) NULL,
    [TAG Y/N] NVARCHAR(255) NULL,
    [B/O TAG Y/N] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.research
-- --------------------------------------------------
CREATE TABLE [dbo].[research]
(
    [filename] VARCHAR(50) NOT NULL,
    [description] VARCHAR(5000) NOT NULL,
    [ffile] VARCHAR(50) NOT NULL,
    [upload_date] DATETIME NOT NULL,
    [dummy1] CHAR(10) NULL,
    [dummy2] CHAR(10) NULL,
    [dummy3] CHAR(10) NULL,
    [dummy4] CHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.research_table
-- --------------------------------------------------
CREATE TABLE [dbo].[research_table]
(
    [pid] INT IDENTITY(1,1) NOT NULL,
    [company_name] VARCHAR(50) NULL,
    [type_reports] VARCHAR(50) NULL,
    [uploaded_Date] VARCHAR(50) NULL,
    [summary] VARCHAR(5000) NULL,
    [path] VARCHAR(100) NULL,
    [loaded_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_INSP_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_INSP_RENAMEDAS_PII]
(
    [BRCode] NVARCHAR(255) NULL,
    [SBCode] NVARCHAR(255) NULL,
    [SBName] NVARCHAR(255) NULL,
    [PANNO] NVARCHAR(255) NULL,
    [Constitution] NVARCHAR(255) NULL,
    [REGNNo] NVARCHAR(255) NULL,
    [OWN_CLICODE] NVARCHAR(255) NULL,
    [SB_own_client_TO] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_with_PAN
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_with_PAN]
(
    [BRCode] VARCHAR(255) NULL,
    [SBCode] VARCHAR(255) NULL,
    [SBName] VARCHAR(255) NULL,
    [PANNO] NVARCHAR(255) NULL,
    [Constitution] NVARCHAR(255) NULL,
    [REGNNo] NVARCHAR(255) NULL,
    [OWN_CLICODE] VARCHAR(255) NULL,
    [SB_Turnover] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SB_WITHOUT_PAN
-- --------------------------------------------------
CREATE TABLE [dbo].[SB_WITHOUT_PAN]
(
    [Brcode] VARCHAR(255) NULL,
    [SBCode] VARCHAR(255) NULL,
    [SBName] VARCHAR(255) NULL,
    [Constitution] VARCHAR(255) NULL,
    [Regn_No] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sbmcx
-- --------------------------------------------------
CREATE TABLE [dbo].[sbmcx]
(
    [SrNo] VARCHAR(255) NULL,
    [CM] VARCHAR(255) NULL,
    [TM] VARCHAR(255) NULL,
    [TerminalID] VARCHAR(255) NULL,
    [ModifiedTime] VARCHAR(255) NULL,
    [TradedTime] VARCHAR(255) NULL,
    [Contract] VARCHAR(255) NULL,
    [Expiry] VARCHAR(255) NULL,
    [OrderNo] VARCHAR(255) NULL,
    [TradeNo] VARCHAR(255) NULL,
    [OldClient] VARCHAR(255) NULL,
    [NewClientId] VARCHAR(255) NULL,
    [nBuyOrSell] VARCHAR(255) NULL,
    [nQuantityinLOTS] INT NULL,
    [Price] MONEY NULL,
    [Amount] MONEY NULL,
    [Type] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sbncdx
-- --------------------------------------------------
CREATE TABLE [dbo].[sbncdx]
(
    [Sr#No#] FLOAT NULL,
    [TRADED_DATE] SMALLDATETIME NULL,
    [TRADED_MBR_ID] FLOAT NULL,
    [MBR_NAME] NVARCHAR(255) NULL,
    [TRADED_NEW_CLIENT] NVARCHAR(255) NULL,
    [TRADED_OLD_CLIENT] NVARCHAR(255) NULL,
    [TRADED_NO] FLOAT NULL,
    [TRADED_CMDTY] NVARCHAR(255) NULL,
    [TRADED_SMBL] NVARCHAR(255) NULL,
    [TRADED_EXP_DT] SMALLDATETIME NULL,
    [TRADED_VLME] INT NULL,
    [TRADED_PRCE] MONEY NULL,
    [Remark] NVARCHAR(255) NULL,
    [buysell] VARCHAR(1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.scrip_alert
-- --------------------------------------------------
CREATE TABLE [dbo].[scrip_alert]
(
    [qty_limit] MONEY NULL,
    [value_limit] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sebi_backendupload
-- --------------------------------------------------
CREATE TABLE [dbo].[sebi_backendupload]
(
    [Sr No] FLOAT NULL,
    [Name] NVARCHAR(255) NULL,
    [Address] NVARCHAR(255) NULL,
    [Pan No] NVARCHAR(255) NULL,
    [Date Of SEBI Order] NVARCHAR(255) NULL,
    [Order No] NVARCHAR(255) NULL,
    [Brief Particulars] NVARCHAR(MAX) NULL,
    [Start Date] NVARCHAR(255) NULL,
    [End Date] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.SEBI_banned
-- --------------------------------------------------
CREATE TABLE [dbo].[SEBI_banned]
(
    [Sr] INT NULL,
    [Name] VARCHAR(800) NULL,
    [Address] NVARCHAR(255) NULL,
    [Pan_no] NVARCHAR(255) NULL,
    [Dt_SEBI_Order] DATETIME NULL,
    [Order_NO] VARCHAR(MAX) NULL,
    [Brief_particulars] NTEXT NULL,
    [Start_Date] SMALLDATETIME NULL,
    [End_date] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sebi_banned_upd_date
-- --------------------------------------------------
CREATE TABLE [dbo].[sebi_banned_upd_date]
(
    [updated_on] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.sebi_temp_banned_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[sebi_temp_banned_RENAMEDAS_PII]
(
    [Sr] INT NULL,
    [Name] NVARCHAR(255) NULL,
    [Address] NVARCHAR(255) NULL,
    [Pan_no] NVARCHAR(255) NULL,
    [Dt_SEBI_Order] DATETIME NOT NULL,
    [Order_NO] VARCHAR(MAX) NULL,
    [Brief_particulars] NTEXT NULL,
    [Start_Date] DATETIME NULL,
    [End_date] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.security
-- --------------------------------------------------
CREATE TABLE [dbo].[security]
(
    [one] VARCHAR(20) NULL,
    [scrip_code] VARCHAR(50) NULL,
    [cagegory] VARCHAR(5) NULL,
    [four] VARCHAR(20) NULL,
    [company] VARCHAR(50) NULL,
    [upload_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.security_prev
-- --------------------------------------------------
CREATE TABLE [dbo].[security_prev]
(
    [one] VARCHAR(20) NULL,
    [scrip_code] VARCHAR(50) NULL,
    [cagegory] VARCHAR(5) NULL,
    [four] VARCHAR(20) NULL,
    [company] VARCHAR(50) NULL,
    [upload_date] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sheet1$
-- --------------------------------------------------
CREATE TABLE [dbo].[Sheet1$]
(
    [User ID] FLOAT NULL,
    [ID name] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sheet2$
-- --------------------------------------------------
CREATE TABLE [dbo].[Sheet2$]
(
    [SrNo] FLOAT NULL,
    [SiteCode] NVARCHAR(255) NULL,
    [Relations] NVARCHAR(255) NULL,
    [Site] NVARCHAR(255) NULL,
    [Address] NVARCHAR(255) NULL,
    [PhNo] NVARCHAR(255) NULL,
    [ContactPerson] NVARCHAR(255) NULL,
    [IPaddress] NVARCHAR(255) NULL,
    [F9] NVARCHAR(255) NULL,
    [F10] NVARCHAR(255) NULL,
    [LoginID] NVARCHAR(255) NULL,
    [F12] NVARCHAR(255) NULL,
    [F13] NVARCHAR(255) NULL,
    [F14] NVARCHAR(255) NULL,
    [F15] NVARCHAR(255) NULL,
    [F16] NVARCHAR(255) NULL,
    [F17] NVARCHAR(255) NULL,
    [F18] NVARCHAR(255) NULL,
    [F19] NVARCHAR(255) NULL,
    [F20] NVARCHAR(255) NULL,
    [F21] NVARCHAR(255) NULL,
    [F22] NVARCHAR(255) NULL,
    [F23] NVARCHAR(255) NULL,
    [F24] NVARCHAR(255) NULL,
    [F25] NVARCHAR(255) NULL,
    [F26] NVARCHAR(255) NULL,
    [F27] NVARCHAR(255) NULL,
    [F28] NVARCHAR(255) NULL,
    [F29] NVARCHAR(255) NULL,
    [F30] NVARCHAR(255) NULL,
    [F31] NVARCHAR(255) NULL,
    [F32] NVARCHAR(255) NULL,
    [F33] NVARCHAR(255) NULL,
    [F34] NVARCHAR(255) NULL,
    [F35] NVARCHAR(255) NULL,
    [F36] NVARCHAR(255) NULL,
    [F37] NVARCHAR(255) NULL,
    [F38] NVARCHAR(255) NULL,
    [F39] NVARCHAR(255) NULL,
    [F40] NVARCHAR(255) NULL,
    [F41] NVARCHAR(255) NULL,
    [F42] NVARCHAR(255) NULL,
    [F43] NVARCHAR(255) NULL,
    [F44] NVARCHAR(255) NULL,
    [F45] NVARCHAR(255) NULL,
    [F46] NVARCHAR(255) NULL,
    [F47] NVARCHAR(255) NULL,
    [F48] NVARCHAR(255) NULL,
    [F49] NVARCHAR(255) NULL,
    [F50] NVARCHAR(255) NULL,
    [F51] NVARCHAR(255) NULL,
    [F52] NVARCHAR(255) NULL,
    [F53] NVARCHAR(255) NULL,
    [F54] NVARCHAR(255) NULL,
    [F55] NVARCHAR(255) NULL,
    [F56] NVARCHAR(255) NULL,
    [F57] NVARCHAR(255) NULL,
    [F58] NVARCHAR(255) NULL,
    [F59] NVARCHAR(255) NULL,
    [F60] NVARCHAR(255) NULL,
    [F61] NVARCHAR(255) NULL,
    [F62] NVARCHAR(255) NULL,
    [F63] NVARCHAR(255) NULL,
    [F64] NVARCHAR(255) NULL,
    [F65] NVARCHAR(255) NULL,
    [F66] NVARCHAR(255) NULL,
    [F67] NVARCHAR(255) NULL,
    [F68] NVARCHAR(255) NULL,
    [F69] NVARCHAR(255) NULL,
    [F70] NVARCHAR(255) NULL,
    [F71] NVARCHAR(255) NULL,
    [F72] NVARCHAR(255) NULL,
    [F73] NVARCHAR(255) NULL,
    [F74] NVARCHAR(255) NULL,
    [F75] NVARCHAR(255) NULL,
    [F76] NVARCHAR(255) NULL,
    [F77] NVARCHAR(255) NULL,
    [F78] NVARCHAR(255) NULL,
    [F79] NVARCHAR(255) NULL,
    [F80] NVARCHAR(255) NULL,
    [F81] NVARCHAR(255) NULL,
    [F82] NVARCHAR(255) NULL,
    [F83] NVARCHAR(255) NULL,
    [F84] NVARCHAR(255) NULL,
    [F85] NVARCHAR(255) NULL,
    [F86] NVARCHAR(255) NULL,
    [F87] NVARCHAR(255) NULL,
    [F88] NVARCHAR(255) NULL,
    [F89] NVARCHAR(255) NULL,
    [F90] NVARCHAR(255) NULL,
    [F91] NVARCHAR(255) NULL,
    [F92] NVARCHAR(255) NULL,
    [F93] NVARCHAR(255) NULL,
    [F94] NVARCHAR(255) NULL,
    [F95] NVARCHAR(255) NULL,
    [F96] NVARCHAR(255) NULL,
    [F97] NVARCHAR(255) NULL,
    [F98] NVARCHAR(255) NULL,
    [F99] NVARCHAR(255) NULL,
    [F100] NVARCHAR(255) NULL,
    [F101] NVARCHAR(255) NULL,
    [F102] NVARCHAR(255) NULL,
    [F103] NVARCHAR(255) NULL,
    [F104] NVARCHAR(255) NULL,
    [F105] NVARCHAR(255) NULL,
    [F106] NVARCHAR(255) NULL,
    [F107] NVARCHAR(255) NULL,
    [F108] NVARCHAR(255) NULL,
    [F109] NVARCHAR(255) NULL,
    [F110] NVARCHAR(255) NULL,
    [F111] NVARCHAR(255) NULL,
    [F112] NVARCHAR(255) NULL,
    [F113] NVARCHAR(255) NULL,
    [F114] NVARCHAR(255) NULL,
    [F115] NVARCHAR(255) NULL,
    [F116] NVARCHAR(255) NULL,
    [F117] NVARCHAR(255) NULL,
    [F118] NVARCHAR(255) NULL,
    [F119] NVARCHAR(255) NULL,
    [F120] NVARCHAR(255) NULL,
    [F121] NVARCHAR(255) NULL,
    [F122] NVARCHAR(255) NULL,
    [F123] NVARCHAR(255) NULL,
    [F124] NVARCHAR(255) NULL,
    [F125] NVARCHAR(255) NULL,
    [F126] NVARCHAR(255) NULL,
    [F127] NVARCHAR(255) NULL,
    [F128] NVARCHAR(255) NULL,
    [F129] NVARCHAR(255) NULL,
    [F130] NVARCHAR(255) NULL,
    [F131] NVARCHAR(255) NULL,
    [F132] NVARCHAR(255) NULL,
    [F133] NVARCHAR(255) NULL,
    [F134] NVARCHAR(255) NULL,
    [F135] NVARCHAR(255) NULL,
    [F136] NVARCHAR(255) NULL,
    [F137] NVARCHAR(255) NULL,
    [F138] NVARCHAR(255) NULL,
    [F139] NVARCHAR(255) NULL,
    [F140] NVARCHAR(255) NULL,
    [F141] NVARCHAR(255) NULL,
    [F142] NVARCHAR(255) NULL,
    [F143] NVARCHAR(255) NULL,
    [F144] NVARCHAR(255) NULL,
    [F145] NVARCHAR(255) NULL,
    [F146] NVARCHAR(255) NULL,
    [F147] NVARCHAR(255) NULL,
    [F148] NVARCHAR(255) NULL,
    [F149] NVARCHAR(255) NULL,
    [F150] NVARCHAR(255) NULL,
    [F151] NVARCHAR(255) NULL,
    [F152] NVARCHAR(255) NULL,
    [F153] NVARCHAR(255) NULL,
    [F154] NVARCHAR(255) NULL,
    [F155] NVARCHAR(255) NULL,
    [F156] NVARCHAR(255) NULL,
    [F157] NVARCHAR(255) NULL,
    [F158] NVARCHAR(255) NULL,
    [F159] NVARCHAR(255) NULL,
    [F160] NVARCHAR(255) NULL,
    [F161] NVARCHAR(255) NULL,
    [F162] NVARCHAR(255) NULL,
    [F163] NVARCHAR(255) NULL,
    [F164] NVARCHAR(255) NULL,
    [F165] NVARCHAR(255) NULL,
    [F166] NVARCHAR(255) NULL,
    [F167] NVARCHAR(255) NULL,
    [F168] NVARCHAR(255) NULL,
    [F169] NVARCHAR(255) NULL,
    [F170] NVARCHAR(255) NULL,
    [F171] NVARCHAR(255) NULL,
    [F172] NVARCHAR(255) NULL,
    [F173] NVARCHAR(255) NULL,
    [F174] NVARCHAR(255) NULL,
    [F175] NVARCHAR(255) NULL,
    [F176] NVARCHAR(255) NULL,
    [F177] NVARCHAR(255) NULL,
    [F178] NVARCHAR(255) NULL,
    [F179] NVARCHAR(255) NULL,
    [F180] NVARCHAR(255) NULL,
    [F181] NVARCHAR(255) NULL,
    [F182] NVARCHAR(255) NULL,
    [F183] NVARCHAR(255) NULL,
    [F184] NVARCHAR(255) NULL,
    [F185] NVARCHAR(255) NULL,
    [F186] NVARCHAR(255) NULL,
    [F187] NVARCHAR(255) NULL,
    [F188] NVARCHAR(255) NULL,
    [F189] NVARCHAR(255) NULL,
    [F190] NVARCHAR(255) NULL,
    [F191] NVARCHAR(255) NULL,
    [F192] NVARCHAR(255) NULL,
    [F193] NVARCHAR(255) NULL,
    [F194] NVARCHAR(255) NULL,
    [F195] NVARCHAR(255) NULL,
    [F196] NVARCHAR(255) NULL,
    [F197] NVARCHAR(255) NULL,
    [F198] NVARCHAR(255) NULL,
    [F199] NVARCHAR(255) NULL,
    [F200] NVARCHAR(255) NULL,
    [F201] NVARCHAR(255) NULL,
    [F202] NVARCHAR(255) NULL,
    [F203] NVARCHAR(255) NULL,
    [F204] NVARCHAR(255) NULL,
    [F205] NVARCHAR(255) NULL,
    [F206] NVARCHAR(255) NULL,
    [F207] NVARCHAR(255) NULL,
    [F208] NVARCHAR(255) NULL,
    [F209] NVARCHAR(255) NULL,
    [F210] NVARCHAR(255) NULL,
    [F211] NVARCHAR(255) NULL,
    [F212] NVARCHAR(255) NULL,
    [F213] NVARCHAR(255) NULL,
    [F214] NVARCHAR(255) NULL,
    [F215] NVARCHAR(255) NULL,
    [F216] NVARCHAR(255) NULL,
    [F217] NVARCHAR(255) NULL,
    [F218] NVARCHAR(255) NULL,
    [F219] NVARCHAR(255) NULL,
    [F220] NVARCHAR(255) NULL,
    [F221] NVARCHAR(255) NULL,
    [F222] NVARCHAR(255) NULL,
    [F223] NVARCHAR(255) NULL,
    [F224] NVARCHAR(255) NULL,
    [F225] NVARCHAR(255) NULL,
    [F226] NVARCHAR(255) NULL,
    [F227] NVARCHAR(255) NULL,
    [F228] NVARCHAR(255) NULL,
    [F229] NVARCHAR(255) NULL,
    [F230] NVARCHAR(255) NULL,
    [F231] NVARCHAR(255) NULL,
    [F232] NVARCHAR(255) NULL,
    [F233] NVARCHAR(255) NULL,
    [F234] NVARCHAR(255) NULL,
    [F235] NVARCHAR(255) NULL,
    [F236] NVARCHAR(255) NULL,
    [F237] NVARCHAR(255) NULL,
    [F238] NVARCHAR(255) NULL,
    [F239] NVARCHAR(255) NULL,
    [F240] NVARCHAR(255) NULL,
    [F241] NVARCHAR(255) NULL,
    [F242] NVARCHAR(255) NULL,
    [F243] NVARCHAR(255) NULL,
    [F244] NVARCHAR(255) NULL,
    [F245] NVARCHAR(255) NULL,
    [F246] NVARCHAR(255) NULL,
    [F247] NVARCHAR(255) NULL,
    [F248] NVARCHAR(255) NULL,
    [F249] NVARCHAR(255) NULL,
    [F250] NVARCHAR(255) NULL,
    [F251] NVARCHAR(255) NULL,
    [F252] NVARCHAR(255) NULL,
    [F253] NVARCHAR(255) NULL,
    [F254] NVARCHAR(255) NULL,
    [F255] NVARCHAR(255) NULL,
    [F256] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Sheet3$
-- --------------------------------------------------
CREATE TABLE [dbo].[Sheet3$]
(
    [F1] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Shift
-- --------------------------------------------------
CREATE TABLE [dbo].[Shift]
(
    [OLD_KYC_CODE] VARCHAR(10) NOT NULL,
    [BRANCH] VARCHAR(10) NOT NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [NEW_KYC_CODE] VARCHAR(10) NOT NULL,
    [EntryDate] DATETIME NULL DEFAULT (getdate()),
    [newcode] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.shift_march25
-- --------------------------------------------------
CREATE TABLE [dbo].[shift_march25]
(
    [OLD_KYC_CODE] VARCHAR(10) NOT NULL,
    [BRANCH] VARCHAR(10) NOT NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [NEW_KYC_CODE] VARCHAR(10) NOT NULL,
    [EntryDate] DATETIME NULL,
    [newcode] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Shift1
-- --------------------------------------------------
CREATE TABLE [dbo].[Shift1]
(
    [OLD_KYC_CODE] VARCHAR(10) NOT NULL,
    [BRANCH] VARCHAR(10) NOT NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [NEW_KYC_CODE] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.student_mvc
-- --------------------------------------------------
CREATE TABLE [dbo].[student_mvc]
(
    [Name] VARCHAR(50) NULL,
    [Address] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.t_ctcl_vsat
-- --------------------------------------------------
CREATE TABLE [dbo].[t_ctcl_vsat]
(
    [vsat_name] VARCHAR(15) NULL,
    [IP] VARCHAR(15) NULL,
    [Active] VARCHAR(1) NULL,
    [Branch_code] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tab1
-- --------------------------------------------------
CREATE TABLE [dbo].[tab1]
(
    [party_code] VARCHAR(20) NULL,
    [brok] MONEY NULL,
    [mindate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tab2
-- --------------------------------------------------
CREATE TABLE [dbo].[tab2]
(
    [party_code] VARCHAR(20) NULL,
    [sm] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tablestatus
-- --------------------------------------------------
CREATE TABLE [dbo].[tablestatus]
(
    [tablename] VARCHAR(100) NULL,
    [NoOfRecords] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tb_FeedBack_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[tb_FeedBack_RENAMEDAS_PII]
(
    [Cl_Name] VARCHAR(200) NOT NULL,
    [Cl_Code] VARCHAR(20) NOT NULL,
    [Contact_no] VARCHAR(100) NOT NULL,
    [Email] VARCHAR(100) NOT NULL,
    [Feedback] VARCHAR(1000) NOT NULL,
    [F_Date] DATETIME NOT NULL,
    [Dummy1] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Access_denied
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Access_denied]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [userid] VARCHAR(50) NULL,
    [ModID] INT NULL,
    [Access_to] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_AccessControl
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_AccessControl]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Utype] VARCHAR(15) NULL,
    [ModID] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2B_MTD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2B_MTD]
(
    [Category] VARCHAR(20) NULL,
    [Target] VARCHAR(20) NULL,
    [Achieved] VARCHAR(20) NULL,
    [Pending] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2B_trlBMAction
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2B_trlBMAction]
(
    [ActionId] INT IDENTITY(1,1) NOT NULL,
    [EntryId] INT NULL,
    [BID] INT NULL,
    [IsArchive] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2B_trlTransaction
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2B_trlTransaction]
(
    [EntryId] INT IDENTITY(1,1) NOT NULL,
    [TrnID] INT NULL,
    [PID] INT NULL,
    [RID] INT NULL,
    [IsArchive] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2B_YTD
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2B_YTD]
(
    [Category] VARCHAR(20) NULL,
    [Target] VARCHAR(20) NULL,
    [Achieved] VARCHAR(20) NULL,
    [Pending] VARCHAR(20) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BBranchManager
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BBranchManager]
(
    [BId] INT IDENTITY(1,1) NOT NULL,
    [BCode] VARCHAR(50) NULL,
    [BMName] VARCHAR(200) NULL,
    [BMContact] VARCHAR(50) NULL,
    [Email] VARCHAR(500) NULL,
    [IsDelete] INT NULL,
    [Region] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BBranchManager_temp
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BBranchManager_temp]
(
    [BCode] VARCHAR(50) NULL,
    [BMName] VARCHAR(200) NULL,
    [BMContact] VARCHAR(50) NULL,
    [Email] VARCHAR(500) NULL,
    [IsDelete] INT NULL,
    [Region] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_B2BEVENTASSESSMENT
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_B2BEVENTASSESSMENT]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PURPOSEID] INT NULL,
    [BMID] VARCHAR(20) NULL,
    [SBID] VARCHAR(20) NULL,
    [ISNEWCLIENT] BIT NULL,
    [SEGMENTIMPROVEMENT] VARCHAR(100) NULL,
    [ISSBACQUISITION] BIT NULL,
    [DATE] VARCHAR(25) NULL,
    [TIME] VARCHAR(25) NULL,
    [VENUE] VARCHAR(50) NULL,
    [ISEVENTEXPERIENCE] BIT NULL,
    [EVENTORGANIZEDDATE] VARCHAR(50) NULL,
    [PURPOSEOFEVENT] VARCHAR(300) NULL,
    [PARTICIPANTSSIZE] VARCHAR(30) NULL,
    [LEADSGENERATED] VARCHAR(50) NULL,
    [SBCONVERTED] VARCHAR(50) NULL,
    [ANTICIPATEDPARTICIPANTS] VARCHAR(50) NULL,
    [PROSPECTIVELEADSFORINVITATION] VARCHAR(50) NULL,
    [KYCEXPECTED] VARCHAR(50) NULL,
    [AVERAGEMARGINPERKYC] VARCHAR(50) NULL,
    [CLIENTSOPENINGNEWSEGMENTS] VARCHAR(50) NULL,
    [SBEXPECTED] VARCHAR(50) NULL,
    [AVERAGEDEPOSITPERSB] VARCHAR(50) NULL,
    [SUGGESTION] VARCHAR(300) NULL,
    [ISMUTUALFUND] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BExPectedOutMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BExPectedOutMaster]
(
    [EID] INT NOT NULL,
    [ExpectedOut] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_B2BHIRING
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_B2BHIRING]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PURPOSEID] INT NULL,
    [BMID] VARCHAR(20) NULL,
    [SBID] VARCHAR(20) NULL,
    [NAME] VARCHAR(20) NULL,
    [BUSINESSPARTNERTAG] VARCHAR(20) NULL,
    [ADDRESS] VARCHAR(500) NULL,
    [CONTACTPERSON] VARCHAR(50) NULL,
    [CONTACTEMAILID] VARCHAR(50) NULL,
    [DESIGNATION] VARCHAR(50) NULL,
    [SALARYMIN] VARCHAR(50) NULL,
    [SALARYMAX] VARCHAR(50) NULL,
    [EDUQUALIFICATION] VARCHAR(50) NULL,
    [EXPERIENCEYEAR] VARCHAR(50) NULL,
    [EXPERIENCEMONTHS] VARCHAR(50) NULL,
    [RESOURCES] VARCHAR(300) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BLoginDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BLoginDetails]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [UserId] VARCHAR(100) NULL,
    [LastLogin] DATETIME NULL,
    [Location] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BMActionMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BMActionMaster]
(
    [BID] INT NOT NULL,
    [BMAction] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BMActionMaster_
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BMActionMaster_]
(
    [BID] INT IDENTITY(1,1) NOT NULL,
    [RID] INT NULL,
    [PID] INT NULL,
    [BMAction] VARCHAR(50) NULL,
    [IsForm] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BMailMatrix
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BMailMatrix]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PID] INT NULL,
    [Region] VARCHAR(50) NULL,
    [ResponsibleID1] VARCHAR(50) NULL,
    [ResponsibleID2] VARCHAR(50) NULL,
    [EscalationId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BMailMatrix_text
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BMailMatrix_text]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PID] INT NULL,
    [Region] VARCHAR(50) NULL,
    [ResponsibleID1] VARCHAR(50) NULL,
    [ResponsibleID2] VARCHAR(50) NULL,
    [EscalationId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_B2BMAINTRANSACTION
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_B2BMAINTRANSACTION]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [BMUSERID] VARCHAR(50) NULL,
    [COMPLIANCE] BIT NULL,
    [MEETINGSTATUS] BIT NULL,
    [SBTAG] VARCHAR(50) NULL,
    [VISITDATE] VARCHAR(50) NULL,
    [REMARK] VARCHAR(500) NULL,
    [LASTMEETING] VARCHAR(50) NULL,
    [SESSIONID] VARCHAR(100) NULL,
    [ISARCHIVE] INT NULL,
    [IsMail] INT NULL DEFAULT ((0))
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BMapping
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BMapping]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [BID] VARCHAR(50) NULL,
    [SBCode] VARCHAR(50) NULL,
    [IsDelete] INT NULL,
    [Region] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BMicrosite
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BMicrosite]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [BMID] VARCHAR(50) NULL,
    [SBID] VARCHAR(50) NULL,
    [PURPOSEID] INT NULL,
    [QUESTIONS] VARCHAR(MAX) NULL,
    [BUSINESSOFFERING] VARCHAR(500) NULL,
    [SBTAG] VARCHAR(50) NULL,
    [FIRMESTABLISHEDYEAR] VARCHAR(50) NULL,
    [WEBSITENAME] VARCHAR(500) NULL,
    [LEAFLET] VARCHAR(500) NULL,
    [WHYUSOTHER] VARCHAR(500) NULL,
    [NAME] VARCHAR(200) NULL,
    [COMPANY] VARCHAR(200) NULL,
    [ADDRESS] VARCHAR(500) NULL,
    [ADDRESS2] VARCHAR(500) NULL,
    [CITY] VARCHAR(50) NULL,
    [STATE] VARCHAR(50) NULL,
    [POSTALCODE] VARCHAR(50) NULL,
    [EMAILID] VARCHAR(50) NULL,
    [PHONE] VARCHAR(50) NULL,
    [FACEBOOKLINK] VARCHAR(50) NULL,
    [TWITTERLINK] VARCHAR(50) NULL,
    [THEME] VARCHAR(50) NULL,
    [COMPANYLOGO] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_B2BMKTCOLLATERAL
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_B2BMKTCOLLATERAL]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PURPOSEID] INT NULL,
    [BMID] VARCHAR(20) NULL,
    [SBID] VARCHAR(20) NULL,
    [ZONE] VARCHAR(50) NULL,
    [REGION] VARCHAR(50) NULL,
    [BRANCHTAG] VARCHAR(50) NULL,
    [BUSINESSPARTNERTAG] VARCHAR(50) NULL,
    [PARTNERNAME] VARCHAR(200) NULL,
    [MATERIALTYPE] VARCHAR(200) NULL,
    [MATERIALSIZE] VARCHAR(50) NULL,
    [DISPATCHLOCATION] VARCHAR(500) NULL,
    [CONTACTPERSONNAME] VARCHAR(200) NULL,
    [PARTNERADDRESS] VARCHAR(500) NULL,
    [CITY] VARCHAR(50) NULL,
    [STATE] VARCHAR(50) NULL,
    [CONTACTNUMBER] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BPrinting
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BPrinting]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ActionId] INT NULL,
    [PartnerTag] VARCHAR(50) NULL,
    [PartnerName] VARCHAR(200) NULL,
    [LandLineNum] VARCHAR(50) NULL,
    [MobNum] VARCHAR(50) NULL,
    [EmailId] VARCHAR(50) NULL,
    [Address] VARCHAR(500) NULL,
    [Leaflet] VARCHAR(50) NULL,
    [Perticulars] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BPurposeMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BPurposeMaster]
(
    [PID] INT NOT NULL,
    [Purpose] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BPurposeMaster_
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BPurposeMaster_]
(
    [PID] INT IDENTITY(1,1) NOT NULL,
    [Purpose] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_B2BPURPOSETRANSACTION
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_B2BPURPOSETRANSACTION]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [MEETINGID] INT NULL,
    [PURPOSE] VARCHAR(50) NULL,
    [REQUIREMENT] VARCHAR(50) NULL,
    [BMACTION] VARCHAR(50) NULL,
    [EXPECTEDOUTCOME] VARCHAR(50) NULL,
    [PARAMETER] VARCHAR(50) NULL,
    [TARGETDATE] VARCHAR(50) NULL,
    [BMSTATUS] INT NULL DEFAULT ((0))
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BReqMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BReqMaster]
(
    [RID] INT NOT NULL,
    [Requirement] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_B2BReqMaster_
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_B2BReqMaster_]
(
    [RID] INT IDENTITY(1,1) NOT NULL,
    [PID] INT NULL,
    [Requirement] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_B2BVCARD_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_B2BVCARD_RENAMEDAS_PII]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PURPOSEID] INT NULL,
    [BMID] VARCHAR(20) NULL,
    [SBID] VARCHAR(20) NULL,
    [SRNUM] VARCHAR(50) NULL,
    [PARTNARNAME] VARCHAR(200) NULL,
    [PARTNERTAG] VARCHAR(50) NULL,
    [DESIGNATION] VARCHAR(50) NULL,
    [DEPARTMENT] VARCHAR(50) NULL,
    [QTY] VARCHAR(50) NULL,
    [LINEOFBUSINESS] VARCHAR(500) NULL,
    [FIRSTNAME] VARCHAR(100) NULL,
    [BRANCHTAG] VARCHAR(50) NULL,
    [ADDRESS] VARCHAR(500) NULL,
    [PINCODE] VARCHAR(50) NULL,
    [LANDLINENUM] VARCHAR(50) NULL,
    [EXTNUM] VARCHAR(50) NULL,
    [FAXNUM] VARCHAR(50) NULL,
    [MOBILENUM] VARCHAR(50) NULL,
    [EMAIL] VARCHAR(50) NULL,
    [REQUESTEDBY] VARCHAR(50) NULL,
    [APPROVEDBY] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_benchmark_cal
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_benchmark_cal]
(
    [curr_date] VARCHAR(15) NULL,
    [proc_from_date] VARCHAR(21) NULL,
    [proc_to_date] VARCHAR(21) NULL,
    [department] VARCHAR(30) NULL,
    [branch_cd] VARCHAR(30) NULL,
    [FTE_Req] FLOAT NULL,
    [FTE_actual] FLOAT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CKYC_Log
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CKYC_Log]
(
    [SRNO] INT IDENTITY(1,1) NOT NULL,
    [CLSPAN] VARCHAR(100) NULL,
    [Status_PHOTO] INT NULL,
    [Status_Sign] INT NULL,
    [Status_POI] INT NULL,
    [Status_POA] INT NULL,
    [Status_Folder] INT NULL,
    [UpdateDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Ckyc_sign
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Ckyc_sign]
(
    [party_code] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_CKYCErrLog
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_CKYCErrLog]
(
    [RecID] INT IDENTITY(1,1) NOT NULL,
    [FunctionName] VARCHAR(100) NULL,
    [ErrDesc] VARCHAR(50) NULL,
    [ErrCreatedBy] VARCHAR(50) NULL,
    [ErrDatetime] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Connection
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Connection]
(
    [ConnectionId] INT IDENTITY(1,1) NOT NULL,
    [ConnectionString] VARCHAR(300) NULL,
    [DatabaseName] VARCHAR(100) NULL,
    [ServerName] VARCHAR(100) NULL,
    [UID] VARCHAR(100) NULL,
    [PWD] VARCHAR(100) NULL,
    [ConName] VARCHAR(100) NULL,
    [CreatedDate] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(10) NULL,
    [ModifiedDate] VARCHAR(30) NULL DEFAULT (getdate()),
    [ModifiedBy] VARCHAR(10) NULL,
    [ApprovedDate] VARCHAR(30) NULL,
    [ApprovedBy] VARCHAR(10) NULL,
    [Isapproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO186
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO186]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO20
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO20]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO34
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO34]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO44
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO44]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO48
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO48]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO65
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO65]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_CSO66
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_CSO66]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(50) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_dtsprocess
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_dtsprocess]
(
    [process_id] INT IDENTITY(1,1) NOT NULL,
    [dts_id] INT NOT NULL,
    [global_variable_values] VARCHAR(3000) NOT NULL,
    [process_status] CHAR(1) NOT NULL,
    [original_file_name] VARCHAR(500) NULL,
    [amd_user_id] INT NOT NULL,
    [amd_date] DATETIME NOT NULL,
    [amd_session_id] BIGINT NULL,
    [row_version] ROWVERSION NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_ECNMIS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_ECNMIS]
(
    [DATE] VARCHAR(50) NULL,
    [START_TIME] VARCHAR(50) NULL,
    [END_TIME] VARCHAR(50) NULL,
    [QUANTITY] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_EmailMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_EmailMaster]
(
    [Sno] INT IDENTITY(1,1) NOT NULL,
    [Purpose] VARCHAR(50) NULL,
    [EmailTO] VARCHAR(MAX) NULL,
    [EmailCC] VARCHAR(MAX) NULL,
    [EmailBCC] VARCHAR(MAX) NULL,
    [Added_by] VARCHAR(50) NULL,
    [Added_on] VARCHAR(50) NULL,
    [Modified_by] VARCHAR(50) NULL,
    [Modified_on] VARCHAR(50) NULL,
    [Approved_by] VARCHAR(50) NULL,
    [Approved_on] VARCHAR(50) NULL,
    [IsApproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_EmailPurpose
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_EmailPurpose]
(
    [EntryId] INT IDENTITY(1,1) NOT NULL,
    [Purpose] VARCHAR(100) NULL,
    [Isapproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_emp_app
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_emp_app]
(
    [EmpId] INT IDENTITY(1,1) NOT NULL,
    [EmpName] VARCHAR(50) NULL,
    [LevelId] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ErrorCode_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ErrorCode_Master]
(
    [ErrorCode_ID] NVARCHAR(255) NULL,
    [ErrorCode_Name] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Exception_log
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Exception_log]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Source] VARCHAR(30) NULL,
    [Message] VARCHAR(300) NULL,
    [StackTrace] VARCHAR(1000) NULL,
    [UserId] VARCHAR(50) NULL,
    [OccuredOn] DATETIME NULL,
    [Isresolved] BIT NULL,
    [ResolvedBy] VARCHAR(50) NULL,
    [ResolvedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Feedback_Master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Feedback_Master]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [Headers] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_FeedbackMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_FeedbackMaster]
(
    [SrNo] INT IDENTITY(1,1) NOT NULL,
    [Question_Headers] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_FeedbackQuestionMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_FeedbackQuestionMaster]
(
    [QSrNo] INT IDENTITY(1,1) NOT NULL,
    [HeadersID] INT NULL,
    [Questions] VARCHAR(1000) NULL,
    [API] VARCHAR(1000) NULL,
    [DateFlag] INT NULL,
    [flag2] INT NULL,
    [flag3] INT NULL,
    [flag4] INT NULL,
    [flag5] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_FOS_CONTACT_LOG
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_FOS_CONTACT_LOG]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ECODE] VARCHAR(50) NULL,
    [CONTACT_NO] VARCHAR(50) NULL,
    [TEMPLATE] VARCHAR(MAX) NULL,
    [CONTACT_TIME] VARCHAR(50) NULL,
    [MEDIUM] VARCHAR(50) NULL,
    [OUTCOME] VARCHAR(MAX) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_FOS_CONTACTS
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_FOS_CONTACTS]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [ECODE] VARCHAR(50) NULL,
    [FIRST_NAME] VARCHAR(50) NULL,
    [LAST_NAME] VARCHAR(50) NULL,
    [MOBILE1] VARCHAR(50) NULL,
    [MOBILE2] VARCHAR(50) NULL,
    [EMAIL] VARCHAR(50) NULL,
    [EMP_MOBILE1] VARCHAR(50) NULL,
    [EMP_MOBILE2] VARCHAR(50) NULL,
    [EMP_EMAIL] VARCHAR(50) NULL,
    [EMP_ADDR] VARCHAR(50) NULL,
    [senior] VARCHAR(50) NULL,
    [type] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_FOS_EMP_DATA
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_FOS_EMP_DATA]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [FIRST_NAME] VARCHAR(50) NULL,
    [LAST_NAME] VARCHAR(50) NULL,
    [EMAIL] VARCHAR(50) NULL,
    [ECODE] VARCHAR(50) NULL,
    [SENIOR] VARCHAR(50) NULL,
    [TYPE] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_FOS_EXCEPTION_LOG
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_FOS_EXCEPTION_LOG]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Source] VARCHAR(30) NULL,
    [Message] VARCHAR(300) NULL,
    [StackTrace] VARCHAR(1000) NULL,
    [UserId] VARCHAR(50) NULL,
    [OccuredOn] DATETIME NULL,
    [Isresolved] BIT NULL,
    [ResolvedBy] VARCHAR(50) NULL,
    [ResolvedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_FOS_TEMPLATE
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_FOS_TEMPLATE]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [TYPE] VARCHAR(50) NULL,
    [TEXT] VARCHAR(MAX) NULL,
    [HEADER] VARCHAR(MAX) NULL,
    [ADDED_BY] VARCHAR(50) NULL,
    [ADDED_ON] VARCHAR(50) NULL,
    [MODIFIED_ON] VARCHAR(50) NULL,
    [MODIFIED_BY] VARCHAR(50) NULL,
    [ISDELETE] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_GlobalParameter
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_GlobalParameter]
(
    [ParamId] INT IDENTITY(1,1) NOT NULL,
    [Key] VARCHAR(50) NULL,
    [Value] VARCHAR(50) NULL,
    [CreatedDate] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(10) NULL,
    [ModifiedDate] VARCHAR(30) NULL,
    [ModifyBy] VARCHAR(10) NULL,
    [Isapproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_HolidayMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_HolidayMaster]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [HoliDate] VARCHAR(50) NULL,
    [Discription] VARCHAR(200) NULL,
    [FromHr] VARCHAR(10) NULL,
    [FromMin] VARCHAR(10) NULL,
    [ToHr] VARCHAR(10) NULL,
    [ToMin] VARCHAR(10) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [CreatedOn] VARCHAR(50) NULL,
    [ModifyBy] VARCHAR(50) NULL,
    [ModifyOn] VARCHAR(50) NULL,
    [IsDelete] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Inhouse_Exception
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Inhouse_Exception]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Source] VARCHAR(30) NULL,
    [Message] VARCHAR(300) NULL,
    [StackTrace] VARCHAR(1000) NULL,
    [UserId] VARCHAR(50) NULL,
    [OccuredOn] DATETIME NULL,
    [Isresolved] BIT NULL,
    [ResolvedBy] VARCHAR(50) NULL,
    [ResolvedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_LeadDetails_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_LeadDetails_RENAMEDAS_PII]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Emp_Code] VARCHAR(50) NULL,
    [Contact_Number] VARCHAR(50) NULL,
    [LeadName] VARCHAR(100) NULL,
    [IsDelete] INT NULL,
    [EmailID] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_LeadDetails_Upload
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_LeadDetails_Upload]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Emp_Code] VARCHAR(50) NULL,
    [Contact_Number] VARCHAR(50) NULL,
    [LeadName] VARCHAR(100) NULL,
    [IsDelete] INT NULL,
    [EmailID] VARCHAR(50) NULL,
    [City] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_LeadStatus
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_LeadStatus]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Status] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_LeadTransaction
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_LeadTransaction]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [Emp_code] VARCHAR(50) NULL,
    [ContactNo] VARCHAR(50) NULL,
    [LeadName] VARCHAR(50) NULL,
    [Status] INT NULL,
    [LogDate] VARCHAR(25) NULL,
    [Isdelete] INT NULL,
    [ReferenceNo] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_LEAFLET
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_LEAFLET]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [PURPOSEID] INT NULL,
    [BMID] VARCHAR(20) NULL,
    [SBID] VARCHAR(20) NULL,
    [PARTNERTAG] VARCHAR(50) NULL,
    [PARTNARNAME] VARCHAR(200) NULL,
    [LANDLINENUM] VARCHAR(50) NULL,
    [MOBILENUM] VARCHAR(50) NULL,
    [EMAIL] VARCHAR(50) NULL,
    [ADDRESS] VARCHAR(500) NULL,
    [LEAFLET] VARCHAR(500) NULL,
    [PARTICULARS] VARCHAR(500) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Level
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Level]
(
    [LevelId] INT IDENTITY(1,1) NOT NULL,
    [Levels] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MOB_NOTIFICATION
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MOB_NOTIFICATION]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [NOTIFICATIONID] VARCHAR(MAX) NULL,
    [UserId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TBL_MOB_NOTIFICATION_LOG
-- --------------------------------------------------
CREATE TABLE [dbo].[TBL_MOB_NOTIFICATION_LOG]
(
    [Id] INT IDENTITY(1,1) NOT NULL,
    [Notification] VARCHAR(100) NULL,
    [Message] VARCHAR(500) NULL,
    [UserId] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_MobActivityLog
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_MobActivityLog]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [UserID] VARCHAR(50) NULL,
    [ActivityLog] VARCHAR(MAX) NULL,
    [LogDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mobLoginDetails
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mobLoginDetails]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [UserId] VARCHAR(100) NULL,
    [SessionId] VARCHAR(300) NULL,
    [LastLogin] DATETIME NULL,
    [Location] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Mobmodule_master
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Mobmodule_master]
(
    [PID] INT IDENTITY(1,1) NOT NULL,
    [Menu] VARCHAR(50) NULL,
    [Handler] VARCHAR(250) NULL,
    [ParentId] INT NOT NULL,
    [seq_no] INT NULL,
    [active] VARCHAR(1) NULL,
    [menu_desc] VARCHAR(250) NULL,
    [CreatedBy] VARCHAR(20) NULL,
    [CreatedOn] DATETIME NULL,
    [ModifiedBy] VARCHAR(20) NULL,
    [ModifiedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Module_Mapping
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Module_Mapping]
(
    [ModuleId] INT IDENTITY(1,1) NOT NULL,
    [SubModuleId] VARCHAR(50) NULL,
    [ProcedureName] VARCHAR(50) NULL,
    [Prameters] VARCHAR(100) NULL,
    [ConnectionId] INT NULL,
    [CreatedDate] VARCHAR(30) NULL,
    [CreatedBy] VARCHAR(10) NULL,
    [ModifiedDate] VARCHAR(30) NULL,
    [ModifyBy] VARCHAR(10) NULL,
    [ApprovedDate] VARCHAR(30) NULL,
    [ApprovedBy] VARCHAR(10) NULL,
    [Isapproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mst_dtsname
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mst_dtsname]
(
    [dts_id] INT NOT NULL,
    [dts_name] VARCHAR(255) NOT NULL,
    [dts_password] VARCHAR(255) NOT NULL,
    [server_name] VARCHAR(255) NOT NULL,
    [db_user] VARCHAR(255) NOT NULL,
    [db_pwd] VARCHAR(255) NOT NULL,
    [global_variable_count] INT NOT NULL,
    [global_variable_name] VARCHAR(3000) NOT NULL,
    [package_path] VARCHAR(1000) NULL,
    [dts_type] INT NULL,
    [amd_user_id] INT NOT NULL,
    [amd_date] DATETIME NOT NULL,
    [row_version] ROWVERSION NOT NULL,
    [module_id] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_mst_Globalreport
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_mst_Globalreport]
(
    [Rpt_srno] INT IDENTITY(1,1) NOT NULL,
    [Rpt_ServerName] VARCHAR(100) NULL,
    [Rpt_Username] VARCHAR(100) NULL,
    [Rpt_Pswd] VARCHAR(100) NULL,
    [Rpt_DatabaseName] VARCHAR(100) NULL,
    [Rpt_QueryName] VARCHAR(100) NULL,
    [Rpt_Parameter] VARCHAR(MAX) NULL,
    [Rpt_Title] VARCHAR(200) NULL,
    [Rpt_ComputeColNo] VARCHAR(100) NULL,
    [Rpt_Paging] INT NULL,
    [Rpt_WithSrno] INT NULL,
    [FooterNote] VARCHAR(250) NULL,
    [AddedBy] VARCHAR(100) NULL,
    [AddedOn] DATETIME NULL,
    [MachineIP] VARCHAR(100) NULL,
    [ColHide] VARCHAR(25) NULL,
    [RowColor] VARCHAR(25) NULL,
    [TableHead] VARCHAR(8000) NULL,
    [FooterNote1] VARCHAR(1000) NULL,
    [ReportHead] VARCHAR(500) NULL,
    [Rpt_ExportOnly] VARCHAR(1) NULL,
    [ColFreeze] INT NULL,
    [ColBold] INT NULL,
    [TitleFromQuery] VARCHAR(1) NULL,
    [RecordToDisplay] VARCHAR(1000) NULL,
    [Rpt_opt] VARCHAR(9) NULL,
    [helppage] VARCHAR(100) NULL,
    [RptInfo] VARCHAR(100) NULL,
    [ColColour] VARCHAR(20) NULL,
    [Delimiter] VARCHAR(10) NULL,
    [forExcel] BIT NULL,
    [forCSV] BIT NULL,
    [forPDF] BIT NULL,
    [IsApproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_New_Registration_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_New_Registration_RENAMEDAS_PII]
(
    [cl_Name] VARCHAR(200) NOT NULL,
    [cl_LastName] VARCHAR(200) NOT NULL,
    [Address1] VARCHAR(250) NOT NULL,
    [Address2] VARCHAR(250) NOT NULL,
    [Area] VARCHAR(250) NOT NULL,
    [City] VARCHAR(150) NOT NULL,
    [State] VARCHAR(200) NOT NULL,
    [Pincode] VARCHAR(200) NOT NULL,
    [Phone_Resi] VARCHAR(50) NOT NULL,
    [Phone_Off] VARCHAR(50) NOT NULL,
    [Mobile] VARCHAR(50) NOT NULL,
    [Email] VARCHAR(50) NOT NULL,
    [Reg_Date] DATETIME NOT NULL,
    [Dummy1] VARCHAR(50) NOT NULL,
    [dummy2] VARCHAR(50) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OFS_Lock
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OFS_Lock]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [EnteredBy] VARCHAR(10) NULL,
    [EnteredOn] DATETIME NULL,
    [LockStatus] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OFS_ORDER
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OFS_ORDER]
(
    [REQUEST_ID] INT IDENTITY(1,1) NOT NULL,
    [REQUEST_DATE] DATETIME NULL,
    [CLIENT_CODE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [SCRIPCODE] VARCHAR(25) NULL,
    [QUANTITY] INT NULL,
    [BID_RATE] MONEY NULL,
    [MIN_BID_RATE] MONEY NULL,
    [CLIENT_TYPE] VARCHAR(3) NULL,
    [MinMarginPercent] INT NULL,
    [Checkon_NetA_NetL] CHAR(2) NULL,
    [NET_AVAILABLE] MONEY NULL,
    [NET_LEDGER] MONEY NULL,
    [MARGIN_AVAILABLE] MONEY NULL,
    [REMARKS] VARCHAR(500) NULL,
    [GENERATION_FLAG] INT NULL,
    [GEN_STATUS] VARCHAR(100) NULL,
    [BID_NO] VARCHAR(25) NULL,
    [FileName] VARCHAR(25) NULL,
    [Batch_No] VARCHAR(3) NULL,
    [EnteredBy] VARCHAR(10) NULL,
    [EnteredOn] DATETIME NULL,
    [IsDelete] INT NULL,
    [UpdatedBy] VARCHAR(10) NULL,
    [UpdatedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OFS_ORDER_log
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OFS_ORDER_log]
(
    [REQUEST_ID] INT NOT NULL,
    [REQUEST_DATE] DATETIME NULL,
    [CLIENT_CODE] VARCHAR(10) NULL,
    [SEGMENT] VARCHAR(5) NULL,
    [SCRIPCODE] VARCHAR(25) NULL,
    [QUANTITY] INT NULL,
    [BID_RATE] MONEY NULL,
    [MIN_BID_RATE] MONEY NULL,
    [CLIENT_TYPE] VARCHAR(3) NULL,
    [MinMarginPercent] INT NULL,
    [Checkon_NetA_NetL] CHAR(2) NULL,
    [NET_AVAILABLE] MONEY NULL,
    [NET_LEDGER] MONEY NULL,
    [MARGIN_AVAILABLE] MONEY NULL,
    [ENTERED_BY] VARCHAR(10) NULL,
    [REMARKS] VARCHAR(500) NULL,
    [GENERATION_FLAG] INT NULL,
    [GEN_STATUS] VARCHAR(100) NULL,
    [BID_NO] VARCHAR(25) NULL,
    [FileName] VARCHAR(25) NULL,
    [Batch_No] VARCHAR(3) NULL,
    [DBactionOn] DATETIME NULL,
    [DBaction] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OFS_ScripMaster
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OFS_ScripMaster]
(
    [Srno] INT IDENTITY(1,1) NOT NULL,
    [ScripName] VARCHAR(50) NULL,
    [BSECode] VARCHAR(20) NULL,
    [NSESymbol] VARCHAR(20) NULL,
    [ValidForDate] DATE NULL,
    [MinBidRate] MONEY NULL,
    [MaxBidRate] MONEY NULL,
    [PercentAlert] INT NULL,
    [RI_AmtLimit] MONEY NULL,
    [MinMarginPercent] INT NULL,
    [Checkon_NetA_NetL] CHAR(2) NULL,
    [EnteredBy] VARCHAR(10) NULL,
    [EnteredOn] DATETIME NULL,
    [IsDelete] INT NULL,
    [UpdatedBy] VARCHAR(10) NULL,
    [UpdatedOn] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OFS_Temp_Reversal_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OFS_Temp_Reversal_BSE]
(
    [SCRIPCODE] VARCHAR(50) NULL,
    [CLIENT_TYPE] VARCHAR(3) NULL,
    [Blank_1] VARCHAR(5) NULL,
    [Client_Code] VARCHAR(10) NULL,
    [Blank_2] VARCHAR(5) NULL,
    [Qty] VARCHAR(5) NULL,
    [Bid_Rate] VARCHAR(10) NULL,
    [Static_val] VARCHAR(2) NULL,
    [Bid_No] VARCHAR(25) NULL,
    [Static_val1] VARCHAR(2) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_OFS_Temp_Reversal_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_OFS_Temp_Reversal_NSE]
(
    [Symbol] VARCHAR(50) NULL,
    [Bid Qty] VARCHAR(5) NULL,
    [Bid Price] VARCHAR(10) NULL,
    [App No] VARCHAR(25) NULL,
    [NOW Order No] VARCHAR(25) NULL,
    [Exch Order No] VARCHAR(25) NULL,
    [Client Category] VARCHAR(25) NULL,
    [Client Code] VARCHAR(10) NULL,
    [CP Code] VARCHAR(25) NULL,
    [Margin Indicator] VARCHAR(25) NULL,
    [Order Status] VARCHAR(100) NULL,
    [Remarks] VARCHAR(400) NULL,
    [Custodian Status] VARCHAR(25) NULL,
    [Allocated Qty] VARCHAR(25) NULL,
    [Allocated Price] VARCHAR(25) NULL,
    [Entry Time] VARCHAR(30) NULL,
    [Last Update Time] VARCHAR(30) NULL,
    [Maker] VARCHAR(30) NULL,
    [Checker] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_PDALogin
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_PDALogin]
(
    [EntryId] INT IDENTITY(1,1) NOT NULL,
    [UserName] VARCHAR(50) NULL,
    [Password] VARCHAR(100) NULL,
    [CreatedOn] VARCHAR(50) NULL,
    [CreatedBy] VARCHAR(50) NULL,
    [ModifyOn] VARCHAR(50) NULL,
    [ModifyBy] VARCHAR(50) NULL,
    [Isdeleted] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_perfmon
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_perfmon]
(
    [id] INT IDENTITY(1,1) NOT NULL,
    [server_name] VARCHAR(100) NULL,
    [IP_Address] VARCHAR(100) NULL,
    [NoOfCores] VARCHAR(100) NULL,
    [Processor] VARCHAR(100) NULL,
    [CPU_Utilization] VARCHAR(100) NULL,
    [Total_Ram] VARCHAR(100) NULL,
    [Available_Ram] VARCHAR(100) NULL,
    [UsedRAM] VARCHAR(100) NULL,
    [Drives] VARCHAR(100) NULL,
    [FreeSpace] VARCHAR(100) NULL,
    [UsedSpace] VARCHAR(100) NULL,
    [Time] VARCHAR(50) NULL DEFAULT (getdate()),
    [TotalDriveSpace] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_ProfilePic
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_ProfilePic]
(
    [ID] INT IDENTITY(1,1) NOT NULL,
    [EmpId] VARCHAR(20) NULL,
    [URL] VARCHAR(50) NULL,
    [UpdateDate] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_report_SCS
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_report_SCS]
(
    [Rpt_srno] INT IDENTITY(1,1) NOT NULL,
    [Rpt_ServerName] VARCHAR(100) NULL,
    [Rpt_Username] VARCHAR(100) NULL,
    [Rpt_Pswd] VARCHAR(100) NULL,
    [Rpt_DatabaseName] VARCHAR(100) NULL,
    [Rpt_QueryName] VARCHAR(100) NULL,
    [Rpt_Parameter] VARCHAR(150) NULL,
    [Rpt_Title] VARCHAR(200) NULL,
    [Rpt_ComputeColNo] VARCHAR(100) NULL,
    [Rpt_Paging] INT NULL,
    [Rpt_WithSrno] INT NULL,
    [FooterNote] VARCHAR(250) NULL,
    [AddedBy] VARCHAR(100) NULL,
    [AddedOn] DATETIME NULL,
    [MachineIP] VARCHAR(100) NULL,
    [ColHide] VARCHAR(25) NULL,
    [RowColor] VARCHAR(25) NULL,
    [TableHead] VARCHAR(8000) NULL,
    [FooterNote1] VARCHAR(1000) NULL,
    [ReportHead] VARCHAR(500) NULL,
    [Rpt_ExportOnly] VARCHAR(1) NULL,
    [ColFreeze] INT NULL,
    [ColBold] INT NULL,
    [TitleFromQuery] VARCHAR(1) NULL,
    [RecordToDisplay] VARCHAR(1000) NULL,
    [Rpt_opt] VARCHAR(9) NULL,
    [helppage] VARCHAR(100) NULL,
    [RptInfo] VARCHAR(100) NULL,
    [ColColour] VARCHAR(20) NULL,
    [Delimiter] VARCHAR(10) NULL,
    [forExcel] BIT NULL,
    [forCSV] BIT NULL,
    [forPDF] BIT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Request
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Request]
(
    [RequestId] INT IDENTITY(1,1) NOT NULL,
    [Request] VARCHAR(200) NULL,
    [RaisedBy] VARCHAR(50) NULL,
    [RaisedDate] DATETIME NULL,
    [LevelId] INT NULL,
    [IsApproved] INT NULL,
    [ApprovedBy] VARCHAR(50) NULL,
    [ApprovedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Request_status
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Request_status]
(
    [RequestId] INT IDENTITY(1,1) NOT NULL,
    [Request] VARCHAR(200) NULL,
    [RaisedBy] VARCHAR(50) NULL,
    [RaisedDate] DATETIME NULL,
    [LevelId] INT NULL,
    [IsApproved] INT NULL,
    [ApprovedBy] VARCHAR(50) NULL,
    [ApprovedDate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_Schedular_data
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_Schedular_data]
(
    [SNo] INT IDENTITY(1,1) NOT NULL,
    [Manager_code] VARCHAR(50) NULL,
    [Update_time] INT NULL,
    [update_status] INT NULL,
    [Added_by] VARCHAR(50) NULL,
    [Added_on] VARCHAR(50) NULL,
    [Modified_by] VARCHAR(50) NULL,
    [Modified_on] VARCHAR(50) NULL,
    [Approved_by] VARCHAR(50) NULL,
    [Approved_on] VARCHAR(50) NULL,
    [IsApproved] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tbl_SSISProcessDtls
-- --------------------------------------------------
CREATE TABLE [dbo].[tbl_SSISProcessDtls]
(
    [process_id] INT NULL,
    [amd_user_id] INT NULL,
    [amd_session_id] BIGINT NULL,
    [start_time] DATETIME NULL,
    [end_time] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_WebinarAngelClientRegistration
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_WebinarAngelClientRegistration]
(
    [Client_code] VARCHAR(50) NOT NULL,
    [Mobile] VARCHAR(50) NOT NULL,
    [RegistrationDate] DATETIME NOT NULL,
    [RegistrationType] VARCHAR(50) NOT NULL,
    [id] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Tbl_WebinarNewClientRegistration_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[Tbl_WebinarNewClientRegistration_RENAMEDAS_PII]
(
    [FirstName] VARCHAR(50) NOT NULL,
    [LastName] VARCHAR(50) NOT NULL,
    [Email] VARCHAR(50) NOT NULL,
    [Mobile] VARCHAR(50) NOT NULL,
    [RegistrationDate] DATE NOT NULL,
    [RegistrationType] VARCHAR(50) NOT NULL,
    [ID] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp
-- --------------------------------------------------
CREATE TABLE [dbo].[temp]
(
    [sLoginId] VARCHAR(10) NULL,
    [nMarketSegmentId] INT NULL,
    [sUserDefinedExchangeName] VARCHAR(20) NULL,
    [nAmount] NUMERIC(18, 2) NULL,
    [nServiceCharge] NUMERIC(18, 2) NULL,
    [sDateTime] DATETIME NULL,
    [nTxnRefNo] VARCHAR(25) NULL,
    [sGroupId] VARCHAR(10) NULL,
    [nProcessFlag] INT NULL,
    [sBankId] VARCHAR(10) NULL,
    [sAgencyId] VARCHAR(20) NULL,
    [sBankRefNo] VARCHAR(20) NULL,
    [sFromAccNo] VARCHAR(16) NULL,
    [sToAccNo] VARCHAR(16) NULL,
    [product] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_aaa
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_aaa]
(
    [SLOGINID] VARCHAR(50) NULL,
    [NMARKETSEGMENTID] INT NOT NULL,
    [EXCHSEG] VARCHAR(10) NOT NULL,
    [S__AMOUNT] MONEY NOT NULL,
    [NSERVICECHARGE] INT NOT NULL,
    [R__RESPONSE_TIME] DATETIME NOT NULL,
    [R__PAYMENT_REFERENCE_NUMBER] VARCHAR(50) NOT NULL,
    [SGROUPID] VARCHAR(10) NULL,
    [NPROCESSFLAG] INT NOT NULL,
    [R__BANK_NAME] VARCHAR(8000) NULL,
    [S__SUBMERCHANT_ID] VARCHAR(50) NOT NULL,
    [R__SUBMERCHANT_TRANSACTION_ID] BIGINT NOT NULL,
    [SFROMACCNO] VARCHAR(1) NOT NULL,
    [STOACCNO] VARCHAR(1) NOT NULL,
    [product] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Temp_Banned
-- --------------------------------------------------
CREATE TABLE [dbo].[Temp_Banned]
(
    [xname] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_BP
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_BP]
(
    [bp_id] VARCHAR(11) NOT NULL,
    [bp_role] CHAR(2) NOT NULL,
    [bp_add1] VARCHAR(36) NULL,
    [bp_add2] VARCHAR(36) NULL,
    [bp_add3] VARCHAR(36) NULL,
    [bp_add4] VARCHAR(36) NULL,
    [bp_pin] CHAR(7) NULL,
    [bp_phone] VARCHAR(24) NULL,
    [bp_fax] VARCHAR(24) NULL,
    [bp_assd_cc_id] CHAR(8) NOT NULL,
    [bp_assd_dp_id] CHAR(8) NULL,
    [bp_assd_cc_cmid] VARCHAR(16) NULL,
    [bp_category] CHAR(2) NULL,
    [bp_name] VARCHAR(135) NULL,
    [bp_stat] CHAR(2) NULL,
    [CTR] INT IDENTITY(1,1) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_CTCL_DTC
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_CTCL_DTC]
(
    [Dealer] VARCHAR(10) NULL,
    [Party_Code] VARCHAR(10) NULL,
    [Location] VARCHAR(10) NULL,
    [Last_updated] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_DPMAPPING
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_DPMAPPING]
(
    [Data] VARCHAR(8000) NULL,
    [server] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Temp_duplicateentry
-- --------------------------------------------------
CREATE TABLE [dbo].[Temp_duplicateentry]
(
    [sLoginId] VARCHAR(10) NULL,
    [nMarketSegmentId] INT NULL,
    [sUserDefinedExchangeName] VARCHAR(20) NULL,
    [nAmount] NUMERIC(18, 2) NULL,
    [nServiceCharge] NUMERIC(18, 2) NULL,
    [sDateTime] DATETIME NULL,
    [nTxnRefNo] VARCHAR(25) NULL,
    [sGroupId] VARCHAR(10) NULL,
    [nProcessFlag] INT NULL,
    [sBankId] VARCHAR(25) NULL,
    [sAgencyId] VARCHAR(20) NULL,
    [sBankRefNo] VARCHAR(20) NULL,
    [sFromAccNo] VARCHAR(16) NULL,
    [sToAccNo] VARCHAR(16) NULL,
    [product] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_fo_to
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_fo_to]
(
    [pcode] VARCHAR(10) NULL,
    [foto] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_itmcx
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_itmcx]
(
    [SrNo] VARCHAR(255) NULL,
    [CM] VARCHAR(255) NULL,
    [TM] VARCHAR(255) NULL,
    [TerminalID] VARCHAR(255) NULL,
    [ModifiedTime] VARCHAR(255) NULL,
    [TradedTime] VARCHAR(255) NULL,
    [Contract] VARCHAR(255) NULL,
    [Expiry] VARCHAR(255) NULL,
    [OrderNo] VARCHAR(255) NULL,
    [TradeNo] VARCHAR(255) NULL,
    [OldClient] VARCHAR(255) NULL,
    [NewClientId] VARCHAR(255) NULL,
    [nBuyOrSell] VARCHAR(255) NULL,
    [nQuantityinLOTS] INT NULL,
    [Price] MONEY NULL,
    [Amount] MONEY NULL,
    [Type] VARCHAR(255) NULL,
    [tdate] DATETIME NULL,
    [OC_MCX] MONEY NULL,
    [OC_NCX] MONEY NULL,
    [NC_MCX] MONEY NULL,
    [NC_NCX] MONEY NULL,
    [OC_CMCX] MONEY NULL,
    [OC_CNCX] MONEY NULL,
    [NC_CMCX] MONEY NULL,
    [NC_CNCX] MONEY NULL,
    [squp] VARCHAR(1) NULL,
    [N_MCX_Imargin] MONEY NULL,
    [N_NCDEX_Imargin] MONEY NULL,
    [BSE_LED] MONEY NULL,
    [NSE_led] MONEY NULL,
    [FO_led] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_itmcx_new
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_itmcx_new]
(
    [srno] INT NULL,
    [tradedtime] DATETIME NULL,
    [newclientid] VARCHAR(10) NULL,
    [NC_Ledger_mcx] MONEY NULL,
    [NC_Ledger_ncdex] MONEY NULL,
    [NC_ledger_bse] MONEY NULL,
    [NC_ledger_nse] MONEY NULL,
    [NC_ledger_fo] MONEY NULL,
    [NC_Coll_mcx] MONEY NULL,
    [NC_Coll_ncdex] MONEY NULL,
    [NC_Coll_bse] MONEY NULL,
    [NC_Coll_nse] MONEY NULL,
    [NC_Coll_fo] MONEY NULL,
    [NC_Margin_mcx] MONEY NULL,
    [NC_Margin_ncdex] MONEY NULL,
    [NC_SBDep_mcx] MONEY NULL,
    [NC_SBDep_ncdex] MONEY NULL,
    [NC_SBDep_bse] MONEY NULL,
    [NC_SBDep_nse] MONEY NULL,
    [NC_SBDep_fo] MONEY NULL,
    [NC_SBCr_mcx] MONEY NULL,
    [NC_SBCr_ncdex] MONEY NULL,
    [NC_SBCr_bse] MONEY NULL,
    [NC_SBCr_nse] MONEY NULL,
    [NC_SBCr_fo] MONEY NULL,
    [nc_margin_fo] MONEY NULL,
    [SB_REG] VARCHAR(5) NULL,
    [SB_Code] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_itncx
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_itncx]
(
    [srno] FLOAT NULL,
    [TradedTime] SMALLDATETIME NULL,
    [TRADED_MBR_ID] FLOAT NULL,
    [MBR_NAME] NVARCHAR(255) NULL,
    [NewClientId] NVARCHAR(255) NULL,
    [OldClient] NVARCHAR(255) NULL,
    [TradeNo] FLOAT NULL,
    [TRADED_CMDTY] NVARCHAR(255) NULL,
    [TRADED_SMBL] NVARCHAR(255) NULL,
    [TRADED_EXP_DT] SMALLDATETIME NULL,
    [TRADED_VLME] INT NULL,
    [TRADED_PRCE] MONEY NULL,
    [Remark] NVARCHAR(255) NULL,
    [buysell] VARCHAR(1) NULL,
    [Tdate] SMALLDATETIME NULL,
    [OC_MCX] MONEY NULL,
    [OC_NCX] MONEY NULL,
    [NC_MCX] MONEY NULL,
    [NC_NCX] MONEY NULL,
    [OC_CMCX] MONEY NULL,
    [OC_CNCX] MONEY NULL,
    [NC_CMCX] MONEY NULL,
    [NC_CNCX] MONEY NULL,
    [squp] VARCHAR(1) NULL,
    [N_MCX_Imargin] MONEY NULL,
    [N_NCDEX_Imargin] MONEY NULL,
    [BSE_LED] MONEY NULL,
    [NSE_led] MONEY NULL,
    [FO_led] MONEY NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_itncx_new
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_itncx_new]
(
    [srno] INT NULL,
    [tradedtime] DATETIME NULL,
    [newclientid] VARCHAR(10) NULL,
    [NC_Ledger_mcx] MONEY NULL,
    [NC_Ledger_ncdex] MONEY NULL,
    [NC_ledger_bse] MONEY NULL,
    [NC_ledger_nse] MONEY NULL,
    [NC_ledger_fo] MONEY NULL,
    [NC_Coll_mcx] MONEY NULL,
    [NC_Coll_ncdex] MONEY NULL,
    [NC_Coll_bse] MONEY NULL,
    [NC_Coll_nse] MONEY NULL,
    [NC_Coll_fo] MONEY NULL,
    [NC_Margin_mcx] MONEY NULL,
    [NC_Margin_ncdex] MONEY NULL,
    [NC_SBDep_mcx] MONEY NULL,
    [NC_SBDep_ncdex] MONEY NULL,
    [NC_SBDep_bse] MONEY NULL,
    [NC_SBDep_nse] MONEY NULL,
    [NC_SBDep_fo] MONEY NULL,
    [NC_SBCr_mcx] MONEY NULL,
    [NC_SBCr_ncdex] MONEY NULL,
    [NC_SBCr_bse] MONEY NULL,
    [NC_SBCr_nse] MONEY NULL,
    [NC_SBCr_fo] MONEY NULL,
    [nc_margin_fo] MONEY NULL,
    [SB_REG] VARCHAR(5) NULL,
    [SB_Code] VARCHAR(5) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_location
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_location]
(
    [location] VARCHAR(50) NULL,
    [last_uploaded] DATETIME NULL,
    [pswd] VARCHAR(25) NULL,
    [username] VARCHAR(25) NULL,
    [category] VARCHAR(10) NULL,
    [locaname] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mcx
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mcx]
(
    [Symbol] VARCHAR(50) NULL,
    [ExpiryDate] VARCHAR(15) NULL,
    [Price] MONEY NULL,
    [Multiplier] BIGINT NULL,
    [I_M] BIGINT NULL,
    [S_B_M] BIGINT NULL,
    [S_S_M] BIGINT NULL,
    [A_M_L] BIGINT NULL,
    [A_M_S] BIGINT NULL,
    [Tender_M] BIGINT NULL,
    [T_M] BIGINT NULL,
    [I_C_V] BIGINT NULL,
    [Margin] BIGINT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mcx_sb
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mcx_sb]
(
    [SrNo] VARCHAR(255) NULL,
    [CM] VARCHAR(255) NULL,
    [TM] VARCHAR(255) NULL,
    [TerminalID] VARCHAR(255) NULL,
    [ModifiedTime] VARCHAR(255) NULL,
    [TradedTime] VARCHAR(255) NULL,
    [Contract] VARCHAR(255) NULL,
    [Expiry] VARCHAR(255) NULL,
    [OrderNo] VARCHAR(255) NULL,
    [TradeNo] VARCHAR(255) NULL,
    [OldClient] VARCHAR(255) NULL,
    [NewClientId] VARCHAR(255) NULL,
    [nBuyOrSell] VARCHAR(255) NULL,
    [nQuantityinLOTS] INT NULL,
    [Price] MONEY NULL,
    [Amount] MONEY NULL,
    [Type] VARCHAR(255) NULL,
    [tdate] DATETIME NULL,
    [OC_MCX] MONEY NULL,
    [OC_NCX] MONEY NULL,
    [NC_MCX] MONEY NULL,
    [NC_NCX] MONEY NULL,
    [OC_CMCX] MONEY NULL,
    [OC_CNCX] MONEY NULL,
    [NC_CMCX] MONEY NULL,
    [NC_CNCX] MONEY NULL,
    [squp] VARCHAR(1) NULL,
    [N_MCX_Imargin] MONEY NULL,
    [N_NCDEX_Imargin] MONEY NULL,
    [BSE_LED] MONEY NULL,
    [NSE_led] MONEY NULL,
    [FO_led] MONEY NULL,
    [new_Sb] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mcx_sbCr
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mcx_sbCr]
(
    [SrNo] VARCHAR(255) NULL,
    [CM] VARCHAR(255) NULL,
    [TM] VARCHAR(255) NULL,
    [TerminalID] VARCHAR(255) NULL,
    [ModifiedTime] VARCHAR(255) NULL,
    [TradedTime] VARCHAR(255) NULL,
    [Contract] VARCHAR(255) NULL,
    [Expiry] VARCHAR(255) NULL,
    [OrderNo] VARCHAR(255) NULL,
    [TradeNo] VARCHAR(255) NULL,
    [OldClient] VARCHAR(255) NULL,
    [NewClientId] VARCHAR(255) NULL,
    [nBuyOrSell] VARCHAR(255) NULL,
    [nQuantityinLOTS] INT NULL,
    [Price] MONEY NULL,
    [Amount] MONEY NULL,
    [Type] VARCHAR(255) NULL,
    [tdate] DATETIME NULL,
    [OC_MCX] MONEY NULL,
    [OC_NCX] MONEY NULL,
    [NC_MCX] MONEY NULL,
    [NC_NCX] MONEY NULL,
    [OC_CMCX] MONEY NULL,
    [OC_CNCX] MONEY NULL,
    [NC_CMCX] MONEY NULL,
    [NC_CNCX] MONEY NULL,
    [squp] VARCHAR(1) NULL,
    [N_MCX_Imargin] MONEY NULL,
    [N_NCDEX_Imargin] MONEY NULL,
    [BSE_LED] MONEY NULL,
    [NSE_led] MONEY NULL,
    [FO_led] MONEY NULL,
    [new_Sb] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mis_file1_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mis_file1_RENAMEDAS_PII]
(
    [sLoginId] VARCHAR(10) NULL,
    [nMarketSegmentId] VARCHAR(20) NULL,
    [sUserDefinedExchangeName] VARCHAR(100) NULL,
    [nAmount] NUMERIC(18, 2) NULL,
    [nServiceCharge] NUMERIC(18, 2) NULL,
    [sDateTime] DATETIME NULL,
    [nTxnRefNo] VARCHAR(25) NULL,
    [sGroupId] VARCHAR(50) NULL,
    [nProcessFlag] INT NULL,
    [sBankId] VARCHAR(50) NULL,
    [sAgencyId] VARCHAR(20) NULL,
    [sBankRefNo] VARCHAR(20) NULL,
    [sFromAccNo] VARCHAR(40) NULL,
    [sToAccNo] VARCHAR(40) NULL,
    [product] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mis_file1a_RENAMEDAS_PII
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mis_file1a_RENAMEDAS_PII]
(
    [sLoginId] VARCHAR(10) NULL,
    [nMarketSegmentId] VARCHAR(20) NULL,
    [sUserDefinedExchangeName] VARCHAR(100) NULL,
    [nAmount] NUMERIC(18, 2) NULL,
    [nServiceCharge] NUMERIC(18, 2) NULL,
    [sDateTime] DATETIME NULL,
    [nTxnRefNo] VARCHAR(50) NULL,
    [sGroupId] VARCHAR(50) NULL,
    [nProcessFlag] INT NULL,
    [sBankId] VARCHAR(50) NULL,
    [sAgencyId] VARCHAR(20) NULL,
    [sBankRefNo] VARCHAR(20) NULL,
    [sFromAccNo] VARCHAR(40) NULL,
    [sToAccNo] VARCHAR(40) NULL,
    [product] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_mis_filexxx
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_mis_filexxx]
(
    [SLOGINID] VARCHAR(50) NULL,
    [NMARKETSEGMENTID] INT NOT NULL,
    [EXCHSEG] VARCHAR(10) NOT NULL,
    [S__AMOUNT] MONEY NOT NULL,
    [NSERVICECHARGE] INT NOT NULL,
    [R__RESPONSE_TIME] DATETIME NOT NULL,
    [R__PAYMENT_REFERENCE_NUMBER] VARCHAR(50) NOT NULL,
    [SGROUPID] VARCHAR(10) NULL,
    [NPROCESSFLAG] INT NOT NULL,
    [R__BANK_NAME] VARCHAR(50) NOT NULL,
    [S__SUBMERCHANT_ID] VARCHAR(50) NOT NULL,
    [R__SUBMERCHANT_TRANSACTION_ID] BIGINT NOT NULL,
    [SFROMACCNO] VARCHAR(1) NOT NULL,
    [STOACCNO] VARCHAR(1) NOT NULL,
    [product] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_ncx_sb_new
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_ncx_sb_new]
(
    [srno] FLOAT NULL,
    [TradedTime] SMALLDATETIME NULL,
    [TRADED_MBR_ID] FLOAT NULL,
    [MBR_NAME] NVARCHAR(255) NULL,
    [NewClientId] NVARCHAR(255) NULL,
    [OldClient] NVARCHAR(255) NULL,
    [TradeNo] FLOAT NULL,
    [TRADED_CMDTY] NVARCHAR(255) NULL,
    [TRADED_SMBL] NVARCHAR(255) NULL,
    [TRADED_EXP_DT] SMALLDATETIME NULL,
    [TRADED_VLME] INT NULL,
    [TRADED_PRCE] MONEY NULL,
    [Remark] NVARCHAR(255) NULL,
    [buysell] VARCHAR(1) NULL,
    [Tdate] SMALLDATETIME NULL,
    [OC_MCX] MONEY NULL,
    [OC_NCX] MONEY NULL,
    [NC_MCX] MONEY NULL,
    [NC_NCX] MONEY NULL,
    [OC_CMCX] MONEY NULL,
    [OC_CNCX] MONEY NULL,
    [NC_CMCX] MONEY NULL,
    [NC_CNCX] MONEY NULL,
    [squp] VARCHAR(1) NULL,
    [N_MCX_Imargin] MONEY NULL,
    [N_NCDEX_Imargin] MONEY NULL,
    [BSE_LED] MONEY NULL,
    [NSE_led] MONEY NULL,
    [FO_led] MONEY NULL,
    [new_Sb] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_ncx_sbCr
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_ncx_sbCr]
(
    [srno] FLOAT NULL,
    [TradedTime] SMALLDATETIME NULL,
    [TRADED_MBR_ID] FLOAT NULL,
    [MBR_NAME] NVARCHAR(255) NULL,
    [NewClientId] NVARCHAR(255) NULL,
    [OldClient] NVARCHAR(255) NULL,
    [TradeNo] FLOAT NULL,
    [TRADED_CMDTY] NVARCHAR(255) NULL,
    [TRADED_SMBL] NVARCHAR(255) NULL,
    [TRADED_EXP_DT] SMALLDATETIME NULL,
    [TRADED_VLME] INT NULL,
    [TRADED_PRCE] MONEY NULL,
    [Remark] NVARCHAR(255) NULL,
    [buysell] VARCHAR(1) NULL,
    [Tdate] SMALLDATETIME NULL,
    [OC_MCX] MONEY NULL,
    [OC_NCX] MONEY NULL,
    [NC_MCX] MONEY NULL,
    [NC_NCX] MONEY NULL,
    [OC_CMCX] MONEY NULL,
    [OC_CNCX] MONEY NULL,
    [NC_CMCX] MONEY NULL,
    [NC_CNCX] MONEY NULL,
    [squp] VARCHAR(1) NULL,
    [N_MCX_Imargin] MONEY NULL,
    [N_NCDEX_Imargin] MONEY NULL,
    [BSE_LED] MONEY NULL,
    [NSE_led] MONEY NULL,
    [FO_led] MONEY NULL,
    [new_Sb] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_onlinepayin
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_onlinepayin]
(
    [sLoginId] VARCHAR(10) NULL,
    [nMarketSegmentId] VARCHAR(10) NULL,
    [sUserDefinedExchangeName] VARCHAR(50) NULL,
    [nAmount] NUMERIC(18, 2) NULL,
    [nServiceCharge] NUMERIC(18, 2) NULL,
    [sDateTime] DATETIME NULL,
    [nTxnRefNo] VARCHAR(13) NULL,
    [sGroupId] VARCHAR(40) NULL,
    [nProcessFlag] INT NULL,
    [sBankId] VARCHAR(10) NULL,
    [sAgencyId] VARCHAR(1) NOT NULL,
    [sBankRefNo] VARCHAR(20) NULL,
    [sFromAccNo] VARCHAR(20) NULL,
    [sToAccNo] VARCHAR(20) NULL,
    [product] VARCHAR(10) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_payin
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_payin]
(
    [srno] INT NOT NULL,
    [Edate] DATETIME NULL,
    [Vdate] DATETIME NULL,
    [Cltcode] VARCHAR(10) NULL,
    [Amount] MONEY NULL,
    [DRCR] VARCHAR(1) NULL,
    [Narration] VARCHAR(50) NULL,
    [BankCode] VARCHAR(25) NULL,
    [BankName] VARCHAR(50) NULL,
    [DDNo] VARCHAR(25) NULL,
    [Branchcode] VARCHAR(10) NULL,
    [BranchName] VARCHAR(50) NULL,
    [chqmode] VARCHAR(50) NULL,
    [chqdate] DATETIME NULL,
    [chqname] VARCHAR(50) NULL,
    [clmode] VARCHAR(10) NULL,
    [entered_on] DATETIME NULL,
    [entered_by] VARCHAR(25) NULL,
    [entered_fromIP] VARCHAR(25) NULL,
    [posted_on] DATETIME NULL,
    [posted_status] VARCHAR(10) NULL,
    [segment] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_pmstrade
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_pmstrade]
(
    [SEBI_NO] VARCHAR(12) NOT NULL,
    [ContractNo] VARCHAR(14) NOT NULL,
    [Exchange] VARCHAR(1) NOT NULL,
    [TradeDate] VARCHAR(11) NULL,
    [segment1] VARCHAR(7) NOT NULL,
    [settlement_number] VARCHAR(3) NULL,
    [settlement_year] VARCHAR(4) NULL,
    [Backofficecode] VARCHAR(10) NULL,
    [bse_code] VARCHAR(10) NOT NULL,
    [nse_symbol] VARCHAR(25) NULL,
    [nse_group] VARCHAR(2) NOT NULL,
    [isin] VARCHAR(20) NULL,
    [scrip_name] VARCHAR(25) NULL,
    [bought_sold] VARCHAR(1) NOT NULL,
    [traded_quantity] INT NULL,
    [marketrate] MONEY NULL,
    [N_netrate] NUMERIC(18, 4) NULL,
    [NserTax] MONEY NULL,
    [Trans_chgs] MONEY NULL,
    [other_chrg] MONEY NULL,
    [stock_payin] VARCHAR(25) NULL,
    [stock_payout] VARCHAR(25) NULL,
    [cash_payin] VARCHAR(25) NULL,
    [cash_payout] VARCHAR(25) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_sebipano
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_sebipano]
(
    [Sr] INT NULL,
    [Name] VARCHAR(800) NULL,
    [Address] NVARCHAR(255) NULL,
    [Pan_no] NVARCHAR(255) NULL,
    [Dt_SEBI_Order] DATETIME NULL,
    [Order_NO] VARCHAR(MAX) NULL,
    [Brief_particulars] NTEXT NULL,
    [Start_Date] SMALLDATETIME NULL,
    [End_date] VARCHAR(500) NULL,
    [status] INT NOT NULL,
    [branch_Cd] VARCHAR(10) NULL,
    [sub_BRoker] VARCHAR(10) NOT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [long_name] VARCHAR(100) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temp_shift
-- --------------------------------------------------
CREATE TABLE [dbo].[temp_shift]
(
    [OLD_KYC_CODE] VARCHAR(10) NOT NULL,
    [BRANCH] VARCHAR(10) NOT NULL,
    [SUB_BROKER] VARCHAR(10) NOT NULL,
    [NEW_KYC_CODE] VARCHAR(10) NOT NULL,
    [EntryDate] DATETIME NULL,
    [newcode] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TempCKYCVal
-- --------------------------------------------------
CREATE TABLE [dbo].[TempCKYCVal]
(
    [TopVal] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempCtclMgrLocation
-- --------------------------------------------------
CREATE TABLE [dbo].[tempCtclMgrLocation]
(
    [LocaCode] VARCHAR(10) NOT NULL,
    [LocaName] VARCHAR(50) NULL,
    [Branch_cd] VARCHAR(10) NULL,
    [SegmentAllowed] VARCHAR(50) NULL,
    [Updated_on] DATETIME NULL,
    [Connectivity_type] VARCHAR(10) NULL,
    [fld_serverid] INT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempDumpSEBIData
-- --------------------------------------------------
CREATE TABLE [dbo].[tempDumpSEBIData]
(
    [text1] VARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempDumpSEBIData1
-- --------------------------------------------------
CREATE TABLE [dbo].[tempDumpSEBIData1]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [text1] VARCHAR(2000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempDumpSEBIdata2
-- --------------------------------------------------
CREATE TABLE [dbo].[tempDumpSEBIdata2]
(
    [SEBIOrder] VARCHAR(1000) NULL,
    [OrderDate] VARCHAR(100) NULL,
    [OrderDetails] VARCHAR(1000) NULL,
    [SectionDetails] VARCHAR(1000) NULL,
    [Entity] VARCHAR(1000) NULL,
    [period] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tempo
-- --------------------------------------------------
CREATE TABLE [dbo].[tempo]
(
    [srno] INT IDENTITY(1,1) NOT NULL,
    [Edate] DATETIME NULL,
    [Vdate] DATETIME NULL,
    [Cltcode] VARCHAR(10) NULL,
    [Amount] MONEY NULL,
    [DRCR] VARCHAR(1) NULL,
    [Narration] VARCHAR(50) NULL,
    [BankCode] VARCHAR(25) NULL,
    [BankName] VARCHAR(50) NULL,
    [DDNo] VARCHAR(25) NULL,
    [Branchcode] VARCHAR(10) NULL,
    [BranchName] VARCHAR(50) NULL,
    [chqmode] VARCHAR(50) NULL,
    [chqdate] DATETIME NULL,
    [chqname] VARCHAR(50) NULL,
    [clmode] VARCHAR(10) NULL,
    [entered_on] DATETIME NULL,
    [entered_by] VARCHAR(25) NULL,
    [entered_fromIP] VARCHAR(25) NULL,
    [posted_on] DATETIME NULL,
    [posted_status] VARCHAR(10) NULL,
    [segment] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.temptable
-- --------------------------------------------------
CREATE TABLE [dbo].[temptable]
(
    [name1] VARCHAR(30) NULL,
    [age] NUMERIC(20, 1) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test
-- --------------------------------------------------
CREATE TABLE [dbo].[test]
(
    [id] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test_table
-- --------------------------------------------------
CREATE TABLE [dbo].[test_table]
(
    [no] VARCHAR(6) NOT NULL,
    [name] VARCHAR(6) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test111
-- --------------------------------------------------
CREATE TABLE [dbo].[test111]
(
    [name] VARCHAR(1000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.test12
-- --------------------------------------------------
CREATE TABLE [dbo].[test12]
(
    [OLD_KYC_CODE] VARCHAR(255) NULL,
    [BRANCH] VARCHAR(255) NULL,
    [SUB_BROKER] VARCHAR(255) NULL,
    [NEW_KYC_CODE] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tmp_overall_mrg
-- --------------------------------------------------
CREATE TABLE [dbo].[tmp_overall_mrg]
(
    [BrokerCode] VARCHAR(10) NULL,
    [Party_code] VARCHAR(10) NULL,
    [PArty_name] VARCHAR(50) NULL,
    [dummy1] VARCHAR(15) NULL,
    [Scrip_cd] VARCHAR(10) NULL,
    [Qty] INT NULL,
    [Funding_amt] MONEY NULL,
    [Funding_date] VARCHAR(10) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TRD_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[TRD_BSE]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TRD_MCX
-- --------------------------------------------------
CREATE TABLE [dbo].[TRD_MCX]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL,
    [T28] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TRD_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[TRD_NCDEX]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TRD_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[TRD_NSE]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TRD_NSEFO
-- --------------------------------------------------
CREATE TABLE [dbo].[TRD_NSEFO]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TROR_BSE
-- --------------------------------------------------
CREATE TABLE [dbo].[TROR_BSE]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tror_mcx
-- --------------------------------------------------
CREATE TABLE [dbo].[tror_mcx]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL,
    [T27] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.trOR_NCDEX
-- --------------------------------------------------
CREATE TABLE [dbo].[trOR_NCDEX]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.TROR_NSE
-- --------------------------------------------------
CREATE TABLE [dbo].[TROR_NSE]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(500) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL,
    [T25] VARCHAR(50) NULL,
    [T26] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.tror_nsefo
-- --------------------------------------------------
CREATE TABLE [dbo].[tror_nsefo]
(
    [T1] VARCHAR(50) NULL,
    [T2] VARCHAR(50) NULL,
    [T3] VARCHAR(50) NULL,
    [T4] VARCHAR(50) NULL,
    [T5] VARCHAR(200) NULL,
    [T6] VARCHAR(50) NULL,
    [T7] VARCHAR(50) NULL,
    [T8] VARCHAR(50) NULL,
    [T9] VARCHAR(50) NULL,
    [T10] VARCHAR(50) NULL,
    [T11] VARCHAR(50) NULL,
    [T12] VARCHAR(50) NULL,
    [T13] VARCHAR(50) NULL,
    [T14] VARCHAR(50) NULL,
    [T15] VARCHAR(50) NULL,
    [T16] VARCHAR(50) NULL,
    [T17] VARCHAR(50) NULL,
    [T18] VARCHAR(50) NULL,
    [T19] VARCHAR(50) NULL,
    [T20] VARCHAR(50) NULL,
    [T21] VARCHAR(50) NULL,
    [T22] VARCHAR(50) NULL,
    [T23] VARCHAR(50) NULL,
    [T24] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.upload_research
-- --------------------------------------------------
CREATE TABLE [dbo].[upload_research]
(
    [company_name] VARCHAR(50) NULL,
    [type_reports] VARCHAR(50) NULL,
    [uploaded_Date] VARCHAR(50) NULL,
    [summary] VARCHAR(5000) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.upload_research_files
-- --------------------------------------------------
CREATE TABLE [dbo].[upload_research_files]
(
    [pid] INT IDENTITY(1,1) NOT NULL,
    [company_name] VARCHAR(50) NULL,
    [type_reports] VARCHAR(50) NULL,
    [uploaded_Date] VARCHAR(50) NULL,
    [summary] VARCHAR(5000) NULL,
    [loaded_date] DATETIME NULL,
    [dummy1] VARCHAR(50) NULL,
    [dummy2] VARCHAR(50) NULL,
    [dummy3] VARCHAR(50) NULL,
    [dummy4] VARCHAR(50) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.UPLOADTEMP
-- --------------------------------------------------
CREATE TABLE [dbo].[UPLOADTEMP]
(
    [symbol] VARCHAR(30) NULL,
    [expdate] DATE NULL,
    [multiplier] VARCHAR(30) NULL,
    [IM] VARCHAR(30) NULL,
    [SBM] VARCHAR(30) NULL,
    [SSM] VARCHAR(30) NULL,
    [AML] VARCHAR(30) NULL,
    [AMS] VARCHAR(30) NULL,
    [TENDERM] VARCHAR(30) NULL,
    [TM] VARCHAR(30) NULL,
    [ICV] VARCHAR(30) NULL,
    [MARGIN] VARCHAR(30) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.userid_details
-- --------------------------------------------------
CREATE TABLE [dbo].[userid_details]
(
    [User ID] FLOAT NULL,
    [ID name] NVARCHAR(255) NULL,
    [Location] NVARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Users
-- --------------------------------------------------
CREATE TABLE [dbo].[Users]
(
    [UserID] INT IDENTITY(1,1) NOT NULL,
    [Name] NVARCHAR(MAX) NOT NULL,
    [Address] NVARCHAR(MAX) NOT NULL,
    [ContactNo] NVARCHAR(MAX) NOT NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vanda_mcx
-- --------------------------------------------------
CREATE TABLE [dbo].[vanda_mcx]
(
    [sauda_date] DATETIME NOT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [symbol] VARCHAR(12) NULL,
    [tradeqty] INT NULL,
    [price] MONEY NULL,
    [brokapplied] MONEY NULL,
    [netrate] NUMERIC(15, 7) NULL,
    [sell_buy] VARCHAR(1) NOT NULL,
    [service_tax] MONEY NULL,
    [turn_tax] MONEY NULL,
    [broker_chrg] MONEY NULL,
    [trade_no] VARCHAR(10) NOT NULL,
    [contractno] VARCHAR(14) NOT NULL,
    [order_no] VARCHAR(15) NOT NULL,
    [expirydate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vanda_ncx
-- --------------------------------------------------
CREATE TABLE [dbo].[vanda_ncx]
(
    [sauda_date] DATETIME NOT NULL,
    [party_code] VARCHAR(10) NOT NULL,
    [symbol] VARCHAR(12) NULL,
    [tradeqty] INT NULL,
    [price] MONEY NULL,
    [brokapplied] MONEY NULL,
    [netrate] NUMERIC(15, 7) NULL,
    [sell_buy] VARCHAR(1) NOT NULL,
    [service_tax] MONEY NULL,
    [turn_tax] MONEY NULL,
    [broker_chrg] MONEY NULL,
    [trade_no] VARCHAR(10) NOT NULL,
    [contractno] VARCHAR(14) NOT NULL,
    [order_no] VARCHAR(15) NOT NULL,
    [expirydate] DATETIME NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ver7.8
-- --------------------------------------------------
CREATE TABLE [dbo].[Ver7.8]
(
    [Col001] VARCHAR(255) NULL,
    [Col002] VARCHAR(255) NULL,
    [Col003] VARCHAR(255) NULL,
    [Col004] VARCHAR(255) NULL,
    [Col005] VARCHAR(255) NULL,
    [Col006] VARCHAR(255) NULL,
    [Col007] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ver7.9S1
-- --------------------------------------------------
CREATE TABLE [dbo].[Ver7.9S1]
(
    [Col001] VARCHAR(255) NULL,
    [Col002] VARCHAR(255) NULL,
    [Col003] VARCHAR(255) NULL,
    [Col004] VARCHAR(255) NULL,
    [Col005] VARCHAR(255) NULL,
    [Col006] VARCHAR(255) NULL,
    [Col007] VARCHAR(255) NULL,
    [Col008] VARCHAR(255) NULL,
    [Col009] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ver7.9S2
-- --------------------------------------------------
CREATE TABLE [dbo].[Ver7.9S2]
(
    [Col001] VARCHAR(255) NULL,
    [Col002] VARCHAR(255) NULL,
    [Col003] VARCHAR(255) NULL,
    [Col004] VARCHAR(255) NULL,
    [Col005] VARCHAR(255) NULL,
    [Col006] VARCHAR(255) NULL,
    [Col007] VARCHAR(255) NULL,
    [Col008] VARCHAR(255) NULL,
    [Col009] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Ver7.9S3
-- --------------------------------------------------
CREATE TABLE [dbo].[Ver7.9S3]
(
    [Col001] VARCHAR(255) NULL,
    [Col002] VARCHAR(255) NULL,
    [Col003] VARCHAR(255) NULL,
    [Col004] VARCHAR(255) NULL,
    [Col005] VARCHAR(255) NULL,
    [Col006] VARCHAR(255) NULL,
    [Col007] VARCHAR(255) NULL,
    [Col008] VARCHAR(255) NULL,
    [Col009] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.Voucher_Entry_Acc_Details
-- --------------------------------------------------
CREATE TABLE [dbo].[Voucher_Entry_Acc_Details]
(
    [SrNo] BIGINT IDENTITY(1,1) NOT NULL,
    [Segment] NVARCHAR(50) NOT NULL,
    [BankCode] VARCHAR(50) NOT NULL,
    [BankName] VARCHAR(200) NULL,
    [AccountNo] VARCHAR(50) NULL,
    [AccountName] VARCHAR(200) NULL,
    [AccountType] VARCHAR(200) NULL,
    [CMSCode] VARCHAR(200) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.VSAT_IDS
-- --------------------------------------------------
CREATE TABLE [dbo].[VSAT_IDS]
(
    [SrNo] VARCHAR(255) NULL,
    [SiteCode] VARCHAR(255) NULL,
    [Relations] VARCHAR(255) NULL,
    [Site] VARCHAR(255) NULL,
    [Address] VARCHAR(255) NULL,
    [PhNo] VARCHAR(255) NULL,
    [ContactPerson] VARCHAR(255) NULL,
    [IPaddress] VARCHAR(255) NULL,
    [aaa] VARCHAR(255) NULL,
    [bbb] VARCHAR(255) NULL,
    [LoginID] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TABLE dbo.vsat_login_id
-- --------------------------------------------------
CREATE TABLE [dbo].[vsat_login_id]
(
    [sitecode] VARCHAR(255) NULL,
    [loginid] VARCHAR(255) NULL
);

GO

-- --------------------------------------------------
-- TRIGGER dbo.ApproveRquest
-- --------------------------------------------------
CREATE TRIGGER ApproveRquest
ON tbl_Request
AFTER Update
as 
declare @MaxLevel as int
declare @level as int
declare @Prelevel as int
declare @IsApproved as int
declare @ApprovedBy as varchar(100)
declare @ApprovedDate as varchar(100)

select @MaxLevel =max(LevelId) from tbl_Level
select @level = LevelId ,@IsApproved = IsApproved,@ApprovedBy=ApprovedBy,@ApprovedDate=ApprovedDate from inserted
select @Prelevel=LevelId from deleted

update tbl_Request_status
set IsApproved=@IsApproved,
ApprovedBy=@ApprovedBy
where LevelId=@Prelevel



if (@MaxLevel<=@level)
begin 
insert into tbl_Request_status(Request,RaisedBy,RaisedDate ,LevelId,IsApproved,ApprovedBy,ApprovedDate)
select Request,RaisedBy,RaisedDate ,LevelId,IsApproved,ApprovedBy,ApprovedDate  from inserted
end

GO

-- --------------------------------------------------
-- TRIGGER dbo.Limit_Violation_Log
-- --------------------------------------------------
CREATE TRIGGER Limit_Violation_Log 
   ON  dbo.periodicity
   AFTER UPDATE
AS 
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	DECLARE @perioducity varchar(100)
	
    -- Insert statements for trigger here
    select @perioducity= value from inserted
    
	insert into Periodicity_Update_Log(Perioducity,Updatedate)
	values(@perioducity,GETDATE())
	
END

GO

-- --------------------------------------------------
-- TRIGGER dbo.NewRquest
-- --------------------------------------------------
CREATE TRIGGER NewRquest
ON tbl_Request
AFTER INSERT
as 
insert into tbl_Request_status(Request,RaisedBy,RaisedDate ,LevelId,IsApproved)
select Request,RaisedBy,RaisedDate ,LevelId,IsApproved from inserted

GO

-- --------------------------------------------------
-- TRIGGER dbo.tShift
-- --------------------------------------------------
CREATE trigger [dbo].[tShift] on [dbo].[Shift] for delete 
as
insert into LogShift(old_kyc_code,branch,sub_broker,new_kyc_code)
select old_kyc_code,branch,sub_broker,new_kyc_code From deleted

where ltrim(rtrim(Old_Kyc_Code))+ltrim(rtrim(New_Kyc_Code))+ltrim(rtrim(branch))+ltrim(rtrim(sub_broker))
 not in (Select ltrim(rtrim(Old_Kyc_Code))+ltrim(rtrim(New_Kyc_Code))+ltrim(rtrim(branch))+ltrim(rtrim(sub_broker)) from LogShift with(Nolock))

GO

-- --------------------------------------------------
-- VIEW dbo.AllSebiBannedEntities
-- --------------------------------------------------
create view AllSebiBannedEntities
As
select [SrNo]=sr,[ClientName]=name,[PanNo]=pan_no,[SebiOrderDate]=dt_sebi_order,[OrderNo]=order_no,
[BriefParticulars]=brief_particulars,[StartDate]=start_date,[EndDate]=end_date from sebi_banned

GO

-- --------------------------------------------------
-- VIEW dbo.Angel_GetPayDetails
-- --------------------------------------------------
create view Angel_GetPayDetails  
as  
SELECT   
clientcode,NMARKETSEGMENTID=0,segment=' ',AmountCredited,  
NSERVICECHARGE=0,TransactionDate,PaymentReferenceNumber,SGROUPID=SPACE(10),NPROCESSFLAG=0,BankName,AgencyId=' ',  
BankTranId,SFROMACCNO=' ',STOACCNO=' '  
FROM angelanywhere.ams.dbo.AMSCLIENTBANKDETAILS (nolock) where status='Accepted'

GO

-- --------------------------------------------------
-- VIEW dbo.Bank_FundsPayout
-- --------------------------------------------------
CREATE view Bank_FundsPayout  
as  
select   
a.sLoginId,a.nMarketSegmentId,d.sUserDefinedExchangeName,/*a.nAmount*/namount=nTxnAmt,a.nServiceCharge,a.sDateTime,a.nTxnRefNo,a.sGroupId,a.nProcessFlag,  
c.sBankId,c.sAgencyId,b.sBankRefNo,c.sFromAccNo,c.sToAccNo  
from   
[10.30.30.7].OdinConnect7.dbo.tbl_FundsAllocation a,   
[10.30.30.7].OdinConnect7.dbo.tbl_BankResponse b,   
[10.30.30.7].OdinConnect7.dbo.tbl_BankRequest c,  
[10.30.30.7].OdinConnect7.dbo.tbl_ExchangeDetails d  
where a.nTxnRefNo=b.nTxnRefNo and a.nTxnRefNo=c.nTxnRefNo    
AND a.nMarketSegmentId=d.nExchangeid  
AND b.sBankRefNo <> 0

GO

-- --------------------------------------------------
-- VIEW dbo.Bank_FundsPayout16
-- --------------------------------------------------
CREATE view Bank_FundsPayout16      
as      
    
select       
a.sLoginId,    
--a.nMarketSegmentId,    
nMarketSegmentId=a.sproductId,    
--d.sUserDefinedExchangeName,    
sUserDefinedExchangeName=d.sproductname,    
a.nAmount,a.nServiceCharge,a.sDateTime,a.nTxnRefNo,a.sGroupId,a.nProcessFlag,      
c.sBankId,    
--c.sAgencyId,    
sAgencyId='',    
b.sBankRefNo,c.sFromAccNo,c.sToAccNo,    
product=(Case when sProductType='diet' then 'AngelDiet' else 'AngelTrade' end)    
from       
[10.30.30.16].PG.dbo.tbl_FundsAllocation a,       
(select * from [10.30.30.16].PG.dbo.tbl_BankResponse where nResponseCode=0) b,       
[10.30.30.16].PG.dbo.tbl_BankRequest c,
[10.30.30.16].PG.dbo.tbl_ProductMaster d
--,PG.dbo.tbl_ExchangeDetails d      
where a.nTxnRefNo=b.nTxnRefNo and a.nTxnRefNo=c.nTxnRefNo and a.sproductId=d.sproductId       
--AND a.nMarketSegmentId=d.nExchangeid      
AND b.sBankRefNo <> 0

GO

-- --------------------------------------------------
-- VIEW dbo.Bank_FundsPayout22
-- --------------------------------------------------
CREATE view Bank_FundsPayout22        
as                
              
select                 
a.sLoginId,              
--a.nMarketSegmentId,              
nMarketSegmentId=a.sproductId,              
--d.sUserDefinedExchangeName,              
sUserDefinedExchangeName=d.sproductname,              
a.nAmount,a.nServiceCharge,a.sDateTime,a.nTxnRefNo,a.sGroupId,a.nProcessFlag,                
c.sBankId,              
--c.sAgencyId,              
sAgencyId='',              
b.sBankRefNo,c.sFromAccNo,c.sToAccNo,              
product=(Case when sProductType='diet' then 'AngelDiet' else 'AngelTrade' end)              
from                 
[172.31.15.22].PG.dbo.tbl_FundsAllocation a with (nolock),                 
(select * from [172.31.15.22].PG.dbo.tbl_BankResponse with (nolock) where nResponseCode=0) b,                 
[172.31.15.22].PG.dbo.tbl_BankRequest c with (nolock),          
(select sproductid,sproductName from [172.31.15.22].PG.dbo.tbl_ProductMaster with (nolock) where sactive=1 group by sproductid,sproductName) d          
--,PG.dbo.tbl_ExchangeDetails d                
where a.nTxnRefNo=b.nTxnRefNo and a.nTxnRefNo=c.nTxnRefNo and a.sproductId=d.sproductId                 
--AND a.nMarketSegmentId=d.nExchangeid                
AND b.sBankRefNo <> '0'

GO

-- --------------------------------------------------
-- VIEW dbo.Bank_FundsPayout7
-- --------------------------------------------------
CREATE view Bank_FundsPayout7  
as          
        
select           
a.sLoginId,        
--a.nMarketSegmentId,        
nMarketSegmentId=a.sproductId,        
--d.sUserDefinedExchangeName,        
sUserDefinedExchangeName=d.sproductname,        
a.nAmount,a.nServiceCharge,a.sDateTime,a.nTxnRefNo,a.sGroupId,a.nProcessFlag,          
c.sBankId,        
--c.sAgencyId,        
sAgencyId='',        
b.sBankRefNo,c.sFromAccNo,c.sToAccNo,        
product=(Case when sProductType='diet' then 'AngelDiet' else 'AngelTrade' end)        
from           
[10.30.30.7].PG.dbo.tbl_FundsAllocation a,           
(select * from [10.30.30.7].PG.dbo.tbl_BankResponse where nResponseCode=0) b,           
[10.30.30.7].PG.dbo.tbl_BankRequest c,    
[10.30.30.7].PG.dbo.tbl_ProductMaster d    
--,PG.dbo.tbl_ExchangeDetails d          
where a.nTxnRefNo=b.nTxnRefNo and a.nTxnRefNo=c.nTxnRefNo and a.sproductId=d.sproductId           
--AND a.nMarketSegmentId=d.nExchangeid          
AND b.sBankRefNo <> 0

GO

-- --------------------------------------------------
-- VIEW dbo.DealerWise_TO
-- --------------------------------------------------
CREATE View DealerWise_TO
as
select  m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T)) --into #t
from 
mis.dbo.BSE_ord_client_info m with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id 
union all
select m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T))
from 
mis.dbo.NSE_ord_client_info m with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id 
union all
select m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T))
from 
mis.dbo.FO_ord_client_info m with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id 
union all
select m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T))
from 
mis.dbo.MCDX_ord_client_info m with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id 
union all
select m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T))
from 
mis.dbo.NCDX_ord_client_info m with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id 
union all
select m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T))
from 
mis.dbo.MCXSX_ord_client_info m with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id 
union all
select m.dealer_id,
weekTO=SUM( case when DATEPART(week,getdate())=DATEPART(week,saudadate)  and  year(getdate())=year(saudadate) then convert(float,T) else 0 end),
monthTO=sum(convert(float,T))
from 
mis.dbo.NSX_ord_client_info m     with (nolock)
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate()) 
group by m.dealer_id

GO

-- --------------------------------------------------
-- VIEW dbo.Exm_ClientTO
-- --------------------------------------------------
/* encrypted or not available */

GO

-- --------------------------------------------------
-- VIEW dbo.Get_BP
-- --------------------------------------------------
create view Get_BP    
as    
SELECT data=    
'01'--RECORD Type    
+'12033200'-- DP ID    
+'F'--Full,I-Incremental    
+convert(varchar(8),getdate(),112)--IncrementalRef Date time    
+replace(convert(varchar(10),getdate(),108),':','')    
+convert(varchar(8),getdate(),112)--IncrementalRef Date time    
+replace(convert(varchar(10),getdate(),108),':','')    
+right(replicate('0',7)+convert(varchar(10),count(1)),7)+' ',ord=0 from temp_BP (nolock)    
union    
SELECT     
data='02'+right(replicate('0',7)+convert(varchar(7),CTR),7)+    
right(replicate('0',8)+convert(varchar(8),bp_id),8)    
+bp_role  
+left(bp_add1+replicate(' ',36),36)    
+left(bp_add2+replicate(' ',36),36)    
+left(bp_add3+replicate(' ',36),36)    
+left(bp_add4+replicate(' ',36),36)    
+left(bp_pin+replicate(' ',7),7)    
+left(bp_phone+replicate(' ',24),24)    
+left(bp_fax+replicate(' ',24),24)    
+left(bp_Assd_CC_Id+replicate(' ',8),8)   
+left(bp_Assd_dp_Id+replicate(' ',8),8)     
+left(bp_Assd_CC_cmId+replicate(' ',16),16)   
+left(bp_category+replicate(' ',2),2)   
+left(bp_name+replicate(' ',135),135)   
+left(bp_category+replicate(' ',2),2)   
,ord=1    
FROM temp_BP (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.Mimansa_PostVeriData
-- --------------------------------------------------

CREATE view [dbo].[Mimansa_PostVeriData]    
as      
select party_Code as Sloginid,      
Segment as Exchseg,    
Amount as S__Amount,    
LogDate as R__Response_time,    
VerificationReferenceNo as R__Payment_reference_number,      
BankName as R__BAnk_name,    
Vendor as S__SubMerchant_id,    
BankAccountNo as SFromAccNo,    
AppName as product,     
VerificationStatus as LimitUpdationAPIStatus    
from mimansa.general.dbo.VW_TransactionVrfLog     
where   
--AppName <>'NBFC' /* commented by Neha on Sep 07 2015*/  
/*AppName not in ('NBFC','SCB-VIRTUAL','KYC')*/  /*Commented on 23 Nov 2017 by Neha*/
AppName not in ('NBFC','SCB-VIRTUAL','SCB -VIRTUAL1','SCB -VIRTUAL2','KYC')

GO

-- --------------------------------------------------
-- VIEW dbo.NseNewScripAdded
-- --------------------------------------------------
create view NseNewScripAdded
as
select a.* from security a (nolock) 
left outer join security_prev b (nolock) 
on a.scrip_Code=b.scrip_Code and a.cagegory=b.cagegory 
where b.scrip_code is null 
and a.cagegory in ('EQ','BE')

GO

-- --------------------------------------------------
-- VIEW dbo.NseNewScripAdded_EQBE
-- --------------------------------------------------
CREATE view NseNewScripAdded_EQBE
as 
select scrip_code=isnull(a.scrip_code,b.scrip_code),
cagegory=
case 
when a.cagegory is null and b.cagegory is not null then b.cagegory 
when a.cagegory is not null and b.cagegory is null then a.cagegory 
else a.cagegory+','+b.cagegory 
end,
upload_date=isnull(a.upload_date,b.upload_date)
from
(select * from NseNewScripAdded where cagegory='EQ') a full outer join
(select * from NseNewScripAdded where cagegory='BE') b
on a.scrip_code=b.scrip_code

GO

-- --------------------------------------------------
-- VIEW dbo.PMS_Bse_NetRate
-- --------------------------------------------------
/* encrypted or not available */

GO

-- --------------------------------------------------
-- VIEW dbo.PMS_DERV_FO_NETRATE
-- --------------------------------------------------
/* encrypted or not available */

GO

-- --------------------------------------------------
-- VIEW dbo.PMS_Nse_NetRate
-- --------------------------------------------------
/* encrypted or not available */

GO

-- --------------------------------------------------
-- VIEW dbo.SubbrokerWise_TO
-- --------------------------------------------------
CREATE View SubbrokerWise_TO  
as  
select  m.SUB_BROKER,  
monthTO=sum(convert(float,T)) --into #t  
from   
mis.dbo.BSE_ord_client_info m with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER   
union all  
select m.SUB_BROKER,  
monthTO=sum(convert(float,T))  
from   
mis.dbo.NSE_ord_client_info m with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER   
union all  
select m.SUB_BROKER,  
monthTO=sum(convert(float,T))  
from   
mis.dbo.FO_ord_client_info m with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER   
union all  
select m.SUB_BROKER,  
monthTO=sum(convert(float,T))  
from   
mis.dbo.MCDX_ord_client_info m with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER   
union all  
select m.SUB_BROKER,  
monthTO=sum(convert(float,T))  
from   
mis.dbo.NCDX_ord_client_info m with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER   
union all  
select m.SUB_BROKER,  
monthTO=sum(convert(float,T))  
from   
mis.dbo.MCXSX_ord_client_info m with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER   
union all  
select m.SUB_BROKER,  
monthTO=sum(convert(float,T))  
from   
mis.dbo.NSX_ord_client_info m     with (nolock)  
where month(saudadate)=month(getdate()) and year(saudadate)=year(getdate())   
group by m.SUB_BROKER

GO

-- --------------------------------------------------
-- VIEW dbo.V_BANKMASTER
-- --------------------------------------------------
CREATE VIEW V_BANKMASTER
AS
select SEGMENT='NBFC',CLTCODE,LONGNAME from [196.1.115.225].ACCOUNTNBFC.DBO.ACMAST WHERE GRPCODE IN ('X0101010000','A0316000000')
UNION
select * from risk.dbo.bankMaster

GO

-- --------------------------------------------------
-- VIEW dbo.v_ctcl_mgrloc
-- --------------------------------------------------
CREATE view v_ctcl_mgrloc
as
SELECT [LocaCode], [LocaName], [Branch_cd],[SegmentAllowed],connectivity_type,fld_serverid,fld_server=b.branch_name FROM [CtclMgrLocation] a
left outer join
(select [Branch_Name]='-',SrNo=0 union
SELECT DISTINCT [Branch_Name], [SrNo] FROM [ctcl1.1].dbo.[CTCL_BRANCH] )b
on a.fld_serverid=b.srno

GO

-- --------------------------------------------------
-- VIEW dbo.V_KYC_OLDNEW_SHIFTING
-- --------------------------------------------------



CREATE VIEW [dbo].[V_KYC_OLDNEW_SHIFTING]
AS
SELECT old_branchcode = y.branch_cd, old_subbrokercode = y.sub_broker, x.*
FROM (
	SELECT DISTINCT a.*
	FROM (
		SELECT DISTINCT x.*
		FROM (
			SELECT OLD_KYC_CODE, New_BranchCode = BRANCH, New_Subbrokercode = SUB_BROKER, NEW_KYC_CODE, EntryDate
			FROM LogShift WITH (NOLOCK)
			WHERE NEW_KYC_CODE NOT IN (
					SELECT NEW_KYC_CODE
					FROM Shift WITH (NOLOCK)
					)
			) x
		INNER  JOIN (
			SELECT new_kyc_code, Entrydate = max(Entrydate)
			FROM LogShift WITH (NOLOCK)
			GROUP BY new_kyc_code
			) y
			ON x.new_kyc_code = y.new_kyc_code
				AND x.Entrydate = y.Entrydate
		) a
	INNER  JOIN (
		SELECT DISTINCT x.*
		FROM (
			SELECT OLD_KYC_CODE, BRANCH, SUB_BROKER, NEW_KYC_CODE, EntryDate
			FROM LogShift WITH (NOLOCK)
			WHERE OLD_KYC_CODE NOT IN (
					SELECT OLD_KYC_CODE
					FROM Shift WITH (NOLOCK)
					)
			) x
		INNER  JOIN (
			SELECT OLD_KYC_CODE, Entrydate = max(Entrydate)
			FROM LogShift WITH (NOLOCK)
			GROUP BY OLD_KYC_CODE
			) y
			ON x.OLD_KYC_CODE = y.OLD_KYC_CODE
				AND x.Entrydate = y.Entrydate
		) b
		ON a.OLD_KYC_CODE = b.OLD_KYC_CODE
			AND a.NEW_KYC_CODE = b.NEW_KYC_CODE
			AND a.entrydate = b.entrydate
	
	UNION
	
	SELECT DISTINCT a.*
	FROM (
		SELECT DISTINCT x.*
		FROM (
			SELECT OLD_KYC_CODE, BRANCH, SUB_BROKER, NEW_KYC_CODE, EntryDate
			FROM Shift WITH (NOLOCK)
			) x
		INNER  JOIN (
			SELECT new_kyc_code, Entrydate = max(Entrydate)
			FROM Shift WITH (NOLOCK)
			GROUP BY new_kyc_code
			) y
			ON x.new_kyc_code = y.new_kyc_code
				AND x.Entrydate = y.Entrydate
		) a
	INNER  JOIN (
		SELECT DISTINCT x.*
		FROM (
			SELECT OLD_KYC_CODE, BRANCH, SUB_BROKER, NEW_KYC_CODE, EntryDate
			FROM Shift WITH (NOLOCK)
			) x
		INNER  JOIN (
			SELECT OLD_KYC_CODE, Entrydate = max(Entrydate)
			FROM Shift WITH (NOLOCK)
			GROUP BY OLD_KYC_CODE
			) y
			ON x.OLD_KYC_CODE = y.OLD_KYC_CODE
				AND x.Entrydate = y.Entrydate
		) b
		ON a.OLD_KYC_CODE = b.OLD_KYC_CODE
			AND a.NEW_KYC_CODE = b.NEW_KYC_CODE
			AND a.entrydate = b.entrydate
	) x
INNER  JOIN risk.dbo.client_details y WITH (NOLOCK)
	ON x.old_kyc_code = y.party_code

GO

-- --------------------------------------------------
-- VIEW dbo.V_PMS_INFO
-- --------------------------------------------------
CREATE View V_PMS_INFO    
as    
select * from PMS_INFO with (nolock)    
union    
select party_code='98'+party_code,scheme,scheme_name,Discret_Flag from PMS_INFO with (nolock)
union
select party_code='88'+party_code,scheme,scheme_name,'N' as Discret_Flag from PMS_INFO with (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.V_temp_mis_file1
-- --------------------------------------------------
CREATE VIEW V_temp_mis_file1    
AS    
    
select sLoginId,nMarketSegmentId,nAmount,nServiceCharge,sDateTime,  
nTxnRefNo,sGroupId,nProcessFlag,sBankId,sAgencyId,sBankRefNo,sFromAccNo,sToAccNo,  
product,    
case     
when  (sUserDefinedExchangeName = 'BSE' or sUserDefinedExchangeName = 'BSE CASH' or sUserDefinedExchangeName = 'BSE EQUITIES') then 'BSE'    
when  (sUserDefinedExchangeName = 'NSE' or sUserDefinedExchangeName = 'NSE CASH' or sUserDefinedExchangeName = 'NSE EQUITIES') then 'NSE'    
when  (sUserDefinedExchangeName = 'NSE DERIVATIVES' or sUserDefinedExchangeName = 'NSE FO' or sUserDefinedExchangeName = 'NSEFO') then 'NSEFO'    
when  (sUserDefinedExchangeName = 'MCX' or sUserDefinedExchangeName = 'MCX FUTURES') then 'MCX'    
when  (sUserDefinedExchangeName = 'NCDEX' or sUserDefinedExchangeName = 'NCDEX FUTURES' ) then 'NCDEX'    
when  (sUserDefinedExchangeName = 'MARGIN' ) then 'MARGIN FUNDING' ELSE sUserDefinedExchangeName    
end  AS sUserDefinedExchangeName from temp_mis_file1a 
UNION
select sLoginId,nMarketSegmentId,nAmount,nServiceCharge,sDateTime,  
nTxnRefNo,sGroupId,nProcessFlag,sBankId,sAgencyId,sBankRefNo,sFromAccNo,sToAccNo,  
product,    
case     
when  (sUserDefinedExchangeName = 'BSE' or sUserDefinedExchangeName = 'BSE CASH' or sUserDefinedExchangeName = 'BSE EQUITIES') then 'BSE'    
when  (sUserDefinedExchangeName = 'NSE' or sUserDefinedExchangeName = 'NSE CASH' or sUserDefinedExchangeName = 'NSE EQUITIES') then 'NSE'    
when  (sUserDefinedExchangeName = 'NSE DERIVATIVES' or sUserDefinedExchangeName = 'NSE FO' or sUserDefinedExchangeName = 'NSEFO') then 'NSEFO'    
when  (sUserDefinedExchangeName = 'MCX' or sUserDefinedExchangeName = 'MCX FUTURES') then 'MCX'    
when  (sUserDefinedExchangeName = 'NCDEX' or sUserDefinedExchangeName = 'NCDEX FUTURES' ) then 'NCDEX'    
when  (sUserDefinedExchangeName = 'MARGIN' ) then 'MARGIN FUNDING' ELSE sUserDefinedExchangeName    
end  AS sUserDefinedExchangeName from temp_mis_file1

GO

-- --------------------------------------------------
-- VIEW dbo.VW_B2B_BROKER
-- --------------------------------------------------

  CREATE VIEW VW_B2B_BROKER  
AS   
  
SELECT SBTAG,BRANCH,TRADENAME,CONTACTPERSON,PANNO,SBCAT,REGION FROM (SELECT SBTAG,BRANCH,TRADENAME,CONTACTPERSON,PANNO,SBCAT  FROM 
[MIS].SB_COMP.DBO.SB_BROKER WHERE SBSTATUS<>'CLS' AND SBTAG<>'T A G' )A  
JOIN (SELECT REGION,TAG FROM [MIS].SB_COMP.DBO.VW_REGION_BRANCH_WITHTAG) B  
ON A.SBTAG=B.TAG

GO

-- --------------------------------------------------
-- VIEW dbo.vw_benchmark_cal
-- --------------------------------------------------

CREATE view vw_benchmark_cal          
As          
          
select proc_from_date,proc_to_date,department,branch_cd as branch,FTE_req,FTE_actual,zone,region,branchname,Regionname from           
tbl_benchmark_cal a join          
--intranet.risk.dbo.Vw_RMS_Client_Vertical b          
intranet.risk.dbo.Vw_branch_vertical b          
on a.branch_cd=b.branch --and a.subbrokcode=b.SB and a.party_code=b.client         
collate Latin1_General_CI_AS

GO

-- --------------------------------------------------
-- VIEW dbo.Vw_CliFundsTrf_payin
-- --------------------------------------------------
Create View Vw_CliFundsTrf_payin
as 
select * from temp_mis_file1 (nolock)

GO

-- --------------------------------------------------
-- VIEW dbo.Vw_GetOldCode_ToNewCode
-- --------------------------------------------------

CREATE View [dbo].[Vw_GetOldCode_ToNewCode]
as    
SELECT OLD_KYC_CODE,NEW_KYC_CODE,EntryDate FROM testdb.dbo.V_KYC_OLDNEW_SHIFTING v WITH(NOLOCK)
UNION
SELECT OLD_KYC_CODE,NEW_KYC_CODE,EntryDate FROM testdb.dbo.shift v WITH(NOLOCK)

GO

-- --------------------------------------------------
-- VIEW dbo.Vw_temp_mis_file1a
-- --------------------------------------------------
Create View Vw_temp_mis_file1a
as
SELECT sloginid,
       nmarketsegmentid,
       suserdefinedexchangename,
       namount,
       nservicecharge,
       sdatetime,
       ntxnrefno,
       sgroupid,
       nprocessflag,
       sbankid,
       sagencyid,
       sbankrefno,
       sfromaccno,
       stoaccno,
       product
FROM   testdb.dbo.temp_mis_file1a 
with (nolock)
WHERE  sdatetime >= Getdate() - 7

GO

-- --------------------------------------------------
-- VIEW dbo.vw_tran_pg_combine
-- --------------------------------------------------

CREATE View [dbo].[vw_tran_pg_combine]      
as      
select party_Code as Sloginid,      
Segment as Exchseg,      
Amount as S__Amount,      
--LimitUpdateResponseRecvdAt as R__Response_time, -- Commented by Mukesh on Jul 27 2013      
TransactionDate as R__Response_time,      
TransactionReferenceNo as R__Payment_reference_number,      
BankName as R__BAnk_name,      
Vendor as S__SubMerchant_id,      
BankAccountNo as SFromAccNo,      
AppName as product,      
--LimitUpdationAPIStatus -- Commented by Mukesh on Jul 27 2013      
LimitUpdationAPIStatus = TransactionStatus      
from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog with (nolock) where    
/*AppName <>'NBFC'  commented by Neha on Sep 07 2015*/  
AppName not in ('NBFC','SCB -VIRTUAL', 'SCB -VIRTUAL1', 'SCB -VIRTUAL2','KYC')  
and (verificationRemark='Success' Or ReVerificationRemark='Success')
and TransactionVerified='Y' AND TransactionStatus = 'OK'

GO

-- --------------------------------------------------
-- VIEW dbo.vw_tran_pg_combine_23Nov2017
-- --------------------------------------------------

create View [dbo].[vw_tran_pg_combine_23Nov2017]      
as      
select party_Code as Sloginid,      
Segment as Exchseg,      
Amount as S__Amount,      
--LimitUpdateResponseRecvdAt as R__Response_time, -- Commented by Mukesh on Jul 27 2013      
TransactionDate as R__Response_time,      
TransactionReferenceNo as R__Payment_reference_number,      
BankName as R__BAnk_name,      
Vendor as S__SubMerchant_id,      
BankAccountNo as SFromAccNo,      
AppName as product,      
--LimitUpdationAPIStatus -- Commented by Mukesh on Jul 27 2013      
LimitUpdationAPIStatus = TransactionStatus      
from mimansa.general.dbo.tbl_AngelPGIMBOTransactionLog with (nolock) where    
/*AppName <>'NBFC'  commented by Neha on Sep 07 2015*/  
AppName not in ('NBFC','SCB-VIRTUAL','SCB -VIRTUAL1','SCB -VIRTUAL2','KYC')  
and verificationRemark='Success'               
and TransactionVerified='Y'

GO

